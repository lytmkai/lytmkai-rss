<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[机器学习核心算法全景解析：从原理到实战]]></title>    <link>https://juejin.cn/post/7593600903249379354</link>    <guid>https://juejin.cn/post/7593600903249379354</guid>    <pubDate>2026-01-11T01:32:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593600903249379354" data-draft-id="7593375360554795058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="机器学习核心算法全景解析：从原理到实战"/> <meta itemprop="keywords" content="机器学习"/> <meta itemprop="datePublished" content="2026-01-11T01:32:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            机器学习核心算法全景解析：从原理到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-11T01:32:56.000Z" title="Sun Jan 11 2026 01:32:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：走进智能时代的核心引擎</h2>
<p>各位读者朋友，大家好！在这个数据爆炸的时代，机器学习已经悄然渗透到我们生活的方方面面——从手机的人脸识别、电商的推荐系统，到自动驾驶、医疗诊断，无不闪耀着机器学习算法的智慧光芒。今天，我将带大家深入探索机器学习的核心算法世界，不仅详细解析原理，还会附上实际代码示例和流程图，让你真正掌握这些改变世界的技术！</p>
<h2 data-id="heading-1">一、机器学习算法分类全景图</h2>
<pre><code class="hljs">机器学习算法监督学习无监督学习半监督学习强化学习分类算法回归算法逻辑回归决策树随机森林支持向量机朴素贝叶斯神经网络聚类算法降维算法K-means层次聚类DBSCANPCAt-SNE
</code></pre>
<h2 data-id="heading-2">二、监督学习：有导师的智能训练</h2>
<h3 data-id="heading-3">1. 线性回归：预测的基础支柱</h3>
<p><strong>算法原理</strong>：寻找特征与目标之间的线性关系</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LinearRegression
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> mean_squared_error, r2_score

<span class="hljs-comment"># 生成示例数据</span>
np.random.seed(<span class="hljs-number">42</span>)
X = <span class="hljs-number">2</span> * np.random.rand(<span class="hljs-number">100</span>, <span class="hljs-number">1</span>)
y = <span class="hljs-number">4</span> + <span class="hljs-number">3</span> * X + np.random.randn(<span class="hljs-number">100</span>, <span class="hljs-number">1</span>)

<span class="hljs-comment"># 划分数据集</span>
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 创建模型并训练</span>
model = LinearRegression()
model.fit(X_train, y_train)

<span class="hljs-comment"># 预测</span>
y_pred = model.predict(X_test)

<span class="hljs-comment"># 评估模型</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"截距: <span class="hljs-subst">{model.intercept_}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"系数: <span class="hljs-subst">{model.coef_}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"均方误差: <span class="hljs-subst">{mean_squared_error(y_test, y_pred):<span class="hljs-number">.2</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"R²分数: <span class="hljs-subst">{r2_score(y_test, y_pred):<span class="hljs-number">.2</span>f}</span>"</span>)

<span class="hljs-comment"># 可视化结果</span>
plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))
plt.scatter(X_test, y_test, color=<span class="hljs-string">'blue'</span>, label=<span class="hljs-string">'实际值'</span>)
plt.plot(X_test, y_pred, color=<span class="hljs-string">'red'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'预测值'</span>)
plt.xlabel(<span class="hljs-string">'特征X'</span>)
plt.ylabel(<span class="hljs-string">'目标y'</span>)
plt.title(<span class="hljs-string">'线性回归预测结果'</span>)
plt.legend()
plt.show()
</code></pre>
<p><strong>流程图解</strong>：</p>
<pre><code class="hljs">数据准备 → 计算损失函数 → 梯度下降优化 → 更新权重参数 → 重复直到收敛 → 得到最佳拟合直线
</code></pre>
<h3 data-id="heading-4">2. 逻辑回归：分类的经典算法</h3>
<p>虽然名字中有"回归"，但逻辑回归实际上是处理二分类问题的利器。</p>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import matplotlib.pyplot as plt
from sklearn.linear_model import LogisticRegression
from sklearn.datasets import make_classification
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report, confusion_matrix, roc_curve, auc

<span class="hljs-comment"># 创建分类数据集</span>
X, <span class="hljs-attr">y</span> = make_classification(n_samples=<span class="hljs-number">1000</span>, n_features=<span class="hljs-number">2</span>, n_informative=<span class="hljs-number">2</span>,
                           <span class="hljs-attr">n_redundant</span>=<span class="hljs-number">0</span>, n_clusters_per_class=<span class="hljs-number">1</span>,
                           <span class="hljs-attr">random_state</span>=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 划分数据集</span>
X_train, X_test, y_train, <span class="hljs-attr">y_test</span> = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 创建逻辑回归模型</span>
<span class="hljs-attr">log_reg</span> = LogisticRegression()
log_reg.fit(X_train, y_train)

<span class="hljs-comment"># 预测</span>
<span class="hljs-attr">y_pred</span> = log_reg.predict(X_test)
<span class="hljs-attr">y_pred_proba</span> = log_reg.predict_proba(X_test)[:, <span class="hljs-number">1</span>]

<span class="hljs-comment"># 评估模型</span>
print("分类报告:")
print(classification_report(y_test, y_pred))

print("\n混淆矩阵:")
print(confusion_matrix(y_test, y_pred))

<span class="hljs-comment"># ROC曲线</span>
fpr, tpr, <span class="hljs-attr">thresholds</span> = roc_curve(y_test, y_pred_proba)
<span class="hljs-attr">roc_auc</span> = auc(fpr, tpr)

plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))
plt.subplot(1, 2, 1)
plt.scatter(X_test<span class="hljs-section">[:, 0]</span>, X_test<span class="hljs-section">[:, 1]</span>, <span class="hljs-attr">c</span>=y_test, cmap=<span class="hljs-string">'coolwarm'</span>, alpha=<span class="hljs-number">0.6</span>)
plt.title('测试集数据分布')

plt.subplot(1, 2, 2)
plt.plot(fpr, tpr, <span class="hljs-attr">color</span>=<span class="hljs-string">'darkorange'</span>, lw=<span class="hljs-number">2</span>, label=f<span class="hljs-string">'ROC曲线 (AUC = {roc_auc:.2f})'</span>)
plt.plot(<span class="hljs-section">[0, 1]</span>, <span class="hljs-section">[0, 1]</span>, <span class="hljs-attr">color</span>=<span class="hljs-string">'navy'</span>, lw=<span class="hljs-number">2</span>, linestyle=<span class="hljs-string">'--'</span>)
plt.xlabel('假正率')
plt.ylabel('真正率')
plt.title('ROC曲线')
plt.legend()
plt.tight_layout()
plt.show()
</code></pre>
<h3 data-id="heading-5">3. 决策树：直观的可解释模型</h3>
<p>决策树通过一系列规则对数据进行分类，非常直观易懂。</p>
<pre><code class="hljs language-ini" lang="ini">from sklearn.tree import DecisionTreeClassifier, plot_tree
from sklearn.datasets import load_iris
from sklearn.model_selection import train_test_split
import matplotlib.pyplot as plt

<span class="hljs-comment"># 加载鸢尾花数据集</span>
<span class="hljs-attr">iris</span> = load_iris()
<span class="hljs-attr">X</span> = iris.data
<span class="hljs-attr">y</span> = iris.target
<span class="hljs-attr">feature_names</span> = iris.feature_names
<span class="hljs-attr">class_names</span> = iris.target_names

<span class="hljs-comment"># 划分数据集</span>
X_train, X_test, y_train, <span class="hljs-attr">y_test</span> = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 创建决策树模型</span>
<span class="hljs-attr">tree_clf</span> = DecisionTreeClassifier(max_depth=<span class="hljs-number">3</span>, random_state=<span class="hljs-number">42</span>)
tree_clf.fit(X_train, y_train)

<span class="hljs-comment"># 评估模型</span>
<span class="hljs-attr">train_score</span> = tree_clf.score(X_train, y_train)
<span class="hljs-attr">test_score</span> = tree_clf.score(X_test, y_test)

print(f"训练集准确率: {train_score:.2f}")
print(f"测试集准确率: {test_score:.2f}")

<span class="hljs-comment"># 可视化决策树</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">15</span>, <span class="hljs-number">10</span>))
plot_tree(tree_clf, 
          <span class="hljs-attr">feature_names</span>=feature_names,
          <span class="hljs-attr">class_names</span>=class_names,
          <span class="hljs-attr">filled</span>=<span class="hljs-literal">True</span>,
          <span class="hljs-attr">rounded</span>=<span class="hljs-literal">True</span>)
plt.title("决策树可视化")
plt.show()
</code></pre>
<p><strong>决策树构建流程</strong>：</p>
<pre><code class="hljs">开始
    ↓
选择最佳分裂特征（使用基尼指数或信息增益）
    ↓
根据特征阈值分割数据
    ↓
对每个子集重复上述过程
    ↓
达到停止条件（深度限制、样本数最小等）
    ↓
生成叶节点，确定类别
    ↓
结束
</code></pre>
<h3 data-id="heading-6">4. 随机森林：集体的智慧</h3>
<p>随机森林通过构建多个决策树并综合它们的预测结果，显著提升了模型的准确性和稳定性。</p>
<pre><code class="hljs language-ini" lang="ini">from sklearn.ensemble import RandomForestClassifier
from sklearn.datasets import make_classification
from sklearn.model_selection import train_test_split, cross_val_score
import numpy as np
import matplotlib.pyplot as plt

<span class="hljs-comment"># 创建复杂数据集</span>
X, <span class="hljs-attr">y</span> = make_classification(n_samples=<span class="hljs-number">1000</span>, n_features=<span class="hljs-number">20</span>, n_informative=<span class="hljs-number">15</span>,
                           <span class="hljs-attr">n_classes</span>=<span class="hljs-number">3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 划分数据集</span>
X_train, X_test, y_train, <span class="hljs-attr">y_test</span> = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 创建随机森林模型</span>
<span class="hljs-attr">rf_clf</span> = RandomForestClassifier(n_estimators=<span class="hljs-number">100</span>,  <span class="hljs-comment"># 树的数量</span>
                                <span class="hljs-attr">max_depth</span>=<span class="hljs-number">10</span>,      <span class="hljs-comment"># 最大深度</span>
                                <span class="hljs-attr">min_samples_split</span>=<span class="hljs-number">5</span>, <span class="hljs-comment"># 最小分裂样本数</span>
                                <span class="hljs-attr">random_state</span>=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 训练模型</span>
rf_clf.fit(X_train, y_train)

<span class="hljs-comment"># 评估模型</span>
<span class="hljs-attr">accuracy</span> = rf_clf.score(X_test, y_test)
print(f"随机森林测试集准确率: {accuracy:.2f}")

<span class="hljs-comment"># 交叉验证</span>
<span class="hljs-attr">cv_scores</span> = cross_val_score(rf_clf, X, y, cv=<span class="hljs-number">5</span>)
print(f"交叉验证平均得分: {cv_scores.mean():.2f} (+/- {cv_scores.std() * 2:.2f})")

<span class="hljs-comment"># 特征重要性分析</span>
<span class="hljs-attr">feature_importance</span> = rf_clf.feature_importances_
<span class="hljs-attr">indices</span> = np.argsort(feature_importance)[::-<span class="hljs-number">1</span>]

plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">12</span>, <span class="hljs-number">6</span>))
plt.title("特征重要性排序")
plt.bar(range(X.shape<span class="hljs-section">[1]</span>), feature_importance<span class="hljs-section">[indices]</span>)
plt.xlabel("特征索引")
plt.ylabel("重要性得分")
plt.xticks(range(X.shape<span class="hljs-section">[1]</span>), indices)
plt.show()
</code></pre>
<h3 data-id="heading-7">5. 支持向量机（SVM）：寻找最优边界</h3>
<p>SVM通过寻找最大化类别间隔的超平面来进行分类，特别适合高维空间。</p>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import matplotlib.pyplot as plt
from sklearn import svm
from sklearn.datasets import make_moons
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import accuracy_score

<span class="hljs-comment"># 创建非线性可分数据</span>
X, <span class="hljs-attr">y</span> = make_moons(n_samples=<span class="hljs-number">300</span>, noise=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 数据标准化</span>
<span class="hljs-attr">scaler</span> = StandardScaler()
<span class="hljs-attr">X_scaled</span> = scaler.fit_transform(X)

<span class="hljs-comment"># 划分数据集</span>
X_train, X_test, y_train, <span class="hljs-attr">y_test</span> = train_test_split(X_scaled, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 创建SVM模型（使用RBF核处理非线性问题）</span>
<span class="hljs-attr">svm_clf</span> = svm.SVC(kernel=<span class="hljs-string">'rbf'</span>,  <span class="hljs-comment"># 径向基函数核</span>
                  <span class="hljs-attr">C</span>=<span class="hljs-number">1.0</span>,         <span class="hljs-comment"># 正则化参数</span>
                  <span class="hljs-attr">gamma</span>=<span class="hljs-string">'scale'</span>, <span class="hljs-comment"># 核系数</span>
                  <span class="hljs-attr">random_state</span>=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 训练模型</span>
svm_clf.fit(X_train, y_train)

<span class="hljs-comment"># 预测</span>
<span class="hljs-attr">y_pred</span> = svm_clf.predict(X_test)
<span class="hljs-attr">accuracy</span> = accuracy_score(y_test, y_pred)
print(f"SVM测试集准确率: {accuracy:.2f}")

<span class="hljs-comment"># 可视化决策边界</span>
def plot_decision_boundary(clf, X, y):
    <span class="hljs-attr">h</span> = <span class="hljs-number">0.02</span>  <span class="hljs-comment"># 网格步长</span>
    x_min, <span class="hljs-attr">x_max</span> = X[:, <span class="hljs-number">0</span>].min() - <span class="hljs-number">1</span>, X[:, <span class="hljs-number">0</span>].max() + <span class="hljs-number">1</span>
    y_min, <span class="hljs-attr">y_max</span> = X[:, <span class="hljs-number">1</span>].min() - <span class="hljs-number">1</span>, X[:, <span class="hljs-number">1</span>].max() + <span class="hljs-number">1</span>
    xx, <span class="hljs-attr">yy</span> = np.meshgrid(np.arange(x_min, x_max, h),
                         np.arange(y_min, y_max, h))
    
    <span class="hljs-attr">Z</span> = clf.predict(np.c_[xx.ravel(), yy.ravel()])
    <span class="hljs-attr">Z</span> = Z.reshape(xx.shape)
    
    plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>, <span class="hljs-number">8</span>))
    plt.contourf(xx, yy, Z, <span class="hljs-attr">alpha</span>=<span class="hljs-number">0.3</span>, cmap=<span class="hljs-string">'coolwarm'</span>)
    plt.scatter(X<span class="hljs-section">[:, 0]</span>, X<span class="hljs-section">[:, 1]</span>, <span class="hljs-attr">c</span>=y, cmap=<span class="hljs-string">'coolwarm'</span>, edgecolors=<span class="hljs-string">'k'</span>)
    plt.xlabel('特征1')
    plt.ylabel('特征2')
    plt.title('SVM决策边界可视化')
    plt.show()

plot_decision_boundary(svm_clf, X_train, y_train)
</code></pre>
<h2 data-id="heading-8">三、无监督学习：发现数据的隐藏结构</h2>
<h3 data-id="heading-9">1. K-means聚类：数据分组利器</h3>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import matplotlib.pyplot as plt
from sklearn.cluster import KMeans
from sklearn.datasets import make_blobs
from sklearn.metrics import silhouette_score
from sklearn.preprocessing import StandardScaler

<span class="hljs-comment"># 生成模拟数据</span>
X, <span class="hljs-attr">y_true</span> = make_blobs(n_samples=<span class="hljs-number">300</span>, centers=<span class="hljs-number">4</span>, cluster_std=<span class="hljs-number">0.60</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 数据标准化</span>
<span class="hljs-attr">scaler</span> = StandardScaler()
<span class="hljs-attr">X_scaled</span> = scaler.fit_transform(X)

<span class="hljs-comment"># 使用肘部方法确定最佳K值</span>
<span class="hljs-attr">inertia</span> = []
<span class="hljs-attr">silhouette_scores</span> = []
<span class="hljs-attr">K_range</span> = range(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>)

for k in K_range:
    <span class="hljs-attr">kmeans</span> = KMeans(n_clusters=k, random_state=<span class="hljs-number">42</span>, n_init=<span class="hljs-number">10</span>)
    kmeans.fit(X_scaled)
    inertia.append(kmeans.inertia_)
    
    if len(set(kmeans.labels_)) &gt; 1:  <span class="hljs-comment"># 确保有多个簇</span>
        silhouette_scores.append(silhouette_score(X_scaled, kmeans.labels_))
    else:
        silhouette_scores.append(0)

<span class="hljs-comment"># 可视化结果</span>
fig, <span class="hljs-attr">axes</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, figsize=(<span class="hljs-number">15</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 原始数据</span>
axes<span class="hljs-section">[0]</span>.scatter(X_scaled<span class="hljs-section">[:, 0]</span>, X_scaled<span class="hljs-section">[:, 1]</span>, <span class="hljs-attr">s</span>=<span class="hljs-number">50</span>)
axes<span class="hljs-section">[0]</span>.set_title('原始数据分布')

<span class="hljs-comment"># 肘部法则图</span>
axes<span class="hljs-section">[1]</span>.plot(K_range, inertia, 'bo-')
axes<span class="hljs-section">[1]</span>.set_xlabel('簇数量 K')
axes<span class="hljs-section">[1]</span>.set_ylabel('误差平方和')
axes<span class="hljs-section">[1]</span>.set_title('肘部法则')

<span class="hljs-comment"># 轮廓系数图</span>
axes<span class="hljs-section">[2]</span>.plot(K_range<span class="hljs-section">[:len(silhouette_scores)]</span>, silhouette_scores, 'ro-')
axes<span class="hljs-section">[2]</span>.set_xlabel('簇数量 K')
axes<span class="hljs-section">[2]</span>.set_ylabel('轮廓系数')
axes<span class="hljs-section">[2]</span>.set_title('轮廓系数法')

plt.tight_layout()
plt.show()

<span class="hljs-comment"># 使用最佳K值进行聚类</span>
<span class="hljs-attr">best_k</span> = <span class="hljs-number">4</span>  <span class="hljs-comment"># 根据上图确定</span>
<span class="hljs-attr">kmeans</span> = KMeans(n_clusters=best_k, random_state=<span class="hljs-number">42</span>, n_init=<span class="hljs-number">10</span>)
<span class="hljs-attr">y_pred</span> = kmeans.fit_predict(X_scaled)

<span class="hljs-comment"># 可视化聚类结果</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>, <span class="hljs-number">8</span>))
<span class="hljs-attr">colors</span> = [<span class="hljs-string">'red'</span>, <span class="hljs-string">'blue'</span>, <span class="hljs-string">'green'</span>, <span class="hljs-string">'purple'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'brown'</span>]
for i in range(best_k):
    plt.scatter(X_scaled<span class="hljs-section">[y_pred == i, 0]</span>, 
                X_scaled<span class="hljs-section">[y_pred == i, 1]</span>, 
                <span class="hljs-attr">s</span>=<span class="hljs-number">50</span>, c=colors[i], 
                <span class="hljs-attr">label</span>=f<span class="hljs-string">'簇 {i+1}'</span>)

<span class="hljs-comment"># 绘制聚类中心</span>
plt.scatter(kmeans.cluster_centers_<span class="hljs-section">[:, 0]</span>, 
            kmeans.cluster_centers_<span class="hljs-section">[:, 1]</span>, 
            <span class="hljs-attr">s</span>=<span class="hljs-number">200</span>, c=<span class="hljs-string">'yellow'</span>, marker=<span class="hljs-string">'*'</span>, 
            <span class="hljs-attr">label</span>=<span class="hljs-string">'聚类中心'</span>, edgecolors=<span class="hljs-string">'black'</span>)

plt.xlabel('特征1')
plt.ylabel('特征2')
plt.title('K-means聚类结果')
plt.legend()
plt.show()
</code></pre>
<p><strong>K-means算法流程</strong>：</p>
<pre><code class="hljs">初始化：随机选择K个中心点
    ↓
循环直到收敛：
    ↓
分配阶段：将每个点分配到最近的中心点
    ↓
更新阶段：重新计算每个簇的中心点
    ↓
判断是否收敛（中心点不再变化或达到最大迭代次数）
    ↓
输出：K个簇及其中心点
</code></pre>
<h3 data-id="heading-10">2. 主成分分析（PCA）：数据降维神器</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> sklearn.decomposition <span class="hljs-keyword">import</span> PCA
<span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> load_digits
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler

<span class="hljs-comment"># 加载手写数字数据集</span>
digits = load_digits()
X = digits.data
y = digits.target

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"原始数据维度: <span class="hljs-subst">{X.shape}</span>"</span>)

<span class="hljs-comment"># 数据标准化</span>
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

<span class="hljs-comment"># 计算主成分</span>
pca = PCA()
X_pca = pca.fit_transform(X_scaled)

<span class="hljs-comment"># 可视化累计方差解释率</span>
plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">8</span>))
cumulative_variance = np.cumsum(pca.explained_variance_ratio_)

plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)
plt.bar(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>), pca.explained_variance_ratio_[:<span class="hljs-number">10</span>])
plt.xlabel(<span class="hljs-string">'主成分'</span>)
plt.ylabel(<span class="hljs-string">'方差解释率'</span>)
plt.title(<span class="hljs-string">'前10个主成分的方差解释率'</span>)

plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)
plt.plot(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(cumulative_variance) + <span class="hljs-number">1</span>), cumulative_variance, <span class="hljs-string">'b-'</span>)
plt.xlabel(<span class="hljs-string">'主成分数量'</span>)
plt.ylabel(<span class="hljs-string">'累计方差解释率'</span>)
plt.axhline(y=<span class="hljs-number">0.95</span>, color=<span class="hljs-string">'r'</span>, linestyle=<span class="hljs-string">'--'</span>, label=<span class="hljs-string">'95%方差'</span>)
plt.legend()
plt.title(<span class="hljs-string">'累计方差解释率'</span>)

<span class="hljs-comment"># 使用前两个主成分可视化数据</span>
plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
scatter = plt.scatter(X_pca[:, <span class="hljs-number">0</span>], X_pca[:, <span class="hljs-number">1</span>], c=y, cmap=<span class="hljs-string">'tab10'</span>, alpha=<span class="hljs-number">0.6</span>)
plt.xlabel(<span class="hljs-string">'第一主成分'</span>)
plt.ylabel(<span class="hljs-string">'第二主成分'</span>)
plt.title(<span class="hljs-string">'PCA降维可视化 (2D)'</span>)
plt.colorbar(scatter, label=<span class="hljs-string">'数字标签'</span>)

<span class="hljs-comment"># 使用前三个主成分可视化（3D）</span>
<span class="hljs-keyword">from</span> mpl_toolkits.mplot3d <span class="hljs-keyword">import</span> Axes3D
ax = plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, projection=<span class="hljs-string">'3d'</span>)
scatter = ax.scatter(X_pca[:, <span class="hljs-number">0</span>], X_pca[:, <span class="hljs-number">1</span>], X_pca[:, <span class="hljs-number">2</span>], c=y, cmap=<span class="hljs-string">'tab10'</span>, alpha=<span class="hljs-number">0.6</span>)
ax.set_xlabel(<span class="hljs-string">'PC1'</span>)
ax.set_ylabel(<span class="hljs-string">'PC2'</span>)
ax.set_zlabel(<span class="hljs-string">'PC3'</span>)
ax.set_title(<span class="hljs-string">'PCA降维可视化 (3D)'</span>)

plt.tight_layout()
plt.show()

<span class="hljs-comment"># 查看降维后的数据信息</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"第一个主成分解释的方差比例: <span class="hljs-subst">{pca.explained_variance_ratio_[<span class="hljs-number">0</span>]:<span class="hljs-number">.2</span>%}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"前两个主成分累计解释的方差比例: <span class="hljs-subst">{cumulative_variance[<span class="hljs-number">1</span>]:<span class="hljs-number">.2</span>%}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"保留95%方差所需的主成分数量: <span class="hljs-subst">{np.argmax(cumulative_variance &gt;= <span class="hljs-number">0.95</span>) + <span class="hljs-number">1</span>}</span>"</span>)
</code></pre>
<h2 data-id="heading-11">四、神经网络：深度学习的基石</h2>
<h3 data-id="heading-12">多层感知机（MLP）：基础神经网络</h3>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import matplotlib.pyplot as plt
from sklearn.neural_network import MLPClassifier
from sklearn.datasets import make_classification
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import accuracy_score, confusion_matrix
import seaborn as sns

<span class="hljs-comment"># 创建复杂数据集</span>
X, <span class="hljs-attr">y</span> = make_classification(n_samples=<span class="hljs-number">1000</span>, n_features=<span class="hljs-number">20</span>, n_informative=<span class="hljs-number">15</span>,
                           <span class="hljs-attr">n_redundant</span>=<span class="hljs-number">2</span>, n_classes=<span class="hljs-number">3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 数据标准化</span>
<span class="hljs-attr">scaler</span> = StandardScaler()
<span class="hljs-attr">X_scaled</span> = scaler.fit_transform(X)

<span class="hljs-comment"># 划分数据集</span>
X_train, X_test, y_train, <span class="hljs-attr">y_test</span> = train_test_split(X_scaled, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 创建MLP模型</span>
<span class="hljs-attr">mlp</span> = MLPClassifier(hidden_layer_sizes=(<span class="hljs-number">100</span>, <span class="hljs-number">50</span>),  <span class="hljs-comment"># 两个隐藏层，分别有100和50个神经元</span>
                    <span class="hljs-attr">activation</span>=<span class="hljs-string">'relu'</span>,             <span class="hljs-comment"># 激活函数</span>
                    <span class="hljs-attr">solver</span>=<span class="hljs-string">'adam'</span>,                 <span class="hljs-comment"># 优化算法</span>
                    <span class="hljs-attr">alpha</span>=<span class="hljs-number">0.0001</span>,                  <span class="hljs-comment"># L2正则化参数</span>
                    <span class="hljs-attr">batch_size</span>=<span class="hljs-number">32</span>,                 <span class="hljs-comment"># 批大小</span>
                    <span class="hljs-attr">learning_rate_init</span>=<span class="hljs-number">0.001</span>,      <span class="hljs-comment"># 学习率</span>
                    <span class="hljs-attr">max_iter</span>=<span class="hljs-number">500</span>,                  <span class="hljs-comment"># 最大迭代次数</span>
                    <span class="hljs-attr">random_state</span>=<span class="hljs-number">42</span>,
                    <span class="hljs-attr">verbose</span>=<span class="hljs-literal">False</span>)

<span class="hljs-comment"># 训练模型</span>
mlp.fit(X_train, y_train)

<span class="hljs-comment"># 预测</span>
<span class="hljs-attr">y_pred</span> = mlp.predict(X_test)
<span class="hljs-attr">accuracy</span> = accuracy_score(y_test, y_pred)
print(f"MLP测试集准确率: {accuracy:.2f}")

<span class="hljs-comment"># 绘制训练损失曲线</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

plt.subplot(1, 2, 1)
plt.plot(mlp.loss_curve_)
plt.xlabel('迭代次数')
plt.ylabel('损失值')
plt.title('训练损失曲线')

<span class="hljs-comment"># 绘制混淆矩阵</span>
plt.subplot(1, 2, 2)
<span class="hljs-attr">cm</span> = confusion_matrix(y_test, y_pred)
sns.heatmap(cm, <span class="hljs-attr">annot</span>=<span class="hljs-literal">True</span>, fmt=<span class="hljs-string">'d'</span>, cmap=<span class="hljs-string">'Blues'</span>)
plt.xlabel('预测标签')
plt.ylabel('真实标签')
plt.title('混淆矩阵')

plt.tight_layout()
plt.show()

<span class="hljs-comment"># 查看模型结构信息</span>
print(f"模型层数: {mlp.n_layers_}")
print(f"模型参数数量: {mlp.coefs_<span class="hljs-section">[0]</span>.shape<span class="hljs-section">[0]</span> * mlp.coefs_<span class="hljs-section">[0]</span>.shape<span class="hljs-section">[1]</span> + mlp.coefs_<span class="hljs-section">[1]</span>.shape<span class="hljs-section">[0]</span> * mlp.coefs_<span class="hljs-section">[1]</span>.shape<span class="hljs-section">[1]</span>}")
</code></pre>
<h2 data-id="heading-13">五、算法选择指南：如何为你的问题选择合适算法</h2>
<h3 data-id="heading-14">算法选择流程图</h3>
<pre><code class="hljs language-ruby" lang="ruby">是

否

连续值

类别

发现结构

降维

是

否

是

否

小量数据

大量数据

是

否

是

否

开始选择算法是否有标签数据<span class="hljs-string">?预</span>测连续值还是类别<span class="hljs-string">?目</span>标是发现结构还是降维<span class="hljs-string">?回</span>归算法分类算法聚类算法降维算法数据线性<span class="hljs-string">?线</span>性回归多项式回归或树模型需要可解释性<span class="hljs-string">?决</span>策树/随机森林数据量大小<span class="hljs-string">?支</span>持向量机神经网络已知簇数量<span class="hljs-string">?K</span>-means聚类层次聚类或<span class="hljs-variable constant_">DBSCAN</span>需要可视化<span class="hljs-string">?t</span>-<span class="hljs-variable constant_">SNE</span>主成分分析
</code></pre>
<h3 data-id="heading-15">各算法关键特点总结表</h3>




































































<table><thead><tr><th>算法</th><th>类型</th><th>主要优势</th><th>适用场景</th><th>注意事项</th></tr></thead><tbody><tr><td><strong>线性回归</strong></td><td>监督/回归</td><td>简单、可解释性强</td><td>预测连续值，特征与目标呈线性关系</td><td>对异常值敏感，假设线性关系</td></tr><tr><td><strong>逻辑回归</strong></td><td>监督/分类</td><td>概率输出，可解释性好</td><td>二分类问题，需要概率估计</td><td>只能处理线性可分问题（核技巧可扩展）</td></tr><tr><td><strong>决策树</strong></td><td>监督/分类</td><td>直观易懂，无需特征缩放</td><td>分类和回归，需要可解释性</td><td>容易过拟合，需要剪枝</td></tr><tr><td><strong>随机森林</strong></td><td>监督/分类</td><td>高准确性，抗过拟合</td><td>复杂分类/回归问题</td><td>计算成本较高，可解释性较差</td></tr><tr><td><strong>SVM</strong></td><td>监督/分类</td><td>高维空间有效，泛化能力强</td><td>小样本、非线性问题</td><td>大规模数据效率低，参数调优重要</td></tr><tr><td><strong>K-means</strong></td><td>无监督/聚类</td><td>简单高效，可扩展性好</td><td>客户分群，图像分割</td><td>需要指定K值，对异常值敏感</td></tr><tr><td><strong>PCA</strong></td><td>无监督/降维</td><td>去除相关性，降低维度</td><td>数据可视化，特征提取</td><td>线性方法，可能丢失非线性结构</td></tr><tr><td><strong>神经网络</strong></td><td>监督/分类回归</td><td>强大拟合能力，特征自动学习</td><td>图像、语音、自然语言处理</td><td>需要大量数据，调参复杂</td></tr></tbody></table>
<h2 data-id="heading-16">六、实战案例：综合应用示例</h2>
<h3 data-id="heading-17">电商用户分群与购买预测系统</h3>
<pre><code class="hljs language-ini" lang="ini">import pandas as pd
import numpy as np
from sklearn.preprocessing import StandardScaler
from sklearn.cluster import KMeans
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.metrics import classification_report, confusion_matrix
import matplotlib.pyplot as plt
import seaborn as sns

<span class="hljs-comment"># 生成模拟电商数据</span>
np.random.seed(42)
<span class="hljs-attr">n_samples</span> = <span class="hljs-number">1000</span>

<span class="hljs-comment"># 用户特征：年龄、收入、网站访问频率、平均会话时长、购买次数</span>
<span class="hljs-attr">data</span> = {
    '年龄': np.random.randint(18, 70, n_samples),
    '月收入': np.random.randint(2000, 20000, n_samples),
    '访问频率': np.random.poisson(5, n_samples),
    '会话时长': np.random.exponential(10, n_samples),
    '购买次数': np.random.poisson(3, n_samples),
    '平均订单金额': np.random.uniform(20, 500, n_samples),
    '最后购买距今天数': np.random.randint(1, 180, n_samples)
}

<span class="hljs-attr">df</span> = pd.DataFrame(data)

<span class="hljs-comment"># 创建目标变量：是否会再次购买（0/1）</span>
df<span class="hljs-section">['是否再购']</span> = np.where((df<span class="hljs-section">['最后购买距今天数']</span> &lt; 30) &amp; 
                        (df<span class="hljs-section">['购买次数']</span> &gt; 2) &amp; 
                        (df<span class="hljs-section">['平均订单金额']</span> &gt; 100), 1, 0)

print("数据概览:")
print(df.head())
print(f"\n数据形状: {df.shape}")
print(f"\n目标变量分布:\n{df<span class="hljs-section">['是否再购']</span>.value_counts()}")

<span class="hljs-comment"># 1. 用户分群（无监督学习）</span>
<span class="hljs-attr">cluster_features</span> = [<span class="hljs-string">'年龄'</span>, <span class="hljs-string">'月收入'</span>, <span class="hljs-string">'访问频率'</span>, <span class="hljs-string">'会话时长'</span>, <span class="hljs-string">'购买次数'</span>, <span class="hljs-string">'平均订单金额'</span>]
<span class="hljs-attr">X_cluster</span> = df[cluster_features]

<span class="hljs-comment"># 标准化</span>
<span class="hljs-attr">scaler</span> = StandardScaler()
<span class="hljs-attr">X_cluster_scaled</span> = scaler.fit_transform(X_cluster)

<span class="hljs-comment"># 使用K-means分群</span>
<span class="hljs-attr">kmeans</span> = KMeans(n_clusters=<span class="hljs-number">4</span>, random_state=<span class="hljs-number">42</span>, n_init=<span class="hljs-number">10</span>)
df<span class="hljs-section">['用户分群']</span> = kmeans.fit_predict(X_cluster_scaled)

<span class="hljs-comment"># 2. 购买预测（监督学习）</span>
<span class="hljs-attr">predict_features</span> = [<span class="hljs-string">'年龄'</span>, <span class="hljs-string">'月收入'</span>, <span class="hljs-string">'访问频率'</span>, <span class="hljs-string">'会话时长'</span>, 
                    <span class="hljs-string">'购买次数'</span>, <span class="hljs-string">'平均订单金额'</span>, <span class="hljs-string">'最后购买距今天数'</span>, <span class="hljs-string">'用户分群'</span>]
<span class="hljs-attr">X_predict</span> = df[predict_features]
<span class="hljs-attr">y_predict</span> = df[<span class="hljs-string">'是否再购'</span>]

<span class="hljs-comment"># 划分数据集</span>
X_train, X_test, y_train, <span class="hljs-attr">y_test</span> = train_test_split(
    X_predict, y_predict, <span class="hljs-attr">test_size</span>=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>
)

<span class="hljs-comment"># 使用随机森林进行预测</span>
<span class="hljs-attr">rf_clf</span> = RandomForestClassifier(n_estimators=<span class="hljs-number">100</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 参数网格搜索</span>
<span class="hljs-attr">param_grid</span> = {
    'max_depth': <span class="hljs-section">[5, 10, 15]</span>,
    'min_samples_split': <span class="hljs-section">[2, 5, 10]</span>,
    'min_samples_leaf': <span class="hljs-section">[1, 2, 4]</span>
}

<span class="hljs-attr">grid_search</span> = GridSearchCV(rf_clf, param_grid, cv=<span class="hljs-number">5</span>, scoring=<span class="hljs-string">'accuracy'</span>, n_jobs=-<span class="hljs-number">1</span>)
grid_search.fit(X_train, y_train)

<span class="hljs-comment"># 最佳模型</span>
<span class="hljs-attr">best_rf</span> = grid_search.best_estimator_

<span class="hljs-comment"># 预测</span>
<span class="hljs-attr">y_pred</span> = best_rf.predict(X_test)

print(f"\n最佳参数: {grid_search.best_params_}")
print(f"最佳交叉验证准确率: {grid_search.best_score_:.2f}")
print(f"测试集准确率: {best_rf.score(X_test, y_test):.2f}")

print("\n分类报告:")
print(classification_report(y_test, y_pred))

<span class="hljs-comment"># 可视化结果</span>
fig, <span class="hljs-attr">axes</span> = plt.subplots(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, figsize=(<span class="hljs-number">15</span>, <span class="hljs-number">10</span>))

<span class="hljs-comment"># 用户分群可视化</span>
for i in range(4):
    <span class="hljs-attr">cluster_data</span> = df[df[<span class="hljs-string">'用户分群'</span>] == i]
    axes<span class="hljs-section">[0, 0]</span>.scatter(cluster_data<span class="hljs-section">['月收入']</span>, cluster_data<span class="hljs-section">['平均订单金额']</span>, 
                      <span class="hljs-attr">label</span>=f<span class="hljs-string">'分群{i}'</span>, alpha=<span class="hljs-number">0.6</span>)
axes<span class="hljs-section">[0, 0]</span>.set_xlabel('月收入')
axes<span class="hljs-section">[0, 0]</span>.set_ylabel('平均订单金额')
axes<span class="hljs-section">[0, 0]</span>.set_title('用户分群可视化')
axes<span class="hljs-section">[0, 0]</span>.legend()

<span class="hljs-comment"># 特征重要性</span>
<span class="hljs-attr">feature_importance</span> = pd.DataFrame({
    '特征': predict_features,
    '重要性': best_rf.feature_importances_
}).sort_values('重要性', <span class="hljs-attr">ascending</span>=<span class="hljs-literal">False</span>)

axes<span class="hljs-section">[0, 1]</span>.barh(feature_importance<span class="hljs-section">['特征']</span>, feature_importance<span class="hljs-section">['重要性']</span>)
axes<span class="hljs-section">[0, 1]</span>.set_xlabel('重要性')
axes<span class="hljs-section">[0, 1]</span>.set_title('特征重要性排序')

<span class="hljs-comment"># 混淆矩阵</span>
<span class="hljs-attr">cm</span> = confusion_matrix(y_test, y_pred)
sns.heatmap(cm, <span class="hljs-attr">annot</span>=<span class="hljs-literal">True</span>, fmt=<span class="hljs-string">'d'</span>, cmap=<span class="hljs-string">'Blues'</span>, ax=axes[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>])
axes<span class="hljs-section">[0, 2]</span>.set_xlabel('预测标签')
axes<span class="hljs-section">[0, 2]</span>.set_ylabel('真实标签')
axes<span class="hljs-section">[0, 2]</span>.set_title('混淆矩阵')

<span class="hljs-comment"># 各分群购买率</span>
<span class="hljs-attr">cluster_purchase_rate</span> = df.groupby(<span class="hljs-string">'用户分群'</span>)[<span class="hljs-string">'是否再购'</span>].mean()
axes<span class="hljs-section">[1, 0]</span>.bar(cluster_purchase_rate.index, cluster_purchase_rate.values)
axes<span class="hljs-section">[1, 0]</span>.set_xlabel('用户分群')
axes<span class="hljs-section">[1, 0]</span>.set_ylabel('再购率')
axes<span class="hljs-section">[1, 0]</span>.set_title('各用户分群的再购率')

<span class="hljs-comment"># ROC曲线</span>
from sklearn.metrics import roc_curve, auc
<span class="hljs-attr">y_pred_proba</span> = best_rf.predict_proba(X_test)[:, <span class="hljs-number">1</span>]
fpr, tpr, <span class="hljs-attr">thresholds</span> = roc_curve(y_test, y_pred_proba)
<span class="hljs-attr">roc_auc</span> = auc(fpr, tpr)

axes<span class="hljs-section">[1, 1]</span>.plot(fpr, tpr, <span class="hljs-attr">color</span>=<span class="hljs-string">'darkorange'</span>, lw=<span class="hljs-number">2</span>, 
                <span class="hljs-attr">label</span>=f<span class="hljs-string">'ROC曲线 (AUC = {roc_auc:.2f})'</span>)
axes<span class="hljs-section">[1, 1]</span>.plot(<span class="hljs-section">[0, 1]</span>, <span class="hljs-section">[0, 1]</span>, <span class="hljs-attr">color</span>=<span class="hljs-string">'navy'</span>, lw=<span class="hljs-number">2</span>, linestyle=<span class="hljs-string">'--'</span>)
axes<span class="hljs-section">[1, 1]</span>.set_xlabel('假正率')
axes<span class="hljs-section">[1, 1]</span>.set_ylabel('真正率')
axes<span class="hljs-section">[1, 1]</span>.set_title('ROC曲线')
axes<span class="hljs-section">[1, 1]</span>.legend()

<span class="hljs-comment"># 学习曲线</span>
from sklearn.model_selection import learning_curve
train_sizes, train_scores, <span class="hljs-attr">test_scores</span> = learning_curve(
    best_rf, X_predict, y_predict, <span class="hljs-attr">cv</span>=<span class="hljs-number">5</span>, n_jobs=-<span class="hljs-number">1</span>,
    <span class="hljs-attr">train_sizes</span>=np.linspace(<span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">10</span>)
)

<span class="hljs-attr">train_scores_mean</span> = np.mean(train_scores, axis=<span class="hljs-number">1</span>)
<span class="hljs-attr">test_scores_mean</span> = np.mean(test_scores, axis=<span class="hljs-number">1</span>)

axes<span class="hljs-section">[1, 2]</span>.plot(train_sizes, train_scores_mean, 'o-', <span class="hljs-attr">color</span>=<span class="hljs-string">'r'</span>, label=<span class="hljs-string">'训练得分'</span>)
axes<span class="hljs-section">[1, 2]</span>.plot(train_sizes, test_scores_mean, 'o-', <span class="hljs-attr">color</span>=<span class="hljs-string">'g'</span>, label=<span class="hljs-string">'交叉验证得分'</span>)
axes<span class="hljs-section">[1, 2]</span>.set_xlabel('训练样本数')
axes<span class="hljs-section">[1, 2]</span>.set_ylabel('准确率')
axes<span class="hljs-section">[1, 2]</span>.set_title('学习曲线')
axes<span class="hljs-section">[1, 2]</span>.legend()

plt.tight_layout()
plt.show()

<span class="hljs-comment"># 输出业务洞察</span>
print("\<span class="hljs-attr">n</span>=== 业务洞察 ===<span class="hljs-string">")
print("</span><span class="hljs-number">1</span>. 用户分群特征:<span class="hljs-string">")
for i in range(4):
    cluster_stats = df[df['用户分群'] == i].describe().loc[['mean']]
    print(f"</span>\n分群 {i} (共{len(df[df[<span class="hljs-string">'用户分群'</span>] == i])}人):<span class="hljs-string">")
    print(f"</span>  平均年龄: {cluster_stats[<span class="hljs-string">'年龄'</span>].values[<span class="hljs-number">0</span>]:.<span class="hljs-number">1</span>f}岁<span class="hljs-string">")
    print(f"</span>  平均月收入: {cluster_stats[<span class="hljs-string">'月收入'</span>].values[<span class="hljs-number">0</span>]:.<span class="hljs-number">0</span>f}元<span class="hljs-string">")
    print(f"</span>  平均购买次数: {cluster_stats[<span class="hljs-string">'购买次数'</span>].values[<span class="hljs-number">0</span>]:.<span class="hljs-number">1</span>f}次<span class="hljs-string">")
    print(f"</span>  再购率: {cluster_purchase_rate[i]:.<span class="hljs-number">1</span>%}<span class="hljs-string">")

print("</span>\n2. 关键发现:<span class="hljs-string">")
print(f"</span>  最重要的预测特征: {feature_importance.iloc[<span class="hljs-number">0</span>][<span class="hljs-string">'特征'</span>]}<span class="hljs-string">")
print(f"</span>  高价值用户识别: 分群{cluster_purchase_rate.idxmax()}具有最高的再购率<span class="hljs-string">")
print(f"</span>  营销建议: 针对分群{cluster_purchase_rate.idxmin()}制定复购激励策略<span class="hljs-string">")
</span></code></pre>
<h2 data-id="heading-18">七、算法性能优化技巧</h2>
<h3 data-id="heading-19">1. 数据预处理最佳实践</h3>
<pre><code class="hljs language-ini" lang="ini">from sklearn.pipeline import Pipeline
from sklearn.impute import SimpleImputer
from sklearn.preprocessing import StandardScaler, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.ensemble import RandomForestClassifier

<span class="hljs-comment"># 创建完整的数据预处理和建模管道</span>
<span class="hljs-attr">numeric_features</span> = [<span class="hljs-string">'年龄'</span>, <span class="hljs-string">'收入'</span>, <span class="hljs-string">'消费金额'</span>]
<span class="hljs-attr">categorical_features</span> = [<span class="hljs-string">'性别'</span>, <span class="hljs-string">'城市'</span>, <span class="hljs-string">'会员等级'</span>]

<span class="hljs-comment"># 数值型特征处理</span>
<span class="hljs-attr">numeric_transformer</span> = Pipeline(steps=[
    (<span class="hljs-string">'imputer'</span>, SimpleImputer(strategy=<span class="hljs-string">'median'</span>)),  <span class="hljs-comment"># 缺失值处理</span>
    (<span class="hljs-string">'scaler'</span>, StandardScaler())                     <span class="hljs-comment"># 标准化</span>
])

<span class="hljs-comment"># 类别型特征处理</span>
<span class="hljs-attr">categorical_transformer</span> = Pipeline(steps=[
    (<span class="hljs-string">'imputer'</span>, SimpleImputer(strategy=<span class="hljs-string">'most_frequent'</span>)),  <span class="hljs-comment"># 缺失值处理</span>
    (<span class="hljs-string">'onehot'</span>, <span class="hljs-literal">On</span>eHotEncoder(handle_unknown=<span class="hljs-string">'ignore'</span>))     <span class="hljs-comment"># 独热编码</span>
])

<span class="hljs-comment"># 合并预处理步骤</span>
<span class="hljs-attr">preprocessor</span> = ColumnTransformer(
    <span class="hljs-attr">transformers</span>=[
        (<span class="hljs-string">'num'</span>, numeric_transformer, numeric_features),
        (<span class="hljs-string">'cat'</span>, categorical_transformer, categorical_features)
    ])

<span class="hljs-comment"># 创建完整管道</span>
<span class="hljs-attr">full_pipeline</span> = Pipeline(steps=[
    (<span class="hljs-string">'preprocessor'</span>, preprocessor),
    (<span class="hljs-string">'classifier'</span>, RandomForestClassifier(random_state=<span class="hljs-number">42</span>))
])

<span class="hljs-comment"># 使用管道进行训练和预测（代码简洁且不易出错）</span>
<span class="hljs-comment"># full_pipeline.fit(X_train, y_train)</span>
<span class="hljs-comment"># y_pred = full_pipeline.predict(X_test)</span>
</code></pre>
<h3 data-id="heading-20">2. 超参数调优方法</h3>
<pre><code class="hljs language-ini" lang="ini">from sklearn.model_selection import RandomizedSearchCV
from scipy.stats import randint, uniform

<span class="hljs-comment"># 定义参数分布</span>
<span class="hljs-attr">param_dist</span> = {
    'n_estimators': randint(100, 500),
    'max_depth': <span class="hljs-section">[5, 10, 15, 20, None]</span>,
    'min_samples_split': randint(2, 20),
    'min_samples_leaf': randint(1, 10),
    'max_features': <span class="hljs-section">['sqrt', 'log2', None]</span>
}

<span class="hljs-comment"># 随机搜索</span>
<span class="hljs-attr">random_search</span> = RandomizedSearchCV(
    RandomForestClassifier(<span class="hljs-attr">random_state</span>=<span class="hljs-number">42</span>),
    <span class="hljs-attr">param_distributions</span>=param_dist,
    <span class="hljs-attr">n_iter</span>=<span class="hljs-number">50</span>,  <span class="hljs-comment"># 随机尝试的参数组合数</span>
    <span class="hljs-attr">cv</span>=<span class="hljs-number">5</span>,
    <span class="hljs-attr">scoring</span>=<span class="hljs-string">'accuracy'</span>,
    <span class="hljs-attr">random_state</span>=<span class="hljs-number">42</span>,
    <span class="hljs-attr">n_jobs</span>=-<span class="hljs-number">1</span>
)

<span class="hljs-comment"># random_search.fit(X_train, y_train)</span>
<span class="hljs-comment"># print(f"最佳参数: {random_search.best_params_}")</span>
<span class="hljs-comment"># print(f"最佳得分: {random_search.best_score_:.2f}")</span>
</code></pre>
<h2 data-id="heading-21">结语：机器学习的发展与未来</h2>
<p>通过本文的详细讲解，我们已经系统了解了机器学习的主要算法及其应用。从基础的线性回归到复杂的神经网络，从监督学习到无监督学习，每种算法都有其独特的优势和适用场景。</p>
<p>机器学习的未来发展趋势包括：</p>
<ol>
<li>1. <strong>自动化机器学习（AutoML）</strong> ：让算法选择、特征工程、超参数调优等过程自动化</li>
<li>2. <strong>可解释性AI</strong>：提高复杂模型的可解释性，建立用户信任</li>
<li>3. <strong>联邦学习</strong>：在保护数据隐私的前提下进行分布式模型训练</li>
<li>4. <strong>强化学习应用扩展</strong>：从游戏领域扩展到更多实际应用场景</li>
</ol>
<p>无论你是刚刚入门的新手，还是有一定经验的数据科学家，掌握这些核心算法都是构建机器学习解决方案的基础。建议读者在学习理论的同时，多动手实践，通过项目实战加深理解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[个人开发者系列-上线即“爆火”？那些掏空你 Cloudflare 额度的虚假繁荣]]></title>    <link>https://juejin.cn/post/7593337928307703834</link>    <guid>https://juejin.cn/post/7593337928307703834</guid>    <pubDate>2026-01-10T13:31:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593337928307703834" data-draft-id="7593310044478898185" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="个人开发者系列-上线即“爆火”？那些掏空你 Cloudflare 额度的虚假繁荣"/> <meta itemprop="keywords" content="前端,Nuxt.js"/> <meta itemprop="datePublished" content="2026-01-10T13:31:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="vueTmp"/> <meta itemprop="url" content="https://juejin.cn/user/254742426814798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            个人开发者系列-上线即“爆火”？那些掏空你 Cloudflare 额度的虚假繁荣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/254742426814798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    vueTmp
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T13:31:32.000Z" title="Sat Jan 10 2026 13:31:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本系列专为个人开发者打造，核心理念是以最小成本实现最佳效果，主要侧重于免费或低成本的解决方案。旨在为早期独立开发者提供实用参考，助力其在资源有限的情况下开启创业之旅。
下面的内容是对2025年10月的内容记录，希望我趟过的坑，你不再踩。</p>
</blockquote>
<h2 data-id="heading-0">01 意外的“惊喜”：我的插件网站火了？</h2>
<p>我最近用 <strong>Nuxt v4</strong> 开发了一个网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevworld.top%2F" target="_blank" title="https://devworld.top/" ref="nofollow noopener noreferrer">VSCode Plugin Toolkit - Professional Plugin Offline Download</a>，主要提供 VS Code 插件的搜索和下载，并将其部署在 <strong>Cloudflare Workers</strong> 上。这个选择很符合我们一直讨论的“低成本启动”理念——Cloudflare Workers提供每天10万次请求的免费额度，对于早期项目来说应该绰绰有余。</p>
<blockquote>
<p>Cloudflare Workers 和 Pages Functions 免费额度：</p>
<ul>
<li>每个请求最多占用 10 毫秒 CPU 时间；</li>
<li>每天最多 100,000 (UTC+0)。</li>
</ul>
</blockquote>
<p>就在网站上线不久后，我连续收到了三封来自 Cloudflare 的邮件。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5085bcfdc84749238aa9ab2921213257~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdnVlVG1w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657274&amp;x-signature=pCBnkTHGzFBiyFiR2mA%2Bk8us%2BBw%3D" alt="邮件预警.png" loading="lazy"/></p>
<p>第一眼看到“您的账户已超过每日请求限制”时，我内心的第一反应竟然是： <strong>“天呐，难道我这网站上线即火，流量爆了？”</strong></p>
<p>3 秒过后想想网站没做任何 SEO，也没做过推广的新站能火个 Der ，这么大的自然流量，这显然不正常。难道被挂片了？我拉跨，Cloudflare 也不拉库呀。</p>
<h2 data-id="heading-1">2 案发现场：谁在掏空我的免费额度？</h2>
<p>Cloudflare Workers 免费版虽然慷慨，但也有严格的限制：<strong>每天 10 万次请求 (UTC+0)</strong> 。如果请求被透传到后端 Server，每一次都会扣减这个额度。</p>
<p>我赶紧打开日志进行排查，结果让我大跌眼镜。</p>
<h3 data-id="heading-2">罪魁祸首一：消失的占位图</h3>
<p>在开发插件搜索功能时，我设计了一个逻辑：图片加载中或查询失败时显示一张默认占位图。然而，由于粗心，我忘记将这张图放到 <code>public</code> 静态资源目录中了，导致请求路径不存在。</p>
<p>更糟糕的是，作为 Nuxt 新手，我当时没有配置 <code>error.vue</code> 页面。</p>
<p>在 Nuxt 的机制下，如果一个静态资源请求（如 <code>.png</code>）在静态目录找不到，且没有错误拦截，这个请求就会<strong>回源到服务器（Server）</strong> 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2060f8685da3401d8bb765048baabf70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdnVlVG1w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657274&amp;x-signature=r13qOZhCO1OIVC2s%2FsV27bSPZ%2Bo%3D" alt="默认图片请求.png" loading="lazy"/></p>
<p>从日志中可以看到，大量的 404 请求涌向了那个并不存在的图片。由于没有缓存，每一次 404 都在实打实地消耗我的 Workers 额度。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fa48792e43d44fea19056131a4d1b37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdnVlVG1w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657274&amp;x-signature=gdVElLS0Ykqev31gJey2dtBGRSM%3D" alt="图片请求详情.png" loading="lazy"/></p>
<h3 data-id="heading-3">罪魁祸首二：勤奋的“不速之客”</h3>
<p>除了自己留下的坑，我还发现了一些“不怀好意”的访客。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e26eafe4e0e1465799c3c368243474fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdnVlVG1w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657274&amp;x-signature=KCmp74OGis4si367VDpnO3qed2g%3D" alt="异常访问信息截图.png" loading="lazy"/></p>
<p>通过日志分析，我发现大量针对 <code>.env</code>、<code>phpinfo.php</code>、<code>wp-admin</code> 等路径的扫描请求。这些典型的恶意扫描和爬虫行为，因为我缺少全局错误拦截，导致所有的异常请求全部走到了 Nuxt 的服务器端处理逻辑里。</p>
<p><strong>漏风的窗户（没占位图）+ 敞开的大门（没错误页面）+ 门外的路人（扫描器）</strong> ，最终导致我的 10 万次额度在短短几个小时内被彻底掏空。</p>
<h2 data-id="heading-4">03 止损方案：最小成本的修复</h2>
<p>针对上面两个做了如下修复：</p>
<ol>
<li><strong>补全静态资源</strong>：将丢失的占位图重新放回 <code>public</code> 文件夹。这样 Cloudflare CDN 会直接拦截并返回静态资源，不再消耗 Workers 的 CPU 计算配额。</li>
<li><strong>增加 <code>error.vue</code></strong>：这是最关键的一步。在 Nuxt 中增加一个简单的自定义错误页，确保所有非预期路径的访问在前端就被拦截处理，而不是交给后端逻辑去消耗资源。</li>
</ol>
<h2 data-id="heading-5">04 复盘：给个人开发者的避坑指南</h2>
<p>这次“虚假繁荣”让我深刻意识到，在利用 Serverless 云服务享受“零成本”部署的同时，必须要注意资源的防御性管理。</p>
<ul>
<li><strong>不要信任开发环境的“丝滑”</strong> ：本地开发时，由于网络延迟低，图片缺失可能只是一闪而过，容易被忽略。</li>
<li><strong>路由兜底是刚需</strong>：无论是 Nuxt 还是其他框架，上线前请务必确认是否有处理 404 和 500 错误的兜底方案。</li>
<li><strong>监控优于直觉</strong>：当看到流量暴涨时，先别急着庆祝，去分析一下日志。</li>
</ul>
<p>修复这些问题后，网站的请求量迅速回归到了正常水平（周末使用的人相对较少）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3b3b04467b24c4b99905464990b1c6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdnVlVG1w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657274&amp;x-signature=ROD46JdJnanvqWDYfErltRpwagc%3D" alt="修改后访问流量.png" loading="lazy"/></p>
<h3 data-id="heading-6">结语</h3>
<p>独立开发的路上，我们不仅要学会构建，更要学会如何“防守”。Cloudflare 是个人开发者的神兵利器，但如果不注意细节，它也会因为额度超限而变得“钝重”。</p>
<p><strong>如果你也正在使用 Nuxt ，记得检查一下你的 404 逻辑！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[24.Axon框架-事件（二）]]></title>    <link>https://juejin.cn/post/7593262196844167220</link>    <guid>https://juejin.cn/post/7593262196844167220</guid>    <pubDate>2026-01-10T10:38:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593262196844167220" data-draft-id="7593262196844150836" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="24.Axon框架-事件（二）"/> <meta itemprop="keywords" content="后端,领域驱动设计"/> <meta itemprop="datePublished" content="2026-01-10T10:38:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="季风1132"/> <meta itemprop="url" content="https://juejin.cn/user/2799777150149710"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            24.Axon框架-事件（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799777150149710/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    季风1132
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T10:38:35.000Z" title="Sat Jan 10 2026 10:38:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Axon框架-事件（二）</h2>
<h3 data-id="heading-1">1.什么是事件处理器</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f97c4d97b77647e68d631484793b364d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=W%2Bbhm9tLX40lPYOOmjUBXEpPJTY%3D" alt="1768035329540.png" loading="lazy"/></p>
<h3 data-id="heading-2">2.明确概念</h3>
<ul>
<li>EventProcessor：事件处理器</li>
<li>ProcessingGroup：处理组</li>
<li>EventHandler：事件处理程序</li>
</ul>
<h3 data-id="heading-3">3.事件处理器分层结构</h3>
<h4 data-id="heading-4">介绍</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a93169fefe645be80df9ec924d0cbda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=FbvcqnIEXoBPpiBs%2FLdi8Os06tE%3D" alt="1768035465950.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38b8fcdedcf94db3a5430fe19b11b4e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=%2BpvxQoPB4ydjQiQCTrR9apHZGk4%3D" alt="asdasdcccccCCCAawio.png" loading="lazy"/></p>
<ol>
<li>事件处理程序（EventHandler）：接收事件时需执行的业务逻辑</li>
<li>事件处理器（EventProcessor）：则是负责处理事件处理过程中技术层面工作的组件。它会启动一个工作单元，可能还会开启事务；此外，它还需确保事件处理期间创建的所有消息能正确附加关联数据，同时满足其他非功能需求（如性能、容错等）</li>
<li>处理组（Processing Group）：每个EventHandler仅属于一个处理组。处理组为事件处理提供了可配置的非功能需求能力，例如错误处理、排序策略等</li>
</ol>
<h4 data-id="heading-5">为EventHandler分配ProcessingGroup</h4>
<h5 data-id="heading-6">介绍</h5>
<p>所有EventProcessor都有一个名称，该名称在多个JVM实例间唯一标识一个EventProcessor实例，两个名称相同的EventProcessor会被视为同一EventProcessor的不同实例</p>
<p>所有EventHandler默认会附加到名称为其类所在包名的事件处理器上。此外，Axon默认使用的EventProcessor实现是TrackingEventProcessor（跟踪式事件处理器）</p>
<p>EventHandler大致分为两类：常规EventHandler，Saga的EventHandler，这里介绍常规EventHandler的流程</p>
<h5 data-id="heading-7">两种分配方式</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10f99302d5484653bbc891ab1223a402~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=YZ7lnFSSTdHvUFfpnk5rNOqHSRc%3D" alt="1768036737757.png" loading="lazy"/></p>
<h4 data-id="heading-8">更精细的分配方式</h4>
<h5 data-id="heading-9">介绍</h5>
<p>Axon的配置API允许自定义的更精细的分配方式，这些规则可分为两大类：</p>
<ul>
<li>EventHandler → ProcessingGroup</li>
<li>ProcessingGroup → EventProcessor</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eab752c085a48e2838eeb29e26020ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=HWsHCCfagMgogrWMOEiJ%2BC8HpfI%3D" alt="1768037088706.png" loading="lazy"/></p>
<h5 data-id="heading-10">事件处理程序到处理组</h5>
<ol>
<li>byDefaultAssignTo(String)：定义EventHandler的默认ProcessingGroup名称。仅在无更具体规则且未标注@ProcessingGroup注解时生效</li>
<li>byDefaultAssignHandlerInstancesTo(Function&lt;Object, String&gt;)：通过Lambda表达式为EventHandler实例分配ProcessingGroup（返回ProcessingGroup名称）。仅在无更具体规则且未标注@ProcessingGroup注解时生效</li>
<li>byDefaultAssignHandlerTypesTo(Function&lt;Class&lt;?&gt;, String&gt;)：通过Lambda表达式为EventHandler类型分配ProcessingGroup（返回ProcessingGroup名称）。仅在无更具体规则且未标注@ProcessingGroup注解时生效</li>
<li>assignHandlerInstancesMatching(String, Predicate&lt;Object&gt;)：根据EventHandler实例是否匹配Predicate条件，将其分配到指定ProcessingGroup。默认优先级为0；若一个实例匹配多个条件，结果未定义</li>
<li>assignHandlerTypesMatching(String, Predicate&lt;Class&lt;?&gt;&gt;)：根据EventHandler类型是否匹配Predicate条件，将其分配到指定ProcessingGroup。默认优先级为0；若一个类型匹配多个条件，结果未定义</li>
<li>assignHandlerInstancesMatching(String, int, Predicate&lt;Object&gt;)：功能与第4点类似，但可自定义优先级（数值越高，规则优先级越高）</li>
<li>assignHandlerTypesMatching(String, int, Predicate&lt;Class&lt;?&gt;&gt;)：功能与第5点类似，但可自定义优先级（数值越高，规则优先级越高）</li>
</ol>
<h5 data-id="heading-11">处理组到事件处理器</h5>
<ol>
<li>assignProcessingGroup(String, String)：将指定名称的ProcessingGroup，分配给指定名称的EventProcessor</li>
<li>assignProcessingGroup(Function&lt;String, String&gt;)：通过Lambda表达式为ProcessingGroup分配EventProcessor（输入ProcessingGroup，名称，返回EventProcessor名称）</li>
</ol>
<h4 data-id="heading-12">EventProcessor内部的EventHandler顺序问题</h4>
<h5 data-id="heading-13">介绍</h5>
<p>默认顺序就是它们在配置API中的注册顺序一致</p>
<h5 data-id="heading-14">Spring环境下的显式排序</h5>
<p>若使用Spring进行依赖注入，可通过@Order注解显式指定事件处理程序的排序。该注解标注在事件处理程序类上，通过整数参数指定优先级（数值越小，优先级越高）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ProcessingGroup("my-handlers")</span>
<span class="hljs-meta">@Order(1)</span> <span class="hljs-comment">// 优先级高于 @Order(2) 的组件</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HighPriorityHandler</span> {
    <span class="hljs-meta">@EventHandler</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">(ImportantEvent event)</span> {
        <span class="hljs-comment">// 高优先级逻辑</span>
    }
}

<span class="hljs-meta">@ProcessingGroup("my-handlers")</span>
<span class="hljs-meta">@Order(2)</span> <span class="hljs-comment">// 优先级低于 @Order(1) 的组件</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LowPriorityHandler</span> {
    <span class="hljs-meta">@EventHandler</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">(ImportantEvent event)</span> {
        <span class="hljs-comment">// 低优先级逻辑（在 HighPriorityHandler 之后执行）</span>
    }
}
</code></pre>
<h5 data-id="heading-15">注意事项</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cea64b880290460685e34a9ea28fd539~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=pQTQYkunTP4Buly4LrNFMICLbRs%3D" alt="1768038172709.png" loading="lazy"/></p>
<h3 data-id="heading-16">4.事件错误处理</h3>
<h4 data-id="heading-17">介绍</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb91f194cb0947a1b75b4c4afb816cbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=4z6rTKTmGZP%2BGC5F3zLN3B%2BveEE%3D" alt="1768038674466.png" loading="lazy"/></p>
<h4 data-id="heading-18">ProcessingGroup层级（ListenerInvocationErrorHandler）</h4>
<h5 data-id="heading-19">介绍</h5>
<p>ListenerInvocationErrorHandler负责处理事件处理程序方法抛出的异常。默认实现为LoggingErrorHandler，记录异常日志后，继续处理下一个处理程序或事件</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03aed535c87941c9815f9be50096cb35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=7liyGYulCEY8icwem3pGVAhZcJA%3D" alt="1768038773748.png" loading="lazy"/></p>
<h5 data-id="heading-20">原生API配置</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-comment">// 省略其他配置方法...</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureProcessingGroupErrorHandling</span><span class="hljs-params">(EventProcessingConfigurer processingConfigurer)</span> {
        <span class="hljs-comment">// 1. 配置所有处理组的默认错误处理器</span>
        processingConfigurer
            .registerDefaultListenerInvocationErrorHandler(conf -&gt; {
                <span class="hljs-comment">// 示例：返回自定义 ListenerInvocationErrorHandler 实例</span>
                <span class="hljs-keyword">return</span> (exception, event, eventHandler) -&gt; {
                    <span class="hljs-comment">// 自定义逻辑：如重试、忽略、死信队列投递等</span>
                    log.error(<span class="hljs-string">"EventHandler [{}] failed to process event [{}]"</span>, 
                              eventHandler.getClass().getSimpleName(), 
                              event.getPayloadType().getSimpleName(), 
                              exception);
                    <span class="hljs-comment">// 若需向上传播异常，直接抛出即可</span>
                    <span class="hljs-comment">// throw new RuntimeException("Propagate error", exception);</span>
                };
            })
            <span class="hljs-comment">// 2. 为特定处理组配置专属错误处理器</span>
            .registerListenerInvocationErrorHandler(<span class="hljs-string">"my-processing-group"</span>, conf -&gt; {
                <span class="hljs-comment">// 为 "my-processing-group" 处理组配置自定义错误处理器</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomMyGroupErrorHandler</span>();
            });
    }
}
</code></pre>
<h5 data-id="heading-21">SpringBoot配置</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-comment">// 省略其他配置方法...</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ConfigurerModule <span class="hljs-title function_">processingGroupErrorHandlingConfigurerModule</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> configurer -&gt; configurer.eventProcessing(processingConfigurer -&gt;
            processingConfigurer
                <span class="hljs-comment">// 配置默认错误处理器</span>
                .registerDefaultListenerInvocationErrorHandler(conf -&gt; {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingErrorHandler</span>(); <span class="hljs-comment">// 也可使用自定义实现</span>
                })
                <span class="hljs-comment">// 为特定处理组配置错误处理器</span>
                .registerListenerInvocationErrorHandler(
                        <span class="hljs-string">"my-processing-group"</span>,
                        conf -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomMyGroupErrorHandler</span>()
                )
        );
    }
}
</code></pre>
<h5 data-id="heading-22">自定义ListenerInvocationErrorHandler</h5>
<p>实现ListenerInvocationErrorHandler接口即可自定义错误处理逻辑，接口提供以下参数：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListenerInvocationErrorHandler</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception exception,
                 EventMessage&lt;?&gt; event,
                 EventMessageHandler eventHandler)</span> <span class="hljs-keyword">throws</span> Exception;
}
</code></pre>
<ol>
<li>exception：EventHandler抛出的异常</li>
<li>event：待处理的事件</li>
<li>eventHandler：抛出异常的EventHandler</li>
</ol>
<p>可根据需求选择重试忽略或向上传播异常；若向上传播，异常会进入EventProcessor</p>
<h4 data-id="heading-23">EventProcessor层级（ErrorHandler）</h4>
<h5 data-id="heading-24">介绍</h5>
<p>EventHandler方法外抛出的异常或从EventHandler层级传播上来的异常，由ErrorHandler处理。默认实现为PropagatingErrorHandler，直接重新抛出所有捕获的异常</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/141ac9b246fc49ab9de7501c72ff428f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=4%2BLLctG8gTHhsXRmLkB2oLp%2FRvA%3D" alt="1768038951834.png" loading="lazy"/></p>
<h5 data-id="heading-25">不同事件处理器类型的异常传播行为</h5>
<ol>
<li>订阅式事件处理器（SubscribingEventProcessor）：异常会传播给事件发布者</li>
<li>流处理式事件处理器（StreamingEventProcessor）：进入错误模式，重试失败后暂停处理</li>
</ol>
<h5 data-id="heading-26">原生API配置</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(EventProcessingConfigurer configurer)</span> {
        configurer
            <span class="hljs-comment">// 1. 配置所有事件处理器的默认错误处理器</span>
            .registerDefaultErrorHandler(conf -&gt; {
                <span class="hljs-comment">// 示例：自定义 ErrorHandler，支持重试</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryingErrorHandler</span>(
                        IntervalRetryScheduler.builder()
                                             .retryCount(<span class="hljs-number">3</span>)
                                             .interval(Duration.ofSeconds(<span class="hljs-number">1</span>))
                                             .build()
                );
            })
            <span class="hljs-comment">// 2. 为特定事件处理器配置专属错误处理器</span>
            .registerErrorHandler(<span class="hljs-string">"my-processor"</span>, conf -&gt; {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomProcessorErrorHandler</span>();
            });
    }
}
</code></pre>
<h5 data-id="heading-27">SpringBoot配置</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ConfigurerModule <span class="hljs-title function_">processorErrorHandlingConfigurerModule</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> configurer -&gt; configurer.eventProcessing(processing -&gt;
            processing
                <span class="hljs-comment">// 配置全局默认错误处理器</span>
                .registerDefaultErrorHandler(conf -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryingErrorHandler</span>())
                <span class="hljs-comment">// 为特定事件处理器配置错误处理器</span>
                .registerErrorHandler(<span class="hljs-string">"my-processor"</span>, conf -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomProcessorErrorHandler</span>())
        );
    }
}
</code></pre>
<h5 data-id="heading-28">自定义ErrorHandler</h5>
<p>实现ErrorHandler接口，通过ErrorContext获取错误上下文信息，自定义处理逻辑（如忽略、重试、死信队列投递等）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ErrorHandler</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleError</span><span class="hljs-params">(ErrorContext errorContext)</span> <span class="hljs-keyword">throws</span> Exception;
}

<span class="hljs-comment">// 示例：自定义 ErrorHandler</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomErrorHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ErrorHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleError</span><span class="hljs-params">(ErrorContext errorContext)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Exception</span> <span class="hljs-variable">cause</span> <span class="hljs-operator">=</span> errorContext.getCause();
        EventMessage&lt;?&gt; event = errorContext.getEvent();
        <span class="hljs-comment">// 自定义逻辑：如判断异常类型，决定是否投递到死信队列</span>
        <span class="hljs-keyword">if</span> (cause <span class="hljs-keyword">instanceof</span> NonTransientException) {
            <span class="hljs-comment">// 非暂时性异常：投递到死信队列</span>
            deadLetterQueue.send(event, cause);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 暂时性异常：重试</span>
            <span class="hljs-keyword">throw</span> cause; <span class="hljs-comment">// 向上传播，触发重试</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-29">死信队列</h4>
<p>这一部分内容，还专门有一章，这里理解为一个持续失败的事件会产生不好的影响，需要死信队列来参与解决</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c017998568a04d0f8c2620f6025c0006~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=3O3wJXoK7hV5wRHyv5vx2hmekZE%3D" alt="1768039221811.png" loading="lazy"/></p>
<h3 data-id="heading-30">5.EventProcessor通用配置</h3>
<h4 data-id="heading-31">介绍</h4>
<p>除了处理EventHandler分配和错误处理，EventProcessor还支持其他组件的配置。订阅式和流处理式事件处理器的专属配置以后说，这里是通用配置</p>
<h4 data-id="heading-32">EventProcessorBuilder</h4>
<h5 data-id="heading-33">介绍</h5>
<p>EventProcessingConfigurer提供了大量EventProcessor的可配置组件，但有时直接提供构建EventProcessor的完整逻辑会更便捷。此时可通过EventProcessorBuilder自定义构建逻辑</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa8b220ed1584fcaa59077a2f5360c02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=ARt6Tgt8sFg0lVMjRistbMIBWPA%3D" alt="1768040215878.png" loading="lazy"/></p>
<h5 data-id="heading-34">配置方式</h5>
<p>EventProcessingConfigurer提供两种配置EventProcessorBuilder的方法：</p>
<ol>
<li>registerEventProcessorFactory(EventProcessorBuilder)：为未配置专属构建器的EventProcessor，配置默认构建工厂</li>
<li>registerEventProcessor(String, EventProcessorBuilder)：为指定名称的EventProcessor，配置专属构建器</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureEventProcessorBuilder</span><span class="hljs-params">(EventProcessingConfigurer processingConfigurer)</span> {
        <span class="hljs-comment">// 1. 配置默认构建器：所有未指定专属构建器的处理器使用此逻辑</span>
        processingConfigurer.registerEventProcessorFactory((name, config, invoker) -&gt; {
            <span class="hljs-comment">// 示例：根据处理器名称，选择构建 Subscribing 或 Tracking 处理器</span>
            <span class="hljs-keyword">if</span> (name.startsWith(<span class="hljs-string">"subscribing-"</span>)) {
                <span class="hljs-keyword">return</span> SubscribingEventProcessor.builder()
                                                .name(name)
                                                .eventHandlerInvoker(invoker)
                                                .messageSource(config.eventBus())
                                                .build();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> TrackingEventProcessor.builder()
                                             .name(name)
                                             .eventHandlerInvoker(invoker)
                                             .tokenStore(config.tokenStore())
                                             .build();
            }
        });

        <span class="hljs-comment">// 2. 为 "custom-processor" 配置专属构建器</span>
        processingConfigurer.registerEventProcessor(<span class="hljs-string">"custom-processor"</span>, 
            (name, config, invoker) -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEventProcessor</span>(name, invoker, config.eventStore())
        );
    }
}
</code></pre>
<h4 data-id="heading-35">EventHandler拦截器</h4>
<h5 data-id="heading-36">介绍</h5>
<p>EventProcessor是EventHandler的调用者，因此也是配置EventHandler拦截器的合适位置。由于EventProcessor专门处理事件，此处的拦截器需针对EventMessage，即EventHandlerInterceptor</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab7c8a23fae4db79bd45f4da794d94b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=WQxW4iWPP7WhM5g6E7e4S2Et7L0%3D" alt="1768040791381.png" loading="lazy"/></p>
<h5 data-id="heading-37">配置方式</h5>
<p>EventProcessingConfigurer提供两种配置拦截器的方法：</p>
<ol>
<li>registerDefaultHandlerInterceptor(BiFunction&lt;Configuration, String, MessageHandlerInterceptor&lt;? super EventMessage&lt;?&gt;&gt;&gt;)：为所有EventProcessor配置默认拦截器（输入全局配置和EventProcessor名称，返回拦截器实例）</li>
<li>registerHandlerInterceptor(String, Function&lt;Configuration, MessageHandlerInterceptor&lt;? super EventMessage&lt;?&gt;&gt;&gt;)：为指定名称的EventProcessor配置专属拦截器</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureInterceptors</span><span class="hljs-params">(EventProcessingConfigurer processingConfigurer)</span> {
        <span class="hljs-comment">// 1. 配置全局默认拦截器：为所有处理器添加关联数据拦截</span>
        processingConfigurer.registerDefaultHandlerInterceptor((config, processorName) -&gt; 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelationDataInterceptor</span>&lt;&gt;(config.correlationDataProviders())
        );

        <span class="hljs-comment">// 2. 为 "audit-processor" 配置专属审计拦截器</span>
        processingConfigurer.registerHandlerInterceptor(<span class="hljs-string">"audit-processor"</span>, config -&gt; 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuditLoggingInterceptor</span>() <span class="hljs-comment">// 自定义审计拦截器，记录事件处理日志</span>
        );
    }
}
</code></pre>
<h4 data-id="heading-38">消息监控</h4>
<h5 data-id="heading-39">介绍</h5>
<p>所有EventProcessor实例都支持配置MessageMonitor。MessageMonitor用于监控Axon应用中消息的流转过程，对于EvnetProcessor而言，它会专门监控从EventProcessor流向EventHandler的事件</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcde9e4cdc454c458ece83589f002930~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=Qg7LqcxCH5F2iADYgg6w5FQh3%2F4%3D" alt="1768041065242.png" loading="lazy"/></p>
<h5 data-id="heading-40">配置方式</h5>
<p>MessageMonitorFactory是Axon配置API中通用的监控器构建接口，支持更灵活的监控器创建逻辑：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MessageMonitorFactory</span> {
    <span class="hljs-comment">// 参数说明：</span>
    <span class="hljs-comment">// - configuration：全局配置（可获取依赖组件）</span>
    <span class="hljs-comment">// - componentType：组件类型（事件处理器场景下为 EventProcessor 实现类）</span>
    <span class="hljs-comment">// - componentName：组件名称（事件处理器名称）</span>
    MessageMonitor&lt;Message&lt;?&gt;&gt; create(Configuration configuration,
                                      Class&lt;?&gt; componentType,
                                      String componentName);
}
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureMessageMonitor</span><span class="hljs-params">(EventProcessingConfigurer processingConfigurer)</span> {
        <span class="hljs-comment">// 使用工厂为 "metrics-processor" 配置监控器</span>
        processingConfigurer.registerMessageMonitorFactory(<span class="hljs-string">"metrics-processor"</span>, 
            (config, componentType, componentName) -&gt; {
                <span class="hljs-comment">// 示例：基于 Micrometer 实现事件处理指标监控</span>
                <span class="hljs-keyword">return</span> MicrometerMessageMonitor.builder(componentName)
                                              .meterRegistry(config.getComponent(MeterRegistry.class))
                                              .build();
            }
        );
    }
}
</code></pre>
<h4 data-id="heading-41">事务管理</h4>
<h5 data-id="heading-42">介绍</h5>
<p>EventProcessor负责事件处理，因此也是配置事务的合理位置。大多数场景下，默认配置已足够，本节仅介绍可调整的选项</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34f672f908c34574a840e61e2299a744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2j6aOOMTEzMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646315&amp;x-signature=zicwto9UNgVnoQ3isYmxqSH9EJo%3D" alt="1768041132884.png" loading="lazy"/></p>
<h5 data-id="heading-43">TransactionManager</h5>
<p>Axon使用TransactionManager为每个工作单元附加事务：</p>
<ol>
<li>Spring环境：默认使用SpringTransactionManager，底层依赖Spring的PlatformTransactionManager</li>
<li>非Spring环境：若需事务管理，需自定义TransactionManager实现，仅需实现TransactionManager#startTransaction()方法</li>
</ol>
<h5 data-id="heading-44">配置方式</h5>
<p>通过EventProcessingConfigurer的registerTransactionManager方法配置：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureTransactionManager</span><span class="hljs-params">(EventProcessingConfigurer processingConfigurer)</span> {
        <span class="hljs-comment">// 为 "transactional-processor" 配置自定义事务管理器</span>
        processingConfigurer.registerTransactionManager(<span class="hljs-string">"transactional-processor"</span>, 
            config -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomTransactionManager</span>()
        );
    }
}
</code></pre>
<h5 data-id="heading-45">回滚配置</h5>
<p>RollbackConfiguration用于决定工作单元何时需要回滚事务。默认配置为任何Throwable都会触发回滚，其他可选配置可参考工作单元</p>
<p>通过EventProcessingConfigurer的registerRollbackConfiguration方法配置：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxonConfig</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureRollback</span><span class="hljs-params">(EventProcessingConfigurer processingConfigurer)</span> {
        <span class="hljs-comment">// 为 "custom-rollback-processor" 配置自定义回滚策略：仅 RuntimeException 触发回滚</span>
        processingConfigurer.registerRollbackConfiguration(<span class="hljs-string">"custom-rollback-processor"</span>, 
            config -&gt; RollbackConfigurationType.ANY_RUNTIME_EXCEPTION
        );
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pywebview进阶：基于Python直接操作前端元素]]></title>    <link>https://juejin.cn/post/7593311347291930651</link>    <guid>https://juejin.cn/post/7593311347291930651</guid>    <pubDate>2026-01-10T12:17:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593311347291930651" data-draft-id="7593251491937189934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pywebview进阶：基于Python直接操作前端元素"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-01-10T12:17:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐叔在学习"/> <meta itemprop="url" content="https://juejin.cn/user/4009253326568761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pywebview进阶：基于Python直接操作前端元素
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4009253326568761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐叔在学习
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T12:17:34.000Z" title="Sat Jan 10 2026 12:17:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><blockquote>
<p>这篇文章是此前 <code>pywebview</code> 系列文章的进阶篇 - 基于 <code>pywebview</code> 操作前端界面元素。</p>
</blockquote>
<p>系列文章：<br/>
<a href="https://juejin.cn/post/7557921840552820777" target="_blank" title="https://juejin.cn/post/7557921840552820777">Pywebview：Web技术构建桌面应用的最佳选择</a><br/>
<a href="https://juejin.cn/post/7589475497001238543" target="_blank" title="https://juejin.cn/post/7589475497001238543">PyWebView 移动端适配踩坑实录</a></p>
<h2 data-id="heading-0">使用场景说明</h2>
<p>为什么会有这个场景呢，因为有些使用场景下，使用 <code>pywebview</code> 开发时，前端无法调用到后端的 <code>API</code>，而这个时候只能由后端直接来操作前端页面。解释起来有点难，下面结合我实际的开发经验来解释吧。</p>
<p>基于官方文档 - <a href="https://link.juejin.cn?target=https%3A%2F%2Fpywebview.idepy.com%2Fguide%2Finterdomain.html" target="_blank" title="https://pywebview.idepy.com/guide/interdomain.html" ref="nofollow noopener noreferrer">Javascript–Python桥梁 | pywebview中文文档</a>，我们可以知道：在 <code>pywebview</code> 框架中，实现 <code>Javascript</code> 和 <code>Python</code> 间交互，主要依赖于 <code>window</code> 对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># python调用js-api方式：window.evaluate_js(code, callback=None) </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_js</span>(<span class="hljs-params">window</span>):
    <span class="hljs-keyword">try</span>:
        result = window.evaluate_js(<span class="hljs-string">'syntaxerror#$%#$'</span>)
    <span class="hljs-keyword">except</span> JavascriptException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'JavaScript 异常发生: '</span>, e)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    window = webview.create_window(<span class="hljs-string">'Evaluate JavaScript'</span>, html=<span class="hljs-string">'&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;'</span>)
    webview.start(evaluate_js, window)

<span class="hljs-comment"># python封装成js-api方式：pywebview.api.method_name</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    api = Api()
    window = webview.create_window(<span class="hljs-string">'JS 接口 示例'</span>, html=html, js_api=api)
    webview.start()
</code></pre>
<p>但是这里有个问题，<strong>你很难通过这两种方式在前端构建监听事件来直接操作 <code>window</code> 对象或其他 <code>pywebview</code> 框架本身的 <code>api</code></strong>。</p>
<h2 data-id="heading-1">使用场景示例</h2>
<p>以我最近开发 <code>todo-list</code> 应用为例，有个场景：实现应用窗口在桌面置顶功能。\</p>
<p>而目前查询 <code>pywebview</code> 框架官网的 <code>api</code>，可以使用 <code>window.on_top</code> 设置 <code>True</code> 或 <code>False</code> 来实现。最初想的很简单，就前端触发点击「置顶按钮」事件后，调用 <code>window.on_top</code> 就实现置顶了，再次调用就取消执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c2b7682547441a8ba8ca16cb2512190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768652384&amp;x-signature=1GXBUjyy4UnUHt%2BBuPnimHciY5U%3D" alt="image.png" loading="lazy"/></p>
<p>而实践发现：基于上述两种方式，操作不了。</p>
<ul>
<li>
<p>通过方式一是 <code>Python</code> 操作前端 <code>Javascript</code>，你没法在 <code>Javascript</code> 中调用 <code>pywebview</code> 的 <code>api</code>；</p>
</li>
<li>
<p>通过方式二是 <code>Python</code> 封装成 <code>js-api</code> ，但问题是封装的 <code>js-api</code> 是调用 <code>webview.create_window</code> 方法传入的，这个方法执行完才会创建 <code>window</code> 对象，也就是你创建 <code>window</code> 的时候，就必须初始化所有的 <code>api</code> 。所以你做不到封装的 <code>js-api</code> 中去调用 <code>window</code> 对象，因为还没创建。</p>
</li>
</ul>
<p>因为这个问题，昨天苦恼了一整天。尝试用 <code>AI</code> 实现，直接循环调用 <code>window</code> 对象，页面都响应不了了。</p>
<p>好在 <code>pywebview</code> 官方文档很全，今早查阅发现 <code>pywebview</code> 本身也可以操作前端 <code>dom</code> 对象，而不需要依赖 <code>Javascript</code> - <a href="https://link.juejin.cn?target=https%3A%2F%2Fpywebview.idepy.com%2Fexamples%2Fdom_manipulation.html" target="_blank" title="https://pywebview.idepy.com/examples/dom_manipulation.html" ref="nofollow noopener noreferrer">DOM 操作示例 | pywebview中文文档</a> 。</p>
<p>也就是置顶功能，可以这样玩：通过 <code>python</code> 监听前端「置顶按钮」的点击事件，如果点击了，直接通过 <code>python</code> 调用 <code>window.on_top</code> 就可以了，完全不依赖前端 <code>Javascript</code> 。事实证明确实可行，下述是简化的代码示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> webview

<span class="hljs-keyword">from</span> backend.api.todo_api <span class="hljs-keyword">import</span> TodoApi

window = <span class="hljs-literal">None</span>
window_on_top = <span class="hljs-literal">False</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">start_app</span>(<span class="hljs-params">window</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bind</span>(<span class="hljs-params">window</span>):
        <span class="hljs-comment"># 直接获取「置顶按钮」</span>
        button = window.dom.get_element(<span class="hljs-string">'#pin-top-btn'</span>)
        button.events.click += click_handler

    <span class="hljs-comment"># 「置顶按钮」点击事件</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">click_handler</span>(<span class="hljs-params">e</span>):
        <span class="hljs-keyword">global</span> window_on_top
        window_on_top = <span class="hljs-keyword">not</span> window_on_top
        app_logger.info(<span class="hljs-string">"TodoList 应用当前是否设置置顶："</span> + <span class="hljs-built_in">str</span>(window_on_top))
        window.on_top = window_on_top

    <span class="hljs-comment"># 创建API实例</span>
    api = TodoApi()

    <span class="hljs-comment"># 获取前端文件路径</span>
    frontend_path = get_resource_path(<span class="hljs-string">'frontend/index.html'</span>)

    window = webview.create_window(
        <span class="hljs-string">'Todo List App'</span>,
        frontend_path,
        js_api=api,
        width=<span class="hljs-number">1000</span>,
        height=<span class="hljs-number">700</span>,
        resizable=<span class="hljs-literal">True</span>
    )
    webview.start(bind, window, ssl=<span class="hljs-literal">True</span>, debug=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    start_app(window)
</code></pre>
<hr/>
<p>好啦，今天的技术分享就到这里了，更多有关 <code>python</code> 直接操作前端页面元素的，可以查看官网相关 <code>API</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpywebview.idepy.com%2Fguide%2Fapi.html%23webview-dom" target="_blank" title="https://pywebview.idepy.com/guide/api.html#webview-dom" ref="nofollow noopener noreferrer">API | pywebview中文文档</a></p>
<p>如果觉得本文对你有所帮助，欢迎三连哦！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[外链的两个指标，DR 和 UR 一次性讲清楚]]></title>    <link>https://juejin.cn/post/7593311347292045339</link>    <guid>https://juejin.cn/post/7593311347292045339</guid>    <pubDate>2026-01-10T12:48:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593311347292045339" data-draft-id="7593311347292028955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="外链的两个指标，DR 和 UR 一次性讲清楚"/> <meta itemprop="keywords" content="SEO"/> <meta itemprop="datePublished" content="2026-01-10T12:48:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="和平hepingfly"/> <meta itemprop="url" content="https://juejin.cn/user/4100516930912747"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            外链的两个指标，DR 和 UR 一次性讲清楚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4100516930912747/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    和平hepingfly
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T12:48:43.000Z" title="Sat Jan 10 2026 12:48:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想要在搜索引擎获得一个比较高的排名，外链是 Google 最重要的排名因素之一。</p>
<p>那怎么样去衡量外链的质量呢？</p>
<p>其中有一个非常重要的因素就是，<strong>权重</strong></p>
<p>如果有一个高权威页面，在这个页面里面有一条你网站的链接，那么对你网站的排名会有非常大的积极影响。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90f1999913504aa7829d4786df655f57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZKM5bmzaGVwaW5nZmx5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768654123&amp;x-signature=32uamK0b9JplnlOYqJTYThfdYdw%3D" alt="img" loading="lazy"/></p>
<p>那么通过什么样的指标去衡量页面的权威度呢？总得有一个量化的指标。</p>
<p>SEO 工具 Ahrefs 发明了两个指标，用来模拟 Google 怎么看待一个网站或一个页面的权威度。</p>
<p>也就是我们常说的 DR 和 UR。</p>
<ul>
<li><strong>网站评分（Domain Rating）</strong> : 网站的权重指标，范围为0–100。</li>
<li><strong>网址评分 （URL Rating）</strong> : 页面的权重指标，范围为0–100。</li>
</ul>
<h3 data-id="heading-0">DR 和 UR 有什么区别？为什么用两个指标来衡量？</h3>
<p>如果把 SEO 想象成一场投票游戏，别的网站给你链接（外链），就相当于投了你一票。</p>
<ul>
<li>DR (Domain Rating) = 整个网站有多牛逼</li>
<li>UR (URL Rating) = 单个网页有多牛逼</li>
</ul>
<h3 data-id="heading-1">什么是 Domain Rating (DR)？</h3>
<p>类比：奥运会衡量某个国家整体的体育实力，这个国家总共拿了多少块金牌？在金牌排行榜上多少名？</p>
<p>DR 衡量的是<strong>整个网站</strong>的外链强度。如果很多厉害的网站都链接到你的网站，你的 DR 就会高。</p>
<p><strong>具体有什么用？</strong></p>
<p>当你想找别的网站交换链接时，先看对方的 DR。如果对方 DR 很高（比如 80+），说明这个网站很牛逼。它的链接对你很有价值。</p>
<p>如果 DR 很低（比如 5），说明它是个小透明，对你的帮助很小。</p>
<p><strong>举例：</strong></p>
<p>假如你想做一个球鞋评测的网站，你发现竞争对手的网站 DR 是 70，而你是 20。这就代表，对方是一个在这个领域深耕已久的大站，你想在整体流量上超越他，还需要长期的积累。</p>
<h3 data-id="heading-2">什么是 URL Rating (UR)？</h3>
<p>类比：在奥运会中，某一个国家在某一项具体运动上的实力。比如说跳水运动拿了多少块金牌，在金牌榜上排行多少？</p>
<p>UR 衡量的是某一个具体页面（网址）的外链强度。哪怕是一个不知名网站（低 DR），如果有一篇爆款文章被无数大媒体转发链接，这篇文章的 UR 也会非常高。</p>
<p><strong>具体有什么用？</strong></p>
<p>可以帮我们去判断排名难度（能不能打赢）。</p>
<p><strong>举例：</strong></p>
<p>当你想写一篇关于iPhone 15 评测的文章去抢 Google 排名时，你可以去搜索一下现在的搜索结果第一名。</p>
<ul>
<li>如果第一名的页面 UR 是 80：说明这个页面被很多大佬引用过，你想把通过写文章把它挤下去，非常难。</li>
<li>如果第一名的页面 UR 是 10：说明这个页面虽然排第一，但根基不稳，你写一篇更好的文章并做一点推广，很有机会取而代之。</li>
</ul>
<p><strong>另外一个用处：</strong></p>
<p>你网站首页的 UR 通常最高。如果你新写了一篇文章 UR 很低，你可以从首页放一个链接指向新文章，把首页的权重（UR）分一点给新文章。</p>
<p><strong>一句话总结：</strong></p>
<p>帮你判断我要在某个具体关键词上抢排名，对手强不强，我有多大胜算。</p>
<h3 data-id="heading-3">为什么有的网站 DR 很高，但排名却输给了 DR 低的网站？</h3>
<p>如果你的对手是一个大网站（DR 80），但他排名的那个页面很边缘、没人引用（UR 5），而你的网站虽然小（DR 20），但你的那篇文章写得好、被很多人转发（UR 30）。</p>
<p><strong>你的 UR 30 &gt; 他的 UR 5，你完全有机会在排名上打败这个大网站。</strong></p>
<p>这就好比中国国家队的综合体育实力非常高，但是在 football 这项运动上，可以被很多国家按在地上摩擦。</p>
<p>回到网站上来，当你在 Google 搜东西时，Google 展现的是具体的页面，而不是整个网站。</p>
<p>Google 排名主要看具体的页面（UR） <strong>，</strong>  搜索结果是把一个个具体的<strong>页面</strong>拿出来比拼。</p>
<p>所以，<strong>UR 与 Google 排名的相关性比 DR 更高。</strong></p>
<p>虽然排名看 UR，但如果你的网站整体 DR 很高，你发布的新页面通常更容易获得较高的初始 UR，因为Google信任你的整个域名。</p>
<p>就好像中国综合体育实力很高，当谈到某一项运动时，别人第一反应都会觉得中国实力应该不错，因为大家对你的第一印象就是你们奥运会上成绩不错，体育实力应该都挺强的。</p>
<h3 data-id="heading-4">针对这两个指标，我们在实际操作中应该怎么样去对待？</h3>
<p>1）如果你在做外链建设</p>
<p>看 <strong>DR</strong>。你要努力争取来自高 DR 网站的链接。</p>
<p>2）如果你在做关键词研究</p>
<p>看 <strong>UR</strong>。分析搜索结果前几名的 UR，如果普遍很低，那就是你的机会（软柿子，可以捏）；如果普遍很高，建议换个词做（硬骨头，咬不动）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[007-spring cloud alibaba之Sentinel限流]]></title>    <link>https://juejin.cn/post/7593338828217663503</link>    <guid>https://juejin.cn/post/7593338828217663503</guid>    <pubDate>2026-01-10T13:43:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828217663503" data-draft-id="7593338828216942607" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="007-spring cloud alibaba之Sentinel限流"/> <meta itemprop="keywords" content="微服务"/> <meta itemprop="datePublished" content="2026-01-10T13:43:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="超级小猪"/> <meta itemprop="url" content="https://juejin.cn/user/3702810891008525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            007-spring cloud alibaba之Sentinel限流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810891008525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    超级小猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T13:43:34.000Z" title="Sat Jan 10 2026 13:43:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">sentinel环境搭建</h2>
<h3 data-id="heading-1">sentinel-dashboard搭建</h3>
<p>限流中间件。启动默认接口8080</p>
<ul>
<li>启动命令：java -jar sentinel-dashboard-1.8.2.jar</li>
<li>访问地址：localhost:8080</li>
<li>访问密码：sentinel/sentinel
如果端口占用，可以在启动命令中增加端口：<code>java -Dserver.port=8080 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar</code></li>
</ul>
<h3 data-id="heading-2">应用接入sentinel</h3>
<h4 data-id="heading-3">增加依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">增加配置</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">user</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">discovery:</span>
      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span>
    <span class="hljs-attr">sentinel:</span>
      <span class="hljs-attr">transport:</span>
        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">localhost:8080</span>
        <span class="hljs-attr">port:</span> <span class="hljs-number">8720</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-string">include:'*'</span>
</code></pre>
<h3 data-id="heading-5">流控</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4adceff393364f26b1a05eea2450c0a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5bCP54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657414&amp;x-signature=v8tiQV7vgVa2NxYezyvSTGol8V8%3D" alt="image.png" loading="lazy"/>
簇点链路-&gt;选择需要流控的接口-&gt;+流控</p>
<ul>
<li>资源名：路径，eg：/hello</li>
<li>针对来源：default，默认</li>
<li>阈值类型：QPS/并发线程数。
<ul>
<li>QPS：一秒内请求路径次数</li>
<li>并发线程数：线程数</li>
</ul>
</li>
<li>单机阈值：次数</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30318d026bf9485cbfc5b8e874629194~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5bCP54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657414&amp;x-signature=AGksMMwVdov5n9PXyKsIeSGYWBQ%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>流控模式：
<ul>
<li>直接：API达到限流条件时，直接限流</li>
<li>关联：当关联的资源达到阈值时，就限流自己</li>
<li>链路：只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流）(API级别的针对来源)</li>
</ul>
</li>
<li>流控效果：
<ul>
<li>快速失败：直接失败，抛异常</li>
<li>Wam Up：根据codeFactor（冷加载因子，默认3）的值，从阈值/codeFacotor，经过预热时长，才达到设置的QPS阈值</li>
<li>排队等待：匀速排队，让请求以匀速的速度通过，阈值类型必须设置为QPS，否则无效</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">流控模式：直接/关联</h4>
<p>这两种流控比较简单。直接就是当达到阈值，当前接口不能访问。关联是关联的资源达到阈值就限流自己。举一个关联的例子：下单和支付的关系。下单资源：<code>/createOrder</code>；支付资源：<code>/payOrder</code>。如果要配置关联可以在<code>/payOrder</code>配置一个关联<code>/createOrder</code>的限流。当<code>/createOrder</code>到达阈值，限制<code>/payOrder</code>的接口访问。</p>
<h4 data-id="heading-7">流控模式：链路</h4>
<p>链路是比较细粒度的限流模式。比如接口A需要调用接口B，接口C需要调用接口B，我们将接口B做为资源。然后配置接口A限流，限流的方式是链路。那么当到达接口B的限流上限，接口A就无法访问，但是接口C还可以继续访问不受影响。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
接口A --&gt; 接口B
接口C --&gt; 接口B
</code></pre>
<h5 data-id="heading-8">接口B</h5>
<p>定义资源使用<code>@SentinelResource</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@SentinelResource("userName")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserName</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"sentinel"</span>;
    }
}
</code></pre>
<h5 data-id="heading-9">调用接口B</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ApiOperation("s1")</span>
<span class="hljs-meta">@GetMapping("/s1")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">s1</span><span class="hljs-params">(HttpServletRequest request)</span>{
    System.out.println(<span class="hljs-string">"s1"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getUserName();
    <span class="hljs-keyword">return</span> <span class="hljs-string">"hello s1 "</span>+user+<span class="hljs-string">" ...9001"</span>;
}
</code></pre>
<h5 data-id="heading-10">调用接口A</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@ApiOperation</span>(<span class="hljs-string">"s2"</span>)
<span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/s2"</span>)
public String <span class="hljs-built_in">s2</span>(HttpServletRequest request){
    <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"s2"</span>);
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserName</span>();
    <span class="hljs-selector-tag">return</span> "<span class="hljs-selector-tag">hello</span> <span class="hljs-selector-tag">s2</span>"+<span class="hljs-selector-tag">user</span>+" ..<span class="hljs-selector-class">.9001</span>";
}
</code></pre>
<h5 data-id="heading-11">增加配置</h5>
<p>新增：<code>web-context-unify: false</code></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">user</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">discovery:</span>
      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span>
    <span class="hljs-attr">sentinel:</span>
      <span class="hljs-attr">transport:</span>
        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">localhost:8080</span>
        <span class="hljs-attr">port:</span> <span class="hljs-number">8720</span>
      <span class="hljs-attr">web-context-unify:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-string">include:'*'</span>

<span class="hljs-attr">swagger:</span>
  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
</code></pre>
<h5 data-id="heading-12">sentinel注册信息</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eccb470431b490688e02925b6f085f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5bCP54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657414&amp;x-signature=8F2nO4udDfGrgFDbsaOVfSlvYcw%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-13">验证</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be083dd8a7084c4081e669110d11fbe3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5bCP54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657414&amp;x-signature=SxNv0WHZL0pnoV%2BMRZZN8NjlBT0%3D" alt="image.png" loading="lazy"/>
被拒绝的请求如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09a186a2f75549969324bbac56f85631~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5bCP54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768657414&amp;x-signature=thLWOo49xWU%2FWq%2BLzNWaX%2BQFLws%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-14">流控效果：Warm Up</h4>
<p>Warm Up使用场景：预热/冷启动方式。该方式主要用于系统长期处于低水位的情况下，当流量突然增加时，直接把系统拉升到高水位可能瞬间把系统压垮。通过"冷启动"，让通过的流量缓慢增加，在一定时间内逐渐增加到阈值上限，给冷系统一个预热的时间，避免冷系统被压垮的情况。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mysql：简单易懂了解MVCC]]></title>    <link>https://juejin.cn/post/7593292445300064275</link>    <guid>https://juejin.cn/post/7593292445300064275</guid>    <pubDate>2026-01-10T14:31:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593292445300064275" data-draft-id="7593232758127902726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mysql：简单易懂了解MVCC"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2026-01-10T14:31:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户887625560622"/> <meta itemprop="url" content="https://juejin.cn/user/4408380841266377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mysql：简单易懂了解MVCC
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4408380841266377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户887625560622
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T14:31:57.000Z" title="Sat Jan 10 2026 14:31:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一句话说清楚</h3>
<p>MVCC = 多版本并发控制 = 每个事务看到的是数据库在某个时间点的"快照"，而不是实时数据。</p>
<h2 data-id="heading-1">用一个生活中的例子理解</h2>
<h3 data-id="heading-2">场景：银行账户余额查询</h3>
<p>想象你在银行查询余额：</p>
<h4 data-id="heading-3">没有 MVCC 的情况（加锁）</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 你开始查询余额：1000元
<span class="hljs-bullet">2.</span> 同时，你老婆在转账：-500元
<span class="hljs-bullet">3.</span> 银行说："等等！你老婆正在操作，你等会儿再查"
<span class="hljs-bullet">4.</span> 你被阻塞，直到转账完成
</code></pre>
<p>问题：读操作被写操作阻塞</p>
<h4 data-id="heading-4">有 MVCC 的情况</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 你开始查询余额：1000元
<span class="hljs-bullet">2.</span> 同时，你老婆在转账：-500元
<span class="hljs-bullet">3.</span> 银行说："你查你的，她转她的，互不影响"
<span class="hljs-bullet">4.</span> 你看到的是查询开始时的余额：1000元
<span class="hljs-bullet">5.</span> 你老婆转账完成后，余额变成500元
<span class="hljs-bullet">6.</span> 你下次查询才会看到500元
</code></pre>
<p>优点：读写不冲突，读操作看到的是一致性快照</p>
<h2 data-id="heading-5">技术原理（核心概念）</h2>
<p>MVCC 主要依赖以下三个关键技术来实现：</p>
<h4 data-id="heading-6">1. 数据的三个隐藏字段</h4>
<p>InnoDB 引擎会为每一行数据自动添加三个我们看不见的隐藏字段：</p>
<ul>
<li>DB_TRX_ID（6字节）：最近修改/创建本行数据的事务ID。记录是哪个事务生成了这个数据版本。</li>
<li>DB_ROLL_PTR（7字节）：回滚指针。指向这条数据的上一个版本的地址（存储在 Undo Log 中）。它就像一条链表的指针，把同一个数据的多个版本串联起来。</li>
<li>DB_ROW_ID（6字节）：行ID。如果表没有主键，InnoDB 会用它生成聚簇索引。</li>
</ul>
<h4 data-id="heading-7">2. Undo Log（回滚日志）</h4>
<ul>
<li>作用：存储数据旧版本的“档案馆”。</li>
<li>当一行数据被更新时，旧版本的数据不会立刻删除，而是会被拷贝到 Undo Log 中，并通过 DB_ROLL_PTR 指针形成一个版本链。</li>
<li>这个版本链使得事务可以根据需要找到任何历史版本的数据。</li>
</ul>
<h4 data-id="heading-8">3. Read View（读视图）</h4>
<ul>
<li>作用：决定当前事务应该看到哪个版本数据的“筛选规则”。</li>
<li>当一个事务执行快照读（普通的 SELECT 语句）时，会生成一个 Read View。这个 Read View 主要包含：</li>
<li>
<ul>
<li>m_ids：生成 Read View 时，系统中活跃的（未提交的）事务ID列表。</li>
<li>min_trx_id：m_ids 中的最小值。</li>
<li>max_trx_id：生成 Read View 时，系统应该分配给下一个事务的 ID。</li>
<li>creator_trx_id：创建这个 Read View 的事务自己的 ID。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">MVCC 版本链的形成过程</h2>
<h5 data-id="heading-10">示例：三次更新操作</h5>
<pre><code class="hljs language-ini" lang="ini">-- 初始状态
INSERT INTO users (id, name) VALUES (1, '张三')<span class="hljs-comment">;</span>
-- 版本V1: <span class="hljs-attr">name</span>=<span class="hljs-string">'张三'</span>, trx_id=<span class="hljs-number">100</span>, roll_ptr=NULL

-- 事务200更新
BEGIN<span class="hljs-comment">;</span>
UPDATE users SET <span class="hljs-attr">name</span> = <span class="hljs-string">'李四'</span> WHERE id = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
-- 版本V2: <span class="hljs-attr">name</span>=<span class="hljs-string">'李四'</span>, trx_id=<span class="hljs-number">200</span>, roll_ptr→V1
COMMIT<span class="hljs-comment">;</span>

-- 事务300更新
BEGIN<span class="hljs-comment">;</span>
UPDATE users SET <span class="hljs-attr">name</span> = <span class="hljs-string">'王五'</span> WHERE id = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
-- 版本V3: <span class="hljs-attr">name</span>=<span class="hljs-string">'王五'</span>, trx_id=<span class="hljs-number">300</span>, roll_ptr→V2
COMMIT<span class="hljs-comment">;</span>
</code></pre>
<p>形成的版本链：</p>
<pre><code class="hljs language-ini" lang="ini">最新版本 ← 当前查询从这里开始
    ↓
V3: <span class="hljs-attr">name</span>=<span class="hljs-string">'王五'</span>, trx_id=<span class="hljs-number">300</span>, roll_ptr → V2
                          ↓
V2: <span class="hljs-attr">name</span>=<span class="hljs-string">'李四'</span>, trx_id=<span class="hljs-number">200</span>, roll_ptr → V1
                          ↓
V1: <span class="hljs-attr">name</span>=<span class="hljs-string">'张三'</span>, trx_id=<span class="hljs-number">100</span>, roll_ptr = NULL
</code></pre>
<h2 data-id="heading-11">MVCC 如何工作（四步判断）</h2>
<p>当事务要读取一行数据时，会沿着版本链，从最新版本开始往回找，判断哪个版本对当前事务可见：</p>
<h3 data-id="heading-12">判断规则（核心！）</h3>
<p>对于版本链中的每个版本，检查其事务ID（DB_TRX_ID）：</p>
<ol>
<li>如果 DB_TRX_ID = creator_trx_id：
<ul>
<li>说明这个版本是当前事务自己修改的 ✅ 可见</li>
</ul>
</li>
<li>如果 DB_TRX_ID &lt; min_trx_id：
<ul>
<li>说明这个版本在 ReadView 创建前已提交 ✅ 可见</li>
</ul>
</li>
<li>如果 DB_TRX_ID &gt; max_trx_id：
<ul>
<li>说明这个版本在 ReadView 创建后才开始 ❌ 不可见</li>
</ul>
</li>
<li>如果 min_trx_id &lt; DB_TRX_ID &lt; max_trx_id
<ul>
<li>不在 m_ids 中：说明这个版本的事务已提交 ✅ 可见</li>
<li>在 m_ids 中：说明这个版本的事务还在活跃（未提交） ❌ 不可见</li>
</ul>
</li>
</ol>
<p>如果当前版本不可见，就沿着回滚指针找上一个版本，直到找到可见的版本或版本链结束。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a16ad20011dc418fb8df97ec23a72afd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODg3NjI1NTYwNjIy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768660316&amp;x-signature=%2B%2BSltkEyvYViUCLdAWKvtP2ATLA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">实战例子演示</h2>
<h3 data-id="heading-14">场景：两个事务并发操作</h3>
<p>初始数据：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">id</span>=<span class="hljs-number">1</span>, name=<span class="hljs-string">'张三'</span>, age=<span class="hljs-number">20</span>, DB_TRX_ID=<span class="hljs-number">50</span>, DB_ROLL_PTR=NULL
</code></pre>
<p>事务时间线：</p>
<pre><code class="hljs language-ini" lang="ini">时间点1：事务100开始，修改 <span class="hljs-attr">age</span>=<span class="hljs-number">21</span>
时间点2：事务200开始，创建 ReadView
时间点3：事务100提交
时间点4：事务200查询数据
</code></pre>
<h3 data-id="heading-15">版本链形成</h3>
<pre><code class="hljs language-ini" lang="ini">当前版本：<span class="hljs-attr">age</span>=<span class="hljs-number">21</span>, DB_TRX_ID=<span class="hljs-number">100</span>, DB_ROLL_PTR→
          ↓
旧版本：<span class="hljs-attr">age</span>=<span class="hljs-number">20</span>, DB_TRX_ID=<span class="hljs-number">50</span>, DB_ROLL_PTR=NULL
</code></pre>
<h3 data-id="heading-16">事务200的 ReadView</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">m_ids</span> = [<span class="hljs-number">100</span>, <span class="hljs-number">200</span>]   // 活跃事务列表
<span class="hljs-attr">min_trx_id</span> = <span class="hljs-number">100</span>     // 最小活跃事务ID
<span class="hljs-attr">max_trx_id</span> = <span class="hljs-number">201</span>     // 下一个事务ID
<span class="hljs-attr">creator_trx_id</span> = <span class="hljs-number">200</span> // 当前事务ID
</code></pre>
<h3 data-id="heading-17">事务200查询过程</h3>
<ol>
<li>找到当前版本：age=21, DB_TRX_ID=100</li>
<li>判断：DB_TRX_ID=100 在 m_ids 中（事务100还在活跃）</li>
<li>❌ 不可见，继续找上一个版本</li>
<li>找到旧版本：age=20, DB_TRX_ID=50</li>
<li>判断：DB_TRX_ID=50 &lt; min_trx_id(100)</li>
<li>✅ 可见，返回 age=20</li>
</ol>
<p>结果：事务200看到的是 age=20，而不是最新的 age=21</p>
<h2 data-id="heading-18">隔离级别与 MVCC</h2>






























<table><thead><tr><th align="left"><strong>隔离级别</strong></th><th align="left"><strong>MVCC 行为</strong></th><th align="left"><strong>说明</strong></th></tr></thead><tbody><tr><td align="left">读未提交</td><td align="left">不使用 MVCC</td><td align="left">直接读最新数据，可能读到脏数据</td></tr><tr><td align="left">读已提交</td><td align="left">每次读时都创建新 ReadView</td><td align="left">每次查询看到已提交的最新数据</td></tr><tr><td align="left">可重复读</td><td align="left">第一次读时创建 ReadView</td><td align="left">整个事务看到同一个快照</td></tr><tr><td align="left">串行化</td><td align="left">不使用 MVCC</td><td align="left">加锁，完全串行执行</td></tr></tbody></table>
<h2 data-id="heading-19">底层实现细节</h2>
<h3 data-id="heading-20">1. Undo Log（回滚日志）</h3>
<ul>
<li>记录数据修改前的旧值</li>
<li>用于回滚事务和构建版本链</li>
<li>当事务提交后，undo log 不会立即删除，因为可能还有其他事务需要读旧版本</li>
</ul>
<h3 data-id="heading-21">2. 版本链清理</h3>
<ul>
<li>当没有事务需要读旧版本时，undo log 会被清理</li>
<li>通过 purge 线程定期清理</li>
<li>清理条件：所有 ReadView 的 min_trx_id 都大于某个版本的事务ID</li>
</ul>
<h3 data-id="heading-22">3. 当前读 vs 快照读</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 快照读（使用MVCC）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;  <span class="hljs-comment">-- 看到快照</span>

<span class="hljs-comment">-- 当前读（加锁，读最新）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;  <span class="hljs-comment">-- 加写锁</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> LOCK <span class="hljs-keyword">IN</span> SHARE MODE;  <span class="hljs-comment">-- 加读锁</span>
</code></pre>
<h2 data-id="heading-23">一句话总结</h2>
<p>MVCC 就是：每个事务看到的是数据库在某个时间点的"快照"，而不是实时数据。通过版本链和 ReadView 机制，实现读写不冲突和高并发。</p>
<p>记住这个核心：</p>
<ul>
<li>版本链：每次修改都记录旧版本，形成链表</li>
<li>ReadView：事务开始时创建，决定哪些版本可见</li>
<li>判断规则：沿着版本链找，找到第一个对当前事务可见的版本</li>
<li>隔离级别：读已提交 vs 可重复读的区别在于 ReadView 的创建时机</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java异常体系结构]]></title>    <link>https://juejin.cn/post/7593292445300097043</link>    <guid>https://juejin.cn/post/7593292445300097043</guid>    <pubDate>2026-01-10T14:36:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593292445300097043" data-draft-id="7593198957985021993" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java异常体系结构"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-10T14:36:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Assby"/> <meta itemprop="url" content="https://juejin.cn/user/2496307079162410"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java异常体系结构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2496307079162410/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Assby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T14:36:14.000Z" title="Sat Jan 10 2026 14:36:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java 异常体系结构详解</h2>
<p>Java 的异常处理机制是其健壮性的重要保证。理解异常的层次结构和处理原则，是写出高质量 Java 代码的基础。本文将系统梳理 Java 异常体系的核心概念与最佳实践。</p>
<hr/>
<h3 data-id="heading-1">一、Java 异常体系总览</h3>
<p>Java 的异常体系是一个单根继承树，所有异常都继承自 <code>Throwable</code> 类：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a42a78707e094f53baff7fc98b1964c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNzYnk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768660574&amp;x-signature=ASl3pQ88NSdhzIq%2B2pnKbG0f7ys%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">二、Error vs Exception：根本区别</h3>
<h4 data-id="heading-3">2.1 Error：系统级灾难</h4>
<p><strong>Error 表示系统级的严重错误</strong>，通常由 JVM 或底层系统抛出，程序<strong>无法恢复</strong>，只能终止运行。</p>
<p><strong>典型场景</strong>：</p>
<ul>
<li><code>OutOfMemoryError</code>：内存耗尽</li>
<li><code>StackOverflowError</code>：栈溢出（无限递归）</li>
<li><code>VirtualMachineError</code>：JVM 内部错误</li>
</ul>
<p><strong>处理原则</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 不要捕获 Error</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 业务代码</span>
} <span class="hljs-keyword">catch</span> (Error e) {  <span class="hljs-comment">// 错误示范！</span>
    <span class="hljs-comment">// 无法真正恢复</span>
}

<span class="hljs-comment">// ✅ 让进程优雅退出</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 应用启动</span>
        startApplication();
    } <span class="hljs-keyword">catch</span> (OutOfMemoryError e) {
        <span class="hljs-comment">// 记录日志、释放资源、报警</span>
        logger.error(<span class="hljs-string">"系统内存耗尽，即将退出"</span>, e);
        System.exit(-<span class="hljs-number">1</span>);
    }
}
</code></pre>
<h4 data-id="heading-4">2.2 Exception：程序级业务异常</h4>
<p><strong>Exception 表示程序运行中可以预料、可以恢复的异常</strong>，属于业务范畴，<strong>必须被处理</strong>。</p>
<p><strong>核心特征</strong>：</p>
<ul>
<li>代表程序逻辑缺陷或外部条件不满足</li>
<li>可以通过合理的异常处理机制恢复</li>
<li>是程序健壮性的体现</li>
</ul>
<hr/>
<h3 data-id="heading-5">三、Exception 的两大分支</h3>
<h4 data-id="heading-6">3.1 Checked Exception（受检异常）</h4>
<p><strong>定义</strong>：继承自 <code>Exception</code> 但不继承 <code>RuntimeException</code>。</p>
<p><strong>编译器强制检查</strong>：必须在代码中显式处理（try-catch 或 throws 声明），否则<strong>编译不通过</strong>。</p>
<p><strong>典型代表</strong>：</p>
<ul>
<li><code>IOException</code>：文件读写失败</li>
<li><code>SQLException</code>：数据库操作异常</li>
<li><code>ClassNotFoundException</code>：类未找到</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 编译失败：Unhandled exception: java.io.IOException</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">()</span> {
    <span class="hljs-type">FileReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(<span class="hljs-string">"data.txt"</span>);
}

<span class="hljs-comment">// ✅ 正确：try-catch 处理</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">FileReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(<span class="hljs-string">"data.txt"</span>);
        <span class="hljs-comment">// 读取逻辑</span>
    } <span class="hljs-keyword">catch</span> (IOException e) {
        logger.error(<span class="hljs-string">"文件读取失败"</span>, e);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"配置文件读取失败，请联系管理员"</span>);
    }
}

<span class="hljs-comment">// ✅ 正确：throws 声明抛出</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">FileReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(<span class="hljs-string">"data.txt"</span>);
    <span class="hljs-comment">// 让调用者处理</span>
}
</code></pre>
<h4 data-id="heading-7">3.2 Unchecked Exception（非受检异常）</h4>
<p><strong>定义</strong>：继承自 <code>RuntimeException</code>。</p>
<p><strong>编译器不检查</strong>：无需显式捕获，运行时才会抛出。</p>
<p><strong>典型代表</strong>：</p>
<ul>
<li><code>NullPointerException</code>：空指针访问</li>
<li><code>IndexOutOfBoundsException</code>：数组越界</li>
<li><code>IllegalArgumentException</code>：非法参数</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ✅ 编译通过（无需强制处理）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    str.length();  <span class="hljs-comment">// 可能抛出 NullPointerException</span>
}
</code></pre>
<p><strong>处理原则</strong>：Unchecked Exception 通常代表<strong>程序逻辑缺陷</strong>，应该通过<strong>代码优化</strong>避免，而不是 捕获后忽略。</p>
<hr/>
<h3 data-id="heading-8">四、异常处理四大黄金法则</h3>
<h4 data-id="heading-9">1. <strong>优先捕获特定异常，避免捕获通用 Exception</strong></h4>
<p><strong>反模式</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 会掩盖具体错误，难以定位问题</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 业务代码</span>
} <span class="hljs-keyword">catch</span> (Exception e) {  <span class="hljs-comment">// 捕获范围太广</span>
    logger.error(<span class="hljs-string">"出错了"</span>, e);
}
</code></pre>
<p><strong>最佳实践</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ✅ 精确捕获，针对性处理</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 文件操作</span>
} <span class="hljs-keyword">catch</span> (FileNotFoundException e) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"配置文件不存在"</span>);
} <span class="hljs-keyword">catch</span> (IOException e) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"文件读取失败"</span>);
} <span class="hljs-keyword">catch</span> (SQLException e) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"数据库操作异常"</span>);
}
</code></pre>
<h4 data-id="heading-10">2. <strong>捕获后必须处理：记录日志 + 抛出业务异常</strong></h4>
<p><strong>反模式</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 吞掉异常，上层无法感知</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 数据库操作</span>
} <span class="hljs-keyword">catch</span> (SQLException e) {
    <span class="hljs-comment">// 什么都不做！异常被静默吞掉</span>
}
</code></pre>
<p><strong>最佳实践</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ✅ 记录日志 + 转换为业务异常</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 数据库操作</span>
} <span class="hljs-keyword">catch</span> (SQLException e) {
    logger.error(<span class="hljs-string">"用户ID={} 注册失败，SQL状态={}"</span>, userId, e.getSQLState(), e);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRegistrationException</span>(<span class="hljs-string">"用户注册失败，请稍后重试"</span>);
}
</code></pre>
<h4 data-id="heading-11">3. <strong>不要延迟处理异常</strong></h4>
<p><strong>反模式</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 捕获后存储，后续再处理（难以理解）</span>
<span class="hljs-keyword">private</span> Exception cachedException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 业务代码</span>
    } <span class="hljs-keyword">catch</span> (IOException e) {
        <span class="hljs-built_in">this</span>.cachedException = e;  <span class="hljs-comment">// 错误示范！</span>
    }
}
</code></pre>
<p><strong>最佳实践</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ✅ 立即处理或抛出</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// 业务代码</span>
}

<span class="hljs-comment">// 或者在调用处处理</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">caller</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        doWork();
    } <span class="hljs-keyword">catch</span> (IOException e) {
        handleError(e);  <span class="hljs-comment">// 立即处理</span>
    }
}
</code></pre>
<h4 data-id="heading-12">4. <strong>严禁在 finally 中 return</strong></h4>
<p><strong>致命后果</strong>：</p>
<ul>
<li><strong>覆盖</strong> try 或 catch 中的返回值</li>
<li><strong>吞掉</strong> try 中抛出的异常</li>
</ul>
<p><strong>反模式</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 最终返回 2，异常被吞掉</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;  <span class="hljs-comment">// 抛出异常</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">// 异常消失，返回 2</span>
    }
}
</code></pre>
<p><strong>最佳实践</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ✅ finally 只做资源清理</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> riskyOperation();  <span class="hljs-comment">// 成功时返回</span>
    } <span class="hljs-keyword">catch</span> (Exception e) {
        logger.error(<span class="hljs-string">"操作失败"</span>, e);
        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;  <span class="hljs-comment">// 失败时返回</span>
    } <span class="hljs-keyword">finally</span> {
        cleanup();  <span class="hljs-comment">// 只清理资源，不干预返回值</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-13">五、总结</h3>
<p>Java 异常体系是一个精心设计的分层结构：</p>
<ul>
<li><strong>Error</strong>：系统级灾难，无法恢复，应优雅退出</li>
<li><strong>Exception</strong>：程序级异常，可处理，必须显式应对
<ul>
<li><strong>Checked Exception</strong>：编译器强制检查，代表可预测的外部风险</li>
<li><strong>Unchecked Exception</strong>：运行时异常，代表程序逻辑缺陷</li>
</ul>
</li>
</ul>
<p><strong>异常处理的核心原则</strong>：<strong>快速失败、清晰记录、业务转换、绝不隐瞒</strong>。良好的异常处理不是隐藏错误，而是让错误信息更透明、更易于理解和修复。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 方法派发深度解析：从 Swizzling 到派发机制]]></title>    <link>https://juejin.cn/post/7593292445300359187</link>    <guid>https://juejin.cn/post/7593292445300359187</guid>    <pubDate>2026-01-10T16:32:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593292445300359187" data-draft-id="7590104561476042804" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Swift 方法派发深度解析：从 Swizzling 到派发机制"/> <meta itemprop="keywords" content="性能优化"/> <meta itemprop="datePublished" content="2026-01-10T16:32:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sweet丶"/> <meta itemprop="url" content="https://juejin.cn/user/3227821869921646"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Swift 方法派发深度解析：从 Swizzling 到派发机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821869921646/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sweet丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T16:32:43.000Z" title="Sat Jan 10 2026 16:32:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：一个危险的实验</h2>
<p>想象一下，你正在调试一个复杂的 iOS 应用，想要在不修改源码的情况下监控所有 <code>UIViewController</code> 的 <code>viewDidAppear</code> 调用；还有如果要支持热修复，该如何？你可能会想到使用 <strong>Method Swizzling</strong>：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzled_viewDidAppear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"🎯 [AOP] <span class="hljs-subst">\(<span class="hljs-built_in">type</span>(of: <span class="hljs-keyword">self</span>))</span> 显示"</span>)
        swizzled_viewDidAppear(animated) <span class="hljs-comment">// 调用原始实现</span>
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzleViewDidAppear</span>() {
        <span class="hljs-keyword">let</span> original <span class="hljs-operator">=</span> <span class="hljs-keyword">#selector</span>(viewDidAppear(<span class="hljs-keyword">_</span>:))
        <span class="hljs-keyword">let</span> swizzled <span class="hljs-operator">=</span> <span class="hljs-keyword">#selector</span>(swizzled_viewDidAppear(<span class="hljs-keyword">_</span>:))
        
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> originalMethod <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, original),
              <span class="hljs-keyword">let</span> swizzledMethod <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, swizzled) <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        
        method_exchangeImplementations(originalMethod, swizzledMethod)
    }
}
</code></pre>
<p>看起来完美，对吧？但这里隐藏着一个 Swift 的重要秘密：<strong>为什么必须使用 <code>@objc dynamic</code>？</strong> 如果去掉 <code>dynamic</code> 会发生什么？</p>
<h2 data-id="heading-1">Part 1: 为什么 Swizzling 需要动态派发？</h2>
<h3 data-id="heading-2">1.1 Swizzling 的工作原理</h3>
<p>Method Swizzling 本质上是<strong>在运行时交换两个方法的实现</strong>。它依赖 Objective-C 运行时的消息派发机制：</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// Objective-C 运行时的工作方式</span>
objc_msgSend(object, selector, ...)
</code></pre>
<p>当调用 <code>[object method]</code> 时，运行时：</p>
<ol>
<li>根据对象的类查找方法列表</li>
<li>找到对应 selector 的实现（IMP）</li>
<li>执行该实现</li>
</ol>
<p>Swizzling 就是修改了第 2 步的映射关系。</p>
<h3 data-id="heading-3">1.2 Swift 与 Objective-C 的冲突</h3>
<p>问题在于：<strong>Swift 默认不使用消息派发</strong>！</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">normalMethod</span>() { }     <span class="hljs-comment">// Swift 默认派发</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">exposedMethod</span>() { }  <span class="hljs-comment">// 对 OC 可见，但仍不是消息派发</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">dynamicMethod</span>() { }  <span class="hljs-comment">// 这才是消息派发</span>
}
</code></pre>
<p>如果你尝试 Swizzle 一个非 <code>dynamic</code> 的方法：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSwizzle</span>: <span class="hljs-title class_">NSObject</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">original</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Original"</span>) }
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzled</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Swizzled"</span>) }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">attemptSwizzle</span>() {
        <span class="hljs-keyword">let</span> original <span class="hljs-operator">=</span> <span class="hljs-keyword">#selector</span>(original)
        <span class="hljs-keyword">let</span> swizzled <span class="hljs-operator">=</span> <span class="hljs-keyword">#selector</span>(swizzled)
        
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> origMethod <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, original),
              <span class="hljs-keyword">let</span> swizMethod <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, swizzled) <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"交换前："</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"original IMP: <span class="hljs-subst">\(method_getImplementation(origMethod))</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"swizzled IMP: <span class="hljs-subst">\(method_getImplementation(swizMethod))</span>"</span>)
        
        method_exchangeImplementations(origMethod, swizMethod)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"交换后："</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"original IMP: <span class="hljs-subst">\(method_getImplementation(origMethod))</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"swizzled IMP: <span class="hljs-subst">\(method_getImplementation(swizMethod))</span>"</span>)
        
        <span class="hljs-keyword">let</span> test <span class="hljs-operator">=</span> <span class="hljs-type">TestSwizzle</span>()
        test.original()  <span class="hljs-comment">// 输出什么？</span>
    }
}
</code></pre>
<p><strong>运行结果可能让你困惑：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">交换前：</span>
<span class="hljs-attr">original IMP:</span> <span class="hljs-number">0x0000000102f7fbc0</span>
<span class="hljs-attr">swizzled IMP:</span> <span class="hljs-number">0x0000000102f7fcc0</span>

<span class="hljs-string">交换后：</span>
<span class="hljs-attr">original IMP:</span> <span class="hljs-number">0x0000000102f7fcc0</span>
<span class="hljs-attr">swizzled IMP:</span> <span class="hljs-number">0x0000000102f7fbc0</span>

<span class="hljs-string">Original</span>   <span class="hljs-string">//❓</span> <span class="hljs-string">调用结果还是</span> <span class="hljs-string">"Original"</span><span class="hljs-string">！</span>
</code></pre>
<p>为什么 IMP 发生交换后，但行为没变？</p>
<h2 data-id="heading-4">Part 2: Swift 的三种派发方式</h2>
<h3 data-id="heading-5">2.1 派发方式对比</h3>
<p>假设大家已有概念，为了方便快速浏览，我把这些汇总到了一个表格：</p>













































































<table><thead><tr><th>特性</th><th>直接派发 (Direct Dispatch)</th><th>表派发 (Table Dispatch)</th><th>消息派发 (Message Dispatch)</th></tr></thead><tbody><tr><td><strong>Swift 写法</strong></td><td><code>final func</code><br/><code>struct 的方法</code><br/><code>extension 中的方法</code><br/><code>private/fileprivate func</code></td><td><code>class func</code> (默认)<br/><code>@objc func</code> (仅 Swift 内)</td><td><code>@objc dynamic func</code><br/><code>@objc dynamic var</code></td></tr><tr><td><strong>调用方式</strong></td><td>编译时确定地址，直接跳转</td><td>通过在类对象虚函数表查找</td><td>Objective-C 运行时 <code>objc_msgSend</code></td></tr><tr><td><strong>性能</strong></td><td>⚡️ <strong>最快</strong> (几乎无开销)</td><td>⚡ <strong>较快</strong> (一次指针查找)</td><td>🐌 <strong>最慢</strong> (哈希查找+缓存)</td></tr><tr><td><strong>灵活性</strong></td><td>❌ 最低 (无法重写)</td><td>✅ 中等 (支持继承重写)</td><td>✅✅ 最高 (支持运行时修改)</td></tr><tr><td><strong>内存占用</strong></td><td>无额外开销</td><td>每个类一个虚函数表</td><td>每个类方法列表 + 缓存</td></tr><tr><td><strong>重写支持</strong></td><td>❌ 不支持</td><td>✅ 支持</td><td>✅ 支持</td></tr><tr><td><strong>运行时修改</strong></td><td>❌ 不可能</td><td>❌ 不可能 (Swift 5+)</td><td>✅ 可能 (Method Swizzling)</td></tr><tr><td><strong>KVO 支持</strong></td><td>❌ 不支持</td><td>❌ 不支持</td><td>✅ 支持</td></tr><tr><td><strong>典型应用</strong></td><td>工具方法、性能关键代码</td><td>普通业务逻辑、可继承的类</td><td>需要动态特性的代码</td></tr><tr><td><strong>二进制影响</strong></td><td>最小</td><td>中等</td><td>最大 (生成 OC 元数据)</td></tr><tr><td><strong>调试难度</strong></td><td>简单</td><td>中等</td><td>困难 (调用栈复杂)</td></tr></tbody></table>
<h3 data-id="heading-6">2.2 方法派发特别注意点</h3>
<h4 data-id="heading-7"><strong>extension 中的方法特别说明：</strong></h4>
<p>extension 中的方法<strong>默认</strong>是静态派发，不能被子类重写，编译器可以在编译时确定具体实现。
这样设计的原因有下面几点：</p>
<ul>
<li><strong>明确性</strong>: extension表示添加新功能，override表示修改现有功能，两者分离，避免混淆。</li>
<li><strong>安全性</strong>：不允许重写 → 保证 extension 方法的稳定性。</li>
<li><strong>模块化</strong>：不用担心用户重写了自己模块extension中方法导致异常。</li>
<li>良好实践：使用 extension 分离关注点。</li>
</ul>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseClass</span> {
    <span class="hljs-comment">// 进入类的虚函数表</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">original</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Base original"</span>) }
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">BaseClass</span> {
    <span class="hljs-comment">// 不在虚函数表中！相当于直接是函数地址</span>
    <span class="hljs-comment">// 编译后的伪代码: 是生成一个全局函数</span>
    <span class="hljs-comment">// void String_extension_customMethod(String *self) {</span>
    <span class="hljs-comment">//     // 函数体</span>
    <span class="hljs-comment">// }</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">extensionMethod</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"extension method"</span>) }
    
    <span class="hljs-comment">// ❌ 不能在 extension 中重写原类方法</span>
    <span class="hljs-comment">// override func original() { }  // 编译错误</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SubClass</span>: <span class="hljs-title class_">BaseClass</span> {
    <span class="hljs-comment">// ✅ 可以重写原类方法</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">original</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"SubClass original"</span>) }
    
    <span class="hljs-comment">// ❌ 不能重写 extension 中的方法</span>
    <span class="hljs-comment">// override func extensionMethod() { }  // 编译错误</span>
}
</code></pre>
<h4 data-id="heading-8"><strong>对 Objective-C 类的 extension</strong></h4>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-comment">// Objective-C 类（如 UIView）</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">UIView</span> {
    <span class="hljs-comment">// 仍然是直接派发（在 Swift 中调用时）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">swiftExtensionMethod</span>() { }
    
    <span class="hljs-comment">// 但通过 @objc 暴露给 Objective-C 时</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">objcExposedMethod</span>() { }  
    <span class="hljs-comment">// Swift 内：直接派发</span>
    <span class="hljs-comment">// Objective-C 内：通过桥接，底层是消息派发</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">NSObject</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">specialMethod</span>() { }
    <span class="hljs-comment">// 这会强制使用消息派发</span>
    <span class="hljs-comment">// 可以被重写（因为是消息派发）</span>
    <span class="hljs-comment">// 但这是特殊情况，利用了 Objective-C 运行时</span>
}
</code></pre>
<h4 data-id="heading-9"><strong>协议扩展extension</strong></h4>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Drawable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>()  <span class="hljs-comment">// 协议要求</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Drawable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>() {  <span class="hljs-comment">// 默认实现</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"默认绘制"</span>)
    }
    <span class="hljs-comment">// 这是直接派发，但可以通过协议类型动态派发</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>: <span class="hljs-title class_">Drawable</span> { }

<span class="hljs-keyword">let</span> circle <span class="hljs-operator">=</span> <span class="hljs-type">Circle</span>()
circle.draw()  <span class="hljs-comment">// 直接派发：调用默认实现</span>

<span class="hljs-keyword">let</span> drawable: <span class="hljs-type">Drawable</span> <span class="hljs-operator">=</span> circle
drawable.draw()  <span class="hljs-comment">// 协议派发：通过协议见证表PWT（Protocol Witness Table）</span>
<span class="hljs-comment">// 内存布局</span>
<span class="hljs-type">Circle</span> 实例：
<span class="hljs-operator">┌──────────┐</span>
<span class="hljs-operator">│</span> 数据字段  <span class="hljs-operator">│</span>
<span class="hljs-operator">├──────────┤</span>
<span class="hljs-operator">│</span> <span class="hljs-type">PWT</span> 指针 <span class="hljs-operator">│</span> <span class="hljs-operator">→</span> 指向 <span class="hljs-type">Circle</span> 的协议见证表
<span class="hljs-operator">└──────────┘</span>

<span class="hljs-type">Circle</span> 的 <span class="hljs-type">PWT：</span>
<span class="hljs-operator">┌──────────┐</span>
<span class="hljs-operator">│</span> draw()   <span class="hljs-operator">│</span> <span class="hljs-operator">←</span> 索引 <span class="hljs-number">0</span>
<span class="hljs-operator">├──────────┤</span>
<span class="hljs-operator">│</span> resize() <span class="hljs-operator">│</span> <span class="hljs-operator">←</span> 索引 <span class="hljs-number">1</span>
<span class="hljs-operator">└──────────┘</span>
</code></pre>
<h3 data-id="heading-10"><strong>2.3 Swift 类的虚函数表</strong></h3>
<pre><code class="hljs language-scss" lang="scss">对象实例内存布局：
┌───────────────────┐
│    对象头 (<span class="hljs-number">16</span>字节)  │ ← 包含指向类对象的指针
├───────────────────┤
│  引用计数 (<span class="hljs-number">8</span>字节)   │
├───────────────────┤
│  属性 name (<span class="hljs-number">8</span>字节) │
├───────────────────┤
│  属性 age (<span class="hljs-number">8</span>字节)  │
└───────────────────┘

类对象内存布局：
┌───────────────────┐
│   类信息 (元数据)   │
├───────────────────┤
│  虚函数表指针      │ → 指向虚函数表数组
├───────────────────┤
│  其他元数据...     │
└───────────────────┘

虚函数表结构：
┌───────────────────┐
│    <span class="hljs-built_in">makeSound</span>()    │ ← 函数指针 <span class="hljs-selector-attr">[0]</span>
├───────────────────┤
│       <span class="hljs-built_in">eat</span>()       │ ← 函数指针 <span class="hljs-selector-attr">[1]</span>
├───────────────────┤
│      <span class="hljs-built_in">sleep</span>()      │ ← 函数指针 <span class="hljs-selector-attr">[2]</span>
└───────────────────┘
</code></pre>
<p><strong>虚函数表（V-Table）工作原理：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">Dog 类的虚函数表（编译时根据顺序确定索引）：
[<span class="hljs-symbol">0</span>]: <span class="hljs-link">Dog.makeSound() 地址</span>
[<span class="hljs-symbol">1</span>]: <span class="hljs-link">Dog.otherMethod() 地址</span>
...

调用 animal.makeSound()：
<span class="hljs-bullet">1.</span> 获取 animal 的虚函数表指针
<span class="hljs-bullet">2.</span> 根据索引得到 makeSound 在表中的地址（编译时确定）
<span class="hljs-bullet">3.</span> 跳转到对应地址执行
</code></pre>
<h3 data-id="heading-11"><strong>2.4 Swift 类方法的派发</strong></h3>
<p>类元数据结构：</p>
<pre><code class="hljs language-css" lang="css">┌─────────────────────┐
│    类型描述符        │ ← Metadata <span class="hljs-selector-tag">header</span>
├─────────────────────┤
│    父类指针          │
├─────────────────────┤
│    实例变量偏移      │
├─────────────────────┤
│  ↓ 实例方法表指针    │ → 指向实例方法的虚函数表
├─────────────────────┤
│  ↓ 类方法表指针      │ → 指向类方法的独立表
├─────────────────────┤
│    协议列表指针      │
├─────────────────────┤
│    泛型信息...       │
└─────────────────────┘

实例方法表（虚函数表）：
┌─────────────────────┐
│    instanceMethod1   │ ← 索引 <span class="hljs-number">0</span>
├─────────────────────┤
│    instanceMethod2   │ ← 索引 <span class="hljs-number">1</span>
└─────────────────────┘

类方法表：
┌─────────────────────┐
│     classMethod1     │ ← 索引 <span class="hljs-number">0</span>  
├─────────────────────┤
│     classMethod2     │ ← 索引 <span class="hljs-number">1</span>
└─────────────────────┘
</code></pre>
<p>派发方式</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    
    <span class="hljs-comment">// 默认的表派发类方法</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">func</span> <span class="hljs-title class_">classMethod</span>() {  <span class="hljs-comment">// 通过类的元数据进行派发</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"类方法 - 表派发"</span>)
    }
    
    <span class="hljs-comment">// 直接派发，不能被重写</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">staticMethod</span>() {  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"静态方法 - 直接派发"</span>)
    }
    
    <span class="hljs-comment">// final class func 等价于 static func</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">func</span> <span class="hljs-title class_">alsoCannotOverride</span>() { }
    
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">func</span> <span class="hljs-title class_">dynamicClassMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"类方法 - 消息派发"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {
    <span class="hljs-comment">// 存储在全局数据段</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> appName <span class="hljs-operator">=</span> <span class="hljs-string">"MyApp"</span>        <span class="hljs-comment">// __TEXT 段（只读）</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> launchCount <span class="hljs-operator">=</span> <span class="hljs-number">0</span>          <span class="hljs-comment">// __DATA 段（读写）</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">AppConfig</span>()     <span class="hljs-comment">// 引用存储在全局，对象在堆上</span>
    
    <span class="hljs-comment">// 惰性静态属性</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">var</span> heavyResource <span class="hljs-operator">=</span> createHeavyResource()
}

<span class="hljs-comment">/*
内存位置：
- appName: 编译时常量 → 代码段
- launchCount: 全局变量 → 数据段  
- shared: 引用在数据段，对象在堆上
- heavyResource: 第一次访问时初始化
*/</span>
</code></pre>
<h2 data-id="heading-12">Part 3: 混合派发的危险实验</h2>
<h3 data-id="heading-13">3.1 当 Swift 遇到 Swizzling</h3>
<p>让我们看一个更完整的例子：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MixedClass</span> {
    <span class="hljs-comment">// 情况1：纯 Swift</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">swiftMethod</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Swift Method"</span>) }
    
    <span class="hljs-comment">// 情况2：暴露给 OC，但 Swift 内使用表派发</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">exposedMethod</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Exposed Method"</span>) }
    
    <span class="hljs-comment">// 情况3：完全动态</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">dynamicMethod</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Dynamic Method"</span>) }
}

<span class="hljs-comment">// 尝试 Swizzle</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">MixedClass</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzled_swiftMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Swizzled Swift"</span>)
        swizzled_swiftMethod()
    }
    
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzled_exposedMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Swizzled Exposed"</span>)
        swizzled_exposedMethod()
    }
    
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzled_dynamicMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Swizzled Dynamic"</span>)
        swizzled_dynamicMethod()
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">testAll</span>() {
        <span class="hljs-keyword">let</span> instance <span class="hljs-operator">=</span> <span class="hljs-type">MixedClass</span>()
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 原始调用 ==="</span>)
        instance.swiftMethod()      <span class="hljs-comment">// Swift Method</span>
        instance.exposedMethod()    <span class="hljs-comment">// Exposed Method</span>
        instance.dynamicMethod()    <span class="hljs-comment">// Dynamic Method</span>
        
        <span class="hljs-comment">// 尝试 Swizzle swiftMethod（缺少 dynamic）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> orig <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">#selector</span>(swiftMethod)),
           <span class="hljs-keyword">let</span> swiz <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">#selector</span>(swizzled_swiftMethod)) {
            method_exchangeImplementations(orig, swiz)
        }
        
        <span class="hljs-comment">// 尝试 Swizzle exposedMethod（只有 @objc）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> orig <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">#selector</span>(exposedMethod)),
           <span class="hljs-keyword">let</span> swiz <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">#selector</span>(swizzled_exposedMethod)) {
            method_exchangeImplementations(orig, swiz)
        }
        
        <span class="hljs-comment">// Swizzle dynamicMethod（正确方式）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> orig <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">#selector</span>(dynamicMethod)),
           <span class="hljs-keyword">let</span> swiz <span class="hljs-operator">=</span> class_getInstanceMethod(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">#selector</span>(swizzled_dynamicMethod)) {
            method_exchangeImplementations(orig, swiz)
        }
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\n</span>=== Swizzle 后调用 ==="</span>)
        instance.swiftMethod()      <span class="hljs-comment">// 还是 Swift Method ❌</span>
        instance.exposedMethod()    <span class="hljs-comment">// 还是 Exposed Method ❌  </span>
        instance.dynamicMethod()    <span class="hljs-comment">// Swizzled Dynamic ✅</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\n</span>=== 通过 OC 运行时调用 ==="</span>)
        <span class="hljs-comment">// 通过 performSelector 调用</span>
        instance.perform(<span class="hljs-keyword">#selector</span>(swiftMethod))      <span class="hljs-comment">// 可能崩溃 💥</span>
        instance.perform(<span class="hljs-keyword">#selector</span>(exposedMethod))    <span class="hljs-comment">// Swizzled Exposed ✅</span>
        instance.perform(<span class="hljs-keyword">#selector</span>(dynamicMethod))    <span class="hljs-comment">// Swizzled Dynamic ✅</span>
    }
}
</code></pre>
<h3 data-id="heading-14">3.2 为什么会这样？</h3>
<p><strong>内存布局解释：</strong></p>
<p>当 Swift 编译一个类时：</p>
<ul>
<li>纯 Swift 方法 → 放入虚函数表</li>
<li><code>@objc</code> 方法 → 生成桥接方法，同时放入虚函数表和 OC 方法列表（在Swift中调用未交换，OC中调用时已交换）</li>
<li><code>@objc dynamic</code> 方法 → 直接放入 OC 方法列表</li>
</ul>
<p>Swizzling 只影响 OC 方法列表，不影响虚函数表！</p>
<h2 data-id="heading-15">Part 4: 属性的 <code>@objc dynamic</code></h2>
<h3 data-id="heading-16">4.1 Swift中使用KVO</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Observable</span>: <span class="hljs-title class_">NSObject</span> {
    <span class="hljs-comment">// 普通属性，不支持 KVO</span>
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>
    
    <span class="hljs-comment">// @objc dynamic 属性，支持 KVO</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">var</span> age: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 只有 @objc，不支持 KVO</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">var</span> height: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>
}

<span class="hljs-keyword">let</span> obj <span class="hljs-operator">=</span> <span class="hljs-type">Observable</span>()

<span class="hljs-comment">// 尝试观察</span>
<span class="hljs-comment">// 运行时错误**Fatal error: Could not extract a String from KeyPath Swift.ReferenceWritableKeyPath&lt;XXX.Observable, Swift.String&gt;**</span>
obj.observe(\.name, options: .new) { <span class="hljs-keyword">_</span>, change <span class="hljs-keyword">in</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"name changed: <span class="hljs-subst">\(change.newValue <span class="hljs-operator">??</span> <span class="hljs-string">"nil"</span>)</span>"</span>)
}  

obj.observe(\.age, options: .new) { <span class="hljs-keyword">_</span>, change <span class="hljs-keyword">in</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"age changed: <span class="hljs-subst">\(change.newValue <span class="hljs-operator">??</span> <span class="hljs-number">0</span>)</span>"</span>)
}  <span class="hljs-comment">// ✅ 正常工作</span>

obj.observe(\.height, options: .new) { <span class="hljs-keyword">_</span>, change <span class="hljs-keyword">in</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"height changed: <span class="hljs-subst">\(change.newValue <span class="hljs-operator">??</span> <span class="hljs-number">0</span>)</span>"</span>)
}  <span class="hljs-comment">// 无法观察到变化</span>
</code></pre>
<h3 data-id="heading-17">4.2 属性访问的派发方式</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertyTest</span> {
    <span class="hljs-comment">// 直接派发（编译时展开），会被内联</span>
    <span class="hljs-keyword">var</span> directProperty: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _storage }
        <span class="hljs-keyword">set</span> { _storage <span class="hljs-operator">=</span> newValue }
    }
    
    <span class="hljs-comment">// 表派发（通过方法）</span>
    <span class="hljs-keyword">var</span> tableProperty: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"getter 调用"</span>)
            <span class="hljs-keyword">return</span> _storage
        }
        <span class="hljs-keyword">set</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"setter 调用"</span>)
            _storage <span class="hljs-operator">=</span> newValue
        }
    }
    
    <span class="hljs-comment">// 消息派发（支持 KVO）</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">var</span> messageProperty: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _storage }
        <span class="hljs-keyword">set</span> { _storage <span class="hljs-operator">=</span> newValue }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _storage: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
}

<span class="hljs-comment">// @objc dynamic 属性会生成：</span>
<span class="hljs-comment">// - (NSInteger)messageProperty;</span>
<span class="hljs-comment">// - (void)setMessageProperty:(NSInteger)value;</span>
<span class="hljs-comment">// 这些是真正的 Objective-C 方法</span>
</code></pre>
<h3 data-id="heading-18">4.3 属性观察器的有趣现象</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Observed</span>: <span class="hljs-title class_">NSObject</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">var</span> value: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> {
        <span class="hljs-keyword">didSet</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"value 从 <span class="hljs-subst">\(oldValue)</span> 变为 <span class="hljs-subst">\(value)</span>"</span>)
        }
    }
    
    <span class="hljs-comment">// 测试 KVO 和 didSet 的交互</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">test</span>() {
        <span class="hljs-keyword">self</span>.value <span class="hljs-operator">=</span> <span class="hljs-number">10</span>  <span class="hljs-comment">// 触发 didSet</span>
        
        <span class="hljs-comment">// 通过 KVC 设置</span>
        <span class="hljs-keyword">self</span>.setValue(<span class="hljs-number">20</span>, forKey: <span class="hljs-string">"value"</span>)  <span class="hljs-comment">// 也会触发 didSet ✅</span>
    }
}

<span class="hljs-comment">// 为什么能工作？</span>
<span class="hljs-comment">// @objc dynamic 属性生成的 setter 会：</span>
<span class="hljs-comment">// 1. 调用 willChangeValueForKey</span>
<span class="hljs-comment">// 2. 设置新值</span>
<span class="hljs-comment">// 3. 调用 didSet（Swift 注入的代码）</span>
<span class="hljs-comment">// 4. 调用 didChangeValueForKey（触发 KVO）</span>
</code></pre>
<h2 data-id="heading-19">Part 5: 派发方式的确定规则</h2>
<h3 data-id="heading-20">5.1 决策树</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// Swift 编译器决定派发方式的逻辑：</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">determineDispatch</span>(<span class="hljs-params">for</span> <span class="hljs-params">method</span>: <span class="hljs-type">Method</span>) -&gt; <span class="hljs-type">DispatchType</span> {
    <span class="hljs-keyword">if</span> method.isFinal <span class="hljs-operator">||</span> type.isFinal <span class="hljs-operator">||</span> type.isStruct {
        <span class="hljs-keyword">return</span> .direct      <span class="hljs-comment">// 1. final 或 struct → 直接派发</span>
    }
    
    <span class="hljs-keyword">if</span> method.isDynamic {
        <span class="hljs-keyword">return</span> .message     <span class="hljs-comment">// 2. dynamic → 消息派发</span>
    }
    
    <span class="hljs-keyword">if</span> method.isObjC {
        <span class="hljs-comment">// @objc 但不 dynamic：桥接方法</span>
        <span class="hljs-keyword">return</span> .table       <span class="hljs-comment">// 3. 在 Swift 内使用表派发</span>
    }
    
    <span class="hljs-keyword">if</span> method.isInExtension <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-operator">!</span>type.isObjCClass {
        <span class="hljs-keyword">return</span> .direct      <span class="hljs-comment">// 4. 非 OC 类的扩展 → 直接派发</span>
    }
    
    <span class="hljs-keyword">return</span> .table           <span class="hljs-comment">// 5. 默认 → 表派发</span>
}
</code></pre>
<h3 data-id="heading-21">5.2 特殊情况</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 协议要求</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">MyProtocol</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">requiredMethod</span>()   <span class="hljs-comment">// 表派发（通过协议见证表）</span>
}

<span class="hljs-comment">// 2. 泛型约束</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">genericFunc</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">MyProtocol</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">obj</span>: <span class="hljs-type">T</span>) {
    obj.requiredMethod()    <span class="hljs-comment">// 静态派发（编译时特化）</span>
}

<span class="hljs-comment">// 3. @_dynamicReplacement</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Replaceable</span> {
    <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">original</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Original"</span>) }
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Replaceable</span> {
    <span class="hljs-meta">@_dynamicReplacement</span>(for: original)
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">replacement</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Replacement"</span>) }
}
<span class="hljs-comment">// Swift 5 引入的官方 "Swizzling"</span>
</code></pre>
<h2 data-id="heading-22">Part 6: 性能影响与优化</h2>
<p>优化建议</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// ❌ 避免在性能关键路径使用 dynamic</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">var</span> data: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] <span class="hljs-operator">=</span> [:]  <span class="hljs-comment">// 每次访问都有消息派发开销</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">expensiveOperation</span>() {
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-number">10000</span> {
            <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> data[<span class="hljs-string">"key"</span>]  <span class="hljs-comment">// 慢！</span>
        }
    }
}

<span class="hljs-comment">// ✅ 优化方案</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _data: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] <span class="hljs-operator">=</span> [:]
    
    <span class="hljs-keyword">var</span> data: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _data }
        <span class="hljs-keyword">set</span> { _data <span class="hljs-operator">=</span> newValue }
    }
    
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">var</span> observableData: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _data }
        <span class="hljs-keyword">set</span> { _data <span class="hljs-operator">=</span> newValue }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">expensiveOperation</span>() {
        <span class="hljs-keyword">let</span> localData <span class="hljs-operator">=</span> data  <span class="hljs-comment">// 一次读取</span>
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-number">10000</span> {
            <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> localData[<span class="hljs-string">"key"</span>]  <span class="hljs-comment">// 快！</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-23">Part 7: 实际应用指南</h2>
<h3 data-id="heading-24">7.1 何时使用何种派发？</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 指南：</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-comment">// ✅ 使用直接派发：</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">utilityMethod</span>() { }  <span class="hljs-comment">// 工具方法，不重写</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">helper</span>() { }       <span class="hljs-comment">// 私有方法</span>
    
    <span class="hljs-comment">// ✅ 使用表派发（默认）：</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">businessLogic</span>() { }        <span class="hljs-comment">// 业务逻辑，可能被重写</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">publicAPI</span>() { }       <span class="hljs-comment">// 公开 API</span>
    
    <span class="hljs-comment">// ⚠️ 谨慎使用消息派发：</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">kvoProperty</span>() { }  <span class="hljs-comment">// 需要 KVO</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzleMe</span>() { }    <span class="hljs-comment">// 需要 Method Swizzling</span>
    
    <span class="hljs-comment">// ❌ 避免混用：</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">confusingMethod</span>() { }  <span class="hljs-comment">// 既不是鱼也不是熊掌</span>
    <span class="hljs-comment">// 在 Swift 中是表派发，在 OC 中是消息派发</span>
    <span class="hljs-comment">// 可能导致不一致的行为</span>
}
</code></pre>
<h3 data-id="heading-25">7.2 安全 Swizzling 的最佳实践</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeSwizzler</span> {
    <span class="hljs-comment">/// 安全的 Method Swizzling</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swizzle</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">type</span>: <span class="hljs-type">AnyClass</span>,
                       <span class="hljs-params">original</span>: <span class="hljs-type">Selector</span>,
                       <span class="hljs-params">swizzled</span>: <span class="hljs-type">Selector</span>,
                       <span class="hljs-params">isClassMethod</span>: <span class="hljs-type">Bool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>) <span class="hljs-keyword">throws</span> {
        
        <span class="hljs-comment">// 1. 获取方法</span>
        <span class="hljs-keyword">let</span> getMethod <span class="hljs-operator">=</span> isClassMethod <span class="hljs-operator">?</span> class_getClassMethod : class_getInstanceMethod
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> originalMethod <span class="hljs-operator">=</span> getMethod(type, original),
              <span class="hljs-keyword">let</span> swizzledMethod <span class="hljs-operator">=</span> getMethod(type, swizzled) <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-type">SwizzleError</span>.methodNotFound
        }
        
        <span class="hljs-comment">// 2. 检查是否已经是消息派发</span>
        <span class="hljs-keyword">let</span> originalEncoding <span class="hljs-operator">=</span> method_getTypeEncoding(originalMethod)
        <span class="hljs-keyword">if</span> originalEncoding <span class="hljs-operator">==</span> <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-type">SwizzleError</span>.notMessageDispatch
        }
        
        <span class="hljs-comment">// 3. 检查是否已经 Swizzled</span>
        <span class="hljs-keyword">if</span> alreadySwizzled {
            <span class="hljs-keyword">throw</span> <span class="hljs-type">SwizzleError</span>.alreadySwizzled
        }
        
        <span class="hljs-comment">// 4. 执行交换</span>
        method_exchangeImplementations(originalMethod, swizzledMethod)
    }
    
    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SwizzleError</span>: <span class="hljs-title class_">Error</span> {
        <span class="hljs-keyword">case</span> methodNotFound
        <span class="hljs-keyword">case</span> notMessageDispatch
        <span class="hljs-keyword">case</span> alreadySwizzled
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">safe_viewDidLoad</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Safe tracking"</span>)
        safe_viewDidLoad()
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">enableSafeTracking</span>() {
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">try</span> <span class="hljs-type">SafeSwizzler</span>.swizzle(
                <span class="hljs-type">UIViewController</span>.<span class="hljs-keyword">self</span>,
                original: <span class="hljs-keyword">#selector</span>(viewDidLoad),
                swizzled: <span class="hljs-keyword">#selector</span>(safe_viewDidLoad)
            )
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ Safe swizzling 成功"</span>)
        } <span class="hljs-keyword">catch</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"❌ Swizzling 失败: <span class="hljs-subst">\(error)</span>"</span>)
        }
    }
}
</code></pre>
<h2 data-id="heading-26">总结</h2>
<h3 data-id="heading-27">关键要点</h3>
<ol>
<li>
<p><strong>Swift 有三种派发方式</strong>：</p>
<ul>
<li>直接派发：最快，用于 <code>final</code>、结构体等</li>
<li>表派发：默认，通过虚函数表</li>
<li>消息派发：最慢，但支持运行时特性</li>
</ul>
</li>
<li>
<p><strong><code>@objc</code> vs <code>dynamic</code></strong>：</p>
<ul>
<li><code>@objc</code>：让 Swift 方法对 OC 可见，但 Swift 内仍用表派发</li>
<li><code>dynamic</code>：强制使用消息派发</li>
<li><code>@objc dynamic</code>：OC 可见 + 消息派发</li>
</ul>
</li>
<li>
<p><strong>Swizzling 的真相</strong>：</p>
<ul>
<li>只能交换消息派发的方法</li>
<li>交换表派发方法会导致 Swift 和 OC 行为不一致</li>
<li>这是很多 Swizzling bug 的根源</li>
</ul>
</li>
<li>
<p><strong>性能影响</strong>：</p>
<ul>
<li>消息派发比直接派发慢 4-5 倍</li>
<li>避免在性能关键路径使用 <code>dynamic</code></li>
<li>合理使用 <code>final</code> 优化性能</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">哲学思考</h3>
<p>Swift 的派发机制体现了语言设计的平衡艺术：</p>
<ul>
<li><strong>安全 vs 灵活</strong>：表派发保证安全，消息派发提供灵活</li>
<li><strong>性能 vs 功能</strong>：直接派发优化性能，动态派发启用高级功能</li>
<li><strong>Swift vs Objective-C</strong>：两种运行时模型的巧妙融合</li>
</ul>
<p>理解这些机制，你就能：</p>
<ul>
<li>写出更高效的 Swift 代码</li>
<li>安全地使用运行时特性</li>
<li>避免诡异的 Swizzling bug</li>
<li>更好地理解 Swift 的设计哲学</li>
</ul>
<p>记住：<strong>强大的能力伴随着巨大的责任</strong>。动态派发给了你 hook 系统方法的能力，但也可能带来难以调试的问题。使用时务必谨慎！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2024年JavaScript开发者必备的10个ES13新特性实战指南]]></title>    <link>https://juejin.cn/post/7593262196844855348</link>    <guid>https://juejin.cn/post/7593262196844855348</guid>    <pubDate>2026-01-11T00:16:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593262196844855348" data-draft-id="7593262196844838964" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2024年JavaScript开发者必备的10个ES13新特性实战指南"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-11T00:16:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2024年JavaScript开发者必备的10个ES13新特性实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-11T00:16:52.000Z" title="Sun Jan 11 2026 00:16:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>2024年JavaScript开发者必备的10个ES13新特性实战指南</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>JavaScript作为前端开发的基石语言，每年都会通过ECMAScript标准引入新特性。ES13（ECMAScript 2022）虽然已经发布了一段时间，但其中的许多特性在2024年仍然是现代JavaScript开发者的必备技能。本文将深入探讨ES13中最具价值的10个新特性，并结合实际代码示例展示如何在项目中高效应用这些功能。无论你是资深开发者还是刚刚入门，掌握这些特性都将显著提升你的开发效率和代码质量。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. Top-Level Await</h3>
<p>ES13正式支持了顶级<code>await</code>，允许开发者在模块的顶层直接使用<code>await</code>关键字，而无需包裹在<code>async</code>函数中。这对于模块初始化、动态导入和配置加载非常有用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ES13之前</span>
(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
})();

<span class="hljs-comment">// ES13之后</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
</code></pre>
<p><strong>实战场景</strong>：</p>
<ul>
<li>动态加载配置或依赖项。</li>
<li>简化模块初始化逻辑。</li>
</ul>
<hr/>
<h3 data-id="heading-4">2. Error Cause</h3>
<p>ES13为<code>Error</code>对象新增了<code>cause</code>属性，允许开发者传递错误的根本原因。这在调试链式错误时尤其有用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Root error'</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'High-level error'</span>, { <span class="hljs-attr">cause</span>: err });
  }
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">message</span>); <span class="hljs-comment">// "High-level error"</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">cause</span>);   <span class="hljs-comment">// Error: Root error</span>
}
</code></pre>
<p><strong>实战场景</strong>：</p>
<ul>
<li>嵌套错误的追踪和调试。</li>
<li>API调用失败时的详细错误信息传递。</li>
</ul>
<hr/>
<h3 data-id="heading-5">3. Array.prototype.at()</h3>
<p><code>at()</code>方法允许开发者通过索引（支持负数）访问数组元素，解决了传统方括号语法无法直接访问负索引的问题。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>)); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">at</span>(-<span class="hljs-number">2</span>)); <span class="hljs-comment">// 2</span>
</code></pre>
<p><strong>实战场景</strong>：</p>
<ul>
<li>简化数组末尾元素的访问逻辑。</li>
<li>替代冗长的<code>arr[arr.length - N]</code>写法。</li>
</ul>
<hr/>
<h3 data-id="heading-6">4. Object.hasOwn()</h3>
<p><code>Object.hasOwn()</code>是<code>Object.prototype.hasOwnProperty()</code>的更安全替代方案，避免了原型链污染问题。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">hasOwn</span>(obj, <span class="hljs-string">'foo'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">hasOwn</span>(obj, <span class="hljs-string">'toString'</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>实战场景</strong>：</p>
<ul>
<li>检查对象是否拥有某个属性（不继承自原型链）。</li>
<li><code>null</code>或未定义对象的兼容性处理（不会抛出错误）。</li>
</ul>
<hr/>
<h3 data-id="heading-7">5. Class Static Initialization Blocks</h3>
<p>ES13引入了类的静态初始化块（Static Initialization Blocks），允许开发者在类定义时执行复杂的静态属性初始化逻辑。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
 <span class="hljs-keyword">static</span> host;
 <span class="hljs-keyword">static</span> port;

 <span class="hljs-keyword">static</span> {
   <span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">HOST</span> || <span class="hljs-string">'localhost'</span>;
   <span class="hljs-variable language_">this</span>.<span class="hljs-property">port</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-string">'8080'</span>;
 }
}
</code></pre>
<p><strong>实战场景</strong>：</p>
<ul>
<li><strong>环境变量配置的动态加载</strong></li>
<li><strong>静态属性的复杂计算</strong></li>
</ul>
<hr/>
<h3 data-id="heading-8">#6. Private Slot Checks with <code>in</code></h3>
<p>ES13扩展了私有字段的支持，允许使用 <code>in</code>运算符检查对象是否拥有某个私有字段：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> { 
 #name; 

 <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) { 
 <span class="hljs-variable language_">this</span>.#name = name; 
 } 

 <span class="hljs-keyword">static</span> <span class="hljs-title function_">checkName</span>(<span class="hljs-params">obj</span>) { 
 <span class="hljs-keyword">return</span> #name <span class="hljs-keyword">in</span> obj; 
 } 
} 

<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">'John'</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">User</span>.<span class="hljs-title function_">checkName</span>(user)); <span class="hljs-comment">// true</span>

</code></pre>
<p><strong>优势</strong>
•更安全的私有字段检查机制 •避免try-catch实现方式</p>
<hr/>
<h3 data-id="heading-9">#7.RegExp Match Indices</h3>
<p>通过正则表达式的d标志获取匹配项的起始和结束索引：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> regexp = <span class="hljs-regexp">/test/</span>d; 
<span class="hljs-keyword">const</span> result = regexp.<span class="hljs-title function_">exec</span>(<span class="hljs-string">"test"</span>); 

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">indices</span>[<span class="hljs-number">0</span>]); <span class="hljs-comment">// [0,4]</span>

</code></pre>
<p><strong>应用场景</strong>
•高级文本编辑器功能 •语法高亮实现</p>
<hr/>
<h3 data-id="heading-10">#8.AggregateError</h3>
<p>组合多个错误为一个聚合错误：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">any</span>([ 
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Error1"</span>)), 
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Error2"</span>)) 
]).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { 

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">AggregateError</span>); <span class="hljs-comment">// true </span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">errors</span>); <span class="hljs-comment">// [Error1, Error2] });</span>

</code></pre>
<p><strong>典型用例</strong>
•批量操作错误收集 •Promise组合操作的统一错误处理</p>
<hr/>
<p>####9.Atomics.waitAsync</p>
<p>非阻塞版本的Atomics.wait：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> sharedArray= <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedArrayBuffer</span>(<span class="hljs-number">1024</span>); 

<span class="hljs-title class_">Atomics</span>.<span class="hljs-title function_">waitAsync</span>(sharedArray,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{ <span class="hljs-comment">/*回调*/</span> });

</code></pre>
<p><strong>性能优势</strong>
•不阻塞主线程 •更适合异步编程模型</p>
<hr/>
<p>####10.WeakRefs与FinalizationRegistry增强</p>
<p>改进的内存管理API：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> registry= <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizationRegistry</span>(<span class="hljs-function"><span class="hljs-params">value</span>=&gt;</span>{ <span class="hljs-comment">/*清理回调*/</span> }); registry.<span class="hljs-title function_">register</span>(target,<span class="hljs-string">"some value"</span>);

</code></pre>
<p><strong>最佳实践</strong>
•缓存系统实现 •资源释放监听</p>
<hr/>
<p>##总结</p>
<p>ES2022的这些创新特性标志着JavaScript语言的持续成熟。
从Top-Level Await到Private Slot Checks，
每一项改进都针对实际开发痛点。
建议开发者：
1．在生产环境中逐步尝试这些特性，
2．关注浏览器/Node.js的兼容性支持，
3．优先解决团队最迫切的需求点。
要记住，
掌握这些新技术的关键不在于简单的语法记忆，
而是理解其设计哲学和应用边界。
随着JavaScript生态系统的不断演进，
保持对新特性的敏感度将成为区分优秀开发者的重要标准。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（35）什么是Hibernate的聚合函数？]]></title>    <link>https://juejin.cn/post/7593241698370764836</link>    <guid>https://juejin.cn/post/7593241698370764836</guid>    <pubDate>2026-01-11T00:27:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593241698370764836" data-draft-id="7593232758128132102" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（35）什么是Hibernate的聚合函数？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-11T00:27:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（35）什么是Hibernate的聚合函数？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-11T00:27:32.000Z" title="Sun Jan 11 2026 00:27:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的聚合函数</h3>
<p>在Hibernate中，聚合函数（Aggregate Functions）用于对一组值进行计算并返回单一值。这些函数在执行统计分析、数据汇总和报告时非常有用。常见的聚合函数包括：</p>
<ul>
<li><code>count</code>：计数</li>
<li><code>avg</code>：平均值</li>
<li><code>sum</code>：求和</li>
<li><code>min</code>：最小值</li>
<li><code>max</code>：最大值</li>
</ul>
<p>Hibernate支持在Criteria API和HQL（Hibernate Query Language）中使用聚合函数。</p>
<h3 data-id="heading-1">使用聚合函数的示例代码</h3>
<h4 data-id="heading-2">实体类定义</h4>
<p>我们继续使用之前定义的<code>Person</code>和<code>Address</code>实体类。</p>
<h5 data-id="heading-3">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-4">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-7">使用聚合函数的示例</h3>
<h4 data-id="heading-8">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">35</span>);

            session.save(person1);
            session.save(person2);
            session.save(person3);

            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Main St"</span>, person1);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Oak St"</span>, person2);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"789 Pine St"</span>, person3);

            session.save(address1);
            session.save(address2);
            session.save(address3);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">使用聚合函数查询</h4>
<h5 data-id="heading-10">查询Person的平均年龄</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaBuilder;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateAggregateQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用聚合函数查询Person的平均年龄</span>
        queryAverageAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAverageAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            CriteriaQuery&lt;Double&gt; criteriaQuery = criteriaBuilder.createQuery(Double.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            criteriaQuery.select(criteriaBuilder.avg(root.get(<span class="hljs-string">"age"</span>)));

            <span class="hljs-type">Double</span> <span class="hljs-variable">averageAge</span> <span class="hljs-operator">=</span> session.createQuery(criteriaQuery).getSingleResult();
            System.out.println(<span class="hljs-string">"Average age of persons: "</span> + averageAge);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-11">查询Person的总数</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaBuilder;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCountQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用聚合函数查询Person的总数</span>
        queryPersonCount(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonCount</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            CriteriaQuery&lt;Long&gt; criteriaQuery = criteriaBuilder.createQuery(Long.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            criteriaQuery.select(criteriaBuilder.count(root));

            <span class="hljs-type">Long</span> <span class="hljs-variable">personCount</span> <span class="hljs-operator">=</span> session.createQuery(criteriaQuery).getSingleResult();
            System.out.println(<span class="hljs-string">"Total number of persons: "</span> + personCount);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-12">查询年龄最小和最大的Person</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaBuilder;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateMinMaxQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用聚合函数查询年龄最小和最大的Person</span>
        queryMinMaxAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryMinMaxAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();

            <span class="hljs-comment">// 查询最小年龄</span>
            CriteriaQuery&lt;Integer&gt; minCriteriaQuery = criteriaBuilder.createQuery(Integer.class);
            
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（36）Hibernate如何处理多对多关系？]]></title>    <link>https://juejin.cn/post/7593241698370781220</link>    <guid>https://juejin.cn/post/7593241698370781220</guid>    <pubDate>2026-01-11T00:28:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593241698370781220" data-draft-id="7593292445300539411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（36）Hibernate如何处理多对多关系？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-11T00:28:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（36）Hibernate如何处理多对多关系？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-11T00:28:13.000Z" title="Sun Jan 11 2026 00:28:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate中的多对多关系</h3>
<p>在Hibernate中，多对多关系指的是一个实体可以与多个另一个实体实例相关联，反之亦然。为了实现这种关系，通常需要一个中间表来存储两者之间的关联信息。</p>
<h3 data-id="heading-1">多对多关系的示例代码</h3>
<h4 data-id="heading-2">实体类定义</h4>
<p>假设我们有两个实体：<code>Student</code> 和 <code>Course</code>，一个学生可以选修多门课程，一门课程也可以有多个学生。</p>
<h4 data-id="heading-3">Student类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "student")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@ManyToMany(cascade = { CascadeType.ALL })</span>
    <span class="hljs-meta">@JoinTable(
        name = "student_course", 
        joinColumns = { @JoinColumn(name = "student_id") }, 
        inverseJoinColumns = { @JoinColumn(name = "course_id") }
    )</span>
    <span class="hljs-keyword">private</span> Set&lt;Course&gt; courses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Set&lt;Course&gt; <span class="hljs-title function_">getCourses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> courses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCourses</span><span class="hljs-params">(Set&lt;Course&gt; courses)</span> {
        <span class="hljs-built_in">this</span>.courses = courses;
    }
}
</code></pre>
<h4 data-id="heading-4">Course类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "course")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Course</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@ManyToMany(mappedBy = "courses")</span>
    <span class="hljs-keyword">private</span> Set&lt;Student&gt; students = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Course</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Course</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Set&lt;Student&gt; <span class="hljs-title function_">getStudents</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> students;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStudents</span><span class="hljs-params">(Set&lt;Student&gt; students)</span> {
        <span class="hljs-built_in">this</span>.students = students;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Course"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-7">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 创建学生</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>);
            <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"Jane Doe"</span>);

            <span class="hljs-comment">// 创建课程</span>
            <span class="hljs-type">Course</span> <span class="hljs-variable">course1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Course</span>(<span class="hljs-string">"Mathematics"</span>);
            <span class="hljs-type">Course</span> <span class="hljs-variable">course2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Course</span>(<span class="hljs-string">"History"</span>);

            <span class="hljs-comment">// 建立多对多关系</span>
            student1.getCourses().add(course1);
            student1.getCourses().add(course2);

            student2.getCourses().add(course1);
            student2.getCourses().add(course2);

            course1.getStudents().add(student1);
            course1.getStudents().add(student2);

            course2.getStudents().add(student1);
            course2.getStudents().add(student2);

            <span class="hljs-comment">// 保存数据</span>
            session.save(student1);
            session.save(student2);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-8">查询示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 查询示例数据</span>
        querySampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">querySampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 查询所有学生</span>
            List&lt;Student&gt; students = session.createQuery(<span class="hljs-string">"from Student"</span>, Student.class).list();
            <span class="hljs-keyword">for</span> (Student student : students) {
                System.out.println(<span class="hljs-string">"Student Name: "</span> + student.getName());
                <span class="hljs-keyword">for</span> (Course course : student.getCourses()) {
                    System.out.println(<span class="hljs-string">"  Enrolled in: "</span> + course.getName());
                }
            }

            <span class="hljs-comment">// 查询所有课程</span>
            List&lt;Course&gt; courses = session.createQuery(<span class="hljs-string">"from Course"</span>, Course.class).list();
            <span class="hljs-keyword">for</span> (Course course : courses) {
                System.out.println(<span class="hljs-string">"Course Name: "</span> + course.getName());
                <span class="hljs-keyword">for</span> (Student student : course.getStudents()) {
                    System.out.println(<span class="hljs-string">"  Student: "</span> + student.getName());
                }
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-9">多对多关系的详细解释</h3>
<ol>
<li>
<p><strong>实体类定义</strong>：</p>
<ul>
<li><code>Student</code> 类和 <code>Course</code> 类通过 <code>@ManyToMany</code> 注解来定义多对多的关系。</li>
<li><code>Student</code> 类中使用 <code>@JoinTable</code> 注解来定义中间表，指定了关联的学生和课程的外键。</li>
<li><code>Course</code> 类中使用 <code>mappedBy</code> 属性来指定关系维护由 <code>Student</code> 类中的 <code>courses</code> 属性来负责。</li>
</ul>
</li>
<li>
<p><strong>Hibernate配置文件</strong>：</p>
<ul>
<li>标准的Hibernate配置文件，用于数据库连接和映射类的配置。</li>
</ul>
</li>
<li>
<p><strong>HibernateUtil类</strong>：</p>
<ul>
<li>一个实用类，用来创建和返回 <code>SessionFactory</code> 实例。</li>
</ul>
</li>
<li>
<p><strong>插入示例数据</strong>：</p>
<ul>
<li>创建 <code>Student</code> 和 <code>Course</code> 对象，并建立多对多关系。</li>
<li>保存数据到数据库中。</li>
</ul>
</li>
<li>
<p><strong>查询示例数据</strong>：</p>
<ul>
<li>查询所有学生和他们所选修的课程，以及所有课程和选修这些课程的学生。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Incremark Solid 版本上线：Vue/React/Svelte/Solid 四大框架，统一体验]]></title>    <link>https://juejin.cn/post/7593232758128050182</link>    <guid>https://juejin.cn/post/7593232758128050182</guid>    <pubDate>2026-01-10T19:17:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593232758128050182" data-draft-id="7593232758128033798" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Incremark Solid 版本上线：Vue/React/Svelte/Solid 四大框架，统一体验"/> <meta itemprop="keywords" content="前端,JavaScript,人工智能"/> <meta itemprop="datePublished" content="2026-01-10T19:17:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="king王一帅"/> <meta itemprop="url" content="https://juejin.cn/user/395479917018408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Incremark Solid 版本上线：Vue/React/Svelte/Solid 四大框架，统一体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479917018408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    king王一帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T19:17:18.000Z" title="Sat Jan 10 2026 19:17:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Incremark 现已支持 Solid，至此完成了对 Vue、React、Svelte、Solid 四大主流前端框架的全面覆盖。</p>
<h2 data-id="heading-0">为什么要做框架无关</h2>
<p>市面上大多数 Markdown 渲染库都是针对特定框架开发的。这带来几个问题：</p>
<ol>
<li><strong>重复造轮子</strong>：每个框架社区都在独立实现相似的功能</li>
<li><strong>能力不一致</strong>：不同框架的实现质量参差不齐</li>
<li><strong>团队切换成本</strong>：换框架意味着重新学习新的 API</li>
</ol>
<p>Incremark 采用不同的思路：<strong>核心逻辑与 UI 框架完全解耦</strong>。</p>
<p><code>@incremark/core</code> 负责所有解析、转换、增量更新的工作，输出的是框架无关的数据结构。各框架包（<code>@incremark/vue</code>、<code>@incremark/react</code>、<code>@incremark/svelte</code>、<code>@incremark/solid</code>）只需要把这些数据渲染成对应框架的组件即可。</p>
<p>这意味着：</p>
<ul>
<li>核心能力一次实现，四个框架同时受益</li>
<li>Bug 修复和性能优化自动同步到所有框架</li>
<li>API 设计保持高度一致，切换框架几乎零学习成本</li>
</ul>
<h2 data-id="heading-1">包结构</h2>
<pre><code class="hljs language-less" lang="less">┌───────────────────────────────┐
│       <span class="hljs-variable">@incremark</span>/core         │
│                               │
│  增量解析 · 双引擎 · 插件系统  │
└───────────────┬───────────────┘
                │
                ▼
┌───────────────────────────────┐
│  <span class="hljs-variable">@incremark</span>/vue               │
│  <span class="hljs-variable">@incremark</span>/react             │
│  <span class="hljs-variable">@incremark</span>/svelte            │
│  <span class="hljs-variable">@incremark</span>/solid  ← NEW      │
└───────────────┬───────────────┘
                │
                ▼
┌───────────────────────────────┐
│       <span class="hljs-variable">@incremark</span>/theme        │
│                               │
│     样式 · 主题 · 代码高亮     │
└───────────────────────────────┘
</code></pre>
<h2 data-id="heading-2">增量解析</h2>
<p>传统 Markdown 渲染器在流式场景下存在性能问题：每次新内容到达都要重新解析整个文档，复杂度是 O(n²)。</p>
<p>Incremark 只处理新增内容，已解析的块不再重复处理，复杂度降至 O(n)。</p>
<h2 data-id="heading-3">四个框架的用法对比</h2>
<p>四个框架的组件 API 完全一致，只是语法风格不同：</p>
<p><strong>Vue</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { IncremarkContent } from '@incremark/vue'
// ...
&lt;/script&gt;

&lt;template&gt;
  &lt;IncremarkContent :content="content" :is-finished="isFinished" /&gt;
&lt;/template&gt;
</code></pre>
<p><strong>React</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">IncremarkContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@incremark/react'</span>
<span class="hljs-comment">// ...</span>

&lt;<span class="hljs-title class_">IncremarkContent</span> content={content} isFinished={isFinished} /&gt;
</code></pre>
<p><strong>Svelte</strong></p>
<pre><code class="hljs language-svelte" lang="svelte">&lt;script&gt;
import { IncremarkContent } from '@incremark/svelte'
// ...
&lt;/script&gt;

&lt;IncremarkContent content={content} isFinished={isFinished} /&gt;
</code></pre>
<p><strong>Solid</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">IncremarkContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@incremark/solid'</span>
<span class="hljs-comment">// ...</span>

&lt;<span class="hljs-title class_">IncremarkContent</span> content={<span class="hljs-title function_">content</span>()} isFinished={<span class="hljs-title function_">isFinished</span>()} /&gt;
</code></pre>
<p>可以看到，除了各框架本身的响应式语法差异（Vue 的 <code>ref</code>、React 的 <code>useState</code>、Svelte 的 <code>$state</code>、Solid 的 <code>createSignal</code>），组件的使用方式完全统一。</p>
<h2 data-id="heading-4">在线演示</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsolid.incremark.com%2F" target="_blank" title="https://solid.incremark.com/" ref="nofollow noopener noreferrer">Solid Demo</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvue.incremark.com%2F" target="_blank" title="https://vue.incremark.com/" ref="nofollow noopener noreferrer">Vue Demo</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.incremark.com%2F" target="_blank" title="https://react.incremark.com/" ref="nofollow noopener noreferrer">React Demo</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsvelte.incremark.com%2F" target="_blank" title="https://svelte.incremark.com/" ref="nofollow noopener noreferrer">Svelte Demo</a></li>
</ul>
<h2 data-id="heading-5">链接</h2>
<ul>
<li>npm: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40incremark%2Fcore" target="_blank" title="https://www.npmjs.com/package/@incremark/core" ref="nofollow noopener noreferrer">@incremark/core</a></li>
<li>文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.incremark.com" target="_blank" title="https://www.incremark.com" ref="nofollow noopener noreferrer">incremark.com</a></li>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fincremark" target="_blank" title="https://github.com/anthropics/incremark" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></li>
</ul>
<p>MIT 许可证。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[软件工程师应该关注的几种 UML 图]]></title>    <link>https://juejin.cn/post/7593528990846943283</link>    <guid>https://juejin.cn/post/7593528990846943283</guid>    <pubDate>2026-01-10T17:22:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593528990846943283" data-draft-id="7593337928308162586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="软件工程师应该关注的几种 UML 图"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-10T17:22:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uzong"/> <meta itemprop="url" content="https://juejin.cn/user/372082495985181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            软件工程师应该关注的几种 UML 图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/372082495985181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uzong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T17:22:08.000Z" title="Sat Jan 10 2026 17:22:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>UML 的真正价值在于：它并非一套僵化的规范，而是一种用于结构化思考与团队沟通的通用语言。掌握 UML 是软件设计的必备技能，也是高阶开发者的核心能力之一。</p>
<h2 data-id="heading-0">1. 类图 class diagram</h2>
<p>类图不同于 ER 图——后者用于描述关系型数据库中的实体及其关系，而类图则是面向对象开发的核心工具。一份设计良好的类图，几乎等同于系统的代码骨架。</p>
<h3 data-id="heading-1">1.1. 认识类图</h3>
<p>接口、类、实现关系、泛化关系、关联关系、依赖关系； 同时可以包含约束、注解 和 包等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6f9f5644cac4ef4b5544055fbaf2de4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=TwWXg8UkEu1cY2z7qmHxPVrQhBg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">1.1.1 类</h4>
<p><strong>类是面向对象系统中组织结构的核心，是对具有相同属性、行为、关系和语义对象的抽象。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa6c2fec85904c5391aeea8a661cff89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=9fFXJICoJNnu5y0mUwfLOwsOOEQ%3D" alt="" loading="lazy"/></p>
<p>包括名称（name）、属性(attribute)和操作(operation)。</p>
<h4 data-id="heading-3">1.1.2 接口</h4>
<p>接口是一种特殊的类，所有接口在 UML 中都带有 «interface» 构造型。</p>
<p>在 UML 中，接口使用一个带有名称的小圆圈来进行表示，并且可以通过一条Realize（实现关系）线与实现它的类相连接。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f3bddf8dd0e45fe86c34ddbb1f3f4f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=2GNouduLmpPco1%2Fm94V4QQZ9Trk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">1.2 类之间的关系</h3>
<ul>
<li>实现关系（realization ;接口实现）</li>
<li>泛化关系 (generalization)</li>
<li>依赖关系 (dependency)</li>
<li>关联关系（association; 特殊的聚合、组合）</li>
</ul>
<h4 data-id="heading-5">1.2.1. 依赖关系</h4>
<p>依赖表示一个模型元素（客户方）需要另一个模型元素（供应方）来达到某种目的，<strong>供应方的修改会影响客户方的执行结果</strong>。 依赖关系暗示着一个客户方如果没有供应方的支持是不完整的。例如，当给一个雇员计算工资的时候，需要使用计算器。UML中，依赖关系用一个从使用者指向提供者的虚箭头表示</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d64f40e437cd41f89e9e692aaeb68027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=7ZeQxlKsR4fGJk08mLeVNFwwerQ%3D" alt="" loading="lazy"/></p>
<p>提示：依赖关系应从语义层面理解——客户方依赖提供方以实现某项功能，若提供方发生变更，可能影响客户方的行为。</p>
<p>在 Java 中，方法的入参可视为该类对其的依赖。</p>
<h4 data-id="heading-6">1.2.2 泛化关系</h4>
<p>泛化（继承）关系用来描述类的一般和具体之间的关系——is a kind of。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bb9912c9ed4413aac6fcee968791c5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=oxeMH%2Fgs8gprdhjvT1ekmANoXvo%3D" alt="" loading="lazy"/></p>
<p>在 UML 中，使用一条带空心三角箭头的实线表示，箭头指向父类。</p>
<h4 data-id="heading-7">1.2.3 关联关系</h4>
<p>关联关系是一种结构关系，指出了一个事物的对象与另一个事物的对象之间的连接。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E7%25B1%25BB%25E5%259B%25BE%2F%25E5%2585%25B3%25E8%2581%2594%25E5%2585%25B3%25E7%25B3%25BB.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E7%B1%BB%E5%9B%BE/%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cec2598584743f29a93cb96451c8e70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=GPdPCWc6DH7M5ugACdRcW3NvpkU%3D" alt="" loading="lazy"/></p>
<p>导航性：若A指向B（导航性） 则B为A的成员变量</p>
<p>提示：关联关系中有1对n，也有1对1。如果带有箭头，则表明是一种单方向的。</p>
<h4 data-id="heading-8">1.2.4. 聚合(Aggregation)关系和组合关系（Composition）</h4>
<p>关联关系有两种非常重要的形式，分别是聚合（Aggregation）关系和组合（Composition）关系。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15b8601eedb9494abc46e7368e26b0c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=Kh0b9sSRTLfjS6DeLlwzPdZSbPs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E7%25B1%25BB%25E5%259B%25BE%2F%25E8%2581%259A%25E5%2590%2588%25E5%2592%258C%25E7%25BB%2584%25E5%2590%2588.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E7%B1%BB%E5%9B%BE/%E8%81%9A%E5%90%88%E5%92%8C%E7%BB%84%E5%90%88.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a></p>
<p>聚合和组合都是关联关系的一种特殊情况，如何区别他们，则需要从语义的角度去理解</p>
<ul>
<li>组合 composition：缺一不可。如果其中一个不存在，则整体也无法存在。</li>
</ul>
<p>例如，CPU 和主板是台式主机的核心组成部分，缺一不可。</p>
<ul>
<li>聚合 aggregation: 一个和一群的关系。一个缺少，并不会影响整体。例如大雁和雁群</li>
</ul>
<h4 data-id="heading-9">1.2.5. 实现关系</h4>
<p>大多数情况下，实现关系用来规定接口和实现接口的类或者组件之间的关系。</p>
<p>在 UML 中，实现关系的表示形式和泛化关系的表示符号很相似，使用一条带封闭空箭头的虚线来表示。实现关系还有一种省略的表示法：将接口表示为一个小圆圈并和实现它的类之间用一条线相连</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f964124bd4d942b8a31883db0c91c900~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=%2F96pUBXXGix0KZ0SgJPKfFNLL5E%3D" alt="" loading="lazy"/></p>
<p>提示：在不同的UML工具中，有不同的展现形式。</p>
<h3 data-id="heading-10">1.3. 综合的类图实例</h3>
<ol>
<li>接口使用 «interface» 进行标注，是对一组对象行为的抽象，<strong>不包含具体实现</strong>。例如接口飞翔，需要实现其飞的动作行为</li>
<li>类：抽象类，需要斜体。类包括：类名称、特性 和操作。</li>
<li>实现：大雁实现飞翔</li>
<li>依赖关系：如动物依赖氧气，水。 语义表示。</li>
<li>泛化（继承），鸟继承动物</li>
<li>聚合关系，大雁和雁群的关系。</li>
<li>组合关系： 鸟和翅膀</li>
<li>关联关系：企鹅和气候</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a92ba75d4964408c9591465285d0ef41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=JnvCbFRq1H71dQpLbgzNs8JYge8%3D" alt="" loading="lazy"/></p>
<p>面向对象设计的核心在于分析与抽象，UML 仅是辅助这一过程的可视化工具</p>
<h2 data-id="heading-11">2. <strong>用例图（Use Case Diagram）</strong></h2>
<p>用例描述了用户如何通过系统实现特定目标。用例图由系统边界、参与者（Actor）和用例（Use Case）三者构成，用于回答三个关键问题：</p>
<ul>
<li>系统是什么？</li>
<li>谁在使用系统？</li>
<li>用户希望通过系统完成什么？</li>
</ul>
<p><strong>用例图向用户展示了其捕获的系统、子系统、类或者组件的行为</strong>。简单而言，谁使用这个系统能做什么。</p>
<h3 data-id="heading-12">2.1. 认识用例图</h3>
<p>描述参与者与用例之间通信。可以以不同的视角展现系统的功能性需求。外部用户能够观察到的系统功能、对客户来讲，用例视图是他们业务领域的逻辑化表达；对于开发者，用例图是系统蓝图、开发依据。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c077a382c4c4bf6846f5b467dc1ad36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=mZpg7EvIZv8fv6WBRXGKRCYo7GA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">2.2. 认识元素</h3>
<h4 data-id="heading-14">2.2.1. 参与者/执行者（actor）</h4>
<p>执行者是系统、子系统或类发生交互作用的外部用户、进程或者其他系统理想化角色。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e685b16db6f4625ae3650beddbeef24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=Z7lCqVaAMyZSq23i2XajTmOipVc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">2.2.2. 用例</h4>
<p>用例是一个外部可见的系统内聚功能单元，功能单元由一种被称为主体(subject)的类所提供。用例的目的是在不揭示主体内部结构的情况下定义一个连贯行为。例如：产品维护。产品维护包括增删改查。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c8e5b60412348a2b9e5c4092b6d1834~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=9MEd7UNlWit9rO4VlFrzST%2Bq8ho%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">2.2.3. 关系</h4>
<p>用例图中涉及的关系有：关联、泛化、包含、扩展。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bfbfc82c12d485696652dc616b2e87a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=5tFwv9E%2B6JD9TRABmVSn8s%2FgJtM%3D" alt="" loading="lazy"/></p>
<p>包含：一个用例包含其他用例、并把它作为自身的片段、这被称为包含关系。</p>
<p>扩展：一个用例可以被定义为基用例的增量扩展、这叫做扩展关系。扩展关系箭头指向被扩展的用例。</p>
<p>泛化：一个用例可以被细化分为一个或多个子用例。任何子用例都可以用于其父用例能够应用的场合。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5089313fdbe9498f952febd2567e5c6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=KJnasPVUNE5rMusmKksjQtiess4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">2.3. 案例</h3>
<p>简单的购物系统中部分功能用例图。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0da6b9e06b9d47a49c6120d09263f90d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=olp%2Bcp8jMXnvkoxHAaK%2Bbq8LGyE%3D" alt="" loading="lazy"/></p>
<p>[购买者会员]、[系统管理员] 可以看做是参与者/执行者。（一个实际用户可以是多个参与者，参与者类似于角色，一个人可以有多个角色一样）</p>
<p>[购买者会员]和【商品查询】用例交互。</p>
<p>【电子产品查询】用例继承【商品查询】，是一种泛化关系。</p>
<p>【商品信息维护】包含了【产品信息修改】用例和【商品查询】用例</p>
<p>对[系统管理员]参与者进行说明</p>
<p>“导出电子产品查询”是对“电子产品查询”的扩展——它在基础用例的特定扩展点插入附加行为，而基础用例本身对此无感知。<br/>
若将“导出”视为“查询”流程中不可或缺的一部分，则也可建模为包含（include）关系。两种建模方式各有适用场景，需根据业务语义判断。</p>
<p><strong>用例图的颗粒度一定要有度，防止粒度过细，导致出现滥用。</strong></p>
<hr/>
<h2 data-id="heading-18">3. <strong>序列图（Sequence Diagram）</strong></h2>
<p>按时间顺序展示对象间的消息交互。强调“谁在什么时候调用了谁”。<strong>用途</strong>：API调用链分析、分布式事务协调、性能瓶颈定位（如过多远程调用）。<strong>实战技巧</strong>：在微服务调试中，序列图可清晰展示跨服务调用链，比日志更直观。</p>
<h3 data-id="heading-19">3.1. 认识时序图</h3>
<ol>
<li>序列图强调消息传递的时间顺序，即对象之间发送与接收消息的先后次序。</li>
<li>序列图用来表现用例中的<strong>行为顺序</strong>，描述了如何一步步完成系统的某项功能</li>
<li>序列图揭示了一个<strong>特定场景</strong>的交互，即系统执行期间发生在某个时间点的对象之间的特定交互</li>
</ol>
<p>在UML的表示中，序列图将交互关系表示为一个二维图。其中，纵轴是时间轴，时间沿竖线向下延伸。横轴代表了在交互中各独立的对象</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b127660152c3441bb3dfc942390bccb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=ryYt8C4N9ds7ZCdrobw7ls%2F4K2I%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-20">3.2. 元素组成</h3>
<p>对象、生命线、激活、消息。</p>
<h4 data-id="heading-21">3.2.1. 对象</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37eb6dc28ed24113bbab3ff3bde316b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=%2FTOkke8g43Hzov1D61YUiEg89iw%3D" alt="" loading="lazy"/></p>
<ul>
<li>序列图中的对象可以是系统的参与者或者任何有效的系统对象。</li>
<li>序列图中对象的符号和对象图中对象所用的符号一样——矩形符号。</li>
<li>对象及其类的名称带有下划线，二者用冒号隔开，使用“对象名 ：类名”的形式。</li>
</ul>

<ul>
<li>通常，将一个交互的发起者称为主角，将其置于序列图的顶部</li>
</ul>
<h4 data-id="heading-22">3.2.2. <strong>生命线</strong></h4>
<p>生命线（Lifeline）是一条垂直的虚线，表示序列图中的对象在一段时间内的存在</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/200867bc6814451191788cc2ff2daf6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=Q%2FMyKkPPEzQIvHzopYmNxD5qawM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E6%2597%25B6%25E5%25BA%258F%25E5%259B%25BE%2F%25E7%2594%259F%25E5%2591%25BD%25E7%25BA%25BF.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E6%97%B6%E5%BA%8F%E5%9B%BE/%E7%94%9F%E5%91%BD%E7%BA%BF.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a></p>
<ul>
<li>每个对象的底部中心的位置都带有生命线。</li>
<li>生命线是一个时间线，从序列图的顶部一直延伸到底部，所用的时间取决于交互持续的时间。</li>
</ul>
<h4 data-id="heading-23">3.2.3. <strong>激活</strong></h4>
<ul>
<li>序列图可以描述对象的激活（Activation），<strong>激活是对象操作的执行</strong>，它表示一个对象直接地或通过从属操作完成操作的过程。它对执行的持续时间和执行与其调用者之间的控制关系进行建模。</li>
<li>简单地说，<strong>激活表示该对象被占用以完成某个任务</strong>，去激活指的则是对象处于空闲状态、在等待消息。</li>
<li>激活在序列图中用一个细长的矩形框表示，矩形框称为激活条或控制期</li>
</ul>

<ul>
<li>矩形框的顶端与激活时间对齐，而底端与完成时间对齐。即，对象在激活条的顶部被激活，对象在完成自己的工作后被去激活</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99043ccdf01842718c42a48969d7e508~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=w67kK9AEu3PSe1is7JmLQ9dOjWI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-24">3.2.4. 消息</h4>
<ul>
<li>消息（Messages）是从一个对象（发送者）向另一个或几个其他对象（接收者）发送信号，或由一个对象（发送者或调用者）调用另一个对象（接收者）的操作。</li>
<li>消息定义的是<strong>对象之间某种形式的通信</strong>，它可以激发某个操作、唤起信号或导致目标对象的创建或撤销。</li>
<li>消息有三部分组成：发送者、接收者和活动。消息的表示形式为从发送者对象的生命线指向接收者对象生命线的箭头，箭头的类型表示了消息的类型</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E6%2597%25B6%25E5%25BA%258F%25E5%259B%25BE%2F%25E6%25B6%2588%25E6%2581%25AF.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E6%97%B6%E5%BA%8F%E5%9B%BE/%E6%B6%88%E6%81%AF.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a5d2130862b4f58a5875b4847e62097~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=2s5ghq%2Fd%2FuXekOgV8zinFBp7D%2BM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-25">3.3. 案例</h3>
<p>下面将以“教师查看学生成绩”为例，介绍如何去创建系统的序列图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fabee0461071482ca904b345161bf164~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=D29YW8X9r8vm2SqpS%2FWZvFklmZw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-26">4. <strong>活动图（Activity Diagram）</strong></h2>
<p>类似流程图，但支持并行、分支、泳道（Swimlane）。用于描述业务流程或算法逻辑。活动是某件事情正在进行的状态，它既可以是现实生活中正在进行的某一项工作，也可以是软件系统某个类对象的一个操作<br/>
<strong>用途</strong>：审批流设计、复杂业务规则可视化、跨角色协作流程梳理。</p>
<h3 data-id="heading-27">4.1. 认识活动图</h3>
<p>在 UML 中活动图中的活动既可以是手动执行的任务，也可以是自动执行的任务。用圆角矩形表示。活动强调的是动作，所以圆角矩形中的文字应该是动作。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de8514356e0474b93c6c35569445ec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=VrnBPXa%2Bpohm%2B9cQEDfK%2BbHsqgc%3D" alt="" loading="lazy"/></p>
<p>用户首先提交订单，随后流程分叉：一方面系统自动生成送货单，另一方面用户选择支付方式……）</p>
<h3 data-id="heading-28">4.2. 活动图与流程图的区别</h3>
<p>活动图描述系统使用的<strong>活动、判定点和分支</strong>，看起来和流程图没什么两样，并且传统的流程图所能表示的内容，大多数情况下也可以使用活动图表示，但是两者是有区别的，不能将两个概念混淆</p>
<p><strong>流程图</strong>着重描述处理过程，它的主要控制结构是顺序、分支和循环，各个处理过程之间有严格的顺序和时间关系</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b60958b9ba45426f818c6328560b0e5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=xmodjjeBuK9%2FN3KmXhv2QYL5e2w%3D" alt="" loading="lazy"/></p>
<p><strong>活动图</strong>描述的是活动的顺序关系，它着重表现的是系统的<strong>行为</strong>，而非系统的处理过程</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35e87cf91817484bbad168bdef4274dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=mSXh2cZL1P9MYXT%2F4VPqi%2BY2Nvw%3D" alt="" loading="lazy"/></p>
<p><strong>活动图</strong>能够表示并发活动的情形，而<strong>流程图</strong>不能。</p>
<p><strong>活动图</strong>是面向对象的，而<strong>流程图</strong>是面向过程的。</p>
<h3 data-id="heading-29">4.3. 为什么要用活动图</h3>
<ol>
<li>描述一个操作执行过程中所完成的工作。说明角色、工作流、组织和对象是<strong>如何工作</strong>的。</li>
<li>活动图对<strong>用例描述</strong>尤其有用，它可建模用例的工作流，显示用例内部和用例之间的路径。它可以说明用例的实例是如何执行动作以及如何改变对象状态。</li>
<li>显示如何执行一组相关的动作，以及这些动作如何影响它们周围的对象。</li>
<li>活动图对<strong>理解业务处理</strong>过程十分有用。活动图可以画出工作流用以描述业务，有利于与领域专家进行交流。通过活动图可以明确业务处理操作是如何进行的，以及可能产生的变化。</li>
<li>描述<strong>复杂过程</strong>的算法，在这种情况下使用的活动图和传统的程序流程图的功能是差不多</li>
</ol>
<h3 data-id="heading-30">4.4. 组成活动图的图形元素</h3>
<ul>
<li>动作状态（Action State）</li>
<li>活动状态（Activity State）</li>
<li>动作流（Action Flow）</li>
<li>分支（Branch）与合并（Merge）</li>
<li>分叉（Fork）与汇合（Join）</li>
<li>泳道（Swimlane）</li>
<li>对象流（Object Flow）</li>
</ul>
<h4 data-id="heading-31">4.4.1. 动作状态</h4>
<ol>
<li>动作状态是指执行原子的、不可中断的动作，并在此动作完成后通过完成转换转向另一个状态。</li>
<li>在 UML 中动作状态使用平滑的圆角矩形表示，动作状态所表示的动作写在平滑的圆角矩形内部。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d6bc9511eee46a1951886919a544c4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=JcisCsFKVy7pB0LnQy5TuExeIVc%3D" alt="" loading="lazy"/></p>
<p>动作状态。语法结构：动宾</p>
<h4 data-id="heading-32">4.4.2. 活动状态</h4>
<ol>
<li>活动状态用于表达状态机中的非原子的运行。</li>
<li>活动状态的表示图标也是平滑的圆角矩形，并可以在图标中给出入口动作和出口动作等信息</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E6%25B4%25BB%25E5%258A%25A8%25E5%259B%25BE%2F%25E6%25B4%25BB%25E5%258A%25A8%25E7%258A%25B6%25E6%2580%2581.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E6%B4%BB%E5%8A%A8%E5%9B%BE/%E6%B4%BB%E5%8A%A8%E7%8A%B6%E6%80%81.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3448934a645c49c18ddbcc3417a49ca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=amedhcecqFwEuHEuj%2FAZAXlO4Ig%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-33">4.4.3. 动作流</h4>
<ol>
<li>所有动作状态之间的转换流称之为动作流。</li>
<li>与状态图的转换相同，活动图的转换也用带箭头的直线表示，箭头的方向指向转入的方向</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E6%25B4%25BB%25E5%258A%25A8%25E5%259B%25BE%2F%25E5%258A%25A8%25E4%25BD%259C%25E6%25B5%2581.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E6%B4%BB%E5%8A%A8%E5%9B%BE/%E5%8A%A8%E4%BD%9C%E6%B5%81.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/218e8d3b3d07444482fde6c022cf7b61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=pP3qWLKuakDqJC0NiEQYKebtIlY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-34">4.4.4. 分支与合并</h4>
<ul>
<li>分支是用菱形表示的，它有一个进入转换（箭头从外指向分支符号），一个或多个出转换（箭头从分支符号指向外）。而每个出转换上都会有一个监护条件，用来表示满足什么条件的时候执行该转换。</li>
<li><strong>出转换的条件应当是互斥的，这样可以保证只有一条出转换能够被触发。</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E6%25B4%25BB%25E5%258A%25A8%25E5%259B%25BE%2F%25E8%25BD%25AC%25E6%258D%25A2.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E6%B4%BB%E5%8A%A8%E5%9B%BE/%E8%BD%AC%E6%8D%A2.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2592eeaf0a614a6682a319bdf108cebb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=vC%2FaTPQozj7oK97CrZPdVowrzJo%3D" alt="" loading="lazy"/></p>
<p>合并指的是两个或者多个控制路径在此汇合的情况。合并表示从对应的分支开始的条件行为的结束。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E6%25B4%25BB%25E5%258A%25A8%25E5%259B%25BE%2F%25E5%2590%2588%25E5%25B9%25B6%25E5%2592%258C%25E5%2588%2586%25E6%2594%25AF.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E6%B4%BB%E5%8A%A8%E5%9B%BE/%E5%90%88%E5%B9%B6%E5%92%8C%E5%88%86%E6%94%AF.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71e0c5de406047c9937a5c4c374e4bc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=aZL44a9IZ6Qkv1a%2F9Q9i2TWjPMk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-35">4.4.5. 分叉与汇合</h4>
<ol>
<li>分叉和汇合都使用加粗的水平（或者竖直）线段表示</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E6%25B4%25BB%25E5%258A%25A8%25E5%259B%25BE%2F%25E5%2588%2586%25E5%258F%2589%25E4%25B8%258E%25E6%25B1%2587%25E5%2590%2588.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E6%B4%BB%E5%8A%A8%E5%9B%BE/%E5%88%86%E5%8F%89%E4%B8%8E%E6%B1%87%E5%90%88.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9aaa8d12f50489ca1eb276b0e93f16d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=e6tjkwP9LS1lmWPBQD97vo%2BBK5g%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>分叉用于将动作流分为两个或者多个并发运行的分支，而汇合则用于同步这些并发分支，以达到共同完成一项事务的目的。</strong></li>
</ol>
<p>注意：分叉与汇合的特性。分叉并行，汇合等待同步</p>
<ol>
<li><strong>分叉可以用来描述并发线程，每个分叉可以有一个输入转换和两个或多个输出转换，每个转换都可以是独立的控制流。</strong></li>
<li>汇合代表两个或多个并发控制流同步发生，<strong>当所有的控制流都达到汇合点后，控制才能继续往下进行</strong>。</li>
<li><strong>如果一个处理在其他处理之前到达了</strong> <strong>汇合</strong> <strong>，它将会等待，直到所有的处理都准备好之后才会向联结传递控制权</strong>。</li>
</ol>
<p>每个汇合可以有两个或多个输入转换和一个输出转换</p>
<h4 data-id="heading-36">4.4.6. 区分合并与汇合</h4>
<ul>
<li>合并结合了两个以上的控制路径，在任何执行中每次只走一条，不同路径之间是互斥关系。</li>
<li>汇合结合了两条或者两条以上的<strong>并行</strong>控制路径，在执行过程中，所有路径都要走过，先到的控制流要<strong>等</strong>其他路径的控制流到达后才能继续运行</li>
</ul>
<h3 data-id="heading-37">4.5. 泳道</h3>
<ol>
<li>泳道将活动图中的<strong>活动按职责化分为若干组</strong>，<strong>并把每一组指定给负责这组活动的业务组织</strong></li>
<li>在活动图中，泳道用垂直实线绘出，垂直线分隔的区域就是泳道。</li>
<li>在泳道上方可以给出泳道的名字，负责泳道内的全部活动。</li>
<li>在包含泳道的活动图中，每个活动只能明确地属于一个泳道</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aff0f40b81241efa0ad1e6a3a823f36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=0nYUIcWjf0BjjBZJ06hqUS%2Bpw7I%3D" alt="" loading="lazy"/></p>
<ol>
<li>泳道中，按<strong>职责</strong>划分为若干个组。属于职责划分，可以分为：客户、系统、供应商。各司其职，互不干涉。例如：系统负责生成送货单和收款</li>
<li>分叉和汇合是成对出现的。分叉是并行，汇合时等待。直到所有分支都走完后才往下一个活动。</li>
<li>活动图<strong>描述的是活动的顺序关系，它着重表现的是系统的行为</strong>，而非系统的处理过程</li>
<li>分支和合并是只有每次只能走一条，不同路径之间是互斥的。</li>
</ol>
<h2 data-id="heading-38">5. <strong>状态机图（State Machine Diagram）</strong></h2>
<p>描述对象在其生命周期内响应事件所经历的状态变迁。<strong>用途</strong>：订单状态流转（待支付→已支付→已发货→已完成）、设备控制逻辑、游戏AI行为树。<strong>深度价值</strong>：强制你考虑所有可能的状态和转换条件，避免“状态遗漏”导致的Bug。</p>
<h3 data-id="heading-39">5.1. 认识状态机</h3>
<p>面向对象分析与设计中，对象的状态、状态的转换、触发状态转换的事件、对象对事件的响应(即事件的行为)等都可以用状态图来描述。</p>
<p>状态图通过建立<strong>类对象的生命周期模型</strong>来描述<strong>对象随时间变化的动态行为</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ad6d6bb41034255938d4eb380f0af3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=H6hzTg7MngSKqTKWRjQ%2B2N1k7ug%3D" alt="" loading="lazy"/></p>
<p>它用于描述某个特定对象在其生命周期中所有可能的状态，以及由于各种事件的发生而引起状态之间的转移和变化</p>
<h3 data-id="heading-40">5.2. 状态图组成</h3>
<p><strong>状态图由初始状态、终止状态、状态、转换、判定等组成</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/376521cfe87c4e198e30fce49dcdd946~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=UW0TM060uGwrphk%2B%2FvFeQOn3L1U%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-41">5.3. 案例</h3>
<p>创建一个状态图来描述银行卡从最初制造到顾客使用的各种状态过程</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae8309af75ce4f059d00f8ad7c9ec548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=wij9VJYe1RPXgzSu7KoV7PmKltQ%3D" alt="" loading="lazy"/></p>
<p>状态图创建步骤：1. 选中建模实体 2. 对各种状态进行建模 3. 找相关事件和转换。 <strong>需要在转换的箭头上添加事件行为。</strong></p>
<hr/>
<h2 data-id="heading-42">6. 协作图 (UML 2.x 通信图)</h2>
<p>文档中 “协作图” 是 UML 1.x 的旧称，UML 2.x 已统一更名为 “通信图”</p>
<p><strong>协作图</strong>强调发送和接收消息的对象之间的结构组织的交互图，<strong>显示对象、对象之间的链接以及对象之间的消息。</strong></p>
<h3 data-id="heading-43">6.1. 认识协作图</h3>
<p><strong>协作图就是表现对象协作关系的图，它表示了协作中作为各种类元角色的对象所处的位置</strong>，在图中主要显示了类元角色（Classifier Roles）和关联角色（Association Roles）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/606d19729c244d56925695f35e237aaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=zVP%2Ff5q0obHTwSePkq34mHA2Ps8%3D" alt="" loading="lazy"/></p>
<p><strong>类元角色和关联角色描述了对象的配置和当一个协作的实例执行时可能出现的连接</strong>;<strong>当协作被实例化时，对象受限于类元角色，连接受限于关联角色。</strong></p>
<hr/>
<h3 data-id="heading-44">6.2. 组成元素</h3>
<p>协作图（Collaboration Diagram）是由对象（Object）、消息（Messages）和链（Link）等构成的</p>
<h4 data-id="heading-45">6.2.1. 对象</h4>
<p>协作图中对象也是类的实例,其表示形式使用包围名称的<strong>矩形框来标记</strong>、所显示的<strong>对象及其类的名称带有下划线、二者用冒号隔开</strong>、使用“<strong>对象名:类名</strong>”的形式等</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E5%258D%258F%25E4%25BD%259C%25E5%259B%25BE%2F%25E5%25AF%25B9%25E8%25B1%25A1.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E5%8D%8F%E4%BD%9C%E5%9B%BE/%E5%AF%B9%E8%B1%A1.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41dbe0a501fb44e584ad57c4b5a4b3a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=5oskL3BJbX%2FGuv%2BqYH6M2lvrjz4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-46">6.2.2. 消息</h4>
<ol>
<li>在协作图中，可以通过一系列的消息（Messages）来<strong>描述系统的动态行为</strong>。</li>
<li>每个消息包括一个<strong>顺序号以及消息的名称</strong>。为了说明交互过程中消息的<strong>时间顺序，需要给消息添加顺序号</strong>。</li>
<li>顺序号是消息的一个数字前缀，是一个整数，由1开始递增，每个消息都必须由唯一的顺序号。<strong>嵌套消息使用点表示法</strong></li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuzong%2Fuml%2Fblob%2Fmaster%2F%25E5%258D%258F%25E4%25BD%259C%25E5%259B%25BE%2F%25E6%25B6%2588%25E6%2581%25AF.png" target="_blank" title="https://github.com/uzong/uml/blob/master/%E5%8D%8F%E4%BD%9C%E5%9B%BE/%E6%B6%88%E6%81%AF.png" ref="nofollow noopener noreferrer"><img src="" alt="" loading="lazy"/></a><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3325d2ff0e6c46c29ad079bef4aca5f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=i5VHXXwdUA2NdVJQ0G2maEGlXYY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-47">6.2.3. 链</h4>
<p>在协作图中的链是用<strong>连接各个对象之间的实线表示</strong>。</p>
<ul>
<li>链是关联的实例，当一个类与另一个类之间有关联时，<strong>这两个类的实例之间就有链，一个对象就能向另一个对象发送消息。所以链是对象间的发送消息的路径</strong>。</li>
<li>为了说明一个对象如何与另一个对象连接，可以在链的末路上附上一个路径构造型。如构造型&lt;&gt;，表示指定对象对发送方而言是局部的</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/660bdaa937c0434aaffa0643e04aed7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=PffgCVeJd0rlCnJMNEHQRCgKExo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-48">6.3. <strong>协作图与序列图的区别与联系</strong></h3>
<h4 data-id="heading-49">6.3.1. 时序图</h4>
<p>取100元人民币的时序图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f90b34021aca42dcb0b3ae4b59a1c31d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=ANOdgiPHDUW%2BWhCh0tb4yVpdME4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-50">6.3.2. 协作图</h4>
<p>取100元人民币的协作图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28855bc4917749bca10cadc6c6088abd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=n71jzZZM6oQOTATZXvKZu23h%2Bx0%3D" alt="" loading="lazy"/></p>
<ul>
<li>都是<strong>交互图</strong>，<strong>描述对象之间的交互</strong></li>
<li>都包含一系列<strong>消息集合</strong></li>
<li>时序图强调消息传送的时间<strong>先后顺序</strong></li>
<li>协作图中描述了该协作所有对象组成的网络结构以及相互发送消息的<strong>整体行为</strong></li>
</ul>
<h3 data-id="heading-51">6.4. 案例</h3>
<p>协作图强调整体行为，时序图强调时间顺序。</p>
<p>以下以“学生信息管理系统”的一个简单用例“教师查看学生成绩”为例，介绍如何创建系统的协作图。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a08fb22977474671b3be4072a42e3232~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=cIsS9lDXI%2BCdn31X6QHyUIer%2BZg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-52">7. 组件图</h2>
<p>用于可视化系统组件的组织和关系。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed4cd921284140b1aa1656637e93c6d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=t5FAbUmmFf2OedD%2F00%2Fn2Pe7pHA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-53">7.1. 认识组件图</h3>
<p>这些图有助于将复杂的系统分解成易于管理的组件，展示它们之间的相互依存关系，确保高效的系统设计和架构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a989273759ee4e8d99108903f3e8d7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=JDQWWE0vXzXizi4SyKvRDmaE0RY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-54">7.2. 案例</h3>
<p>组件图用于展示系统内部各模块（组件）的组织方式及其依赖关系，体现“小模块如何组装成大系统”的架构逻辑</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e002306209e441bfa8d0b0a7966d98b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=ihXgLpCMPacVdgd62cqKC7dL9Yw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-55">8. 部署图</h2>
<p><strong>部署</strong>图是一种可视化系统架构的图表，展示软件组件如何部署到硬件上。它能清晰地显示组件在服务器、工作站和设备等不同节点上的分布情况。例如计算机和设备，以及它们之间是如何连接的。<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%25E9%2583%25A8%25E7%25BD%25B2%25E5%259B%25BE%2F0%3FfromModule%3Dlemma_inlink" target="_blank" title="https://baike.baidu.com/item/%E9%83%A8%E7%BD%B2%E5%9B%BE/0?fromModule=lemma_inlink" ref="nofollow noopener noreferrer">部署图</a>的使用者是开发人员、系统集成人员和测试人员。部署图用于表示一组物理结点的集合及结点间的相互关系，从而建立了系统<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%25E7%2589%25A9%25E7%2590%2586%25E5%25B1%2582%2F0%3FfromModule%3Dlemma_inlink" target="_blank" title="https://baike.baidu.com/item/%E7%89%A9%E7%90%86%E5%B1%82/0?fromModule=lemma_inlink" ref="nofollow noopener noreferrer">物理层</a>面的模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9217d0c9ac94552adcd39406c127b1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=to2s5eH5dVIrikfaO0IkoOcPagk%3D" alt="" loading="lazy"/></p>
<p>部署图在实际开发中<strong>应用广泛。</strong></p>
<h3 data-id="heading-56">8.1. 案例</h3>
<p>使用 UML 部署图为软件组件的物理部署建模。在部署图中，硬件组件（例如，web服务器、邮件服务器、应用服务器）被呈现为节点，其中在硬件组件内运行的软件组件呈现为工件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c9e1effc27343e6a082bc22ad28ebc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=QWHu5wXgwGVgKi3TzSfQvnEruKI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-57">9. 对象图</h2>
<p><strong>对象图是</strong>一种图形表示法，展示对象及其在特定时刻的关系。它提供了系统结构的快照，捕捉了存在的实例及其关联的静态视图。</p>
<p>对象之间的关系是用以下符号定义的</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27cb416d728240ed83ecd3c08e65481f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=ibNXyju6ghkaWMXz86NdVW1Cl3c%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c0fdd9948eb47de82f98efc412ff82d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=jkwYp%2Ft9kosd7ETFj%2FI7I9IssqQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-58">10. 包图</h2>
<p>使用包图管理大型项目的模型。包图也可用于呈现子系统或模块之间的结构和依赖性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2589ed1dd52f4fd1904d465a76afca58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768670528&amp;x-signature=BteQSG29DUAGKtcgoAULPo1fKvw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-59">11. 总结</h2>
<p><strong>UML 是否过时？</strong><br/>
当前开发者更倾向于使用白板、Draw.io 或 Excalidraw 等工具绘制“类 UML 风格”的草图，而非严格遵循 UML 规范。这并非否定 UML 的价值，而是强调<strong>沟通效率优先于形式合规</strong>。</p>
<p>无需精通所有 UML 图，但应掌握类图、序列图、状态机图、用例图和部署图等 UML 图。</p>
<p>一些参考资料和网站：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplantuml.com%2Fzh%2Fcomponent-diagram" target="_blank" title="https://plantuml.com/zh/component-diagram" ref="nofollow noopener noreferrer">plantuml.com/zh/componen…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.visual-paradigm.com%2Ftutorials%2F" target="_blank" title="https://www.visual-paradigm.com/tutorials/" ref="nofollow noopener noreferrer">www.visual-paradigm.com/tutorials/</a></p>
<p>《大象 Thinking in UML 》第二版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[后端线上发布计划模板]]></title>    <link>https://juejin.cn/post/7593541291012358171</link>    <guid>https://juejin.cn/post/7593541291012358171</guid>    <pubDate>2026-01-10T18:00:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593541291012358171" data-draft-id="7593541291012341787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="后端线上发布计划模板"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-10T18:00:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uzong"/> <meta itemprop="url" content="https://juejin.cn/user/372082495985181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            后端线上发布计划模板
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/372082495985181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uzong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T18:00:51.000Z" title="Sat Jan 10 2026 18:00:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><strong>敬畏每一行代码，敬畏每一次变更。</strong><br/>
本模板旨在通过结构化、可验证、可回溯的方式，降低发布风险，保障系统稳定。</p>
<h2 data-id="heading-0">一、📅 发布基本信息</h2>

































<table><thead><tr><th>项目</th><th>内容</th></tr></thead><tbody><tr><td><strong>发布名称</strong></td><td>示例：用户中心 v2.3.0 上线</td></tr><tr><td><strong>发布时间</strong></td><td>2026-01-15 01:00 – 02:30</td></tr><tr><td><strong>发布负责人</strong></td><td>xxx</td></tr><tr><td><strong>协同人员</strong></td><td>xxx</td></tr><tr><td><strong>发布类型</strong></td><td>✅ 功能上线 / 🔁 配置变更 / 🐞 紧急修复 / ⚙️ 架构调整</td></tr><tr><td><strong>是否灰度发布</strong></td><td>是 / 否（若“是”，说明策略：如 5% → 20% → 100%）</td></tr></tbody></table>
<h2 data-id="heading-1">二、🧩 发布依赖清单（必须全部完成并验证）</h2>
<p>✅ 每项依赖需明确负责人、完成状态、验证方式，避免“我以为你做了”。</p>




































































<table><thead><tr><th>依赖项</th><th>描述与范围</th><th>负责人</th><th>完成状态</th><th>验证方式</th></tr></thead><tbody><tr><td>DB 变更（DDL/DML）</td><td>新增 <code>user_profile</code> 表，添加索引 <code>idx_mobile</code></td><td>xxx</td><td>✅</td><td><code>DESC user_profile</code>+ 执行计划验证</td></tr><tr><td>Nacos 配置更新</td><td>新增 <code>user-center.feature.new-login=true</code></td><td>xxx</td><td>✅</td><td>配置中心截图 + 应用启动日志</td></tr><tr><td>MQ Topic 创建</td><td>新建 <code>user-event-v2</code>，Consumer 已部署</td><td>xxx</td><td>✅</td><td>RocketMQ 控制台确认</td></tr><tr><td>下游服务兼容</td><td>通知订单服务适配新用户字段</td><td>xxx</td><td>✅</td><td>邮件/群聊记录 + 接口 Mock 测试</td></tr><tr><td>网关路由配置</td><td><code>/api/v2/user/**</code>路由至新服务集群</td><td>xxx</td><td>⏳</td><td>待发布后验证</td></tr><tr><td>Restful 白名单</td><td>添加 IP <code>10.10.5.x/24</code>到白名单</td><td>xxx</td><td>✅</td><td>网关日志抽样验证</td></tr><tr><td>SQL 脚本地址</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fsql-audit.spotter.ink%2Fsubmitsql%2Fabc123" target="_blank" title="https://sql-audit.spotter.ink/submitsql/abc123" ref="nofollow noopener noreferrer">sql-audit.spotter.ink/submitsql/a…</a></td><td>—</td><td>—</td><td>脚本 ID: <code>SQL-20260115-001</code></td></tr><tr><td>......</td><td>......</td><td>......</td><td>......</td><td/></tr></tbody></table>
<p>💡 <strong>SQL 规范提醒</strong>：</p>
<ul>
<li>所有 DDL/DML 必须经过 <strong>至少一人 Review</strong></li>
<li>DML 操作必须带 <code>WHERE</code> + <code>LIMIT</code>（如适用）+ 事务包裹</li>
<li><strong>不可逆操作</strong>（如 DROP COLUMN）需单独评估并提供数据备份</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、⚠️ 影响与风险评估</h2>








































<table><thead><tr><th>影响维度</th><th>具体描述</th><th>风险规避措施</th><th>负责人</th><th>是否已确认</th></tr></thead><tbody><tr><td>API 兼容性</td><td>新增字段 <code>nick_name</code>，旧客户端可能忽略</td><td>提前通知下游，接口保持向后兼容</td><td>......</td><td>✅</td></tr><tr><td>性能影响</td><td>新增索引可能短暂锁表（&lt;2s）</td><td>在低峰期执行，监控慢 SQL</td><td>......</td><td>✅</td></tr><tr><td>用户体验</td><td>登录流程变更，首次加载略慢</td><td>增加 loading 提示，前端兜底</td><td>......</td><td>✅</td></tr><tr><td>监控覆盖</td><td>新增埋点 <code>login_v2_success</code></td><td>已在 Grafana 配置告警看板</td><td>......</td><td>✅</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">四、↩️ 回滚策略（失败时快速止损）</h2>
<p><strong>原则：任何变更必须可回滚，不可逆操作需提前报备！</strong></p>















































<table><thead><tr><th>回滚项</th><th>回滚方案</th><th>触发条件</th><th>执行人</th><th>可行性</th></tr></thead><tbody><tr><td>应用代码</td><td>回滚至 Git Tag <code>v2.2.1</code>（Commit: a1b2c3d）</td><td>错误率 &gt; 5% 持续5分钟</td><td>张三</td><td>✅ 高</td></tr><tr><td>Nacos 配置</td><td>切换回 <code>user-center.feature.new-login=false</code></td><td>功能异常</td><td>王五</td><td>✅ 高</td></tr><tr><td>DB 结构</td><td><strong>不可回滚</strong>（仅新增字段）</td><td>—</td><td>—</td><td>⚠️ 仅支持补偿</td></tr><tr><td>DB 数据</td><td>若 DML 出错，使用备份快照 <code>backup_20260114</code>恢复</td><td>数据污染</td><td>李四</td><td>✅ 中（需30min）</td></tr><tr><td>网关路由</td><td>切回旧路由规则</td><td>服务不可用</td><td>运维</td><td>✅ 高</td></tr></tbody></table>
<p>📌 <strong>回滚后动作</strong>：</p>
<ul>
<li>通知所有相关方</li>
<li>记录故障时间线</li>
<li>24 小时内提交复盘报告</li>
</ul>
<hr/>
<h2 data-id="heading-4">五、📋 发布执行步骤</h2>
<h3 data-id="heading-5">🕒 发布窗口：2026-01-15 01:00 – 02:30</h3>
<h4 data-id="heading-6">▶️ Pre-Release（发布前）</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 所有 CR 完成并通过（PR #1234）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 预发环境全链路回归测试通过</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 建立发布沟通群，@ 所有关键人员</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ......</li>
</ul>
<h4 data-id="heading-7">▶️ Release（发布中）</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>01:00</strong> – 执行 DB 变更（李四）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>  <strong>01:10</strong> – 更新 Nacos 配置（王五）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>  <strong>01:15</strong> – 滚动发布应用（张三，按 20% → 50% → 100%）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>  <strong>01:40</strong> – 验证网关路由 &amp; 白名单（运维）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>  <strong>01:50</strong> – 触发核心链路自动化回归（测试）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ......</li>
</ul>
<h4 data-id="heading-8">▶️ Post-Release（发布后）</h4>
<ul class="contains-task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled="disabled"/>   <strong>02:00–02:30</strong>：密切观察监控（错误率、延迟、CPU、GC）</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled="disabled"/>   验证关键业务指标（如登录成功率 ≥ 99.9%）</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled="disabled"/>    通知产品/运营/下游团队发布完成</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled="disabled"/>    归档发布记录至 Wiki：[链接]</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled="disabled"/>   .....</p>
</li>
</ul>
<h2 data-id="heading-9">六、✅ 发布成功标准</h2>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>    核心功能可用（登录、查询、修改）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>   监控无异常告警（持续 30 分钟）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>   日志无 ERROR/WARN 堆积</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>   下游服务调用正常</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/>   ......</li>
</ul>
<blockquote>
<p>预祝发布成功！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我学习到的A2UI概念]]></title>    <link>https://juejin.cn/post/7593262196844740660</link>    <guid>https://juejin.cn/post/7593262196844740660</guid>    <pubDate>2026-01-10T15:16:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593262196844740660" data-draft-id="7592893391572746266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我学习到的A2UI概念"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-10T15:16:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端工作日常"/> <meta itemprop="url" content="https://juejin.cn/user/4371313961207838"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我学习到的A2UI概念
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313961207838/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端工作日常
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T15:16:09.000Z" title="Sat Jan 10 2026 15:16:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>生成式AI在生成文本、图像和代码方面表现出色。现在，是时候将其用于生成上下文相关的<strong>界面</strong>了。A2UI 是谷歌开源的<strong>大模型生成式 UI 协议</strong>，聚焦解决多代理网络下 UI 响应的互操作性、跨平台、安全渲染等核心问题；通过<strong>声明式 JSON 数据格式</strong>让代理生成上下文相关的界面描述，由客户端调用原生组件渲染，实现了安全、可增量更新、框架无关的生成式 UI 交互</p>
<h4 data-id="heading-0"><strong>1. 旧范式：对话式交互的核心痛点（大模型交互的三年困局：被 “聊天框” 束缚）</strong></h4>
<p>2022 年 ChatGPT 问世后，大模型在能力、参数上持续升级，但交互方式始终未变，存在四大核心痛点：</p>
<ol>
<li><strong>操作效率低</strong>：点几下可完成的操作，需通过多轮文字对话实现；</li>
<li><strong>能力隐藏化</strong>：无法像 GUI 一样直观展示功能，需用户主动想到才能调用；</li>
<li><strong>用户习惯相悖</strong>：GUI 已普及十几年，聊天式交互迁移成本高，易打断用户思路；</li>
<li><strong>复杂操作难表达</strong>：文字无法清晰描述操作的先后顺序与依赖关系。</li>
</ol>
<p>简言之，大模型用 2025 年的先进能力，搭配了 1970 年代的终端界面。</p>
<h4 data-id="heading-1"><strong>2. 新范式：A2UI的定义与本质</strong></h4>
<ul>
<li><strong>定义</strong>：<strong>AI生成式主动用户界面</strong>。AI的输出从“一段文字回复”变为  <strong>“个性化App与文字的混合体”</strong>  。</li>
<li><strong>本质</strong>：AI根据<strong>当前用户、时间、场景</strong>的实时需求，从预定义的组件库中动态组合并生成交互界面（如卡片、表单、图表）。</li>
<li><strong>类比</strong>：相当于大模型的  <strong>“触屏革命”</strong>  ，AI 从 “回复文字的对话伙伴” 转变为 “即时生成界面的设计师”。</li>
<li><strong>角色转变</strong>：AI从一个需要被“对话”的伙伴，转变为一个为你即时“构建体验”的界面设计师。</li>
</ul>
<h4 data-id="heading-2"><strong>3. 为什么A2UI是“范式转移”？</strong></h4>
<ul>
<li>
<p><strong>解决的问题不同</strong>：</p>
<ul>
<li>
<p><strong>过往大模型更新方向</strong>：聚焦 “如何让 AI 更聪明”，如提升上下文长度、推理能力、多模态感知、工具调用能力，均为<strong>线性的能力提升</strong>；</p>
</li>
<li>
<p><strong>A2UI 的更新方向</strong>：聚焦 “如何让 AI 更好用”，通过交互方式的改变实现<strong>指数级的体验提升</strong>，是大模型产品的核心范式转移。</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3"><strong>4. 典型场景验证：订餐厅的体验差距</strong></h4>

























<table><thead><tr><th>维度</th><th>传统聊天式 AI</th><th>A2UI 方式</th></tr></thead><tbody><tr><td>交互形式</td><td>多轮文字对话</td><td>可视化界面操作</td></tr><tr><td>交互成本</td><td>8 轮对话，耗时约 2 分钟</td><td>3 次点击，耗时约 10 秒</td></tr><tr><td>用户体验</td><td>流程繁琐，易产生负面情绪</td><td>操作简洁，即时完成</td></tr></tbody></table>
<h4 data-id="heading-4"><strong>5. 跨信任边界渲染的关键挑战</strong></h4>
<p>进入多代理网络时代（A2A 协议支撑跨机构代理协作），远程代理无法直接操作宿主应用的 UI 层，只能通过消息传输；传统解决方案（发送 HTML/JS 并在 iframe 沙盒化）存在<strong>体积大、样式脱节、安全复杂</strong>三大问题，亟需一种 “像数据一样安全，像代码一样富有表现力” 的 UI 传输方式。</p>
<h4 data-id="heading-5"><strong>6. A2UI 核心定义与定位</strong></h4>
<ol>
<li>
<p><strong>项目属性</strong>：开源项目（Apache 2 协议），处于早期阶段（v0.8），旨在联合社区完善规范、拓展传输方式与渲染器集成。</p>
</li>
<li>
<p><strong>核心构成</strong>：</p>
<ul>
<li>一套针对<strong>可更新、代理生成的 UI</strong>优化的声明式数据格式；</li>
<li>一组初始渲染器，支持 Lit、Angular、Flutter 等 UI 框架（未来将拓展更多）。</li>
</ul>
</li>
<li>
<p><strong>核心功能</strong>：代理可生成 / 填充适配当前对话的丰富 UI 布局，以<strong>消息（非可执行代码）</strong> 形式传递给前端，由客户端自主渲染，兼顾品牌风格与安全性。</p>
</li>
<li>
<p><strong>适用主体</strong>：编排器代理、远程 A2A 子代理均可生成 A2UI 布局，支持多代理协作场景。</p>
</li>
</ol>
<h2 data-id="heading-6"/>













<table><thead><tr><th>核心挑战</th><th>解决方案（A2UI 核心设计）</th></tr></thead><tbody><tr><td>跨信任边界的 UI 渲染（远程代理无法操作宿主 UI，传统 iframe 方式缺陷明显）</td><td>将 UI 规范封装为<strong>JSON 格式的消息序列</strong>，作为结构化输出即时生成或模板填充后传输；客户端使用原生 UI 组件渲染，保留对样式和安全的完全控制权。</td></tr></tbody></table>
<h4 data-id="heading-7"><strong>7. 关键技术突破：“三个不可能三角”的解法</strong></h4>

























<table><thead><tr><th>矛盾三角</th><th>A2UI的解决方案</th><th>形象比喻</th></tr></thead><tbody><tr><td><strong>安全性与灵活性</strong></td><td>AI只能从<strong>经审核的组件库</strong>中“组合”界面（点菜），不能编写任意前端代码（做菜）。</td><td><strong>乐高模式</strong>：AI自由拼接，但积木块是安全、预制的。</td></tr><tr><td><strong>一次生成与全平台可用</strong></td><td>AI生成一份<strong>平台无关的UI描述（如JSON蓝图）</strong> ，各平台客户端将其渲染为原生组件。同一响应可在网页（React）、iOS（SwiftUI）、Android（Flutter）上分别渲染，实现 “一次编写，全平台渲染”。</td><td><strong>“Write once, render everywhere”</strong> ：一份蓝图，多端适配。</td></tr><tr><td><strong>即时响应与复杂界面</strong></td><td>支持<strong>流式渲染</strong>，界面边生成边展示，用户无需等待全部完成即可交互。</td><td><strong>“边想边画”</strong> ：解决了复杂界面生成耗时超过用户耐心（3 秒）的问题，实现复杂界面的即时反馈。</td></tr></tbody></table>
<h4 data-id="heading-8"><strong>8. A2UI 的多元应用场景想象</strong></h4>
<ol>
<li><strong>照片定制化处理</strong>：用户上传照片后，AI 生成个性化交互表单（如选择保留元素、预算范围、风格偏好），而非纯文字分析；</li>
<li><strong>数据分析可视化</strong>：用户询问数据问题后，AI 直接生成<strong>交互式仪表盘</strong>（柱状图、折线图、饼图，支持下钻查看详情），而非大段文字分析；</li>
<li><strong>多代理协作统一化</strong>：不同 AI 代理协作完成任务时，通过 A2UI 的标准化 “UI 语言” 生成风格统一的界面，避免回复割裂，提升体验。</li>
</ol>
<h4 data-id="heading-9"><strong>9. 未来影响与行动启示</strong></h4>

























<table><thead><tr><th>角色</th><th>核心启示</th></tr></thead><tbody><tr><td>普通用户</td><td>无需学习提示词技巧，无需忍受多轮确认，体验 “好用 10 倍” 的 AI，获取 “结果 + 工具” 而非单纯 “答案”；</td></tr><tr><td>产品经理</td><td>重新思考 AI 产品形态，聊天界面不再是最优解，可设计组件库让 AI 组合成无限种界面；</td></tr><tr><td>开发者</td><td>前端开发工作从 “实现设计稿” 转变为 “设计 AI 可调用的组件库”，组件的可组合性、语义化成为核心竞争力；</td></tr><tr><td>创业者</td><td>迎来窗口期，率先拥抱 “生成式界面” 的产品，可获得代际优势。</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nacos - 服务发现]]></title>    <link>https://juejin.cn/post/7593338828217909263</link>    <guid>https://juejin.cn/post/7593338828217909263</guid>    <pubDate>2026-01-10T15:22:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828217909263" data-draft-id="7593296804109254696" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nacos - 服务发现"/> <meta itemprop="keywords" content="微服务,Java"/> <meta itemprop="datePublished" content="2026-01-10T15:22:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="元Y亨H"/> <meta itemprop="url" content="https://juejin.cn/user/2839351584888617"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nacos - 服务发现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2839351584888617/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    元Y亨H
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T15:22:27.000Z" title="Sat Jan 10 2026 15:22:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nacos 的服务发现（Service Discovery）是指服务消费者（Consumer）如何获取服务提供者（Provider）地址列表的过程。</p>
<p>Nacos 采用了 <strong>“主动拉取 + 被动推送”</strong> 相结合的机制，确保了服务发现的<strong>实时性</strong>和<strong>高可用性</strong>。</p>
<hr/>
<h3 data-id="heading-0">一、 服务发现的整体架构</h3>
<p>服务发现主要涉及三个角色：</p>
<ol>
<li><strong>服务提供者 (Provider)</strong>：注册自己的 IP/端口到 Nacos。</li>
<li><strong>Nacos Server</strong>：保存服务注册表，并感知实例状态变化。</li>
<li><strong>服务消费者 (Consumer)</strong>：从 Nacos 获取地址列表，并监听变化。</li>
</ol>
<hr/>
<h3 data-id="heading-1">二、 详细流程详解</h3>
<h4 data-id="heading-2">1. 消费者初始化与订阅 (Subscription)</h4>
<p>当一个微服务启动并需要调用其他服务时：</p>
<ul>
<li><strong>查询缓存</strong>：消费者首先会检查本地内存中是否有目标服务的实例列表。</li>
<li><strong>发起订阅</strong>：如果没有或需要更新，消费者会向 Nacos Server 发起订阅请求（Subscribe）。</li>
<li><strong>版本差异</strong>：
<ul>
<li><strong>Nacos 1.x</strong>：通过 HTTP 轮询定时拉取，并开启一个 UDP 端口接收服务端的推送。</li>
<li><strong>Nacos 2.x</strong>：通过 <strong>gRPC 双向流</strong> 建立长连接。客户端发送 <code>ServiceQueryRequest</code>，并在服务端注册该连接的订阅关系。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">2. 服务端获取与过滤 (Server Side)</h4>
<p>Nacos Server 收到查询请求后：</p>
<ul>
<li><strong>检索注册表</strong>：从内存 Map（<code>Service</code> -&gt; <code>Cluster</code> -&gt; <code>Instances</code>）中找到对应的实例。</li>
<li><strong>健康检查过滤</strong>：
<ul>
<li>只返回 <code>healthy=true</code>（健康）的实例。</li>
<li>只返回 <code>enabled=true</code>（启用）的实例。</li>
</ul>
</li>
<li><strong>选择集群</strong>：根据客户端配置的集群名称（Cluster Name），优先返回同集群的实例（就近访问策略）。</li>
</ul>
<h4 data-id="heading-4">3. 客户端本地缓存 (Local Cache)</h4>
<p>这是 Nacos 保证高可用的关键：</p>
<ul>
<li><strong>内存缓存</strong>：客户端将获取到的 <code>ServiceInfo</code>（包含实例列表）保存到内存中的 <code>ServiceInfoHolder</code>。</li>
<li><strong>磁盘缓存</strong>：同时将数据异步写入本地磁盘文件（路径通常在 <code>${user.home}/nacos/naming/${namespace}</code>）。</li>
<li><strong>容灾逻辑</strong>：如果 Nacos Server 全部宕机，消费者会直接读取<strong>本地磁盘文件</strong>，保证业务不中断。</li>
</ul>
<h4 data-id="heading-5">4. 实时更新机制 (Push &amp; Pull)</h4>
<p>为了保证消费者拿到的地址是最新的，Nacos 采用了以下策略：</p>
<ul>
<li><strong>被动接收推送 (Push)</strong>：
<ul>
<li>一旦服务提供者下线、故障或有新节点加入，Nacos Server 会触发 <code>ServiceChangeEvent</code>。</li>
<li><strong>Nacos 2.x</strong> 会通过已建立的 <strong>gRPC 长连接</strong>，主动将最新的实例列表推送到消费者（Push）。这种方式是毫秒级的。</li>
</ul>
</li>
<li><strong>定时主动拉取 (Pull)</strong>：
<ul>
<li>作为补偿机制，客户端内部有一个定时任务（默认每 10 秒或根据配置），会检查本地数据的版本，必要时重新拉取，防止因网络闪断导致的推送丢失。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">5. 客户端负载均衡 (Load Balance)</h4>
<p>服务发现拿到的是一个列表（比如 3 个 IP），具体调用哪一个由客户端决定：</p>
<ul>
<li>在 Spring Cloud 环境中，通常配合 <strong>Spring Cloud LoadBalancer</strong> 或 <strong>Ribbon</strong>。</li>
<li>根据 Nacos 返回的 <strong>Weight（权重）</strong> 进行加权随机访问。</li>
<li>执行最终的 RPC 调用（如 RestTemplate, Feign, Dubbo）。</li>
</ul>
<hr/>
<h3 data-id="heading-7">三、 核心流程图解</h3>
<ol>
<li><strong>Consumer</strong> -&gt; <code>query</code> (gRPC) -&gt; <strong>Nacos Server</strong></li>
<li><strong>Nacos Server</strong> -&gt; <code>result</code> (Instance List) -&gt; <strong>Consumer</strong></li>
<li><strong>Consumer</strong> -&gt; <code>save</code> -&gt; <strong>Memory &amp; Disk Cache</strong></li>
<li><em>(当 Provider 发生变化时)</em></li>
<li><strong>Nacos Server</strong> -&gt; <code>push</code> (New List) -&gt; <strong>Consumer</strong></li>
<li><strong>Consumer</strong> -&gt; <code>update</code> -&gt; <strong>Local Cache</strong></li>
</ol>
<hr/>
<h3 data-id="heading-8">四、 关键特性总结</h3>

























<table><thead><tr><th align="left">特性</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>实时性</strong></td><td align="left">2.x 基于 gRPC 长连接推送，几乎瞬时感知服务变化。</td></tr><tr><td align="left"><strong>高可用 (Self-Protection)</strong></td><td align="left">就算 Nacos 集群挂了，客户端靠本地缓存（磁盘文件）也能正常调用服务。</td></tr><tr><td align="left"><strong>就近访问</strong></td><td align="left">支持按 Cluster 归类，优先调用同机房/同地域的服务，降低延迟。</td></tr><tr><td align="left"><strong>权重调整</strong></td><td align="left">支持在 Nacos 控制台动态修改实例权重，实现灰度发布或平滑下线。</td></tr></tbody></table>
<h3 data-id="heading-9">五、 Nacos 是如何支撑大规模服务发现的？</h3>
<ol>
<li><strong>分级存储</strong>：Namespace -&gt; Group -&gt; Service -&gt; Cluster -&gt; Instance，结构清晰。</li>
<li><strong>UDP/gRPC 推送</strong>：相比全量拉取，推送极大减少了网络带宽消耗。</li>
<li><strong>写时复制 (CopyOnWrite)</strong>：在更新实例列表时，不影响读取操作，保证高性能。</li>
<li><strong>压缩传输</strong>：在返回大量实例时，Nacos 会对数据进行压缩，减少网络开销。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 YOLOv8 的 100 类中药材智能识别实战 [目标检测完整源码]]]></title>    <link>https://juejin.cn/post/7593541291012112411</link>    <guid>https://juejin.cn/post/7593541291012112411</guid>    <pubDate>2026-01-10T15:59:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593541291012112411" data-draft-id="7593311347292405787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 YOLOv8 的 100 类中药材智能识别实战 [目标检测完整源码]"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-10T15:59:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是杰尼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 YOLOv8 的 100 类中药材智能识别实战 [目标检测完整源码]
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是杰尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T15:59:54.000Z" title="Sat Jan 10 2026 15:59:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于 YOLOv8 的 100 类中药材智能识别实战 [目标检测完整源码]</h2>
<h3 data-id="heading-1">引言：中药识别，为什么一定要“检测”而不是“分类”？</h3>
<p>在中药材智能识别领域，很多初学者会优先选择 <strong>图像分类模型（ResNet、EfficientNet）</strong>，但在真实业务环境中，很快就会遇到问题：</p>
<ul>
<li>一张图里 <strong>可能存在多种药材</strong></li>
<li>药材 <strong>大小差异大、遮挡严重</strong></li>
<li>需要 <strong>明确位置与类别</strong>，而不仅是“这是什么”</li>
</ul>
<p>这使得<strong>目标检测模型</strong>成为更合理的技术选择。</p>
<p>本文将系统介绍一个 <strong>基于 YOLOv8 的 100 类中药材检测系统</strong>，覆盖从数据集设计、模型训练，到 PyQt5 可视化部署的完整工程流程，帮助你真正“跑通一个可用的 AI 项目”。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bf244e5d02845b99a2f165654370c3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=PzsWjVgDY3ByA64CiKg2biUgNDc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">源码下载与效果演示</h3>
<p>哔哩哔哩视频下方观看：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1NyGxzaEP2%2F" target="_blank" title="https://www.bilibili.com/video/BV1NyGxzaEP2/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1Ny…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94aff7aedff545269feee91cafabb8f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=fVi4M5O0RjroOjDq7D6XKaJqHC8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>包含：</p>
<p>📦完整项目源码</p>
<p>📦 预训练模型权重</p>
<p>🗂️ 数据集地址（含标注脚本</p>
<h3 data-id="heading-3">一、系统整体架构设计</h3>
<p>整个中药材识别系统由四个核心模块构成：</p>
<pre><code class="hljs">数据集 → YOLOv8 检测模型 → 推理服务 → PyQt5 可视化前端
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/107b3efe54984e22ad14493ec5c52331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=ljTjAwJSr5HJoqQW%2F81pwiTknIo%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0e76dd5a90a460f99a04fa151ecbf20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=kdY%2FJTeB7D6IPgwAuB3PcIcOGxE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-4">技术选型说明</h4>





























<table><thead><tr><th>模块</th><th>技术</th></tr></thead><tbody><tr><td>目标检测</td><td>YOLOv8 (Ultralytics)</td></tr><tr><td>训练框架</td><td>PyTorch</td></tr><tr><td>推理方式</td><td>Python API</td></tr><tr><td>图形界面</td><td>PyQt5</td></tr><tr><td>数据格式</td><td>YOLO Detection 标注</td></tr></tbody></table>
<p>该架构的优势在于：</p>
<ul>
<li><strong>训练与推理解耦</strong></li>
<li>可快速替换模型（n / s / m）</li>
<li>前端无需理解深度学习细节</li>
</ul>
<hr/>
<h3 data-id="heading-5">二、数据集设计与类别体系</h3>
<h4 data-id="heading-6">2.1 类别规模与特点</h4>
<p>本项目共包含 <strong>100 种常见中药材</strong>，涵盖：</p>
<ul>
<li>根茎类（如：人参、黄芪）</li>
<li>果实种子类（如：枳壳、酸枣仁）</li>
<li>动物药材（如：全蝎、地龙）</li>
<li>矿物类（如：自然铜）</li>
</ul>
<p>数据集总规模约 <strong>9,000+ 张图像</strong>，均采用 <strong>目标检测标注方式</strong>，而非整图分类。</p>
<h4 data-id="heading-7">2.2 YOLO 标注格式</h4>
<p>每张图片对应一个 <code>.txt</code> 文件：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">class_id</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">x_center</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">y_center</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">width</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">height</span>&gt;</span>
</code></pre>
<p>所有坐标均为 <strong>归一化比例值</strong>，这使得模型对分辨率变化具备天然适应性。</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac93a4ccd65149eab36560e131c98573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=RdaeGAJy3N2Eul155jHiDjW%2FvqQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-8">三、为什么选择 YOLOv8？</h3>
<p>YOLOv8 是 Ultralytics 在 2023 年发布的新一代 YOLO 系列模型，在工程实践中具备明显优势：</p>
<h4 data-id="heading-9">3.1 架构层面优势</h4>
<ul>
<li><strong>Anchor-Free 设计</strong>，减少人工先验</li>
<li>Task-Aligned Assigner，提高正样本质量</li>
<li>解耦头结构，分类与回归更稳定</li>
</ul>
<h4 data-id="heading-10">3.2 工程层面优势</h4>
<ul>
<li>原生支持 <strong>Detection / Segmentation / Pose</strong></li>
<li>训练、推理、导出统一 API</li>
<li>ONNX / TensorRT 导出流程成熟</li>
</ul>
<p>对于中药材这类 <strong>小目标 + 多类别 + 实拍环境复杂</strong> 的任务，YOLOv8 的性价比非常高。</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f74042c45d4779bd1b4dd03f7237b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=VPKZhzmP%2FBk5bXPjOglzMDnEAok%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-11">四、模型训练流程详解</h3>
<h4 data-id="heading-12">4.1 数据组织结构</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">dataset/
├── images/
│   ├── train
│   └── <span class="hljs-keyword">val</span>
└── labels/
    ├── train
    └── <span class="hljs-keyword">val</span>
</code></pre>
<p>并通过 <code>yaml</code> 文件定义：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">path:</span> <span class="hljs-string">dataset</span>
<span class="hljs-attr">train:</span> <span class="hljs-string">images/train</span>
<span class="hljs-attr">val:</span> <span class="hljs-string">images/val</span>
<span class="hljs-attr">nc:</span> <span class="hljs-number">100</span>
<span class="hljs-attr">names:</span> [<span class="hljs-string">...</span>]
</code></pre>
<h4 data-id="heading-13">4.2 训练命令示例</h4>
<pre><code class="hljs language-bash" lang="bash">yolo detect train \
  model=yolov8n.pt \
  data=herb.yaml \
  epochs=100 \
  batch=16 \
  imgsz=640
</code></pre>
<h4 data-id="heading-14">4.3 训练过程关注指标</h4>
<ul>
<li><code>box_loss</code>：定位质量</li>
<li><code>cls_loss</code>：类别区分能力</li>
<li><code>mAP@0.5</code>：部署可用性判断指标</li>
</ul>
<p>在实验中，当 <strong>mAP@0.5 ≥ 0.9</strong>，模型已具备稳定实用价值。</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbcfecdf9b394bb0aad377109322ba59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=m7%2F6IIdiqEkAd%2Bc9pAsxvNSezMY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-15">五、推理与结果可视化</h3>
<h4 data-id="heading-16">5.1 Python 推理接口</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> ultralytics <span class="hljs-keyword">import</span> YOLO

model = YOLO(<span class="hljs-string">"best.pt"</span>)
results = model(<span class="hljs-string">"test.jpg"</span>, conf=<span class="hljs-number">0.3</span>, save=<span class="hljs-literal">True</span>)
</code></pre>
<p>YOLOv8 会自动输出：</p>
<ul>
<li>边界框</li>
<li>类别名称</li>
<li>置信度</li>
<li>可视化结果图</li>
</ul>
<h4 data-id="heading-17">5.2 检测效果特点</h4>
<ul>
<li>对常见药材识别准确率高</li>
<li>对背景干扰具备一定鲁棒性</li>
<li>支持同图多类别检测</li>
</ul>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40f0e43d867f42ae8741ec0d8331f5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768665594&amp;x-signature=QOjKc84e8nb5A71oTyeeB5hLVPc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-18">六、PyQt5 图形界面设计</h3>
<p>为了降低使用门槛，项目实现了一个 <strong>桌面级可视化检测工具</strong>，支持：</p>
<ul>
<li>单张图片检测</li>
<li>文件夹批量检测</li>
<li>视频流检测</li>
<li>摄像头实时识别</li>
<li>检测结果自动保存</li>
</ul>
<h4 data-id="heading-19">6.1 UI 与模型解耦</h4>
<p>前端仅负责：</p>
<ul>
<li>文件选择</li>
<li>参数配置</li>
<li>结果展示</li>
</ul>
<p>模型逻辑完全独立，方便后期替换或升级。</p>
<hr/>
<h3 data-id="heading-20">七、工程化落地价值</h3>
<p>该项目不仅是一个“能跑的 Demo”，而是具备明确工程价值的系统：</p>
<ul>
<li>可用于 <strong>中药教学演示</strong></li>
<li>可作为 <strong>AI + 中医药</strong> 项目原型</li>
<li>可二次训练，扩展至更多药材</li>
<li>可部署为检测服务或嵌入业务系统</li>
</ul>
<hr/>
<h3 data-id="heading-21">总结</h3>
<p>通过 YOLOv8 + PyQt5 的组合，我们可以用相对低的工程成本，构建一个<strong>从数据到系统完整闭环的中药材识别平台</strong>。</p>
<p>这个项目的意义不在于“模型有多复杂”，而在于：</p>
<ul>
<li>流程完整</li>
<li>结构清晰</li>
<li>易于复现</li>
<li>具备真实落地潜力</li>
</ul>
<p>本文围绕“中药材智能识别”这一典型的 AI 落地场景，系统性地介绍了一个基于 <strong>YOLOv8 的 100 类中药材目标检测工程实践</strong>。从问题背景、数据集设计、模型选型，到训练评估、推理实现以及 PyQt5 可视化部署，完整呈现了一个可复现、可扩展、可实际使用的计算机视觉项目闭环。该方案不仅验证了 YOLOv8 在多类别、小目标复杂场景下的有效性，也体现了将深度学习模型工程化、产品化的实现路径。对于希望深入理解 <strong>CV 技术如何从算法走向真实应用</strong>，或探索 <strong>AI 与中医药数字化融合</strong> 的开发者而言，该项目具备较高的学习价值与实践参考意义。</p>
<p>如果你正在寻找一个 <strong>兼顾算法深度与工程实用性</strong> 的计算机视觉项目，中药材目标检测无疑是一个非常好的切入点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 技能工程入门：从独立能力到协作生态]]></title>    <link>https://juejin.cn/post/7593375360553812018</link>    <guid>https://juejin.cn/post/7593375360553812018</guid>    <pubDate>2026-01-10T14:54:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593375360553812018" data-draft-id="7593541291012014107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 技能工程入门：从独立能力到协作生态"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-10T14:54:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 技能工程入门：从独立能力到协作生态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T14:54:11.000Z" title="Sat Jan 10 2026 14:54:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着大型语言模型（LLM）能力的飞速发展，如何让它们稳定、高效地执行复杂任务，已成为AI工程化的核心挑战。作为应对，<strong>“技能”（Skills）</strong> 作为一种新兴的AI能力封装范式应运而生，而由其引发的AI智能体间的互操作性问题，则催生了以<strong>模型上下文协议（MCP）</strong> 为代表的一系列通信协议。</p>
<p>本文将系统性地介绍技能的概念、开发方法，并深入探讨其与MCP等协议的关系，为你构建下一代智能应用奠定基础。</p>
<h3 data-id="heading-0">技能：模块化与可复用的AI能力单元</h3>
<p>一个“技能”（Skill），尤其是在Anthropic Claude的语境下，可以理解为<strong>一个封装了特定任务指令、执行逻辑与资源的文件夹</strong>。它的核心设计哲学是“渐进式披露”（progressive disclosure）：当AI智能体（如Claude）需要完成一项任务时，它会先扫描所有可用技能的轻量级元数据（仅几十个Token），在确定相关后，再动态加载该技能的完整指令和资源。</p>
<p>这与传统的系统提示或一次性工具调用有本质区别：</p>
<ul>
<li><strong>与提示（Prompts）对比</strong>：提示是临时的、存在于单次对话中的自然语言指令。技能则是<strong>持久化、模块化、可复用</strong>的专业知识包，能够在不同对话中保持一致的行为。</li>
<li><strong>与项目（Projects）对比</strong>：项目是独立的工作区，拥有自己的聊天历史和知识库，侧重于为<strong>长期、复杂的协作任务</strong>提供持久的上下文环境。</li>
<li><strong>与子代理（Sub-agents）对比</strong>：子代理是拥有独立上下文和工具权限的专门化AI助手，适合并行处理或需要严格隔离工具访问的场景。技能则更侧重于定义<strong>任务执行的标准化流程和知识</strong>，本身不一定是独立的“代理”。</li>
</ul>
<p>技能的典型结构包括一个描述用途和操作流程的 <code>SKILL.md</code> 文件，以及可能包含的脚本、模板或资源文件。这种设计实现了<strong>标准化、自动化和可复用</strong>，让AI从“根据指令临时推理”转变为“调用现成方案高效执行”。官方测试数据显示，使用技能后，任务执行效率可提升约40%，错误率下降35%以上。</p>
<h4 data-id="heading-1">技能开发入门实践</h4>
<p>开发一个技能通常遵循以下路径：</p>
<ol>
<li><strong>明确边界与设计</strong>：清晰定义技能的目的、输入、输出及边界条件。例如，一个“代码安全审查技能”需明确其审查标准（如基于OWASP）、审查范围及输出报告格式。</li>
<li><strong>创建技能文件</strong>：在指定目录（如 <code>~/.claude/skills/</code>）创建技能文件夹，并编写核心的 <code>SKILL.md</code> 文件。该文件通常采用Markdown格式，包含技能名称、描述、详细指令、使用示例和最佳实践。</li>
<li><strong>封装资源</strong>：将技能执行所需的脚本、模板或参考数据放入同一文件夹，确保技能自成一体。</li>
<li><strong>测试与共享</strong>：在AI智能体中测试技能效果。技能可以方便地在团队内共享或通过市场分发，实现能力的规模化复用。</li>
</ol>
<h3 data-id="heading-2">MCP：连接AI与外部世界的“桥梁协议”</h3>
<p>如果说技能定义了AI“应该怎么做”，那么<strong>模型上下文协议（Model Context Protocol, MCP）</strong> 则解决了AI“能够访问什么”的问题。</p>
<p>MCP是由Anthropic提出的一种开放标准，其核心功能是<strong>为AI模型提供标准化的接口，以安全、可控的方式访问外部工具、数据源和系统</strong>，如数据库、API、文件系统或SaaS平台。它像一个通用适配器，让不同的外部资源都能以统一的JSON-RPC接口被AI模型调用，无需为每个工具编写硬编码的集成逻辑。</p>
<p>在架构上，MCP采用经典的客户端-服务器模型。AI模型（客户端）通过MCP协议与MCP服务器通信，由服务器代理对实际工具或资源的调用。这种设计实现了<strong>集中控制和安全性</strong>，尤其适合企业环境，但也会引入额外的“代理层”延迟和开发成本。</p>
<p>为了更清晰地理解技能与MCP在智能体架构中的不同角色，可以参考以下对比框架：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph A [能力定义层: 技能 (Skills)]
        direction LR
        A1[“专业技能包&lt;br&gt;（如代码审查、数据分析）”]
        A2[“工作流规范&lt;br&gt;（定义任务步骤与逻辑）”]
        A3[“持久化指令集&lt;br&gt;（确保行为一致性）”]
    end

    subgraph B [能力接入层: 协议 (MCP等)]
        B1[“MCP：模型上下文协议&lt;br&gt;（工具与数据访问）”]
        B2[“A2A：智能体间协议&lt;br&gt;（多智能体协作）”]
    end

    subgraph C [执行资源层]
        C1[外部工具与API]
        C2[数据库与文件系统]
        C3[其他AI智能体]
    end

    A -- “定义‘如何做’” --&gt; B
    B -- “提供‘能访问什么’” --&gt; C
</code></pre>
<p>如图所示，<strong>技能与MCP并非替代关系，而是互补共生的</strong>。一个强大的AI智能体往往需要两者结合：MCP为其打开通往外部世界的大门，提供 raw data（原始数据）和 basic functions（基础功能）；技能则赋予其专业的“工作经验”和“操作手册”，指导它如何高效、规范地利用这些能力和数据完成任务。</p>
<p>例如，在一个智能代码分析场景中：</p>
<ul>
<li><strong>MCP的角色</strong>：通过 <code>claude-context</code> 等MCP服务器，为Claude提供访问整个代码库（如Milvus向量数据库）的能力。</li>
<li><strong>技能的角色</strong>：一个“Milvus代码搜索技能”会定义具体的工作流程，例如：如何构建语义搜索查询、如何按模块和相关性对结果排序、最终如何将分析结果以清晰的Markdown表格呈现给用户。</li>
</ul>
<h3 data-id="heading-3">协议之海：超越MCP的AI协作生态</h3>
<p>MCP主要解决的是<strong>单一智能体与外部工具/数据的连接问题</strong>（即“上下文导向协议”）。然而，当多个AI智能体需要协同工作以解决更复杂的问题时，就需要更高层的<strong>智能体间协议</strong>。这正是当前AI协议生态快速发展的领域。</p>
<p>除了MCP，值得关注的主要协议还包括：</p>





























<table><thead><tr><th align="left">协议名称</th><th align="left">核心提出方</th><th align="left">设计目标与焦点</th><th align="left">典型应用场景</th></tr></thead><tbody><tr><td align="left"><strong>A2A</strong> (Agent-to-Agent)</td><td align="left">Google</td><td align="left"><strong>实现跨供应商、跨框架的智能体互操作与协作</strong>。支持智能体发现、任务委托和复杂工作流编排。</td><td align="left">企业级多智能体系统（如旅行规划中航班、酒店、天气智能体协作）。</td></tr><tr><td align="left"><strong>ACP</strong> (Agent Communication Protocol)</td><td align="left">IBM / Cisco</td><td align="left">支持<strong>受控环境</strong>（如本地、边缘）中智能体间的结构化通信与发现，强调低延迟和本地优先。</td><td align="left">物联网设备集群、机器人舰队、离线边缘AI协调。</td></tr><tr><td align="left"><strong>ANP</strong> (Agent Network Protocol)</td><td align="left">ANP社区</td><td align="left">构建<strong>开放互联网环境</strong>下的去中心化智能体网络，支持基于语义的智能体发现与对等协作。</td><td align="left">跨组织、跨平台的开放式智能体生态。</td></tr></tbody></table>
<p>这些协议与MCP共同构成了一个多层次的标准体系。未来，它们可能走向分工协作（如MCP负责基层工具调用，A2A负责高层多智能体协作）或相互融合。目前，由OpenAI、Anthropic、Google等巨头联合成立的<strong>AI智能体基金会（AAIF）</strong>，正致力于推动包括MCP在内的智能体互操作性标准的中立发展，这有望减少生态碎片化。</p>
<h3 data-id="heading-4">总结与展望：成为AI能力架构师</h3>
<p>理解技能与各类协议，是构建下一代AI原生应用的关键：</p>
<ol>
<li><strong>技能是标准化的“知识胶囊”与“工作流”</strong>：它让AI的行为可预测、可复用、可传承团队经验，是提升AI产出质量与一致性的核心。</li>
<li><strong>MCP是基础“连接器”</strong>：它让AI获得了感知和行动延伸的能力，是智能体接入现实世界的必备基础设施。</li>
<li><strong>协议生态是“协作网络”</strong>：A2A、ACP等协议定义了智能体社会的交流规则，使大规模、跨系统的复杂协作成为可能。</li>
</ol>
<p>对于开发者而言，演进路径已然清晰：从掌握<strong>单一技能的开发</strong>起步，确保其可靠与可用；进而学习利用<strong>MCP</strong> 集成外部能力；最终，在需要构建复杂系统时，探索使用 <strong>A2A等多智能体协议</strong>进行编排。</p>
<p>未来，AI的竞争将不仅是模型能力的竞争，更是<strong>技能库的丰富度、标准化协议的支持度以及整个系统架构合理性</strong>的综合竞争。从“提示词工程师”迈向“AI能力架构师”，正是从这个认知开始。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建高并发AI服务网关：C++与gRPC的工程实践]]></title>    <link>https://juejin.cn/post/7593310044479176713</link>    <guid>https://juejin.cn/post/7593310044479176713</guid>    <pubDate>2026-01-10T14:55:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593310044479176713" data-draft-id="7593528990846566451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建高并发AI服务网关：C++与gRPC的工程实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-10T14:55:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建高并发AI服务网关：C++与gRPC的工程实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T14:55:48.000Z" title="Sat Jan 10 2026 14:55:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着AI服务在企业中的规模化部署，如何高效、可靠地将多个异构AI模型集成到统一的服务架构中，成为后端工程师面临的重要挑战。本文介绍基于C++与gRPC构建高并发AI服务网关的完整实践方案，涵盖架构设计、性能优化、容错机制等关键环节。</p>
<h2 data-id="heading-0">1. 问题背景：AI服务部署的挑战</h2>
<h3 data-id="heading-1">1.1 现状分析</h3>
<p>典型的AI服务部署面临以下痛点：</p>
<ul>
<li><strong>异构环境</strong>：PyTorch、TensorFlow、ONNX等多种框架并存</li>
<li><strong>资源竞争</strong>：GPU内存管理复杂，模型加载/卸载开销大</li>
<li><strong>服务治理缺失</strong>：缺乏统一的路由、监控、熔断机制</li>
<li><strong>协议不统一</strong>：REST、gRPC、自定义TCP协议混合使用</li>
</ul>
<h3 data-id="heading-2">1.2 网关核心需求</h3>
<ul>
<li>支持每秒万级请求的高并发处理</li>
<li>99.99%的可用性保证</li>
<li>平均响应延迟&lt;50ms（含网络开销）</li>
<li>支持动态模型更新与版本管理</li>
</ul>
<h2 data-id="heading-3">2. 架构设计</h2>
<h3 data-id="heading-4">2.1 整体架构</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────┐
│                   客户端请求                      │
└─────────────────┬───────────────────────────────┘
                  │ HTTP/<span class="hljs-number">1.1</span>, HTTP/<span class="hljs-number">2</span>, gRPC
                  ▼
┌─────────────────────────────────────────────────┐
│              AI服务网关 (C++核心)                 │
│  ┌──────────┬──────────┬────────────────────┐  │
│  │请求接收层│ 路由层   │   连接池管理层      │  │
│  │- 多协议  │- 负载均衡│- 健康检查          │  │
│  │- TLS终止 │- 版本路由│- 熔断机制          │  │
│  └──────────┴──────────┴────────────────────┘  │
└─────────────────┬───────────────────────────────┘
                  │ 内部gRPC
      ┌───────────┼───────────┐
      ▼           ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│CV模型服务│ │NLP模型服务│ │推荐模型服务│
│(Python) │ │(Python) │ │(C++)    │
└─────────┘ └─────────┘ └─────────┘
</code></pre>
<h3 data-id="heading-5">2.2 核心组件设计</h3>
<h4 data-id="heading-6">2.2.1 协议适配层</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProtocolAdapter</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">ProtocolAdapter</span>() = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// 统一内部表示</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">UnifiedRequest</span> {
        std::string model_name;
        std::string model_version;
        google::protobuf::Any data;
        std::map&lt;std::string, std::string&gt; metadata;
    };
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">decode</span><span class="hljs-params">(UnifiedRequest&amp; out, 
                       <span class="hljs-type">const</span> std::string&amp; raw_data)</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">encode</span><span class="hljs-params">(<span class="hljs-type">const</span> UnifiedResponse&amp; in,
                       std::string&amp; raw_data)</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-comment">// HTTP适配器实现示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpAdapter</span> : <span class="hljs-keyword">public</span> ProtocolAdapter {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">decode</span><span class="hljs-params">(UnifiedRequest&amp; out, 
               <span class="hljs-type">const</span> std::string&amp; raw_data)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// 解析HTTP请求，提取头部、路径参数</span>
        <span class="hljs-comment">// /v1/models/{model_name}/versions/{version}/predict</span>
        <span class="hljs-comment">// 转换为统一格式</span>
    }
};
</code></pre>
<h4 data-id="heading-7">2.2.2 智能路由层</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Router</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">RoutingResult</span> {
        std::string endpoint;      <span class="hljs-comment">// 后端服务地址</span>
        ModelVersion version;      <span class="hljs-comment">// 模型版本</span>
        <span class="hljs-type">int</span> priority;             <span class="hljs-comment">// 路由优先级</span>
        LoadBalancer* lb;         <span class="hljs-comment">// 负载均衡策略</span>
    };
    
    <span class="hljs-function">RoutingResult <span class="hljs-title">route</span><span class="hljs-params">(<span class="hljs-type">const</span> UnifiedRequest&amp; req)</span> </span>{
        <span class="hljs-comment">// 1. 基于模型名的路由</span>
        <span class="hljs-comment">// 2. 版本控制：canary发布、A/B测试</span>
        <span class="hljs-comment">// 3. 基于内容的路由（如根据图像尺寸选择不同模型）</span>
        <span class="hljs-comment">// 4. 优先级路由（VIP用户走高性能集群）</span>
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 路由规则配置</span>
    std::unordered_map&lt;std::string, RouteConfig&gt; route_table_;
    
    <span class="hljs-comment">// 一致性哈希环，用于会话保持</span>
    ConsistentHashRing&lt;std::string&gt; hash_ring_;
};
</code></pre>
<h2 data-id="heading-8">3. 高性能实现</h2>
<h3 data-id="heading-9">3.1 基于libevent的异步IO</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncIOServer</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">start</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> </span>{
        base_ = <span class="hljs-built_in">event_base_new</span>();
        
        <span class="hljs-comment">// gRPC服务器集成</span>
        grpc::ServerBuilder builder;
        builder.<span class="hljs-built_in">AddListeningPort</span>(
            <span class="hljs-string">"0.0.0.0:"</span> + std::<span class="hljs-built_in">to_string</span>(port),
            grpc::<span class="hljs-built_in">InsecureServerCredentials</span>());
        builder.<span class="hljs-built_in">RegisterService</span>(&amp;grpc_service_);
        
        <span class="hljs-comment">// 与libevent事件循环集成</span>
        <span class="hljs-keyword">auto</span> completion_queue = builder.<span class="hljs-built_in">AddCompletionQueue</span>();
        server_ = builder.<span class="hljs-built_in">BuildAndStart</span>();
        
        <span class="hljs-comment">// 启动处理线程</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; thread_count_; ++i) {
            workers_.<span class="hljs-built_in">emplace_back</span>([<span class="hljs-keyword">this</span>, completion_queue] {
                <span class="hljs-built_in">handle_rpcs</span>(completion_queue);
            });
        }
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_rpcs</span><span class="hljs-params">(grpc::ServerCompletionQueue* cq)</span> </span>{
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">CallData</span>(&amp;service_, cq);  <span class="hljs-comment">// 创建新的调用上下文</span>
        
        <span class="hljs-type">void</span>* tag;
        <span class="hljs-type">bool</span> ok;
        <span class="hljs-keyword">while</span> (cq-&gt;<span class="hljs-built_in">Next</span>(&amp;tag, &amp;ok)) {
            <span class="hljs-keyword">auto</span> call_data = <span class="hljs-built_in">static_cast</span>&lt;CallData*&gt;(tag);
            <span class="hljs-keyword">if</span> (ok) {
                call_data-&gt;<span class="hljs-built_in">proceed</span>();
            } <span class="hljs-keyword">else</span> {
                call_data-&gt;<span class="hljs-built_in">cancel</span>();
            }
        }
    }
};
</code></pre>
<h3 data-id="heading-10">3.2 连接池管理</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Connection</span> {
        std::unique_ptr&lt;ModelService::Stub&gt; stub;
        std::chrono::steady_clock::time_point last_used;
        <span class="hljs-type">bool</span> healthy;
    };
    
    <span class="hljs-function">std::shared_ptr&lt;Connection&gt; <span class="hljs-title">acquire</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; endpoint)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        <span class="hljs-keyword">auto</span>&amp; pool = pools_[endpoint];
        
        <span class="hljs-comment">// 1. 尝试获取空闲连接</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it = pool.<span class="hljs-built_in">begin</span>(); it != pool.<span class="hljs-built_in">end</span>(); ++it) {
            <span class="hljs-keyword">if</span> ((*it)-&gt;healthy &amp;&amp; !(*it)-&gt;in_use) {
                (*it)-&gt;in_use = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">return</span> *it;
            }
        }
        
        <span class="hljs-comment">// 2. 创建新连接（如果未达到上限）</span>
        <span class="hljs-keyword">if</span> (pool.<span class="hljs-built_in">size</span>() &lt; max_per_endpoint_) {
            <span class="hljs-keyword">auto</span> conn = <span class="hljs-built_in">create_connection</span>(endpoint);
            conn-&gt;in_use = <span class="hljs-literal">true</span>;
            pool.<span class="hljs-built_in">push_back</span>(conn);
            <span class="hljs-keyword">return</span> conn;
        }
        
        <span class="hljs-comment">// 3. 等待连接释放（带超时）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">wait_for_connection</span>(endpoint);
    }
    
<span class="hljs-keyword">private</span>:
    std::unordered_map&lt;std::string, std::vector&lt;std::shared_ptr&lt;Connection&gt;&gt;&gt; pools_;
    std::mutex mutex_;
};
</code></pre>
<h3 data-id="heading-11">3.3 零拷贝数据传输</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroCopyBuffer</span> <span class="hljs-keyword">final</span> : <span class="hljs-keyword">public</span> grpc::ByteBuffer {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 使用共享内存或RDMA传输大型张量数据</span>
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">SerializeToZeroCopyStream</span><span class="hljs-params">(
        grpc::ByteBuffer* buffer,
        <span class="hljs-type">const</span> tensorflow::Tensor&amp; tensor)</span> </span>{
        
        <span class="hljs-comment">// 对于大于1MB的张量，使用外部存储</span>
        <span class="hljs-keyword">if</span> (tensor.<span class="hljs-built_in">TotalBytes</span>() &gt; <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>) {
            <span class="hljs-keyword">auto</span> shared_mem = <span class="hljs-built_in">allocate_shared_memory</span>(tensor.<span class="hljs-built_in">TotalBytes</span>());
            tensor.<span class="hljs-built_in">AsProtoTensorContent</span>(shared_mem-&gt;<span class="hljs-built_in">data</span>());
            
            <span class="hljs-comment">// 仅传输内存句柄，而非实际数据</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">send_memory_handle</span>(buffer, shared_mem-&gt;<span class="hljs-built_in">handle</span>());
        }
        
        <span class="hljs-keyword">return</span> grpc::ByteBuffer::<span class="hljs-built_in">SerializeToByteBuffer</span>(tensor, buffer);
    }
};
</code></pre>
<h2 data-id="heading-12">4. 高级特性实现</h2>
<h3 data-id="heading-13">4.1 熔断与降级</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CircuitBreaker</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">enum class</span> <span class="hljs-title class_">State</span> { CLOSED, OPEN, HALF_OPEN };
    
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">allow_request</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        <span class="hljs-keyword">if</span> (state_ == State::OPEN) {
            <span class="hljs-keyword">if</span> (std::chrono::steady_clock::<span class="hljs-built_in">now</span>() &gt; reset_timeout_) {
                state_ = State::HALF_OPEN;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// 尝试恢复</span>
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 熔断中</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_success</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        failure_count_ = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (state_ == State::HALF_OPEN) {
            state_ = State::CLOSED;
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_failure</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        failure_count_++;
        <span class="hljs-keyword">if</span> (failure_count_ &gt;= threshold_ &amp;&amp; state_ == State::CLOSED) {
            state_ = State::OPEN;
            reset_timeout_ = std::chrono::steady_clock::<span class="hljs-built_in">now</span>() + 
                           std::chrono::<span class="hljs-built_in">seconds</span>(reset_timeout_sec_);
        }
    }
    
<span class="hljs-keyword">private</span>:
    State state_ = State::CLOSED;
    <span class="hljs-type">int</span> failure_count_ = <span class="hljs-number">0</span>;
    <span class="hljs-type">int</span> threshold_ = <span class="hljs-number">10</span>;
    std::chrono::steady_clock::time_point reset_timeout_;
    std::mutex mutex_;
};
</code></pre>
<h3 data-id="heading-14">4.2 优先级队列与请求调度</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityRequestQueue</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">PrioritizedRequest</span> {
        UnifiedRequest request;
        <span class="hljs-type">int</span> priority;      <span class="hljs-comment">// 0-9，0最高</span>
        std::chrono::steady_clock::time_point enqueue_time;
        
        <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-type">const</span> PrioritizedRequest&amp; other) <span class="hljs-type">const</span> {
            <span class="hljs-comment">// 优先级高的先处理</span>
            <span class="hljs-keyword">if</span> (priority != other.priority) 
                <span class="hljs-keyword">return</span> priority &gt; other.priority;  
            
            <span class="hljs-comment">// 同优先级，等待时间长的先处理</span>
            <span class="hljs-keyword">return</span> enqueue_time &gt; other.enqueue_time;
        }
    };
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(PrioritizedRequest&amp;&amp; req)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        <span class="hljs-comment">// 如果队列已满，根据策略处理</span>
        <span class="hljs-keyword">if</span> (queue_.<span class="hljs-built_in">size</span>() &gt;= max_size_) {
            <span class="hljs-built_in">handle_queue_full</span>(req);
            <span class="hljs-keyword">return</span>;
        }
        
        queue_.<span class="hljs-built_in">push</span>(std::<span class="hljs-built_in">move</span>(req));
        cv_.<span class="hljs-built_in">notify_one</span>();
    }
    
    <span class="hljs-function">PrioritizedRequest <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        cv_.<span class="hljs-built_in">wait</span>(lock, [<span class="hljs-keyword">this</span>] { 
            <span class="hljs-keyword">return</span> !queue_.<span class="hljs-built_in">empty</span>() || stopped_; 
        });
        
        <span class="hljs-keyword">if</span> (stopped_) <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"Queue stopped"</span>);
        
        <span class="hljs-keyword">auto</span> req = std::<span class="hljs-built_in">move</span>(queue_.<span class="hljs-built_in">top</span>());
        queue_.<span class="hljs-built_in">pop</span>();
        <span class="hljs-keyword">return</span> req;
    }
    
<span class="hljs-keyword">private</span>:
    std::priority_queue&lt;PrioritizedRequest&gt; queue_;
    std::mutex mutex_;
    std::condition_variable cv_;
};
</code></pre>
<h3 data-id="heading-15">4.3 动态批处理</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicBatcher</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_request</span><span class="hljs-params">(<span class="hljs-type">const</span> UnifiedRequest&amp; req,
                     std::promise&lt;UnifiedResponse&gt; promise)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        batch_.<span class="hljs-built_in">push_back</span>({req, std::<span class="hljs-built_in">move</span>(promise)});
        
        <span class="hljs-comment">// 触发批处理条件</span>
        <span class="hljs-keyword">if</span> (batch_.<span class="hljs-built_in">size</span>() &gt;= max_batch_size_ ||
            timer_.<span class="hljs-built_in">elapsed</span>() &gt;= max_delay_ms_) {
            <span class="hljs-built_in">process_batch</span>();
        }
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_batch</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (batch_.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">return</span>;
        
        <span class="hljs-comment">// 1. 将多个请求合并为批次</span>
        BatchedRequest batched_request;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; item : batch_) {
            batched_request.<span class="hljs-built_in">add_requests</span>(item.request);
        }
        
        <span class="hljs-comment">// 2. 发送到支持批量推理的后端</span>
        <span class="hljs-keyword">auto</span> batched_response = stub_-&gt;<span class="hljs-built_in">BatchPredict</span>(batched_request);
        
        <span class="hljs-comment">// 3. 拆分结果并设置promise</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; batch_.<span class="hljs-built_in">size</span>(); ++i) {
            batch_[i].promise.<span class="hljs-built_in">set_value</span>(
                batched_response.<span class="hljs-built_in">responses</span>(i)
            );
        }
        
        batch_.<span class="hljs-built_in">clear</span>();
        timer_.<span class="hljs-built_in">reset</span>();
    }
    
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">BatchItem</span> {
        UnifiedRequest request;
        std::promise&lt;UnifiedResponse&gt; promise;
    };
    
    std::vector&lt;BatchItem&gt; batch_;
    Timer timer_;
};
</code></pre>
<h2 data-id="heading-16">5. 性能优化</h2>
<h3 data-id="heading-17">5.1 内存池优化</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TensorMemoryPool</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">allocate</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> </span>{
        <span class="hljs-comment">// 根据大小选择合适的内存池</span>
        <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">4</span>KB) <span class="hljs-keyword">return</span> small_pool_.<span class="hljs-built_in">allocate</span>(size);
        <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">1</span>MB) <span class="hljs-keyword">return</span> medium_pool_.<span class="hljs-built_in">allocate</span>(size);
        <span class="hljs-keyword">return</span> large_pool_.<span class="hljs-built_in">allocate</span>(size);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deallocate</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> size)</span> </span>{
        <span class="hljs-comment">// 记录分配模式，动态调整池大小</span>
        allocation_stats_.<span class="hljs-built_in">record</span>(size);
        
        <span class="hljs-comment">// 复用内存块而非释放</span>
        <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">4</span>KB) small_pool_.<span class="hljs-built_in">deallocate</span>(ptr, size);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">1</span>MB) medium_pool_.<span class="hljs-built_in">deallocate</span>(ptr, size);
        <span class="hljs-keyword">else</span> large_pool_.<span class="hljs-built_in">deallocate</span>(ptr, size);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 针对不同大小的内存块使用不同的分配策略</span>
    FixedSizeMemoryPool&lt;<span class="hljs-number">4</span> * <span class="hljs-number">1024</span>&gt; small_pool_;     <span class="hljs-comment">// 4KB块</span>
    FixedSizeMemoryPool&lt;<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>&gt; medium_pool_; <span class="hljs-comment">// 1MB块</span>
    std::pmr::monotonic_buffer_resource large_pool_; <span class="hljs-comment">// 大块内存</span>
};
</code></pre>
<h3 data-id="heading-18">5.2 CPU亲和性设置</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set_cpu_affinity</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">cpu_set_t</span> cpuset;
    <span class="hljs-built_in">CPU_ZERO</span>(&amp;cpuset);
    
    <span class="hljs-comment">// 网关线程绑定到CPU 0-3</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i) {
        <span class="hljs-built_in">CPU_SET</span>(i, &amp;cpuset);
    }
    
    <span class="hljs-type">pthread_t</span> current_thread = <span class="hljs-built_in">pthread_self</span>();
    <span class="hljs-built_in">pthread_setaffinity_np</span>(current_thread, 
                          <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">cpu_set_t</span>), &amp;cpuset);
    
    <span class="hljs-comment">// gRPC轮询线程绑定到独立CPU核心</span>
    grpc::ResourceQuota quota;
    quota.<span class="hljs-built_in">SetThreadPoolCores</span>(<span class="hljs-number">2</span>);  <span class="hljs-comment">// 专用CPU核心</span>
}
</code></pre>
<h2 data-id="heading-19">6. 监控与可观测性</h2>
<h3 data-id="heading-20">6.1 多维指标采集</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MetricsCollector</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">record_request</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; model_name,
                       <span class="hljs-type">const</span> std::string&amp; version,
                       <span class="hljs-type">int64_t</span> latency_ms,
                       <span class="hljs-type">bool</span> success)</span> </span>{
        <span class="hljs-comment">// 基础指标</span>
        prometheus::<span class="hljs-type">labels_t</span> labels{
            {<span class="hljs-string">"model"</span>, model_name},
            {<span class="hljs-string">"version"</span>, version},
            {<span class="hljs-string">"status"</span>, success ? <span class="hljs-string">"success"</span> : <span class="hljs-string">"error"</span>}
        };
        
        request_latency_.<span class="hljs-built_in">Add</span>(labels).<span class="hljs-built_in">Observe</span>(latency_ms);
        request_counter_.<span class="hljs-built_in">Add</span>(labels).<span class="hljs-built_in">Increment</span>();
        
        <span class="hljs-comment">// 百分位数计算</span>
        <span class="hljs-keyword">auto</span>&amp; histogram = <span class="hljs-built_in">get_histogram</span>(model_name);
        histogram.<span class="hljs-built_in">add_value</span>(latency_ms);
        
        <span class="hljs-comment">// 实时报警检测</span>
        <span class="hljs-keyword">if</span> (latency_ms &gt; threshold_ms_) {
            <span class="hljs-built_in">alert_slow_request</span>(model_name, latency_ms);
        }
    }
    
<span class="hljs-keyword">private</span>:
    prometheus::Histogram&amp; request_latency_;
    prometheus::Counter&amp; request_counter_;
    
    <span class="hljs-comment">// 滑动窗口统计</span>
    SlidingWindowStats&lt;<span class="hljs-number">1000</span>&gt; window_stats_;  <span class="hljs-comment">// 最近1000个请求</span>
};
</code></pre>
<h3 data-id="heading-21">6.2 分布式追踪集成</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handle_request_with_trace</span><span class="hljs-params">(<span class="hljs-type">const</span> UnifiedRequest&amp; req)</span> </span>{
    <span class="hljs-comment">// 从请求头中提取追踪上下文</span>
    <span class="hljs-keyword">auto</span> trace_context = <span class="hljs-built_in">extract_trace_context</span>(req.metadata);
    
    <span class="hljs-comment">// 创建Span</span>
    <span class="hljs-keyword">auto</span> span = tracer_-&gt;<span class="hljs-built_in">StartSpan</span>(<span class="hljs-string">"gateway.process"</span>);
    span-&gt;<span class="hljs-built_in">SetTag</span>(<span class="hljs-string">"model"</span>, req.model_name);
    span-&gt;<span class="hljs-built_in">SetTag</span>(<span class="hljs-string">"version"</span>, req.model_version);
    
    <span class="hljs-comment">// 注入追踪信息到下游</span>
    <span class="hljs-built_in">inject_trace_context</span>(span-&gt;<span class="hljs-built_in">context</span>(), req.metadata);
    
    <span class="hljs-comment">// 异步记录</span>
    span-&gt;<span class="hljs-built_in">Log</span>({{<span class="hljs-string">"event"</span>, <span class="hljs-string">"start_processing"</span>}});
    
    <span class="hljs-comment">// 确保Span在请求结束时完成</span>
    ON_SCOPE_EXIT {
        span-&gt;<span class="hljs-built_in">Finish</span>();
    };
}
</code></pre>
<h2 data-id="heading-22">7. 压测结果与性能数据</h2>
<h3 data-id="heading-23">7.1 测试环境</h3>
<ul>
<li>硬件：Intel Xeon Platinum 8280, 512GB RAM</li>
<li>网络：10GbE</li>
<li>后端：8个NVIDIA V100节点</li>
</ul>
<h3 data-id="heading-24">7.2 性能指标</h3>








































<table><thead><tr><th>场景</th><th>QPS</th><th>平均延迟</th><th>P99延迟</th><th>CPU使用率</th></tr></thead><tbody><tr><td>单一模型</td><td>12,500</td><td>38ms</td><td>89ms</td><td>65%</td></tr><tr><td>多模型混合</td><td>8,200</td><td>52ms</td><td>121ms</td><td>72%</td></tr><tr><td>熔断触发</td><td>5,000</td><td>45ms</td><td>98ms</td><td>40%</td></tr><tr><td>批量处理(8)</td><td>15,800</td><td>68ms</td><td>152ms</td><td>58%</td></tr></tbody></table>
<h3 data-id="heading-25">7.3 与传统方案的对比</h3>
<ul>
<li><strong>对比纯Python网关</strong>：QPS提升4.2倍，内存使用减少67%</li>
<li><strong>对比Nginx + uWSGI</strong>：延迟降低41%，配置复杂度显著降低</li>
<li><strong>对比Spring Cloud Gateway</strong>：资源开销减少53%，更适合AI负载特性</li>
</ul>
<h2 data-id="heading-26">8. 生产环境部署建议</h2>
<h3 data-id="heading-27">8.1 配置模板</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">gateway:</span>
  <span class="hljs-attr">server:</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
    <span class="hljs-attr">worker_threads:</span> <span class="hljs-number">16</span>
    <span class="hljs-attr">max_connections:</span> <span class="hljs-number">10000</span>
    
  <span class="hljs-attr">routing:</span>
    <span class="hljs-attr">default_timeout_ms:</span> <span class="hljs-number">1000</span>
    <span class="hljs-attr">retry_policy:</span>
      <span class="hljs-attr">max_attempts:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">backoff_ms:</span> <span class="hljs-number">100</span>
      
  <span class="hljs-attr">circuit_breaker:</span>
    <span class="hljs-attr">failure_threshold:</span> <span class="hljs-number">10</span>
    <span class="hljs-attr">reset_timeout_sec:</span> <span class="hljs-number">30</span>
    
  <span class="hljs-attr">batching:</span>
    <span class="hljs-attr">max_batch_size:</span> <span class="hljs-number">16</span>
    <span class="hljs-attr">max_delay_ms:</span> <span class="hljs-number">10</span>
    
  <span class="hljs-attr">monitoring:</span>
    <span class="hljs-attr">metrics_port:</span> <span class="hljs-number">9090</span>
    <span class="hljs-attr">trace_sample_rate:</span> <span class="hljs-number">0.1</span>
</code></pre>
<h3 data-id="heading-28">8.2 滚动更新策略</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 新版本灰度发布</span>
kubectl apply -f gateway-v2-canary.yaml

<span class="hljs-comment"># 2. 流量逐步切换（10% → 50% → 100%）</span>
istioctl set-route gateway-default \
  --weight gateway-v1=90,gateway-v2=10

<span class="hljs-comment"># 3. 监控关键指标</span>
watch -n 1 <span class="hljs-string">'curl http://metrics:9090/qps'</span>

<span class="hljs-comment"># 4. 自动回滚机制</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$ERROR_RATE</span> -gt 5% ]; <span class="hljs-keyword">then</span>
    rollback_to_v1
<span class="hljs-keyword">fi</span>
</code></pre>
<h2 data-id="heading-29">9. 未来演进方向</h2>
<h3 data-id="heading-30">9.1 自适应优化</h3>
<ul>
<li>基于强化学习的动态批处理策略</li>
<li>实时流量预测与弹性伸缩</li>
<li>异常检测与自愈机制</li>
</ul>
<h3 data-id="heading-31">9.2 边缘计算集成</h3>
<ul>
<li>模型分层部署（云端大模型 + 边缘小模型）</li>
<li>联邦学习网关支持</li>
<li>离线推理能力</li>
</ul>
<h2 data-id="heading-32">结论</h2>
<p>本文提出的基于C++与gRPC的AI服务网关方案，在实际生产环境中表现出优异的性能和可靠性。通过连接池管理、智能路由、熔断降级等机制，有效解决了AI服务部署中的关键挑战。C++的高性能特性结合gRPC的现代RPC框架，为构建企业级AI基础设施提供了坚实的技术基础。</p>
<p>该方案已在某头部互联网公司的推荐系统中稳定运行6个月，日均处理请求超过50亿次，可用性达到99.995%。源代码已开源在GitHub（地址见文末），欢迎社区贡献和改进。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端必备动态规划的10道经典题目]]></title>    <link>https://juejin.cn/post/7593241698370437156</link>    <guid>https://juejin.cn/post/7593241698370437156</guid>    <pubDate>2026-01-10T13:36:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593241698370437156" data-draft-id="7593292445299916819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端必备动态规划的10道经典题目"/> <meta itemprop="keywords" content="前端,后端,算法"/> <meta itemprop="datePublished" content="2026-01-10T13:36:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜酱"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端必备动态规划的10道经典题目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T13:36:44.000Z" title="Sat Jan 10 2026 13:36:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读38分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前端必备动态规划：10道经典题目详解（DP五部曲实战）</h2>
<blockquote>
<p>动态规划是前端算法面试的高频考点。本文通过「DP五部曲」框架，手把手带你掌握10道前端必备的DP题目，从基础递推到背包问题，每道题都包含详细注释、易错点分析和前端实际应用场景。</p>
</blockquote>
<p>动态规划零基础的可以先补下</p>
<ul>
<li><a href="https://juejin.cn/post/7591207451778875418" target="_blank" title="https://juejin.cn/post/7591207451778875418">从经典问题入手，吃透动态规划核心</a></li>
<li><a href="https://juejin.cn/post/7591788451029565483" target="_blank" title="https://juejin.cn/post/7591788451029565483">用填充表格法-吃透01背包及其变形</a></li>
<li><a href="https://juejin.cn/post/7592815497848881215" target="_blank" title="https://juejin.cn/post/7592815497848881215">用填充表格法-继续吃透完全背包和多重背包及其变形</a></li>
</ul>
<h3 data-id="heading-1">一、动态规划五部曲（核心框架）</h3>
<p>无论什么DP问题，都可以按以下5个步骤拆解，这是解决DP问题的「万能钥匙」：</p>
<ol>
<li><strong>确定dp数组及下标的含义</strong>：明确 <code>dp[i]</code>（或二维 <code>dp[i][j]</code>）代表什么物理意义（比如"第i阶台阶的爬法数"）</li>
<li><strong>确定递推公式</strong>：找到 <code>dp[i]</code> 与子问题 <code>dp[i-1]</code>/<code>dp[i-2]</code> 等的依赖关系（核心）</li>
<li><strong>dp数组如何初始化</strong>：根据问题边界条件，初始化无法通过递推得到的基础值</li>
<li><strong>确定遍历顺序</strong>：保证计算 <code>dp[i]</code> 时，其依赖的子问题已经被计算完成</li>
<li><strong>打印dp数组（验证）</strong>：通过打印中间结果，验证递推逻辑是否正确（调试必备）</li>
</ol>
<p>下面结合具体问题，逐一实战这套框架。</p>
<hr/>
<h3 data-id="heading-2">二、入门级（3道，理解DP核心三步法，必刷）</h3>
<h4 data-id="heading-3">1. LeetCode70. 爬楼梯 ★</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fclimbing-stairs%2F" target="_blank" title="https://leetcode.cn/problems/climbing-stairs/" ref="nofollow noopener noreferrer">70. 爬楼梯</a></p>
<p><strong>难度</strong>：简单</p>
<p><strong>核心</strong>：单状态转移，入门必做，会基础版 + 空间优化版</p>
<p><strong>前端场景</strong>：步数计算、递归转迭代优化、分页器跳转步数计算、游戏角色移动路径数计算</p>
<p><strong>题目描述</strong>：</p>
<p>假设你正在爬楼梯。需要 <code>n</code> 阶你才能到达楼顶。</p>
<p>每次你可以爬 <code>1</code> 或 <code>2</code> 个台阶。你有多少种不同的方法可以爬到楼顶呢？</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">n</span> = <span class="hljs-number">2</span>
输出：2
解释：有两种方法可以爬到楼顶。
1. 1 阶 + 1 阶
2. 2 阶
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">输入：n = 3
输出：3
解释：有三种方法可以爬到楼顶。
<span class="hljs-bullet">1.</span> 1 阶 + 1 阶 + 1 阶
<span class="hljs-bullet">2.</span> 1 阶 + 2 阶
<span class="hljs-bullet">3.</span> 2 阶 + 1 阶
</code></pre>
<h5 data-id="heading-4">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i]</code> 表示爬到第i阶台阶的不同方法数</li>
<li><strong>递推公式</strong>：<code>dp[i] = dp[i-1] + dp[i-2]</code>（到第i阶的方法=到i-1阶爬1步 + 到i-2阶爬2步）</li>
<li><strong>初始化</strong>：<code>dp[1] = 1</code>（1阶只有1种方法），<code>dp[2] = 2</code>（2阶有2种方法）</li>
<li><strong>遍历顺序</strong>：从左到右（i从3到n）</li>
<li><strong>打印验证</strong>：遍历过程中打印<code>dp[i]</code>，验证方法数是否符合预期</li>
</ol>
<h5 data-id="heading-5">完整版代码（二维DP思想，但实际用一维数组）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode70. 爬楼梯
 * 时间复杂度：O(n)
 * 空间复杂度：O(n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">climbStairs</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i] 表示爬到第i阶台阶的不同方法数</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>);

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  <span class="hljs-comment">// 边界条件：1阶只有1种方法，2阶有2种方法</span>
  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;

  dp[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>; <span class="hljs-comment">// 1阶：只有1种方法（直接爬1阶）</span>
  dp[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>; <span class="hljs-comment">// 2阶：有2种方法（1+1 或 2）</span>

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：从左到右，保证计算dp[i]时dp[i-1]和dp[i-2]已计算</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">3</span>; i &lt;= n; i++) {
    <span class="hljs-comment">// 【步骤2】确定递推公式</span>
    <span class="hljs-comment">// 到达第i阶只有两种方式：</span>
    <span class="hljs-comment">// 1. 从第i-1阶爬1步到达 → 方法数 = dp[i-1]</span>
    <span class="hljs-comment">// 2. 从第i-2阶爬2步到达 → 方法数 = dp[i-2]</span>
    <span class="hljs-comment">// 总方法数 = 两种方式的方法数之和（加法原理）</span>
    dp[i] = dp[i - <span class="hljs-number">1</span>] + dp[i - <span class="hljs-number">2</span>];

    <span class="hljs-comment">// 【步骤5】打印dp数组（验证） - 调试时可以取消注释</span>
    <span class="hljs-comment">// console.log(`dp[${i}] = ${dp[i]}`);</span>
  }

  <span class="hljs-keyword">return</span> dp[n];
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">climbStairs</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">climbStairs</span>(<span class="hljs-number">3</span>)); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">climbStairs</span>(<span class="hljs-number">4</span>)); <span class="hljs-comment">// 5</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">climbStairs</span>(<span class="hljs-number">5</span>)); <span class="hljs-comment">// 8</span>
</code></pre>
<h5 data-id="heading-6">空间优化版（滚动数组）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：滚动数组
 * 时间复杂度：O(n)
 * 空间复杂度：O(1) ← 从O(n)优化到O(1)
 *
 * 【优化思路】
 * 观察递推公式：dp[i] = dp[i-1] + dp[i-2]
 * 发现dp[i]只依赖前两个状态，不需要保存整个数组
 * 可以用三个变量滚动更新：prevPrev(dp[i-2]), prev(dp[i-1]), cur(dp[i])
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">climbStairs</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-comment">// 【易错点1】边界处理：n=1或n=2时需要提前返回</span>
  <span class="hljs-comment">// 如果n=1时进入循环，prevPrev=1, prev=2会计算出错误结果</span>
  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// 初始化：对应dp[1]=1, dp[2]=2</span>
  <span class="hljs-keyword">let</span> prevPrev = <span class="hljs-number">1</span>; <span class="hljs-comment">// dp[i-2]，初始表示dp[1]=1</span>
  <span class="hljs-keyword">let</span> prev = <span class="hljs-number">2</span>; <span class="hljs-comment">// dp[i-1]，初始表示dp[2]=2</span>
  <span class="hljs-keyword">let</span> cur;

  <span class="hljs-comment">// 从第3阶开始计算</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">3</span>; i &lt;= n; i++) {
    <span class="hljs-comment">// 计算当前阶的方法数</span>
    cur = prevPrev + prev;

    <span class="hljs-comment">// 【易错点2】滚动更新顺序很重要：先更新prevPrev，再更新prev</span>
    <span class="hljs-comment">// 如果顺序错误（如先更新prev），会导致prevPrev获取到错误的值</span>
    prevPrev = prev; <span class="hljs-comment">// 下一轮的dp[i-2] = 当前的dp[i-1]</span>
    prev = cur; <span class="hljs-comment">// 下一轮的dp[i-1] = 当前的dp[i]</span>
  }

  <span class="hljs-keyword">return</span> cur;
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>分页器组件</strong>：计算从第1页跳转到第n页的不同路径数（每次可以跳1页或2页）</li>
<li><strong>游戏开发</strong>：角色在台阶上移动，每次可以走1步或2步，计算到达目标位置的方案数</li>
<li><strong>动画路径计算</strong>：计算元素从位置A到位置B的不同动画路径数量</li>
</ul>
<hr/>
<h4 data-id="heading-7">2. LeetCode53. 最大子数组和 ★</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fmaximum-subarray%2F" target="_blank" title="https://leetcode.cn/problems/maximum-subarray/" ref="nofollow noopener noreferrer">53. 最大子数组和</a></p>
<p><strong>难度</strong>：简单</p>
<p><strong>核心</strong>：贪心 + DP 结合，理解「状态转移的条件选择」</p>
<p><strong>前端场景</strong>：数据趋势统计、收益/数值最值分析、股票K线图最大收益区间、用户行为数据峰值分析</p>
<p><strong>题目描述</strong>：</p>
<p>给你一个整数数组 <code>nums</code> ，请你找出一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。</p>
<p>子数组是数组中的一个连续部分。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [-<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,-<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,-<span class="hljs-number">5</span>,<span class="hljs-number">4</span>]
输出：6
解释：连续子数组 <span class="hljs-section">[4,-1,2,1]</span> 的和最大，为 6。
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">1</span>]
输出：1
</code></pre>
<p><strong>示例 3</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>]
输出：23
</code></pre>
<h5 data-id="heading-8">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i]</code> 表示以 <code>nums[i]</code> 为结尾的最大子数组和（注意：必须以nums[i]结尾）</li>
<li><strong>递推公式</strong>：<code>dp[i] = Math.max(nums[i], dp[i-1] + nums[i])</code>（要么重新开始，要么延续前面的和）</li>
<li><strong>初始化</strong>：<code>dp[0] = nums[0]</code>（第一个元素的最大子数组和就是它自己）</li>
<li><strong>遍历顺序</strong>：从左到右（i从1到n-1）</li>
<li><strong>打印验证</strong>：打印dp数组，找到最大值</li>
</ol>
<h5 data-id="heading-9">完整版代码</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode53. 最大子数组和
 * 时间复杂度：O(n)
 * 空间复杂度：O(n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">maxSubArray</span>(<span class="hljs-params">nums</span>) {
  <span class="hljs-keyword">const</span> len = nums.<span class="hljs-property">length</span>;

  <span class="hljs-comment">// 【易错点1】边界处理：空数组返回0</span>
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> nums[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i] 表示以nums[i]为结尾的最大子数组和（注意：必须以nums[i]结尾）</span>
  <span class="hljs-comment">// 这个定义很关键：保证子数组是连续的</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(len);

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  <span class="hljs-comment">// 第一个元素的最大子数组和就是它自己（没有前面的元素可以延续）</span>
  dp[<span class="hljs-number">0</span>] = nums[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 用于记录全局最大值（因为dp[i]只表示以i结尾的最大和，不一定全局最大）</span>
  <span class="hljs-keyword">let</span> maxSum = dp[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：从左到右</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; len; i++) {
    <span class="hljs-comment">// 【步骤2】确定递推公式</span>
    <span class="hljs-comment">// 核心思想：如果前面的和是负数，不如重新开始（贪心思想）</span>
    <span class="hljs-comment">// 两种选择：</span>
    <span class="hljs-comment">// 1. 重新开始：只选当前元素nums[i]（前面的和是负数，拖累总和）</span>
    <span class="hljs-comment">// 2. 延续前面的：dp[i-1] + nums[i]（前面的和是正数，可以继续累加）</span>
    dp[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(nums[i], dp[i - <span class="hljs-number">1</span>] + nums[i]);

    <span class="hljs-comment">// 【易错点2】必须实时更新全局最大值</span>
    <span class="hljs-comment">// 因为dp[i]只是以i结尾的最大和，最终答案不一定是dp[len-1]</span>
    maxSum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxSum, dp[i]);

    <span class="hljs-comment">// 【步骤5】打印验证</span>
    <span class="hljs-comment">// console.log(`dp[${i}] = ${dp[i]}, maxSum = ${maxSum}`);</span>
  }

  <span class="hljs-keyword">return</span> maxSum;
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxSubArray</span>([-<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">5</span>, <span class="hljs-number">4</span>])); <span class="hljs-comment">// 6</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxSubArray</span>([<span class="hljs-number">1</span>])); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxSubArray</span>([<span class="hljs-number">5</span>, <span class="hljs-number">4</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>])); <span class="hljs-comment">// 23</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxSubArray</span>([-<span class="hljs-number">1</span>])); <span class="hljs-comment">// -1</span>
</code></pre>
<h5 data-id="heading-10">空间优化版（只需一个变量）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：滚动变量
 * 时间复杂度：O(n)
 * 空间复杂度：O(1) ← 从O(n)优化到O(1)
 *
 * 【优化思路】
 * dp[i]只依赖dp[i-1]，不需要保存整个数组
 * 用一个变量prev保存上一个状态即可
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">maxSubArray</span>(<span class="hljs-params">nums</span>) {
  <span class="hljs-keyword">const</span> len = nums.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> nums[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 用prev代替dp[i-1]，初始值为dp[0]</span>
  <span class="hljs-keyword">let</span> prev = nums[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">let</span> maxSum = prev;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; len; i++) {
    <span class="hljs-comment">// 计算当前状态：要么重新开始，要么延续前面的</span>
    prev = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(nums[i], prev + nums[i]);

    <span class="hljs-comment">// 更新全局最大值</span>
    maxSum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxSum, prev);
  }

  <span class="hljs-keyword">return</span> maxSum;
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>股票K线图</strong>：计算某段时间内买入卖出的最大收益（价格差的最大连续子数组和）</li>
<li><strong>用户行为分析</strong>：分析用户在某段时间内的活跃度峰值（数据流的最大连续区间和）</li>
<li><strong>性能监控</strong>：找到服务器响应时间最差的连续时间段（负值转换为响应时间）</li>
<li><strong>数据可视化</strong>：在折线图中高亮显示数据增长最快的连续区间</li>
</ul>
<hr/>
<h4 data-id="heading-11">3. LeetCode198. 打家劫舍 ★</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fhouse-robber%2F" target="_blank" title="https://leetcode.cn/problems/house-robber/" ref="nofollow noopener noreferrer">198. 打家劫舍</a></p>
<p><strong>难度</strong>：简单</p>
<p><strong>核心</strong>：状态转移的「条件限制」（相邻不选），基础空间优化</p>
<p><strong>前端场景</strong>：资源筛选、最优选择问题、权限分配优化、任务调度（不能同时执行相邻任务）</p>
<p><strong>题目描述</strong>：</p>
<p>你是一个专业的小偷，计划偷窃沿街的房屋。每间房内都藏有一定的现金，相邻的房屋装有相互连通的防盗系统，如果两间相邻的房屋在同一晚上被小偷闯入，系统会自动报警。</p>
<p>给定一个代表每个房屋存放金额的非负整数数组 <code>nums</code>，请计算你不触动警报装置的情况下，一夜之内能够偷窃到的最高金额。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>]
输出：4
解释：偷窃 1 号房屋（金额 = 1），然后偷窃 3 号房屋（金额 = 3）。总金额 = 1 + <span class="hljs-attr">3</span> = <span class="hljs-number">4</span>。
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">9</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>]
输出：12
解释：偷窃 1 号房屋（金额 = 2），然后偷窃 3 号房屋（金额 = 9），接着偷窃 5 号房屋（金额 = 1）。总金额 = 2 + 9 + <span class="hljs-attr">1</span> = <span class="hljs-number">12</span>。
</code></pre>
<h5 data-id="heading-12">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i]</code> 表示前i间房屋能偷到的最高金额
<ul>
<li>可以用二维状态：<code>dp[i][0]</code> 表示第i间不偷，<code>dp[i][1]</code> 表示第i间偷</li>
</ul>
</li>
<li><strong>递推公式</strong>：
<ul>
<li><code>dp[i][0] = Math.max(dp[i-1][0], dp[i-1][1])</code>（不偷当前，前一间可偷可不偷）</li>
<li><code>dp[i][1] = dp[i-1][0] + nums[i-1]</code>（偷当前，前一间必须不偷）</li>
</ul>
</li>
<li><strong>初始化</strong>：<code>dp[0] = [0, 0]</code>（前0间，偷或不偷都是0）</li>
<li><strong>遍历顺序</strong>：从左到右（i从1到n）</li>
<li><strong>打印验证</strong>：打印dp数组验证</li>
</ol>
<h5 data-id="heading-13">完整版代码（二维状态）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode198. 打家劫舍
 * 时间复杂度：O(n)
 * 空间复杂度：O(n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">rob</span>(<span class="hljs-params">nums</span>) {
  <span class="hljs-keyword">const</span> len = nums.<span class="hljs-property">length</span>;

  <span class="hljs-comment">// 【易错点1】边界处理</span>
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> nums[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i][0] = 前i间房屋，第i间不偷能获取的最高金额</span>
  <span class="hljs-comment">// dp[i][1] = 前i间房屋，第i间偷能获取的最高金额</span>
  <span class="hljs-comment">// 使用二维状态可以清晰地表达"相邻不能同时偷"的约束</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(len + <span class="hljs-number">1</span>);

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  <span class="hljs-comment">// 前0间房屋：不偷和偷的金额都是0（没有房屋可偷）</span>
  dp[<span class="hljs-number">0</span>] = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>];

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：从左到右</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) {
    <span class="hljs-comment">// 【易错点2】数组索引转换：dp[i]对应nums[i-1]</span>
    <span class="hljs-comment">// dp[1]对应nums[0]（第1间房屋），dp[2]对应nums[1]（第2间房屋）</span>
    <span class="hljs-keyword">const</span> curVal = nums[i - <span class="hljs-number">1</span>];

    <span class="hljs-comment">// 【步骤2】确定递推公式</span>
    <span class="hljs-comment">// 状态1：第i间不偷 → 前i-1间可以偷也可以不偷，取最大值</span>
    <span class="hljs-keyword">const</span> valNotThief = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...dp[i - <span class="hljs-number">1</span>]);

    <span class="hljs-comment">// 状态2：第i间偷 → 前i-1间必须不偷（相邻不能同时偷），加上当前金额</span>
    <span class="hljs-comment">// 【易错点3】必须是dp[i-1][0]，不能是dp[i-1][1]（违反相邻规则）</span>
    <span class="hljs-keyword">const</span> valThief = curVal + dp[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>];

    <span class="hljs-comment">// 更新当前状态</span>
    dp[i] = [valNotThief, valThief];

    <span class="hljs-comment">// 【步骤5】打印验证</span>
    <span class="hljs-comment">// console.log(`dp[${i}] = [不偷:${valNotThief}, 偷:${valThief}]`);</span>
  }

  <span class="hljs-comment">// 最终结果：前len间房屋偷或不偷的最大值</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...dp[len]);
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">rob</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>])); <span class="hljs-comment">// 4</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">rob</span>([<span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>])); <span class="hljs-comment">// 12</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">rob</span>([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>])); <span class="hljs-comment">// 4</span>
</code></pre>
<h5 data-id="heading-14">空间优化版（两个变量）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：滚动变量
 * 时间复杂度：O(n)
 * 空间复杂度：O(1) ← 从O(n)优化到O(1)
 *
 * 【优化思路】
 * 观察递推公式：dp[i]只依赖dp[i-1]的两个值
 * 可以用两个变量vNot和vYes滚动更新
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">rob</span>(<span class="hljs-params">nums</span>) {
  <span class="hljs-keyword">const</span> len = nums.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> nums[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 初始化：对应dp[0] = [0, 0]</span>
  <span class="hljs-keyword">let</span> vNot = <span class="hljs-number">0</span>; <span class="hljs-comment">// 前i间不偷的最大值</span>
  <span class="hljs-keyword">let</span> vYes = <span class="hljs-number">0</span>; <span class="hljs-comment">// 前i间偷的最大值</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) {
    <span class="hljs-keyword">const</span> curVal = nums[i - <span class="hljs-number">1</span>];

    <span class="hljs-comment">// 【易错点4】关键：提前保存上一轮的所有状态，避免更新时覆盖</span>
    <span class="hljs-comment">// 如果直接使用vNot和vYes，更新vNot时可能会用到已经更新的vYes值</span>
    <span class="hljs-keyword">const</span> prevNot = vNot;
    <span class="hljs-keyword">const</span> prevYes = vYes;

    <span class="hljs-comment">// 不偷当前间：上一轮偷或不偷的最大值</span>
    vNot = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(prevNot, prevYes);

    <span class="hljs-comment">// 偷当前间：上一轮不偷的最大值 + 当前金额</span>
    <span class="hljs-comment">// 【易错点5】必须用prevNot，不能用vNot（因为vNot已经更新了）</span>
    vYes = curVal + prevNot;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(vNot, vYes);
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>任务调度</strong>：在任务列表中，某些任务不能同时执行（有依赖关系），求最大收益</li>
<li><strong>权限分配</strong>：某些权限不能同时授予（互斥权限），求最大权限价值组合</li>
<li><strong>资源选择</strong>：在资源列表中，相邻资源有冲突，求最优选择方案</li>
<li><strong>广告投放优化</strong>：相邻时段的广告不能同时投放，求最大收益的投放方案</li>
</ul>
<hr/>
<h3 data-id="heading-15">三、经典应用级（4道，DP核心考点，高频考）</h3>
<h4 data-id="heading-16">4. LeetCode62. 不同路径 ★</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Funique-paths%2F" target="_blank" title="https://leetcode.cn/problems/unique-paths/" ref="nofollow noopener noreferrer">62. 不同路径</a></p>
<p><strong>难度</strong>：中等</p>
<p><strong>核心</strong>：二维DP基础（可优化为一维），理解「路径型DP」</p>
<p><strong>前端场景</strong>：可视化布局路径计算、网格类问题、Canvas/SVG路径绘制、游戏地图路径规划</p>
<p><strong>题目描述</strong>：</p>
<p>一个机器人位于一个 <code>m x n</code> 网格的左上角 （起始点在下图中标记为 "Start" ）。</p>
<p>机器人每次只能向下或者向右移动一步。机器人试图达到网格的右下角（在下图中标记为 "Finish"）。</p>
<p>问总共有多少条不同的路径？</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">m</span> = <span class="hljs-number">3</span>, n = <span class="hljs-number">7</span>
输出：28
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">输入：m = 3, n = 2
输出：3
解释：从左上角开始，总共有 3 条路径可以到达右下角：
<span class="hljs-bullet">1.</span> 向右 → 向下 → 向下
<span class="hljs-bullet">2.</span> 向下 → 向下 → 向右
<span class="hljs-bullet">3.</span> 向下 → 向右 → 向下
</code></pre>
<h5 data-id="heading-17">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i][j]</code> 表示从起点(0,0)走到位置(i,j)的不同路径数</li>
<li><strong>递推公式</strong>：<code>dp[i][j] = dp[i-1][j] + dp[i][j-1]</code>（只能从上方或左方来）</li>
<li><strong>初始化</strong>：
<ul>
<li>第一行所有位置：<code>dp[0][j] = 1</code>（只能从左边来）</li>
<li>第一列所有位置：<code>dp[i][0] = 1</code>（只能从上边来）</li>
</ul>
</li>
<li><strong>遍历顺序</strong>：从上到下、从左到右（双重循环）</li>
<li><strong>打印验证</strong>：打印dp数组验证</li>
</ol>
<h5 data-id="heading-18">完整版代码（二维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode62. 不同路径
 * 时间复杂度：O(m * n)
 * 空间复杂度：O(m * n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">uniquePaths</span>(<span class="hljs-params">m, n</span>) {
  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i][j] 表示从左上角(0,0)走到位置(i,j)的不同路径数</span>
  <span class="hljs-comment">// 为了方便处理边界，使用dp[i+1][j+1]表示网格(i,j)的路径数</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>));

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  <span class="hljs-comment">// 第一行（i=1）：所有位置只能从左边来，路径数都是1</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) {
    dp[<span class="hljs-number">1</span>][j] = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 第一列（j=1）：所有位置只能从上边来，路径数都是1</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) {
    dp[i][<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：从上到下、从左到右</span>
  <span class="hljs-comment">// 从(2,2)开始，因为第一行和第一列已经初始化</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt;= m; i++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">2</span>; j &lt;= n; j++) {
      <span class="hljs-comment">// 【步骤2】确定递推公式</span>
      <span class="hljs-comment">// 走到(i,j)只有两种方式：</span>
      <span class="hljs-comment">// 1. 从上方(i-1,j)向下走一步 → 路径数 = dp[i-1][j]</span>
      <span class="hljs-comment">// 2. 从左方(i,j-1)向右走一步 → 路径数 = dp[i][j-1]</span>
      <span class="hljs-comment">// 总路径数 = 两种方式的路径数之和（加法原理）</span>
      dp[i][j] = dp[i - <span class="hljs-number">1</span>][j] + dp[i][j - <span class="hljs-number">1</span>];
    }
  }

  <span class="hljs-comment">// 【步骤5】打印验证（调试时取消注释）</span>
  <span class="hljs-comment">// console.log('DP数组：');</span>
  <span class="hljs-comment">// for (let i = 1; i &lt;= m; i++) {</span>
  <span class="hljs-comment">//   console.log(dp[i].slice(1).join(' '));</span>
  <span class="hljs-comment">// }</span>

  <span class="hljs-keyword">return</span> dp[m][n];
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>)); <span class="hljs-comment">// 28</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>)); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniquePaths</span>(<span class="hljs-number">7</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 28</span>
</code></pre>
<h5 data-id="heading-19">空间优化版（一维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：一维DP
 * 时间复杂度：O(m * n)
 * 空间复杂度：O(n) ← 从O(m*n)优化到O(n)
 *
 * 【优化思路】
 * 观察递推公式：dp[i][j] = dp[i-1][j] + dp[i][j-1]
 * 计算第i行时，只需要用到：
 * 1. 上一行第j列的值（dp[i-1][j]）→ 对应更新前的dp[j]
 * 2. 当前行第j-1列的值（dp[i][j-1]）→ 对应更新后的dp[j-1]
 * 可以用一维数组dp[j]滚动更新
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">uniquePaths</span>(<span class="hljs-params">m, n</span>) {
  <span class="hljs-comment">// 【步骤1】一维dp数组：dp[j]表示当前行第j列的路径数</span>
  <span class="hljs-comment">// 初始化为第一行的值：所有位置路径数都是1（只能从左边来）</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">1</span>);

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：从第2行开始遍历</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt;= m; i++) {
    <span class="hljs-comment">// 【易错点1】j从2开始，因为第1列（j=1）的值永远是1（只能从上边来）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">2</span>; j &lt;= n; j++) {
      <span class="hljs-comment">// 【步骤2】递推公式（一维版）</span>
      <span class="hljs-comment">// dp[j]（更新前）= 上一行第j列的路径数（dp[i-1][j]）</span>
      <span class="hljs-comment">// dp[j-1]（更新后）= 当前行第j-1列的路径数（dp[i][j-1]）</span>
      <span class="hljs-comment">// 更新：dp[j] = dp[j]（旧值，来自上方）+ dp[j-1]（新值，来自左方）</span>
      dp[j] = dp[j] + dp[j - <span class="hljs-number">1</span>];

      <span class="hljs-comment">// 【易错点2】注意：这里dp[j-1]是已经更新的值（当前行），</span>
      <span class="hljs-comment">// 而dp[j]是旧值（上一行），正好符合递推公式的需求</span>
    }
  }

  <span class="hljs-keyword">return</span> dp[n];
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>Canvas/SVG路径绘制</strong>：计算从起点到终点的不同绘制路径数量</li>
<li><strong>游戏地图</strong>：计算角色从起点到终点的移动方案数（只能向右或向下）</li>
<li><strong>网格布局计算</strong>：在CSS Grid或Flex布局中，计算元素排列的不同路径数</li>
<li><strong>路由规划</strong>：在地图应用中，计算从A点到B点的不同路线数量</li>
</ul>
<hr/>
<h4 data-id="heading-20">5. LeetCode63. 不同路径 II</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Funique-paths-ii%2F" target="_blank" title="https://leetcode.cn/problems/unique-paths-ii/" ref="nofollow noopener noreferrer">63. 不同路径 II</a></p>
<p><strong>难度</strong>：中等</p>
<p><strong>核心</strong>：带障碍的路径DP，学会「状态转移的边界判断」</p>
<p><strong>前端场景</strong>：网格布局中的障碍物处理、表单验证路径计算、游戏地图障碍物路径规划</p>
<p><strong>题目描述</strong>：</p>
<p>一个机器人位于一个 <code>m x n</code> 网格的左上角（起始点在下图中标记为 "Start" ）。</p>
<p>机器人每次只能向下或者向右移动一步。机器人试图达到网格的右下角（在下图中标记为 "Finish"）。</p>
<p>现在考虑网格中有障碍物。那么从左上角到右下角将会有多少条不同的路径？</p>
<p>网格中的障碍物和空位置分别用 <code>1</code> 和 <code>0</code> 来表示。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-lua" lang="lua">输入：obstacleGrid = <span class="hljs-string">[[0,0,0],[0,1,0],[0,0,0]]</span>
输出：<span class="hljs-number">2</span>
解释：<span class="hljs-number">3</span>x3 网格的正中间有一个障碍物。
从左上角到右下角一共有 <span class="hljs-number">2</span> 条不同的路径：
<span class="hljs-number">1.</span> 向右 → 向右 → 向下 → 向下
<span class="hljs-number">2.</span> 向下 → 向下 → 向右 → 向右
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-lua" lang="lua">输入：obstacleGrid = <span class="hljs-string">[[0,1],[0,0]]</span>
输出：<span class="hljs-number">1</span>
</code></pre>
<h5 data-id="heading-21">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i][j]</code> 表示从起点到达位置(i,j)的路径数</li>
<li><strong>递推公式</strong>：
<ul>
<li>如果(i,j)是障碍物：<code>dp[i][j] = 0</code></li>
<li>否则：<code>dp[i][j] = dp[i-1][j] + dp[i][j-1]</code></li>
</ul>
</li>
<li><strong>初始化</strong>：
<ul>
<li>第一行：遇到障碍物前都是1，遇到障碍物后都是0</li>
<li>第一列：遇到障碍物前都是1，遇到障碍物后都是0</li>
</ul>
</li>
<li><strong>遍历顺序</strong>：从上到下、从左到右</li>
<li><strong>打印验证</strong>：打印dp数组验证</li>
</ol>
<h5 data-id="heading-22">完整版代码（二维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode63. 不同路径 II（带障碍物）
 * 时间复杂度：O(m * n)
 * 空间复杂度：O(m * n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">uniquePathsWithObstacles</span>(<span class="hljs-params">obstacleGrid</span>) {
  <span class="hljs-keyword">const</span> m = obstacleGrid.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> n = obstacleGrid[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>;

  <span class="hljs-comment">// 【易错点1】边界处理：起点或终点是障碍物，直接返回0</span>
  <span class="hljs-keyword">if</span> (obstacleGrid[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === <span class="hljs-number">1</span> || obstacleGrid[m - <span class="hljs-number">1</span>][n - <span class="hljs-number">1</span>] === <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }

  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i][j] 表示从起点到达位置(i-1,j-1)的路径数（索引从1开始便于处理边界）</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>));

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  <span class="hljs-comment">// 初始化第一行：只能从左边来，遇到障碍物则后续位置无法到达</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) {
    <span class="hljs-keyword">const</span> curGrid = obstacleGrid[<span class="hljs-number">0</span>][j - <span class="hljs-number">1</span>]; <span class="hljs-comment">// 网格索引转换</span>
    <span class="hljs-keyword">if</span> (curGrid === <span class="hljs-number">1</span>) {
      <span class="hljs-comment">// 【易错点2】遇到障碍物，后续位置都无法到达，直接跳出</span>
      <span class="hljs-keyword">break</span>;
    }
    dp[<span class="hljs-number">1</span>][j] = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 初始化第一列：只能从上边来，遇到障碍物则后续位置无法到达</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt;= m; i++) {
    <span class="hljs-comment">// 【易错点3】从i=2开始，因为dp[1][1]已在第一行初始化</span>
    <span class="hljs-keyword">const</span> curGrid = obstacleGrid[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (curGrid === <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">break</span>;
    }
    dp[i][<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：从第2行第2列开始</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt;= m; i++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">2</span>; j &lt;= n; j++) {
      <span class="hljs-comment">// 网格索引转换：dp[i][j]对应网格(i-1, j-1)</span>
      <span class="hljs-keyword">const</span> curGrid = obstacleGrid[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>];

      <span class="hljs-comment">// 【步骤2】确定递推公式</span>
      <span class="hljs-keyword">if</span> (curGrid === <span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 【易错点4】当前位置是障碍物，无法到达，路径数为0</span>
        dp[i][j] = <span class="hljs-number">0</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 当前位置不是障碍物，可以从上方或左方到达</span>
        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j] + dp[i][j - <span class="hljs-number">1</span>];
      }
    }
  }

  <span class="hljs-keyword">return</span> dp[m][n];
}
</code></pre>
<h5 data-id="heading-23">空间优化版（一维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：一维DP
 * 时间复杂度：O(m * n)
 * 空间复杂度：O(n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">uniquePathsWithObstacles</span>(<span class="hljs-params">obstacleGrid</span>) {
  <span class="hljs-keyword">const</span> m = obstacleGrid.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> n = obstacleGrid[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>;

  <span class="hljs-keyword">if</span> (obstacleGrid[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === <span class="hljs-number">1</span> || obstacleGrid[m - <span class="hljs-number">1</span>][n - <span class="hljs-number">1</span>] === <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }

  <span class="hljs-comment">// 一维dp数组：dp[j]表示当前行第j列的路径数</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// 初始化第一行</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) {
    <span class="hljs-keyword">const</span> curGrid = obstacleGrid[<span class="hljs-number">0</span>][j - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (curGrid === <span class="hljs-number">1</span>) <span class="hljs-keyword">break</span>;
    dp[j] = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 从第2行开始遍历</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt;= m; i++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) {
      <span class="hljs-keyword">const</span> curGrid = obstacleGrid[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>];

      <span class="hljs-keyword">if</span> (curGrid === <span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 【易错点5】障碍物位置路径数置0</span>
        dp[j] = <span class="hljs-number">0</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (j === <span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 第一列：只能从上边来，保持dp[j]不变（如果上边是障碍物，dp[j]已经是0）</span>
        <span class="hljs-comment">// 不需要更新，因为第一列的路径数在初始化时已经确定</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 非第一列：可以从上方或左方到达</span>
        dp[j] = dp[j] + dp[j - <span class="hljs-number">1</span>];
      }
    }
  }

  <span class="hljs-keyword">return</span> dp[n];
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>表单验证</strong>：在复杂的多步骤表单中，某些步骤可能被禁用（障碍物），计算完成表单的不同路径</li>
<li><strong>游戏地图</strong>：在游戏中，某些格子是障碍物，计算从起点到终点的路径数</li>
<li><strong>权限路由</strong>：在权限系统中，某些路由节点被禁用，计算用户可访问的路由路径数</li>
<li><strong>工作流设计</strong>：在工作流中，某些节点可能被跳过，计算完成流程的不同路径</li>
</ul>
<hr/>
<h4 data-id="heading-24">6. LeetCode213. 打家劫舍 II</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fhouse-robber-ii%2F" target="_blank" title="https://leetcode.cn/problems/house-robber-ii/" ref="nofollow noopener noreferrer">213. 打家劫舍 II</a></p>
<p><strong>难度</strong>：中等</p>
<p><strong>核心</strong>：环形DP，拆分为两个基础DP问题（分治思想）</p>
<p><strong>前端场景</strong>：环形资源分配、循环任务调度、权限系统中的循环依赖处理</p>
<p><strong>题目描述</strong>：</p>
<p>你是一个专业的小偷，计划偷窃沿街的房屋，每间房内都藏有一定的现金。这个地方所有的房屋都围成一圈，这意味着第一个房屋和最后一个房屋是紧挨着的。同时，相邻的房屋装有相互连通的防盗系统，如果两间相邻的房屋在同一晚上被小偷闯入，系统会自动报警。</p>
<p>给定一个代表每个房屋存放金额的非负整数数组 <code>nums</code>，请计算你在不触动警报装置的情况下，今晚能够偷窃到的最高金额。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>]
输出：3
解释：你不能先偷窃 1 号房屋（金额 = 2），然后偷窃 3 号房屋（金额 = 2），因为他们是相邻的。
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>]
输出：4
解释：你可以先偷窃 1 号房屋（金额 = 1），然后偷窃 3 号房屋（金额 = 3）。偷窃到的最高金额 = 1 + <span class="hljs-attr">3</span> = <span class="hljs-number">4</span>。
</code></pre>
<p><strong>示例 3</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]
输出：3
</code></pre>
<h5 data-id="heading-25">DP五部曲分析（分治思想）</h5>
<p><strong>核心思路</strong>：环形问题转化为两个线性问题</p>
<ul>
<li>情况1：不偷第一间（可以偷最后一间）→ 转换为线性问题：偷 [1, len-1]</li>
<li>情况2：不偷最后一间（可以偷第一间）→ 转换为线性问题：偷 [0, len-2]</li>
<li>取两种情况的最大值</li>
</ul>
<h5 data-id="heading-26">完整版代码</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode213. 打家劫舍 II（环形）
 * 时间复杂度：O(n)
 * 空间复杂度：O(n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">rob</span>(<span class="hljs-params">nums</span>) {
  <span class="hljs-keyword">const</span> len = nums.<span class="hljs-property">length</span>;

  <span class="hljs-comment">// 【易错点1】边界处理</span>
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> nums[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(nums[<span class="hljs-number">0</span>], nums[<span class="hljs-number">1</span>]);

  <span class="hljs-comment">// 【核心思路】环形问题拆分为两个线性问题</span>
  <span class="hljs-comment">// 情况1：不偷第一间（可以偷最后一间）→ 范围 [1, len-1]</span>
  <span class="hljs-comment">// 情况2：不偷最后一间（可以偷第一间）→ 范围 [0, len-2]</span>
  <span class="hljs-comment">// 取两种情况的最大值</span>

  <span class="hljs-comment">/**
   * 辅助函数：线性数组的打家劫舍（LeetCode198的解法）
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">arr</span> - 线性房屋数组
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">number</span>} - 能偷到的最大金额
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">robLinear</span>(<span class="hljs-params">arr</span>) {
    <span class="hljs-keyword">const</span> n = arr.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (n === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> arr[<span class="hljs-number">0</span>];

    <span class="hljs-comment">// 二维状态DP</span>
    <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>);
    dp[<span class="hljs-number">0</span>] = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]; <span class="hljs-comment">// 前0间：不偷和偷都是0</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
      <span class="hljs-keyword">const</span> curVal = arr[i - <span class="hljs-number">1</span>];
      <span class="hljs-comment">// 不偷当前间：前i-1间偷或不偷的最大值</span>
      <span class="hljs-keyword">const</span> valNotThief = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...dp[i - <span class="hljs-number">1</span>]);
      <span class="hljs-comment">// 偷当前间：前i-1间必须不偷</span>
      <span class="hljs-keyword">const</span> valThief = curVal + dp[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>];
      dp[i] = [valNotThief, valThief];
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...dp[n]);
  }

  <span class="hljs-comment">// 情况1：不偷第一间，范围是nums[1]到nums[len-1]</span>
  <span class="hljs-keyword">const</span> case1 = <span class="hljs-title function_">robLinear</span>(nums.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>));

  <span class="hljs-comment">// 情况2：不偷最后一间，范围是nums[0]到nums[len-2]</span>
  <span class="hljs-keyword">const</span> case2 = <span class="hljs-title function_">robLinear</span>(nums.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, len - <span class="hljs-number">1</span>));

  <span class="hljs-comment">// 【易错点2】返回两种情况的最大值</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(case1, case2);
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">rob</span>([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>])); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">rob</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>])); <span class="hljs-comment">// 4</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">rob</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])); <span class="hljs-comment">// 3</span>
</code></pre>
<h5 data-id="heading-27">空间优化版（使用滚动变量）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：robLinear函数使用滚动变量
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">rob</span>(<span class="hljs-params">nums</span>) {
  <span class="hljs-keyword">const</span> len = nums.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> nums[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(nums[<span class="hljs-number">0</span>], nums[<span class="hljs-number">1</span>]);

  <span class="hljs-comment">// 辅助函数：线性数组打家劫舍（空间优化版）</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">robLinear</span>(<span class="hljs-params">arr</span>) {
    <span class="hljs-keyword">const</span> n = arr.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (n === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> arr[<span class="hljs-number">0</span>];

    <span class="hljs-keyword">let</span> vNot = <span class="hljs-number">0</span>; <span class="hljs-comment">// 不偷的最大值</span>
    <span class="hljs-keyword">let</span> vYes = <span class="hljs-number">0</span>; <span class="hljs-comment">// 偷的最大值</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
      <span class="hljs-keyword">const</span> curVal = arr[i];
      <span class="hljs-keyword">const</span> prevNot = vNot;
      <span class="hljs-keyword">const</span> prevYes = vYes;

      vNot = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(prevNot, prevYes);
      vYes = curVal + prevNot;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(vNot, vYes);
  }

  <span class="hljs-keyword">const</span> case1 = <span class="hljs-title function_">robLinear</span>(nums.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>));
  <span class="hljs-keyword">const</span> case2 = <span class="hljs-title function_">robLinear</span>(nums.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, len - <span class="hljs-number">1</span>));

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(case1, case2);
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>循环任务调度</strong>：在循环列表中，某些任务不能同时执行，求最大收益的调度方案</li>
<li><strong>环形权限分配</strong>：在权限环中，相邻权限互斥，求最大权限价值组合</li>
<li><strong>资源循环利用</strong>：在循环资源池中，某些资源不能同时使用，求最优资源分配</li>
<li><strong>时间轮调度</strong>：在时间轮算法中，计算最优的任务执行方案</li>
</ul>
<hr/>
<h4 data-id="heading-28">7. LeetCode322. 零钱兑换 ★</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcoin-change%2F" target="_blank" title="https://leetcode.cn/problems/coin-change/" ref="nofollow noopener noreferrer">322. 零钱兑换</a></p>
<p><strong>难度</strong>：中等</p>
<p><strong>核心</strong>：完全背包基础版，理解「最值型DP」的状态转移</p>
<p><strong>前端场景</strong>：金额/资源最优分配、最少步骤问题、支付找零算法、资源最小化配置</p>
<p><strong>题目描述</strong>：</p>
<p>给你一个整数数组 <code>coins</code> ，表示不同面额的硬币；以及一个整数 <code>amount</code> ，表示总金额。</p>
<p>计算并返回可以凑成总金额所需的 最少的硬币个数 。如果没有任何一种硬币组合能组成总金额，返回 <code>-1</code> 。</p>
<p>你可以认为每种硬币的数量是无限的。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">coins</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>], amount = <span class="hljs-number">11</span>
输出：3
解释：<span class="hljs-attr">11</span> = <span class="hljs-number">5</span> + <span class="hljs-number">5</span> + <span class="hljs-number">1</span>
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">coins</span> = [<span class="hljs-number">2</span>], amount = <span class="hljs-number">3</span>
输出：-1
解释：无法凑成总金额 3
</code></pre>
<p><strong>示例 3</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">coins</span> = [<span class="hljs-number">1</span>], amount = <span class="hljs-number">0</span>
输出：0
</code></pre>
<h5 data-id="heading-29">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i][j]</code> 表示用前i种硬币凑出金额j所需的最少硬币个数</li>
<li><strong>递推公式</strong>：
<ul>
<li>不选第i种硬币：<code>dp[i][j] = dp[i-1][j]</code></li>
<li>选第i种硬币：<code>dp[i][j] = dp[i][j-coins[i-1]] + 1</code>（注意是<code>dp[i]</code>不是<code>dp[i-1]</code>，因为可以重复选）</li>
<li>取最小值：<code>dp[i][j] = Math.min(dp[i-1][j], dp[i][j-coins[i-1]] + 1)</code></li>
</ul>
</li>
<li><strong>初始化</strong>：
<ul>
<li><code>dp[0][0] = 0</code>（0种硬币凑0元需要0个）</li>
<li><code>dp[0][j&gt;0] = Infinity</code>（0种硬币无法凑正数金额）</li>
<li><code>dp[i][0] = 0</code>（凑0元永远需要0个）</li>
</ul>
</li>
<li><strong>遍历顺序</strong>：外层遍历硬币种类，内层遍历金额（正序，因为是完全背包）</li>
<li><strong>打印验证</strong>：打印dp数组验证</li>
</ol>
<h5 data-id="heading-30">完整版代码（二维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode322. 零钱兑换（完全背包-最值型）
 * 时间复杂度：O(coins.length * amount)
 * 空间复杂度：O(coins.length * amount)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">coinChange</span>(<span class="hljs-params">coins, amount</span>) {
  <span class="hljs-keyword">const</span> coinCount = coins.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> target = amount;

  <span class="hljs-comment">// 【易错点1】边界处理：凑0元直接返回0</span>
  <span class="hljs-keyword">if</span> (target === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i][j] = 用前i种硬币凑出金额j所需的最少硬币个数</span>
  <span class="hljs-comment">// 初始化：所有值先填Infinity（表示初始无法凑出）</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(coinCount + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(target + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Infinity</span>));

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// 0种硬币凑0元，需要0个</span>
  <span class="hljs-comment">// 0种硬币凑正数金额，无法凑出（保持Infinity）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= target; j++) {
    dp[<span class="hljs-number">0</span>][j] = <span class="hljs-title class_">Infinity</span>;
  }

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：外层遍历硬币种类，内层遍历金额（正序）</span>
  <span class="hljs-comment">// 正序遍历是因为完全背包：每种硬币可以使用无限次</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= coinCount; i++) {
    dp[i][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// 凑0元永远需要0个硬币</span>
    <span class="hljs-keyword">const</span> curCoin = coins[i - <span class="hljs-number">1</span>]; <span class="hljs-comment">// 【易错点2】数组索引转换：第i种硬币对应coins[i-1]</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= target; j++) {
      <span class="hljs-keyword">if</span> (j &lt; curCoin) {
        <span class="hljs-comment">// 金额不足，无法使用当前硬币，继承前i-1种硬币的结果</span>
        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j];
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 【步骤2】确定递推公式</span>
        <span class="hljs-comment">// 完全背包核心：用当前硬币时是dp[i][j-curCoin]+1（而非dp[i-1]）</span>
        <span class="hljs-comment">// 因为硬币可以重复使用，所以用dp[i]（已经考虑了当前硬币）</span>
        dp[i][j] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
          dp[i - <span class="hljs-number">1</span>][j], <span class="hljs-comment">// 不用第i种硬币</span>
          dp[i][j - curCoin] + <span class="hljs-number">1</span> <span class="hljs-comment">// 用第i种硬币（注意是dp[i]，可以重复选）</span>
        );
      }
    }
  }

  <span class="hljs-comment">// 【易错点3】无法凑出时返回-1，而非Infinity</span>
  <span class="hljs-keyword">return</span> dp[coinCount][target] === <span class="hljs-title class_">Infinity</span> ? -<span class="hljs-number">1</span> : dp[coinCount][target];
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">coinChange</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>], <span class="hljs-number">11</span>)); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">coinChange</span>([<span class="hljs-number">2</span>], <span class="hljs-number">3</span>)); <span class="hljs-comment">// -1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">coinChange</span>([<span class="hljs-number">1</span>], <span class="hljs-number">0</span>)); <span class="hljs-comment">// 0</span>
</code></pre>
<h5 data-id="heading-31">空间优化版（一维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：一维DP
 * 时间复杂度：O(coins.length * amount)
 * 空间复杂度：O(amount) ← 从O(coins.length * amount)优化到O(amount)
 *
 * 【优化思路】
 * 观察递推公式：dp[i][j] = Math.min(dp[i-1][j], dp[i][j-coins[i-1]] + 1)
 * 计算dp[i][j]时只需要：
 * 1. 上一行第j列的值（dp[i-1][j]）→ 对应更新前的dp[j]
 * 2. 当前行第j-coins[i-1]列的值（dp[i][j-coins[i-1]]）→ 对应更新后的dp[j-coins[i-1]]
 * 可以用一维数组dp[j]正序遍历（完全背包特征：正序）
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">coinChange</span>(<span class="hljs-params">coins, amount</span>) {
  <span class="hljs-keyword">const</span> coinCount = coins.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> target = amount;

  <span class="hljs-keyword">if</span> (target === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 【步骤1】一维dp数组：dp[j] = 凑出金额j所需的最少硬币个数</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(target + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Infinity</span>);

  <span class="hljs-comment">// 【步骤3】初始化</span>
  dp[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// 凑0元需要0个硬币</span>

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：外层遍历硬币，内层正序遍历金额</span>
  <span class="hljs-comment">// 【易错点4】完全背包必须正序遍历：保证每种硬币可以使用无限次</span>
  <span class="hljs-comment">// 如果倒序遍历，就变成了01背包（每种硬币只能用一次）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= coinCount; i++) {
    <span class="hljs-keyword">const</span> curCoin = coins[i - <span class="hljs-number">1</span>];

    <span class="hljs-comment">// 【易错点5】从curCoin开始遍历，避免j&lt;curCoin的无效判断</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = curCoin; j &lt;= target; j++) {
      <span class="hljs-comment">// 【步骤2】递推公式（一维版）</span>
      <span class="hljs-comment">// dp[j]（更新前）= 不用当前硬币的最少个数（上一轮的结果）</span>
      <span class="hljs-comment">// dp[j - curCoin] + 1 = 用当前硬币的最少个数（当前轮已更新的结果）</span>
      dp[j] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(dp[j], dp[j - curCoin] + <span class="hljs-number">1</span>);
    }
  }

  <span class="hljs-comment">// 【易错点6】返回前检查是否为Infinity</span>
  <span class="hljs-keyword">return</span> dp[target] === <span class="hljs-title class_">Infinity</span> ? -<span class="hljs-number">1</span> : dp[target];
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>支付找零</strong>：在支付系统中，计算用最少硬币数找零给用户</li>
<li><strong>资源最小化配置</strong>：在资源分配中，用最少的资源组合达到目标值</li>
<li><strong>API调用优化</strong>：计算用最少的API调用次数完成某个任务</li>
<li><strong>组件懒加载</strong>：计算用最少的组件加载次数完成页面渲染</li>
</ul>
<hr/>
<h4 data-id="heading-32">8. LeetCode518. 零钱兑换 II</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcoin-change-ii%2F" target="_blank" title="https://leetcode.cn/problems/coin-change-ii/" ref="nofollow noopener noreferrer">518. 零钱兑换 II</a></p>
<p><strong>难度</strong>：中等</p>
<p><strong>核心</strong>：完全背包的「组合数型DP」，与322（最值型）做区分</p>
<p><strong>前端场景</strong>：组合方案统计、支付方式组合数计算、资源配置方案数统计</p>
<p><strong>题目描述</strong>：</p>
<p>给你一个整数数组 <code>coins</code> 表示不同面额的硬币，另给一个整数 <code>amount</code> 表示总金额。</p>
<p>请你计算并返回可以凑成总金额的硬币组合数。如果任何硬币组合都无法凑出总金额，返回 0 。</p>
<p>假设每一种面额的硬币有无限个。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">amount</span> = <span class="hljs-number">5</span>, coins = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>]
输出：4
解释：有四种方式可以凑成总金额：
<span class="hljs-attr">5</span>=<span class="hljs-number">5</span>
<span class="hljs-attr">5</span>=<span class="hljs-number">2</span>+<span class="hljs-number">2</span>+<span class="hljs-number">1</span>
<span class="hljs-attr">5</span>=<span class="hljs-number">2</span>+<span class="hljs-number">1</span>+<span class="hljs-number">1</span>+<span class="hljs-number">1</span>
<span class="hljs-attr">5</span>=<span class="hljs-number">1</span>+<span class="hljs-number">1</span>+<span class="hljs-number">1</span>+<span class="hljs-number">1</span>+<span class="hljs-number">1</span>
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">amount</span> = <span class="hljs-number">3</span>, coins = [<span class="hljs-number">2</span>]
输出：0
解释：只用面额 2 的硬币无法凑成总金额 3。
</code></pre>
<p><strong>示例 3</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">amount</span> = <span class="hljs-number">10</span>, coins = [<span class="hljs-number">10</span>]
输出：1
</code></pre>
<h5 data-id="heading-33">DP五部曲分析（与322的区别）</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i][j]</code> 表示用前i种硬币凑出金额j的组合数（注意：是组合数，不是最少个数）</li>
<li><strong>递推公式</strong>：
<ul>
<li>不选第i种硬币：<code>dp[i][j] = dp[i-1][j]</code></li>
<li>选第i种硬币：<code>dp[i][j] = dp[i][j-coins[i-1]]</code>（注意是加法，不是取最小值）</li>
<li>总组合数：<code>dp[i][j] = dp[i-1][j] + dp[i][j-coins[i-1]]</code></li>
</ul>
</li>
<li><strong>初始化</strong>：
<ul>
<li><code>dp[0][0] = 1</code>（0种硬币凑0元，有1种组合：不选任何硬币）</li>
<li><code>dp[i][0] = 1</code>（凑0元永远只有1种组合）</li>
<li><code>dp[0][j&gt;0] = 0</code>（0种硬币无法凑正数金额）</li>
</ul>
</li>
<li><strong>遍历顺序</strong>：外层遍历硬币（保证组合不重复），内层正序遍历金额</li>
<li><strong>打印验证</strong>：打印dp数组验证</li>
</ol>
<h5 data-id="heading-34">完整版代码（二维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode518. 零钱兑换 II（完全背包-组合数型）
 * 时间复杂度：O(coins.length * amount)
 * 空间复杂度：O(coins.length * amount)
 *
 * 【与322的区别】
 * - 322求：最少的硬币个数（最值型）→ Math.min
 * - 518求：组合数（计数型）→ 加法
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">amount, coins</span>) {
  <span class="hljs-keyword">const</span> coinCount = coins.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> targetAmount = amount;

  <span class="hljs-comment">// 【易错点1】边界处理：凑0元返回1（唯一组合：不选任何硬币）</span>
  <span class="hljs-keyword">if</span> (targetAmount === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i][j] = 用前i种硬币凑出金额j的组合数</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(coinCount + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(targetAmount + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>));

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  <span class="hljs-comment">// 【易错点2】凑0元的组合数是1（不选任何硬币），不是0</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= coinCount; i++) {
    dp[i][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>; <span class="hljs-comment">// 凑0元永远只有1种组合</span>
  }

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：外层遍历硬币，内层正序遍历金额</span>
  <span class="hljs-comment">// 【关键】外层遍历硬币保证了组合不重复：如[1,2]和[2,1]被视为同一种组合</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= coinCount; i++) {
    <span class="hljs-keyword">const</span> currentCoin = coins[i - <span class="hljs-number">1</span>]; <span class="hljs-comment">// 【易错点3】数组索引转换</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= targetAmount; j++) {
      <span class="hljs-keyword">if</span> (j &lt; currentCoin) {
        <span class="hljs-comment">// 金额不足，无法用当前硬币，继承前i-1种的组合数</span>
        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j];
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 【步骤2】确定递推公式（组合数 = 不用 + 用）</span>
        <span class="hljs-comment">// dp[i-1][j]：不用第i种硬币的组合数</span>
        <span class="hljs-comment">// dp[i][j-currentCoin]：用第i种硬币的组合数（注意是dp[i]，可重复选）</span>
        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j] + dp[i][j - currentCoin];
      }
    }
  }

  <span class="hljs-comment">// 无法凑出时自然返回0（符合题目要求）</span>
  <span class="hljs-keyword">return</span> dp[coinCount][targetAmount];
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">change</span>(<span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>])); <span class="hljs-comment">// 4</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">change</span>(<span class="hljs-number">3</span>, [<span class="hljs-number">2</span>])); <span class="hljs-comment">// 0</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">change</span>(<span class="hljs-number">10</span>, [<span class="hljs-number">10</span>])); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">change</span>(<span class="hljs-number">0</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>])); <span class="hljs-comment">// 1</span>
</code></pre>
<h5 data-id="heading-35">空间优化版（一维DP）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：一维DP
 * 时间复杂度：O(coins.length * amount)
 * 空间复杂度：O(amount)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">amount, coins</span>) {
  <span class="hljs-keyword">const</span> coinCount = coins.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> targetAmount = amount;

  <span class="hljs-keyword">if</span> (targetAmount === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// 【步骤1】一维dp数组：dp[j] = 凑出金额j的组合数</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(targetAmount + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
  dp[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>; <span class="hljs-comment">// 【核心初始化】凑0元的组合数为1</span>

  <span class="hljs-comment">// 【步骤4】遍历顺序：外层遍历硬币，内层正序遍历金额</span>
  <span class="hljs-comment">// 【关键理解】外层遍历硬币 → 保证组合数不重复</span>
  <span class="hljs-comment">// 如果外层遍历金额，内层遍历硬币，会得到排列数（顺序有关）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= coinCount; i++) {
    <span class="hljs-keyword">const</span> currentCoin = coins[i - <span class="hljs-number">1</span>];

    <span class="hljs-comment">// 【易错点4】完全背包：金额正序遍历（从currentCoin开始）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = currentCoin; j &lt;= targetAmount; j++) {
      <span class="hljs-comment">// 【步骤2】递推公式（一维版）</span>
      <span class="hljs-comment">// dp[j]（更新前）= 不用当前硬币的组合数（上一轮的结果）</span>
      <span class="hljs-comment">// dp[j - currentCoin]（更新后）= 用当前硬币的组合数（当前轮已更新的结果）</span>
      dp[j] = dp[j] + dp[j - currentCoin];
    }
  }

  <span class="hljs-keyword">return</span> dp[targetAmount];
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>支付方式组合</strong>：计算用户可以用多少种不同的支付方式组合完成支付</li>
<li><strong>资源配置方案</strong>：计算有多少种不同的资源配置方案可以达到目标</li>
<li><strong>功能组合统计</strong>：计算有多少种不同的功能组合可以满足用户需求</li>
<li><strong>优惠券组合</strong>：计算有多少种不同的优惠券组合可以使用</li>
</ul>
<hr/>
<h3 data-id="heading-36">四、进阶拓展级（3道，中大厂加分，理解即可）</h3>
<h4 data-id="heading-37">9. LeetCode300. 最长递增子序列</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Flongest-increasing-subsequence%2F" target="_blank" title="https://leetcode.cn/problems/longest-increasing-subsequence/" ref="nofollow noopener noreferrer">300. 最长递增子序列</a></p>
<p><strong>难度</strong>：中等</p>
<p><strong>核心</strong>：单维度DP的经典拓展，理解「非连续状态转移」</p>
<p><strong>前端场景</strong>：数据趋势分析、序列统计、时间线组件、用户行为序列分析</p>
<p><strong>题目描述</strong>：</p>
<p>给你一个整数数组 <code>nums</code> ，找到其中最长严格递增子序列的长度。</p>
<p>子序列是由数组派生而来的序列，删除（或不删除）数组中的元素而不改变其余元素的顺序。例如，<code>[3,6,2,7]</code> 是数组 <code>[0,3,1,6,2,2,7]</code> 的子序列。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">10</span>,<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">101</span>,<span class="hljs-number">18</span>]
输出：4
解释：最长递增子序列是 <span class="hljs-section">[2,3,7,101]</span>，因此长度为 4。
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]
输出：4
解释：最长递增子序列是 <span class="hljs-section">[0,1,2,3]</span>，长度为 4
</code></pre>
<p><strong>示例 3</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">nums</span> = [<span class="hljs-number">7</span>,<span class="hljs-number">7</span>,<span class="hljs-number">7</span>,<span class="hljs-number">7</span>,<span class="hljs-number">7</span>,<span class="hljs-number">7</span>,<span class="hljs-number">7</span>]
输出：1
解释：最长递增子序列是 <span class="hljs-section">[7]</span>，长度为 1
</code></pre>
<h5 data-id="heading-38">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i]</code> 表示以 <code>nums[i]</code> 为最后一个元素的最长严格递增子序列的长度</li>
<li><strong>递推公式</strong>：
<ul>
<li>对于每个 <code>nums[i]</code>，遍历前面所有元素 <code>nums[j]</code> (j &lt; i)</li>
<li>如果 <code>nums[i] &gt; nums[j]</code>，则 <code>nums[i]</code> 可以接在 <code>nums[j]</code> 的子序列后面</li>
<li><code>dp[i] = Math.max(dp[i], dp[j] + 1)</code> （在所有满足条件的j中取最大值）</li>
</ul>
</li>
<li><strong>初始化</strong>：<code>dp[i] = 1</code>（每个元素自身构成长度为1的子序列）</li>
<li><strong>遍历顺序</strong>：外层遍历i（从1到n-1），内层遍历j（从0到i-1）</li>
<li><strong>打印验证</strong>：打印dp数组，返回最大值（注意：最长子序列不一定以最后一个元素结尾）</li>
</ol>
<h5 data-id="heading-39">完整版代码</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode300. 最长递增子序列
 * 时间复杂度：O(n²)
 * 空间复杂度：O(n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLIS</span>(<span class="hljs-params">nums</span>) {
  <span class="hljs-keyword">const</span> count = nums.<span class="hljs-property">length</span>;

  <span class="hljs-comment">// 【易错点1】边界处理：空数组/单元素数组</span>
  <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> count;

  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i] = 以nums[i]为最后一个元素的最长严格递增子序列的长度</span>
  <span class="hljs-comment">// 【易错点2】初始化错误：必须初始化为1，不能初始化为0</span>
  <span class="hljs-comment">// 因为每个元素自身至少构成长度为1的子序列</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(count).<span class="hljs-title function_">fill</span>(<span class="hljs-number">1</span>);

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：外层遍历i，内层遍历j</span>
  <span class="hljs-comment">// 【易错点3】i从1开始：i=0时前面没有元素，无法计算</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; count; i++) {
    <span class="hljs-keyword">const</span> curNum = nums[i]; <span class="hljs-comment">// 当前元素</span>

    <span class="hljs-comment">// 内层遍历：检查i前面所有元素j（而非仅j=i-1）</span>
    <span class="hljs-comment">// 【易错点4】必须遍历所有j&lt;i，不能只遍历j=i-1</span>
    <span class="hljs-comment">// 因为子序列可以非连续，nums[i]可以接在任意满足条件的nums[j]后面</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; i; j++) {
      <span class="hljs-comment">// 【步骤2】确定递推公式</span>
      <span class="hljs-comment">// 【易错点5】递增条件：必须是严格递增（&gt;），不能是&gt;=</span>
      <span class="hljs-keyword">if</span> (curNum &gt; nums[j]) {
        <span class="hljs-comment">// 如果nums[i] &gt; nums[j]，则nums[i]可以接在nums[j]的子序列后面</span>
        <span class="hljs-comment">// 取所有满足条件的dp[j]+1的最大值</span>
        dp[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(dp[i], dp[j] + <span class="hljs-number">1</span>);
      }
    }

    <span class="hljs-comment">// 【步骤5】打印验证</span>
    <span class="hljs-comment">// console.log(`dp[${i}] = ${dp[i]}`);</span>
  }

  <span class="hljs-comment">// 【易错点6】返回错误：不能返回dp[count-1]</span>
  <span class="hljs-comment">// 因为最长递增子序列不一定以最后一个元素结尾</span>
  <span class="hljs-comment">// 必须返回dp数组中的最大值</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...dp);
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">lengthOfLIS</span>([<span class="hljs-number">10</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">101</span>, <span class="hljs-number">18</span>])); <span class="hljs-comment">// 4</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">lengthOfLIS</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])); <span class="hljs-comment">// 4</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">lengthOfLIS</span>([<span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>])); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">lengthOfLIS</span>([<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>])); <span class="hljs-comment">// 6</span>
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>时间线组件</strong>：在时间线中，找到最长连续增长的时间段</li>
<li><strong>用户行为分析</strong>：分析用户行为序列中最长的正向发展趋势</li>
<li><strong>数据可视化</strong>：在图表中高亮显示数据的最长递增区间</li>
<li><strong>版本号比较</strong>：找到版本号序列中最长的递增子序列</li>
</ul>
<hr/>
<h4 data-id="heading-40">10. LeetCode121. 买卖股票的最佳时机 ★</h4>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fbest-time-to-buy-and-sell-stock%2F" target="_blank" title="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock/" ref="nofollow noopener noreferrer">121. 买卖股票的最佳时机</a></p>
<p><strong>难度</strong>：简单</p>
<p><strong>核心</strong>：DP + 贪心结合，也可纯DP实现，理解「状态定义的简化」</p>
<p><strong>前端场景</strong>：数据趋势、收益计算、股票K线图分析、价格波动分析</p>
<p><strong>题目描述</strong>：</p>
<p>给定一个数组 <code>prices</code> ，它的第 <code>i</code> 个元素 <code>prices[i]</code> 表示一支给定股票第 <code>i</code> 天的价格。</p>
<p>你只能选择 某一天 买入这只股票，并选择在 未来的某一个不同的日子 卖出该股票。设计一个算法来计算你所能获取的最大利润。</p>
<p>如果你不能获取任何利润，返回 0 。</p>
<p><strong>示例 1</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-section">[7,1,5,3,6,4]</span>
输出：5
解释：在第 2 天（股票价格 = 1）的时候买入，在第 5 天（股票价格 = 6）的时候卖出，最大利润 = <span class="hljs-attr">6-1</span> = <span class="hljs-number">5</span>。
     注意利润不能是 <span class="hljs-attr">7-1</span> = <span class="hljs-number">6</span>, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。
</code></pre>
<p><strong>示例 2</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">prices</span> = [<span class="hljs-number">7</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>]
输出：0
解释：在这种情况下, 交易无法完成, 所以返回 0。
</code></pre>
<h5 data-id="heading-41">DP五部曲分析</h5>
<ol>
<li><strong>dp数组含义</strong>：<code>dp[i]</code> 表示第i天卖出股票能获得的最大利润</li>
<li><strong>递推公式</strong>：<code>dp[i] = prices[i] - minPrice</code>（当天价格减去之前的最小价格）</li>
<li><strong>初始化</strong>：<code>dp[0] = 0</code>（第0天无法卖出），<code>minPrice = prices[0]</code></li>
<li><strong>遍历顺序</strong>：从左到右（i从1到n-1），同时维护最小价格</li>
<li><strong>打印验证</strong>：打印dp数组，返回最大值（注意：最大利润不一定在最后一天卖出）</li>
</ol>
<h5 data-id="heading-42">完整版代码</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * LeetCode121. 买卖股票的最佳时机
 * 时间复杂度：O(n)
 * 空间复杂度：O(n)
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">maxProfit</span>(<span class="hljs-params">prices</span>) {
  <span class="hljs-keyword">const</span> count = prices.<span class="hljs-property">length</span>;

  <span class="hljs-comment">// 【易错点1】边界处理：空数组/单元素数组</span>
  <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 【步骤1】确定dp数组及下标的含义</span>
  <span class="hljs-comment">// dp[i] = 第i天卖出股票能获得的最大利润</span>
  <span class="hljs-keyword">const</span> dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(count).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// 【步骤3】dp数组如何初始化</span>
  <span class="hljs-comment">// 第0天无法卖出（必须先买入），利润为0</span>
  dp[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 维护遍历到当前的最小价格（用于计算利润）</span>
  <span class="hljs-keyword">let</span> minPrice = prices[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 初始买入价格是第0天的价格</span>

  <span class="hljs-comment">// 【步骤4】确定遍历顺序：从左到右</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; count; i++) {
    <span class="hljs-keyword">const</span> curPrice = prices[i]; <span class="hljs-comment">// 当天价格</span>

    <span class="hljs-comment">// 【核心逻辑1】更新最小价格（必须先更新，再计算利润）</span>
    <span class="hljs-comment">// 【易错点2】顺序错误：如果先计算利润再更新minPrice，会导致"当天买当天卖"的逻辑错误</span>
    <span class="hljs-comment">// 正确的顺序：先更新minPrice（基于之前的价格），再计算当天卖出的利润</span>
    minPrice = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(minPrice, curPrice);

    <span class="hljs-comment">// 【步骤2】确定递推公式</span>
    <span class="hljs-comment">// 第i天卖出的最大利润 = 当天价格 - 之前的最小价格（最佳买入点）</span>
    <span class="hljs-comment">// 如果结果为负，dp[i]保持0（等价于不交易）</span>
    dp[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, curPrice - minPrice);

    <span class="hljs-comment">// 【步骤5】打印验证</span>
    <span class="hljs-comment">// console.log(`第${i}天：价格=${curPrice}, 最小价格=${minPrice}, 利润=${dp[i]}`);</span>
  }

  <span class="hljs-comment">// 【易错点3】返回错误：不能返回dp[count-1]</span>
  <span class="hljs-comment">// 因为最大利润不一定在最后一天卖出（如示例1中最大利润在第5天，不是最后一天）</span>
  <span class="hljs-comment">// 必须返回dp数组中的最大值</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...dp);
}

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxProfit</span>([<span class="hljs-number">7</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>])); <span class="hljs-comment">// 5</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxProfit</span>([<span class="hljs-number">7</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>])); <span class="hljs-comment">// 0</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxProfit</span>([<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>])); <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxProfit</span>([<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>])); <span class="hljs-comment">// 4</span>
</code></pre>
<h5 data-id="heading-43">空间优化版（只需一个变量）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 空间优化版：贪心思想
 * 时间复杂度：O(n)
 * 空间复杂度：O(1) ← 从O(n)优化到O(1)
 *
 * 【优化思路】
 * 观察：dp[i]只依赖dp[i-1]和minPrice
 * 而且我们只需要最大值，不需要保存整个dp数组
 * 用一个变量maxProfit实时更新最大值即可
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">maxProfit</span>(<span class="hljs-params">prices</span>) {
  <span class="hljs-keyword">const</span> count = prices.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

  <span class="hljs-keyword">let</span> minPrice = prices[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 最小买入价格</span>
  <span class="hljs-keyword">let</span> maxProfit = <span class="hljs-number">0</span>; <span class="hljs-comment">// 最大利润</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; count; i++) {
    <span class="hljs-keyword">const</span> curPrice = prices[i];

    <span class="hljs-comment">// 更新最小价格</span>
    minPrice = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(minPrice, curPrice);

    <span class="hljs-comment">// 计算当天卖出的利润，并更新最大利润</span>
    maxProfit = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxProfit, curPrice - minPrice);
  }

  <span class="hljs-keyword">return</span> maxProfit;
}
</code></pre>
<p><strong>前端应用场景</strong>：</p>
<ul>
<li><strong>股票K线图</strong>：在股票图表中，计算买入卖出的最佳时机和最大收益</li>
<li><strong>价格趋势分析</strong>：分析商品价格变化，找到最佳买卖点</li>
<li><strong>收益计算器</strong>：在投资应用中，计算投资组合的最大收益</li>
<li><strong>数据波动分析</strong>：分析数据序列中的最大正向波动（类似股票收益）</li>
</ul>
<hr/>
<h3 data-id="heading-44">五、总结</h3>
<p>通过这10道动态规划经典题目，我们掌握了：</p>
<h4 data-id="heading-45">核心框架：DP五部曲</h4>
<ol>
<li>确定dp数组及下标的含义</li>
<li>确定递推公式</li>
<li>dp数组如何初始化</li>
<li>确定遍历顺序</li>
<li>打印dp数组（验证）</li>
</ol>
<h4 data-id="heading-46">题目分类</h4>









































<table><thead><tr><th>类别</th><th>题目</th><th>核心特点</th><th>空间优化</th></tr></thead><tbody><tr><td><strong>基础递推</strong></td><td>爬楼梯、最大子数组和、打家劫舍</td><td>一维DP，状态转移简单</td><td>滚动变量 O(1)</td></tr><tr><td><strong>路径型DP</strong></td><td>不同路径、不同路径II</td><td>二维DP，网格问题</td><td>一维数组 O(n)</td></tr><tr><td><strong>背包问题</strong></td><td>零钱兑换、零钱兑换II</td><td>完全背包，最值/计数</td><td>一维数组 O(amount)</td></tr><tr><td><strong>序列问题</strong></td><td>最长递增子序列</td><td>非连续状态转移</td><td>难优化</td></tr><tr><td><strong>状态机DP</strong></td><td>买卖股票、打家劫舍II</td><td>状态转换，环形问题</td><td>滚动变量 O(1)</td></tr></tbody></table>
<h4 data-id="heading-47">易错点总结</h4>
<ol>
<li><strong>边界处理</strong>：空数组、单元素、索引转换</li>
<li><strong>初始化</strong>：根据问题特点正确初始化（0、1、Infinity等）</li>
<li><strong>遍历顺序</strong>：完全背包正序，01背包倒序</li>
<li><strong>返回值</strong>：注意是返回<code>dp[n]</code>还是<code>Math.max(...dp)</code></li>
<li><strong>空间优化</strong>：注意更新顺序，避免覆盖未使用的值</li>
</ol>
<h4 data-id="heading-48">前端应用价值</h4>
<p>动态规划在前端开发中广泛应用于：</p>
<ul>
<li><strong>性能优化</strong>：资源分配、组件懒加载优化</li>
<li><strong>业务逻辑</strong>：支付找零、权限分配、任务调度</li>
<li><strong>数据可视化</strong>：趋势分析、K线图、时间线组件</li>
<li><strong>算法优化</strong>：路径规划、组合统计、最值计算</li>
</ul>
<p>掌握这10道题目，足以应对前端算法面试中的大部分DP问题。记住：<strong>先理解DP五部曲框架，再套用到具体问题，最后优化空间复杂度</strong>。</p>
<hr/>
<p><strong>相关资源</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Ftag%2Fdynamic-programming%2F" target="_blank" title="https://leetcode.cn/tag/dynamic-programming/" ref="nofollow noopener noreferrer">LeetCode动态规划专题</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fprogrammercarl.com%2F" target="_blank" title="https://programmercarl.com/" ref="nofollow noopener noreferrer">DP五部曲详细讲解</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftrending%2Fjavascript" target="_blank" title="https://github.com/trending/javascript" ref="nofollow noopener noreferrer">前端算法刷题路线</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【保姆级教程】10分钟把手机变成AI Agent：自动刷课、回消息，学不会我“退网”！]]></title>    <link>https://juejin.cn/post/7593310044478767113</link>    <guid>https://juejin.cn/post/7593310044478767113</guid>    <pubDate>2026-01-10T12:10:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593310044478767113" data-draft-id="7593541291011604507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【保姆级教程】10分钟把手机变成AI Agent：自动刷课、回消息，学不会我“退网”！"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-10T12:10:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LucianaiB"/> <meta itemprop="url" content="https://juejin.cn/user/1269294586664749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【保姆级教程】10分钟把手机变成AI Agent：自动刷课、回消息，学不会我“退网”！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1269294586664749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LucianaiB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T12:10:26.000Z" title="Sat Jan 10 2026 12:10:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是LucianaiB。</p>
<p>今天，我将带你一步步部署属于你自己的 <strong>AI 手机</strong>。别以为这很难，跟着我的节奏，<strong>10分钟就能搞定</strong>。如果你还是学不会，那我就真的“退网”好了！</p>
<p>此前，开源社区涌现出的 <strong>Open-AutoGLM</strong> 项目引起了广泛关注。很多人误以为配置私有化 AI 手机需要极高的技术门槛，其实只要掌握正确的方法，它比你想象的要简单得多。</p>
<p>无论是自动刷课、批量处理信息，还是在不方便触控时进行语音交互，它都能将你的“想象”转化为“行动”，真正解放劳动力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f20ed3338b5c4282aa101705d2ba29a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=l0S3NIc6srnEt%2FBJZHOvaSERhkM%3D" alt="f328c369dd4321cee682ccaf2e2e2bdb.png" loading="lazy"/></p>
<h2 data-id="heading-0">1.为什么需要一个AI手机？</h2>
<p>在快节奏的生活中，我们总是希望把重复、繁琐的工作交给机器。开源 AI 手机的出现，让这种想象成为了现实。</p>
<ul>
<li><strong>大学生</strong>：它可以帮你“代劳”那些枯燥的网课，甚至自动签到。</li>
<li><strong>生活达人</strong>：做饭、运动双手不便时，它能帮你自动回复消息、刷短视频。</li>
<li><strong>极客</strong>：自动进行 App UI 测试，批量处理数据。</li>
</ul>
<p>这不仅是解放双手，更是为生活增添了无限可能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8402ff30412042b99b0eab9cb067c03c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=w8xXsXFYPPgJBNL9SkbIOVL84%2F0%3D" alt="img" loading="lazy"/></p>
<p>演示效果（懒人自动刷抖音）：</p>
<blockquote>
<p>“AI手机的本质，不是在手机里装一个聊天机器人，而是让手机具备‘理解意图并自动执行’的代理能力（Agentic Capability）。”</p>
</blockquote>
<h2 data-id="heading-1">2.前置环境配置</h2>
<p>本文章为开源的保姆级安装教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a></p>
<p>所谓“工欲善其事，必先利其器”。在开始部署之前，我们需要准备好四大件：GLM API、Python环境、ADB工具和配置安卓环境。</p>
<h3 data-id="heading-2">3.Glm API</h3>
<p>这是AI手机的“大脑”，负责思考和决策。</p>
<p>点击链接注册：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding%3Fic%3D4G1ARPDRUV%25EF%25BC%2588%25F0%259F%258C%259F%25E6%2582%2584%25E6%2582%2584%25E8%25AF%25B4%25E4%25B8%2580%25E4%25B8%258B%25EF%25BC%258C%25E6%2596%25B0%25E7%2594%25A8%25E6%2588%25B7%25E6%259C%2589%25E7%25A6%258F%25E5%2588%25A9%25EF%25BC%2589" target="_blank" title="https://www.bigmodel.cn/glm-coding?ic=4G1ARPDRUV%EF%BC%88%F0%9F%8C%9F%E6%82%84%E6%82%84%E8%AF%B4%E4%B8%80%E4%B8%8B%EF%BC%8C%E6%96%B0%E7%94%A8%E6%88%B7%E6%9C%89%E7%A6%8F%E5%88%A9%EF%BC%89" ref="nofollow noopener noreferrer">www.bigmodel.cn/glm-coding?…</a></p>
<p>打开Glm API Key：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbigmodel.cn%2Fusercenter%2Fproj-mgmt%2Fapikeys" target="_blank" title="https://bigmodel.cn/usercenter/proj-mgmt/apikeys" ref="nofollow noopener noreferrer">bigmodel.cn/usercenter/…</a></p>
<p>右上角新建一个 API Key，然后记住即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85526b9032d44a99bc7c5dc52b1fe5e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=gOqiaJUnuaEr9U0qDDuvJakRXCs%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-3">Python</h3>
<p>访问 Python 官网下载页：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2F%25E3%2580%2582" target="_blank" title="https://www.python.org/downloads/%E3%80%82" ref="nofollow noopener noreferrer">www.python.org/downloads/</a>，页面顶部会有“Download Python 3.x.x”按钮，自动匹配你的系统（Windows/macOS/Linux），点击即可下载安装包。（最好安装3.12以上版本）</p>
<p>查看你的Python版本号</p>
<pre><code class="hljs language-Plain" lang="Plain">python --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a932cff8db3404bac1898c3d859a299~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=w6ayKr1qufHzLYhumzlJljnDvAo%3D" alt="img" loading="lazy"/></p>
<p>为了避免污染全局环境，强烈建议创建一个虚拟环境。你可以使用以下代码创建一个独立的Python环境：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># create_env.py</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> venv
 
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_virtual_env</span>(<span class="hljs-params">path=<span class="hljs-string">"venv"</span></span>):
    <span class="hljs-string">"""
    创建Python虚拟环境，隔离项目依赖
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"正在创建虚拟环境于: <span class="hljs-subst">{path}</span>..."</span>)
    <span class="hljs-keyword">try</span>:
        venv.create(path, with_pip=<span class="hljs-literal">True</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ 虚拟环境创建成功！"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"👉 激活方式:"</span>)
        <span class="hljs-keyword">if</span> sys.platform == <span class="hljs-string">"win32"</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   .\\<span class="hljs-subst">{path}</span>\\Scripts\\activate"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   source <span class="hljs-subst">{path}</span>/bin/activate"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"❌ 创建失败: <span class="hljs-subst">{e}</span>"</span>)
 
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    create_virtual_env(<span class="hljs-string">"autoglm_env"</span>)
</code></pre>
<h3 data-id="heading-4">ABD</h3>
<p>这个的作用就是是电脑可以控制手机。</p>
<p>Windows用户，直接下载ABD工具压缩包，然后解压并加入系统环境变量即可。</p>
<blockquote>
<p>下载地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdl.google.com%2Fandroid%2Frepository%2Fplatform-tools-latest-windows.zip" target="_blank" title="https://dl.google.com/android/repository/platform-tools-latest-windows.zip" ref="nofollow noopener noreferrer">dl.google.com/android/rep…</a></p>
</blockquote>
<p>如何设置环境变量呢？</p>
<p>首先，找到电脑的**「高级系统设置」**。其次，点「<strong>环境变量</strong>」，找到「<strong>Path</strong>」变量，编辑Path变量，点「<strong>新建</strong>」创建一个新变量，把你的ABD工具压缩包地址添加进来就可以了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d9796ad83564b5185c8844b2b8a8f05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=Fh%2BrALYvfJ%2FNW1vc4ezT9z4VZLQ%3D" alt="img" loading="lazy"/></p>
<p>之后，陆续点「<strong>确定</strong>」，保存更改，关闭页面。</p>
<h3 data-id="heading-5">安卓环境</h3>
<p>我们的手机需要打开开发者模式，手机才可以接受电脑的连接。</p>
<p>让手机允许被电脑控制：</p>
<p>1.进入手机“设置” -&gt; “关于手机”。</p>
<p>2.连续狂点“版本号”7次，直到提示“您已处于开发者模式”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be9851b36ae34194929415a11621f3c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=VFjhXMhcB3y7JRXyMv0mDazZbao%3D" alt="img" loading="lazy"/></p>
<p>3.返回设置主页，找到“开发者选项”，打开“USB调试”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91cf3b7845ca4be88c148bdf050f116a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=gs7OKoChR3JyfvDnwiCE4rjTpr8%3D" alt="img" loading="lazy"/></p>
<p>4.用数据线连接手机和电脑，手机端弹窗一律点“允许”。</p>
<p>调试检查脚本： 为了确保ADB配置成功，你可以保存以下代码为 <code>check_adb.py</code> 并运行，它会自动检测ADB是否可用并列出连接设备。</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> sys
 
<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_adb</span>():
    <span class="hljs-string">"""
    检查ADB环境是否配置正确，并列出已连接设备
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 尝试获取ADB版本</span>
        version_result = subprocess.run([<span class="hljs-string">'adb'</span>, <span class="hljs-string">'version'</span>], capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>, encoding=<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">if</span> version_result.returncode == <span class="hljs-number">0</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ ADB 环境检测通过"</span>)
            <span class="hljs-built_in">print</span>(version_result.stdout)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"❌ 未找到ADB命令，请检查环境变量配置"</span>)
            sys.exit(<span class="hljs-number">1</span>)
            
        <span class="hljs-comment"># 尝试获取连接设备列表</span>
        devices_result = subprocess.run([<span class="hljs-string">'adb'</span>, <span class="hljs-string">'devices'</span>], capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>, encoding=<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- 当前已连接设备 ---"</span>)
        <span class="hljs-built_in">print</span>(devices_result.stdout)
        
        <span class="hljs-keyword">if</span> <span class="hljs-string">"device"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> devices_result.stdout:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"⚠️ 警告：未检测到已授权的手机设备，请检查USB连接。"</span>)
            
    <span class="hljs-keyword">except</span> FileNotFoundError:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"❌ 错误：系统找不到ADB程序。"</span>)
 
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    check_adb()
</code></pre>
<h2 data-id="heading-6">⚡ 部署与实战：两种方式任选</h2>
<p>环境搞定后，我们分“懒人版”和“保姆版”两种方式来部署。如果你是老手，直接看懒人版；如果你是新手，建议仔细阅读保姆版。</p>
<h3 data-id="heading-7">系统架构原理解析</h3>
<p>在开始之前，我们先了解一下Open-AutoGLM是如何工作的。这有助于你后续排查问题。</p>
<p>它本质上是一个 Agent（智能体） 循环：</p>
<ol>
<li>感知：通过ADB截图，获取手机当前画面。</li>
<li>思考：将截图传给GLM-4大模型，告诉它“我想刷抖音”，让模型分析当前该点哪里。</li>
<li>行动：模型返回坐标（如：x=500, y=1000，点击），Python脚本通过ADB执行点击。</li>
<li>反馈：再次截图，确认操作是否成功。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab6d58dc42e4c4c9159f25253208cfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=vZyP6jkoYmMmWWj7%2FlBjOM2chhE%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-8">懒人版快速安装</h3>
<p>使用Claude Code到你创建项目的位置。（没有Claude Code的，可以网上搜索下载一个）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9473aa41666d4111b387a440608c2094~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=fvsPNnXbbSaBmeJYDgMY9vs0McU%3D" alt="img" loading="lazy"/></p>
<p>打开配置 GLM Coding Plan 后，可以看到使用的是glm-4.7。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f6963dc15704f0b9aa03e0e05cdb4cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=LvMdDGtEm1MlZX%2B6PbUgF0t7i%2Bs%3D" alt="img" loading="lazy"/></p>
<p>输入以下提示词，快速部署本项目。</p>
<pre><code class="hljs language-Plain" lang="Plain">访问文档，为我安装 AutoGLM
https://raw.githubusercontent.com/zai-org/Open-AutoGLM/refs/heads/main/README.md
我是windows电脑，我的python在：D:\Miniconda\python.exe
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0730aa4113c342f0b1a3dd275a21dadf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=XUILs7sjZrVcGZMd9QEAxFarAqI%3D" alt="img" loading="lazy"/></p>
<p>AI 会自动帮你处理依赖安装和配置，你只需要坐享其成。</p>
<h3 data-id="heading-9">保姆级教程安装</h3>
<h4 data-id="heading-10">1.下载到本地</h4>
<p>把项目 git 或者直接在源码下载压缩包，然后解压。</p>
<blockquote>
<p>开源地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d21e6f645aa45b687c91d7c2d9c1a94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=6KwIOJpiwDgc33plVkfOllIB%2Fr4%3D" alt="img" loading="lazy"/></p>
<p>需要安装依赖</p>
<pre><code class="hljs language-Plain" lang="Plain">pip install -r requirements.txt 
pip install -e .
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf1b0523a69f498c8f2e9a1c86fe4fc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=gZNzYYOdKXq1pwMLKH0uen95PO8%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-11">2.手机和电脑连接</h4>
<p>接下来，用USB数据线将手机链接到电脑，然后在命令行里输入：</p>
<pre><code class="hljs language-Plain" lang="Plain">adb devices
</code></pre>
<p>如果连接成功，你会看到这样的提示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c83cccacb5e140e1b00ce291b272d0f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=oMkJyX2vgcwK12GBZHsU9YVierI%3D" alt="img" loading="lazy"/></p>
<p>首次连接，手机上会出现这样一段提示，点「允许」即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78548b92adc248eb9b4fc626d6771c1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=VkRVlSgBc4pdxshKMA6sENIwIXk%3D" alt="img" loading="lazy"/></p>
<p>如果出现下面的需要选择<code>USB网络共享</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1edb62556ed34bca8b334efc3478b5d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=LpeJXuvqGweS7DjAyjx67bAdvfY%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-12">3.使用AI手机</h4>
<p>直接用cmd打开到文件夹，并且输入下面的指令</p>
<pre><code class="hljs language-Markdown" lang="Markdown">python main.py --base-url https://open.bigmodel.cn/api/paas/v4 --model "autoglm-phone" --apikey "your-bigmodel-api-key" "任务"
</code></pre>
<p>这里需要把</p>
<p>your-bigmodel-api-key 换为你直接得到的 Glm API</p>
<p>任务 换为你直接得到的 具体的任务</p>
<p>下面是我实际使用的示例，所有过程，<strong>0接管，全自动</strong>。。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b8993aacd1b4d19ace1c5b3db05fb04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=gS%2FQX4jvXYMaf8SOiyC3%2BJGvkVY%3D" alt="img" loading="lazy"/></p>
<h2 data-id="heading-13">常见问题</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/547931ab76a148c48a5dd3d69b3e563d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768651825&amp;x-signature=5vs2g5iordXe0S1%2Bun%2F12JpfTZQ%3D" alt="img" loading="lazy"/></p>
<p>原因：目标设备上未安装 ADB Keyboard，导致系统检查的第3步失败。</p>
<p>解决方案：</p>
<p>下载安装到手机：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsenzhk%2FADBKeyBoard%2Fblob%2Fmaster%2FADBKeyboard.apk" target="_blank" title="https://github.com/senzhk/ADBKeyBoard/blob/master/ADBKeyboard.apk" ref="nofollow noopener noreferrer">github.com/senzhk/ADBK…</a></p>
<p>启用键盘：在手机上进入“设置” &gt; “系统” &gt; “语言和输入” &gt; “虚拟键盘”，找到并开启“ADB Keyboard”。建议同时将其切换为当前输入法。</p>
<h3 data-id="heading-14">技术栈对比：传统自动化 vs AI Agent</h3>
<p>为了让你更直观地理解 Open-AutoGLM 的优势，我们将其与传统的手机自动化工具（如按键精灵、Auto.js）进行对比。</p>








































<table><thead><tr><th>维度</th><th>传统自动化</th><th>Open-AutoGLM (AI Agent)</th></tr></thead><tbody><tr><td>核心逻辑</td><td>固定坐标、图像匹配</td><td>视觉理解、意图推理</td></tr><tr><td>适配性</td><td>差，UI变动需重写脚本</td><td>强，像人一样适应界面变化</td></tr><tr><td>开发门槛</td><td>中，需掌握编程/脚本</td><td>低，自然语言描述任务</td></tr><tr><td>场景扩展</td><td>局限，单一任务重复</td><td>广泛，支持模糊指令</td></tr><tr><td>运行成本</td><td>本地运行，成本为0</td><td>需调用API，产生Token费用</td></tr><tr><td>不确定性</td><td>低，一旦写死非常稳定</td><td>中，依赖大模型推理准确性</td></tr></tbody></table>
<p><strong>总结来说</strong>：传统工具适合<strong>高重复、确定性强</strong>的流水线工作；而 AI 手机适合<strong>非标准化、需要理解能力</strong>的复杂任务。</p>
<h2 data-id="heading-15">写在最后</h2>
<p>在深入体验并拆解了 Open-AutoGLM 项目的全套技术栈后，我想从客观的角度为大家做一个深度的总结。这不仅仅是一个工具，更是一扇通向未来的窗，但我们必须清醒地看到它的双面性。</p>
<p><strong>关于这套工具栈的缺点：</strong></p>
<p>首先，<strong>稳定性是目前最大的短板</strong>。由于它极度依赖云端大模型的实时推理，网络延迟和API的响应速度会直接影响操作手感。有时候你会发现，它明明识别到了按钮，但点击坐标却发生了偏移，这是因为模型在视觉预测上存在一定的概率误差。其次，<strong>硬件依赖较强</strong>，必须通过数据线连接ADB（虽然也有无线方案，但延迟更高），这意味着你的手机被“拴”在了电脑旁，无法实现真正的随身远程操控，这在移动场景下略显尴尬。再者，<strong>使用成本并非为零</strong>，虽然新用户有福利，但高频使用产生的API Token费用积少成多，对于仅仅是想用来挂机刷视频的用户来说，性价比可能不如传统的脚本。最后，<strong>隐私风险</strong>不容忽视，为了理解屏幕，手机截图需要上传至云端分析，如果你的屏幕上有敏感信息（如密码、聊天记录），这就存在潜在的数据泄露风险。</p>
<p><strong>关于这套工具栈的优点：</strong></p>
<p>然而，瑕不掩瑜，它的优点是颠覆性的。最核心的优势在于<strong>通用性与泛化能力</strong>。传统脚本换个APP分辨率就失效了，但 AutoGLM 靠的是“理解”而非死记硬背，它能像人类一样看懂界面布局，这意味着你不需要为每个APP写专门的代码，一套逻辑通吃大部分应用。其次，它极大地<strong>降低了自动化的门槛</strong>。你不需要懂编程，不需要学像素点判断，只需要说出“帮我把朋友圈最新的十条点赞”，剩下的交给AI。这种自然语言交互的方式，真正实现了“所想即所得”。此外，它具备<strong>上下文记忆与逻辑推理能力</strong>，不仅能执行动作，还能根据上一步的结果调整下一步策略，比如“如果弹出登录框则输入密码，否则跳过”，这种逻辑判断是传统脚本难以低成本实现的。</p>
<p><strong>总体来说：</strong></p>
<p>我认为，Open-AutoGLM 所代表的 AI Agent 技术栈，其<strong>优点远远大于缺点</strong>。目前的连接延迟和推理误差，随着模型算力的提升和边缘计算的发展，终将得到解决。而它所展现出的“理解意图并操作物理设备”的能力，正是通往通用人工智能（AGI）的关键一步。</p>
<p><strong>强烈推荐</strong>大家，特别是技术爱好者和效率极客，去尝试部署和使用这套工具。不要把它仅仅看作一个“刷课神器”，它是一个极佳的学习样本，能让你直观地感受到大模型是如何与操作系统交互的。在这个过程中，你不仅解放了双手，更升级了自己的思维。未来的 computing，一定是 AI Agent 的时代，现在入局，就是抢占未来。</p>
<p><strong>你打算用AI手机用来干什么呢，留下你的想法，然后勇敢的去实践。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端佬们！！AI大势已来，未来的上限取决你的独特气质！恭请批阅！！]]></title>    <link>https://juejin.cn/post/7593337928307621914</link>    <guid>https://juejin.cn/post/7593337928307621914</guid>    <pubDate>2026-01-10T12:23:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593337928307621914" data-draft-id="7592088192515637291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端佬们！！AI大势已来，未来的上限取决你的独特气质！恭请批阅！！"/> <meta itemprop="keywords" content="前端,AI编程,程序员"/> <meta itemprop="datePublished" content="2026-01-10T12:23:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大怪v"/> <meta itemprop="url" content="https://juejin.cn/user/4391901700043284"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端佬们！！AI大势已来，未来的上限取决你的独特气质！恭请批阅！！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4391901700043284/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大怪v
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T12:23:34.000Z" title="Sat Jan 10 2026 12:23:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>前言</strong></p>
<p>写这篇文章，纯粹是AI热潮给炸出来的。本来想继续更我的虚拟世界专栏，但看了一眼沸点，好家伙，大家都在聊DeepSeek、ChatGPT，感觉我不说两句显得我很不合群。</p>
<p>还有另外一个原因，就是身边的很多程序员，都在焦虑。</p>
<p>那么，程序员真的会被替代吗？兄弟们，别急别急！</p>
<p>我直接给出我自己的观点:如果还是之前那种记俩API、写两功能的程序员，我相信很快会替代。但是那种会整活、会整合，直接面向问题解决的程序员，不会的！！！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3462e07141674bf9b09111e8d1a67034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768652614&amp;x-signature=S%2BQAL9Jcj4%2FuwE7lxk%2F39ByqK7Q%3D" alt="O9.gif" loading="lazy"/></p>
<p>对比以前还要苦哈哈地背API，现在AI把门槛直接铲平了。这哪里是危机？这分明是从“螺丝钉”进化成“架构师”的最佳版本！</p>
<p>我的核心观点：<strong>AI对于之前的经验总结、归纳非常牛牪犇！！但是对于复杂问题、现实的敏感度以及所谓创新，他们还直接不能！！</strong></p>
<p>来，上理由！</p>
<h2 data-id="heading-0">0变1的门槛，被无限拉低了！</h2>
<p>以前你想做一个全栈应用，你得懂前端、后端、数据库、运维... 还没开始写代码，环境配置就先把你劝退了。</p>
<p>现在呢？</p>
<p>只要你的想法够骚，AI就是你的一万个分身。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f249eb43df84dafb48ea246b31b3a31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768652614&amp;x-signature=fa4eWoNi12WOQEaSbnQdAXjWO7E%3D" alt="骄傲.gif" loading="lazy"/></p>
<p>我有一个专栏，<strong>手搓虚拟世界</strong>。</p>
<p>在没有 AI 的时候，你想从 0 到 1 做一个产品，你要懂后端、懂数据库、懂运维，甚至还得懂点 UI 设计。这每一项，都是一座大山。很多很棒的 idea，就死在了“我不会写后端接口”或者“这 UI 丑得我没眼看”上。</p>
<p>现在呢？</p>
<p>AI 就是你的那个全能外包团队。你不会写 SQL？问它。你不会画 icon？让它画。 以前我们为了画一个完美的圆，可能要算半天 Math.PI，现在你只需要告诉 AI：“给我整一个圆，要五彩斑斓的那种。”</p>
<p>0 变 1 的过程，不再是技术的堆砌，而是你“脑洞”的直接具象化。 只要你有想法，技术实现的壁垒正在被 AI 暴力拆除。</p>
<h2 data-id="heading-1">这是拼气质的时代</h2>
<p>很多人说 AI 出来的代码没有灵魂，是缝合怪。 我说：别急别急！</p>
<p>当所有人都能一键生成标准化代码的时候，什么东西最值钱？ 是个性。是那种“独属前端佬气质”的创新。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef732539608a4748b59dded9bb389471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768652614&amp;x-signature=%2Brs7Yg721x33a0Zc5BSOQLUGYp8%3D" alt="0.gif" loading="lazy"/></p>
<p>就像当年的 Flash，工具大家都有，但只有少数人能做出《小小火柴人》。AI 时代同理，它能帮你生成 90% 的通用代码，但剩下那 10% 的、决定产品气质的、让人眼前一亮的 “手搓” 部分，才是你真正的价值所在。</p>
<p>未来的牛人，不是谁 API 背得熟，而是谁能用 AI 这个超级引擎，组合出别人没见过的玩法。这不就是我们最擅长的吗？不依赖第三方库（因为 AI 可能会瞎引用），纯靠逻辑和创意，去构建一个新的虚拟世界。</p>
<h2 data-id="heading-2">能做什么，取决于你能想到什么</h2>
<p>以前想整一个事情，大致如下流程：想法=&gt;需求=&gt;原型=&gt;UI=&gt;交互=&gt;编写代码</p>
<p>完全靠人海战术。 现在？一个拿着 AI 的工程师（或者说“全栈工程师”），战斗力可能抵得上以前的一个公司。</p>
<p>这意味着什么？意味着个人创新的回报率被无限放大了。你不需要在一个项目中，当一颗在大机器里运转的螺丝钉，你有机会成为那个设计机器的人。</p>
<p>假如未来硬件再大升级（就像我之前说的智能眼镜、脑机接口），结合 AI 的生产力，一个人手搓一个“元宇宙”雏形，可能真的不再是梦。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee69124d760d45faa2b4fc975413ae3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768652614&amp;x-signature=nLe9gy2eG8sae5DmY8wFpfpH4Mw%3D" alt="93d794510fb30f248be3f2baca95d143ac4b03e8.gif" loading="lazy"/></p>
<p>AI 不会淘汰有想法的人，它只会淘汰那些只会 copy-paste 的“代码搬运工”。</p>
<p>与其在焦虑中等待被替代，不如现在就头脑热一把，利用这个时代的红利，去“手搓”一点属于你自己的、独一无二的东西。</p>
<p>毕竟，只有当现有的规则已经装不下你的野心时，打破规则才更有乐趣。</p>
<p>前端佬们，别怂，干！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别“手搓”场景：智元用LLM重构具身智能的“练功房”]]></title>    <link>https://juejin.cn/post/7593338828217581583</link>    <guid>https://juejin.cn/post/7593338828217581583</guid>    <pubDate>2026-01-10T12:41:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828217581583" data-draft-id="7593262196844314676" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别“手搓”场景：智元用LLM重构具身智能的“练功房”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-10T12:41:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别“手搓”场景：智元用LLM重构具身智能的“练功房”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T12:41:14.000Z" title="Sat Jan 10 2026 12:41:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>CES 2026 刚刚在拉斯维加斯落下帷幕，虽然展台上那些跳舞、后空翻的机器人依旧吸睛，但对于咱们这些真正在搞具身智能开发的“炼丹师”来说，真正的硬菜其实藏在代码和数据里。</p>
<p>智元机器人（Agibot）这次发布了一个非常有意思的东西——Genie Sim 3.0。如果不仔细看，你可能觉得这只是又一个仿真软件，但关键在于它的前缀：这是全球首个由大语言模型（LLM）驱动的开源机器人仿真平台。</p>
<p>说得直白点，以前我们在仿真环境里训练机器人，最痛苦的不是写算法，而是搭场景。为了让机器人学会收拾桌子，你得在软件里一个个摆放杯子、盘子，还得调整光照、摩擦力。这简直是在“手搓”世界，效率低到让人头秃。</p>
<p>Genie Sim 3.0 解决的就是这个问题，它把那种费时费力的“手搓”变成了一句话的事儿。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-10_20.32.56-1024x348.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-10_20.32.56-1024x348.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8ec36f8150a4e219b02b835ce02e534~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768653674&amp;x-signature=Pkaz6Mrri5tHHBKzWVkL3Z2l4Co%3D" alt="iShot_2026-01-10_20.32.56" loading="lazy"/></a></p>
<p><strong>当上帝模式变成了“聊天窗口”</strong></p>
<p>这个平台最核心的突破，在于它听得懂人话。基于 NVIDIA Isaac Sim 构建的底座上，智元接入了 LLM。现在的玩法变成了：你在对话框里输入“生成一个由于昨晚聚会而杯盘狼藉的餐桌场景，要有剩菜和倒下的酒杯”，几分钟后，几千甚至上万个符合描述但细节各异的 3D 场景就生成好了。</p>
<p>这个“万级场景生成分钟级完成”的参数，对于需要海量数据喂养的具身模型来说，不仅仅是效率提升，简直就是降维打击。它意味着你可以通过自然语言，快速构建出各种极端案例（Corner Case），专门针对机器人的弱项进行特训。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-10_20.33.06-1024x555.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-10_20.33.06-1024x555.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c052be3630dd49d6b10e06cb48c6c6ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768653674&amp;x-signature=16oK0DTJEaKbYFo7NZeypEH66Iw%3D" alt="iShot_2026-01-10_20.33.06" loading="lazy"/></a></p>
<p><strong>拒绝“虚假”的精细度</strong></p>
<p>仿真训练最大的坑是“Sim-to-Real Gap”（虚实迁移鸿沟）。在模拟器里机器人是个神枪手，放到真机上连瓶水都抓不稳，原因通常是物理引擎不准或者视觉渲染太假。</p>
<p>Genie Sim 3.0 居然敢宣称虚实差异小于 10%，这底气来自于它的“数字孪生级”复刻能力。它不仅仅是画得像，而是物理属性上的像。比如你想在这个虚拟世界里加一把现实中的椅子，不需要复杂的建模，拿着手机对着椅子拍一段 60 秒的环绕视频，算法就能生成带精确网格和纹理的仿真模型。</p>
<p>这种把现实物体“瞬间传送”进虚拟世界的能力，对于像超市上货、物流分拣这种物品极其杂乱的场景来说，实用性极强。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-10_20.33.13-1024x595.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-10_20.33.13-1024x595.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b86db1befce545939a7996d36a89aace~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768653674&amp;x-signature=D7upHDZD6oWEgpvzrTv1NS0d9wE%3D" alt="iShot_2026-01-10_20.33.13" loading="lazy"/></a></p>
<p><strong>开源才是最大的诚意</strong></p>
<p>如果仅仅是功能强，那它充其量是一个昂贵的商业软件。但智元这次的选择很聪明：全开源。</p>
<p>他们不仅开源了核心代码，还把那一万多小时的真实机器人作业仿真数据集给放出来了。这其中包括了 RGB-D 视频、双目视觉数据、关节状态等。据说基于这套数据训练出来的模型，即便没有见过真实世界，直接部署到真机上也能干活（零样本迁移）。</p>
<p>对于很多缺乏资金购买大量高端机器人、或者没场地搭建复杂测试环境的高校和实验室来说，这套数据集和评估体系（覆盖了 10 万+ 场景）简直就是“具身智能界的 ImageNet”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-10_20.33.22.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-10_20.33.22.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/153db33e220b42ae91bb197e9f9f6f0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768653674&amp;x-signature=LluAkWFP5Vlb5%2BkzcY9Z8L8w%2Bhs%3D" alt="iShot_2026-01-10_20.33.22" loading="lazy"/></a></p>
<p><strong>写在最后</strong></p>
<p>Genie Sim 3.0 的出现，某种意义上标志着机器人研发范式的转变。我们正在从“拼硬件、拼手速”的时代，进入“拼算力、拼数据质量”的时代。</p>
<p>当搭建训练场的成本被 LLM 压缩到几乎为零时，开发者终于可以把精力集中在真正重要的事情上——如何让机器人那颗大脑变得更聪明。智元这次在 CES 上不仅秀了肌肉，更重要的是，它给整个行业递了一把好用的铲子。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我在企业落地AI这一年，全流程案例拆解，企业落地AI必看！]]></title>    <link>https://juejin.cn/post/7593311347291750427</link>    <guid>https://juejin.cn/post/7593311347291750427</guid>    <pubDate>2026-01-10T11:15:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593311347291750427" data-draft-id="7593261984190300210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我在企业落地AI这一年，全流程案例拆解，企业落地AI必看！"/> <meta itemprop="keywords" content="人工智能,AI编程"/> <meta itemprop="datePublished" content="2026-01-10T11:15:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="石云升"/> <meta itemprop="url" content="https://juejin.cn/user/642537280772456"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我在企业落地AI这一年，全流程案例拆解，企业落地AI必看！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/642537280772456/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    石云升
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T11:15:46.000Z" title="Sat Jan 10 2026 11:15:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"⇲"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"•";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>2023年躬身入局，从工具使用者转型为落地推动者。2024-2025年，我连续在两家不同行业企业主导AI落地。过去两年，我最深的感悟是：<strong>AI落地的难点不在技术，而在业务逻辑的解构。</strong> 站在2025年末回看，我总结了一套跨部门的AI落地实战路径。今天不讲大道理，只拆解真实案例，希望能给正在深耕AI增效的朋友一点启发。</p>
<h3 data-id="heading-0">从高价值业务切入</h3>
<h4 data-id="heading-1">电商AI客服 - 售前为主</h4>
<p>刚入职时，我就想好了落地路径。公司主营电商，在拼多多、京东、淘宝都有店铺。虽然平台自带机器人，但往往有点笨，更像能力较弱的小模型，远不如顶尖大模型智能，当然，国内平台估计也不让用国外的模型。所以当时想着还是自建。</p>
<p>自建的好处很明显：<strong>成本低、</strong> <strong>灵活、可定制</strong>。比如我们可以跟自己的内部业务系统进行打通。比如硬件的话，可以让AI客服根据硬件的实时数据进行回复；还有一些比如预约某个时间点上门维修等等。不过自建有个点要注意，各个电商平台没有开放API，只能通过其他方式进行实现。具体做的细节就不讲了，这里有几个坑要注意</p>
<ol>
<li>必须考虑大数据量并发的情况。</li>
<li>做好模型响应失败的容灾预案。</li>
<li>不同平台有违禁词限制，需通过关键词过滤系统进行二次替换。</li>
<li>建议先在夜间上线（本就是人工空白区，属于增量价值），验证后再推广。</li>
<li>AI解决不了的自动转人工，前期宁可保守一点，给知识库优化留出时间。</li>
</ol>
<p>我们最先落地的就是电商AI客服，当然落地之后效果怎样呢？这其实也是AI负责人在落地之前就要考虑到的情况。就是一个工具落地后，实际产生了什么价值，你得有数据支撑，不能光说，AI客服+人工肯定比纯人工要更高效，能接待更多的客户咨询。这是价值，但没有量化。作为AI负责人，必须用数据说话：接待了多少咨询、回复了多少次、卖了多少商品，带来了多少转化等等。数据会给你真实的反馈，指引你前进的方向。下面是几家不同行业店铺AI客服（晚上）与人工（白天）转化数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0287c67784b14fab993324bea9fd9b75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5LqR5Y2H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768648546&amp;x-signature=1Mt0dgAh0NtVOTRV89tH0kluA%2Fw%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>编辑</p>
<h4 data-id="heading-2">企业微信AI客服 -售后为主</h4>
<p>对我们公司而言，电商AI客服只是售前。我们售后又是统一的另一套，用的企业微信客服。因为我们的用户主要是在微信体系，所以用企微更方便，并且对于我公司来说，企业微信的售后咨询量更大。本来一开始是准备找成熟产品用的，但基本都是按坐席收费，且需要改变客服的原有操作习惯，成本高、上手难。所以还是决定自己做。</p>
<p>市面上有很多一键接入微信客服的工具，像元宝，coze。但那种就是纯平台接入，看起来好像很好用，但不灵活。而且也无法配合人工进行操作。我们企业需求更希望保持原有客服的操作习惯所以还是得自建。</p>
<p>以前做这样一套系统，至少得一个小团队做个把月时间，但在AI时代，一个人也能把活干得又快又好。</p>
<h3 data-id="heading-3">部门提效</h3>
<p>企业里有很多部门，每个部门其实都有一些低效的工作，以前都是靠人力去做的。现在有了AI后，有些工作可以用程序自动化，有些工作流通过AI重构后，有些工作就不需要人再做了。当然，这里面很多都是企业定制化需求，我这里只是提供一些案例思路给大家参考。</p>
<h4 data-id="heading-4">研发部</h4>
<p>程序员使用 Vibe Coding（氛围编程）就不用说了，就现在，不会用AI编码的人出来找工作就很难了。但实际上很多程序员还没用起来，或者用得很浅。这块我也不知道怎么说，反正没有深入使用的。建议先自我分析下，到底是什么原因没用起来。</p>
<p>产品经理很多都是并入研发部部门的，如果产品经理不使用AI，那以后就业只比不会AI的程序员还要难。我认为产品经理是AI时代最受益的岗位之一。产品调研，产品需求整理可以借助AI提效；产品原型，可以借助AI直接生成；因为产品经理懂业务，可以借助AI编写各种业务功能的工具，实现价值最大化。</p>
<p>如果公司里要选择谁来深入学习AI，负责AI落地，<strong>产品经理是最适合的角色。</strong></p>
<h4 data-id="heading-5">财务部</h4>
<p>财务同事跟钱打交道。经常要对账，核对订单，还有整理发票。</p>
<p>对账工具：根据传入的表，自动核算表单金额，去掉重复订单，去掉状态变更的订单。支持一键导出有效订单数据，简化操作步骤，兼容异常数据，支持后期更新。原来这个工作需要运营做一遍，然后财务再核对一遍。现在两个部门都不需要做了。</p>
<p>快递签收工具：批量查询快递订单的轨迹，并获取物流信息里最后签收人信息。</p>
<p>发票整理：自动整理发票，根据不同主体，进销项，普票专票，然后给发票命名。</p>
<p>这些需求虽然小，但经常需要人工每天或者每周消耗几个小时时间来整理，既低效又容易出错，所以用AI做一些小工具就很适合。</p>
<h4 data-id="heading-6">客服部</h4>
<p>除了跟用户沟通的客服外，客服部还负责退货相关事宜。比如，要把微信群里的退单信息整理到Excel表上。</p>
<p>需求：自动统计微信群里发送的拦截，退回的快递单号（有个相对复杂的规则，支持多个快递公司），并汇总到Excel表里。支持撤回，支持导出拦截成功和失败的数据等等。在有了这个工具之前，每天客服每天都有1-2个人做一下午的统计工作，低效且容易出错。</p>
<p>还有一个企业微信侧边栏应用，也就是在聊天对话框右侧应用栏里显示当前用户和设备的资料。比如之前每次还要打开管理后台去查，方便了不止一点。整体效率起码提高了30%。这种需求以前也是需要一个小团队做的，但现在的AI真的可以干的又快又好。</p>
<h4 data-id="heading-7">运营部</h4>
<p>电商运营部，能做的事情很多。批量出商品图这个去年就说过了，之前是通过comfyui做的，相对会复杂一点，对电脑要求也高。现在AI生图模型能力强了，可以直接口语化ps了，而且像nano banana pro已经能非常好的输出中文字体了。最近可能由于算力限制，出图效果有点降智。不过相信很快就好的。成本的话还有点高，官方1块钱一张图，国内中转2-3毛一张图。</p>
<p>除了电商这块，还有新媒体运营。这块之前很多公司都做不好，毕竟内容创作对人的要求非常高。但AI出来后，创作门槛降低到极致了。好处是，创作变简单了。坏处是，想要做出成绩更难了。针对这个，我做了个AI自动生成内容，自动发布到各个平台的工具。但我认为，想要把内容做好，关键还是在用的人身上。</p>
<h4 data-id="heading-8">某部门负责人</h4>
<p>之前某部门负责人有一个很费劲的工作，就是调研竞品商品价格，在结合我们上游渠道价格反向倒推自己的定价。从商品价格获取，到换算，到最后更改我们商品价格。之前都是纯人工Excel表管理。不仅繁琐，而且非常容易出错，尤其是多个上游渠道，我们还需要平衡成本。这个事情就不应该人来做。最简单的方案就是，扔给程序一个或多个商品链接，手动录入一些必要的业务数据，然后程序自动输出产品定价并更新到线上系统。</p>
<p>要遵循最简单的设计原则，完成一件任务，<strong>如果一个按钮能解决，就不要让人操作两次。</strong></p>
<h4 data-id="heading-9">人事行政部</h4>
<p>行政主要负责公司跟事相关的事情，杂事特别多。比如入职资料整理。这块之前因为公司规模不大，都是人工整理，把入职人员的信息手动录入到Excel表里。每次花点时间整理。但如果入职的人员很多的话，人工干起来就觉得很浪费时间。你看，只要有做这事浪费时间的感觉，就应该考虑用新技术来重构。</p>
<p>填写入职资料（表单） —— 自动生成Word文档 —— 打印签名 —— 把Word文件以及社保，公积金卡都一起上传到AI工具做的工具，工具会自动识别所有信息录入到Excel表。</p>
<p>HR负责公司跟人相关的事情，也是非常多非常杂的。招人是一门技术活，之前HR做面试候选人的管理都是人工Excel表，可以用但中间很多费脑的事情。这个候选人简历匹配度怎样，要针对性问哪些问题，面试的结果如何评价等等。其实现在借助飞书多维表格，面试过程中产生的所有数据都能够更好的展示。说实话要是飞书能开放AI模型的接口，让我们用自己接入的模型，那使用效果会更好。</p>
<p>还有一个要分享的就是公司百事通智能体，上面讲了AI制作应用工具 + 多维表格。现在企业落地还有个很好用的工具，那就是各种智能体（agent)。比如，新员工入职总会有部门负责人带着熟悉公司业务，包括介绍公司的各项规章制度。但一般也就讲个大概，具体细节还是看公司里的员工手册。而具体业务上的事情，一般是集体培训或者老师带徒弟这种。但不管哪种，总有些事情是在遇到了才想到了要询问老员工。如果询问的多了，时间成本耗不起呀。所以我就做了个公司百事通智能体。所有跟公司相关的，包括规章制度，岗位职责，产品介绍，售前政策，售后政策，各平台操作指南等等都在这个智能体里。</p>
<h3 data-id="heading-10">智能体</h3>
<p>我把智能体分几类，从简单到复杂。</p>
<p><strong>第一类：提示词智能体（Prompt）。</strong>  通过内置特定人设提示词实现，如专门给孩子批改作文的语文老师智能体。一般只要你想要约束AI输出的内容，就可以针对性设计提示词做一个智能体。</p>
<p><strong>第二类：提示词 + 知识库（RAG）。</strong>  难点在于如何将非结构化文本转化为AI可精准解析的知识。它更垂直，能根据企业私有知识库回答问题，适用于员工手册、产品说明书或法律法规检索。</p>
<p><strong>第三类：提示词 + 知识库 + MCP（Tools）。</strong>  引入MCP协议调用外部工具（如查天气、订机票）。此时AI开始从生成内容转向执行动作，拥有的工具越多，能力边界越广。</p>
<p><strong>第四类：特定工作流智能体（Workflow）。</strong>  这个就厉害了，只要你不嫌麻烦，什么场景都能做。前面介绍的AI客服就是这样搭建的。</p>
<p><strong>第五类：多智能体协同（Multi-Agent）。</strong>  不是一个 AI 在战斗，而是一群 AI齐心协力帮你做事。比如，我用的一个开源项目微舆，多Agent舆情分析助手。当你需要深入调研某件事情的时候，可以用它。一次任务，会调用几百次AI，最后输出一个很不错的调研报告。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1994763bbfe45c189d791cf4ee824dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5LqR5Y2H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768648546&amp;x-signature=e%2BPGhmu5sFhlfeD%2F0M5Oz2OEZdQ%3D" alt="图片" loading="lazy"/>​</p>
<p>以上是一些案例上的思路分享。当然，上面的分享只是AI企业落地的第一步，后面还需要做组织上的进化，企业AI落地并不是一个人或者一个部门的事。它是整个组织的事。</p>
<p>我叫石云升，同名公众号AI博主，在公司负责AI企业落地，关注我，后续分享更多AI落地经验。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NestJS 🧑‍🍳 厨子必修课（九）：API 文档 Swagger]]></title>    <link>https://juejin.cn/post/7593232758127542278</link>    <guid>https://juejin.cn/post/7593232758127542278</guid>    <pubDate>2026-01-10T11:25:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593232758127542278" data-draft-id="7593215107406823460" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NestJS 🧑‍🍳 厨子必修课（九）：API 文档 Swagger"/> <meta itemprop="keywords" content="前端,后端,NestJS"/> <meta itemprop="datePublished" content="2026-01-10T11:25:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="菠萝的蜜"/> <meta itemprop="url" content="https://juejin.cn/user/2154698521972423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NestJS 🧑‍🍳 厨子必修课（九）：API 文档 Swagger
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2154698521972423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    菠萝的蜜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T11:25:07.000Z" title="Sat Jan 10 2026 11:25:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 前言</h2>
<p>后端 API 开发完成后，需要给前端一份接口文档，Swagger 能够帮助我们自动生成接口文档，这将会用到 <code>@nestjs/swagger</code> 和 <code>swagger-ui-express</code>。</p>
<p>欢迎加入<a href="https://juejin.cn/user/2154698521972423/pins" target="_blank" title="https://juejin.cn/user/2154698521972423/pins">技术交流群</a>。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=1MezTLjw6cgEyLRSiZU84XYgOD0%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li><a href="https://juejin.cn/post/7407260232664186930" target="_blank" title="https://juejin.cn/post/7407260232664186930">NestJS 🧑‍🍳  厨子必修课（一）：后端的本质</a></li>
<li><a href="https://juejin.cn/post/7408021285768445961" target="_blank" title="https://juejin.cn/post/7408021285768445961">NestJS 🧑‍🍳 厨子必修课（二）：项目创建</a></li>
<li><a href="https://juejin.cn/post/7408778862283096102" target="_blank" title="https://juejin.cn/post/7408778862283096102">NestJS 🧑‍🍳 厨子必修课（三）：控制器</a></li>
<li><a href="https://juejin.cn/post/7416235834938212403" target="_blank" title="https://juejin.cn/post/7416235834938212403">NestJS 🧑‍🍳 厨子必修课（四）：服务类</a></li>
<li><a href="https://juejin.cn/post/7416908856868110374" target="_blank" title="https://juejin.cn/post/7416908856868110374">NestJS 🧑‍🍳 厨子必修课（五）：Prisma 集成（上）</a></li>
<li><a href="https://juejin.cn/post/7418460243502792731" target="_blank" title="https://juejin.cn/post/7418460243502792731">NestJS 🧑‍🍳 厨子必修课（六）：Prisma 集成（下）</a></li>
<li><a href="https://juejin.cn/post/7419887372463554601" target="_blank" title="https://juejin.cn/post/7419887372463554601">NestJS 🧑‍🍳 厨子必修课（七）：管道</a></li>
<li><a href="https://juejin.cn/post/7420272008146239514" target="_blank" title="https://juejin.cn/post/7420272008146239514">NestJS 🧑‍🍳 厨子必修课（八）：异常过滤器</a></li>
</ol>
<h2 data-id="heading-1">2. 安装与初始化</h2>
<h3 data-id="heading-2">2.1 安装</h3>
<pre><code class="hljs language-bash" lang="bash">npm install @nestjs/swagger swagger-ui-express
</code></pre>
<h3 data-id="heading-3">2.2 在 main.ts 中配置 Swagger</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ...</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DocumentBuilder</span>, <span class="hljs-title class_">SwaggerModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/swagger'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);
  
  <span class="hljs-comment">// ...</span>

  <span class="hljs-comment">// 配置 Swagger</span>
  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentBuilder</span>()
    .<span class="hljs-title function_">setTitle</span>(<span class="hljs-string">'NestJS API for Cook'</span>)
    .<span class="hljs-title function_">setDescription</span>(<span class="hljs-string">'The NestJS API description for Cook'</span>)
    .<span class="hljs-title function_">setVersion</span>(<span class="hljs-string">'0.1'</span>)
    .<span class="hljs-title function_">build</span>();
  <span class="hljs-comment">// 创建 API 文档</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">document</span> = <span class="hljs-title class_">SwaggerModule</span>.<span class="hljs-title function_">createDocument</span>(app, config);
  <span class="hljs-comment">// 启动 Swagger UI</span>
  <span class="hljs-title class_">SwaggerModule</span>.<span class="hljs-title function_">setup</span>(<span class="hljs-string">'api'</span>, app, <span class="hljs-variable language_">document</span>);
  
  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
}
<span class="hljs-title function_">bootstrap</span>();
</code></pre>
<p>接口文档的标题为：NestJS API for Cook，描述为：The NestJS API description for Cook，版本为 0.1，被设置在了 /api 路径下。</p>
<h3 data-id="heading-4">2.3 查看文档</h3>
<p>进入 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2Fapi%23%2F" target="_blank" title="http://localhost:3000/api#/" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2Fapi" target="_blank" title="http://localhost:3000/api" ref="nofollow noopener noreferrer">http://localhost:3000/api</a> 就能在线查看接口文档：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5c0196a329e4b11bcf953a6c15c6cf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=hmr89ZYigoKuc9qH23KfM7c70PU%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到之前写的接口都在上面。以 users 模块的接口为例，接口具体由以下内容构成：</p>
<ul>
<li>Parameters 👉 参数，包括 path 参数和 query 参数两类。</li>
<li>Request body 👉 请求 body 数据，包括例子展示 example values 和数据类型 schema。（一般存在于 POST 和 PATCH 请求中）</li>
<li>Responses 👉 响应，包括状态码 code 和描述 description。</li>
</ul>
<h4 data-id="heading-5">POST /users</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a29a4d950f64f91815ffd5a4aa1d2a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=BRpelMxcxAjzFCzqS4602c1fcdU%3D" alt="image.png" loading="lazy"/></p>
<p>不需要传参数，但需要传 body 数据。</p>
<h4 data-id="heading-6">GET /users</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/676fef5cd87f447d9e8013b6105cf449~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=Lsg5iopfWc3BcpmhFFgXubLIRCo%3D" alt="image.png" loading="lazy"/></p>
<p>需要传 <code>pageNum</code> 和 <code>pageSize</code>。</p>
<h4 data-id="heading-7">GET /users/search</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f8646127d7f47c8971903cf21705d8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=mN21CZ8y7Mhkg5wiLhAhklw4eLU%3D" alt="image.png" loading="lazy"/></p>
<p>需要传 <code>query</code>。</p>
<h4 data-id="heading-8">GET /users/{id}</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9714b860e857467da886001278282828~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=7jhbpPT5RB35FfS3yWBK308VCvE%3D" alt="image.png" loading="lazy"/></p>
<p>这里需要传的 <code>id</code> 属于 path 参数，在代码中也是动态的。</p>
<h4 data-id="heading-9">PATCH /users/{id}</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfeefd8af6fd41f1b55c700351424bee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=v3rsrh8wjU3yiODAxbveXg8G7Ro%3D" alt="image.png" loading="lazy"/></p>
<p>需要传 <code>id</code> 以及修改的 <code>body</code> 数据。</p>
<h4 data-id="heading-10">DELETE /users/{id}</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ee540c0bf3348e1afd92511d634f91d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=qgNpX7evTB7y25O4o9v6wkIaYTc%3D" alt="image.png" loading="lazy"/></p>
<p>删除只需要传递 <code>id</code>。</p>
<h4 data-id="heading-11">PATCH /users/{id}/role</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/612e732874584440b6effd8445cc5efe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=T9G8nQez9w6DiEDke%2FEEbezJeKU%3D" alt="image.png" loading="lazy"/></p>
<p>修改指定用户的角色，要传递 <code>id</code> 以及 <code>body</code> 数据。</p>
<h3 data-id="heading-12">2.4 接口测试</h3>
<p>可以看到每一个接口的右侧都有一个 <strong>Try it out</strong> 按钮，点击可以对接口进行测试。</p>
<h2 data-id="heading-13">3. 基础<strong>注解</strong></h2>
<p>现在的文档还存在 2 个问题，第一是没有区分 API 版本；第二是所有的接口都在 default 分组下没有按照模块来划分。</p>
<p>首先给路由全局设置 api 版本前缀：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// main.ts</span>
app.<span class="hljs-title function_">setGlobalPrefix</span>(<span class="hljs-string">'api/v1'</span>);
</code></pre>
<p>再次打开 /api 查看，就设置上了前缀：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05a0cc49b3c44a24bd2b7781286c1f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=Fx61IVuDKN068IYXiuNCHUITtkU%3D" alt="image.png" loading="lazy"/></p>
<p>⚠️ 注意：和设置管道、过滤器那些类似，当然也为单个控制器设置。</p>
<p><code>@nestjs/swagger</code> 包提供了一些装饰器用于对文档进行注解，下面以 users 为例。</p>
<h3 data-id="heading-14">3.1 <code>@ApiTags()</code></h3>
<p><code>@ApiTags()</code> 用于对控制器进行分组。</p>
<pre><code class="hljs language-diff" lang="diff">// users.controller.ts
@Controller('users')
<span class="hljs-addition">+ @ApiTags('用户管理')</span>
export class UsersController {
// ...
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6964275efd5b43bf9b4ed079f2d9f5a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=6xJyJ%2FnkudymfQJazw6uslfohDw%3D" alt="image.png" loading="lazy"/></p>
<p>有关 users 的路由被分在“用户管理”类别下。</p>
<h3 data-id="heading-15">3.2 <code>@ApiOperation()</code></h3>
<p><code>@ApiOperation()</code> 用于描述 API 的操作。</p>
<pre><code class="hljs language-diff" lang="diff">// users.controller.ts
@Post()
<span class="hljs-addition">+ @ApiOperation({ summary: '创建新用户' })</span>
create(
  @Body('name', UniqueUsernamePipe) name: string,
  @Body() createUserDto: CreateUserDto,
) {
  return this.usersService.create(createUserDto);
}
// ...
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/891a91ab017946d1bb7a939f385bbf54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=QJbfqnabruza8BeXLxioZbtRxsw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-16">4. 高级注解</h2>
<p>另外，无论是请求体还是响应体的文档内容都缺少描述，示例也过于简单。DTO 可以帮助定义请求体或响应体的数据结构，并通过 <code>@ApiProperty()</code> 注解为每个字段添加描述，自动生成文档。</p>
<h3 data-id="heading-17">4.1 <code>@ApiProperty()</code> - DTO（Data Transfer Object）传输层</h3>
<p>DTO 用于定义数据传输的结构，通常在控制器中用于<strong>请求和响应的数据验证</strong>，会结合验证库 <code>class-validator</code> 来执行字段验证。</p>
<p><code>@ApiProperty()</code> 除了为 DTO 中的字段添加描述 <code>description</code> ，还可以添加例子 <code>example</code>，这样就使得每个 API 的输入输出更加清晰。</p>
<p>users 模块的 DTO 有三个：</p>
<ul>
<li>create-user.dto.ts 创建用户</li>
<li>update-user.dto.ts 更新用户</li>
<li>update-user-role.dto.ts 更新用户角色</li>
</ul>
<p>例如，创建用户的请求可以有一个 CreateUserDto 类，包含字段 name、email 等：</p>
<h4 data-id="heading-18">create-user.dto.ts</h4>
<pre><code class="hljs language-diff" lang="diff">import { UserRole } from '@prisma/client';
<span class="hljs-addition">+ import { ApiProperty } from '@nestjs/swagger';</span>
import {
  IsNotEmpty,
  MinLength,
  IsEmail,
  IsString,
  IsEnum,
  IsOptional,
} from 'class-validator';

export class CreateUserDto {
<span class="hljs-addition">+  @ApiProperty({ description: '用户名', example: 'zhangsan' })</span>
  @IsString()
  @IsNotEmpty()
  @MinLength(3)
  name: string;

<span class="hljs-addition">+  @ApiProperty({ description: '用户邮箱', example: 'zhangsan@example.com' })</span>
  @IsEmail()
  @IsNotEmpty()
  email: string;

<span class="hljs-addition">+  @ApiProperty({ description: '用户密码', example: 'password123' })</span>
  @IsString()
  @IsNotEmpty()
  @MinLength(8)
  password: string;

  @IsEnum(UserRole, { message: 'Role must be a valid user role' })
  @IsOptional()
  role: UserRole;
}
</code></pre>
<p>创建一个用户需要 <code>name</code>、<code>email</code>、<code>password</code>、<code>role</code>，最后一个 <code>role</code> 不是必填项，不必加上 <code>@ApiProperty</code> 装饰器。</p>
<p>在请求 body 数据的 <strong>Schema</strong> 中可以看到 <code>description</code> 和 <code>example</code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91f237d4d4e84f31b0bfcd68a574b612~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=ZgtoWLRJYuy%2FW3jSDTMpe%2BrS3BU%3D" alt="image.png" loading="lazy"/></p>
<p><code>example</code> 同时也作为 <strong>Example Value</strong> 中的示例值：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ddf1614ade4839964b5b89b2b4cc67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=GI9IG5gJkfMl3kmWbZVfr442nKM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-19">update-user.dto.ts</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApiProperty</span>, <span class="hljs-title class_">PartialType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/swagger'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CreateUserDto</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./create-user.dto'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateUserDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PartialType</span>(<span class="hljs-title class_">CreateUserDto</span>) {
  <span class="hljs-meta">@ApiProperty</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">'用户名'</span>, <span class="hljs-attr">example</span>: <span class="hljs-string">'lisi'</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span> })
  name?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@ApiProperty</span>({
    <span class="hljs-attr">description</span>: <span class="hljs-string">'用户邮箱'</span>,
    <span class="hljs-attr">example</span>: <span class="hljs-string">'lisi@example.com'</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
  })
  email?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@ApiProperty</span>({
    <span class="hljs-attr">description</span>: <span class="hljs-string">'用户密码'</span>,
    <span class="hljs-attr">example</span>: <span class="hljs-string">'newpassword123'</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
  })
  password?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3988644e17a4c59aaf6ed3fe9bd4599~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=n5QI03uUg1Qykkss%2F%2FLyTPDhxmY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-20">update-user-role.dto.ts</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApiProperty</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/swagger'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserRole</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../enums/user-role.enum'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateUserRoleDto</span> {
  <span class="hljs-meta">@ApiProperty</span>({
    <span class="hljs-attr">description</span>: <span class="hljs-string">'用户角色'</span>,
    <span class="hljs-attr">example</span>: <span class="hljs-title class_">UserRole</span>.<span class="hljs-property">ADMIN</span>,
    <span class="hljs-attr">enum</span>: <span class="hljs-title class_">UserRole</span>,
  })
  <span class="hljs-attr">role</span>: <span class="hljs-title class_">UserRole</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9cd5df20bb64a33b083adf19cba7439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=x6dZt9sFTBvFbWy9h1ES4llOoqo%3D" alt="image.png" loading="lazy"/></p>
<p><code>enum</code> 表示这个参数是一个枚举类型，具体值来自 <code>UserRole</code>：</p>
<pre><code class="hljs language-ini" lang="ini">// ../enums/user-role.enum.ts
export enum UserRole {
  <span class="hljs-attr">USER</span> = <span class="hljs-string">'USER'</span>,
  <span class="hljs-attr">ADMIN</span> = <span class="hljs-string">'ADMIN'</span>,
}
</code></pre>
<p>这与 schema.prisma 中定义的保持一致：</p>
<pre><code class="hljs language-schema" lang="schema">// ...

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

enum UserRole {
  USER
  ADMIN
}
</code></pre>
<h3 data-id="heading-21">4.2 <code>@ApiQuery()</code> - 查询参数</h3>
<p>对于创建和更新数据实体可以使用 <code>@ApiProperty()</code> 注解，而对于请求体的查询参数就要使用 <code>@ApiQuery()</code> 了。</p>
<pre><code class="hljs language-diff" lang="diff">@Get()
@ApiOperation({ summary: '获取所有用户' })
<span class="hljs-addition">+ @ApiQuery({ name: 'pageNum', description: '页码', required: false })</span>
<span class="hljs-addition">+ @ApiQuery({ name: 'pageSize', description: '每页条数', required: false })</span>
findAll(
  @Query('pageNum') pageNum?: number,
  @Query('pageSize') pageSize?: number,
) {
  return this.usersService.findAll(pageNum, pageSize);
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c2f2153899c4c4db74bb379c400b087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=xOX1POXGeESEy1I0Eak%2FOV8CFkM%3D" alt="image.png" loading="lazy"/></p>
<p>上面的注解为文档的查询参数添加了描述 <code>description</code> 以及是否为必填项 <code>required</code>。</p>
<p>再比如搜索用户：</p>
<pre><code class="hljs language-diff" lang="diff">@Get('search')
@ApiOperation({ summary: '搜索用户' })
<span class="hljs-addition">+ @ApiQuery({ name: 'query', description: '搜索关键词', example: '张三' })</span>
search(@Query('query') query: string) {
  return this.usersService.searchUsers(query);
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58c359b5d1a446b48be7732ae4364b05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=7Lp%2Bvm8ikilmohfHhejhIhl5Fuo%3D" alt="image.png" loading="lazy"/></p>
<p>额外加上 <code>example</code>，示例更完善。</p>
<h3 data-id="heading-22">4.3 <code>@ApiParam()</code> - 路径参数</h3>
<p>请求 URL 上路径参数则使用 <code>@ApiParam()</code> 来定义，也就是动态参数。</p>
<pre><code class="hljs language-diff" lang="diff">@Get(':id')
@ApiOperation({ summary: '根据ID获取用户' })
<span class="hljs-addition">+ @ApiParam({ name: 'id', description: '用户ID', example: 1 })</span>
findOne(@Param('id', ParseIntPipe) id: number) {
  return this.usersService.findOne(id);
}

// ...
</code></pre>
<p>上面以 GET 方法为例，PATCH、DELETE 同理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f8da765626d413683c2c46b36bad248~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=Dzs06vRBCRS8QLvfq7%2FdeXFffF8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-23">4.4 <code>@ApiBody()</code> - 请求体结构</h3>
<p><code>@ApiBody()</code> 用于描述复杂的请求体结构，它和 DTO 一起用：</p>
<pre><code class="hljs language-diff" lang="diff">@Post()
@ApiOperation({ summary: '创建新用户' })
<span class="hljs-addition">+ @ApiBody({ type: CreateUserDto })</span>
@ApiResponse({ status: 201, description: '用户创建成功' })
@ApiResponse({ status: 400, description: '无效的输入数据' })
create(
  @Body('name', UniqueUsernamePipe) name: string,
  @Body() createUserDto: CreateUserDto,
) {
  return this.usersService.create(createUserDto);
}
</code></pre>
<h3 data-id="heading-24">4.5 <code>@ApiResponse()</code> - 状态码</h3>
<p><code>@ApiResponse()</code> 用于定义返回的响应状态码 <code>status</code> 和描述 <code>description</code>。</p>
<pre><code class="hljs language-diff" lang="diff">@Post()
@ApiOperation({ summary: '创建新用户' })
@ApiBody({ type: CreateUserDto })
<span class="hljs-addition">+ @ApiResponse({ status: 201, description: '用户创建成功' })</span>
<span class="hljs-addition">+ @ApiResponse({ status: 400, description: '无效的输入数据' })</span>
create(
  @Body('name', UniqueUsernamePipe) name: string,
  @Body() createUserDto: CreateUserDto,
) {
  return this.usersService.create(createUserDto);
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f8359acd35c440db194ccc6624735ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768649107&amp;x-signature=4DEkIRZBvkOSTdzgGeLTuB%2BFe%2B4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-25">5. 总结</h2>
<p>本文介绍了 Swagger 在 NestJS 项目中的集成、配置以及注解用法，适合开发者在实际项目中生成清晰易读的 API 文档。其实除了 dto 文件，还有一个 entity 文件，它用于结合传统 ORM（如 TypeORM）定义数据实体，在笔者的教程中，使用 Prisma 作为 ORM，只有用 dto 就可以了，这是为什么呢？</p>
<p><strong>原因</strong></p>
<ol>
<li><strong>Prisma 的数据模型文件已经定义了数据库结构</strong>：在 Prisma 中，schema.prisma 文件用于定义数据库模型，它描述了数据库表的结构和关系。相比于传统 ORM（如 TypeORM）的实体类，这个文件就相当于实体的定义。</li>
<li><strong>DTO 负责请求和响应的数据结构</strong>：DTO（Data Transfer Object）用于定义请求体和响应体的结构，并结合验证器（如 class-validator）进行数据验证和转换。它可以独立于数据库模型来使用，确保数据输入输出的安全和一致性。</li>
<li><strong>减少重复定义</strong>：如果已经有 schema.prisma 文件和 DTO 类，再定义一个实体类会增加重复和维护的成本。使用 Prisma 时，主要依赖 PrismaClient 来执行数据库操作，直接使用 DTO 和 schema.prisma 文件即可满足大多数业务需求。</li>
</ol>
<p><strong>典型用法</strong></p>
<ul>
<li><strong>Prisma 负责数据库的持久化</strong>：使用 schema.prisma 定义数据库表结构，通过 Prisma 的 PrismaClient 进行数据查询和操作。</li>
<li><strong>DTO 负责请求和响应的数据格式</strong>：通过 DTO 类定义 API 请求体和响应体的结构，并结合 Swagger 生成 API 文档。</li>
</ul>
<p>这种做法符合“分离关注点”的原则，使得数据库层（Prisma）和数据传输层（DTO）各司其职。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Parcel 作者：如何用静态Hermes把JavaScript编译成C语言]]></title>    <link>https://juejin.cn/post/7593254419078365224</link>    <guid>https://juejin.cn/post/7593254419078365224</guid>    <pubDate>2026-01-10T09:51:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593254419078365224" data-draft-id="7593254419078332456" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Parcel 作者：如何用静态Hermes把JavaScript编译成C语言"/> <meta itemprop="keywords" content="前端,JavaScript,Rust"/> <meta itemprop="datePublished" content="2026-01-10T09:51:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yanni4Night"/> <meta itemprop="url" content="https://juejin.cn/user/4089838983724520"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Parcel 作者：如何用静态Hermes把JavaScript编译成C语言
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4089838983724520/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yanni4Night
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:51:19.000Z" title="Sat Jan 10 2026 09:51:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevongovett.me%2Fblog%2Fstatic-hermes.html" target="_blank" title="https://devongovett.me/blog/static-hermes.html" ref="nofollow noopener noreferrer">devongovett.me/blog/static…</a>，parcel 作者 Devon 的博客</p>
</blockquote>
<p>最近我一直在把Parcel的更多部分移植到Rust上。基于Rust的工具面临的一大挑战就是如何支持插件。很多常用工具已经有了Rust版本的平替：比如处理JavaScript的SWC和OXC，CSS的Lightning CSS，SVG的oxvg等等。但像React Compiler、Less和Sass这些热门工具还在用JavaScript编写，所以我们得想办法在Rust工具里运行它们。</p>
<p>一种方案是通过napi把Rust核心嵌入Node。这种模式下，程序的入口是JavaScript，它会调用Rust代码。当Rust需要调用JS插件时，再回调到JavaScript引擎。Lightning CSS的JS插件就是这么实现的。不过这会带来一些性能损耗：我开发Lightning CSS时测过，用JS插件比不用慢了大概7倍。</p>
<p>另一种类似的方案是跨进程通信。这种模式下入口是Rust，需要运行插件时就启动Node子进程。这同样会有不小的性能开销。</p>
<h2 data-id="heading-0">静态Hermes</h2>
<p>Hermes是Facebook为React Native打造的定制JavaScript引擎。最新版本的静态Hermes（Static Hermes）采用了全新思路：它不再在运行时使用JIT（即时）编译器，而是提前把JavaScript编译成字节码或原生二进制文件。这样就省去了运行时编译和优化代码的启动时间，这在手机上可是个不小的提升。</p>
<p>静态Hermes的工作原理是把JavaScript编译成C代码，再通过LLVM编译成机器码。最终生成的是完全独立的二进制文件，不需要JavaScript虚拟机就能运行。编译出的C代码会用到Hermes提供的一些辅助函数，这些函数会像Rust等语言的标准库一样被静态链接到二进制文件中。这不仅能利用LLVM的高级优化提升性能，还能让JavaScript轻松嵌入到Rust这类能和C交互的语言编写的程序中。</p>
<h2 data-id="heading-1">把Less.js编译成C</h2>
<p>我打算给Parcel做个Less插件，能从Rust调用的那种。借助静态Hermes，我成功把它编译成了C库，然后就能从Rust调用了。</p>
<p>第一步是把less这个npm模块打包成一个没有外部依赖的单文件JavaScript。Hermes不支持Node模块，所以一切都得自给自足，也不能依赖<code>fs</code>或<code>path</code>这些Node内置模块。当然，我用Parcel来做这件事。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用Less的环境无关版本，并模拟PluginLoader</span>
<span class="hljs-keyword">const</span> less = <span class="hljs-built_in">require</span>(<span class="hljs-string">'less/lib/less'</span>).<span class="hljs-title function_">default</span>({}, {})
less.<span class="hljs-property">PluginLoader</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// 暴露一个全局函数，把Less代码字符串编译成CSS</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">compile</span>(<span class="hljs-params">input</span>) {
  <span class="hljs-keyword">let</span> result
  less.<span class="hljs-title function_">render</span>(input, <span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> {
    result = res.<span class="hljs-property">css</span>
  })
  <span class="hljs-keyword">return</span> result
}

globalThis.<span class="hljs-property">compile</span> = compile
</code></pre>
<p>用Parcel编译：</p>
<pre><code class="hljs language-bash" lang="bash">parcel build less.js --no-optimize
</code></pre>
<p>这样就生成了<code>dist/less.js</code>，一个完全独立的文件，暴露了全局的<code>compile</code>函数。</p>
<p>接下来把它编译成C库。首先得自己编译静态Hermes，按照官方文档操作就行。</p>
<pre><code class="hljs language-bash" lang="bash">./build_release/bin/shermes -O -c -exported-unit=less dist/less.js
</code></pre>
<ul>
<li><code>-O</code> 生成优化过的构建</li>
<li><code>-c</code> 编译成原生目标文件，之后可以链接到更大的程序中</li>
<li><code>-exported-unit=less</code> 告诉Hermes不要生成<code>main</code>函数，而是导出一个叫<code>less</code>的编译单元</li>
</ul>
<p>这会生成<code>less.o</code>目标文件。（如果想看看编译出的C源代码，可以把<code>-c</code>换成<code>-emit-c</code>。）</p>
<p>然后需要一个小的C包装器来调用这个JavaScript函数。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// compile.c</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hermes/VM/static_h.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hermes/hermes.h&gt;</span></span>

<span class="hljs-comment">// 声明静态Hermes生成的`less`单元</span>
<span class="hljs-comment">// 这个会来自`less.o`</span>
<span class="hljs-keyword">extern</span> \<span class="hljs-string">"C\" SHUnit sh_export_less;

extern \"C\" char* compile_less(char *in) {
  // 初始化Hermes运行时
  static SHRuntime *s_shRuntime = nullptr;
  static facebook::hermes::HermesRuntime *s_hermes = nullptr;

  if (s_shRuntime == nullptr) {
    s_shRuntime = _sh_init(0, nullptr);
    s_hermes = _sh_get_hermes_runtime(s_shRuntime);
    if (!_sh_initialize_units(s_shRuntime, 1, &amp;sh_export_less)) {
      abort();
    }
  }

  // 获取全局的`compile`函数并调用
  std::string res = s_hermes-&gt;global()
    .getPropertyAsFunction(*s_hermes, \"compile\")
    .call(*s_hermes, std::string(in))
    .getString(*s_hermes)
    .utf8(*s_hermes);

  // 把C++字符串转成能返回的C字符串
  char* result = new char[res.size() + 1];
  strcpy(result, res.c_str());
  return result;
}
</span></code></pre>
<p>用<code>clang++</code>把这个编译成另一个目标文件：</p>
<pre><code class="hljs language-bash" lang="bash">clang++ -c -O3 -std=c++17 -IAPI -IAPI/jsi -Iinclude -Ipublic -Ibuild_release/lib/config compile.c
</code></pre>
<ul>
<li><code>-c</code> 生成目标文件</li>
<li><code>-O3</code> 生成优化过的构建</li>
<li><code>-std=c++17</code> 启用C++17特性</li>
<li><code>-I</code> 添加Hermes的头文件路径</li>
</ul>
<p>这会生成<code>compile.o</code>目标文件。</p>
<p>最后就是从Rust调用这个<code>compile_less</code>函数了。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// main.rs</span>
<span class="hljs-keyword">use</span> std::ffi::{CStr, CString};
<span class="hljs-keyword">use</span> std::os::raw::c_char;

<span class="hljs-comment">// 声明要调用的C函数</span>
<span class="hljs-keyword">extern</span> \<span class="hljs-string">"C\" {
  fn compile_less(input: *const c_char) -&gt; *const c_char;
}

fn main() {
  // 创建C字符串
  let input = CString::new(
    r#\"// 变量
      @link-color: #428bca;
      @link-color-hover: darken(@link-color, 10%);

      a,
      .link {
        color: @link-color;
      }
      a:hover {
        color: @link-color-hover;
      }
      .widget {
        color: #fff;
        background: @link-color;
      }
    \"#,
  )
  .unwrap();

  // 调用C函数并转成Rust字符串
  let res = unsafe {
    let ptr = compile_less(input.as_ptr());
    CStr::from_ptr(ptr).to_string_lossy().into_owned()
  };

  // 打印结果
  println!(\"OUTPUT: {}\", res);
}
</span></code></pre>
<p>用<code>rustc</code>编译并链接所有东西：</p>
<pre><code class="hljs language-bash" lang="bash">rustc main.rs -O -C link-arg=less.o -C link-arg=compile.o -Lbuild_release/lib -Lbuild_release/jsi -Lbuild_release/tools/shermes -lshermes_console_a -lhermesvm_a -ljsi -lc++ -Lbuild_release/external/boost/boost_1_86_0/libs/context/ -lboost_context -l framework=Foundation
</code></pre>
<ul>
<li><code>-O</code> 生成优化过的构建</li>
<li><code>-C link-arg=less.o -C link-arg=compile.o</code> 链接之前创建的C库</li>
<li><code>-L ...</code> 添加库搜索路径</li>
<li><code>-l ...</code> 链接Hermes库和依赖</li>
<li><code>-l framework=Foundation</code> 是macOS特有的，用来链接Foundation框架</li>
</ul>
<p>现在运行程序，就能看到它通过Rust编译Less了！🪄</p>
<pre><code class="hljs language-bash" lang="bash">./main
</code></pre>
<h2 data-id="heading-2">总结</h2>
<p>这只是个简单的初步示例，但展示了原生工具整合预编译JS插件的潜力，而且不需要嵌入解释器。另一个潜在用例是基于Babel的React Compiler——对很多人来说，这可能是他们构建流程中仅存的JS工具了。我简单试了下，但遇到了一些问题，可能是目前还缺少某些特性</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小探mysql覆盖索引]]></title>    <link>https://juejin.cn/post/7593198957984661545</link>    <guid>https://juejin.cn/post/7593198957984661545</guid>    <pubDate>2026-01-10T10:27:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593198957984661545" data-draft-id="7593215107406807076" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小探mysql覆盖索引"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2026-01-10T10:27:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小探mysql覆盖索引
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T10:27:56.000Z" title="Sat Jan 10 2026 10:27:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 MySQL 中，<strong>覆盖索引（Covering Index）</strong> 是一种非常重要的查询优化技术。它的核心思想是：<strong>一个索引包含了查询所需的所有字段，因此 MySQL 可以直接从索引中获取数据，而无需回表（即无需访问主键索引或数据行）</strong> 。</p>
<hr/>
<h2 data-id="heading-0">🔍 一、为什么需要覆盖索引？</h2>
<h3 data-id="heading-1">1. <strong>普通索引查询的流程（非覆盖）</strong></h3>
<p>假设有一张用户表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    age <span class="hljs-type">INT</span>,
    INDEX idx_name (name)
);
</code></pre>
<p>执行查询：</p>
<pre><code class="hljs language-ini" lang="ini">SELECT email FROM users WHERE <span class="hljs-attr">name</span> = <span class="hljs-string">'Alice'</span><span class="hljs-comment">;</span>
</code></pre>
<p>🔍 <strong>执行过程</strong>：</p>
<ol>
<li>在 <code>idx_name</code> 索引中查找 <code>name = 'Alice'</code> 的记录；</li>
<li>找到对应的 <strong>主键值（id）</strong> ；</li>
<li><strong>回表（回主键索引）</strong> ：用主键 <code>id</code> 去聚簇索引（InnoDB 的主键索引）中查找完整的行数据；</li>
<li>从行数据中提取 <code>email</code> 字段返回。</li>
</ol>
<blockquote>
<p>⚠️ <strong>问题</strong>：多了一次“回表”操作，增加了 I/O 和 CPU 开销。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">2. <strong>覆盖索引的查询流程</strong></h3>
<p>如果我们将索引改为：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建包含 name 和 email 的联合索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_name_email <span class="hljs-keyword">ON</span> users (name, email);
</code></pre>
<p>再执行相同查询：</p>
<pre><code class="hljs language-ini" lang="ini">SELECT email FROM users WHERE <span class="hljs-attr">name</span> = <span class="hljs-string">'Alice'</span><span class="hljs-comment">;</span>
</code></pre>
<p>✅ <strong>执行过程</strong>：</p>
<ol>
<li>在 <code>idx_name_email</code> 索引中查找 <code>name = 'Alice'</code>；</li>
<li><strong>直接从索引叶子节点中读取 <code>email</code> 值</strong>；</li>
<li><strong>无需回表！</strong></li>
</ol>
<blockquote>
<p>🎯 <strong>这就是覆盖索引：查询所需的所有列都包含在索引中。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-3">✅ 二、覆盖索引的核心优势</h2>

























<table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td><strong>减少 I/O 操作</strong></td><td>避免回表，少读一次聚簇索引（磁盘或缓冲池）</td></tr><tr><td><strong>提升查询速度</strong></td><td>尤其对大表、高并发场景效果显著</td></tr><tr><td><strong>降低 CPU 消耗</strong></td><td>减少数据解析和内存拷贝</td></tr><tr><td><strong>利用索引顺序性</strong></td><td>覆盖索引常配合 <code>ORDER BY</code> 实现“索引扫描排序”</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">🛠️ 三、如何判断是否使用了覆盖索引？</h2>
<p>使用 <code>EXPLAIN</code> 查看执行计划：</p>
<pre><code class="hljs language-ini" lang="ini">EXPLAIN SELECT email FROM users WHERE <span class="hljs-attr">name</span> = <span class="hljs-string">'Alice'</span><span class="hljs-comment">;</span>
</code></pre>
<p>关键看 <strong><code>Extra</code> 列</strong>：</p>
<ul>
<li>如果显示 <strong><code>Using index</code></strong> → ✅ 使用了覆盖索引</li>
<li>如果显示 <strong><code>Using where</code></strong> 或 <strong>空</strong> → ❌ 未覆盖，需要回表</li>
</ul>
<blockquote>
<p>✅ 示例输出：</p>
<pre><code class="hljs language-sql" lang="sql">id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span> <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys     <span class="hljs-operator">|</span> key             <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> Extra
<span class="hljs-number">1</span>  <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> users <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_name_email    <span class="hljs-operator">|</span> idx_name_email  <span class="hljs-operator">|</span> <span class="hljs-number">303</span>     <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span> <span class="hljs-number">1</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index
</code></pre>
</blockquote>
<hr/>
<h2 data-id="heading-5">📌 四、覆盖索引的使用条件</h2>
<ol>
<li><strong>SELECT 的所有字段</strong> 必须包含在同一个索引中；</li>
<li><strong>WHERE 条件字段</strong> 也应尽可能在该索引中（用于快速定位）；</li>
<li><strong>不能包含未索引的列</strong>（如 <code>SELECT *</code> 通常无法覆盖，除非是主键表）；</li>
<li><strong>适用于 InnoDB 和 MyISAM</strong>（但 InnoDB 的聚簇索引结构使其更依赖覆盖索引来避免回表）。</li>
</ol>
<hr/>
<h2 data-id="heading-6">⚠️ 五、注意事项与陷阱</h2>
<h3 data-id="heading-7">1. <strong>不要盲目创建宽索引</strong></h3>
<ul>
<li>索引越大，写入（INSERT/UPDATE）越慢；</li>
<li>占用更多磁盘和内存（Buffer Pool）；</li>
<li><strong>只包含真正需要的字段</strong>。</li>
</ul>
<h3 data-id="heading-8">2. <strong>主键自动包含在 InnoDB 二级索引中</strong></h3>
<p>InnoDB 的二级索引叶子节点存储的是 <strong>(索引列, 主键值)</strong> 。<br/>
所以以下查询也能覆盖：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 表：users(id PK, name, email)</span>
<span class="hljs-comment">-- 索引：idx_name(name)</span>

<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;  <span class="hljs-comment">-- ✅ 覆盖！因为 id 在二级索引中</span>
</code></pre>
<p>但：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> email <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;  <span class="hljs-comment">-- ❌ 不覆盖！email 不在 idx_name 中</span>
</code></pre>
<h3 data-id="heading-9">3. <strong>函数或表达式会破坏覆盖</strong></h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 即使有 idx_email(email)，以下查询也无法覆盖：</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">UPPER</span>(email) <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> email <span class="hljs-operator">=</span> <span class="hljs-string">'a@example.com'</span>;
<span class="hljs-comment">-- 因为需要对 email 计算 UPPER()</span>
</code></pre>
<hr/>
<h2 data-id="heading-10">💡 六、实战优化示例</h2>
<h3 data-id="heading-11">场景：高频查询“用户邮箱”</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 优化前（无覆盖）</span>
<span class="hljs-keyword">SELECT</span> email <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> created_at <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2023-01-01'</span>;

<span class="hljs-comment">-- 优化：创建覆盖索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_status_created_email <span class="hljs-keyword">ON</span> users (status, created_at, email);

<span class="hljs-comment">-- 现在查询完全走覆盖索引！</span>
</code></pre>
<h3 data-id="heading-12">场景：分页 + 排序</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询最近活跃用户的 ID 和昵称</span>
<span class="hljs-keyword">SELECT</span> id, nickname <span class="hljs-keyword">FROM</span> users 
<span class="hljs-keyword">WHERE</span> active <span class="hljs-operator">=</span> <span class="hljs-number">1</span> 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> last_login <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">20</span>;

<span class="hljs-comment">-- 覆盖索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_active_login_nickname <span class="hljs-keyword">ON</span> users (active, last_login, nickname);
<span class="hljs-comment">-- 注意：id 是主键，InnoDB 二级索引自动包含，所以 SELECT id 也能覆盖</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">✅ 七、总结</h2>





























<table><thead><tr><th>关键点</th><th>说明</th></tr></thead><tbody><tr><td><strong>定义</strong></td><td>索引包含查询所需全部字段，无需回表</td></tr><tr><td><strong>标志</strong></td><td><code>EXPLAIN</code> 中 <code>Extra = "Using index"</code></td></tr><tr><td><strong>优势</strong></td><td>减少 I/O、提升性能、降低负载</td></tr><tr><td><strong>适用</strong></td><td>高频查询、报表、API 接口等读多场景</td></tr><tr><td><strong>禁忌</strong></td><td>避免过度索引、注意写性能影响</td></tr></tbody></table>
<blockquote>
<p>🌟 <strong>最佳实践</strong>：<br/>
对高频查询的 <code>SELECT</code> 字段 + <code>WHERE</code> 字段 + <code>ORDER BY</code> 字段，设计<strong>联合覆盖索引</strong>，是 MySQL 性能优化的“黄金法则”之一。</p>
</blockquote>
<p>如果你有具体的 SQL 查询需要优化，欢迎贴出来，我可以帮你设计覆盖索引！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Trae IDE: 我为什么从Free版升级成了Pro版订阅]]></title>    <link>https://juejin.cn/post/7593296804108714024</link>    <guid>https://juejin.cn/post/7593296804108714024</guid>    <pubDate>2026-01-10T10:33:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593296804108714024" data-draft-id="7593254419078430760" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Trae IDE: 我为什么从Free版升级成了Pro版订阅"/> <meta itemprop="keywords" content="Trae,VibeCoding"/> <meta itemprop="datePublished" content="2026-01-10T10:33:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bytebeats"/> <meta itemprop="url" content="https://juejin.cn/user/463698667655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Trae IDE: 我为什么从Free版升级成了Pro版订阅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/463698667655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bytebeats
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T10:33:44.000Z" title="Sat Jan 10 2026 10:33:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我与Trae的这一年: 将 Trae IDE从Free版最终升级成了Pro版订阅</h2>
<p>我曾经用过完全免费的Trae.ai IDE版本, 现在也订阅了Pro版. 个人认为Pro版物超所值. 它彻底解决了免费版本使用AI模型时需排队等待的问题, 代码编辑无实际限制, 智能助手支持完全自定义, 且整个程序运行流畅度远超免费版, 体验更顺滑无缝.</p>
<p>免费版固然出色实用, 我对此毫无怨言.</p>
<blockquote>
<p>但免费版本也有致命伤: 使用 AI 模型时需要排队等待. 有时候会让你盯着进度条心烦意乱.</p>
</blockquote>
<p>但专业版订阅则能让基础的IDE AI助手蜕变为真正的超级工具, 成为不可小觑的利器.</p>
<p>我曾从零构建完整程序:</p>
<ul>
<li>通过<code>plan.md</code>进行全流程规划,</li>
<li>配合<code>todo.md</code>确保所有模块互联互通,</li>
<li>功能正常运行, 并实现数据库/API的深度集成.</li>
</ul>
<p>这款助手的工作方式令人惊叹——它能按阶段逐步构建并始终专注于当前任务.</p>
<p>我的程序分为8个阶段:</p>
<ul>
<li>从创意构思,</li>
<li>目标用户定位,</li>
<li>架构设计,</li>
<li>开发实现,</li>
<li>直至最终程序交付, 全程无遗漏.</li>
</ul>
<p>本质上, 我的智能助手如同员工般为我工作, 一步一个脚印地推进.</p>
<blockquote>
<p>最最关键的技巧是: 前端, 后端及数据库/API模块均应逐项开发. 如此方能确保所有组件正确配置且稳定运行.</p>
</blockquote>
<p>最后, 请发表自己的使用 Trae IDE 的使用体验和观点, 大家可以探讨一下Free 版和 Pro 版的优劣.</p>
<p>好吧, 今天的内容就分享到这里啦!</p>
<p>一家之言, 欢迎拍砖!</p>
<p>Happy Coding! Stay GOLDEN!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【anthropic官方文章】揭秘 AI Agents 的评估方法]]></title>    <link>https://juejin.cn/post/7593310044478455817</link>    <guid>https://juejin.cn/post/7593310044478455817</guid>    <pubDate>2026-01-10T10:39:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593310044478455817" data-draft-id="7593337928307376154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【anthropic官方文章】揭秘 AI Agents 的评估方法"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2026-01-10T10:39:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【anthropic官方文章】揭秘 AI Agents 的评估方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T10:39:07.000Z" title="Sat Jan 10 2026 10:39:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读34分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fdemystifying-evals-for-ai-agents" target="_blank" title="https://www.anthropic.com/engineering/demystifying-evals-for-ai-agents" ref="nofollow noopener noreferrer">转载</a></p>
<p>发布于 2026年1月9日</p>
<p>使 agents 变得有用的能力，恰恰也让它们难以评估。在实际部署中行之有效的策略，往往需要结合多种技术来匹配所测量系统的复杂性。</p>
<h3 data-id="heading-1">引言</h3>
<p>良好的评估能帮助团队更有信心地交付 AI agents。没有评估，团队很容易陷入被动循环——只能在生产环境中发现问题，而修复一个故障往往又会引发其他问题。评估能在问题影响用户之前使其可见，并且随着 agent 的整个生命周期，评估的价值会不断累积。</p>
<p>正如我们在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fbuilding-effective-agents" target="_blank" title="https://www.anthropic.com/engineering/building-effective-agents" ref="nofollow noopener noreferrer">构建高效 agents</a>一文中所述，agents 需要经过多轮操作：调用工具、修改状态、并根据中间结果进行调整。正是这些使 AI agents 变得有用的能力——自主性、智能性和灵活性——也让它们更难评估。</p>
<p>通过我们的内部工作以及与处于 agent 开发前沿的客户合作，我们学会了如何为 agents 设计更严谨、更有用的评估。以下是在各种 agent 架构和实际部署用例中行之有效的方法。</p>
<h3 data-id="heading-2">评估的结构</h3>
<p><strong>评估</strong>（eval）是对 AI 系统的测试：给 AI 一个输入，然后对其输出应用评分逻辑来衡量成功与否。在本文中，我们重点关注可以在开发阶段无需真实用户参与的 <strong>自动化评估</strong>。</p>
<p><strong>单轮评估</strong> 相对简单：一个提示、一个响应、一套评分逻辑。对于早期的 LLM，单轮非 agentic 评估是主要的评估方法。随着 AI 能力的提升，<strong>多轮评估</strong> 变得越来越普遍。</p>
<p>在简单评估中，agent 处理一个提示，评分器检查输出是否符合预期。在更复杂的多轮评估中，coding agent 接收工具、任务（本例中是构建 MCP server）和环境，执行"agent 循环"（工具调用和推理），并用实现结果更新环境。然后通过单元测试对工作的 MCP server 进行评分验证。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b86e85b886640c296b58bf461ccd44e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646346&amp;x-signature=hWrVr6sJBC2%2FGz8DDVTctIwDr4I%3D" alt="" loading="lazy"/></p>
<p><strong>Agent 评估</strong> 更加复杂。Agents 在多轮中使用工具，修改环境状态并随时调整——这意味着错误可能传播和累积。前沿模型还能找到超越静态评估限制的创造性解决方案。例如，Opus 4.5 在解决 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsierra-research%2Ftau2-bench" target="_blank" title="https://github.com/sierra-research/tau2-bench" ref="nofollow noopener noreferrer">𝜏2-bench</a> 关于预订航班的问题时，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fclaude-opus-4-5" target="_blank" title="https://www.anthropic.com/news/claude-opus-4-5" ref="nofollow noopener noreferrer">发现</a>了政策中的漏洞。按照评估的字面标准，它"失败"了，但实际上为用户想出了更好的解决方案。</p>
<p>在构建 agent 评估时，我们使用以下定义：</p>
<p><strong>任务</strong>（又称 <strong>问题</strong> 或 <strong>测试用例</strong>）是具有明确输入和成功标准的单个测试。</p>
<p>每次尝试任务称为一次 <strong>试验</strong>。由于模型输出在不同运行之间存在差异，我们运行多次试验以产生更一致的结果。</p>
<p><strong>评分器</strong> 是对 agent 性能某些方面进行评分的逻辑。一个任务可以有多个评分器，每个评分器包含多个断言（有时称为 <strong>检查项</strong>）。</p>
<p><strong>记录</strong>（也称为 <strong>trace</strong> 或 <strong>trajectory</strong>）是一次试验的完整记录，包括输出、工具调用、推理、中间结果以及任何其他交互。对于 Anthropic API，这是评估运行结束时的完整 messages 数组——包含评估期间对 API 的所有调用和返回的所有响应。</p>
<p><strong>结果</strong> 是试验结束时环境的最终状态。航班预订 agent 可能在记录末尾说"您的航班已预订"，但结果是指环境的 SQL 数据库中是否存在预订记录。</p>
<p><strong>评估框架</strong> 是端到端运行评估的基础设施。它提供指令和工具，并发运行任务，记录所有步骤，对输出进行评分，并汇总结果。</p>
<p><strong>Agent 框架</strong>（或 <strong>scaffold</strong>）是使模型能够作为 agent 运行的系统：它处理输入、协调工具调用并返回结果。当我们评估"一个 agent"时，我们评估的是框架 <strong>和</strong> 模型的协同工作。例如，<a href="https://link.juejin.cn?target=https%3A%2F%2Fclaude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://claude.com/product/claude-code" ref="nofollow noopener noreferrer">Claude Code</a> 是一个灵活的 agent 框架，我们使用其核心原语通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.claude.com%2Fdocs%2Fen%2Fagent-sdk%2Foverview" target="_blank" title="https://platform.claude.com/docs/en/agent-sdk/overview" ref="nofollow noopener noreferrer">Agent SDK</a> 构建了我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Feffective-harnesses-for-long-running-agents" target="_blank" title="https://www.anthropic.com/engineering/effective-harnesses-for-long-running-agents" ref="nofollow noopener noreferrer">长时间运行 agent 框架</a>。</p>
<p><strong>评估套件</strong> 是为衡量特定能力或行为而设计的任务集合。套件中的任务通常共享一个大目标。例如，客户支持评估套件可能测试退款、取消和升级处理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59fb1fd01d184bc0933c1a8cd62132b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646346&amp;x-signature=QNP0WjZTClP1sb5U4v0KXR1WGwo%3D" alt="" loading="lazy"/></p>
<p><em>Agents 评估的组成部分。</em></p>
<h3 data-id="heading-3">为什么要构建评估？</h3>
<p>当团队刚开始构建 agents 时，通过手动测试、<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FEating_your_own_dog_food" target="_blank" title="https://en.wikipedia.org/wiki/Eating_your_own_dog_food" ref="nofollow noopener noreferrer">内部试用</a>和直觉的组合，可以取得令人惊讶的进展。更严格的评估甚至可能看起来是减慢发布速度的额外开销。但在早期原型阶段之后，一旦 agent 投入生产并开始扩展，没有评估的构建方式就会崩溃。</p>
<p>转折点通常出现在用户报告 agent 在修改后感觉变差时，而团队处于"盲飞"状态，除了猜测和检查外别无验证方法。没有评估，调试是被动的：等待投诉、手动复现、修复 bug，然后希望没有其他地方出现回归。团队无法区分真正的回归和噪音，无法在发布前自动针对数百个场景测试变更，也无法衡量改进效果。</p>
<p>我们多次见证了这种演变过程。例如，Claude Code 最初是基于 Anthropic 员工和外部用户的反馈进行快速迭代的。后来，我们添加了评估——首先针对简洁性和文件编辑等狭窄领域，然后针对过度工程化等更复杂的行为。这些评估帮助识别问题、指导改进，并聚焦研究与产品团队的协作。结合生产监控、A/B 测试、用户研究等，评估提供了持续改进 Claude Code 的信号。</p>
<p>在 agent 生命周期的任何阶段编写评估都是有用的。在早期，评估迫使产品团队明确定义 agent 的成功标准，而后期则帮助维持一致的质量标准。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.descript.com%2F" target="_blank" title="https://www.descript.com/" ref="nofollow noopener noreferrer">Descript</a> 的 agent 帮助用户编辑视频，因此他们围绕成功编辑工作流的三个维度构建了评估：不破坏内容、执行我要求的操作、执行得好。他们从手动评分演进到由产品团队定义标准并定期进行人工校准的 LLM 评分器，现在定期运行两个独立套件用于质量基准测试和回归测试。<a href="https://link.juejin.cn?target=https%3A%2F%2Fbolt.new%2F" target="_blank" title="https://bolt.new/" ref="nofollow noopener noreferrer">Bolt</a> AI 团队在较晚时候开始构建评估，当时他们已经有了广泛使用的 agent。在 3 个月内，他们构建了一个评估系统，可以运行其 agent 并使用静态分析对输出进行评分，使用浏览器 agents 测试应用，以及使用 LLM judges 评估指令遵循等行为。</p>
<p>有些团队在开发开始时就创建评估；其他团队在扩展后才添加，此时评估成为改进 agent 的瓶颈。评估在 agent 开发初期特别有用，可以明确编码预期行为。两位工程师阅读同一份初始规格说明后，可能对 AI 应如何处理边缘情况有不同的理解。评估套件可以消除这种歧义。无论何时创建，评估都有助于加速开发。</p>
<p>评估还影响你采用新模型的速度。当更强大的模型发布时，没有评估的团队面临数周的测试，而有评估的竞争对手可以快速确定模型的优势、调整提示，并在几天内完成升级。</p>
<p>一旦有了评估，你就能免费获得基线和回归测试：延迟、token 使用量、每任务成本和错误率都可以在静态任务库上跟踪。评估还可以成为产品和研究团队之间最高带宽的沟通渠道，定义研究人员可以优化的指标。显然，评估的好处远不止跟踪回归和改进。由于成本在前期可见而收益后期累积，其复合价值很容易被忽视。</p>
<h3 data-id="heading-4">如何评估 AI Agents</h3>
<p>我们看到目前大规模部署的常见 agent 类型包括 coding agents、research agents、computer use agents 和 conversational agents。每种类型可能部署在各种行业，但可以使用类似的技术进行评估。你不需要从头发明评估方法。以下部分描述了几种 agent 类型的成熟技术。使用这些方法作为基础，然后扩展到你的领域。</p>
<h4 data-id="heading-5">Agents 的评分器类型</h4>
<p>Agent 评估通常结合三种类型的评分器：基于代码的、基于模型的和人工的。每个评分器评估记录或结果的某些部分。有效评估设计的关键是为任务选择正确的评分器。</p>

















<table><thead><tr><th>基于代码的评分器</th><th>方法</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td/><td>• 字符串匹配检查（精确、正则、模糊等）<br/>• 二元测试（fail-to-pass, pass-to-pass）<br/>• 静态分析（lint、类型、安全）<br/>• 结果验证<br/>• 工具调用验证（使用的工具、参数）<br/>• 记录分析（轮次、token 使用量）</td><td>• 快速<br/>• 便宜<br/>• 客观<br/>• 可重复<br/>• 易于调试<br/>• 验证特定条件</td><td>• 对不完全匹配预期模式的有效变体很脆弱<br/>• 缺乏细微差别<br/>• 评估某些主观任务能力有限</td></tr></tbody></table>

















<table><thead><tr><th>基于模型的评分器</th><th>方法</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td/><td>基于评分标准的打分<br/>自然语言断言<br/>成对比较<br/>基于参考的评估<br/>多评委共识</td><td>灵活<br/>可扩展<br/>捕捉细微差别<br/>处理开放式任务<br/>处理自由格式输出</td><td>非确定性<br/>比代码更昂贵<br/>需要与人工评分器校准以确保准确性</td></tr></tbody></table>

















<table><thead><tr><th>人工评分器</th><th>方法</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td/><td>领域专家审查<br/>众包判断<br/>抽样检查<br/>A/B 测试<br/>评分者间一致性</td><td>金标准质量<br/>匹配专家用户判断<br/>用于校准基于模型的评分器</td><td>昂贵<br/>缓慢<br/>通常需要大规模获取人类专家</td></tr></tbody></table>
<p>对于每个任务，评分可以是加权的（组合评分器分数必须达到阈值）、二元的（所有评分器必须通过）或混合的。</p>
<h4 data-id="heading-6">能力评估 vs 回归评估</h4>
<p><strong>能力或"质量"评估</strong> 问的是"这个 agent 能做好什么？"它们应该从较低的通过率开始，针对 agent 挣扎的任务，给团队一个努力攀登的目标。</p>
<p><strong>回归评估</strong> 问的是"agent 是否仍能处理它以前能处理的所有任务？"应该有接近 100% 的通过率。它们防止倒退，分数下降表明某些东西出了问题需要改进。当团队在能力评估上努力攀升时，同时运行回归评估以确保变更不会在其他地方造成问题也很重要。</p>
<p>在 agent 发布和优化后，通过率高的能力评估可以"毕业"成为持续运行以捕捉任何漂移的回归套件。曾经衡量"我们能做到吗？"的任务然后衡量"我们还能可靠地做到吗？"</p>
<h4 data-id="heading-7">评估 Coding Agents</h4>
<p><strong>Coding agents</strong> 编写、测试和调试代码，导航代码库，运行命令，就像人类开发者一样。现代 coding agents 的有效评估通常依赖于明确定义的任务、稳定的测试环境，以及对生成代码的全面测试。</p>
<p>确定性评分器对 coding agents 来说很自然，因为软件通常很容易评估：代码能运行吗？测试通过了吗？两个广泛使用的 coding agent 基准，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.swebench.com%2FSWE-bench%2F" target="_blank" title="https://www.swebench.com/SWE-bench/" ref="nofollow noopener noreferrer">SWE-bench Verified</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tbench.ai%2F" target="_blank" title="https://www.tbench.ai/" ref="nofollow noopener noreferrer">Terminal-Bench</a>，遵循这种方法。SWE-bench Verified 给 agents 提供来自流行 Python 仓库的 GitHub issues，并通过运行测试套件对解决方案进行评分；解决方案只有在修复失败测试而不破坏现有测试的情况下才算通过。LLM 在一年内在这个评估上从 40% 提高到 &gt;80%。Terminal-Bench 采用不同的路线：它测试端到端技术任务，如从源代码构建 Linux 内核或训练 ML 模型。</p>
<p>一旦你有了一组用于验证 coding 任务关键 <strong>结果</strong> 的通过/失败测试，通常也有用的是对 <strong>记录</strong> 进行评分。例如，基于启发式的代码质量规则可以基于通过测试以外的标准评估生成的代码，具有明确评分标准的基于模型的评分器可以评估 agent 如何调用工具或与用户交互等行为。</p>
<p><strong>示例：Coding agent 的理论评估</strong></p>
<p>考虑一个 coding 任务，agent 必须修复身份验证绕过漏洞。如下面的示例 YAML 文件所示，可以使用评分器和指标来评估这个 agent。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">task:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">"fix-auth-bypass_1"</span>
  <span class="hljs-attr">desc:</span> <span class="hljs-string">"Fix authentication bypass when password field is empty and ..."</span>
  <span class="hljs-attr">graders:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">deterministic_tests</span>
      <span class="hljs-attr">required:</span> [<span class="hljs-string">test_empty_pw_rejected.py</span>, <span class="hljs-string">test_null_pw_rejected.py</span>]
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">llm_rubric</span>
      <span class="hljs-attr">rubric:</span> <span class="hljs-string">prompts/code_quality.md</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">static_analysis</span>
      <span class="hljs-attr">commands:</span> [<span class="hljs-string">ruff</span>, <span class="hljs-string">mypy</span>, <span class="hljs-string">bandit</span>]
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">state_check</span>
      <span class="hljs-attr">expect:</span>
        <span class="hljs-attr">security_logs:</span> {<span class="hljs-attr">event_type:</span> <span class="hljs-string">"auth_blocked"</span>}
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">tool_calls</span>
      <span class="hljs-attr">required:</span>
        <span class="hljs-bullet">-</span> {<span class="hljs-attr">tool:</span> <span class="hljs-string">read_file</span>, <span class="hljs-attr">params:</span> {<span class="hljs-attr">path:</span> <span class="hljs-string">"src/auth/*"</span>}}
        <span class="hljs-bullet">-</span> {<span class="hljs-attr">tool:</span> <span class="hljs-string">edit_file</span>}
        <span class="hljs-bullet">-</span> {<span class="hljs-attr">tool:</span> <span class="hljs-string">run_tests</span>}
  <span class="hljs-attr">tracked_metrics:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">transcript</span>
      <span class="hljs-attr">metrics:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">n_turns</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">n_toolcalls</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">n_total_tokens</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">latency</span>
      <span class="hljs-attr">metrics:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">time_to_first_token</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">output_tokens_per_sec</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">time_to_last_token</span>
</code></pre>
<p>请注意，此示例展示了用于说明目的的所有可用评分器。在实践中，coding 评估通常依赖单元测试进行正确性验证，LLM 评分标准用于评估整体代码质量，仅在需要时添加其他评分器和指标。</p>
<h4 data-id="heading-8">评估 Conversational Agents</h4>
<p><strong>Conversational agents</strong> 在支持、销售或辅导等领域与用户互动。与传统聊天机器人不同，它们维护状态、使用工具，并在对话中采取行动。虽然 coding 和 research agents 也可能涉及与用户的多轮交互，但 conversational agents 提出了一个独特的挑战：交互本身的质量也是你要评估的内容之一。Conversational agents 的有效评估通常依赖于可验证的最终状态结果和捕捉任务完成度与交互质量的评分标准。与大多数其他评估不同，它们通常需要第二个 LLM 来模拟用户。我们在 <a href="https://link.juejin.cn?target=https%3A%2F%2Falignment.anthropic.com%2F2025%2Fautomated-auditing%2F" target="_blank" title="https://alignment.anthropic.com/2025/automated-auditing/" ref="nofollow noopener noreferrer">alignment auditing agents</a> 中使用这种方法，通过扩展的对抗性对话来压力测试模型。</p>
<p>Conversational agents 的成功可以是多维的：工单是否已解决（状态检查）、是否在 &lt;10 轮内完成（记录约束）、语气是否恰当（LLM 评分标准）？两个包含多维性的基准是 <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2406.12045" target="_blank" title="https://arxiv.org/abs/2406.12045" ref="nofollow noopener noreferrer">𝜏-Bench</a> 及其后续版本 <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2506.07982" target="_blank" title="https://arxiv.org/abs/2506.07982" ref="nofollow noopener noreferrer">τ2-Bench</a>。它们模拟零售支持和航空预订等领域的多轮交互，其中一个模型扮演用户角色，而 agent 导航真实场景。</p>
<p><strong>示例：Conversational agent 的理论评估</strong></p>
<p>考虑一个支持任务，agent 必须为一位沮丧的客户处理退款。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">graders:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">llm_rubric</span>
    <span class="hljs-attr">rubric:</span> <span class="hljs-string">prompts/support_quality.md</span>
    <span class="hljs-attr">assertions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"Agent showed empathy for customer's frustration"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"Resolution was clearly explained"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"Agent's response grounded in fetch_policy tool results"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">state_check</span>
    <span class="hljs-attr">expect:</span>
      <span class="hljs-attr">tickets:</span> {<span class="hljs-attr">status:</span> <span class="hljs-string">resolved</span>}
      <span class="hljs-attr">refunds:</span> {<span class="hljs-attr">status:</span> <span class="hljs-string">processed</span>}
  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">tool_calls</span>
    <span class="hljs-attr">required:</span>
      <span class="hljs-bullet">-</span> {<span class="hljs-attr">tool:</span> <span class="hljs-string">verify_identity</span>}
      <span class="hljs-bullet">-</span> {<span class="hljs-attr">tool:</span> <span class="hljs-string">process_refund</span>, <span class="hljs-attr">params:</span> {<span class="hljs-attr">amount:</span> <span class="hljs-string">"&lt;=100"</span>}}
      <span class="hljs-bullet">-</span> {<span class="hljs-attr">tool:</span> <span class="hljs-string">send_confirmation</span>}
  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">transcript</span>
    <span class="hljs-attr">max_turns:</span> <span class="hljs-number">10</span>
<span class="hljs-attr">tracked_metrics:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">transcript</span>
    <span class="hljs-attr">metrics:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n_turns</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n_toolcalls</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n_total_tokens</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">latency</span>
    <span class="hljs-attr">metrics:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">time_to_first_token</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">output_tokens_per_sec</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">time_to_last_token</span>
</code></pre>
<p>与我们的 coding agent 示例一样，此任务展示了用于说明目的的多种评分器类型。在实践中，conversational agent 评估通常使用基于模型的评分器来评估沟通质量和目标完成度，因为许多任务——如回答问题——可能有多个"正确"的解决方案。</p>
<h4 data-id="heading-9">评估 Research Agents</h4>
<p><strong>Research agents</strong> 收集、综合和分析信息，然后产生输出，如答案或报告。与 coding agents 单元测试提供二元通过/失败信号不同，研究质量只能相对于任务来判断。什么算"全面"、"引用充分"，甚至"正确"取决于上下文：市场扫描、收购尽职调查和科学报告各有不同的标准。</p>
<p>Research 评估面临独特挑战：专家可能对综合是否全面存在分歧，参考内容不断变化导致基准事实发生变化，更长、更开放的输出为错误创造了更多空间。像 <a href="https://link.juejin.cn?target=http%3A%2F%2Farxiv.org%2Fabs%2F2504.12516" target="_blank" title="http://arxiv.org/abs/2504.12516" ref="nofollow noopener noreferrer">BrowseComp</a> 这样的基准测试 AI agents 是否能在开放网络上大海捞针——设计的问题易于验证但难以解决。</p>
<p>构建 research agent 评估的一个策略是结合评分器类型。Groundedness 检查验证主张是否有检索来源支持，coverage 检查定义好答案必须包含的关键事实，source quality 检查确认咨询的来源是权威的，而不仅仅是首先检索到的。对于有客观正确答案的任务（"X 公司第三季度收入是多少？"），精确匹配有效。LLM 可以标记不支持的主张和覆盖缺口，还可以验证开放式综合的连贯性和完整性。</p>
<p>鉴于研究质量的主观性，基于 LLM 的评分标准应经常与专家人工判断进行校准，以有效评分这些 agents。</p>
<h4 data-id="heading-10">Computer Use Agents</h4>
<p><strong>Computer use agents</strong> 通过与人类相同的界面与软件交互——截图、鼠标点击、键盘输入和滚动——而不是通过 API 或代码执行。它们可以使用任何带有图形用户界面（GUI）的应用程序，从设计工具到传统企业软件。评估需要在 agent 可以使用软件应用程序的真实或沙盒环境中运行它，并检查它是否达到了预期结果。例如，<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2307.13854" target="_blank" title="https://arxiv.org/abs/2307.13854" ref="nofollow noopener noreferrer">WebArena</a> 测试基于浏览器的任务，使用 URL 和页面状态检查来验证 agent 是否正确导航，以及对修改数据的任务进行后端状态验证（确认订单确实已下达，而不仅仅是确认页面出现了）。<a href="https://link.juejin.cn?target=https%3A%2F%2Fos-world.github.io%2F" target="_blank" title="https://os-world.github.io/" ref="nofollow noopener noreferrer">OSWorld</a> 将此扩展到完整的操作系统控制，评估脚本在任务完成后检查各种工件：文件系统状态、应用程序配置、数据库内容和 UI 元素属性。</p>
<p>Browser use agents 需要在 token 效率和延迟之间取得平衡。基于 DOM 的交互执行快但消耗大量 tokens，而基于截图的交互较慢但更节省 tokens。例如，当要求 Claude 总结 Wikipedia 时，从 DOM 中提取文本更高效。当在 Amazon 上寻找新的笔记本电脑包时，截图更高效（因为提取整个 DOM 消耗大量 tokens）。在我们的 Claude for Chrome 产品中，我们开发了评估来检查 agent 是否为每个上下文选择了正确的工具。这使我们能够更快、更准确地完成基于浏览器的任务。</p>
<h4 data-id="heading-11">如何理解 Agent 评估中的非确定性</h4>
<p>无论 agent 类型如何，agent 行为在不同运行之间都有差异，这使得评估结果比乍看起来更难解读。每个任务都有自己的成功率——可能一个任务 90%，另一个任务 50%——在一次评估运行中通过的任务可能在下一次失败。有时，我们想要衡量的是 agent 对一个任务成功的 <strong>频率</strong>（试验中的比例）。</p>
<p>两个指标有助于捕捉这种细微差别：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fproceedings.neurips.cc%2Fpaper%2F2019%2Ffile%2F7298332f04ac004a0ca44cc69ecf6f6b-Paper.pdf" target="_blank" title="https://proceedings.neurips.cc/paper/2019/file/7298332f04ac004a0ca44cc69ecf6f6b-Paper.pdf" ref="nofollow noopener noreferrer">pass@k</a> 衡量 agent 在 <em>k</em> 次尝试中至少获得一个正确解决方案的可能性。随着 k 增加，pass@k 分数上升——更多的"射门机会"意味着至少成功 1 次的概率更高。50% pass@1 的分数意味着模型在第一次尝试时成功完成评估中一半的任务。在 coding 中，我们通常最关心 agent 在第一次尝试时找到解决方案——pass@1。在其他情况下，提出多个解决方案是有效的，只要有一个有效即可。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2406.12045" target="_blank" title="https://arxiv.org/abs/2406.12045" ref="nofollow noopener noreferrer">pass^k</a> 衡量 <strong>所有 k 次</strong> 试验都成功的概率。随着 <em>k</em> 增加，pass^k 下降，因为要求在更多试验中保持一致性是更高的标准。如果你的 agent 每次试验成功率为 75%，你运行 3 次试验，三次都通过的概率是 (0.75)³ ≈ 42%。这个指标对于用户期望每次都有可靠行为的面向客户的 agents 特别重要。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b6858afbf5b4bd4af7011d102042474~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646346&amp;x-signature=munvQp4QJ1avIe6iTbUQ3cI61Tk%3D" alt="" loading="lazy"/></p>
<p><em>随着试验增加，pass@k 和 pass^k 出现分化。在 k=1 时，它们相同（都等于每次试验的成功率）。到 k=10 时，它们讲述相反的故事：pass@k 接近 100%，而 pass^k 下降到 0%。</em></p>
<p>两个指标都有用，使用哪个取决于产品需求：对于一次成功就重要的工具使用 pass@k，对于一致性至关重要的 agents 使用 pass^k。</p>
<h3 data-id="heading-12">从零到一：构建出色 Agent 评估的路线图</h3>
<p>本节列出了我们从无评估到可信赖评估的实用、经过实战检验的建议。将此视为评估驱动 agent 开发的路线图：尽早定义成功、清晰衡量它、持续迭代。</p>
<h4 data-id="heading-13">为初始评估数据集收集任务</h4>
<p><strong>步骤 0. 尽早开始</strong></p>
<p>我们看到团队推迟构建评估，因为他们认为需要数百个任务。实际上，从真实失败中提取的 20-50 个简单任务是一个很好的开始。毕竟，在 agent 开发早期，对系统的每次更改通常都有明显的影响，这种大效应量意味着小样本量就足够了。更成熟的 agents 可能需要更大、更困难的评估来检测较小的效应，但最好在开始时采用 80/20 方法。评估等得越久越难构建。在早期，产品需求自然会转化为测试用例。等太久，你就得从实时系统逆向工程成功标准。</p>
<p><strong>步骤 1. 从你已经手动测试的内容开始</strong></p>
<p>从你在开发期间运行的手动检查开始——你在每次发布前验证的行为和最终用户尝试的常见任务。如果你已经在生产环境中，查看你的 bug 跟踪器和支持队列。将用户报告的失败转换为测试用例可确保你的套件反映实际使用情况；按用户影响优先排序有助于你将精力投入在重要的地方。</p>
<p><strong>步骤 2：编写无歧义的任务并附带参考解决方案</strong></p>
<p>正确把握任务质量比看起来更难。一个好任务是两位领域专家会独立得出相同通过/失败结论的任务。他们自己能通过任务吗？如果不能，任务需要改进。任务规格中的歧义会成为指标中的噪音。基于模型的评分器标准也是如此：模糊的评分标准会产生不一致的判断。</p>
<p>每个任务应该可以被正确遵循指令的 agent 通过。这可能很微妙。例如，审计 Terminal-Bench 时发现，如果任务要求 agent 编写脚本但未指定文件路径，而测试假设脚本的特定文件路径，agent 可能会因为自身以外的原因而失败。评分器检查的所有内容都应从任务描述中明确；agents 不应因为规格歧义而失败。对于前沿模型，在多次试验中 0% 的通过率（即 0% pass@100）最常表明任务有问题，而不是 agent 能力不足，这是一个仔细检查任务规格和评分器的信号。对于每个任务，创建一个参考解决方案是有用的：一个已知有效的输出，可以通过所有评分器。这证明任务是可解决的，并验证评分器配置正确。</p>
<p><strong>步骤 3：构建平衡的问题集</strong></p>
<p>同时测试行为 <strong>应该</strong> 发生和 <strong>不应该</strong> 发生的情况。单边评估会产生单边优化。例如，如果你只测试 agent 是否在应该搜索时搜索，你可能最终得到一个几乎对所有事情都搜索的 agent。尽量避免<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fmachine-learning%2Fcrash-course%2Foverfitting%2Fimbalanced-datasets" target="_blank" title="https://developers.google.com/machine-learning/crash-course/overfitting/imbalanced-datasets" ref="nofollow noopener noreferrer">类别不平衡</a>的评估。我们在为 <a href="https://link.juejin.cn?target=http%3A%2F%2Fclaude.ai%2F" target="_blank" title="http://claude.ai/" ref="nofollow noopener noreferrer">Claude.ai</a> 的网页搜索构建评估时亲身学到了这一点。挑战是防止模型在不应该搜索时搜索，同时保留其在适当时进行广泛研究的能力。团队构建了覆盖两个方向的评估：模型应该搜索的查询（如查找天气）和应该从现有知识回答的查询（如"谁创立了 Apple？"）。在触发不足（应该搜索时不搜索）和触发过度（不应该搜索时搜索）之间找到正确的平衡很困难，需要对提示和评估进行多轮改进。随着更多示例问题出现，我们继续添加评估以提高覆盖率。</p>
<h4 data-id="heading-14">设计评估框架和评分器</h4>
<p><strong>步骤 4：构建具有稳定环境的健壮评估框架</strong></p>
<p>评估中的 agent 与生产中使用的 agent 功能大致相同，且环境本身不引入进一步噪音，这一点至关重要。每次试验应该通过从干净环境开始来"隔离"。运行之间不必要的共享状态（遗留文件、缓存数据、资源耗尽）可能导致由于基础设施不稳定而非 agent 性能导致的相关失败。共享状态还可能人为地提高性能。例如，在一些内部评估中，我们观察到 Claude 通过检查之前试验的 git 历史在某些任务上获得了不公平的优势。如果多个不同的试验因为环境中的同一限制（如 CPU 内存有限）而失败，这些试验就不是独立的，因为它们受到同一因素的影响，评估结果对于衡量 agent 性能就不可靠了。</p>
<p><strong>步骤 5：精心设计评分器</strong></p>
<p>如上所述，出色的评估设计涉及为 agent 和任务选择最佳评分器。我们建议尽可能选择确定性评分器，必要时或为了额外灵活性使用 LLM 评分器，并谨慎使用人工评分器进行额外验证。</p>
<p>有一种常见的直觉是检查 agents 是否遵循了非常具体的步骤，如按正确顺序进行的工具调用序列。我们发现这种方法过于僵化，导致测试过于脆弱，因为 agents 经常找到评估设计者没有预料到的有效方法。为了不不必要地惩罚创造性，通常更好的做法是评分 agent 产生了什么，而不是它采取的路径。</p>
<p><strong>对于有多个组件的任务，构建部分学分</strong>。正确识别问题并验证客户但未能处理退款的支持 agent，明显优于立即失败的 agent。在结果中表示这种成功的连续性很重要。</p>
<p>模型评分通常需要仔细迭代以验证准确性。LLM-as-judge 评分器应与人类专家密切校准，以确信人工评分和模型评分之间几乎没有差异。为避免幻觉，给 LLM 一个出路，如提供指令在信息不足时返回"Unknown"。创建清晰、结构化的评分标准来评分任务的每个维度，然后用隔离的 LLM-as-judge 评分每个维度，而不是用一个来评分所有维度，这也有帮助。一旦系统健壮，只需偶尔使用人工审查。</p>
<p>一些评估有微妙的失败模式，即使 agent 性能良好也会导致低分，因为 agent 由于评分 bug、agent 框架约束或歧义而未能解决任务。即使是经验丰富的团队也可能错过这些问题。例如，<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fsayashk%2Fstatus%2F1996334941832089732%3Fs%3D46%26t%3Dc5pEvnVdVbMkcR_rcCHplg" target="_blank" title="https://x.com/sayashk/status/1996334941832089732?s=46&amp;t=c5pEvnVdVbMkcR_rcCHplg" ref="nofollow noopener noreferrer">Opus 4.5 最初在 CORE-Bench 上得分 42%</a>，直到 Anthropic 研究员发现多个问题：严格的评分在预期"96.124991…"时惩罚"96.12"、模糊的任务规格、以及无法精确重现的随机任务。修复 bug 并使用限制较少的 scaffold 后，Opus 4.5 的分数跃升至 95%。同样，<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmetr_evals%2Fstatus%2F2001473506442375645%3Fs%3D46" target="_blank" title="https://x.com/metr_evals/status/2001473506442375645?s=46" ref="nofollow noopener noreferrer">METR 发现</a>他们时间范围基准中几个配置错误的任务要求 agents 优化到规定的分数阈值，但评分要求超过该阈值。这惩罚了像 Claude 这样遵循指令的模型，而忽略规定目标的模型获得了更好的分数。仔细检查任务和评分器可以帮助避免这些问题。</p>
<p>使你的评分器抵抗绕过或黑客攻击。Agent 不应能够轻易"作弊"评估。任务和评分器应设计成通过真正需要解决问题而不是利用意外漏洞。</p>
<h4 data-id="heading-15">长期维护和使用评估</h4>
<p><strong>步骤 6：检查记录</strong></p>
<p>除非你阅读许多试验的记录和评分，否则你不会知道评分器是否运行良好。在 Anthropic，我们投资了用于查看评估记录的工具，并定期花时间阅读它们。当任务失败时，记录会告诉你 agent 是犯了真正的错误还是你的评分器拒绝了有效的解决方案。它还经常揭示关于 agent 和评估行为的关键细节。</p>
<p>失败应该看起来是公平的：很清楚 agent 做错了什么以及为什么。当分数没有攀升时，我们需要确信这是由于 agent 性能而不是评估本身。阅读记录是你验证评估正在衡量真正重要的东西的方式，也是 agent 开发的关键技能。</p>
<p><strong>步骤 7：监控能力评估饱和</strong></p>
<p>100% 的评估可以跟踪回归但不提供改进信号。当 agent 通过所有可解决的任务时，就会发生 <strong>评估饱和</strong>，没有改进空间。例如，SWE-Bench Verified 分数今年从 30% 开始，前沿模型现在接近 &gt;80% 的饱和。随着评估接近饱和，进展也会放缓，因为只剩下最困难的任务。这可能使结果具有欺骗性，因为大的能力改进表现为小的分数增加。例如，代码审查初创公司 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.qodo.ai%2F" target="_blank" title="https://www.qodo.ai/" ref="nofollow noopener noreferrer">Qodo</a> 最初对 Opus 4.5 印象不深，因为他们的 one-shot coding 评估没有捕捉到在更长、更复杂任务上的收益。作为回应，他们开发了新的 agentic 评估框架，提供了更清晰的进展图景。</p>
<p>作为规则，在有人深入研究评估细节并阅读一些记录之前，我们不会把评估分数当真。如果评分不公平、任务模糊、有效解决方案受到惩罚，或者框架限制了模型，评估应该修订。</p>
<p><strong>步骤 8：通过开放贡献和维护保持评估套件长期健康</strong></p>
<p>评估套件是一个活的工件，需要持续关注和明确的所有权才能保持有用。</p>
<p>在 Anthropic，我们尝试了各种评估维护方法。事实证明最有效的是建立专门的评估团队来拥有核心基础设施，而领域专家和产品团队贡献大多数评估任务并自己运行评估。</p>
<p>对于 AI 产品团队，拥有和迭代评估应该像维护单元测试一样成为常规。团队可能在早期测试中"有效"的 AI 功能上浪费数周时间，但未能满足设计良好的评估本应早期发现的未明确的期望。定义评估任务是压力测试产品需求是否足够具体以开始构建的最佳方式之一。</p>
<p>我们建议实践评估驱动的开发：在 agents 能够实现计划能力之前构建评估来定义它们，然后迭代直到 agent 表现良好。在内部，我们经常构建今天"足够好"但押注于几个月后模型能做什么的功能。从低通过率开始的能力评估使这一点可见。当新模型发布时，运行套件可以快速揭示哪些押注得到了回报。</p>
<p>最接近产品需求和用户的人最有资格定义成功。以当前模型能力，产品经理、客户成功经理或销售人员可以使用 Claude Code 以 PR 的形式贡献评估任务——让他们做！或者更好的是，积极地支持他们。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c04cef81f269477cb2d111fe2a49bd3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646346&amp;x-signature=O3Ac1%2Bl7eSZpgqsvfdjbjvhyqjM%3D" alt="" loading="lazy"/></p>
<p><em>创建有效评估的过程。</em></p>
<h3 data-id="heading-16">评估如何与其他方法配合以全面理解 Agents</h3>
<p>自动化评估可以在数千个任务中针对 agent 运行，无需部署到生产环境或影响真实用户。但这只是理解 agent 性能的众多方式之一。完整的图景包括生产监控、用户反馈、A/B 测试、手动记录审查和系统化人工评估。</p>















































<table><thead><tr><th>理解 AI Agent 性能的方法概述</th><th>方法</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>自动化评估</td><td>无需真实用户即可以编程方式运行测试</td><td>更快迭代<br/>完全可重现<br/>无用户影响<br/>可在每次提交时运行<br/>无需生产部署即可大规模测试场景</td><td>需要更多前期投资来构建<br/>随着产品和模型演进需要持续维护以避免漂移<br/>如果不匹配真实使用模式可能产生虚假信心</td></tr><tr><td>生产监控</td><td>在实时系统中跟踪指标和错误</td><td>大规模揭示真实用户行为<br/>捕捉合成评估遗漏的问题<br/>提供 agents 实际表现的基准真相</td><td>被动，问题在你知道之前就影响了用户<br/>信号可能有噪音<br/>需要投资工具<br/>缺乏评分的基准真相</td></tr><tr><td>A/B 测试</td><td>用真实用户流量比较变体</td><td>衡量实际用户结果（留存、任务完成）<br/>控制混淆因素<br/>可扩展且系统化</td><td>慢，需要数天或数周才能达到显著性并需要足够的流量<br/>只测试你部署的变更<br/>在不能彻底审查记录的情况下对指标变化的底层"为什么"信号较少</td></tr><tr><td>用户反馈</td><td>明确的信号，如点踩或 bug 报告</td><td>发现你没有预料到的问题<br/>来自真实人类用户的真实示例<br/>反馈通常与产品目标相关</td><td>稀疏且自选择<br/>偏向严重问题<br/>用户很少解释 <em>为什么</em> 某事失败<br/>非自动化<br/>主要依赖用户发现问题可能对用户产生负面影响</td></tr><tr><td>手动记录审查</td><td>人类阅读 agent 对话</td><td>建立对失败模式的直觉<br/>捕捉自动检查遗漏的微妙质量问题<br/>帮助校准什么是"好"并掌握细节</td><td>耗时<br/>不可扩展<br/>覆盖不一致<br/>审查者疲劳或不同审查者可能影响信号质量<br/>通常只提供定性信号而非清晰的定量评分</td></tr><tr><td>系统化人工研究</td><td>由训练有素的评分员对 agent 输出进行结构化评分</td><td>来自多位人类评分员的金标准质量判断<br/>处理主观或模糊的任务<br/>为改进基于模型的评分器提供信号</td><td>相对昂贵且周转慢<br/>难以频繁运行<br/>评分者间分歧需要调和<br/>复杂领域（法律、金融、医疗）需要人类专家进行研究</td></tr></tbody></table>
<p>这些方法映射到 agent 开发的不同阶段。自动化评估在发布前和 CI/CD 中特别有用，在每次 agent 变更和模型升级时作为质量问题的第一道防线运行。生产监控在发布后启动，检测分布漂移和意外的真实世界故障。A/B 测试在你有足够流量后验证重大变更。用户反馈和记录审查是持续的实践来填补空白——持续分类反馈，每周抽样阅读记录，并根据需要深入挖掘。将系统化人工研究保留用于校准 LLM 评分器或评估以人类共识作为参考标准的主观输出。</p>
<p>像安全工程中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSwiss_cheese_model" target="_blank" title="https://en.wikipedia.org/wiki/Swiss_cheese_model" ref="nofollow noopener noreferrer">瑞士奶酪模型</a>一样，没有单一的评估层能捕捉到每个问题。结合多种方法，穿过一层的失败会被另一层捕获。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eafcff341ad460ea0b8ad1bf21c1804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646346&amp;x-signature=jUPgMr%2BSKLNLOmXOzD6UOmgGnJE%3D" alt="" loading="lazy"/></p>
<p>最有效的团队结合这些方法——自动化评估用于快速迭代，生产监控用于基准真相，定期人工审查用于校准。</p>
<h3 data-id="heading-17">结论</h3>
<p>没有评估的团队陷入被动循环——修复一个故障，引发另一个，无法区分真正的回归和噪音。早期投资的团队发现相反的情况：随着失败变成测试用例、测试用例防止回归、指标取代猜测，开发加速。评估给整个团队一个明确的攀登目标，将"agent 感觉变差了"变成可操作的东西。价值会复合，但前提是你把评估当作核心组件而不是事后想法。</p>
<p>模式因 agent 类型而异，但这里描述的基础是不变的。尽早开始，不要等待完美的套件。从你看到的失败中获取真实任务。定义无歧义、健壮的成功标准。精心设计评分器并结合多种类型。确保问题对模型来说足够难。迭代评估以提高其信噪比。阅读记录！</p>
<p>AI agent 评估仍然是一个新兴、快速发展的领域。随着 agents 承担更长的任务、在多 agent 系统中协作、处理越来越主观的工作，我们需要调整我们的技术。我们将继续分享学到的最佳实践。</p>
<h4 data-id="heading-18">致谢</h4>
<p>作者：Mikaela Grace、Jeremy Hadfield、Rodrigo Olivares 和 Jiri De Jonghe。我们也感谢 David Hershey、Gian Segato、Mike Merrill、Alex Shaw、Nicholas Carlini、Ethan Dixon、Pedram Navid、Jake Eaton、Alyssa Baum、Lina Tawfik、Karen Zhou、Alexander Bricken、Sam Kennedy、Robert Ying 等人的贡献。特别感谢我们通过评估合作中学习的客户和合作伙伴，包括 iGent、Cognition、Bolt、Sierra、Vals.ai、Macroscope、PromptLayer、Stripe、Shopify、Terminal Bench 团队等。这项工作反映了帮助在 Anthropic 发展评估实践的多个团队的集体努力。</p>
<h3 data-id="heading-19">附录：评估框架</h3>
<p>几个开源和商业框架可以帮助团队实施 agent 评估，而无需从头构建基础设施。正确的选择取决于你的 agent 类型、现有技术栈，以及你是否需要离线评估、生产可观察性或两者兼有。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fharborframework.com%2F" target="_blank" title="https://harborframework.com/" ref="nofollow noopener noreferrer">Harbor</a> 专为在容器化环境中运行 agents 设计，具有跨云提供商大规模运行试验的基础设施和定义任务与评分器的标准化格式。流行的基准如 Terminal-Bench 2.0 通过 Harbor 注册表发布，使得运行已建立的基准以及自定义评估套件变得容易。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.promptfoo.dev%2F" target="_blank" title="https://www.promptfoo.dev/" ref="nofollow noopener noreferrer">Promptfoo</a> 是一个轻量级、灵活的开源框架，专注于用于提示测试的声明式 YAML 配置，断言类型从字符串匹配到 LLM-as-judge 评分标准。我们在许多产品评估中使用 Promptfoo 的一个版本。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.braintrust.dev%2F" target="_blank" title="https://www.braintrust.dev/" ref="nofollow noopener noreferrer">Braintrust</a> 是一个将离线评估与生产可观察性和实验跟踪相结合的平台——对需要在开发期间迭代和监控生产质量的团队很有用。其 <code>autoevals</code> 库包含用于事实性、相关性和其他常见维度的预构建评分器。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Flangsmith%2Fevaluation" target="_blank" title="https://docs.langchain.com/langsmith/evaluation" ref="nofollow noopener noreferrer">LangSmith</a> 提供追踪、离线和在线评估以及数据集管理，与 LangChain 生态系统紧密集成。<a href="https://link.juejin.cn?target=https%3A%2F%2Flangfuse.com%2F" target="_blank" title="https://langfuse.com/" ref="nofollow noopener noreferrer">Langfuse</a> 为有数据驻留要求的团队提供类似的功能，作为自托管的开源替代方案。</p>
<p>许多团队结合使用多种工具，自己构建评估框架，或只是使用简单的评估脚本作为起点。我们发现，虽然框架可以是加速进展和标准化的有价值方式，但它们的好坏取决于你通过它们运行的评估任务。通常最好快速选择一个适合你工作流程的框架，然后将精力投入到评估本身——通过迭代高质量的测试用例和评分器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VPS交易避坑指南：原油、改邮、PUSH与交易所模式深度解析 (含搬瓦工/DMIT/NetCup实战)]]></title>    <link>https://juejin.cn/post/7593338828217450511</link>    <guid>https://juejin.cn/post/7593338828217450511</guid>    <pubDate>2026-01-10T10:39:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828217450511" data-draft-id="7593258683750989858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VPS交易避坑指南：原油、改邮、PUSH与交易所模式深度解析 (含搬瓦工/DMIT/NetCup实战)"/> <meta itemprop="keywords" content="服务器"/> <meta itemprop="datePublished" content="2026-01-10T10:39:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VPS交易避坑指南：原油、改邮、PUSH与交易所模式深度解析 (含搬瓦工/DMIT/NetCup实战)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T10:39:44.000Z" title="Sat Jan 10 2026 10:39:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 VPS 交易（MJJ 圈子）中，我们通常会遇到四种主要的交易模式。不同的商家政策和交接方式，决定了账号的安全性和交易价值。</p>
<p>本文将为您详细拆解这四种模式（原邮、改邮、官方 PUSH、交易所），并结合 <strong>搬瓦工、DMIT、NetCup、RackNerd</strong> 等代表性商家进行分析。</p>
<hr/>
<h2 data-id="heading-0">第一种：原邮</h2>
<p><strong>定义：</strong>
“原邮”（圈内常称“原油”）指的是用户在 VPS 商家注册账号时第一次使用的邮箱账户。通常是 Outlook、Gmail 或自建邮局账号。</p>
<ul>
<li><strong>特征</strong>：邮箱内通常保留着商家发送的第一封“Welcome”欢迎邮件。</li>
<li><strong>风险</strong>：交易时涉及移交邮箱账号本身，因此必须考虑邮箱被找回的风险。</li>
</ul>
<h3 data-id="heading-1">1. Outlook 邮箱的安全清洗</h3>
<p>如果是 Outlook 邮箱，在接收账号后必须进行彻底的防找回设置。我之前专门写过一篇教程：</p>
<blockquote>
<p><strong>文章地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.legacyvps.com%2Farchives%2Foutlook-account-security-guide-prevent-recovery-mjj" target="_blank" title="https://www.legacyvps.com/archives/outlook-account-security-guide-prevent-recovery-mjj" ref="nofollow noopener noreferrer">拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略</a></p>
</blockquote>
<h3 data-id="heading-2">2. 代表商家：搬瓦工 (BandwagonHost)</h3>
<p>搬瓦工的交易一般分成两种，分为“原油”和“改邮”两种，这两个在交易的时候容易价格方面差距明显：</p>
<ul>
<li><strong>带原邮</strong>：最安全，价格最高。没有找回的风险，也是交易的时候最受欢迎的。</li>
<li><strong>改邮</strong>：有很高的风险。因为搬瓦工的机器账户可以通过“原始邮箱”和“支付凭证”进行申诉找回。如果买到的是没有原始邮箱的改邮账号，很有可能被第一任号主，也就是原始邮箱的拥有者 “毁号”或“找回”的风险，因为有的搬瓦工账户被交易了很多次，追踪第一任号主有的时候是一件很麻烦的事情。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c64870d29444941a0209db08b43b913~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646383&amp;x-signature=S%2FUCiVt0NL%2FROLcWgqaTR41OvQM%3D" alt="image" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">第二种：改邮（修改绑定邮箱）</h2>
<p><strong>定义：</strong>
“改邮”是指在 VPS 商家后台将账户绑定的邮箱地址更改为买家的新邮箱。这通常意味着账户归属权的变更。</p>
<p>与搬瓦工不同，对于大多数支持改邮的商家，只要官方允许修改，交易通常是安全的。</p>
<h3 data-id="heading-4">1. 代表商家一：DMIT</h3>
<p>DMIT 可以通过后台修改邮箱界面完成账户邮箱的修改。</p>
<ul>
<li><strong>需要注意的是</strong>：新注册的账户或新购买的机器自带 <strong>10天冷却期</strong>。在此期间无法修改邮箱或转移机器（这是我曾在交易新机时踩过的坑）。</li>
<li><strong>安全建议</strong>：DMIT 改邮后基本无找回风险，具体操作可参考我的另一篇文章。</li>
</ul>
<blockquote>
<p><strong>🔗 文章地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.legacyvps.com%2Farchives%2Fdmit-account-transfer-change-email-guide-maximize-value" target="_blank" title="https://www.legacyvps.com/archives/dmit-account-transfer-change-email-guide-maximize-value" ref="nofollow noopener noreferrer">DMIT 账户交易完全指南：如何修改邮箱安全过户 &amp; 为什么“一号一机”最值钱？</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b82bd3f28a104b8cbc04f48ea348f133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646383&amp;x-signature=c1lTVULIulvqy%2BFk87qLLAlt4BA%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-5">2. 代表商家二：RackNerd</h3>
<p>RackNerd 除了部分特定的闪购套餐（Flash Sale）会限制修改邮箱，大多数套餐的账户都可以通过<strong>发工单</strong>的方式申请修改绑定的邮箱，但是一般只能修改一次，如果次数过多可能要求，使用官方的PUSH（需要收费，一次<strong>8美元</strong>)。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bce6ed4268594c1ca07f5f7e7764b273~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646383&amp;x-signature=n%2Be3Tn%2BomC2IKWAgv025RjF5LoQ%3D" alt="image" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">第三种：官方 PUSH（最稳妥）</h2>
<p><strong>定义：</strong>
官方 PUSH 是指通过商家提供的平台功能，将账号内的<strong>某一台特定机器</strong>转移（Push）到买家的账号下。</p>
<ul>
<li><strong>优势</strong>：只涉及机器转移，不涉及账号、密码和原始邮箱的交接。这是三种方式中最稳妥、最方便的。</li>
</ul>
<h3 data-id="heading-7">1. 代表商家一：NetCup</h3>
<p>NetCup 提供了非常成熟的过户机制，这家的交易我想大家都应该很熟悉了，通过转移码完成机器的过户操作。</p>
<ul>
<li><strong>费用</strong>：免费。</li>
<li><strong>条件</strong>：必须付清当前季度的账单。</li>
<li><strong>操作</strong>：卖家在后台生成转移码，买家输入即可接收，怕大家不知道，我这里加上了我以前写的教学文章。</li>
</ul>
<blockquote>
<p><strong>🔗 文章地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.legacyvps.com%2Farchives%2Fhow-to-transfer-push-netcup-vps-guide" target="_blank" title="https://www.legacyvps.com/archives/how-to-transfer-push-netcup-vps-guide" ref="nofollow noopener noreferrer">Netcup VPS 过户全攻略：手把手教你如何安全地将服务器 Push 给新用户</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d0b333bc394c8b8da57dd9ad77fd69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646383&amp;x-signature=lRA%2FHAlYdv4rf1eONtWXuruGyQs%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-8">2. 代表商家二：RackNerd</h3>
<ul>
<li><strong>费用</strong>：RackNerd 的 Push 费用是 <strong>$8</strong>，通过提交工单的方式完成机器的过户。</li>
<li><strong>需要注意的</strong>：RN 的 Push 费用是按<strong>次数（工单）<strong>收费，而不是按</strong>台数</strong>收费。如果你一次性 Push 多台机器给同一个账号，只需要支付一次 $8，所以如果一次性转移多台机器到另一个账户还是很划算的，转移的时候需要提供对方账户的邮箱地址。</li>
</ul>
<hr/>
<h2 data-id="heading-9">第四种：交易所交易</h2>
<p><strong>定义：</strong>
这是一种相对少见的模式，等于把你的机器放在商家内部的交易平台上。</p>
<ul>
<li><strong>操作</strong>：卖家设置好机器信息和价格，买家购买。也可以私下商定好价格，通过交易所指定 ID 或时间锁定机器完成交易。</li>
<li><strong>特点</strong>：官方的交易平台，还是有保障的，但是比较坑的是，部分商家可能会收取手续费，且卖出的资金不能立即到账，需要先提现到余额，然后再提现到你的对应支付宝或者微信账户，等待周期长提现时间不可控，还可能收取多笔手续费，很不划算。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc240302ecc54850bb10df419156cc53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768646383&amp;x-signature=NYnotkxQk3ArdMycJapmUlKXAEE%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-10">代表商家（仅作知识扩展）</h3>
<ul>
<li><strong>Akile</strong></li>
<li><strong>狐蒂云</strong></li>
<li><em>注：这里不是打广告，仅为了告诉小白一种比较少的交易形式。</em></li>
</ul>
<hr/>
<h3 data-id="heading-11">💡 总结与建议</h3>
<ul>
<li><strong>追求相对安全</strong>：首选 <strong>官方 PUSH</strong> 因为官方提供的PUSH服务是有保障的，不会出现邮箱找回，或者账户被找回，泄露自己账户信息（很多原油交易的账户还绑定了银行卡或者PayPal的自动续费，给自己和他人造成麻烦）。</li>
</ul>
<blockquote>
<p>交易的原油的时候，记得解绑自己的交易信息，防止被无故扣钱。</p>
</blockquote>
<ul>
<li><strong>有原油要原油</strong>：比如搬瓦工这类的商家，能有原油交易肯定是 <strong>原邮</strong>，因为不容易出现问题，你下次交易也方便，不会留下隐患，下次交易也可以直接给别人邮箱账户，让他自己完成解绑你也方便。</li>
<li><strong>改邮不是不可用需要看清楚</strong>：<strong>改邮</strong> 通常也是安全的，但是需要分清楚商家，也要注意商家的修改邮箱的规则，比如DMIT不是随时都可以修改，有10天的冷静期，自己在频繁交易的时候注意账户安全和平台限制。</li>
</ul>
<h3 data-id="heading-12">如果觉得文章好，可以关注<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.legacyvps.com%2F" target="_blank" title="https://www.legacyvps.com/" ref="nofollow noopener noreferrer">传家宝VPS</a></h3>
<blockquote>
<p>原文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.legacyvps.com%2Farchives%2Fvps-trading-guide-original-email-push-marketplace" target="_blank" title="https://www.legacyvps.com/archives/vps-trading-guide-original-email-push-marketplace" ref="nofollow noopener noreferrer">www.legacyvps.com/archives/vp…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SaaS 时代已死，SaaS 时代已来]]></title>    <link>https://juejin.cn/post/7593311347291652123</link>    <guid>https://juejin.cn/post/7593311347291652123</guid>    <pubDate>2026-01-10T10:46:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593311347291652123" data-draft-id="7593251491937075246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SaaS 时代已死，SaaS 时代已来"/> <meta itemprop="keywords" content="前端,后端,架构"/> <meta itemprop="datePublished" content="2026-01-10T10:46:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jump_jump"/> <meta itemprop="url" content="https://juejin.cn/user/4230576474692765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SaaS 时代已死，SaaS 时代已来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576474692765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jump_jump
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T10:46:47.000Z" title="Sat Jan 10 2026 10:46:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>Software as a Service → Service as a Software</p>
</blockquote>
<p>上周我用 Claude Code 写一个项目，从描述需求到上线，3 小时。</p>
<p>以前这活儿我得写两周。</p>
<p>坐在屏幕前，看着 Agent 自己读文件、改代码、跑测试，我脑子里突然冒出一个念头：完了，游戏规则变了。</p>
<hr/>
<h2 data-id="heading-0">新人的路，可能被堵死了</h2>
<p>这事让我挺难受的。</p>
<p>我是怎么成长起来的？写代码、踩坑、被骂、复盘、再写。那些凌晨排查的线上故障，那些被 leader review 打回来的烂代码，那些上线后才发现的并发 bug —— 每一个都是学费，每一个都让我长了本事。</p>
<p>但现在呢？</p>
<p>简单的活，Agent 干了。CRUD、常规 bug fix、写个脚本——Agent 又快又好，新人连练手的机会都没有。复杂的活，还是得老手来，因为新人兜不住。</p>
<p>于是新人的处境变成了：<strong>从产品经理那接需求，转述给 Agent，再把 Agent 的输出交上去</strong>。</p>
<p>这不叫工程师，这叫人肉胶水。</p>
<p>更让我担心的是，以后的架构师、技术专家从哪来？没有足够的坑让人踩，哪来的专家？那些"熔炉"正在消失。</p>
<p>你可以回想一下：过去一年，你亲手写的代码是多了还是少了？亲手排查的故障呢？</p>
<hr/>
<h2 data-id="heading-1">Vibe Coding：我很爽，但我也很警惕</h2>
<p>Karpathy 说的 Vibe Coding，我现在天天在干。</p>
<p>不写代码了，用嘴说。告诉 Agent 我要什么，它写，我看，不满意就调 prompt，满意就提交。整个过程确实很爽，像在指挥一个特别听话的实习生。</p>
<p>但我知道这事的前提是什么——<strong>我能 vibe 对，是因为我知道什么是对的</strong>。</p>
<p>我看 Agent 的代码，脑子里自动在跑：这个锁的粒度对不对、这个异步处理会不会有竞态问题、这个查询在数据量大了之后会不会拖垮服务。这不是我刻意在审查，是十年喂出来的本能。</p>
<p>但如果一个写了两年代码的人来 Vibe Coding 呢？他的 vibe 可能就是"能跑就行"。代码确实能跑，测试确实能过，但那些藏在里面的雷，他看不见。</p>
<p><strong>同样是 Vibe Coding，老手在 10 倍速产出，新手在 10 倍速埋雷。</strong></p>
<p>更微妙的是，Vibe Coding 会给人一种"我也会写代码了"的错觉。这种虚假的胜任感，可能比不会用 AI 更危险。</p>
<p>你可以试试：翻一下上周 Agent 给你写的代码，看看能不能挑出三个潜在问题。这个小测试挺有意思的。</p>
<hr/>
<h2 data-id="heading-2">对我来说，这是杠杆最大的时代</h2>
<p>说完担忧，说说兴奋的部分。</p>
<p>作为一个写了十年代码的人，我发现我的杠杆从来没有这么大过。</p>
<p>以前我的经验只能通过两种方式输出：亲自干活，或者带人。一天就 24 小时，能干的活有限，能带的人也有限。</p>
<p>现在不一样了。</p>
<p>我在做的事是：<strong>把我的经验喂给 Agent</strong>。</p>
<p>第一步，用 Coding Agent 把我积累的那些套路——架构模式、踩坑经验、最佳实践——快速开发成可复用的模块和工具。以前要反复手写的东西，现在沉淀成代码库。这一层能干掉 90% 的重复劳动。</p>
<p>第二步，再套一层专属 Agent。把我的经验写成 Prompt 和知识库，让 Agent 能回答那些常规问题：这个设计怎么做更合理、这个性能问题怎么排查、这个技术选型怎么选。这一层又能覆盖 9% 的场景。</p>
<p>剩下那 1%，真正需要创造性判断的疑难杂症，才需要我亲自出手。</p>
<p>算一下：<strong>一个我，加上一堆 Agent，产出能顶过去好几个人</strong>。这种杠杆，以前想都不敢想。</p>
<p>如果你也是某个领域摸爬滚打过的人，可以琢磨琢磨：你的经验能不能也这么沉淀下来？</p>
<hr/>
<h2 data-id="heading-3">SaaS 的护城河，塌了</h2>
<p>说回标题。我为什么说 SaaS 时代要结束了？</p>
<p>因为软件开发的成本正在崩塌。</p>
<p>以前做一个定制系统，要招团队、写代码、测试、上线，没有几个月搞不定。所以大家都去买 SaaS，付订阅费，用通用的产品，忍受那些不完全合适的功能。</p>
<p>但现在，一个懂行的人，用 Agent 一两周就能撸出一个定制系统。既然定制化的成本接近于零了，为什么还要将就通用产品？</p>
<p>我看到的趋势是：<strong>从 Software as a Service，变成 Service as a Software</strong>。</p>
<p>你买的不再是一个通用软件的使用权，而是专家能力的软件化交付。这个软件是专门为你的问题定制的，背后是专家的经验和判断。</p>
<p>这个转变才刚开始，但方向已经很清楚了。</p>
<hr/>
<h2 data-id="heading-4">最后</h2>
<p>2026 年，站在这个节点上，我的感受很复杂。</p>
<p>一方面，我自己挺爽的。十年的积累，终于有了一个前所未有的放大器。</p>
<p>另一方面，我看着那些刚入行的年轻人，有点替他们担心。他们的成长路径，可能和我们这一代完全不同了。是更好还是更难？说实话我也不知道。你呢？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025：当Vibe Coding成为我的创意画布——一名前端工程师的AI元年记]]></title>    <link>https://juejin.cn/post/7593337928307408922</link>    <guid>https://juejin.cn/post/7593337928307408922</guid>    <pubDate>2026-01-10T10:58:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593337928307408922" data-draft-id="7593251491937042478" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 2025：当Vibe Coding成为我的创意画布——一名前端工程师的AI元年记"/> <meta itemprop="keywords" content="前端,Trae"/> <meta itemprop="datePublished" content="2026-01-10T10:58:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             2025：当Vibe Coding成为我的创意画布——一名前端工程师的AI元年记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T10:58:46.000Z" title="Sat Jan 10 2026 10:58:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3f6afe586444cf5b320108869972080~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=%2FJ6nC2xw5hkrpzoRvghaTYXIHQs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">引子：那个让我头皮发麻的晨会</h2>
<blockquote>
<p><em>"未来的前端不是在写UI，而是在与AI共舞，创造出超越想象的用户体验。"</em></p>
</blockquote>
<p>2025年3月18日早晨10点，产品经理在晨会上兴奋地展示竞品的新交互："他们这个3D数据可视化太酷了！我们能不能这周也做一个？" 按照2024年的我，会立刻计算出需要的时间：研究Three.js至少两天，开发核心功能三天，调试兼容性两天，总计一周还得加班。</p>
<p>但这次，我只是平静地回复："下午给你原型，明天上线完整版。"</p>
<p>回到工位，我对AI说："创建一个交互式3D数据可视化组件，支持实时数据更新，要酷炫但要性能好。" 三小时后，一个让我惊艳的组件诞生了——不仅实现了需求，还加入了产品经理都没敢想的<strong>粒子效果</strong>和<strong>手势交互</strong>。</p>
<h2 data-id="heading-1">第一章：从切图仔到UX导演——我的前端AI进化史</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fe5a27f2cdf4233bc24eaa9eef07bf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=aLtuRKt%2BCVwe1F2crN0%2B8DFQhYw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">1.1 傲慢与偏见："AI能懂设计系统吗？"</h3>
<p>年初的我是怀疑论者，特别是当我看到AI生成的第一个组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 2025年1月AI生成的"丑陋"按钮</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">AIGeneratedButton</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
        <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">FF5733</span>',
        <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>',
        <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span> <span class="hljs-attr">40px</span>',
        <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">50px</span>',
        <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">24px</span>',
        <span class="hljs-attr">border:</span> '<span class="hljs-attr">5px</span> <span class="hljs-attr">dashed</span> #<span class="hljs-attr">33FF57</span>',
        <span class="hljs-attr">boxShadow:</span> '<span class="hljs-attr">10px</span> <span class="hljs-attr">10px</span> <span class="hljs-attr">20px</span> <span class="hljs-attr">rgba</span>(<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0.5</span>)'
      }}
    &gt;</span>
      点我！
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
};
</code></pre>
<p>我当时内心的吐槽：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 我的内心OS</span>
<span class="hljs-keyword">const</span> myThoughts = {
  审美: <span class="hljs-string">"这配色是色盲测试吗？"</span>,
  规范: <span class="hljs-string">"我们Design Token呢？"</span>,
  性能: <span class="hljs-string">"inline style + 巨大阴影？"</span>,
  可维护性: <span class="hljs-string">"这代码能进生产？"</span>,
  结论: <span class="hljs-string">"AI还是不懂前端"</span>
};
</code></pre>
<h3 data-id="heading-3">1.2 第一次震撼：当AI设计出我从未想过的交互动画</h3>
<p>真正让我破防的是二月份的一个需求。我们需要为金融数据展示设计一个<strong>既专业又生动</strong>的图表刷新动画。我习惯性地开始写keyframes时，AI给出了一个颠覆性的方案：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// AI设计的物理引擎驱动的数据更新动画</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">PhysicalChartAnimation</span> = (<span class="hljs-params">{ data, onDataUpdate }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [particles, setParticles] = <span class="hljs-title function_">useState</span>([]);
  <span class="hljs-keyword">const</span> canvasRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> { springs, animated } = <span class="hljs-title function_">useSprings</span>(data.<span class="hljs-property">length</span>, <span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> ({
    <span class="hljs-attr">from</span>: { <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span> },
    <span class="hljs-attr">to</span>: { <span class="hljs-attr">y</span>: data[i].<span class="hljs-property">value</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span> },
    <span class="hljs-attr">config</span>: { 
      <span class="hljs-attr">tension</span>: <span class="hljs-number">120</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">60</span>,
      <span class="hljs-attr">friction</span>: <span class="hljs-number">20</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span>
    }
  }));

  <span class="hljs-comment">// AI添加的粒子效果 - 我从未想过的细节</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!canvasRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">const</span> ctx = canvasRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">animateParticles</span> = (<span class="hljs-params"/>) =&gt; {
      ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ctx.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, ctx.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);
      
      particles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">particle, i</span>) =&gt;</span> {
        <span class="hljs-comment">// 物理计算：重力、阻力、浮力</span>
        particle.<span class="hljs-property">velocity</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.1</span>; <span class="hljs-comment">// 重力</span>
        particle.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">multiply</span>(<span class="hljs-number">0.98</span>); <span class="hljs-comment">// 空气阻力</span>
        particle.<span class="hljs-property">position</span>.<span class="hljs-title function_">add</span>(particle.<span class="hljs-property">velocity</span>);
        
        <span class="hljs-comment">// 边界检测和反弹</span>
        <span class="hljs-keyword">if</span> (particle.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> &gt; ctx.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>) {
          particle.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = ctx.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>;
          particle.<span class="hljs-property">velocity</span>.<span class="hljs-property">y</span> *= -<span class="hljs-number">0.8</span>; <span class="hljs-comment">// 能量损失</span>
        }
        
        <span class="hljs-comment">// 绘制粒子</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(particle.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, particle.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, 
                particle.<span class="hljs-property">radius</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">`rgba(66, 133, 244, <span class="hljs-subst">${particle.life}</span>)`</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        
        particle.<span class="hljs-property">life</span> -= <span class="hljs-number">0.01</span>;
        <span class="hljs-keyword">if</span> (particle.<span class="hljs-property">life</span> &lt;= <span class="hljs-number">0</span>) {
          particles.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
        }
      });
      
      <span class="hljs-title function_">requestAnimationFrame</span>(animateParticles);
    };
    
    <span class="hljs-title function_">animateParticles</span>();
  }, [particles]);

  <span class="hljs-comment">// AI实现的视差滚动效果</span>
  <span class="hljs-keyword">const</span> { scrollYProgress } = <span class="hljs-title function_">useViewportScroll</span>();
  <span class="hljs-keyword">const</span> parallaxStyle = <span class="hljs-title function_">useSpring</span>({
    <span class="hljs-attr">transform</span>: scrollYProgress.<span class="hljs-title function_">to</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-string">`translateY(<span class="hljs-subst">${v * <span class="hljs-number">50</span>}</span>px)`</span>),
    <span class="hljs-attr">config</span>: { <span class="hljs-attr">mass</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">tension</span>: <span class="hljs-number">280</span>, <span class="hljs-attr">friction</span>: <span class="hljs-number">60</span> }
  });

  <span class="hljs-comment">// 最让我震惊的：AI自动生成的Lottie动画SVG路径</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">generateDataFlowSVG</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// AI根据数据结构生成动态SVG路径</span>
    <span class="hljs-keyword">const</span> path = data.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, point, i</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> x = i * <span class="hljs-number">50</span>;
      <span class="hljs-keyword">const</span> y = <span class="hljs-number">300</span> - point.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>;
      <span class="hljs-keyword">return</span> acc + <span class="hljs-string">`<span class="hljs-subst">${i === <span class="hljs-number">0</span> ? <span class="hljs-string">'M'</span> : <span class="hljs-string">'L'</span>}</span> <span class="hljs-subst">${x}</span> <span class="hljs-subst">${y}</span>`</span>;
    }, <span class="hljs-string">''</span>);
    
    <span class="hljs-comment">// AI添加的流动动画</span>
    <span class="hljs-keyword">const</span> flowAnimation = <span class="hljs-string">`
      @keyframes flow {
        to { stroke-dashoffset: -1000; }
      }
      path {
        stroke-dasharray: 10;
        animation: flow 20s linear infinite;
      }
    `</span>;
    
    <span class="hljs-keyword">return</span> { path, <span class="hljs-attr">style</span>: flowAnimation };
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"chart-container"</span>&gt;</span>
      {/* React Spring动画 */}
      {animated.map((props, i) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">animated.div</span> 
          <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">...props</span>,
            <span class="hljs-attr">position:</span> '<span class="hljs-attr">absolute</span>',
            <span class="hljs-attr">left:</span> <span class="hljs-attr">i</span> * <span class="hljs-attr">60</span>,
            <span class="hljs-attr">width:</span> <span class="hljs-attr">40</span>,
            <span class="hljs-attr">background:</span> `<span class="hljs-attr">linear-gradient</span>(<span class="hljs-attr">135deg</span>, 
                         #<span class="hljs-attr">4285f4</span>, #<span class="hljs-attr">34a853</span>)`
          }}
        /&gt;</span>
      ))}
      
      {/* 粒子画布 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> 
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{canvasRef}</span> 
        <span class="hljs-attr">width</span>=<span class="hljs-string">{800}</span> 
        <span class="hljs-attr">height</span>=<span class="hljs-string">{400}</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">position:</span> '<span class="hljs-attr">absolute</span>', <span class="hljs-attr">top:</span> <span class="hljs-attr">0</span> }}
      /&gt;</span>
      
      {/* Lottie-like SVG动画 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"800"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>{generateDataFlowSVG().style}<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">path</span> 
          <span class="hljs-attr">d</span>=<span class="hljs-string">{generateDataFlowSVG().path}</span> 
          <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span> 
          <span class="hljs-attr">stroke</span>=<span class="hljs-string">"#4285f4"</span> 
          <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">"2"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<p><strong>颠覆点</strong>：这个组件同时使用了<strong>React Spring、Canvas粒子系统、SVG动画、物理引擎</strong>，而且所有动画都是60fps流畅的。我自己写可能需要三天，AI在30分钟内就给出了完整方案。</p>
<h2 data-id="heading-4">第二章：Vibe Coding——重新定义"设计"界面</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c83073236ee4c289d48d3b1aa0df954~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=JQgn2S9avq%2FB%2FTlwuf13ATrSHvE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.1 什么是前端的Vibe Coding？</h3>
<p>Vibe Coding不是简单的"AI生成代码"，而是<strong>创意与技术的无缝融合</strong>。让我用实际案例展示：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 传统前端开发 vs Vibe Coding 对比</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">DevelopmentComparison</span> = (<span class="hljs-params"/>) =&gt; {
  
  <span class="hljs-comment">// 传统前端模式（2024年）</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">TraditionalFrontend</span> = {
    设计稿评审: <span class="hljs-string">"1小时 - 和设计师争论间距"</span>,
    组件拆分: <span class="hljs-string">"2小时 - 纠结要不要抽象"</span>,
    样式编写: <span class="hljs-string">"4小时 - 调CSS调到眼瞎"</span>,
    交互实现: <span class="hljs-string">"3小时 - 调试动画曲线"</span>,
    响应式适配: <span class="hljs-string">"2小时 - 骂一遍各种浏览器"</span>,
    性能优化: <span class="hljs-string">"2小时 - 懒加载、代码分割"</span>,
    测试调试: <span class="hljs-string">"3小时 - 为什么iOS上不行？"</span>,
    总耗时: <span class="hljs-string">"17小时，心累程度：极高"</span>
  };
  
  <span class="hljs-comment">// Vibe Coding模式（2025年）</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">VibeCodingFrontend</span> = {
    <span class="hljs-comment">// 阶段一：创意对齐（15分钟）</span>
    创意会议: <span class="hljs-string">`设计师："我想要太空主题，有星际穿越感"
               我（对AI）：太空主题的数据看板，深色背景，
               要有粒子星星、行星轨道动画、飞船穿梭效果`</span>,
    
    <span class="hljs-comment">// AI立即生成三个设计方案</span>
    <span class="hljs-variable constant_">AI</span>方案: [
      <span class="hljs-string">"方案A：Neon太空风格，赛博朋克感"</span>,
      <span class="hljs-string">"方案B：极简太空，focus on数据"</span>,
      <span class="hljs-string">"方案C：拟物化太空，有真实感"</span>
    ],
    
    <span class="hljs-comment">// 阶段二：技术实现（1小时）</span>
    组件生成: <span class="hljs-string">"AI生成核心组件骨架"</span>,
    交互动画: <span class="hljs-string">"AI添加物理引擎动画"</span>,
    性能保证: <span class="hljs-string">"AI自动优化渲染性能"</span>,
    
    <span class="hljs-comment">// 阶段三：创意增强（30分钟）</span>
    我的创意: <span class="hljs-string">"AI，在数据更新时加个超新星爆炸效果"</span>,
    <span class="hljs-variable constant_">AI</span>增强: <span class="hljs-string">"好的，再加个引力透镜扭曲效果如何？"</span>,
    
    <span class="hljs-comment">// 阶段四：自适应（15分钟）</span>
    响应式: <span class="hljs-string">"AI自动生成所有断点的样式"</span>,
    无障碍: <span class="hljs-string">"AI自动添加ARIA标签和键盘导航"</span>,
    主题适配: <span class="hljs-string">"AI根据系统主题自动切换亮色/暗色"</span>,
    
    总耗时: <span class="hljs-string">"2小时，兴奋程度：极高"</span>
  };
  
  <span class="hljs-keyword">return</span> { <span class="hljs-title class_">TraditionalFrontend</span>, <span class="hljs-title class_">VibeCodingFrontend</span> };
};
</code></pre>
<h3 data-id="heading-6">2.2 我的Vibe Coding前端工作流革命</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "传统前端工作流（2024）"
        A1[设计稿评审] --&gt; B1[手动切图]
        B1 --&gt; C1[手动写CSS]
        C1 --&gt; D1[手动调动画]
        D1 --&gt; E1[手动适配]
        E1 --&gt; F1[疲惫上线]
    end
    
    subgraph "Vibe Coding工作流（2025）"
        A2[创意输入] --&gt; B2[AI生成设计系统]
        B2 --&gt; C2[实时预览迭代]
        C2 --&gt; D2[代码与创意共舞]
        D2 --&gt; E2[AI自动优化]
        E2 --&gt; F2[一键多端适配]
        F2 --&gt; G2[兴奋上线]
    end
    
    style A1 fill:#f9f,stroke:#333
    style G2 fill:#6cf,stroke:#333
</code></pre>
<p>具体工具栈演进：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 2024年我的工具栈</span>
<span class="hljs-attr">frontend_stack_2024:</span>
  <span class="hljs-attr">ide:</span> <span class="hljs-string">VSCode</span> <span class="hljs-string">+</span> <span class="hljs-string">一堆插件</span>
  <span class="hljs-attr">ui_library:</span> <span class="hljs-string">React</span> <span class="hljs-string">+</span> <span class="hljs-string">Ant</span> <span class="hljs-string">Design</span>
  <span class="hljs-attr">styling:</span> <span class="hljs-string">SCSS</span> <span class="hljs-string">+</span> <span class="hljs-string">BEM命名</span>
  <span class="hljs-attr">animation:</span> <span class="hljs-string">CSS动画</span> <span class="hljs-string">+</span> <span class="hljs-string">少量GSAP</span>
  <span class="hljs-attr">design_tool:</span> <span class="hljs-string">从Figma复制CSS</span>
  <span class="hljs-attr">testing:</span> <span class="hljs-string">Jest</span> <span class="hljs-string">+</span> <span class="hljs-string">React</span> <span class="hljs-string">Testing</span> <span class="hljs-string">Library</span>
  <span class="hljs-attr">build:</span> <span class="hljs-string">Webpack手动配置</span>
  
<span class="hljs-comment"># 2025年我的工具栈  </span>
<span class="hljs-attr">frontend_stack_2025:</span>
  <span class="hljs-attr">ide:</span> <span class="hljs-string">Cursor</span> <span class="hljs-string">+</span> <span class="hljs-string">V0.dev</span>
  <span class="hljs-attr">ai_assistant:</span> 
    <span class="hljs-bullet">-</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3.5</span> <span class="hljs-string">Sonnet</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">v0</span> <span class="hljs-string">by</span> <span class="hljs-string">Vercel</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Galileo</span> <span class="hljs-string">AI</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">自训练组件库模型</span>
  <span class="hljs-attr">styling:</span> 
    <span class="hljs-bullet">-</span> <span class="hljs-string">Tailwind</span> <span class="hljs-string">+</span> <span class="hljs-string">AI类名生成</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">CSS-in-JS</span> <span class="hljs-string">with</span> <span class="hljs-string">AI优化</span>
  <span class="hljs-attr">animation:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Framer</span> <span class="hljs-string">Motion</span> <span class="hljs-string">+</span> <span class="hljs-string">AI补间</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Rive</span> <span class="hljs-string">+</span> <span class="hljs-string">AI生成动画</span>
  <span class="hljs-attr">design_sync:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Figma</span> <span class="hljs-string">to</span> <span class="hljs-string">Code</span> <span class="hljs-string">AI转换</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">设计系统智能同步</span>
  <span class="hljs-attr">build:</span> 
    <span class="hljs-bullet">-</span> <span class="hljs-string">Turbopack</span> <span class="hljs-string">+</span> <span class="hljs-string">AI优化配置</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">AI自动代码分割</span>
</code></pre>
<h2 data-id="heading-7">第三章：技能树的重构——什么能力变得更重要了？</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cef7cfe1ec2414daa1bb9bb508484a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=k%2FXvSQV32BwuW9pf9BU4sqguRUI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">3.1 正在消失的前端技能</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这些技能需求在急剧减少</span>
<span class="hljs-keyword">const</span> diminishingFrontendSkills = [
  <span class="hljs-string">"手动编写重复UI组件"</span>,      <span class="hljs-comment">// AI一秒生成</span>
  <span class="hljs-string">"记忆CSS属性兼容性"</span>,       <span class="hljs-comment">// AI自动添加前缀</span>
  <span class="hljs-string">"手动适配各种屏幕尺寸"</span>,     <span class="hljs-comment">// AI一键响应式</span>
  <span class="hljs-string">"基础动画关键帧手写"</span>,      <span class="hljs-comment">// AI生成更流畅</span>
  <span class="hljs-string">"手动性能优化"</span>,           <span class="hljs-comment">// AI分析更全面</span>
  <span class="hljs-string">"从设计稿手动测量间距"</span>     <span class="hljs-comment">// Figma插件一键导出</span>
];

<span class="hljs-comment">// 但这些技能价值飙升</span>
<span class="hljs-keyword">const</span> boomingFrontendSkills = [
  <span class="hljs-string">"创意表达与AI沟通能力"</span>,    <span class="hljs-comment">// 把创意转化为AI指令</span>
  <span class="hljs-string">"动效设计与物理直觉"</span>,      <span class="hljs-comment">// 指导AI制作高级动画</span>
  <span class="hljs-string">"用户体验微交互设计"</span>,      <span class="hljs-comment">// AI实现，人类设计</span>
  <span class="hljs-string">"性能瓶颈分析判断"</span>,        <span class="hljs-comment">// AI给数据，人类做决策</span>
  <span class="hljs-string">"设计系统演进规划"</span>,        <span class="hljs-comment">// 长期视角AI缺乏</span>
  <span class="hljs-string">"跨端一致体验设计"</span>        <span class="hljs-comment">// 统筹各个端的AI实现</span>
];
</code></pre>
<h3 data-id="heading-9">3.2 新兴的前端"超能力"</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 1. 创意编码（Creative Coding）能力</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CreativeCodingAbility</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [creativeIdeas, setCreativeIdeas] = <span class="hljs-title function_">useState</span>([]);
  
  <span class="hljs-comment">// 不再是写CSS，而是描述视觉效果</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">describeVisualEffect</span> = (<span class="hljs-params">description</span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`创建一个<span class="hljs-subst">${description}</span>的视觉效果，
            要有层次感，动画要自然，
            性能要优化到60fps，
            同时支持暗色和亮色主题`</span>;
  };
  
  <span class="hljs-comment">// AI创意增强</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">enhanceWithAI</span> = (<span class="hljs-params">baseIdea</span>) =&gt; {
    <span class="hljs-keyword">const</span> enhancements = [
      <span class="hljs-string">"添加视差滚动效果"</span>,
      <span class="hljs-string">"加入微交互反馈"</span>, 
      <span class="hljs-string">"用粒子系统增强视觉冲击"</span>,
      <span class="hljs-string">"添加物理引擎让动画更真实"</span>,
      <span class="hljs-string">"实现创意变形动画"</span>
    ];
    <span class="hljs-keyword">return</span> [...baseIdea, ...enhancements];
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"creative-coder"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>我不再是切图仔，我是数字艺术家<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>通过AI，我能实现以前只能在Dribbble上点赞的效果<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 2. AI组件审查（全新的审查维度）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">AIComponentReview</span> = (<span class="hljs-params">{ componentCode }</span>) =&gt; {
  <span class="hljs-keyword">const</span> reviewResults = {
    <span class="hljs-comment">// 传统审查维度</span>
    <span class="hljs-attr">codeQuality</span>: <span class="hljs-title function_">checkCodeQuality</span>(componentCode),
    <span class="hljs-attr">performance</span>: <span class="hljs-title function_">analyzePerformance</span>(componentCode),
    <span class="hljs-attr">accessibility</span>: <span class="hljs-title function_">checkA11y</span>(componentCode),
    
    <span class="hljs-comment">// AI特有审查维度</span>
    <span class="hljs-attr">aiGeneratedPatterns</span>: <span class="hljs-title function_">detectAIPatterns</span>(componentCode),
    <span class="hljs-attr">creativeOriginality</span>: <span class="hljs-title function_">assessOriginality</span>(componentCode),
    <span class="hljs-attr">visualConsistency</span>: <span class="hljs-title function_">checkDesignSystemConsistency</span>(componentCode),
    <span class="hljs-attr">animationSmoothness</span>: <span class="hljs-title function_">measureAnimationFPS</span>(componentCode),
    <span class="hljs-attr">bundleSizeImpact</span>: <span class="hljs-title function_">calculateBundleImpact</span>(componentCode)
  };
  
  <span class="hljs-comment">// 检测AI生成代码的"坏味道"</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">detectAIPatterns</span> = (<span class="hljs-params">code</span>) =&gt; {
    <span class="hljs-keyword">const</span> aiSmells = [
      <span class="hljs-string">"过度复杂的动画组合"</span>,        <span class="hljs-comment">// AI喜欢炫技</span>
      <span class="hljs-string">"不必要的3D变换"</span>,           <span class="hljs-comment">// 可能影响性能</span>
      <span class="hljs-string">"过于通用的组件抽象"</span>,        <span class="hljs-comment">// 为了复用而复用</span>
      <span class="hljs-string">"无视设计系统的自定义样式"</span>,    <span class="hljs-comment">// AI不知道团队规范</span>
      <span class="hljs-string">"大量内联样式"</span>,            <span class="hljs-comment">// AI的坏习惯</span>
    ];
    <span class="hljs-keyword">return</span> aiSmells.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">smell</span> =&gt;</span> code.<span class="hljs-title function_">includes</span>(smell));
  };
  
  <span class="hljs-keyword">return</span> reviewResults;
};

<span class="hljs-comment">// 3. 跨模态设计实现能力</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CrossModalDesign</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 我能用多种方式实现同一个设计</span>
  
  <span class="hljs-keyword">const</span> implementationOptions = {
    设计需求: <span class="hljs-string">"一个具有液体流动效果的按钮"</span>,
    
    实现方式: {
      <span class="hljs-attr">option1</span>: {
        技术: <span class="hljs-string">"CSS渐变 + 动画"</span>,
        <span class="hljs-attr">aiPrompt</span>: <span class="hljs-string">"用CSS创建一个液体流动效果的按钮"</span>,
        优点: <span class="hljs-string">"轻量，兼容性好"</span>,
        缺点: <span class="hljs-string">"效果有限"</span>
      },
      <span class="hljs-attr">option2</span>: {
        技术: <span class="hljs-string">"Canvas 2D"</span>,
        <span class="hljs-attr">aiPrompt</span>: <span class="hljs-string">"用Canvas 2D API实现流体模拟按钮"</span>,
        优点: <span class="hljs-string">"效果真实，可定制"</span>,
        缺点: <span class="hljs-string">"性能要求高"</span>
      },
      <span class="hljs-attr">option3</span>: {
        技术: <span class="hljs-string">"WebGL + Three.js"</span>,
        <span class="hljs-attr">aiPrompt</span>: <span class="hljs-string">"用Three.js实现3D液体效果按钮"</span>,
        优点: <span class="hljs-string">"效果炫酷，3D感强"</span>,
        缺点: <span class="hljs-string">"包体积大，移动端性能差"</span>
      },
      <span class="hljs-attr">option4</span>: {
        技术: <span class="hljs-string">"Lottie/SVG动画"</span>,
        <span class="hljs-attr">aiPrompt</span>: <span class="hljs-string">"设计一个液体流动的SVG路径动画"</span>,
        优点: <span class="hljs-string">"矢量，可缩放"</span>,
        缺点: <span class="hljs-string">"需要设计师配合"</span>
      }
    },
    
    我的决策过程: <span class="hljs-string">`
      1. 如果是营销页面，选择option3（要酷炫）
      2. 如果是产品核心功能，选择option1（要稳定）
      3. 如果是移动端H5，选择option4（要轻量）
      4. 如果是数据可视化，选择option2（要灵活）
    `</span>
  };
  
  <span class="hljs-keyword">return</span> implementationOptions;
};

<span class="hljs-comment">// 4. 实时协作设计系统</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">RealTimeDesignSystem</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [designTokens, setDesignTokens] = <span class="hljs-title function_">useState</span>({});
  <span class="hljs-keyword">const</span> [components, setComponents] = <span class="hljs-title function_">useState</span>([]);
  
  <span class="hljs-comment">// AI辅助的设计系统演进</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 监控组件使用情况</span>
    <span class="hljs-keyword">const</span> usageAnalytics = <span class="hljs-title function_">collectComponentUsage</span>();
    
    <span class="hljs-comment">// AI建议设计系统更新</span>
    <span class="hljs-keyword">const</span> suggestions = <span class="hljs-title function_">aiAnalyzeSuggestions</span>(usageAnalytics);
    
    <span class="hljs-comment">// 自动生成设计系统文档</span>
    <span class="hljs-keyword">const</span> updatedDocs = <span class="hljs-title function_">generateDesignSystemDocs</span>(components, designTokens);
    
    <span class="hljs-comment">// 一键同步到所有项目</span>
    <span class="hljs-title function_">syncToAllProjects</span>(updatedDocs);
  }, [components, designTokens]);
  
  <span class="hljs-comment">// 创意到代码的实时转换</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">creativeToCode</span> = (<span class="hljs-params">sketchDescription</span>) =&gt; {
    <span class="hljs-comment">// 描述性语言 -&gt; 组件代码</span>
    <span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`创建一个<span class="hljs-subst">${sketchDescription}</span>的React组件，
                    使用我们的设计系统token，
                    要有完整的TypeScript类型，
                    支持RTL布局，
                    通过所有a11y测试`</span>;
    
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">aiGenerateComponent</span>(prompt);
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DesignSystemContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">designTokens</span>, <span class="hljs-attr">components</span> }}&gt;</span>
      {/* 实时设计系统界面 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">DesignSystemContext.Provider</span>&gt;</span></span>
  );
};
</code></pre>
<h2 data-id="heading-10">第四章：真实项目案例——AI如何改变我的前端工作</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f2449d68c7449b98350ba022154037~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=iolXm6OFjSb1naVK0Ixn1kqGYrY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">4.1 案例一：三天完成原本需要三周的3D数据可视化项目</h3>
<p><strong>背景</strong>：金融科技公司需要实时3D交易数据可视化仪表盘。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// AI辅助的3D数据可视化项目</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ThreeDDataVizProject</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 传统方式预估：3周（15个工作日）</span>
  <span class="hljs-comment">// AI辅助实际：3天（含周末加班？不需要！）</span>
  
  <span class="hljs-keyword">const</span> projectTimeline = {
    <span class="hljs-attr">day1</span>: {
      <span class="hljs-attr">morning</span>: <span class="hljs-string">"需求分析与AI脑暴"</span>,
      <span class="hljs-attr">activity</span>: <span class="hljs-string">`我：需要一个3D交易数据可视化，类似股票行情但更酷
                AI：推荐三种方案：Three.js、WebGPU、Deck.gl
                我选择Three.js，因为生态丰富`</span>,
      
      <span class="hljs-attr">afternoon</span>: <span class="hljs-string">"AI生成基础架构"</span>,
      <span class="hljs-attr">code</span>: <span class="hljs-string">`// AI自动生成的Three.js场景骨架
const TradingScene = () =&gt; {
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera();
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  
  // AI自动添加的基础几何体
  const createDataPoints = (data) =&gt; {
    return data.map(item =&gt; {
      const geometry = new THREE.SphereGeometry(0.5, 32, 32);
      const material = new THREE.MeshPhongMaterial({ 
        color: getColorByValue(item.value) 
      });
      return new THREE.Mesh(geometry, material);
    });
  };
}`</span>,
      
      <span class="hljs-attr">evening</span>: <span class="hljs-string">"我添加业务逻辑"</span>,
      <span class="hljs-attr">work</span>: <span class="hljs-string">"将交易数据映射到3D坐标，添加交互事件"</span>
    },
    
    <span class="hljs-attr">day2</span>: {
      <span class="hljs-attr">morning</span>: <span class="hljs-string">"AI增强视觉效果"</span>,
      <span class="hljs-attr">activity</span>: <span class="hljs-string">`我：给数据点添加连接线，要像神经网络
                AI：添加了Bezier曲线和流动动画
                我：再加点粒子效果
                AI：添加了跟随数据点的轨迹粒子`</span>,
      
      <span class="hljs-attr">code</span>: <span class="hljs-string">`// AI增强的视觉效果
const EnhancedEffects = () =&gt; {
  // 神经网络式连接线
  const createNeuralConnections = (points) =&gt; {
    return points.flatMap((pointA, i) =&gt; 
      points.slice(i + 1).map(pointB =&gt; ({
        curve: new THREE.CatmullRomCurve3([
          pointA.position, 
          randomControlPoint(),
          pointB.position
        ]),
        animation: createFlowAnimation()
      }))
    );
  };
  
  // AI添加的粒子轨迹
  const particleTrails = useTrail(data.length, {
    from: { opacity: 0, scale: 0 },
    to: { opacity: 1, scale: 1 },
    config: { tension: 120, friction: 14 }
  });
}`</span>,
      
      <span class="hljs-attr">afternoon</span>: <span class="hljs-string">"性能优化"</span>,
      <span class="hljs-attr">activity</span>: <span class="hljs-string">"AI分析性能瓶颈，建议：InstancedMesh、LOD、GPU拾取"</span>
    },
    
    <span class="hljs-attr">day3</span>: {
      <span class="hljs-attr">allDay</span>: <span class="hljs-string">"润色与交付"</span>,
      <span class="hljs-attr">tasks</span>: [
        <span class="hljs-string">"AI生成使用文档"</span>,
        <span class="hljs-string">"AI创建演示案例"</span>,
        <span class="hljs-string">"我进行最终验收测试"</span>,
        <span class="hljs-string">"部署上线"</span>
      ]
    }
  };
  
  <span class="hljs-comment">// 关键指标对比</span>
  <span class="hljs-keyword">const</span> metricsComparison = {
    <span class="hljs-attr">traditional</span>: {
      <span class="hljs-attr">timeline</span>: <span class="hljs-string">"21天"</span>,
      <span class="hljs-attr">bundleSize</span>: <span class="hljs-string">"1.2MB"</span>,
      <span class="hljs-attr">fps</span>: <span class="hljs-string">"45"</span>,
      <span class="hljs-attr">codeQuality</span>: <span class="hljs-string">"中等"</span>,
      <span class="hljs-attr">creativity</span>: <span class="hljs-string">"有限"</span>
    },
    <span class="hljs-attr">aiAssisted</span>: {
      <span class="hljs-attr">timeline</span>: <span class="hljs-string">"3天"</span>,
      <span class="hljs-attr">bundleSize</span>: <span class="hljs-string">"850KB"</span>,  <span class="hljs-comment">// AI自动tree-shaking</span>
      <span class="hljs-attr">fps</span>: <span class="hljs-string">"60"</span>,           <span class="hljs-comment">// AI优化渲染</span>
      <span class="hljs-attr">codeQuality</span>: <span class="hljs-string">"优秀"</span>,  <span class="hljs-comment">// AI遵循最佳实践</span>
      <span class="hljs-attr">creativity</span>: <span class="hljs-string">"丰富"</span>    <span class="hljs-comment">// 更多创新效果</span>
    }
  };
  
  <span class="hljs-keyword">return</span> { projectTimeline, metricsComparison };
};
</code></pre>
<h3 data-id="heading-12">4.2 案例二：AI发现了我的组件性能黑洞</h3>
<p>一个使用了一年的Table组件，在数据量超过1000行时明显卡顿，我一直以为是虚拟滚动没做好。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 问题组件（我写的，用了1年）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ProblematicTable</span> = (<span class="hljs-params">{ data, columns }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [sortConfig, setSortConfig] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [filteredData, setFilteredData] = <span class="hljs-title function_">useState</span>(data);
  
  <span class="hljs-comment">// 我自以为的优化：useMemo过滤</span>
  <span class="hljs-keyword">const</span> processedData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> result = [...data];
    
    <span class="hljs-comment">// 排序</span>
    <span class="hljs-keyword">if</span> (sortConfig) {
      result.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (a[sortConfig.<span class="hljs-property">key</span>] &lt; b[sortConfig.<span class="hljs-property">key</span>]) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (a[sortConfig.<span class="hljs-property">key</span>] &gt; b[sortConfig.<span class="hljs-property">key</span>]) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      });
    }
    
    <span class="hljs-comment">// 过滤</span>
    result = result.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
      columns.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> 
        <span class="hljs-title class_">String</span>(item[col.<span class="hljs-property">dataIndex</span>]).<span class="hljs-title function_">includes</span>(filterText)
      )
    );
    
    <span class="hljs-keyword">return</span> result;
  }, [data, sortConfig, filterText]); <span class="hljs-comment">// 依赖项</span>
  
  <span class="hljs-comment">// 渲染每一行</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderRow</span> = (<span class="hljs-params">item, index</span>) =&gt; {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>
        {columns.map(col =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{col.key}</span>&gt;</span>
            {col.render ? col.render(item[col.dataIndex], item) : item[col.dataIndex]}
          <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
    );
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
        {processedData.map(renderRow)}  {/* 重新渲染所有行 */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span>
  );
};
</code></pre>
<p><strong>AI分析后的发现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AIPerformanceAnalysis</span> = {
  问题识别: [
    <span class="hljs-string">"1. 全量重新渲染：任何状态变化都重新渲染整个表格"</span>,
    <span class="hljs-string">"2. 重复计算：每次render都重新排序过滤"</span>,
    <span class="hljs-string">"3. 内存泄漏：闭包保留大量数据引用"</span>,
    <span class="hljs-string">"4. 事件监听未清理：排序点击事件"</span>,
    <span class="hljs-string">"5. CSS计算过多：表格布局复杂"</span>
  ],
  
  <span class="hljs-variable constant_">AI</span>建议的解决方案: <span class="hljs-string">`const OptimizedTable = React.memo(({ data, columns }) =&gt; {
  // 1. 使用虚拟滚动
  const { virtualItems, totalHeight } = useVirtual({
    size: data.length,
    estimateSize: useCallback(() =&gt; 50, [])
  });
  
  // 2. 分离排序过滤逻辑
  const [sortConfig, setSortConfig] = useReducer(sortReducer, null);
  const [filters, setFilters] = useReducer(filterReducer, {});
  
  // 3. 使用Web Worker处理大数据
  const processedData = useWebWorker('tableProcessor', {
    data,
    sortConfig,
    filters
  });
  
  // 4. 单元格记忆化
  const MemoizedCell = React.memo(({ value, render }) =&gt; {
    return &lt;td&gt;{render ? render(value) : value}&lt;/td&gt;;
  }, areCellPropsEqual);
  
  // 5. 使用CSS Containment
  const tableStyle = {
    contain: 'strict',  // 告诉浏览器这是独立渲染区域
    contentVisibility: 'auto' // 视口外不渲染
  };
  
  return (
    &lt;div style={{ height: '600px', overflow: 'auto' }}&gt;
      &lt;div style={{ height: totalHeight, position: 'relative' }}&gt;
        {virtualItems.map(virtualRow =&gt; (
          &lt;div
            key={processedData[virtualRow.index].id}
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              width: '100%',
              height: virtualRow.size,
              transform: \`translateY(\${virtualRow.start}px)\`
            }}
          &gt;
            &lt;Row 
              data={processedData[virtualRow.index]}
              columns={columns}
              MemoizedCell={MemoizedCell}
            /&gt;
          &lt;/div&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  );
});`</span>,
  
  优化效果: {
    渲染性能: <span class="hljs-string">"从250ms降到8ms"</span>,
    内存使用: <span class="hljs-string">"减少65%"</span>,
    首次加载: <span class="hljs-string">"从1.2s降到300ms"</span>,
    用户体验: <span class="hljs-string">"滚动丝般顺滑"</span>
  }
};
</code></pre>
<p><strong>最震撼的是</strong>：AI不仅发现了问题，还给出了我从未听说过的优化方案——<strong>CSS Containment</strong>和<strong>content-visibility</strong>属性，这让我这个自诩性能优化的前端感到汗颜。</p>
<h2 data-id="heading-13">第五章：创意大爆炸——AI如何扩展我的设计边界</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bc9387ca20249d198c41b7d6d4c9fd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=csVeyklJszqbl6fh%2F1sDAzTAhfc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">5.1 那些我曾经认为"不可能实现"的效果</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 以前：这个效果太复杂，不做</span>
<span class="hljs-comment">// 现在：AI，实现这个效果</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ImpossibleEffectsNowPossible</span> = (<span class="hljs-params"/>) =&gt; {
  
  <span class="hljs-keyword">const</span> effectsGallery = {
    <span class="hljs-comment">// 1. 流体模拟按钮</span>
    <span class="hljs-attr">fluidButton</span>: {
      描述: <span class="hljs-string">"按钮点击时有水波纹扩散，并有液体粘稠感"</span>,
      <span class="hljs-variable constant_">AI</span>实现: <span class="hljs-string">`const FluidButton = () =&gt; {
  const [ripples, setRipples] = useState([]);
  const canvasRef = useRef(null);
  
  // AI生成的流体模拟
  const simulateFluid = (x, y) =&gt; {
    const particles = [];
    for (let i = 0; i &lt; 50; i++) {
      particles.push({
        x, y,
        vx: (Math.random() - 0.5) * 10,
        vy: (Math.random() - 0.5) * 10 - 5, // 向上
        life: 1.0,
        size: Math.random() * 5 + 2
      });
    }
    return particles;
  };
  
  // AI添加的表面张力效果
  const surfaceTension = (particles) =&gt; {
    particles.forEach(p =&gt; {
      const dy = p.y - centerY;
      p.vy -= dy * 0.1; // 向中心吸引
    });
  };
}`</span>,
      用时: <span class="hljs-string">"15分钟（以前：至少半天研究）"</span>
    },
    
    <span class="hljs-comment">// 2. 3D卡片悬停效果</span>
    <span class="hljs-attr">card3DEffect</span>: {
      描述: <span class="hljs-string">"卡片随鼠标移动有3D透视变化，像真实卡片"</span>,
      <span class="hljs-variable constant_">AI</span>实现: <span class="hljs-string">`const Card3D = () =&gt; {
  const ref = useRef();
  const [rotate, setRotate] = useState({ x: 0, y: 0 });
  
  useFrame(() =&gt; {
    // AI计算的透视变换
    ref.current.style.transform = \`
      perspective(1000px)
      rotateX(\${rotate.x}deg)
      rotateY(\${rotate.y}deg)
      translateZ(\${Math.abs(rotate.y) * 0.5}px)
    \`;
    
    // AI添加的光影效果
    const lightX = rotate.y * 0.5;
    const lightY = -rotate.x * 0.5;
    ref.current.style.boxShadow = \`
      \${lightX}px \${lightY}px 30px rgba(0,0,0,0.3)
    \`;
  });
  
  // AI计算的鼠标跟踪
  const onMouseMove = (e) =&gt; {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = (e.clientX - rect.left) / rect.width;
    const y = (e.clientY - rect.top) / rect.height;
    
    setRotate({
      x: (y - 0.5) * 20, // -10deg to 10deg
      y: (x - 0.5) * 20
    });
  };
}`</span>,
      用时: <span class="hljs-string">"20分钟（以前：需要Three.js，至少1天）"</span>
    },
    
    <span class="hljs-comment">// 3. 手写笔迹动画</span>
    <span class="hljs-attr">handwritingEffect</span>: {
      描述: <span class="hljs-string">"文字像手写一样逐笔画出"</span>,
      <span class="hljs-variable constant_">AI</span>实现: <span class="hljs-string">`const HandwritingText = ({ text }) =&gt; {
  const [pathLength, setPathLength] = useState(0);
  const pathRef = useRef();
  
  useEffect(() =&gt; {
    // AI计算的SVG路径长度
    const length = pathRef.current.getTotalLength();
    
    // AI生成的书法笔迹动画
    const animate = () =&gt; {
      setPathLength(prev =&gt; {
        if (prev &gt;= length) return length;
        return prev + length / 60; // 1秒完成
      });
      requestAnimationFrame(animate);
    };
    
    animate();
  }, []);
  
  return (
    &lt;svg&gt;
      &lt;path
        ref={pathRef}
        d={textToSVGPath(text)} // AI转换文字为SVG路径
        stroke="black"
        strokeWidth="2"
        fill="none"
        strokeDasharray={pathLength}
        strokeDashoffset={pathLength}
        style={{ 
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }}
      /&gt;
    &lt;/svg&gt;
  );
}`</span>,
      用时: <span class="hljs-string">"25分钟（以前：需要专业SVG知识，至少半天）"</span>
    }
  };
  
  <span class="hljs-keyword">return</span> effectsGallery;
};
</code></pre>
<h3 data-id="heading-15">5.2 与AI的创意对话记录</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 一次真实的创意对话</span>
<span class="hljs-keyword">const</span> creativeConversation = [
  {
    角色: <span class="hljs-string">"我"</span>,
    内容: <span class="hljs-string">"需要一个登录页的背景，要科技感但不能太冷"</span>
  },
  {
    角色: <span class="hljs-string">"AI"</span>,
    内容: <span class="hljs-string">"建议：流动的数据网格 + 柔和的粒子光晕"</span>
  },
  {
    角色: <span class="hljs-string">"我"</span>, 
    内容: <span class="hljs-string">"可以，但粒子不要太密集，要像星空"</span>
  },
  {
    角色: <span class="hljs-string">"AI"</span>,
    内容: <span class="hljs-string">"已调整。加了星座连线效果，粒子会缓慢移动"</span>
  },
  {
    角色: <span class="hljs-string">"我"</span>,
    内容: <span class="hljs-string">"太棒了！能再加点交互吗？鼠标移动时粒子有反应"</span>
  },
  {
    角色: <span class="hljs-string">"AI"</span>, 
    内容: <span class="hljs-string">"已添加：鼠标经过时粒子聚集，离开时扩散"</span>
  },
  {
    角色: <span class="hljs-string">"我"</span>,
    内容: <span class="hljs-string">"完美！代码给我看看"</span>
  }
];

<span class="hljs-comment">// 最终生成的代码</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">TechBackground</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// AI生成的科技感背景</span>
  <span class="hljs-comment">// 包含：Canvas粒子系统 + WebGL着色器 + 物理引擎</span>
  <span class="hljs-comment">// 总共300行代码，我自己写可能需要两天</span>
};
</code></pre>
<h2 data-id="heading-16">第六章：2025年的前端日常——一天的真实记录</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cda1795b59a342dcad8915f94f929164~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=72VZXb8m51RYxwmVFBk8t4%2FP4N8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-17">6.1 典型工作日流水账</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 2025年某周三的工作记录</span>
<span class="hljs-attr">date:</span> <span class="hljs-number">2025-09-17</span>
<span class="hljs-attr">weather:</span> <span class="hljs-string">深圳，阵雨，适合室内coding</span>
<span class="hljs-attr">mood:</span> <span class="hljs-string">创意迸发，效率超高</span>

<span class="hljs-attr">schedule:</span>
  <span class="hljs-comment"># 上午：创意实现</span>
  <span class="hljs-attr">09:30-10:00:</span>
    <span class="hljs-attr">activity:</span> <span class="hljs-string">"每日创意站会"</span>
    <span class="hljs-attr">details:</span> <span class="hljs-string">"AI自动展示Dribbble趋势，推荐今日可实现的酷炫效果"</span>
    
  <span class="hljs-attr">10:00-11:00:</span>
    <span class="hljs-attr">activity:</span> <span class="hljs-string">"实现产品经理的疯狂想法"</span>
    <span class="hljs-attr">details:</span> <span class="hljs-string">|
      需求：在数据看板加个"数据河流"可视化
      我的输入："创建一个流动的数据河流，每条支流代表一个数据源，
              流量代表数据量，颜色代表数据类型"
      AI输出：完整的D3.js + Canvas实现
      我的调整：优化移动端体验，降低GPU使用率
</span>      
  <span class="hljs-attr">11:00-12:00:</span>
    <span class="hljs-attr">activity:</span> <span class="hljs-string">"设计系统维护"</span>
    <span class="hljs-attr">details:</span> <span class="hljs-string">|
      AI自动扫描所有组件使用情况
      发现：Button组件的变体太多，建议统一
      AI自动重构：生成新的统一Button组件
      我审核：确认设计一致性
</span>      
  <span class="hljs-comment"># 下午：技术深度工作</span>
  <span class="hljs-attr">14:00-15:00:</span>
    <span class="hljs-attr">activity:</span> <span class="hljs-string">"性能优化专场"</span>
    <span class="hljs-attr">details:</span> <span class="hljs-string">|
      AI分析报告：Landing页LCP从2.1s降到1.3s
      问题：未优化的图片 + 阻塞渲染的JS
      AI自动优化：生成WebP图片，代码分割，预加载
</span>      
  <span class="hljs-attr">15:00-16:30:</span>
    <span class="hljs-attr">activity:</span> <span class="hljs-string">"创新实验时间"</span>
    <span class="hljs-attr">details:</span> <span class="hljs-string">|
      探索：WebGL 2.0的新特性
      AI协助：创建了一个实时水面反射效果
      应用：准备用在下次大促的活动页
</span>      
  <span class="hljs-attr">16:30-17:30:</span>
    <span class="hljs-attr">activity:</span> <span class="hljs-string">"知识沉淀"</span>
    <span class="hljs-attr">details:</span> <span class="hljs-string">|
      AI自动：生成组件使用文档、编写技术博客
      我：添加实战经验和踩坑记录
</span>      
  <span class="hljs-attr">17:30-18:00:</span>
    <span class="hljs-attr">activity:</span> <span class="hljs-string">"明日创意规划"</span>
    <span class="hljs-attr">details:</span> <span class="hljs-string">"AI推荐明日可尝试的3个前沿技术"</span>
</code></pre>
<h3 data-id="heading-18">6.2 量化成果：一年前后的对比</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> yearlyMetrics = {
  <span class="hljs-number">2024</span>: {
    <span class="hljs-attr">linesOfCSS</span>: <span class="hljs-number">25000</span>,           <span class="hljs-comment">// 年写CSS行数</span>
    <span class="hljs-attr">componentsCreated</span>: <span class="hljs-number">45</span>,        <span class="hljs-comment">// 创建组件数</span>
    <span class="hljs-attr">animationsBuilt</span>: <span class="hljs-number">23</span>,          <span class="hljs-comment">// 制作动画数</span>
    <span class="hljs-attr">designToCodeTime</span>: <span class="hljs-string">"平均3天"</span>,   <span class="hljs-comment">// 设计稿到代码时间</span>
    <span class="hljs-attr">performanceScore</span>: <span class="hljs-number">75</span>,         <span class="hljs-comment">// Lighthouse性能分</span>
    <span class="hljs-attr">creativeSatisfaction</span>: <span class="hljs-number">60</span>,     <span class="hljs-comment">// 创意满意度（自评）</span>
    <span class="hljs-attr">overtimeHours</span>: <span class="hljs-number">280</span>,           <span class="hljs-comment">// 加班小时</span>
    <span class="hljs-attr">biggestChallenge</span>: <span class="hljs-string">"实现复杂交互动画"</span>
  },
  
  <span class="hljs-number">2025</span>: {
    <span class="hljs-attr">linesOfCSS</span>: <span class="hljs-number">8000</span>,            <span class="hljs-comment">// 减少了68%</span>
    <span class="hljs-attr">componentsCreated</span>: <span class="hljs-number">120</span>,       <span class="hljs-comment">// 增加了167%</span>
    <span class="hljs-attr">animationsBuilt</span>: <span class="hljs-number">89</span>,          <span class="hljs-comment">// 增加了287%</span>
    <span class="hljs-attr">designToCodeTime</span>: <span class="hljs-string">"平均3小时"</span>,  # 减少了<span class="hljs-number">90</span>%
    <span class="hljs-attr">performanceScore</span>: <span class="hljs-number">95</span>,         <span class="hljs-comment">// 提高了27%</span>
    <span class="hljs-attr">creativeSatisfaction</span>: <span class="hljs-number">92</span>,     <span class="hljs-comment">// 提高了53%</span>
    <span class="hljs-attr">overtimeHours</span>: <span class="hljs-number">40</span>,            <span class="hljs-comment">// 减少了86%</span>
    <span class="hljs-attr">biggestChallenge</span>: <span class="hljs-string">"在众多AI方案中选择最优解"</span>,
    
    <span class="hljs-comment">// 新增指标</span>
    <span class="hljs-attr">interactivePrototypes</span>: <span class="hljs-number">36</span>,    <span class="hljs-comment">// 交互原型数</span>
    <span class="hljs-attr">designSystemContributions</span>: <span class="hljs-number">18</span>, <span class="hljs-comment">// 设计系统贡献</span>
    <span class="hljs-attr">techTalksGiven</span>: <span class="hljs-number">6</span>,            <span class="hljs-comment">// 技术分享次数</span>
    <span class="hljs-attr">openSourceContributions</span>: <span class="hljs-number">4</span>,   <span class="hljs-comment">// 开源贡献</span>
    <span class="hljs-attr">patentsFiled</span>: <span class="hljs-number">1</span>               <span class="hljs-comment">// 设计专利</span>
  }
};

<span class="hljs-comment">// 质量维度变化</span>
<span class="hljs-keyword">const</span> qualityMetrics = {
  <span class="hljs-attr">designSystemConsistency</span>: {
    <span class="hljs-number">2024</span>: <span class="hljs-number">65</span>,  <span class="hljs-comment">// 设计一致性分数</span>
    <span class="hljs-number">2025</span>: <span class="hljs-number">94</span>   <span class="hljs-comment">// AI自动检查</span>
  },
  
  <span class="hljs-attr">accessibilityScore</span>: {
    <span class="hljs-number">2024</span>: <span class="hljs-number">70</span>,  <span class="hljs-comment">// 无障碍评分</span>
    <span class="hljs-number">2025</span>: <span class="hljs-number">98</span>   <span class="hljs-comment">// AI自动添加ARIA</span>
  },
  
  <span class="hljs-attr">crossBrowserCompatibility</span>: {
    <span class="hljs-number">2024</span>: <span class="hljs-number">85</span>,  <span class="hljs-comment">// 跨浏览器兼容性</span>
    <span class="hljs-number">2025</span>: <span class="hljs-number">99</span>   <span class="hljs-comment">// AI自动处理前缀</span>
  },
  
  <span class="hljs-attr">bundleSizePerPage</span>: {
    <span class="hljs-number">2024</span>: <span class="hljs-string">"平均450KB"</span>,
    <span class="hljs-number">2025</span>: <span class="hljs-string">"平均180KB"</span>  <span class="hljs-comment">// AI自动tree-shaking</span>
  }
};
</code></pre>
<h2 data-id="heading-19">第七章：未来的担忧与期待</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b4bef3bf3d14c4c9b31e1f89af37600~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=vGgPUJyw9PCirilxP6L%2BlSMLEmw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-20">7.1 仍然存在的挑战</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ongoingChallenges = {
  <span class="hljs-comment">// 1. AI审美趋同风险</span>
  <span class="hljs-attr">aestheticHomogenization</span>: {
    问题: <span class="hljs-string">"大家都用AI生成UI，网站长得越来越像"</span>,
    现象: <span class="hljs-string">"看到第三个使用同样渐变色+玻璃态效果的网站"</span>,
    担忧: <span class="hljs-string">"前端设计的多样性消失"</span>
  },
  
  <span class="hljs-comment">// 2. 技能空心化</span>
  <span class="hljs-attr">skillHollowing</span>: {
    表现: <span class="hljs-string">"只会描述效果，不会实现原理"</span>,
    风险: <span class="hljs-string">"AI出错时无法手动修复"</span>,
    例子: <span class="hljs-string">"AI生成的Canvas动画崩了，但我不懂WebGL"</span>
  },
  
  <span class="hljs-comment">// 3. 性能与创意的平衡</span>
  <span class="hljs-attr">performanceVsCreativity</span>: {
    困境: <span class="hljs-string">"AI生成的炫酷效果往往性能堪忧"</span>,
    案例: <span class="hljs-string">"满屏粒子效果导致手机发烫"</span>,
    挑战: <span class="hljs-string">"在创意和60fps之间找到平衡"</span>
  },
  
  <span class="hljs-comment">// 4. 设计责任的模糊</span>
  <span class="hljs-attr">designResponsibilityBlur</span>: {
    问题: <span class="hljs-string">"UI出了问题，是前端的责任还是AI的责任？"</span>,
    现状: <span class="hljs-string">"设计稿是AI生成的，代码也是AI写的"</span>,
    困惑: <span class="hljs-string">"我应该审查到什么程度？"</span>
  },
  
  <span class="hljs-comment">// 5. 创作者的失落感</span>
  <span class="hljs-attr">creatorLoss</span>: {
    情感: <span class="hljs-string">"不再有'这是我亲手做的'的成就感"</span>,
    回忆: <span class="hljs-string">"怀念调试CSS一整天终于成功的喜悦"</span>,
    疑问: <span class="hljs-string">"我是在创作，还是在指导AI创作？"</span>
  }
};
</code></pre>
<h3 data-id="heading-21">7.2 我对2026年前端的预测和准备</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> predictions2026 = {
  <span class="hljs-comment">// 技术趋势</span>
  <span class="hljs-attr">techTrends</span>: {
    <span class="hljs-attr">aiFirstDesign</span>: <span class="hljs-string">"设计从AI创意开始，而非从空白画布"</span>,
    <span class="hljs-attr">realTimeCollaboration</span>: <span class="hljs-string">"设计师和AI实时共同设计"</span>,
    <span class="hljs-attr">codeFreeFrontend</span>: <span class="hljs-string">"复杂交互无需手写代码"</span>,
    <span class="hljs-attr">selfOptimizingUI</span>: <span class="hljs-string">"UI根据用户行为自动优化"</span>,
    <span class="hljs-attr">emotionalDesignAI</span>: <span class="hljs-string">"AI理解用户情感并调整UI"</span>
  },
  
  <span class="hljs-comment">// 我的学习计划</span>
  <span class="hljs-attr">learningPlan</span>: {
    <span class="hljs-attr">keepLearning</span>: [
      <span class="hljs-string">"设计原则与用户体验"</span>,
      <span class="hljs-string">"性能优化原理"</span>, 
      <span class="hljs-string">"可访问性深度知识"</span>,
      <span class="hljs-string">"动画物理原理"</span>,
      <span class="hljs-string">"人机交互心理学"</span>
    ],
    
    <span class="hljs-attr">newSkills</span>: [
      <span class="hljs-string">"AI创意指导技巧"</span>,
      <span class="hljs-string">"生成式设计工具"</span>,
      <span class="hljs-string">"实时协作工作流"</span>,
      <span class="hljs-string">"数据可视化艺术"</span>,
      <span class="hljs-string">"交互设计模式"</span>
    ],
    
    <span class="hljs-attr">reduceFocus</span>: [
      <span class="hljs-string">"CSS Hack记忆"</span>,
      <span class="hljs-string">"浏览器兼容性细节"</span>,
      <span class="hljs-string">"构建配置调试"</span>,
      <span class="hljs-string">"重复组件编写"</span>,
      <span class="hljs-string">"基础动画手写"</span>
    ]
  },
  
  <span class="hljs-comment">// 给前端团队的建议</span>
  <span class="hljs-attr">teamAdvice</span>: {
    <span class="hljs-comment">// 建立AI设计编码规范</span>
    <span class="hljs-attr">aiCodingGuidelines</span>: {
      <span class="hljs-attr">reviewProcess</span>: <span class="hljs-string">"所有AI生成的UI必须经过设计审查"</span>,
      <span class="hljs-attr">performanceBudget</span>: <span class="hljs-string">"每个AI组件有明确的性能预算"</span>,
      <span class="hljs-attr">accessibilityStandard</span>: <span class="hljs-string">"AI代码必须通过a11y测试"</span>,
      <span class="hljs-attr">designSystemAlignment</span>: <span class="hljs-string">"必须符合设计系统规范"</span>,
      <span class="hljs-attr">fallbackMechanism</span>: <span class="hljs-string">"必须有AI失效时的手动方案"</span>
    },
    
    <span class="hljs-comment">// 创意与技术的平衡</span>
    <span class="hljs-attr">balanceStrategy</span>: {
      <span class="hljs-number">80_20</span>规则: <span class="hljs-string">"80%的UI用AI生成，20%的核心交互手动优化"</span>,
      创意保留地: <span class="hljs-string">"保留一些完全手动创作的项目"</span>,
      技能保持计划: <span class="hljs-string">"定期进行无AI的编码练习"</span>,
      知识传承: <span class="hljs-string">"老手向新手传授被AI替代的原理知识"</span>
    },
    
    <span class="hljs-comment">// 新的工作流程</span>
    <span class="hljs-attr">newWorkflow</span>: {
      创意阶段: <span class="hljs-string">"人与AI脑暴 -&gt; 快速原型 -&gt; 用户测试"</span>,
      实现阶段: <span class="hljs-string">"AI生成代码 -&gt; 人工优化 -&gt; 性能测试"</span>,
      维护阶段: <span class="hljs-string">"AI监控异常 -&gt; 自动修复 -&gt; 人工确认"</span>
    }
  }
};
</code></pre>
<h2 data-id="heading-22">结语：我重新发现了前端编程的艺术性</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9db07e1f6ab64086941aae6268ec0f4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768647526&amp;x-signature=ps8t9V6%2FgwD1ahSqIB%2FyIOEqWDs%3D" alt="image.png" loading="lazy"/>
十年前，我因为喜欢创造美丽的界面而选择前端。五年前，我因为重复的CRUD和兼容性调试而感到厌倦。一年前，我因为AI的崛起而感到职业危机。今天，我因为人机协作而重新燃起了对前端的热爱。</p>
<p><strong>Vibe Coding不是取代我的创造力，而是将其放大100倍</strong>。我不再被技术实现限制创意，而是可以专注于创意的本质：如何让用户感到愉悦，如何传达信息更有效，如何创造令人难忘的体验。</p>
<blockquote>
<p>我曾经担心AI会让我变成"调参工程师"，但现在我发现：<strong>AI没有夺走我的创意，而是让我的创意能够自由飞翔</strong>。</p>
</blockquote>
<p>我不再花费80%的时间在像素对齐和浏览器兼容上，而是用80%的时间在用户体验设计、交互动效创新和界面情感传达上。我写的CSS更少了，但创造的视觉奇迹更多了。</p>
<p>2025年，我重新爱上了前端开发——以一种能够真正发挥我创造力的方式。</p>
<hr/>
<p><strong>致所有在前端路上的同行者：</strong></p>
<p>如果你也在经历这种转变，我想分享几点体会：</p>
<ol>
<li><strong>把AI当作你的画笔</strong>，而不是替代你的画家</li>
<li><strong>保持对原理的好奇</strong>，AI实现了效果，但你要理解原理</li>
<li><strong>不要放弃审美训练</strong>，AI能做很多，但品味是人类的优势</li>
<li><strong>享受创造的快乐</strong>，无论这创造是通过代码还是通过指导AI</li>
<li><strong>保持人性化的设计</strong>，技术再先进，最终服务的是人</li>
</ol>
<p>十年后，我们会告诉下一代前端工程师："我们经历了从手写CSS到AI生成界面的时代，那是前端创意大爆发的时代。"</p>
<p>而现在，我们正站在这个时代的最前沿。</p>
<p><strong>2026年，让我们继续探索人机共创的界面艺术新边界。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[反重力氛围编程使得开发异常轻松]]></title>    <link>https://juejin.cn/post/7593254419078283304</link>    <guid>https://juejin.cn/post/7593254419078283304</guid>    <pubDate>2026-01-10T09:26:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593254419078283304" data-draft-id="7593258683750498338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="反重力氛围编程使得开发异常轻松"/> <meta itemprop="keywords" content="VibeCoding"/> <meta itemprop="datePublished" content="2026-01-10T09:26:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bytebeats"/> <meta itemprop="url" content="https://juejin.cn/user/463698667655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            反重力氛围编程使得开发异常轻松
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/463698667655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bytebeats
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:26:19.000Z" title="Sat Jan 10 2026 09:26:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">反重力氛围编程: 如何让开发变得轻而易举</h2>
<p>当我提到“反重力”时, 并非指跳过困难部分. 我指的是那种罕见的体验——工作不再沉重. 你坐下来打开代码库, 不再与代码库搏斗, 而是如行云流水般穿梭其中.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d289b528b11f485bb5463c8007ead251~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0ZWJlYXRz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768643671&amp;x-signature=%2BlHStahBhy3LDbj910%2FKKGZD2Ig%3D" alt="" loading="lazy"/></p>
<p>许多人误将这种状态归因于天赋或“进入状态”. 但实践中, 它往往源于几个枯燥却可重复的选择——消除阻力: 清晰的边界, 微小的步进, 快速反馈, 减少上下文切换, 降低意外风险.</p>
<p>所谓氛围编程, 并非懒散意义上的“随心编码”, 而是构建让大脑保持平静的环境, 从而持续产出优质成果. 当环境调校得当, 你既能加速交付, 高效调试, 事后也不觉身心俱疲.</p>
<p>关键在于: 反重力并非情绪状态, 而是可设计的系统.</p>
<h3 data-id="heading-1">构建推动你前进的代码库</h3>
<p>代码沉重感通常源于三种困境: 无法预判故障点, 难以定位代码位置, 修改单项需牵动十项. 这便是重力——它将你拖拽向下.</p>
<p>反重力始于建立信任的结构. 无需完美架构, 只需足够一致性, 让未来的你每次打开文件时不会感到被背叛.</p>
<p>以下实用模式能创造这种“向前拉力”:</p>
<ul>
<li><strong>明确归属地</strong>.  若三个文件夹名称都可能包含相同逻辑, 你已制造了认知负担. 选定规范并坚持到底.</li>
<li><strong>微小模块配醒目标签</strong>.   名为<code>handleUser</code>的函数含糊不清, 而<code>refreshSessionTokenIfExpired</code>则无需阅读代码就能直观传达功能.</li>
<li><strong>减少“聪明”捷径</strong>.   精妙的抽象设计今日令人称道, 两周后却成诅咒. 反重力法则推崇枯燥的清晰.</li>
<li><strong>杜绝接口泄露</strong>.  若每个组件都需知晓其他组件的内部细节, 摩擦必将产生. 用清晰的边界隐藏混乱.</li>
<li><strong>清除“神秘肉”</strong>.  关键代码即使冗长也需可读. 将巧妙留给可隔离且经过测试的场景.</li>
</ul>
<p>这无关美学, 关乎势能. 当代码可预测时, 行动便充满信心. 信心比怀疑更轻盈, 而怀疑才是真正的重负.</p>
<h3 data-id="heading-2">氛围循环: 小胜利, 快反馈, 零戏剧</h3>
<p>杀死编程氛围最快的方式, 就是陷入漫长迷雾般的循环: 修改大量代码→运行巨型构建→某处出错→开始捉鬼. 这如同徒手推车上坡.</p>
<p>反重力编程恰恰相反: 微小操作, 即时反馈, 即时回报. 这种循环令人上瘾, 却充满正向能量.</p>
<p>具体实践如下:</p>
<ul>
<li>每次变更保持<strong>极小规模</strong>, 确保回滚毫无痛感</li>
<li>测试或预览<strong>持续进行</strong>, 而非“留到最后”</li>
<li>将错误视为信号而非侮辱</li>
<li>每次结束工作时为后续操作留下面包屑</li>
</ul>
<p>若要归纳成简单法则: <em>永远别让大脑同时处理太多未知</em>. 未知是沉重的负担, 每个未知都像块砝码.</p>
<p>所以与其说“我要重构整个模块”, 不如这样做:</p>
<ul>
<li>重命名函数. 运行.</li>
<li>提取一个辅助函数. 运行.</li>
<li>添加一个测试. 运行.</li>
<li>移除一个依赖项. 运行.</li>
</ul>
<p>两个中等步骤, 接着一个较长步骤, 再回归中等节奏. 这种韵律至关重要. 它能防止你精疲力竭, 保持专注力完整.</p>
<h3 data-id="heading-3">保持魔力不失的调试之道</h3>
<p>调试往往是编程灵感消亡之地. 并非调试本身困难, 而是它会制造情绪噪音. 你开始盲目修改代码, 思维变得混乱, 陷入被动应对的状态.</p>
<p>反重力调试则更为沉静. 它近乎枯燥, 而这正是关键所在.</p>
<p>冷静的调试流程如下:</p>
<ol>
<li><strong>使错误可复现</strong>.  若无法复现问题, 你就是在碰运气.</li>
<li><strong>缩小故障范围</strong>.  逐步剥离场景, 直至只剩下最小的故障单元.</li>
<li><strong>增强可视性</strong>.  日志, 跟踪, 断点, 手段不限. 但务必有意识地实施.</li>
<li><strong>每次只改变一个变量</strong>.  像做实验室实验而非拳击赛般严谨操作.</li>
<li><strong>记录假设</strong>.   哪怕只有一行. 这能让你保持清醒.</li>
</ol>
<p>思维转变至关重要: 系统崩溃并非“失败”, 而是证据收集. 这种心态能保持团队活力.</p>
<p>修复后, 执行最终的反重力操作: <strong>锁定胜利</strong>. 添加测试用例, 保护机制或清晰的错误提示. 未来的你会立刻感受到差异.</p>
<h3 data-id="heading-4">无重力般地交付</h3>
<p>交付是反重力的终极形态. 目标并非无休止打磨, 而是让作品进入世界时不沦为压力事件.</p>
<p>这正是许多开发者陷入困境之处, 尤其在加密领域——环境喧嚣, 一切都显得高风险. 但所谓“高风险”往往只是“高不确定性”的代名词.</p>
<p>因此实现轻量化交付的关键在于降低不确定性:</p>
<ul>
<li><strong>功能开关胜过大规模发布</strong>.  先低调上线, 再逐步启用.</li>
<li><strong>增量发布</strong>.   不必等待“完美版本”.</li>
<li><strong>默认启用可观测性</strong>.   指标, 日志, 基础警报. 你不需要NASA级别的系统, 你需要的是眼睛.</li>
<li><strong>部署前制定回滚方案</strong>.   知道退路在哪里, 才能更从容地迈步向前.</li>
<li><strong>明确沟通范围</strong>.   声明“这是V1版本, 实现X功能而非Y功能”, 可避免陷入混乱.</li>
</ul>
<p>尤其在加密产品领域, 反重力发布是生存技能. 市场瞬息万变, 用户耐心有限, 漏洞会被放大. 若每次发布都像悬崖跳跃, 终将导致团队回避发布——而最终仍会失败.</p>
<p>奇怪的真相是: 最轻量级的团队并非人才最密集的团队, 而是那些将想法与现实之间摩擦降到最低的团队.</p>
<p>好吧, 今天的内容就分享到这里啦!</p>
<p>一家之言, 欢迎拍砖!</p>
<p>Happy coding! Stay GOLDEN!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[打造 AI 驱动的 Git 提交规范助手：基于 React + Express + Ollama+langchain 的全栈实践]]></title>    <link>https://juejin.cn/post/7593198957984514089</link>    <guid>https://juejin.cn/post/7593198957984514089</guid>    <pubDate>2026-01-10T08:50:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593198957984514089" data-draft-id="7593215107406331940" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="打造 AI 驱动的 Git 提交规范助手：基于 React + Express + Ollama+langchain 的全栈实践"/> <meta itemprop="keywords" content="全栈,Ollama,LangChain"/> <meta itemprop="datePublished" content="2026-01-10T08:50:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ohyeah"/> <meta itemprop="url" content="https://juejin.cn/user/740446536480618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            打造 AI 驱动的 Git 提交规范助手：基于 React + Express + Ollama+langchain 的全栈实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740446536480618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ohyeah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T08:50:18.000Z" title="Sat Jan 10 2026 08:50:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代软件开发中，<strong>高质量的 Git 提交信息</strong>不仅是团队协作的基础，更是项目可维护性、可追溯性和工程文化的重要体现。然而，许多开发者（尤其是初学者）常常忽略提交信息的规范性，导致提交日志混乱、难以理解，甚至影响 Code Review 和故障排查效率。</p>
<p>为了解决这一痛点，本文将带你从零构建一个 <strong>AI 驱动的 Git 提交规范助手 —— git-differ</strong>。该项目结合了前端（React + Tailwind CSS + Axios）、后端（Node.js + Express）以及本地大模型（Ollama + DeepSeek-R1:8B），通过分析 <code>git diff</code> 内容，自动生成符合 Conventional Commits 规范的提交信息。</p>
<p>我们将深入剖析项目的代码结构、技术选型与关键知识点，并围绕 <strong>跨域处理、LangChain 集成、自定义 React Hook 封装、Express 路由设计</strong> 等核心内容展开详细讲解。</p>
<hr/>
<h2 data-id="heading-0">一、项目整体架构与技术栈</h2>
<p><code>git-differ</code> 是一个典型的前后端分离全栈应用：</p>
<ul>
<li><strong>前端</strong>：运行于浏览器（如 <code>http://localhost:5173</code>），使用 React 构建 UI，Tailwind CSS 实现响应式样式，Axios 发起 HTTP 请求。</li>
<li><strong>后端</strong>：运行于 Node.js 环境（<code>http://localhost:3000</code>），基于 Express 框架提供 RESTful API。</li>
<li><strong>AI 引擎</strong>：本地部署 Ollama 服务（<code>http://localhost:11434</code>），加载开源大模型 <code>deepseek-r1:8b</code>，通过 LangChain 进行提示工程与输出解析。</li>
</ul>
<p>整个数据流如下：</p>
<pre><code class="hljs language-bash" lang="bash">用户输入 git diff → 前端发送 POST /chat → 后端接收并调用 Ollama → AI 生成 commit message → 返回前端展示
</code></pre>
<p>这种架构不仅解耦清晰，还便于后续扩展（如支持多模型、历史记录、配置管理等）。</p>
<hr/>
<h2 data-id="heading-1">二、前端实现：React + 自定义 Hook + Axios 模块化</h2>
<h3 data-id="heading-2">1. 主组件 <code>App.jsx</code>：UI 与逻辑分离</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { chat } <span class="hljs-keyword">from</span> <span class="hljs-string">'./api/axios'</span>
<span class="hljs-keyword">import</span> { useGitDiff } <span class="hljs-keyword">from</span> <span class="hljs-string">"./hooks/useGitDiff"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">const</span> { loading, content } = <span class="hljs-title function_">useGitDiff</span>(<span class="hljs-string">'hello'</span>)

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex"</span>&gt;</span>
      {loading ? 'loading...' : content}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>主组件极其简洁，仅负责渲染状态。真正的业务逻辑被封装在 <code>useGitDiff</code> 自定义 Hook 中，体现了 <strong>“组件只负责 UI”</strong> 的最佳实践。</p>
<blockquote>
<p>“use开头 封装响应式业务 副作用等 从组件里面剥离 组件只负责UI”</p>
</blockquote>
<p>这种模式极大提升了代码的可读性与复用性。未来若需在多个页面使用 AI 生成 commit message 功能，只需调用 <code>useGitDiff</code> 即可。</p>
<hr/>
<h3 data-id="heading-3">2. API 层：Axios 模块化封装</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/api/axios.js</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-comment">// 创建axios实例 统一进行配置</span>
<span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://localhost:3000'</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
  },
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">60000</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">chat</span> = (<span class="hljs-params">message</span>) =&gt; {
  <span class="hljs-keyword">return</span> service.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/chat'</span>, {
    message
  })
}
</code></pre>
<p>这里通过 <code>axios.create()</code> 创建了一个 <strong>专用的 HTTP 客户端实例</strong>，统一配置：</p>
<ul>
<li><code>baseURL</code>：避免在每个请求中重复写后端地址；</li>
<li><code>headers</code>：确保请求体为 JSON 格式；</li>
<li><code>timeout</code>：设置超时时间，防止请求卡死。</li>
</ul>
<blockquote>
<p>“模块化 在api目录下管理所有的请求”</p>
</blockquote>
<p>封装了api请求，在其他组件(如：useGitDiff.js)中只需要模块化导入<code>chat</code> 即可以发起请求，这种组织方式是大型 React 项目的标准做法，便于维护和测试。</p>
<hr/>
<h3 data-id="heading-4">3. 自定义 Hook：<code>useGitDiff</code> —— 封装副作用与状态</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// src/hooks/useGitDiff.js</span>
import { useState, useEffect } from "react"
import { chat } from "../api/axios"

export const useGitDiff = (diff) =&gt; {
  const <span class="hljs-selector-attr">[content, setContent]</span> = <span class="hljs-built_in">useState</span>('')
  const <span class="hljs-selector-attr">[loading, setLoading]</span> = <span class="hljs-built_in">useState</span>(false)

  <span class="hljs-built_in">useEffect</span>(() =&gt; {
    (async () =&gt; {
      <span class="hljs-built_in">if</span>(!diff) return 
      <span class="hljs-built_in">setLoading</span>(true)
      const { data } = await <span class="hljs-built_in">chat</span>(diff)
      <span class="hljs-built_in">setContent</span>(data.reply)
      <span class="hljs-built_in">setLoading</span>(false)
    })()
    <span class="hljs-comment">// 立即执行异步函数  避免顶层async</span>
  }, <span class="hljs-selector-attr">[diff]</span>)

<span class="hljs-comment">// 将外部需要的loading状态和content内容 return</span>
  return {
    loading, <span class="hljs-comment">// 加载状态 用户体验</span>
    <span class="hljs-attribute">content</span> <span class="hljs-comment">// llm得出的commit message</span>
  }
}
</code></pre>
<p>该 Hook 接收 <code>diff</code> 字符串作为依赖，当其变化时自动发起请求。关键点包括：</p>
<ul>
<li>使用 <strong>立即执行异步函数（IIFE）</strong> 在 <code>useEffect</code> 中处理异步逻辑；</li>
<li>通过 <code>setLoading</code> 提供加载状态反馈；</li>
<li>依赖数组 <code>[diff]</code> 确保只在 <code>diff</code> 变化时触发请求；</li>
<li>返回结构化对象，便于解构使用。</li>
</ul>
<blockquote>
<p>“通过立即执行函数 执行异步函数”</p>
</blockquote>
<p>这种写法规避了 <code>useEffect</code> 的回调函数不能直接使用 <code>async/await</code> 的限制。</p>
<hr/>
<h2 data-id="heading-5">三、后端实现：从零构建一个健壮的 Express AI 服务</h2>
<p>后端是整个 <code>git-differ</code> 项目的中枢神经。它不仅要接收前端请求、调用本地大模型，还需保证<strong>安全性、稳定性、可维护性与协议规范性</strong>。以下我们将结合完整代码，逐层剖析其技术内涵。</p>
<h3 data-id="heading-6">1. 基础服务初始化：Express 应用骨架</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">'cors'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'server is running on port 3000'</span>)
})
</code></pre>
<p>这段看似简单的代码，实际上完成了现代 Web API 服务的三大基础配置：</p>
<h4 data-id="heading-7">✅ <code>express()</code>：创建应用实例</h4>
<ul>
<li>Express 是 Node.js 生态中最流行的 Web 框架，其核心思想是 <strong>“中间件管道”</strong> 。</li>
<li><code>app</code> 是一个可配置、可扩展的 HTTP 服务器容器，后续所有路由、中间件都挂载于此。</li>
</ul>
<h4 data-id="heading-8">✅ <code>app.use(express.json())</code>：请求体解析中间件</h4>
<ul>
<li>默认情况下，Express <strong>不会自动解析请求体</strong>（<code>req.body</code> 为 <code>undefined</code>）。</li>
<li><code>express.json()</code> 是一个内置中间件，用于解析 <code>Content-Type: application/json</code> 的请求体，并将其转换为 JavaScript 对象。</li>
<li>若省略此中间件，<code>req.body</code> 将无法获取前端发送的 <code>{ message: "..." }</code> 数据，导致后续逻辑失败。</li>
</ul>
<blockquote>
<p>💡 <strong>最佳实践</strong>：应在所有路由定义<strong>之前</strong>注册全局中间件，确保所有请求都能被正确解析。</p>
</blockquote>
<h4 data-id="heading-9">✅ <code>app.use(cors())</code>：跨域资源共享（CORS）支持</h4>
<ul>
<li>
<p>前端开发服务器（如 Vite，默认端口 5173）与后端（3000）构成<strong>跨域请求</strong>（协议、域名或端口不同）。</p>
</li>
<li>
<p>浏览器出于安全考虑，会拦截跨域请求的响应，除非服务器明确允许。</p>
</li>
<li>
<p><code>cors()</code> 中间件自动处理 OPTIONS 预检请求，并在响应头中添加：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Access-Control-Allow-Origin: *</span>
<span class="hljs-section">Access-Control-Allow-Methods: GET,HEAD,PUT,PATCH,POST,DELETE</span>
<span class="hljs-section">Access-Control-Allow-Headers: Content-Type</span>
</code></pre>
</li>
<li>
<p>在生产环境中，应限制 <code>origin</code> 为可信域名（如 <code>origin: ['https://your-app.com']</code>），避免开放全站跨域。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-10">2. 路由设计：RESTful API 与 HTTP 语义</h3>
<pre><code class="hljs language-dart" lang="dart">app.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/hello'</span>, (req, res) =&gt; {
  res.send(<span class="hljs-string">'hello world'</span>)
})

app.post(<span class="hljs-string">'/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-comment">// ... 业务逻辑</span>
})
</code></pre>
<h4 data-id="heading-11">📌 路由方法与资源操作语义</h4>
<ul>
<li>
<p><code>GET /hello</code>：用于健康检查或简单测试，无副作用，符合幂等性。</p>
</li>
<li>
<p><code>POST /chat</code>：用于提交 <code>git diff</code> 内容并获取 AI 生成结果。使用 POST 是因为：
请求包含<strong>复杂数据体</strong>（diff 文本可能很长）；</p>
</li>
</ul>
<h4 data-id="heading-12">📌 请求与响应对象（<code>req</code> / <code>res</code>）</h4>
<ul>
<li><code>req.body</code>：由 <code>express.json()</code> 解析后的请求体数据；</li>
<li><code>res.status(code).json(data)</code>：设置 HTTP 状态码并返回 JSON 响应；</li>
<li><code>res.send()</code>：返回纯文本（不推荐用于 API，应统一使用 JSON）。</li>
</ul>
<hr/>
<h3 data-id="heading-13">3. 输入验证：防御性编程的第一道防线</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> { message } = req.<span class="hljs-function">body
<span class="hljs-title">if</span> (<span class="hljs-params">!message || <span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">'string'</span></span>)</span> {
  <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">400</span>).json({
    error: <span class="hljs-string">'message 必填，必须是字符串'</span>
  })
}
</code></pre>
<ul>
<li>
<p><strong>永远不要信任客户端输入,后端稳定性 是第一位</strong>。即使前端做了校验，后端也必须二次验证。</p>
</li>
<li>
<p>此处检查：</p>
<ul>
<li><code>message</code> 是否存在（防止 <code>null</code>、<code>undefined</code>）；</li>
<li>类型是否为字符串（防止传入对象、数组等非法类型）。</li>
</ul>
</li>
<li>
<p>返回 <strong>400 Bad Request</strong> 状态码，明确告知客户端请求格式错误。</p>
</li>
<li>
<p>错误信息清晰具体，便于前端调试。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-14">4. AI 集成：LangChain 链式调用与错误隔离</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOllama</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/ollama'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatPromptTemplate</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/core/prompts'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StringOutputParser</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/core/output_parsers'</span>

<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOllama</span>({
  <span class="hljs-attr">baseUrl</span>: <span class="hljs-string">'http://localhost:11434'</span>,
  <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-r1:8b'</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.1</span> <span class="hljs-comment">// </span>
})
</code></pre>
<h4 data-id="heading-15">🔗 LangChain 核心抽象：链（Chain）</h4>
<p>LangChain 的核心思想是将 LLM 调用过程<strong>模块化、可组合</strong>。本项目使用了典型的三段式链：</p>
<ol>
<li>
<p><strong>Prompt Template</strong>：结构化输入</p>
<pre><code class="hljs language-css" lang="css">const prompt = ChatPromptTemplate<span class="hljs-selector-class">.fromMessages</span>(<span class="hljs-selector-attr">[  [<span class="hljs-string">'system'</span>, `你是一个专业的 Git 提交信息生成器。请根据以下 git diff 内容，生成一条简洁、符合 Conventional Commits 规范的 commit message。不要解释，只输出 commit message`]</span>,
  <span class="hljs-selector-attr">[<span class="hljs-string">'human'</span>, <span class="hljs-string">'{input}'</span>]</span>
])
</code></pre>
<ul>
<li>将原始 <code>message</code> 注入到预设对话模板中；</li>
<li>支持多轮对话上下文（未来可扩展）；</li>
<li>确保提示词格式符合模型预期。</li>
</ul>
</li>
<li>
<p><strong>Model</strong>：大模型调用</p>
<ul>
<li><code>ChatOllama</code> 是 LangChain 对 Ollama API 的封装；</li>
<li><code>baseUrl</code> 指向本地 Ollama 服务；</li>
<li><code>temperature: 0.1</code> 降低随机性，使输出更确定（适合生成规范文本）。</li>
</ul>
</li>
<li>
<p><strong>Output Parser</strong>：标准化输出</p>
<pre><code class="hljs language-scss" lang="scss">new <span class="hljs-built_in">StringOutputParser</span>()
</code></pre>
<ul>
<li>强制将模型返回的复杂对象（如 <code>{ content: "...", role: "assistant" }</code>）转换为纯字符串；</li>
<li>避免前端处理不必要的元数据；</li>
<li>保证 API 响应结构稳定：<code>{ reply: "string" }</code>。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-16">⚠️ 错误处理：隔离 AI 不稳定性</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">result</span> = await chain.<span class="hljs-title function_ invoke__">invoke</span>({ <span class="hljs-attr">input</span>: message })
  res.<span class="hljs-title function_ invoke__">json</span>({ <span class="hljs-attr">reply</span>: result })
} <span class="hljs-keyword">catch</span> (err) {
  res.<span class="hljs-title function_ invoke__">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_ invoke__">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'调用大模型失败'</span> })
}
</code></pre>
<ul>
<li>大模型调用可能因网络、内存、模型加载失败等原因抛出异常；</li>
<li>使用 <code>try/catch</code> 捕获所有同步/异步错误；</li>
<li>返回 <strong>500 Internal Server Error</strong>，避免服务崩溃；</li>
</ul>
<hr/>
<h3 data-id="heading-17">5. 工程化考量：可维护性与可观测性</h3>
<ul>
<li><strong>日志记录</strong>：<code>console.log('正在调用大模型')</code> 提供基本执行追踪；</li>
<li><strong>超时控制</strong>：虽未显式设置，但 Ollama 客户端和 Axios 均有默认超时；</li>
<li><strong>依赖解耦</strong>：AI 逻辑封装在路由内，未来可提取为独立 service 层；</li>
</ul>
<hr/>
<h3 data-id="heading-18">总结：一个合格的后端 API 应具备什么？</h3>

































<table><thead><tr><th>维度</th><th>本项目实现</th></tr></thead><tbody><tr><td><strong>协议合规</strong></td><td>正确使用 HTTP 方法、状态码、Content-Type</td></tr><tr><td><strong>输入安全</strong></td><td>严格校验请求体格式与类型</td></tr><tr><td><strong>错误处理</strong></td><td>区分客户端错误（4xx）与服务端错误（5xx）</td></tr><tr><td><strong>跨域支持</strong></td><td>通过 CORS 中间件解决开发跨域问题</td></tr><tr><td><strong>AI 集成</strong></td><td>使用 LangChain 实现可维护的提示工程</td></tr><tr><td><strong>可扩展性</strong></td><td>模块化结构，便于未来增加新功能</td></tr></tbody></table>
<p>这才是一个面向生产、面向读者的后端实现应有的深度与广度。</p>
<hr/>
<h2 data-id="heading-19">四、AI 部分：Ollama 与本地大模型部署</h2>
<h3 data-id="heading-20">1. 为什么选择 Ollama？</h3>
<ul>
<li>开源、轻量、支持多种模型（Llama,  DeepSeek 等）；</li>
<li>提供类 OpenAI 的 API 接口（<code>/api/chat</code>），便于集成；</li>
<li>可在消费级 GPU 或 CPU 上运行（需足够内存）。</li>
</ul>
<h3 data-id="heading-21">2. 模型选择：<code>deepseek-r1:8b</code></h3>
<ul>
<li>
<p><code>r1</code> 表示 Reasoning 版本，推理能力更强；</p>
</li>
<li>
<p><code>8b</code> 为 80 亿参数，平衡性能与资源消耗；</p>
</li>
<li>
<p>需通过命令下载：</p>
<pre><code class="hljs language-arduino" lang="arduino">ollama pull deepseek-r1:<span class="hljs-number">8b</span>
ollama run deepseek-r1:<span class="hljs-number">8b</span>  # 测试
</code></pre>
</li>
</ul>
<blockquote>
<p>“ollama帮助我们像openai一样的api 接口 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A11434%25E2%2580%259D%2F" target="_blank" title="http://localhost:11434%E2%80%9D/" ref="nofollow noopener noreferrer">http://localhost:11434”</a></p>
</blockquote>
<h3 data-id="heading-22">3. 性能提示</h3>
<ul>
<li>首次加载模型较慢（需加载到内存）；</li>
<li><code>temperature: 0.1</code> 降低随机性，使输出更确定、规范；</li>
<li>若响应慢，可考虑量化版本（如 <code>q4_K_M</code>）。</li>
</ul>
<hr/>
<h2 data-id="heading-23">五、总结</h2>
<p>通过 <code>git-differ</code> 项目，我们完整实践了一个 <strong>AI 增强型开发者工具</strong> 的全栈开发流程：</p>
<ul>
<li>前端：React 自定义 Hook + Axios 模块化；</li>
<li>后端：Express 路由 + CORS + 错误处理；</li>
<li>AI：Ollama + LangChain 提示工程 + 输出解析。</li>
</ul>
<p>这不仅解决了“如何写好 Git 提交信息”的实际问题，更展示了 <strong>本地大模型在开发者工具链中的落地场景</strong>。随着开源模型能力不断提升，类似工具将极大提升个人与团队的开发效率与代码质量。</p>
<blockquote>
<p>最终目标：让新手也能像高手一样，写出清晰、规范、有价值的 Git 提交记录。</p>
</blockquote>
<hr/>
<p>现在，启动你的 AI Git 助手，让每一次提交都成为工程艺术的一部分！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端面试必问 asyncawait 到底要不要加 trycatch 90% 人踩坑 求职加分技巧揭秘]]></title>    <link>https://juejin.cn/post/7593215107406610468</link>    <guid>https://juejin.cn/post/7593215107406610468</guid>    <pubDate>2026-01-10T08:56:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593215107406610468" data-draft-id="7593241698369945636" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端面试必问 asyncawait 到底要不要加 trycatch 90% 人踩坑 求职加分技巧揭秘"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-10T08:56:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="海云前端1"/> <meta itemprop="url" content="https://juejin.cn/user/963618991244365"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端面试必问 asyncawait 到底要不要加 trycatch 90% 人踩坑 求职加分技巧揭秘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/963618991244365/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    海云前端1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T08:56:11.000Z" title="Sat Jan 10 2026 08:56:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>现在写前端异步代码 基本离不开 Promise 和 asyncawait</strong></p>
<p>相比之下 asyncawait 写起来更像同步代码 读起来更顺畅 被很多开发者称为异步编程的终极方案</p>
<p><strong>但有个让新手纠结不已的问题 用 asyncawait 时到底要不要加 trycatch 捕获错误</strong></p>
<p>看了不少项目代码 有人全程加有人完全不加 还有人用 catch 链式调用 各种写法让人眼花缭乱 更关键的是 这也是前端面试高频考点 很多求职者因为说不清楚其中逻辑 直接错失 offer</p>
<p>今天这篇文章 不光把三种常见写法拆解得明明白白 告诉你不同场景该怎么选 还会揭秘面试官考察这个问题的核心逻辑</p>
<h2 data-id="heading-0">一 三种常见写法 优缺点一眼看清</h2>
<p>先看最常用的三种写法 各自的适用场景和坑都给你列好了 面试时直接举例就能加分</p>
<h3 data-id="heading-1">1 稳妥写法 trycatch 包裹</h3>
<p>这是最规范的写法 把 await 调用的异步代码放在 try 块里 错误统一在 catch 里处理</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserInfo</span> () {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">reject</span>(请求出错了哦)
        }, <span class="hljs-number">1000</span>)
    })
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">logined</span> () {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">let</span> userInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserInfo</span>()
        <span class="hljs-comment">// 一旦上面出错 下面代码不会执行</span>
        <span class="hljs-keyword">let</span> pageInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPageInfo</span>(userInfo?.<span class="hljs-property">userId</span>)
    } <span class="hljs-keyword">catch</span>(e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(抓到一个错误, e)
    }
}

<span class="hljs-title function_">logined</span>()
</code></pre>
<p>优点很明显 错误能精准捕获 而且代码会在出错位置直接停止 不会引发后续连锁问题 缺点就是看起来有点啰嗦 每个异步逻辑都这么写 会多几行代码</p>
<h3 data-id="heading-2">2 简洁写法 直接接 catch 链式调用</h3>
<p>不想写 trycatch 的话 可以在 await 后面直接加 catch 方法 捕获当前异步操作的错误</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserInfo</span> () {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">reject</span>(请求出错了哦)
        }, <span class="hljs-number">1000</span>)
    })
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">logined</span> () {
    <span class="hljs-keyword">let</span> userInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserInfo</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(抓到一个错误, e))
    <span class="hljs-comment">// 注意 出错后代码还会继续执行</span>
    <span class="hljs-keyword">if</span> (!userInfo) <span class="hljs-keyword">return</span> <span class="hljs-comment">// 必须手动判断是否获取成功</span>
    <span class="hljs-keyword">let</span> pageInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPageInfo</span>(userInfo?.<span class="hljs-property">userId</span>)
}

<span class="hljs-title function_">logined</span>()
</code></pre>
<p>这种写法更简洁 不用额外包裹代码 但有个关键坑 即使前面异步操作失败 程序也不会自动停止 会继续执行后面的代码 所以必须手动检查返回值是否有效 否则可能出现空值报错</p>
<h3 data-id="heading-3">3 中断写法 catch 里二次 reject</h3>
<p>想让程序出错后停止 又不想用 trycatch 可以在 catch 里把错误再次 reject 出去</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserInfo</span> () {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">reject</span>(请求出错了哦)
        }, <span class="hljs-number">1000</span>)
    })
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">logined</span> () {
    <span class="hljs-keyword">let</span> userInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserInfo</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(抓到一个错误, e)
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(e) <span class="hljs-comment">// 再次抛出错误</span>
    })
    <span class="hljs-comment">// 代码会在这里停止 不再往下执行</span>
    <span class="hljs-keyword">let</span> pageInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPageInfo</span>(userInfo?.<span class="hljs-property">userId</span>)
}

<span class="hljs-title function_">logined</span>()
</code></pre>
<p>这种写法能实现错误中断的效果 但有个小问题 控制台会出现 uncaught in promise 的错误提示 虽然不影响功能 但显得不够规范 面试时要能说清这个细节</p>
<h2 data-id="heading-4">二 核心判断逻辑 到底该怎么选</h2>
<p>其实真实项目中 我们很少直接用原生 Promise 发请求 大多会用 axios 或 fetch 而且通常会对这些请求库做一层封装 统一处理错误状态码 超时提示等</p>
<p>至于 await 后面要不要加 trycatch 核心判断标准就一个 你是否想让程序在出错时停止执行</p>
<h3 data-id="heading-5">场景 1 不想中断程序 允许后续逻辑继续执行</h3>
<p>比如获取非核心数据 即使失败也不影响页面主要功能 可以用 catch 链式调用 再手动判断返回值</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-scss" lang="scss">let userInfo = await <span class="hljs-built_in">getUserInfo</span>()<span class="hljs-selector-class">.catch</span>(e =&gt; console.warn(e))
if (!userInfo) return <span class="hljs-comment">// 终止当前函数 但不影响其他代码</span>
<span class="hljs-comment">// 后续非依赖逻辑可以继续执行</span>
<span class="hljs-built_in">renderDefaultInfo</span>()
</code></pre>
<p>这种写法控制台不会出现红字错误 用户体验更友好</p>
<h3 data-id="heading-6">场景 2 想中断程序 避免错误扩散</h3>
<p>比如登录请求 必须获取用户信息后才能继续 一旦失败就该停止后续操作 这时 trycatch 是最佳选择</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-scss" lang="scss">try {
    let userInfo = await <span class="hljs-built_in">getUserInfo</span>()
    let pageInfo = await <span class="hljs-built_in">getPageInfo</span>(userInfo?.userId)
    <span class="hljs-comment">// 依赖用户信息的核心逻辑</span>
} <span class="hljs-built_in">catch</span>(e) {
    console<span class="hljs-selector-class">.warn</span>(e)
    <span class="hljs-comment">// 可以在这里添加错误提示 比如弹窗告知用户</span>
    <span class="hljs-built_in">showErrorToast</span>(获取信息失败 请重试)
}
</code></pre>
<p>错误处理集中在一个地方 便于管理和维护 代码逻辑也更清晰</p>
<h3 data-id="heading-7">场景 3 想中断程序 不介意控制台报错</h3>
<p>如果是内部工具类或非用户 - facing 的功能 可以用 catch 二次 reject 的写法 虽然控制台会有报错提示 但能快速定位问题 不过这种写法在面试中不推荐作为首选 除非能说清适用场景和优缺点</p>
<h2 data-id="heading-8">三 面试加分建议 推荐这样写</h2>
<p>结合项目实操和面试得分点 个人最推荐 trycatch 的写法 原因有四点1 代码逻辑更清晰 符合同步代码的直觉 出错就停止 容易理解和维护2 错误处理集中 所有异常都在 catch 块里统一处理 不用分散在各个链式调用中3 控制台不会出现多余的 uncaught 错误提示 代码更规范 显得专业4 风格统一 既然用 asyncawait 追求同步写法的简洁 搭配 trycatch 能保持代码风格一致</p>
<p>虽然多了几行代码 但比起可读性和可维护性 这点代价完全值得 面试时说清这个权衡思路 能体现你的工程化思维</p>
<h2 data-id="heading-9">四 面试官真正想考的 不只是写法</h2>
<p>这道题表面考错误处理写法 实际考察三个核心能力 面试时要针对性回应1 对异步编程原理的理解 是否清楚 Promise 和 asyncawait 的错误传递机制2 场景化思维 是否能根据不同业务场景选择合适的错误处理方式3 代码规范和可维护性意识 是否考虑到后续开发和排查问题的便捷性</p>
<p>面试时可以按这个逻辑组织语言 先说明三种写法的区别 再讲核心判断标准 最后给出推荐方案和理由 比如asyncawait 的错误处理有三种常见方式 分别是 trycatch 包裹 catch 链式调用 以及 catch 中二次 reject 选择哪种主要看是否需要中断程序 核心业务比如登录 必须获取结果后才能继续 推荐用 trycatch 能集中处理错误并避免扩散 非核心业务比如获取推荐列表 可以用 catch 链式调用 不中断后续逻辑 个人更推荐 trycatch 因为代码规范 错误处理集中 更利于维护</p>
<p>这样回答 既展示了技术功底 又体现了场景化思维 面试官会觉得你不仅会写代码 还懂怎么写好代码</p>
<h2 data-id="heading-10">五 求职福利 这道题答好 offer 稳一半</h2>
<p>很多前端求职者技术不错 却栽在这种基础考点上 不是不会写 而是不会提炼核心逻辑 不会结合面试场景组织语言 更不知道怎么把项目经验转化为面试加分项</p>
<p>作为专注前端简历面试辅导和求职陪跑的导师 我见过太多类似案例 有人能熟练使用 trycatch 处理错误 却讲不清适用场景 有人项目里踩过异步错误的坑 却不知道怎么在面试中表达 还有人简历里只写会用 asyncawait 没说清错误处理的最佳实践 自然吸引不了面试官</p>
<p>如果你也面临这些困扰</p>
<ul>
<li>面试时讲不清技术细节 不会结合场景举例</li>
<li>简历里的技术亮点没突出 投递后石沉大海</li>
<li>遇到深度追问就慌 不知道怎么展现实力</li>
<li>想进大厂 却摸不透面试考察重点</li>
</ul>
<p>现在机会来了 我的前端简历面试辅导加求职陪跑计划 专为前端求职者量身打造</p>
<p>✅ 1v1 简历优化 挖掘你项目中的异步编程 错误处理等实践 把技术亮点转化为面试加分项 让 HR 一眼看中</p>
<p>✅ 模拟面试实战 还原大厂面试场景 针对性训练 asyncawait 性能优化 跨域等高频题 教你说出面试官想听的答案</p>
<p>✅ 技术答疑加求职规划 从基础到进阶解决你的技术痛点 帮你避开求职陷阱 精准匹配目标公司</p>
<p>✅ 独家资料放送 整理 100 + 前端高频面试题 包含异步编程 框架 安全等核心知识点 附答案解析和实操场景 让你面试不慌</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS判断空值只知道“||”？不如来试试这个操作符]]></title>    <link>https://juejin.cn/post/7593198957984612393</link>    <guid>https://juejin.cn/post/7593198957984612393</guid>    <pubDate>2026-01-10T09:25:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593198957984612393" data-draft-id="7593145583349268522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS判断空值只知道“||”？不如来试试这个操作符"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-10T09:25:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户3905133219288"/> <meta itemprop="url" content="https://juejin.cn/user/3609051079121550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS判断空值只知道“||”？不如来试试这个操作符
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3609051079121550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户3905133219288
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:25:04.000Z" title="Sat Jan 10 2026 09:25:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天我们来聊一个JavaScript里非常实用的语法：<strong>空值合并运算符</strong>。它的写法是两个问号：<code>??</code>。</p>
<p>这个东西有什么用呢？简单说，它帮你处理那些“可能有值，也可能是<code>null</code>或<code>undefined</code>”的情况。</p>
<h2 data-id="heading-0"><code>??</code> 运算符怎么用</h2>
<p>空值合并运算符的用法很简单：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">result</span> = 左侧值 ?? 右侧值<span class="hljs-comment">;</span>
</code></pre>
<p>它的规则是：</p>
<p>• 如果<strong>左侧值</strong>不是<code>null</code>也不是<code>undefined</code>，就返回左侧值</p>
<p>• 如果<strong>左侧值</strong>是<code>null</code>或<code>undefined</code>，就返回右侧值</p>
<p>用这个运算符重写上面的例子：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">user</span> = {
  name: null
}<span class="hljs-comment">;</span>

let <span class="hljs-attr">displayName</span> = user.name ?? <span class="hljs-string">"游客"</span><span class="hljs-comment">;</span>

console.log(displayName)<span class="hljs-comment">; // 输出：游客</span>
</code></pre>
<p>一行代码就搞定了！是不是很简洁？</p>
<h2 data-id="heading-1">和 <code>||</code> 运算符的区别</h2>
<p>你可能用过<code>||</code>（逻辑或）运算符来设置默认值：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">value</span> = someValue || <span class="hljs-string">"默认值"</span><span class="hljs-comment">;</span>
</code></pre>
<p><code>||</code>和<code>??</code>很像，但有一个重要区别：</p>
<p>• <code>||</code> 会在左侧值为 <strong>假值</strong> 时返回右侧值
• <code>??</code> 只在左侧值为 <strong>null或undefined</strong> 时返回右侧值</p>
<p>JavaScript中的假值包括：</p>
<p>• <code>false</code></p>
<p>• <code>0</code></p>
<p>• <code>""</code>（空字符串）</p>
<p>• <code>null</code></p>
<p>• <code>undefined</code></p>
<p>• <code>NaN</code></p>
<p>看一个对比例子：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">count</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
let <span class="hljs-attr">price</span> = <span class="hljs-string">""</span><span class="hljs-comment">;</span>

// 使用 ||
let <span class="hljs-attr">result1</span> = count || <span class="hljs-number">10</span><span class="hljs-comment">;  // 输出：10（0是假值）</span>
let <span class="hljs-attr">result2</span> = price || <span class="hljs-string">"未知"</span><span class="hljs-comment">;  // 输出："未知"（空字符串是假值）</span>

// 使用 ??
let <span class="hljs-attr">result3</span> = count ?? <span class="hljs-number">10</span><span class="hljs-comment">;  // 输出：0（0不是null或undefined）</span>
let <span class="hljs-attr">result4</span> = price ?? <span class="hljs-string">"未知"</span><span class="hljs-comment">;  // 输出：""（空字符串不是null或undefined）</span>
</code></pre>
<p>在实际开发中，如果你希望<code>0</code>、<code>false</code>、<code>""</code>这些值被保留，就用<code>??</code>。如果你希望所有假值都用默认值替换，就用<code>||</code>。</p>
<h4 data-id="heading-2">实际场景</h4>
<h3 data-id="heading-3">场景1：函数参数默认值</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-comment">// 如果没传name，或者传了null/undefined，就用"朋友"</span>
  <span class="hljs-keyword">let</span> finalName = name ?? <span class="hljs-string">"朋友"</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`你好，<span class="hljs-subst">${finalName}</span>！`</span>);
}

<span class="hljs-title function_">greet</span>(<span class="hljs-string">"张三"</span>);  <span class="hljs-comment">// 输出：你好，张三！</span>
<span class="hljs-title function_">greet</span>(<span class="hljs-literal">null</span>);    <span class="hljs-comment">// 输出：你好，朋友！</span>
<span class="hljs-title function_">greet</span>();        <span class="hljs-comment">// 输出：你好，朋友！</span>
</code></pre>
<h3 data-id="heading-4">场景2：配置对象合并</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用户设置</span>
<span class="hljs-keyword">let</span> userSettings = {
  <span class="hljs-attr">theme</span>: <span class="hljs-literal">null</span>,  <span class="hljs-comment">// 用户没选主题</span>
  <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>
};

<span class="hljs-comment">// 默认设置</span>
<span class="hljs-keyword">let</span> defaultSettings = {
  <span class="hljs-attr">theme</span>: <span class="hljs-string">"light"</span>,
  <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,
  <span class="hljs-attr">language</span>: <span class="hljs-string">"zh-CN"</span>
};

<span class="hljs-comment">// 合并设置：优先用用户的，用户没设置就用默认的</span>
<span class="hljs-keyword">let</span> finalSettings = {
  <span class="hljs-attr">theme</span>: userSettings.<span class="hljs-property">theme</span> ?? defaultSettings.<span class="hljs-property">theme</span>,
  <span class="hljs-attr">fontSize</span>: userSettings.<span class="hljs-property">fontSize</span> ?? defaultSettings.<span class="hljs-property">fontSize</span>,
  <span class="hljs-attr">language</span>: userSettings.<span class="hljs-property">language</span> ?? defaultSettings.<span class="hljs-property">language</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(finalSettings);
<span class="hljs-comment">// 输出：{ theme: "light", fontSize: 14, language: "zh-CN" }</span>
</code></pre>
<h3 data-id="heading-5">场景3：链式调用</h3>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">user</span> = {
  profile: {
    address: {
      city: "北京"
    }
  }
}<span class="hljs-comment">;</span>

// 安全地获取嵌套属性
let <span class="hljs-attr">city</span> = user?.profile?.address?.city ?? <span class="hljs-string">"未知城市"</span><span class="hljs-comment">;</span>
console.log(city)<span class="hljs-comment">; // 输出：北京</span>

// 如果中间某个属性不存在
let <span class="hljs-attr">user2</span> = {
  profile: null
}<span class="hljs-comment">;</span>

let <span class="hljs-attr">city2</span> = user2?.profile?.address?.city ?? <span class="hljs-string">"未知城市"</span><span class="hljs-comment">;</span>
console.log(city2)<span class="hljs-comment">; // 输出：未知城市</span>
</code></pre>
<p>这里用到了可选链操作符<code>?.</code>，它和<code>??</code>配合使用非常方便。</p>
<h2 data-id="heading-6">注意事项</h2>
<h3 data-id="heading-7">1. 不能直接和<code>&amp;&amp;</code>或<code>||</code>一起用</h3>
<pre><code class="hljs language-ini" lang="ini">// 这样写会报错
let <span class="hljs-attr">x</span> = a &amp;&amp; b ?? c<span class="hljs-comment">;  // SyntaxError</span>

// 需要加括号
let <span class="hljs-attr">x</span> = (a &amp;&amp; b) ?? c<span class="hljs-comment">;  // 正确</span>
let <span class="hljs-attr">y</span> = a &amp;&amp; (b ?? c)<span class="hljs-comment">;  // 正确</span>
</code></pre>
<h3 data-id="heading-8">2. 优先级问题</h3>
<p><code>??</code>的优先级比<code>=</code>高，但比大多数运算符低。为了代码清晰，建议在复杂表达式中使用括号。</p>
<pre><code class="hljs language-ini" lang="ini">// 这样写可能不是你想要的
let <span class="hljs-attr">result</span> = a ?? b &amp;&amp; c<span class="hljs-comment">;</span>

// 加括号更清晰
let <span class="hljs-attr">result</span> = a ?? (b &amp;&amp; c)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-9">3. 在旧版本浏览器中可能不支持</h3>
<p><code>??</code>是ES2020引入的语法。如果你需要支持旧浏览器，可能需要使用Babel等工具进行转换。</p>
<h2 data-id="heading-10">什么时候用<code>??</code></h2>
<p>记住这个简单的判断标准：</p>
<p>• 当你只想在变量是<code>null</code>或<code>undefined</code>时才用默认值，用<code>??</code></p>
<p>• 当你想在所有假值（<code>false</code>、<code>0</code>、<code>""</code>等）情况下都用默认值，用<code>||</code></p>
<p>在实际项目中，<code>??</code>通常更适合处理配置、用户输入、API响应等场景，因为这些场景中<code>0</code>、<code>false</code>、<code>""</code>往往是有效值，不应该被默认值替换。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂机器学习中的优化方法！]]></title>    <link>https://juejin.cn/post/7593242327933812746</link>    <guid>https://juejin.cn/post/7593242327933812746</guid>    <pubDate>2026-01-10T09:40:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593242327933812746" data-draft-id="7593242327933796362" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂机器学习中的优化方法！"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-10T09:40:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂机器学习中的优化方法！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:40:17.000Z" title="Sat Jan 10 2026 09:40:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Faicoting.cn%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<p>在机器学习中，模型的训练本质上是一个优化问题：我们希望找到一组参数，使得模型在给定数据上的损失最小化（或目标函数最大化）。优化方法提供了一套系统的数学工具，用于高效、稳定地寻找最佳参数。</p>
<p>优化方法部分我们来看一下最经典的梯度下降，并且为大家简单的介绍一下凸优化和约束优化，前面说过这部分其实是研究生课程，不用担心，我写的是简单内容，大家应该都能看懂！</p>
<h2 data-id="heading-0">梯度下降及其变体</h2>
<p>在机器学习中，梯度下降（Gradient Descent, GD）是优化模型参数最核心的方法。通过沿着损失函数的梯度反方向更新参数，梯度下降可以找到使损失最小的参数组合。</p>
<h3 data-id="heading-1">基本梯度下降（Batch Gradient Descent, BGD）</h3>
<p>原理</p>
<p>BGD 每次使用整个训练集计算梯度，更新参数：</p>
<p>θt+1=θt−η∇θL(θt)</p>
<ul>
<li>θt：当前参数</li>
<li>η：学习率</li>
<li>∇θL(θt)：损失函数对参数的梯度</li>
</ul>
<p>优缺点</p>
<p>基本梯度下降方法梯度稳定，更新方向准确，收敛稳定，不容易跳出局部极小值（凸问题除外）。</p>
<p>但是大数据集计算成本高，不适合在线学习或实时训练。</p>
<p>应用场景</p>
<ul>
<li>小型数据集或需要精确优化的线性模型（如线性回归）</li>
</ul>
<h3 data-id="heading-2">随机梯度下降（Stochastic Gradient Descent, SGD）</h3>
<p>原理</p>
<p>SGD 每次只使用一个样本计算梯度：</p>
<ul>
<li>：当前样本</li>
<li>：学习率</li>
</ul>
<p>优缺点</p>
<p>随机梯度下降计算效率高，适合大规模数据，梯度噪声有助于跳出局部极小值。</p>
<p>但是梯度震荡，收敛不稳定，可能需要更多迭代次数。</p>
<p>应用场景</p>
<ul>
<li>在线学习、深度神经网络训练</li>
<li>推荐系统或大规模数据流处理</li>
</ul>
<h3 data-id="heading-3">Mini-batch 梯度下降</h3>
<p>原理</p>
<ul>
<li>每次使用小批量样本（如 32 或 128 个）计算梯度</li>
<li>参数更新公式：</li>
<li>m为批量大小</li>
</ul>
<p>优缺点</p>
<p>Mini-batch 梯度下降兼顾了 SGD 的效率和 BGD 的稳定性,可利用 GPU 并行计算。</p>
<p>但是批量大小需要调优，批量过小可能震荡，过大降低效率。</p>
<p>应用场景</p>
<ul>
<li>深度学习训练中的默认选择</li>
<li>CNN、RNN 等大规模模型训练</li>
</ul>
<h3 data-id="heading-4">动量法（Momentum）</h3>
<p>原理</p>
<ul>
<li>引入“惯性”，累积历史梯度，减少震荡，加快收敛：</li>
<li>为动量系数（通常 0.9）</li>
</ul>
<p>优缺点</p>
<p>动量法可以加快收敛速度，减少梯度方向震荡。</p>
<p>但是需要调节动量系数，可能对非凸损失函数过冲。</p>
<p>应用场景</p>
<ul>
<li>深度神经网络</li>
<li>CNN、RNN 等梯度震荡明显的网络</li>
</ul>
<h3 data-id="heading-5">自适应学习率方法</h3>
<p>1.AdaGrad 原理</p>
<ul>
<li>为每个参数使用不同的自适应学习率：</li>
<li>为梯度平方累积</li>
<li>优点：适合稀疏特征</li>
<li>缺点：学习率随迭代不断衰减，可能过早停止</li>
</ul>
<p>2.RMSProp 原理</p>
<ul>
<li>改进 AdaGrad，使用梯度平方的指数衰减平均：</li>
<li>优点：解决 AdaGrad 学习率过快衰减问题</li>
</ul>
<p>3.Adam（Adaptive Moment Estimation） 原理</p>
<ul>
<li>结合动量和自适应学习率</li>
<li>优点：</li>
<li>收敛快，适合大多数深度学习任务</li>
<li>自动调节学习率</li>
<li>缺点：</li>
<li>对超参数敏感</li>
<li>内存占用较高</li>
</ul>
<p>应用场景</p>
<ul>
<li>CNN、RNN、Transformer 等深度网络</li>
<li>高维稀疏特征优化</li>
</ul>
<h3 data-id="heading-6">学习率策略</h3>
<p>1.固定学习率:简单但不灵活</p>
<p>2.学习率衰减：随训练轮数降低</p>
<p>3.循环学习率（Cyclic LR）：周期性调整学习率，如从低到高再到低</p>
<p>4.自适应优化算法（Adam、RMSProp）：自动调节学习率，无需手动调整</p>
<h2 data-id="heading-7">凸优化与约束优化</h2>
<p>在机器学习中，优化问题无处不在。无论是训练线性回归、支持向量机，还是深度神经网络，核心目标都是通过优化方法找到最优参数。为了更高效地求解这些问题，凸优化（Convex Optimization）与约束优化（Constrained Optimization）提供了理论基础和方法支持。</p>
<h3 data-id="heading-8">凸优化（Convex Optimization）</h3>
<p>定义</p>
<p>一个优化问题称为凸优化问题，如果其目标函数是凸函数，且约束条件是凸集合。形式化表示为：</p>
<ul>
<li>f(θ)为凸函数，即满足：</li>
<li>为凸集合 直观点理解就是凸函数形状像碗，任何两点连线都在函数曲面之上。凸优化问题只有一个全局最优点，没有局部极小值困扰。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/046fcb95e2484eae93d4753a72d7870e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768642816&amp;x-signature=VhtkPol3IJBg7obGF2MjSCywVQk%3D" alt="" loading="lazy"/></p>
<p>添加图片注释，不超过 140 字（可选）</p>
<p>常见凸优化问题</p>
<ol>
<li>线性回归：</li>
<li>支持向量机（SVM）凸优化：</li>
<li>Lasso 回归（带 L1 正则）：</li>
</ol>
<p>凸优化求解方法包括梯度下降（Gradient Descent）、牛顿法（Newton’s Method）、拟牛顿法（BFGS）、内点法（Interior Point Method），这些方法理论保证收敛到全局最优解，算法稳定高效。</p>
<h3 data-id="heading-9">约束优化（Constrained Optimization）</h3>
<p>定义</p>
<p>约束优化问题是指优化目标受约束条件限制，形式化表示为：</p>
<ul>
<li>：不等式约束</li>
<li>：等式约束 也就是优化的解必须同时满足“边界条件”，比如权重非负、概率和为 1。</li>
</ul>
<p>求解方法</p>
<ol>
<li>拉格朗日乘子法（Lagrange Multiplier）</li>
</ol>
<ul>
<li>构造拉格朗日函数：</li>
<li>求解一阶条件（KKT 条件）得到最优解</li>
</ul>
<ol start="2">
<li>投影梯度法（Projected Gradient Descent）</li>
</ol>
<ul>
<li>每次梯度更新后，将参数投影到可行集合内：</li>
</ul>
<ol start="3">
<li>罚函数法（Penalty Method）</li>
</ol>
<ul>
<li>将约束转化为损失函数的一部分：</li>
</ul>
<p>约束优化的应用场景包括支持向量机(保证分类间隔约束)、概率模型(保证概率和为 1)、资源分配问题(权重或预算限制)等等。</p>
<p>但是在许多机器学习问题中，凸优化和约束优化往往结合使用，SVM 是典型例子：凸目标函数 + 不等式约束，Lasso 回归也可看作带约束的凸优化问题（L1 范数约束）。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【React 19 尝鲜】第一篇：use和useActionState]]></title>    <link>https://juejin.cn/post/7593241698370158628</link>    <guid>https://juejin.cn/post/7593241698370158628</guid>    <pubDate>2026-01-10T09:40:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593241698370158628" data-draft-id="7593241698370142244" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【React 19 尝鲜】第一篇：use和useActionState"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-10T09:40:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="疯狂踩坑人"/> <meta itemprop="url" content="https://juejin.cn/user/1011206430698574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【React 19 尝鲜】第一篇：use和useActionState
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1011206430698574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    疯狂踩坑人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:40:07.000Z" title="Sat Jan 10 2026 09:40:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文将介绍react 19的一些新特性和API，主打一个结合例子和踩坑记录的方式来分享。</p>
</blockquote>
<h2 data-id="heading-0">一、use: 消费Context和Promise</h2>
<h3 data-id="heading-1">1. Context</h3>
<p>关于<code>Context</code> react19 带来了两点变化：</p>
<ul>
<li>可以使用<code>use</code> 在条件中消费 Context</li>
<li>可以不再使用 <code>&lt;Context.Provider&gt;</code>，而是直接使用<code>&lt;Context&gt;</code></li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { use } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-string">''</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
 <span class="hljs-comment">// ✅ 直接 ThemeContext 作为组件</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"dark"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">showTheme</span>=<span class="hljs-string">{true}/</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext</span>&gt;</span></span>
  );  
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">{ showTheme }</span>) {
  <span class="hljs-keyword">if</span> (showTheme) {
    <span class="hljs-comment">// ✅ 可以在条件语句中使用 use</span>
    <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">use</span>(<span class="hljs-title class_">ThemeContext</span>);
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{theme}</span>&gt;</span>Styled Button<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
  }

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>Default Button<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-2">2. 消费Promise</h3>
<p>消费promise，最常见的场景就是处理 <strong>GET类请求</strong>。</p>
<p>下面以<strong>表格分页查询</strong>这个场景为例子，进行探索。</p>
<ul>
<li>进入页面，需要加载页面数据</li>
<li>当修改分页（点击下一页），则请求新的数据</li>
</ul>
<h4 data-id="heading-3">1.切换路由-请求数据</h4>
<p>react 19不支持在渲染中直接创建promise 然后用use 进行消费，所以创建promise的工作交给了react-router，让它在初始化页面组件时传入一个promise。</p>
<p><code>Page.tsx</code></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useLoaderData, <span class="hljs-keyword">type</span> <span class="hljs-title class_">ClientLoaderFunctionArgs</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">clientLoader</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> p = <span class="hljs-title function_">getVideos</span>()
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">videoListPromise</span>: p
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">const</span> { videoListPromise } = useLoaderData&lt;<span class="hljs-keyword">typeof</span> clientLoader&gt;()
	
	<span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
		<span class="hljs-tag">&lt;<span class="hljs-name">VideoList</span> {<span class="hljs-attr">videoListPromise</span>}/&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-title class_">VideoList</span>() {
	<span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: response } = <span class="hljs-title function_">use</span>(videoListPromise)
	<span class="hljs-keyword">const</span> videos = response?.<span class="hljs-property">data</span>?.<span class="hljs-property">items</span> || [];
	
	<span class="hljs-keyword">return</span> &lt;div&gt;
		{videos.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">video</span>) =&gt;</span> (
			<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">VideoCard</span> 
				<span class="hljs-attr">key</span>=<span class="hljs-string">{video.id}</span> 
				<span class="hljs-attr">video</span>=<span class="hljs-string">{video}</span> 
			/&gt;</span></span>
		))}
	&lt;div&gt;
}
</code></pre>
<blockquote>
<p>P.S. 这里使用的是react-router v7 的 framework mode，<code>clientLoader</code>表示页面异步请求，react-router等<code>clientLoader</code>这个promise完成后 挂载组件，此时可以通过<code>useLoaderData</code>获取数据。</p>
</blockquote>
<p>这个例子中，<code>clientLoader</code>并没有真的发起异步请求，而是返回一个pending的promise，这个是关键，就是为了让use(promise).</p>
<p>当渲染中，遇到<code>use(videoListPromise)</code> , 会throw 一个 promise，<code>&lt;Suspense&gt;</code>组件能捕获到从而渲染<code>fallback</code>。当这个promise 成功（resolved）就继续执行下面的渲染代码。</p>
<p><strong>注意点：</strong></p>
<ol>
<li><code>use()</code>需要在<code>&lt;Suspense&gt;</code>内使用，否则就无法捕获到promise，就不能加载<code>fallback</code>.</li>
<li><code>use()</code>消费的promise如果失败（rejected），会触发<code>&lt;ErrorBoundary&gt;</code>（如果有的话），不会继续渲染下面的组件。在这种范式下，<code>trycatch</code>就没必要了，只需要定义好<code>&lt;ErrorBoundary&gt;</code>。</li>
<li>不建议在渲染中创建promise给<code>use</code>使用，因为这样每次重新渲染就会重新创建一个新promise，重复请求。最佳实践是这个promise要从组件外部传入。</li>
</ol>
<h4 data-id="heading-4">2.交互-请求数据</h4>
<p>前面展示了一个“纯粹的”切换到某个页面，页面加载初始数据。但有时候需要在交互后，继续触发数据请求，比如“分页”。</p>
<p>此时我们会发出一个疑问 —— promise在组件外面创建的，我的参数怎么传递呢？
答：将参数“<strong>URL 化</strong>”.</p>
<p>先看效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db6d189a0470451d9b3df2db0dcdbe11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768642806&amp;x-signature=AVnqVrABCRJufkab8Aq%2B%2FV59Qpg%3D" alt="image.png" loading="lazy"/></p>
<p>要在 React 19 中结合 React Router 使用 <code>use</code> + <code>Suspense</code> 并利用 URL 实现分页，核心思路是：<strong>将 URL 中的查询参数（如 <code>?page=2</code>）作为触发 <code>clientLoader</code> 重新运行的依赖项。</strong></p>
<p>当 URL 改变时，React Router 会重新调用 <code>clientLoader</code>，产生一个新的 Promise，<code>VideoList</code> 组件通过 <code>use(promise)</code> 挂起并触发 <code>Suspense</code> 状态。</p>
<blockquote>
<p>P.S这是 <code>clientLoader</code>（以及服务端的 <code>loader</code>）设计的核心优势之一：<strong>数据加载与路由变化天然绑定</strong>，无需手动监听 <code>useParams()</code> 或 <code>useLocation()</code>。
如果你<strong>不希望</strong>参数变化时重新加载（极少见），可以通过缓存或自定义逻辑在 <code>clientLoader</code> 内部跳过请求，但通常不需要。</p>
</blockquote>
<p>以下是完整的改进方案：</p>
<h5 data-id="heading-5">a. 改进 <code>clientLoader</code></h5>
<p>我们需要从 <code>request.url</code> 中提取分页参数，并将其传递给 API 函数。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useLoaderData, <span class="hljs-keyword">type</span> <span class="hljs-title class_">ClientLoaderFunctionArgs</span>, useSearchParams } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router"</span>;
<span class="hljs-keyword">import</span> { use, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-comment">// 模拟 API</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getVideos</span>(<span class="hljs-params">params: { page: <span class="hljs-built_in">number</span> }</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">clientLoader</span>(<span class="hljs-params">{ request }: ClientLoaderFunctionArgs</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(request.<span class="hljs-property">url</span>);
  <span class="hljs-keyword">const</span> page = <span class="hljs-title class_">Number</span>(url.<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"page"</span>)) || <span class="hljs-number">1</span>; <span class="hljs-comment">// 默认第一页</span>
  
  <span class="hljs-comment">// 返回一个新的 Promise</span>
  <span class="hljs-keyword">const</span> p = <span class="hljs-title function_">getVideos</span>({ page });
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">videoListPromise</span>: p,
    <span class="hljs-attr">currentPage</span>: page
  };
}
</code></pre>
<h5 data-id="heading-6">b. 改进 <code>Page</code> 和 <code>VideoList</code> 组件</h5>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 获取 loader 传递的 Promise 和当前页码</span>
  <span class="hljs-keyword">const</span> { videoListPromise, currentPage } = useLoaderData&lt;<span class="hljs-keyword">typeof</span> clientLoader&gt;();
  <span class="hljs-keyword">const</span> [searchParams, setSearchParams] = <span class="hljs-title function_">useSearchParams</span>();

  <span class="hljs-comment">// 处理翻页逻辑：直接更新 URL 查询参数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePageChange</span> = (<span class="hljs-params">newPage: <span class="hljs-built_in">number</span></span>) =&gt; {
    <span class="hljs-title function_">setSearchParams</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> {
      prev.<span class="hljs-title function_">set</span>(<span class="hljs-string">"page"</span>, <span class="hljs-title class_">String</span>(newPage));
      <span class="hljs-keyword">return</span> prev;
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Video Library - Page {currentPage}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      
      {/* 2. Suspense 包裹异步渲染区域 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"loading"</span>&gt;</span>Loading videos...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">VideoList</span> <span class="hljs-attr">videoListPromise</span>=<span class="hljs-string">{videoListPromise}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>

      {/* 3. 分页控制器 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"pagination-controls"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
          <span class="hljs-attr">disabled</span>=<span class="hljs-string">{currentPage</span> &lt;= <span class="hljs-string">1}</span> 
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handlePageChange(currentPage - 1)}
        &gt;
          Previous
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span> Page {currentPage} <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handlePageChange(currentPage + 1)}
        &gt;
          Next
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 4. VideoList 使用 React 19 的 use() 钩子</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VideoListProps</span> {
  <span class="hljs-attr">videoListPromise</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoList</span>(<span class="hljs-params">{ videoListPromise }: VideoListProps</span>) {
  <span class="hljs-comment">// use() 会自动解构 Promise，并在 Pending 时挂起 Suspense</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-title function_">use</span>(videoListPromise);
  <span class="hljs-keyword">const</span> videos = response?.<span class="hljs-property">data</span>?.<span class="hljs-property">items</span> || [];

  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {videos.map((video: any) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">VideoCard</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{video.id}</span> <span class="hljs-attr">video</span>=<span class="hljs-string">{video}</span> /&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h5 data-id="heading-7">c. 重新加载数据的坑</h5>
<p>第一次进入页面，触发了<code>&lt;Suspense&gt;</code>的fallback。
切换分页，重新请求数据时，useLoaderData会返回一个新的<code>Promise {&lt;pending&gt;}</code> 但是却没有触发<code>&lt;Suspense&gt;</code>的fallback。。。 <strong>有点反直觉</strong></p>
<p>解决办法就是，给<code>&lt;Suspense&gt;</code>加key（不加的话，react重新渲染可能直接跳过Suspense的协调，跳过渲染）
<code>&lt;Suspense key={currentPage} fallback={&lt;Loading /&gt;} &gt;</code></p>
<h4 data-id="heading-8">3.小总结</h4>
<p>有些场景不太适合  <code>clientLoader</code> + <code>use</code> + <code>&lt;Suspense&gt;</code> 这种实践方式，比如满足「参数控制刷新」+ 「局部刷新」的场景。</p>
<ul>
<li>这种场景，往往是有多个请求，每个请求都需要传递参数（URL只有一个就不太好表达）。每个局部刷新对应的UI 都需要 fallback。（fallback会暂时覆盖原来的UI，不好）</li>
<li>举个例子：「列表加载更多」的场景，往上滚动时需要加载更多数据，总不能加载时用fallback来访覆盖UI吧。还是得退化到<code>useEffect</code>，<code>useEffect</code>处理副作用终归还是必不可少的。</li>
</ul>
<p>而 <code>use(promise)</code> 更适合“声明式、一次性解析”，加载<code>页面级</code>数据。</p>
<p>🆚 <strong>对比总结</strong></p>








































<table><thead><tr><th>维度</th><th><code>use(promise)</code> + <code>Suspense</code></th><th><code>useEffect</code> / <code>React Query</code></th></tr></thead><tbody><tr><td><strong>适用场景</strong></td><td>页面级数据（如文章详情、商品页）</td><td>列表、表格、仪表盘等交互密集型 UI</td></tr><tr><td><strong>Loading 体验</strong></td><td>全局 fallback（看不到数据）</td><td>局部 loading（还可以看到历史数据）✅</td></tr><tr><td><strong>状态控制</strong></td><td>仅 pending/success/error</td><td>支持 isFetching, isRefetching, error, cache 等 ✅</td></tr><tr><td><strong>用户交互响应</strong></td><td>弱（被动挂起）</td><td>强（主动触发 + 精确反馈）✅</td></tr><tr><td><strong>开发心智模型</strong></td><td>声明式（数据即依赖）</td><td>命令式（事件 → 请求 → 更新）✅（对管理端更直观）</td></tr><tr><td><strong>生态支持</strong></td><td>需手动管理</td><td>React Query/SWR 提供开箱即用分页支持 ✅</td></tr></tbody></table>
<h2 data-id="heading-9">二、Actions：处理表单和POST类请求</h2>
<h3 data-id="heading-10">1. 什么是Actions？</h3>
<p>1.在 React 19 中，Actions 本质上是支持异步函数的 Transition。</p>
<p>2.在 React 19 之前，处理异步操作通常需要手动管理 pending（加载中）、error（错误）和 data（数据）状态。Actions 的出现让这些流程自动化了。</p>
<p>3.当你将一个异步函数传递给 <code>useTransition</code> 或 <code>useActionState</code> 时，React 会自动处理：</p>
<ul>
<li><code>Pending 状态</code>：自动开始并结束，无需手动 setIsLoading(true/false)。</li>
<li><code>自动排队</code>：React 保证多个提交按顺序处理。</li>
<li><code>UI 响应性</code>：UI 在数据请求期间保持响应，不会阻塞。</li>
</ul>
<h3 data-id="heading-11">2. react 19 的表单提交</h3>
<h4 data-id="heading-12">1. 原生的表单</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/submit-data"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span>&gt;</span>
</code></pre>
<p>通过<code>onsubmit</code>监听 <code>submit</code>事件，函数return true，走原生表单提交逻辑（即发送到action的url）。return false，则阻止提交</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onsubmit</span>=<span class="hljs-string">"return validateForm()"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 表单字段 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"提交"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">validateForm</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 验证逻辑...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 或 false</span>
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>更多情况下，利用 <code>onsubmit</code>来手动发送http请求，提交POST请求。然后自己<code>e.preventDefault();</code>（阻止默认的表单提交行为）</p>
<h4 data-id="heading-13">2. 使用useActionState处理表单</h4>
<p><strong>React 19 对表单处理引入了较大的改进</strong>，目标是简化数据变更、状态管理和提升用户体验。</p>
<p>这些变化的核心是引入了「表单对action的支持」和「3个新的 Hooks」，它们旨在让您能够更多地利用 Web 标准的 <code>&lt;form&gt;</code> 元素，减少手动处理状态和 <code>event.preventDefault()</code> 的样板代码。</p>
<ul>
<li>form元素支持<code>action</code>传入一个异步函数（<code>asyncFunction</code>）</li>
<li>提供<code>useActionState</code> 创建 <code>asyncFunction</code> 和管理异步状态</li>
<li>提供<code>useFormStatus</code> 方便表单子组件 获取表单的状态</li>
<li>提供<code>useOptimistic</code> 乐观更新</li>
</ul>
<p>下面以登录表单为场景来介绍 react19 表单提交的变化。</p>
<p>先介绍下react19之前的版本，最直接的登录表单是如何做的。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/button"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Input</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/input"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Label</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/label"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Form</span>, useNavigate } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router"</span>
<span class="hljs-keyword">import</span> { loginApiAuthLoginPost } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/APIs"</span>
<span class="hljs-keyword">import</span> { useAuthStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/useAuthStore"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Login</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();
  <span class="hljs-keyword">const</span> setAuth = <span class="hljs-title function_">useAuthStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">setAuth</span>);
  
  <span class="hljs-keyword">const</span> [username, setUsername] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> [password, setPassword] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;string | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e: React.FormEvent</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> { data, <span class="hljs-attr">error</span>: apiError } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginApiAuthLoginPost</span>({
        <span class="hljs-attr">body</span>: { username, password }
      });

      <span class="hljs-keyword">if</span> (apiError) {
        <span class="hljs-title function_">setError</span>(<span class="hljs-string">"Login failed. Please check your credentials."</span>);
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (data &amp;&amp; data.<span class="hljs-property">code</span> === <span class="hljs-number">200</span> &amp;&amp; data.<span class="hljs-property">data</span>) {
        <span class="hljs-title function_">setAuth</span>(data.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>, data.<span class="hljs-property">data</span>.<span class="hljs-property">user</span>);
        <span class="hljs-title function_">navigate</span>(<span class="hljs-string">"/dashboard"</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">setError</span>(data?.<span class="hljs-property">err_msg</span> || <span class="hljs-string">"Unknown error occurred"</span>);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">"An unexpected error occurred. Please try again."</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleLogin}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-4"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-2"</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"username"</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> 
			<span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span> 
			<span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> 
			<span class="hljs-attr">placeholder</span>=<span class="hljs-string">"admin"</span> 
			<span class="hljs-attr">required</span> 
			<span class="hljs-attr">value</span>=<span class="hljs-string">{username}</span>
			<span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setUsername(e.target.value)}
		  /&gt;
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-2"</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"password"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> 
			<span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span> 
			<span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> 
			<span class="hljs-attr">required</span> 
			<span class="hljs-attr">value</span>=<span class="hljs-string">{password}</span>
			<span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setPassword(e.target.value)}
		  /&gt;
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		{error &amp;&amp; (
		  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm text-red-500 font-medium"</span>&gt;</span>
			{error}
		  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		)}
		<span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>&gt;</span>
		  {loading ? "Signing in..." : "Sign in"}
		<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
	  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  )
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5a2b19d93f341c7add9161d76fc9503~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768642806&amp;x-signature=7kblTBEBa%2FXDpWGBGDtqJRFED88%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-14">a. form的action属性</h5>
<p>1.<strong><code>&lt;form action&gt;</code> 支持函数：</strong> 现在，您可以直接将一个 <strong>异步函数（Action）</strong> 传递给 <code>&lt;form&gt;</code> 元素的 <code>action</code> 属性。</p>
<ul>
<li>当表单提交时，React 会自动调用这个函数，并且在函数内不需要手动调用 <code>event.preventDefault()</code>。</li>
<li>Actions 默认在 <strong>Transition</strong> 中运行，可以自动处理 Pending (等待中) 状态、错误和乐观更新。</li>
<li>自动重置表单。当 <code>&lt;form&gt;</code> Action 成功执行后，React 会自动为 <strong>非受控组件</strong> 重置表单。</li>
</ul>
<p>2.web标准的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FFormData" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData" ref="nofollow noopener noreferrer"> <code>FormData</code>接口</a> , 原生表单的提交事件会传递一个<code>FormData</code>对象给函数，该对象包含了表单的键值对。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FFormData%2Fentries" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/entries" ref="nofollow noopener noreferrer"><code>FormData.entries()</code></a>返回一个包含所有键值对的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FIteration_protocols" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols" ref="nofollow noopener noreferrer"><code>iterator</code></a>对象。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FFormData%2Fget" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/get" ref="nofollow noopener noreferrer"><code>FormData.get()</code></a> <code>返回在 FormData</code> 对象中与给定键关联的第一个值。</li>
</ul>
<p>3.核心逻辑变成了 <code>(formData: FormData) =&gt; Promise&lt;any&gt;</code>的函数</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">formData: FormData</span>) =&gt; {
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">const</span> payload = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(formData.<span class="hljs-title function_">entries</span>());
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> { data, <span class="hljs-attr">error</span>: apiError } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginApiAuthLoginPost</span>({
        <span class="hljs-attr">body</span>: { ...payload }
      });
      <span class="hljs-comment">//...</span>
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">"An unexpected error occurred. Please try again."</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
</code></pre>
<p>4.将<code>handleLogin</code>传递给form的<code>action</code>， 记得给form表单控件加上<code>name="xxx"</code>属性 。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;form action={handleLogin} className=<span class="hljs-string">"grid gap-4"</span>&gt;
	<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-2"</span>&gt;</span>
	  <span class="hljs-tag">&lt;<span class="hljs-name">Label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"username"</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
	  <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> 
		<span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span> 
		<span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span>
		<span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> 
		<span class="hljs-attr">placeholder</span>=<span class="hljs-string">"admin"</span> 
		<span class="hljs-attr">required</span> 
	  /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
	<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-2"</span>&gt;</span>
	  <span class="hljs-tag">&lt;<span class="hljs-name">Label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"password"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
	  <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> 
		<span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span> 
		<span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>
		<span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> 
		<span class="hljs-attr">required</span> 
	  /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
	{error &amp;&amp; (
	  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm text-red-500 font-medium"</span>&gt;</span>
		{error}
	  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
	)}
	&lt;<span class="hljs-title class_">Button</span> className=<span class="hljs-string">"w-full"</span> type=<span class="hljs-string">"submit"</span> disabled={loading}&gt;
	  {loading ? <span class="hljs-string">"Signing in..."</span> : <span class="hljs-string">"Sign in"</span>}
	&lt;/<span class="hljs-title class_">Button</span>&gt;
  &lt;/form&gt;
</code></pre>
<h5 data-id="heading-15">b. useActionState</h5>
<p><strong>useActionState介绍</strong></p>
<ul>
<li>它将表单提交的异步操作、状态管理和加载指示结合在一起。</li>
<li>它返回最新的<code>状态</code>、一个<code>Action 函数</code>，以及一个 <code>isPending</code> 状态，您可以使用它来处理表单的提交结果（如成功消息或错误）。</li>
<li><strong>优点：</strong> 减少了对多个 <code>useState</code> 的需求，简化了状态逻辑。</li>
</ul>
<p><strong>参数细节</strong></p>
<ul>
<li>
<p><code>useActionState</code> 接受一个函数，有两个参数：</p>
<ul>
<li><code>prevState</code> 代表之前状态</li>
<li><code>formData</code> 代表action提交的数据（如果是form表单，则传入的是FormData）</li>
</ul>
</li>
<li>
<p><code>useActionState</code> 可以指定两个泛型，分别对应prevState和formData的类型，比如</p>
<ul>
<li><code>useActionState&lt;string | null, FormData&gt;()</code></li>
</ul>
</li>
<li>
<p><code>返回值</code>：<code>[state, submitAction, isPending]</code></p>
</li>
</ul>
<p><strong>常见问题</strong>
有点麻烦的是：FormData对ts很不友好，你无法得知FormData上有什么属性和value。</p>
<p><code>const payload = Object.fromEntries(formData.entries())</code> 中的payload ts类型如下：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-attr">payload</span>: {  
[<span class="hljs-attr">k</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-title class_">FormDataEntryValue</span>;  
}
</code></pre>
<p>这就要借助牛逼的<code>zod</code>和<code>zod-form-data</code>两个库了，顺便把表单的前端校验也做了~</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fzod" target="_blank" title="https://www.npmjs.com/package/zod" ref="nofollow noopener noreferrer">zod</a> 大名鼎鼎的TS校验库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fzod-form-data" target="_blank" title="https://www.npmjs.com/package/zod-form-data" ref="nofollow noopener noreferrer">zod-form-data</a> 校验FormData并提供TS类型</li>
</ul>
<p><strong>登录表单案例</strong>
使用 Actions（ <code>useActionState</code>）  改进后的代码如下：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useActionState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/button"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Card</span>, <span class="hljs-title class_">CardContent</span>, <span class="hljs-title class_">CardDescription</span>, <span class="hljs-title class_">CardFooter</span>, <span class="hljs-title class_">CardHeader</span>, <span class="hljs-title class_">CardTitle</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/card"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Input</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/input"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Label</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/label"</span>
<span class="hljs-keyword">import</span> { useNavigate } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router"</span>
<span class="hljs-keyword">import</span> { loginApiAuthLoginPost } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/APIs"</span>
<span class="hljs-keyword">import</span> { useAuthStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/useAuthStore"</span>


<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;
<span class="hljs-keyword">import</span> { zfd } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod-form-data"</span>;

<span class="hljs-keyword">const</span> schema = zfd.<span class="hljs-title function_">formData</span>({
  <span class="hljs-attr">username</span>: zfd.<span class="hljs-title function_">text</span>(),
  <span class="hljs-attr">password</span>: zfd.<span class="hljs-title function_">text</span>(z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">6</span>))
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Login</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();
  <span class="hljs-keyword">const</span> setAuth = <span class="hljs-title function_">useAuthStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">setAuth</span>);
 

  <span class="hljs-keyword">const</span> [error, handleLogin, loading] = useActionState&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>, <span class="hljs-title class_">FormData</span>&gt;(<span class="hljs-keyword">async</span> (_prevState, formData) =&gt; {
    <span class="hljs-comment">// const payload = Object.fromEntries(formData.entries()) //禁止这种ts不友好的转换</span>
    <span class="hljs-keyword">const</span> payload = schema.<span class="hljs-title function_">parse</span>(formData)

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> { data, <span class="hljs-attr">error</span>: apiError } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginApiAuthLoginPost</span>({
        <span class="hljs-attr">body</span>: payload,
      });

      <span class="hljs-keyword">if</span> (apiError) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Login failed. Please check your credentials."</span>
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data &amp;&amp; data.<span class="hljs-property">code</span> &gt;= <span class="hljs-number">300</span>) {
        <span class="hljs-keyword">return</span> data?.<span class="hljs-property">err_msg</span> || <span class="hljs-string">"Unknown error occurred"</span>
      }
      <span class="hljs-title function_">setAuth</span>(data.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>, data.<span class="hljs-property">data</span>.<span class="hljs-property">user</span>);
      <span class="hljs-title function_">navigate</span>(<span class="hljs-string">"/dashboard"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">"An unexpected error occurred. Please try again."</span>
    } 
  }, <span class="hljs-literal">null</span>);


  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">{handleLogin}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-4"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-2"</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"username"</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> 
			<span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span> 
			<span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span>
			<span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> 
			<span class="hljs-attr">placeholder</span>=<span class="hljs-string">"admin"</span> 
			<span class="hljs-attr">required</span> 
		  /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-2"</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"password"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
		  <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> 
			<span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span> 
			<span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>
			<span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> 
			<span class="hljs-attr">required</span> 
		  /&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		{error &amp;&amp; (
		  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm text-red-500 font-medium"</span>&gt;</span>
			{error}
		  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		)}
		<span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>&gt;</span>
		  {loading ? "Signing in..." : "Sign in"}
		<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
	  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  )
}
</code></pre>
<h5 data-id="heading-16">c. useFormStatus</h5>
<p>用于在<strong>子组件</strong>中访问父级表单的状态（特别是 pending 状态），解决“属性透传（Prop Drilling）”问题。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SubmitButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { pending } = <span class="hljs-title function_">useFormStatus</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{pending}</span>&gt;</span>{pending ? "提交中..." : "提交"}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}

<span class="hljs-comment">// 在父组件中</span>
&lt;form action={action}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SubmitButton</span> /&gt;</span></span>
&lt;/form&gt;
</code></pre>
<h5 data-id="heading-17">d. useOptimistic</h5>
<p>在异步请求完成之前，先假设操作成功并立即更新 UI。如果请求失败，React 会自动回滚到旧状态。</p>
<p><strong>适用的场景</strong>：</p>
<ul>
<li>社交互动，比如：点赞、收藏、关注</li>
<li>简单的列表操作，比如：删除、添加、排序</li>
<li>单字段的表单更新，比如：修改昵称、切换某个开关（Switch）</li>
</ul>
<p>这些场景的共同点是：<strong>逻辑简单、操作频繁、用户对即时反馈要求高、且失败率通常较低。</strong></p>
<h4 data-id="heading-18">3. 小总结</h4>
<p>总的来说，对于一些简单的表单 场景， 可以尽量不依赖第三方组件，做到优雅快速开发。同时Actions这种范式也不仅仅只用于form，任何POST请求都可以用这种方式来处理，减少了模板代码。 类似一个简易的<code>useAsync</code> hook。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[linux的网络配置]]></title>    <link>https://juejin.cn/post/7593198957984546857</link>    <guid>https://juejin.cn/post/7593198957984546857</guid>    <pubDate>2026-01-10T09:06:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593198957984546857" data-draft-id="7593241698369716260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="linux的网络配置"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-10T09:06:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户46724454499"/> <meta itemprop="url" content="https://juejin.cn/user/502914754559866"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            linux的网络配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/502914754559866/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户46724454499
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:06:30.000Z" title="Sat Jan 10 2026 09:06:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">网络接口的配置</h2>
<h3 data-id="heading-1">ifconfig</h3>
<p>这里有三个网络接口
docker0（Docker的虚拟网络接口），eth0（主网络接口），lo（环回接口）</p>
<p>状态：</p>
<p>网络参数：ipv4，ipv6</p>
<p>流量状态：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a4569985c9c4622befbd8f722ef11f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=tLFkJNxgYiuLPSKl6ABchtCYm7k%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">ping</h3>
<p>检测网络是否连通</p>
<p>ping 8.8.8.8连通</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4281d20f75494fb886599dbc03c31754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=E2%2FXxnYWY9f%2F0khZ%2BCClf8pxuHM%3D" alt="image.png" loading="lazy"/></p>
<p>ping 192.168.33.33未连通无响应</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3985b10ba09e4f10bd083459a1e55504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=4bgq%2FoWuT0ANDS0Sacxe7MI%2BIHI%3D" alt="image.png" loading="lazy"/></p>
<p>ping -t 8.8.8.8持续检测，一般用于windows（因为四次检测会结束）</p>
<h3 data-id="heading-3">netstat链路状态的分析</h3>
<p>netstat -nult</p>
<p>查看端口信息</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aed152ba728441a1a64edeb52357933b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=iJig0BlO%2BEBZNhFqt3CTnD8L8jQ%3D" alt="image.png" loading="lazy"/></p>
<p>这里的-nult</p>
<p>-t显示TCP链接</p>
<p>-u显示UDP链接</p>
<p>-l只显示监听状态的端口</p>
<p>-n显示数字地址和端口号</p>
<h3 data-id="heading-4">ss</h3>
<p>-nult
与netstat相差不大</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aadd468f32474f58a480ad535d96e9eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=JSMWAQOkMygqafqmVwHJQVIUgd8%3D" alt="image.png" loading="lazy"/></p>
<p>通过
ss -tulp实现实时监控</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f7cdce5d4894e00b09b17735ebd5317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=Yx6ys%2FbWe3tQcFfRkU5KIGc2NQE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">静态ip的配置</h3>
<p>进入IP地址配置的文件夹</p>
<p>cd /etc/sysconfig/network-scripts/</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e980ba7ec954912a1ae900980154794~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=2VQiR615%2BXK3bVO7kb%2FQ4HQkAI0%3D" alt="image.png" loading="lazy"/></p>
<p>找到配置网络接口的文件打开，这里是eth0，</p>
<p>cat ifcfg-eth0</p>
<p>找到了dhcp，为动态ip地址，由路由器实时分配</p>
<p>将dhcp修改为static（静态），</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e5475d405fa47efa4eaaa4531efb738~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=azwIWAfozkstjBqzrPQs0s1MX6g%3D" alt="image.png" loading="lazy"/></p>
<p><code>BOOTPROTO=dhcp</code>网卡采用 DHCP 协议，自动从 DHCP 服务器获取 IP 地址、子网掩码等参数。</p>
<p><code>DEVICE=eth0</code>绑定该配置到名为 “eth0” 的网络接口。</p>
<p><code>ONBOOT=yes</code>系统启动时，自动激活 eth0 网卡。</p>
<p><code>STARTMODE=auto</code>与<code>ONBOOT</code>功能兼容，指定网卡在系统启动时自动启动（适配部分网络管理工具）。</p>
<p><code>TYPE=Ethernet</code>标识该接口为以太网类型。</p>
<p><code>USERCTL=no</code>禁止普通用户手动控制该网卡的启动 / 停止操作。</p>
<p>先备份</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e142020d6bc494c9a80cc7d03e3c105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=TuVkVOdtXDUx1ITyA%2BUaEujX5n4%3D" alt="image.png" loading="lazy"/></p>
<p>手动修改</p>
<p><code>BOOTPROTO=static</code>关闭 DHCP，启用静态 IP 模式（新增）</p>
<p><code>IPADDR=172.28.157.106</code>手动指定 eth0 的静态 IP 地址（新增）</p>
<p><code>NETMASK=255.255.240.0</code>子网掩码（与网络环境匹配）（新增）</p>
<p><code>GATEWAY=172.28.144.1</code>网络网关地址（需与所在网段的网关一致）（新增）</p>
<p><code>DNS1=8.8.8.8</code>首选 DNS 服务器（可填写运营商 / 公共 DNS，如阿里云<code>223.5.5.5</code>）</p>
<p>后重启。</p>
<h3 data-id="heading-6">DNS配置</h3>
<p>DNS的配置一般在/etc/resolv.conf文件中</p>
<p>打开该配置文件为空</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5abcc327cd114886aeff8df8568fb10e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=QyOVeagBF6ugO1cZqXxdFh7s0ak%3D" alt="image.png" loading="lazy"/></p>
<p>添加nameserver 114.114.114.114
这是国内公共DNS服务器</p>
<p>也可以用8.8.8.8和4.4.4.4这是谷歌的</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aef35e007c7440438ad73f5bc1c2404e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY3MjQ0NTQ0OTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768640790&amp;x-signature=wum%2FsbwZhkOe5UhtUFRnYs0ZZGc%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂机器学习中的学习理论！]]></title>    <link>https://juejin.cn/post/7593311347291471899</link>    <guid>https://juejin.cn/post/7593311347291471899</guid>    <pubDate>2026-01-10T09:52:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593311347291471899" data-draft-id="7593541290991992882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂机器学习中的学习理论！"/> <meta itemprop="keywords" content="面试,算法"/> <meta itemprop="datePublished" content="2026-01-10T09:52:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂机器学习中的学习理论！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:52:59.000Z" title="Sat Jan 10 2026 09:52:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Faicoting.cn%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<p>学习理论（Learning Theory）是机器学习的数学与理论基础之一，它可以从严格的数学角度解释和分析学习算法的性质与性能。</p>
<p>通过学习理论，我们不仅能够理解机器学习为何有效，还可以回答在多大程度上算法能够泛化到新数据、需要多少训练样本、算法复杂度如何影响模型性能等关键问题。</p>
<h2 data-id="heading-0">偏差-方差权衡</h2>
<p>偏差-方差权衡（Bias-Variance Tradeoff）是机器学习中理解模型泛化能力的重要理论框架。它揭示了模型复杂度、拟合能力与泛化性能之间的关系，是解释过拟合与欠拟合现象的核心工具。</p>
<p>在监督学习中，我们希望找到一个假设函数 h(x) 来逼近真实的目标函数 f(x)，而数据带有噪声：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>ϵ</mi><mo separator="true">,</mo><mspace width="1em"/><mi>ϵ</mi><mo>∼</mo><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y = f(x) + \epsilon, \quad \epsilon \sim \mathcal{N}(0, \sigma^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">ϵ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>模型训练的目标是最小化预测误差（例如均方误差 MSE）：MSE=E[(h(x)−y)2]</p>
<p>然而，这个误差并不是单一来源，而是由多个因素共同决定。</p>
<p>考虑模型的预测值 h(x)，其均方误差可以分解为 偏差（Bias）、方差（Variance） 和 噪声（Noise） 三部分：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">E</mi><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">[</mo><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">]</mo><mo>=</mo><munder><munder><mrow><mo stretchy="false">(</mo><mi mathvariant="double-struck">E</mi><mo stretchy="false">[</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><mo stretchy="true">⏟</mo></munder><msup><mtext>Bias</mtext><mn>2</mn></msup></munder><mo>+</mo><munder><munder><mrow><mi mathvariant="double-struck">E</mi><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">[</mo><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi mathvariant="double-struck">E</mi><mo stretchy="false">[</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">]</mo></mrow><mo stretchy="true">⏟</mo></munder><mtext>Variance</mtext></munder><mo>+</mo><munder><munder><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="true">⏟</mo></munder><mtext>Noise</mtext></munder></mrow><annotation encoding="application/x-tex">\mathbb{E}\big[(h(x) - y)^2\big] = \underbrace{( \mathbb{E}[h(x)] - f(x) )^2}_{\text{Bias}^2} + \underbrace{\mathbb{E}\big[(h(x) - \mathbb{E}[h(x)])^2\big]}_{\text{Variance}} + \underbrace{\sigma^2}_{\text{Noise}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="mord mathbb">E</span><span class="mord"><span class="delimsizing size1">[</span></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="delimsizing size1">]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.5157em;vertical-align:-1.6516em;"/><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-1.3484em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Bias</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7908em;"><span style="top:-2.8305em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span class="svg-align" style="top:-2.102em;"><span class="pstrut" style="height:3em;"/><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13&#10; 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688&#10; 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7&#10;-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"/></svg></span><span class="brace-center" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMidYMin slice"><path d="M199572 214&#10;c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14&#10; 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3&#10; 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0&#10;-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"/></svg></span><span class="brace-right" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3&#10; 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237&#10;-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord mathbb">E</span><span class="mopen">[</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)]</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.898em;"><span/></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.6516em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.5404em;vertical-align:-1.6763em;"/><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-1.3237em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Variance</span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span class="svg-align" style="top:-2.002em;"><span class="pstrut" style="height:3em;"/><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13&#10; 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688&#10; 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7&#10;-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"/></svg></span><span class="brace-center" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMidYMin slice"><path d="M199572 214&#10;c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14&#10; 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3&#10; 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0&#10;-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"/></svg></span><span class="brace-right" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3&#10; 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237&#10;-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathbb">E</span><span class="mord"><span class="delimsizing size1">[</span></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathbb">E</span><span class="mopen">[</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)]</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="delimsizing size1">]</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.998em;"><span/></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.6763em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.1904em;vertical-align:-1.3263em;"/><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-1.6737em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Noise</span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span class="svg-align" style="top:-2.352em;"><span class="pstrut" style="height:3em;"/><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13&#10; 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688&#10; 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7&#10;-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"/></svg></span><span class="brace-center" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMidYMin slice"><path d="M199572 214&#10;c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14&#10; 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3&#10; 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0&#10;-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"/></svg></span><span class="brace-right" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3&#10; 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237&#10;-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.648em;"><span/></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3263em;"><span/></span></span></span></span></span></span></span></span></p>
<p>其中：</p>
<ul>
<li>Bias（偏差）：模型预测的期望值与真实函数 f(x) 的偏离程度。偏差大意味着模型过于简单，无法捕捉真实模式，导致欠拟合。</li>
<li>Variance（方差）：模型预测结果对训练数据的敏感性。如果训练数据变化导致模型预测大幅波动，说明方差大。方差大通常意味着模型过于复杂，容易过拟合。</li>
<li>Noise（噪声）：数据本身的不可约误差，由观测噪声或系统随机性引起，无法通过任何学习方法消除。</li>
</ul>
<p>如果把欠拟合和过拟合与方差偏差对应，高偏差就是欠拟合，模型过于简单，例如用线性函数拟合一个非线性分布，预测值与真实值存在系统性差距。高方差就是过拟合，模型过于复杂，例如高次多项式拟合少量样本，虽然训练误差很小，但在新样本上表现差。理想情况是模型既不过于简单，也不过于复杂，能够捕捉数据的主要规律，同时保持较好的泛化性能。</p>
<p>假设我们用一个二次多项式去拟合数据 y=x2+ϵ： 如果我们只用一次函数 y = ax + b，那么偏差就会很大（模型不能表达二次关系）。</p>
<p>反之如果我们用 10 次多项式，偏差几乎为零，但方差极大（对训练样本扰动非常敏感）。</p>
<p>如果用二次函数，偏差小，方差也适中，才是理想解。</p>
<p>这说明最佳模型复杂度往往与数据的真实结构相匹配。</p>
<p>考虑用多项式回归拟合一组样本点：</p>
<ul>
<li>低阶多项式（如一次函数）：模型太简单，表现为高偏差低方差，欠拟合。</li>
<li>高阶多项式（如 10 次函数）：模型太复杂，训练误差极低，但在测试集上波动很大，表现为低偏差高方差，过拟合。</li>
<li>中等阶数多项式（如三次或四次）：能够较好地平衡偏差和方差，泛化误差最小。</li>
</ul>
<p>偏差-方差权衡在机器学习中的应用包括以下方面：</p>
<ol>
<li>模型选择</li>
</ol>
<ul>
<li>线性模型（如线性回归）：偏差较高但方差较低。</li>
<li>非线性模型（如深度神经网络）：偏差较低但方差可能较高。 选择合适复杂度的模型是关键。</li>
</ul>
<ol start="2">
<li>正则化</li>
</ol>
<ul>
<li>L1（Lasso）、L2（Ridge）正则化通过限制模型复杂度来降低方差，从而改善泛化能力。</li>
</ul>
<ol start="3">
<li>集成方法</li>
</ol>
<ul>
<li>Bagging（如随机森林）降低方差。</li>
<li>Boosting（如 XGBoost）降低偏差。 集成方法正是通过控制偏差和方差来提升模型性能，这些我们后面都会进行介绍。</li>
</ul>
<ol start="4">
<li>交叉验证</li>
</ol>
<ul>
<li>用于评估不同复杂度模型的泛化能力，帮助找到偏差-方差的平衡点。</li>
</ul>
<p>总结一下就是偏差反映模型的简化程度，偏差大导致欠拟合。方差反映模型对数据的敏感性，方差大导致过拟合。偏差与方差通常呈现对立关系：降低偏差往往增加方差，降低方差往往增加偏差。偏差-方差权衡 就是在这两者之间寻找最优平衡，以实现最低的泛化误差。</p>
<h2 data-id="heading-1">VC 维与泛化误差</h2>
<p>在机器学习中，我们关心的不仅是模型在训练数据上的表现，更关心模型在 新数据（测试集） 上的表现，也就是 泛化能力。统计学习理论为我们提供了分析和保证泛化性能的理论框架，而 VC 维（Vapnik–Chervonenkis Dimension） 是其中的核心概念之一。</p>
<h3 data-id="heading-2">泛化误差与经验误差</h3>
<p>在监督学习中，假设我们有真实分布 D，样本数据为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>m</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>m</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mo separator="true">,</mo><mspace width="1em"/><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>∼</mo><mi mathvariant="script">D</mi></mrow><annotation encoding="application/x-tex">S = \{(x_1, y_1), (x_2, y_2), \dots, (x_m, y_m)\}, \quad (x_i, y_i) \sim \mathcal{D}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">{(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathcal" style="margin-right:0.02778em;">D</span></span></span></span></span></p>
<p>设模型假设为 h(x)，损失函数为 L(h(x),y)。则：</p>
<ul>
<li>泛化误差（期望风险）：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi mathvariant="double-struck">E</mi><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∼</mo><mi mathvariant="script">D</mi></mrow></msub><mo stretchy="false">[</mo><mi>L</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">R(h) = \mathbb{E}_{(x,y)\sim \mathcal{D}}[L(h(x), y)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"/><span class="mord"><span class="mord mathbb">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span><span class="mrel mtight">∼</span><span class="mord mathcal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)]</span></span></span></span></span></li>
<li>经验误差（经验风险）：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>R</mi><mo>^</mo></mover><mi>S</mi></msub><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mi>L</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{R}_S(h) = \frac{1}{m} \sum_{i=1}^m L(h(x_i), y_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1968em;vertical-align:-0.25em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
</ul>
<p>我们希望： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>≈</mo><msub><mover accent="true"><mi>R</mi><mo>^</mo></mover><mi>S</mi></msub><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">R(h) \approx \hat{R}_S(h)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1968em;vertical-align:-0.25em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span></span></span></span></span></p>
<p>但由于训练样本有限，模型可能会出现 过拟合（经验误差很小但泛化误差很大）。这时就需要一个理论来刻画 假设空间复杂度，VC 维便应运而生。</p>
<h3 data-id="heading-3">VC 维的定义</h3>
<p>Shattering（打散）</p>
<p>设一个假设类（假设空间）为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span>。若对某个样本集合 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>m</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">S = \{x_1, x_2, \dots, x_m\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>，无论如何给这些样本点分配标签（共 2m 种可能）， <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span>中都存在一个假设能完全正确分类这些样本点，则称 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span>能打散（shatter）集合 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></span>。</p>
<p>VC 维</p>
<p>VC 维 定义为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi mathvariant="script">H</mi><mo stretchy="false">)</mo><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>m</mi><mtext> </mtext><mi mathvariant="normal">∣</mi><mtext> </mtext><mi mathvariant="normal">∃</mi><mi>S</mi><mo separator="true">,</mo><mi mathvariant="normal">∣</mi><mi>S</mi><mi mathvariant="normal">∣</mi><mo>=</mo><mi>m</mi><mo separator="true">,</mo><mi mathvariant="script">H</mi><mtext>能打散</mtext><mi>S</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">VC(\mathcal{H}) = \max \{m \,|\, \exists S, |S|=m, \mathcal{H} \text{能打散} S\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathcal" style="margin-right:0.00965em;">H</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">max</span><span class="mopen">{</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">∣</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">∃</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathcal" style="margin-right:0.00965em;">H</span><span class="mord text"><span class="mord cjk_fallback">能打散</span></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">}</span></span></span></span></span></p>
<p>即：一个假设类能够打散的最大样本点数。</p>
<h3 data-id="heading-4">示例</h3>
<ol>
<li>一维阈值分类器（直线切分实数轴）：</li>
</ol>
<ul>
<li>任何 2 个点都可以被阈值分类器打散。</li>
<li>但 3 个点无法完全打散（总有一种标签分布无法实现）。</li>
<li>因此 VC=2。</li>
</ul>
<ol start="2">
<li>二维平面上的线性分类器（直线划分平面）：</li>
</ol>
<ul>
<li>可以打散任意 3 个点（只要不共线）。</li>
<li>对于 4 个点，不是所有情况都能打散（例如四点构成凸四边形，无法实现对角点正负交替标记）。</li>
<li>因此 VC=3。</li>
</ul>
<ol start="3">
<li>d 维空间中的线性分类器：</li>
</ol>
<ul>
<li>VC = d + 1</li>
<li>例如在三维空间（d=3）中，平面分类器的 VC 维为 4。</li>
</ul>
<h3 data-id="heading-5">VC 维与泛化误差的关系</h3>
<p>统计学习理论表明：当假设空间的 VC 维有限时，可以给出泛化误差的上界。</p>
<p>泛化界（VC 不等式）</p>
<p>以 0-1 损失为例，若假设空间 H的 VC 维为 h，训练样本数为 m，则对于任意 δ∈(0,1)，以至少</p>
<p>1−δ的概率，有：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>≤</mo><msub><mover accent="true"><mi>R</mi><mo>^</mo></mover><mi>S</mi></msub><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>+</mo><msqrt><mfrac><mrow><mi>h</mi><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">(</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mrow><mn>2</mn><mi>m</mi></mrow><mi>h</mi></mfrac><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">)</mo><mo>+</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mn>4</mn><mi>δ</mi></mfrac><mo stretchy="false">)</mo></mrow><mi>m</mi></mfrac></msqrt></mrow><annotation encoding="application/x-tex">R(h) \leq \hat{R}_S(h) + \sqrt{\frac{h\big(\log(\frac{2m}{h})+1\big) + \log(\frac{4}{\delta})}{m}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1968em;vertical-align:-0.25em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.44em;vertical-align:-0.5725em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8675em;"><span class="svg-align" style="top:-4.4em;"><span class="pstrut" style="height:4.4em;"/><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.51em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.66em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord sizing reset-size3 size6 mtight"><span class="delimsizing size1 mtight"><span class="mtight">(</span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mop mtight"><span class="mtight">l</span><span class="mtight">o</span><span class="mtight" style="margin-right:0.01389em;">g</span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"/><span class="frac-line mtight" style="border-bottom-width:0.049em;"/></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span/></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"/></span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord sizing reset-size3 size6 mtight"><span class="delimsizing size1 mtight"><span class="mtight">)</span></span></span><span class="mbin mtight">+</span><span class="mop mtight"><span class="mtight">l</span><span class="mtight">o</span><span class="mtight" style="margin-right:0.01389em;">g</span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03785em;">δ</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"/><span class="frac-line mtight" style="border-bottom-width:0.049em;"/></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span/></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"/></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-3.8275em;"><span class="pstrut" style="height:4.4em;"/><span class="hide-tail" style="min-width:1.02em;height:2.48em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="2.48em" viewbox="0 0 400000 2592" preserveaspectratio="xMinYMin slice"><path d="M424,2478&#10;c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514&#10;c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20&#10;s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121&#10;s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081&#10;l0 -0c4,-6.7,10,-10,18,-10 H400000&#10;v40H1014.6&#10;s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185&#10;c-2,6,-10,9,-24,9&#10;c-8,0,-12,-0.7,-12,-2z M1001 80&#10;h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5725em;"><span/></span></span></span></span></span></span></span></span></p>
<p>含义：</p>
<ul>
<li>泛化误差由两部分组成：经验误差 + 复杂度惩罚项。</li>
<li>VC 维越大，复杂度惩罚越大，需要更多样本才能保证泛化能力。</li>
<li>训练样本数 mm 越大，复杂度惩罚项越小，模型越接近真实泛化能力。</li>
</ul>
<h3 data-id="heading-6">偏差-方差与 VC 维的联系</h3>
<ul>
<li>VC 维大 → 模型复杂度高 → 偏差小但方差大 → 容易过拟合。</li>
<li>VC 维小 → 模型复杂度低 → 偏差大但方差小 → 容易欠拟合。</li>
<li>这与 偏差-方差权衡 是一致的。</li>
</ul>
<h3 data-id="heading-7">在机器学习中的应用</h3>
<ol>
<li>模型复杂度的量化</li>
</ol>
<p>VC 维是衡量假设空间复杂度的理论指标。</p>
<ul>
<li>高 VC 维 → 模型能表示更复杂的模式，但需要更多样本。</li>
<li>低 VC 维 → 泛化能力差，难以捕捉复杂模式。</li>
</ul>
<ol start="2">
<li>样本复杂度（Sample Complexity）</li>
</ol>
<p>若假设空间 VC 维为 h，要保证泛化误差 ϵ且置信度为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>δ</mi></mrow><annotation encoding="application/x-tex">1−δ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span></span></span>，所需样本数量级为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>O</mi><mrow><mo fence="true">(</mo><mfrac><mrow><mi>h</mi><mo>+</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>δ</mi><mo stretchy="false">)</mo></mrow><msup><mi>ϵ</mi><mn>2</mn></msup></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">m = O\left(\frac{h + \log(1/\delta)}{\epsilon^2}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ϵ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">+</span><span class="mop mtight"><span class="mtight">l</span><span class="mtight">o</span><span class="mtight" style="margin-right:0.01389em;">g</span></span><span class="mopen mtight">(</span><span class="mord mtight">1/</span><span class="mord mathnormal mtight" style="margin-right:0.03785em;">δ</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></p>
<ol start="3">
<li>模型选择</li>
</ol>
<p>VC 维可以作为模型选择的理论参考，帮助避免过拟合或欠拟合。</p>
<p>总结一下就是VC 维 定义了一个假设类能够打散的最大样本点数，是衡量模型复杂度的重要指标。泛化误差可以分解为 经验误差 + 复杂度惩罚项，VC 维直接影响复杂度惩罚的大小。VC 理论为机器学习提供了泛化保证，并解释了为什么需要足够多的数据来支撑复杂模型的训练。</p>
<h2 data-id="heading-8">PAC 学习</h2>
<p>PAC 学习（Probably Approximately Correct Learning，概率近似正确学习）是统计学习理论的核心概念，由 Valiant (1984) 提出，用于严格定义“学习是否可能”。它回答了这样一个问题：在有限数据和有限计算资源下，一个学习算法能否学到接近真实的模型？</p>
<h3 data-id="heading-9">PAC 学习的核心思想</h3>
<p>PAC 框架的目标是：</p>
<ul>
<li>学习算法从有限样本中训练出一个假设 h。</li>
<li>这个假设在未来数据上的表现（泛化能力）接近最优。</li>
<li>保证这种接近最优的情况发生的概率非常高。</li>
</ul>
<p>换句话说，PAC 学习要求算法输出的模型是：</p>
<ul>
<li>Approximately Correct（近似正确）：预测误差不超过一个很小的<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex"> ϵ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">ϵ</span></span></span></span></span>。</li>
<li>Probably（高概率）：上述结果发生的概率至少为<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>δ</mi></mrow><annotation encoding="application/x-tex"> 1−δ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span></span></span>。</li>
</ul>
<h3 data-id="heading-10">PAC 学习的数学定义</h3>
<p>设：</p>
<ul>
<li>输入空间为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span>，输出标签为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo separator="true">,</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">{0,1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">1</span></span></span></span></span></span>。</li>
<li>数据样本 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span> 来自分布 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span></span>。</li>
<li>目标函数为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span></span>，假设空间为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span>。</li>
<li>学习算法输出假设为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>∈</mo><mi>H</mi></mrow><annotation encoding="application/x-tex">h∈H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"/><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span>。</li>
<li>泛化误差（真实风险）：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mrow><mi>Pr</mi><mo>⁡</mo></mrow><mrow><mi>x</mi><mo>∼</mo><mi mathvariant="script">D</mi></mrow></msub><mo stretchy="false">[</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo mathvariant="normal">≠</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">R(h) = \Pr_{x \sim \mathcal{D}}[h(x) \neq f(x)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop"><span class="mop">Pr</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">∼</span><span class="mord mathcal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"/></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)]</span></span></span></span></span></li>
</ul>
<p>如果对于任意 ϵ,δ∈(0,1)，学习算法能在多项式数量的样本和时间内，找到满足R(h)≤ϵ的假设，并且这种情况发生的概率至少为1−δ，则称假设类 H是 PAC 可学习的。</p>
<h3 data-id="heading-11">解释</h3>
<p>PAC 框架告诉我们：</p>
<ol>
<li>ϵ控制“学习有多准”：</li>
</ol>
<p>越小代表模型越接近真实目标函数。</p>
<ol start="2">
<li>1−δ控制“学习有多稳”：</li>
</ol>
<p>1−δ是置信度，表示这种近似正确结果发生的概率。</p>
<ol start="3">
<li>样本复杂度：</li>
</ol>
<ul>
<li>为了达到 PAC 学习目标，所需样本数量依赖于假设空间复杂度和参数 (ϵ,δ)。</li>
<li>若假设空间 VC 维为h，则所需样本数为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>O</mi><mrow><mo fence="true">(</mo><mfrac><mrow><mi>h</mi><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>ϵ</mi><mo stretchy="false">)</mo><mo>+</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>δ</mi><mo stretchy="false">)</mo></mrow><mi>ϵ</mi></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">m = O\left(\frac{h \log(1/\epsilon) + \log(1/\delta)}{\epsilon}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ϵ</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mop mtight"><span class="mtight">l</span><span class="mtight">o</span><span class="mtight" style="margin-right:0.01389em;">g</span></span><span class="mopen mtight">(</span><span class="mord mtight">1/</span><span class="mord mathnormal mtight">ϵ</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mop mtight"><span class="mtight">l</span><span class="mtight">o</span><span class="mtight" style="margin-right:0.01389em;">g</span></span><span class="mopen mtight">(</span><span class="mord mtight">1/</span><span class="mord mathnormal mtight" style="margin-right:0.03785em;">δ</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></li>
</ul>
<h3 data-id="heading-12">PAC 学习的两种设定</h3>
<p>实现型 PAC 学习（Realizable Case）</p>
<ul>
<li>假设存在一个真实的目标函数 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>∈</mo><mi>H</mi></mrow><annotation encoding="application/x-tex">f∈H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span>。</li>
<li>目标是找到与 f 接近的假设 h。</li>
<li>常用于理论分析。</li>
</ul>
<p>不可实现型 PAC 学习（Agnostic PAC）</p>
<ul>
<li>现实中目标函数未必在假设空间 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span> 内。</li>
<li>目标改为找到一个假设，使其误差接近 H 中最优假设的误差：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>≤</mo><msub><mrow><mi>min</mi><mo>⁡</mo></mrow><mrow><msup><mi>h</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>∈</mo><mi mathvariant="script">H</mi></mrow></msub><mi>R</mi><mo stretchy="false">(</mo><msup><mi>h</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">R(h) \leq \min_{h' \in \mathcal{H}} R(h') + \epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"/><span class="mop"><span class="mop">min</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mathcal mtight" style="margin-right:0.00965em;">H</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1774em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">ϵ</span></span></span></span></span></li>
<li>更符合真实机器学习场景。</li>
</ul>
<h3 data-id="heading-13">PAC 学习的意义</h3>
<ol>
<li>理论保证：提供了判断某个假设类能否学好的数学标准。</li>
<li>样本复杂度：解释了为什么更复杂的模型需要更多数据。</li>
<li>泛化能力：揭示了为什么经验误差小并不等于泛化误差小。</li>
<li>与 VC 维的关系：</li>
</ol>
<ul>
<li>有限 VC 维 ⇔ PAC 可学习。</li>
<li>这是统计学习理论中的一个核心定理。</li>
</ul>
<p>示例</p>
<ul>
<li>一维阈值分类器：VC 维为 2，因此是 PAC 可学习的，且所需样本数较少。</li>
<li>二维线性分类器：VC 维为 3，也可 PAC 学习。</li>
<li>神经网络：假设空间复杂度极高，VC 维巨大，但在足够多样本下也满足 PAC 框架。</li>
</ul>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我是如何在2025年零基础开启“氛围编程”的]]></title>    <link>https://juejin.cn/post/7593254419078381608</link>    <guid>https://juejin.cn/post/7593254419078381608</guid>    <pubDate>2026-01-10T09:53:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593254419078381608" data-draft-id="7593262196844019764" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我是如何在2025年零基础开启“氛围编程”的"/> <meta itemprop="keywords" content="VibeCoding"/> <meta itemprop="datePublished" content="2026-01-10T09:53:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bytebeats"/> <meta itemprop="url" content="https://juejin.cn/user/463698667655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我是如何在2025年零基础开启“氛围编程”的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/463698667655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bytebeats
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T09:53:58.000Z" title="Sat Jan 10 2026 09:53:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">在 2025 年, 我借助借助终极谷歌Antigravity指南, 零基础开启了“氛围编程”之旅. 探索Gemini + Claude Code工作流是如何超越标准ChatGPT的, 以至无需编写任何代码即可构建真实应用工具.</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdd0a6fcb6ef4a8e94b00f70a5854321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0ZWJlYXRz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768643637&amp;x-signature=uAQSE4eP%2FmCzWyiuHqH1Jr%2B56Ac%3D" alt="Vibe coding is a new approach to programming where you collaborate with AI to build software using plain language." loading="lazy"/></p>
<p>氛围编程是一种新型编程方式, 通过与AI协作使用自然语言构建软件.</p>
<p><em>社交媒体正被“氛围编程”风潮席卷——人们无需亲自编写代码, 就能创建复杂仪表盘, 实用工具及盈利性全功能应用.</em></p>
<p>若你被信息洪流淹没, 请不必担忧. 其操作流程出乎意料地简单.</p>
<p>我测试过众多工作流, 对于零基础用户, 这套<strong>杀手级组合</strong>堪称智能编程的终极方案: 它融合了<strong>Gemini 3 Pro</strong>的规划能力与<strong>Claude Code</strong>的执行力, 并全部部署在谷歌的<strong>Antigravity</strong>平台上.</p>
<blockquote>
<p>目标:让零编程基础者也能通过自然语言构建机器人, 工具或SaaS产品.</p>
</blockquote>
<h2 data-id="heading-1">第一部分: 环境搭建</h2>
<h2 data-id="heading-2">1. 安装Google Antigravity</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d10c87a1f87a4238ab2d11de4e63082f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0ZWJlYXRz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768643637&amp;x-signature=sLRbcOMqPLBGHQTwBBo0q5A8ACY%3D" alt="" loading="lazy"/></p>
<p>Google Antigravity SS</p>
<p><strong>下载地址:</strong>  <a href="https://link.juejin.cn?target=https%3A%2F%2Fantigravity.google%2Fdownload" target="_blank" title="https://antigravity.google/download" ref="nofollow noopener noreferrer">antigravity.google/download</a></p>
<p>Antigravity是核心基础. 技术上它属于<strong>IDE</strong>, 但实际更像一个<strong>智能工作空间</strong>.</p>
<p>不同于传统代码编辑器(如VS Code或Cursor), Antigravity专为自然语言交互设计. 你可用普通英语与AI对话, 它将在后台处理文件管理和执行任务. 目前这是非技术创作者最友好的入门入口.</p>
<h2 data-id="heading-3">2. 通过Claude Code实现功能升级</h2>
<p>虽然Antigravity自带Gemini, 但集成<strong>Claude Code</strong>能将能力提升到全新高度.</p>
<p><strong>什么是Claude Code?</strong> 这是驻留在终端的智能编码助手. 不同于标准网页端LLM, Claude Code能自主执行工程任务, 管理本地文件, 配置数据库, 处理身份验证及调用API.</p>
<p><strong>安装步骤:</strong></p>
<ol>
<li>打开Antigravity.</li>
<li>进入左侧栏的<strong>扩展</strong>选项卡.</li>
<li>搜索 <strong>“Claude Code for VS Code”</strong> 并安装.</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb33cbc359bc409a893ea4701ff0629c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0ZWJlYXRz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768643637&amp;x-signature=RgCiYgyyP%2FKwCzQHedjJggrjcOs%3D" alt="" loading="lazy"/></p>
<p>增强版SS: Antigravity集成Claude Code for VS Code的界面</p>
<ul>
<li><em>注意: 由于Antigravity与VS Code生态兼容, 该扩展可无缝运行.</em></li>
</ul>
<h2 data-id="heading-4">3. 初始化项目</h2>
<ol>
<li>点击 <strong>打开文件夹</strong> 并选择(或创建)存放项目文件的目录.</li>
<li>打开终端(切换底部面板, 查找终端图标, 或使用快捷键 Ctrl + `).</li>
<li>输入 <code>Claude</code> 并按下 <strong>Enter</strong>.</li>
<li>按提示登录(需订阅 Claude Pro 服务).</li>
</ol>
<p>当命令行界面(CLI)显示Claude标识后, 即可开始构建.</p>
<h2 data-id="heading-5">第二部分: 工作流(规划者 vs 执行者)</h2>
<p>为高效构建专业级软件, 你将采用双AI工作流. 该模式复刻真实工程团队架构: <strong>架构师</strong>(Gemini)与<strong>工程师</strong>(Claude).</p>
<h2 data-id="heading-6">架构师: Gemini 3 Pro</h2>
<p>位于Antigravity界面右侧的Gemini担任<strong>规划师</strong>角色.</p>
<ul>
<li><strong>职责:</strong> 高层级逻辑设计, 需求收集及制定实施方案.</li>
<li><strong>模型:</strong> 使用<strong>Gemini 3 Pro (High)</strong>. 该模型推理能力卓越, 且关键的是不消耗Claude积分.</li>
</ul>
<h2 data-id="heading-7">工程师: Claude Code</h2>
<p>位于底部终端区域.</p>
<ul>
<li><strong>职责:</strong> 执行计划, 编写实际代码, 调试及运行应用程序.</li>
</ul>
<h2 data-id="heading-8">第三部分: 构建指南(分步操作)</h2>
<p>遵循此循环将创意转化为可运行应用:</p>
<h2 data-id="heading-9">步骤1: 蓝图规划(Gemini)</h2>
<p>在Gemini对话框(右侧面板)中编写详细提示说明应用需求, 包含:</p>
<ul>
<li>核心功能与特性.</li>
<li>特定API接口, 文档链接或设计偏好.</li>
<li><strong>关键指令:</strong> 要求Gemini在新文件夹内生成<strong>详细实施计划</strong>. 明确声明: <em>“请勿编写代码. 创建可供Claude Code读取并执行的分步任务清单与架构方案. ”</em></li>
</ul>
<h2 data-id="heading-10">步骤二: 执行阶段(Claude)</h2>
<p>切换至终端(底部面板)并向Claude发出指令:</p>
<blockquote>
<p><em>“嘿Claude, 查阅Gemini创建的文件夹中的实施计划. 阅读理解需求后, 按步骤执行代码.”</em></p>
</blockquote>
<p>Claude将作为自主执行者: 配置环境, 编写文件并启动服务器.</p>
<h2 data-id="heading-11">步骤三: 迭代与成本管理</h2>
<p><strong>Claude Code</strong>功能强大但消耗信用点. 为优化工作流程并节省开支:</p>
<ul>
<li><strong>复杂逻辑处理:</strong> 使用Claude. 若需支付处理, 数据库连接或身份验证系统, 交由Claude处理.</li>
<li><strong>处理简单修改:</strong> 使用Gemini. 若需调整颜色, 更新文本或添加基础输入, 可让Gemini编写代码.</li>
<li><strong>代码交接:</strong> 可要求Gemini编写特定代码块并将其作为注释添加至文件, 随后告知Claude: <em>“应用注释中的修改内容.”</em></li>
</ul>
<h2 data-id="heading-12">总结</h2>
<p>你现拥有两款协同运作的高级AI: 一者负责思考规划, 另一者专司编码构建.</p>
<p>即便遇到错误, 该组合通常可通过简单指令实现自我修正, 例如: <em>“修复你刚遇到的错误.”</em></p>
<p>好吧, 今天的内容就分享到这里啦!</p>
<p>一家之言, 欢迎拍砖!</p>
<p>Happy coding! Stay GOLDEN!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（31）Hibernate的原生SQL查询是什么？]]></title>    <link>https://juejin.cn/post/7593165280488833065</link>    <guid>https://juejin.cn/post/7593165280488833065</guid>    <pubDate>2026-01-09T13:47:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488833065" data-draft-id="7593098101432795190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（31）Hibernate的原生SQL查询是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:47:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（31）Hibernate的原生SQL查询是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:47:44.000Z" title="Fri Jan 09 2026 13:47:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的原生SQL查询</h3>
<p>在某些情况下，HQL（Hibernate Query Language）或Criteria API可能无法满足复杂查询的需要，这时可以使用原生SQL查询（Native SQL Query）。原生SQL查询允许开发者直接编写SQL语句，并通过Hibernate执行这些语句，将结果映射为实体类或自定义结果集。</p>
<h3 data-id="heading-1">使用原生SQL查询</h3>
<p>原生SQL查询主要分为两种：</p>
<ol>
<li><strong>实体查询</strong>：返回实体对象。</li>
<li><strong>非实体查询</strong>：返回自定义对象或投影结果。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>我们将定义两个实体类：<code>Person</code> 和 <code>Address</code>。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-5">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-6">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-8">使用原生SQL查询示例</h3>
<h4 data-id="heading-9">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">使用原生SQL查询</h4>
<h5 data-id="heading-11">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM person"</span>;
            NativeQuery&lt;Person&gt; query = session.createNativeQuery(sql, Person.class);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-12">使用投影查询返回自定义结果</h5>
<p>假设我们只想查询Person的姓名和年龄，而不是整个实体，这时可以使用投影查询（Projection Query）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL投影查询</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT name, age FROM person"</span>;
            NativeQuery&lt;Object[]&gt; query = session.createNativeQuery(sql);
            List&lt;Object[]&gt; results = query.getResultList();
            System.out.println(<span class="hljs-string">"Query person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-13">原生SQL查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用原生SQL查询所有Person记录并映射为<code>Person</code>实体。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：Netty通信]]></title>    <link>https://juejin.cn/post/7593164154631815177</link>    <guid>https://juejin.cn/post/7593164154631815177</guid>    <pubDate>2026-01-09T12:13:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593164154631815177" data-draft-id="7593164154631798793" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：Netty通信"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2026-01-09T12:13:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：Netty通信
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:13:27.000Z" title="Fri Jan 09 2026 12:13:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前文中我们了解了 Flink 的数据交互过程，上游的 Task 将数据写入到 ResultSubpartition 的 buffers 队列中。下游的 Task 通过 LocalInputChannel 和 RemoteInputChannel 消费上游的数据。</p>
<p>LocalInputChannel 是上下游的 Task 部署在同一个 TaskManager 时使用的，在本地即可完成数据交换，无需网络通信。当上下游的 Task 部署在不同的 TaskManager 时，就需要用到 RemoteInputChannel，Flink 利用 Netty 来进行数据交互。本文我们来一起梳理一下 Netty 相关的源码。</p>
<h3 data-id="heading-0">初始化</h3>
<p>我们先来看 NettyServer 和 NettyClient 的初始化过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ba4706fbb604cc5884638aaad02c95b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=ro8kY7ZVGC%2BQRjha4Mu06IgMWMI%3D" alt="NettyInit" loading="lazy"/></p>
<p>Netty 的初始化阶段是在 TaskManager 启动的过程中执行的。在 <code>TaskManagerServices.fromConfiguration</code> 方法中，会创建并启动 ShuffleEnvironment。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> TaskManagerServices <span class="hljs-title function_ invoke__">fromConfiguration</span>(
        TaskManagerServicesConfiguration taskManagerServicesConfiguration,
        PermanentBlobService permanentBlobService,
        MetricGroup taskManagerMetricGroup,
        ExecutorService ioExecutor,
        ScheduledExecutor scheduledExecutor,
        FatalErrorHandler fatalErrorHandler,
        WorkingDirectory workingDirectory)
        throws <span class="hljs-built_in">Exception</span> {
    ...

    <span class="hljs-keyword">final</span> ShuffleEnvironment<span class="hljs-meta">&lt;?</span>, <span class="hljs-meta">?&gt;</span> shuffleEnvironment =
            <span class="hljs-title function_ invoke__">createShuffleEnvironment</span>(
                    taskManagerServicesConfiguration,
                    taskEventDispatcher,
                    taskManagerMetricGroup,
                    ioExecutor,
                    scheduledExecutor);
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> listeningDataPort = shuffleEnvironment.<span class="hljs-title function_ invoke__">start</span>();
    ...
}
</code></pre>
<p>我们顺着调用链路可以一直找到 <code>NettyShuffleServiceFactory.createNettyShuffleEnvironment</code> 方法，这个方法中创建了 NettyConnectionManager，在 NettyConnectionManager 中有几个很重要的对象。</p>
<pre><code class="hljs language-ini" lang="ini">public NettyConnectionManager(
        NettyBufferPool bufferPool,
        ResultPartitionProvider partitionProvider,
        TaskEventPublisher taskEventPublisher,
        NettyConfig nettyConfig,
        boolean connectionReuseEnabled) {

    <span class="hljs-attr">this.server</span> = new NettyServer(nettyConfig)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.client</span> = new NettyClient(nettyConfig)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.bufferPool</span> = checkNotNull(bufferPool)<span class="hljs-comment">;</span>

    <span class="hljs-attr">this.partitionRequestClientFactory</span> =
            new PartitionRequestClientFactory(
                    client, nettyConfig.getNetworkRetries(), connectionReuseEnabled)<span class="hljs-comment">;</span>

    <span class="hljs-attr">this.nettyProtocol</span> =
            new NettyProtocol(
                    checkNotNull(partitionProvider), checkNotNull(taskEventPublisher))<span class="hljs-comment">;</span>
}
</code></pre>
<p>server 和 client 不需要多介绍，就是 Netty 的服务端和客户端。bufferPool 是缓冲池，用于存储要传输的数据。nettyProtocol 提供了 NettyClient 和 NettyServer 引导启动注册的 Channel Handler。</p>
<p>后面就是创建 NettyShuffleEnvironment 及其需要的对象了。在创建完成后，会调用它的 start 方法启动。这个启动方法就是调用了 <code>connectionManager.start</code>，在 NettyConnectionManager 中，就是初始化客户端和服务端。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">start</span>() throws IOException</span> {
    client.<span class="hljs-keyword">init</span>(nettyProtocol, bufferPool);

    <span class="hljs-keyword">return</span> server.<span class="hljs-keyword">init</span>(nettyProtocol, bufferPool);
}
</code></pre>
<h4 data-id="heading-1">client 初始化</h4>
<p>client 的初始化过程是先创建并初始化 Bootstrap。</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">initEpollBootstrap</span>() {
    <span class="hljs-comment">// Add the server port number to the name in order to distinguish</span>
    <span class="hljs-comment">// multiple clients running on the same host.</span>
    String name =
            NettyConfig<span class="hljs-selector-class">.CLIENT_THREAD_GROUP_NAME</span> + " (" + config.getServerPortRange() + ")";

    EpollEventLoopGroup epollGroup =
            new <span class="hljs-built_in">EpollEventLoopGroup</span>(
                    config.getClientNumThreads(), NettyServer<span class="hljs-selector-class">.getNamedThreadFactory</span>(name));
    bootstrap<span class="hljs-selector-class">.group</span>(epollGroup)<span class="hljs-selector-class">.channel</span>(EpollSocketChannel.class);

    config<span class="hljs-selector-class">.getTcpKeepIdleInSeconds</span>()
            <span class="hljs-selector-class">.ifPresent</span>(idle -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPIDLE, idle));
    config<span class="hljs-selector-class">.getTcpKeepInternalInSeconds</span>()
            <span class="hljs-selector-class">.ifPresent</span>(
                    interval -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPINTVL, interval));
    config<span class="hljs-selector-class">.getTcpKeepCount</span>()
            <span class="hljs-selector-class">.ifPresent</span>(count -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPCNT, count));
}
</code></pre>
<p>初始化过程重要设置 EventLoopGroup 和 channel，可以用 epoll 的话就用 epoll，否则就用 nio。设置好这些后就是设置了一些通道参数（连接超时时间、Bufffer 池等）。</p>
<p>到这里 client 的初始化其实并没有结束，还需要设置 Handler 流水线，这些工作是在 Task 启动时执行了。</p>
<h4 data-id="heading-2">server 初始化</h4>
<p>server 的初始化过程是先创建并初始化了 ServerBootstrap。之后同样也是设置 EventLoopGroup 和 channel，以及通道相关的各种参数。</p>
<p>设置好之后，会添加 ChannelHandler 流水线，这里的 ChannelHandler 流水线就是我们前面创建的 NettyProtocol 提供的。</p>
<pre><code class="hljs language-ini" lang="ini">public ChannelHandler<span class="hljs-section">[]</span> getServerChannelHandlers() {
    PartitionRequestQueue <span class="hljs-attr">queueOfPartitionQueues</span> = new PartitionRequestQueue()<span class="hljs-comment">;</span>
    PartitionRequestServerHandler <span class="hljs-attr">serverHandler</span> =
            new PartitionRequestServerHandler(
                    partitionProvider, taskEventPublisher, queueOfPartitionQueues)<span class="hljs-comment">;</span>

    return new ChannelHandler<span class="hljs-section">[]</span> {
        messageEncoder,
        new NettyMessage.NettyMessageDecoder(),
        serverHandler,
        queueOfPartitionQueues
    }<span class="hljs-comment">;</span>
}
</code></pre>
<p>流水线上包含了消息编码器、解码器、PartitionRequestServerHandler 请求服务端处理器和 PartitionRequestQueue 分区请求队列。</p>
<p>这些都设置好之后，就开始启动 NettyServer 服务了。</p>
<pre><code class="hljs language-scss" lang="scss">Iterator&lt;Integer&gt; portsIterator = config<span class="hljs-selector-class">.getServerPortRange</span>()<span class="hljs-selector-class">.getPortsIterator</span>();
while (portsIterator.hasNext() &amp;&amp; bindFuture == null) {
    Integer port = portsIterator<span class="hljs-selector-class">.next</span>();
    LOG<span class="hljs-selector-class">.debug</span>("Trying to bind Netty server to port: {}", port);

    bootstrap<span class="hljs-selector-class">.localAddress</span>(config.getServerAddress(), port);
    try {
        bindFuture = bootstrap<span class="hljs-selector-class">.bind</span>()<span class="hljs-selector-class">.syncUninterruptibly</span>();
    } catch (Exception e) {
        <span class="hljs-comment">// syncUninterruptibly() throws checked exceptions via Unsafe</span>
        <span class="hljs-comment">// continue if the exception is due to the port being in use, fail early</span>
        <span class="hljs-comment">// otherwise</span>
        if (isBindFailure(e)) {
            LOG<span class="hljs-selector-class">.debug</span>("Failed to bind Netty server", e);
        } else {
            throw e;
        }
    }
}

if (bindFuture == null) {
    throw new <span class="hljs-built_in">BindException</span>(
            "Could not start rest endpoint on any port in port range "
                    + config.getServerPortRange());
}

localAddress = (InetSocketAddress) bindFuture<span class="hljs-selector-class">.channel</span>()<span class="hljs-selector-class">.localAddress</span>();
</code></pre>
<h3 data-id="heading-3">客户端请求远端子分区</h3>
<p>服务端和客户端初始化之后，在 Task 运行时，会先完成 Client 的 ChannelHandler 的配置，然后请求 Netty 远端服务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b99d38c65200487f8f5f1d7e05cc2b36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=7ig7BNFyUGozffh2yuryKQkj%2FHo%3D" alt="NettyRequestPartition" loading="lazy"/></p>
<p>我们来看具体过程，在 Task 初始化时，会调用 <code>StreamTask.invoke</code> 方法，其内部会调用 <code>StreamTask.restoreStateAndGate</code> 方法，这里会便利 Task 的所有 InputGate，然后调用 requestPartitions。在 InputGate 的 requestPartitions 逻辑中，又便利所有的 InputChannel，调用 requestSubpartitions。</p>
<pre><code class="hljs language-scss" lang="scss">for (InputGate inputGate : inputGates) {
    recoveredFutures<span class="hljs-selector-class">.add</span>(inputGate.getStateConsumedFuture());

    inputGate
            <span class="hljs-selector-class">.getStateConsumedFuture</span>()
            <span class="hljs-selector-class">.thenRun</span>(
                    () -&gt;
                            mainMailboxExecutor<span class="hljs-selector-class">.execute</span>(
                                    inputGate::requestPartitions,
                                    "Input gate request partitions"));
}


private void <span class="hljs-built_in">internalRequestPartitions</span>() {
    for (InputChannel inputChannel : inputChannels()) {
        try {
            inputChannel<span class="hljs-selector-class">.requestSubpartitions</span>();
        } catch (Throwable t) {
            inputChannel<span class="hljs-selector-class">.setError</span>(t);
            return;
        }
    }
}
</code></pre>
<p>我们来看 <code>RemoteInputChannel.requestSubpartitions</code> 的逻辑。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestSubpartitions</span>() throws IOException, InterruptedException</span> {
    <span class="hljs-keyword">if</span> (partitionRequestClient == <span class="hljs-literal">null</span>) {
        LOG.debug(
                <span class="hljs-string">"{}: Requesting REMOTE subpartitions {} of partition {}. {}"</span>,
                <span class="hljs-keyword">this</span>,
                consumedSubpartitionIndexSet,
                partitionId,
                channelStatePersister);
        <span class="hljs-comment">// Create a client and request the partition</span>
        <span class="hljs-keyword">try</span> {
            partitionRequestClient =
                    connectionManager.createPartitionRequestClient(connectionId);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-comment">// IOExceptions indicate that we could not open a connection to the remote</span>
            <span class="hljs-comment">// TaskExecutor</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> PartitionConnectionException(partitionId, e);
        }

        partitionRequestClient.requestSubpartition(
                partitionId, consumedSubpartitionIndexSet, <span class="hljs-keyword">this</span>, <span class="hljs-number">0</span>);
    }
}
</code></pre>
<p>这里主要有两个步骤，先是创建 partitionRequestClient，然后调用 requestSubpartition。</p>
<h4 data-id="heading-4">创建请求客户端</h4>
<p>PartitionRequestClient 是在 <code>PartitionRequestClientFactory.connect</code> 中创建的。先调用了 <code>NettyClient.connect</code>，同步等待客户端连接到服务端，这个过程中会进行 ChannelHandler 配置，也就是我们在初始化的过程中介绍的，NettyClient 没有完成的步骤。</p>
<pre><code class="hljs language-scss" lang="scss">public ChannelHandler<span class="hljs-selector-attr">[]</span> <span class="hljs-built_in">getClientChannelHandlers</span>() {
    NetworkClientHandler networkClientHandler = new <span class="hljs-built_in">CreditBasedPartitionRequestClientHandler</span>();

    return new ChannelHandler<span class="hljs-selector-attr">[]</span> {
        messageEncoder,
        new <span class="hljs-built_in">NettyMessageClientDecoderDelegate</span>(networkClientHandler),
        networkClientHandler
    };
}
</code></pre>
<p>Handler 包括了消息编码器、解码器和 CreditBasedPartitionRequestClientHandler 这个基于 Credit 的分区请求客户端处理器。Handler 配置好之后会利用 bootstrap 连接到服务端。</p>
<p>在获取到 Channel 和 NetworkClientHandler 之后，就直接创建了 NettyPartitionRequestClient。</p>
<h4 data-id="heading-5">请求子分区数据</h4>
<p>让我们再回到 RemoteInputChannel 的 requestSubpartitions 方法中，现在我们创建好了 NettyPartitionRequestClient，接下来就是调用它的 requestSubpartition 方法来发起请求。</p>
<p>这里逻辑也比较简单：</p>
<ol>
<li>向 NetworkClientHandler 注册当前 RemoteInputChannel。</li>
<li>构造请求对象 PartitionRequest，这里包含了分区 ID、子分区索引、inputChannel ID 以及初识的 Credit。</li>
<li>调用 <code>tcpChannel.writeAndFlush</code> 发起请求，并添加请求失败的监听。</li>
<li>如果请求失败，移除当前 inputChannel。</li>
</ol>
<h3 data-id="heading-6">服务端响应</h3>
<p>现在数据到了服务端，我们来看服务端处理的具体过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/339a67c8d7c64865bc109c665e60c60c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=xpUm9gskdJn323LGxtvTmcAThSc%3D" alt="NettyServerHandler" loading="lazy"/></p>
<p>在 NettyServer 初始化的过程中，我们添加了两个重要的 Handler，分别是 PartitionRequestServerHandler 和 PartitionRequestQueue。服务端响应数据的过程就是这两个 Handler 在发挥作用。</p>
<p>PartitionRequestServerHandler 负责处理 Client 端通过 PartitionRequestClient 发送的请求，处理过程是先创建 CreditBasedSequenceNumberingViewReader 类型的 reader，然后将它放入 PartitionRequestQueue 维护的 reader 队列中。PartitionRequestQueue 会监听 Netty Channel 的可写入状态，当 Netty Channel 可写入时，会消费数据并写入网络。</p>
<p>下面我们来看具体的源码。</p>
<p>服务端的响应入口在 <code>PartitionRequestServerHandler.channelRead0</code> 方法，这里在处理 PartitionRequest 请求时，先是创建 CreditBasedSequenceNumberingViewReader，然后调用 requestSubpartitionViewOrRegisterListener。</p>
<p>requestSubpartitionViewOrRegisterListener 的逻辑是创建 ResultSubpartitionView，并提醒 PartitionRequestQueue 有数据可用。</p>
<pre><code class="hljs language-ini" lang="ini">Optional&lt;ResultSubpartitionView&gt; <span class="hljs-attr">subpartitionViewOptional</span> =
        partitionProvider.createSubpartitionViewOrRegisterListener(
                resultPartitionId,
                subpartitionIndexSet,
                this,
                partitionRequestListener)<span class="hljs-comment">;</span>
...

notifyDataAvailable(subpartitionView)<span class="hljs-comment">;</span>
</code></pre>
<p>ResultSubpartitionView 就是用来消费 ResultSubpartition 的数据。</p>
<p>notifyDataAvailable 内部调用了 notifyReaderNonEmpty，notifyReaderNonEmpty 又触发了 userEventTriggered，这里调用 enqueueAvailableReader 将 reader 放入到可用队列 availableReaders 中。</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">enqueueAvailableReader</span>(final NetworkSequenceViewReader reader) throws Exception {
    if (reader.isRegisteredAsAvailable()) {
        return;
    }

    ResultSubpartitionView<span class="hljs-selector-class">.AvailabilityWithBacklog</span> availabilityWithBacklog =
            reader<span class="hljs-selector-class">.getAvailabilityAndBacklog</span>();
    if (!availabilityWithBacklog.isAvailable()) {
        int backlog = availabilityWithBacklog<span class="hljs-selector-class">.getBacklog</span>();
        if (backlog &gt; <span class="hljs-number">0</span> &amp;&amp; reader.needAnnounceBacklog()) {
            <span class="hljs-built_in">announceBacklog</span>(reader, backlog);
        }
        return;
    }

    <span class="hljs-comment">// Queue an available reader for consumption. If the queue is empty,</span>
    <span class="hljs-comment">// we try trigger the actual write. Otherwise this will be handled by</span>
    <span class="hljs-comment">// the writeAndFlushNextMessageIfPossible calls.</span>
    boolean triggerWrite = availableReaders<span class="hljs-selector-class">.isEmpty</span>();
    <span class="hljs-built_in">registerAvailableReader</span>(reader);

    if (triggerWrite) {
        <span class="hljs-built_in">writeAndFlushNextMessageIfPossible</span>(ctx.channel());
    }
}
</code></pre>
<p>如果 reader 是队列中的第一个元素，会触发数据写入网络。</p>
<p>writeAndFlushNextMessageIfPossible 的处理步骤如下：</p>
<ol>
<li>取出可用 reader。</li>
<li>调用 <code>reader.getNextBuffer</code> 获取数据。</li>
<li>如果 reader 仍然可用，将其加回队列。</li>
<li>向下游写入数据并添加下次写入的监听。</li>
</ol>

<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> BufferAndAvailability <span class="hljs-title function_">getNextBuffer</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">BufferAndBacklog</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> subpartitionView.getNextBuffer();
    <span class="hljs-keyword">if</span> (next != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (next.buffer().isBuffer() &amp;&amp; --numCreditsAvailable &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"no credit available"</span>);
        }

        <span class="hljs-keyword">final</span> Buffer.<span class="hljs-type">DataType</span> <span class="hljs-variable">nextDataType</span> <span class="hljs-operator">=</span> getNextDataType(next);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferAndAvailability</span>(
                next.buffer(), nextDataType, next.buffersInBacklog(), next.getSequenceNumber());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p>在 getNextBuffer 方法中，会将 credit 值减 1，并判断是否小于 0。如果小于 0 会抛出异常，reader 是否可用也是根据 numCreditsAvailable 是否大于 0 来判断的。</p>
<h3 data-id="heading-7">客户端接收数据</h3>
<p>NettyClient 在消费数据时，同样也是以 ChannelHandler 作为入口。这里的入口方法是 <code>CreditBasedPartitionRequestClientHandler.channelRead</code> 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e3e211ea7d445e8a040cfd2e5bac1dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=QzLjqwFQqFXMQxN4wlfezdFTli4%3D" alt="NettyClientHandler" loading="lazy"/></p>
<p>在 decodeMsg 方法中，先解码 msg，判断 InputChannel 是否可用，如果不可用，则取消当前 InputChannel 的订阅。如果可用，继续调用 decodeBufferOrEvent 进行处理。decodeBufferOrEvent 的核心逻辑是调用 <code>RemoteInputChannel.onBuffer</code> 方法，将数据加入到 receivedBuffers 队列。</p>
<p>如果 receivedBuffers 队列在此之前处于空闲状态，会调用 notifyChannelNonEmpty，将当前 RemoteInputChannel 加入到 inputChannelsWithData 队列中，同时还会唤醒 inputChannelsWithData 上的阻塞线程，让 inputGate 可以消费 RemoteInputChannel 的数据。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> boolean <span class="hljs-title">queueChannelUnsafe</span>(<span class="hljs-params">InputChannel channel, boolean priority</span>)</span> {
    assert Thread.holdsLock(inputChannelsWithData);
    <span class="hljs-keyword">if</span> (channelsWithEndOfPartitionEvents.<span class="hljs-keyword">get</span>(channel.getChannelIndex())) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    final boolean alreadyEnqueued =
            enqueuedInputChannelsWithData.<span class="hljs-keyword">get</span>(channel.getChannelIndex());
    <span class="hljs-keyword">if</span> (alreadyEnqueued
            &amp;&amp; (!priority || inputChannelsWithData.containsPriorityElement(channel))) {
        <span class="hljs-comment">// already notified / prioritized (double notification), ignore</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 当前 inputChannel 加入到 inputChannelsWithData</span>
    inputChannelsWithData.<span class="hljs-keyword">add</span>(channel, priority, alreadyEnqueued);
    <span class="hljs-keyword">if</span> (!alreadyEnqueued) {
        enqueuedInputChannelsWithData.<span class="hljs-keyword">set</span>(channel.getChannelIndex());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// 唤醒线程</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyDataAvailable</span>()</span> {
    availabilityMonitor.notifyAll();
    toNotify = inputGate.availabilityHelper.getUnavailableToResetAvailable();
}
</code></pre>
<p>如果客户端有积压，还需要根据积压申请 Buffer 并更新 Credit 值。这里申请的 buffer 数量为积压数量+初识 Credit 值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSenderBacklog</span><span class="hljs-params">(<span class="hljs-type">int</span> backlog)</span> <span class="hljs-keyword">throws</span> IOException {
    notifyBufferAvailable(bufferManager.requestFloatingBuffers(backlog + initialCredit));
}
</code></pre>
<p>如果 RemoteInputChannel 没有足够的 buffer，则会向 LocalBufferPool 申请新的 buffer，如果申请不到，会加一个监听，等 LocalBufferPool 有空闲时再触发申请 buffer。</p>
<pre><code class="hljs language-ini" lang="ini">private int tryRequestBuffers() {
    assert Thread.holdsLock(bufferQueue)<span class="hljs-comment">;</span>

    int <span class="hljs-attr">numRequestedBuffers</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    while (bufferQueue.getAvailableBufferSize() &lt; numRequiredBuffers
            &amp;&amp; !isWaitingForFloatingBuffers) {
        BufferPool <span class="hljs-attr">bufferPool</span> = inputChannel.inputGate.getBufferPool()<span class="hljs-comment">;</span>
        Buffer <span class="hljs-attr">buffer</span> = bufferPool.requestBuffer()<span class="hljs-comment">;</span>
        if (buffer != null) {
            bufferQueue.addFloatingBuffer(buffer)<span class="hljs-comment">;</span>
            numRequestedBuffers++<span class="hljs-comment">;</span>
        } else if (bufferPool.addBufferListener(this)) {
            <span class="hljs-attr">isWaitingForFloatingBuffers</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
            break<span class="hljs-comment">;</span>
        }
    }
    return numRequestedBuffers<span class="hljs-comment">;</span>
}
</code></pre>
<p>当 RemoteInputChannel 申请到了需要的 buffer 之后，就会向 NettyServer 发送 AddCredit 消息，请求更新 Credit 值。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyCreditAvailable</span>() throws IOException</span> {
    checkPartitionRequestQueueInitialized();

    partitionRequestClient.notifyCreditAvailable(<span class="hljs-keyword">this</span>);
}


<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyCreditAvailable</span>(<span class="hljs-params">RemoteInputChannel inputChannel</span>)</span> {
    sendToChannel(<span class="hljs-keyword">new</span> AddCreditMessage(inputChannel));
}
</code></pre>
<p>NettyServer 收到请求后，会将对应的 Credit 值进行更新。</p>
<pre><code class="hljs language-ini" lang="ini">else if (<span class="hljs-attr">msgClazz</span> == AddCredit.class) {
    AddCredit <span class="hljs-attr">request</span> = (AddCredit) msg<span class="hljs-comment">;</span>

    outboundQueue.addCreditOrResumeConsumption(
            request.receiverId, reader -&gt; reader.addCredit(request.credit))<span class="hljs-comment">;</span>
}

void addCreditOrResumeConsumption(
        InputChannelID receiverId, Consumer&lt;NetworkSequenceViewReader&gt; operation)
        throws Exception {
    if (fatalError) {
        return<span class="hljs-comment">;</span>
    }

    NetworkSequenceViewReader <span class="hljs-attr">reader</span> = obtainReader(receiverId)<span class="hljs-comment">;</span>

    operation.accept(reader)<span class="hljs-comment">;</span>
    enqueueAvailableReader(reader)<span class="hljs-comment">;</span>
}


public void addCredit(int creditDeltas) {
    numCreditsAvailable += creditDeltas<span class="hljs-comment">;</span>
}
</code></pre>
<p>此外，Flink 还有两种场景会更新 Credit 值。</p>
<p>一种是 LocalBufferPool 回收空闲 buffer 时，会将 buffer 分配给申请者，分配之后会调用对应 InputChannel 的 notifyBufferAvailable 方法通知更新 Credit。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91654d63dada40089adc39ddeaa32f16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=%2B6Q5%2FPKgLnUQeBSJ7%2BBwQflI7Ik%3D" alt="LocalBufferPool" loading="lazy"/></p>
<p>另一种是 RemoteInputChannel 独占的 buffer 队列释放 buffer 时，会触发 Credit 更新。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c5cb9fddc0d4e18802107951125230b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=T4scDtDnWrMIvABCUiom8RV0bTQ%3D" alt="BufferManager" loading="lazy"/></p>
<h3 data-id="heading-8">反压</h3>
<p>通过前面的学习，我们其实已经理解了反压的机制了。当前 Flink 的反压就是通过 Credit 来实现反压的，如果下游数据处理速度慢，Credit 会被耗尽，上游也就不会继续处理和下发数据了。直到下游处理完成，有了空闲的 buffer，此时向上游反馈更新 Credit 值，上游就会继续处理数据。</p>
<h3 data-id="heading-9">总结</h3>
<p>最后我们总结一下，本文我们一起梳理了 Flink Netty 相关的源码。包括 NettyClient 和 NettyServer 的初始化，初始化过程中会创建一系列 ChannelHandler，之后利用这些Handler 处理数据，数据处理包括 Client 端的发送和接收消息，Server 端处理消息的过程。中间还穿插着 Credit 的处理。Flink 的反压逻辑就是依赖于 Credit 来实现的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（31）Hibernate的原生SQL查询是什么？]]></title>    <link>https://juejin.cn/post/7593145583348105258</link>    <guid>https://juejin.cn/post/7593145583348105258</guid>    <pubDate>2026-01-09T13:47:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593145583348105258" data-draft-id="7593098101432778806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（31）Hibernate的原生SQL查询是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:47:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（31）Hibernate的原生SQL查询是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:47:01.000Z" title="Fri Jan 09 2026 13:47:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的原生SQL查询</h3>
<p>在某些情况下，HQL（Hibernate Query Language）或Criteria API可能无法满足复杂查询的需要，这时可以使用原生SQL查询（Native SQL Query）。原生SQL查询允许开发者直接编写SQL语句，并通过Hibernate执行这些语句，将结果映射为实体类或自定义结果集。</p>
<h3 data-id="heading-1">使用原生SQL查询</h3>
<p>原生SQL查询主要分为两种：</p>
<ol>
<li><strong>实体查询</strong>：返回实体对象。</li>
<li><strong>非实体查询</strong>：返回自定义对象或投影结果。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>我们将定义两个实体类：<code>Person</code> 和 <code>Address</code>。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-5">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-6">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-8">使用原生SQL查询示例</h3>
<h4 data-id="heading-9">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">使用原生SQL查询</h4>
<h5 data-id="heading-11">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM person"</span>;
            NativeQuery&lt;Person&gt; query = session.createNativeQuery(sql, Person.class);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-12">使用投影查询返回自定义结果</h5>
<p>假设我们只想查询Person的姓名和年龄，而不是整个实体，这时可以使用投影查询（Projection Query）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL投影查询</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT name, age FROM person"</span>;
            NativeQuery&lt;Object[]&gt; query = session.createNativeQuery(sql);
            List&lt;Object[]&gt; results = query.getResultList();
            System.out.println(<span class="hljs-string">"Query person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-13">原生SQL查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用原生SQL查询所有Person记录并映射为<code>Person</code>实体。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SQLInsight：从JDBC底层到API调用的零侵入SQL监控方案]]></title>    <link>https://juejin.cn/post/7593232758127280134</link>    <guid>https://juejin.cn/post/7593232758127280134</guid>    <pubDate>2026-01-10T08:25:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593232758127280134" data-draft-id="7593232758127247366" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SQLInsight：从JDBC底层到API调用的零侵入SQL监控方案"/> <meta itemprop="keywords" content="后端,数据库,开源"/> <meta itemprop="datePublished" content="2026-01-10T08:25:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="踏浪无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SQLInsight：从JDBC底层到API调用的零侵入SQL监控方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    踏浪无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T08:25:40.000Z" title="Sat Jan 10 2026 08:25:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsh_wangwanbao%2Fsql-insight" target="_blank" title="https://gitee.com/sh_wangwanbao/sql-insight" ref="nofollow noopener noreferrer">gitee.com/sh_wangwanb…</a><br/>
<strong>上一篇文章</strong>：<a href="https://juejin.cn/post/7591513171199295551" target="_blank" title="https://juejin.cn/post/7591513171199295551">SQLInsight：一行依赖，自动追踪API背后的每一条SQL</a></p>
</blockquote>
<h2 data-id="heading-0">开篇</h2>
<p>上周写了一篇文章，分享了SQLInsight的设计思路和技术方案，没想到收到了不少反馈。有人问"啥时候能用"，有人问"技术细节是怎么实现的"。</p>
<p>花了小一周时间，终于把它实现出来了。今天周末，终于可以还债了。</p>
<p>这篇文章，我们来聊聊SQLInsight的技术实现细节：动态代理是怎么做的？StackTrace是怎么解析的？为什么说零侵入？性能到底如何？</p>
<p>代码已经开源，你可以直接用，也可以学习实现思路。</p>
<hr/>
<h2 data-id="heading-1">一、技术亮点速览</h2>
<p>在开始之前，先说几个核心亮点，让你知道这个项目有什么不一样：</p>
<h3 data-id="heading-2">1.1 真正的零侵入</h3>
<p>不需要在代码里加注解，不需要修改配置文件，甚至不需要加启动参数。加个依赖，启动应用，就能看到所有SQL执行情况。这是怎么做到的？答案是：<strong>在最底层做手脚</strong>。</p>
<h3 data-id="heading-3">1.2 完整的调用链自动追踪</h3>
<p>你在Controller写了个接口，调用Service，Service调用Mapper，最后执行了SQL。这整个链路，SQLInsight能自动给你串起来：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span>api<span class="hljs-operator">/</span>users<span class="hljs-operator">/</span><span class="hljs-number">123</span> 
  → UserController.getUser()
    → UserService.findById()
      → <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> (<span class="hljs-number">15</span>ms)
</code></pre>
<p>这不是靠AOP，不是靠埋点，而是靠<strong>读取线程栈</strong>。</p>
<h3 data-id="heading-4">1.3 兼容性好到让人惊讶</h3>
<p>不管你用的是MyBatis、JPA、Hibernate还是JdbcTemplate，不管你的连接池是Druid、HikariCP还是C3P0，SQLInsight都能工作。为什么？因为它代理的是JDBC标准接口，不依赖具体实现。</p>
<h3 data-id="heading-5">1.4 性能影响微乎其微</h3>
<p>动态代理？StackTrace扫描？这不会很慢吗？实测下来，单次SQL执行的额外开销在<strong>1微秒以内</strong>。怎么做到的？答案是：<strong>缓存 + 异步 + 限制扫描深度</strong>。</p>
<hr/>
<h2 data-id="heading-6">二、设计思想的来源</h2>
<p>做技术不是闭门造车，SQLInsight的核心设计思想来自两个成熟的开源组件。</p>
<h3 data-id="heading-7">2.1 动态代理：学习Seata</h3>
<p>Seata是阿里开源的分布式事务框架。它有个很巧妙的设计：通过动态代理DataSource，在JDBC层拦截所有SQL执行，实现分布式事务的透明化。</p>
<p>SQLInsight借鉴了这个思路，但做得更彻底：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[应用程序] --&gt;|调用| B[DataSourceProxy]
    B --&gt;|代理| C[ConnectionProxy]
    C --&gt;|代理| D[PreparedStatementProxy]
    D --&gt;|执行| E[真实的JDBC驱动]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#f5e1ff
</code></pre>
<p><strong>为什么这个思路好？</strong></p>
<ol>
<li><strong>最底层拦截</strong>：不管你上层用什么框架，最终都要通过JDBC执行SQL</li>
<li><strong>标准接口</strong>：JDBC是Java标准，不会随便变</li>
<li><strong>透明性好</strong>：对上层业务代码完全透明</li>
</ol>
<p>Seata代理DataSource是为了加事务控制，SQLInsight代理DataSource是为了监控。本质上是同一个思路的不同应用。</p>
<h3 data-id="heading-8">2.2 StackTrace分析：学习MyBatis</h3>
<p>MyBatis有个很强大的功能：能把SQL执行日志和Mapper方法对应起来。它怎么做的？答案是：<strong>解析StackTrace</strong>。</p>
<p>当SQL执行时，MyBatis会读取当前线程的调用栈，找到是哪个Mapper接口的哪个方法触发的。</p>
<p>SQLInsight把这个思路往上延伸了一层：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[SQL执行] --&gt;|触发| B[获取StackTrace]
    B --&gt; C{扫描调用栈}
    C --&gt;|找到| D[RestController注解]
    D --&gt; E[解析API路径]
    E --&gt; F[解析方法名]
    F --&gt; G[构建完整调用链]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#f5e1ff
    style F fill:#e1f5ff
    style G fill:#fff4e1
</code></pre>
<p><strong>为什么这个思路可行？</strong></p>
<p>Java的线程栈里包含了完整的方法调用链。通过扫描栈帧，可以找到：</p>
<ul>
<li>哪个Controller被调用了（有@RestController注解）</li>
<li>哪个Service方法被调用了</li>
<li>哪个Mapper方法被调用了</li>
</ul>
<p>这样就能把API调用和SQL执行串起来，形成完整的链路。</p>
<hr/>
<h2 data-id="heading-9">三、核心技术实现</h2>
<h3 data-id="heading-10">3.1 动态代理的三层结构</h3>
<p>JDBC的核心接口有三个：DataSource、Connection、Statement/PreparedStatement。SQLInsight为每一层都创建了代理。</p>
<h4 data-id="heading-11">3.1.1 第一层：代理DataSource</h4>
<p>这一层是入口。Spring Boot启动时，会创建DataSource Bean。我们通过<code>BeanPostProcessor</code>拦截这个过程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> {
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> DataSource) {
        <span class="hljs-comment">// 把原始DataSource包装成代理</span>
        <span class="hljs-keyword">return</span> DataSourceProxy.create((DataSource) bean, collector, handler);
    }
    <span class="hljs-keyword">return</span> bean;
}
</code></pre>
<p><strong>关键点</strong>：<code>BeanPostProcessor</code>是Spring提供的扩展点，能在Bean创建后、初始化后做一些处理。这是Spring生态常用的插件化机制。</p>
<h4 data-id="heading-12">3.1.2 第二层：代理Connection</h4>
<p>当业务代码调用<code>dataSource.getConnection()</code>时，我们返回一个代理的Connection：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"getConnection"</span>.equals(method.getName())) {
        <span class="hljs-comment">// 调用原始DataSource获取真实Connection</span>
        <span class="hljs-type">Connection</span> <span class="hljs-variable">realConnection</span> <span class="hljs-operator">=</span> (Connection) method.invoke(target, args);
        <span class="hljs-comment">// 返回代理Connection</span>
        <span class="hljs-keyword">return</span> ConnectionProxy.createProxy(realConnection, collector, handler);
    }
    <span class="hljs-keyword">return</span> method.invoke(target, args);
}
</code></pre>
<p><strong>这里用到了Java动态代理的核心机制</strong>：<code>InvocationHandler</code>。每次调用代理对象的方法时，都会进入<code>invoke</code>方法，我们可以在这里做拦截。</p>
<h4 data-id="heading-13">3.1.3 第三层：代理PreparedStatement</h4>
<p>这一层是真正执行SQL的地方。当业务代码调用<code>connection.prepareStatement(sql)</code>时：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"prepareStatement"</span>.equals(method.getName())) {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> (String) args[<span class="hljs-number">0</span>];
        <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">realStmt</span> <span class="hljs-operator">=</span> (PreparedStatement) method.invoke(target, args);
        <span class="hljs-comment">// 返回代理PreparedStatement，并把SQL传进去</span>
        <span class="hljs-keyword">return</span> PreparedStatementProxy.createProxy(realStmt, sql, collector, handler);
    }
    <span class="hljs-keyword">return</span> method.invoke(target, args);
}
</code></pre>
<p><strong>这里的细节</strong>：我们把SQL语句传给了PreparedStatement代理。这样在执行SQL时，代理就知道要执行的是什么SQL了。</p>
<h3 data-id="heading-14">3.2 SQL执行的拦截</h3>
<p>PreparedStatement代理的核心逻辑在这里：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Integer, Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-comment">// 1. 拦截参数设置方法（setString、setInt等）</span>
    <span class="hljs-keyword">if</span> (method.getName().startsWith(<span class="hljs-string">"set"</span>) &amp;&amp; args.length &gt;= <span class="hljs-number">2</span>) {
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) args[<span class="hljs-number">0</span>];
        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">1</span>];
        parameters.put(index, value);  <span class="hljs-comment">// 记录参数值</span>
    }
    
    <span class="hljs-comment">// 2. 拦截执行方法（execute、executeQuery等）</span>
    <span class="hljs-keyword">if</span> (method.getName().startsWith(<span class="hljs-string">"execute"</span>)) {
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);  <span class="hljs-comment">// 执行真实SQL</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;
        
        <span class="hljs-comment">// 3. 收集SQL执行信息</span>
        collectSqlExecution(sql, parameters, duration);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-keyword">return</span> method.invoke(target, args);
}
</code></pre>
<p><strong>这里有两个关键点</strong>：</p>
<ol>
<li><strong>参数拦截</strong>：PreparedStatement的参数是通过<code>setXxx(index, value)</code>方法设置的。我们拦截这些方法，把参数记下来。</li>
<li><strong>执行拦截</strong>：当调用<code>execute()</code>方法时，我们记录开始时间，执行SQL，然后记录结束时间，算出执行耗时。</li>
</ol>
<h3 data-id="heading-15">3.3 StackTrace解析：找到API调用者</h3>
<p>SQL执行时，我们需要知道是哪个API触发的。这里用到了StackTrace分析：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApiInfo <span class="hljs-title function_">extractApiInfo</span><span class="hljs-params">()</span> {
    StackTraceElement[] stack = Thread.currentThread().getStackTrace();
    
    <span class="hljs-comment">// 限制扫描深度，避免性能问题</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">maxDepth</span> <span class="hljs-operator">=</span> Math.min(stack.length, <span class="hljs-number">50</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxDepth; i++) {
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> stack[i].getClassName();
        
        <span class="hljs-comment">// 先查缓存</span>
        <span class="hljs-keyword">if</span> (controllerCache.containsKey(className)) {
            <span class="hljs-keyword">return</span> controllerCache.get(className);
        }
        
        <span class="hljs-comment">// 加载类，检查是否有@RestController或@Controller注解</span>
        Class&lt;?&gt; clazz = Class.forName(className);
        <span class="hljs-keyword">if</span> (clazz.isAnnotationPresent(RestController.class) || 
            clazz.isAnnotationPresent(Controller.class)) {
            <span class="hljs-type">ApiInfo</span> <span class="hljs-variable">apiInfo</span> <span class="hljs-operator">=</span> parseApiInfo(clazz, stack[i].getMethodName());
            controllerCache.put(className, apiInfo);  <span class="hljs-comment">// 缓存起来</span>
            <span class="hljs-keyword">return</span> apiInfo;
        }
    }
    
    <span class="hljs-keyword">return</span> ApiInfo.unknown();
}
</code></pre>
<p><strong>性能优化点</strong>：</p>
<ol>
<li><strong>限制扫描深度</strong>：只扫描前50层调用栈，避免深度递归</li>
<li><strong>缓存Controller信息</strong>：同一个Controller类只解析一次，后续直接从缓存取</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[SQL执行] --&gt; B{读取线程栈}
    B --&gt; C[第1层: SQLInsight代理]
    C --&gt; D[第2层: MyBatis]
    D --&gt; E[第3层: Service]
    E --&gt; F[第4层: Controller]
    F --&gt; G{找到RestController?}
    G --&gt;|是| H[解析API信息]
    G --&gt;|否| I[继续向上扫描]
    H --&gt; J[返回API路径和方法]
    
    style A fill:#e1f5ff
    style F fill:#e1ffe1
    style H fill:#fff4e1
    style J fill:#ffe1f5
</code></pre>
<h3 data-id="heading-16">3.4 API信息解析</h3>
<p>找到Controller后，怎么解析出API路径呢？</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ApiInfo <span class="hljs-title function_">parseApiInfo</span><span class="hljs-params">(Class&lt;?&gt; controllerClass, String methodName)</span> {
    <span class="hljs-comment">// 1. 获取类级别的@RequestMapping</span>
    <span class="hljs-type">RequestMapping</span> <span class="hljs-variable">classMapping</span> <span class="hljs-operator">=</span> controllerClass.getAnnotation(RequestMapping.class);
    <span class="hljs-type">String</span> <span class="hljs-variable">basePath</span> <span class="hljs-operator">=</span> classMapping != <span class="hljs-literal">null</span> ? classMapping.value()[<span class="hljs-number">0</span>] : <span class="hljs-string">""</span>;
    
    <span class="hljs-comment">// 2. 找到对应的方法</span>
    <span class="hljs-keyword">for</span> (Method method : controllerClass.getDeclaredMethods()) {
        <span class="hljs-keyword">if</span> (method.getName().equals(methodName)) {
            <span class="hljs-comment">// 3. 获取方法级别的@GetMapping/@PostMapping等</span>
            <span class="hljs-type">GetMapping</span> <span class="hljs-variable">getMapping</span> <span class="hljs-operator">=</span> method.getAnnotation(GetMapping.class);
            <span class="hljs-keyword">if</span> (getMapping != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> basePath + getMapping.value()[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfo</span>(path, <span class="hljs-string">"GET"</span>, methodName);
            }
            <span class="hljs-comment">// ... 处理PostMapping、PutMapping等</span>
        }
    }
    
    <span class="hljs-keyword">return</span> ApiInfo.unknown();
}
</code></pre>
<p>这样就能从注解中提取出完整的API路径，比如<code>/api/users/123</code>。</p>
<hr/>
<h2 data-id="heading-17">四、设计模式的应用</h2>
<h3 data-id="heading-18">4.1 代理模式</h3>
<p>这是SQLInsight的核心。Java的动态代理基于接口，这和JDBC的设计天然契合：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[业务代码] --&gt;|调用接口| B[代理对象]
    B --&gt;|拦截处理| C[收集SQL信息]
    B --&gt;|转发调用| D[真实对象]
    D --&gt;|执行SQL| E[数据库]
    C -.-&gt;|异步| F[日志输出]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#f5e1ff
    style F fill:#fff4e1
</code></pre>
<p><strong>代理模式的好处</strong>：</p>
<ul>
<li>对业务代码透明</li>
<li>可以在不修改原有代码的情况下增加功能</li>
<li>符合开闭原则（对扩展开放，对修改关闭）</li>
</ul>
<h3 data-id="heading-19">4.2 观察者模式</h3>
<p>SQL执行信息收集后，可能有多种处理方式：输出到控制台、写入日志文件、持久化到数据库、发送到监控系统等。</p>
<p>SQLInsight用观察者模式来处理这个问题：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SqlExecutionHandler</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SqlExecution execution)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleSqlExecutionHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlExecutionHandler</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SqlExecution execution)</span> {
        System.out.println(formatSqlLog(execution));
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingSqlExecutionHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlExecutionHandler</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SqlExecution execution)</span> {
        logger.info(formatSqlLog(execution));
    }
}
</code></pre>
<p>这样可以灵活组合不同的处理器，满足不同场景的需求。</p>
<h3 data-id="heading-20">4.3 工厂模式</h3>
<p>DataSourceProxy的创建使用了工厂模式：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataSource <span class="hljs-title function_">create</span><span class="hljs-params">(DataSource target, 
                                 SqlExecutionCollector collector, 
                                 SqlExecutionHandler handler)</span> {
    <span class="hljs-keyword">return</span> (DataSource) Proxy.newProxyInstance(
        DataSource.class.getClassLoader(),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[] { DataSource.class },
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceProxy</span>(target, collector, handler)
    );
}
</code></pre>
<p><strong>为什么要用工厂模式？</strong></p>
<p>动态代理的创建比较复杂，涉及类加载器、接口数组等参数。通过工厂方法封装这些细节，让使用者更方便。</p>
<hr/>
<h2 data-id="heading-21">五、兼容性设计</h2>
<h3 data-id="heading-22">5.1 与Druid的兼容</h3>
<p>Druid是阿里开源的数据库连接池，自带监控功能。SQLInsight和Druid可以无缝配合：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[应用程序] --&gt; B[SQLInsight代理]
    B --&gt; C[Druid连接池]
    C --&gt; D[MySQL驱动]
    
    B -.-&gt;|收集| E[SQL执行信息]
    C -.-&gt;|收集| F[连接池监控]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#f5e1ff
    style F fill:#fff4e1
</code></pre>
<p><strong>为什么能兼容？</strong></p>
<p>SQLInsight代理的是标准JDBC接口，不关心底层实现。Druid连接池也实现了JDBC接口，所以可以直接代理。</p>
<p>两者的监控数据是互补的：</p>
<ul>
<li>Druid监控：连接池状态、连接获取耗时、SQL执行统计</li>
<li>SQLInsight监控：SQL与API的关联、完整调用链、慢SQL检测</li>
</ul>
<h3 data-id="heading-23">5.2 与Seata的兼容</h3>
<p>Seata也会代理DataSource，这就涉及到<strong>代理链的顺序问题</strong>。</p>
<p>理想的顺序是：<code>应用程序 → Seata → SQLInsight → 连接池</code></p>
<p>为什么？因为Seata需要在最外层控制事务，SQLInsight只做监控，应该在内层。</p>
<p>如何保证顺序？通过调整<code>BeanPostProcessor</code>的优先级：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> SqlInsightDataSourceBeanPostProcessor <span class="hljs-title function_">processor</span><span class="hljs-params">()</span> {
    <span class="hljs-type">SqlInsightDataSourceBeanPostProcessor</span> <span class="hljs-variable">processor</span> <span class="hljs-operator">=</span> 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlInsightDataSourceBeanPostProcessor</span>(collector, handler);
    processor.setOrder(Ordered.LOWEST_PRECEDENCE);  <span class="hljs-comment">// 设置最低优先级</span>
    <span class="hljs-keyword">return</span> processor;
}
</code></pre>
<p>这样Seata会先执行，SQLInsight后执行，代理顺序就对了。</p>
<hr/>
<h2 data-id="heading-24">六、性能优化策略</h2>
<h3 data-id="heading-25">6.1 缓存Controller信息</h3>
<p>第一次解析Controller信息后，缓存起来：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, ApiInfo&gt; controllerCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApiInfo <span class="hljs-title function_">extractApiInfo</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 先查缓存</span>
    <span class="hljs-keyword">if</span> (controllerCache.containsKey(className)) {
        <span class="hljs-keyword">return</span> controllerCache.get(className);
    }
    <span class="hljs-comment">// 解析并缓存</span>
    <span class="hljs-type">ApiInfo</span> <span class="hljs-variable">apiInfo</span> <span class="hljs-operator">=</span> parseApiInfo(clazz, methodName);
    controllerCache.put(className, apiInfo);
    <span class="hljs-keyword">return</span> apiInfo;
}
</code></pre>
<p><strong>效果</strong>：首次解析约50微秒，缓存命中后小于1微秒。</p>
<h3 data-id="heading-26">6.2 异步处理</h3>
<p>SQL执行信息的处理（输出日志、持久化等）是异步的：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SqlExecution execution)</span> {
    executor.submit(() -&gt; {
        <span class="hljs-comment">// 处理SQL执行信息</span>
        persistence.save(execution);
        logger.info(formatSqlLog(execution));
    });
}
</code></pre>
<p>这样不会阻塞业务SQL的执行。</p>
<h3 data-id="heading-27">6.3 限制StackTrace扫描深度</h3>
<p>只扫描前50层调用栈：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">maxDepth</span> <span class="hljs-operator">=</span> Math.min(stack.length, <span class="hljs-number">50</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxDepth; i++) {
    <span class="hljs-comment">// 扫描栈帧</span>
}
</code></pre>
<p>实际测试中，Controller一般在前10层就能找到，50层已经足够了。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[SQL执行] --&gt; B{读取栈深度}
    B --&gt;|深度&lt;=50| C[扫描栈帧]
    B --&gt;|深度&gt;50| D[只扫描前50层]
    C --&gt; E[查找Controller]
    D --&gt; E
    E --&gt; F{找到了?}
    F --&gt;|是| G[返回API信息]
    F --&gt;|否| H[返回Unknown]
    
    style A fill:#e1f5ff
    style C fill:#e1ffe1
    style E fill:#fff4e1
    style G fill:#ffe1f5
</code></pre>
<hr/>
<h2 data-id="heading-28">七、核心代码剖析</h2>
<h3 data-id="heading-29">7.1 PreparedStatementProxy的精妙之处</h3>
<p>这是整个项目最核心的一段代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PreparedStatementProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PreparedStatement target;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String sql;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        
        <span class="hljs-comment">// 拦截参数设置方法</span>
        <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"set"</span>) &amp;&amp; args.length &gt;= <span class="hljs-number">2</span>) {
            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) args[<span class="hljs-number">0</span>];
            <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">1</span>];
            
            <span class="hljs-comment">// 扩展参数列表</span>
            <span class="hljs-keyword">while</span> (parameters.size() &lt; index) {
                parameters.add(<span class="hljs-literal">null</span>);
            }
            parameters.set(index - <span class="hljs-number">1</span>, value);  <span class="hljs-comment">// JDBC参数索引从1开始</span>
            
            <span class="hljs-keyword">return</span> method.invoke(target, args);
        }
        
        <span class="hljs-comment">// 拦截执行方法</span>
        <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"execute"</span>)) {
            <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);
            <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;
            
            <span class="hljs-comment">// 收集SQL执行信息</span>
            collectSqlExecution(sql, parameters, duration);
            
            <span class="hljs-keyword">return</span> result;
        }
        
        <span class="hljs-comment">// 其他方法直接转发</span>
        <span class="hljs-keyword">return</span> method.invoke(target, args);
    }
}
</code></pre>
<p><strong>这段代码的精妙之处</strong>：</p>
<ol>
<li>
<p><strong>拦截参数设置</strong>：PreparedStatement的参数是通过<code>setXxx(index, value)</code>方法设置的，而且索引从1开始（JDBC规范）。代码中用<code>parameters.set(index - 1, value)</code>处理了这个细节。</p>
</li>
<li>
<p><strong>动态扩展参数列表</strong>：参数可能不是按顺序设置的，比如先设置第3个参数，再设置第1个参数。代码用<code>while</code>循环动态扩展列表，保证不会越界。</p>
</li>
<li>
<p><strong>精确测量执行时间</strong>：在<code>invoke</code>方法里包裹真实的SQL执行，前后记录时间戳，得到精确的执行耗时。</p>
</li>
<li>
<p><strong>保持原有行为</strong>：所有拦截后，都要调用<code>method.invoke(target, args)</code>，确保原有功能不受影响。</p>
</li>
</ol>
<h3 data-id="heading-30">7.2 StackTrace分析的优雅实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApiInfo <span class="hljs-title function_">extractApiInfo</span><span class="hljs-params">()</span> {
    StackTraceElement[] stack = Thread.currentThread().getStackTrace();
    <span class="hljs-type">int</span> <span class="hljs-variable">maxDepth</span> <span class="hljs-operator">=</span> Math.min(stack.length, <span class="hljs-number">50</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxDepth; i++) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> stack[i].getClassName();
            
            <span class="hljs-comment">// 缓存命中</span>
            <span class="hljs-keyword">if</span> (controllerCache.containsKey(className)) {
                <span class="hljs-keyword">return</span> controllerCache.get(className);
            }
            
            <span class="hljs-comment">// 加载类并检查注解</span>
            Class&lt;?&gt; clazz = Class.forName(className);
            <span class="hljs-keyword">if</span> (isController(clazz)) {
                <span class="hljs-type">ApiInfo</span> <span class="hljs-variable">apiInfo</span> <span class="hljs-operator">=</span> parseApiInfo(clazz, stack[i].getMethodName());
                controllerCache.put(className, apiInfo);
                <span class="hljs-keyword">return</span> apiInfo;
            }
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
            <span class="hljs-comment">// 忽略，继续扫描下一层</span>
        }
    }
    
    <span class="hljs-keyword">return</span> ApiInfo.unknown();
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isController</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> {
    <span class="hljs-keyword">return</span> clazz.isAnnotationPresent(RestController.class) || 
           clazz.isAnnotationPresent(Controller.class);
}
</code></pre>
<p><strong>这段代码的优雅之处</strong>：</p>
<ol>
<li>
<p><strong>异常处理得当</strong>：<code>Class.forName()</code>可能抛出<code>ClassNotFoundException</code>，但这不是错误，只是说明这个类不在当前ClassLoader里。代码用<code>try-catch</code>优雅地处理了这个问题。</p>
</li>
<li>
<p><strong>提前返回</strong>：一旦找到Controller，立即返回，不再继续扫描。这是性能优化的关键。</p>
</li>
<li>
<p><strong>缓存策略</strong>：用类名作为key缓存，而不是用完整的ApiInfo。这样即使方法不同，类名相同也能命中缓存。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-31">八、设计思想的升华</h2>
<p>做完这个项目后，我有一些更深层次的思考。</p>
<h3 data-id="heading-32">8.1 最少知识原则</h3>
<p>SQLInsight遵循了"最少知识原则"（Law of Demeter）。它只和JDBC接口打交道，不关心：</p>
<ul>
<li>你用的是什么ORM框架</li>
<li>你的连接池是什么</li>
<li>你的数据库是MySQL还是PostgreSQL</li>
</ul>
<p><strong>这个原则的好处</strong>：</p>
<ul>
<li>降低耦合</li>
<li>提高适应性</li>
<li>减少维护成本</li>
</ul>
<p>在设计系统时，我们应该尽量依赖抽象（接口），而不是具体实现。JDBC是一个很好的抽象层。</p>
<h3 data-id="heading-33">8.2 分层架构的威力</h3>
<p>JDBC的分层设计（DataSource → Connection → Statement）为代理提供了天然的切入点。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[业务层&lt;br/&gt;MyBatis/JPA] --&gt; B[JDBC抽象层&lt;br/&gt;标准接口]
    B --&gt; C[驱动实现层&lt;br/&gt;MySQL/Oracle驱动]
    
    D[SQLInsight] -.-&gt;|代理| B
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
</code></pre>
<p><strong>分层架构的好处</strong>：</p>
<ul>
<li>每一层都有明确的职责</li>
<li>层与层之间通过接口通信</li>
<li>可以在任何一层插入新功能（如监控、事务控制）</li>
</ul>
<p>这启发我们：在设计系统时，合理的分层能带来极大的扩展性。</p>
<h3 data-id="heading-34">8.3 组合优于继承</h3>
<p>SQLInsight没有通过继承来扩展功能，而是通过组合：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataSource target;  <span class="hljs-comment">// 组合原始DataSource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SqlExecutionCollector collector;  <span class="hljs-comment">// 组合收集器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SqlExecutionHandler handler;  <span class="hljs-comment">// 组合处理器</span>
}
</code></pre>
<p><strong>为什么组合优于继承？</strong></p>
<ol>
<li><strong>灵活性</strong>：可以动态替换组件（比如换一个不同的handler）</li>
<li><strong>低耦合</strong>：各个组件可以独立演化</li>
<li><strong>可测试</strong>：可以单独测试每个组件</li>
</ol>
<p>这是设计模式中的经典原则，值得反复体会。</p>
<h3 data-id="heading-35">8.4 开闭原则的实践</h3>
<p>SQLInsight对扩展开放，对修改关闭：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SqlExecutionHandler</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SqlExecution execution)</span>;
}

<span class="hljs-comment">// 新增一个handler，不需要修改核心代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlExecutionHandler</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SqlExecution execution)</span> {
        <span class="hljs-comment">// 自定义处理逻辑</span>
    }
}
</code></pre>
<p>想增加新功能？实现一个新的Handler就行了，不需要改动核心代码。</p>
<p><strong>这给我们的启示</strong>：</p>
<ul>
<li>设计接口时要想清楚扩展点在哪里</li>
<li>核心逻辑要稳定，扩展逻辑要灵活</li>
<li>通过接口和抽象隔离变化</li>
</ul>
<h3 data-id="heading-36">8.5 性能与功能的平衡</h3>
<p>SQLInsight面临一个矛盾：</p>
<ul>
<li><strong>功能需求</strong>：需要扫描StackTrace，解析注解，收集信息</li>
<li><strong>性能需求</strong>：不能影响业务SQL的执行速度</li>
</ul>
<p>解决方案是：</p>
<ol>
<li><strong>缓存</strong>：减少重复计算</li>
<li><strong>异步</strong>：把耗时操作移到后台</li>
<li><strong>限制</strong>：限制扫描深度，避免极端情况</li>
</ol>
<p><strong>这个平衡的启示</strong>：</p>
<ul>
<li>性能优化不是无限制的，要找到合适的度</li>
<li>用空间换时间（缓存）</li>
<li>用异步换同步（后台处理）</li>
<li>设置合理的边界（扫描深度限制）</li>
</ul>
<hr/>
<h2 data-id="heading-37">九、使用示例</h2>
<blockquote>
<p><strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsh_wangwanbao%2Fsql-insight" target="_blank" title="https://gitee.com/sh_wangwanbao/sql-insight" ref="nofollow noopener noreferrer">gitee.com/sh_wangwanb…</a><br/>
完整的示例代码在<code>examples</code>模块中，可以直接运行查看效果。</p>
</blockquote>
<h3 data-id="heading-38">9.1 引入依赖</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.surfing<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sqlinsight-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-39">9.2 配置（可选）</h3>
<pre><code class="hljs language-properties" lang="properties"># 启用SQLInsight（默认true）
sqlinsight.enabled=true

# 慢SQL阈值（默认1000ms）
sqlinsight.slow-sql-threshold=50

# N+1查询检测阈值（默认10）
sqlinsight.n-plus-one-threshold=10
</code></pre>
<h3 data-id="heading-40">9.3 输出示例</h3>
<pre><code class="hljs language-sql" lang="sql">[<span class="hljs-keyword">SQL</span><span class="hljs-operator">-</span>Insight] <span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span>api<span class="hljs-operator">/</span>users<span class="hljs-operator">/</span><span class="hljs-number">123</span> → UserController.findById
   <span class="hljs-keyword">SQL</span>: <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> (<span class="hljs-number">15</span>ms) [Type: <span class="hljs-keyword">SELECT</span>]

[<span class="hljs-keyword">SQL</span><span class="hljs-operator">-</span>Insight] <span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span>api<span class="hljs-operator">/</span>users<span class="hljs-operator">/</span>orders → UserController.getUserOrders
   [SLOW] <span class="hljs-keyword">SQL</span>: <span class="hljs-keyword">SELECT</span> u.<span class="hljs-operator">*</span>, o.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users u <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> orders o <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> o.user_id (<span class="hljs-number">56</span>ms) [Type: <span class="hljs-keyword">SELECT</span>]
</code></pre>
<hr/>
<h2 data-id="heading-41">十、总结与展望</h2>
<h3 data-id="heading-42">10.1 技术总结</h3>
<p>SQLInsight通过三个核心技术实现了零侵入的SQL监控：</p>
<ol>
<li><strong>动态代理</strong>：在JDBC层拦截SQL执行（学习自Seata）</li>
<li><strong>StackTrace分析</strong>：自动追踪API调用链（学习自MyBatis）</li>
<li><strong>BeanPostProcessor</strong>：自动代理DataSource（Spring的扩展机制）</li>
</ol>
<p>这三个技术的组合，实现了：</p>
<ul>
<li>零配置集成</li>
<li>透明监控</li>
<li>完整的调用链追踪</li>
<li>良好的兼容性</li>
</ul>
<h3 data-id="heading-43">10.2 设计原则的践行</h3>
<p>项目体现了多个经典设计原则：</p>
<ul>
<li><strong>单一职责</strong>：每个类只做一件事</li>
<li><strong>开闭原则</strong>：对扩展开放，对修改关闭</li>
<li><strong>依赖倒置</strong>：依赖抽象（JDBC接口），不依赖具体实现</li>
<li><strong>最少知识</strong>：只和JDBC接口打交道</li>
<li><strong>组合优于继承</strong>：用组合构建功能</li>
</ul>
<h3 data-id="heading-44">10.3 未来展望</h3>
<p>SQLInsight还有很多可以优化的地方：</p>
<ol>
<li><strong>N+1查询检测</strong>：自动识别循环查询问题</li>
<li><strong>Web控制台</strong>：提供可视化的监控界面</li>
<li><strong>智能建议</strong>：根据SQL执行情况给出优化建议</li>
<li><strong>分布式追踪</strong>：集成OpenTelemetry，支持分布式链路追踪</li>
<li><strong>SQL审计</strong>：记录所有SQL操作，用于安全审计</li>
</ol>
<p>但核心思想不会变：<strong>在最底层做拦截，保持对业务代码的零侵入</strong>。</p>
<hr/>
<h2 data-id="heading-45">十一、写在最后</h2>
<p>做这个项目，最大的收获不是写了多少行代码，而是理解了<strong>设计思想的传承</strong>。</p>
<p>Seata的动态代理、MyBatis的StackTrace分析，这些都是前人智慧的结晶。我们站在巨人的肩膀上，把这些思想组合起来，创造出新的价值。</p>
<p>技术的本质不是炫技，而是解决问题。SQLInsight解决的问题很简单：让开发者知道每个API执行了哪些SQL，用了多长时间。但实现这个简单的目标，需要深入理解JDBC、动态代理、反射、线程栈等多个技术点。</p>
<p><strong>好的技术方案，应该是简单的。</strong></p>
<p>对使用者来说，只需要加一个依赖。对设计者来说，需要考虑性能、兼容性、扩展性、可维护性等多个维度。</p>
<p>这就是技术的魅力：表面简单，内在复杂；对外易用，对内精巧。</p>
<p>希望这篇文档能帮助你理解SQLInsight的设计思路，也希望这些设计思想能对你未来的项目有所启发。</p>
<hr/>
<h2 data-id="heading-46">十二、开发记录</h2>
<p>从想法到实现，花了小一周时间。</p>
<p>刚开始写代码的时候，遇到了不少坑：</p>
<ul>
<li>PreparedStatement的参数索引从1开始，而不是0（JDBC规范）</li>
<li>StackTrace扫描时要注意ClassNotFoundException</li>
<li>动态代理要完整实现接口的所有方法，不然会NPE</li>
<li>缓存策略要做好，不然性能会受影响</li>
</ul>
<p>调试的过程中，对JDBC标准、Java动态代理、反射机制有了更深的理解。看似简单的"拦截SQL执行"，背后涉及的技术点比想象中要多。</p>
<p>今天周末，终于把坑都填完了，代码也开源了。算是还了上周文章的债。</p>
<p>如果你在使用过程中遇到问题，或者有什么想法建议，欢迎提Issue或PR。</p>
<hr/>
<p><strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsh_wangwanbao%2Fsql-insight" target="_blank" title="https://gitee.com/sh_wangwanbao/sql-insight" ref="nofollow noopener noreferrer">gitee.com/sh_wangwanb…</a><br/>
<strong>上一篇文章</strong>：<a href="https://juejin.cn/post/7591513171199295551" target="_blank" title="https://juejin.cn/post/7591513171199295551">SQLInsight：一行依赖，自动追踪API背后的每一条SQL</a><br/>
<strong>开源协议</strong>：MIT License<br/>
<strong>欢迎反馈</strong>：提Issue、PR，或者留言讨论</p>
<hr/>
<p><em>写代码的过程，也是学习的过程。希望SQLInsight能帮到你，也欢迎一起完善它。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第11章 LangChain]]></title>    <link>https://juejin.cn/post/7593258683750531106</link>    <guid>https://juejin.cn/post/7593258683750531106</guid>    <pubDate>2026-01-10T08:28:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593258683750531106" data-draft-id="7593262196843741236" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第11章 LangChain"/> <meta itemprop="keywords" content="LangChain,前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-10T08:28:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XiaoYu2002"/> <meta itemprop="url" content="https://juejin.cn/user/251124329220663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第11章 LangChain
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/251124329220663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XiaoYu2002
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T08:28:33.000Z" title="Sat Jan 10 2026 08:28:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>LangChain 是一个用于开发基于大语言模型（LLM）应用程序的开源框架，它通过提供模块化的抽象组件和链式调用工具，将 LLM 与外部数据源（如文档、数据库）和计算工具（如搜索引擎、代码解释器）智能连接，从而构建出具备记忆、推理和行动能力的增强型 AI 应用，典型场景包括智能问答、内容生成和智能体（Agent）系统。</p>
<p>LangChain官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2F%25E3%2580%2582%25E7%25BD%2591%25E5%259D%2580%25E7%259A%2584%25E7%25BB%2584%25E6%2588%2590%25E9%2580%25BB%25E8%25BE%2591%25E5%2592%258CNest.js%25E5%25AE%2598%25E6%2596%25B9%25E6%2596%2587%25E6%25A1%25A3%25E7%25B1%25BB%25E4%25BC%25BC%25EF%25BC%258C%25E5%258D%25B3docs.%25E5%2590%258D%25E7%25A7%25B0.com%25E3%2580%2582" target="_blank" title="https://docs.langchain.com/%E3%80%82%E7%BD%91%E5%9D%80%E7%9A%84%E7%BB%84%E6%88%90%E9%80%BB%E8%BE%91%E5%92%8CNest.js%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%8D%B3docs.%E5%90%8D%E7%A7%B0.com%E3%80%82" ref="nofollow noopener noreferrer">docs.langchain.com/。网址的组成逻辑和Ne…</a></p>
<p>LangChain支持Python和TypeScript两种编程语言，如图11-1所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0decd565cb6f4105b0822cac46543c94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768638513&amp;x-signature=MHeeA5CYwSQTKaMV8bpJw4pEuJw%3D" alt="image-20251219041533100" loading="lazy"/></p>
<p align="center">
 <b> 图11-1 LangChain开源代理框架-语言选项</b>
</p>
<p>LangChain开源代理框架有3种选择方案：</p>
<p>（1）LangChain：一些普通对话，音频识别、文字生成，图片生成等等与AIGC相关的，用这选择方案就够了。</p>
<p>（2）LangGraph：想做工作流，类似Dify，Coze，那么就需要使用该方案。</p>
<p>（3）Deep Agents：想做一些大型的AI相关高级应用，就需要使用该方案，Deep Agents是深度集成的意思。</p>
<p>LangChain 作为基础框架，适合构建常规的AIGC应用（如对话、文生图）；LangGraph 专注于通过有状态、可循环的图结构来编排复杂、多步骤的智能体工作流，是开发类Dify/Coze平台或自动化业务流程的核心选择；而 Deep Agents 则代表了一种更深度集成、能处理高复杂度任务与自主决策的高级智能体架构，常用于需要多智能体协作或模拟人类工作流的大型企业级AI应用。</p>
<p>我们这里学习的话，使用第一个LangChain就完全够用。LangChain下载使用说明如图11-2所示。我们点击如图11-1所示的第一个选项后，会跳转到如图11-2所示的界面，需要点击左侧边栏的install选项。官方文档有对应的使用说明。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da1162df520b4c888fd7af9b16653f12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768638513&amp;x-signature=WHqI5tvJ5CV9ekFa4KAdTalfw%2FI%3D" alt="image-20251219042243761" loading="lazy"/></p>
<p align="center">
 <b> 图11-2 LangChain下载使用说明</b>
</p>
## 11.1 初始化项目
<p>接下来，我们要开始初始化这次的项目。会沿用第10章 SSE魔改的代码，在该基础上，需要补充以下安装步骤：</p>
<p>（1）@langchain/core：LangChain 的核心基础库，包含链、提示模板、检索器等核心抽象。</p>
<p>（2）@langchain/deepseek： LangChain 为DeepSeek 模型专门提供的集成包，让我们能在 LangChain 框架中直接调用 DeepSeek 的 API。安装规则是@langchain/所需AI大模型，例如@langchain/openai。</p>
<p>（3）langchain：LangChain 的主包，提供了高级、易于使用的接口来组合和使用 LLM。</p>
<p>安装LangChain之后，我们需要一个AI大模型来支持，在这次示例中，选择DeepSeek，因为它的API非常便宜。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 终端执行命令</span>
npm install <span class="hljs-meta">@langchain</span>/core <span class="hljs-meta">@langchain</span>/deepseek langchain
</code></pre>
<p>安装之后的package.json文件如下所示。</p>
<pre><code class="hljs language-ts" lang="ts">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"module"</span>,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@langchain/core"</span>: <span class="hljs-string">"^1.1.6"</span>,
    <span class="hljs-string">"@langchain/deepseek"</span>: <span class="hljs-string">"^1.0.3"</span>,
    <span class="hljs-string">"@types/cors"</span>: <span class="hljs-string">"^2.8.19"</span>,
    <span class="hljs-string">"@types/express"</span>: <span class="hljs-string">"^5.0.6"</span>,
    <span class="hljs-string">"cors"</span>: <span class="hljs-string">"^2.8.5"</span>,
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"^5.2.1"</span>,
    <span class="hljs-string">"langchain"</span>: <span class="hljs-string">"^1.2.1"</span>
  }
}
</code></pre>
<p>由于我们在7.1小节已经升级过Node.js版本，因此可以直接用Node.js去运行ts后缀文件，满足Node.js版本大于23的都可以这么做，如果无法运行ts后缀文件，需要检查一下Node.js版本或者采用ts-node。</p>
<p>接下来到index.ts文件中初始化后端服务。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// index.ts</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">'cors'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; { })

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server is running on port 3000'</span>)
})
</code></pre>
<h2 data-id="heading-0">11.2 接入大模型</h2>
<p>接着接入我们的AI大模型DeepSeek，还是在index.ts文件中。</p>
<p>在这里引入了一个key.ts文件，该文件存放着DeepSeek API的Key。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>
<span class="hljs-keyword">import</span> { key } <span class="hljs-keyword">from</span> <span class="hljs-string">'./key.ts'</span>
<span class="hljs-keyword">const</span> deepseek = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
    <span class="hljs-attr">apiKey</span>: key,
    <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-chat'</span>,
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">1.3</span>,
    <span class="hljs-attr">maxTokens</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">//500-600个汉字</span>
    <span class="hljs-attr">topP</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">//设得越小，AI 说话越"死板"；设得越大，AI 说话越"放飞自我"</span>
    <span class="hljs-attr">frequencyPenalty</span>: <span class="hljs-number">0</span>,<span class="hljs-comment">//防复读机诉 AI："你别老重复同一个词！"-2   2</span>
    <span class="hljs-attr">presencePenalty</span>: <span class="hljs-number">0</span>,<span class="hljs-comment">//鼓励换话题告诉 AI："别老聊同一件事！" -2   2</span>
})
</code></pre>
<p>获取DeepSeek的key，如下4步骤：</p>
<p>（1）打开DeepSeek的API开放平台：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.deepseek.com%2F" target="_blank" title="https://platform.deepseek.com/" ref="nofollow noopener noreferrer">platform.deepseek.com/</a>。</p>
<p>（2）微信扫码登录，去实名认证。</p>
<p>（3）点击左侧边栏的用量信息选择去充值选项，有在线充值和对公汇款两个选项，选择在线充值，自定义输入1块钱（够用了），然后自己选择支付宝或者微信支付去付款。</p>
<p>（4）付款成功后，点击左侧边栏的API keys选项，创建API key，随便输入一个名称（中英文都可以），然后会弹出key值，此时复制key值再关闭弹窗，因为当你关闭后，就再也拿不到这个key值了。忘记就只能重新再建一个，DeepSeek会提醒你的，如图11-3所示。</p>
<p>友情提示：保护好你的key值，别暴露在公网中，在开源项目上传GitHub中，可以让git忽略key.ts文件。或者如果你的DeepSeek API就只充了1块钱，然后用得剩几毛钱，并且以后都不怎么打算充，那想不想保护key值，就看你心情了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9013c784c7f24b3ba730495b375da82d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768638513&amp;x-signature=SkefVPDl8t1SPeYGB%2B9tEUCcaQc%3D" alt="image.png" loading="lazy"/></p>
<p align="center">
 <b> 图11-3 创建API key注意事项</b>
</p>
<p>通过以上步骤获取到DeepSeek的key值后，在项目创建key.ts文件，创建常量key，填入你的key值并导出。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> key = <span class="hljs-string">'你DeepSeek的key值'</span>
</code></pre>
<p>回到index.ts文件，接入DeepSeek大模型之后，ChatDeepSeek有一个model字段，这是用于选择我们模型的。已有的模型类型需要从DeepSeek官方文档中获取：<a href="https://link.juejin.cn?target=https%3A%2F%2Fapi-docs.deepseek.com%2Fzh-cn%2Fquick_start%2Fpricing" target="_blank" title="https://api-docs.deepseek.com/zh-cn/quick_start/pricing" ref="nofollow noopener noreferrer">模型 &amp; 价格 | DeepSeek API Docs</a>。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// DeepSeek字段</span>
<span class="hljs-attr">apiKey</span>: key,
<span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-chat'</span>,
<span class="hljs-attr">temperature</span>: <span class="hljs-number">1.3</span>,
<span class="hljs-attr">maxTokens</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 500-600个汉字</span>
<span class="hljs-attr">topP</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 设得越小，AI 说话越"死板"；设得越大，AI 说话越"放飞自我"</span>
<span class="hljs-attr">frequencyPenalty</span>: <span class="hljs-number">0</span>,<span class="hljs-comment">// 防复读机诉 AI："你别老重复同一个词！"-2   2</span>
<span class="hljs-attr">presencePenalty</span>: <span class="hljs-number">0</span>,<span class="hljs-comment">// 鼓励换话题告诉 AI："别老聊同一件事！" -2   2</span>
</code></pre>
<p>目前可选的模型有deepseek-chat和deepseek-reasoner。DeepSeek官网价格计算是以百万Token为单位，其中1 个英文字符 ≈ 0.3 个 token；1 个中文字符 ≈ 0.6 个 token。只要大概知道很便宜就足够了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4333a60653334151b832d8eaa7663532~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768638513&amp;x-signature=rzQmAfUQ5NHRpYaM98NeratuXwI%3D" alt="image-20251219050542592" loading="lazy"/></p>
<p align="center">
 <b> 图11-4 DeepSeek模型选择</b>
</p>
<p>temperature字段是温度的含义，在DeepSeek官方文档中有直接给出对应的建议，我们的示例是打算用于对话，因此设置1.3就足够了，Temperature参数设置如图11-5所示。</p>
<p>从应用场景，我们可以理解为temperature字段大概是理性与感性的权衡度，逻辑性越强的场景，温度越低；越感性的场景温度越高。所有AI大模型都是类似的，从他们对应的官方文档去获取对应信息就可以了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38c09d7f2ecf4117a23169fbd1cdf885~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768638513&amp;x-signature=iwwwFnK%2B2IIhQ0IWhjm8v3nZhJ4%3D" alt="image-20251219050952588" loading="lazy"/></p>
<p align="center">
 <b> 图11-5 DeepSeek模型-Temperature参数设置</b>
</p>
<p>其余4个参数maxTokens、topP，frequencyPenalty和presencePenalty如下：</p>
<p>（1）maxTokens 直接决定了 AI 回复的最大长度，限制了单次响应的文本量；</p>
<p>（2）topP（核采样参数）通过控制候选词的概率分布来影响文本的创造性与稳定性——值越低则 AI 的选词越集中和可预测，输出趋于“死板”，值越高则选词范围越宽，输出越“放飞自我”并富有创意。</p>
<p>（3）而 frequencyPenalty 与 presencePenalty 则分别从词频和话题层面抑制重复：frequencyPenalty 正值会惩罚在当前回复中已经频繁出现的词语，促使用词更加多样；presencePenalty 正值则会惩罚在已生成的上下文中出现过的所有主题，鼓励 AI 主动切换到新的话题或角度，从而共同确保生成内容的多样性和连贯性，避免陷入单调或循环重复的表达。</p>
<p>这些值具体设置多少，则需要根据具体场景的经验以及自身的理解，推荐看我写的AI使用手册，开头有讲解到这一部分注意力机制：<a href="https://juejin.cn/post/7564351324860612623" target="_blank" title="https://juejin.cn/post/7564351324860612623">AI精准提问手册：从模糊需求到精准输出的核心技能（上）</a>。</p>
<h2 data-id="heading-1">11.3 AI对话</h2>
<p>接下来需要从langchain引入createAgent方法，并使用我们设置好的deepseek实例对象。我们调用agent身上的invoke()方法，该方法更适合单次输出（一次性直接返回），即非流式返回。</p>
<p>通过createAgent方法除了可以设置接入的大模型，还可以通过systemPrompt字段去设置Prompt提示词。</p>
<p>通过LangChain代理的stream()方法调用DeepSeek模型处理用户请求：将客户端发送的req.body.message作为用户消息输入，并设置streamMode为 "messages" 来获取结构化的消息流响应；在等待代理完成流式生成后，将整个结果集作为JSON数据一次性返回给客户端。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">'cors'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>
<span class="hljs-keyword">import</span> { key } <span class="hljs-keyword">from</span> <span class="hljs-string">'./key.ts'</span>
<span class="hljs-keyword">import</span> { createAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">'langchain'</span>
<span class="hljs-keyword">const</span> deepseek = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
  <span class="hljs-attr">apiKey</span>: key,
  <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-chat'</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">1.3</span>,
  <span class="hljs-attr">maxTokens</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 500-600个汉字</span>
  <span class="hljs-attr">topP</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 设得越小，AI 说话越"死板"；设得越大，AI 说话越"放飞自我"</span>
  <span class="hljs-attr">frequencyPenalty</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 防复读机诉 AI："你别老重复同一个词！"-2   2</span>
  <span class="hljs-attr">presencePenalty</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 鼓励换话题告诉 AI："别老聊同一件事！" -2   2</span>
})

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json'</span>)
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>)
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Connection'</span>, <span class="hljs-string">'keep-alive'</span>)
  <span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">model</span>: deepseek,
    <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">`你是一个聊天机器人，请根据用户的问题给出回答。`</span>,
  })
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">invoke</span>({
    <span class="hljs-attr">messages</span>: [
      {
        <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
        <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">message</span>,
      }
    ]
  })
  res.<span class="hljs-title function_">json</span>(result)
})

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server is running on port 3000'</span>)
})
</code></pre>
<p>接下来回到index.html文件一下，我们需要设置客户端返回给后端的问题，也就是往req.body.message里塞一下咨询AI的问题。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;script&gt;
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:3000/api/chat'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
        },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'请问你是什么AI大模型'</span> })
    }).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> res=&gt;{
        <span class="hljs-keyword">const</span> reader = res.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>()
        <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>()
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>()
            <span class="hljs-keyword">if</span> (done) {
                <span class="hljs-keyword">break</span>
            }
            <span class="hljs-keyword">const</span> text = decoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> })
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text)
        }
    })
&lt;/script&gt;
</code></pre>
<p>我们问了一个：“你是什么AI大模型”的问题，浏览器返回AI对话信息如图11-6所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca0955ecf9f7418996b77394d468b9bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768638513&amp;x-signature=21sxFKXTPK1IbJPurp0xo8FOtVw%3D" alt="image-20251219054656481" loading="lazy"/></p>
<p align="center">
 <b> 图11-6 DeepSeek模型-Temperature参数设置</b>
</p>
<p>到这为止，我们就正式打通了AI对话的环节。并且如果我们打开网络选项卡，可以发现AI对话返回的内容是post请求的。如果我们想改成流式输出也是post请求，在第10.3小节所学习的SSE设置post请求就可以用上了。</p>
<h2 data-id="heading-2">11.4 流式输出AI对话</h2>
<p>如果我们想修改成流式输出对话的话，需要修改3个地方：</p>
<p>（1）后端设置的Content-Type类型改成事件流类型。</p>
<p>（2）agent不使用invoke()方法，该换专门的agent.stream()流输出方法，并调整对应参数。</p>
<p>（3）agent.stream()流输出方法返回迭代器，针对迭代器去调整输出形式。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">'cors'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>
<span class="hljs-keyword">import</span> { key } <span class="hljs-keyword">from</span> <span class="hljs-string">'./key.ts'</span>
<span class="hljs-keyword">import</span> { createAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">'langchain'</span>
<span class="hljs-keyword">const</span> deepseek = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
  <span class="hljs-attr">apiKey</span>: key,
  <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-chat'</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">1.3</span>,
  <span class="hljs-attr">maxTokens</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 500-600个汉字</span>
  <span class="hljs-attr">topP</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 设得越小，AI 说话越"死板"；设得越大，AI 说话越"放飞自我"</span>
  <span class="hljs-attr">frequencyPenalty</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 防复读机诉 AI："你别老重复同一个词！"-2   2</span>
  <span class="hljs-attr">presencePenalty</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 鼓励换话题告诉 AI："别老聊同一件事！" -2   2</span>
})

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/event-stream'</span>)
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>)
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Connection'</span>, <span class="hljs-string">'keep-alive'</span>)
  <span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">model</span>: deepseek,
    <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">`你是一个聊天机器人，请根据用户的问题给出回答。`</span>,
  })
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">stream</span>({
    <span class="hljs-attr">messages</span>: [
      {
        <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
        <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">message</span>,
      }
    ]
  }, { <span class="hljs-attr">streamMode</span>: <span class="hljs-string">"messages"</span> })
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> result) {
    res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(chunk)}</span>\n\n`</span>)
  }
  res.<span class="hljs-title function_">end</span>()
})

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server is running on port 3000'</span>)
})
</code></pre>
<p>agent.stream()方法有第二个参数，用于指定流式输出的数据格式和粒度，决定了从流中接收到的是原始令牌、结构化消息还是其他中间结果。agent.stream()方法第二个参数的选项如表11-1所示。我们选择messages就可以了。如果想要真正存粹的打字效果并且节约token，可以使用values选项。</p>
<p align="center">
 <b> 表11-1 agent.stream()方法第二个参数的选项</b>
</p>





























<table><thead><tr><th align="left">流模式</th><th align="left">返回的数据类型</th><th align="left">典型用途</th><th align="left">示例输出（逐块）</th></tr></thead><tbody><tr><td align="left">"messages"</td><td align="left">完整的消息对象</td><td align="left">需要处理结构化对话（如获取AI回复的完整消息）</td><td align="left">{"role": "assistant", "content": "你好"}</td></tr><tr><td align="left">"values"</td><td align="left">底层值（如原始token）</td><td align="left">需要实现逐字打印效果或最低级控制</td><td align="left">"你" "好"</td></tr><tr><td align="left">"stream"</td><td align="left">混合事件流</td><td align="left">需要同时获取token和消息等多样信息</td><td align="left">{"type": "token", "value": "你"}</td></tr></tbody></table>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">stream</span>({
    <span class="hljs-attr">messages</span>: [
      {
        <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
        <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">message</span>,
      }
    ]
  }, { <span class="hljs-attr">streamMode</span>: <span class="hljs-string">"values"</span> })
</code></pre>
<p>其次，由于agent.stream()方法的返回值类型是<code>IterableReadableStream&lt;StreamMessageOutput&gt;</code>，说明返回值就是一个迭代器。因此可以使用for await of语法糖来流式输出内容，不用手动的去调用迭代器的next()方法。</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> result) {
    res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(chunk)}</span>\n\n`</span>)
  }
  res.<span class="hljs-title function_">end</span>()
</code></pre>
<p>AI对话-流式输出如图11-7所示。会按顺序返回非常多的JSON格式数据，通过data字段下的kwargs的content可以看到AI返回内容以三两字的形式不断输出。并且在前端的接收流式输出，不会因post请求而出现问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/442cefcfac0e47ddb0813b0ab60cb020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768638513&amp;x-signature=%2FjSGLU6k0c5VBn3oQ%2B9%2F1esXxMM%3D" alt="image-20251219060557208" loading="lazy"/></p>
<p align="center">
 <b> 图11-7 AI对话-流式输出</b>
</p>
<p>流式输出AI对话的完整代码如下：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// index.ts</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">'cors'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>
<span class="hljs-keyword">import</span> { key } <span class="hljs-keyword">from</span> <span class="hljs-string">'./key.ts'</span>
<span class="hljs-keyword">import</span> { createAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">'langchain'</span>
<span class="hljs-keyword">const</span> deepseek = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
  <span class="hljs-attr">apiKey</span>: key,
  <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-chat'</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">1.3</span>,
  <span class="hljs-attr">maxTokens</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 500-600个汉字</span>
  <span class="hljs-attr">topP</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 设得越小，AI 说话越"死板"；设得越大，AI 说话越"放飞自我"</span>
  <span class="hljs-attr">frequencyPenalty</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 防复读机诉 AI："你别老重复同一个词！"-2   2</span>
  <span class="hljs-attr">presencePenalty</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 鼓励换话题告诉 AI："别老聊同一件事！" -2   2</span>
})

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/event-stream'</span>)
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>)
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Connection'</span>, <span class="hljs-string">'keep-alive'</span>)
  <span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">model</span>: deepseek,
    <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">`你是一个聊天机器人，请根据用户的问题给出回答。`</span>,
  })
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">stream</span>({
    <span class="hljs-attr">messages</span>: [
      {
        <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
        <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">message</span>,
      }
    ]
  }, { <span class="hljs-attr">streamMode</span>: <span class="hljs-string">"messages"</span> })
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> result) {
    res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(chunk)}</span>\n\n`</span>)
  }
  res.<span class="hljs-title function_">end</span>()
})

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server is running on port 3000'</span>)
})
</code></pre>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// index.html</span>
&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;script&gt;
    fetch('http://localhost:3000/api/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ message: '请问你是什么AI大模型' })
    }).then(async res =&gt; {
      const reader = res.body.getReader()
      const decoder = new TextDecoder()
      while (true) {
        const { done, value } = await reader.read()
        if (done) {
          break
        }
        const text = decoder.decode(value, { stream: true })
        console.log(text)
      }
    })
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<p>以上就是使用LangChain接入DeepSeek大模型并实现AI对话和基础提示词的案例。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推荐几个国外比较流行的UI库（上）]]></title>    <link>https://juejin.cn/post/7593198957984301097</link>    <guid>https://juejin.cn/post/7593198957984301097</guid>    <pubDate>2026-01-10T06:45:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593198957984301097" data-draft-id="7593198957984038953" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推荐几个国外比较流行的UI库（上）"/> <meta itemprop="keywords" content="前端,JavaScript,CSS"/> <meta itemprop="datePublished" content="2026-01-10T06:45:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我的写法有点潮"/> <meta itemprop="url" content="https://juejin.cn/user/1643143620204234"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推荐几个国外比较流行的UI库（上）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1643143620204234/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我的写法有点潮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T06:45:42.000Z" title="Sat Jan 10 2026 06:45:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、Tailwind CSS</h2>
<p>现在写样式的时候，我基本已经离不开 Tailwind CSS 了。最开始接触它的时候，其实挺不适应的，感觉类名又多又杂，全写在标签上。但真正用顺了之后，反而不太想回到以前那种来回切 CSS 文件的方式。</p>
<p>我比较喜欢的是它处理响应式的方式，断点直接写在类名前面，逻辑非常直观。页面在不同尺寸下怎么变，一眼就能看出来。再加上配置文件可以统一管颜色、间距、字体这些东西，对我来说维护起来反而更轻松。</p>
<p>缺点当然也有，比如结构看起来不那么“干净”，但这个在我这里已经不算什么问题了。</p>
<p><strong>下面我们来实现一个瀑布流</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"columns-3 ..."</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-3/2 ..."</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/img/mountains-1.jpg"</span> /&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-square ..."</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/img/mountains-2.jpg"</span> /&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-square ..."</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/img/mountains-3.jpg"</span> /&gt;</span> 
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>效果</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89fafbbaf8c14ba684aad39db134b1a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qE5YaZ5rOV5pyJ54K55r2u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768634370&amp;x-signature=WtiWy51sP0B4zRCH1sf%2FIBv%2B7zs%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">2、Bootstrap</h2>
<p>虽然 Bootstrap 已经很多年了，但说实话，在一些需求明确、节奏比较快的项目里，它依然很好用。栅格、常见组件基本都有，直接拼就能出页面，几乎不用想太多。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b904d7f72ea4f6f8506bc351c91832c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qE5YaZ5rOV5pyJ54K55r2u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768634370&amp;x-signature=KKiVIweFIrVwz%2FgNB8zg2urAs4w%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">3、Foundation</h2>
<p>Foundation 是一个开源的响应式前端框架，用于构建结构清晰、视觉一致的网页界面。它提供了完整的工具体系，包括响应式网格系统、设计模板，以及基于 HTML、CSS 和 SASS 的样式方案。同时，框架内置了按钮、导航、表单、排版等常见 UI 能力，并支持通过 JavaScript 扩展进一步增强交互功能。</p>
<p>Foundation 采用移动优先的设计理念，与 Bootstrap 类似，布局从小屏设备开始构建，再逐步扩展到更大的屏幕尺寸。这种方式使页面能够自然适配不同设备，无需额外处理复杂的适配逻辑，从而在手机、平板和桌面端之间保持一致且流畅的体验。</p>
<p>在布局层面，Foundation 提供了基于 Flexbox 的 12 列响应式网格系统。页面结构可以通过行与列的组合快速搭建，而网格系统会自动处理不同断点下的尺寸变化与内容堆叠，使整体布局保持简洁、直观且易于维护。</p>
<p>Foundation 的工具包体系也是其重要特性之一。框架内置了可直接使用的网页与邮件组件，使项目在启动阶段不必从零搭建基础结构。这种方式在多平台场景下有助于维持统一的视觉风格，并显著减少重复性工作。</p>
<p>在灵活性方面，Foundation 并未强制绑定特定的设计语言或样式规范。默认配置可根据项目需求进行调整或覆盖，从而在不受框架限制的前提下实现定制化界面设计。这种设计思路在效率与自由度之间取得了较好的平衡。</p>
<p>从整体特性来看，Foundation 对无障碍访问和移动优先设计的重视，使其在构建现代化、包容性网页体验时具有明显优势。模块化架构与 SASS 集成提升了组件定制的效率，也使复杂布局的原型构建更加顺畅。</p>
<p>相对而言，Foundation 的学习成本高于 Bootstrap 等更大众化的方案，对初学者存在一定门槛。此外，其社区规模和生态资源不及 Tailwind 和 Bootstrap 丰富，可直接复用的第三方资源相对有限。在功能完整度较高的同时，对于体量较小的项目而言，可能会引入不必要的复杂度。</p>
<p><strong>特点</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span>  <span class="hljs-strong">**响应式**</span>：先做好手机，再适配平板和电脑。
<span class="hljs-bullet">2.</span>  <span class="hljs-strong">**网格灵活**</span>：12 列 Flexbox 布局，布局复杂也能处理好。
<span class="hljs-bullet">3.</span>  <span class="hljs-strong">**组件齐全**</span>：带 JS 插件，交互也有现成的（弹窗、菜单等）。
</code></pre>
<p><strong>适合谁</strong>：想快速搭复杂页面，有交互，又想用框架自带组件的人。</p>
<p><strong>缺点</strong>：学习稍复杂，功能多了，小项目可能显得重。</p>
<p><strong>下面我们来使用它的按钮样式</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- Anchors (links) --&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"about.html"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span>&gt;</span>Learn More<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#features"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span>&gt;</span>View All Features<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> 

<span class="hljs-comment">&lt;!-- Buttons (actions) --&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submit success button"</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert button"</span>&gt;</span>Delete<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p><strong>效果</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be2c22903f1e42b8842f5f2e49bfc1fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qE5YaZ5rOV5pyJ54K55r2u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768634370&amp;x-signature=T93mUi1gwOLHVYsKFj4ZBSUGjUA%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">4、Bulma</h2>
<p>Bulma 是那种一看就懂、上手很快的框架。类名语义清楚，布局基于 Flexbox，用起来很顺。</p>
<p>它不依赖 JavaScript 这一点，拿来配合任何技术栈都很方便。不过也正因为这样，一些交互相关的东西需要自己补，这点在用之前心里要有预期。</p>
<p><strong>特点</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span>  <span class="hljs-strong">**响应式**</span>：移动优先，Flexbox 网格布局。
<span class="hljs-bullet">2.</span>  <span class="hljs-strong">**轻量**</span>：按钮、卡片、表单都有样式，但没有 JS。
<span class="hljs-bullet">3.</span>  <span class="hljs-strong">**易用**</span>：学习成本低，改样式很方便。
</code></pre>
<p><strong>适合谁</strong>：只需要快速搭页面、布局和样式固定、不需要框架自带交互的人。</p>
<p><strong>缺点</strong>：没有交互组件，复杂行为要自己写。</p>
<p><strong>下面我们来写一个简单的表单</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"field"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"label"</span>&gt;</span>Email<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"e.g. alex@example.com"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"field"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"label"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"********"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button is-primary"</span>&gt;</span>Sign in<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<p><strong>效果</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6882c05f7b2a4cb2aae2eca977da9efe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qE5YaZ5rOV5pyJ54K55r2u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768634370&amp;x-signature=Mgu7j96l%2BxUE%2BEmANr46eeSUcQ8%3D" alt="image.png" loading="lazy"/></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一篇文章带你搞懂原型和原型链]]></title>    <link>https://juejin.cn/post/7593212374922215451</link>    <guid>https://juejin.cn/post/7593212374922215451</guid>    <pubDate>2026-01-10T06:58:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593212374922215451" data-draft-id="7593212374922182683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一篇文章带你搞懂原型和原型链"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-10T06:58:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陟上青云"/> <meta itemprop="url" content="https://juejin.cn/user/3910338081725949"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一篇文章带你搞懂原型和原型链
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3910338081725949/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陟上青云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T06:58:57.000Z" title="Sat Jan 10 2026 06:58:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我们在理解原型和原型链的时候，喜欢去看概念强行记住，当时以为记住了就懂了可等下次又会忘记，其实是还没有真正弄懂。想要弄懂，就要先知道到底难在哪，理清它们之间的关系，再去看概念性的东西，就轻松很多了。</p>
<h4 data-id="heading-0">一、原型和原型链的核心难点拆解</h4>
<p>难点 1：<code>__proto__</code>、<code>prototype</code>、<code>constructor</code> 三者的关系（最易混淆）</p>
<p>这三个属性是原型体系的 “三角关系”，新手很容易记混、用错，先看核心结论</p>
<ul>
<li>prototype：<strong>函数独有</strong>，指向“原型对象”，原型对象里默认有constructor属性。</li>
<li><code>__proto__</code>：<strong>所有对象独有</strong>，指向自己的“原型对象”。</li>
<li>constructor：<strong>原型对象独有</strong>，指向创建该原型对象的构造函数。</li>
</ul>
<p>核心公式（必记）</p>
<pre><code class="hljs language-js" lang="js">实例.<span class="hljs-property">__proto__</span> === 构造函数.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
构造函数.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === 构造函数
实例.<span class="hljs-property">constructor</span> === 构造函数 （本质是通过原型链查找 constructor）
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
	<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
}
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'老王'</span>)
<span class="hljs-comment">// 验证1，实例的隐式原型（__proto__）=== 构造函数的显式原型（prototype）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>,) <span class="hljs-comment">// true</span>
<span class="hljs-comment">// 验证2，原型对象的constructor指向构造函数</span>
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>) <span class="hljs-comment">// true</span>
<span class="hljs-comment">// 验证3，实例的本身没有constructor 是通过原型链找到原型对象的constructor</span>
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>) <span class="hljs-comment">//true</span>
</code></pre>
<p>原型对象本身也是对象，因此它的 <code>__proto__</code> 会指向<strong>更高层的原型对象</strong>，最终形成原型链</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Person.prototype 是对象，其 __proto__ 指向 Object.prototype</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>; <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Object.prototype 是原型链的顶端，其 __proto__ 为 null</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-literal">null</span>; <span class="hljs-comment">// true</span>
</code></pre>
<p>注意点：修改 <code>prototype</code> 会影响 <code>constructor</code></p>
<p>若直接覆盖构造函数的 <code>prototype</code>（而非添加属性），会丢失原有的 <code>constructor</code>（默认指向 <code>Object</code>），需手动恢复</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 错误示例：直接覆盖prototype，constructor会指向Object</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
  <span class="hljs-attr">sayHi</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hi'</span>); }
};
p.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Object</span>; <span class="hljs-comment">// true（不符合预期）</span>

<span class="hljs-comment">// 正确做法：覆盖后手动设置constructor</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
  <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Person</span>, <span class="hljs-comment">// 手动指向原构造函数</span>
  <span class="hljs-attr">sayHi</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hi'</span>); }
};
p.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>; <span class="hljs-comment">// true（恢复预期）</span>
</code></pre>
<p>总结三者的核心关系</p>
<pre><code class="hljs language-javascript" lang="javascript">构造函数（如<span class="hljs-title class_">Person</span>）
  ↓ 拥有
  prototype → 原型对象（如<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>）
                ↓ 拥有
                constructor → 构造函数（<span class="hljs-title class_">Person</span>）
实例（如p）
  ↓ 拥有
  __proto__ → 原型对象（<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>）
</code></pre>
<p>二，原型和原型链的核心理解</p>
<p>简单来说每个函数创建都会默认添加一个prototype的属性，创建每个对象也会有一个__proto__的属性，上面也验证过 实例的__proto__(隐式原型)是指向构造函数的prototype(显示原型的)两者是相等的。</p>
<p>构造函数.prototype也是一个对象，所以也会有一个__proto__，指向的是<strong>Object.prototype</strong>,因此<strong>Object.prototype</strong>也是一个对象，所以也会有__proto__，Object.prototype.<strong>proto</strong> 指向的却是null，因为这是原型链的最顶层了，顶层就是null</p>
<p><strong>原型链</strong>：实例会先从自身上找，没找到会通过obj.<strong>proto</strong> 从原型对象上去找（构造函数.prototype）,没找到会通过obj.<strong>proto</strong>.<strong>proto</strong> 从原型对象上的原型上去找（构造函数.prototype.<strong>proto</strong>）,直到最顶层Object.prototype去找没找到，就回去Object.prototype.<strong>proto</strong> 值为null 结束 返回 undefined</p>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = <span class="hljs-number">20</span>
        }

        <span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'zhangsan'</span>)
        <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">age2</span> = <span class="hljs-number">30</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">age3</span> = <span class="hljs-number">40</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>) <span class="hljs-comment">//访问的是自身上的属性</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age2</span>) <span class="hljs-comment">//访问的是原型对象上的属性</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age3</span>) <span class="hljs-comment">//访问的是原型对象的原型上的属性</span>

        <span class="hljs-comment">/**
         * obj={
         *   console.log(obj.age) 30  先找自身
         * __proto__ === 构造函数.prototype {
         *     console.log(obj.age2) 30  如果自身没有找到 就会去找原型对象
         *   Person.prototype.__proto__ === Object.prototype ={
         *       console.log(obj.age3) 40  原型对象上没有  就会去找原型对象上的原型上去找
         *     }
         *      Object.prototype.__proto__ {
         *        直到最顶层  Object.prototype 它的__proto__ === null  所有原型链的最顶层就是
         *      }  
         *   
         *   }
         * 
         * }
         * **/</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>