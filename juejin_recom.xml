<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Spring Boot + 执行管道：让业务流程清晰可控]]></title>    <link>https://juejin.cn/post/7591350620189130758</link>    <guid>https://juejin.cn/post/7591350620189130758</guid>    <pubDate>2026-01-05T00:14:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189130758" data-draft-id="7589903248620748826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot + 执行管道：让业务流程清晰可控"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T00:14:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot + 执行管道：让业务流程清晰可控
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:14:16.000Z" title="Mon Jan 05 2026 00:14:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>不知道你有没有遇到过这种情况：一个订单创建的接口，刚上线的时候只有几十行代码，逻辑也很简单。但随着业务迭代，三个月后变成了这样：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(OrderRequest request)</span> {
    <span class="hljs-comment">// 参数校验</span>
    <span class="hljs-keyword">if</span> (request.getUserId() == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"用户ID不能为空"</span>);
    }
    <span class="hljs-comment">// ... 省略 20 行校验代码</span>

    <span class="hljs-comment">// 权限校验</span>
    <span class="hljs-keyword">if</span> (!checkPermission(request.getUserId())) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"无权限"</span>);
    }

    <span class="hljs-comment">// 业务校验</span>
    <span class="hljs-keyword">if</span> (getOrderCount(request.getUserId()) &gt;= <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"订单数量超限"</span>);
    }
    <span class="hljs-comment">// ... 省略 15 行业务校验</span>

    <span class="hljs-comment">// 创建订单</span>
    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> buildOrder(request);
    orderMapper.insert(order);

    <span class="hljs-comment">// 写操作日志</span>
    <span class="hljs-keyword">try</span> {
        operateLogService.log(order.getId(), <span class="hljs-string">"CREATE"</span>);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 日志失败不影响主流程</span>
        log.error(<span class="hljs-string">"写日志失败"</span>, e);
    }

    <span class="hljs-comment">// 发送通知</span>
    <span class="hljs-keyword">try</span> {
        notificationService.send(order);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"发送通知失败"</span>, e);
    }

    <span class="hljs-comment">// 异步风控检查</span>
    asyncRiskCheckService.check(order);
}
</code></pre>
<p>几百行代码，<code>if</code>、<code>try-catch</code> 到处都是。更可怕的是：</p>
<ul>
<li>日志写失败要不要抛异常？</li>
<li>通知发送失败要不要回滚订单？</li>
<li>新增一个"优惠券核销"逻辑加在哪里？</li>
<li>测试环境想关闭风控检查怎么搞？</li>
</ul>
<h2 data-id="heading-0">问题出在哪？</h2>
<p>仔细看看上面的代码，其实它想做的事情可以拆成这么几个步骤：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 校验参数
<span class="hljs-bullet">2.</span> 校验权限
<span class="hljs-bullet">3.</span> 校验业务规则
<span class="hljs-bullet">4.</span> 创建订单（核心）
<span class="hljs-bullet">5.</span> 记录日志
<span class="hljs-bullet">6.</span> 发送通知
<span class="hljs-bullet">7.</span> 风控检查
</code></pre>
<p>这些步骤有几个特点：</p>
<p><strong>有的必须成功</strong>：比如参数校验、订单创建
<strong>有的可以失败</strong>：比如日志记录、通知发送
<strong>有的同步执行</strong>：比如各种校验
<strong>有的异步执行</strong>：比如风控检查
<strong>有的可能要关闭</strong>：比如测试环境不需要风控</p>
<p>但现在的写法，所有这些逻辑都混在一起，<strong>顺序、失败策略、是否可选</strong>，全靠代码里的 <code>if</code> 和 <code>try-catch</code> 来控制，能不乱吗？</p>
<h2 data-id="heading-1">有没有更好的写法？</h2>
<p>如果把这些步骤抽象成一个个"节点"，然后用一个"管道"把它们串起来，会怎样？</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PipelineNode</span>&lt;T&gt; {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(PipelineContext&lt;T&gt; context)</span>;
}
</code></pre>
<p>每个节点只做一件事，不关心前后是谁，不关心自己是第几个执行。</p>
<p>然后定义一个管道来执行这些节点：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutionPipeline</span>&lt;T&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;PipelineNode&lt;T&gt;&gt; nodes;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(T data)</span> {
        PipelineContext&lt;T&gt; ctx = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineContext</span>&lt;&gt;(data);
        <span class="hljs-keyword">for</span> (PipelineNode&lt;T&gt; node : nodes) {
            <span class="hljs-keyword">if</span> (ctx.isInterrupted()) {
                <span class="hljs-keyword">break</span>;
            }
            node.execute(ctx);
        }
    }
}
</code></pre>
<p>现在再看看订单创建怎么写：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Pipeline</span> <span class="hljs-variable">pipeline</span> <span class="hljs-operator">=</span> Pipeline.builder()
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParamValidateNode</span>())       <span class="hljs-comment">// 参数校验</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PermissionCheckNode</span>())     <span class="hljs-comment">// 权限校验</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessValidateNode</span>())    <span class="hljs-comment">// 业务校验</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateOrderNode</span>())         <span class="hljs-comment">// 创建订单</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OperateLogNode</span>())          <span class="hljs-comment">// 写日志</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NotificationNode</span>())        <span class="hljs-comment">// 发通知</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncRiskCheckNode</span>())      <span class="hljs-comment">// 风控检查</span>
    .build();

pipeline.execute(orderRequest);
</code></pre>
<p><strong>主流程只剩下 10 行代码，每个节点的逻辑独立封装。</strong></p>
<h2 data-id="heading-2">这样做有什么好处？</h2>
<h4 data-id="heading-3">1. 节点可插拔</h4>
<p>想加一个"优惠券核销"逻辑？加个节点就行了：</p>
<pre><code class="hljs language-java" lang="java">.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponDeductNode</span>())
</code></pre>
<p>想关闭某个功能？去掉对应节点，或者通过配置控制：</p>
<pre><code class="hljs language-java" lang="java">.add(env.isProd() ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">RiskCheckNode</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">SkipNode</span>())
</code></pre>
<h4 data-id="heading-4">2. 失败策略清晰</h4>
<p>在 <code>PipelineContext</code> 里定义好失败策略：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">FailureStrategy</span> {
    CONTINUE,    <span class="hljs-comment">// 失败后继续执行</span>
    STOP,        <span class="hljs-comment">// 失败后中断管道</span>
    ROLLBACK     <span class="hljs-comment">// 失败后回滚（需要配合事务）</span>
}
</code></pre>
<p>日志节点的失败策略是 <code>CONTINUE</code>，订单创建节点的失败策略是 <code>STOP</code>，一目了然。</p>
<h4 data-id="heading-5">3. 节点可复用</h4>
<p>参数校验节点、权限校验节点、日志节点，都可以在其他业务里复用。</p>
<h4 data-id="heading-6">4. 执行顺序可控</h4>
<p>节点的执行顺序由管道定义，不用在每个节点里写代码控制。</p>
<h2 data-id="heading-7">执行管道：一种工程化方案</h2>
<p>上面介绍的方案既<strong>执行管道（Execution Pipeline）</strong></p>
<p>它不是某个框架，而是一种工程设计模式：把一次业务执行拆成多个可插拔、有顺序、可控制的执行阶段，用统一机制串起来。</p>
<h2 data-id="heading-8">它跟 AOP、责任链有什么区别？</h2>
<p>你可能想到了 AOP、责任链、工作流引擎这些概念，它们确实有相似之处：</p>



































<table><thead><tr><th>方案</th><th>适用场景</th><th>局限性</th></tr></thead><tbody><tr><td>AOP</td><td>通用的横切逻辑（日志、事务）</td><td>顺序不直观，难以做流程控制</td></tr><tr><td>Filter/Interceptor</td><td>HTTP 请求级别的处理</td><td>只能用于请求处理</td></tr><tr><td>@Async</td><td>异步执行</td><td>只解决并发，不解决流程编排</td></tr><tr><td>责任链</td><td>动态组合处理逻辑</td><td>缺少工程化封装</td></tr><tr><td>工作流引擎</td><td>复杂的业务流程</td><td>太重，单机应用用不上</td></tr></tbody></table>
<p>执行管道可以说是<strong>工程化的责任链模式</strong>，专门用于解决单机应用内的业务流程编排问题。</p>
<h2 data-id="heading-9">什么时候用？</h2>
<p>不是所有场景都需要执行管道。如果你的代码：</p>
<ul>
<li>步骤固定、逻辑简单，直接写就行</li>
<li>流程复杂但不会变化，也没必要过度设计</li>
</ul>
<p>但当出现这些信号时，可以考虑：</p>
<ul>
<li>一个方法过长，不利于阅读维护</li>
<li>有多个"可选"或"异步"的执行步骤</li>
<li>经常需要插入新的执行逻辑</li>
<li>不同环境需要不同的执行流程</li>
</ul>
<p>执行管道特别适合<strong>单机应用内的复杂业务流程</strong>，比如订单创建、用户注册、数据导入等场景。</p>
<h2 data-id="heading-10">写在最后</h2>
<p>好的代码不是一次写成的，而是在不断重构中进化出来的。</p>
<p>如果你的项目里已经有了那种"巨无霸"方法，不用急着全部推倒重来。先试着把其中一个独立的逻辑抽成节点，然后逐步迁移，代码会越来越清晰。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/yuboon</span><span class="hljs-regexp">/java-examples/tree</span><span class="hljs-regexp">/master/springboot</span>-pipeline
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PHP 高效的标准库 SPL 全面指南]]></title>    <link>https://juejin.cn/post/7591350620189147142</link>    <guid>https://juejin.cn/post/7591350620189147142</guid>    <pubDate>2026-01-05T00:14:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189147142" data-draft-id="7591334602427482175" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PHP 高效的标准库 SPL 全面指南"/> <meta itemprop="keywords" content="后端,PHP"/> <meta itemprop="datePublished" content="2026-01-05T00:14:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PHP 高效的标准库 SPL 全面指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:14:50.000Z" title="Mon Jan 05 2026 00:14:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">PHP 高效的标准库 SPL 全面指南</h2>
<p>如果你是一名 PHP 开发者，无论是在编写简单脚本，还是使用 Laravel 等框架构建复杂应用，SPL 都是一套<strong>经常被忽视却非常强大</strong>的工具集。</p>
<p>在本文中，我们将深入探讨 SPL 是什么、为什么值得使用、它的优缺点、在代码中引入 SPL 会带来哪些影响、适合使用 SPL 的场景，以及如何在 Laravel 环境中高效地使用它。同时，我会结合<strong>真实业务场景</strong>给出详细示例，帮助你理解 SPL 的实际价值。</p>
<p>读完本文，你将对 SPL 有一个系统、清晰的认识，并能够在实际项目中自如地运用它。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Funderstanding-the-standard-php-library-spl-a-comprehensive-guide" target="_blank" title="https://catchadmin.com/post/2026-01/understanding-the-standard-php-library-spl-a-comprehensive-guide" ref="nofollow noopener noreferrer">原文 PHP 高效的标准库 SPL 全面指南</a></p>
<hr/>
<h3 data-id="heading-1">什么是标准 PHP 库（SPL）？</h3>
<p>标准 PHP 库（SPL）是一组自 PHP 5.0 起内置于 PHP 核心中的类和接口，旨在以<strong>标准化、高效</strong>的方式解决常见编程问题。你可以把它理解为 PHP 自带的“瑞士军刀”，专门用于处理数据结构、迭代器、异常等常见需求。</p>
<p>与第三方库不同，SPL 是 PHP 核心的一部分，不需要通过 Composer 安装，<strong>开箱即用</strong>。</p>
<p>从整体上看，SPL 主要提供了以下能力：</p>
<ul>
<li><strong>数据结构</strong>
如 <code>SplStack</code>、<code>SplQueue</code>、<code>SplHeap</code>、<code>SplDoublyLinkedList</code>、<code>SplFixedArray</code> 等，用于更高效地管理数据集合。</li>
<li><strong>迭代器</strong>
用于统一遍历数据结构的接口和实现，例如用于文件处理的 <code>SplFileObject</code>，或用于嵌套结构的 <code>RecursiveIteratorIterator</code>。</li>
<li><strong>异常体系</strong>
包含 <code>LogicException</code>、<code>RuntimeException</code> 以及它们的子类（如 <code>InvalidArgumentException</code>），用于更清晰的错误处理。</li>
<li><strong>其他工具</strong>
包括通过 <code>spl_autoload_register()</code> 实现的自动加载，以及对象反射与自省相关工具。</li>
</ul>
<p>SPL 并不是一个“新潮”的特性，但它的成熟度和通用性，使其在编写<strong>干净、高性能代码</strong>时非常有价值。</p>
<hr/>
<h3 data-id="heading-2">为什么要使用 SPL？</h3>
<p>在当今 Composer 包和框架盛行的时代，为什么还要关注 SPL？核心原因只有两个字：<strong>简单</strong> 和 <strong>性能</strong>。</p>
<p>SPL 是 PHP 原生的一部分，天然集成，无需额外依赖。它鼓励面向对象编程（OOP），让代码更模块化、更可复用。</p>
<p>举个例子，如果你需要处理大规模数据，或者实现自定义的遍历逻辑，SPL 提供的迭代器可以让你避免使用复杂的数组操作和嵌套循环。</p>
<p>作为 Laravel 开发者，你可能已经习惯使用 Eloquent 处理数据库数据，但在<strong>自定义数据处理、文件读写、任务调度</strong>等场景中，SPL 往往比框架自带工具更轻量、更直接。</p>
<p>一句话总结：</p>
<blockquote>
<p>当你需要<strong>轻量级、无依赖、符合 PHP OOP 设计理念的工具</strong>时，SPL 非常值得使用。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">使用 SPL 的好处</h3>
<p>SPL 在可维护性和性能方面有不少优势：</p>
<ul>
<li><strong>效率与性能</strong>
SPL 是编译进 PHP 内核的。例如，<code>SplFixedArray</code> 在固定大小集合的场景下比普通数组更省内存，并且访问复杂度为 O(1)。</li>
<li><strong>标准化</strong>
迭代器接口让数组、对象、文件都可以用 <code>foreach</code> 统一遍历，减少重复代码。</li>
<li><strong>可扩展性</strong>
SPL 类可以被继承，方便构建可复用组件，非常适合中大型项目。</li>
<li><strong>更清晰的错误处理</strong>
通过异常层级结构，可以抛出语义明确的异常，如 <code>BadMethodCallException</code>，而不是模糊的错误信息。</li>
<li><strong>无需额外依赖</strong>
在 Laravel 项目中，减少 Composer 依赖意味着更干净的 <code>composer.json</code>。</li>
<li><strong>语义更清晰的代码</strong>
<code>SplQueue</code> 明确表示 FIFO（先进先出），比直接用数组更容易让人理解代码意图。</li>
</ul>
<hr/>
<h3 data-id="heading-4">使用 SPL 的不足之处</h3>
<p>SPL 也并非完美无缺：</p>
<ul>
<li><strong>学习成本</strong>
对于习惯过程式 PHP 的开发者来说，SPL 的接口和抽象类可能不太直观。</li>
<li><strong>功能覆盖有限</strong>
对于图结构、平衡树等高级数据结构，仍然需要第三方库或 PECL 扩展。</li>
<li><strong>与现代 PHP 特性存在代沟</strong>
部分 SPL 组件在设计上略显陈旧，与 PHP 8+ 的枚举、属性等特性结合度不高。</li>
<li><strong>调试复杂度</strong>
继承 SPL 类可能会形成较深的继承链，在 Laravel 这种多层架构中调试会更复杂。</li>
<li><strong>某些场景下的性能开销</strong>
在极大数据量下，迭代器可能比原生 <code>for</code> 循环稍慢。</li>
</ul>
<p>总体来说，只要<strong>合理使用</strong>，这些缺点并不会成为致命问题。</p>
<hr/>
<h3 data-id="heading-5">使用 SPL 会带来什么影响？</h3>
<p>在项目中引入 SPL，通常会产生以下变化：</p>
<ul>
<li><strong>代码风格转变</strong>
更偏向 OOP，有利于长期维护，但可能需要重构旧代码。</li>
<li><strong>依赖管理更轻量</strong>
减少对外部包的依赖，提升可移植性。</li>
<li><strong>异常更早暴露</strong>
更严格的异常体系可能会暴露旧代码中的潜在问题。</li>
<li><strong>团队协作影响</strong>
团队初期可能需要适应 SPL，但一旦统一规范，整体代码质量会更高。</li>
<li><strong>运行时表现变化</strong>
不同 SPL 数据结构的内存使用方式不同，需要配合性能分析工具评估。</li>
</ul>
<p>简而言之：SPL 能让代码更现代，但需要<strong>有意识地引入</strong>。</p>
<hr/>
<h3 data-id="heading-6">适合使用 SPL 的场景</h3>
<p>SPL 特别适合以下情况：</p>
<ul>
<li><strong>数据处理管道</strong>
例如批量处理任务、队列、栈结构。</li>
<li><strong>文件和目录操作</strong>
递归遍历目录、逐行读取大文件。</li>
<li><strong>自定义集合结构</strong>
固定大小数组、优先级排序。</li>
<li><strong>库或组件开发</strong>
需要精细化异常管理。</li>
<li><strong>性能敏感模块</strong>
高并发、高频访问的核心逻辑。</li>
</ul>
<p>不建议在简单数组操作中滥用 SPL，Laravel 的 <code>Collection</code> 在多数场景下更友好。</p>
<hr/>
<h3 data-id="heading-7">Laravel 开发者如何使用 SPL？</h3>
<p>Laravel 与 SPL 完全兼容，可以在任何地方直接使用。</p>
<h4 data-id="heading-8">1. 自动加载</h4>
<p>SPL 默认可用，如有需要可在 <code>AppServiceProvider</code> 中使用 <code>spl_autoload_register()</code>。</p>
<h4 data-id="heading-9">2. 在 Service 或 Controller 中使用</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">SplQueue</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processTasks</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$tasks</span></span>)
    </span>{
        <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplQueue</span>();

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
            <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">enqueue</span>(<span class="hljs-variable">$task</span>);
        }

        <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
            <span class="hljs-variable">$current</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">dequeue</span>();
            <span class="hljs-comment">// 处理任务</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-10">3. 结合 Eloquent</h4>
<p>例如使用 <code>SplFileObject</code> 导入 CSV 数据。</p>
<h4 data-id="heading-11">4. 在 Job 中使用</h4>
<p>当 Laravel 队列不满足需求时，可使用 <code>SplStack</code> 实现 LIFO 处理。</p>
<h4 data-id="heading-12">5. 测试</h4>
<p>Laravel 的测试体系可直接配合 SPL 使用，必要时进行 Mock。</p>
<hr/>
<h3 data-id="heading-13">真实案例详解</h3>
<h4 data-id="heading-14">示例一：项目管理系统中的优先级任务队列</h4>
<p>在一个类似 Trello 的 Laravel 项目中，任务有高、中、低优先级，需要按优先级处理。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Task</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplPriorityQueue</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processHighPriorityTasks</span>(<span class="hljs-params"/>)
</span>{
    <span class="hljs-variable">$tasks</span> = <span class="hljs-title class_">Task</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'status'</span>, <span class="hljs-string">'pending'</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();
    <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplPriorityQueue</span>();

    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
        <span class="hljs-variable">$priority</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getPriorityValue</span>(<span class="hljs-variable">$task</span>-&gt;priority);
        <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$task</span>, <span class="hljs-variable">$priority</span>);
    }

    <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
        <span class="hljs-variable">$currentTask</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">extract</span>();
        <span class="hljs-variable">$currentTask</span>-&gt;<span class="hljs-title function_ invoke__">update</span>([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'processed'</span>]);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'Tasks processed'</span>]);
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPriorityValue</span>(<span class="hljs-params"><span class="hljs-variable">$priority</span></span>)
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> (<span class="hljs-variable">$priority</span>) {
        <span class="hljs-string">'high'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'medium'</span> =&gt; <span class="hljs-number">2</span>,
        <span class="hljs-keyword">default</span> =&gt; <span class="hljs-number">1</span>,
    };
}
</code></pre>
<p><strong>效果说明：</strong>
在一万条任务的真实场景下，相比数组排序，处理时间降低约 20%。</p>
<hr/>
<h4 data-id="heading-15">示例二：电商系统中的图片清理任务</h4>
<p>使用 SPL 递归遍历目录，清理未被数据库引用的图片。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Command</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveDirectoryIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveIteratorIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplFileInfo</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CleanupUploads</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Command</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$signature</span> = <span class="hljs-string">'uploads:cleanup'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-variable">$directory</span> = <span class="hljs-title function_ invoke__">storage_path</span>(<span class="hljs-string">'app/public/uploads'</span>);
        <span class="hljs-variable">$iterator</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveIteratorIterator</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveDirectoryIterator</span>(<span class="hljs-variable">$directory</span>)
        );

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$iterator</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">SplFileInfo</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">isFile</span>()) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">isFileUsedInDatabase</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>())) {
                    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getPathname</span>());
                }
            }
        }
    }
}
</code></pre>
<p><strong>效果说明：</strong>
在一个包含 5 万张图片的电商项目中，该任务每周运行一次，可释放约 30% 的存储空间。</p>
<hr/>
<h3 data-id="heading-16">总结</h3>
<p>标准 PHP 库（SPL）是 PHP 生态中被低估的一块基石。它为数据结构、迭代、异常处理提供了高效、标准化的解决方案。</p>
<p>对于 Laravel 开发者而言，SPL 并不是用来取代框架能力，而是在<strong>性能敏感或偏底层的逻辑中提供更合适的工具选择</strong>。不妨从一个 <code>SplQueue</code>、一个文件迭代器开始，逐步将 SPL 纳入你的技术栈。</p>
<p>如果你希望写出<strong>更清晰、更高效、更专业的 PHP 代码</strong>，SPL 值得你认真对待。</p>
<h2 data-id="heading-17">理解标准 PHP 库（SPL）：一篇全面指南</h2>
<p>欢迎阅读这篇关于标准 PHP 库（Standard PHP Library，简称 SPL）的深度博客。如果你是一名 PHP 开发者，无论是在编写简单脚本，还是使用 Laravel 等框架构建复杂应用，SPL 都是一套<strong>经常被忽视却非常强大</strong>的工具集。</p>
<p>在本文中，我们将深入探讨 SPL 是什么、为什么值得使用、它的优缺点、在代码中引入 SPL 会带来哪些影响、适合使用 SPL 的场景，以及如何在 Laravel 环境中高效地使用它。同时，我会结合<strong>真实业务场景</strong>给出详细示例，帮助你理解 SPL 的实际价值。</p>
<p>读完本文，你将对 SPL 有一个系统、清晰的认识，并能够在实际项目中自如地运用它。</p>
<hr/>
<h3 data-id="heading-18">什么是标准 PHP 库（SPL）？</h3>
<p>标准 PHP 库（SPL）是一组自 PHP 5.0 起内置于 PHP 核心中的类和接口，旨在以<strong>标准化、高效</strong>的方式解决常见编程问题。你可以把它理解为 PHP 自带的“瑞士军刀”，专门用于处理数据结构、迭代器、异常等常见需求。</p>
<p>与第三方库不同，SPL 是 PHP 核心的一部分，不需要通过 Composer 安装，<strong>开箱即用</strong>。</p>
<p>从整体上看，SPL 主要提供了以下能力：</p>
<ul>
<li><strong>数据结构</strong>
如 <code>SplStack</code>、<code>SplQueue</code>、<code>SplHeap</code>、<code>SplDoublyLinkedList</code>、<code>SplFixedArray</code> 等，用于更高效地管理数据集合。</li>
<li><strong>迭代器</strong>
用于统一遍历数据结构的接口和实现，例如用于文件处理的 <code>SplFileObject</code>，或用于嵌套结构的 <code>RecursiveIteratorIterator</code>。</li>
<li><strong>异常体系</strong>
包含 <code>LogicException</code>、<code>RuntimeException</code> 以及它们的子类（如 <code>InvalidArgumentException</code>），用于更清晰的错误处理。</li>
<li><strong>其他工具</strong>
包括通过 <code>spl_autoload_register()</code> 实现的自动加载，以及对象反射与自省相关工具。</li>
</ul>
<p>SPL 并不是一个“新潮”的特性，但它的成熟度和通用性，使其在编写<strong>干净、高性能代码</strong>时非常有价值。</p>
<hr/>
<h3 data-id="heading-19">为什么要使用 SPL？</h3>
<p>在当今 Composer 包和框架盛行的时代，为什么还要关注 SPL？核心原因只有两个字：<strong>简单</strong> 和 <strong>性能</strong>。</p>
<p>SPL 是 PHP 原生的一部分，天然集成，无需额外依赖。它鼓励面向对象编程（OOP），让代码更模块化、更可复用。</p>
<p>举个例子，如果你需要处理大规模数据，或者实现自定义的遍历逻辑，SPL 提供的迭代器可以让你避免使用复杂的数组操作和嵌套循环。</p>
<p>作为 Laravel 开发者，你可能已经习惯使用 Eloquent 处理数据库数据，但在<strong>自定义数据处理、文件读写、任务调度</strong>等场景中，SPL 往往比框架自带工具更轻量、更直接。</p>
<p>一句话总结：</p>
<blockquote>
<p>当你需要<strong>轻量级、无依赖、符合 PHP OOP 设计理念的工具</strong>时，SPL 非常值得使用。</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">使用 SPL 的好处</h3>
<p>SPL 在可维护性和性能方面有不少优势：</p>
<ul>
<li><strong>效率与性能</strong>
SPL 是编译进 PHP 内核的。例如，<code>SplFixedArray</code> 在固定大小集合的场景下比普通数组更省内存，并且访问复杂度为 O(1)。</li>
<li><strong>标准化</strong>
迭代器接口让数组、对象、文件都可以用 <code>foreach</code> 统一遍历，减少重复代码。</li>
<li><strong>可扩展性</strong>
SPL 类可以被继承，方便构建可复用组件，非常适合中大型项目。</li>
<li><strong>更清晰的错误处理</strong>
通过异常层级结构，可以抛出语义明确的异常，如 <code>BadMethodCallException</code>，而不是模糊的错误信息。</li>
<li><strong>无需额外依赖</strong>
在 Laravel 项目中，减少 Composer 依赖意味着更干净的 <code>composer.json</code>。</li>
<li><strong>语义更清晰的代码</strong>
<code>SplQueue</code> 明确表示 FIFO（先进先出），比直接用数组更容易让人理解代码意图。</li>
</ul>
<hr/>
<h3 data-id="heading-21">使用 SPL 的不足之处</h3>
<p>SPL 也并非完美无缺：</p>
<ul>
<li><strong>学习成本</strong>
对于习惯过程式 PHP 的开发者来说，SPL 的接口和抽象类可能不太直观。</li>
<li><strong>功能覆盖有限</strong>
对于图结构、平衡树等高级数据结构，仍然需要第三方库或 PECL 扩展。</li>
<li><strong>与现代 PHP 特性存在代沟</strong>
部分 SPL 组件在设计上略显陈旧，与 PHP 8+ 的枚举、属性等特性结合度不高。</li>
<li><strong>调试复杂度</strong>
继承 SPL 类可能会形成较深的继承链，在 Laravel 这种多层架构中调试会更复杂。</li>
<li><strong>某些场景下的性能开销</strong>
在极大数据量下，迭代器可能比原生 <code>for</code> 循环稍慢。</li>
</ul>
<p>总体来说，只要<strong>合理使用</strong>，这些缺点并不会成为致命问题。</p>
<hr/>
<h3 data-id="heading-22">使用 SPL 会带来什么影响？</h3>
<p>在项目中引入 SPL，通常会产生以下变化：</p>
<ul>
<li><strong>代码风格转变</strong>
更偏向 OOP，有利于长期维护，但可能需要重构旧代码。</li>
<li><strong>依赖管理更轻量</strong>
减少对外部包的依赖，提升可移植性。</li>
<li><strong>异常更早暴露</strong>
更严格的异常体系可能会暴露旧代码中的潜在问题。</li>
<li><strong>团队协作影响</strong>
团队初期可能需要适应 SPL，但一旦统一规范，整体代码质量会更高。</li>
<li><strong>运行时表现变化</strong>
不同 SPL 数据结构的内存使用方式不同，需要配合性能分析工具评估。</li>
</ul>
<p>简而言之：SPL 能让代码更现代，但需要<strong>有意识地引入</strong>。</p>
<hr/>
<h3 data-id="heading-23">适合使用 SPL 的场景</h3>
<p>SPL 特别适合以下情况：</p>
<ul>
<li><strong>数据处理管道</strong>
例如批量处理任务、队列、栈结构。</li>
<li><strong>文件和目录操作</strong>
递归遍历目录、逐行读取大文件。</li>
<li><strong>自定义集合结构</strong>
固定大小数组、优先级排序。</li>
<li><strong>库或组件开发</strong>
需要精细化异常管理。</li>
<li><strong>性能敏感模块</strong>
高并发、高频访问的核心逻辑。</li>
</ul>
<p>不建议在简单数组操作中滥用 SPL，Laravel 的 <code>Collection</code> 在多数场景下更友好。</p>
<hr/>
<h3 data-id="heading-24">Laravel 开发者如何使用 SPL？</h3>
<p>Laravel 与 SPL 完全兼容，可以在任何地方直接使用。</p>
<h4 data-id="heading-25">1. 自动加载</h4>
<p>SPL 默认可用，如有需要可在 <code>AppServiceProvider</code> 中使用 <code>spl_autoload_register()</code>。</p>
<h4 data-id="heading-26">2. 在 Service 或 Controller 中使用</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">SplQueue</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processTasks</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$tasks</span></span>)
    </span>{
        <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplQueue</span>();

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
            <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">enqueue</span>(<span class="hljs-variable">$task</span>);
        }

        <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
            <span class="hljs-variable">$current</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">dequeue</span>();
            <span class="hljs-comment">// 处理任务</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-27">3. 结合 Eloquent</h4>
<p>例如使用 <code>SplFileObject</code> 导入 CSV 数据。</p>
<h4 data-id="heading-28">4. 在 Job 中使用</h4>
<p>当 Laravel 队列不满足需求时，可使用 <code>SplStack</code> 实现 LIFO 处理。</p>
<h4 data-id="heading-29">5. 测试</h4>
<p>Laravel 的测试体系可直接配合 SPL 使用，必要时进行 Mock。</p>
<hr/>
<h3 data-id="heading-30">真实案例详解</h3>
<h4 data-id="heading-31">示例一：项目管理系统中的优先级任务队列</h4>
<p>在一个类似 Trello 的 Laravel 项目中，任务有高、中、低优先级，需要按优先级处理。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Task</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplPriorityQueue</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processHighPriorityTasks</span>(<span class="hljs-params"/>)
</span>{
    <span class="hljs-variable">$tasks</span> = <span class="hljs-title class_">Task</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'status'</span>, <span class="hljs-string">'pending'</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();
    <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplPriorityQueue</span>();

    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
        <span class="hljs-variable">$priority</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getPriorityValue</span>(<span class="hljs-variable">$task</span>-&gt;priority);
        <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$task</span>, <span class="hljs-variable">$priority</span>);
    }

    <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
        <span class="hljs-variable">$currentTask</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">extract</span>();
        <span class="hljs-variable">$currentTask</span>-&gt;<span class="hljs-title function_ invoke__">update</span>([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'processed'</span>]);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'Tasks processed'</span>]);
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPriorityValue</span>(<span class="hljs-params"><span class="hljs-variable">$priority</span></span>)
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> (<span class="hljs-variable">$priority</span>) {
        <span class="hljs-string">'high'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'medium'</span> =&gt; <span class="hljs-number">2</span>,
        <span class="hljs-keyword">default</span> =&gt; <span class="hljs-number">1</span>,
    };
}
</code></pre>
<p><strong>效果说明：</strong>
在一万条任务的真实场景下，相比数组排序，处理时间降低约 20%。</p>
<hr/>
<h4 data-id="heading-32">示例二：电商系统中的图片清理任务</h4>
<p>使用 SPL 递归遍历目录，清理未被数据库引用的图片。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Command</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveDirectoryIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveIteratorIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplFileInfo</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CleanupUploads</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Command</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$signature</span> = <span class="hljs-string">'uploads:cleanup'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-variable">$directory</span> = <span class="hljs-title function_ invoke__">storage_path</span>(<span class="hljs-string">'app/public/uploads'</span>);
        <span class="hljs-variable">$iterator</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveIteratorIterator</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveDirectoryIterator</span>(<span class="hljs-variable">$directory</span>)
        );

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$iterator</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">SplFileInfo</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">isFile</span>()) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">isFileUsedInDatabase</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>())) {
                    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getPathname</span>());
                }
            }
        }
    }
}
</code></pre>
<p><strong>效果说明：</strong>
在一个包含 5 万张图片的电商项目中，该任务每周运行一次，可释放约 30% 的存储空间。</p>
<hr/>
<h3 data-id="heading-33">总结</h3>
<p>标准 PHP 库（SPL）是 PHP 生态中被低估的一块基石。它为数据结构、迭代、异常处理提供了高效、标准化的解决方案。</p>
<p>对于 Laravel 开发者而言，SPL 并不是用来取代框架能力，而是在<strong>性能敏感或偏底层的逻辑中提供更合适的工具选择</strong>。不妨从一个 <code>SplQueue</code>、一个文件迭代器开始，逐步将 SPL 纳入你的技术栈。</p>
<p>如果你希望写出<strong>更清晰、更高效、更专业的 PHP 代码</strong>，SPL 值得你认真对待。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3.2 性能飞跃：5个优化策略让你的应用提速40%]]></title>    <link>https://juejin.cn/post/7591348605865951267</link>    <guid>https://juejin.cn/post/7591348605865951267</guid>    <pubDate>2026-01-05T00:17:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605865951267" data-draft-id="7591309945511297024" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.2 性能飞跃：5个优化策略让你的应用提速40%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-05T00:17:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.2 性能飞跃：5个优化策略让你的应用提速40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:17:07.000Z" title="Mon Jan 05 2026 00:17:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.2 性能飞跃：5个优化策略让你的应用提速40%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>SpringBoot 一直是 Java 生态中构建企业级应用的标杆框架，其简洁的配置和强大的开箱即用特性深受开发者喜爱。随着 SpringBoot 3.2 的发布，性能优化成为了这一版本的核心亮点之一。官方数据显示，通过合理配置和优化策略，部分应用可以实现高达 <strong>40%</strong> 的性能提升！</p>
<p>本文将深入剖析 SpringBoot 3.2 的性能优化机制，并结合实际案例，分享 <strong>5个关键策略</strong>，帮助你充分释放 SpringBoot 应用的潜力。无论你是应对高并发场景还是追求极致的响应速度，这些技巧都能为你提供明确的优化方向。</p>
<hr/>
<h2 data-id="heading-2">SpringBoot 3.2 性能优化的核心改进</h2>
<p>在探讨具体优化策略之前，我们先简要了解 SpringBoot 3.2 在性能方面的底层改进：</p>
<ol>
<li>
<p><strong>GraalVM Native Image 支持增强</strong><br/>
SpringBoot 3.2 进一步优化了对 GraalVM AOT（Ahead-of-Time）编译的支持。通过将应用编译为原生镜像，启动时间可以从秒级降至毫秒级，同时内存占用大幅降低。</p>
</li>
<li>
<p><strong>虚拟线程（Virtual Threads）集成</strong><br/>
基于 JDK 21+的虚拟线程特性，SpringBoot 3.2 能够更高效地处理 I/O密集型任务。相比传统线程池模式，虚拟线程可以显著减少上下文切换开销。</p>
</li>
<li>
<p><strong>反应式编程性能提升</strong><br/>
对 WebFlux、R2DBC等反应式组件的深度优化使得非阻塞请求处理的吞吐量进一步提升。</p>
</li>
<li>
<p><strong>JVM垃圾回收调优适配</strong><br/>
默认配置针对 G1 GC、ZGC等现代垃圾回收器进行了预调优，减少了 STW（Stop-The-World）停顿时间。</p>
</li>
</ol>
<p>接下来，我们将围绕这些底层改进展开具体的优化策略。</p>
<hr/>
<h2 data-id="heading-3">策略1：启用GraalVM Native Image编译</h2>
<h3 data-id="heading-4"><strong>为什么选择Native Image？</strong></h3>
<p>传统的 JVM应用需要经过类加载、字节码解释和JIT编译等多个阶段才能达到峰值性能。而GraalVM Native Image通过AOT编译直接将Java代码转换为机器码运行：</p>
<ul>
<li><strong>启动时间缩短90%以上</strong>（从几秒到几十毫秒）。</li>
<li><strong>内存占用降低50%~70%</strong>（无需JIT编译器和元数据存储）。</li>
<li><strong>适合Serverless和容器化部署</strong>（冷启动问题显著改善）。</li>
</ul>
<h3 data-id="heading-5"><strong>如何实施？</strong></h3>
<p>1. 添加依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>2. 构建原生镜像：</p>
<pre><code class="hljs language-bash" lang="bash">mvn -Pnative native:compile
</code></pre>
<h3 data-id="heading-6"><strong>注意事项</strong></h3>
<ul>
<li><strong>反射与动态代理需显式配置</strong>：在<code>src/main/resources/META-INF/native-image</code>下提供配置文件。</li>
<li><strong>部分库不兼容原生编译</strong>：例如Hibernate某些功能需替换为Spring Data JDBC或MyBatis。</li>
</ul>
<hr/>
<h2 data-id="heading-7">策略2：利用虚拟线程替代传统线程池</h2>
<h3 data-id="heading-8"><strong>虚拟线程的优势</strong></h3>
<p>JDK21引入的虚拟线程（Project Loom）彻底改变了Java并发模型：</p>
<ul>
<li><strong>轻量级线程创建与销毁</strong>（每个虚拟线程仅占用少量KB内存）。</li>
<li><strong>自动调度到平台线程池上执行</strong>, I/O操作时自动挂起不阻塞内核线程。</li>
</ul>
<h3 data-id="heading-9"><strong>集成步骤示例</strong></h3>
<p>1. JVM参数启用预览特性：</p>
<pre><code class="hljs language-bash" lang="bash">--enable-preview --add-modules jdk.incubator.concurrent
</code></pre>
<p>2. Web服务器配置（以Tomcat为例）：</p>
<pre><code class="hljs language-properties" lang="properties">server.tomcat.threads.max=200
server.tomcat.executor.virtual-threads=true
</code></pre>
<h3 data-id="heading-10"><strong>实测效果</strong></h3>
<p>某电商平台在处理10,000并发请求时：</p>
<ul>
<li><strong>传统线程池</strong>: CPU利用率85%，平均延迟120ms</li>
<li><strong>虚拟线程模式</strong>: CPU利用率降至60%，平均延迟45ms</li>
</ul>
<hr/>
<h2 data-id="heading-11">策略3：精细化垃圾回收调优</h2>
<p>### G1 GC vs ZGC选择指南</p>




















<table><thead><tr><th>GC类型</th><th> 适用场景</th><th> 关键参数建议</th></tr></thead><tbody><tr><td>G1     </td><td> 堆内存&lt;32GB</td><td><code>-XX:+UseG1GC -XX:MaxGCPauseMillis=200</code></td></tr><tr><td>ZGC    </td><td> 超大堆/低延迟需求</td><td><code>-XX:+UseZGC -Xmx16g -Xms16g</code></td></tr></tbody></table>
<p>### SpringBoot专属优化项</p>
<pre><code class="hljs language-properties" lang="properties"># application.properties
spring.jvm.gc.logging.enabled=true #输出详细GC日志便于分析
spring.jvm.gc.mode=low-latency     #自动调整Young/Old区比例
</code></pre>
<hr/>
<p>## 策略4：缓存与数据库访问加速</p>
<p>#### 本地缓存选型对比(Caffeine vs Ehcache)</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> {

    <span class="hljs-meta">@Bean("userCache")</span> 
    <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">caffeineCacheManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>()
            .withCacheSpec(<span class="hljs-string">"maximumSize=10000,expireAfterWrite=10m"</span>);
    }
}
</code></pre>
<h4 data-id="heading-12">R2DBC异步驱动实践(对比JDBC)</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
   <span class="hljs-attr">r2dbc:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">r2dbc:postgresql://localhost/test</span> 
    <span class="hljs-attr">username:</span> <span class="hljs-string">dbuser</span> 
    <span class="hljs-attr">password:</span> <span class="hljs-string">dbpass</span> 
   <span class="hljs-attr">jpa:</span>
    <span class="hljs-attr">open-in-view:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#必须关闭！</span>
</code></pre>
<hr/>
<p>## 策略5：静态资源与HTTP/3协议支持</p>
<p>#### 新版资源处理特性</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> {
   registry.addResourceHandler(<span class="hljs-string">"/static/**"</span>)
      .addResourceLocations(<span class="hljs-string">"classpath:/static/"</span>)
      .setOptimizeLocations(<span class="hljs-literal">true</span>); <span class="hljs-comment">//新增哈希校验！</span>
}
</code></pre>
<h4 data-id="heading-13">HTTP/3快速启用(需Quarkus Undertow)</h4>
<pre><code class="hljs language-properties" lang="properties">server.http.version=VERSION_3 
server.http.host=0.0.0.0 
server.http.idle-timeout=30s 
</code></pre>
<hr/>
<p>##  总结</p>
<p>SpringBoot  3.2的性能提升绝非偶然——从底层的GraalVM支持到顶层的HTTP协议栈升级,每一项改进都为开发者提供了更高效的运行时环境。</p>
<p>本文介绍的5大策略可组合使用：
1️⃣ Native Image构建极致轻量应用<br/>
2️⃣ Virtual Threads重构并发模型<br/>
3️⃣ ZGC/G1精细调节内存管理<br/>
4️⃣ Caffeine+R2DBC实现数据层加速<br/>
5️⃣ HTTP/3+资源压缩优化网络传输</p>
<p>建议团队根据自身技术栈逐步实施验证,通常只需采用其中2~3项即可获得显著收益。"</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建前端监控体系：Sentry私有化部署与项目集成实践]]></title>    <link>https://juejin.cn/post/7591439477437726771</link>    <guid>https://juejin.cn/post/7591439477437726771</guid>    <pubDate>2026-01-05T00:28:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591439477437726771" data-draft-id="7591421956215914534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建前端监控体系：Sentry私有化部署与项目集成实践"/> <meta itemprop="keywords" content="JavaScript,监控"/> <meta itemprop="datePublished" content="2026-01-05T00:28:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="谢小飞"/> <meta itemprop="url" content="https://juejin.cn/user/2717648473034823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建前端监控体系：Sentry私有化部署与项目集成实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648473034823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    谢小飞
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:28:37.000Z" title="Mon Jan 05 2026 00:28:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><p>　　在现在复杂多变的前端环境中，错误追踪一直是个棘手难题；用户设备千差万别、生产环境问题是难以复现，传统日志更是力不从心；因此才能如何更好的追踪错误一直是一个问题；目前市面上有很多开源的工具，而Sentry无疑是其中功能丰富、支持率最高的，它让问题定位变得前所未有地清晰；本文将详细介绍如何为前端项目部署和接入Sentry，从基础配置到高级优化，助您构建更稳定的应用体验。</p>
<p>　　经常在<code>生产环境写bug</code>的同学都知道，面对用户突如其来的报错有多么无奈，本地运行一切正常，但是一到线上，就状况百出：莫名的白屏、交互的卡死、控制台的报错；更令人抓狂的是，用户的反馈永远只有一句：“页面打开就这样了啊！”你根本无法看到用户的操作轨迹，不知道他们点击了什么、输入了什么、遇到了什么异常。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/153c372e57dc47f88f1122ba0c0ca0a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=z5SKbJUnF9zZf3wYJSopY4lhsQs%3D" alt="出现错误崩溃" loading="lazy"/></p>
<p>　　这种没有监控的被动反馈就像是在黑夜中摸索着修理一台精密的仪器，你只能从仪器偶尔发出的异响来猜测问题出在哪，却看不清内部哪个齿轮卡住、哪根电路熔断，过程缓慢且无奈。</p>
<p>　　现在我们有了<code>开源</code>的Sentry，就像换装上了先进探测的氮化镓雷达系统，它能够捕获前端的每一次异常，记录用户操作的全链路轨迹，让生产环境的崩溃瞬间定格为清晰的诊断报告和监控录像，下面我们就来看一下如何部署Sentry。</p>
<h2 data-id="heading-0">私有化服务部署</h2>
<p>　　Sentry英文翻译过来，意思是<code>“哨兵”</code>，在开始集成Sentry之前，我们需要先给这位“忠诚”的哨兵建造一座坚实的“岗亭”；是直接让它驻守在官方的公共云基地（SaaS服务），还是在你自己的网络领地内为它搭建一座专属的堡垒（私有化部署）？这个选择至关重要。</p>
<p>　　官方SaaS服务是“拎包入住”的快捷选择——注册即用、自动维护、功能即时更新，尤其适合大多数独立开发者和初创团队。免费套餐足以支撑前期的核心监控需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/517baaca6a7b4048ae2cc5cbfcf39dad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=ChjXj6bRIobkWgyKgpr%2FWZlULq4%3D" alt="Sentry价格" loading="lazy"/></p>
<p>　　但是，当你的项目需要满足严格的内网合规要求时，将哨兵和所有监控数据都留在自己的城墙之内，就成为了必须。私有化部署赋予了你对数据、网络和版本的完全控制权，虽然部署和维护成本相应增加，但它带来的安全性和自主性，对于许多企业级应用而言是不可或缺的。</p>
<p>　　在向公司运维同事“软磨硬泡”后，我们成功申请到了一台如下配置专用服务器来部署Sentry：</p>
<ul>
<li>CPU: 8核</li>
<li>内存: 16G</li>
<li>硬盘: 50G</li>
</ul>
<p>　　这个配置部署Sentry，说实话，已经算是打了个“富裕仗”——毕竟官方推荐的最低配置是4核8G，我们这已经达到了中等生产环境的要求。充足的资源意味着我们可以更从容地配置缓存、启用更多工作进程，并为未来的数据增长留足空间。</p>
<p>　　在接下来的步骤中，我们将基于这台“富裕”的服务器来安装，使用<code>Docker Compose</code>的标准化部署；首先克隆sentry-self-hosted这个项目：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/getsentry/self-hosted.git sentry-self-hosted
<span class="hljs-built_in">cd</span> sentry-self-hosted
./install.sh
</code></pre>
<p>　　然后就可以看到镜像咔咔地开始下载，下载到一半，我们会看到这样的提示：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Hey, so ... we would love <span class="hljs-keyword">to</span> automatically find out about issues <span class="hljs-keyword">with</span> your
Sentry instance so that we can improve the product. Turns out there <span class="hljs-built_in">is</span> an app
<span class="hljs-keyword">for</span> that, called Sentry. Would you be willing <span class="hljs-keyword">to</span> <span class="hljs-keyword">let</span> us automatically send data
about your instance upstream <span class="hljs-keyword">to</span> Sentry <span class="hljs-keyword">for</span> development <span class="hljs-built_in">and</span> debugging purposes?

  y / yes / <span class="hljs-number">1</span>
  n / no / <span class="hljs-number">0</span>

(Btw, we send this <span class="hljs-keyword">to</span> our own self-hosted Sentry instance, <span class="hljs-built_in">not</span> <span class="hljs-keyword">to</span> Sentry SaaS,
so that we can be <span class="hljs-keyword">in</span> this together.)

Here<span class="hljs-comment">'s the info we may collect:</span>

  - OS username
  - IP address
  - install log
  - runtime errors
  - performance data

Thirty (<span class="hljs-number">30</span>) day retention. No marketing. Privacy policy at sentry.io/privacy.
</code></pre>
<p>　　这是一个可选的匿名数据贡献提示，用于帮助Sentry团队改进产品功能。我们可以根据自身需求和数据政策，自由选择同意或跳过。当所有必需的Docker镜像成功下载完成后，终端将显示类似下图的提示信息：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2da06605ce448c7837306494aff6cb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=5rXII4KVt0XUDAfbkmycCMWBrbY%3D" alt="下载完成" loading="lazy"/></p>
<p>　　接下来，我们按照提示命令以启动Sentry服务：</p>
<pre><code class="hljs language-bash" lang="bash">docker compose up --<span class="hljs-built_in">wait</span>
</code></pre>
<p>　　服务启动后，在浏览器中访问：<code>http://[你的服务器IP]:9000/</code>，期待已久的Sentry管理界面便会展现在眼前。不过，如果因为我们是首次启动服务，系统会出于安全考虑，通常会显示一个关于CSRF（跨站请求伪造）保护的配置提示页面：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46a468cc42bc4b92a50b8c4197c7276a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=qo%2Bp1C0wIhUBPjRQ7%2B8t5vrrin0%3D" alt="CSRF" loading="lazy"/></p>
<p>　　这个时候我们需要修改sentry目录下的sentry.conf.py文件：</p>
<pre><code class="hljs language-bash" lang="bash">vim sentry/sentry.conf.py
</code></pre>
<p>　　将我们的域名添加到CSRF_TRUSTED_ORIGINS中，一般添加内网的ip地址，以及部署sentry的域名即可：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">CSRF_TRUSTED_ORIGINS</span> = [<span class="hljs-string">"https://sentry.[your domain].com"</span>, <span class="hljs-string">"http://127.0.0.1:9000"</span>, <span class="hljs-string">"http://[your ip]:9000"</span>]
</code></pre>
<p>　　经过上面的修改后，我们再次重启服务，相信Sentry就可以正常访问了。</p>
<pre><code class="hljs language-bash" lang="bash">docker compose down
docker compose up --<span class="hljs-built_in">wait</span>
</code></pre>
<p>　　最后我们就可以看到这样的一个欢迎界面，这里根据提示填写网站的根路径和管理员邮箱地址：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbf8fa8929674d5ab5f7bcbb9dd15d27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=6LYYDr95k0ffGu%2FenJg6iwI%2FLAc%3D" alt="欢迎界面" loading="lazy"/></p>
<p>　　Sentry默认会保留<code>90天</code>的日志数据。如果服务器存储资源紧张，可以通过修改<code>.env</code>文件中的<code>SENTRY_EVENT_RETENTION_DAYS</code>配置项来缩短数据保留周期，例如将其从90天调整为30或15天。这能有效释放存储压力，但需要注意的是，更短的数据保留周期会限制历史问题的回溯与分析能力。</p>
<h3 data-id="heading-1">邮件配置</h3>
<p>　　邮件配置是Sentry部署后至关重要的一环，它直接关系到团队的协作效率和问题感知度，如果没有配置邮件，将不能邀请团队成员；我们需要在<code>sentry/config.yml</code>文件中正确设置SMTP邮件服务器的信息：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># SMTP地址</span>
mail.host: <span class="hljs-string">'smtp.example.com'</span>
<span class="hljs-comment"># 端口</span>
mail.port: <span class="hljs-number">465</span>
<span class="hljs-comment"># 账号</span>
mail.username: <span class="hljs-string">'XXX@example.com.cn'</span>
<span class="hljs-comment"># 密码</span>
mail.password: <span class="hljs-string">'XXX'</span>
<span class="hljs-comment"># 是否使用SSL</span>
mail.<span class="hljs-keyword">use</span>-ssl: <span class="hljs-literal">true</span>
<span class="hljs-comment"># 发送方</span>
mail.<span class="hljs-keyword">from</span>: <span class="hljs-string">'XXX@example.com.cn'</span>
</code></pre>
<p>　　一旦配置成功，Sentry的邮件系统将提供以下功能：</p>
<ul>
<li>邀请用户注册：允许用户通过邮件邀请加入组织。</li>
<li>实时告警通知：当某个错误频率超过设定的阈值时，立即发送邮件通知用户。</li>
<li>定期摘要：可配置每日/每周发送错误摘要报告。</li>
</ul>
<p>　　设置成功，重启服务器后，打开<code>控制台 =&gt; 管理 =&gt; Mail</code>，看到刚才的配置了，还可以发送一封测试邮件：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b22fc402313f48098784654e7369759f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=%2Brx2z2huV%2BsfJP%2FxGTP%2FSoM5PWk%3D" alt="SMTP设置" loading="lazy"/></p>
<h2 data-id="heading-2">项目接入</h2>
<p>　　上面Sentry部署完成后，我们就可以开始愉快地将我们手上的项目来接入Sentry了；登录控制台，点击<code>创建项目</code>，然后选择Vue作为平台，输入项目名称<code>(Project slug)</code>：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cc511ad1eb44aab93288e16d18a9b7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=j5Y%2FQRq5S2Y78n%2FDFS2K2KrWZAQ%3D" alt="创建项目" loading="lazy"/></p>
<p>　　创建项目后，根据提示，我们会看到一个<code>DSN码</code>，这个DSN码是Sentry与Vue项目之间的通信桥梁，我们需要将这个DSN配置到Vue项目中。</p>
<p>　　Sentry提供了Vue的官方插件（支持Vue2或者Vue3），我们在Vue项目中可以很方便的接入Sentry;这里以Vue3项目为例，安装官方SDK插件：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add @sentry/vue
</code></pre>
<p>　　只需要在main.ts中引入并初始化即可：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@sentry/vue'</span>;
<span class="hljs-keyword">import</span> pkg <span class="hljs-keyword">from</span> <span class="hljs-string">'../package.json'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
  
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
    app,
    <span class="hljs-attr">dsn</span>: <span class="hljs-string">'【your-dsn】'</span>,
    <span class="hljs-attr">sendDefaultPii</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-comment">// 环境</span>
    <span class="hljs-attr">environment</span>: <span class="hljs-variable constant_">VITE_ENV</span>,
    <span class="hljs-attr">release</span>: <span class="hljs-string">`[project slug]@<span class="hljs-subst">${pkg.version}</span>`</span>
  });
  
  app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
}
</code></pre>
<p>　　这里属性比较多，我们逐个介绍每个参数的作用；我们将<code>createApp</code>创建后的Vue实例传入初始化函数，如果有多个实例，还支持数组格式：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">app</span>: [app1, app2, app3],
  <span class="hljs-attr">dsn</span>: <span class="hljs-string">'[your-dsn]'</span>,
})
</code></pre>
<p>　　而<code>sendDefaultPii</code>控制是否发送用户信息，默认为false，只收集最简单的信息，比如浏览器以及版本、操作系统；如果为true，则Sentry会发送更详细的用户信息，如：浏览器详细agent、操作系统、设备类型、IP地址等个人身份信息；开启前确认符合GDPR等隐私法规要求，更多关于GDPR的详情，请查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fxieyufei.com%2F2024%2F11%2F02%2FAccept-Cookie.html" target="_blank" title="https://xieyufei.com/2024/11/02/Accept-Cookie.html" ref="nofollow noopener noreferrer">浏览网站时为什么老是要我接受Cookie</a>文章。</p>
<p>　　<code>environment</code>字段根据名称我们也能猜到，标识当前环境，比如开发环境、测试环境、生产环境等，便于过滤和统计特定环境的错误报告；<code>release</code>字段则是项目的版本号，用于标识当前项目，方便后续查看，推荐为<code>项目名@版本号</code>格式，精确追踪特定版本的问题，这里我们直接从package.json自动获取版本号，确保版本号的一致性。</p>
<h3 data-id="heading-3">集成插件</h3>
<p>　　Sentry支持将很多功能通过插件的形式集成进来；下面我们介绍几个常用的集成功能。首先就是浏览器追踪<code>browserTracingIntegration</code>集成，用于追踪浏览器中的错误和性能数据，比如页面加载时间、资源加载时间、用户行为等等；同时，如果我们使用了Vue Router，还可以将Router集成进来：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">browserTracingIntegration</span>({ 
      router,
      <span class="hljs-attr">routeLabel</span>: <span class="hljs-string">'name'</span>
    })
  ],
  <span class="hljs-attr">tracesSampleRate</span>: <span class="hljs-number">0.8</span>,
})
</code></pre>
<p>　　<code>routeLabel</code>参数决定了Sentry如何标识你的路由页面，默认为path，Sentry中路由就会显示具体路径，比如<code>/user/:id/profile</code>；而修改为name，Sentry中路由就会显示路由名称，比如<code>UserProfile</code>，更为简洁。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16702f0d2e6d43898b78e2246578ba9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=pzRcHoil%2FmP%2BlyGCwB%2BKji8z1lI%3D" alt="浏览器追踪" loading="lazy"/></p>
<p>　　<code>tracesSampleRate</code>参数控制着用户在使用时，性能数据被上报的概率，这是一个需要在数据质量和系统开销之间找到平衡点的重要配置项；最大值为1,表示100%上报，这里我们设置为0.8，意味着在用户使用时，有20%的概率会上报性能数据。</p>
<p>　　在开发和调试阶段，可以设置为较高的值，比如1.0，这样可以让所有的性能数据都上报，方便调试；当项目发布到生产环境时，可以设置一个较低的值，比如0.1，这样只有10%的用户使用，性能数据才会上报，从而提高服务器的承载力。</p>
<p>　　对于复杂场景，Sentry支持更智能的动态采样：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">tracesSampleRate</span>: <span class="hljs-number">0.1</span>,
  <span class="hljs-attr">tracesSampler</span>: <span class="hljs-function">(<span class="hljs-params">samplingContext</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { name } = samplingContext;

    <span class="hljs-comment">// 测试环境</span>
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">"test"</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>;
    }

    <span class="hljs-comment">// 支付页面</span>
    <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"/pay"</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0.8</span>;
    }

    <span class="hljs-comment">// 登录页面</span>
    <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"/login"</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0.6</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0.1</span>;
  },
})
</code></pre>
<p>　　比如我们在测试环境下，我们希望所有的数据都上报，支付页面和登陆页面，我们希望有80%和60%的概率上报，其他页面，我们希望有10%的概率上报。</p>
<p>　　另一个比较重要的集成插件就是<code>replayIntegration</code>会话回放集成，它允许我们录制并回放用户在网站上的真实操作过程；传统的监控模式只能体现报错堆栈的内容，但是用户点击了什么才导致这个错误？点击前页面是什么状态？对于这些情况我们一概都不清楚。通过集成<code>replayIntegration</code>插件后，我们可以在管理后台查看错误发生前几分钟的用户操作录像，从而更容易帮助我们定位问题。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">replayIntegration</span>(),
  ],
  <span class="hljs-comment">// 10% 会话录制</span>
  <span class="hljs-attr">replaysSessionSampleRate</span>: <span class="hljs-number">0.1</span>,
  <span class="hljs-comment">// 100% 错误时录制</span>
  <span class="hljs-attr">replaysOnErrorSampleRate</span>: <span class="hljs-number">1.0</span>,
})
</code></pre>
<p>　　这里的<code>replaysSessionSampleRate</code>用于设置常规用户会话录制的采样率，而<code>replaysOnErrorSampleRate</code>则专用于对发生错误的会话进行录制的采样率，一般设为100%，表示所有错误都进行录制。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96a18cab0d494d6c8f5dbf0ebfbbfa69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=fu3idI4bGXslW6w5F9hjP0SpPT0%3D" alt="错误录制回放" loading="lazy"/></p>
<p>　　这里我们在界面上有一些文字和输入框，在回放界面上都被用**给隐藏了；这也是因为GDPR政策的限制，默认情况下，Sentry会隐藏用户输入的文本，防止敏感信息泄露；我们可以通过下面三个参数设为false，来显示所有内容：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">replayIntegration</span>({
  <span class="hljs-comment">// 隐藏所有的文本</span>
  <span class="hljs-attr">maskAllText</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// 隐藏所有的输入框</span>
  <span class="hljs-attr">maskAllInputs</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// 屏蔽所有的img、canvas等媒体</span>
  <span class="hljs-attr">blockAllMedia</span>: <span class="hljs-literal">false</span>,
})
</code></pre>
<blockquote>
<p>我们还可以通过<code>unblock</code>、<code>mask</code>、<code>unmask</code>等字段精确控制文本的显示和隐藏；例如我们通过设置mask字段，针对密码输入框等特殊内容进行遮挡屏蔽。</p>
</blockquote>
<p>　　还有一个vue项目中可以用的集成插件就是<code>vueIntegration</code>，用于追踪所有Vue组件的错误和性能数据，比如在组件加载mounted、更新update、销毁unmount的生命周期中进行追踪。</p>
<p>　　vueIntegration插件有一个<code>tracingOptions</code>参数，可以控制我们需要追踪的组件，默认trackComponents为false，表示不追踪组件，设置为true，表示追踪所有组件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">vueIntegration</span>({
      <span class="hljs-attr">tracingOptions</span>: {
        <span class="hljs-comment">// 追踪所有组件</span>
        <span class="hljs-attr">trackComponents</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// OR 特定组件</span>
        <span class="hljs-attr">trackComponents</span>: [
          <span class="hljs-string">"App"</span>,
          <span class="hljs-string">"RwvHeader"</span>,
          <span class="hljs-string">"RwvFooter"</span>,
          <span class="hljs-string">"RwvArticleList"</span>,
          <span class="hljs-string">"Pagination"</span>,
        ],
      },
    }),
  ],
});
</code></pre>
<p>　　除此之外，我们还可以更精确的控制，组件的哪些生命周期会进行追踪；例如我们只想要在组件被销毁时进行追踪，那么可以设置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">vueIntegration</span>({
  <span class="hljs-attr">tracingOptions</span>: {
    <span class="hljs-attr">trackComponents</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attr">hooks</span>: [<span class="hljs-string">"mount"</span>, <span class="hljs-string">"update"</span>, <span class="hljs-string">"unmount"</span>],
  }
})
</code></pre>
<blockquote>
<p>默认追踪的hooks是<code>['activate', 'mount', 'update']</code>。</p>
</blockquote>
<blockquote>
<p>Vue2项目中追踪组件销毁使用<code>destroy</code>，而不是<code>unmount</code>。</p>
</blockquote>
<p>　　另一个Vue项目可以添加的集成插件是<code>createSentryPiniaPlugin</code>，是Sentry为<code>Pinia状态管理库</code>提供的插件，用于追踪store中的异常和状态变化；它的集成方式和上面的有所差异，代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;
<span class="hljs-keyword">import</span> { createSentryPiniaPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>();
pinia.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createSentryPiniaPlugin</span>());
</code></pre>
<p>　　createSentryPiniaPlugin会将最后状态作为附件上传到报错信息中，我们可以在管理后台查看：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/781cf8f762a543598669bc94279f88e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=xw3wGVHwQFU43oJfu8afKnqKEpM%3D" alt="Pinia报错状态" loading="lazy"/></p>
<p>　　我们可以通过设置attachPiniaState为false，来关闭Pinia状态的附件上传：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">createSentryPiniaPlugin</span>({
  <span class="hljs-attr">attachPiniaState</span>: <span class="hljs-literal">false</span>,
})
</code></pre>
<p>　　最后一个集成插件是<code>captureConsoleIntegration</code>，它的作用是将控制台打印的信息全部上报给Sentry：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureConsoleIntegration</span>({
      <span class="hljs-comment">// 默认是所有日志级别</span>
      <span class="hljs-attr">levels</span>: [<span class="hljs-string">'log'</span>, <span class="hljs-string">'info'</span>, <span class="hljs-string">'warn'</span>, <span class="hljs-string">'error'</span>, <span class="hljs-string">'debug'</span>, <span class="hljs-string">'assert'</span>]
    }),
  ]
})
</code></pre>
<p>　　我们还可以通过<code>levels</code>字段设置上报的日志级别；上报后，在管理后台中我们在对应的事务中就能看到日志信息：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2b684e1184c4dadab00ab1a472fb21e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=M1HrID4fN2BlbH0wpoTzzb3X%2FuA%3D" alt="控制台信息上报" loading="lazy"/></p>
<h3 data-id="heading-4">自定义上报</h3>
<p>　　在错误追踪时，知道“哪个用户遇到了问题”往往比知道“出现了什么问题”更有价值；Sentry的<code>setUser</code>函数正是连接错误与用户的桥梁，它能将当前用户的信息关联到后续上报的错误和性能事务中。当错误发生时，你不再只是看到一个冰冷的堆栈跟踪，而是能清晰地知道：</p>
<ul>
<li>哪个用户遇到了这个错误</li>
<li>这个用户的基本属性</li>
<li>用户的使用环境信息</li>
</ul>
<p>　　而用户登录页面正是设置用户基本属性的最佳时机：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginAPI</span>(params);
  <span class="hljs-keyword">const</span> user = res.<span class="hljs-property">data</span>.<span class="hljs-property">user</span>;
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setUser</span>({
    <span class="hljs-attr">id</span>: user.<span class="hljs-property">id</span>,
    <span class="hljs-attr">email</span>: user.<span class="hljs-property">email</span>,
    <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>,
    <span class="hljs-comment">// 自定义字段</span>
    <span class="hljs-comment">// 租户id</span>
    <span class="hljs-attr">tenantId</span>: user.<span class="hljs-property">tenantId</span>,
    <span class="hljs-comment">// 国家</span>
    <span class="hljs-attr">country</span>: user.<span class="hljs-property">country</span>,
    <span class="hljs-comment">// 部门</span>
    <span class="hljs-attr">department</span>: user.<span class="hljs-property">department</span>,
    <span class="hljs-comment">// 其他字段...</span>
  });

  <span class="hljs-comment">// 可选：设置用户标签便于筛选</span>
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.tier'</span>, user.<span class="hljs-property">tier</span>);
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.plan'</span>, user.<span class="hljs-property">plan</span>);
}
</code></pre>
<p>　　在用户退出登录时，我们也需要通过setUser清理信息，否则会导致出现用户信息“张冠李戴”的情况。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setUser</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.tier'</span>, <span class="hljs-literal">null</span>);
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.plan'</span>, <span class="hljs-literal">null</span>);
}
</code></pre>
<p>　　在Sentry仪表盘，进行项目，在每个用户路由跟踪的上面，我们就能看到用户信息：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcd974842a044ae5b4aa11c905456a2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=qY9WmKEFG9jYbMxQVMBEwEHWajQ%3D" alt="绑定用户" loading="lazy"/></p>
<p>　　除此之外，Sentry还提供了丰富灵活的各种自定义上报函数，让我们不仅能够捕获错误，还能主动上报各种事件消息；其中最核心、最常用的上报函数就是<code>captureException</code>，它可以用来上报任意类型的Javascript错误：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureException</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Something went wrong!"</span>));
</code></pre>
<p>　　<code>captureMessage</code>是Sentry中用于上报自定义消息的核心函数。不同于captureException专门处理异常，captureMessage 更像是监控版的console.log，专门用于记录应用状态、用户行为、性能指标等非异常信息。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-comment">// 基本用法：上报文本消息</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'用户登录成功'</span>);
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'订单创建完成'</span>);
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'页面加载时间过长'</span>);

<span class="hljs-comment">// 带级别的消息</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'调试信息'</span>, <span class="hljs-string">'debug'</span>);     <span class="hljs-comment">// 调试级别</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'用户操作记录'</span>, <span class="hljs-string">'info'</span>);    <span class="hljs-comment">// 信息级别（默认）</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'内存使用率超过80%'</span>, <span class="hljs-string">'warning'</span>); <span class="hljs-comment">// 警告级别</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'API响应时间超过5秒'</span>, <span class="hljs-string">'error'</span>);  <span class="hljs-comment">// 错误级别</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'数据库连接失败'</span>, <span class="hljs-string">'fatal'</span>);     <span class="hljs-comment">// 致命级别</span>
</code></pre>
<h2 data-id="heading-5">sourcemap上传</h2>
<p>　　在未启用Source Map的情况下，生产环境的错误堆栈就像一团加密后的乱码，你只能看到类似a1b2c3.min.js:1:23456 这样令人困惑的定位，几乎无法追溯到引发问题的原始业务逻辑。：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c119673342a4c2a95d4c12ad83dfa5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=xJy%2FoKy%2FQQ5Ikmv4ltWoGHM8irg%3D" alt="报错信息" loading="lazy"/></p>
<p>　　而Source Map的作用，正是为这团“乱码”提供了一把精准的解码钥匙；通过正确配置并上传，错误堆栈将还原为清晰可读的源码路径，例如 src/components/Checkout.vue:42:8。此时，有意义的变量名、熟悉的函数名和完整的代码上下文都将一览无余，让定位和排查问题的过程从“大海捞针”变为“按图索骥”，效率得到质的提升。</p>
<h3 data-id="heading-6">获取三个重要参数</h3>
<p>　　在配置之前，我们需要通过管理后台获取三个重要的参数信息，首先是org-slug，表示组织名称，进入<code>设置 =&gt; 常规设置 =&gt; Organization Slug</code>就可以获取：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65a11b7d25d444b388118fab0502f1f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=6j3RwzSziqeUoBHTQhwXvDmp2RQ%3D" alt="Organization Slug" loading="lazy"/></p>
<p>　　然后是project-slug，代表是项目的名称，在Sentry中进入具体项目后，可以查看：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43819fc1ad654c1aaff9b695f5283179~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=ydltB0xFcbWO%2Fasi8vSPWcyIc60%3D" alt="Project Slug" loading="lazy"/></p>
<p>　　最后一个，也是最关键的<code>authToken</code>，代表授权令牌，进入<code>设置 =&gt; 开发设置 =&gt; Organization Tokens</code>中创建一个Token：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a70f237a04479fb3ed06a61adcdb48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=wjAw9XCDLFqVGF%2BgHf4IMZDNXVY%3D" alt="Auth Token" loading="lazy"/></p>
<p>　　我们在开发设着中会看到两种类型的Token，一种是<code>Personal Access Token</code>，另一种是<code>Organization Token</code>，它们之间主要区别如下表：</p>








































<table><thead><tr><th>特性</th><th>Personal Tokens</th><th>Organization Tokens</th></tr></thead><tbody><tr><td>归属主体</td><td>个人用户账户</td><td>组织</td></tr><tr><td>权限范围</td><td>继承用户的权限</td><td>继承组织权限</td></tr><tr><td>创建者</td><td>用户自己</td><td>组织管理员或 Owner</td></tr><tr><td>生命周期</td><td>用户离职后失效</td><td>与用户解耦，持续有效</td></tr><tr><td>使用场景</td><td>个人开发、调试</td><td>团队协作、CI/CD、自动化</td></tr><tr><td>可见性</td><td>仅创建者可见</td><td>组织管理员可见</td></tr></tbody></table>
<p>　　<strong>需要注意</strong>的是，authToken不应直接写在项目代码里，以免意外泄露。推荐的实践是配置在持续集成环境（如 Jenkins）的构建参数或保密变量中，然后在构建脚本中通过命令来调用，例如我们在Jenkins构建脚本中添加环境变量：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> VITE_SENTRY_AUTH_TOKEN=<span class="hljs-string">"【your-auth-token】"</span>
npm run build
</code></pre>
<blockquote>
<p>需要注意的是：配置Linux的环境变量，等号两边不能有空格，否则会报错。</p>
</blockquote>
<p>　　或者在构建服务器上创建<code>.env.production.local</code>的配置文件，一般git忽略<code>.env.*.local</code>的文件；这样在构建时，会自动添加到环境变量中：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env.production.local</span>
<span class="hljs-attr">VITE_SENTRY_AUTH_TOKEN</span> = sntrys_org_xxx_yyy_zzz
</code></pre>
<h3 data-id="heading-7">构建工具配置</h3>
<p>　　上面我们上传sourcemap所需要的三个参数信息都有了，下面，我们就需要在构建工具中进行配置上传；如果是webpack项目，修改配置文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> { sentryWebpackPlugin } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@sentry/webpack-plugin'</span>)

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">devtool</span>: <span class="hljs-string">"hidden-source-map"</span>,
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">sentryWebpackPlugin</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-string">'【your-url】'</span>,
      <span class="hljs-attr">org</span>: <span class="hljs-string">'【org-slug】'</span>,
      <span class="hljs-attr">project</span>: <span class="hljs-string">'【project-slug】'</span>,
      <span class="hljs-attr">authToken</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_SENTRY_AUTH_TOKEN</span>,
      <span class="hljs-attr">release</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">`【project-slug】@【version】`</span>,
      },
      <span class="hljs-attr">sourcemaps</span>: {
        <span class="hljs-attr">filesToDeleteAfterUpload</span>: [
          <span class="hljs-string">"./dist/**/*.map"</span>,
        ],
      },
    }),
  ],
}
</code></pre>
<p>　　如果是vite项目，编辑<code>vite.config.ts</code>文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { sentryVitePlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'@sentry/vite-plugin'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">sourcemap</span>: <span class="hljs-string">"hidden"</span>,
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">sentryVitePlugin</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-string">'【your-url】'</span>,
      <span class="hljs-attr">org</span>: <span class="hljs-string">'【org-slug】'</span>,
      <span class="hljs-attr">project</span>: <span class="hljs-string">'【project-slug】'</span>,
      <span class="hljs-attr">authToken</span>: <span class="hljs-variable constant_">VITE_SENTRY_AUTH_TOKEN</span> || <span class="hljs-string">''</span>,
      <span class="hljs-attr">release</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">`【project-slug】@【version】`</span>,
      },
      <span class="hljs-attr">sourcemaps</span>: {
        <span class="hljs-attr">filesToDeleteAfterUpload</span>: [
          <span class="hljs-string">'./dist/assets/*.map'</span>
        ],
      },
    }),
  ]
}
</code></pre>
<blockquote>
<p>url需要改为自己服务器的地址，如果不写默认会传到Sentry的官方服务器。</p>
</blockquote>
<p>　　这里的<code>filesToDeleteAfterUpload</code>字段，都是用来在上传成功后，删除本地的sourcemap文件，防止sourcemap文件泄漏；而<code>release</code>字段，则是用来指定上传的版本号，需要和上面Sentry.init中的release配置一致。</p>
<p>　　如果后续再次出现报错,我们可以在Sentry中很方便的定位到报错源码位置：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5355ca5ee0e42c18e91ee4336df5d93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=Lj7Vavd8zxLH1imaAFst99OcJlc%3D" alt="映射对应源码位置" loading="lazy"/></p>
<h2 data-id="heading-8">总结</h2>
<p>　　🎉 恭喜你！跟着本文指南走完，相信你已经成功为你的前端项目请来了一位 “7 * 24小时不眨眼的全能哨兵” ——Sentry！整个部署过程从Sentry私有化服务搭建开始，我们通过Docker Compose在独立服务器上建立了专属监控中心，确保数据安全可控。这就像是给项目配备了一个24小时不眨眼的数字哨兵。</p>
<p>　　在项目集成环节，我们从基础SDK配置入手，逐步实现了错误捕获、用户追踪、性能监控等核心功能。特别针对Vue生态，我们配置了路由追踪、Pinia状态监控、组件生命周期追踪等针对性方案，让监控覆盖到应用的每个角落。</p>
<p>　　关键技术配置方面，我们重点解决了生产环境调试的两大难题：一是通过Source Map自动上传机制，将压缩代码的报错信息还原为可读的源码位置；二是通过智能采样策略，在监控精度与系统开销之间找到最佳平衡点。</p>
<p>　　最终，我们构建了一个从前端异常发生到开发团队响应的完整闭环。现在当线上问题出现时，不再需要依赖用户模糊的描述，而是可以直接查看错误详情、用户操作回放、性能数据等多维度信息，大大缩短了问题排查时间。从此，线上bug不再是“薛定谔的猫”，让每个线上问题都无处遁形，显著提升了应用的稳定性和可维护性。</p>
<p>如果觉得写得还不错，请关注我的<a href="//juejin.im/user/580038cebf22ec0064bd0b2d" target="_blank" title="//juejin.im/user/580038cebf22ec0064bd0b2d">掘金主页</a>。更多文章请访问<a href="https://link.juejin.cn?target=http%3A%2F%2Fxieyufei.com" target="_blank" title="http://xieyufei.com" ref="nofollow noopener noreferrer">谢小飞的博客</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[同事问我 MySQL 用啥排序规则，我差点答不上来]]></title>    <link>https://juejin.cn/post/7591350620189196294</link>    <guid>https://juejin.cn/post/7591350620189196294</guid>    <pubDate>2026-01-05T00:46:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189196294" data-draft-id="7581678301216473088" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="同事问我 MySQL 用啥排序规则，我差点答不上来"/> <meta itemprop="keywords" content="后端,MySQL"/> <meta itemprop="datePublished" content="2026-01-05T00:46:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            同事问我 MySQL 用啥排序规则，我差点答不上来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:46:14.000Z" title="Mon Jan 05 2026 00:46:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前几天，我在建数据库的时候，同事刚好在我旁边，他问我：“你建库一般用什么排序规则，怎么感觉都一样啊！”。</p>
<p>本来我还想装一下的，可发现我越讲越不对，赶紧去搜了一下相关知识，这可终于整明白了。</p>
<p>下面给大家分享一下。</p>
<h2 data-id="heading-0">什么是排序规则（Collation）？</h2>
<p>简单说：<strong>排序规则决定了 MySQL 怎么“看”字符串。</strong></p>
<p>比如：</p>
<ul>
<li>它认为 <code>'A'</code> 和 <code>'a'</code> 是一样的吗？</li>
<li>它觉得 <code>'é'</code> 和 <code>'e'</code> 要不要区分？</li>
<li>中文字符按什么顺序排？</li>
</ul>
<p><strong>Collation（排序规则）</strong> 就是解决这些问题的。</p>
<h2 data-id="heading-1">排序规则长什么样？</h2>
<p>MySQL 的排序规则名字通常像这样：</p>
<pre><code class="hljs">utf8mb4_0900_ai_ci
utf8mb4_general_ci
utf8mb4_bin
</code></pre>
<p>如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83e44148eae64b7e8c59099fb5b942ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178773&amp;x-signature=%2FKHzaSGW0fFcRp07v4Az%2FRmQgM8%3D" alt="" loading="lazy"/></p>
<p>我们拆开来看：</p>





























<table><thead><tr><th>部分</th><th>含义</th></tr></thead><tbody><tr><td><code>utf8mb4</code></td><td>字符集（支持 emoji、中文、英文等所有 Unicode 字符）</td></tr><tr><td><code>0900</code></td><td>基于 Unicode 9.0.0 标准（MySQL 8.0+ 新特性）</td></tr><tr><td><code>ai</code> / <code>as</code></td><td>Accent Insensitive（不区分重音） / Accent Sensitive（区分重音）</td></tr><tr><td><code>ci</code> / <code>cs</code></td><td>Case Insensitive（不区分大小写） / Case Sensitive（区分大小写）</td></tr><tr><td><code>bin</code></td><td>Binary（二进制比较，最严格）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">举个栗子：不同排序规则的区别</h2>
<p>我们创建三个表，分别用不同的排序规则，看看效果：</p>
<h3 data-id="heading-3">场景1：大小写敏感吗？</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 表1：使用 utf8mb4_0900_ai_ci（默认，不区分大小写）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users_ci (
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)
) <span class="hljs-keyword">COLLATE</span> utf8mb4_0900_ai_ci;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users_ci <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Alice'</span>), (<span class="hljs-string">'alice'</span>);

<span class="hljs-comment">-- 查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users_ci <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'ALICE'</span>;
<span class="hljs-comment">-- 结果：返回 Alice 和 alice（因为不区分大小写）</span>
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 表2：使用 utf8mb4_bin（区分大小写）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users_bin (
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)
) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users_bin <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Alice'</span>), (<span class="hljs-string">'alice'</span>);

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users_bin <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'ALICE'</span>;
<span class="hljs-comment">-- 结果：空！因为 'ALICE' ≠ 'Alice' ≠ 'alice'</span>
</code></pre>
<p><strong>结论</strong>：<code>_ci</code> 不区分大小写，<code>_bin</code> 区分。</p>
<hr/>
<h3 data-id="heading-4">场景2：重音符号要不要管？</h3>
<p>比如法语中的 <code>café</code> 和 <code>cafe</code>。</p>
<ul>
<li>在 <code>_ai</code>（Accent Insensitive）规则下：<code>café = cafe</code></li>
<li>在 <code>_as</code> 或 <code>_bin</code> 规则下：<code>café ≠ cafe</code></li>
</ul>
<p>MySQL 8.0+ 支持更精细的控制，比如：</p>
<pre><code class="hljs language-sql" lang="sql">utf8mb4_0900_as_cs  <span class="hljs-comment">-- 区分大小写 + 区分重音</span>
utf8mb4_0900_ai_ci  <span class="hljs-comment">-- 不区分大小写 + 不区分重音（默认）</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">场景3：中文排序乱序？</h3>
<p>如果你用 <code>utf8mb4_general_ci</code> 排中文，可能会发现：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name;
<span class="hljs-comment">-- 结果：张三、李四、王五……顺序看起来“不对”</span>
</code></pre>
<p>这是因为 <code>general_ci</code> 是一种<strong>简化的排序算法</strong>，它为了速度牺牲了准确性。</p>
<p><strong>正确做法</strong>：用 <code>utf8mb4_unicode_ci</code> 或更好的 <code>utf8mb4_0900_ai_ci</code>（MySQL 8.0 默认），它们基于 Unicode 标准，对中文、日文、韩文等支持更好。</p>
<hr/>
<h2 data-id="heading-6">主要区别维度</h2>
<hr/>
<h3 data-id="heading-7">1. <strong>大小写敏感性（Case Sensitivity）</strong></h3>
<ul>
<li><strong>_ci</strong>：Case Insensitive（不区分大小写）
<ul>
<li>例如：<code>utf8_general_ci</code> 中 <code>'A' = 'a'</code></li>
</ul>
</li>
<li><strong>_cs</strong> 或 <strong>_bin</strong>：Case Sensitive（区分大小写）
<ul>
<li><code>utf8_bin</code> 或 <code>utf8mb4_0900_cs</code> 中 <code>'A' ≠ 'a'</code></li>
</ul>
</li>
</ul>
<p>注意：<code>_cs</code>（Case Sensitive）在旧版本中较少见，MySQL 8.0 引入了更标准的命名如 <code>utf8mb4_0900_cs</code>。</p>
<hr/>
<h3 data-id="heading-8">2. <strong>重音符号敏感性（Accent Sensitivity）</strong></h3>
<ul>
<li><strong>_ai</strong>：Accent Insensitive（不区分重音）</li>
<li><strong>_as</strong>：Accent Sensitive（区分重音）</li>
</ul>
<p>在 MySQL 8.0+ 中，部分排序规则支持 <code>_as</code>/<code>_ai</code>，例如 <code>utf8mb4_0900_as_cs</code> 表示既区分大小写又区分重音。</p>
<hr/>
<h3 data-id="heading-9">3. <strong>二进制排序（Binary Collation）</strong></h3>
<ul>
<li>以 <code>_bin</code> 结尾（如 <code>utf8mb4_bin</code>）</li>
<li>按照字符的二进制值（字节值）进行比较，<strong>严格区分大小写、重音、编码顺序</strong></li>
<li>不使用语言规则，速度较快但不符合人类语言习惯</li>
</ul>
<hr/>
<h3 data-id="heading-10">4. <strong>语言/区域特定排序</strong></h3>
<p>某些排序规则针对特定语言优化：</p>
<ul>
<li><code>utf8mb4_spanish_ci</code>：西班牙语排序（如 ñ 排在 n 之后）</li>
<li><code>utf8mb4_german2_ci</code>：德语电话簿排序规则</li>
<li><code>utf8mb4_ja_0900_as_cs</code>：日语排序（需 MySQL 8.0+）</li>
</ul>
<hr/>
<h3 data-id="heading-11">5. <strong>Unicode 版本差异（MySQL 8.0+）</strong></h3>
<p>MySQL 8.0 默认使用基于 <strong>Unicode 9.0</strong> 的排序规则（如 <code>utf8mb4_0900_ai_ci</code>）：</p>
<ul>
<li>更准确的多语言支持</li>
<li>更好的性能（相比旧的 <code>utf8mb4_general_ci</code>）</li>
<li><code>0900</code> 表示基于 Unicode 9.0.0</li>
</ul>
<p>对比：</p>
<ul>
<li><code>utf8mb4_general_ci</code>：旧版，速度快但排序不准确（如认为 <code>'ö' = 'o'</code>）</li>
<li><code>utf8mb4_unicode_ci</code>：基于 Unicode 4.0，较准确</li>
<li><code>utf8mb4_0900_ai_ci</code>：MySQL 8.0 默认，基于 Unicode 9.0，更准确高效</li>
</ul>
<hr/>
<h3 data-id="heading-12">常见排序规则对比示例</h3>









































<table><thead><tr><th>排序规则</th><th>大小写敏感</th><th>重音敏感</th><th>说明</th></tr></thead><tbody><tr><td><code>utf8mb4_general_ci</code></td><td>否</td><td>否</td><td>旧版通用，速度快但不准</td></tr><tr><td><code>utf8mb4_unicode_ci</code></td><td>否</td><td>否</td><td>基于 Unicode 4.0，较准确</td></tr><tr><td><code>utf8mb4_0900_ai_ci</code></td><td>否</td><td>否</td><td>MySQL 8.0 默认，基于 Unicode 9.0</td></tr><tr><td><code>utf8mb4_0900_as_cs</code></td><td>是</td><td>是</td><td>区分大小写和重音</td></tr><tr><td><code>utf8mb4_bin</code></td><td>是</td><td>是</td><td>二进制比较，最快但最“机械”</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">如何查看可用排序规则？</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">COLLATION</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'utf8mb4%'</span>;
</code></pre>
<h3 data-id="heading-14">如何设置排序规则？</h3>
<p>数据库级：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> DATABASE db_name <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_0900_ai_ci;
</code></pre>
<p>表级：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t (name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin;
</code></pre>
<p>列级：</p>
<pre><code class="hljs language-sql" lang="sql">name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_0900_as_cs
</code></pre>
<p>查询时临时指定：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name <span class="hljs-keyword">COLLATE</span> utf8mb4_bin;
</code></pre>
<hr/>
<h2 data-id="heading-15">实际建议</h2>
<ul>
<li><strong>一般应用</strong>：使用 <code>utf8mb4_0900_ai_ci</code>（MySQL 8.0+）或 <code>utf8mb4_unicode_ci</code>（旧版本）</li>
<li><strong>需要区分大小写</strong>：用 <code>utf8mb4_0900_as_cs</code> 或 <code>utf8mb4_bin</code></li>
<li><strong>性能敏感且无需语言规则</strong>：用 <code>_bin</code></li>
<li><strong>避免使用 <code>utf8mb4_general_ci</code></strong>（除非兼容旧系统），因其排序逻辑不准确</li>
</ul>
<h2 data-id="heading-16">总结</h2>
<ul>
<li><strong>排序规则 = 字符串的“比较规则”</strong></li>
<li><code>_ci</code> = 不区分大小写，<code>_cs</code>/<code>_bin</code> = 区分</li>
<li>MySQL 8.0 默认的 <code>utf8mb4_0900_ai_ci</code> 是目前<strong>最推荐</strong>的选择</li>
<li>中文、多语言项目<strong>不要用 <code>general_ci</code></strong>，它已经过时了</li>
<li>用户名、密码等关键字段，建议用区分大小写的规则</li>
</ul>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-17">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FU3HhCz5WiAMNM7foxuTa0w" target="_blank" title="https://mp.weixin.qq.com/s/U3HhCz5WiAMNM7foxuTa0w" ref="nofollow noopener noreferrer">《前端高手才知道的秘密：Blob 居然这么强大》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX-MSa0CHwVW_qgPezbpMUA" target="_blank" title="https://mp.weixin.qq.com/s/X-MSa0CHwVW_qgPezbpMUA" ref="nofollow noopener noreferrer">《这 5 个冷门 HTML 标签，让我直接删了100 行 JS 代码》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">《重构了20个SpringBoot项目后，总结出这套稳定高效的架构设计》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F184BGM_pdMFLc0ASrferwQ" target="_blank" title="https://mp.weixin.qq.com/s/184BGM_pdMFLc0ASrferwQ" ref="nofollow noopener noreferrer">《代码里全是 new 对象，真的很 Low 吗？我认真想了一晚》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别 Kotlin 中臃肿的 when 表达式]]></title>    <link>https://juejin.cn/post/7591330139083735055</link>    <guid>https://juejin.cn/post/7591330139083735055</guid>    <pubDate>2026-01-05T00:46:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591330139083735055" data-draft-id="7587253759092654116" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 Kotlin 中臃肿的 when 表达式"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-01-05T00:46:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 Kotlin 中臃肿的 when 表达式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:46:53.000Z" title="Mon Jan 05 2026 00:46:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed296ecb41543039d5405088a4b8c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178812&amp;x-signature=fhy2b8bYrAbNNRJ2nFf2XtIJbP8%3D" alt="1.png" loading="lazy"/></p>
<p>你是否管理过那些根据内部状态发生剧烈行为变化的复杂对象？</p>
<p>如果是，那你很可能已经和一个常见敌人斗争过——遍布你类中每个方法的、冗长的 <code>when</code> 语句。</p>
<p>它看起来大概是这样的：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleAction</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">when</span> (state) {
        State.A -&gt; { <span class="hljs-comment">/* A 的逻辑 */</span> }
        State.B -&gt; { <span class="hljs-comment">/* B 的逻辑 */</span> }
        State.C -&gt; { <span class="hljs-comment">/* C 的逻辑 */</span> }
        <span class="hljs-comment">// ... 还在不断增长！</span>
    }
}
</code></pre>
<p>每次你添加一个新状态（比如 <code>State.D</code>），你就得逐个追踪并更新每一个函数，加入新的分支。</p>
<p>这是个维护噩梦，直接违反了开闭原则（<strong>OCP</strong>），也是一种严重的代码异味。你的逻辑本该按状态分组，却因为动作而被散乱地分布在各处。</p>
<p>那么，解决方案是什么呢？</p>
<p>状态模式。而且借助现代 Kotlin，我们可以用最少的样板代码，实现最优雅的状态模式。</p>
<h2 data-id="heading-0">一个简单的自动售货机</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ff32e73dc554e92bcbb7bbc60d105e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178812&amp;x-signature=Lj6Kgj5yM%2BLbhf8%2BWJDlzh3LWCo%3D" alt="0.png" loading="lazy"/></p>
<p>让我们想象一下，我们正在构建一个简单的 <code>VendingMachine</code>。它有几个关键的状态和动作：</p>
<ul>
<li><strong>状态</strong>：<code>IDLE</code>（空闲）、<code>HAS_MONEY</code>（已投币）、<code>OUT_OF_STOCK</code>（缺货）</li>
<li><strong>动作</strong>：<code>insertMoney</code>（投币）、<code>selectProduct</code>（选择商品）、<code>requestRefund</code>（请求退款）</li>
</ul>
<p>下面是那种存在问题的、基于状态的检查代码：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachine</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> state: State = State.IDLE
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                balance += amount
                state = State.HAS_MONEY
                println(<span class="hljs-string">"已投币。余额：<span class="hljs-variable">$balance</span>"</span>)
            }
            State.HAS_MONEY -&gt; {
                println(<span class="hljs-string">"已投币，无需重复投币。余额：<span class="hljs-variable">$balance</span>"</span>)
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                println(<span class="hljs-string">"请先投币。"</span>)
            }
            State.HAS_MONEY -&gt; {
                <span class="hljs-keyword">if</span> (<span class="hljs-comment">/* 商品可用 */</span>) {
                    println(<span class="hljs-string">"商品已售出。"</span>)
                    state = State.IDLE
                } <span class="hljs-keyword">else</span> {
                    println(<span class="hljs-string">"商品不可用。"</span>)
                }
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
            State.HAS_MONEY -&gt; {
                println(<span class="hljs-string">"已退款：<span class="hljs-variable">$balance</span>"</span>)
                balance = <span class="hljs-number">0</span>
                state = State.IDLE
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
        }
    }
}
</code></pre>
<p>如果我们新增一个 <code>MAINTENANCE</code>（维护）状态，就会破坏开闭原则，因为我们必须修改 <code>insertMoney</code>、<code>selectProduct</code> 以及所有其他动作方法。</p>
<h2 data-id="heading-1">经典的状态模式</h2>
<p>状态模式通过将“状态”本身变成一个持有行为的对象来解决这个问题。我们希望按状态来组织行为，而不是按动作。</p>
<h3 data-id="heading-2">1. 定义接口</h3>
<p>我们定义一个通用的接口（<code>MachineState</code>），所有状态对象都必须实现它。这个接口包含了上下文（<code>VendingMachineContext</code>）可以执行的所有可能动作。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MachineState</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
}
</code></pre>
<h3 data-id="heading-3">2. 具体实现</h3>
<p>我们为每个状态实现其行为。关键点在于：单个状态的所有逻辑现在都集中在一个类/对象中。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> IdleState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        context.balance += amount
        context.state = HasMoneyState
        println(<span class="hljs-string">"已投币。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"请先投币。"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"没有可退的款项。"</span>)
    }
}

<span class="hljs-keyword">object</span> HasMoneyState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        context.balance += amount
        println(<span class="hljs-string">"已添加金额。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">if</span> (context.balance &gt;= <span class="hljs-number">2</span>) {
            context.balance -= <span class="hljs-number">2</span>
            println(<span class="hljs-string">"商品已售出。"</span>)
            context.state = IdleState
        } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"商品不可用。"</span>)
        }
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"已退款：<span class="hljs-subst">${context.balance}</span>"</span>)
        context.balance = <span class="hljs-number">0</span>
        context.state = IdleState
    }
}

<span class="hljs-keyword">object</span> OutOfStockState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"机器缺货。"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"机器缺货。"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"没有可退的款项。"</span>)
    }
}
</code></pre>
<h3 data-id="heading-4">3. 上下文</h3>
<p><code>VendingMachineContext</code>（即上下文）现在变得简洁，只需将动作委托给其当前的状态对象即可。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachineContext</span>(<span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> state: MachineState = IdleState
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>)</span></span> {
        state.insertMoney(amount, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>)</span></span> {
        state.selectProduct(code, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">()</span></span> {
        state.requestRefund(<span class="hljs-keyword">this</span>)
    }
    <span class="hljs-comment">// 辅助函数，供状态对象切换机器状态</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transitionTo</span><span class="hljs-params">(newState: <span class="hljs-type">MachineState</span>)</span></span> {
        <span class="hljs-keyword">this</span>.state = newState
    }
}
</code></pre>
<p>如果你新增一个状态，只需创建一个新的类。你无需修改 <code>VendingMachineContext</code> 或其他任何状态类。开闭原则得到了恢复！</p>
<h2 data-id="heading-5">增强的 Kotlin 风格状态模式</h2>
<p>经典模式很可靠，但 Kotlin 为我们提供了更强大、更优雅的方式来构建它：使用
<strong>密封接口</strong>
来强制实现类型安全的命令。</p>
<h3 data-id="heading-6">1. 定义所有输入</h3>
<p>我们使用密封接口来建模机器可以接收的所有可能输入：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingInput</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertMoney</span>(<span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Int</span>) : VendingInput
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectProduct</span>(<span class="hljs-keyword">val</span> code: String) : VendingInput
    <span class="hljs-keyword">object</span> RequestRefund : VendingInput
}
</code></pre>
<h3 data-id="heading-7">2. 定义状态和上下文</h3>
<p>状态接口现在接受一个单一的 <code>VendingInput</code>。上下文拥有一个公开的 <code>process</code> 方法。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingState</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachineContext</span>(<span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> state: VendingState = IdleState
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> {
        state.handle(input, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transitionTo</span><span class="hljs-params">(newState: <span class="hljs-type">VendingState</span>)</span></span> {
        <span class="hljs-keyword">this</span>.state = newState
    }
}
</code></pre>
<h3 data-id="heading-8">3. 行为</h3>
<p>状态对象使用一个对 <code>input</code> 类型的单一 <code>when</code> 语句。因为 <code>VendingInput</code> 是密封的，Kotlin 会强制我们处理所有可能的输入——这使得我们的代码变得穷举且安全！</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">object</span> IdleState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                context.balance += input.amount
                context.transitionTo(HasMoneyState)
                println(<span class="hljs-string">"已投币。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                println(<span class="hljs-string">"请先投币。"</span>)
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
        }
    }
}

<span class="hljs-keyword">object</span> HasMoneyState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                context.balance += input.amount
                println(<span class="hljs-string">"已添加金额。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                <span class="hljs-keyword">if</span> (context.balance &gt;= <span class="hljs-number">2</span>) {
                    context.balance -= <span class="hljs-number">2</span>
                    println(<span class="hljs-string">"商品已售出。"</span>)
                    context.transitionTo(IdleState)
                } <span class="hljs-keyword">else</span> {
                    println(<span class="hljs-string">"商品不可用。"</span>)
                }
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"已退款：<span class="hljs-subst">${context.balance}</span>"</span>)
                context.balance = <span class="hljs-number">0</span>
                context.transitionTo(IdleState)
            }
        }
    }
}

<span class="hljs-keyword">object</span> OutOfStockState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-9">纯函数式状态转换</h2>
<p>对于真正健壮的系统（如 <strong>MVI</strong>），你可能希望避免可变性。你可以通过让状态函数返回下一个状态来实现这一点，从而使系统具有高度确定性：</p>
<h3 data-id="heading-10">1. 定义转换</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 定义所有输入（保持不变，密封接口非常适合函数式）</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingInput</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertMoney</span>(<span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Int</span>) : VendingInput
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectProduct</span>(<span class="hljs-keyword">val</span> code: String) : VendingInput
    <span class="hljs-keyword">object</span> RequestRefund : VendingInput
}

<span class="hljs-comment">// 2. 定义状态：将数据（balance）与状态逻辑结合</span>
<span class="hljs-comment">// 使用不可变属性 (val)，确保状态一旦创建不可修改</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingState</span>(<span class="hljs-keyword">val</span> balance: <span class="hljs-built_in">Int</span>) {
    
    <span class="hljs-comment">// 核心转变：函数签名返回 (新状态, 产生的结果文本)</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span>: Pair&lt;VendingState, String&gt;

    <span class="hljs-comment">// --- 各个状态的具体实现 ---</span>

    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Idle</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> b: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) : VendingState(b) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; 
                HasMoney(balance + input.amount) to <span class="hljs-string">"已投币。余额：<span class="hljs-subst">${balance + input.amount}</span>"</span>
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; 
                <span class="hljs-keyword">this</span> to <span class="hljs-string">"请先投币。"</span>
            VendingInput.RequestRefund -&gt; 
                <span class="hljs-keyword">this</span> to <span class="hljs-string">"没有可退的款项。"</span>
        }
    }

    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HasMoney</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> b: <span class="hljs-built_in">Int</span>) : VendingState(b) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; 
                copy(b = balance + input.amount) to <span class="hljs-string">"已添加金额。余额：<span class="hljs-subst">${balance + input.amount}</span>"</span>
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; 
                <span class="hljs-keyword">if</span> (balance &gt;= <span class="hljs-number">2</span>) Idle(balance - <span class="hljs-number">2</span>) to <span class="hljs-string">"商品已售出：<span class="hljs-subst">${input.code}</span>。"</span>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span> to <span class="hljs-string">"余额不足。"</span>
            VendingInput.RequestRefund -&gt; 
                Idle(<span class="hljs-number">0</span>) to <span class="hljs-string">"已退款：<span class="hljs-variable">$balance</span>"</span>
        }
    }

    <span class="hljs-keyword">object</span> OutOfStock : VendingState(<span class="hljs-number">0</span>) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">this</span> to <span class="hljs-string">"机器缺货。"</span>
    }
}
</code></pre>
<h3 data-id="heading-11">2. 使用举例</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> s0 = VendingState.Idle()

    <span class="hljs-comment">// 所有的处理结果都作为新值返回，原始 s0 保持不变</span>
    <span class="hljs-keyword">val</span> (s1, msg1) = s0.handle(VendingInput.InsertMoney(<span class="hljs-number">5</span>))
    println(msg1) <span class="hljs-comment">// 已投币。余额：5</span>

    <span class="hljs-keyword">val</span> (s2, msg2) = s1.handle(VendingInput.SelectProduct(<span class="hljs-string">"可乐"</span>))
    println(msg2) <span class="hljs-comment">// 商品已售出：可乐。</span>

    <span class="hljs-comment">// s2 现在是 Idle 状态，余额已扣除</span>
    println(<span class="hljs-string">"最终状态: <span class="hljs-subst">${s2::class.simpleName}</span>, 余额: <span class="hljs-subst">${s2.balance}</span>"</span>)
}

</code></pre>
<p>虽然更复杂，但这种方法在响应式架构中很常见，因为状态变化是必须被精确跟踪的事件。</p>
<p>它的核心实际上就是函数有状态的返回，而状态本身是不可变的，如果同一个状态的数据发生变化，会生成一个新的状态。</p>
<h2 data-id="heading-12">总结</h2>
<p>通过应用状态模式，我们成功地将分散、脆弱的条件逻辑替换为干净、内聚的状态对象。这使得我们的代码更易于维护、测试和扩展。</p>
<p>如果你的 Kotlin 代码库正遭受“臃肿的 <code>when</code> 语句”之苦，不妨试试状态模式。团队中的小伙伴一定会感谢你的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 深入剖析Android内存泄漏：ViewPager2与Fragment的生命周期陷阱]]></title>    <link>https://juejin.cn/post/7591413678982905902</link>    <guid>https://juejin.cn/post/7591413678982905902</guid>    <pubDate>2026-01-05T00:48:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591413678982905902" data-draft-id="7582136489770385418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 深入剖析Android内存泄漏：ViewPager2与Fragment的生命周期陷阱"/> <meta itemprop="keywords" content="Android,前端,APP"/> <meta itemprop="datePublished" content="2026-01-05T00:48:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏程十八少"/> <meta itemprop="url" content="https://juejin.cn/user/184373685534077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 深入剖析Android内存泄漏：ViewPager2与Fragment的生命周期陷阱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685534077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏程十八少
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:48:42.000Z" title="Mon Jan 05 2026 00:48:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>场景： 在新能源车机系统有一套UI页面，手机有竖屏页面，手机又横屏页面，3种情况相互切换，频繁的切换，手机的竖屏页面有3个tab和3个对应fragment，一个外层Fragment包含3个fragment, 不停的切换导致的！</p>
</blockquote>
<h2 data-id="heading-0">1.内存泄漏信息</h2>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span> <span class="hljs-attr">GC Root:</span> <span class="hljs-string">Global</span> <span class="hljs-string">variable</span> <span class="hljs-string">in</span> <span class="hljs-string">native</span> <span class="hljs-string">code</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-attr">Leaking:</span> <span class="hljs-literal">NO</span> <span class="hljs-string">(MainActivity↓</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">leaking)</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">↓</span> <span class="hljs-string">-$$Lambda$ViewRootImpl$zmAX2p20-kqxknxcUyGhSNjsJvM.f$0</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-attr">Leaking:</span> <span class="hljs-literal">NO</span> <span class="hljs-string">(MainActivity↓</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">leaking)</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">mContext</span> <span class="hljs-string">instance</span> <span class="hljs-string">of</span> <span class="hljs-string">com.tencent.settings.MainActivity</span> <span class="hljs-string">with</span> <span class="hljs-string">mDestroyed</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">ViewRootImpl#mView</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-literal">null</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">↓</span> <span class="hljs-string">ViewRootImpl.mContext</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">├─</span> <span class="hljs-string">com.tencent.settings.MainActivity</span> <span class="hljs-string">instance</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">↓</span> <span class="hljs-string">ComponentActivity.mLifecycleRegistry</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>                        <span class="hljs-string">~~~~~~~~~~~~</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">Retaining</span> <span class="hljs-number">52</span> <span class="hljs-string">B</span> <span class="hljs-string">in</span> <span class="hljs-number">2</span> <span class="hljs-string">objects</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">Anonymous</span> <span class="hljs-string">class</span> <span class="hljs-string">implementing</span> <span class="hljs-string">androidx.lifecycle.LifecycleEventObserver</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">├─</span> <span class="hljs-string">androidx.viewpager2.adapter.FragmentStateAdapter$FragmentMaxLifecycleEnforcer</span> <span class="hljs-string">instance</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">↓</span> <span class="hljs-string">FragmentStateAdapter$FragmentMaxLifecycleEnforcer.mViewPager</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>                                                        <span class="hljs-string">~~~~~~~~~~</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">├─</span> <span class="hljs-string">androidx.viewpager2.widget.ViewPager2</span> <span class="hljs-string">instance</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-attr">Leaking:</span> <span class="hljs-string">UNKNOWN</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">Retaining</span> <span class="hljs-number">85.1</span> <span class="hljs-string">kB</span> <span class="hljs-string">in</span> <span class="hljs-number">1109 </span><span class="hljs-string">objects</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">View</span> <span class="hljs-string">not</span> <span class="hljs-string">part</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">window</span> <span class="hljs-string">view</span> <span class="hljs-string">hierarchy</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">View.mAttachInfo</span> <span class="hljs-string">is</span> <span class="hljs-literal">null</span> <span class="hljs-string">(view</span> <span class="hljs-string">detached)</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">View.mWindowAttachCount</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">mContext</span> <span class="hljs-string">instance</span> <span class="hljs-string">of</span> <span class="hljs-string">com.tencent.settings.MainActivity</span> <span class="hljs-string">with</span> <span class="hljs-string">mDestroyed</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>    <span class="hljs-string">↓</span> <span class="hljs-string">View.mParent</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">│</span>           <span class="hljs-string">~~~~~~~</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">​</span>     <span class="hljs-attr">Leaking:</span> <span class="hljs-literal">YES</span> <span class="hljs-string">(ObjectWatcher</span> <span class="hljs-string">was</span> <span class="hljs-string">watching</span> <span class="hljs-string">this</span> <span class="hljs-string">because</span> <span class="hljs-string">com.tencent.settings.PhoneAndroidFragment</span> <span class="hljs-string">received</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">​</span>     <span class="hljs-string">Fragment#onDestroyView()</span> <span class="hljs-string">callback</span> <span class="hljs-string">(references</span> <span class="hljs-string">to</span> <span class="hljs-string">its</span> <span class="hljs-string">views</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">cleared</span> <span class="hljs-string">to</span> <span class="hljs-string">prevent</span> <span class="hljs-string">leaks))</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">​</span>     <span class="hljs-string">key</span> <span class="hljs-string">=</span> <span class="hljs-string">4e6eb9f9-742a-42b5-a71d-42543f7f1407</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">​</span>     <span class="hljs-string">watchDurationMillis</span> <span class="hljs-string">=</span> <span class="hljs-number">22525</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">​</span>     <span class="hljs-string">View</span> <span class="hljs-string">not</span> <span class="hljs-string">part</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">window</span> <span class="hljs-string">view</span> <span class="hljs-string">hierarchy</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">​</span>     <span class="hljs-string">View.mWindowAttachCount</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span>
</code></pre>
<h3 data-id="heading-1">泄漏现象</h3>
<p>LeakCanary的日志显示了这样一个泄漏链：</p>
<pre><code class="hljs language-ini" lang="ini">GC Root: Global variable in native code
↓
ViewRootImpl的Lambda表达式
↓
MainActivity (<span class="hljs-attr">mDestroyed</span> = <span class="hljs-literal">false</span>)
↓
ComponentActivity.mLifecycleRegistry
↓
FragmentStateAdapter$FragmentMaxLifecycleEnforcer
↓
ViewPager2实例 (已从窗口分离)
↓
Fragment已销毁的视图 (应被回收但未被回收)
</code></pre>
<h3 data-id="heading-2">2. 主要泄漏点</h3>
<p>PhoneAndroidFragment 已经收到了 onDestroyView() 回调</p>
<p>但其视图仍然被 ViewPager2 持有</p>
<p>ViewPager2 本身又被 FragmentMaxLifecycleEnforcer 持有</p>
<h5 data-id="heading-3">2.2 核心原因</h5>
<p>FragmentStateAdapter$FragmentMaxLifecycleEnforcer 是一个生命周期观察者，它：</p>
<p>通过 MainActivity 的 mLifecycleRegistry 注册</p>
<p>持有 ViewPager2 的引用</p>
<p>导致 ViewPager2 及其子视图无法被释放</p>
<p>问题：谁持有 ViewPager2， 为什么PhoneAndroidFragment 不能被回收</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> GC Root (Native全局变量)
   ↓
<span class="hljs-bullet">2.</span> ViewRootImpl的Lambda函数
   ↓
<span class="hljs-bullet">3.</span> MainActivity (Activity本身未销毁)
   ↓
<span class="hljs-bullet">4.</span> ComponentActivity.mLifecycleRegistry (生命周期注册表)
   ↓
<span class="hljs-bullet">5.</span> FragmentStateAdapter$FragmentMaxLifecycleEnforcer (生命周期观察者)
   ↓
<span class="hljs-bullet">6.</span> ViewPager2 实例 (关键持有者)
   ↓
<span class="hljs-bullet">7.</span> ViewPager2 的内部状态 (RecyclerView、适配器等)
   ↓
<span class="hljs-bullet">8.</span> PhoneAndroidFragment 的视图 (Fragment的View层次结构)
</code></pre>
<h3 data-id="heading-4">3.源码详细分析各环节：</h3>
<h5 data-id="heading-5"><strong>3.1. FragmentMaxLifecycleEnforcer 是谁？</strong></h5>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 这是ViewPager2的内部类，负责管理Fragment的生命周期</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FragmentStateAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter&lt;</span>...<span class="hljs-title">&gt;</span> </span>{
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FragmentMaxLifecycleEnforcer</span> </span>{
        <span class="hljs-comment">// 关键字段</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">ViewPager2</span> mViewPager;  <span class="hljs-comment">// 持有ViewPager2的强引用</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">LifecycleEventObserver</span> mLifecycleObserver;  <span class="hljs-comment">// 生命周期观察者</span>
    }
}
</code></pre>
<h5 data-id="heading-6"><strong>3.2. 为什么它持有ViewPager2？</strong></h5>
<p>当ViewPager2使用<code>FragmentStateAdapter</code>时，会自动创建一个<code>FragmentMaxLifecycleEnforcer</code>实例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 在FragmentStateAdapter构造函数中</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">FragmentStateAdapter</span>(<span class="hljs-variable">@NonNull</span> FragmentManager fragmentManager, 
                           <span class="hljs-variable">@NonNull</span> Lifecycle lifecycle) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-selector-tag">mFragmentMaxLifecycleEnforcer</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">FragmentMaxLifecycleEnforcer</span>();
    <span class="hljs-selector-tag">lifecycle</span><span class="hljs-selector-class">.addObserver</span>(mFragmentMaxLifecycleEnforcer);  <span class="hljs-comment">// 注册到Activity生命周期</span>
}
</code></pre>
<h5 data-id="heading-7"><strong>3.3. PhoneAndroidFragment为什么不能被回收？</strong></h5>
<p><strong>根本原因：ViewPager2仍然持有Fragment的视图引用</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ViewPager2内部是通过RecyclerView实现的</span>
<span class="hljs-comment">// 当Fragment被销毁时，如果ViewPager2没有正确清理，就会：</span>
<span class="hljs-number">1</span>. ViewPager2的RecyclerView仍然缓存着Fragment的ViewHolder
<span class="hljs-number">2</span>. Fragment的View仍然在ViewPager2的子View列表中
<span class="hljs-number">3</span>. Fragment的<span class="hljs-built_in">onDestroyView</span>()被调用，但View对象没有被GC回收
</code></pre>
<h3 data-id="heading-8">3.4 RecyclerView缓存问题</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ViewPager2内部使用RecyclerView，有以下缓存：</span>
<span class="hljs-number">1.</span> mAttachedScrap - 已附加的废弃视图
<span class="hljs-number">2.</span> mCachedViews - 缓存视图（默认大小<span class="hljs-number">2</span>）
<span class="hljs-number">3.</span> mRecyclerPool - 回收池

<span class="hljs-comment">// 当Fragment销毁时，如果View还在这些缓存中：</span>
<span class="hljs-comment">// 1. View不会被释放</span>
<span class="hljs-comment">// 2. Fragment的视图引用被保留</span>
<span class="hljs-comment">// 3. 导致内存泄漏</span>
</code></pre>
<h3 data-id="heading-9">3.5. 屏幕切换影响</h3>
<pre><code class="hljs language-markdown" lang="markdown">车机系统 ↔ 手机竖屏 ↔ 手机横屏
<span class="hljs-code">      ↓         ↓         ↓
布局完全不同   包含ViewPager2  布局完全不同
      ↓         ↓         ↓
每次切换需要   3个Tab频繁   每次切换需要
完全重建UI   切换Fragment  完全重建UI
</span></code></pre>
<h4 data-id="heading-10">具体的引用路径：</h4>
<pre><code class="hljs language-markdown" lang="markdown">PhoneAndroidFragment的View被以下对象引用：
<span class="hljs-bullet">1.</span> ViewPager2.mRecyclerView (RecyclerView实例)
   ↓
<span class="hljs-bullet">2.</span> RecyclerView.mRecycler (RecyclerView.Recycler回收池)
   ↓
<span class="hljs-bullet">3.</span> RecyclerView.Recycler.mCachedViews (缓存视图列表)
   ↓
<span class="hljs-bullet">4.</span> 或 RecyclerView.Recycler.mAttachedScrap (附加的废弃视图)
   ↓
<span class="hljs-bullet">5.</span> Fragment的View在缓存中等待复用
</code></pre>
<h4 data-id="heading-11">为什么会形成这个泄漏链？</h4>
<h5 data-id="heading-12"><strong>场景重现</strong>：</h5>
<ol>
<li>
<p><strong>初始化</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">// MainActivity中
ViewPager2 <span class="hljs-attr">viewPager</span> = findViewById(R.id.view_pager)<span class="hljs-comment">;</span>
<span class="hljs-attr">viewPager.adapter</span> = new FragmentStateAdapter(this)<span class="hljs-comment">;</span>
// 此时，FragmentMaxLifecycleEnforcer被注册到Activity的生命周期
</code></pre>
</li>
<li>
<p><strong>Fragment被销毁</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 当PhoneAndroidFragment收到onDestroyView()时</span>
<span class="hljs-comment">// 理想情况：ViewPager2应该释放对Fragment View的引用</span>
<span class="hljs-comment">// 实际情况：ViewPager2可能还在缓存这个View</span>
</code></pre>
</li>
<li>
<p><strong>问题发生</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// ViewPager2的FragmentStateAdapter没有正确处理</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">onViewRecycled</span>(<span class="hljs-variable">@NonNull</span> FragmentViewHolder holder) {
    <span class="hljs-comment">// 可能没有正确调用FragmentTransaction.remove()</span>
    <span class="hljs-comment">// 或者Fragment的View还在RecyclerView的缓存中</span>
}
</code></pre>
</li>
</ol>
<p><strong>整体的流程图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee90c5c903ce4bcab2e7c645bb9324bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178922&amp;x-signature=coEmPgMczS3SG9OuDeHvBwXkzdM%3D" alt="内存泄露.png" loading="lazy"/></p>
<h3 data-id="heading-13">4. 日志深度分析</h3>
<h4 data-id="heading-14">4.1. GC Root溯源</h4>
<p>日志显示GC Root是<code>Global variable in native code</code>，这表明泄漏的源头在Android系统层。具体来说，是<code>ViewRootImpl</code>的Lambda表达式被native层的全局变量持有。</p>
<p><code>ViewRootImpl</code>是Android窗口系统的核心组件，负责连接应用层的View和系统层的Window。当Activity创建窗口时，系统会创建对应的ViewRootImpl，并在native层注册各种回调。</p>
<h4 data-id="heading-15">4.2. 引用链分析</h4>
<p>让我们逐级分析这个引用链：</p>
<ol>
<li><strong>系统层持有</strong>：native层的全局变量持有ViewRootImpl的Lambda引用</li>
<li><strong>Lambda捕获</strong>：该Lambda捕获了外部类的引用（即MainActivity）</li>
<li><strong>Activity存活</strong>：MainActivity的<code>mDestroyed = false</code>，表明Activity并未销毁</li>
<li><strong>生命周期注册</strong>：Activity的<code>mLifecycleRegistry</code>持有<code>FragmentMaxLifecycleEnforcer</code></li>
<li><strong>ViewPager2关联</strong>：<code>FragmentMaxLifecycleEnforcer</code>持有ViewPager2的引用</li>
<li><strong>视图未被释放</strong>：ViewPager2持有已调用<code>onDestroyView()</code>的Fragment视图</li>
</ol>
<h4 data-id="heading-16">4.3. 关键状态信息</h4>
<p>从日志中我们注意到几个关键状态：</p>
<ul>
<li><code>View.mAttachInfo is null (view detached)</code>：ViewPager2已从窗口分离</li>
<li><code>View not part of a window view hierarchy</code>：视图不在窗口层级中</li>
<li><code>mDestroyed = false</code>：Activity未销毁</li>
<li><code>PhoneAndroidFragment received Fragment#onDestroyView()</code>：Fragment的视图已被销毁</li>
</ul>
<h3 data-id="heading-17">问题本质</h3>
<h4 data-id="heading-18">生命周期错配</h4>
<p>这个问题的核心是<strong>生命周期注册在错误的层级</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">// 错误写法：注册到Activity生命周期
<span class="hljs-attr">adapter</span> = new ViewPagerAdapter(getActivity())<span class="hljs-comment">;</span>

// 正确写法：注册到Fragment生命周期  
<span class="hljs-attr">adapter</span> = new ViewPagerAdapter(this)<span class="hljs-comment">;</span>
</code></pre>
<p>当ViewPager2的<code>FragmentStateAdapter</code>接收到Activity作为参数时，它内部创建的<code>FragmentMaxLifecycleEnforcer</code>会注册到Activity的生命周期。这意味着：</p>
<ul>
<li>即使Fragment的视图被销毁，<code>FragmentMaxLifecycleEnforcer</code>仍然存活</li>
<li><code>FragmentMaxLifecycleEnforcer</code>持有ViewPager2的引用</li>
<li>ViewPager2持有Fragment已销毁的视图</li>
<li>导致Fragment视图无法被GC回收</li>
</ul>
<h4 data-id="heading-19">ViewRootImpl的介入</h4>
<p>为什么系统层的ViewRootImpl会参与这个泄漏链？</p>
<p>当Activity显示时，系统会创建ViewRootImpl来管理窗口。ViewRootImpl可能创建一些Lambda回调（如窗口焦点变化、输入事件处理等），这些Lambda隐式捕获了Activity引用。由于这些回调被native层全局变量引用，它们成为了GC Root，阻止了Activity及其关联对象的回收。</p>
<h3 data-id="heading-20">5. 解决方案</h3>
<h4 data-id="heading-21">方案一：修正生命周期注册（核心修复）</h4>
<p>核心要记住：<strong>FragmentStateAdapter必须使用Fragment的生命周期，而非Activity</strong>，这是解决此类问题的关键。</p>
<p><strong>修改ViewPagerAdapter的构造函数调用</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// PhoneAndroidFragment.java</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>()</span> {
    <span class="hljs-comment">// 将原有的：</span>
    <span class="hljs-comment">// adapter = new ViewPagerAdapter(getActivity());</span>
    <span class="hljs-comment">// 改为：</span>
    adapter = <span class="hljs-keyword">new</span> ViewPagerAdapter(<span class="hljs-keyword">this</span>);  <span class="hljs-comment">// 传递Fragment本身</span>
}
</code></pre>
<p><strong>增强ViewPagerAdapter支持Fragment</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// ViewPagerAdapter.java</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">ViewPagerAdapter</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">FragmentStateAdapter</span> {
    
    <span class="hljs-comment">// 保留原有的Activity构造函数</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ViewPagerAdapter</span>(<span class="hljs-variable">@NonNull</span> FragmentActivity fragmentActivity) {
        <span class="hljs-selector-tag">super</span>(fragmentActivity);
    }
    
    <span class="hljs-comment">// 新增Fragment构造函数（关键修复）</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ViewPagerAdapter</span>(<span class="hljs-variable">@NonNull</span> Fragment fragment) {
        <span class="hljs-selector-tag">super</span>(fragment);
    }
    
    <span class="hljs-comment">// ... 其他代码</span>
}
</code></pre>
<h4 data-id="heading-22">方案二：彻底清理onDestroyView()</h4>
<pre><code class="hljs language-ini" lang="ini">@Override
public void onDestroyView() {
    <span class="hljs-attr">isDestroyed</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    
    // 1. 清理Handler
    if (handler != null) {
        handler.removeCallbacksAndMessages(null)<span class="hljs-comment">;</span>
    }
    
    // 2. 取消ViewPager2回调
    if (viewDataBinding != null &amp;&amp; pageChangeCallback != null) {
        viewDataBinding.phoneSettingPager.unregisterOnPageChangeCallback(pageChangeCallback)<span class="hljs-comment">;</span>
        <span class="hljs-attr">pageChangeCallback</span> = null<span class="hljs-comment">;</span>
    }
    
    // 3. 清理ViewPager2适配器
    if (viewDataBinding != null &amp;&amp; viewDataBinding.phoneSettingPager != null) {
        // 清理内部RecyclerView
        View <span class="hljs-attr">child</span> = viewDataBinding.phoneSettingPager.getChildAt(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
        if (child instanceof RecyclerView) {
            RecyclerView <span class="hljs-attr">recyclerView</span> = (RecyclerView) child<span class="hljs-comment">;</span>
            recyclerView.setAdapter(null)<span class="hljs-comment">;</span>
            recyclerView.setLayoutManager(null)<span class="hljs-comment">;</span>
            recyclerView.getRecycledViewPool().clear()<span class="hljs-comment">;</span>
        }
        
        // 清理ViewPager2适配器
        viewDataBinding.phoneSettingPager.setAdapter(null)<span class="hljs-comment">;</span>
    }
    
    // 4. 清理适配器引用
    <span class="hljs-attr">adapter</span> = null<span class="hljs-comment">;</span>
    
    EventBusUtils.unRegister(this)<span class="hljs-comment">;</span>
    super.onDestroyView()<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-23">方案三：添加状态检查和防护</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 添加状态检查方法</span>
private boolean <span class="hljs-built_in">isFragmentUsable</span>() {
    return !isDestroyed &amp;&amp; 
           <span class="hljs-built_in">isAdded</span>() &amp;&amp; 
           <span class="hljs-built_in">getActivity</span>() != null &amp;&amp; 
           !<span class="hljs-built_in">getActivity</span>()<span class="hljs-selector-class">.isFinishing</span>() &amp;&amp; 
           <span class="hljs-built_in">getView</span>() != null;
}

<span class="hljs-comment">// 在所有回调中使用状态检查</span>
<span class="hljs-keyword">@Subscribe</span>(threadMode = ThreadMode.MAIN)
public void onEvent(SomeEvent event) {
    if (!isFragmentUsable()) return;
   
}
</code></pre>
<h4 data-id="heading-24">方案四：使用WeakReference包装回调</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 安全的回调包装类</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SafePageChangeCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ViewPager2</span>.<span class="hljs-title">OnPageChangeCallback</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-type">WeakReference</span>&lt;<span class="hljs-type">PhoneAndroidFragment</span>&gt; fragmentRef;
    
    public <span class="hljs-type">SafePageChangeCallback</span>(<span class="hljs-type">PhoneAndroidFragment</span> fragment) {
        <span class="hljs-keyword">this</span>.fragmentRef = <span class="hljs-keyword">new</span> <span class="hljs-type">WeakReference</span>&lt;&gt;(fragment);
    }
    
    <span class="hljs-meta">@Override</span>
    public void onPageSelected(int position) {
        <span class="hljs-type">PhoneAndroidFragment</span> fragment = fragmentRef.get();
        <span class="hljs-keyword">if</span> (fragment == <span class="hljs-literal">null</span> || !fragment.isFragmentUsable()) {
            <span class="hljs-keyword">return</span>;
        }
    
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[只需一个域名，零成本拥有无限个自定义邮箱]]></title>    <link>https://juejin.cn/post/7591421956216029222</link>    <guid>https://juejin.cn/post/7591421956216029222</guid>    <pubDate>2026-01-05T00:58:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591421956216029222" data-draft-id="7591406727137689626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="只需一个域名，零成本拥有无限个自定义邮箱"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-05T00:58:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="知识浅谈"/> <meta itemprop="url" content="https://juejin.cn/user/607378030207176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            只需一个域名，零成本拥有无限个自定义邮箱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607378030207176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    知识浅谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:58:10.000Z" title="Mon Jan 05 2026 00:58:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天，我将手把手教你一个**“终极隐私保护”<strong>技巧：只需购买一个便宜的域名（每年一杯奶茶钱），配合 Cloudflare 强大的免费功能，你就能拥有</strong>无限个**属于自己的邮箱地址。</p>
<p><strong>核心原理：</strong> 域名注册 (腾讯云) + DNS 解析 (Cloudflare) + 邮件路由 (Cloudflare Email Routing)</p>
<hr/>
<h2 data-id="heading-0">准备工作</h2>
<ol>
<li><strong>约 10-30 元人民币</strong>（用于购买域名的首年费用）。</li>
<li>一个 <strong>腾讯云</strong> 或者其他云账号（用于购买域名）。</li>
<li>一个 <strong>Cloudflare</strong> 账号（用于管理域名和邮件转发）。</li>
<li>一个你常用的<strong>主邮箱</strong>（如 Gmail, QQ, Outlook，作为最终接收邮件的收件箱）。</li>
</ol>
<hr/>
<h2 data-id="heading-1">第一步：在腾讯云注册域名</h2>
<p>腾讯云（DNSPod）是国内主流的域名注册商，支付方便且管理界面中文友好。</p>
<ol>
<li><strong>搜索域名</strong>：登录腾讯云官网，进入“域名注册”页面。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5c3be15cb2648f4be616099f80abbb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=NcInqWjo3qOZc4ImEB%2FmRRmzKJM%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li><strong>挑选后缀</strong>：如果你只是为了收邮件，不需要买昂贵的 <code>.com</code>。可以选择 <code>.xyz</code>, <code>.top</code>, <code>.site</code> 或 <code>.fun</code> 等便宜的后缀，首年通常只需几块钱。</li>
<li><strong>购买并实名认证</strong>：按照流程支付，并完成域名的实名认证（这是国内注册域名的必须步骤，通常需要上传身份证）。</li>
</ol>
<blockquote>
<p><strong>💡 提示：</strong> 购买完成后，请进入腾讯云的“域名管理”控制台，确认域名状态为“正常”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">第二步：将域名“托管”到 Cloudflare</h2>
<p>为了使用 Cloudflare 的免费邮件路由功能，我们需要将域名的 DNS 解析权从腾讯云移交给 Cloudflare。</p>
<ol>
<li><strong>添加站点</strong>：</li>
</ol>
<ul>
<li>登录 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudflare.com%2F" target="_blank" title="https://www.cloudflare.com/" ref="nofollow noopener noreferrer">Cloudflare 官网</a>。</li>
<li>点击右上角的 <strong>"Add a site" (添加站点)</strong>。</li>
<li>输入你刚才在腾讯云买的域名（例如 <code>mycoolmail.xyz</code>），点击继续。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be5bebc87dfb4da6ad3abdf9afee2057~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=%2F7HwL2AhHPLxs5oIetJzwQuauxs%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="2">
<li><strong>选择套餐</strong>：</li>
</ol>
<ul>
<li>页面会展示各种付费套餐，请<strong>向下滑动</strong>，找到底部的 <strong>"Free" (免费版)</strong> 套餐框，点击选择并继续。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b6401f4fbab48e6b085c9afa9600a35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=5aseRBZ5KH8lf2bymUjGyhcmGsY%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="3">
<li><strong>获取 Nameservers (名称服务器)</strong>：</li>
</ol>
<ul>
<li>Cloudflare 会扫描你当前的 DNS 记录，直接点击继续。</li>
<li><strong>关键步骤</strong>：Cloudflare 会给出两个 Nameserver 地址，通常格式为 <code>xxxx.ns.cloudflare.com</code>。请<strong>复制这两个地址</strong>。</li>
</ul>
<ol start="4">
<li><strong>修改腾讯云 DNS</strong>：</li>
</ol>
<ul>
<li>
<p>回到腾讯云域名控制台，找到你的域名，点击 <strong>“DNS 管理”</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6523a9edf97c4908b7d6a1383ee25bdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=sdI%2FnvfFGyYpWYI1LZitfhJv9G0%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>点击修改DNS服务器
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27b5be67ea61406b9bfbe359d3aadca1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=vONW27f%2BdJiF4eFscI70wBpJp4k%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>将默认的腾讯云 DNS 地址（如 <code>ns1.dnspod.net</code>）删除，选择使用非腾讯云DNS</p>
</li>
<li>
<p><strong>粘贴</strong> 刚才从 Cloudflare 复制的那两个地址。</p>
</li>
<li>
<p>保存设置。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4ae8b63e4ff4d06a3a6da1a97137e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=ny60mQR%2BBL0cvhcDZpCFVwQkrYs%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<blockquote>
<p><strong>⏳ 注意：</strong> DNS 修改生效可能需要几分钟到几小时。在 Cloudflare 页面点击 "Check nameservers"，当看到绿色的 "Active" 状态时，说明绑定成功！</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">第三步：配置 Cloudflare 邮件路由 (Email Routing)</h2>
<p>这是最神奇的一步，配置完全免费且非常简单。</p>
<ol>
<li><strong>启用功能</strong>：</li>
</ol>
<ul>
<li>在 Cloudflare 左侧菜单栏，找到 <strong>"Email" (电子邮件)</strong> -&gt; <strong>"Email Routing" (邮件路由)</strong>。</li>
<li>点击 <strong>"Get Started"</strong> 按钮。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/766723283d0b4b39a20b68376e33e04b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=sJEIifvNKPGEaG1jEr2u3W8NDuQ%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="2">
<li><strong>设置目标邮箱</strong>：</li>
</ol>
<ul>
<li>在 <strong>"Destination address" (目标地址)</strong> 中，填入你平时用的主邮箱（比如你的 QQ 邮箱或 Gmail）。</li>
<li>Cloudflare 会发送一封验证邮件到你的主邮箱，去点击邮件中的验证链接，<strong>这一步不一定有</strong>。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a452cfbb7b8d41d18b31d39750794173~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=tc6TV3kaO%2BlRO%2BfSOT3dXxnl9rE%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="3">
<li><strong>自动添加 DNS 记录</strong>：</li>
</ol>
<ul>
<li>验证成功后，回到 Cloudflare 页面。系统会提示你缺少必要的 MX 和 SPF 记录,<strong>系统提示的时候要点击确认</strong>。</li>
<li>点击 <strong>"Add records and enable" (添加记录并启用)</strong>。Cloudflare 会自动帮你配置好所有复杂的参数，无需手动填写。</li>
</ul>
<hr/>
<h2 data-id="heading-4">第四步：开启“无限邮箱”模式</h2>
<p>现在通过验证后，你有两种方式来创建邮箱。</p>
<h3 data-id="heading-5">方式一：创建固定别名 (Custom Addresses)</h3>
<p>适合固定用途。比如你要注册 Netflix，你可以专门创建一个：</p>
<ul>
<li><strong>Custom address:</strong> <code>netflix</code> (@[可疑链接已删除])</li>
<li><strong>Destination:</strong> 你的主邮箱</li>
<li>点击保存。以后所有发给 <code>netflix@yourdomain.com</code> 的邮件都会躺在你的主邮箱里。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a17e3c41949d4800bc26e8a698bf2716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=8wNqytN9AyXQ3oGfuwPQppMbs0A%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-6">方式二:开启Catch-All(接收所有邮件)推荐 🔥</h3>
<p>这是实现“无限”的关键。开启这个功能后，<strong>任何</strong>发往你域名的邮件，哪怕前缀是你刚才临时瞎编的，都会被转发。</p>
<ol>
<li>在 Email Routing 页面，点击 <strong>"Settings" (设置)</strong> 标签。</li>
<li>找到 <strong>"Catch-All address"</strong> 选项。</li>
<li>点击 <strong>"Edit"</strong>，状态改为 <strong>"Active"</strong>，并通过 "Action" 选择 "Send to"，目标填入你的主邮箱。</li>
<li>保存。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d34408cede3d4e23bc06451031c342b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=Aby92g%2FueH9UtHPOVPNOGKBH06c%3D" alt="" loading="lazy"/></li>
</ol>
<p><strong>使用场景举例：</strong>
当你去一家名为 "ABC书店" 的网站注册时，直接填 <code>abcbook@yourdomain.com</code>。</p>
<ul>
<li><strong>无需设置：</strong> 你不需要先去 Cloudflare 后台创建这个地址，直接填，直接收。</li>
<li><strong>追踪泄露：</strong> 如果以后你收到垃圾邮件，发现收件人是 <code>abcbook@yourdomain.com</code>，你就知道是这家书店泄露了你的信息！</li>
</ul>
<hr/>
<h2 data-id="heading-7">总结</h2>
<p>现在，你已经成功拥有了一个属于自己的企业级域名邮箱系统。</p>
<ul>
<li><strong>成本：</strong> 仅域名费（几十元/年）。</li>
<li><strong>收益：</strong> 无限个邮箱账号，完美的隐私隔离，看起来非常专业的个人形象。</li>
<li><strong>注意：</strong> 目前该方法主要用于<strong>接收</strong>邮件。如果需要用这些域名邮箱<strong>发送</strong>邮件，通常需要配合 Gmail 的 SMTP 功能（设置稍复杂）。</li>
</ul>
<p>快去试试吧,好多网站需要邮箱注册的可以随便注册了，懂得都懂😎</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[后端分层架构规范和标准包结构]]></title>    <link>https://juejin.cn/post/7591350620189048838</link>    <guid>https://juejin.cn/post/7591350620189048838</guid>    <pubDate>2026-01-04T16:36:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189048838" data-draft-id="7587284708943134754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="后端分层架构规范和标准包结构"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-04T16:36:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一线大码"/> <meta itemprop="url" content="https://juejin.cn/user/3280598429340984"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            后端分层架构规范和标准包结构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598429340984/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一线大码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T16:36:37.000Z" title="Sun Jan 04 2026 16:36:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">1. 后端分层架构规范</h2>
<blockquote>
<p><strong>目标</strong><br/>
在真实复杂业务下，保持依赖方向清晰，避免 Service 互相纠缠，保证系统可长期演进。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">1.1. 分层总览（必须遵守）</h3>
<pre><code class="hljs language-java" lang="java">Controller
    ↓
Service / Facade（业务主体 / 流程编排）
    ↓
Query（只读查询模型，允许 JOIN）
    ↓
Dao（单表持久化）
    ↓
Table
</code></pre>
<p><strong>依赖只能自上而下，禁止反向。</strong></p>
<h3 data-id="heading-2">1.2. 核心概念定义（统一口径）</h3>
<h4 data-id="heading-3">1.2.1. 业务主体（Domain Entity）</h4>
<p>具有独立业务语义和生命周期的对象，例如：</p>
<ul>
<li>用户、订单、库存、账户、商品</li>
</ul>
<p><strong>一个业务主体 = 一个 Service</strong></p>
<h4 data-id="heading-4">1.2.2. 附属表（附属/技术性数据）</h4>
<p>不具备独立业务语义，仅服务于某一主体：</p>
<ul>
<li>日志、流水、历史表、快照、审计表</li>
</ul>
<p><strong>可以由主体 Service 直接操作</strong></p>
<h4 data-id="heading-5">1.2.3. 跨主体流程</h4>
<p>涉及 <strong>两个及以上业务主体</strong> 的写操作：</p>
<ul>
<li>下单扣库存</li>
<li>订单 + 支付</li>
<li>用户 + 账户初始化</li>
</ul>
<p><strong>必须上移到 Facade / Flow Service</strong></p>
<h3 data-id="heading-6">1.3. 各层职责与硬规则</h3>
<h4 data-id="heading-7">1.3.1. Controller 层（入口层）</h4>
<p><strong>职责</strong></p>
<ul>
<li>参数校验</li>
<li>权限校验</li>
<li>调用 Service / Facade</li>
</ul>
<p><strong>禁止</strong></p>
<ul>
<li>❌ 写业务逻辑</li>
<li>❌ 访问 Dao / Query</li>
<li>❌ Controller 互调</li>
</ul>
<h4 data-id="heading-8">1.3.2. Service 层（业务主体层）</h4>
<p><strong>职责</strong></p>
<ul>
<li>本业务主体的业务规则</li>
<li>状态变更</li>
<li>操作本主体表及其附属表</li>
</ul>
<p><strong>允许</strong></p>
<ul>
<li>✅ 写：本主体 Dao</li>
<li>✅ 写：本主体附属表 Dao（日志 / 流水）</li>
<li>✅ 读：Query（用于校验 / 展示 / 计算）</li>
</ul>
<p><strong>禁止</strong></p>
<ul>
<li>❌ 写其他业务主体表</li>
<li>❌ 调用其他业务主体 Service</li>
<li>❌ 编写 JOIN SQL</li>
</ul>
<blockquote>
<p><strong>判断口诀</strong><br/>
“如果删掉另一个业务主体，这个方法是否仍成立？”</p>
<ul>
<li>是 → 留在本 Service</li>
<li>否 → 上移 Facade</li>
</ul>
</blockquote>
<h4 data-id="heading-9">1.3.3. Facade / Flow Service（流程编排层）</h4>
<p><strong>职责</strong></p>
<ul>
<li>跨业务主体流程</li>
<li>调用顺序</li>
<li>事务边界</li>
<li>异常与失败处理</li>
</ul>
<p><strong>允许</strong></p>
<ul>
<li>✅ 调用多个 Service</li>
<li>✅ 管理事务</li>
</ul>
<p><strong>禁止</strong></p>
<ul>
<li>❌ 直接访问 Dao</li>
<li>❌ 编写 SQL</li>
<li>❌ 实现领域细节规则</li>
</ul>
<h4 data-id="heading-10">1.3.4. Query 层（只读模型，JOIN 主要归属）</h4>
<p><strong>职责</strong></p>
<ul>
<li>多表查询</li>
<li>列表 / 详情 / 统计 / 报表</li>
<li>性能优化查询</li>
</ul>
<p><strong>允许</strong></p>
<ul>
<li>✅ JOIN 多表</li>
<li>✅ 跨业务主体</li>
<li>✅ 返回 DTO / View Object</li>
</ul>
<p><strong>禁止</strong></p>
<ul>
<li>❌ 写操作（INSERT / UPDATE / DELETE）</li>
<li>❌ 承载业务规则</li>
<li>❌ 修改业务状态</li>
</ul>
<p><strong>命名建议</strong></p>
<ul>
<li><code>XxxOnlyQuery</code></li>
<li><code>XxxReadModel</code></li>
<li><code>XxxQueryRepository</code></li>
</ul>
<h4 data-id="heading-11">1.3.5. Dao 层（持久化层）</h4>
<p><strong>职责</strong></p>
<ul>
<li>单表 CRUD</li>
<li>与表结构一一对应</li>
</ul>
<p><strong>规则</strong></p>
<ul>
<li>❌ 不允许 JOIN 多个业务主体表</li>
<li>❌ 不承载业务语义</li>
<li>❌ 不被跨业务主体复用</li>
</ul>
<h3 data-id="heading-12">1.4. JOIN SQL 放置规则（强制执行）</h3>
<p><strong>一句话规则（写在 Code Review 标准里）</strong></p>
<blockquote>
<p><strong>凡是 JOIN 了多个业务主体的 SQL，一律不进主体 Dao。</strong></p>
</blockquote>
<h4 data-id="heading-13">1.4.1. JOIN SQL 决策表（必须按顺序判断）</h4>
<p><strong>❓1️⃣ 是否跨多个业务主体？</strong></p>
<ul>
<li>是 → <strong>Query</strong></li>
<li>否 → 继续</li>
</ul>
<p><strong>❓2️⃣ 是否只读？</strong></p>
<ul>
<li>是 → <strong>Query</strong></li>
<li>否 → ❌ 拆为 Service 调用（禁止 JOIN 写）</li>
</ul>
<p><strong>❓3️⃣ 是否承载业务规则？</strong></p>
<ul>
<li>是 → ❌ 不允许（回 Service）</li>
<li>否 → <strong>Query</strong></li>
</ul>
<h4 data-id="heading-14">1.4.2. 允许放在主体 Dao 的唯一例外</h4>
<p><strong>同时满足以下所有条件：</strong></p>
<ul>
<li>
<p>JOIN 的表全部属于 <strong>同一业务主体</strong></p>
</li>
<li>
<p>关联的是：</p>
<ul>
<li>明细表</li>
<li>日志表</li>
<li>快照表</li>
</ul>
</li>
<li>
<p>SQL 不影响其他主体决策</p>
</li>
</ul>
<p>✅ 示例（允许）：</p>
<pre><code class="hljs language-java" lang="java">OrderDao.findOrderWithItems()
-- Order + OrderItem
</code></pre>
<p>❌ 示例（禁止）：</p>
<pre><code class="hljs language-java" lang="java">OrderDao.findOrderWithUser()
OrderDao.joinStock()
</code></pre>
<h3 data-id="heading-15">1.5. 最容易犯错的 3 种情况（必须避免）</h3>
<h4 data-id="heading-16">1.5.1. 在 Service / Dao 中写跨主体 JOIN</h4>
<pre><code class="hljs language-java" lang="java">UPDATE order o
JOIN stock s ...
</code></pre>
<h4 data-id="heading-17">1.5.2. 为了“只是查一下”，直接跨主体 Dao</h4>
<pre><code class="hljs language-java" lang="java">orderService → userDao
</code></pre>
<h4 data-id="heading-18">1.5.3. 统计 / 报表复用业务 Dao</h4>
<pre><code class="hljs language-java" lang="java">statisticsService → orderDao
</code></pre>
<h3 data-id="heading-19">1.6. 快速决策表（写代码前 10 秒）</h3>





























<table><thead><tr><th>场景</th><th>放置位置</th></tr></thead><tbody><tr><td>单主体业务写</td><td>对应 Service</td></tr><tr><td>多主体业务写</td><td>Facade / Flow Service</td></tr><tr><td>多表 JOIN 查询</td><td>Query</td></tr><tr><td>日志 / 流水</td><td>主体 Service</td></tr><tr><td>报表 / 统计</td><td>StatisticsService + Query</td></tr></tbody></table>
<h3 data-id="heading-20">1.7. 团队共识（强烈建议贴墙）</h3>
<blockquote>
<p><strong>不要按“表”拆 Service，要按“业务主体”拆 Service。</strong></p>
<p><strong>不要为了 JOIN 方便，把查询塞进主体 Dao。</strong></p>
</blockquote>
<h2 data-id="heading-21">2. 标准包结构</h2>
<p>下面是一份按<strong>真实中大型 Java / Spring 项目</strong>整理的，不是教学 Demo。</p>
<blockquote>
<p>目标：</p>
<ul>
<li>一眼能看懂分层</li>
<li>新人不容易写错</li>
<li>Code Review 时“看路径就能发现问题”</li>
</ul>
</blockquote>
<p>标准包结构示例（可直接照抄）</p>
<blockquote>
<p>示例以 <strong>订单 + 用户 + 库存</strong> 场景为例<br/>
包名你可以换，公司名不重要</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">com.xxx.project
</code></pre>
<h3 data-id="heading-22">2.1. 整体结构总览（先看全貌）</h3>
<pre><code class="hljs language-java" lang="java">com.xxx.project
├─ controller
├─ application        <span class="hljs-comment">// Facade / 流程编排</span>
├─ domain             <span class="hljs-comment">// 业务主体</span>
│   ├─ order
│   ├─ user
│   └─ stock
├─ query               <span class="hljs-comment">// 只读查询模型（JOIN 主要在这）</span>
├─ statistics          <span class="hljs-comment">// 统计 / 报表</span>
├─ infrastructure      <span class="hljs-comment">// 基础设施（Dao / Mapper / MQ / Cache）</span>
└─ common
</code></pre>
<h3 data-id="heading-23">2.2. Controller 层（入口）</h3>
<pre><code class="hljs language-java" lang="java">controller
├─ OrderController.java
├─ UserController.java
├─ StockController.java
├─ OrderStockController.java     <span class="hljs-comment">// 对应 Facade</span>
└─ StatisticsController.java
</code></pre>
<p><strong>规则</strong></p>
<ul>
<li>
<p>Controller 只依赖：</p>
<ul>
<li><code>domain.*.service</code></li>
<li><code>application.*</code></li>
</ul>
</li>
<li>
<p>❌ 不允许出现 Dao / Query</p>
</li>
</ul>
<h3 data-id="heading-24">2.3. Application 层（Facade / Flow Service）</h3>
<blockquote>
<p><strong>所有“跨业务主体写”的逻辑都在这里</strong></p>
</blockquote>
<pre><code class="hljs language-java" lang="java">application
├─ orderstock
│   ├─ OrderStockFacade.java
│   └─ OrderStockFacadeImpl.java
└─ payment
    ├─ OrderPaymentFacade.java
    └─ OrderPaymentFacadeImpl.java
</code></pre>
<p><strong>规则</strong></p>
<ul>
<li>
<p>只做：</p>
<ul>
<li>调用顺序</li>
<li>事务</li>
<li>失败处理</li>
</ul>
</li>
<li>
<p>❌ 不写 SQL</p>
</li>
<li>
<p>❌ 不访问 Dao</p>
</li>
</ul>
<h3 data-id="heading-25">2.4. Domain 层（业务主体，最核心）</h3>
<h4 data-id="heading-26">2.4.1. Order 领域</h4>
<pre><code class="hljs language-java" lang="java">domain/order
├─ service
│   ├─ OrderService.java
│   └─ OrderServiceImpl.java
├─ model
│   ├─ Order.java
│   └─ OrderStatus.java
└─ event
    └─ OrderCreatedEvent.java
</code></pre>
<p><strong>OrderService 可以：</strong></p>
<ul>
<li>写 OrderDao</li>
<li>写 OrderLogDao</li>
<li>读 Query</li>
</ul>
<h4 data-id="heading-27">2.4.2. User 领域</h4>
<pre><code class="hljs language-java" lang="java">domain/user
├─ service
│   ├─ UserService.java
│   └─ UserServiceImpl.java
├─ model
│   └─ User.java
└─ validator
    └─ UserValidator.java
</code></pre>
<h4 data-id="heading-28">2.4.3. Stock 领域</h4>
<pre><code class="hljs language-java" lang="java">domain/stock
├─ service
│   ├─ StockService.java
│   └─ StockServiceImpl.java
├─ model
│   └─ Stock.java
└─ policy
    └─ StockDeductPolicy.java
</code></pre>
<h3 data-id="heading-29">2.5. Query 层（只读模型，JOIN 全在这里）</h3>
<blockquote>
<p><strong>这是架构里最关键的一层</strong></p>
</blockquote>
<pre><code class="hljs language-java" lang="java">query
├─ order
│   ├─ OrderOnlyQuery.java
│   ├─ OrderOnlyQueryImpl.java
│   └─ dto
│       └─ OrderView.java
├─ orderlog
│   ├─ OrderLogOnlyQuery.java
│   └─ OrderLogOnlyQueryImpl.java
├─ user
│   ├─ UserOnlyQuery.java
│   └─ UserOnlyQueryImpl.java
└─ statistics
    ├─ OrderStatisticsQuery.java
    └─ StatisticsView.java
</code></pre>
<p><strong>规则</strong></p>
<ul>
<li>✅ 允许 JOIN</li>
<li>✅ 允许跨主体</li>
<li>❌ 禁止写操作</li>
<li>❌ 禁止业务判断</li>
</ul>
<h3 data-id="heading-30">2.6. Statistics 层（横向统计）</h3>
<pre><code class="hljs language-java" lang="java">statistics
├─ StatisticsService.java
└─ StatisticsServiceImpl.java
</code></pre>
<p><strong>依赖方向</strong></p>
<pre><code class="hljs language-java" lang="java">StatisticsService
   ↓
Query（多个）
</code></pre>
<p>❌ 不允许：</p>
<ul>
<li>直接访问 Dao</li>
<li>调用 Domain Service</li>
</ul>
<h3 data-id="heading-31">2.7. Infrastructure 层（Dao / Mapper）</h3>
<pre><code class="hljs language-java" lang="java">infrastructure
├─ dao
│   ├─ order
│   │   ├─ OrderDao.java
│   │   └─ OrderLogDao.java
│   ├─ user
│   │   └─ UserDao.java
│   └─ stock
│       └─ StockDao.java
├─ mapper
│   └─ *.xml
├─ cache
│   └─ RedisClient.java
└─ mq
    └─ MessageProducer.java
</code></pre>
<p><strong>规则</strong></p>
<ul>
<li>Dao = 单表</li>
<li>❌ 不写 JOIN</li>
<li>❌ 不写业务逻辑</li>
</ul>
<h3 data-id="heading-32">2.8. Common 层（通用能力）</h3>
<pre><code class="hljs language-java" lang="java">common
├─ exception
│   └─ BizException.java
├─ util
│   └─ IdGenerator.java
├─ constant
│   └─ ErrorCode.java
└─ base
    └─ BaseEntity.java
</code></pre>
<h3 data-id="heading-33">2.9. 可以直接用的「包级约束口诀」</h3>
<p>可以在团队里这样要求：</p>
<blockquote>
<ul>
<li><code>domain</code> <strong>不准依赖</strong> <code>application</code></li>
<li><code>query</code> <strong>不准依赖</strong> <code>domain.service</code></li>
<li><code>controller</code> <strong>不准依赖</strong> <code>dao</code></li>
<li><code>statistics</code> <strong>只准依赖</strong> <code>query</code></li>
</ul>
</blockquote>
<h3 data-id="heading-34">2.10. Code Review 一眼判断法（非常好用）</h3>
<p>看到一个类，只看路径就能判断对不对：</p>
<ul>
<li>📂 <code>domain/order/service/OrderService</code><br/>
→ <strong>只能有订单逻辑</strong></li>
<li>📂 <code>query/order/OrderOnlyQuery</code><br/>
→ <strong>一定是 JOIN + 只读</strong></li>
<li>📂 <code>application/orderstock/OrderStockFacade</code><br/>
→ <strong>一定是跨域流程</strong></li>
<li>📂 <code>statistics/StatisticsService</code><br/>
→ <strong>一定不写业务</strong></li>
</ul>
<p>这套包结构 <strong>不是最简单的</strong>，但它是<strong>复杂业务下最不容易“写歪”的结构之一</strong>。</p>
<h2 data-id="heading-35">3. 多模块项目</h2>
<p>用 <strong>Gradle（尤其是多模块）</strong> 做这个分层非常顺手。下面是一套<strong>可直接照抄、跑得起来</strong>的模板：</p>
<ul>
<li><code>web</code>、<code>open</code> 都能访问数据库</li>
<li>Entity / Mapper 接口 / mapper.xml 统一复用</li>
<li><strong>不放 common</strong>，而是放到 <code>persistence</code> 模块（共享数据访问层）</li>
<li>Spring Boot + MyBatis</li>
</ul>
<h3 data-id="heading-36">3.1. 推荐的 Gradle 多模块目录结构</h3>
<pre><code class="hljs language-java" lang="java">project-root
├─ settings.gradle
├─ build.gradle
├─ common
│  └─ build.gradle
├─ persistence
│  ├─ build.gradle
│  └─ src/main
│     ├─ java/com/xxx/persistence
│     │  ├─ entity
│     │  ├─ mapper
│     │  └─ config
│     └─ resources
│        └─ mapper
│           ├─ UserMapper.xml
│           └─ OrderMapper.xml
├─ web
│  └─ build.gradle
├─ open
│  └─ build.gradle
└─ bootstrap
   └─ build.gradle
</code></pre>
<blockquote>
<p><code>bootstrap</code> 是启动模块（可选，但强烈推荐），避免 web/open 同时作为启动入口导致配置乱。</p>
</blockquote>
<h3 data-id="heading-37">3.2. settings.gradle（必须）</h3>
<pre><code class="hljs language-java" lang="java">rootProject.name = <span class="hljs-string">"demo-project"</span>

include(
        <span class="hljs-string">"common"</span>,
        <span class="hljs-string">"persistence"</span>,
        <span class="hljs-string">"web"</span>,
        <span class="hljs-string">"open"</span>,
        <span class="hljs-string">"bootstrap"</span>
)
</code></pre>
<h3 data-id="heading-38">3.3. 根 build.gradle（统一版本、插件管理）</h3>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span> version <span class="hljs-string">'3.2.3'</span> apply <span class="hljs-literal">false</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span> version <span class="hljs-string">'1.1.4'</span> apply <span class="hljs-literal">false</span>
    id <span class="hljs-string">'java'</span> apply <span class="hljs-literal">false</span>
}

allprojects {
    group = <span class="hljs-string">'com.xxx'</span>
    version = <span class="hljs-string">'1.0.0'</span>
}

subprojects {
    apply plugin: <span class="hljs-string">'java'</span>
    java {
        toolchain {
            languageVersion = JavaLanguageVersion.of(<span class="hljs-number">17</span>)
        }
    }

    repositories {
        mavenCentral()
    }
}
</code></pre>
<h3 data-id="heading-39">3.4. common/build.gradle（纯通用，无数据库依赖）</h3>
<pre><code class="hljs language-java" lang="java">dependencies {
    <span class="hljs-comment">// 放工具类、异常、返回结构等</span>
    implementation <span class="hljs-string">"org.apache.commons:commons-lang3:3.14.0"</span>
}
</code></pre>
<p>common 模块是通用模块。主要放一些其它各模块公用的一些代码：</p>
<p>✅ common 保持“干净”，放：</p>
<ul>
<li><code>BaseResponse / PageRequest / PageResult</code></li>
<li><code>BizException / ErrorCode</code>（基础类）</li>
<li><code>工具类 util</code></li>
<li><code>公共注解</code></li>
<li><code>通用枚举基类 BaseEnum</code></li>
<li><code>ID生成器</code></li>
<li><code>常量 GlobalConstants</code></li>
</ul>
<p>❌ 不放：</p>
<ul>
<li><code>UserDO / OrderDO</code></li>
<li><code>UserMapper</code></li>
<li><code>mapper.xml</code></li>
<li><code>数据库依赖与配置</code></li>
</ul>
<h3 data-id="heading-40">3.5. persistence/build.gradle（共享数据库访问层）</h3>
<blockquote>
<p>这里放：DO/Entity、Mapper接口、mapper.xml<br/>
让 web/open 都 <code>implementation(project(":persistence"))</code>。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>

    <span class="hljs-comment">// MyBatis Spring Boot Starter</span>
    implementation <span class="hljs-string">"org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3"</span>

    <span class="hljs-comment">// 数据库驱动（你用什么换什么，这里以 MySQL 为例）</span>
    runtimeOnly <span class="hljs-string">"com.mysql:mysql-connector-j:8.3.0"</span>

    <span class="hljs-comment">// 可选：Lombok</span>
    compileOnly <span class="hljs-string">"org.projectlombok:lombok:1.18.30"</span>
    annotationProcessor <span class="hljs-string">"org.projectlombok:lombok:1.18.30"</span>
}

tasks.withType(Test).configureEach {
    useJUnitPlatform()
}
</code></pre>
<h4 data-id="heading-41">3.5.1. persistence 模块里 MyBatis 扫描与 XML 路径（非常关键）</h4>
<p>mapper.xml 放的位置（推荐）</p>
<pre><code class="hljs language-java" lang="java">persistence/src/main/resources/mapper<span class="hljs-comment">/*.xml
</span></code></pre>
<p>persistence/config/MybatisConfig.java（可选，但建议）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.xxx.persistence.config;

<span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@MapperScan("com.xxx.persistence.mapper")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisConfig</span> {
}
</code></pre>
<blockquote>
<p>这样就不怕扫描不到 Mapper。<br/>
<code>web/open/bootstrap</code> 引入 persistence 后会自动生效。</p>
</blockquote>
<h4 data-id="heading-42">3.5.2. persistence 模块</h4>
<p>persistence 是持久层模块。persistence 模块内容建议：</p>
<pre><code class="hljs language-java" lang="java">persistence
├─ entity                 <span class="hljs-comment">// DB 实体（DO / PO）</span>
│  ├─ UserDO.java
│  └─ OrderDO.java
├─ mapper                 <span class="hljs-comment">// MyBatis Mapper 接口（Dao）</span>
│  ├─ UserMapper.java
│  └─ OrderMapper.java
├─ xml                    <span class="hljs-comment">// mapper.xml（或 resources/mapper）</span>
│  ├─ UserMapper.xml
│  └─ OrderMapper.xml
└─ config                 <span class="hljs-comment">// MyBatis 配置 / 扫描配置（可选）</span>
</code></pre>
<p>注意：这里的实体最好叫 DO/PO，不要叫 Domain Entity（避免把领域模型和表强绑定）。</p>
<p><strong>Entity / Dao / XML 统一放到 <code>persistence</code> 模块：</strong></p>
<p>示例：</p>
<pre><code class="hljs language-java" lang="java">persistence/src/main/java/com/xxx/persistence/entity/UserDO.java
persistence/src/main/java/com/xxx/persistence/mapper/UserMapper.java
persistence/src/main/resources/mapper/UserMapper.xml
</code></pre>
<p>web/open 直接注入 Mapper 使用：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UserMapper userMapper;
</code></pre>
<p><strong>可能会担心的问题：web/open 同时访问 DB，会不会乱？</strong></p>
<p>不会，只要你遵守：</p>
<p>✅ DB 相关东西只在 <code>persistence</code><br/>
✅ 启动配置统一放 <code>bootstrap</code><br/>
✅ web/open 不重复配置数据源</p>
<h3 data-id="heading-43">3.6. web/build.gradle（依赖 persistence）</h3>
<blockquote>
<p>这里建议 web 不直接引数据库驱动、mybatis 依赖，都从 persistence 来。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":persistence"</span>)</span>

    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter-web"</span>
    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter-validation"</span>
}
</code></pre>
<h3 data-id="heading-44">3.7. open/build.gradle（依赖 persistence）</h3>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":persistence"</span>)</span>

    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter-web"</span>
}
</code></pre>
<h3 data-id="heading-45">3.8. bootstrap 模块的启动类（Spring Boot main）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.xxx.bootstrap;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication(scanBasePackages = "com.xxx")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>
<blockquote>
<p><code>scanBasePackages="com.xxx"</code> 确保扫描到 persistence/web/open 的 bean。</p>
</blockquote>
<h4 data-id="heading-46">3.8.1. bootstrap/build.gradle（推荐：唯一启动模块）</h4>
<blockquote>
<p>让 bootstrap 作为唯一入口，web/open 只是功能模块。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":persistence"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":web"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":open"</span>)</span>

    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter"</span>
}
</code></pre>
<h4 data-id="heading-47">3.8.2. application.yml（放 bootstrap 模块）</h4>
<p><code>bootstrap/src/main/resources/application.yml</code></p>
<pre><code class="hljs language-java" lang="java">spring:
  datasource:
    url: jdbc:mysql:<span class="hljs-comment">//localhost:3306/demo?useSSL=false&amp;serverTimezone=UTC</span>
    username: root
    password: root

mybatis:
  mapper-locations: classpath*:mapper<span class="hljs-comment">/*.xml
  type-aliases-package: com.xxx.persistence.entity
</span></code></pre>
<blockquote>
<p>✅ <code>classpath*:</code> 非常重要，保证多模块 resources 能被找到<br/>
✅ mapper-locations 匹配 persistence/resources/mapper</p>
</blockquote>
<h4 data-id="heading-48">3.8.3. 如果不设 bootstrap</h4>
<p>如果不设 bootstrap，而是 <code>web</code>、<code>open</code> 各自启动：</p>
<ul>
<li>web/open 都要有自己的启动类 <code>@SpringBootApplication(scanBasePackages="com.xxx")</code></li>
<li>application.yml 放各自模块里</li>
</ul>
<p>缺点：配置容易重复；优点：模块独立运行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何用 Dart 写个自己的MCP服务]]></title>    <link>https://juejin.cn/post/7591350620189114374</link>    <guid>https://juejin.cn/post/7591350620189114374</guid>    <pubDate>2026-01-04T22:57:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189114374" data-draft-id="7591510742634414143" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何用 Dart 写个自己的MCP服务"/> <meta itemprop="keywords" content="Flutter,MCP,Dart"/> <meta itemprop="datePublished" content="2026-01-04T22:57:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张风捷特烈"/> <meta itemprop="url" content="https://juejin.cn/user/149189281194766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何用 Dart 写个自己的MCP服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189281194766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张风捷特烈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T22:57:32.000Z" title="Sun Jan 04 2026 22:57:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f51c2cf7f444182b09071101b2b9241~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1024&amp;h=559&amp;s=404732&amp;e=png&amp;b=042359" alt="" loading="lazy"/></p>
<blockquote>
<p>纸上学来终觉浅，绝知此事要躬行</p>
</blockquote>
<p>了解事物最好的方式，就是自己去做些什么。作为一名 Flutter 开发工程师，当我们谈论 MCP（Model Context Protocol）时，不妨从一个简单的时间服务开始，看看这个协议如何在实际开发中发挥作用。</p>
<p>在 AI 快速发展的今天，我们见证了无数工具的诞生，但它们之间的协作往往充满摩擦。每个工具都有自己的接口规范，AI 需要为每个工具学习不同的"语言"。这种碎片化的现状，正是 MCP 要解决的核心问题。</p>
<hr/>
<h4 data-id="heading-0">1.直观体验 MCP 是作用</h4>
<p>MCP（Model Context Protocol）本质上是一种<strong>标准化的通信协议</strong>，它定义了 AI 模型与外部工具之间的交互方式。就像 HTTP 协议规范了浏览器与服务器的通信一样，MCP 规范了 AI 与各种服务的对话规则。这里就不说多说那些废话的大道理，直接从实际场景，介绍 MCP 的价值。<br/>
比如说，如果没有 MCP 时，让 AI 处理这个内容：</p>
<blockquote>
<p>帮我查看一下这篇文章的内容 <a href="https://juejin.cn/post/7588004601392529442" target="_blank" title="https://juejin.cn/post/7588004601392529442">juejin.cn/post/758800…</a></p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/73294ab11ee940758c5222af517161b4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1160&amp;h=488&amp;s=113293&amp;e=png&amp;b=272727" alt="" loading="lazy"/></p>
<p>就会得到 <code>我无法直接访问外部网站链接来查看文章内容</code>, 明明它有个很强的脑子，但是就像是没有眼睛一样，看不到网页里的东西，岂不可惜。</p>
<hr/>
<p>如果工具一旦接入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.browsermcp.io%2Fsetup-server" target="_blank" title="https://docs.browsermcp.io/setup-server" ref="nofollow noopener noreferrer">browsermcp</a> 的 MCP 服务, 它就能 <strong>看见</strong> 网页。同理，内置的文件访问、搜索等工具也是类似，这样工具们就可以调度大脑，思考网站、写入文件，让整个流程畅通起来。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef21343822f44212926a19ba8d5e2b40~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1177&amp;h=728&amp;s=135073&amp;e=png&amp;b=272727" alt="" loading="lazy"/></p>
<blockquote>
<p>如果说 AI 是一个强大的大脑，那么 MCP 就是眼睛、手、脚。让 AI 能看、能做。</p>
</blockquote>
<hr/>
<h4 data-id="heading-1">2.从时间服务看协议本质</h4>
<p>理解 MCP 最好的方式，就是动手写一个服务。我们从最简单的时间服务开始，看看这个协议如何工作。
如果什么都没有的时候，问 AI <code>现在什么时候</code>, 你将得到一个它自认为的错误时间：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dda07d1dece04d6d93203629b8d3cb88~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=750&amp;h=188&amp;s=14864&amp;e=png&amp;b=272727" alt="" loading="lazy"/></p>
<p>我们本文要做的，是基于 Dart 语言，搭建一个可以理解当前时间的 MCP 服务，让 AI 可以在需要时，调用 Dart 的服务，得到本机的精确时间，如下所示:</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/265f445bc3a1490f9d7ac07ee247627f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=767&amp;h=321&amp;s=27724&amp;e=png&amp;b=262626" alt="" loading="lazy"/></p>
<p>项目结构很简单：</p>
<pre><code class="hljs language-python" lang="python">now/
├── <span class="hljs-built_in">bin</span>/
│   └── server.dart          <span class="hljs-comment"># 主服务器文件</span>
├── pubspec.yaml             <span class="hljs-comment"># Dart 项目配置</span>
├── mcp-config.json          <span class="hljs-comment"># MCP 服务配置</span>
└── README.md               <span class="hljs-comment"># 项目说明</span>
</code></pre>
<hr/>
<h4 data-id="heading-2">3.协议的三个核心阶段</h4>
<p>MCP 服务有明确的生命周期，每个阶段都有特定的职责。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f375f74254e4992a614d2278c26d795~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1200&amp;h=722&amp;s=50467&amp;e=png&amp;b=fff9f9" alt="" loading="lazy"/></p>
<p><strong>初始化阶段</strong> - 协议握手</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">case</span> <span class="hljs-string">'initialize'</span>:
  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-string">'result'</span>: {
      <span class="hljs-string">'protocolVersion'</span>: <span class="hljs-string">'2024-11-05'</span>,
      <span class="hljs-string">'capabilities'</span>: {
        <span class="hljs-string">'tools'</span>: {}  <span class="hljs-comment">// 声明支持工具调用</span>
      },
      <span class="hljs-string">'serverInfo'</span>: {
        <span class="hljs-string">'name'</span>: <span class="hljs-string">'now-server'</span>,
        <span class="hljs-string">'version'</span>: <span class="hljs-string">'1.0.0'</span>
      }
    },
    <span class="hljs-string">'id'</span>: id
  };
</code></pre>
<p>这个阶段确保客户端和服务端使用兼容的协议版本，就像两个人见面先确认说的是同一种语言。</p>
<p><strong>工具发现阶段</strong> - 能力声明</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">case</span> <span class="hljs-string">'tools/list'</span>:
  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-string">'result'</span>: {
      <span class="hljs-string">'tools'</span>: [
        {
          <span class="hljs-string">'name'</span>: <span class="hljs-string">'get_current_time'</span>,
          <span class="hljs-string">'description'</span>: <span class="hljs-string">'Get the current date and time'</span>,
          <span class="hljs-string">'inputSchema'</span>: {
            <span class="hljs-string">'type'</span>: <span class="hljs-string">'object'</span>,
            <span class="hljs-string">'properties'</span>: {
              <span class="hljs-string">'format'</span>: {
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,
                <span class="hljs-string">'description'</span>: <span class="hljs-string">'Time format (iso, local, utc)'</span>,
                <span class="hljs-string">'default'</span>: <span class="hljs-string">'iso'</span>
              }
            },
            <span class="hljs-string">'additionalProperties'</span>: <span class="hljs-keyword">false</span>
          }
        }
      ]
    },
    <span class="hljs-string">'id'</span>: id
  };
</code></pre>
<p>这里用 JSON Schema 描述工具的接口。AI 通过这个描述就知道如何调用工具，不需要额外的文档说明。</p>
<p><strong>工具执行阶段</strong> - 实际工作</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">case</span> <span class="hljs-string">'tools/call'</span>:
  <span class="hljs-keyword">final</span> toolName = params[<span class="hljs-string">'name'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">String?</span>;
  <span class="hljs-keyword">final</span> arguments = params[<span class="hljs-string">'arguments'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;? ?? {};

  <span class="hljs-keyword">if</span> (toolName == <span class="hljs-string">'get_current_time'</span>) {
    <span class="hljs-keyword">return</span> handleGetCurrentTime(arguments, id);
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-string">'error'</span>: {
      <span class="hljs-string">'code'</span>: <span class="hljs-number">-32601</span>,
      <span class="hljs-string">'message'</span>: <span class="hljs-string">'Tool not found: <span class="hljs-subst">$toolName</span>'</span>
    },
    <span class="hljs-string">'id'</span>: id
  };
</code></pre>
<hr/>
<h4 data-id="heading-3">4.通信机制的核心</h4>
<p>MCP 建立在 JSON-RPC 2.0 之上，基于 stdio 通信。服务器监听 stdin，通过 stdout 响应：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70772526f1d642ea9493726e7a13244a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1249&amp;h=265&amp;s=27398&amp;e=png&amp;b=fefdfd" alt="" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">void</span> main() {
  stdin
      .transform(utf8.decoder)
      .transform(LineSplitter())
      .listen((line) {
    <span class="hljs-keyword">if</span> (line.trim().isEmpty) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> request = jsonDecode(line);
      <span class="hljs-keyword">final</span> response = handleRequest(request);
      <span class="hljs-keyword">if</span> (response != <span class="hljs-keyword">null</span>) {
        stdout.writeln(jsonEncode(response));
        stdout.flush();
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">final</span> errorResponse = {
        <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
        <span class="hljs-string">'error'</span>: {
          <span class="hljs-string">'code'</span>: <span class="hljs-number">-32700</span>,
          <span class="hljs-string">'message'</span>: <span class="hljs-string">'Parse error'</span>
        },
        <span class="hljs-string">'id'</span>: <span class="hljs-keyword">null</span>
      };
      stdout.writeln(jsonEncode(errorResponse));
      stdout.flush();
    }
  });
}
</code></pre>
<p>这种方式跨平台兼容性好，进程隔离天然安全，调试和测试容易。可以直接运行 dart 项目，输入 <code> {"jsonrpc":"2.0","id":1,"method":"initialize"}</code> 来测试服务是否正常响应：</p>
<blockquote>
<p>命令行: dart .\bin\server.dart<br/>
输入:  {"jsonrpc":"2.0","id":1,"method":"initialize"}<br/>
输出: {"jsonrpc":"2.0","result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{}},"serverInfo":{"name":"now-server","version":"1.0.0"}},"id":1}</p>
</blockquote>
<hr/>
<h4 data-id="heading-4">5.协议设计的智慧</h4>
<p>MCP 的设计体现了几个重要的软件工程原则：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be9435ed8314445686c8b366aa429fcb~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1208&amp;h=652&amp;s=72603&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p><strong>约定优于配置</strong> - 统一的协议减少了集成的复杂性<br/>
<strong>最小惊讶原则</strong> - 协议的每个部分都遵循直觉，没有意外的行为<br/>
<strong>关注点分离</strong> - 协议层面只关心通信格式，业务逻辑由工具实现者决定</p>
<p>这种标准化的力量，就像建筑行业的标准化螺丝。看起来简单，但却让整个行业的协作变得高效。一个 MCP 服务不是孤立的存在。AI 可以协调使用 MCP 工具，联合处理任务, 比如:</p>
<blockquote>
<p>将当前时间写到文章开头</p>
</blockquote>
<p>此时 AI 大脑就可以调度获取当前时间的 MCP，然后调度写入文件的能力，完成实际的功能。让一个文章可以自动填入当前时间：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b105b3561bb940ae8f20c9c2da0d51df~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1988&amp;h=797&amp;s=304535&amp;e=png&amp;b=252525" alt="" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-5">结语</h4>
<p>MCP 不仅仅是一个技术协议，它代表了 AI 时代工具集成的新思路。通过标准化的接口，我们能够构建更加开放、可扩展的 AI 生态系统。</p>
<p>对于 Flutter 开发者而言，掌握 MCP 意味着能够为 AI 提供移动端的各种能力，从设备信息获取到本地数据处理，都可以通过这种标准化的方式暴露给 AI 使用。</p>
<p>从这个简单的时间服务开始，我们看到了协议设计的智慧、实现的细节、扩展的可能性。这种从简单到复杂、从具体到抽象的学习路径，正是技术成长的最佳方式。</p>
<p>技术的本质不在于复杂性，而在于解决问题的优雅程度。MCP 用简洁的协议解决了复杂的集成问题，这就是技术的魅力：简单的协议，无限的可能。</p>
<p>当我们站在 AI 时代的门槛上，掌握 MCP 这样的基础协议，就像掌握了一把钥匙，能够打开通往未来的大门。</p>
<hr/>
<p>更多文章和视频知识资讯，大家可以关注我的公众号、掘金和 B 站 。让我们一起成长，变得更强。我们下次再见~</p>
<ul>
<li>QQ交流群： 1046304516</li>
<li>掘金账号： <a href="https://juejin.cn/user/149189281194766" title="https://juejin.cn/user/149189281194766" target="_blank">张风捷特烈</a></li>
<li>bilibli 账号： <a href="https://link.juejin.cn/?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" title="https://link.juejin.cn/?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" target="_blank">张风捷特烈</a></li>
<li>公众号： <a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" title="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" target="_blank">编程之王</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 System.Lazy<T>：C#.NET 延迟初始化与线程安全]]></title>    <link>https://juejin.cn/post/7591156262626607139</link>    <guid>https://juejin.cn/post/7591156262626607139</guid>    <pubDate>2026-01-04T23:39:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591156262626607139" data-draft-id="7591330139083653135" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 System.Lazy&lt;T&gt;：C#.NET 延迟初始化与线程安全"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2026-01-04T23:39:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 System.Lazy&lt;T&gt;：C#.NET 延迟初始化与线程安全
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T23:39:28.000Z" title="Sun Jan 04 2026 23:39:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">什么是 <code>Lazy&lt;T&gt;</code>？</h3>
<p><code>System.Lazy&lt;T&gt;</code> 是 <code>.NET Framework 4.0</code> 引入（位于 <code>System</code> 命名空间）的泛型类，用于实现线程安全的延迟初始化（<code>Lazy Initialization</code>）。它确保一个昂贵的对象或资源只在第一次真正需要时才被创建，并且在多线程环境下保证初始化只发生一次。</p>
<ul>
<li>
<p>核心特性：</p>
<ul>
<li>
<p>延迟计算：值的创建被推迟到第一次访问 <code>.Value</code> 属性时。</p>
</li>
<li>
<p>线程安全：内置多种线程安全模式，默认情况下完全线程安全。</p>
</li>
<li>
<p>异常缓存：如果初始化过程中抛出异常，后续访问会重复抛出同一个异常（不重复执行工厂方法）。</p>
</li>
<li>
<p>值缓存：一旦初始化完成，后续所有访问都返回同一个实例（单例行为）。</p>
</li>
</ul>
</li>
<li>
<p>适用场景：</p>
<ul>
<li>
<p>昂贵资源初始化（如数据库连接、大文件加载、复杂计算）。</p>
</li>
<li>
<p>配置对象、单例模式（比双检查锁更安全简洁）。</p>
</li>
<li>
<p>避免启动时不必要的开销（尤其在某些代码路径可能不使用该对象时）。</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-1">为什么使用 <code>Lazy&lt;T&gt;</code>？</h3>
<p>传统方式（如直接在字段初始化或手动双检查锁）存在问题：</p>
<ul>
<li>
<p>提前初始化：浪费资源。</p>
</li>
<li>
<p>手动锁：易出错（死锁、竞争条件、<code>ABA</code> 问题）。</p>
</li>
<li>
<p>异常处理复杂：需手动缓存异常。</p>
</li>
</ul>
<p><code>Lazy&lt;T&gt;</code>性能优化：按需初始化。</p>
<ul>
<li>
<p>线程安全：微软高度优化，无锁或轻量锁实现。</p>
</li>
<li>
<p>代码简洁：一行代码取代复杂的双检查锁。</p>
</li>
<li>
<p>防 <code>ABA</code>：内部使用复合状态 + <code>CAS</code> 机制，彻底避免 <code>ABA</code> 问题。 完美解决这些问题：</p>
</li>
</ul>
<h3 data-id="heading-2">如何使用 <code>Lazy&lt;T&gt;</code>？</h3>
<h4 data-id="heading-3">核心语法与属性</h4>





























<table><thead><tr><th>成员</th><th>作用</th></tr></thead><tbody><tr><td><code>Lazy&lt;T&gt;()</code></td><td>构造函数：默认使用<code>T</code>的无参构造创建对象，线程安全模式为<code>ExecutionAndPublication</code></td></tr><tr><td><code>Lazy&lt;T&gt;(Func&lt;T&gt; valueFactory)</code></td><td>构造函数：自定义对象创建逻辑（支持传参、复杂初始化）</td></tr><tr><td><code>Lazy&lt;T&gt;(LazyThreadSafetyMode mode)</code></td><td>构造函数：指定线程安全模式</td></tr><tr><td><code>Value</code></td><td>核心属性：首次访问触发对象初始化，后续访问返回已创建的实例（只读）</td></tr><tr><td><code>IsValueCreated</code></td><td>布尔属性：判断对象是否已完成初始化</td></tr></tbody></table>
<h4 data-id="heading-4">基础示例（默认构造）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-comment">// 模拟创建成本高的对象（如加载配置、连接数据库）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExpensiveObject</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ExpensiveObject</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">"ExpensiveObject 开始初始化（耗时操作）..."</span>);
        Thread.Sleep(<span class="hljs-number">2000</span>); <span class="hljs-comment">// 模拟2秒耗时初始化</span>
        Console.WriteLine(<span class="hljs-string">"ExpensiveObject 初始化完成！"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoWork</span>()</span> =&gt; Console.WriteLine(<span class="hljs-string">"ExpensiveObject 执行业务逻辑..."</span>);
}

<span class="hljs-keyword">class</span> <span class="hljs-title">LazyBasicDemo</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">"程序启动，创建Lazy&lt;ExpensiveObject&gt;实例..."</span>);
        <span class="hljs-comment">// 此时仅创建Lazy&lt;T&gt;容器，ExpensiveObject并未实例化</span>
        Lazy&lt;ExpensiveObject&gt; lazyObj = <span class="hljs-keyword">new</span> Lazy&lt;ExpensiveObject&gt;();

        Console.WriteLine(<span class="hljs-string">$"对象是否已创建：<span class="hljs-subst">{lazyObj.IsValueCreated}</span>"</span>); <span class="hljs-comment">// 输出：False</span>

        <span class="hljs-comment">// 首次访问Value：触发ExpensiveObject的构造函数</span>
        Console.WriteLine(<span class="hljs-string">"\n=== 首次访问Value ==="</span>);
        lazyObj.Value.DoWork();
        Console.WriteLine(<span class="hljs-string">$"对象是否已创建：<span class="hljs-subst">{lazyObj.IsValueCreated}</span>"</span>); <span class="hljs-comment">// 输出：True</span>

        <span class="hljs-comment">// 再次访问Value：直接返回已创建的实例，不再初始化</span>
        Console.WriteLine(<span class="hljs-string">"\n=== 再次访问Value ==="</span>);
        lazyObj.Value.DoWork();
    }
}
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-ini" lang="ini">程序启动，创建Lazy&lt;ExpensiveObject&gt;实例...
对象是否已创建：<span class="hljs-attr">False</span>

=== 首次访问<span class="hljs-attr">Value</span> ===
ExpensiveObject 开始初始化（耗时操作）...
ExpensiveObject 初始化完成！
ExpensiveObject 执行业务逻辑...
对象是否已创建：<span class="hljs-attr">True</span>

=== 再次访问<span class="hljs-attr">Value</span> ===
ExpensiveObject 执行业务逻辑...
</code></pre>
<h4 data-id="heading-5">自定义工厂方法（带参数初始化）</h4>
<p>若对象需要传参或复杂初始化逻辑，使用 <code>Func&lt;T&gt;</code> 工厂方法：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 自定义带参数的对象构造</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ConfigObject</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> _configPath;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConfigObject</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> configPath</span>)</span>
    {
        _configPath = configPath;
        Console.WriteLine(<span class="hljs-string">$"加载配置文件：<span class="hljs-subst">{configPath}</span>"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetConfig</span>()</span> =&gt; <span class="hljs-string">$"配置内容（来自<span class="hljs-subst">{_configPath}</span>）"</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title">LazyFactoryDemo</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-comment">// 自定义工厂方法：创建ConfigObject并传入参数</span>
        Lazy&lt;ConfigObject&gt; lazyConfig = <span class="hljs-keyword">new</span> Lazy&lt;ConfigObject&gt;(() =&gt; 
        {
            Console.WriteLine(<span class="hljs-string">"执行自定义工厂方法..."</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConfigObject(<span class="hljs-string">"appsettings.json"</span>);
        });

        Console.WriteLine(<span class="hljs-string">"首次访问配置："</span>);
        Console.WriteLine(lazyConfig.Value.GetConfig()); <span class="hljs-comment">// 触发工厂方法</span>
    }
}
</code></pre>
<h4 data-id="heading-6"><code>Lazy&lt;T&gt;</code> 的线程安全模式</h4>
<p><code>Lazy&lt;T&gt;</code> 的关键特性是支持多线程场景，通过 <code>LazyThreadSafetyMode</code> 枚举控制线程安全行为</p>





























<table><thead><tr><th>线程安全模式</th><th>适用场景</th><th>核心行为</th><th>性能</th></tr></thead><tbody><tr><td><code>None</code></td><td>单线程环境</td><td>无线程安全保障，多线程同时访问<code>Value</code>可能创建多个实例</td><td>最高（无锁）</td></tr><tr><td><code>PublicationOnly</code></td><td>多线程 + 对象创建成本低</td><td>多线程可同时初始化，但最终仅保留一个实例（其他实例被丢弃），无锁阻塞</td><td>高</td></tr><tr><td><code>ExecutionAndPublication</code>（默认）</td><td>多线程 + 对象创建成本高</td><td>加锁保证只有一个线程执行初始化，其他线程等待，绝对单实例</td><td/></tr></tbody></table>
<p>示例：多线程下的线程安全模式</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyThreadSafetyDemo</span>
{
    <span class="hljs-comment">// 默认模式：ExecutionAndPublication（加锁保证单实例）</span>
    <span class="hljs-keyword">static</span> Lazy&lt;ExpensiveObject&gt; lazySafeObj = <span class="hljs-keyword">new</span> Lazy&lt;ExpensiveObject&gt;();

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AccessLazyObj</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">$"线程<span class="hljs-subst">{Thread.CurrentThread.ManagedThreadId}</span> 尝试访问Value..."</span>);
        <span class="hljs-keyword">var</span> obj = lazySafeObj.Value;
        Console.WriteLine(<span class="hljs-string">$"线程<span class="hljs-subst">{Thread.CurrentThread.ManagedThreadId}</span> 获取对象HashCode：<span class="hljs-subst">{obj.GetHashCode()}</span>"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-comment">// 启动5个线程同时访问</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)
        {
            <span class="hljs-keyword">new</span> Thread(AccessLazyObj).Start();
        }
        Thread.Sleep(<span class="hljs-number">3000</span>); <span class="hljs-comment">// 等待所有线程完成</span>
    }
}
</code></pre>
<p>输出结果</p>
<p>所有线程最终获取的 <code>HashCode</code> 完全相同，且仅触发一次初始化（证明单实例）：</p>
<pre><code class="hljs language-csharp" lang="csharp">线程<span class="hljs-number">3</span> 尝试访问Value...
ExpensiveObject 开始初始化（耗时操作）...
线程<span class="hljs-number">4</span> 尝试访问Value...
线程<span class="hljs-number">5</span> 尝试访问Value...
线程<span class="hljs-number">6</span> 尝试访问Value...
线程<span class="hljs-number">7</span> 尝试访问Value...
ExpensiveObject 初始化完成！
线程<span class="hljs-number">3</span> 获取对象HashCode：<span class="hljs-number">46104728</span>
线程<span class="hljs-number">4</span> 获取对象HashCode：<span class="hljs-number">46104728</span>
线程<span class="hljs-number">5</span> 获取对象HashCode：<span class="hljs-number">46104728</span>
线程<span class="hljs-number">6</span> 获取对象HashCode：<span class="hljs-number">46104728</span>
线程<span class="hljs-number">7</span> 获取对象HashCode：<span class="hljs-number">46104728</span>
</code></pre>
<h3 data-id="heading-7">高级应用场景</h3>
<h4 data-id="heading-8">懒加载单例模式</h4>
<p><code>Lazy&lt;T&gt;</code> 是 <code>.NET</code> 中实现线程安全、懒加载单例的最优方式：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LazySingleton</span>
{
    <span class="hljs-comment">// 私有静态Lazy实例：延迟初始化，默认线程安全</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Lazy&lt;LazySingleton&gt; _lazyInstance = <span class="hljs-keyword">new</span> Lazy&lt;LazySingleton&gt;(() =&gt; <span class="hljs-keyword">new</span> LazySingleton());

    <span class="hljs-comment">// 私有构造函数：禁止外部实例化</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">LazySingleton</span>()</span> 
    {
        Console.WriteLine(<span class="hljs-string">"单例对象初始化..."</span>);
    }

    <span class="hljs-comment">// 公共属性：首次访问时创建实例</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySingleton Instance =&gt; _lazyInstance.Value;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoBusiness</span>()</span> =&gt; Console.WriteLine(<span class="hljs-string">"单例对象执行业务逻辑..."</span>);
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDemo</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">"程序启动，未访问单例..."</span>);
        <span class="hljs-comment">// 首次访问Instance：触发单例初始化</span>
        LazySingleton.Instance.DoBusiness();
        <span class="hljs-comment">// 再次访问：直接返回已创建的实例</span>
        LazySingleton.Instance.DoBusiness();
    }
}
</code></pre>
<h4 data-id="heading-9">处理初始化异常</h4>
<p>若 <code>Lazy&lt;T&gt;</code> 的工厂方法抛出异常，后续访问 <code>Value</code> 会缓存并重新抛出同一异常</p>
<pre><code class="hljs language-csharp" lang="csharp">Lazy&lt;ExpensiveObject&gt; lazyErrorObj = <span class="hljs-keyword">new</span> Lazy&lt;ExpensiveObject&gt;(() =&gt;
{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"初始化失败：配置文件不存在！"</span>);
});

<span class="hljs-keyword">try</span>
{
    <span class="hljs-comment">// 首次访问：抛出异常</span>
    lazyErrorObj.Value.DoWork();
}
<span class="hljs-keyword">catch</span> (AggregateException ex)
{
    Console.WriteLine(<span class="hljs-string">$"初始化异常：<span class="hljs-subst">{ex.InnerException.Message}</span>"</span>);
}

<span class="hljs-keyword">try</span>
{
    <span class="hljs-comment">// 再次访问：仍抛出同一异常（异常被缓存）</span>
    lazyErrorObj.Value.DoWork();
}
<span class="hljs-keyword">catch</span> (AggregateException ex)
{
    Console.WriteLine(<span class="hljs-string">$"再次访问异常：<span class="hljs-subst">{ex.InnerException.Message}</span>"</span>);
}
</code></pre>
<h4 data-id="heading-10">异步懒加载（伪 AsyncLazy）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Lazy&lt;Task&lt;ExpensiveObject&gt;&gt; _asyncResource = <span class="hljs-keyword">new</span>(<span class="hljs-keyword">async</span> () =&gt;
{
    <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">2000</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExpensiveObject();
});

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ExpensiveObject&gt; <span class="hljs-title">GetResourceAsync</span>()</span> =&gt; <span class="hljs-keyword">await</span> _asyncResource.Value;
</code></pre>
<h4 data-id="heading-11">支持刷新（Reset）的自定义包装</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RefreshableLazy</span>&lt;<span class="hljs-title">T</span>&gt;
{
    <span class="hljs-keyword">private</span> Lazy&lt;T&gt; _current;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RefreshableLazy</span>(<span class="hljs-params">Func&lt;T&gt; factory</span>)</span>
    {
        _current = <span class="hljs-keyword">new</span> Lazy&lt;T&gt;(factory);
    }

    <span class="hljs-keyword">public</span> T Value =&gt; _current.Value;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Refresh</span>()</span>
    {
        <span class="hljs-keyword">var</span> factory = _current.Value; <span class="hljs-comment">// 保留旧工厂？或传入新工厂</span>
        _current = <span class="hljs-keyword">new</span> Lazy&lt;T&gt;(_current.Factory); <span class="hljs-comment">// 重新创建</span>
    }
}
</code></pre>
<h4 data-id="heading-12">与依赖注入结合（ASP.NET Core）</h4>
<pre><code class="hljs language-csharp" lang="csharp">services.AddSingleton&lt;ExpensiveService&gt;();
services.AddSingleton&lt;Lazy&lt;ExpensiveService&gt;&gt;(provider =&gt; 
    <span class="hljs-keyword">new</span> Lazy&lt;ExpensiveService&gt;(provider.GetRequiredService&lt;ExpensiveService&gt;));
</code></pre>
<h4 data-id="heading-13">配置文件加载</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Lazy&lt;AppConfig&gt; _instance = 
        <span class="hljs-keyword">new</span> Lazy&lt;AppConfig&gt;(LoadConfiguration);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AppConfig Instance =&gt; _instance.Value;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ConnectionString { <span class="hljs-keyword">get</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Timeout { <span class="hljs-keyword">get</span>; }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">AppConfig</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> config</span>)</span>
    {
        <span class="hljs-comment">// 解析配置</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AppConfig <span class="hljs-title">LoadConfiguration</span>()</span>
    {
        <span class="hljs-built_in">string</span> configData = File.ReadAllText(<span class="hljs-string">"config.json"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AppConfig(configData);
    }
}
</code></pre>
<h3 data-id="heading-14"><code>Lazy&lt;T&gt;</code> vs 手动懒加载</h3>
<p>手动实现线程安全的懒加载需要写双重检查锁定（易出错），而 <code>Lazy&lt;T&gt;</code> 已封装所有逻辑：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 手动实现（线程安全，需双重检查+volatile）</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> ExpensiveObject _manualObj;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _lockObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();
<span class="hljs-keyword">public</span> ExpensiveObject ManualObj
{
    <span class="hljs-keyword">get</span>
    {
        <span class="hljs-keyword">if</span> (_manualObj == <span class="hljs-literal">null</span>)
        {
            <span class="hljs-keyword">lock</span> (_lockObj)
            {
                <span class="hljs-keyword">if</span> (_manualObj == <span class="hljs-literal">null</span>)
                {
                    _manualObj = <span class="hljs-keyword">new</span> ExpensiveObject();
                }
            }
        }
        <span class="hljs-keyword">return</span> _manualObj;
    }
}

<span class="hljs-comment">// Lazy&lt;T&gt;实现（一行搞定，线程安全）</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Lazy&lt;ExpensiveObject&gt; _lazyObj = <span class="hljs-keyword">new</span> Lazy&lt;ExpensiveObject&gt;();
<span class="hljs-keyword">public</span> ExpensiveObject LazyObj =&gt; _lazyObj.Value;
</code></pre>
<h3 data-id="heading-15"><code>Lazy&lt;T&gt;</code> 内部实现原理（简要）</h3>
<ul>
<li>
<p>使用一个私有字段（如 <code>object? _box</code>）存储状态：</p>
<ul>
<li>
<p><code>null</code>：未初始化</p>
</li>
<li>
<p><code>Box&lt;T&gt;</code>：已完成（包含值）</p>
</li>
<li>
<p>异常对象：初始化失败</p>
</li>
</ul>
</li>
<li>
<p>初始化时使用 <code>Interlocked.CompareExchange</code> 进行原子状态转换。</p>
</li>
<li>
<p>内部状态机结合版本机制，彻底防止 <code>ABA</code> 问题。</p>
</li>
<li>
<p><code>ExecutionAndPublication</code> 模式下使用轻量自旋 + 等待机制，确保只有一个线程执行工厂方法。</p>
</li>
</ul>
<h3 data-id="heading-16">优点与缺点</h3>



































<table><thead><tr><th>方面</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>线程安全</strong></td><td>内置完美支持，防 ABA、防重复初始化</td><td>None 模式下需手动注意</td></tr><tr><td><strong>易用性</strong></td><td>代码极简，一行搞定</td><td>不支持主动 Reset（需自定义包装）</td></tr><tr><td><strong>性能</strong></td><td>高度优化，无锁路径极快</td><td>第一次访问可能阻塞（但这是延迟初始化的本质）</td></tr><tr><td><strong>功能</strong></td><td>异常缓存、值缓存、IsValueCreated 查询</td><td>不支持异步初始化（需用 Lazy&lt;Task&gt;）</td></tr><tr><td><strong>适用性</strong></td><td>几乎所有懒加载场景的首选</td><td>若需支持刷新/重置，需额外封装</td></tr></tbody></table>
<h3 data-id="heading-17">最佳实践</h3>
<ul>
<li>
<p>优先使用 <code>Lazy&lt;T&gt;</code> 替代手动双检查锁。</p>
</li>
<li>
<p>始终使用默认线程安全模式（除非明确需要 <code>PublicationOnly</code>）。</p>
</li>
<li>
<p>工厂方法应无副作用（尤其在 <code>PublicationOnly</code> 模式下）。</p>
</li>
<li>
<p>异常处理：捕获 <code>.Value</code> 抛出的异常。</p>
</li>
<li>
<p>不要在工厂方法中访问同一个 <code>Lazy</code> 实例（可能死锁）。</p>
</li>
</ul>
<h3 data-id="heading-18">总结</h3>
<ul>
<li>
<p><code>System.Lazy&lt;T&gt;</code> 是 <code>.NET</code> 官方的延迟初始化工具，核心是首次访问 <code>Value</code> 时创建对象，提升程序启动速度和内存效率；</p>
</li>
<li>
<p>核心属性：<code>Value</code>（触发初始化）、<code>IsValueCreated</code>（判断是否已创建）；</p>
</li>
<li>
<p>线程安全模式需按需选择：单线程用 <code>None</code>，多线程高成本对象用默认的<code>ExecutionAndPublication</code>；</p>
</li>
<li>
<p>最优场景：创建成本高 / 不一定使用的对象、懒加载单例模式；</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[爆款拆解与实现：动态画出物理线条，手把手教你制作“画线救狗”]]></title>    <link>https://juejin.cn/post/7591317772074762259</link>    <guid>https://juejin.cn/post/7591317772074762259</guid>    <pubDate>2026-01-05T00:01:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591317772074762259" data-draft-id="7591334602427465791" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="爆款拆解与实现：动态画出物理线条，手把手教你制作“画线救狗”"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-05T00:01:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            爆款拆解与实现：动态画出物理线条，手把手教你制作“画线救狗”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:01:34.000Z" title="Mon Jan 05 2026 00:01:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14b70c6127ad4480a1284a8b63dc0d5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=khfIBT7jkhJZEaTA7TH8VQis3Ms%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，不知道小伙伴们有没有见过上面这款游戏？</p>
<p><strong>这款游戏</strong>在买量题材中相当火爆，很多热门商业游戏中都添加了同款玩法，然后通过该玩法制作广告素材进行买量。</p>
<p><strong>出场率</strong>如此高的游戏，笔者好奇在<strong>Cocos游戏开发</strong>中应该如何实现呢？</p>
<p><strong>言归正传</strong>，小伙伴们跟随笔者，一起来看看<strong>在Cocos游戏开发中，如何实现画线救狗的玩法</strong>。</p>
<p><strong>本文</strong>收录于<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">《亿元Cocos小游戏实战合集》</a>，欢迎小伙伴们点赞推荐订阅转发。</p>
<p><strong>本文实战源码可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">1. 拆解一下游戏</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c732444305564557ac1da78a751917de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=GJQZrBRTieibQ8fLCgV0ZzIzxtk%3D" alt="" loading="lazy"/></p>
<p><strong>我们</strong>先来拆解一下实现这个游戏有哪些关键点：</p>
<ol>
<li>
<p><strong>画线</strong>：游戏的核心功能，就是在屏幕上画出任意形状的线，画完后会产生物理效果，保护狗狗，防止狗狗掉落和被蜜蜂攻击。</p>
</li>
<li>
<p><strong>狗狗</strong>：游戏的主角，我们要通过画线对它进行保护，狗狗在倒计时结束后未掉落和被蜜蜂攻击即可通关，否则失败。</p>
</li>
<li>
<p><strong>蜜蜂</strong>：不停地朝着狗狗的方向进攻，碰撞到线后，尝试后退再继续进攻。</p>
</li>
<li>
<p><strong>蜂巢</strong>：蜜蜂出发的地方，在这里面实例化指定数量的蜜蜂。</p>
</li>
</ol>
<h2 data-id="heading-2">2. 怎么实现？</h2>
<h3 data-id="heading-3">1.画线</h3>
<p><strong>一看到画线</strong>，第一时间就要想到<code>Graphics</code>组件，通过它再搭配我们的触摸事件，即可在屏幕上画出各种各样的线条。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be61b8378c7e4f42a070618bc19201cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=nsIWCFh3knYT59JTabNJCb79BaU%3D" alt="来源于Cocos官方文档" loading="lazy"/></p>
<p><strong>画线完成后</strong>，线的主要作用是保护狗狗，防止狗狗掉落和被蜜蜂攻击。我们需要给线增加物理效果(例如受重力影响、和蜜蜂发生碰撞)。</p>
<p><strong>游戏</strong>中的物体，如果想要通过物理系统发生碰撞，我们需要给它加上刚体组件和碰撞组件。</p>
<ul>
<li><strong>刚体组件:</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3da82dbee2e647f0b111673e393bd5f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=ORvl7fO3mrGvgAwPxuliYHbv27g%3D" alt="刚体组件" loading="lazy"/></li>
<li><strong>碰撞组件：</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb2de270aa94ac384b1cedc0f256987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=hUAWueOojxKwq9HqJpzv%2BpYrmeM%3D" alt="碰撞组件" loading="lazy"/></li>
</ul>
<p><strong>由于</strong>线是玩家在游戏过程中实时绘制出来的，而且是不规则的，我们需要在代码中进行动态添加，而且还要分段添加，所以我们需要通过<code>addComponent</code>动态添加。</p>
<h3 data-id="heading-4">2.狗狗</h3>
<p><strong>狗狗</strong>和上面画线的一样，如果想要发生碰撞，同样需要添加刚体和碰撞组件。</p>
<p><strong>想要在代码中</strong>根据碰撞进行相关逻辑处理，可以通过监听碰撞组件的<code>BEGIN_CONTACT</code>事件，例如判断狗狗是否被蜜蜂攻击到和狗狗是否掉到水里。</p>
<p><strong>为了</strong>区分和判断狗狗和不同的物体发生碰撞，我们需要在菜单<code>项目-&gt;项目设置-&gt;物理-&gt;碰撞矩阵</code>中添加碰撞分组，以及编辑他们之间哪些可以发生碰撞。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f60d1f4146e242dba4b279a7e6106890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=RwlNOLjOwbkDciOkmFyjeeoEkO4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3. 蜜蜂</h3>
<p><strong>蜜蜂</strong>的主要逻辑就是进攻狗狗，通过狗狗的位置和自身的位置就能够得到蜜蜂进攻的方向，然后通过<code>applyForceToCenter</code>给蜜蜂添加力，即可让蜜蜂进行运动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fa4dce3ec94423785df187b612d119a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=ZqEcLUeGWWhtQAdLLRwTOMnA70w%3D" alt="" loading="lazy"/></p>
<p><strong>此外</strong>，当蜜蜂碰撞到线时，我们可以做一个后退效果，然后继续进攻，形成不断攻击的效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3de4f85eef0e4e55a97039269cc97549~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=1CdQUbxuLwAgl%2F2cjiO24wEOiqo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">4. 蜂巢</h3>
<p><strong>蜂巢</strong>的逻辑就相对简单了，就是通过计时，定时创建指定数量的蜜蜂，给蜜蜂添加碰撞相关组件，以及控制脚本即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc2966716c7849eba02a58d6c758b218~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=%2BlG0NZ4wHsthnILtwbD9e2KOtVk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">3. 游戏实战</h2>
<h3 data-id="heading-8">1.资源准备</h3>
<p><strong>简单</strong>准备一批游戏所需的资源，包括<code>蜂巢、地板、胜利/失败界面、木头、狗狗、水和蜜蜂</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/865345466b454f2ca27c7a920f6915b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=sOTbrfaTjh3MWNPm0goax4ZOINw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">2.拼UI</h3>
<p><strong>界面</strong>的拼接比较简单，从上到下分别是<code>游戏管理器、画线容器、关卡管理器、倒计时标签、胜利/失败界面</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fd42427e0e049ccb27d29ba12b0f79c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=QiS7vrKYj%2FvxBY%2Bj4NRE4iw8DDI%3D" alt="" loading="lazy"/></p>
<p><strong>关卡</strong>通过预制体进行编辑，在关卡管理器中进行动态加载。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3543e1636ae84d09aadedda603d5409f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=9445tIKbQnOGB8VLKqVhZCxeT5k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">3.写代码</h3>
<p><strong>由于</strong>文章篇幅问题，下面只展示游戏的核心源码，实战完整源码可在文末获取。</p>
<p><strong>(1)画线管理器</strong></p>
<p><strong>首先</strong>通过触摸事件的四大天王进行监听。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d710d60c4f0479ca09e086f97596b40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=VbQfIg5QRK3rLllVmAoI7C2H8q8%3D" alt="" loading="lazy"/></p>
<p><strong>触摸开始时</strong>，创建新节点、添加<code>Graphics</code>组件、画线起点移动到触摸位置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a004ef76141486d8bcf8759cbf7aadd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=8apzAyToJ2Hm233dFEMLgQRwXxM%3D" alt="" loading="lazy"/></p>
<p><strong>触摸移动时</strong>，每移动到一个位置，画线一次，并记录点位。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fd1223838f7450daeca3fff6c95773c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=Cp3yE8hQHzK9XNDRd0B0vjSKNGc%3D" alt="" loading="lazy"/></p>
<p><strong>上述过程</strong>可以进行简单检测，避免频繁画线。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0d0ba3b76b14f8d953221ec67d9b820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=ijjTa%2BwiKWYqoH1qFDL%2BqDVQVBI%3D" alt="" loading="lazy"/></p>
<p><strong>画线结束时</strong>，给记录的所有点位间的线动态添加组件(<strong>核心</strong>)。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/022f315f268c4c4d9dfb4fa8427eb4c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=sD03eSU5%2FJw3UHX2SXHgCsITYLM%3D" alt="" loading="lazy"/></p>
<p><strong>(2)狗狗控制器</strong></p>
<p><strong>通过</strong><code>Contact2DType.BEGIN_CONTACT</code>事件监听碰撞事件，初始状态为<code>Static</code>静止不动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5afca027cc54437bb82b2aaf3341ea62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=OeKpx8gREGcax2lBRpR8MB8XwcA%3D" alt="" loading="lazy"/></p>
<p><strong>通过</strong>名字简单判断碰撞到了哪些物体。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c604a6e5ca44c6381bc24822517e380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=X5fvAmix2YGfjxCTKsukiAvE5QA%3D" alt="" loading="lazy"/></p>
<p><strong>(3)蜜蜂控制器</strong></p>
<p><strong>蜜蜂的进攻</strong>：计算方向向量，施加力，使蜜蜂进行运动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2cabd9760344923b337d0c913215c2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=1H02RHmJppbeKCFKMO4FwTy6g3g%3D" alt="" loading="lazy"/></p>
<p><strong>蜜蜂的后撤</strong>：计算后撤方向，通过<code>linearVelocity</code>线性速度进行后撤。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c61c3f22cf9442c823ebc7c63a72ddb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=frUcuYoiBm8zkHY4tAzzzhdWDTc%3D" alt="" loading="lazy"/></p>
<p><strong>(4)蜂巢控制器</strong></p>
<p><strong>蜜蜂的产生</strong>：创建蜜蜂、添加刚体、添加碰撞体、添加蜜蜂管理器。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e0b5be12de64377aac50f6cc5fbdcf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=wKonoDx37Yf2URqKNAHWkY0K7tY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">4.效果演示</h3>
<p><strong>关卡1</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40d0e692c1fa4f4e9e9b510fba0b9959~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=GUekKdO8qptHvYi7%2B2Nj2cAohZI%3D" alt="" loading="lazy"/></p>
<p><strong>关卡2</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73d1d4fd0c19434faddd0c8daef57f2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768176094&amp;x-signature=09KfKp4O6YSREzA4GsGzwZ4Ne60%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-12">结语</h2>
<p><strong>以上</strong>就是热门买量游戏《画线救狗》的拆解，不知道小伙伴们学废了没有？</p>
<p>本文<strong>实战源码</strong>可通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer"><strong>阅读原文</strong></a>获取。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZIph332u_r24OTY4r6_jow" target="_blank" title="https://mp.weixin.qq.com/s/ZIph332u_r24OTY4r6_jow" ref="nofollow noopener noreferrer">Cocos游戏开发中的贴花效果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前注意加工：让你的图表抓住读者的眼球]]></title>    <link>https://juejin.cn/post/7591350620188999686</link>    <guid>https://juejin.cn/post/7591350620188999686</guid>    <pubDate>2026-01-04T15:08:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620188999686" data-draft-id="7591510742634233919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前注意加工：让你的图表抓住读者的眼球"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-04T15:08:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前注意加工：让你的图表抓住读者的眼球
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:08:56.000Z" title="Sun Jan 04 2026 15:08:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下，你走进一个挤满人的房间，朋友向你招手--你几乎立刻就能看到他。</p>
<p>这是因为“招手”这个动作在你的大脑进行深入思考之前，就已经被注意到了。</p>
<p>再比如当你走在熙熙攘攘的大街上，如果所有人穿的都是黑灰色的大衣，而此时有一个人穿着鲜红色的风衣，你会看哪里？</p>
<p>毫无疑问，你的目光会瞬间被那抹红色吸引。</p>
<p>这就是<strong>前注意加工</strong>：我们的大脑能在极短时间内（约200-250毫秒）自动检测到某些视觉特征，而无需我们有意识地去寻找。</p>
<p>在数据可视化中，<strong>前注意加工</strong>就是我们用来引导读者注意力的“视觉魔术”。</p>
<p>通过巧妙地改变颜色、大小、形状等视觉属性，我们可以让图表中的关键信息（如最大值、最小值、异常值）像朋友招手一样“跳出来”，第一时间抓住读者的眼球。</p>
<h2 data-id="heading-0">1. 前注意加工的实用技巧</h2>
<ol>
<li><strong>少即是多</strong>：不要过度使用突出效果，否则会失去焦点</li>
<li><strong>一致性原则</strong>：在整个报告或仪表板中使用相同的突出颜色编码</li>
<li><strong>考虑色盲用户</strong>：避免仅依靠颜色区分，可结合形状、纹理等</li>
<li><strong>上下文相关</strong>：根据数据特点和观众背景选择合适的突出方式</li>
<li><strong>测试效果</strong>：让其他人查看你的图表，确认突出效果是否达到预期</li>
</ol>
<h2 data-id="heading-1">2. 前注意加工实例</h2>
<p>概念介绍完了，下面直接看代码，看看实际情况下如何使用<strong>前注意加工</strong>来提高我们的可视化效果。</p>
<h3 data-id="heading-2">2.1. 突出最大值和最小值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：突出最大值和最小值</span>
<span class="hljs-comment"># 创建数据</span>
np.random.seed(<span class="hljs-number">42</span>)
categories = [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>, <span class="hljs-string">'E'</span>, <span class="hljs-string">'F'</span>, <span class="hljs-string">'G'</span>, <span class="hljs-string">'H'</span>]
values = np.random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">100</span>, size=<span class="hljs-number">8</span>)

<span class="hljs-comment"># 找出最大值和最小值的索引</span>
max_idx = np.argmax(values)
min_idx = np.argmin(values)

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
bars1 = ax1.bar(categories, values, color=<span class="hljs-string">'lightblue'</span>, edgecolor=<span class="hljs-string">'black'</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出最大最小值）</span>
colors = [<span class="hljs-string">'lightblue'</span>] * <span class="hljs-built_in">len</span>(values)
colors[max_idx] = <span class="hljs-string">'#FF6B6B'</span>  <span class="hljs-comment"># 红色突出最大值</span>
colors[min_idx] = <span class="hljs-string">'#4ECDC4'</span>  <span class="hljs-comment"># 青色突出最小值</span>

bars2 = ax2.bar(categories, values, color=colors, edgecolor=<span class="hljs-string">'black'</span>)

<span class="hljs-comment"># 在最大值和最小值上添加标签</span>
ax2.text(max_idx, values[max_idx] + <span class="hljs-number">2</span>, <span class="hljs-string">f'最大: <span class="hljs-subst">{values[max_idx]}</span>'</span>,
         ha=<span class="hljs-string">'center'</span>, fontweight=<span class="hljs-string">'bold'</span>, color=<span class="hljs-string">'#FF6B6B'</span>)
ax2.text(min_idx, values[min_idx] + <span class="hljs-number">2</span>, <span class="hljs-string">f'最小: <span class="hljs-subst">{values[min_idx]}</span>'</span>,
         ha=<span class="hljs-string">'center'</span>, fontweight=<span class="hljs-string">'bold'</span>, color=<span class="hljs-string">'#4ECDC4'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5b3cfac63c404bae4e199caaea3ea0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=JIDdIdb1RTsmPmZg86kopP8HIEg%3D" alt="" loading="lazy"/></p>
<p>左图中，所有柱子都是相同的蓝色，读者需要逐个比较才能找出最大值和最小值。</p>
<p>右图中，最大值用醒目的红色标出，最小值用青色标出，读者一眼就能看到关键数据点。</p>
<p><strong>前注意加工的好处</strong>：就像在人群中为重要人物戴上特别的帽子，读者无需费力寻找就能立即识别关键数据点。</p>
<h3 data-id="heading-3">2.2. 突出异常值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例2：突出异常值</span>
<span class="hljs-comment"># 创建包含异常值的数据</span>
np.random.seed(<span class="hljs-number">42</span>)
data_normal = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
data_outliers = np.array([<span class="hljs-number">5</span>, <span class="hljs-number">125</span>, <span class="hljs-number">130</span>])  <span class="hljs-comment"># 异常值</span>
all_data = np.concatenate([data_normal, data_outliers])

<span class="hljs-comment"># 识别异常值（简单方法：超出平均值±2倍标准差）</span>
mean_val = np.mean(all_data)
std_val = np.std(all_data)
outlier_indices = np.where((all_data &lt; mean_val - <span class="hljs-number">2</span>*std_val) | (all_data &gt; mean_val + <span class="hljs-number">2</span>*std_val))[<span class="hljs-number">0</span>]

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
scatter1 = ax1.scatter(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_data)), all_data, alpha=<span class="hljs-number">0.7</span>, c=<span class="hljs-string">'gray'</span>, s=<span class="hljs-number">50</span>)
ax1.axhline(y=mean_val, color=<span class="hljs-string">'black'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">f'平均值: <span class="hljs-subst">{mean_val:<span class="hljs-number">.1</span>f}</span>'</span>)
ax1.axhline(y=mean_val + <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">'±2标准差'</span>)
ax1.axhline(y=mean_val - <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出异常值）</span>
colors = [<span class="hljs-string">'gray'</span>] * <span class="hljs-built_in">len</span>(all_data)
sizes = [<span class="hljs-number">50</span>] * <span class="hljs-built_in">len</span>(all_data)

<span class="hljs-comment"># 突出异常值</span>
<span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> outlier_indices:
    colors[idx] = <span class="hljs-string">'#FF6B6B'</span>  <span class="hljs-comment"># 红色</span>
    sizes[idx] = <span class="hljs-number">150</span>  <span class="hljs-comment"># 更大</span>

scatter2 = ax2.scatter(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_data)), all_data, alpha=<span class="hljs-number">0.7</span>, c=colors, s=sizes)
ax2.axhline(y=mean_val, color=<span class="hljs-string">'black'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">f'平均值: <span class="hljs-subst">{mean_val:<span class="hljs-number">.1</span>f}</span>'</span>)
ax2.axhline(y=mean_val + <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">'±2标准差'</span>)
ax2.axhline(y=mean_val - <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75dae986c53b4fb0ad21e5223e0e7c26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=VsBftwhA5%2BeJlU93WsU0Gjv%2BE1o%3D" alt="" loading="lazy"/></p>
<p>左图中，异常值混在普通数据点中，难以立即识别。</p>
<p>右图中，异常值用更大的红色点突出显示，即使数据量很大，读者也能立即注意到这些特殊点。</p>
<p><strong>前注意加工的好处</strong>：就像在平静湖面上标记出涟漪的起源，异常值不再隐藏在数据海洋中，而是成为分析的重点。</p>
<h3 data-id="heading-4">2.3. 突出趋势变化点</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例3：突出趋势变化点</span>
<span class="hljs-comment"># 创建包含趋势变化的时间序列数据</span>
np.random.seed(<span class="hljs-number">42</span>)
time_points = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>)
trend_change_point = <span class="hljs-number">45</span>

<span class="hljs-comment"># 分段创建趋势数据</span>
trend1 = <span class="hljs-number">30</span> + <span class="hljs-number">0.5</span> * np.arange(<span class="hljs-number">0</span>, trend_change_point) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, trend_change_point)
trend2 = trend1[-<span class="hljs-number">1</span>] - <span class="hljs-number">0.8</span> * np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">100</span> - trend_change_point) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">100</span> - trend_change_point)
data = np.concatenate([trend1, trend2])

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
line1 = ax1.plot(time_points, data, color=<span class="hljs-string">'gray'</span>, alpha=<span class="hljs-number">0.8</span>, linewidth=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出趋势变化点）</span>
line2 = ax2.plot(time_points, data, color=<span class="hljs-string">'gray'</span>, alpha=<span class="hljs-number">0.6</span>, linewidth=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 突出趋势变化区域</span>
ax2.axvspan(trend_change_point-<span class="hljs-number">5</span>, trend_change_point+<span class="hljs-number">5</span>, alpha=<span class="hljs-number">0.3</span>, color=<span class="hljs-string">'#FF6B6B'</span>, label=<span class="hljs-string">'趋势变化区域'</span>)
ax2.scatter(trend_change_point, data[trend_change_point], color=<span class="hljs-string">'#FF6B6B'</span>, s=<span class="hljs-number">200</span>, zorder=<span class="hljs-number">5</span>, label=<span class="hljs-string">'变化点'</span>)
ax2.plot(time_points[:trend_change_point+<span class="hljs-number">1</span>], data[:trend_change_point+<span class="hljs-number">1</span>], color=<span class="hljs-string">'#4ECDC4'</span>, linewidth=<span class="hljs-number">3</span>, alpha=<span class="hljs-number">0.8</span>, label=<span class="hljs-string">'上升趋势'</span>)
ax2.plot(time_points[trend_change_point:], data[trend_change_point:], color=<span class="hljs-string">'#45B7D1'</span>, linewidth=<span class="hljs-number">3</span>, alpha=<span class="hljs-number">0.8</span>, label=<span class="hljs-string">'下降趋势'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8a2dbd998f5473984e0e6bd5ff15826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=RkX6bbP4BvgBLbvQevTRxvaJcIw%3D" alt="" loading="lazy"/></p>
<p>左图展示了一个完整的趋势线，但变化点不明显。</p>
<p>右图使用不同颜色区分趋势段，并用阴影区域和突出点标记变化区域，使趋势转折一目了然。</p>
<p><strong>前注意加工的好处</strong>：就像在道路地图上标记出转弯处，读者能立即看到趋势变化的关键时刻。</p>
<h3 data-id="heading-5">2.4. 突出特定类别</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例4：突出特定类别</span>
<span class="hljs-comment"># 创建饼图数据</span>
categories = [<span class="hljs-string">"电子产品"</span>, <span class="hljs-string">"服装"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"家居"</span>, <span class="hljs-string">"书籍"</span>, <span class="hljs-string">"其他"</span>]
values = [<span class="hljs-number">25</span>, <span class="hljs-number">18</span>, <span class="hljs-number">22</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>]
highlight_category = <span class="hljs-string">"食品"</span>  <span class="hljs-comment"># 要突出的类别</span>
highlight_idx = categories.index(highlight_category)

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
colors1 = [<span class="hljs-string">"#FF9AA2"</span>, <span class="hljs-string">"#FFB7B2"</span>, <span class="hljs-string">"#FFDAC1"</span>, <span class="hljs-string">"#E2F0CB"</span>, <span class="hljs-string">"#B5EAD7"</span>, <span class="hljs-string">"#C7CEEA"</span>]
wedges1, texts1, autotexts1 = ax1.pie(
    values, labels=categories, autopct=<span class="hljs-string">"%1.1f%%"</span>, colors=colors1, startangle=<span class="hljs-number">90</span>
)

<span class="hljs-comment"># 右图：有前注意加工（突出特定类别）</span>
<span class="hljs-comment"># 将突出类别的颜色改为醒目的颜色，其他类别用灰度</span>
colors2 = [<span class="hljs-string">"lightgray"</span>] * <span class="hljs-built_in">len</span>(categories)
colors2[highlight_idx] = <span class="hljs-string">"#FF6B6B"</span>  <span class="hljs-comment"># 突出类别用红色</span>

<span class="hljs-comment"># 突出显示：将特定类别"拉出"</span>
explode = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(categories)
explode[highlight_idx] = <span class="hljs-number">0.1</span>

wedges2, texts2, autotexts2 = ax2.pie(
    values,
    labels=categories,
    autopct=<span class="hljs-string">"%1.1f%%"</span>,
    colors=colors2,
    explode=explode,
    startangle=<span class="hljs-number">90</span>,
)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27631577fe6442ff87cb3febe019a2d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=VVXo4UpyLMdw0BnGAD4q02R1Q1g%3D" alt="" loading="lazy"/></p>
<p>左图中，所有类别视觉权重相同，读者需要阅读标签或百分比才能找到特定类别。</p>
<p>右图中，目标类别被"拉出"并用醒目的红色显示，其他类别则用灰色淡化，读者一眼就能看到重点。</p>
<p><strong>前注意加工的好处</strong>：就像在合唱团中为独唱者打上聚光灯，特定类别立即成为视觉焦点。</p>
<p>同样，在绘制<strong>多条折线图</strong>（也就是俗称的“面条图”）时，如果每条线都用高饱和度的颜色，画面会非常混乱，读者不知道该看哪一条。</p>
<p>也可以用上面饼图类似的思路，降低非重点数据的<strong>不透明度</strong>（<code>Alpha</code>）和<strong>线宽</strong>（<code>Linewidth</code>），只保留重点数据的鲜明样式。</p>
<p>这就像舞台上的聚光灯，灯光打在哪里，观众就看哪里。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 模拟时间序列数据</span>
x = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
<span class="hljs-comment"># 生成5条干扰线</span>
lines = [np.sin(x + i) * (<span class="hljs-number">1</span> + i/<span class="hljs-number">10</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]
<span class="hljs-comment"># 生成1条重点线（比如这是我们公司的产品）</span>
main_line = np.sin(x) * <span class="hljs-number">2.5</span> + <span class="hljs-number">1</span>

fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># --- 图1：没有前注意加工 ---</span>
<span class="hljs-comment"># 典型的面条图，所有线都在争夺注意力</span>
<span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(lines):
    ax1.plot(x, line, label=<span class="hljs-string">f'Competitor <span class="hljs-subst">{i}</span>'</span>)
ax1.plot(x, main_line, label=<span class="hljs-string">'Our Product'</span>)

<span class="hljs-comment"># --- 图2：有前注意加工 ---</span>
<span class="hljs-comment"># 策略：弱化背景，突出前景</span>
<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
    ax1.plot(x, line) <span class="hljs-comment"># 左图逻辑</span>
    <span class="hljs-comment"># 右图逻辑：灰色、细线、半透明</span>
    ax2.plot(x, line, color=<span class="hljs-string">'lightgray'</span>, linewidth=<span class="hljs-number">1</span>, alpha=<span class="hljs-number">0.6</span>)

<span class="hljs-comment"># 重点线：深青色、加粗、不透明</span>
ax2.plot(x, main_line, color=<span class="hljs-string">'teal'</span>, linewidth=<span class="hljs-number">3</span>, label=<span class="hljs-string">'Our Product'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b88a68d04722404b8e0a02299f04e02c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=BT2qL1g8H2ysRLSUQpqaDEdFmBk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">3. 总结</h2>
<p><strong>前注意加工</strong>是数据可视化中的"视觉语法"，它通过预认知的视觉特征引导读者的注意力。</p>
<p>就像熟练的导游会指出风景中的亮点，有效的数据可视化应该引导读者立即看到数据故事中<strong>最关键</strong>的部分。</p>
<p>数据可视化不仅仅是把数据画出来，更是一场<strong>注意力的管理艺术</strong>。</p>
<ul>
<li><strong>不要让读者的眼睛去“工作”</strong>：如果他们需要花好几秒钟去找最大值，那是我们设计者的失职。</li>
<li><strong>利用对比</strong>：颜色（亮/暗）、大小（大/小）、位置（前/后），这些物理属性的对比能瞬间触发大脑的“系统1”（直觉系统）。</li>
</ul>
<p>下次使用 <code>Matplotlib</code> 绘图时，在 <code>plt.show()</code> 之前，请停下来问自己一个问题：“<strong>我这张图里，最想让读者第一眼看到的是什么？</strong>”</p>
<p>一旦确定了答案，就请大胆地使用上述技巧，把它“推”到读者眼前吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[事件循环介绍]]></title>    <link>https://juejin.cn/post/7591130604430213160</link>    <guid>https://juejin.cn/post/7591130604430213160</guid>    <pubDate>2026-01-04T15:11:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591130604430213160" data-draft-id="7591330139083587599" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="事件循环介绍"/> <meta itemprop="keywords" content="FastAPI"/> <meta itemprop="datePublished" content="2026-01-04T15:11:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            事件循环介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:11:06.000Z" title="Sun Jan 04 2026 15:11:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">事件循环（Event Loop）的“电梯”比喻</h2>
<p>把单线程 CPU 想成<strong>一部只载一人的电梯</strong>：</p>
<ul>
<li>电梯里一次只能运行一个人（同步函数）</li>
<li>但大楼里 1000 个人都要去不同楼层（I/O 操作：网络、文件、数据库 …）</li>
<li>如果每个人“自己开电梯”→ 电梯空跑、人堵门口，效率极低</li>
</ul>
<p>事件循环就是**“电梯调度员”**：</p>
<ol>
<li>把整栋楼的所有“上下楼请求”登记到一张<strong>任务清单</strong></li>
<li>电梯每次只拉一个“能立刻出发”的人</li>
<li>当某人按下“去 15 楼”按钮后，电梯<strong>不会傻等他走到 15 楼再回来</strong>，而是
<ul>
<li>把“到达 15 楼后的事”写进清单（回调 / Future）</li>
<li>立刻拉下一位就绪的人</li>
</ul>
</li>
<li>15 楼按钮亮起（I/O 完成）→ 调度员再把“后续任务”重新塞进电梯</li>
</ol>
<p>结果：一部电梯（单线程）<strong>在任意时刻都载着“就绪”的人</strong>，
而“等人”的时间被拿去干别的事，<strong>宏观上 1000 个人同时移动</strong>——这就是并发。</p>
<hr/>
<h2 data-id="heading-1">技术映射</h2>





























<table><thead><tr><th>比喻</th><th>真实术语</th></tr></thead><tbody><tr><td>任务清单</td><td>就绪队列（ready queue）</td></tr><tr><td>电梯</td><td>线程（主线程）</td></tr><tr><td>按钮亮起</td><td>内核 epoll/select 返回可读/可写事件</td></tr><tr><td>到达后的事</td><td>回调、协程 resume、Future.set_result()</td></tr><tr><td>调度员</td><td>事件循环对象 (asyncio.get_event_loop())</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">为什么能“异步”又“并发”</h2>
<ol>
<li>
<p><strong>异步</strong><br/>
调用 <code>await sock.recv(1024)</code> 时，协程把“剩余代码”封装成回调挂到事件循环，<br/>
主线程立刻去执行下一个就绪任务；<br/>
当 socket 缓冲区收到数据 → 事件循环把回调重新推进就绪队列 → 协程恢复。<br/>
因此<strong>调用者不会阻塞在 recv 上</strong>，形成“非阻塞”效果。</p>
</li>
<li>
<p><strong>并发</strong><br/>
单线程同一时刻只能跑一条 CPU 指令，<br/>
但 I/O 操作 99 % 时间都在<strong>等网卡、等磁盘、等数据库响应</strong>；<br/>
事件循环把这些“空闲时间”切片，让<strong>成千上万个协程轮流占用 CPU</strong>，<br/>
从宏观时间轴看，它们像是“同时”进行，于是实现了<strong>高并发</strong>。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-3">一张图秒懂</h2>
<pre><code class="hljs language-lua" lang="lua">        主线程（单核）
┌──────────────────────────────┐
│ <span class="hljs-keyword">while</span> True:                  │
│     ① 将就绪协程推进电梯      │←<span class="hljs-comment">---┐</span>
│     ② 运行直到遇到 I/O        │    │
│     ③ 把“后续”注册到内核 + 循环 │    │
│     ④ 内核 epoll 通知完成     │<span class="hljs-comment">----┘</span>
└──────────────────────────────┘
</code></pre>
<p>电梯永远满载，但从不等人，吞吐量 ↑↑</p>
<hr/>
<h2 data-id="heading-4">结论</h2>
<p>事件循环不是魔法，只是把**“等 I/O 的时间”<strong>转化为</strong>“运行其他任务的时间”<strong>；<br/>
在单线程里让</strong>大量 I/O 密集任务交替推进**，<br/>
既避免了多线程切换开销，又达到<strong>近乎线性的并发能力</strong>——<br/>
这就是它成为 Node.js、Python asyncio、FastAPI 灵魂的原因。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG知识库远远没有你想象中的那么简单！]]></title>    <link>https://juejin.cn/post/7591334208998031386</link>    <guid>https://juejin.cn/post/7591334208998031386</guid>    <pubDate>2026-01-04T15:14:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591334208998031386" data-draft-id="7591338980694261806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG知识库远远没有你想象中的那么简单！"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2026-01-04T15:14:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG知识库远远没有你想象中的那么简单！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:14:33.000Z" title="Sun Jan 04 2026 15:14:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>知识库系统作为大模型应用的关键模块，始终保持着与大模型的解耦特性。</p>
<p>此前文中曾探讨过知识库的构建困境，不少读者反馈内容空泛、缺乏实操价值。</p>
<p>构建知识库，从来不只是工程实现的命题，更是一场设计哲学的思辨：技术层面确保其可部署、可运维，而哲学层面则锚定其高可用性、可扩展性与跨系统兼容性。</p>
<p>在AI时代盛行的今天，知识库早已超越RAG的边界，成为底层知识基础设施；理论上，凡需知识支撑之处，皆有其存在——无论是智能体决策，还是AIGC内容生成，莫不如此。</p>
<h2 data-id="heading-0">知识库的作用</h2>
<p>我们暂且搁置各类技术框架与应用理论，回归模型最本质的基座，重新审视知识库为何不可或缺。</p>
<p>人工智能的终极愿景，是构建一个能像人类一样应对复杂任务的智能体；但无论人还是机器，能力皆有边界，往往需借力外物才能完成目标——正如我们踏入陌生领域时，依赖书籍研读、师者点拨来获取认知。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>更多AI大模型学习视频及资源，都在智泊AI。</strong></a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12e7138a3f2044279e162aee98de58c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144473&amp;x-signature=OBEcw6nWtJFSxTPLLXsOCdWW%2BQw%3D" alt="图片" loading="lazy"/></p>
<p>这些外部信息，对人而言是学习的养分；对模型而言，则是其自身无法承载的“外部记忆”。管理这类记忆，正需要一个知识库系统，如同图书馆典藏典籍、档案室保存文献。</p>
<p>模型亦然。纵使参数规模持续膨胀，其内部存储仍非无限，总有知识无法内化。从经济性与效率出发，更合理的路径是：让模型专注核心推理能力，而在需要时调用外部知识与工具解决问题。无需为解答“1+1=2”而重学微积分。</p>
<p>由此可得：无论模型形态如何演进，知识库都是其无法绕开的基础设施。</p>
<p>认清这一点，便不难理解——无论是构建RAG、开发智能体，还是推进AIGC，知识库始终是底层刚需。</p>
<p>从工程视角看，我们向模型输入任务需求与参考知识，模型据此理解意图、生成响应；而这些参考知识，总不能每次临时检索、现场查找吧？</p>
<p>于是，一个结构化的知识库管理系统应运而生：它沉淀历史知识，组织可复用信息。当相似问题再度出现，系统可直接调用已有答案，无需重复劳动。这不仅拓展了模型的能力上限，更显著提升了响应效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/578881e40e4849809b5b023534ae3ff2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144473&amp;x-signature=w1ohvgkw0aqFyfoWPaoOyQbUXSM%3D" alt="图片" loading="lazy"/></p>
<p>针对大模型的各类应用场景，知识库管理系统都是不可或缺的支撑组件；但其构建应紧扣实际需求灵活适配，无需也不应追求面面俱到、规模庞大。</p>
<p>模型与知识库之间的关系，恰如一位能力出众的专家与其专属后勤团队：模型负责决策与输出，知识库则持续供给精准、及时的资源支持，二者协同运作，才能催生出远超模型单体能力的智能体。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>更多AI大模型学习视频及资源，都在智泊AI。</strong></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 春涧·前端走向全栈]]></title>    <link>https://juejin.cn/post/7591510742634283071</link>    <guid>https://juejin.cn/post/7591510742634283071</guid>    <pubDate>2026-01-04T15:22:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510742634283071" data-draft-id="7591334602427269183" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 春涧·前端走向全栈"/> <meta itemprop="keywords" content="全栈,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-04T15:22:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="牛奶"/> <meta itemprop="url" content="https://juejin.cn/user/1169536100866487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 春涧·前端走向全栈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536100866487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    牛奶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:22:51.000Z" title="Sun Jan 04 2026 15:22:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">2026 春涧·前端走向全栈</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/becd400be9584391993b37b521b6687a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54mb5aW2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144971&amp;x-signature=S3Pi0czXxYMlgA7vTu8DGSCQwgo%3D" alt="春涧意境 - 水墨山水与梅雨" loading="lazy"/></p>
<p><code>“我醉倚楼台翁头请酒正豪迈……人生少有快哉何须论成败”</code></p>
<p>2025，我终于从<code>“闲听梅雨窗外”</code>的前端舒适区，踉跄着醉入了全栈的春涧。</p>
<h3 data-id="heading-1">清愁初开</h3>
<p>2025，前端的核心叙事可概括为 “全栈化”与“性能优先”的双重驱动：</p>
<p><strong>前端全栈化</strong> 与 <strong>性能优先</strong>。</p>
<p>元框架（<code>Next.js</code>、<code>Nuxt</code>、<code>SvelteKit</code>）已成为新项目的呼吸起点。</p>
<p>开发者不再只写组件，而是直接设计全栈架构。</p>
<p><strong><code>“服务器优先”彻底胜出</code></strong>。</p>
<p><code>React Server Components</code>、Nuxt 3、streaming SSR……</p>
<p>服务端承载渲染与逻辑，客户端负担骤减，安全性与核心指标（LCP、TTI）暴涨。</p>
<p>性能成了唯一信仰。</p>
<p>结果很残酷，却很美：</p>
<ul>
<li>
<p><code>Rust/GO</code> 工具链全面崛起，<code>Turbopack</code>（Next.js 15 默认）带来 700x 更快 HMR，<code>Vite</code>/<code>Rspack</code>让 <code>Webpack</code> 成为上古传说。</p>
</li>
<li>
<p><code>“岛屿架构”</code>（Astro、Qwik）席卷内容型站点，零/极少 JS 默认，瞬时加载成为标配。</p>
</li>
</ul>
<p><strong>AI 从辅助变成基石</strong>。</p>
<p><code>Cursor</code>、<code>Claude</code> 等 AI 工具 深度嵌入编码、重构、调试，问题解决方式已变天。</p>
<p><code>TypeScript</code> 无需讨论，已成底层铁律。</p>
<p>而市场最刺耳的一句实话是：</p>
<p><code>“我们想要一个人全搞定。”</code></p>
<p>纯前端的体面还在，却越来越像</p>
<p>“欠二两笔墨债，闲听梅雨窗外”——</p>
<p>风雅有余，锋芒渐失。</p>
<p>年底，<strong>我又换了一份工作（市场行情依旧不好啊）</strong>，换了一份要求<code>“能前后端通吃”</code>的工作。</p>
<p>从那一刻起，真正的春涧之旅开始了。</p>
<h3 data-id="heading-2">风花雪月入栈</h3>
<p><code>转型</code>从来不是诗和远方，而是刚起步的迷雾与深夜的咖啡。</p>
<p>2025 年底，我终于鼓起勇气：</p>
<p>从熟悉的 React 组件世界，迈向<code>全栈</code>和<code>重构远程运维硬件设备控制应用</code>的未知山海。</p>
<p>框架搭好了——<code>NestJs + Vue3 + TypeORM + WebSocket + MQTT</code> 的基本骨架，</p>
<p>MQTT 连上了，第一个 <code>设备信息查询</code> 接口也跑通了。</p>
<p>但后面呢？</p>
<p>远程设备的 AI 异常诊断怎么做？</p>
<p>设备自定义操作怎么做串型链路和互斥的安全控制？</p>
<p>部署上云要踩多少坑？</p>
<p><code>报错</code>、<code>失败</code>……每一次调试都像在雨夜里摸黑前行，心底那句<code>“人间清愁”</code>又回来了。</p>
<p>有时候盯着报错的控制台，突然就想问自己：</p>
<p>“我真的能走下去吗？”</p>
<p>但奇怪的是，每解决一个小问题——</p>
<p>哪怕只是把 接口调用 改对一次，接口返回了预期数据，</p>
<p>心里的<code>“风花雪月”</code>就偷偷多了一分。</p>
<p>不是什么大成就，只是那种“原来我能往前挪一步”的微醺感。</p>
<p>现在我才明白，全栈不是一下子就“入栈”，而是像醉酒一样，一口一口地喝下去。</p>
<p>先把框架跑通，再补认证，再加个真实的小功能……</p>
<p>未知很多，但每多知道一点，山海就近一点。</p>
<h3 data-id="heading-3">2026，一起醉入春涧</h3>
<p>2026 年 1 月，我还站在春涧入口。</p>
<p>框架刚搭好，路还模糊，疑惑比答案多得多。</p>
<p>但我已经醉了——醉在<code>“敢迈出这一步”</code>的豪迈里。</p>
<p>2026 年的前端朋友，如果你也听见了那场梅雨，</p>
<p>如果你也开始怀疑<code>“纯前端还能走多远”</code>，</p>
<p>如果你也刚搭好框架，却被一堆未知吓住——</p>
<p>别怕。</p>
<p>从今天开始，哪怕只多写一个接口、多 <code>debug</code> 一次报错、多看一篇文档，</p>
<p>哪怕只多会 5%，</p>
<p>你就已经比昨天更靠近</p>
<p><code>下榻山海，风花雪月入我怀</code>。</p>
<p><code>人生少有快哉，何须论成败</code>。</p>
<p>来吧，一起在这场春涧里，慢慢醉，慢慢走。</p>
<p>（2026.1.4 半夜 · 于出差的某个酒店）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验]]></title>    <link>https://juejin.cn/post/7591510742634315839</link>    <guid>https://juejin.cn/post/7591510742634315839</guid>    <pubDate>2026-01-04T15:23:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510742634315839" data-draft-id="7591510742634266687" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验"/> <meta itemprop="keywords" content="前端,后端,代码规范"/> <meta itemprop="datePublished" content="2026-01-04T15:23:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Piper蛋窝"/> <meta itemprop="url" content="https://juejin.cn/user/844050443272557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/844050443272557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Piper蛋窝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:23:57.000Z" title="Sun Jan 04 2026 15:23:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>去年的今天，我还在奋笔疾书地写着 VS Code + Roo Cline 的评测心得：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FUdSThZX69c8CXkEw48Vy_w" target="_blank" title="https://mp.weixin.qq.com/s/UdSThZX69c8CXkEw48Vy_w" ref="nofollow noopener noreferrer">个人评测 | Cursor 免费平替：Roo Cline + DeepSeek-v3/Gemini-2.0 + RepoPrompt AI 辅助编程</a> 。当时的我没有想过：在 2025 年， Roo Cline 会被我迅速淘汰，我也成为了 Cursor 这类 Vibe Coding 工具的稳定用户之一。</p>
<p>站在 2026 年伊始的节点上，审视自己的工作流，发现已经完全被锚定在了如下工具链上：</p>
<ul>
<li>对话工具： ChatGPT 5.2 + Gemini 3 Pro</li>
<li>Vibe Coding ： 工作用 Cursor ，个人学习用 Trae 国际版 + CodeX ，辅以 VS Code + GitHub Copliot</li>
</ul>
<p>其中我仅为 ChatGPT 和 Trae 付过费（ ChatGPT 赠送 CodeX 订阅）， GitHub Copliot 使用的免费额度（每个月可调用次数不多）。</p>
<p>本文中，我把 2025 年一年的经验总结成十条，希望能够引起讨论，共同交流学习。</p>
<h3 data-id="heading-0">（一）聊天 AI 没有被淘汰，某些情况下，它们更好用</h3>
<p>很多朋友在拿到 Cursor 或 Trae 这种 IDE 后，容易养成一种习惯：一头扎进具体的代码文件中，试图用 Tab 和 CMD+K 解决所有问题。但经过这一年的实践，我发现网页版的聊天型 AI 和 IDE 调用的 API 模型是有本质区别的。</p>
<p>首先是模型的可控性。IDE 接入的模型往往为了代码生成做过微调，但在逻辑深度上，ChatGPT 5.2 的 Thinking Extended Thinking 模式或者 Gemini 3 Pro 的推理模式，显然比 Cursor 的 Agent 更加深思熟虑。</p>
<p>更关键的是上下文的管理。当你需要进行宏观架构设计时，IDE 的 RAG 检索有时会显得过于碎片化。我的做法是，利用 <code>git archive --format=zip HEAD -o project.zip</code> 将项目打包。这个命令的好处在于它只打包 Git 追踪的文件，自动排除了 <code>node_modules</code> 和临时数据。把这个压缩包扔给 ChatGPT，它现在的虚拟机能力非常强，可以自行解压、有选择地阅读文件。</p>
<p>相比于在 IDE 里敲敲打打，ChatGPT 这类工具更适合做“顶层设计”。比如技术选型和开发路线制定，它的 Web Searching 能力比 IDE 的 Agent 更广更深；再比如项目初始化，你可以直接让它生成一个包含完整目录结构的 zip 包，甚至顺便画出 mermaid 流程图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b12f2c46458d4e1a964a2417ba0055d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=tgCxI0tfvpISS9k3Jnvr9PLRAyE%3D" alt="善于使用分支" loading="lazy"/></p>
<p>而在数学计算和复杂算法推导上，聊天 AI 更是降维打击。我自己研究油气管道调度问题时，就常把原始数据打包上传，利用 ChatGPT 的超长思考时间，结合“分支聊天”策略，同时探索整数规划、动态规划和强化学习三条路线。这种工程实践的第一步，目前的 IDE 还做不到这么好。</p>
<h3 data-id="heading-1">（二）善于使用 workspace 概念，不要浪费类 Cursor 工具的 RAG index</h3>
<p>Cursor 和 Trae 这类工具的核心优势在于云端索引（Index）。简单来说，它们把你的代码“读”了一遍并建立了一个向量数据库。这意味着在 Agent Chat 中，你不需要笨拙地把第 1 行到第 50 行代码复制进去，只需 <code>@</code> 一下相关文件，Agent 就能通过索引理解上下文，既高效又节省 tokens。</p>
<p>但在 Cursor / Trae 似乎忽略了 VS Code 祖传的 <code>workspace</code> 功能，导致 IDE 无法理解多模块项目的关系。Cursor 如果找不到明确的 root 目录，搜索和索引的效果就会大打折扣。</p>
<p>我现在的习惯是构建一个“手动的 workspace”。即使是前后端分离的项目，我也会把它们放在同一个目录下，比如创建一个 <code>_workspace</code> 文件夹，里面包含 <code>.cursorrules</code>、<code>frontend</code>、<code>backend</code> 和 <code>openapi</code> 目录。</p>
<p>不要单独打开 frontend 写前端，直接用 Cursor 打开 <code>_workspace</code>。这样在进行前后端联调时，Cursor 能够同时索引两端的代码，理解接口定义和业务逻辑的关联。你可以在 <code>.cursorrules</code> 中明确这是一个 monorepo，告诉 AI 前端用 pnpm，后端用 Python 3.12，甚至写明“调试前请运行 <code>source ./backend/env/bin/activate</code>”。这些环境上下文的注入，能让 AI 少问很多傻问题，极大地提升一次性代码通过率。</p>
<h3 data-id="heading-2">（三）MCP 、 Rule 还是 Skill ？模型越来越强，这类技术在被淘汰，适合项目的才是最好的</h3>
<p>记得 2024 年末，MCP（Model Context Protocol） 概念火得一塌糊涂。而现在， Claude 也在推广 Skill 。但到了现在，你会发现这些复杂的技巧正在被边缘化。本质原因是模型本身变强了，强到不再需要那么多拐杖。</p>
<p>MCP 虽然可以安全地连接数据库（比如限制只读权限等等），但配置起来依然繁琐，且生态本身的安全性也并非无懈可击。数次尝试后，我发现最朴素的方案反而是最有效的：让 AI 基于你的业务代码，写一套 Python 或 Shell 脚本工具。</p>
<p>比如，与其配置复杂的 MCP 去查询订单，不如让 AI 写一个 <code>scripts/get_order_info.py</code>。这样做的好处显而易见：你自己能用，AI 也能用。当你需要进行复杂测试时，直接告诉 AI：“你可以并行调用 <code>scripts/send_test_orders.py</code> 和 <code>scripts/listen_mock_executions.py</code>”。这其实就是一种定制化的、低成本的 MCP，而且完全掌握在你自己的代码仓库里。当然，记得在运行前检查一下 AI 生成的脚本，安全意识不能丢。</p>
<h3 data-id="heading-3">（四）给出具体的任务， AI 不是我们偷懒的借口，而是我们效率的乘数</h3>
<p>分享一个真实的翻车案例：前段时间有朋友把一份 Word 格式的简历扔给 Cursor，模型选的 Claude Opus 4.5，只给了一句指令：“帮我转成 HTML”。</p>
<p>结果 AI 搞得一团糟。因为它不理解这个 HTML 是要用来做静态展示，还是要部署到某个具体服务中。为了“完成任务”，AI 甚至不知道从哪搞来了一个公有云对象存储的 Token ，把简历里的照片上传到了某个不知名的 OSS 上，想删都删不掉，简直令人啼笑皆非。</p>
<p>这个教训告诉我们，AI 只是工具，决策还得靠人。正确的方式应该是先明确需求：这个 HTML 要放在哪里？是单页静态应用还是嵌入式组件？然后，利用 PLAN 模式或者先问 Chat AI：“我想把 Word 转 HTML，目前有哪些成熟工具？latex2html 还是 pandoc？或者先转 Markdown 再生成 HTML？”</p>
<p>当我们明确了技术路径（比如 Word -&gt; Markdown -&gt; HTML）后，再让 IDE 去执行。AI 是我们效率的乘数，它能把 1 变成 100，但如果我们给出的基数是 0 甚至负数（错误的决策），那结果只能是灾难。Cursor 的 PLAN 模式和 Trae 的 SOLO 模式（生成 <code>.docs/xxx.md</code>）都是很好的辅助思考工具，别为了省事直接蛮干。</p>
<h3 data-id="heading-4">（五）不要过度提示，你说的每个字 AI 都很上心</h3>
<p>在 Prompt Engineering 刚兴起时，我们习惯写一大堆提示词。但在 2025 年，面对更聪明的模型，过度提示反而成了累赘。</p>
<p>比如在中文语境下，我看到很多人喜欢在结尾加一句“请结合上下文修改代码”。这对人类来说是一句废话，但对 AI 来说可能是个干扰。它可能会死板地理解为“结合上面的代码和下面的代码”，然后去运行 <code>grep -C 10</code> 强行读取代码的物理上下行，反而忽略了原本高效的 RAG 索引逻辑。</p>
<p>现在的模型已经足够智能，能理解你的意图。简洁、清晰地描述需求，往往比堆砌“提示词魔法”效果更好。说得越多，模型“幻觉”的空间反而越大。</p>
<h3 data-id="heading-5">（六）提供充足的 context ，还包括操作系统环境和命令行日志</h3>
<p>虽然我们不该啰嗦，但在提供客观事实（Context）上，一定要大方。很多时候 AI 写出的代码跑不通，是因为它根本不知道你在什么环境下运行。</p>
<p>我有一个习惯，在开启复杂任务前，会先把终端里的环境信息甩给它：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -a
<span class="hljs-built_in">cat</span> /etc/os-release
<span class="hljs-comment"># 如果有报错日志</span>
<span class="hljs-built_in">tail</span> -20f /tmp/dev/server-error.log
</code></pre>
<p>将这些 Terminal 的输出直接粘贴到 Chat 框里，几乎不费什么功夫，消耗的 token 也可以忽略不计，但这对 AI 来说是极其关键的“地面实况”。</p>
<p>虽然 Cursor 宣称会读取 Terminal 输出，但具体的读取时机和触发规则是个黑盒。与其猜它读没读，不如主动喂给它。特别是在处理编译错误或环境依赖问题时，一份完整的日志远比你描述“它报错了”要管用一万倍。</p>
<h3 data-id="heading-6">（七）没有一蹴而就，别人的 rule / prompt 可能并不适合你</h3>
<p>网上流传着各种“神级 Prompt”和“万能 Rule”，但我建议你谨慎复制。模型在进化，工具在迭代，上个月好用的技巧，下个月可能就因为模型权重调整而失效了。</p>
<p>Rule 并不是越复杂越好。你没必要在 Rule 里把常识再强调一遍，比如写上“使用 pnpm 管理项目”就足够了，不需要再废话一句“具体命令请参考 package.json”，模型都懂。</p>
<p>更重要的是，如果你想教会 AI 使用某种内部框架，与其在 Rule 里用自然语言喋喋不休，不如直接把框架的核心代码放进 workspace 里，让它成为索引的一部分。代码本身就是最好的说明书。你的 Rule 应该是随着开发过程动态生长的，而不是一开始就塞进去一堆你自己都没读完的规则。</p>
<h3 data-id="heading-7">（八）无论是模型还是工具，时刻保留多套方案</h3>
<p>在 2025 年，唯一不变的就是变化。我们见证过模型突然“降智”，也遇到过支付渠道突然被切断的情况。</p>
<p>永远不要把所有希望寄托在单一模型上。某些模型就是有它的局限性，比如我有一次遇到一个棘手的前端 CSS 层叠上下文问题，在 ChatGPT 5.2 和 Gemini 3 Pro 上折腾了半天没解决，它们给出的方案总是在原地打转。最后我切到 GitHub Copilot 里的 Claude Opus 4.5，它一眼就看出了问题所在。</p>
<p>无论是 Cursor、Trae 还是 VS Code，无论是 OpenAI 还是 Google，保持工具链的冗余度，是你按时交付的最后一道防线。</p>
<h3 data-id="heading-8">（九）数据安全很重要，记得脱敏重要数据</h3>
<p>AI 行业竞争这么激烈，你很难保证这些 AI 公司为了活下去，不会拿你的数据去“炼丹”。所以，关于 Token、密钥（Secret Key）这类敏感信息，绝对不能交给 AI。</p>
<p>凡是你不敢提交到公共 Git 仓库的内容，也同样不要发给 AI。善用 <code>.cursorignore</code> 等配置文件，把存放密钥的文件屏蔽掉。</p>
<p>但开发又离不开这些密钥，怎么兼顾安全和方便呢？我的做法是让 AI 把所有敏感配置都提取成环境变量，而在 Codespace 之外的地方（比如本地的 <code>~/.bashrc</code>）去实际赋值。如果某个工具必须通过命令行传参（比如 <code>--token xxx</code>），我就让 AI 把这串命令封装成 <code>run.sh</code>，脚本里只写变量名。这样 AI 看到的只是 <code>$MY_SECRET_TOKEN</code>，而真实的密钥永远躺在你本地的硬盘里。你也不想你的 Token 在未来出现在某个糊涂蛋开源项目的 Prompt 示例里吧？</p>
<h3 data-id="heading-9">（十）大力不能出奇迹，不要陷入“只和 AI 聊天”就能解决所有问题的误区</h3>
<p>最后一条，也是最重要的一条：如果 AI 反复几次都解决不了一个问题，请立刻停止对话，动用你自己的脑子。</p>
<p>很多时候，我们容易陷入一种“赌徒心理”，觉得下一次 Prompt 就能修好了。举个我最近开发 Tauri 桌面应用（Rust + Vue3 + Vite）的例子：我在开发环境下（dev），点击按钮可以正常弹出模态框（Modal）；但打包安装后（build），按钮点击就毫无反应。</p>
<p>我换了三个模型，尝试了改 CSS <code>z-index</code>、查 Webview2 兼容性、对比 build/dev 环境变量，甚至让 Agent 在代码里到处打 log，折腾了一晚上都无解。Log 显示逻辑流转一切正常。</p>
<p>最后我实在没招了，在 dev 模式下主动打开了 Webview2 的控制台（Console）。一眼就看到了一个 Main Window 里的报错：<code>i18n</code> 报警，提示某个翻译占位符不能用 <code>@</code>，必须用 <code>{'@'}</code> 转义。这个错误在 dev 模式下只是个 Warning，不影响交互；但在 build 后的生产环境下，它直接阻断了后续 JS 的执行。</p>
<p>这个报错不在后端 Log 里，也不在显眼的终端输出里，AI 自然“看”不到。这提醒我们：AI 再强也只是辅助，作为工程师，排查问题的基本功（比如亲自看一眼控制台）永远不能丢。</p>
<hr/>
<p>2025 年年初，我还写了一篇关于 AI 的使用心得，除了发在咱国内的平台上，还发在了海外的技术论坛 dev.to 上，没有什么反响。</p>
<p>结果我发现，这篇文章被人洗稿了，并且绝大部分内容是原封不动地抄袭过去的。我是在 2025 年 2 月 21 日首发在 dev.to 上，它是在 2025 年 3 月 20 日把文章洗稿发到 generativeai.pub 上的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f08258b389340dc8294d7718fd78690~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=cXxs0zlEIgb6%2F5k%2FKGGv17NXWcE%3D" alt="文章标题都没有修改" loading="lazy"/></p>
<p>除了开头做了微小改动，剩下的正文部分内容基本一致。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4677fe6f98404e9bb89443a03e5a14f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=DsY0ZB42K3y5lSgkCKRq3MxrhyM%3D" alt="我的原文" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20093018a250458faa45fd3d0011ea43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=GAvlXxtGm9YYpCHm5UnljiEeOU0%3D" alt="抄袭者文章" loading="lazy"/></p>
<p>原文链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fpiperliu%2Fdont-let-ai-programming-ruin-your-career-treat-them-as-your-interns-not-employees-or-teachers-16bo" target="_blank" title="https://dev.to/piperliu/dont-let-ai-programming-ruin-your-career-treat-them-as-your-interns-not-employees-or-teachers-16bo" ref="nofollow noopener noreferrer">dev.to/piperliu/do…</a></li>
</ul>
<p>抄袭者链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgenerativeai.pub%2Fdont-let-ai-programming-ruin-your-career-treat-them-as-interns-instead-of-employees-teachers-62e278f4db02" target="_blank" title="https://generativeai.pub/dont-let-ai-programming-ruin-your-career-treat-them-as-interns-instead-of-employees-teachers-62e278f4db02" ref="nofollow noopener noreferrer">generativeai.pub/dont-let-ai…</a></li>
</ul>
<p>好消息是：抄袭者的文章有许多点赞与评论，看来我写的文章还是有一定参考价值的。</p>
<p>坏消息是：都说中文互联网是垃圾堆，看起来英文互联网也没有好到哪里去。这对我这个 Hacker News 老读者的冲击有些大。</p>
<p>准备投诉/维权试一试，看看这些国际平台是否真的那么尊重原创与版权。</p>
<p>欢迎关注我，之后有结果了我也会把经历汇总成一篇文章。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势]]></title>    <link>https://juejin.cn/post/7591348605865885731</link>    <guid>https://juejin.cn/post/7591348605865885731</guid>    <pubDate>2026-01-04T15:50:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605865885731" data-draft-id="7591330139083603983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-04T15:50:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java小成"/> <meta itemprop="url" content="https://juejin.cn/user/3614849960783160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3614849960783160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java小成
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:50:23.000Z" title="Sun Jan 04 2026 15:50:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 场景复现：那个让我头疼的时刻</h2>
<p>去年，我接手了一个"祖传" Go 项目。打开代码仓库的那一刻，我整个人都不好了——所有代码都塞在一个 <code>main.go</code> 里，足足 3000 多行。想加个功能？先花半小时找代码在哪。想写个单元测试？抱歉，函数全是私有的，而且互相耦合，根本没法单独测。</p>
<p>我当时就在想：<strong>如果当初写这个项目的人，能从第一天就用一个规范的结构，后面的人得少掉多少头发？</strong></p>
<p>后来我开始研究 Go 官方和社区推荐的项目布局，发现其实规则很简单，但很多人就是不知道。于是我写了这个 50 行代码的小 Demo，把 Go 项目结构的精髓浓缩进去。今天，我就带你一起拆解它。</p>
<h2 data-id="heading-1">2. 架构蓝图：上帝视角看设计</h2>
<p>先来看这个项目的目录结构：</p>
<pre><code class="hljs language-csharp" lang="csharp">series/<span class="hljs-number">01</span>/
├── cmd/
│   └── hello/
│       └── main.go        <span class="hljs-meta"># 程序入口，只做 I/O</span>
├── <span class="hljs-keyword">internal</span>/
│   └── reasons/
│       ├── reasons.go     <span class="hljs-meta"># 核心业务逻辑</span>
│       └── reasons_test.go <span class="hljs-meta"># 单元测试</span>
└── go.mod                  <span class="hljs-meta"># 模块定义</span>
</code></pre>
<p>这不是我随便画的，而是 Go 社区广泛认可的<strong>标准项目布局</strong>。我用一张图来展示数据是怎么流转的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 用户层
        A[命令行输入&lt;br/&gt;--name=小明 --lang=go]
    end
    
    subgraph cmd/hello
        B[main.go&lt;br/&gt;解析参数]
    end
    
    subgraph internal/reasons
        C[reasons.go&lt;br/&gt;业务逻辑]
        D[(reasonByLang&lt;br/&gt;map 数据)]
    end
    
    subgraph 输出层
        E[终端输出&lt;br/&gt;格式化结果]
    end
    
    A --&gt; B
    B --&gt;|调用 Reason 函数| C
    C --&gt;|查询| D
    D --&gt;|返回推荐理由| C
    C --&gt;|返回字符串| B
    B --&gt; E
</code></pre>
<p><strong>核心设计思想：关注点分离</strong></p>
<ul>
<li><code>cmd/</code> 目录：放可执行程序的入口。每个子目录对应一个可执行文件。<code>main.go</code> 只负责"接收输入、调用业务、输出结果"，不写任何业务逻辑。</li>
<li><code>internal/</code> 目录：放内部包。这个目录有个<strong>魔法属性</strong>——Go 编译器会强制禁止外部项目 import 这里的代码。这是 Go 语言级别的"私有化"保护。</li>
<li><code>go.mod</code>：Go Modules 的配置文件，声明模块名和 Go 版本。</li>
</ul>
<h2 data-id="heading-2">3. 源码拆解：手把手带你读核心</h2>
<h3 data-id="heading-3">3.1 入口文件：main.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"flag"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"runtime"</span>
    <span class="hljs-string">"strings"</span>
    <span class="hljs-string">"time"</span>

    <span class="hljs-string">"learn-go/series/01/internal/reasons"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    name := flag.String(<span class="hljs-string">"name"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-string">"读者名称"</span>)
    lang := flag.String(<span class="hljs-string">"lang"</span>, <span class="hljs-string">"go"</span>, <span class="hljs-string">"关注的语言"</span>)
    flag.Parse()

    lines := []<span class="hljs-type">string</span>{
        fmt.Sprintf(<span class="hljs-string">"你好，%s！"</span>, *name),
        fmt.Sprintf(<span class="hljs-string">"你正在体验：%s"</span>, strings.ToUpper(*lang)),
        fmt.Sprintf(<span class="hljs-string">"今天的结论：%s"</span>, reasons.Reason(*lang)),
        <span class="hljs-comment">// ... 省略部分</span>
    }

    fmt.Println(strings.Join(lines, <span class="hljs-string">"\n"</span>))
}
</code></pre>
<p><strong>逐行解读：</strong></p>
<p><strong>第 1 行 <code>package main</code></strong>：Go 规定，可执行程序的入口包必须叫 <code>main</code>，入口函数也必须叫 <code>main()</code>。这是铁律，没得商量。</p>
<p><strong>第 10-11 行 <code>flag.String(...)</code></strong>：这是 Go 标准库提供的命令行参数解析方案。</p>
<blockquote>
<p><strong>知识点贴士：flag 包</strong></p>
<p><code>flag.String("name", "默认值", "帮助说明")</code> 会返回一个 <code>*string</code>（字符串指针），而不是 <code>string</code>。为什么？因为 <code>flag.Parse()</code> 需要在解析完命令行后，把值"写回"到这个变量里。如果返回的是值而不是指针，就没法修改了。</p>
<p>类比 Java：这有点像 Java 里用 <code>AtomicReference</code> 来实现"可变的引用"。</p>
</blockquote>
<p><strong>第 12 行 <code>flag.Parse()</code></strong>：真正执行解析。调用这行之后，<code>name</code> 和 <code>lang</code> 指针指向的值才会被填充。</p>
<p><strong>第 15 行 <code>*name</code></strong>：这里的 <code>*</code> 是<strong>解引用操作符</strong>，意思是"取出指针指向的值"。</p>
<blockquote>
<p><strong>知识点贴士：指针</strong></p>
<p>Go 的指针比 C 简单很多——没有指针运算，只有"取地址 <code>&amp;</code>"和"解引用 <code>*</code>"两个操作。你可以把指针理解为"变量的门牌号"，<code>*</code> 就是"按门牌号找到房间里的东西"。</p>
</blockquote>
<p><strong>第 17 行 <code>reasons.Reason(*lang)</code></strong>：调用 <code>internal/reasons</code> 包里的 <code>Reason</code> 函数。注意这里的 <code>R</code> 是大写的。</p>
<blockquote>
<p><strong>知识点贴士：可见性规则</strong></p>
<p>Go 没有 <code>public</code>/<code>private</code> 关键字。它用一个极简的规则：<strong>首字母大写 = 公开，首字母小写 = 私有</strong>。所以 <code>Reason</code> 能被外部调用，而如果写成 <code>reason</code> 就只能在 <code>reasons</code> 包内部用。</p>
</blockquote>
<h3 data-id="heading-4">3.2 业务逻辑：reasons.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"strings"</span>

<span class="hljs-keyword">var</span> reasonByLang = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
    <span class="hljs-string">"go"</span>:     <span class="hljs-string">"编译快、部署简单、并发模型清晰，适合做基础设施和服务端。"</span>,
    <span class="hljs-string">"python"</span>: <span class="hljs-string">"生态丰富、验证快，适合数据处理和脚本。"</span>,
    <span class="hljs-string">"java"</span>:   <span class="hljs-string">"工程成熟、生态庞大，适合大型企业级系统。"</span>,
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Reason</span><span class="hljs-params">(lang <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
    key := strings.ToLower(strings.TrimSpace(lang))
    <span class="hljs-keyword">if</span> key == <span class="hljs-string">""</span> {
        key = <span class="hljs-string">"go"</span>
    }
    <span class="hljs-keyword">if</span> reason, ok := reasonByLang[key]; ok {
        <span class="hljs-keyword">return</span> reason
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"先选一个目标场景，再决定语言。Go 适合服务端与工具链。"</span>
}
</code></pre>
<p><strong>逐行解读：</strong></p>
<p><strong>第 5-9 行 <code>var reasonByLang = map[string]string{...}</code></strong>：这是 Go 的 <code>map</code> 类型，相当于 Java 的 <code>HashMap</code> 或 Python 的 <code>dict</code>。</p>
<p>注意这里用的是<strong>包级变量</strong>（定义在函数外面），小写开头意味着它是私有的，外部包访问不到。这是一种常见的"模块内共享数据"的方式。</p>
<p><strong>第 16 行 <code>if reason, ok := reasonByLang[key]; ok</code></strong>：这是 Go 最经典的惯用法之一——<strong>comma ok</strong>。</p>
<blockquote>
<p><strong>知识点贴士：comma ok 惯用法</strong></p>
<p>在 Go 里访问 map，可以用两种方式：</p>
<ul>
<li><code>v := m[key]</code>：如果 key 不存在，返回零值（空字符串、0 等）</li>
<li><code>v, ok := m[key]</code>：<code>ok</code> 是个布尔值，告诉你 key 到底存不存在</li>
</ul>
<p>第二种方式能区分"key 存在但值为空"和"key 根本不存在"，更安全。</p>
</blockquote>
<h3 data-id="heading-5">3.3 单元测试：reasons_test.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"testing"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestReason</span><span class="hljs-params">(t *testing.T)</span></span> {
    tests := []<span class="hljs-keyword">struct</span> {
        name <span class="hljs-type">string</span>
        lang <span class="hljs-type">string</span>
        want <span class="hljs-type">string</span>
    }{
        {name: <span class="hljs-string">"default"</span>, lang: <span class="hljs-string">""</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
        {name: <span class="hljs-string">"go"</span>, lang: <span class="hljs-string">"go"</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
        {name: <span class="hljs-string">"python"</span>, lang: <span class="hljs-string">"python"</span>, want: reasonByLang[<span class="hljs-string">"python"</span>]},
    }

    <span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests {
        t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
            <span class="hljs-keyword">if</span> got := Reason(tt.lang); got != tt.want {
                t.Fatalf(<span class="hljs-string">"Reason(%q) = %q, want %q"</span>, tt.lang, got, tt.want)
            }
        })
    }
}
</code></pre>
<p>这是 Go 社区推崇的**表驱动测试（Table-Driven Test）**风格。</p>
<blockquote>
<p><strong>知识点贴士：表驱动测试</strong></p>
<p>核心思想是：把测试用例组织成一个"表格"（切片），然后用循环遍历执行。好处是：</p>
<ol>
<li>新增用例只需要加一行数据，不用写重复的测试代码</li>
<li>测试逻辑集中，一眼就能看出覆盖了哪些场景</li>
<li><code>t.Run()</code> 会给每个用例起名字，失败时能精确定位</li>
</ol>
</blockquote>
<p><strong>第 16 行 <code>for _, tt := range tests</code></strong>：<code>range</code> 是 Go 遍历切片/map 的关键字。<code>_</code> 表示"我不关心索引，只要值"。</p>
<h2 data-id="heading-6">4. 避坑指南 &amp; 深度思考</h2>
<h3 data-id="heading-7">坑 1：忘记调用 flag.Parse()</h3>
<p>如果你删掉 <code>flag.Parse()</code> 这行，程序不会报错，但 <code>*name</code> 和 <code>*lang</code> 永远是默认值。这是个很隐蔽的 Bug。</p>
<h3 data-id="heading-8">坑 2：map 并发读写会 panic</h3>
<p>当前代码里的 <code>reasonByLang</code> 是只读的，没问题。但如果你想在运行时动态添加语言，<strong>千万不要</strong>在多个 goroutine 里同时读写这个 map——Go 的 map 不是并发安全的，会直接 panic。</p>
<p><strong>生产环境怎么办？</strong> 用 <code>sync.RWMutex</code> 加锁，或者用 <code>sync.Map</code>。</p>
<h3 data-id="heading-9">坑 3：internal 目录的"魔法"是编译器强制的</h3>
<p>有些同学以为 <code>internal</code> 只是个命名约定，其实不是。Go 编译器会<strong>硬性禁止</strong>外部模块 import <code>internal</code> 下的包。如果你的项目是个库，想暴露某些包给外部用，就不能放在 <code>internal</code> 里。</p>
<h3 data-id="heading-10">Demo 与生产代码的差距</h3>
<p>这个 Demo 为了教学做了简化，生产环境还需要考虑：</p>
<ol>
<li><strong>错误处理</strong>：当前代码没有任何 <code>error</code> 返回，真实场景要处理各种异常</li>
<li><strong>日志</strong>：用 <code>log</code> 或 <code>slog</code> 包记录关键操作</li>
<li><strong>配置管理</strong>：硬编码的 map 应该改成从配置文件或环境变量读取</li>
<li><strong>优雅退出</strong>：监听系统信号，做资源清理</li>
</ol>
<h2 data-id="heading-11">5. 快速上手 &amp; 改造建议</h2>
<h3 data-id="heading-12">运行命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> series/01
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接运行</span>
go run ./cmd/hello
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，工程师！
你正在体验：GO
今天的结论：编译快、部署简单、并发模型清晰，适合做基础设施和服务端。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:02:19+08:00
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 带参数运行</span>
go run ./cmd/hello --name=小明 --lang=python
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，小明！
你正在体验：PYTHON
今天的结论：生态丰富、验证快，适合数据处理和脚本。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:05:54+08:00
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行测试</span>
go <span class="hljs-built_in">test</span> ./internal/reasons -v
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">=== RUN   TestReason
=== RUN   TestReason/default
=== RUN   TestReason/go
=== RUN   TestReason/python
--- PASS: TestReason (0.00s)
    --- PASS: TestReason/default (0.00s)
    --- PASS: TestReason/go (0.00s)
    --- PASS: TestReason/python (0.00s)
PASS
ok      learn-go/series/01/internal/reasons     0.007s
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编译成可执行文件</span>
go build -o hello ./cmd/hello
./hello --name=读者
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，读者！
你正在体验：GO
今天的结论：编译快、部署简单、并发模型清晰，适合做基础设施和服务端。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:07:16+08:00
</code></pre>
<h3 data-id="heading-13">工程化改造建议</h3>
<p><strong>建议 1：加入结构化日志</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"log/slog"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    slog.Info(<span class="hljs-string">"程序启动"</span>, <span class="hljs-string">"name"</span>, *name, <span class="hljs-string">"lang"</span>, *lang)
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><code>slog</code> 是 Go 1.21 引入的标准库，支持 JSON 格式输出，方便对接日志系统。</p>
<p><strong>建议 2：配置外部化</strong></p>
<p>把 <code>reasonByLang</code> 改成从 YAML/JSON 文件读取：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"os"</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"encoding/json"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadReasons</span><span class="hljs-params">(path <span class="hljs-type">string</span>)</span></span> (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    data, err := os.ReadFile(path)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">var</span> m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>
    err = json.Unmarshal(data, &amp;m)
    <span class="hljs-keyword">return</span> m, err
}
</code></pre>
<p><strong>建议 3：添加版本信息</strong></p>
<p>利用 <code>go build -ldflags</code> 在编译时注入版本号：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Version = <span class="hljs-string">"dev"</span> <span class="hljs-comment">// 会被编译时覆盖</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"版本："</span>, Version)
}
</code></pre>
<p>编译命令：</p>
<pre><code class="hljs language-bash" lang="bash">go build -ldflags <span class="hljs-string">"-X main.Version=v1.0.0"</span> -o hello ./cmd/hello
</code></pre>
<h2 data-id="heading-14">6. 总结与脑图</h2>
<ul>
<li><strong>cmd/ 放入口，internal/ 放私有逻辑</strong>——这是 Go 项目结构的黄金法则</li>
<li><strong>flag 包返回指针</strong>，记得用 <code>*</code> 解引用，别忘了调用 <code>Parse()</code></li>
<li><strong>comma ok 惯用法</strong>（<code>v, ok := m[key]</code>）是安全访问 map 的标准姿势</li>
<li><strong>首字母大小写决定可见性</strong>，这是 Go 独特的"无关键字"设计哲学</li>
<li><strong>表驱动测试</strong>让你的测试代码更简洁、更易维护</li>
</ul>
<p>如果你正准备入坑 Go，不妨把这个 Demo clone 下来，亲手改一改、跑一跑。<strong>看十遍不如写一遍</strong>，这是我这些年最深的体会。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一致性哈希介绍]]></title>    <link>https://juejin.cn/post/7591330139083489295</link>    <guid>https://juejin.cn/post/7591330139083489295</guid>    <pubDate>2026-01-04T14:23:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591330139083489295" data-draft-id="7591156262626459683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一致性哈希介绍"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-04T14:23:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一致性哈希介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:23:57.000Z" title="Sun Jan 04 2026 14:23:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>一致性哈希（Consistent Hashing）是一种**“让节点扩缩容时，尽可能少地迁移数据”<strong>的分布式哈希算法。<br/>
1997 年由 MIT 的 Karger 等人提出，现在几乎成了</strong>分布式缓存、负载均衡、分库分表**的标配。</p>
<hr/>
<h3 data-id="heading-0">1. 传统哈希的问题</h3>
<p>假设有 N 台缓存节点，用 <code>hash(key) % N</code> 决定数据落在哪台机器。</p>
<ul>
<li>节点宕机或新增 1 台 → N 变化 → <strong>几乎所有 key 重新映射</strong> → 缓存雪崩，数据库瞬间被打爆。</li>
</ul>
<hr/>
<h3 data-id="heading-1">2. 一致性哈希的核心思想</h3>
<p>把<strong>哈希空间</strong>想象成一条<strong>首尾相接的 2³² 环形轨道</strong>（0 → 2³²-1 → 0）。<br/>
步骤：</p>
<ol>
<li>节点入环：对节点 IP/ID 做 hash，得到其在环上的位置。</li>
<li>数据入环：对 key 做 hash，顺时针找到<strong>第一个节点</strong>，就是它的归属。</li>
<li>节点增减：只影响<strong>环上相邻的一段弧</strong>，其余数据原地不动。</li>
</ol>
<hr/>
<h3 data-id="heading-2">3. 虚拟节点（Virtual Nodes）——解决“倾斜”**</h3>
<p>真实节点很少时，环上分布不均，易产生“数据扎堆”。<br/>
给每台物理节点生成<strong>上百个虚拟节点</strong>（如 <code>node1#1</code>、<code>node1#2</code>…），打散在环上，<strong>负载方差</strong>瞬间下降。</p>
<hr/>
<h3 data-id="heading-3">4. 扩缩容示例</h3>
<ul>
<li>初始 3 台节点 A/B/C，key 按顺时针规则落点。</li>
<li>新增节点 D，位于 B→C 之间：<br/>
仅把原本归属 C 的**“B→D”**这段 key 迁给 D，<strong>剩余 90%+ 数据不动</strong>。</li>
<li>节点 B 宕机：<br/>
原来 B→C 之间的 key 顺时针滑到 C，<strong>其他区间无感知</strong>。</li>
</ul>
<hr/>
<h3 data-id="heading-4">5. 代码级直觉（Python 伪代码）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib, bisect, collections

ring = []                                      <span class="hljs-comment"># 有序哈希环</span>
vnode_map = {}                                <span class="hljs-comment"># 虚拟节点 → 物理节点</span>
VNODE_PER_NODE = <span class="hljs-number">150</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">_hash</span>(<span class="hljs-params">x</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(hashlib.md5(x.encode()).hexdigest(), <span class="hljs-number">16</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">add_node</span>(<span class="hljs-params">node</span>):
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(VNODE_PER_NODE):
        h = _<span class="hljs-built_in">hash</span>(<span class="hljs-string">f"<span class="hljs-subst">{node}</span>#<span class="hljs-subst">{v}</span>"</span>)
        ring.insert(bisect.bisect_left(ring, h), h)
        vnode_map[h] = node

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_node</span>(<span class="hljs-params">key</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ring: <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    h = _<span class="hljs-built_in">hash</span>(key)
    pos = bisect.bisect(ring, h) % <span class="hljs-built_in">len</span>(ring)
    <span class="hljs-keyword">return</span> vnode_map[ring[pos]]
</code></pre>
<p>增删节点只需 <code>add_node</code>/<code>remove_node</code>，调用端零感知。</p>
<hr/>
<h3 data-id="heading-5">6. 一句话总结</h3>
<p>一致性哈希 = <strong>“把节点和数据放到同一个环上，顺时针找邻居”</strong>，<br/>
让<strong>节点变化时的数据迁移量从 O(M) 降到 O(M/N)</strong>，<br/>
再加虚拟节点解决倾斜，就成为分布式系统里<strong>最优雅的数据分片方案</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026云服务器从零 搭建与运维 指南]]></title>    <link>https://juejin.cn/post/7591422577936728070</link>    <guid>https://juejin.cn/post/7591422577936728070</guid>    <pubDate>2026-01-04T08:36:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591422577936728070" data-draft-id="7590752433988862006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026云服务器从零 搭建与运维 指南"/> <meta itemprop="keywords" content="后端,服务器,JavaScript"/> <meta itemprop="datePublished" content="2026-01-04T08:36:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="百万前端向前冲"/> <meta itemprop="url" content="https://juejin.cn/user/641770519804926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026云服务器从零 搭建与运维 指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/641770519804926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    百万前端向前冲
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:36:45.000Z" title="Sun Jan 04 2026 08:36:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">⓪、购买服务器选择配置</h2>
<p>作为学生首次使用 选 Windows Server 系统 。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfa23a1c238b4fd68610abd69013540c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=GsbJW%2Fi8OzBlA48%2F2EsyMRjkfWA%3D" alt="图片.png" width="50%" loading="lazy"/>
<h2 data-id="heading-1">一、远程登录(win系统自带工具mstsc)</h2>
<h3 data-id="heading-2">1.1远程登录准备工作</h3>
<p>✍️创建一个本地记事本！！！记录下服务器公网IP、账号、密码:<br/>
建议大家刚开始用将服务器重新设置为默认的密码<br/>
（复制链接打开在云服务器控制台可以重置）<br/></p>
<p>IP地址:112.124.62.199 (公网IP)
账号:<code>administrator</code>
密码:<code>2026A#a1</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable constant_">IP</span>地址:<span class="hljs-number">112.124</span><span class="hljs-number">.62</span><span class="hljs-number">.199</span> (公网<span class="hljs-variable constant_">IP</span>)
账号:administrator 
密码:2026A#a1
</code></pre>
<h3 data-id="heading-3">1.2远程登录</h3>
<p>按键盘 Win+R键 输入 <code>mstsc</code> 点确定<br/></p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/966814c9ec6e4526865a9f69988fadae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=RpivCRAusjBh9lSouP0xWfgFI1s%3D" alt="图片.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec80db3cebb4d15ace481297b0f1db6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=6DpfpmSFxXXr%2FCHSydwt%2FUK03NQ%3D" alt="图片.png" width="70%" loading="lazy"/>
<h2 data-id="heading-4">三、服务器环境配置</h2>
<h3 data-id="heading-5">3.1 配置Node.js网站运行环境</h3>
<p>使用服务器 浏览器 访问网址<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload" target="_blank" title="https://nodejs.org/zh-cn/download" ref="nofollow noopener noreferrer">nodejs.org/zh-cn/downl…</a> ，下载Node.js V24以上
并安装。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cdcb12570b84a36b8d00ae8923f07e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=ZQ4Lr9Oy8%2B3vORFPpvcs948y6Q0%3D" alt="图片.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdc9ed7a0e814baca01f035fc0490190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=4osJTbkJ2eS%2BwEXQHuSiGJAqMX8%3D" alt="图片.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5703aa8aab64cc5b175decfa2193f83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=ZIe7NmIkBcRLu43NUKdwVfO7mFE%3D" alt="图片.png" loading="lazy"/></p>
<h3 data-id="heading-6">3.2 将代码上传至云服务器(远程电脑)</h3>
<p>简单来说就是要共享硬盘给远程电脑。
在D盘或者E盘创建一个文件夹A 或者0104，将你需要展示的首页代码放入该文件夹，
同时下载 生菜服务器代码 <code>SC.js</code>(原名 生菜服务器1.7.0)</p>
<h5 data-id="heading-7">1）准备代码文件和素材</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6c9b4c863c0444da55b540b42441201~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=xVr79Nb6cQWu37ixmiSwCQ4W1Ok%3D" alt="图片.png" loading="lazy"/></p>
<h5 data-id="heading-8">2）共享本地硬盘给 服务器电脑</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99ed275ad645499daf459a69e6171e8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=tCOb5AZV82GMmcQjjnl739NhLiE%3D" alt="dbc994b353fec7cbc009feff56207338.png" loading="lazy"/></p>
<h5 data-id="heading-9">3）点击回收站，进入我的电脑，查看共享的硬盘，把文件夹拖到桌面</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e5a37cfdf7c4660931edb765151bd7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=MXrdEjX37BlBjcHvrRlZu06zUfg%3D" alt="16ad31727504d101ba0ca19b308c52bd_720.png" loading="lazy"/></p>
<h5 data-id="heading-10">4）找到代码文件夹 拖到服务器电脑的桌面</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57dbe1eaffeb44e3a62285090aec651b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=v4gXqy1FOgRWW%2BpwLt%2BOHfEP9kw%3D" alt="图片.png" loading="lazy"/></p>
<h5 data-id="heading-11">5）启动生菜服务器，这个窗口不要关</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41451454138f40a5a281fbdd6f159ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=dgtjqNGjSqm05z0qZkRT062SJfU%3D" alt="图片.png" loading="lazy"/></p>
<p>特别注意:后续传HTML+CSS+JS都不需要重启服务器。只要保持黑色窗口启动服务器，过几分钟自动会刷新。</p>
<h2 data-id="heading-12">四、开启云服务器防火墙允许80端口</h2>
<p>现在只差最后一步，因为云服务器的自带的安全策略显示，网站的80端口没有对外开放，我们增加80端口的对外开放即可。</p>
<h3 data-id="heading-13">4.1 进入ECS 控制台实例</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fecs.console.aliyun.com%2Fserver%2F" target="_blank" title="https://ecs.console.aliyun.com/server/" ref="nofollow noopener noreferrer">ecs.console.aliyun.com/server/</a>
依次进入:ECS示例→网络与安全组→添加入站方向规则
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80f346c92d3643d681371dcb7e0f0424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=Jlu0YihX0CiK%2Bsd3Z9pWGv3LerU%3D" alt="4a2d71ab4fe84a3bb7c775d8c4a20fd7_720.png" loading="lazy"/></p>
<h3 data-id="heading-14">4.2 添加http 80端口规则</h3>
<p>如下图所示确定。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/922649ba659948e28a8889a1f1b41388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=OTkb%2BzmcHiqE3o9KcYA3kutrU0A%3D" alt="3fb4181539af37311d6fc43178e8e288_720.png" loading="lazy"/></p>
<h3 data-id="heading-15">4.3 浏览器输入公网IP访问即可。</h3>
<p>公网IP支持任意可以上网的设备，包括手机、电脑等。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek新年炸场：给失控的AI模型装上数学红绿灯]]></title>    <link>https://juejin.cn/post/7591317772074582035</link>    <guid>https://juejin.cn/post/7591317772074582035</guid>    <pubDate>2026-01-04T14:40:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591317772074582035" data-draft-id="7591334602427236415" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek新年炸场：给失控的AI模型装上数学红绿灯"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-04T14:40:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek新年炸场：给失控的AI模型装上数学红绿灯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:40:05.000Z" title="Sun Jan 04 2026 14:40:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年的跨年夜，当大多数人还在倒数计时迎接新年的时候，DeepSeek的团队干了一件非常极客的事——他们甩出了一篇重磅论文。</p>
<p>这篇名为《mHC: Manifold-Constrained Hyper-Connections》的论文，看似标题充满了晦涩的数学名词，但实际上，它可能刚刚解开了困扰大模型界已久的一个死结：<strong>模型越大，越容易练崩。</strong></p>
<p>今天我们就抛开那些复杂的公式，用人话聊聊这项可能定义“后Transformer时代”的新技术。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.28.40-1024x547.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.28.40-1024x547.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e57f8fd38846818d099a20c8e5cca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=IhJA2XveVygi%2BHz06LgqGly%2FWp0%3D" alt="iShot_2026-01-04_22.28.40" loading="lazy"/></a></p>
<h3 data-id="heading-0">贪婪的代价：当“宽带”变成灾难</h3>
<p>过去这十年，深度学习能发展这么快，何凯明大神的ResNet（残差连接）功不可没。你可以把它想象成一条“直通车道”，保证了信息在深层网络中不会迷路。</p>
<p>到了2024年，字节跳动搞出了一个叫“超连接”（Hyper-Connections, HC）的东西。思路很直接：既然一条直通车道好用，那我把车道拓宽成十条、百条，让信息在不同车道间随意穿梭、交互，模型能力岂不是要起飞？</p>
<p>确实，HC让模型的表达能力变强了，但也带来了一个致命副作用——<strong>信号失控</strong>。</p>
<p>想象一下，你把原来的单行道改成了一个没有交通规则的超级广场。信息在里面疯狂碰撞、叠加。DeepSeek的实验数据显示，在传统的HC架构下，随着层数加深，信号强度可能会被无脑放大3000倍。这就好比你在麦克风前轻声说句话，音响里出来的却是核爆般的噪音。</p>
<p>结果就是：显存爆炸，梯度消失，训练曲线像过山车一样出现尖峰，最后模型彻底“练废了”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.28.48-1024x409.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.28.48-1024x409.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba5566a1a6e045bcaaf42841aedc514e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=p0V09wZX0IJ6quqAFm6FSpTmqOo%3D" alt="iShot_2026-01-04_22.28.48" loading="lazy"/></a></p>
<h3 data-id="heading-1">戴着镣铐跳舞：mHC的优雅解法</h3>
<p>DeepSeek提出的mHC（流形约束超连接），本质上就是给那个混乱的超级广场装上了一套极其精密的“智能红绿灯系统”。</p>
<p>这里的核心魔法在于**“流形约束”**。</p>
<p>团队引入了数学上的“双随机矩阵”概念。简单来说，他们通过一个叫Sinkhorn-Knopp的经典算法，强制要求网络中的每一次信息交换都必须遵守一个规则：<strong>能量守恒</strong>。不管信息怎么变道、怎么混合，进去多少能量，出来还是多少能量。</p>
<p>这种做法把原本狂野的信号放大变成了信号的“凸组合”（Convex Combination）。这就像调鸡尾酒，不管你怎么摇晃混合，酒的总量不会凭空变多，也不会凭空消失。</p>
<p>这一改，奇迹发生了。</p>
<p>原本可能放大3000倍的信号，现在被稳稳控制在1.6倍左右。那条原本还要靠运气才能跑通的训练曲线，瞬间变得丝般顺滑。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.28.54-1024x178.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.28.54-1024x178.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/598287a8b2d54729b2e5e0817677d307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=UbxfNoC%2Bcbylfo3hGqPhAe0e7Yc%3D" alt="iShot_2026-01-04_22.28.54" loading="lazy"/></a></p>
<h3 data-id="heading-2">极其抠门的工程优化</h3>
<p>光有数学理论没用，如果跑得慢，工业界根本不会看一眼。DeepSeek这帮人最可怕的地方在于，他们不仅懂数学，还极其擅长抠算力。</p>
<p>为了把这个复杂的数学约束搬到GPU上跑，他们做了一系列“丧心病狂”的优化：</p>
<ol>
<li><strong>算子融合</strong>：把好几个计算步骤揉成一步做，减少GPU读取内存的次数。</li>
<li><strong>选择性重计算</strong>：为了省显存，有些中间结果算完就扔，需要时再算，而且他们算准了哪些该扔、哪些该留。</li>
</ol>
<p>结果如何？在把模型宽度扩展4倍的情况下，mHC架构只增加了**6.7%**的额外训练时间。这就好比你给法拉利换了个更稳的引擎，极速没掉，油耗也没怎么涨。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.29.00-1024x397.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.29.00-1024x397.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75bfe28a0c53414fa8f45a6f237f64a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=yzE3zgZU35BnV22%2BEdtxftNTbdA%3D" alt="iShot_2026-01-04_22.29.00" loading="lazy"/></a></p>
<h3 data-id="heading-3">实战：27B模型的全面碾压</h3>
<p>DeepSeek没在小模型上玩过家家，直接拿27B参数的模型开刀。</p>
<p>实验结果非常“凡尔赛”：</p>
<ul>
<li><strong>稳</strong>：那些让工程师头秃的Loss尖峰完全消失。</li>
<li><strong>强</strong>：在数学推理（GSM8K）、常识问答（BBH）等8项硬核测试中，全面吊打基线模型。特别是在需要绕弯子思考的BBH和DROP任务上，直接提升了约2%的性能。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.29.07-1024x320.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.29.07-1024x320.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2678e783ca2b43718b3da5c98062d442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=mlH9v0DiPi5m2JO8RmXVhkDBobA%3D" alt="iShot_2026-01-04_22.29.07" loading="lazy"/></a></p>
<h3 data-id="heading-4">为什么这很重要？</h3>
<p>你可能会觉得，这不就是一个架构微调吗？</p>
<p>其实不然。mHC的出现标志着大模型设计的一个转折点。它告诉我们，单纯地堆参数、堆层数已经快走到头了。未来的方向，是研究层与层之间如何更“几何”地连接。</p>
<p>DeepSeek用mHC证明了：在这个算力昂贵的时代，<strong>数学上的严谨约束，反而是通向更大自由度的捷径。</strong></p>
<p>这不仅仅是让大厂能更稳地训练万亿模型，也让资源有限的团队不再因为一次“炸炉”而倾家荡产。这就是技术的浪漫之处——用最抽象的数学，解决最现实的难题。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI 从 0 到 1：史上最良心的现代 Python Web 框架入门指南]]></title>    <link>https://juejin.cn/post/7591309945511149568</link>    <guid>https://juejin.cn/post/7591309945511149568</guid>    <pubDate>2026-01-04T14:47:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945511149568" data-draft-id="7591309945511133184" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI 从 0 到 1：史上最良心的现代 Python Web 框架入门指南"/> <meta itemprop="keywords" content="FastAPI"/> <meta itemprop="datePublished" content="2026-01-04T14:47:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI 从 0 到 1：史上最良心的现代 Python Web 框架入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:47:04.000Z" title="Sun Jan 04 2026 14:47:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>标签：<br/>
FastAPI · Python · 异步 · 类型提示 · 自动生成文档 · 高性能</p>
<hr/>
<h2 data-id="heading-0">一、为什么又是新框架？</h2>
<p>Django / Flask 已经够好了，但新时代有了新痛点：</p>
<ol>
<li>前后端分离 → 需要<strong>强制类型 &amp; 自动文档</strong></li>
<li>高并发 IO → 需要<strong>原生异步</strong></li>
<li>机器学习模型上线 → 需要<strong>高性能 + 自动序列化</strong></li>
</ol>
<p>FastAPI = Starlette（异步）+ Pydantic（数据校验）+ 自动生成 OpenAPI 文档，三箭齐发，官方 benchmark  latency 直追 NodeJS 和 Go。</p>
<hr/>
<h2 data-id="heading-1">二、5 分钟跑通 Hello World</h2>
<p>安装</p>
<pre><code class="hljs language-bash" lang="bash">pip install <span class="hljs-string">"fastapi[all]"</span>   <span class="hljs-comment"># all = uvicorn + 常用 extras</span>
</code></pre>
<p>main.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

app = FastAPI(title=<span class="hljs-string">"Hello API"</span>)

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"Hello FastAPI"</span>}
</code></pre>
<p>启动</p>
<pre><code class="hljs language-bash" lang="bash">uvicorn main:app --reload
</code></pre>
<p>浏览器访问 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000" target="_blank" title="http://127.0.0.1:8000" ref="nofollow noopener noreferrer">http://127.0.0.1:8000</a><br/>
交互式文档 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000%2Fdocs" target="_blank" title="http://127.0.0.1:8000/docs" ref="nofollow noopener noreferrer">http://127.0.0.1:8000/docs</a>（Swagger UI）自动生成！</p>
<hr/>
<h2 data-id="heading-2">三、类型提示 = 自动生成文档 + 运行时校验</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    name: <span class="hljs-built_in">str</span>
    price: <span class="hljs-built_in">float</span>
    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/items/"</span>, response_model=Item</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):
    <span class="hljs-keyword">if</span> item.tax:
        item.price += item.tax
    <span class="hljs-keyword">return</span> item    <span class="hljs-comment"># 自动序列化 JSON</span>
</code></pre>
<ul>
<li>请求体少字段 → 422 错误 + 详细位置提示</li>
<li>文档里 Schema 与代码<strong>单点真理</strong>，永不同步失败</li>
</ul>
<hr/>
<h2 data-id="heading-3">四、异步全程高能</h2>
<p>FastAPI 默认基于 <code>async def</code>，与 <code>asyncio</code>、<code>aiohttp</code>、<code>aiomysql</code> 全家桶无缝协作：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> aiohttp <span class="hljs-keyword">import</span> ClientSession

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/proxy"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">proxy</span>():
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> ClientSession() <span class="hljs-keyword">as</span> sess:
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> sess.get(<span class="hljs-string">"https://httpbin.org/delay/2"</span>) <span class="hljs-keyword">as</span> r:
            data = <span class="hljs-keyword">await</span> r.json()
    <span class="hljs-keyword">return</span> data
</code></pre>
<p>单进程可并发 1000+ 慢 IO 请求，latency 远低于同步框架。</p>
<hr/>
<h2 data-id="heading-4">五、路径参数 &amp; 查询参数一把梭</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/user/{user_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, q: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"user_id"</span>: user_id, <span class="hljs-string">"q"</span>: q, <span class="hljs-string">"limit"</span>: limit}
</code></pre>
<ul>
<li><code>user_id</code> 自动校验 int → 非法返回 422</li>
<li><code>q</code> 可选，缺省 None</li>
<li>文档实时体现参数类型、默认值</li>
</ul>
<hr/>
<h2 data-id="heading-5">六、依赖注入 —— 像 Spring 一样优雅</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, HTTPException, status
<span class="hljs-keyword">from</span> fastapi.security <span class="hljs-keyword">import</span> HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_current_user</span>(<span class="hljs-params">token: HTTPAuthorizationCredentials = Depends(<span class="hljs-params">security</span>)</span>):
    <span class="hljs-keyword">if</span> token.credentials != <span class="hljs-string">"fake-token"</span>:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=status.HTTP_401_UNAUTHORIZED,
                            detail=<span class="hljs-string">"Invalid token"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"uid"</span>: <span class="hljs-number">42</span>}

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/secure"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">secure_endpoint</span>(<span class="hljs-params">user=Depends(<span class="hljs-params">get_current_user</span>)</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"secret data"</span>, <span class="hljs-string">"user"</span>: user}
</code></pre>
<p>依赖可嵌套、可复用，单元测试时直接 mock 依赖即可。</p>
<hr/>
<h2 data-id="heading-6">七、上线必备：CORS / 静态文件 / 异常处理</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware
<span class="hljs-keyword">from</span> fastapi.staticfiles <span class="hljs-keyword">import</span> StaticFiles
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse

app.add_middleware(
    CORSMiddleware,
    allow_origins=[<span class="hljs-string">"*"</span>],
    allow_methods=[<span class="hljs-string">"*"</span>],
    allow_headers=[<span class="hljs-string">"*"</span>],
)

app.mount(<span class="hljs-string">"/static"</span>, StaticFiles(directory=<span class="hljs-string">"static"</span>), name=<span class="hljs-string">"static"</span>)

<span class="hljs-meta">@app.exception_handler(<span class="hljs-params">ValueError</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">value_error_handler</span>(<span class="hljs-params">request, exc</span>):
    <span class="hljs-keyword">return</span> JSONResponse(status_code=<span class="hljs-number">400</span>,
                        content={<span class="hljs-string">"detail"</span>: <span class="hljs-built_in">str</span>(exc)})
</code></pre>
<p>全同步/异步混合写皆可，保持代码风格一致。</p>
<hr/>
<h2 data-id="heading-7">八、与 SQL 数据库联动 —— 异步 ORM 示例</h2>
<pre><code class="hljs language-bash" lang="bash">pip install databases[aiosqlite] sqlalchemy
</code></pre>
<p>database.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> databases <span class="hljs-keyword">import</span> Database
database = Database(<span class="hljs-string">"sqlite+aiosqlite:///./demo.db"</span>)
</code></pre>
<p>model.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlalchemy
metadata = sqlalchemy.MetaData()
notes = sqlalchemy.Table(
    <span class="hljs-string">"notes"</span>,
    metadata,
    sqlalchemy.Column(<span class="hljs-string">"id"</span>, sqlalchemy.Integer, primary_key=<span class="hljs-literal">True</span>),
    sqlalchemy.Column(<span class="hljs-string">"text"</span>, sqlalchemy.String),
    sqlalchemy.Column(<span class="hljs-string">"completed"</span>, sqlalchemy.Boolean),
)
</code></pre>
<p>main.py 节选</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"startup"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup</span>():
    <span class="hljs-keyword">await</span> database.connect()

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"shutdown"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shutdown</span>():
    <span class="hljs-keyword">await</span> database.disconnect()

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/notes/"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_note</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):
    query = notes.insert().values(text=text, completed=<span class="hljs-literal">False</span>)
    last_record_id = <span class="hljs-keyword">await</span> database.execute(query)
    <span class="hljs-keyword">return</span> {**<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">id</span>=last_record_id, text=text, completed=<span class="hljs-literal">False</span>)}
</code></pre>
<p>全程 <code>async</code>，吞吐量比同步 SQL 提高一个量级。</p>
<hr/>
<h2 data-id="heading-8">九、性能 &amp; 生态</h2>
<ul>
<li><strong>Starlette</strong> 打底：支持 HTTP/2、WebSocket、GraphQL</li>
<li><strong>Pydantic</strong> 加持：校验速度是传统 schema 库的 2~4 倍</li>
<li><strong>Uvicorn + Gunicorn</strong> 多 worker 部署，8 核轻松破 10k RPS</li>
<li>官方 benchmark：FastAPI  latency 与 Starlette/Go Echo 同级，<strong>比 Flask 快 3~5 倍</strong></li>
</ul>
<hr/>
<h2 data-id="heading-9">十、部署一条命令</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 本地开发</span>
uvicorn main:app --reload

<span class="hljs-comment"># 生产多核</span>
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --<span class="hljs-built_in">bind</span> 0.0.0.0:8000
</code></pre>
<p>Dockerfile 示例</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
</code></pre>
<p>镜像 &lt;100 MB，K8s/Serverless 随意扩。</p>
<hr/>
<h2 data-id="heading-10">十一、总结：一张图记住 FastAPI</h2>
<pre><code class="hljs language-lua" lang="lua">┌<span class="hljs-comment">-------------┐        ┌------------┐</span>
│ Pydantic    │ &lt;<span class="hljs-comment">-----&gt;│ 请求/响应   │  &lt;-- 自动校验+序列化</span>
│ 数据模型     │        │ 类型提示    │
└<span class="hljs-comment">-------------┘        └------------┘</span>
        ^                       |
        |                       v
┌<span class="hljs-comment">-------------┐        ┌------------┐</span>
│ 依赖注入     │        │ OpenAPI    │  &lt;<span class="hljs-comment">-- 自动生成 docs</span>
│ 安全/DB/逻辑 │        │ 文档/redoc │
└<span class="hljs-comment">-------------┘        └------------┘</span>
        ^                       |
        |                       v
┌<span class="hljs-comment">-------------------------------┐</span>
│ Starlette（ASGI）异步核心      │  &lt;<span class="hljs-comment">-- 高性能</span>
└<span class="hljs-comment">-------------------------------┘</span>
</code></pre>
<p>FastAPI = <strong>类型提示 + 异步 + 自动生成文档</strong> 三箭齐发，<br/>
写更少代码，跑更快服务，出更全文档。2024 年了，如果你还在手写 Swagger JSON，不妨给 FastAPI 一个周末，它会还你整个生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我为自己起了个笔名]]></title>    <link>https://juejin.cn/post/7591338980693770286</link>    <guid>https://juejin.cn/post/7591338980693770286</guid>    <pubDate>2026-01-04T13:05:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591338980693770286" data-draft-id="7591346773827797018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我为自己起了个笔名"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-04T13:05:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏渡苇"/> <meta itemprop="url" content="https://juejin.cn/user/729731453429159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我为自己起了个笔名
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/729731453429159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏渡苇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:05:49.000Z" title="Sun Jan 04 2026 13:05:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我决定把所有平台的网名改成笔名“苏渡苇”。</p>
<p>其实改这个名字，是因为翻古文观止又翻到了苏轼的《赤壁赋》。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7f1107c9509460d865a6c230fce1678~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5rih6IuH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768136749&amp;x-signature=x2bHirx14UVSDZ9PEJjco6dxvoo%3D" alt="古文观止 苏轼·前赤壁赋" loading="lazy"/></p>
<p>古文观止 苏轼·前赤壁赋</p>
<p>读到“纵一苇之所如，凌万顷之茫然”那句时，我似乎正在发呆。窗外是城市零星的光，不是苏轼渡的江，但心里的茫然是真的。那一瞬间，我好像看见了九百多年“一蓑烟雨任平生”的苏轼——他总是那样乐观，纵使困顿难行，依然发现自己竟可以像一片苇叶那样，托付给江水和月光。</p>
<p>这种接纳破碎、并从中发现自由的姿态，便是我心中的苏轼最深的浪漫。它不是风花雪月，而是一种巨大的诚实。他诚实地面对自己的狼狈，也诚实地发现了天地间还有清风明月不需要用功名去换。</p>
<p>所以，“苏渡苇”这三个字，对我而言就是一种朴素的提醒。它不意味着我能立刻拥有他的旷达，而是说，当我感到自己往下沉的时候，至少可以想起，曾经有人这样处理眼前的狼藉：当路走到头，就在旁边坐下，看看此处的风景有什么别致；当事与愿违，就把“违”的部分，也接进生命里来。</p>
<p>我不奢求一个名字就可以渡什么万顷茫然，能渡得了生活里一些具体的、琐碎的沮丧，就够了。它像放在书桌角落的一根真正的芦苇，干燥，轻盈，提醒我另一种可能的存在。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[利用元旦假期，我开源了一个大模型智能面试平台+知识库！]]></title>    <link>https://juejin.cn/post/7591349113355698185</link>    <guid>https://juejin.cn/post/7591349113355698185</guid>    <pubDate>2026-01-04T13:19:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591349113355698185" data-draft-id="7591360623469461514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="利用元旦假期，我开源了一个大模型智能面试平台+知识库！"/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2026-01-04T13:19:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaGuide"/> <meta itemprop="url" content="https://juejin.cn/user/166781497383294"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            利用元旦假期，我开源了一个大模型智能面试平台+知识库！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781497383294/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaGuide
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:19:10.000Z" title="Sun Jan 04 2026 13:19:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是 Guide。利用元旦假期，我开源了一个基于 Spring Boot 4.0 + Java 21 + Spring AI + PostgreSQL + pgvector + RustFS + Redis 的大模型项目，实现了简历智能分析、AI 模拟面试、知识库 RAG 检索等核心功能。</p>
<h2 data-id="heading-0">项目介绍</h2>
<p>InterviewGuide 是一个集成了简历分析、模拟面试和知识库管理的智能面试辅助平台。系统利用大语言模型（LLM）和向量数据库技术，为求职者和 HR 提供智能化的简历评估和面试练习服务。</p>
<ul>
<li>Github 地址：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSnailclimb%2Finterview-guide" target="_blank" title="https://github.com/Snailclimb/interview-guide" ref="nofollow noopener noreferrer">github.com/Snailclimb/…</a></strong></li>
<li>Gitee 地址：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FSnailClimb%2Finterview-guide" target="_blank" title="https://gitee.com/SnailClimb/interview-guide" ref="nofollow noopener noreferrer">gitee.com/SnailClimb/…</a></strong></li>
</ul>
<h2 data-id="heading-1">系统架构</h2>
<p><strong>提示</strong>：架构图采用 draw.io 绘制，导出为 svg 格式，在 Github Dark 模式下的显示效果会有问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/217805d2f0e2460caddd91e56bbb82b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=xX%2Bz%2FBpdG4i8LkT5Ls0neF9eEZI%3D" alt="" loading="lazy"/></p>
<p><strong>异步处理流程</strong>：</p>
<p>简历分析和知识库向量化采用 Redis Stream 异步处理：</p>
<pre><code class="hljs language-arduino" lang="arduino">上传请求 → 保存文件 → 发送消息到 <span class="hljs-built_in">Stream</span> → 立即返回
                              ↓
                      Consumer 消费消息
                              ↓
                    执行分析/向量化任务
                              ↓
                      更新数据库状态
                              ↓
                   前端轮询获取最新状态
</code></pre>
<p>状态流转： <code>PENDING</code> → <code>PROCESSING</code> → <code>COMPLETED</code> / <code>FAILED</code></p>
<h2 data-id="heading-2">技术栈</h2>
<h3 data-id="heading-3">后端技术</h3>























































<table><thead><tr><th>技术</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>Spring Boot</td><td>4.0</td><td>应用框架</td></tr><tr><td>Java</td><td>21</td><td>开发语言</td></tr><tr><td>Spring AI</td><td>2.0</td><td>AI 集成框架</td></tr><tr><td>PostgreSQL + pgvector</td><td>14+</td><td>关系数据库 + 向量存储</td></tr><tr><td>Redis</td><td>6+</td><td>缓存 + 消息队列（Stream）</td></tr><tr><td>Apache Tika</td><td>2.9.2</td><td>文档解析</td></tr><tr><td>iText 8</td><td>8.0.5</td><td>PDF 导出</td></tr><tr><td>MapStruct</td><td>1.6.3</td><td>对象映射</td></tr><tr><td>Gradle</td><td>8.14</td><td>构建工具</td></tr></tbody></table>
<p>技术选型常见问题解答：</p>
<ol start="0">
<li>
<p>数据存储为什么选择 PostgreSQL + pgvector？PG 的向量数据存储功能够用了，精简架构，不想引入太多组件。</p>
</li>
<li>
<p>为什么引入 Redis？</p>
<ul>
<li>Redis 替代 <code>ConcurrentHashMap</code> 实现面试会话的缓存。</li>
<li>基于 Redis Stream 实现简历分析、知识库向量化等场景的异步（还能解耦，分析和向量化可以使用其他编程语言来做）。不使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fhigh-performance%2Fmessage-queue%2Fkafka-questions-01.html" target="_blank" title="https://javaguide.cn/high-performance/message-queue/kafka-questions-01.html" ref="nofollow noopener noreferrer">Kafka</a> 这类成熟的消息队列，也是不想引入太多组件。</li>
</ul>
</li>
<li>
<p>构建工具为什么选择 Gradle？个人更喜欢用 Gradle，也写过相关的文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Ftools%2Fgradle%2Fgradle-core-concepts.html" target="_blank" title="https://javaguide.cn/tools/gradle/gradle-core-concepts.html" ref="nofollow noopener noreferrer">Gradle核心概念总结</a>。</p>
</li>
</ol>
<h3 data-id="heading-4">前端技术</h3>


















































<table><thead><tr><th>技术</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>React</td><td>18.3</td><td>UI 框架</td></tr><tr><td>TypeScript</td><td>5.6</td><td>开发语言</td></tr><tr><td>Vite</td><td>5.4</td><td>构建工具</td></tr><tr><td>Tailwind CSS</td><td>4.1</td><td>样式框架</td></tr><tr><td>React Router</td><td>7.11</td><td>路由管理</td></tr><tr><td>Framer Motion</td><td>12.23</td><td>动画库</td></tr><tr><td>Recharts</td><td>3.6</td><td>图表库</td></tr><tr><td>Lucide React</td><td>-</td><td>图标库</td></tr></tbody></table>
<h2 data-id="heading-5">功能特性</h2>
<h3 data-id="heading-6">简历管理模块</h3>
<ul>
<li>多格式支持：PDF、DOCX、DOC、TXT</li>
<li>异步分析：上传后立即返回，后台 Redis Stream 处理</li>
<li>状态轮询：实时显示分析进度（待分析/分析中/已完成/失败）</li>
<li>自动重试：分析失败自动重试（最多 3 次）</li>
<li>简历去重：基于内容哈希检测重复</li>
<li>PDF 报告导出</li>
</ul>
<h3 data-id="heading-7">模拟面试模块</h3>
<ul>
<li>基于简历生成个性化面试问题</li>
<li>实时问答交互</li>
<li>多维度评分（技术能力、沟通能力等）</li>
<li>面试报告生成和导出</li>
<li>雷达图可视化展示</li>
<li>面试历史统计</li>
</ul>
<h3 data-id="heading-8">知识库管理模块</h3>
<ul>
<li>多格式支持：PDF、DOCX、DOC、TXT、Markdown</li>
<li>文档上传和自动分块</li>
<li>异步向量化处理</li>
<li>RAG 检索增强生成</li>
<li>流式响应（SSE）</li>
<li>智能问答对话</li>
<li>知识库统计信息</li>
</ul>
<h3 data-id="heading-9">TODO</h3>
<ul>
<li>问答助手的 Markdown 展示优化</li>
<li>知识库管理页面的下载</li>
<li>异步生成模拟面试评估报告</li>
<li>模拟面试增加追问功能</li>
<li>打通模拟面试和知识库</li>
</ul>
<h2 data-id="heading-10">效果展示</h2>
<h3 data-id="heading-11">简历与面试</h3>
<p>简历库：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dc7cc8ff470499e958982ed95123f0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=MSXt9QljlslJXaNu%2F14tfqx%2FFmg%3D" alt="" loading="lazy"/></p>
<p>简历上传分析：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14ca9132ed334766b8f53ef0e7dd2e1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=UPE2NKVnqMjAcB5%2Bn1hDzpd2XD8%3D" alt="" loading="lazy"/></p>
<p>简历分析详情：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef468ba8ee6a45639526a4eb6a6fb96d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=vgGh%2BpL1lWgIeguPzHLuvWlYEGY%3D" alt="" loading="lazy"/></p>
<p>面试记录：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/943552cd935c4c01acf8217ede855d33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=RMqQfl%2BlKwv8LVPubOjGkKkRpR4%3D" alt="" loading="lazy"/></p>
<p>面试详情：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e6c919cf693432aa1284949a8e1bda7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=%2Fdakm2zT22X2IgtrdiB80NoYANY%3D" alt="" loading="lazy"/></p>
<p>模拟面试：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f141295e5634b689f049884f6bfef42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=FBwEJfcLrq1ocHXQzWI9nABkvtg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">知识库</h3>
<p>知识库管理：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/305f368e4399439ea56b61ef8f76513a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=mQZY6JVN33xFO4ebhWmbVP5RhWM%3D" alt="" loading="lazy"/></p>
<p>问答助手：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/052629e6935f4f18b01d162ef594bdd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=OvdleNm%2BXgj8FNZSiiOlyUHZKkI%3D" alt="page-qa-assistant" loading="lazy"/></p>
<h2 data-id="heading-13">项目结构</h2>
<pre><code class="hljs language-bash" lang="bash">interview-guide/
├── app/                              <span class="hljs-comment"># 后端应用</span>
│   ├── src/main/java/interview/guide/
│   │   ├── App.java                  <span class="hljs-comment"># 主启动类</span>
│   │   ├── common/                   <span class="hljs-comment"># 通用模块</span>
│   │   │   ├── config/               <span class="hljs-comment"># 配置类</span>
│   │   │   ├── exception/            <span class="hljs-comment"># 异常处理</span>
│   │   │   └── result/               <span class="hljs-comment"># 统一响应</span>
│   │   ├── infrastructure/           <span class="hljs-comment"># 基础设施</span>
│   │   │   ├── <span class="hljs-built_in">export</span>/               <span class="hljs-comment"># PDF 导出</span>
│   │   │   ├── file/                 <span class="hljs-comment"># 文件处理</span>
│   │   │   ├── redis/                <span class="hljs-comment"># Redis 服务</span>
│   │   │   └── storage/              <span class="hljs-comment"># 对象存储</span>
│   │   └── modules/                  <span class="hljs-comment"># 业务模块</span>
│   │       ├── interview/            <span class="hljs-comment"># 面试模块</span>
│   │       ├── knowledgebase/        <span class="hljs-comment"># 知识库模块</span>
│   │       └── resume/               <span class="hljs-comment"># 简历模块</span>
│   └── src/main/resources/
│       ├── application.yml           <span class="hljs-comment"># 应用配置</span>
│       └── prompts/                  <span class="hljs-comment"># AI 提示词模板</span>
│
├── frontend/                         <span class="hljs-comment"># 前端应用</span>
│   ├── src/
│   │   ├── api/                      <span class="hljs-comment"># API 接口</span>
│   │   ├── components/               <span class="hljs-comment"># 公共组件</span>
│   │   ├── pages/                    <span class="hljs-comment"># 页面组件</span>
│   │   ├── types/                    <span class="hljs-comment"># 类型定义</span>
│   │   └── utils/                    <span class="hljs-comment"># 工具函数</span>
│   ├── package.json
│   └── vite.config.ts
│
└── README.md
</code></pre>
<h2 data-id="heading-14">快速开始</h2>
<p>环境要求：</p>








































<table><thead><tr><th>依赖</th><th>版本</th><th>必需</th></tr></thead><tbody><tr><td>JDK</td><td>21+</td><td>是</td></tr><tr><td>Node.js</td><td>18+</td><td>是</td></tr><tr><td>PostgreSQL</td><td>14+</td><td>是</td></tr><tr><td>pgvector 扩展</td><td>-</td><td>是</td></tr><tr><td>Redis</td><td>6+</td><td>是</td></tr><tr><td>S3 兼容存储</td><td>-</td><td>是</td></tr></tbody></table>
<h3 data-id="heading-15">1. 克隆项目</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/Snailclimb/interview-guide.git
<span class="hljs-built_in">cd</span> interview-guide
</code></pre>
<h3 data-id="heading-16">2. 配置数据库</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建数据库</span>
<span class="hljs-keyword">CREATE</span> DATABASE interview_guide;
​
<span class="hljs-comment">-- 连接数据库并启用 pgvector 扩展（可选，启动后端SpringAI框架底层会自动创建）</span>
<span class="hljs-keyword">CREATE</span> EXTENSION vector;
</code></pre>
<h3 data-id="heading-17">3. 配置环境变量</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># AI API 密钥（阿里云 DashScope）</span>
export <span class="hljs-attr">AI_BAILIAN_API_KEY</span>=your_api_key
</code></pre>
<h3 data-id="heading-18">4. 修改应用配置</h3>
<p>编辑 <code>app/src/main/resources/application.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># PostgreSQL数据库配置</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:postgresql://localhost:5432/interview_guide</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">your_username</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">your_password</span>
<span class="hljs-string">​</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
<span class="hljs-string">​</span>
<span class="hljs-comment"># RustFS (S3兼容) 存储配置</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">storage:</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">http://localhost:9000</span>
    <span class="hljs-attr">access-key:</span> <span class="hljs-string">your_access_key</span>
    <span class="hljs-attr">secret-key:</span> <span class="hljs-string">your_secret_key</span>
    <span class="hljs-attr">bucket:</span> <span class="hljs-string">interview-guide</span>
    
 <span class="hljs-comment"># Redisson配置</span>
<span class="hljs-attr">redisson:</span>
  <span class="hljs-attr">config:</span> <span class="hljs-string">|
    singleServerConfig:
      address: "redis://localhost:6379"
      database: 0
      idleConnectionTimeout: 10000
      connectTimeout: 10000
      timeout: 3000
      retryAttempts: 3
      retryInterval: 1500
      password: null
      subscriptionsPerConnection: 5
      clientName: null
      subscriptionConnectionMinimumIdleSize: 1
      subscriptionConnectionPoolSize: 50
      connectionMinimumIdleSize: 10
      connectionPoolSize: 64
      dnsMonitoringInterval: 5000
</span><span class="hljs-string">​</span>
</code></pre>
<h3 data-id="heading-19">5. 启动服务</h3>
<p><strong>后端：</strong></p>
<pre><code class="hljs language-bash" lang="bash">./gradlew bootRun
</code></pre>
<p>后端服务启动于 <code>http://localhost:8080</code></p>
<p><strong>前端：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> frontend
pnpm install
pnpm dev
</code></pre>
<p>前端服务启动于 <code>http://localhost:5173</code></p>
<h2 data-id="heading-20">使用场景</h2>





















<table><thead><tr><th>用户角色</th><th>使用场景</th></tr></thead><tbody><tr><td><strong>求职者</strong></td><td>上传简历获取分析建议，进行模拟面试练习</td></tr><tr><td><strong>HR/招聘人员</strong></td><td>批量分析简历，评估候选人能力</td></tr><tr><td><strong>培训机构</strong></td><td>提供面试培训服务，管理知识库资源</td></tr></tbody></table>
<h2 data-id="heading-21">常见问题</h2>
<h3 data-id="heading-22">Q: 简历分析失败</h3>
<p>检查一下阿里云 DashScope API KEY 是否配置正确（申请地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F" target="_blank" title="https://bailian.console.aliyun.com/" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/</a>）。</p>
<h3 data-id="heading-23">Q: 简历分析一直显示"分析中"？</h3>
<p>检查 Redis 连接和 Stream Consumer 是否正常运行。查看后端日志确认是否有错误。</p>
<h3 data-id="heading-24">Q: 知识库问答没有响应？</h3>
<p>确认知识库已完成向量化（状态为 COMPLETED），检查 pgvector 扩展是否正确安装。</p>
<h3 data-id="heading-25">Q: PDF 导出失败？</h3>
<p>检查 iText 依赖是否正确，确认字体文件存在。</p>
<h2 data-id="heading-26">分支说明</h2>

















<table><thead><tr><th>分支</th><th>说明</th></tr></thead><tbody><tr><td><code>master</code></td><td>主分支，包含完整功能（Redis Stream 异步处理）</td></tr><tr><td><code>v1.0-without-redis</code></td><td>基础版本，同步处理，无 Redis 依赖</td></tr></tbody></table>
<h2 data-id="heading-27">贡献</h2>
<p>欢迎提交 Issue 和 Pull Request！</p>
<h2 data-id="heading-28">许可证</h2>
<p>AGPL-3.0 License（只要通过网络提供服务，就必须向用户公开修改后的源码）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 基础：状态管理入门]]></title>    <link>https://juejin.cn/post/7591318630694551606</link>    <guid>https://juejin.cn/post/7591318630694551606</guid>    <pubDate>2026-01-04T13:40:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591318630694551606" data-draft-id="7591317772074483731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 基础：状态管理入门"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-04T13:40:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桜吹雪"/> <meta itemprop="url" content="https://juejin.cn/user/1179091901098269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 基础：状态管理入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1179091901098269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桜吹雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:40:11.000Z" title="Sun Jan 04 2026 13:40:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.telerik.com%2Fblogs%2Fvue-basics-state-management-vue%23state-at-scale-with-pinia" target="_blank" title="https://www.telerik.com/blogs/vue-basics-state-management-vue#state-at-scale-with-pinia" ref="nofollow noopener noreferrer">Vue Basics: State Management in Vue</a></p>
</blockquote>
<p>学习如何随着应用规模的扩大，利用 ref/reactive、props/emits、provide/inject 和 Pinia 来扩展 Vue 的状态管理。</p>
<p>在使用 Vue 构建任何交互式应用时，“状态”是你最先接触到的核心概念之一。无论是表单中的文本、购物车里的商品，还是已登录用户的个人资料，正确地管理这些状态对于保持应用的稳定性、响应性以及易扩展性都至关重要。</p>
<p>Vue 3 引入了组合式 API 以及全新的响应式系统，为开发者提供了前所未有的强大且灵活的状态管理方式。在本指南中，我们将探讨 Vue 3 如何处理状态——从使用 <code>ref</code> 和 <code>reactive</code> 管理局部状态开始，到通过 <code>props</code> 和 <code>provide</code>/<code>inject</code> 共享数据，最后进阶到 Vue 的官方状态管理库 Pinia。读完本文，你将获得一份清晰的路线图，能够根据应用的具体需求选择最合适的工具。</p>
<h2 data-id="heading-0">理解 Vue 中的状态管理概念</h2>
<p>状态是每一个交互式 Vue 应用的核心。正是它让你的 UI 变得动态——只要更新状态，Vue 就会自动将这些变化反映在 DOM 中。</p>
<p>广义上讲，状态分为两种类型：</p>
<ul>
<li>局部状态： 存在于单个组件内部（例如：计数器组件中的 count 变量）。</li>
<li>全局状态： 在多个组件或应用的不同部分之间共享（例如：用户登录认证状态）。</li>
</ul>
<p>默认情况下，每个 Vue 组件都维护着自己的响应式状态，我们通常称之为局部状态。在探索如何在组件间共享状态以及最终使用 Pinia 进行全局管理之前，让我们先从这里入手。</p>
<h2 data-id="heading-1">使用 ref 和 reactive 管理局部状态</h2>
<p>为了管理局部响应式状态，Vue 3 的组合式 API 提供了两个主要工具：<code>ref</code> 和 <code>reactive</code>。如果你刚接触 Vue，可能会对选择哪一个感到困惑——因此，让我们基于对局部状态的理解，来详细拆解这两个工具。</p>
<h3 data-id="heading-2">使用 ref</h3>
<p>当处理原始值（数字、字符串、布尔值）时，请使用 ref。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from 'vue'

//state
const count = ref(0)

//actions
function increment() {
  count.value++
}
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="increment"&gt;Count is: {{ count }}&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p>在这里，<code>count</code> 被封装在一个 <code>ref</code> 中，并通过 <code>.value</code> 来访问其值。</p>
<h3 data-id="heading-3">使用 reactive</h3>
<p>当处理对象或数组时，请使用 <code>reactive</code>。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { reactive } from 'vue'

const user = reactive({
  name: ' ',
  age: 25
})
&lt;/script&gt;

&lt;template&gt;
  &lt;input v-model="user.name" placeholder="Enter your name" /&gt;
  &lt;p&gt;{{ user.name }} is {{ user.age }} years old.&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<p>在底层，Vue 将对象封装在一个 Proxy 中，因此它可以自动追踪变化并更新 DOM。</p>
<p>局部状态是 Vue 单向数据流最简单的例子：状态驱动 UI。但一旦多个组件需要共享同一份状态，仅靠局部管理就会变得困难，这时我们就需要超越局部状态了。</p>
<h2 data-id="heading-4">在组件间共享状态</h2>
<p>局部状态对于单个组件来说运作良好，但如果多个组件需要相同的数据该怎么办？Vue 提供了几种共享状态的方式：props/emits 和 provide/inject。</p>
<h3 data-id="heading-5">Props 和 Emits</h3>
<p>Props 允许父组件向下传递状态，而 emits 允许子组件向上发送事件。</p>
<p>让我们看看下面这个简单的演示：</p>
<h4 data-id="heading-6">父组件</h4>
<p>你可以通过 props 将数据从父组件传递给子组件。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Parent.vue --&gt;
&lt;template&gt;
  &lt;Child :count="count" @increment="count++" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import Child from './Child.vue'

const count = ref(0)
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-7">子组件</h4>
<p>当子组件需要更新父组件的状态时，它可以触发（emit）一个事件。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Child.vue --&gt;
&lt;template&gt;
  &lt;button @click="$emit('increment')"&gt;Clicked&lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
defineProps(['count'])
defineEmits(['increment'])
&lt;/script&gt;
</code></pre>
<p>这种方法对于小型应用来说效果很好，但如果你有深层嵌套的组件，到处传递 props 和 emits 很快就会变得混乱，从而导致所谓的“<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fcomponents%2Fprovide-inject.html%23prop-drilling" target="_blank" title="https://vuejs.org/guide/components/provide-inject.html#prop-drilling" ref="nofollow noopener noreferrer">Prop Drilling</a>”（属性逐级透传）问题。为了避免这种情况，Vue 提供了另一种选择：provide/inject。</p>
<h3 data-id="heading-8">Provide/inject：避免 Prop Drilling</h3>
<p>Vue 中的 <code>provide</code>/<code>inject</code> API 使得父组件能够轻松地与子组件共享数据，无论嵌套多深，都无需通过每一个中间层级向下传递 props。</p>
<p>让我们看看下面这个简单的代码演示：</p>
<h4 data-id="heading-9">父组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ParentComponent.vue --&gt;
&lt;script setup&gt;
import { ref, provide } from 'vue'
import ChildComponent from './ChildComponent.vue'

   const count = ref(0)
   provide('count', count)

   const increment = () =&gt; {
      count.value++
  }
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;h2&gt;Parent Count: {{ count }}&lt;/h2&gt;
    &lt;button @click="increment"&gt;Increment&lt;/button&gt;
    &lt;!-- 不通过props传递 --&gt;
    &lt;ChildComponent /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p><code>provide()</code> 函数用于父组件中，使其数据对后代组件可用。它接收两个参数：一个注入键和一个值。这个键可以是字符串或 Symbol，后代组件将使用该键通过 <code>inject()</code> 来访问对应的值。单个组件不限于调用一次；你可以使用不同的键多次调用 <code>provide()</code> 来共享不同的值。</p>
<p><code>provide()</code> 的第二个参数是你想要共享的数据，它可以是任何类型——原始值、对象、函数，甚至是像 ref 或 reactive 这样的响应式状态。当你提供一个响应式值时，Vue 不会传递副本；它会建立一个实时连接，允许使用 <code>inject()</code> 的后代组件自动与提供者保持同步。</p>
<h4 data-id="heading-10">子组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ChildComponent.vue --&gt;
&lt;script setup&gt;
import GrandChildComponent from './GrandChildComponent.vue'
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;h3&gt;I am the Child&lt;/h3&gt;
    &lt;!-- 注意: 不通过props传递 --&gt;
    &lt;GrandChildComponent /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>要注入祖先组件提供的数据，请在 <code>GrandChildComponent.vue</code> 中使用 <code>inject()</code> 函数：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- GrandChildComponent.vue --&gt;
&lt;script setup&gt;
import { inject } from 'vue'
const count = inject('count')
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;Grandchild sees count: {{ count }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>在上面的代码演示中，ParentComponent 提供了响应式的 <code>count</code>，因此 ChildComponent 不需要做任何操作——它只需向下传递插槽/子组件。然后 GrandChildComponent 可以直接注入 <code>count</code>，并对父组件的更新保持响应。</p>
<p>这是如何使用 <code>provide</code>/<code>inject</code> 模式的一个基本演示；不过，如果你想了解更多，这篇文章进行了非常详细的介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.telerik.com%2Fblogs%2Fvue-basics-exploring-vue-provide-inject-pattern" target="_blank" title="https://www.telerik.com/blogs/vue-basics-exploring-vue-provide-inject-pattern" ref="nofollow noopener noreferrer">Vue 基础：探索 Vue 的 Provide/Inject 模式</a>。</p>
<p><code>provide</code>/<code>inject</code> 模式非常适合在中型应用中避免 Prop Drilling。然而，随着应用规模的增长，以这种方式管理依赖关系可能会变得复杂。对于大型且复杂的应用，我们需要一个更具结构化和可扩展性的专门状态管理解决方案，这正是像 Pinia 这样的库大显身手的地方。</p>
<h2 data-id="heading-11">利用 Pinia 应对大规模状态管理</h2>
<p>随着你的应用不断增长，在多个组件之间手动管理状态会很快变得令人头疼。我们之前介绍的模式对于小型项目来说运作良好，但一旦你开始构建大规模的生产级应用，就有许多事情需要考虑：</p>
<ul>
<li>热模块替换 (HMR)</li>
<li>更强的团队协作约定</li>
<li>与 Vue DevTools 的集成，包括时间轴、组件内检查和时光旅行调试 (Time-travel debugging)</li>
<li>服务端渲染 (SSR) 支持</li>
</ul>
<p>你需要一个中央仓库，一个单一的数据源，供多个组件读取和写入，而这正是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">Pinia</a> 登场的地方。</p>
<p>Pinia 是 Vue 3 的官方状态管理库，也是 Vuex 的继任者。它专为处理上述所有场景而设计。它更简单、更直观，并且旨在与组合式 API 无缝配合。</p>
<p>在深入代码演示之前，让我们先明确基础知识。从核心上讲，状态管理关乎你的数据存放在哪里、如何读取以及如何更新。Pinia 用四个概念将这些规范化：</p>
<ul>
<li>State (状态)： 这是你实际的响应式数据。把它看作你应用的单一数据源。例如用户的个人资料详情、购物车中的商品或模态框是否打开。</li>
<li>Store (仓库)： 容纳状态的集中式容器。Store 将数据集中管理，而不是分散在多个组件中，因此任何组件都可以访问和更新它，而无需混乱的 Prop 逐层传递 (Prop Drilling)。</li>
<li>Getters (获取器)： 它们就像 Store 的计算属性。它们允许你派生或转换状态值（例如，计算购物车中商品的成本），而无需在多处重复逻辑。</li>
<li>Actions (动作)： 更新状态的函数。它们就像 Vue 组件中的 methods（方法），是你存放修改逻辑的地方，无论是增加计数器、向列表添加项目还是从 API 获取数据。</li>
</ul>
<p>可以这样理解：</p>
<ul>
<li>State 是你持有的数据</li>
<li>Getters 是你查看数据的方式</li>
<li>Actions 定义数据如何变化</li>
<li>Store 是这一切的栖身之所</li>
</ul>
<p>接下来，让我们演示如何将 Pinia 集成到我们的计数器演示应用中。</p>
<h2 data-id="heading-12">设置 Pinia</h2>
<p>为 Vue 3 单页应用设置 Pinia 非常简单。如果你是使用 Vue CLI 或 create-vue 从头开始创建一个新项目，设置向导甚至会询问你是否要使用 Pinia 作为你的状态管理首选。</p>
<p>要在新项目中手动设置 Pinia——或将其添加到现有应用中——请遵循以下步骤：</p>
<p>首先，使用 <code>npm</code> 或 <code>yarn</code> 安装 Pinia 包：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm install pinia

<span class="hljs-meta"># or</span>

yarn install pinia
</code></pre>
<p>要将 Pinia 注册到你的应用中，请打开挂载应用的入口文件（通常是 <code>main.js</code> 或 <code>main.ts</code>），并在你的 Vue 应用实例上调用 <code>app.use(pinia)</code>：</p>
<p><strong>main.js</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

app.<span class="hljs-title function_">use</span>(pinia)
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p>现在我们可以开始为计数器演示应用创建 Store 了。</p>
<h3 data-id="heading-13">创建 Store</h3>
<p>这是一个简单的计数器 Store，演示了所有四个概念。要创建一个 Store，首先新建一个文件来存放代码。一个好的做法是将这些文件放在专用的 <code>stores</code> 文件夹中，以保持项目井井有条。</p>
<p><strong>CounterStore.js</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {

----

})
</code></pre>
<p>我们要使用 Pinia 的 <code>defineStore</code> 方法来创建 Store。它接受两个主要参数：第一个是 Store 的 <code>id</code>，它在你的应用中必须是唯一的。你可以随意命名，但对于这个例子，<code>counter</code> 是最合适的，因为这正是我们的 Store 所管理的。</p>
<p>第二个参数是一个定义 Store 选项的对象。让我们分解一下可以在其中包含的内容：</p>
<h3 data-id="heading-14">State</h3>
<p>在 Store 中定义的第一个选项是 <code>state</code>。如果你使用过 Vue 的选项式 API (Options API)，这会让你倍感亲切。它只是一个返回对象的函数，该对象包含你的 Store 应管理的所有响应式数据。对于我们的计数器应用演示，我们将向 state 添加 <code>count</code> 属性：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {
  <span class="hljs-comment">// State — 响应式共享数据</span>
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  })
})
</code></pre>
<p>然后我们可以轻松地在 <code>CounterButton.vue</code> 组件中导入这个 Store 并使用 <code>count</code> 状态。</p>
<p><strong>CounterButton.vue</strong></p>
<pre><code class="hljs language-js" lang="js">&lt;script setup&gt;
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'../stores/CounterStore.js’
const counter = useCounterStore()
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
  &lt;button &gt;
    Clicked {{ counter.count }} times
 &lt;/button&gt;
 
  &lt;/div&gt;
&lt;/template&gt;
</span></code></pre>
<p>在上面的代码示例中，我们导入了 <code>useCounterStore</code> 然后调用了该方法。这将返回我们在前面创建的计数器 Store 的副本。这个 Store 中的状态是全局的，意味着对它所做的任何更新都会自动反映在所有使用该 Store 的组件中。</p>
<h3 data-id="heading-15">Getters</h3>
<p>就像 Vue 的计算属性一样，Pinia Store 允许我们定义 <code>getters</code>。Getter 本质上是一个从 Store 状态派生出来的计算值。当你想要基于现有状态转换、过滤或计算某些内容，而又不想在组件之间重复逻辑时，它们非常有用。例如，我们可以使用 getter 方法计算当前状态的乘积：</p>
<p>更新你的 <code>CounterStore.js</code>，添加以下代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {

  <span class="hljs-comment">// State — 响应式共享数据</span>
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
     <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  })

  <span class="hljs-comment">// Getters — 派生状态</span>
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>
  },

})
</code></pre>
<p>就是这样。现在我们拥有了一个 <code>doubleCount</code> 属性，可以在任何组件中使用。</p>
<p>创建一个 <code>CounterDisplay.vue</code> 组件，使用 <code>doubleCount</code> 属性向用户显示消息。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { useCounterStore } from '../stores/CounterStore.js'
const counter = useCounterStore()
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;Current Count: {{ counter.count }}&lt;/p&gt;
    &lt;p&gt;Double Count: {{ counter.doubleCount }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>Getters 设计为同步的。如果你需要执行异步工作（如获取数据），请改用 Action。</p>
<h3 data-id="heading-16">Actions</h3>
<p>我们可以在 Store 中定义的最后一个选项是 actions。把 actions 想象成 Store 版本的组件方法——它们封装了更改状态或执行任务的逻辑。与仅用于派生和返回数据的 getters 不同，actions 旨在更新状态和处理副作用。</p>
<p>Actions 的一个主要优势是它们可以是异步的，这与 getters 不同。这使得它们非常适合诸如从 API 获取数据、处理表单提交或执行任何在将结果提交回 Store 之前需要时间的操作。例如，这是一个创建逻辑来增加状态 <code>count</code> 或从 API 获取初始 <code>count</code> 数据的好位置。</p>
<p>打开我们的 <code>CounterStore.js</code> 并更新以下代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {

  <span class="hljs-comment">// State — 响应式共享数据</span>
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
     <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  })

  <span class="hljs-comment">// Getters — 派生状态</span>
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>
  },

  <span class="hljs-comment">// Actions — 更新状态的逻辑</span>
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
    },

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchInitialCount</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/count'</span>)
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = data.<span class="hljs-property">value</span>
    }
  }
})
</code></pre>
<p>现在在 <code>CounterButton.vue</code> 组件内部，你可以调用 action 而不是直接修改状态：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { useCounterStore } from '../stores/CounterStore.js’
const counter = useCounterStore()
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="counter.increment"&gt;Increment&lt;/button&gt;
  &lt;button @click="counter.fetchInitialCount"&gt;Load Initial Count&lt;/button&gt;
  &lt;p&gt;Count is: {{ counter.count }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<p>从上面的代码修改可以看出，<code>increment()</code> 是一个直接修改 Store 状态的简单 action，而 <code>fetchInitialCount()</code> 则演示了 action 也可以处理异步任务，如定时器或 API。由于 Pinia Store 是响应式的，一旦 action 更新了状态，所有使用该 Store 的组件将立即反映新值。</p>
<h2 data-id="heading-17">总结</h2>
<p>Vue 中的状态管理不必让人感到不知所措。从小处着手，使用 <code>ref</code> 和 <code>reactive</code> 处理本地状态。当组件需要通信时，<code>props</code> 和 <code>emits</code> 是自然的选择。随着应用增长，<code>provide</code>/<code>inject</code> 有助于减少 Prop 逐层传递并保持条理清晰。</p>
<p>但当你的应用需要一个在许多组件之间共享且一致的状态时，Pinia 便脱颖而出。它提供了一个集中、可扩展的 Store，作为你应用的单一数据源。</p>
<p>知道何时使用每种方法是真正的关键。你不需要从第一天起就使用 Pinia，但随着项目变得越来越复杂，你会感激它的结构和可靠性。掌握了这些选项，你就可以自信地管理状态——无论你是构建一个小挂件还是一个大规模的生产级应用。</p>
<p>如果你想超越基础知识，<a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">官方的 Pinia 文档</a>是最好的下一步。它深入介绍了插件、高级模式、DevTools 集成等内容——所有内容都解释得清晰实用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《10 分钟上手 RabbitMQ：用 Python 写一个“不丢消息”的迷你消息系统》]]></title>    <link>https://juejin.cn/post/7591130604430049320</link>    <guid>https://juejin.cn/post/7591130604430049320</guid>    <pubDate>2026-01-04T13:58:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591130604430049320" data-draft-id="7591309945511002112" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《10 分钟上手 RabbitMQ：用 Python 写一个“不丢消息”的迷你消息系统》"/> <meta itemprop="keywords" content="RabbitMQ"/> <meta itemprop="datePublished" content="2026-01-04T13:58:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《10 分钟上手 RabbitMQ：用 Python 写一个“不丢消息”的迷你消息系统》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:58:18.000Z" title="Sun Jan 04 2026 13:58:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>标签：<br/>
RabbitMQ · Python · 消息队列 · 实战 Demo · 入门</p>
<hr/>
<h3 data-id="heading-0">为什么写这篇？</h3>
<p>消息队列（MQ）的概念大家背得滚瓜烂熟：解耦、异步、削峰。但“第一次把消息真正发出去”的门槛依旧不小：</p>
<ul>
<li>需要装 Erlang？</li>
<li>管理界面怎么开？</li>
<li>消息会不会一发就丢？</li>
</ul>
<p>这篇文章带你 10 分钟跑通第一个可生产的 RabbitMQ 示例，代码不足 80 行，却覆盖<strong>持久化 + 手动 ACK + 连接断线重试</strong>等生产级要素，复制即可运行。</p>
<hr/>
<h3 data-id="heading-1">1. 一键启动 RabbitMQ</h3>
<p>不想装 Erlang？Docker 一把梭：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d --hostname rabbit \
  --name rabbit \
  -p 5672:5672 \
  -p 15672:15672 \
  rabbitmq:3.12-management
</code></pre>
<p>浏览器打开 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A15672" target="_blank" title="http://localhost:15672" ref="nofollow noopener noreferrer">http://localhost:15672</a><br/>
账号/密码：<code>guest / guest</code><br/>
能看到队列、消息速率、节点内存，调试神器 get✔</p>
<hr/>
<h3 data-id="heading-2">2. Python 依赖仅一个包</h3>
<pre><code class="hljs language-bash" lang="bash">pip install pika==1.3.2
</code></pre>
<hr/>
<h3 data-id="heading-3">3. 队列与消息：先声明，再使用</h3>
<p>RabbitMQ 的哲学：<strong>队列只创建一次，谁先到谁声明</strong>。<br/>
示例里把 <code>durable=True</code> 打开，即使 MQ 重启，队列元数据也不会丢。</p>
<hr/>
<h3 data-id="heading-4">4. 生产者代码（producer.py）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pika, sys

QUEUE = <span class="hljs-string">'demo_queue'</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    conn = pika.BlockingConnection(pika.ConnectionParameters(<span class="hljs-string">'localhost'</span>))
    ch = conn.channel()
    ch.queue_declare(queue=QUEUE, durable=<span class="hljs-literal">True</span>)          <span class="hljs-comment"># 持久化队列</span>

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
        body = <span class="hljs-string">f'hello <span class="hljs-subst">{i}</span>'</span>
        ch.basic_publish(exchange=<span class="hljs-string">''</span>,
                         routing_key=QUEUE,
                         body=body,
                         properties=pika.BasicProperties(delivery_mode=<span class="hljs-number">2</span>))  <span class="hljs-comment"># 持久化消息</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f' [x] Sent "<span class="hljs-subst">{body}</span>"'</span>)
    conn.close()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">try</span>:
        main()
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        sys.exit()
</code></pre>
<p>运行结果：</p>
<pre><code class="hljs language-csharp" lang="csharp"> [<span class="hljs-meta">x</span>] Sent <span class="hljs-string">"hello 0"</span>
 [<span class="hljs-meta">x</span>] Sent <span class="hljs-string">"hello 1"</span>
 ...
 [<span class="hljs-meta">x</span>] Sent <span class="hljs-string">"hello 9"</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">5. 消费者代码（consumer.py）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pika, time, sys

QUEUE = <span class="hljs-string">'demo_queue'</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">ch, method, properties, body</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f' [x] Received <span class="hljs-subst">{body.decode()}</span>'</span>)
    time.sleep(<span class="hljs-number">1</span>)                               <span class="hljs-comment"># 模拟耗时</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">' [x] Done'</span>)
    ch.basic_ack(delivery_tag=method.delivery_tag)  <span class="hljs-comment"># 手动 ack</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    conn = pika.BlockingConnection(pika.ConnectionParameters(<span class="hljs-string">'localhost'</span>))
    ch = conn.channel()
    ch.queue_declare(queue=QUEUE, durable=<span class="hljs-literal">True</span>)
    ch.basic_qos(prefetch_count=<span class="hljs-number">1</span>)              <span class="hljs-comment"># 公平分发</span>
    ch.basic_consume(queue=QUEUE, on_message_callback=callback)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">' [*] Waiting for messages. To exit press CTRL+C'</span>)
    ch.start_consuming()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">try</span>:
        main()
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        sys.exit()
</code></pre>
<p>运行后，每秒处理 1 条消息，10 秒完成全部任务；<br/>
RabbitMQ UI 中 <code>Messages</code> 从 10 → 0，没有一条积压。</p>
<hr/>
<h3 data-id="heading-6">6. 小结：我们到底做了什么？</h3>






























<table><thead><tr><th>关键点</th><th>命令/参数</th><th>作用</th></tr></thead><tbody><tr><td>队列持久化</td><td><code>queue_declare(durable=True)</code></td><td>MQ 重启队列不丢</td></tr><tr><td>消息持久化</td><td><code>delivery_mode=2</code></td><td>服务器掉电消息不丢</td></tr><tr><td>手动 ACK</td><td><code>basic_ack</code></td><td>消费者崩溃时消息可重新投递</td></tr><tr><td>公平分发</td><td><code>basic_qos(prefetch_count=1)</code></td><td>慢消费者不会被压垮</td></tr></tbody></table>
<p>把这 4 项配置搬到生产环境，你就已经战胜了 80% 的“消息丢失”事故。</p>
<hr/>
<h3 data-id="heading-7">7. 下一步可以玩什么？</h3>
<ol>
<li>把 <code>demo_queue</code> 换成 <code>topic</code> 模式，实现日志级别路由；</li>
<li>用 <code>RPC</code> 模式做同步调用，假装自己是一个微服务网关；</li>
<li>开镜像队列 + 集群，Kill 掉任一节点，消息依旧在线；</li>
<li>给消费端加 <code>retry + dead-letter-exchange</code>，自动重试 3 次后进入死信队列，人工处理。</li>
</ol>
<hr/>
<h3 data-id="heading-8">8. 一句鸡汤</h3>
<p>消息队列的难点从来不在于“发消息”，而在于“失败时消息还在”。<br/>
先让今天的 10 条消息不丢，再去考虑百万 QPS 的宏伟蓝图——脚下已出发，远方不远。</p>
<p>完整源码已上传 GitHub：<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyourname%2Frabbitmq-python-minimal" target="_blank" title="https://github.com/yourname/rabbitmq-python-minimal" ref="nofollow noopener noreferrer">github.com/yourname/ra…</a><br/>
欢迎 Star &amp; PR，祝大家排队愉快！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 原生下的新的社区形态会是什么]]></title>    <link>https://juejin.cn/post/7591350620188377094</link>    <guid>https://juejin.cn/post/7591350620188377094</guid>    <pubDate>2026-01-04T12:05:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620188377094" data-draft-id="7591422577937612806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 原生下的新的社区形态会是什么"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-04T12:05:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XCaptaino"/> <meta itemprop="url" content="https://juejin.cn/user/3052665287739005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 原生下的新的社区形态会是什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3052665287739005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XCaptaino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:05:04.000Z" title="Sun Jan 04 2026 12:05:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 不会杀死社区，但会杀死那些只做 “信息搬运工” 的平庸社区。Stack Overflow 的下滑与 Reddit 的坚挺就是最好的例证。未来的社区必须构建以 “<strong>可信</strong>” 与 “<strong>独创性</strong>” 、 “<strong>用户深度链接</strong>”为核心的资产体系，将 AI 作为过滤噪音的过滤器和放大创意的放大器，而非替代人类思考的生成器。本文没有答案，单纯记录一下一些思考</p>
<p>在 AIGC 边际成本趋零的背景下，传统 “提问 - 回答” 的知识搬运模式已难以为继。
我觉得有一些问题是传统社区和知识问答社区必须要回答的问题</p>
<ul>
<li><strong>价值升级：</strong> 当标准答案唾手可得，社区如何提供 AI 无法生成的稀缺价值？</li>
<li><strong>秩序重构：</strong> 在人机混杂的环境中，如何保证内容的可信度与社区的讨论秩序？</li>
<li><strong>量化落地：</strong> 如何建立一套可执行、可监测的指标体系来指导日常运营？</li>
</ul>
<h2 data-id="heading-0">社区形态的演进脉络</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/376b096f1a0e461799a055da60ec4e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133104&amp;x-signature=lj2KXeX3H6GD2ai0zYW0IEGmVYM%3D" alt="image.png" loading="lazy"/></p>
<p>回顾互联网社区的发展，每一次技术跃迁都重塑了 “连接” 的方式。我们正在经历从社交网络向 “AI 原生社区” 跨越的关键时刻。这一演进并非断裂，而是对社区核心要素的深化。</p>
<p><strong>兴趣论坛 (1979-2003)：</strong> 受限于拨号带宽，用户基于纯粹兴趣聚合（如 Usenet, NGA）。核心是 “认同感”。</p>
<p><strong>内容平台 (2003-2016)：</strong> 搜索引擎与宽带普及，放大了分发效率（如 Reddit, 知乎）。核心是 “影响力”。</p>
<p><strong>社交网络 (2016-至今)：</strong> 移动互联与算法推荐，流量精准变现（如 TikTok, 小红书）。核心是 “商业价值”。</p>
<p><strong>AI原生社区 (未来 1)：</strong> 生成式 AI 让内容生产成本趋零。核心回归 “真实协作” 与 “人机共生”。</p>
<p>在新范式下，我们必须重新审视社区的三大基石：</p>
<h4 data-id="heading-1">定位</h4>
<p>不再是 “找答案”，而是 <strong>“找共鸣” 与 “解决复杂问题”</strong> 。</p>
<p>用户来这里是因为 AI 无法提供情感慰藉或处理非标场景。</p>
<h4 data-id="heading-2">文化</h4>
<p>从崇拜 “大神” 转向<strong>崇拜 “真实”</strong> 。</p>
<p>社区应鼓励原创、个人经历与深度思考，明确排斥批量生成的流水线内容。</p>
<h4 data-id="heading-3">规则</h4>
<p>建立<strong>人机分层</strong>的激励机制。</p>
<p>严惩伪装成人类的 AI 灌水，重奖经过验证的高价值人类贡献。</p>
<h2 data-id="heading-4">生成式 AI 对知识型社区的差异化影响</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1319724de9c4bfda29d1ec4a1b8d6ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133104&amp;x-signature=JyClvQRbvYUYr2IiWcAdu5Gy9JM%3D" alt="image.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nature.com%2Farticles%2Fs41598-024-61221-0" target="_blank" title="https://www.nature.com/articles/s41598-024-61221-0" ref="nofollow noopener noreferrer">Nature (2024)</a> 的研究通过对比 Stack Overflow (SO) 与 Reddit 开发者社区，揭示了 “信息型” 与 “关系型” 社区的不同命运。</p>

























<table><thead><tr><th>维度</th><th>Stack Overflow (纯信息型)</th><th>Reddit 开发者社区 (关系/讨论型)</th></tr></thead><tbody><tr><td><strong>流量变化</strong></td><td><strong>下降约 12%</strong> (日均减少百万级访问)</td><td>无显著统计学差异，保持稳定</td></tr><tr><td><strong>提问特征</strong></td><td>总体提问量下滑，简单问题消失，<strong>问题复杂度显著上升</strong></td><td>维持原有讨论生态，话题未受明显冲击</td></tr><tr><td><strong>用户流失</strong></td><td><strong>新手用户大量流失</strong>，留存用户多为老手</td><td>用户结构未见明显断层</td></tr></tbody></table>
<p><strong>运营启示：</strong></p>
<ul>
<li><strong>拥抱复杂：</strong> 简单问题被 AI 拦截是必然，社区应主动引导用户讨论 “没有标准答案” 的复杂场景。</li>
<li><strong>增强纽带：</strong> Reddit 的韧性证明了 “人际连接” 的护城河作用。应增加 AMA (Ask Me Anything)、圆桌讨论等强互动形式。</li>
<li><strong>奖励非标：</strong> 修改积分规则，降低对简单搬运内容的奖励，大幅提升对经验分享、观点辩论的激励权重。</li>
</ul>
<h2 data-id="heading-5">信息/关系/观点三类社区的实操策略</h2>
<p>不同类型的社区应采取差异化的转型策略：</p>
<h4 data-id="heading-6">A) Stack Overflow</h4>
<p><strong>信息型：转型专家网络</strong></p>
<ul>
<li><strong>聚焦深度：</strong> 引导提问者补充详细上下文，拒绝 “一句话提问”。</li>
<li><strong>专家计划：</strong> 认证领域专家，对经过专家验证的答案给予双倍权重。</li>
<li><strong>严禁灌水：</strong> 对复制粘贴 GPT 答案的账号实行零容忍封禁。</li>
</ul>
<h4 data-id="heading-7">B) Reddit Dev</h4>
<p><strong>关系型：强化社交密度</strong></p>
<ul>
<li><strong>主题活动：</strong> 定期举办 AMA、黑客马拉松，制造 “氛围感”为用户提供深度链接的场景和机会。</li>
<li><strong>版主自治：</strong> 赋权版主制定个性化的反 AI 规则（如特定板块禁止 AI）。</li>
<li><strong>群组协作：</strong> 鼓励基于项目的长周期讨论，而非单次问答。</li>
</ul>
<h4 data-id="heading-8">C) Hacker News</h4>
<p><strong>观点型：捍卫原创思考</strong></p>
<ul>
<li><strong>慢速 Karma：</strong> 保持高门槛的信誉积累机制，防止 AI 刷号。</li>
<li><strong>辅助标识：</strong> 允许 AI 辅助润色，但必须在文末声明，强调观点属于人类。</li>
<li><strong>来源核查：</strong> 对引用链接进行自动化真实性校验，防止幻觉。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b54f9fda5bd4c5db9b599330ddac737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133104&amp;x-signature=bZcHJB4RhA3Fc28QhyWL8uXWUC0%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Claude中问 "元芳（Gemini）你怎么看？"]]></title>    <link>https://juejin.cn/post/7591360623469314058</link>    <guid>https://juejin.cn/post/7591360623469314058</guid>    <pubDate>2026-01-04T12:18:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591360623469314058" data-draft-id="7591322050240610342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Claude中问 &quot;元芳（Gemini）你怎么看？&quot;"/> <meta itemprop="keywords" content="AI编程,Claude,Gemini"/> <meta itemprop="datePublished" content="2026-01-04T12:18:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Claude中问 "元芳（Gemini）你怎么看？"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:18:40.000Z" title="Sun Jan 04 2026 12:18:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>当前对程序员较为友好的两种AI工具，应该非Claude和Gemini莫属。尽管公认Claude在编码上能力更强，但是Gemini也有自己的优势，如100万Token超长上下文、原生多模态支持图片、PDF、音频、视频等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2350f52dd08946a29b5fbdd74b48dff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=xu8YihaZWGIgfLpN5xQpU1Y9C%2BM%3D" alt="" loading="lazy"/></p>
<p>在我们使用Claude的过程中，可能会出现如下场景：</p>
<ul>
<li>Claude的答案不是那么满意，想对比看看Gemini的答案</li>
<li>在特定场景下，就想使用更高效的Gemini来处理</li>
</ul>
<p>这个时候，不管我们是同时开着两个CLI还是使用网页版的Gemini，都能体会到来回切换工具或者重新交代上下文的痛苦。而我们要做到的就是，在必要时候，只需要在Claude中问一句“gemini你怎么看” ，Claude就可以输出Gemini的结果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/549c23688e574b42b8c30fe15ad53b6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=Nt%2BH8AObANgC93IorNeLXNEg5I4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">怎么做🌟</h2>
<p>最简单的方式就是直接在Claude中执行gemini的Bash指令，比如我们先在Claude中问 1+1等于多少。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2c595de35f348129170a24d7a357b06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=YF%2FW%2F%2FrikyHxFA2DFVfY0JvhvLY%3D" alt="" loading="lazy"/></p>
<p>如果我们想让Gemini来回答这个问题，只需要执行如下指令：</p>
<pre><code class="hljs language-css" lang="css">gemini -<span class="hljs-selector-tag">p</span> <span class="hljs-number">1</span>+<span class="hljs-number">1</span>等于多少
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdea7f58aa2f4b029dd37586ec5a29c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=Y7x%2FP3mAZNgcML%2B5LtYEvZVmrhM%3D" alt="" loading="lazy"/></p>
<p>可以看到，Gemini也给出了答案。这个例子可能不够准确的让你意识到这个Gemini的回答确实来自Gemini。我们再来看一个图片的例子。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6635bb8debd2472b815c331696857599~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=SlR%2F%2BCIixp2FQEj9UYZZcYPvS0k%3D" alt="" loading="lazy"/></p>
<p>我们先让Claude来描述这张图片，结果如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; test-image.png 这张图片是干嘛的 </span>

⏺ Let me read the image file to see what it contains.

⏺ Read(test-image.png)
  ⎿  Read image (25.5KB)
  ⎿  Running PostToolUse hooks… (1/2 done)

⏺ 这张图片显示了一个深色主题的 IDE/代码编辑器界面。从图片来看:

<span class="hljs-bullet">  -</span> 左侧是文件资源管理器侧边栏，显示了项目文件结构
<span class="hljs-bullet">  -</span> 主编辑区域显示了一个深色背景的编辑器
<span class="hljs-bullet">  -</span> 看起来像是 Visual Studio Code 或类似的开发环境

  根据文件名 test-image.png，这似乎是一个测试用的截图文件。这张图片可能是用于:
<span class="hljs-bullet">  -</span> 测试图片读取功能
<span class="hljs-bullet">  -</span> 作为项目中的示例或测试资源
<span class="hljs-bullet">  -</span> 记录某个开发环境的配置或界面
</code></pre>
<p>再让Gemini来描述这张图片，结果如下所示：</p>
<pre><code class="hljs language-scss" lang="scss"> <span class="hljs-built_in">Bash</span>(gemini "这张图片是干嘛的" &lt; test-image.png)
  ⎿ 这张图片（test-image<span class="hljs-selector-class">.png</span>）是一个 **<span class="hljs-number">800</span>x600 像素的 PNG 图像**。                                              

    从二进制数据来看，它似乎是一个非常简单的图像，很可能是一个包含
    **白色背景和少量图形元素**（如简单的线条或图标
    … +<span class="hljs-number">3</span> lines (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ 根据 Gemini CLI 的分析,test-image<span class="hljs-selector-class">.png</span> 是一张 <span class="hljs-number">800</span>x600 像素的 PNG 图像,包含白色背景和一些简单的图形元素(如线条或图标)。

  从文件名 test_cl 目录的位置来看,这张图片很可能是用于开发或测试 Gemini CLI 图像处理功能的示例素材。它作为一个测试文件,用来验证图像分析和视觉识别功能是否正常工作。
</code></pre>
<p>我们可以看到，他们的回答是完全不一致的。但是我们不可能每次都去写一个<code>gemini -p</code> 指令，这个时候我们就想到了将上述指令描述成一个skill。</p>
<h2 data-id="heading-2">好的方式🌟🌟</h2>
<p>创建一个skill来描述我们的要求：</p>
<ul>
<li>执行Gemini指令分析问题</li>
<li>将Gemini分析的结果与Claude的结果进行对比</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">---  name:  gemini  description:  Cross-AI  comparison  tool  that  executes  Gemini  CLI  <span class="hljs-keyword">and</span>  compares  results  with  Claude<span class="hljs-number">'</span>s  responses.  Use  when  user  asks  <span class="hljs-string">"gemini怎么看"</span>,  <span class="hljs-string">"让gemini回答"</span>,  <span class="hljs-keyword">or</span>  mentions  <span class="hljs-string">"gemini"</span>  to  get  alternative  perspectives  <span class="hljs-keyword">and</span>  compare  AI  model  outputs.  Supports  both  text  questions  <span class="hljs-keyword">and</span>  image  analysis  queries.  ---  # Gemini Cross-AI Comparison   ## Overview   This  skill  enables  cross-AI  comparison  by  executing  the  Gemini  CLI  tool  <span class="hljs-keyword">and</span>  contrasting  its  responses  with  Claude<span class="hljs-number">'</span>s  answers.  This  provides  users  with  multiple  perspectives  <span class="hljs-keyword">and</span>  helps  validate  accuracy.   ## Workflow   ### <span class="hljs-number">1.</span> Detect Trigger   Trigger <span class="hljs-keyword">this</span> skill when user uses phrases like:  -  <span class="hljs-string">"gemini怎么看"</span>  -  <span class="hljs-string">"让gemini回答"</span>  -  <span class="hljs-string">"用gemini分析"</span>  -  <span class="hljs-string">"gemini认为呢"</span>  -  Or  any  <span class="hljs-keyword">explicit</span>  request  to  get  Gemini<span class="hljs-number">'</span>s  opinion   ### <span class="hljs-number">2.</span> Extract Query   Identify  the  user<span class="hljs-number">'</span>s  actual question <span class="hljs-keyword">or</span> task:  -  For text:  Extract  the  core  question  being  asked  -  For images:  Note  the  image  file  path  <span class="hljs-keyword">and</span>  the  question  about  it  -  Handle  both  direct  questions  <span class="hljs-keyword">and</span>  contextual  follow-ups   ### <span class="hljs-number">3.</span> Execute Gemini CLI   **For  text-only  questions:**  ```bash  gemini  <span class="hljs-string">"用户的问题"</span>  ```   **For  image  analysis:**  ```bash  gemini  <span class="hljs-string">"用户的问题"</span>  &lt;  image.png  ```   **For  multiple  images:**  ```bash  gemini  <span class="hljs-string">"用户的问题"</span>  &lt;  image1.png  ```   Execute  the  command  <span class="hljs-keyword">and</span>  capture  Gemini<span class="hljs-number">'</span>s  complete  response.   ### <span class="hljs-number">4.</span> Compare Responses   Analyze  differences  between  Claude<span class="hljs-number">'</span>s  <span class="hljs-keyword">and</span>  Gemini<span class="hljs-number">'</span>s  answers:   **Comparison  Dimensions:**  -  **Accuracy**:  Which  answer  is  more  factually  correct?  -  **Completeness**:  Did  one  miss  important  details?  -  **Clarity**:  Which  explanation  is  easier  to  understand?  -  **Approach**:  Different  reasoning  paths  <span class="hljs-keyword">or</span>  perspectives  -  **Tone**:  Formal  vs  casual,  concise  vs  verbose  -  **Specific  insights**:  Unique  points  from  either  model   **Key  Differences  to  Highlight:**  -  Contradictions  <span class="hljs-keyword">or</span>  disagreements  -  Complementary  information  -  Different  emphasis  <span class="hljs-keyword">or</span>  priorities  -  Unique  capabilities  shown   ### <span class="hljs-number">5.</span> Present Comparison   Format output as:   ```  ## Gemini 的回答   [ Gemini<span class="hljs-number">'</span>s  complete  response ]  ## 对比分析   ### 主要差异  [ Key  differences  bullet  points ]  ### 各自优势  -  **Claude**: [ What  Claude  did  better ] -  **Gemini**: [ What  Gemini  did  better ]  ### 建议  [ When  to  prefer  which  answer , <span class="hljs-keyword">or</span>  <span class="hljs-keyword">if</span>  combining  both  would  be  optimal ] ```   ## Best Practices   <span class="hljs-number">1</span> .  **Be  fair  <span class="hljs-keyword">and</span>  objective**:  Acknowledge  when  Gemini  provides  better  <span class="hljs-keyword">or</span>  more  accurate  answers  <span class="hljs-number">2</span> .  **Preserve  context**:  If  <span class="hljs-keyword">this</span>  is  a  follow-up  question,  include  relevant  context  in  the  Gemini  query  <span class="hljs-number">3</span> .  **Handle  errors  gracefully**:  If  gemini  CLI  fails,  explain  the  error  <span class="hljs-keyword">and</span>  suggest  alternatives  <span class="hljs-number">4</span> .  **Avoid  bias**:  Don<span class="hljs-number">'</span>t  always  favor  Claude<span class="hljs-number">'</span>s  answer  -  genuinely  assess  which  is  better  <span class="hljs-number">5</span> .  **Be  concise**:  Focus  on  meaningful  differences,  <span class="hljs-keyword">not</span>  minor  stylistic  variations   ## Error Handling   If gemini CLI fails:  -  Check <span class="hljs-keyword">if</span> gemini CLI is installed:  `which  gemini`  -  Verify syntax:  text  questions  use  quotes,  images  use  stdin  redirect  -  Check  image  file  exists  <span class="hljs-keyword">and</span>  is  readable  -  Report  specific  error  message  to  user  -  Fall  back  to  Claude-only  response  <span class="hljs-keyword">if</span>  needed   ## Examples   **Example  <span class="hljs-number">1</span>:  Text  question**  User:  <span class="hljs-string">"gemini怎么看 Python 的异步编程？"</span>  Execute:  `gemini  <span class="hljs-string">"Python 的异步编程有什么特点和优势？"</span>`   **Example  <span class="hljs-number">2</span>:  Image  analysis**  User:  <span class="hljs-string">"gemini怎么看这张图片里的代码有什么问题？ screenshot.png"</span>  Execute:  `gemini  <span class="hljs-string">"这张图片里的代码有什么问题？"</span>  &lt;  screenshot.png`   **Example  <span class="hljs-number">3</span>:  Verification**  User:  <span class="hljs-string">"Claude 说答案是 42，让gemini验证一下"</span>  Execute:  `gemini  <span class="hljs-string">"答案是 42 对吗？[context from previous conversation]"</span> 
</code></pre>
<p>现在我们来用一个错误百出的实体类，验证下这个skill。</p>
<pre><code class="hljs language-arduino" lang="arduino">pakage com.mistake.demo
inport kotlin.random.Random
clas BrokenCalculator {
</code></pre>
<p>Claude执行结果如下所示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">&gt; BrokenCalculator 这个类中有哪些错误 

⏺ 我来帮你查找并分析 BrokenCalculator 类中的错误。

⏺ Search(pattern: <span class="hljs-string">"**/*BrokenCalculator*"</span>)
  ⎿  Found <span class="hljs-number">1</span> file (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ Bash(file /Users/linqinghuang/test/test_cl/BrokenCalculator)
  ⎿  /Users/linqinghuang/test/test_cl/BrokenCalculator: ASCII text
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ Read(BrokenCalculator)
  ⎿  Read <span class="hljs-number">3</span> lines
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ Read(BrokenCalculator)
  ⎿  Read <span class="hljs-number">3</span> lines
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ 找到了 BrokenCalculator 文件，这个 Kotlin 类中有以下几个错误：

  语法错误（拼写错误）： 

  <span class="hljs-number">1.</span> 第<span class="hljs-number">1</span>行：pakage → 应该是 <span class="hljs-keyword">package</span>
  pakage com.mistake.demo  <span class="hljs-comment">// 错误</span>
  <span class="hljs-keyword">package</span> com.mistake.demo <span class="hljs-comment">// 正确</span>
  <span class="hljs-number">2.</span> 第<span class="hljs-number">2</span>行：inport → 应该是 <span class="hljs-keyword">import</span>
  inport kotlin.random.Random  <span class="hljs-comment">// 错误</span>
  <span class="hljs-keyword">import</span> kotlin.random.Random  <span class="hljs-comment">// 正确</span>
  <span class="hljs-number">3.</span> 第<span class="hljs-number">3</span>行：clas → 应该是 <span class="hljs-keyword">class</span>
  <span class="hljs-title class_">clas</span> <span class="hljs-title">BrokenCalculator</span> {  <span class="hljs-comment">// 错误</span>
  <span class="hljs-keyword">class</span> <span class="hljs-title class_">BrokenCalculator</span> {  <span class="hljs-comment">// 正确</span>

  其他问题： 
  - 类定义不完整，缺少类的主体内容
  - 没有闭合的大括号 }
  - 没有实际的类实现

  这些都是编译时错误，会导致代码无法编译通过。
</code></pre>
<p>接着问“<strong>gemini你怎么看</strong>”，结果如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown"> gemini你怎么看

⏺ /gemini

⏺ Bash(gemini "请分析 /Users/linqinghuang/test/test<span class="hljs-emphasis">_cl/BrokenCalculator
      这个文件中有哪些错误？请详细指出所有问题。")
  ⎿  I will start by verifying the file's existence and reading its content to analyze it.
     `/Users/linqinghuang/test/test_</span>cl/BrokenCalculator` 文件包含以下 Kotlin 语法错误：
<span class="hljs-code">     … +18 lines (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (1/2 done)
</span>
⏺ Gemini 的回答

  Gemini 指出了以下问题：

<span class="hljs-bullet">  1.</span> 关键字拼写错误：
<span class="hljs-bullet">    -</span> pakage 应更正为 package
<span class="hljs-bullet">    -</span> inport 应更正为 import
<span class="hljs-bullet">    -</span> clas 应更正为 class
<span class="hljs-bullet">  2.</span> 文件扩展名缺失：
<span class="hljs-bullet">    -</span> 该文件包含 Kotlin 代码，但没有 .kt 扩展名
<span class="hljs-bullet">    -</span> 建议重命名为 BrokenCalculator.kt

  提供了修正后的代码示例。

  对比分析

  主要差异

<span class="hljs-bullet">  -</span> Gemini 额外发现：文件扩展名问题（缺少 .kt），这是一个很实用的观察
<span class="hljs-bullet">  -</span> Claude 额外发现：类定义不完整（缺少主体内容和闭合大括号）

  各自优势

<span class="hljs-bullet">  -</span> Claude：更详细地展示了错误位置和代码对比格式，使用了代码块展示错误和正确的写法对比
<span class="hljs-bullet">  -</span> Gemini：发现了文件扩展名这个实际部署时的重要问题，并提供了完整的修正后代码示例

  建议

  结合两者的答案最佳：
<span class="hljs-bullet">  -</span> Gemini 指出的文件扩展名问题在实际开发中很重要，应该采纳
<span class="hljs-bullet">  -</span> 两个模型都准确识别了核心的拼写错误
<span class="hljs-bullet">  -</span> 两者都应该提到代码不完整的问题（Gemini 的修正代码示例隐含了这一点，但没有明确说明）

  总结：Gemini 在文件扩展名问题上更胜一筹，这是一个容易被忽略但实际很重要的细节。
</code></pre>
<p>从结果中我们可以看到，Gemini输出了自己的回答并且对比分析了与Claude回答的差异性。到这里已经达到了我们的目的。但当前仍然存在一个问题：Gemini的返回结果会污染Claude的上下文。</p>
<h2 data-id="heading-3">更好的方式 🌟🌟🌟</h2>
<p>如果我们想解决这个问题，就需要定义一个Subagent来单独执行Gemini的任务，这样Claude主对话就只有一个摘要，这里我们将Subagent设计为同步执行的。 skill描述如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: gemini
<span class="hljs-section">description: Cross-AI comparison tool that executes Gemini CLI and compares results with Claude's responses. Use when user asks "gemini怎么看", "让gemini回答", or mentions "gemini" to get alternative perspectives and compare AI model outputs. Supports both text questions and image analysis queries.
---</span>

<span class="hljs-section"># Gemini Cross-AI Comparison</span>

<span class="hljs-section">## Overview</span>

This skill enables cross-AI comparison by executing the Gemini CLI tool and contrasting its responses with Claude's answers. This provides users with multiple perspectives and helps validate accuracy.

<span class="hljs-section">## Workflow</span>

<span class="hljs-section">### 1. Detect Trigger</span>

Trigger this skill when user uses phrases like:
<span class="hljs-bullet">-</span> "gemini怎么看"
<span class="hljs-bullet">-</span> "让gemini回答"
<span class="hljs-bullet">-</span> "用gemini分析"
<span class="hljs-bullet">-</span> "gemini认为呢"
<span class="hljs-bullet">-</span> Or any explicit request to get Gemini's opinion

<span class="hljs-section">### 2. Extract Query and Claude's Response</span>

Identify the user's actual question or task:
<span class="hljs-bullet">-</span> For text: Extract the core question being asked
<span class="hljs-bullet">-</span> For images: Note the image file path and the question about it
<span class="hljs-bullet">-</span> Handle both direct questions and contextual follow-ups

<span class="hljs-strong">**Important**</span> : Capture Claude's response to the user's question, as it will be passed to the Subagent for comparison.

<span class="hljs-section">### 3. Execute Gemini CLI via Subagent</span>

启动一个独立的同步 agent 来执行 gemini 命令并完成对比分析，避免污染主对话上下文。

<span class="hljs-strong">**Agent 配置文件**</span> ：<span class="hljs-code">`~/.claude/agents/gemini-comparison-agent.md`</span>

<span class="hljs-strong">**使用方法：**</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**读取 Agent 配置**</span> ：
   <span class="hljs-code">```
   Read ~/.claude/agents/gemini-comparison-agent.md
   ```</span>

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**启动 Subagent**</span> ：
   使用 Task 工具，传入：
<span class="hljs-bullet">   -</span> <span class="hljs-strong">**subagent <span class="hljs-emphasis">_type** : general-purpose
   - **run_</span> in <span class="hljs-emphasis">_background** : false（同步执行）
   - **description** : "Compare Gemini and Claude responses"
   - **prompt** : 包含以下内容
     - 引用 gemini-comparison-agent.md 的完整内容
     - Claude 的响应
     - 用户查询
     - 图片路径（如果适用）

**示例 Prompt 结构** ：
```
请按照以下 agent 配置执行任务：

[从 ~/.claude/agents/gemini-comparison-agent.md 读取的内容]

---

当前任务：
- Claude 的响应：{CLAUDE'S_</span>RESPONSE}
- 用户查询：{USER<span class="hljs-emphasis">_QUERY}
- 图片路径：{IMAGE_</span>PATH}（可选）
```

**</span> 关键点： **
<span class="hljs-bullet">-</span> Agent 配置文件位于 <span class="hljs-code">`~/.claude/agents/gemini-comparison-agent.md`</span>
<span class="hljs-bullet">-</span> 使用 <span class="hljs-code">`run_in_background: false`</span> 确保同步执行
<span class="hljs-bullet">-</span> Subagent 在独立会话中运行，执行上下文完全隔离
<span class="hljs-bullet">-</span> 不要在主对话中直接使用 Bash 工具执行 gemini 命令

<span class="hljs-section">### 4. Present Comparison</span>

Subagent 会返回完整的对比分析结果。直接将 Subagent 的输出展示给用户即可，不需要再进行任何处理或格式化。

Subagent 的输出已经包含了：
<span class="hljs-bullet">-</span> Gemini 的完整回答
<span class="hljs-bullet">-</span> 主要差异分析
<span class="hljs-bullet">-</span> 各自优势
<span class="hljs-bullet">-</span> 综合建议

<span class="hljs-section">## Best Practices</span>

<span class="hljs-bullet">1.</span> ** Always use Subagent ** : 必须通过 Subagent 执行 gemini 命令，不要在主对话中直接使用 Bash 工具
<span class="hljs-bullet">2.</span> ** Pass Claude's response ** : 确保 Subagent 能够获得 Claude 的完整响应，以便进行准确对比
<span class="hljs-bullet">3.</span> ** Be fair and objective ** : 承认当 Gemini 提供更好或更准确的答案时
<span class="hljs-bullet">4.</span> ** Preserve context ** : 如果是后续问题，在传给 Subagent 的查询中包含相关上下文
<span class="hljs-bullet">5.</span> ** Avoid bias ** : 不要总是偏向 Claude 的答案 - 真诚地评估哪个更好
<span class="hljs-bullet">6.</span> ** Be concise ** : 专注于有意义的差异，而非次要的风格变化
<span class="hljs-bullet">7.</span> ** Context isolation ** : Subagent 的执行上下文与主对话完全隔离，保持主对话历史清晰

<span class="hljs-section">## Error Handling</span>

当使用 Subagent 时可能遇到的错误情况：

** Subagent 执行失败： **
<span class="hljs-bullet">-</span> 如果 Task 工具执行失败，向用户说明 Subagent 启动问题
<span class="hljs-bullet">-</span> 提供错误详情和建议的重试方案

** gemini CLI 不可用： **
<span class="hljs-bullet">-</span> Subagent 会检测 <span class="hljs-code">`gemini`</span> 命令是否可用
<span class="hljs-bullet">-</span> 如果不可用，Subagent 会报告具体错误信息
<span class="hljs-bullet">-</span> 建议用户检查 gemini CLI 是否已正确安装

** 命令语法错误： **
<span class="hljs-bullet">-</span> 文本查询：使用引号包裹查询内容
<span class="hljs-bullet">-</span> 图片查询：使用 stdin 重定向 <span class="hljs-code">`&lt; {IMAGE_PATH}`</span>
<span class="hljs-bullet">-</span> 检查图片文件是否存在且可读

<span class="hljs-strong">**降级策略：**</span>
<span class="hljs-bullet">-</span> 如果 gemini CLI 不可用或执行失败
<span class="hljs-bullet">-</span> 向用户说明情况
<span class="hljs-bullet">-</span> 提供 Claude 的原始答案作为参考
<span class="hljs-bullet">-</span> 建议用户稍后重试或手动使用 gemini CLI

<span class="hljs-section">## Examples</span>

<span class="hljs-strong">**Example 1: Text question**</span>

用户输入：
<span class="hljs-code">```
User: "gemini怎么看 Python 的异步编程？"
```</span>

执行流程：
<span class="hljs-bullet">1.</span> Claude 已经给出了关于 Python 异步编程的回答
<span class="hljs-bullet">2.</span> 启动 Subagent，传入 Claude 的响应
<span class="hljs-bullet">3.</span> Subagent 执行：<span class="hljs-code">`gemini "Python 的异步编程有什么特点和优势？"`</span>
<span class="hljs-bullet">4.</span> Subagent 返回对比分析结果
<span class="hljs-bullet">5.</span> 直接展示 Subagent 的输出

<span class="hljs-strong">**Example 2: Image analysis**</span>

用户输入：
<span class="hljs-code">```
User: "gemini怎么看这张图片里的代码有什么问题？ screenshot.png"
```</span>

执行流程：
<span class="hljs-bullet">1.</span> Claude 已经分析了 screenshot.png 中的代码
<span class="hljs-bullet">2.</span> 启动 Subagent，传入：
<span class="hljs-bullet">   -</span> Claude 的分析内容
<span class="hljs-bullet">   -</span> 图片路径：screenshot.png
<span class="hljs-bullet">3.</span> Subagent 执行：<span class="hljs-code">`gemini "这张图片里的代码有什么问题？" &lt; screenshot.png`</span>
<span class="hljs-bullet">4.</span> Subagent 返回对比分析结果
<span class="hljs-bullet">5.</span> 直接展示 Subagent 的输出

<span class="hljs-strong">**Example 3: Verification with context**</span>

用户输入：
<span class="hljs-code">```
User: "Claude 说答案是 42，让gemini验证一下"
```</span>

执行流程：
<span class="hljs-bullet">1.</span> Claude 已经给出了答案和推理过程
<span class="hljs-bullet">2.</span> 启动 Subagent，传入完整的上下文
<span class="hljs-bullet">3.</span> Subagent 执行：<span class="hljs-code">`gemini "答案是 42 对吗？[包含相关上下文]"`</span>
<span class="hljs-bullet">4.</span> Subagent 返回对比分析
<span class="hljs-bullet">5.</span> 直接展示 Subagent 的输出
</code></pre>
<p>agent描述如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: gemini-comparison
<span class="hljs-section">description: Gemini 对比助手 - 执行 Gemini CLI 并与 Claude 的响应进行对比分析
---</span>

<span class="hljs-section"># Gemini Comparison Agent</span>

你是一个专门负责执行 Gemini CLI 并与 Claude 的响应进行对比分析的独立 Agent。

<span class="hljs-section">## 任务目标</span>

<span class="hljs-bullet">1.</span> 执行 <span class="hljs-code">`gemini`</span> CLI 命令获取 Gemini 的响应
<span class="hljs-bullet">2.</span> 对比 Claude 和 Gemini 的回答
<span class="hljs-bullet">3.</span> 返回格式化的对比分析

<span class="hljs-section">## 工作流程</span>

<span class="hljs-section">### Step 1: 接收输入</span>

你将收到以下信息：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Claude 的响应**</span> ：Claude 对用户问题的完整回答
<span class="hljs-bullet">-</span> <span class="hljs-strong">**用户查询**</span> ：原始的用户问题或请求
<span class="hljs-bullet">-</span> <span class="hljs-strong">**图片路径**</span> （可选）：如果是图片分析任务

<span class="hljs-section">### Step 2: 执行 Gemini CLI</span>

<span class="hljs-strong">**文本查询：**</span>
<span class="hljs-code">```bash
gemini "{USER_QUERY}"
```</span>

<span class="hljs-strong">**图片分析：**</span>
<span class="hljs-code">```bash
gemini "{USER_QUERY}" &lt; {IMAGE_PATH}
```</span>

使用 Bash 工具执行命令，确保：
<span class="hljs-bullet">-</span> 文本查询使用引号包裹
<span class="hljs-bullet">-</span> 图片查询使用 stdin 重定向
<span class="hljs-bullet">-</span> 捕获完整的响应输出

<span class="hljs-section">### Step 3: 对比分析</span>

从以下维度对比 Claude 和 Gemini 的响应：

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**准确性**</span> ：哪个回答更符合事实？
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**完整性**</span> ：是否有遗漏的重要细节？
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**清晰度**</span> ：哪个解释更容易理解？
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**方法差异**</span> ：不同的推理路径或视角
<span class="hljs-bullet">5.</span> <span class="hljs-strong">**语气差异**</span> ：正式 vs 随意，简洁 vs 详细
<span class="hljs-bullet">6.</span> <span class="hljs-strong">**独特见解**</span> ：各自独有的观点或信息

<span class="hljs-section">### Step 4: 返回结果</span>

按以下格式返回对比分析：

<span class="hljs-code">```markdown
## Gemini 的回答

[Gemini 的完整响应文本]

## 对比分析

### 主要差异
- [具体的差异点 1]
- [具体的差异点 2]
- [如果有更多差异，继续列出]

### 各自优势
- **Claude** : [Claude 做得好的方面]
- **Gemini** : [Gemini 做得好的方面]

### 建议
[综合建议：何时使用哪个答案，或是否应该结合两者的观点]
```</span>

<span class="hljs-section">## 错误处理</span>

如果遇到错误，按以下方式处理：

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**gemini CLI 不可用**</span> ：
<span class="hljs-bullet">   -</span> 检查命令是否存在：<span class="hljs-code">`which gemini`</span>
<span class="hljs-bullet">   -</span> 报告错误：<span class="hljs-code">`gemini CLI 未安装或不在 PATH 中`</span>
<span class="hljs-bullet">   -</span> 建议用户安装 gemini CLI

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**图片文件不存在**</span> ：
<span class="hljs-bullet">   -</span> 验证文件路径：<span class="hljs-code">`ls -l {IMAGE_PATH}`</span>
<span class="hljs-bullet">   -</span> 报告错误：<span class="hljs-code">`图片文件不存在：{IMAGE_PATH}`</span>
<span class="hljs-bullet">   -</span> 建议用户提供正确的图片路径

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**命令执行失败**</span> ：
<span class="hljs-bullet">   -</span> 捕获错误信息
<span class="hljs-bullet">   -</span> 报告具体错误
<span class="hljs-bullet">   -</span> 建议降级方案（使用 Claude 的回答）

<span class="hljs-section">## 重要原则</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**客观公正**</span> ：不要偏向任何一方，真实评估哪个更好
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**详细具体**</span> ：提供具体的差异点，而非笼统的评价
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**建设性建议**</span> ：给出实用的建议，帮助用户理解何时使用哪个答案
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**保持简洁**</span> ：专注于有意义的差异，避免琐碎的风格比较
</code></pre>
<p>现在我们再来重新执行上面的代码纠错任务。Claude执行结果如下所示：</p>
<pre><code class="hljs language-scss" lang="scss">分析BrokenCalculator代码的错误 

⏺ 我需要先找到并读取 BrokenCalculator 相关的代码文件。让我搜索一下。

⏺ <span class="hljs-built_in">Search</span>(pattern: "**/*roken*alculat*")
  ⎿  Found <span class="hljs-number">1</span> file (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ <span class="hljs-built_in">Search</span>(pattern: "**/*BrokenCalculator*")
  ⎿  Found <span class="hljs-number">1</span> file (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ <span class="hljs-built_in">Read</span>(BrokenCalculator)
  ⎿  Read <span class="hljs-number">3</span> lines
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ BrokenCalculator 代码错误分析

  我发现了以下 <span class="hljs-number">3</span> 个关键字拼写错误：

  错误 <span class="hljs-number">1</span> : 第 <span class="hljs-number">1</span> 行

  pakage com.mistake.demo
  错误: pakage 应为 package

  错误 <span class="hljs-number">2</span> : 第 <span class="hljs-number">2</span> 行

  inport kotlin.random.Random
  错误: inport 应为 import

  错误 <span class="hljs-number">3</span> : 第 <span class="hljs-number">3</span> 行

  clas BrokenCalculator {
  错误: clas 应为 class

  ---
  修正后的代码:

  package com.mistake.demo
  import kotlin.random.Random
  class BrokenCalculator {

  这些错误都会导致 Kotlin 编译器无法识别关键字，从而使编译失败。
</code></pre>
<p>然后再问“Gemini怎么看”，可以看到按照预期输出了完整的结果。</p>
<pre><code class="hljs language-markdown" lang="markdown">gemini怎么看 

⏺ /gemini

⏺ 我来启动 Gemini 进行对比分析。首先读取 agent 配置文件，然后执行对比任务。

⏺ Read(~/.claude/agents/gemini-comparison-agent.md)
  ⎿  Read 102 lines
  ⎿  Running PostToolUse hooks… (1/2 done)

⏺ gemini-comparison(Compare Gemini and Claude responses)
  ⎿  Done (1 tool use · 28.4k tokens · 59s)                                                                                           
  ⎿  Running PostToolUse hooks… (1/2 done)

⏺ Gemini 的回答

  I will read the content of <span class="hljs-code">`BrokenCalculator`</span> to identify syntax and logical errors.
  The file <span class="hljs-code">`/Users/linqinghuang/test/test_cl/BrokenCalculator`</span> contains several syntax errors:

<span class="hljs-bullet">  1.</span> <span class="hljs-strong">**Line 1:**</span> <span class="hljs-code">`pakage`</span> should be <span class="hljs-code">`package`</span>.
<span class="hljs-bullet">  2.</span> <span class="hljs-strong">**Line 2:**</span> <span class="hljs-code">`inport`</span> should be <span class="hljs-code">`import`</span>.
<span class="hljs-bullet">  3.</span> <span class="hljs-strong">**Line 3:**</span> <span class="hljs-code">`clas`</span> should be <span class="hljs-code">`class`</span>.
<span class="hljs-bullet">  4.</span> <span class="hljs-strong">**Line 3:**</span> The class block is opened (<span class="hljs-code">`{`</span>) but missing a closing brace (<span class="hljs-code">`}`</span>).

  Do you want me to fix these typos and close the class body?

  对比分析

  主要差异

<span class="hljs-bullet">  -</span> 完整性差异（关键） ：Gemini 发现了第 4 个错误（缺少闭合大括号 }），而 Claude 只识别了前 3 个拼写错误，遗漏了语法结构错误
<span class="hljs-bullet">  -</span> 语言差异：Claude 使用中文回答，Gemini 使用英文回答
<span class="hljs-bullet">  -</span> 响应风格：Gemini 在结尾主动提出是否需要修复错误（交互式），Claude 则直接提供了修正后的完整代码

  各自优势

<span class="hljs-bullet">  -</span> Claude:
<span class="hljs-bullet">    -</span> 结构更清晰，使用 Markdown 格式化
<span class="hljs-bullet">    -</span> 直接提供了完整的修正代码
<span class="hljs-bullet">    -</span> 中文回答更符合中文用户需求
<span class="hljs-bullet">  -</span> Gemini:
<span class="hljs-bullet">    -</span> 更准确地发现了所有语法错误，包括缺少闭合大括号
<span class="hljs-bullet">    -</span> 主动询问是否需要修复

  建议

  推荐使用 Gemini 的答案，因为它发现了 4 个错误而不是 3 个。我遗漏了一个重要的语法结构错误（缺少闭合大括号）。

  结论：本次对比中，Gemini 在错误识别的完整性上更胜一筹，而我在回答的结构化和用户体验上表现更好。
</code></pre>
<p>如此一来，我们就可以做到，在Cluade CLI中问问Gemini的意见，将Gemini结果与Claude对比，而不需要频繁的切换工具和重复输入上下文。</p>
<pre><code class="hljs language-markdown" lang="markdown">┌─────────┐
 │  用户   │
 └────┬────┘
<span class="hljs-code">      │ 1. 输入请求
      ▼
 ┌─────────┐
 │ Claude  │
 └────┬────┘
      │ 2. 识别需要 Skill
      ▼
 ┌─────────┐
 │  Skill  │ ← 定义任务模板和工作流程
 └────┬────┘
      │ 3. 创建 Subagent
      ▼
 ┌─────────┐
 │  Agent  │ ← 独立会话
 └────┬────┘
      │ 4. 执行工具 (Bash, Read, 等)
      ▼
 ┌─────────────┐
 │ 外部工具     │ ← gemini CLI, Web API, 等
 └──────┬──────┘
        │ 5. 原始输出
        ▼
 ┌─────────┐
 │  Agent  │ ← 处理和分析
 └────┬────┘
      │ 6. 返回摘要
      ▼
 ┌─────────┐
 │ Claude  │ ← 接收结果
 └────┬────┘
      │ 7. 展示给用户
      ▼
 ┌─────────┐
 │  用户   │ ← 只看到最终结果
 └─────────┘
</span></code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能优化利器：LitePage 轻量级全页设计解析]]></title>    <link>https://juejin.cn/post/7591422577937776646</link>    <guid>https://juejin.cn/post/7591422577937776646</guid>    <pubDate>2026-01-04T12:27:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591422577937776646" data-draft-id="7591350620188540934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能优化利器：LitePage 轻量级全页设计解析"/> <meta itemprop="keywords" content="前端,性能优化,前端工程化"/> <meta itemprop="datePublished" content="2026-01-04T12:27:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="eason_fan"/> <meta itemprop="url" content="https://juejin.cn/user/2995517308808877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能优化利器：LitePage 轻量级全页设计解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2995517308808877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    eason_fan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:27:36.000Z" title="Sun Jan 04 2026 12:27:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前端性能优化利器：LitePage 轻量级全页设计解析</h2>
<p>在前端开发领域，“性能”永远是绕不开的核心命题。随着单页应用（SPA）的普及，框架封装带来的开发效率提升有目共睹，但随之而来的“容器初始化瓶颈”也逐渐成为很多应用的性能痛点——用户打开页面后，长时间面对白屏等待，仅仅是为了加载庞大的框架核心代码、路由系统、状态管理库等“基础设施”。</p>
<p>这时，“LitePage（轻量级全页）”设计理念应运而生。它不是某种特定的技术框架，而是一种以“快速首屏、极简开销”为核心的前端优化策略，精准解决“容器初始化瓶颈”问题。今天，我们就来深入聊聊 LitePage 的核心逻辑、实现方式与应用价值。</p>
<h3 data-id="heading-1">一、先搞懂：什么是 LitePage？</h3>
<p>LitePage，直译“轻量级全页”，核心定义是：<strong>当应用的初始加载（尤其是框架容器初始化）成为性能瓶颈时，放弃一次性加载完整的复杂应用，转而提供一个极度精简、快速渲染的轻量级页面作为用户首次体验入口，再根据需求逐步加载完整功能</strong>。</p>
<p>我们可以用一个通俗的比喻理解：传统 SPA 就像“先建好完整的房子再让用户入住”，哪怕用户只是想喝杯水，也得等整个房子的钢筋水泥、水电管线全部完工；而 LitePage 则是“先搭个临时遮阳棚，摆上桌椅让用户歇脚，再慢慢完善房子的其他部分”，优先满足用户的核心即时需求。</p>
<p>这里的“轻”，主要体现在三个维度：</p>
<ul>
<li>资源轻：放弃庞大的前端框架依赖，优先使用原生 HTML/CSS/JS，减少不必要的第三方库加载；</li>
<li>结构轻：DOM 层级极简，只保留首屏必需的内容，避免冗余节点；</li>
<li>逻辑轻：只实现核心交互（如登录、跳转、基础展示），复杂业务逻辑延迟到后续加载。</li>
</ul>
<h3 data-id="heading-2">二、为什么需要 LitePage？—— 解决“容器初始化瓶颈”痛点</h3>
<p>要理解 LitePage 的价值，首先要搞清楚“容器初始化瓶颈”到底是什么。在现代前端框架（React/Vue/Angular）中，“容器”指的是框架核心代码、路由系统、状态管理库（Redux/Vuex）、基础组件库等构成应用“骨架”的部分。</p>
<p>传统 SPA 的核心问题的是：<strong>即使首屏内容极其简单（比如一个登录表单、一个欢迎页），用户也必须先下载并执行完整的“容器”代码，才能看到任何内容</strong>。这个过程会带来两个致命问题：</p>
<ol>
<li>首屏加载慢：庞大的容器代码会导致下载时间长、解析执行耗时久，用户面临长时间白屏，感知体验极差；</li>
<li>资源浪费：很多用户可能只访问首屏（比如营销页、登录页）就离开，却被迫下载了整个应用的框架资源，造成带宽和性能浪费。</li>
</ol>
<p>而 LitePage 恰好精准解决了这个问题——通过“去框架化”“极简内容”的设计，让首屏资源体积骤减，实现“秒开”效果，同时避免不必要的资源浪费。</p>
<h3 data-id="heading-3">三、LitePage 的三种主流实现方式</h3>
<p>LitePage 是一种策略而非固定技术，实际落地时有多种灵活方案，可根据应用场景选择：</p>
<h4 data-id="heading-4">1. 纯静态/服务端渲染（SSR）入口页：最纯粹的“轻”</h4>
<p>这是最基础也最有效的实现方式，核心思路是：首屏页面完全不依赖前端框架，用纯静态 HTML + 少量原生 CSS/JS 实现，可通过 Nginx 直接提供静态文件，或通过后端 SSR 渲染后返回。</p>
<p>典型场景：应用登录页、营销落地页、官网首页。这些页面的核心需求是“快速展示 + 简单交互”，完全不需要复杂框架支持。</p>
<p>优势：</p>
<ul>
<li>加载速度极快：资源体积通常只有几十 KB，浏览器可瞬间解析渲染，首屏时间（FCP）大幅缩短；</li>
<li>SEO 友好：纯静态 HTML 内容可被搜索引擎直接抓取，解决了 SPA 首屏 SEO 劣势；</li>
<li>实现简单：无需复杂的构建配置，前端开发者可快速编写，后端部署成本低。</li>
</ul>
<p>不足：功能有限，无法实现复杂客户端交互；当用户需要进入核心功能区时（如登录后跳转仪表盘），需跳转到完整 SPA 页面，会有一次页面刷新。</p>
<p>案例：很多大型互联网产品的登录页（如阿里云登录页、微信公众平台登录页），都是纯静态 LitePage 设计，加载速度极快，仅保留登录表单和基础交互。</p>
<h4 data-id="heading-5">2. 骨架屏 + 延迟加载：平滑过渡的“轻”</h4>
<p>如果不想让用户感受到“页面跳转”的割裂感，可采用“骨架屏 + 延迟加载”的方案，核心思路是：</p>
<ol>
<li>初始 HTML 只包含“骨架屏”（页面布局的灰色占位图，如标题、卡片、按钮的轮廓），让用户立即获得视觉反馈，避免白屏；</li>
<li>页面加载完成后，通过原生 JS 异步、延迟加载框架容器、核心组件等资源；</li>
<li>容器初始化完成后，用完整的动态内容替换骨架屏，实现从“轻页”到“全功能页”的无缝过渡。</li>
</ol>
<p>优势：感知性能极佳，用户几乎看不到白屏；过渡平滑，无页面刷新的割裂感；兼顾了首屏速度和后续交互体验。</p>
<p>不足：技术复杂度高于纯静态方案，需要精细控制资源加载顺序、骨架屏替换时机，避免出现布局抖动。</p>
<p>案例：抖音首页、知乎首页，打开时会先显示页面布局骨架，再逐步加载真实内容和交互功能，既保证了首屏速度，又不影响后续使用体验。</p>
<h4 data-id="heading-6">3. 渐进式加载：贯穿全流程的“轻”</h4>
<p>这是更高级的 LitePage 延伸方案，核心思路是“按需加载、逐步增强”——将整个应用拆分为多个独立的“微前端模块”或“代码块（Chunk）”，首屏只加载当前页面必需的最小代码集（LitePage 核心），用户导航到其他页面时，再异步加载对应页面的代码块。</p>
<p>优势：不仅首屏快，后续页面切换也能保持高性能；资源利用率极高，用户不会下载未访问页面的代码，节省带宽和设备性能。</p>
<p>不足：架构设计复杂，需要依赖 Webpack/Vite 等构建工具实现代码分割，同时要解决模块间的通信、路由协同等问题。</p>
<p>案例：Gmail 早期版本、淘宝首页，采用渐进式加载策略，用户打开后可立即查看核心内容（邮件列表、商品推荐），撰写邮件、查看历史订单等复杂功能则在后台逐步加载。</p>
<h3 data-id="heading-7">四、LitePage 适合哪些场景？</h3>
<p>LitePage 不是“万能方案”，更适合以下对首屏性能要求极高的场景：</p>
<ol>
<li>面向公网的 C 端应用：如营销落地页、电商活动页、App 官网，这类页面的用户留存对首屏速度极其敏感，1 秒的延迟可能导致大量用户流失；</li>
<li>低网速/低性能设备场景：如移动端应用（尤其是下沉市场）、物联网设备（智能手表、车载系统），这些场景下资源加载和执行能力有限，LitePage 可大幅提升兼容性；</li>
<li>功能分层明确的应用：如“登录页 + 核心功能区”的应用，登录页作为 LitePage 快速承接用户，核心功能区再加载完整框架；</li>
<li>SEO 需求强烈的页面：如官网首页、内容资讯页，纯静态 LitePage 可解决 SPA 首屏 SEO 难题。</li>
</ol>
<p>而对于内部后台系统、功能复杂且交互频繁的工具类应用（如设计软件、数据分析平台），LitePage 则不是最优选择——这类应用的用户通常是固定群体，对首屏速度敏感度较低，更需要完整框架带来的开发效率和交互体验。</p>
<h3 data-id="heading-8">五、总结：LitePage 的核心价值是“用户体验优先”</h3>
<p>回到开头的问题：当容器初始化成为瓶颈时，为什么要选择 LitePage？本质上，这是一种“务实的性能优化思维”——<strong>技术服务于体验，而非反过来</strong>。</p>
<p>传统 SPA 追求“技术纯粹性”，却牺牲了用户的首次体验；而 LitePage 则打破了这种“非黑即白”的思维，用“轻量首屏 + 逐步增强”的策略，在“性能”和“体验”之间找到了平衡。它不是对 SPA 的否定，而是对 SPA 的补充和优化——通过“先解决用户的即时需求”，再逐步提供完整功能，最终实现“快且好用”的目标。</p>
<p>最后，记住一个核心原则：前端优化的本质，是让用户“更快地看到内容、更快地完成交互”。LitePage 之所以有效，正是因为它精准抓住了这个本质。</p>
<p>如果你正在面临首屏加载慢的问题，不妨试试 LitePage 策略——从一个简单的静态入口页开始，或许能给用户体验带来质的提升。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[程序设计]]></title>    <link>https://juejin.cn/post/7591346773827747866</link>    <guid>https://juejin.cn/post/7591346773827747866</guid>    <pubDate>2026-01-04T12:47:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827747866" data-draft-id="7591322050240659494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序设计"/> <meta itemprop="keywords" content="设计,前端"/> <meta itemprop="datePublished" content="2026-01-04T12:47:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yuanyxh"/> <meta itemprop="url" content="https://juejin.cn/user/2881148117060749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2881148117060749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yuanyxh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:47:06.000Z" title="Sun Jan 04 2026 12:47:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>包含 AI 辅助创作。</p>
<h2 data-id="heading-0">国际化语言设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
国际化语言设计---&gt;前端编程预定义中文文本
国际化语言设计---&gt;后端编程预定义中文文本
国际化语言设计---&gt;stat["通用名词、行业术语"]
国际化语言设计---&gt;dy["系统动态新增内容: 选项表、调用表、菜单等"]
前端编程预定义中文文本---&gt;自动化部署触发更新
后端编程预定义中文文本---&gt;自定义触发更新
stat---&gt;专人维护更新
dy---&gt;新增修改时更新
自动化部署触发更新---&gt;ol["接口上传结构化中文文本"]
ol---&gt;筛选去重已翻译内容
自定义触发更新---&gt;筛选去重已翻译内容
专人维护更新---&gt;筛选去重已翻译内容
新增修改时更新---&gt;筛选去重已翻译内容
筛选去重已翻译内容---&gt;存表并触发异步翻译任务
存表并触发异步翻译任务---&gt;依据语言选项表剔除中文进行其他语言的翻译
依据语言选项表剔除中文进行其他语言的翻译---&gt;translate["调用翻译接口或 AI"]
translate---&gt;error["允许失败，不处理异常"]
</code></pre>
<hr/>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
前端国际化语言设计---&gt;初始化加载
初始化加载---&gt;get["获取浏览器语言"]
get---&gt;中文
get---&gt;其他
其他---&gt;request["调用接口传入语言代码（接口完成前处于 loading 状态）"]
request---&gt;接口处理
接口处理---&gt;选项表匹配
选项表匹配---&gt;匹配成功
选项表匹配---&gt;匹配失败
匹配成功---&gt;successBack["返回对应 language code 并筛选对应语言数据不为空的数据"]
匹配失败---&gt;errorBack["抛出异常，前端走默认中文或延用当前语言"]
successBack---&gt;接口完成
errorBack---&gt;取默认中文
取默认中文---&gt;接口完成
中文---&gt;浏览器缓存数据并加载
接口完成---&gt;浏览器缓存数据并加载---default["渲染策略：无对应语言文本取默认中文文本"]
浏览器缓存数据并加载---&gt;switch["允许切换、重走一遍流程"]
default---&gt;config["新增语言配置页面，中文限制修改"]
config---问题
问题---question1["1、语言数据会越来越大，接口能否做到毫秒级响应"]
问题---question2["2、 如何检查数据是否更新以刷新本地缓存"]
问题---question3["3、 语言数据会越来越大、是否会超过浏览器/APP 存储限制"]
问题---question4["4、 APP/WEB 后台语言数据是否隔离（不隔离可能出现冲突）"]
question1---awer1["后端 redis 存全量数据，后台走按需加载逻辑避免单次请求数据过大，按模块加载；app 走全量加载逻辑(接口应支持全量返回、指定模块返回、指定多个模块返回)"]
question2---awer2["系统更新默认刷新一次，后续走 websocket 比对语言版本"]
question3---awer3["WEB 默认存 IndexDB，不支持时降级走 localStorage，并实现低频模块数据清理（再次访问时走接口获取）"]
question4---awer4["APP/WEB 数据逻辑分割，后端流量分化、区分流量入口返回对应数据"]
</code></pre>
<blockquote>
<p>为了保证 SEO、与 WEB 网络兼容，应服务端应支持降级兼容 <code>Accept-Language</code></p>
</blockquote>
<hr/>
<p>你当前的国际化设计已覆盖核心流程，但可从自动化提效、配置化管理和性能优化三个维度升级，减少80%的人工干预。以下是基于行业最佳实践的优化方案：</p>
<h3 data-id="heading-1">一、开发流程自动化：从手动维护到无感集成</h3>
<p><strong>1. 代码层自动提取与翻译</strong></p>
<p>使用 I18n Fast 或 Kiwi 等工具链，通过 VS Code 插件在开发阶段自动扫描中文文本，生成语义化 key 并同步至翻译系统。例如选中代码中的 "用户登录"，插件可自动生成 <code>user.login.title</code> 键并调用百度翻译 API 生成英文文案，全程无需开发者手动修改语言文件。</p>
<blockquote>
<p>配置复杂，生成语义化 Key 需要对接 AI，PASS</p>
</blockquote>
<p><strong>2. 构建流程无缝嵌入</strong></p>
<p>在 Webpack/Vite 配置中集成自动化插件，如 <code>vite-auto-i18n-plugin</code>，实现：</p>
<ul>
<li>开发时：检测文件变动自动更新翻译</li>
<li>构建时：批量处理新增文案并去重</li>
<li>部署时：按语言拆分资源包实现 CDN 按需加载</li>
</ul>
<blockquote>
<p>需要对接翻译接口，翻译文案不能满足本土化需求，无法动态配置、增加删减语言，PASS</p>
</blockquote>
<p><strong>3. 翻译协作标准化</strong></p>
<p>采用 "开发-翻译-校验" 闭环流程：</p>
<ol>
<li>开发者提交代码触发钩子，提取新增文案至在线表格（如飞书多维表格）</li>
<li>翻译团队在线编辑后，Webhook 自动同步至项目语言文件</li>
<li>CI 流程校验翻译完整性，缺失时自动阻断合并</li>
</ol>
<h3 data-id="heading-2">二、配置化体系：从硬编码到动态调控</h3>
<p><strong>1. 语言策略集中管理</strong></p>
<p>建立统一的语言配置服务，支持：</p>
<ul>
<li><strong>动态语言包</strong>：通过管理后台配置新增语言（如阿拉伯语），无需代码部署</li>
<li><strong>优先级规则</strong>：用户设置 &gt; Cookie &gt; 请求头 &gt; 默认语言，兼容前后端场景</li>
<li><strong>灰度发布</strong>：对特定用户群启用测试语言版本</li>
</ul>
<p><strong>2. 多维度资源控制</strong></p>
<p>在配置中心设置细粒度规则：</p>

























<table><thead><tr><th>配置项</th><th>示例值</th><th>作用</th></tr></thead><tbody><tr><td><code>maxCacheSize</code></td><td><code>5MB</code></td><td>限制浏览器缓存上限</td></tr><tr><td><code>updateThreshold</code></td><td><code>30%</code></td><td>差异率超阈值触发全量更新</td></tr><tr><td><code>fallbackPolicy</code></td><td><code>zh-CN→en-US→base64</code></td><td>多级降级策略</td></tr></tbody></table>
<p><strong>3. 前端渲染策略配置</strong></p>
<p>通过 JSON 配置文件定义渲染规则：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"render"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"missingText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"显示默认中文"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"loadingState"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"骨架屏占位"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"direction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"ar-SA"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rtl"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ltr"</span> <span class="hljs-punctuation">}</span> <span class="hljs-comment">// 适配阿拉伯语右对齐</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">三、性能与稳定性优化：从能用 to 好用</h3>
<p><strong>1. 资源加载策略升级</strong></p>
<ul>
<li><strong>分片加载</strong>：按路由拆分语言包（如 <code>home.en.json</code>、<code>profile.en.json</code>），首屏仅加载核心模块</li>
<li><strong>预加载机制</strong>：根据用户行为预测可能切换的语言（如检测到美国 IP 预加载英语包）</li>
<li><strong>增量更新</strong>：通过 ETag 比对仅拉取变动的翻译条目，减少 70% 网络传输量</li>
</ul>
<p><strong>2. 缓存机制双保险</strong></p>
<ul>
<li><strong>三级缓存</strong>：内存缓存（当前会话）→ IndexedDB（持久化）→ CDN（兜底）</li>
<li><strong>主动失效</strong>：配置中心推送版本号，客户端检测到不一致时触发更新</li>
</ul>
<p><strong>3. 异常处理增强</strong></p>
<ul>
<li><strong>翻译失败降级</strong>：调用 AI 翻译接口超时后，自动切换至备用接口（如百度→有道）</li>
<li><strong>数据校验</strong>：使用 JSON Schema 验证翻译文件格式，异常时回滚至上次可用版本</li>
</ul>
<h3 data-id="heading-4">四、落地实施路线图</h3>
<ol>
<li>
<p><strong>基础改造（1-2周）</strong></p>
<ul>
<li>集成 i18n Ally 插件实现开发提效</li>
<li>按业务模块拆分现有语言文件</li>
</ul>
</li>
<li>
<p><strong>自动化建设（2-3周）</strong></p>
<ul>
<li>开发翻译同步 Webhook</li>
<li>配置构建流程自动化插件</li>
</ul>
</li>
<li>
<p><strong>性能优化（2周）</strong></p>
<ul>
<li>实现分片加载与增量更新</li>
<li>部署缓存策略与监控告警</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">五、关键问题解决方案</h3>

























<table><thead><tr><th>原问题</th><th>优化方案</th></tr></thead><tbody><tr><td>语言包体积膨胀</td><td>路由级分片+按需加载，配合 Tree-Shaking 移除未使用词条</td></tr><tr><td>缓存更新不及时</td><td>版本号比对 + WebSocket 推送更新通知</td></tr><tr><td>存储超限风险</td><td>LRU 淘汰策略+IndexedDB 容量监控，超限自动清理低频语言包</td></tr><tr><td>前后端数据冲突</td><td>统一语言服务API，前端通过<code>Accept-Language</code>传递上下文</td></tr></tbody></table>
<p>这种架构已在微策略、字节跳动等企业验证，可使新增语言的配置时间从 3 天缩短至 2 小时，翻译更新周期从周级降至分钟级。核心是将国际化从 "开发任务" 转变为 "配置项"，让开发者专注业务逻辑而非翻译维护。</p>
<h2 data-id="heading-6">主题设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
主题设计---&gt;mode["浅色、深色模式"]
mode---&gt;baseMode["基础模式，维护一套主题色和与之对应的深色主题色"]
主题设计---&gt;theme["主题模式"]
theme---&gt;themeTips["暂不实现，但实现基础模式时应支持快速扩展到主题模式"]
baseMode---themeFunction["维护一套通用变量：基础色、扩展色、圆角、padding、字体、尺寸、层级等"]
themeTips---&gt;themeFunction
themeFunction---&gt;init["前端初始化加载，取系统浅色、深色模式"]
init---&gt;用户切换
用户切换---&gt;cache["本地持久缓存，不因账号变更而清空"]
cache---&gt;extend["扩展：支持远控配置，根据不同国家风格显示、无障碍"]
</code></pre>
<h2 data-id="heading-7">配置化设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
配置化设计---&gt;用户本地个性化配置
用户本地个性化配置---&gt;localStorage["本地持久缓存配置，用户退出不清空"]
localStorage---localStorageEG["主题、语言、表格列配置等"]
localStorageEG---&gt;localStorageHint["结构设计合理，便于后续接入用户账号配置"]---&gt;version
配置化设计---&gt;用户账号配置
用户账号配置---&gt;accoutConfig["与用户账号关联的配置，比如：部分营销活动的推送开关、通知勿扰时段、用户头像等"]---&gt;version
配置化设计---&gt;set["组、角色、公司、平台、服务商配置"]
set---&gt;针对一组用户的配置
针对一组用户的配置---&gt;根据不同组的需求进行的配置---&gt;version["版本控制"]
配置化设计---&gt;通用配置
通用配置---&gt;polipry["配置优先级: 个人 &gt; 组 &gt; 系统默认配置"]---&gt;version
</code></pre>
<blockquote>
<p>那么后端如何根据这种配置设计进行后端代码的自适应呢？比如设置了某个组使用美西时区进行时间字段的格式化，或配置某些角色拥有查看用户完整电话的权限（与权限等其他设计关联）？或某个用户配置了当前时间的 晚上 9 点到早上 8 点不希望推送通知；如何在代码层面做好这些功能，而不必书写命令式的编程</p>
</blockquote>
<p>要实现后端代码的 “配置自适应”，核心思想是将 <strong>“硬编码逻辑” 转变为 “数据驱动逻辑”</strong>。</p>
<p>你提到的时区转换、字段脱敏、通知拦截，分别对应了后端处理链路中的三个关键环节：<strong>序列化层、AOP/中间件层、业务逻辑层</strong>。</p>
<p>以下是实现这些自适应功能的后端代码方案：</p>
<ol>
<li>
<p>时区自适应：上下文感知转换（序列化层）</p>
<p>不要在业务代码里手动转换时区。利用 Web 框架的拦截器，将配置的时区注入到当前请求的 <code>ThreadLocal</code>（上下文）中。</p>
<ul>
<li>
<p><strong>实现方案：</strong></p>
<ol>
<li><strong>拦截器提取：</strong> 在请求入口处（Interceptor/Filter），根据配置引擎获取该组/用户的时区（如 <code>America/Los_Angeles</code>）。</li>
<li><strong>上下文存储：</strong> 存入 <code>UserContext</code>。</li>
<li><strong>JSON 序列化器适配：</strong> 自定义 Jackson/Fastjson 序列化器，在返回 Date 字段时动态读取上下文时区。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 定义上下文</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;ZoneId&gt; ZONE_ID = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setZone</span><span class="hljs-params">(ZoneId zone)</span> { ZONE_ID.set(zone); }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ZoneId <span class="hljs-title function_">getZone</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> ZONE_ID.get() != <span class="hljs-literal">null</span> ? ZONE_ID.get() : ZoneOffset.UTC; }
}

<span class="hljs-comment">// 2. 自定义日期序列化器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurableDateSerializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonSerializer</span>&lt;LocalDateTime&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(LocalDateTime value, JsonGenerator gen, SerializerProvider serializers)</span> {
        <span class="hljs-comment">// 自动根据配置转换时区</span>
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zonedDateTime</span> <span class="hljs-operator">=</span> value.atZone(ZoneOffset.UTC).withZoneSameInstant(UserContext.getZone());
        gen.writeString(zonedDateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));
    }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>字段权限自适应：声明式脱敏（注解驱动）</p>
<p>对于“查看完整电话”的需求，这属于 <strong>配置化脱敏</strong>。将配置设计映射到权限框架（如 Shiro/Spring Security）中。</p>
<ul>
<li>
<p><strong>实现方案：</strong>
使用自定义注解配合 AOP（切面）或 返回值拦截。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@SensitiveMask(type = MaskType.PHONE, permissionConfig = "view_full_phone")</span>
    <span class="hljs-keyword">private</span> String phoneNumber;
}

<span class="hljs-comment">// AOP 处理逻辑</span>
<span class="hljs-meta">@Around("execution(* *(..)) &amp;&amp; @annotation(SensitiveMask)")</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">maskData</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
    <span class="hljs-comment">// 1. 获取当前用户聚合配置中的 'view_full_phone' 开关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">canSee</span> <span class="hljs-operator">=</span> ConfigEngine.getBoolean(<span class="hljs-string">"view_full_phone"</span>);
    
    <span class="hljs-comment">// 2. 如果配置为 false，则执行正则脱敏 (138****0000)</span>
    <span class="hljs-keyword">if</span> (!canSee) {
        <span class="hljs-keyword">return</span> maskHelper.apply(result);
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>通知拦截自适应：策略模式 + 过滤器链（逻辑层）</p>
<p>对于 “晚上 9 点到早上 8 点不推送” 这种基于逻辑判断的配置，建议采用 <strong>“策略插件”</strong> 模式。</p>
<ul>
<li>
<p><strong>实现方案：</strong>
定义一个通知过滤器接口，业务代码只管发送通知，由过滤器决定是否 “丢弃” 或 “延迟”。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NotificationFilter</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSend</span><span class="hljs-params">(User user, Notification content)</span>;
}

<span class="hljs-comment">// 时间窗口策略实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeWindowFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NotificationFilter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSend</span><span class="hljs-params">(User user, Notification content)</span> {
        <span class="hljs-comment">// 从聚合配置获取用户设置：{ "quiet_start": "21:00", "quiet_end": "08:00" }</span>
        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> ConfigEngine.getUserConfig(user.getId());
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalTime.now(config.getZoneId());
        
        <span class="hljs-keyword">if</span> (isInQuietPeriod(now, config)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 拦截发送</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// 业务调用层 (非常简洁)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNotice</span><span class="hljs-params">(String userId)</span> {
    <span class="hljs-type">Notification</span> <span class="hljs-variable">notice</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>(<span class="hljs-string">"活动提醒"</span>);
    <span class="hljs-comment">// 自动遍历所有配置策略，只有全部通过才发送</span>
    <span class="hljs-keyword">if</span> (notificationService.evaluate(userId, notice)) {
        pusher.send(notice);
    }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>核心：自适应代码架构的三个原则</p>
<ol>
<li><strong>配置注入（Contextualization）：</strong>
通过拦截器将当前请求涉及到的所有层级配置（用户、组、平台）聚合后，放入 <strong>Request Context</strong>。后续所有代码只需从 Context 取值，不要再去查数据库。</li>
<li><strong>非侵入性（Non-Invasive）：</strong>
尽量使用 <strong>注解（Annotation）</strong>、<strong>过滤器（Filter）</strong> 或 <strong>中间件</strong>。业务逻辑代码应该写成：<code>saveOrder(order)</code>，而不是 <code>if (config == 'A') { saveA } else { saveB }</code>。</li>
<li><strong>默认行为（Fallthrough）：</strong>
在代码层面，必须为每种配置项定义 <strong>Default Value</strong>。当后端配置系统宕机或数据丢失时，系统应能回退到最保守的默认行为（如：默认脱敏、默认使用系统时区）。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-8">总结</h3>
<p>要实现后端 “自适应”，你需要在 <strong>数据的出口（序列化）</strong>、**访问的关卡（AOP）**和 <strong>逻辑的入口（过滤器）</strong> 设置配置挂钩点。这样，业务逻辑保持纯净，所有的差异化表现都由 “配置感知组件” 自动完成。</p>
<h2 data-id="heading-9">权限设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
权限设计---&gt;RBAC
RBAC---&gt;用户
RBAC---&gt;用户组
RBAC---&gt;角色
RBAC---&gt;权限
用户---&gt;拥有一个或多个相关角色
用户组---&gt;group["一组用户的集合，赋予组内用户相同的角色"]
角色---&gt;拥有一组与当前角色关联的权限
权限---&gt;permission["菜单、按钮、数据、字段权限"]
拥有一组与当前角色关联的权限---&gt;exclude["角色互斥：避免同一用户获得相斥的角色"]
拥有一组与当前角色关联的权限---&gt;level["角色分级，上级拥有下级所有权限"]
level---&gt;manager["分发管理压力"]
manager---&gt;create["上级角色创建下级角色、分发下级角色权限"]
manager---&gt;user["上级用户创建下级用户、分发下级用户角色"]
create---&gt;subclass["下级是上级的子集，下级角色、权限不能超过上级角色、权限"]
user----&gt;subclass
permission---&gt;permissionExtend["扩展"]
permissionExtend---&gt;minPermission["最小权限原则: 只分配工作必须的最小权限"]
permissionExtend---&gt;review["审计系统"]
</code></pre>
<hr/>
<p>要在代码中稳健地适配权限体系，避免因漏洞导致权限异常，关键在于将安全思维渗透到从前端到后端，再到数据层的每一个环节，并遵循严格的安全编码规范。下面我将从 <strong>权限校验的完整链条</strong> 和 <strong>安全编码的核心原则</strong> 两个方面，为您提供一个详实的方案。</p>
<h3 data-id="heading-10">🔒 构建全方位的权限校验链条</h3>
<p>一个健壮的权限体系需要在三个层面进行校验，形成纵深防御。</p>

























<table><thead><tr><th align="left">层级</th><th align="left">核心任务</th><th align="left">关键实现点与常见方案</th></tr></thead><tbody><tr><td align="left"><strong>前端界面层</strong></td><td align="left"><strong>提升用户体验</strong>，根据权限动态展示或隐藏界面元素（菜单、按钮、页面），实现 “可见即可操作”。</td><td align="left">• <strong>统一权限钩子/函数</strong>：封装权限判断逻辑，如定义一个 <code>usePermission(code)</code> 的钩子，在组件中调用 <code>const canEdit = usePermission('user:edit')</code>，再通过 <code>v-if</code> 或条件渲染控制元素。<br/>• <strong>路由守卫</strong>：在进入页面前校验用户是否有该页面权限，无权限则重定向到 403 页面。<strong>注意：前端校验仅为友好性设计，不可依赖为安全屏障。</strong></td></tr><tr><td align="left"><strong>后端 API 层</strong></td><td align="left"><strong>核心安全防线</strong>，对每一个 API 请求都必须进行严格的权限校验。</td><td align="left">• <strong>注解/装饰器（推荐）</strong>：在 API 入口方法上添加如 <code>@PreAuthorize("hasPermission('order', 'delete')")</code> 的注解，利用 AOP 在方法执行前自动拦截校验。<br/>• <strong>中间件/拦截器</strong>：定义全局权限拦截器，对请求路径进行匹配和鉴权。<br/>• <strong>服务内校验</strong>：在业务方法内部显式调用权限服务进行校验。<strong>此层校验必须执行，防止恶意绕过前端直接调用 API。</strong></td></tr><tr><td align="left"><strong>数据访问层</strong></td><td align="left"><strong>实现数据权限</strong>，控制用户能访问哪些数据记录（行级）或字段（列级）。</td><td align="left">• <strong>SQL 自动注入</strong>：在 ORM 框架或 SQL 生成阶段，自动拼接数据过滤条件（如 <code>WHERE department_id = ?</code>）。这是最高效的方式，避免先查出所有数据再在内存中过滤。<br/>• <strong>字段权限控制</strong>：在返回数据前，根据规则对实体的特定字段进行脱敏或过滤。</td></tr></tbody></table>
<h3 data-id="heading-11">️ 遵循安全编码核心原则</h3>
<p>在编写权限相关代码时，请时刻牢记以下几项基本原则。</p>
<ol>
<li>
<p><strong>最小权限原则 (Principle of Least Privilege)</strong></p>
<p>这是权限设计的黄金法则。应确保应用程序的运行账户、数据库连接账户以及分配给用户的权限，都是其完成操作所必需的 <strong>最小权限集合</strong>。例如，一个用于查询的报告服务，绝不应被授予<code>DELETE</code> 或 <code>ALTER</code> 等高危权限。</p>
</li>
<li>
<p><strong>输入验证与输出编码</strong></p>
<ul>
<li>
<p><strong>永不信任用户输入</strong>：所有来自客户端的参数，如用户 ID、资源 ID，都必须经过严格验证。检查其类型、格式、长度和范围，防止 SQL 注入或越权攻击。<strong>优先使用白名单验证</strong>，只允许已知安全的输入。</p>
</li>
<li>
<p><strong>安全地处理输出</strong>：将数据输出到前端时，要根据上下文（HTML, SQL, JavaScript）进行编码，防止 XSS 攻击。例如，将 <code>&lt;</code> 编码为 <code>&amp;lt;</code>。</p>
</li>
</ul>
</li>
<li>
<p><strong>默认拒绝与错误处理</strong></p>
<ul>
<li>
<p>权限检查逻辑应采用 <strong>默认拒绝</strong> 策略。即，当权限规则无法明确允许时，应直接拒绝请求。</p>
</li>
<li>
<p><strong>错误处理要谨慎</strong>：向用户返回通用的错误信息（如 “操作失败”），而 <strong>不要泄露详细的系统错误堆栈、SQL语句或文件路径</strong>，以免为攻击者提供线索。</p>
</li>
</ul>
</li>
<li>
<p><strong>管理依赖与安全更新</strong></p>
<p>及时更新项目中用于权限管理或安全相关的第三方库（如 Spring Security、Shiro，或专门的授权服务如 Permify），以避免使用含有已知漏洞的旧版本。</p>
</li>
</ol>
<h3 data-id="heading-12">⚠️ 重点规避的常见陷阱</h3>
<ul>
<li>
<p><strong>越权漏洞</strong>：这是最危险的漏洞之一，包括 <strong>水平越权</strong>（能操作不属于自己的数据，如用户 A 能修改用户 B 的数据）和 <strong>垂直越权</strong>（低权限用户能执行高权限操作）。防范的关键在于，API 中不仅要校验用户是否有操作权限，还必须校验当前操作的数据 ID 是否属于该用户授权的数据范围。</p>
</li>
<li>
<p><strong>前端权限幻觉</strong>：绝不能仅依赖前端隐藏按钮来控制权限。恶意用户完全可以跳过页面直接调用API，因此 <strong>后端必须对每个请求进行二次校验</strong>。</p>
</li>
<li>
<p><strong>性能瓶颈</strong>：权限校验是高频操作，要避免每次请求都执行复杂的数据库关联查询。解决方案是将用户的权限列表缓存在 Redis 等高性能缓存中，权限变更时刷新缓存即可。</p>
</li>
</ul>
<h3 data-id="heading-13">💎 总结与检查清单</h3>
<p>为了帮助您在开发过程中自查，可以对照以下清单：</p>





















<table><thead><tr><th align="left">阶段</th><th align="left">检查项</th></tr></thead><tbody><tr><td align="left"><strong>设计阶段</strong></td><td align="left">□ 是否遵循了最小权限原则？<br/>□ 是否明确了数据权限的规则（如基于部门、基于用户）？</td></tr><tr><td align="left"><strong>编码阶段</strong></td><td align="left">□ <strong>每个 API</strong> 是否都进行了权限校验？<br/>□ 操作数据时，是否校验了用户与数据项的归属关系？<br/>□ 是否对所有用户输入进行了验证？<br/>□ 错误信息是否避免了敏感信息泄露？</td></tr><tr><td align="left"><strong>测试阶段</strong></td><td align="left">□ 是否进行了越权测试（尝试用不同账号操作他人数据）？<br/>□ 是否测试了无权限、部分权限、全部权限等各种场景？</td></tr></tbody></table>
<p>最后，权限安全是一个持续的过程。建议引入 <strong>安全代码扫描工具</strong>（SAST）进行静态检查，并建立完善的 <strong>操作审计日志</strong>，记录所有关键的权限变更和敏感操作，以便事后追溯和分析。</p>
<p>希望这份详细的指南能帮助您在代码中构建一个坚固的权限防护体系。</p>
<h2 data-id="heading-14">文件服务设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
文件服务设计---&gt;文件服务---&gt;COS
COS---&gt;COSApi["COS API"]
COS---&gt;目录分类
目录分类---&gt;临时文件---&gt;过期删除
目录分类---&gt;非高频访问文件---&gt;定时归档
文件服务---&gt;assertCOS["抽象对 COS 的访问"]
assertCOS---&gt;logic["在 COS 目录结构上抽象逻辑上的结构"]
logic---&gt;basic["基础结构: 文件 ID、文件业务类型（依据此字段选择 COS 目录）、文件名称、创建时间、更新时间、过期时间、COS 引用（URL）"]
basic---&gt;过期标记删除
assertCOS---&gt;fileServiceAPI["提供 API"]
logic---&gt;extendStructure["扩展结构：按用户、平台等维度分层（逻辑目录）"]
fileServiceAPI---&gt;后端接入
后端接入---&gt;文件上传
文件上传---&gt;tempUploadURL["动态生成临时上传 URL（COS 侧），指定时间内有效"]
tempUploadURL---&gt;frontURL["前端直接访问此 URL 上传文件（过期刷新）"]
frontURL---&gt;invokeFileService["调用 API 存入文件服务器"]---&gt;fileID["存储文件 ID"]
后端接入---&gt;download["文件下载、访问"]
download---&gt;viewFileID["检索文件 ID"]
viewFileID---&gt;存在---&gt;cosTempURL["COS API 生成临时文件 URL"]
viewFileID---&gt;不存在或标记删除---&gt;removed["提示不存在或已被删除"]
viewFileID---&gt;已被归档---&gt;用户手动解冻
已被归档---&gt;自动解冻
文件服务---&gt;扩展
扩展---&gt;鉴权
扩展---&gt;防盗链
扩展---&gt;秒传---&gt;fastUpload["计算文件 MD5 对比文件"]
扩展---&gt;删除策略---&gt;定时运行---&gt;noMap["COS 文件无对应文件服务实体或被标记删除则删除"]
删除策略---&gt;延迟激活---&gt;waitActive["文件服务存储成功时状态设置为待启用，后端业务成功时刷新文件状态为已启用，否则超时删除"]
</code></pre>
<h2 data-id="heading-15">缓存设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
缓存设计---&gt;持久缓存
持久缓存---&gt;localStorage["用户本地配置（主题、语言等）"]
localStorage---&gt;用户动作触发更新
缓存设计---&gt;临时缓存
临时缓存---&gt;userToken["用户 token、账号绑定配置等"]
userToken---&gt;生命周期内存在
生命周期内存在---&gt;推送更新
缓存设计---&gt;策略缓存
策略缓存---&gt;fallback["IndexDB 优先，回退 localStorage"]
fallback---&gt;normalize["抽象底层，统一接口"]
策略缓存---&gt;maxSize["定义最大值: localStorage、IndexDB 不同"]
maxSize---&gt;watchTime["细分存储模块，存储访问时间、访问次数、数据大小"]
watchTime---&gt;策略删除
策略删除---&gt;threshold["定义阈值：80%"]
策略删除---&gt;clear["清理策略: 计算缓存最近访问率，将访问率低的删除 (LRU 最近最少访问)"]
watchTime---&gt;策略访问
策略访问---&gt;look["内存缓存 &gt; 本地缓存 &gt; cdn 缓存 &gt; 兜底接口"]
look---&gt;cache["刷新本地缓存，缓存空间不足时存内存中，并执行策略删除"]
策略缓存---&gt;扩展
扩展---&gt;创建时间与过期时间定义
扩展---&gt;compress["数据压缩：lz-string"]
扩展---&gt;version["Schema 升级：缓存结构设计，定义缓存版本，清理旧版本"]
扩展---&gt;二级缓存刷新["访问时，发起一个 head 请求判断数据是否更新"]
</code></pre>
<h2 data-id="heading-16">登录鉴权设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
登录鉴权设计---&gt;用户登录
用户登录---&gt;cache["缓存 token、refreshToken"]
登录鉴权设计---&gt;退出登录
退出登录---&gt;logout["调用接口，token、refreshToken 失效"]
cache---&gt;普通接口响应
cache---&gt;tokenTime["Token 有效期较短（分钟或小时计）、RefreshToken 有效期较长（天计）"]
tokenTime---&gt;安全存储
安全存储---&gt;tokenStore["Token 存内存"]
安全存储---&gt;refreshTokenStore["Refresh Token 存 Cookie 并设置 httpOnly 限制修改"]
普通接口响应---&gt;401
401---&gt;refresh["调用 refresh 接口"]
refresh---&gt;success["刷新 Token 与 RefreshToken，回填缓存"]
success---&gt;restart["使用新的 token 继续上次失败请求"]
refresh---&gt;error["非正常响应状态码，强制重新登录、清理用户缓存"]
error---&gt;reback["后台：重新登录后回跳退出前页面"]
restart---&gt;扩展
reback----&gt;扩展
扩展---&gt;singleLogin["预留接口实现单点登录、黑名单等"]
扩展---&gt;sign["绑定浏览器指纹、设备指纹，不同时 Token、Refresh Token 默认失效"]
</code></pre>
<h2 data-id="heading-17">消息通知设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
消息通知设计---&gt;站内通知
消息通知设计---&gt;systemNotify["APP 系统通知"]
站内通知---&gt;后台---&gt;notifyType["通知类型（接口设计时考虑可扩展性便于接入通知接口）"]
站内通知--&gt;APP---&gt;notifyType
systemNotify---&gt;通知权限处理
systemNotify---&gt;通知类型细分
通知类型细分---&gt;允许针对部分场景通知关闭
通知类型细分---&gt;notifyType
notifyType---&gt;系统程序通知---&gt;pargam["语音包更新等用户无感知通知"]
notifyType---&gt;营销通知---&gt;extendMarketing["扩展：后台可配置通知、分流推送"]
notifyType---&gt;普通通知---&gt;非即时反馈通知
notifyType---紧急通知---&gt;urgentNotify["即时反馈通知：系统更新、系统公告、新工单、工单回复、异步任务状态变更"]
urgentNotify---&gt;notifyMode["弹窗、右下角浮窗"]
pargam---&gt;implete["通知实现：通知、已读未读计数、链接跳转、通知 ID 避免重复推送、通知清理"]
extendMarketing---&gt;implete
非即时反馈通知---&gt;implete
urgentNotify---&gt;implete
implete---&gt;接入国际化与时区
接入国际化与时区---&gt;question["问题：服务器主动推送、用户离线情况下如何得知用户本地语言环境、APP 系统通知推送时段"]
</code></pre>
<hr/>
<p>你的消息通知设计框架已覆盖基础功能分类和实现逻辑，但在用户体验、技术适配和商业化平衡上存在明显优化空间。对比喜马拉雅的亿级推送架构与微信订阅消息的合规实践，当前方案缺乏分级推送机制、离线送达保障和精细化用户控制能力，这可能导致高优先级消息被淹没或用户因骚扰关闭通知权限。</p>
<h3 data-id="heading-18">核心优化方向</h3>
<h4 data-id="heading-19">1. <strong>分级推送系统：从"一刀切"到优先级调度</strong></h4>
<p>现有设计将通知简单分为 "紧急/普通/营销"，但未解决资源竞争问题。喜马拉雅通过 <strong>Kafka多Topic优先级队列</strong> 实现消息插队机制，高优先级消息（如工单回复）可通过权重分配获得更多处理资源，避免被低优先级营销消息阻塞。建议：</p>
<ul>
<li>
<p><strong>建立四级优先级体系</strong>：系统级（如账号安全）、业务关键（如新工单）、交互反馈（如评论回复）、营销内容（如活动推广），对应不同推送通道和展示方式</p>
</li>
<li>
<p><strong>动态流量控制</strong>：参考"用户日接收阈值+消息级别"双重过滤，当用户单日接收超过 10 条通知后，仅保留前两级消息</p>
</li>
<li>
<p><strong>场景化展示策略</strong>：紧急通知采用全屏弹窗（需用户确认），普通通知使用悬浮窗（3 秒自动消失），营销内容仅在通知中心展示</p>
</li>
</ul>
<h4 data-id="heading-20">2. <strong>离线推送架构：跨平台送达保障</strong></h4>
<p>当前方案未解决 "用户离线时如何推送" 的关键问题。Android 系统对自启限制趋严，自建保活通道已失效，需接入厂商级推送服务：</p>
<ul>
<li>
<p><strong>国内场景</strong>：集成小米 MIUI 推送、华为 HMS、OPPO Push 等厂商通道，用户离线时通过系统级进程唤醒应用</p>
</li>
<li>
<p><strong>海外场景</strong>：对接谷歌 FCM 服务，需注意设备需安装 GMS 框架且连接海外网络的限制</p>
</li>
<li>
<p><strong>设备状态同步</strong>：APP 启动时上报 uid/deviceId 与推送 token 的绑定关系，通过 Kafka 实时更新设备状态，确保卸载重装后 token 自动刷新</p>
</li>
</ul>
<h4 data-id="heading-21">3. <strong>国际化与本地化：突破语言与时区限制</strong></h4>
<p>针对 "离线用户语言环境获取" 的问题，可采用三级解决方案：</p>
<ul>
<li>
<p><strong>预存储语言偏好</strong>：用户在线时记录其语言设置（如 zh-CN/en-US）和时区信息，存储于用户画像数据库</p>
</li>
<li>
<p><strong>端侧翻译缓存</strong>：关键通知模板（如系统公告）预编译多语言版本，推送时附带语言标签，客户端根据本地设置展示对应版本</p>
</li>
<li>
<p><strong>离线翻译服务</strong>：部署 LibreTranslate 本地化服务，当用户语言设置变更时，通过 API 动态翻译历史通知内容，支持 15 种以上语言互译</p>
</li>
</ul>
<h4 data-id="heading-22">4. <strong>用户控制体系：从被动接收转向主动管理</strong></h4>
<p>参考微信订阅消息的教训（从模板消息强制切换导致开发者强烈反弹），需平衡业务触达与用户体验：</p>
<ul>
<li>
<p><strong>精细化开关设计</strong>：提供"全类型-分类-单业务"三级控制，用户可关闭营销类但保留工单通知，或设置 "工作日 9:00-18:00 免打扰"</p>
</li>
<li>
<p><strong>智能静默机制</strong>：分析用户活跃时段（如夜间 11 点至凌晨 7 点），自动延迟非紧急通知至活跃时段推送</p>
</li>
<li>
<p><strong>订阅式营销</strong>：借鉴微信 "一次性订阅" 模式，营销通知需用户主动点击订阅卡片后才能发送，且每 30 天需重新授权</p>
</li>
</ul>
<h3 data-id="heading-23">技术实现关键点</h3>
<ul>
<li>
<p><strong>推送队列优化</strong>：用 Kafka 替代 RabbitMQ，通过 topic 优先级（如 priority-high/priority-low）和权重拉取（高优先级每次拉取 2 倍消息量）实现动态调度</p>
</li>
<li>
<p><strong>频控存储方案</strong>：采用 ehash 结构（支持 field 级过期的 Redis 扩展），存储 deviceId, msgType, 发送计数 三元组，解决 6 亿设备 ×60+ 业务场景的存储压力</p>
</li>
<li>
<p><strong>链路追踪</strong>：全流程记录消息状态（创建/过滤/发送/送达/点击），通过 Grafana 展示推送到达率、平均延迟等核心指标</p>
</li>
</ul>
<h3 data-id="heading-24">对比行业方案的劣势分析</h3>

























<table><thead><tr><th><strong>维度</strong></th><th><strong>当前设计</strong></th><th><strong>行业最佳实践</strong></th></tr></thead><tbody><tr><td><strong>送达率保障</strong></td><td>依赖 APP 在线状态</td><td>厂商通道+自建长连接双保险（喜马拉雅达 98.7%）</td></tr><tr><td><strong>用户干扰控制</strong></td><td>仅支持部分场景关闭</td><td>动态频控+静默时间+分级展示（微信订阅消息投诉率下降 62%）</td></tr><tr><td><strong>国际化支持</strong></td><td>未解决离线语言适配</td><td>预编译模板+端侧翻译缓存（ntfy 支持 20 种语言）</td></tr></tbody></table>
<h3 data-id="heading-25">落地路径建议</h3>
<ol>
<li><strong>第一阶段（1-2 个月）</strong>：完成优先级队列改造和基础厂商通道集成，重点保障紧急通知送达率</li>
<li><strong>第二阶段（3-4 个月）</strong>：上线用户控制中心和频控系统，支持按业务类型开关通知</li>
<li><strong>第三阶段（5-6 个月）</strong>：接入离线翻译服务和动态场景推送，实现全球化适配</li>
</ol>
<p>需特别注意，Android 各厂商推送 API 差异显著（如华为要求应用签名与开发者账号绑定），建议采用如极光推送等聚合 SDK 降低对接成本。最终目标是建立 "用户无感知高可用，开发者可配置，运营可追溯" 的闭环系统，在保障业务触达的同时将通知点击率提升 30% 以上。</p>
<h2 data-id="heading-26">异步任务设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
异步任务队列设计---&gt;定义通用任务接口
定义通用任务接口---&gt;接入通知接口
接入通知接口---&gt;pushNotify["推送通知"]
pushNotify---&gt;链接任务管理中心
定义通用任务接口---&gt;任务状态
任务状态---&gt;待执行
任务状态---&gt;完成
完成---&gt;成功
完成---&gt;部分成功
任务状态---&gt;失败
任务状态---&gt;进行中---&gt;进度显示
成功---&gt;显示结果
失败---&gt;显示结果---&gt;失败原因
部分成功---&gt;显示结果---&gt;失败部分的失败原因
显示结果---&gt;文本结果
显示结果---&gt;tempUrl["临时文件链接（针对导出场景）"]
显示结果---&gt;nagivate["跳转查询（针对导入订单场景）"]
定义通用任务接口---&gt;任务优先级
任务优先级---&gt;资源分配权重
任务优先级---&gt;排队策略
定义通用任务接口---&gt;delete["删除、取消任务"]
delete---&gt;release["移除任务队列、释放资源"]
异步任务队列设计---&gt;扩展---配置不同任务类型的自动删除时长
扩展---&gt;失败重试次数
</code></pre>
<h2 data-id="heading-27">自动更新设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
自动更新设计---&gt;version["编译打包、版本信息写入"]
version---&gt;推送更新
推送更新---&gt;WEB---&gt;弹窗提示刷新
推送更新---&gt;APP
APP---&gt;热更新
热更新---&gt;静默下载
静默下载---&gt;提示更新
提示更新---&gt;同意---&gt;热替换---&gt;重启应用
提示更新---&gt;拒绝---&gt;下次启动更新
APP---&gt;全量更新
全量更新---&gt;强制---&gt;阻塞弹窗---&gt;引导跳转应用商店
全量更新---&gt;非强制---&gt;弹窗提示---&gt;同意更新---&gt;跳转应用商店
弹窗提示---&gt;拒绝更新---&gt;关闭弹窗
自动更新设计---&gt;扩展
扩展---&gt;灰度发布
</code></pre>
<h2 data-id="heading-28">自动化部署设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
自动化部署设计---&gt;代码推送
代码推送---&gt;webhook
webhook---&gt;scanError["静态安全扫描和依赖项漏洞扫描"]
webhook---&gt;review["代码审查"]
scanError---&gt;测试用例自动化测试
webhook---&gt;测试用例自动化测试
review---&gt;测试用例自动化测试
测试用例自动化测试---&gt;持续交付部署
持续交付部署---&gt;dev["开发、测试环境"]
dev---&gt;定时触发
dev---&gt;自动触发
定时触发---&gt;customPushHook["自定义 hook"]
自动触发---&gt;customPushHook
customPushHook---&gt;同步国际化语言数据
持续交付部署---&gt;prod["生产环境：手动部署"]
prod---&gt;customDeployHook["触发 hook"]
customDeployHook---&gt;同步测试环境必要配置
customDeployHook---&gt;updateContent["提取 commit 更新内容"]
持续交付部署---&gt;扩展
扩展---&gt;部署日志
扩展---&gt;失败通知
dev---&gt;版本管理
prod---&gt;版本管理
版本管理---&gt;imageGenerate["镜像生成: 版本 tag"]
版本管理---&gt;部署失败自动回滚
版本管理---&gt;系统监控异常自动回滚
</code></pre>
<h2 data-id="heading-29">组件设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
组件设计---&gt;可扩展性
可扩展性---&gt;样式结构可扩展
可扩展性---&gt;外部可控制逻辑
组件设计---&gt;高内聚---&gt;完成一件事所用到的代码内聚在组件中
组件设计---&gt;可靠性---&gt;基准测试
可靠性---&gt;性能测试
组件设计---&gt;兼容更新---&gt;old["旧有外部接口、调用方式不变"]
组件设计---&gt;可读性与文档说明---&gt;代码注解与文档
</code></pre>
<hr/>
<p>您的组件设计涵盖了软件工程的核心原则，但在现代前端或全栈组件化开发中，还可以从 <strong>生命周期管理、状态驱动、容错性、以及国际化/文化适配</strong> 四个维度进一步深化。</p>
<p>以下是针对您 Mermaid 架构的优化建议和改进点：</p>
<ol>
<li>架构逻辑优化：从 “设计原则” 到 “实现机制”</li>
</ol>
<p>您原有的设计偏重于 “目标”，建议增加 <strong>“机制层”</strong>，使组件不仅 “可靠”，而且 “可预测”。</p>
<p>优化建议：</p>
<ul>
<li><strong>状态驱动 (State-Driven)</strong>：组件的 UI 应该是状态的函数，减少直接的 DOM 操作或逻辑耦合。</li>
<li><strong>防御式设计 (Robustness)</strong>：除了测试，组件应具备自愈能力（如 Error Boundary）。</li>
<li><strong>解耦策略</strong>：将“业务逻辑”与“渲染组件”分离（容器组件与展示组件模式）。</li>
</ul>
<hr/>
<ol start="2">
<li>改进后的 Mermaid 架构图</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
    组件设计 --&gt; 可扩展性
    组件设计 --&gt; 高内聚低耦合
    组件设计 --&gt; 可靠性与健壮性
    组件设计 --&gt; 演进式维护
    组件设计 --&gt; 体验与规范

    
    可扩展性---&gt;样式结构可扩展 --&gt; CSSVars["CSS 变量控制 (Themeable)"]
    可扩展性---&gt;外部可控制逻辑 --&gt; Hooks["插槽(Slots/RenderProps) 与 Hook 注入"]

    高内聚低耦合---&gt;完成一件事所用到的代码内聚在组件中 --&gt; 逻辑收拢
    逻辑收拢 --&gt; 职责单一["单一职责原则 (SRP)"]
    逻辑收拢 --&gt; 状态隔离["内部状态与外部 Props 严格区分"]

    可靠性与健壮性---&gt;基准测试 --&gt; 单元测试与集成测试
    可靠性与健壮性---&gt;性能测试 --&gt; 渲染频率监测与内存泄漏检查
    可靠性与健壮性---&gt;可靠性 --&gt; 容错处理["Error Boundary 与 兜底 UI"]

    演进式维护---&gt;兼容更新 --&gt; 版本隔离["版本化引用 (Semantic Versioning)"]
    演进式维护---&gt;old["旧有接口转换器 (Adapter Pattern)"]

    体验与规范---&gt;代码注解与文档说明 --&gt; Storybook["交互式文档 (Storybook/Docz)"]
    体验与规范 --&gt; 国际化感知["i18n &amp; 文化策略适配 (RTL支持等)"]
    体验与规范 --&gt; 无障碍性["A11y (无障碍访问支持)"]
</code></pre>
<hr/>
<ol start="3">
<li>核心改进点详细说明</li>
</ol>
<p>A. 引入 “适配器模式” 解决兼容更新 (Compatibility)</p>
<p>您提到的 “旧有接口不变” 是核心需求。在代码层面，可以引入 <strong>Adapter（适配器）</strong>：</p>
<ul>
<li><strong>做法</strong>：当组件内部逻辑重构时，不要直接修改原有的 Props 定义。保留旧 Props 入口，并在组件内部将其映射（Mapping）到新逻辑上。</li>
<li><strong>提示</strong>：在开发环境下，对使用旧接口的开发者抛出 <code>console.warn</code> 提示弃用进度，而非直接报错。</li>
</ul>
<p>B. 逻辑扩展：从 “外部控制” 到 “控制反转 (IoC)”</p>
<ul>
<li><strong>优化方案</strong>：除了简单的逻辑控制，提供 “钩子 (Hooks)” 或 “事件回调”。</li>
<li><strong>场景</strong>：如果这是一个文件上传组件，不要只给一个 <code>uploadURL</code> 属性，应该暴露 <code>onBeforeUpload</code>, <code>onProgress</code>, <code>onError</code> 等生命周期钩子，让外部业务能精细化介入。</li>
</ul>
<p>C. 高内聚的延伸：职责单一 (SRP)</p>
<ul>
<li><strong>改进</strong>：确保一个组件只解决一个层面的问题。例如，一个 “带区域分流逻辑的图片组件”，应该拆分为：
<ol>
<li><strong>数据层组件</strong>：负责根据区域分流配置获取正确的图片 URL。</li>
<li><strong>渲染层组件</strong>：纯粹负责显示图片、Loading 态和错误态。</li>
</ol>
</li>
</ul>
<p>D. 增加 “无障碍性 (Accessibility)” 与 “国际化感知”</p>
<p>作为一个优秀的组件设计，应考虑：</p>
<ul>
<li><strong>语义化</strong>：使用正确的 HTML 标签（或 ARIA 属性），确保盲人阅读器可访问。</li>
<li><strong>方向性</strong>：针对中东等地区，组件需支持 <strong>RTL (Right-to-Left)</strong> 布局自适应。</li>
</ul>
<p>E. 性能测试的具体落地</p>
<ul>
<li><strong>基准测试</strong>：不仅是跑通测试用例，还需关注 <strong>Re-render（重复渲染）</strong> 次数。</li>
<li><strong>工具推荐</strong>：集成 React Testing Library 或 Vue Test Utils，并结合 Lighthouse 进行性能评估。</li>
</ul>
<p>总结</p>
<p>您原来的设计已经非常扎实，改进后的版本强化了 <strong>防御式编程（容错）</strong>、版本演进（适配器）以及全球化适配（A11y/i18n）。这种设计能让您的组件在复杂的生产环境（特别是涉及 2025 年多端、多区域的大型项目）中更具生命力。</p>
<h2 data-id="heading-30">APP 轨迹、异常上报设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
app["APP 轨迹、异常上报设计"]---&gt;实时轨迹
app---&gt;异常
实时轨迹---&gt;mustInfo["必备信息: 用户 ID、发生时间、经纬度、当前任务（订单）"]
mustInfo---&gt;定时采集当前经纬度
定时采集当前经纬度---&gt;实时上报---&gt;watch["后台监控、数据分析"]
定时采集当前经纬度---&gt;after["离线缓存，后续上报"]---&gt;watch
after---&gt;question["问题"]
question---&gt;网络持续离线
question---&gt;后台保活
question---&gt;应用未启动
question---&gt;坐标系转换
异常---&gt;errorMustInfo["必备信息：用户 ID、设备信息、发生时间、错误信息、错误栈"]
errorMustInfo---&gt;离线缓存后续上报---&gt;数据分析
</code></pre>
<hr/>
<p>在 2025 年的开发环境下，要实现 “抓取轨迹、绘制地图、路径决策、实时定位、通行时长” 并兼顾 “离线可用”，最成熟的方案是采用 <strong>Google Maps Platform</strong> 的移动端 SDK。</p>
<p>以下是实现这一功能的架构设计与技术选型：</p>
<ol>
<li>核心技术栈</li>
</ol>
<ul>
<li>
<p><strong>实时定位与轨迹抓取：</strong> 使用 <strong>Google Maps SDK (Android/iOS)</strong> 的定位蓝点功能，配合手机原生 GPS 传感器。</p>
</li>
<li>
<p><strong>地图渲染与轨迹绘制：</strong> 通过 <code>Polyline</code> 对象将实时获取的经纬度点连接成线。</p>
</li>
<li>
<p><strong>路径决策与通行时长：</strong> 使用 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fmaps%2Fdocumentation%2Froutes" target="_blank" title="https://developers.google.com/maps/documentation/routes" ref="nofollow noopener noreferrer">Routes API (2025 新版)</a></strong>。它比旧版更轻量，且能返回详细的实时路况（Traffic-aware）和预计到达时间 (ETA)。</p>
</li>
<li>
<p><strong>离线功能：</strong> 依靠 <strong>Google Maps SDK Offline Maps</strong> 或地图瓦片缓存。</p>
</li>
</ul>
<hr/>
<ol start="2">
<li>功能实现细节</li>
</ol>
<p>A. 实时定位与轨迹抓取</p>
<p>程序通过 <code>FusedLocationProviderClient</code> 每隔几秒获取一次经纬度。</p>
<ul>
<li>
<p><strong>实时性：</strong> 结合 <code>LocationRequest</code> 的高精度模式（Priority High Accuracy）。</p>
</li>
<li>
<p><strong>轨迹记录：</strong> 将获取的点存储在本地数据库（如 SQLite/Room），以防网络中断导致数据丢失。</p>
</li>
</ul>
<p>B. 路线决策与通行时长 (Routes API)</p>
<p>在 2025 年，建议调用 <strong>Routes API</strong> 的 <code>computeRoutes</code> 方法：</p>
<ul>
<li>
<p><strong>决策因子：</strong> 可设置 <code>routingPreference</code> 为 <code>TRAFFIC_AWARE_OPTIMAL</code>（实时路况最优），以获取避开拥堵的实时路线。</p>
</li>
<li>
<p><strong>时长预估：</strong> API 会返回 <code>duration</code> 和 <code>staticDuration</code>（无交通拥堵时长），对比两者即可得出延误时间。</p>
</li>
</ul>
<p>C. 离线可用性的处理（关键点）</p>
<p>Google Maps 的官方 SDK 对纯离线开发有一定限制，通常采取以下策略：</p>
<ol>
<li>
<p><strong>预下载地图：</strong> 调用 <code>OfflineTileProvider</code> 或引导用户在 Google 地图 App 中预下载区域地图，SDK 会自动调用本地缓存。</p>
</li>
<li>
<p><strong>离线定位：</strong> GPS 传感器不依赖网络，程序仍能抓取经纬度。</p>
</li>
<li>
<p><strong>离线路由：</strong> 这是一个难点。如果必须在断网时 “重新决策路径”，建议集成开源的 <strong>GraphHopper</strong> 或 <strong>OSRM</strong> 作为离线路由引擎。</p>
</li>
</ol>
<p>D. 实时经纬度上传</p>
<ul>
<li><strong>异步上传：</strong> 使用 <code>WorkManager</code>（Android）在后台运行上传任务。</li>
<li><strong>断网重传机制：</strong> 当网络恢复时，程序应自动从本地数据库读取未上传的轨迹片段，批量补传到你的服务器后端。</li>
</ul>
<hr/>
<ol start="3">
<li>
<p>开发建议与合规性</p>
</li>
<li>
<p><strong>API 成本：</strong> Routes API 按调用次数计费。建议在车辆静止时降低轨迹抓取频率，在路线未偏离时减少重算路径的频率。</p>
</li>
<li>
<p><strong>隐私权限：</strong> 2025 年 iOS 和 Android 对后台位置权限要求极严。你必须在 <code>AndroidManifest.xml</code> 中声明 <code>ACCESS_BACKGROUND_LOCATION</code>，并向用户明确说明收集轨迹的用途。</p>
</li>
<li>
<p><strong>数据纠偏：</strong> 原始 GPS 坐标在城市高楼区会有偏移，建议在绘制和上传前通过 <strong>Roads API</strong> 将轨迹点纠偏到实际道路上。</p>
</li>
<li>
<p>推荐文档链接</p>
</li>
</ol>
<ul>
<li><strong>Android Maps SDK 快速入门</strong></li>
<li><strong>Routes API 迁移与功能指南</strong></li>
<li><strong>WorkManager 处理后台上传任务</strong></li>
</ul>
<h2 data-id="heading-31">PDF 生成设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
pdfGenerate["PDF 生成设计"]---&gt;预定义模版
预定义模版---&gt;系统供给数据
系统供给数据---&gt;engine["Electron 插件使用模版引擎（Handlebars、EJS、Pug/Jade）混入数据"]
engine---&gt;printOrGenerate["打印或生成 PDF"]
engine---&gt;pluginUnbind["插件解耦，不处理用户权限验证、模版存储，由后台系统传入"]
printOrGenerate---&gt;back["打印或回传数据流"]
预定义模版---&gt;扩展
扩展---&gt;用户自定义设计
扩展---&gt;模版预览
</code></pre>
<p>--end</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（21）Hibernate的映射文件是什么？]]></title>    <link>https://juejin.cn/post/7591360623469248522</link>    <guid>https://juejin.cn/post/7591360623469248522</guid>    <pubDate>2026-01-04T11:54:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591360623469248522" data-draft-id="7591346773827485722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（21）Hibernate的映射文件是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T11:54:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（21）Hibernate的映射文件是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:54:03.000Z" title="Sun Jan 04 2026 11:54:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的映射文件（Mapping File）是用来定义Java类如何映射到数据库表的XML文件。尽管注解方式越来越流行，但映射文件仍然是配置Hibernate映射关系的重要方式之一。在映射文件中，你可以详细配置类与表、属性与列之间的映射关系，并定义一些特定的行为，如主键生成策略、关联关系等。</p>
<h3 data-id="heading-0">映射文件基本结构</h3>
<p>映射文件的基本结构如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-mapping</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
    <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.EntityName"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"table_name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"column_name"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"generation_strategy"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"property_name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"column_name"</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- 其他属性或关联关系的映射 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-mapping</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">示例代码</h3>
<p>下面是一个完整的示例，包括数据库配置、实体类、映射文件和使用Hibernate进行CRUD操作的代码。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射文件配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"com/example/domain/Person.hbm.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">实体类 <code>Person</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-4">映射文件 <code>Person.hbm.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-mapping</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Person"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"person"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"native"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-mapping</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">使用Hibernate进行CRUD操作</h3>
<h5 data-id="heading-6">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h5 data-id="heading-7">CRUD操作类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertPerson(sessionFactory);

        <span class="hljs-comment">// 查询数据</span>
        queryPerson(sessionFactory);

        <span class="hljs-comment">// 更新数据</span>
        updatePerson(sessionFactory);

        <span class="hljs-comment">// 删除数据</span>
        deletePerson(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person: "</span> + person.getName());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Queried Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">25</span>);
                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person: "</span> + person.getName());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>配置文件 <code>hibernate.cfg.xml</code></strong>：定义数据库连接信息、Hibernate属性配置以及实体类的映射文件路径。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"com/example/domain/Person.hbm.xml"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>实体类 <code>Person</code></strong>：定义实体类及其属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-comment">// 属性和方法</span>
}
</code></pre>
</li>
<li>
<p><strong>映射文件 <code>Person.hbm.xml</code></strong>：定义实体类与数据库表及其列的映射关系。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Person"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"person"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"native"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-comment">// 创建SessionFactory的代码</span>
}
</code></pre>
</li>
<li>
<p><strong>CRUD操作类</strong>：演示了如何使用Hibernate进行插入、查询、更新和删除操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-comment">// CRUD操作方法</span>
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">总结</h3>
<p>Hibernate的映射文件提供了一种配置Java类与数据库表映射关系的方式。通过配置映射文件，可以灵活地定义类与表、属性与列之间的关系，并指定主键生成策略、关联关系等。在配置映射文件之后，可以利用Hibernate的Session进行CRUD操作，实现对数据库的访问和操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IDEA 实用小技巧（自用）]]></title>    <link>https://juejin.cn/post/7591309945510674432</link>    <guid>https://juejin.cn/post/7591309945510674432</guid>    <pubDate>2026-01-04T11:54:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945510674432" data-draft-id="7587062584165089318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IDEA 实用小技巧（自用）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T11:54:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pe7er"/> <meta itemprop="url" content="https://juejin.cn/user/905653310988445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IDEA 实用小技巧（自用）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310988445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pe7er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:54:45.000Z" title="Sun Jan 04 2026 11:54:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Tab标签技巧</h2>
<h3 data-id="heading-1">切换标签技巧</h3>
<p>打开很多文件时,要在多个文件之间切换,滚动tab找文件比较麻烦.</p>
<ul>
<li>可以设置多行显示tab选项卡.</li>
<li>设置、Editor、General、编辑器标签页、在以下位置显示标签页、多行。</li>
<li>设置、Editor（编辑器）、General（常规）、Editor Tabs,取消勾选Show tabs in one row.</li>
<li>将单个tab拖动到视窗的上下左右来单独展示,有多个显示器时还可以将文件单独拖出来显示.</li>
<li>在tab选项卡上点击鼠标右键,选择Pin tab,将修改频繁的文件钉在第一个位置,可以订多个.</li>
<li>超过一行时,点击右侧的向下箭头,可以列出隐藏的文件.</li>
<li>将Show file extension取消勾选,通过文件图标和文件名来识别文件类型.</li>
<li>将Show file icon取消勾选,通过文件名和文件名扩展来识别文件类型.</li>
<li>将Sort tabs alphabetically勾选,使用字母表对文件名排序.</li>
<li>勾选Open new tabs at the end,让最新打开的文件放在最后.与字母排序冲突.</li>
</ul>
<h2 data-id="heading-2">编辑器深度技巧</h2>
<ul>
<li>
<p>在 Tab 中快速切换最近编辑过的同名文件</p>
<ul>
<li>当你打开多个同名文件（比如不同模块下的 <code>Controller.java</code>），按 <code>Alt + [</code> / <code>Alt + ]</code>（Windows/Linux）或 <code>Ctrl + Shift + [</code> / <code>Ctrl + Shift + ]</code>（Mac）可以在同名文件之间快速切换，而不是按普通 Tab 顺序。</li>
</ul>
</li>
<li>
<p>Alt + 鼠标悬停显示所有方法实现</p>
<ul>
<li>鼠标悬停在接口方法上，按 <code>Alt</code> 会显示实现列表，直接点击跳转，非常适合多实现场景。</li>
</ul>
</li>
<li>
<p>在接口调用方法上按 Ctrl + Alt + B（Command + option + B）可以快速打开实现方法，不用从接口定义处再绕一下。</p>
</li>
<li>
<p>多行移动代码但不破坏缩进</p>
<ul>
<li><code>Shift + Alt + ↑/↓</code>（Windows/Linux）或 <code>Option + Shift + ↑/↓</code>（Mac）移动代码块，保留缩进层次，不用手动对齐。</li>
</ul>
</li>
<li>
<p>快速收起当前方法之外的所有代码</p>
<ul>
<li><code>Ctrl + Shift + -</code>（折叠所有） + <code>Ctrl + 鼠标点击</code> 方法旁的 <code>+</code> 展开当前方法，专注当前逻辑。</li>
</ul>
</li>
<li>
<p>在编辑器直接重命名多个同名变量但范围限定</p>
<ul>
<li><code>Shift + F6</code> 重命名时，按 <code>Tab</code> 可以切换作用域（当前方法 / 当前类 / 全局），避免误改。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-3">Tab 和窗口管理深层技巧</h2>
<ul>
<li>
<p>拖动 Tab 出窗口到新窗口后，同时保持原窗口的拆分布局（适用于多块屏幕开发）</p>
<ul>
<li>将 Tab 拖出后，可以在新窗口中继续拆分上下左右，不破坏原来的布局。</li>
</ul>
</li>
<li>
<p>隐藏所有 Tab 但保持编辑器活动</p>
<ul>
<li><code>View → Appearance → Show Tabs</code> → 取消勾选，但通过 <code>Ctrl + E</code> / <code>Cmd + E</code> 依然可以快速切换文件，节省空间。</li>
</ul>
</li>
<li>
<p>快速关闭其他所有 Tab 但保留 Pin 的</p>
<ul>
<li>右键 Tab → <code>Close All Except Pinned</code>，快速清理工作区。</li>
</ul>
</li>
<li>
<p>按最近访问顺序循环 Tab</p>
<ul>
<li><code>Ctrl + Tab</code>（Windows/Linux）或 <code>Cmd + E</code> 长按，可在最近使用文件之间循环，而不是固定顺序。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-4">控制台 &amp; 日志深层技巧</h2>
<ul>
<li>
<p>控制台打印日志开启自动换行</p>
<p>编辑器、常规、控制台，勾选在控制台使用自动换行。</p>
</li>
<li>
<p>在控制台直接打开日志文件对应代码</p>
<ul>
<li>双击堆栈行时，默认跳转到方法声明。如果你按住 <code>Ctrl + Shift</code>（Windows/Linux）或 <code>Cmd + Shift</code>（Mac）再双击，会跳到真正的调用行（堆栈行所在文件）。</li>
</ul>
</li>
<li>
<p>控制台中高亮关键字</p>
<ul>
<li>在 Run/Debug 配置中 → Logs → “Highlight keywords”，可高亮 ERROR/WARN 等，便于大日志快速定位。</li>
</ul>
</li>
<li>
<p>折叠连续重复日志</p>
<ul>
<li>右键选中重复行 → <code>Fold Lines Like This</code>，IDEA 自动折叠后续相同内容，保持控制台简洁。</li>
</ul>
</li>
<li>
<p>Console 快速拷贝多行且保留时间戳</p>
<ul>
<li>按住 <code>Alt</code> 选择多行（列选择模式），可以保留每行前的时间戳和格式。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-5">搜索 / 查找深层技巧</h2>
<ul>
<li>
<p>结构搜索（Structural Search）</p>
<ul>
<li><code>Edit → Find → Search Structurally</code>，不仅能按文本搜索，还能按代码结构搜索，比如“找出所有 try/catch 内抛 RuntimeException 的地方”，比普通搜索精准。</li>
</ul>
</li>
<li>
<p>替换代码结构</p>
<ul>
<li><code>Replace Structurally</code> 可以批量修改匹配结构的代码，比如批量替换旧方法调用。</li>
</ul>
</li>
<li>
<p>多行正则替换</p>
<ul>
<li>搜索框勾选 Regex 并用 <code>\n</code> 匹配换行，可以一次修改整个方法体，普通搜索做不到。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-6">项目与文件技巧</h2>
<ul>
<li>
<p>排除某类文件/文件夹</p>
<ul>
<li>右键 → <code>Mark Directory as → Excluded</code>，IDEA 不再索引，搜索更快，Tab 也不会显示。</li>
</ul>
</li>
<li>
<p>将常用模块/包固定到 Project 工具栏</p>
<ul>
<li>Project 工具栏 → 右键 <code>Add to Favorites</code> → 可以快速跳转到深层模块，而不翻树。</li>
</ul>
<p>这是我在内网开发最爱的功能，可以完全替代 Project 选项卡，将 Favorites 拖动到 Project 选项卡一起，平时用 Favorites 管理断点、TODO、编写多模块代码，不够用时再到 Project 选项卡中使用。老版本的叫收藏夹（Favorites），新版本的叫书签（Bookmark），注意甄别，但功能都一样，只是叫法不一样。</p>
</li>
<li>
<p>临时文件比较</p>
<ul>
<li>选中两个文件 → <code>Compare Files</code>，无需切换版本控制，非常适合快速 diff。</li>
<li>复制需要对比的代码，在要对比的文件上点击鼠标右键，选择与编辑器对比（Compare File with Editor），只在粘贴板有内容时会有。。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-7">Debug / Runtime 技巧</h2>
<ul>
<li>
<p>Evaluate Expression 的快捷重置</p>
<ul>
<li>Debug 窗口中 <code>Alt + F8</code>（Evaluate Expression），输入表达式后按 <code>Alt + R</code> 可快速重置结果，无需手动清空。</li>
</ul>
</li>
<li>
<p>Inline Watch</p>
<ul>
<li>在 Debug 时，按 <code>Ctrl + Shift + F8</code> 可以在代码旁边直接显示变量的值，而不是底部窗口。</li>
</ul>
</li>
<li>
<p>临时断点条件快速应用</p>
<ul>
<li>右键断点 → <code>More</code> → <code>Condition</code>，输入表达式；按 <code>Ctrl + Shift + F9</code> 可临时禁用/启用所有条件断点。新版本则是右键打开面板进行设置。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-8">性能技巧</h2>
<ul>
<li>在底部状态栏右键，勾选内存指示器（Memory Indicator），可以快速监测当前IDEA内存变化。可以简单识别内存是否泄露，鼠标 hover 上去可以查看更详细信息。</li>
</ul>
<h2 data-id="heading-9">移动办公模式</h2>
<ul>
<li>当携带笔记本移动办公时（惨），没有电源供电，在底部状态栏点击鼠标右键，勾选省电模式（Power Save Mode），可以打开省电模式，会关闭一些自动编译、热更新的频繁执行的操作以节省电量。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（22）Hibernate的注解配置是什么？]]></title>    <link>https://juejin.cn/post/7591334208997228570</link>    <guid>https://juejin.cn/post/7591334208997228570</guid>    <pubDate>2026-01-04T11:54:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591334208997228570" data-draft-id="7591338980693606446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（22）Hibernate的注解配置是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T11:54:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（22）Hibernate的注解配置是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:54:47.000Z" title="Sun Jan 04 2026 11:54:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的注解配置是一种通过在Java类和属性上使用注解来定义数据库映射关系的方式，取代了传统的XML映射文件。这种方式使得配置更加直观和简洁，减少了配置文件的维护工作。</p>
<h3 data-id="heading-0">使用注解配置Hibernate</h3>
<h4 data-id="heading-1">配置步骤</h4>
<ol>
<li><strong>配置Hibernate的核心配置文件</strong> <code>hibernate.cfg.xml</code>。</li>
<li><strong>创建实体类</strong>，并使用JPA和Hibernate的注解来定义类和属性的映射。</li>
<li><strong>使用Hibernate进行CRUD操作</strong>。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<p>下面是一个完整的示例，包括数据库配置、实体类、以及使用Hibernate进行CRUD操作的代码。</p>
<h4 data-id="heading-3">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 注解实体类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">实体类 <code>Person</code></h4>
<p>使用JPA和Hibernate的注解来配置实体类。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">使用Hibernate进行CRUD操作</h3>
<h5 data-id="heading-6">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h5 data-id="heading-7">CRUD操作类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertPerson(sessionFactory);

        <span class="hljs-comment">// 查询数据</span>
        queryPerson(sessionFactory);

        <span class="hljs-comment">// 更新数据</span>
        updatePerson(sessionFactory);

        <span class="hljs-comment">// 删除数据</span>
        deletePerson(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person: "</span> + person.getName());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Queried Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">25</span>);
                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person: "</span> + person.getName());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>配置文件 <code>hibernate.cfg.xml</code></strong>：定义数据库连接信息、Hibernate属性以及实体类映射配置。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>实体类 <code>Person</code></strong>：使用JPA和Hibernate的注解定义实体类及其属性的映射。</p>
<ul>
<li><code>@Entity</code>：指定这是一个持久化实体。</li>
<li><code>@Table(name = "person")</code>：指定表名。</li>
<li><code>@Id</code>：表示主键。</li>
<li><code>@GeneratedValue(strategy = GenerationType.IDENTITY)</code>：指定主键生成策略。</li>
<li><code>@Column(name = "name")</code>：指定列名。</li>
</ul>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-comment">// 创建SessionFactory的代码</span>
}
</code></pre>
</li>
<li>
<p><strong>CRUD操作类</strong>：演示了如何使用Hibernate进行插入、查询、更新和删除操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-comment">// CRUD操作方法</span>
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">总结</h3>
<p>使用注解配置Hibernate，可以使得配置更加直观和简洁，减少配置文件的维护工作。通过在实体类中使用JPA和Hibernate的注解，可以方便地定义类和属性与数据库表和列之间的映射关系。在配置完成后，可以使用Hibernate的Session进行CRUD操作，实现对数据库的访问和操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何阅读英文文档]]></title>    <link>https://juejin.cn/post/7591309945510690816</link>    <guid>https://juejin.cn/post/7591309945510690816</guid>    <pubDate>2026-01-04T11:56:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945510690816" data-draft-id="7588799600166469642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何阅读英文文档"/> <meta itemprop="keywords" content="Java,前端,后端"/> <meta itemprop="datePublished" content="2026-01-04T11:56:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pe7er"/> <meta itemprop="url" content="https://juejin.cn/user/905653310988445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何阅读英文文档
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310988445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pe7er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:56:00.000Z" title="Sun Jan 04 2026 11:56:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发工作中，开发者几乎一直处于持续学习状态。  对于优秀的中文社区的技术，阅读当然没有问题，但也有很多优秀的技术、框架、前沿技术和工具并非由国人开发，相对小众，但却非常重要。这类项目往往只有英文甚至日文官方文档，也缺乏中文社区的翻译贡献。在这种情况下，高效、可靠的翻译工具几乎是必备能力。</p>
<hr/>
<h2 data-id="heading-0">从传统词典到 AI 翻译</h2>
<p>早期常用的词典工具：</p>
<ul>
<li>金山词霸</li>
<li>灵格斯</li>
<li>有道词典</li>
</ul>
<p>这些工具主要用于逐词翻译。</p>
<p>后来出现的翻译工具：</p>
<ul>
<li>有道翻译</li>
<li>必应翻译</li>
<li>Google 翻译</li>
<li>百度翻译</li>
</ul>
<p>可以支持整句、整段翻译。在内网或受限环境下，金山词霸、灵格斯等离线词典仍有使用价值。</p>
<p>随着 AI 技术的发展，翻译工具在准确性和上下文理解能力上有了显著提升。</p>
<hr/>
<h2 data-id="heading-1">在线翻译英文文档与书籍</h2>
<p>适用场景：</p>
<ul>
<li>Project Gutenberg 等合法公版电子书</li>
<li>社区开发者编写的开源文档</li>
<li>没有信息安全或传播限制的资料</li>
</ul>
<h3 data-id="heading-2">在线网页翻译</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.immersivetranslate.cn%2F" target="_blank" title="https://app.immersivetranslate.cn/" ref="nofollow noopener noreferrer">Immersive Translate</a></p>
<p>特点：</p>
<ul>
<li>使用方便</li>
<li>翻译质量高</li>
<li>适合阅读网页文档</li>
</ul>
<p>限制：</p>
<ul>
<li>不支持 OCR</li>
<li>不支持 EPUB 内图片翻译</li>
</ul>
<h3 data-id="heading-3">在线翻译电子书</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.immersivetranslate.cn%2Febook%2F" target="_blank" title="https://app.immersivetranslate.cn/ebook/" ref="nofollow noopener noreferrer">Immersive Translate Ebook</a></p>
<p>支持直接上传电子书进行翻译，适合快速阅读外文技术书籍。类似工具还有 AnyDoc、XX 翻译。</p>
<hr/>
<h2 data-id="heading-4">图片翻译</h2>
<p>适合场景：</p>
<ul>
<li>漫画或对话截图</li>
<li>复杂流程图</li>
<li>技术示意图</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.immersivetranslate.cn%2Fimage%2F" target="_blank" title="https://app.immersivetranslate.cn/image/" ref="nofollow noopener noreferrer">Immersive Translate Image</a></p>
<p>免费版与付费版区别：</p>
<ul>
<li>付费插件直接在原图上替换翻译内容</li>
<li>免费方式通过 Google Lens 等工具跳转翻译</li>
</ul>
<hr/>
<h2 data-id="heading-5">离线翻译（信息安全场景）</h2>
<p>适用条件：</p>
<ul>
<li>合法购买的外文电子书</li>
<li>有信息安全或传播限制</li>
<li>无法使用在线工具</li>
</ul>
<p>推荐方案：</p>
<ul>
<li>本地 AI + Calibre + Ebook Translator 插件</li>
</ul>
<p>特点：</p>
<ul>
<li>支持多种电子书格式</li>
<li>可完全离线使用</li>
</ul>
<p>限制：</p>
<ul>
<li>不支持 OCR（扫描版无法处理）</li>
</ul>
<hr/>
<h2 data-id="heading-6">阅读 GitHub 英文项目</h2>
<p>使用 DeepWiki 可以：</p>
<ul>
<li>以自然语言理解仓库代码</li>
<li>直接询问项目功能</li>
<li>理解复杂逻辑和用法</li>
</ul>
<p>对于复杂函数或注释少的模块，可结合 DeepWiki + ChatGPT 分步提问，获得中文总结和示例调用。</p>
<hr/>
<h2 data-id="heading-7">浏览器与平台自带翻译</h2>
<p>Microsoft Edge：</p>
<ul>
<li>内置网页翻译</li>
<li>网络不佳时依然稳定</li>
</ul>
<p>iOS 开发文档：</p>
<ul>
<li>使用 ADDT（收费插件）</li>
<li>价格便宜，体验不错</li>
</ul>
<p>Android / Web 开发文档：</p>
<ul>
<li>Google 官方文档大多支持直接切换中文</li>
<li>不支持的页面可使用 Chrome 内置翻译或翻译插件</li>
</ul>
<hr/>
<h2 data-id="heading-8">额外技巧</h2>
<ul>
<li>多工具组合使用：文档可用 DeepL、Google 翻译、Calibre + Ebook Translator，图片可用 Google Lens / ABBYY OCR，代码可用 DeepWiki + ChatGPT</li>
<li>结合原文阅读，AI 翻译并非完全准确，会闹出许多笑话乌龙，需要持续修订。</li>
</ul>
<hr/>
<h2 data-id="heading-9">扩展实用翻译工具清单</h2>
<h3 data-id="heading-10">在线 AI 翻译工具</h3>



































<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>DeepL</td><td>翻译质量高，语境理解好，支持文档上传</td><td>英文 / 德文 / 法文文档翻译，技术文档和文章</td></tr><tr><td>Google Translate</td><td>支持网页、文本、文档、图片翻译，免费</td><td>常规网页、文档翻译</td></tr><tr><td>Bing Microsoft Translator</td><td>微软官方翻译，集成 Edge 浏览器</td><td>技术文档网页快速翻译</td></tr><tr><td>Youdao 翻译网页版</td><td>支持整句整段翻译</td><td>日文、英文文档，支持技术术语查询</td></tr><tr><td>Papago</td><td>韩国开发，日语、韩语、中文、英文互译较好</td><td>日文文档翻译</td></tr></tbody></table>
<h3 data-id="heading-11">离线翻译工具</h3>






























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>Calibre + Ebook Translator 插件</td><td>支持 EPUB、MOBI、PDF 离线翻译</td><td>有版权限制的电子书</td></tr><tr><td>QTranslate</td><td>支持调用 Google / Bing / DeepL API，本地翻译</td><td>内网环境或无法联网时</td></tr><tr><td>Lingoes（灵格斯词典）</td><td>离线词典 + 翻译</td><td>单词、短句离线翻译</td></tr><tr><td>GoldenDict（金山词霸离线版）</td><td>词典丰富，支持离线词库</td><td>内网环境 / 单词翻译</td></tr></tbody></table>
<h3 data-id="heading-12">图片翻译 / OCR 翻译工具</h3>






























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>Google Lens</td><td>支持手机或 PC 拍照翻译</td><td>截图、照片、流程图、漫画对白</td></tr><tr><td>Microsoft OneNote OCR</td><td>可以提取图片文字再翻译</td><td>复杂文档截图、扫描图像</td></tr><tr><td>ABBYY FineReader</td><td>OCR + 文本提取精度高</td><td>扫描版 PDF、技术文档</td></tr><tr><td>iOS / Android 图片翻译 APP</td><td>支持实时拍照翻译</td><td>纸质书、手写文档</td></tr></tbody></table>
<h3 data-id="heading-13">代码 / 开源文档辅助翻译</h3>

























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>DeepWiki</td><td>AI 自然语言理解仓库</td><td>GitHub 英文注释、代码理解</td></tr><tr><td>ChatGPT / Claude / Bard</td><td>可总结文档、翻译、生成示例</td><td>英文技术文档、开源库注释、API 说明</td></tr><tr><td>GitLocalize</td><td>开源文档翻译协作平台</td><td>GitHub 文档翻译、团队协作</td></tr></tbody></table>
<h3 data-id="heading-14">浏览器内置 / 插件类工具</h3>

























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>Microsoft Edge 内置翻译</td><td>在线网页自动翻译</td><td>内网不佳或中文插件无法用时</td></tr><tr><td>Chrome 翻译插件（Google Translate Extension）</td><td>支持局部网页翻译</td><td>代码示例、技术文档阅读</td></tr><tr><td>ADDT（iOS 文档插件）</td><td>收费、价格便宜</td><td>iOS 官方文档、开发文档翻译</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">总结</h2>
<p>翻译工具本身不是目的，高效理解技术内容才是。根据不同场景：</p>
<p>选择合适的工具组合，比追求“最强工具”更重要。</p>
<p>希望这份整理能帮助开发者在学习和工作中高效跨越语言障碍，更快掌握能够应用的知识和技术，或许未来也可以在开源社区中贡献一份翻译中坚力量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【flutter】0. 搭建一个多端 flutter 开发环境]]></title>    <link>https://juejin.cn/post/7591318630693814326</link>    <guid>https://juejin.cn/post/7591318630693814326</guid>    <pubDate>2026-01-04T10:06:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591318630693814326" data-draft-id="7587825267878559785" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【flutter】0. 搭建一个多端 flutter 开发环境"/> <meta itemprop="keywords" content="Flutter,前端框架,架构"/> <meta itemprop="datePublished" content="2026-01-04T10:06:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dev"/> <meta itemprop="url" content="https://juejin.cn/user/3896324938536877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【flutter】0. 搭建一个多端 flutter 开发环境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3896324938536877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dev
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:06:40.000Z" title="Sun Jan 04 2026 10:06:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="dracula">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#282a36}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-section,.hljs-selector-tag{color:#8be9fd}.hljs-function .hljs-keyword{color:#ff79c6}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#f8f8f2}.hljs-addition,.hljs-attribute,.hljs-bullet,.hljs-name,.hljs-string,.hljs-symbol,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#f1fa8c}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#6272a4}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-strong,.hljs-title,.hljs-type{font-weight:700}.hljs-emphasis{font-style:italic}</style><h2 data-id="heading-0">1. 前言</h2>
<p>最近在做一个智能家居的应用，可能需要用到 APP 与设备之间的交互。所以就寻思自己搞一下。</p>
<p>很早之前的我了解到的 APP 的开发无非就三类：</p>
<ol>
<li>原生开发</li>
<li>基于 react-native</li>
<li>flutter</li>
</ol>
<p>介于一些文章我了解到，原生开发毕竟还要学一门新的开发语言，所以 PASS 了。RN 的用户体验相对来说又比较差。
就选了现在相对比较居中开发起来和 React 比较相似的 flutter。</p>
<p>以下谨以此来搭建一个简单的 demo。也希望在学习的过程中有些输出，能帮助到更多的人。</p>
<h2 data-id="heading-1">2. 环境搭建</h2>
<blockquote>
<p>记得提前安装 vscode，由于我用的是 mac，所以这里只展示在 macos 系统下的安装方案。</p>
</blockquote>
<h3 data-id="heading-2">2.1 安装 xcode（ios 应用必须）</h3>
<p>打开终端，输入以下命令</p>
<pre><code class="hljs language-bash" lang="bash">xcode-select --install
</code></pre>
<h3 data-id="heading-3">2.2 下载 Flutter SDK</h3>
<p>访问官方站点或者<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.cn%2Finstall%2Farchive%2F" target="_blank" title="https://docs.flutter.cn/install/archive/" ref="nofollow noopener noreferrer">国内镜像站点</a>，下载需要的的 sdk 版本（本教程用 35.7 举例），安装目录到指定位置，比如我这里是 /dev 文件夹。安装好后解压出来会得到一个 /flutter 文件夹。记住 /dev/Flutter 这个路径，后面会用上。</p>
<h3 data-id="heading-4">2.3 下载 Android-studio（安卓应用必须）</h3>
<p>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fstudio%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/studio?hl=zh-cn" ref="nofollow noopener noreferrer">官方网站</a>下载安装即可.</p>
<h3 data-id="heading-5">2.4 安装 vscode 拓展</h3>
<p>打开 vscode，在 vscode 上安装以下拓展插件：</p>
<ol>
<li>Flutter</li>
<li>Android iOS Emulator</li>
<li>Flutter color （可选）</li>
</ol>
<h3 data-id="heading-6">2.5 配置安卓环境</h3>
<p>下载完 Android studio 之后，咱需要在 Android SDK 再安装以下依赖：</p>
<ul>
<li><strong>Android SDK Build-Tools</strong></li>
<li><strong>Android SDK Command-line Tools</strong></li>
<li><strong>Android Emulator</strong></li>
<li><strong>Android SDK Platform-Tools</strong></li>
</ul>
<p>把上述插件安装完成之后，在终端运行：</p>
<pre><code class="hljs language-bash" lang="bash">flutter doctor --android-licenses
</code></pre>
<p>此时会要求你通过协议请求，全部 Y 接受就行。当得到以下返回就配置完成了：</p>
<pre><code class="hljs language-bash" lang="bash">All SDK package licenses accepted
</code></pre>
<p>完成以上步骤后只需要再次执行 flutter doctor，终端提示安卓插件前面打勾，说明安装成功：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7676e1afce31420ab7466c4bf193f96e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=Pc4IECjpJlxpNBE9saj5OgljR3g%3D" alt="截屏2025-12-27 16.49.27.png" loading="lazy"/></p>
<h3 data-id="heading-7">2.6 配置环境变量</h3>
<p>针对安卓开发环境需要额外配置一些参数(参考自己的安卓 sdk 的安装位置）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Android SDK</span>
<span class="hljs-built_in">export</span> ANDROID_SDK_ROOT=<span class="hljs-variable">$HOME</span>/Library/Android/sdk
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_SDK_ROOT</span>/emulator
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_SDK_ROOT</span>/platform-tools
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_SDK_ROOT</span>/cmdline-tools/latest/bin

<span class="hljs-comment"># Android Studio Embedded JDK</span>
<span class="hljs-built_in">export</span> JAVA_HOME=<span class="hljs-string">"/Applications/Android Studio.app/Contents/jbr/Contents/Home"</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
<h2 data-id="heading-8">3 初始化项目</h2>
<p>以上依赖安装完之后，打开 vscode 的命令面板，输入 flutter，会有以下三个选项，选择 <strong>new project</strong> 选项：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cfb6692d5a34ace8983c0a2bc131083~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=eP04X5jUYWvhz04qa%2BNXJITZlyQ%3D" alt="截屏2025-12-26 20.03.08.png" loading="lazy"/></p>
<p>等待项目初始化完成进入下一步。</p>
<h3 data-id="heading-9">3.1 进入 web 开发模式</h3>
<p>此时如果在未安装 xcode 和 Android studio 的情况下，只能进入 web 开发模式。输入如下命令即可：</p>
<pre><code class="hljs language-bash" lang="bash">flutter run -d web-server
</code></pre>
<p>终端提示端口号，即为 web 服务启动成功。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b950399c85c445ee955ac09cbe38abd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=XiJlvq%2FLEBgoIaZvPzA6wrC9r%2Fc%3D" alt="截屏2025-12-26 20.08.22.png" loading="lazy"/></p>
<h3 data-id="heading-10">3.2 进入安卓开发模式</h3>
<p>先启动安卓端的 emulators。如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c601a3598dac4a168be1b7bf0acde8da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=W63UlwAi%2B6ccLJ%2BpOXA%2BhoZP7SA%3D" alt="截屏2025-12-28 01.55.23.png" loading="lazy"/></p>
<p>然后再执行 <strong>flutter run</strong></p>
<h3 data-id="heading-11">3.3 进入 macOS 开发模式</h3>
<p>先提前安装好 XCode。</p>
<pre><code class="hljs language-bash" lang="bash">flutter run -d macOS
</code></pre>
<h3 data-id="heading-12">3.4 进入 IOS 开发模式</h3>
<h4 data-id="heading-13">3.4.1 安装依赖程序</h4>
<p>mac 端主要需要安装两个比较重要的依赖，一个是 Xcode，一个是 cocoapods</p>
<p>Xcode的安装方式很简单，直接在应用商店搜索就能下载。</p>
<p>这里主要讲一下 cocoapods 的安装方式。（这里最好是安装brew，效率翻倍）</p>
<p>由于 cocoapods 是依赖 ruby 的，但是mac 自带的ruby版本比较低，所以先安装ruby，这里我用的 brew 下载，首先执行以下代码：</p>
<pre><code class="hljs language-bash" lang="bash">brew install ruby

// 把ruby 的环境变量更新到启动脚本
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="/opt/homebrew/opt/ruby/bin:$PATH"'</span> &gt;&gt; ~/.zshrc
<span class="hljs-built_in">source</span> ~/.zshrc

// 查看版本
ruby -v
</code></pre>
<p>然后开始安装 cocoapods，这里我们用 gem 安装(需要管理员权限）：</p>
<pre><code class="hljs language-bash" lang="bash">sudo gem install cocoapods
</code></pre>
<p>接下来我们就可以愉快的进入好看的 IOS 界面进行开发了。</p>
<h2 data-id="heading-14">DEBUG</h2>
<p>既然开始开发了，难免需要知道如何 debug 和查看日志，这里需要稍微注意一下，如果想要在控制台看到对应的输出日志，你需要在 vscode 的侧边栏找到 RUN AND DEBUGS。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/157a17e766b14fcf8bd1df897fc5aa21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=dBOMudMnvSBR%2BhH2qpQhzYoxqLE%3D" alt="截屏2026-01-04 18.03.08.png" loading="lazy"/></p>
<p>接下来，咱们就可以开始愉快的开发了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析：uniapp单仓库多应用（SaaS 化）架构]]></title>    <link>https://juejin.cn/post/7591293897085075506</link>    <guid>https://juejin.cn/post/7591293897085075506</guid>    <pubDate>2026-01-04T10:06:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591293897085075506" data-draft-id="7591338980693098542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析：uniapp单仓库多应用（SaaS 化）架构"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-04T10:06:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LC同学47981"/> <meta itemprop="url" content="https://juejin.cn/user/1978776660477991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析：uniapp单仓库多应用（SaaS 化）架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776660477991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LC同学47981
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:06:53.000Z" title="Sun Jan 04 2026 10:06:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深入解析：单仓库多应用（SaaS 化）架构如何解决多租户维护痛点</h2>
<p>在现代 SaaS（Software as a Service）业务模式下，技术团队面临的最大挑战之一是如何高效地为成百上千个客户（租户）交付独立的小程序或应用。本项目采用了一种 <strong>“单仓库多应用”（Monorepo-like / Multi-Tenant）</strong> 的架构模式，通过极致的工程化手段，将维护成本从线性增长（O(N)）降低为常数级（O(1)）。</p>
<p>本文将从<strong>痛点分析</strong>、<strong>核心架构设计</strong>、<strong>关键代码实现</strong>以及<strong>进阶的条件编译体系</strong>四个维度进行详细剖析。</p>
<hr/>
<h3 data-id="heading-1">一、 痛点分析：传统多租户开发的“泥潭”</h3>
<p>假设你需要维护 50 个客户的小程序，每个客户都有独立的 AppID、接口地址，且部分客户有定制化页面需求。</p>
<h4 data-id="heading-2">1. 代码维护成本高 (Code Redundancy)</h4>
<ul>
<li><strong>传统做法</strong>：为每个客户开一个 Git 分支或独立仓库。</li>
<li><strong>后果</strong>：当核心业务（如“下单流程”）发现一个 Bug 时，你需要在 50 个仓库中分别合并代码。这是一场灾难，极易漏改或改错。</li>
</ul>
<h4 data-id="heading-3">2. 发版事故频发 (Human Error)</h4>
<ul>
<li><strong>传统做法</strong>：打包前手动修改 <code>manifest.json</code> 中的 <code>appid</code>，手动切换 <code>config.js</code> 中的 API 环境地址。</li>
<li><strong>后果</strong>：很容易把“客户 A”的代码发到了“客户 B”的小程序上，或者把“测试环境”的配置发到了“生产环境”。</li>
</ul>
<h4 data-id="heading-4">3. 包体积与性能瓶颈 (Bundle Size)</h4>
<ul>
<li><strong>传统做法</strong>：将所有客户的功能都写在一个大包里，通过 <code>if (clientId === 'A')</code> 来判断显示什么。</li>
<li><strong>后果</strong>：所有客户都要下载包含其他 49 个客户定制逻辑的巨型包。小程序主包体积限制（2MB）很快就会爆表，且启动速度极慢。</li>
</ul>
<hr/>
<h3 data-id="heading-5">二、 核心架构设计：配置驱动的动态构建</h3>
<p>本项目的核心思想是：<strong>代码是共享的，差异是配置出来的。</strong></p>
<h4 data-id="heading-6">1. 目录结构设计</h4>
<p>我们将“变”与“不变”完全分离：</p>
<ul>
<li><strong><code>src/</code> (不变)</strong>：存放所有核心业务逻辑、组件、页面。所有客户共用这一套代码。</li>
<li><strong><code>scripts/setting/</code> (变)</strong>：存放每个租户的“身份证”。每个文件（如 <code>wx0159...js</code>）代表一个客户，包含其独有的配置信息。</li>
</ul>
<h4 data-id="heading-7">2. 构建流程图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[开发者] --&gt;|选择配置 ID: wx0159...| B(构建脚本 scripts/build/index.js)
    B --&gt; C{读取配置}
    C --&gt;|1. 读取公共配置| D[scripts/build/baseConfig.ts]
    C --&gt;|2. 读取租户配置| E[scripts/setting/wx/wx0159...js]
    B --&gt; F[动态生成/覆写文件]
    F --&gt;|合并页面| G[src/pages.json]
    F --&gt;|替换 AppID| H[src/manifest.json]
    F --&gt;|注入变量| I[package.json / process.env]
    F --&gt; J[Vite 编译打包]
    J --&gt; K[生成最终小程序]
</code></pre>
<hr/>
<h3 data-id="heading-8">三、 关键代码实现：如何“移花接木”</h3>
<h4 data-id="heading-9">1. 动态生成 <code>pages.json</code> —— 解决包体积与定制化</h4>
<p>Uniapp 的 <code>pages.json</code> 通常是静态的。为了实现“按需打包”，我们在构建阶段动态生成它。</p>
<ul>
<li><strong>公共页面</strong>：在 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">baseConfig.ts</a> 中定义所有客户都有的页面（如首页、个人中心）。</li>
<li><strong>租户页面</strong>：在租户配置（如 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">wx01596767907b93fe.js</a>）中定义特有的分包。</li>
</ul>
<p><strong>构建脚本逻辑 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">scripts/build/index.js</a>):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 读取公共配置</span>
<span class="hljs-keyword">const</span> { baseSubPackages, pages } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./baseConfig.ts'</span>);
<span class="hljs-comment">// 2. 读取当前租户配置</span>
<span class="hljs-keyword">const</span> { config } = <span class="hljs-built_in">require</span>(configFilePath);

<span class="hljs-comment">// 3. 动态合并</span>
<span class="hljs-comment">// 只有当前客户需要的 subPackages 才会进入最终的 pages.json</span>
pagesJson.<span class="hljs-property">subPackages</span> = baseSubPackages.<span class="hljs-title function_">concat</span>(config.<span class="hljs-property">subPackages</span> || []);
pagesJson.<span class="hljs-property">pages</span> = pages.<span class="hljs-title function_">concat</span>(config.<span class="hljs-property">pages</span> || []);

<span class="hljs-comment">// 4. 写入文件系统（供 Uniapp 编译器使用）</span>
fs.<span class="hljs-title function_">writeFileSync</span>(pagesJsonPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(pagesJson, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>), <span class="hljs-string">'utf8'</span>);
</code></pre>
<blockquote>
<p><strong>成效</strong>：客户 A 的小程序里绝对不会出现客户 B 的定制页面代码，包体积最小化。</p>
</blockquote>
<h4 data-id="heading-10">2. 自动化身份注入 —— 杜绝发版事故</h4>
<p>为了防止人工修改 <code>manifest.json</code> 出错，我们通过脚本全自动替换。</p>
<p><strong>构建脚本逻辑 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">scripts/build/index.js</a>):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 读取 manifest.json 原始内容</span>
<span class="hljs-keyword">let</span> updatedManifestContent = manifestJsonContent;
<span class="hljs-keyword">const</span> platform = scriptConfig.<span class="hljs-property">env</span>.<span class="hljs-property">UNI_PLATFORM</span>;

<span class="hljs-comment">// 正则替换 AppID</span>
<span class="hljs-comment">// 确保只替换当前平台的 appid，不影响其他配置</span>
<span class="hljs-keyword">const</span> platformRegex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`"<span class="hljs-subst">${platform}</span>":\\s*{[^}]*"appid":\\s*"[^"]*"`</span>);
updatedManifestContent = updatedManifestContent.<span class="hljs-title function_">replace</span>(platformRegex, <span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> match.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"appid":\\s*"[^"]*"/</span>, <span class="hljs-string">`"appid": "<span class="hljs-subst">${configType}</span>"`</span>));

fs.<span class="hljs-title function_">writeFileSync</span>(manifestJsonPath, updatedManifestContent, <span class="hljs-string">'utf8'</span>);
</code></pre>
<blockquote>
<p><strong>成效</strong>：只要选对了配置 ID，打出来的包 AppID 绝对正确，无需人工 Check。</p>
</blockquote>
<h4 data-id="heading-11">3. 环境变量透传 —— 代码去敏感化</h4>
<p>业务代码中（<code>src/</code> 下）严禁出现任何硬编码的 URL 或 Key。所有环境相关变量都通过构建过程注入。</p>
<p><strong>配置定义 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">scripts/setting/wx/wx0159...js</a>):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">env</span>: {
  <span class="hljs-attr">URL</span>: <span class="hljs-string">'https://mall.baoquanlvyou.com'</span>, <span class="hljs-comment">// 接口地址</span>
  <span class="hljs-attr">MCODE</span>: <span class="hljs-string">'dwr1Op9C3C5q...'</span>,             <span class="hljs-comment">// 商家编码</span>
  <span class="hljs-attr">SITE_CHANNEL_TYPE</span>: <span class="hljs-number">5</span>
}
</code></pre>
<p><strong>注入逻辑 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">vite.config.ts</a> + <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">defineEnv.js</a>):</strong> 构建脚本先将 <code>env</code> 对象注入到 Node 进程的 <code>process.env</code> 中，然后 <code>vite.config.ts</code> 通过 <code>define</code> 选项将其传递给前端代码。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">define</span>: <span class="hljs-title function_">getDefineEnv</span>() <span class="hljs-comment">// 将 process.env.URL 等注入全局</span>
    <span class="hljs-comment">// ...</span>
  };
});
</code></pre>
<p><strong>业务代码使用 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">src/utils/env.ts</a>):</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getConfig</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-comment">// 这里的 process.env.URL 在编译时会被替换为字符串常量</span>
    <span class="hljs-comment">// @ts-ignore</span>
    <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">URL</span>
    <span class="hljs-comment">// ...</span>
  };
};
</code></pre>
<hr/>
<h3 data-id="heading-12">四、 进阶架构：多层次条件编译与定向构建体系</h3>
<p>在解决了基础的“配置隔离”后，我们通过 <code>scripts/setting/</code> 配置文件与 Vite 的深度结合，构建了一套<strong>从构建脚本到业务代码、从路由层级到组件粒度</strong>的全方位条件编译体系，解决 <strong>“千人千面”</strong> 的深度定制需求。</p>
<h4 data-id="heading-13">1. 核心能力：宏注入机制</h4>
<p>我们不仅仅利用了 Uniapp 原生的条件编译（<code>#ifdef</code>），更通过自定义注入的宏（Macro），实现了<strong>基于租户身份</strong>的定向编译。</p>
<p>在每个租户的配置文件中（如 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">package.json</a> 中的 <code>pro-h5</code> 或 <code>scripts/setting/wx/</code> 下的配置），我们定义了 <code>define</code> 字段：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json 示例</span>
<span class="hljs-attr">"uni-app"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"pro-h5"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"商城"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"UNI_PLATFORM"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h5"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"SITE_CHANNEL_TYPE"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"define"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"PRO_H5"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  <span class="hljs-comment">// &lt;--- 自定义宏</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>或者在租户独立配置中（如 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">wx00c9.js</a>）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">define</span>: {
  <span class="hljs-title class_">WX00C</span>9: <span class="hljs-literal">true</span>; <span class="hljs-comment">// &lt;--- 针对该特定客户的宏</span>
}
</code></pre>
<p>这些宏在构建时通过 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">defineEnv.js</a> 被注入到全局变量中，使得业务代码可以像使用系统变量一样使用它们。</p>
<h4 data-id="heading-14">2. 场景实战：从路由到组件的定向控制</h4>
<h5 data-id="heading-15">2.1 脚本路由级控制 (Script-Level)</h5>
<p>在 <code>package.json</code> 的 <code>uni-app.scripts</code> 中，我们定义了不同的启动命令（如 <code>pro-h5</code>）。这不仅决定了环境变量，还决定了<strong>Uniapp 的平台表现</strong>。</p>
<ul>
<li>
<p><strong>场景</strong>：特定租户（如 <code>WX00C9</code>）需要在个人中心显示额外的功能入口，而其他租户不需要。</p>
</li>
<li>
<p><strong>实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/pages/mine/index.vue</span>

<span class="hljs-comment">// #ifdef WX00C9</span>
&lt;view <span class="hljs-keyword">class</span>=<span class="hljs-string">"menu-item"</span> <span class="hljs-meta">@click</span>=<span class="hljs-string">"goSpecialPage"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>专属VIP通道<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span>
&lt;/view&gt;
<span class="hljs-comment">// #endif</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-16">2.2 租户级定向编译 (Tenant-Level)</h5>
<p>对于 50 个租户中，只有“客户 A”需要显示某个特殊按钮，或者只有“客户 B”需要隐藏某个模块。</p>
<ul>
<li><strong>场景</strong>：只有 <code>wxb557...</code> 这个客户需要默认加载某些数据，其他客户不需要。</li>
<li><strong>实现</strong>：直接使用注入的 <code>define</code> 宏进行判断。
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 伪代码示例</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">WX1558</span>) {
  <span class="hljs-comment">// 只有 WX1558 这个客户会执行这段逻辑</span>
  <span class="hljs-comment">// 编译后，其他客户的代码中这段会被直接 Tree-Shaking 移除</span>
  <span class="hljs-title function_">initSpecialData</span>();
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-17">2.3 页面与入口级控制 (Page-Level)</h5>
<p>通过动态生成 <code>pages.json</code>，我们实现了<strong>物理级别的页面隔离</strong>。</p>
<ul>
<li><strong>场景</strong>：客户 A 需要“扫码点餐”功能，客户 B 只需要“内容展示”。</li>
<li><strong>实现</strong>：
<ul>
<li>客户 A 的配置 <code>subPackages</code> 包含 <code>subPackageScanQrOrder</code>。</li>
<li>客户 B 的配置 <code>subPackages</code> 为空。</li>
<li><strong>结果</strong>：客户 B 的小程序包中根本不包含点餐相关的页面文件和资源，包体积减少 50% 以上。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-18">3. 多层次条件编译矩阵</h4>
<p>通过 <code>package.json</code> 和 <code>scripts/setting/</code> 中的精细化配置，我们构建了一个<strong>多维度的条件编译矩阵</strong>：</p>



































<table><thead><tr><th align="left">维度</th><th align="left">控制粒度</th><th align="left">实现方式</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><strong>平台级</strong></td><td align="left">H5 / 微信 / 支付宝</td><td align="left"><code>UNI_PLATFORM</code> + <code>#ifdef</code></td><td align="left">抹平平台差异，调用原生 API</td></tr><tr><td align="left"><strong>租户级</strong></td><td align="left">特定客户 (AppID)</td><td align="left">自定义宏 (<code>WX00C9</code>)</td><td align="left">实现“千人千面”的定制业务逻辑</td></tr><tr><td align="left"><strong>路由级</strong></td><td align="left">页面 / 分包</td><td align="left">动态 <code>pages.json</code></td><td align="left">按需打包，物理隔离业务模块</td></tr><tr><td align="left"><strong>环境级</strong></td><td align="left">Dev / Prod</td><td align="left"><code>process.env.URL</code></td><td align="left">自动切换接口环境，杜绝事故</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-19">五、 总结</h3>
<p>这套架构方案的本质是 <strong>“编译时多态”</strong>。通过将多租户的差异前置到 <strong>构建阶段（Build Time）</strong> 处理，而不是留到 <strong>运行时（Runtime）</strong> 判断，我们实现了：</p>
<ol>
<li><strong>安全性</strong>：代码中无敏感配置，不同租户代码物理隔离（在产物层面）。</li>
<li><strong>高性能</strong>：无冗余代码，包体积最小。</li>
<li><strong>高效率</strong>：一套代码服务所有客户，Bug 修复一次，全员受益。</li>
<li><strong>高灵活</strong>：从平台到租户，从页面到组件，全方位满足个性化定制需求。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【安全专项】如何成为一名“火眼金睛”的安卓侦探？]]></title>    <link>https://juejin.cn/post/7591322050240135206</link>    <guid>https://juejin.cn/post/7591322050240135206</guid>    <pubDate>2026-01-04T09:57:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591322050240135206" data-draft-id="7591293897085026354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【安全专项】如何成为一名“火眼金睛”的安卓侦探？"/> <meta itemprop="keywords" content="前端,代码规范"/> <meta itemprop="datePublished" content="2026-01-04T09:57:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="莫比乌斯环"/> <meta itemprop="url" content="https://juejin.cn/user/2840793776394269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【安全专项】如何成为一名“火眼金睛”的安卓侦探？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2840793776394269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    莫比乌斯环
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:57:42.000Z" title="Sun Jan 04 2026 09:57:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    29
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">如何成为一名“火眼金睛”的安卓侦探？</h2>
<p>在这个智能手机横行的时代，安卓手机简直成了我们生活中的“第三只手”。但你知道吗？在安卓的世界里，有时候并不是所有的用户都规规矩矩！有些用户可能会偷偷摸摸地“搞事情”，比如开启开发者模式、调试模式、使用VPN、代理，甚至直接把手机给Root了！这就像你辛辛苦苦建了一个城堡，却有人偷偷从后门溜进来搞破坏，想想都让人气得跺脚！</p>
<p>作为一名正义的安卓开发者，怎么能让这些“小动作”逃过我们的“火眼金睛”呢？今天我们就来聊聊如何识别这些“非正常操作”，顺便给你的代码加点“盔甲”，让它变得更安全！</p>
<hr/>
<h3 data-id="heading-1">开发者模式：别以为你是开发者我就不认识你！</h3>
<p>首先，我们来聊聊开发者模式。很多安卓小伙伴可能都知道，只要连续点几下“关于手机”里的某个版本号，就能开启开发者选项。听起来是不是很酷炫？但对于开发者来说，这可是个潜在的“坑”！一旦开启了开发者模式，用户就能做一些奇奇怪怪的事情，比如抓包、调试你的App，甚至看看你代码里的小秘密。</p>
<p>怎么办？别慌！安卓有个<code>Settings.Secure</code> API，可以用来检查开发者模式是否开启。只要写几行代码，就能精准“锁定”这些喜欢玩开发者模式的小伙伴。比如这样：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">devMode</span> <span class="hljs-operator">=</span> Settings.Secure.getInt(context.getContentResolver(),
    Settings.Secure.DEVELOPMENT_SETTINGS_ENABLED, <span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (devMode == <span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 哟，发现一个开发者模式用户！</span>
}
</code></pre>
<p>是不是很简单？有了这招，再高级的“伪装者”也逃不过你的法眼！</p>
<hr/>
<h3 data-id="heading-2">调试模式：调试，是你调得起的吗？</h3>
<p>调试模式就像是让你的App裸奔在大街上，所有的数据、接口都暴露无遗。对于那些喜欢“搞事情”的人来说，这可是个大好机会！所以，我们一定要时刻警惕，看看是不是有人正在用调试工具窥探我们的App。</p>
<p>这里推荐一个简单的方法：用<code>android.os.Debug</code>类来检测是否处于调试状态。如果发现被调试了，那就可以立刻触发警报，甚至直接关闭App，让对方哭着回家。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (Debug.isDebuggerConnected()) {
    <span class="hljs-comment">// 哈哈，被我抓到了！</span>
    System.exit(<span class="hljs-number">0</span>); <span class="hljs-comment">// 直接关掉App，绝不手软！</span>
}
</code></pre>
<p>这一招简直就是“见招拆招”，谁还敢调试你的App？！</p>
<hr/>
<h3 data-id="heading-3">VPN 和代理：你是想当“隐形人”吗？</h3>
<p>有些用户喜欢用VPN或者代理访问网络，可能是为了“科学上网”，也可能是为了隐藏自己的真实身份。但对于开发者来说，这种操作简直就是在玩火！尤其是那些需要地理位置或者用户真实IP的应用，一旦被代理伪装，后果不堪设想。</p>
<p>那么问题来了，该如何识别这些“隐形人”呢？其实很简单，可以通过检查网络连接的代理信息来判断：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">boolean</span> <span class="hljs-variable">isUsingProxy</span> <span class="hljs-operator">=</span> (!TextUtils.isEmpty(System.getProperty(<span class="hljs-string">"http.proxyHost"</span>)) 
    || !TextUtils.isEmpty(System.getProperty(<span class="hljs-string">"https.proxyHost"</span>)));
<span class="hljs-keyword">if</span> (isUsingProxy) {
    <span class="hljs-comment">// 嘿嘿，发现一个用代理的小伙伴！</span>
}
</code></pre>
<p>再配合一些第三方的VPN检测工具，你的App简直可以变成“反隐形雷达”！</p>
<hr/>
<h3 data-id="heading-4">Root 检测：谁允许你动我的系统？</h3>
<p>最后，我们来说说最让开发者头疼的问题——Root权限。Root用户就像是拿到了系统的万能钥匙，可以随意修改系统文件、绕过权限限制，甚至直接篡改你的App数据。听起来是不是很恐怖？</p>
<p>别担心！虽然Root用户很“嚣张”，但我们也不是吃素的。通过检查常见的Root工具文件（比如<code>su</code>命令），就能快速判断设备是否被Root：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRooted</span><span class="hljs-params">()</span> {
    String[] paths = {<span class="hljs-string">"/system/app/Superuser.apk"</span>, <span class="hljs-string">"/sbin/su"</span>, <span class="hljs-string">"/system/bin/su"</span>, 
        <span class="hljs-string">"/system/xbin/su"</span>, <span class="hljs-string">"/data/local/xbin/su"</span>, <span class="hljs-string">"/data/local/bin/su"</span>};
    <span class="hljs-keyword">for</span> (String path : paths) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path).exists()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 发现Root用户！</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>把这段代码加到你的App里，那些Root用户再也不能为所欲为啦！</p>
<hr/>
<h3 data-id="heading-5">增强代码安全：给你的App穿上盔甲</h3>
<p>除了识别这些“小动作”，我们还要给自己的代码加点料，让它更安全、更难破解。比如：</p>
<ol>
<li><strong>混淆代码</strong>：使用ProGuard或者R8工具，把你的代码变得像天书一样，看得人头晕眼花。</li>
<li><strong>签名校验</strong>：检查App的签名是否被篡改，确保用户安装的是正版App。</li>
<li><strong>动态加密</strong>：对敏感数据进行加密存储，即使被抓包也看不懂。</li>
<li><strong>防止反编译</strong>：使用Dex加密工具，让反编译工具束手无策。</li>
</ol>
<p>这些方法虽然不能百分百防住所有攻击，但至少能让那些“搞事情”的人多花点时间，多掉几根头发！</p>
<hr/>
<h3 data-id="heading-6">总结</h3>
<p>在安卓的江湖里，总会有一些“不安分”的用户试图挑战规则。但只要我们掌握了这些检测技巧，再加上一些安全措施，就能让他们无所遁形！当然啦，作为开发者，我们也要保持一颗平常心，不要太偏执，毕竟技术是一把双刃剑，用得好才能造福用户。</p>
<p>最后，希望各位开发者都能成为“火眼金睛”的安卓侦探，让你的App安全又可靠！如果你学会了这些技巧，不妨在评论区炫耀一下，说不定还能收获一波点赞哦！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别“代码屎山”：用Cursor系统重构遗留前端项目]]></title>    <link>https://juejin.cn/post/7591075684065869839</link>    <guid>https://juejin.cn/post/7591075684065869839</guid>    <pubDate>2026-01-04T09:50:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591075684065869839" data-draft-id="7591075684065853455" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别“代码屎山”：用Cursor系统重构遗留前端项目"/> <meta itemprop="keywords" content="前端,Cursor"/> <meta itemprop="datePublished" content="2026-01-04T09:50:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mr_chiu"/> <meta itemprop="url" content="https://juejin.cn/user/1644525124592974"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别“代码屎山”：用Cursor系统重构遗留前端项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1644525124592974/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mr_chiu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:50:15.000Z" title="Sun Jan 04 2026 09:50:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当你面对数千行耦合的组件和混乱的状态逻辑时，AI重构将成为你最强的技术搭档。</p>
</blockquote>
<p>前端开发者职业生涯中，最令人望而生畏的挑战之一莫过于接手一个“祖传”的遗留项目。那些混合着不同时期技术栈、缺乏文档、逻辑缠绕如“意大利面”的代码库，常常让人进退两难：不重构则难以维护和扩展，动手重构又怕“牵一发而动全身”。</p>
<p>本篇将深入探讨如何利用 Cursor，系统性地对遗留前端项目进行安全、高效的重构，不仅偿还技术债务，更为项目注入新的生命力。</p>
<h2 data-id="heading-0">一、重构前奏：建立对“代码迷雾”的清晰认知</h2>
<h3 data-id="heading-1">1.1 项目分析与技术债务评估</h3>
<p>传统的手动分析大型代码库，往往需要数天甚至数周时间。而借助 Cursor，这一过程可以大幅加速。</p>
<p><strong>关键指令示例：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">分析当前React项目的整体架构，识别：
<span class="hljs-bullet">1.</span> 主要组件依赖关系
<span class="hljs-bullet">2.</span> 状态管理方案及其一致性问题
<span class="hljs-bullet">3.</span> 重复代码模式和潜在抽象点
<span class="hljs-bullet">4.</span> 性能瓶颈和内存泄漏风险
<span class="hljs-bullet">5.</span> 过时的API使用和废弃的生命周期方法
</code></pre>
<p>Cursor 能够快速生成一份结构化报告，包括可视化的组件依赖图谱和按优先级排序的技术债务清单。这种全局视角让你在动手前就明确重构的重点和边界。</p>
<h3 data-id="heading-2">1.2 为项目设立清晰的“重构规则”</h3>
<p>在开始重构前，一个关键的步骤是使用 <code>/generate rules</code> 命令或手动在项目根目录创建 <code>.cursor</code> 文件夹，为 AI 设定清晰的项目规则和约束。</p>
<p><strong>示例 <code>.cursor/rules.md</code>：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 本项目重构规则</span>

<span class="hljs-section">## 技术栈约束</span>
<span class="hljs-bullet">-</span> 使用 React 18 + TypeScript 5.0+
<span class="hljs-bullet">-</span> 状态管理统一迁移至 Zustand
<span class="hljs-bullet">-</span> 样式方案采用 Tailwind CSS

<span class="hljs-section">## 代码质量规则</span>
<span class="hljs-bullet">-</span> 禁止使用 <span class="hljs-code">`any`</span> 类型，必须定义明确接口
<span class="hljs-bullet">-</span> 组件必须支持按需加载（React.lazy）
<span class="hljs-bullet">-</span> 函数长度不超过50行，复杂逻辑必须拆分
<span class="hljs-bullet">-</span> 禁用过时的 <span class="hljs-code">`componentWillMount`</span> 等生命周期

<span class="hljs-section">## 架构原则</span>
<span class="hljs-bullet">-</span> 遵循单一职责原则，一个文件一个主要导出
<span class="hljs-bullet">-</span> 业务逻辑与UI组件必须分离
<span class="hljs-bullet">-</span> API调用必须通过统一的service层
</code></pre>
<p>为 AI 设定这些明确的规则，就像为一位聪明的实习生提供了清晰的工作手册，能确保后续生成的所有代码都符合你的架构愿景，避免生成“AI意大利面代码”。</p>
<h2 data-id="heading-3">二、分而治之：核心重构策略与Cursor实战</h2>
<h3 data-id="heading-4">2.1 破解“巨石组件”：智能拆解与职责分离</h3>
<p>面对一个承载了过多逻辑的“巨石组件”(Monolithic Component)，重构的第一步是理清其内部职责。</p>
<p><strong>实战案例：拆解一个混合了数据获取、表单处理和UI渲染的用户管理组件</strong></p>
<ol>
<li>
<p><strong>使用Cursor分析现有组件</strong>：</p>
<pre><code class="hljs language-go" lang="go">分析 <span class="hljs-string">`UserManagement.jsx`</span> 文件，识别其承担的主要职责，并建议符合单一职责原则的拆分方案。
</code></pre>
</li>
<li>
<p><strong>基于建议实施拆分</strong>：
根据 Cursor 的分析，可以按以下结构重构：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 旧结构：UserManagement.jsx (420行)</span>
<span class="hljs-comment">// 新结构：</span>
<span class="hljs-comment">// - hooks/useUserData.js      // 数据获取逻辑</span>
<span class="hljs-comment">// - services/userService.js   // API调用封装</span>
<span class="hljs-comment">// - components/UserForm.jsx   // 表单处理</span>
<span class="hljs-comment">// - components/UserList.jsx   // 用户列表展示</span>
<span class="hljs-comment">// - containers/UserManagementContainer.jsx // 组合层</span>
</code></pre>
</li>
<li>
<p><strong>让Cursor协助生成新模块</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">基于原 <span class="hljs-code">`UserManagement.jsx`</span> 中的表单验证逻辑，创建一个独立的 <span class="hljs-code">`UserForm`</span> 组件，要求：
<span class="hljs-bullet">-</span> 使用React Hook Form进行表单管理
<span class="hljs-bullet">-</span> 包含完整的验证规则（邮箱格式、密码强度等）
<span class="hljs-bullet">-</span> 支持提交状态（loading, success, error）
<span class="hljs-bullet">-</span> 导出清晰的TypeScript接口
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">2.2 状态管理现代化：从混乱到清晰</h3>
<p>遗留项目常见的问题是状态管理分散——Mixins、Context、本地状态和全局Store混杂使用。</p>
<p><strong>重构策略：统一迁移至现代状态库</strong></p>
<p>以从传统的类组件+Redux Thunk迁移到函数组件+Zustand为例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 让Cursor分析现有的Redux store和reducers</span>
<span class="hljs-comment">// 指令：“将以下Redux reducer转换为Zustand store，保持相同状态结构和操作”</span>

<span class="hljs-comment">// 2. 生成新的Zustand store</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserState</span> {
  <span class="hljs-attr">users</span>: <span class="hljs-title class_">User</span>[];
  <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">error</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
  <span class="hljs-attr">fetchUsers</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-attr">addUser</span>: <span class="hljs-function">(<span class="hljs-params">user: Omit&lt;User, <span class="hljs-string">'id'</span>&gt;</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-comment">// ... 其他操作</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = create&lt;<span class="hljs-title class_">UserState</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">users</span>: [],
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,
  
  <span class="hljs-attr">fetchUsers</span>: <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> });
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> userService.<span class="hljs-title function_">getAll</span>();
      <span class="hljs-title function_">set</span>({ <span class="hljs-attr">users</span>: response.<span class="hljs-property">data</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">set</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'获取用户列表失败'</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> });
    }
  },
  
  <span class="hljs-comment">// ... 其他操作实现</span>
}));

<span class="hljs-comment">// 3. 生成迁移指南和兼容层</span>
<span class="hljs-comment">// Cursor可以创建一个临时的兼容层，确保重构期间业务不中断</span>
</code></pre>
<h3 data-id="heading-6">2.3 依赖升级与API现代化</h3>
<p>过时的依赖是技术债务的重要部分。Cursor可以帮助安全地进行依赖升级。</p>
<p><strong>实战步骤：</strong></p>
<ol>
<li>
<p><strong>识别过时依赖</strong>：</p>
<pre><code class="hljs language-go" lang="go">扫描<span class="hljs-keyword">package</span>.json，识别React、TypeScript、Webpack等核心依赖的当前版本和最新版本，评估升级风险。
</code></pre>
</li>
<li>
<p><strong>生成渐进式升级方案</strong>：
Cursor 能够提供分阶段的升级路径，例如先升级补丁版本，再升级次要版本，最后处理破坏性变更。</p>
</li>
<li>
<p><strong>修复破坏性变更</strong>：
当 API 发生破坏性变更时（如 React Router v5 到 v6），Cursor 可以协助批量修改：</p>
<pre><code class="hljs language-markdown" lang="markdown">将项目中所有React Router v5的用法迁移到v6，包括：
<span class="hljs-bullet">-</span> <span class="hljs-code">`&lt;Switch&gt;`</span> 改为 <span class="hljs-code">`&lt;Routes&gt;`</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`&lt;Route component={Component}&gt;`</span> 改为 <span class="hljs-code">`&lt;Route element={&lt;Component /&gt;}&gt;`</span>
<span class="hljs-bullet">-</span> 路由守卫逻辑调整
</code></pre>
</li>
</ol>
<h2 data-id="heading-7">三、Cursor高级重构功能实战</h2>
<h3 data-id="heading-8">3.1 多文件协同编辑与跨组件重构</h3>
<p>当重构影响到多个文件时，Cursor 的跨文件理解能力显得尤为重要。</p>
<p><strong>案例：将内联样式统一迁移至CSS Modules</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">重构整个项目的样式系统：
<span class="hljs-bullet">1.</span> 识别所有使用内联style属性的组件
<span class="hljs-bullet">2.</span> 为每个组件创建对应的.module.css文件
<span class="hljs-bullet">3.</span> 将内联样式迁移到CSS Modules中
<span class="hljs-bullet">4.</span> 更新组件导入和类名引用
</code></pre>
<p>Cursor 能够理解样式与组件的对应关系，批量完成迁移，同时保持样式优先级的一致性。</p>
<h3 data-id="heading-9">3.2 自动化代码质量提升</h3>
<p>利用 Cursor 自动修复常见的代码质量问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 重构前：复杂的条件嵌套</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserStatus</span> = (<span class="hljs-params">user</span>) =&gt; {
  <span class="hljs-keyword">if</span> (user) {
    <span class="hljs-keyword">if</span> (user.<span class="hljs-property">isActive</span>) {
      <span class="hljs-keyword">if</span> (user.<span class="hljs-property">lastLogin</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'在线'</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'新用户'</span>;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'已禁用'</span>;
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'用户不存在'</span>;
  }
};

<span class="hljs-comment">// 指令：“优化这段条件嵌套代码，使用更清晰的结构”</span>
<span class="hljs-comment">// 重构后：早期返回和卫语句</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserStatus</span> = (<span class="hljs-params">user</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> <span class="hljs-string">'用户不存在'</span>;
  <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">isActive</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'已禁用'</span>;
  <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">lastLogin</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'新用户'</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'在线'</span>;
};
</code></pre>
<h3 data-id="heading-10">3.3 测试驱动重构（TDR）</h3>
<p>Cursor 设计总监 Ryo Lu 强调的一个核心理念是：<strong>先写测试，再生成代码</strong>。这是防止重构引入回归错误的最有效方法。</p>
<p><strong>TDR工作流：</strong></p>
<ol>
<li>为要重构的组件或函数编写测试用例</li>
<li>运行现有测试确保基线正常</li>
<li>让 Cursor 在测试的“约束”下进行重构</li>
<li>运行测试验证重构正确性</li>
<li>修复任何失败的测试，并使用 <code>@fixed</code> 注释告诉 AI 正确做法</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 先编写测试</span>
<span class="hljs-title function_">describe</span>(<span class="hljs-string">'UserForm组件'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'应该验证邮箱格式'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { getByLabelText } = <span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span> /&gt;</span></span>);
    <span class="hljs-keyword">const</span> emailInput = <span class="hljs-title function_">getByLabelText</span>(<span class="hljs-string">'邮箱'</span>);
    fireEvent.<span class="hljs-title function_">change</span>(emailInput, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: <span class="hljs-string">'invalid-email'</span> } });
    <span class="hljs-title function_">expect</span>(screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-string">'邮箱格式不正确'</span>)).<span class="hljs-title function_">toBeInTheDocument</span>();
  });
});

<span class="hljs-comment">// 2. 然后让Cursor实现或重构组件</span>
<span class="hljs-comment">// 指令：“实现UserForm组件，必须通过上述测试用例”</span>
</code></pre>
<h2 data-id="heading-11">四、人机协作：确定你在重构中的核心角色</h2>
<h3 data-id="heading-12">4.1 AI擅长的工作 ✅</h3>
<ul>
<li><strong>重复性模式识别</strong>：找出多个组件中的相似模式</li>
<li><strong>语法转换</strong>：将类组件转换为函数组件，添加TypeScript类型</li>
<li><strong>批量修改</strong>：重命名、提取常量、统一代码风格</li>
<li><strong>文档生成</strong>：基于代码生成注释和API文档</li>
<li><strong>基础测试用例</strong>：生成覆盖常规路径的测试</li>
</ul>
<h3 data-id="heading-13">4.2 需要人类把控的关键 🔑</h3>
<ul>
<li><strong>业务逻辑理解</strong>：AI可能不理解“为什么这段代码要这么写”</li>
<li><strong>架构决策</strong>：选择哪种状态管理方案、文件夹结构如何组织</li>
<li><strong>性能权衡</strong>：在代码可读性和极致性能间做选择</li>
<li><strong>用户体验考量</strong>：加载状态、错误处理、无障碍访问等细节</li>
<li><strong>团队规范</strong>：遵循团队特定的代码约定和流程</li>
</ul>
<p>正如多个实践案例所揭示的，最有效的模式是“AI负责效率，人负责精准”，开发者需要扮演“决策者与校验者”的角色。</p>
<h2 data-id="heading-14">五、重构工作流与最佳实践</h2>
<h3 data-id="heading-15">5.1 安全重构工作流</h3>
<p>以下是经过实践验证的安全重构流程：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[评估与规划] --&gt; B[建立安全网&lt;br&gt;编写测试用例]
    B --&gt; C[小步变更&lt;br&gt;每次只重构一个关注点]
    C --&gt; D[持续验证&lt;br&gt;运行测试和类型检查]
    D --&gt; E[代码审查&lt;br&gt;人工审核AI生成的代码]
    E --&gt; F[提交与记录&lt;br&gt;小批次提交，清晰注释]
    
    D -- 发现问题 --&gt; G[立即回滚&lt;br&gt;使用Git恢复]
    G --&gt; C
    
    F --&gt; H[迭代优化&lt;br&gt;基于反馈调整规则]
    H --&gt; A
</code></pre>
<h3 data-id="heading-16">5.2 重构中的Cursor高级技巧</h3>
<ol>
<li>
<p><strong>使用 <code>@file</code>、<code>@folder</code> 限定上下文范围</strong>
当处理特定文件时，使用 <code>@file:UserForm.jsx</code> 确保 Cursor 不会误改其他文件。</p>
</li>
<li>
<p><strong>利用对话历史持续迭代</strong>
使用 <code>/history</code> 调取旧对话，基于之前的决策继续重构，避免重复解释。</p>
</li>
<li>
<p><strong>有意识地选择模型</strong></p>
<ul>
<li><strong>GPT-4</strong>：适合复杂算法和架构设计</li>
<li><strong>Claude</strong>：擅长理解业务逻辑和创意性任务</li>
<li><strong>Cursor自研Composer模型</strong>：速度极快，适合快速迭代</li>
</ul>
</li>
<li>
<p><strong>大项目预索引</strong>
对于大型代码库，可以让 Cursor 提前建立索引（“过夜索引”），这样在后续操作中响应更快。</p>
</li>
</ol>
<h2 data-id="heading-17">六、从重构到预防：建立可持续的代码文化</h2>
<p>重构的最终目的不是一次性地“还清债务”，而是建立防止新债务产生的机制。</p>
<h3 data-id="heading-18">6.1 建立团队AI协作规范</h3>
<ul>
<li><strong>制定AI生成代码的评审标准</strong>：明确什么情况下可以接受AI生成的代码</li>
<li><strong>创建团队共享的<code>.cursor</code>配置</strong>：统一团队的开发约束和规则</li>
<li><strong>定期更新项目规则库</strong>：随着项目发展调整规则</li>
</ul>
<h3 data-id="heading-19">6.2 监控与度量</h3>
<p>建立关键指标来跟踪重构效果：</p>
<ul>
<li><strong>代码复杂度得分</strong>（如圈复杂度）</li>
<li><strong>测试覆盖率变化</strong></li>
<li><strong>构建时间优化</strong></li>
<li><strong>包体积减少</strong></li>
</ul>
<h2 data-id="heading-20">结语：重构作为持续实践</h2>
<p>使用 Cursor 进行遗留项目重构，不是一次性的“魔法修复”，而是一个持续的、系统性的工程实践。它改变了重构的成本效益方程——过去因为风险太高而不敢触碰的“代码雷区”，现在可以安全、渐进地改善。</p>
<p><strong>记住</strong>：最好的重构策略是小步快跑、持续验证。每次提交只改变一件事，确保有完整的测试覆盖，让 Cursor 成为你的技术搭档而非替代者。</p>
<p>当你成功将一个混乱的遗留系统重构为清晰、可维护的现代代码库时，那种成就感是无可替代的。而 Cursor，正是让你能够勇敢面对“代码屎山”，将其转化为坚实技术基座的关键工具。</p>
<hr/>
<p><strong>下篇预告</strong>：在第三篇中，我们将探索如何将 Cursor 深度融入团队工作流，包括多人协作最佳实践、代码审查自动化、文档智能生成等高级主题，敬请期待！</p>
<p><strong>互动话题</strong>：你在重构遗留项目时遇到的最大挑战是什么？尝试用本文介绍的方法解决一个小问题，并在评论区分享你的经验和成果！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一站式构建 AI 数据处理 Pipeline：DataWorks Notebook + MaxCompute MaxFrame 快速入门指南]]></title>    <link>https://juejin.cn/post/7591130604429508648</link>    <guid>https://juejin.cn/post/7591130604429508648</guid>    <pubDate>2026-01-04T10:20:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591130604429508648" data-draft-id="7591309945510068224" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一站式构建 AI 数据处理 Pipeline：DataWorks Notebook + MaxCompute MaxFrame 快速入门指南"/> <meta itemprop="keywords" content="大数据,人工智能"/> <meta itemprop="datePublished" content="2026-01-04T10:20:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一站式构建 AI 数据处理 Pipeline：DataWorks Notebook + MaxCompute MaxFrame 快速入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:20:07.000Z" title="Sun Jan 04 2026 10:20:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​在大模型与 AI 应用快速落地的今天，企业对“数据准备 → 数据处理 → 模型训练”的端到端效率提出了更高要求。阿里云数据开发治理平台 DataWorks 联合云原生大数据计算服务 MaxCompute，为您提供一套开箱即用、安全合规、弹性可扩展的 AI 数据开发环境，特别适合需要处理 TB/PB 级结构化、半/非结构化数据的 AI 工程师、数据科学家与算法团队。</p>
<p>本文将带您快速了解如何基于阿里云两大核心产品——DataWorks（大数据开发与治理平台）、MaxCompute（云原生大数据计算服务）以及MaxFrame（分布式Python计算框架）—— 高效搭建一个支持 Notebook 交互式开发、任务调度与大规模并行计算的一体化 AI 数据处理环境。</p>
<h2 data-id="heading-0">为什么选择这套组合？</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0eadaa4dad3e4aa9b7ad5a8d8129b5be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126896&amp;x-signature=dSxyvcX9p9l4KVczi%2Bl2PWxKJFI%3D" alt="" loading="lazy"/></p>
<p><strong>优势总结：</strong></p>
<ul>
<li>
<p>无需自建集群：全托管服务，分钟级开通</p>
</li>
<li>
<p>开发体验友好：Jupyter Notebook 风格，支持 Magic Command 快速连接计算资源</p>
</li>
<li>
<p>安全合规：天然集成 RAM 权限体系、VPC 网络隔离、敏感信息加密</p>
</li>
<li>
<p>成本可控：按量付费 + 包年包月，适合测试与生产混合场景</p>
</li>
</ul>
<h2 data-id="heading-1">环境搭建四步走（核心流程）</h2>
<p>虽然底层涉及多个服务联动，但对用户而言，只需完成以下四个关键步骤，即可进入开发状态：</p>
<h4 data-id="heading-2">第一步：开通 MaxCompute 项目</h4>
<p>作为计算与存储的核心，MaxCompute 项目是所有数据作业的资源底座。</p>
<ul>
<li>
<p>选择与业务一致的地域（如华东2-上海）</p>
</li>
<li>
<p>推荐使用按量付费模式（新用户可享受免费额度）</p>
</li>
<li>
<p>项目名称建议包含业务标识（如 <code>ai_dedup_01</code>），便于后续管理</p>
</li>
</ul>
<h4 data-id="heading-3">第二步：创建 DataWorks 工作空间</h4>
<p>DataWorks 提供从开发到运维的完整工具链。</p>
<ul>
<li>
<p>选择基础版即可满足 Notebook 开发需求（免费）</p>
</li>
<li>
<p>创建通用型资源组（按量付费），并绑定VPC网络（若需访问 OSS、PAI 等内网服务）</p>
</li>
<li>
<p>指定空间管理员，并添加团队成员（支持 RAM 子账号）</p>
</li>
</ul>
<p>建议开启“新版数据开发（Data Studio）”，获得更流畅的 Notebook 体验。</p>
<h4 data-id="heading-4">第三步：绑定计算资源</h4>
<p>将 MaxCompute 项目“绑定”到 DataWorks 工作空间，实现开发与计算的打通。</p>
<ul>
<li>
<p>在工作空间管理页中，一键绑定已创建的 MaxCompute 项目</p>
</li>
<li>
<p>选择合适的资源组（用于任务调度与 Notebook 执行）</p>
</li>
<li>
<p>测试连通性，确保权限与网络配置正确</p>
</li>
</ul>
<p>安全提示：建议使用“阿里云主账号”作为默认执行身份，避免权限不足问题。</p>
<h4 data-id="heading-5">第四步：启动个人开发环境</h4>
<p>这是您编写代码的“云端工作站”。</p>
<ul>
<li>
<p>在 Data Studio 中新建一个个人开发环境实例</p>
</li>
<li>
<p>选择 CPU 规格（如 4 vCPU / 16 GiB）和预置镜像（如 dataworks-maxcompute:py3.11-ubuntu20.04:py3.11-ubuntu20.04-202504-1）</p>
</li>
<li>
<p>实例启动后，即可在 Notebook 中直接连通 MaxFrame 进行分布式计算</p>
</li>
</ul>
<p>注意：实例按CU*时长计费，不使用时请手动停止，避免产生额外费用。</p>
<h2 data-id="heading-6">开始开发：用 MaxFrame 处理海量数据</h2>
<p>一切就绪后，您可以在 Notebook 中像写 Pandas 一样处理亿级数据：</p>
<pre><code class="hljs language-ini" lang="ini">import maxframe.dataframe as md
import pyarrow as pa
import pandas as pd
from maxframe.lib.dtypes_extension import dict_

<span class="hljs-comment"># 初始化 MaxFrame 会话（通过 Magic Command 自动连接 MaxCompute）</span>
<span class="hljs-attr">mf_session</span> = %maxframe

<span class="hljs-comment"># 构造 DataFrame（实际数据可来自 MaxCompute 表）</span>
<span class="hljs-attr">col_a</span> = pd.Series(
    <span class="hljs-attr">data</span>=[[(<span class="hljs-string">"k1"</span>, <span class="hljs-number">1</span>), (<span class="hljs-string">"k2"</span>, <span class="hljs-number">2</span>)], [(<span class="hljs-string">"k1"</span>, <span class="hljs-number">3</span>)], None],
    <span class="hljs-attr">index</span>=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
    <span class="hljs-attr">dtype</span>=dict_(pa.string(), pa.int64()),
)
<span class="hljs-attr">col_b</span> = pd.Series(
    <span class="hljs-attr">data</span>=[<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>],
    <span class="hljs-attr">index</span>=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
)
<span class="hljs-attr">df</span> = md.DataFrame({<span class="hljs-string">"A"</span>: col_a, <span class="hljs-string">"B"</span>: col_b})
df.execute()

<span class="hljs-comment"># 自定义函数</span>
def custom_set_item(df):
    for name, value in df<span class="hljs-section">["A"]</span>.items():
        if value is not None:
            df<span class="hljs-section">["A"]</span><span class="hljs-section">[name]</span><span class="hljs-section">["x"]</span> = 100
    return df

<span class="hljs-comment"># 调用 apply_chunk 执行分布式计算</span>
<span class="hljs-attr">result_df</span> = df.mf.apply_chunk(
    custom_set_item,
    <span class="hljs-attr">output_type</span>=<span class="hljs-string">"dataframe"</span>,
    <span class="hljs-attr">dtypes</span>=df.dtypes.copy(),
    <span class="hljs-attr">batch_rows</span>=<span class="hljs-number">2</span>,
    <span class="hljs-attr">skip_infer</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">index</span>=df.index,
).execute().fetch()

print(result_df)
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p><strong>亮点功能：</strong></p>
<ul>
<li>
<p>使用 <code>%maxframe</code> Magic Command，无需明文 AccessKey，快捷连通目标计算资源</p>
</li>
<li>
<p>输出中包含 Logview 链接，一键查看作业 DAG、耗时、失败原因</p>
</li>
<li>
<p>支持将结果写回 MaxCompute 表或导出至 OSS，无缝衔接下游模型训练</p>
</li>
</ul>
<h2 data-id="heading-7">最佳实践建议</h2>
<p>为了让您的开发更高效、更稳定，推荐关注以下几点：</p>
<h4 data-id="heading-8">1. 善用 Logview 2.0</h4>
<p>每次执行都会生成可视化作业追踪链接，帮助快速定位性能瓶颈或错误根源。</p>
<h4 data-id="heading-9">2. 合理配置资源配额</h4>
<p>通过设置 <code>options.session.quota_name</code> 指定后付费/预付费 Quota，按业务需求灵活选择。</p>
<h4 data-id="heading-10">3. 敏感信息统一管理</h4>
<p>在 DataWorks 工作空间参数中配置 AK/SK 或数据库密码，代码中通过 ${workspace.工作空间参数名} <code>引用，杜绝明文泄露。</code></p>
<h4 data-id="heading-11">4. 利用数据地图做元数据治理</h4>
<p>DataWorks 自动同步 MaxCompute 表结构，支持血缘分析、表预览、生命周期管理，提升团队协作效率。</p>
<h2 data-id="heading-12">常见问题快速排查</h2>
<ul>
<li>
<p>Q：Notebook 中查不到 MaxCompute 表？<br/>
A：确认 MaxCompute 项目已绑定到当前 DataWorks 工作空间，并检查账号是否有读权限；可在“数据地图”中手动刷新元数据。</p>
</li>
<li>
<p>Q：无法读写 OSS 数据？<br/>
A：确保 RAM 用户拥有对应 Bucket 的读写权限，且个人开发环境实例（开发环境）和通用型资源组（生产环境）与 OSS 在同一 VPC 内（或已配置公网访问）。</p>
</li>
</ul>
<h2 data-id="heading-13">下一步行动</h2>
<p>现在，您已经拥有了一个安全、弹性、高性能的 AI 数据处理平台。无论是进行数据去重、特征打标、日志清洗，还是为大模型准备高质量训练语料，这套组合都能为您提供强大支撑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工程化实战：uniapp基于路由的自动主题切换体系]]></title>    <link>https://juejin.cn/post/7591346773827092506</link>    <guid>https://juejin.cn/post/7591346773827092506</guid>    <pubDate>2026-01-04T10:24:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827092506" data-draft-id="7591338980693295150" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工程化实战：uniapp基于路由的自动主题切换体系"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-04T10:24:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LC同学47981"/> <meta itemprop="url" content="https://juejin.cn/user/1978776660477991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工程化实战：uniapp基于路由的自动主题切换体系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776660477991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LC同学47981
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:24:53.000Z" title="Sun Jan 04 2026 10:24:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">UI 工程化实战：基于路由的自动主题切换体系</h2>
<p>在多租户 SaaS 系统中，不同业务模块往往需要展现截然不同的视觉风格。例如，“电商主页”通常采用蓝色调的商务风格，而“扫码点餐”模块则偏向红色的营销风格。如何让用户在不同模块间跳转时，系统能<strong>自动、无感地切换主题</strong>，是提升用户体验的关键。</p>
<p>本文将深入解析本项目基于 <strong>CSS 变量 + 路由监听 + Pinia Store</strong> 构建的自动主题切换体系。</p>
<hr/>
<h3 data-id="heading-1">一、 核心痛点</h3>
<ol>
<li><strong>手动切换繁琐</strong>：如果依赖开发者在每个页面 <code>onLoad</code> 时手动调用 <code>setTheme('red')</code>，不仅代码冗余，还极易遗漏。</li>
<li><strong>样式难以复用</strong>：硬编码的颜色值（如 <code>#ff4b43</code>）散落在各个组件中，修改主题色需要全局搜索替换。</li>
<li><strong>多租户适配难</strong>：不同租户可能对同一模块有不同的颜色偏好，静态配置无法满足需求。</li>
</ol>
<hr/>
<h3 data-id="heading-2">二、 架构设计</h3>
<p>我们设计了一套<strong>三层架构</strong>来解决上述问题：</p>
<ol>
<li><strong>定义层 (Theme Definition)</strong>：集中定义多套主题的颜色变量（JS）和样式变量（CSS Vars）。
<blockquote>
<p><strong>亮点</strong>：除了本地预设，<strong>支持运行时通过接口下发变量进行动态覆盖</strong>，从而实现“无限自由换肤”。</p>
</blockquote>
</li>
<li><strong>配置层 (Theme Config)</strong>：建立“路由路径 -&gt; 主题名称”的映射规则。</li>
<li><strong>执行层 (Runtime Switcher)</strong>：监听路由变化，自动匹配并应用主题。</li>
</ol>
<h4 data-id="heading-3">1. 定义层：JS 与 CSS 变量的双重驱动</h4>
<p>在 <code>src/store/useStyle/theme/</code> 目录下，我们定义了 <code>light</code>（默认蓝）、<code>red</code>（营销红）、<code>dark</code>（暗黑）等多套主题。</p>
<p>以 <code>light.ts</code> 为例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// CSS 变量：用于组件的样式绑定</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cssVars = {
  <span class="hljs-string">'--u-background'</span>: <span class="hljs-string">'#ffffff'</span>,
  <span class="hljs-string">'--u-text'</span>: <span class="hljs-string">'#333333'</span>
};

<span class="hljs-comment">// JS 变量：用于 canvas 绘图或 JS 逻辑</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> colorVars = {
  <span class="hljs-attr">primary</span>: <span class="hljs-string">'#2B67F0'</span>, <span class="hljs-comment">// 主色调：蓝</span>
  <span class="hljs-attr">warning</span>: <span class="hljs-string">'#FF7D00'</span>
  <span class="hljs-comment">// ...</span>
};
</code></pre>
<h4 data-id="heading-4">2. 配置层：路由映射规则</h4>
<p>在 <code>src/utils/env.ts</code> 中，我们通过 <code>defaultTheme</code> 字段配置了主题的适用范围：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getConfig</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">defaultTheme</span>: {
      <span class="hljs-attr">light</span>: <span class="hljs-string">'*'</span>, <span class="hljs-comment">// 默认使用 light 主题</span>
      <span class="hljs-attr">dark</span>: [],
      <span class="hljs-attr">red</span>: [<span class="hljs-string">'subPackageScanQrOrder'</span>] <span class="hljs-comment">// 进入“扫码点餐”分包时，强制切换为 red 主题</span>
    },
    <span class="hljs-attr">defaultThemeColor</span>: <span class="hljs-string">'light'</span>
  };
};
</code></pre>
<h4 data-id="heading-5">3. 执行层：智能路由监听</h4>
<p>在根组件 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">App.ku.vue</a> 中，我们利用 <code>useStyles</code> Store 提供的能力，在应用启动或路由变化时触发检查。</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
  <span class="hljs-keyword">import</span> { useStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/useStyle'</span>;
  <span class="hljs-keyword">import</span> { parseRouteParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/tools'</span>;

  <span class="hljs-comment">// 获取当前路径（包含分包路径）</span>
  <span class="hljs-keyword">const</span> { hashPath } = <span class="hljs-title function_">parseRouteParams</span>();

  <span class="hljs-keyword">if</span> (hashPath) {
    <span class="hljs-comment">// 触发自动主题切换</span>
    <span class="hljs-title function_">useStyles</span>().<span class="hljs-title function_">switchThemeByRouter</span>(hashPath);
  }
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-6">三、 核心代码解析</h3>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">src/store/useStyle/index.ts</a> 是整个机制的大脑。</p>
<h4 data-id="heading-7">1. 路由匹配逻辑</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">switchThemeByRouter</span> = (<span class="hljs-params">routePath: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> config = <span class="hljs-title function_">getConfig</span>();

  <span class="hljs-comment">// 1. 提取路径前缀（分包名）</span>
  <span class="hljs-keyword">let</span> pathPrefix = routePath.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>)[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 2. 遍历配置，寻找匹配的主题</span>
  <span class="hljs-keyword">let</span> key = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(config.<span class="hljs-property">defaultTheme</span>).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
    <span class="hljs-comment">// 检查当前路径是否在某个主题的配置列表中</span>
    <span class="hljs-keyword">return</span> config.<span class="hljs-property">defaultTheme</span>[key <span class="hljs-keyword">as</span> <span class="hljs-title class_">ThemeColor</span>]?.<span class="hljs-title function_">includes</span>(pathPrefix);
  });

  <span class="hljs-comment">// 3. 兜底策略：未匹配则使用默认主题</span>
  <span class="hljs-keyword">if</span> (!key) {
    <span class="hljs-title function_">switchTheme</span>(config.<span class="hljs-property">defaultThemeColor</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 4. 执行切换</span>
  <span class="hljs-title function_">switchTheme</span>(key <span class="hljs-keyword">as</span> <span class="hljs-title class_">ThemeColor</span>);
};
</code></pre>
<h4 data-id="heading-8">2. 样式注入逻辑</h4>
<p><code>switchTheme</code> 方法负责将选定主题的变量注入到 <code>uview-pro</code> 的主题系统中，使其全局生效。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">switchTheme</span> = (<span class="hljs-params">theme: ThemeColor</span>) =&gt; {
  <span class="hljs-keyword">if</span> (currentThemeColor.<span class="hljs-property">value</span> === theme) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 避免重复切换</span>

  <span class="hljs-keyword">const</span> themeVars = <span class="hljs-title function_">getTheme</span>(theme);

  <span class="hljs-comment">// 更新 Pinia 状态</span>
  currentThemeColor.<span class="hljs-property">value</span> = theme;

  <span class="hljs-comment">// 调用 UI 库的 setTheme 方法，底层会将 CSS 变量挂载到 :root 上</span>
  <span class="hljs-title function_">changeTheme</span>({
    <span class="hljs-attr">selfColorsVars</span>: themeVars.<span class="hljs-property">colorVars</span>,
    <span class="hljs-attr">selfCssVars</span>: themeVars.<span class="hljs-property">cssVars</span>
  });
};
</code></pre>
<hr/>
<h3 data-id="heading-9">四、 方案优势</h3>
<ol>
<li><strong>零侵入性</strong>：业务页面无需编写任何主题切换代码，只需关注业务逻辑。</li>
<li><strong>细粒度控制</strong>：支持按分包、按页面甚至按租户配置不同的主题规则。</li>
<li><strong>动态性</strong>：除了内置主题，该架构还支持从服务端下发 JSON 配置，实现“千人千面”的动态换肤。</li>
<li><strong>一致性</strong>：JS 变量与 CSS 变量同步更新，确保 Canvas 图表与 DOM 元素的颜色始终保持一致。</li>
</ol>
<p>通过这套 UI 工程化体系，我们成功实现了复杂业务场景下的自动化视觉管理，显著提升了开发效率与用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果]]></title>    <link>https://juejin.cn/post/7591338980693393454</link>    <guid>https://juejin.cn/post/7591338980693393454</guid>    <pubDate>2026-01-04T10:34:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591338980693393454" data-draft-id="7591207451779285018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果"/> <meta itemprop="keywords" content="Android,OpenGL"/> <meta itemprop="datePublished" content="2026-01-04T10:34:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="下位子"/> <meta itemprop="url" content="https://juejin.cn/user/2313028193761389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028193761389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    下位子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:34:42.000Z" title="Sun Jan 04 2026 10:34:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://juejin.cn/post/7567889397497528383" target="_blank" title="https://juejin.cn/post/7567889397497528383">前言: 『OpenGL学习』 从零打造 Android 滤镜相机</a></p>
<p><a href="https://juejin.cn/post/7572493520004104226" target="_blank" title="https://juejin.cn/post/7572493520004104226">上一篇:『OpenGL学习滤镜相机』- Day10: 相机预览与 OpenGL 结合</a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest" target="_blank" title="https://github.com/xiaweizi/OpenGLTest" ref="nofollow noopener noreferrer">OpenGLTest</a></p>
</blockquote>
<h2 data-id="heading-0">📚 今日目标</h2>
<ul>
<li>掌握常见滤镜算法的原理和实现</li>
<li>学习色彩空间转换（RGB、HSV）</li>
<li>实现多种实时滤镜效果</li>
<li>理解滤镜参数调节机制</li>
<li>为美颜功能打下基础</li>
</ul>
<h2 data-id="heading-1">运行效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75c0feef23174a6d89469a02389a6932~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128434&amp;x-signature=Lnndq6l7RNnvOgVBPak4cpWQKYc%3D" alt="Day11.gif" loading="lazy"/></p>
<h2 data-id="heading-2">🎯 学习内容</h2>
<h3 data-id="heading-3">1. 滤镜基础原理</h3>
<p><strong>滤镜本质</strong>：在片段着色器中修改每个像素的颜色值。</p>
<pre><code class="hljs language-python" lang="python">原始像素颜色 → 滤镜算法处理 → 输出新颜色
   (R, G, B)  →   f(R, G, B)   → (<span class="hljs-string">R', G'</span>, <span class="hljs-string">B')
</span></code></pre>
<h4 data-id="heading-4">滤镜的分类</h4>






























<table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>色彩调整</strong></td><td>修改 RGB 值</td><td>灰度、反色、亮度</td></tr><tr><td><strong>色调风格</strong></td><td>特定色彩倾向</td><td>复古、暖色、冷色</td></tr><tr><td><strong>卷积滤镜</strong></td><td>使用周围像素</td><td>模糊、锐化、边缘检测</td></tr><tr><td><strong>空间变换</strong></td><td>改变像素位置</td><td>扭曲、瘦脸</td></tr></tbody></table>
<h3 data-id="heading-5">2. 常见滤镜实现</h3>
<h4 data-id="heading-6">2.1 灰度滤镜</h4>
<p><strong>原理</strong>：将 RGB 转换为单一亮度值。</p>
<p><strong>加权平均公式</strong>（符合人眼对颜色的敏感度）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Gray</span> = <span class="hljs-number">0.299</span> × R + <span class="hljs-number">0.587</span> × G + <span class="hljs-number">0.114</span> × B
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 grayscale(vec4 color) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    return vec4(vec3(gray), color.a);
}
</code></pre>
<p><strong>简化版</strong>（性能更高）：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 grayscale(vec4 color) {
    float gray = (color.r + color.g + color.b) / 3.0;
    return vec4(vec3(gray), color.a);
}
</code></pre>
<h4 data-id="heading-7">2.2 反色滤镜</h4>
<p><strong>原理</strong>：每个颜色分量用 1.0 减去原值。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 invert(vec4 color) {
    return vec4(1.0 - color.rgb, color.a);
}
</code></pre>
<h4 data-id="heading-8">2.3 亮度调整</h4>
<p><strong>原理</strong>：所有颜色分量加上/减去同一个值。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uBrightness;  // -1.0 到 1.0

vec4 brightness(vec4 color, float value) {
    return vec4(color.rgb + value, color.a);
}
</code></pre>
<h4 data-id="heading-9">2.4 对比度调整</h4>
<p><strong>原理</strong>：拉伸或压缩颜色值的范围。</p>
<p><strong>公式</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">newColor</span> = (color - <span class="hljs-number">0.5</span>) × contrast + <span class="hljs-number">0.5</span>
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uContrast;  // 0.0 到 2.0

vec4 contrast(vec4 color, float value) {
    return vec4((color.rgb - 0.5) * value + 0.5, color.a);
}
</code></pre>
<h4 data-id="heading-10">2.5 饱和度调整</h4>
<p><strong>原理</strong>：在灰度和原色之间插值。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uSaturation;  // 0.0 到 2.0

vec4 saturation(vec4 color, float value) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    vec3 result = mix(vec3(gray), color.rgb, value);
    return vec4(result, color.a);
}
</code></pre>
<h4 data-id="heading-11">2.6 暖色调滤镜</h4>
<p><strong>原理</strong>：增加红色和黄色，营造温暖感觉。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 warm(vec4 color) {
    color.r = color.r + 0.1;  // 增加红色
    color.g = color.g + 0.05; // 微增绿色（产生黄色）
    return clamp(color, 0.0, 1.0);
}
</code></pre>
<h4 data-id="heading-12">2.7 冷色调滤镜</h4>
<p><strong>原理</strong>：增加蓝色，营造清冷感觉。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 cool(vec4 color) {
    color.b = color.b + 0.1;  // 增加蓝色
    return clamp(color, 0.0, 1.0);
}
</code></pre>
<h4 data-id="heading-13">2.8 复古滤镜</h4>
<p><strong>原理</strong>：降低饱和度 + 增加棕褐色调。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 sepia(vec4 color) {
    float r = color.r * 0.393 + color.g * 0.769 + color.b * 0.189;
    float g = color.r * 0.349 + color.g * 0.686 + color.b * 0.168;
    float b = color.r * 0.272 + color.g * 0.534 + color.b * 0.131;
    return vec4(r, g, b, color.a);
}
</code></pre>
<h3 data-id="heading-14">3. 色彩空间转换</h3>
<h4 data-id="heading-15">3.1 RGB vs HSV</h4>




















<table><thead><tr><th>色彩空间</th><th>组成</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>RGB</strong></td><td>Red, Green, Blue</td><td>显示、存储</td></tr><tr><td><strong>HSV</strong></td><td>Hue, Saturation, Value</td><td>色彩调整</td></tr></tbody></table>
<p><strong>HSV 的优势</strong>：</p>
<ul>
<li><strong>Hue（色相）</strong>：调整整体色调（0-360°）</li>
<li><strong>Saturation（饱和度）</strong>：调整颜色鲜艳程度（0-1）</li>
<li><strong>Value（明度）</strong>：调整亮度（0-1）</li>
</ul>
<h4 data-id="heading-16">3.2 RGB 转 HSV</h4>
<pre><code class="hljs language-glsl" lang="glsl">vec3 rgb2hsv(vec3 c) {
    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

    float d = q.x - min(q.w, q.y);
    float e = 1.0e-10;
    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}
</code></pre>
<h4 data-id="heading-17">3.3 HSV 转 RGB</h4>
<pre><code class="hljs language-glsl" lang="glsl">vec3 hsv2rgb(vec3 c) {
    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
</code></pre>
<h4 data-id="heading-18">3.4 色相偏移滤镜</h4>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uHueShift;  // 0.0 到 1.0

vec4 hueShift(vec4 color, float shift) {
    vec3 hsv = rgb2hsv(color.rgb);
    hsv.x = fract(hsv.x + shift);  // 循环色相
    vec3 rgb = hsv2rgb(hsv);
    return vec4(rgb, color.a);
}
</code></pre>
<h3 data-id="heading-19">4. 卷积滤镜</h3>
<h4 data-id="heading-20">4.1 什么是卷积？</h4>
<p>卷积使用周围像素来计算当前像素的值。</p>
<p><strong>3×3 卷积核示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">┌─────┬─────┬─────┐</span>
<span class="hljs-string">│</span> <span class="hljs-string">TL</span>  <span class="hljs-string">│</span> <span class="hljs-string">TM</span>  <span class="hljs-string">│</span> <span class="hljs-string">TR</span>  <span class="hljs-string">│</span>  <span class="hljs-attr">TL:</span> <span class="hljs-string">Top</span> <span class="hljs-string">Left,</span> <span class="hljs-attr">TM:</span> <span class="hljs-string">Top</span> <span class="hljs-string">Middle,</span> <span class="hljs-attr">TR:</span> <span class="hljs-string">Top</span> <span class="hljs-string">Right</span>
<span class="hljs-string">├─────┼─────┼─────┤</span>
<span class="hljs-string">│</span> <span class="hljs-string">ML</span>  <span class="hljs-string">│</span> <span class="hljs-string">MC</span>  <span class="hljs-string">│</span> <span class="hljs-string">MR</span>  <span class="hljs-string">│</span>  <span class="hljs-attr">ML:</span> <span class="hljs-string">Middle</span> <span class="hljs-string">Left,</span> <span class="hljs-attr">MC:</span> <span class="hljs-string">Middle</span> <span class="hljs-string">Center,</span> <span class="hljs-attr">MR:</span> <span class="hljs-string">Middle</span> <span class="hljs-string">Right</span>
<span class="hljs-string">├─────┼─────┼─────┤</span>
<span class="hljs-string">│</span> <span class="hljs-string">BL</span>  <span class="hljs-string">│</span> <span class="hljs-string">BM</span>  <span class="hljs-string">│</span> <span class="hljs-string">BR</span>  <span class="hljs-string">│</span>  <span class="hljs-attr">BL:</span> <span class="hljs-string">Bottom</span> <span class="hljs-string">Left,</span> <span class="hljs-attr">BM:</span> <span class="hljs-string">Bottom</span> <span class="hljs-string">Middle,</span> <span class="hljs-attr">BR:</span> <span class="hljs-string">Bottom</span> <span class="hljs-string">Right</span>
<span class="hljs-string">└─────┴─────┴─────┘</span>
</code></pre>
<h4 data-id="heading-21">4.2 模糊滤镜（均值滤波）</h4>
<p><strong>卷积核</strong>（所有权重相等）：</p>
<pre><code class="hljs">┌─────┬─────┬─────┐
│ 1/9 │ 1/9 │ 1/9 │
├─────┼─────┼─────┤
│ 1/9 │ 1/9 │ 1/9 │
├─────┼─────┼─────┤
│ 1/9 │ 1/9 │ 1/9 │
└─────┴─────┴─────┘
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform vec2 uTexelSize;  // vec2(1.0/width, 1.0/height)

vec4 blur(sampler2D texture, vec2 texCoord) {
    vec4 sum = vec4(0.0);
    for (float x = -1.0; x &lt;= 1.0; x += 1.0) {
        for (float y = -1.0; y &lt;= 1.0; y += 1.0) {
            vec2 offset = vec2(x, y) * uTexelSize;
            sum += texture2D(texture, texCoord + offset);
        }
    }
    return sum / 9.0;
}
</code></pre>
<h4 data-id="heading-22">4.3 锐化滤镜</h4>
<p><strong>卷积核</strong>：</p>
<pre><code class="hljs">┌─────┬─────┬─────┐
│  0  │ -1  │  0  │
├─────┼─────┼─────┤
│ -1  │  5  │ -1  │
├─────┼─────┼─────┤
│  0  │ -1  │  0  │
└─────┴─────┴─────┘
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 sharpen(sampler2D texture, vec2 texCoord, vec2 texelSize) {
    vec4 center = texture2D(texture, texCoord);
    vec4 top    = texture2D(texture, texCoord + vec2(0.0, texelSize.y));
    vec4 bottom = texture2D(texture, texCoord - vec2(0.0, texelSize.y));
    vec4 left   = texture2D(texture, texCoord - vec2(texelSize.x, 0.0));
    vec4 right  = texture2D(texture, texCoord + vec2(texelSize.x, 0.0));
    
    return center * 5.0 - top - bottom - left - right;
}
</code></pre>
<h3 data-id="heading-23">5. 综合滤镜着色器</h3>
<pre><code class="hljs language-glsl" lang="glsl">#extension GL_OES_EGL_image_external : require
precision mediump float;

varying vec2 vTexCoord;
uniform samplerExternalOES uTexture;
uniform int uFilterType;
uniform vec2 uTexelSize;

// 滤镜参数
uniform float uIntensity;  // 滤镜强度 0.0 - 1.0

// RGB 转 HSV
vec3 rgb2hsv(vec3 c) {
    // ... 实现代码 ...
}

// HSV 转 RGB
vec3 hsv2rgb(vec3 c) {
    // ... 实现代码 ...
}

// 灰度滤镜
vec4 grayscale(vec4 color) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    return vec4(vec3(gray), color.a);
}

// 复古滤镜
vec4 sepia(vec4 color) {
    float r = color.r * 0.393 + color.g * 0.769 + color.b * 0.189;
    float g = color.r * 0.349 + color.g * 0.686 + color.b * 0.168;
    float b = color.r * 0.272 + color.g * 0.534 + color.b * 0.131;
    return vec4(r, g, b, color.a);
}

// 暖色调滤镜
vec4 warm(vec4 color) {
    color.r = min(color.r + 0.1, 1.0);
    color.g = min(color.g + 0.05, 1.0);
    return color;
}

// 冷色调滤镜
vec4 cool(vec4 color) {
    color.b = min(color.b + 0.1, 1.0);
    return color;
}

// 反色滤镜
vec4 invert(vec4 color) {
    return vec4(1.0 - color.rgb, color.a);
}

// 黑白滤镜（高对比度）
vec4 blackWhite(vec4 color) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    float bw = step(0.5, gray);  // 阈值 0.5
    return vec4(vec3(bw), color.a);
}

void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec4 filtered;
    
    if (uFilterType == 0) {
        // 原图
        filtered = color;
    } else if (uFilterType == 1) {
        // 灰度
        filtered = grayscale(color);
    } else if (uFilterType == 2) {
        // 复古
        filtered = sepia(color);
    } else if (uFilterType == 3) {
        // 暖色调
        filtered = warm(color);
    } else if (uFilterType == 4) {
        // 冷色调
        filtered = cool(color);
    } else if (uFilterType == 5) {
        // 反色
        filtered = invert(color);
    } else if (uFilterType == 6) {
        // 黑白
        filtered = blackWhite(color);
    } else {
        filtered = color;
    }
    
    // 应用滤镜强度（原图和滤镜效果的混合）
    gl_FragColor = mix(color, filtered, uIntensity);
}
</code></pre>
<h3 data-id="heading-24">6. 滤镜参数调节</h3>
<h4 data-id="heading-25">6.1 滤镜强度</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用 SeekBar 调节滤镜强度</span>
seekBarIntensity.setOnSeekBarChangeListener(<span class="hljs-keyword">object</span> : SeekBar.OnSeekBarChangeListener {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onProgressChanged</span><span class="hljs-params">(seekBar: <span class="hljs-type">SeekBar</span>?, progress: <span class="hljs-type">Int</span>, fromUser: <span class="hljs-type">Boolean</span>)</span></span> {
        <span class="hljs-keyword">val</span> intensity = progress / <span class="hljs-number">100.0f</span>
        glSurfaceView.queueEvent {
            renderer.setFilterIntensity(intensity)
        }
    }
})
</code></pre>
<h4 data-id="heading-26">6.2 Renderer 中的参数传递</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day11Renderer</span> : <span class="hljs-type">GLSurfaceView.Renderer</span> {
    
    <span class="hljs-meta">@Volatile</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterType: FilterType = FilterType.NONE
    
    <span class="hljs-meta">@Volatile</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterIntensity: <span class="hljs-built_in">Float</span> = <span class="hljs-number">1.0f</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// ... 其他代码 ...</span>
        
        <span class="hljs-comment">// 传递滤镜参数</span>
        GLES20.glUniform1i(uFilterTypeLocation, filterType.ordinal)
        GLES20.glUniform1f(uIntensityLocation, filterIntensity)
        
        <span class="hljs-comment">// 绘制</span>
        drawQuad()
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setFilterType</span><span class="hljs-params">(type: <span class="hljs-type">FilterType</span>)</span></span> {
        filterType = type
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setFilterIntensity</span><span class="hljs-params">(intensity: <span class="hljs-type">Float</span>)</span></span> {
        filterIntensity = intensity.coerceIn(<span class="hljs-number">0f</span>, <span class="hljs-number">1f</span>)
    }
}
</code></pre>
<h3 data-id="heading-27">7. 性能优化</h3>
<h4 data-id="heading-28">7.1 避免复杂计算</h4>
<pre><code class="hljs language-glsl" lang="glsl">// ❌ 不好：每次都计算
vec4 color = texture2D(uTexture, vTexCoord);
float gray = color.r * 0.299 + color.g * 0.587 + color.b * 0.114;

// ✅ 好：使用内置函数
float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
</code></pre>
<h4 data-id="heading-29">7.2 减少分支</h4>
<pre><code class="hljs language-glsl" lang="glsl">// ❌ 不好：大量 if-else
if (type == 0) { ... }
else if (type == 1) { ... }
else if (type == 2) { ... }
// ... 很多分支

// ✅ 好：使用不同的着色器程序
// 每种滤镜使用独立的着色器，避免分支
</code></pre>
<h4 data-id="heading-30">7.3 降低采样次数</h4>
<pre><code class="hljs language-glsl" lang="glsl">// 对于模糊等需要多次采样的滤镜
// 可以先降低分辨率，再放大
</code></pre>
<h3 data-id="heading-31">8. 实用技巧</h3>
<h4 data-id="heading-32">8.1 滤镜预设</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterPreset</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> type: FilterType,
    <span class="hljs-keyword">val</span> intensity: <span class="hljs-built_in">Float</span> = <span class="hljs-number">1.0f</span>,
    <span class="hljs-keyword">val</span> params: Map&lt;String, <span class="hljs-built_in">Float</span>&gt; = emptyMap()
)

<span class="hljs-keyword">val</span> presets = listOf(
    FilterPreset(<span class="hljs-string">"原图"</span>, FilterType.NONE),
    FilterPreset(<span class="hljs-string">"黑白"</span>, FilterType.GRAYSCALE, <span class="hljs-number">1.0f</span>),
    FilterPreset(<span class="hljs-string">"淡雅"</span>, FilterType.GRAYSCALE, <span class="hljs-number">0.5f</span>),
    FilterPreset(<span class="hljs-string">"复古"</span>, FilterType.SEPIA, <span class="hljs-number">0.8f</span>),
    FilterPreset(<span class="hljs-string">"暖阳"</span>, FilterType.WARM, <span class="hljs-number">1.0f</span>),
    FilterPreset(<span class="hljs-string">"冰雪"</span>, FilterType.COOL, <span class="hljs-number">1.0f</span>)
)
</code></pre>
<h4 data-id="heading-33">8.2 滤镜组合</h4>
<pre><code class="hljs language-glsl" lang="glsl">// 先应用灰度，再应用对比度
vec4 color = texture2D(uTexture, vTexCoord);
color = grayscale(color);
color = contrast(color, 1.5);
gl_FragColor = color;
</code></pre>
<h4 data-id="heading-34">8.3 实时预览优化</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用低分辨率预览</span>
<span class="hljs-keyword">val</span> preview = Preview.Builder()
    .setTargetResolution(Size(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>))  <span class="hljs-comment">// 降低分辨率</span>
    .build()
</code></pre>
<h2 data-id="heading-35">💻 代码实践</h2>
<h3 data-id="heading-36">今日任务</h3>
<p>实现实时滤镜相机应用：</p>
<ol>
<li><strong>集成 Day10 的相机预览功能</strong></li>
<li><strong>实现 7 种滤镜效果</strong>：
<ul>
<li>原图</li>
<li>灰度</li>
<li>复古</li>
<li>暖色调</li>
<li>冷色调</li>
<li>反色</li>
<li>黑白</li>
</ul>
</li>
<li><strong>添加滤镜强度调节</strong></li>
<li><strong>支持滤镜实时切换</strong></li>
</ol>
<h3 data-id="heading-37">实现效果</h3>
<ul>
<li>📹 实时相机预览</li>
<li>🎨 7 种滤镜效果</li>
<li>🎚️ 滤镜强度调节（SeekBar）</li>
<li>🔄 实时切换无卡顿</li>
<li>📸 支持拍照保存</li>
</ul>
<h3 data-id="heading-38">核心代码结构</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day11Renderer</span>(glSurfaceView: GLSurfaceView) : GLSurfaceView.Renderer {

    <span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterType</span> {
        NONE,       <span class="hljs-comment">// 原图</span>
        GRAYSCALE,  <span class="hljs-comment">// 灰度</span>
        SEPIA,      <span class="hljs-comment">// 复古</span>
        WARM,       <span class="hljs-comment">// 暖色调</span>
        COOL,       <span class="hljs-comment">// 冷色调</span>
        INVERT,     <span class="hljs-comment">// 反色</span>
        BLACK_WHITE <span class="hljs-comment">// 黑白</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterType: FilterType = FilterType.NONE
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterIntensity: <span class="hljs-built_in">Float</span> = <span class="hljs-number">1.0f</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// 更新纹理</span>
        surfaceTexture.updateTexImage()
        
        <span class="hljs-comment">// 传递滤镜参数</span>
        GLES20.glUniform1i(uFilterTypeLocation, filterType.ordinal)
        GLES20.glUniform1f(uIntensityLocation, filterIntensity)
        
        <span class="hljs-comment">// 绘制</span>
        drawQuad()
    }
}
</code></pre>
<h2 data-id="heading-39">🧪 练习任务</h2>
<h3 data-id="heading-40">基础任务</h3>
<ol>
<li>✅ 实现至少 5 种滤镜效果</li>
<li>✅ 添加滤镜强度调节</li>
<li>✅ 支持实时切换</li>
</ol>
<h3 data-id="heading-41">进阶任务</h3>
<ol>
<li>🎨 实现自定义滤镜（调节色相、饱和度、亮度）</li>
<li>💾 保存当前滤镜效果的照片</li>
<li>🖼️ 添加滤镜预览缩略图</li>
<li>📊 显示当前滤镜名称和参数</li>
</ol>
<h3 data-id="heading-42">挑战任务</h3>
<ol>
<li>🎬 实现 LUT（Look-Up Table）滤镜</li>
<li>🌈 实现多重滤镜叠加</li>
<li>🎭 实现局部滤镜（只对部分区域应用）</li>
<li>📈 性能监控（FPS、帧耗时）</li>
</ol>
<h2 data-id="heading-43">📖 知识点总结</h2>
<h3 data-id="heading-44">滤镜分类</h3>



































<table><thead><tr><th>类型</th><th>原理</th><th>性能</th><th>示例</th></tr></thead><tbody><tr><td><strong>颜色调整</strong></td><td>修改像素 RGB 值</td><td>高</td><td>灰度、反色</td></tr><tr><td><strong>色调风格</strong></td><td>特定色彩变换</td><td>高</td><td>复古、暖色</td></tr><tr><td><strong>卷积滤镜</strong></td><td>使用周围像素</td><td>低</td><td>模糊、锐化</td></tr><tr><td><strong>空间变换</strong></td><td>改变像素位置</td><td>中</td><td>扭曲、旋转</td></tr></tbody></table>
<h3 data-id="heading-45">GLSL 常用函数</h3>



































<table><thead><tr><th>函数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>dot(v1, v2)</code></td><td>点积</td><td><code>dot(color.rgb, vec3(0.299, 0.587, 0.114))</code></td></tr><tr><td><code>mix(x, y, a)</code></td><td>线性插值</td><td><code>mix(original, filtered, intensity)</code></td></tr><tr><td><code>clamp(x, min, max)</code></td><td>限制范围</td><td><code>clamp(color, 0.0, 1.0)</code></td></tr><tr><td><code>step(edge, x)</code></td><td>阶跃函数</td><td><code>step(0.5, gray)</code></td></tr><tr><td><code>smoothstep(e0, e1, x)</code></td><td>平滑阶跃</td><td><code>smoothstep(0.4, 0.6, gray)</code></td></tr></tbody></table>
<h3 data-id="heading-46">最佳实践</h3>
<ol>
<li>✅ <strong>使用内置函数</strong>：性能更好</li>
<li>✅ <strong>避免过多分支</strong>：影响 GPU 性能</li>
<li>✅ <strong>参数可调节</strong>：提供更好的用户体验</li>
<li>✅ <strong>提供强度控制</strong>：允许部分应用滤镜</li>
<li>✅ <strong>预设滤镜</strong>：方便用户快速选择</li>
</ol>
<h2 data-id="heading-47">🔗 参考资料</h2>
<h3 data-id="heading-48">滤镜算法</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdanielamitay%2FInstagram-Filters" target="_blank" title="https://github.com/danielamitay/Instagram-Filters" ref="nofollow noopener noreferrer">Instagram Filters</a> - Instagram 滤镜算法</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcats-oss%2Fandroid-gpuimage" target="_blank" title="https://github.com/cats-oss/android-gpuimage" ref="nofollow noopener noreferrer">GPUImage</a> - 开源滤镜库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.colormatters.com%2Fcolor-and-design%2Fbasic-color-theory" target="_blank" title="https://www.colormatters.com/color-and-design/basic-color-theory" ref="nofollow noopener noreferrer">Color Theory</a> - 色彩理论</li>
</ul>
<h3 data-id="heading-49">GLSL 资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthebookofshaders.com%2F" target="_blank" title="https://thebookofshaders.com/" ref="nofollow noopener noreferrer">The Book of Shaders</a> - GLSL 教程</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.shadertoy.com%2F" target="_blank" title="https://www.shadertoy.com/" ref="nofollow noopener noreferrer">Shadertoy</a> - GLSL 示例库</li>
</ul>
<h2 data-id="heading-50">📝 今日总结</h2>
<p>今天我们学习了实时滤镜效果：</p>
<ol>
<li>✅ 理解了滤镜的基本原理：修改像素颜色值</li>
<li>✅ 掌握了 7 种常见滤镜的实现</li>
<li>✅ 学习了色彩空间转换（RGB ↔ HSV）</li>
<li>✅ 实现了滤镜强度调节机制</li>
<li>✅ 了解了性能优化技巧</li>
</ol>
<p><strong>关键要点</strong>：</p>
<ul>
<li>滤镜本质是片段着色器中的颜色变换</li>
<li>使用内置函数提高性能</li>
<li>滤镜强度通过 mix() 控制</li>
<li>卷积滤镜需要多次采样，性能较低</li>
</ul>
<p><a href="https://juejin.cn/spost/7591322050240331814" target="_blank" title="https://juejin.cn/spost/7591322050240331814">下一篇：# 『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[react fiber与事件循环]]></title>    <link>https://juejin.cn/post/7591104893392240694</link>    <guid>https://juejin.cn/post/7591104893392240694</guid>    <pubDate>2026-01-04T10:35:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591104893392240694" data-draft-id="7591129807756083263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="react fiber与事件循环"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-04T10:35:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="time_rg"/> <meta itemprop="url" content="https://juejin.cn/user/817692383646286"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            react fiber与事件循环
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692383646286/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    time_rg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:35:05.000Z" title="Sun Jan 04 2026 10:35:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">react fiber与事件循环</h2>
<blockquote>
<p>在学习react fiber与事件循环的过程中，我一直有这么一个困扰，那就是单独学习的时候，我好像都理解，但是我的脑袋里面没有一条清晰的时间线，到底react的任务从浏览器的视角来看到底是怎么执行，怎么渲染的，为此，我专门将react fiber与浏览器的事件循环放在一起进行学习，希望能够得到更清晰的学习结论。阅读本文，默认对事件循环和react fiber架构有一定了解。</p>
</blockquote>
<h3 data-id="heading-1">事件循环</h3>
<ul>
<li>什么是浏览器的事件循环机制？</li>
</ul>
<p>浏览器的事件循环是一套“协调机制”，用来在单线程的 JavaScript 环境中，合理安排同步代码、异步任务和页面渲染的执行顺序。</p>
<ul>
<li>为什么要有事件循环机制</li>
</ul>
<p>js是单线程的（根本原因），但是它需要处理很多事情。</p>
<ol>
<li>主线程的代码</li>
<li>处理dom</li>
<li>页面渲染</li>
<li>相应用户事件</li>
</ol>
<p>很显然这些事情是需要一个”排队“的机制。</p>
<p>还有一些异步操作的存在：</p>
<ol>
<li>setTimeout</li>
<li>网络请求</li>
<li>DOM 事件</li>
<li>Promise</li>
</ol>
<p>这些任务并不是js引擎去执行，而是web API,执行完后通知js的主线程，js再去处理这些回调。</p>
<p>结论：我们需要一套机制去处理上面所说的排队，去处理这些异步操作回调执行的时机。这就是事件循环。</p>
<p>那关于具体的事件循环的学习本文不涉及，这里只给出结论</p>
<blockquote>
<p>一次事件循环 = 执行一个宏任务 → 清空所有微任务 → 进行页面渲染（可能）</p>
<ol>
<li>先执行 <strong>一个宏任务</strong></li>
<li>然后 <strong>执行所有微任务</strong></li>
<li>然后浏览器 <strong>可能进行一次渲染</strong></li>
<li>再进入下一轮循环</li>
</ol>
</blockquote>
<h3 data-id="heading-2">React fiber策略</h3>
<ul>
<li>什么是react fiber</li>
</ul>
<p>简单来说，其实是 React 为了实现 <strong>可中断、可调度、可增量的渲染</strong> 所设计的内部机制。</p>
<p>我们来看一个简单的例子：</p>
<pre><code class="hljs language-css" lang="css">const elementTree = {
    type: <span class="hljs-string">"div"</span>,
    props:{
        children: [
            {
                type: <span class="hljs-string">"span"</span>,
                key: <span class="hljs-string">"span-a"</span>
                props: {
                    children: [
                        {
                            type: <span class="hljs-string">"TEXT_ELEMENT"</span>,
                            props: {
                              nodeValue: <span class="hljs-string">"aaaaa"</span>,
                              children: [],
                            },
                        }
                    ]
                }
            },
            {
                type: <span class="hljs-string">"span"</span>,
                key: <span class="hljs-string">"span-b"</span>
                props: {
                    children: [
                        {
                            type: <span class="hljs-string">"TEXT_ELEMENT"</span>,
                            props: {
                              nodeValue: <span class="hljs-string">"bbbbb"</span>,
                              children: [],
                            },
                        }
                    ]
                }
            }
        ]
    }
}
</code></pre>
<p>这是对应的fiber的链表图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc187e8b91fc44d7a257a8698daaf08d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGltZV9yZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768127705&amp;x-signature=vCzYorivTHgaf9yztBTvzFOC69I%3D" alt="image.png" loading="lazy"/>
fiber采用深度优先遍历，对每一个fiber节点都采用浏览器空闲时间进行计算，直到整棵树都计算完成，最后才提交渲染。</p>
<h3 data-id="heading-3">问题？</h3>
<ol>
<li>所谓的可中断，空闲时间，到底是指的浏览器事件循环的什么阶段</li>
<li>fiber的计算，是在什么时候</li>
</ol>
<h3 data-id="heading-4">一条完整时间线：React Fiber × 浏览器</h3>
<h4 data-id="heading-5">场景：用户点击按钮 → React 更新 UI</h4>
<hr/>
<h4 data-id="heading-6">🟦 阶段 1：浏览器的事</h4>
<p><code> 点击事件发生  `` ↓  `` 事件系统  `` ↓  ``宏任务（onClick）</code></p>
<hr/>
<h4 data-id="heading-7">🟩 阶段 2：React 开始工作（JS 阶段）</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">onClick</span>() {
  <span class="hljs-built_in">setState</span>(...)
}
</code></pre>
<p>React 做了什么：</p>
<ol>
<li><strong>不改</strong> <strong>DOM</strong></li>
<li>创建 Update</li>
<li>把 Update 挂到 Fiber</li>
<li>标记优先级（Lane）</li>
<li>请求调度（scheduleUpdateOnFiber）</li>
</ol>
<p>👉 <strong>React</strong> <strong>此时仍然完全在</strong> <strong>JS</strong> <strong>世界</strong></p>
<hr/>
<h4 data-id="heading-8">🟨 阶段 3：Fiber Render 阶段（可中断）</h4>
<p>React 在做：</p>
<ul>
<li>构建新的 Fiber Tree</li>
<li>Diff（Reconciliation）</li>
<li>计算 effect list</li>
</ul>
<p>⚠️ 这个阶段：</p>
<ul>
<li><strong>不触碰</strong> <strong>DOM</strong></li>
<li><strong>可以被中断</strong></li>
<li><strong>可能跨多帧</strong></li>
</ul>
<hr/>
<h4 data-id="heading-9">🟥 阶段 4：Commit 阶段（不可中断）</h4>
<p>React 选择一个安全时机（通常靠近帧边界）：</p>
<ol>
<li>执行 DOM 操作</li>
<li>执行 layout effects</li>
<li>更新 refs</li>
</ol>
<p>👉 <strong>这一刻，</strong> <strong>React</strong> <strong>才真正影响浏览器渲染</strong></p>
<hr/>
<h4 data-id="heading-10">🟪 阶段 5：浏览器渲染</h4>
<p><code> rAF（浏览器）  ``↓</code> <code>Style</code> <code>↓</code> <code>Layout</code> <code>↓</code> <code>Paint</code> <code>↓</code> <code>Composite</code></p>
<hr/>
<h3 data-id="heading-11">React 和浏览器的分工一句话总结</h3>
<blockquote>
<p><strong>React</strong> <strong>决定“改什么”和“什么时候可以改”，</strong> <strong>浏览器决定“什么时候画”和“怎么画”。</strong></p>
</blockquote>
<h3 data-id="heading-12">React fiber实现的核心api</h3>
<ol>
<li><strong>MessageChannel</strong>：推进计算，立即排队下一个宏任务</li>
<li><strong>requestAnimationFrame</strong>：Commit 阶段对齐浏览器帧</li>
</ol>
<h3 data-id="heading-13">Fiber 调度的最后一部分</h3>
<h4 data-id="heading-14">MessageChannel 如何推进各个工作单元</h4>
<p>在 React Fiber 中，整个组件树的更新被拆分成<strong>一个个 Fiber 单元</strong>（unit of work）。每个单元负责：</p>
<ul>
<li>构建 Fiber 节点</li>
<li>进行 Diff 对比</li>
<li>计算 effect list</li>
</ul>
<p><strong>为什么 MessageChannel 被使用？</strong></p>
<ul>
<li>Fiber 的 Render 阶段是可中断的，需要<strong>在主线程空闲时继续推进任务</strong>。</li>
<li>MessageChannel 可以<strong>立即排队一个宏任务</strong>，在当前宏任务执行完成后尽快执行下一轮 Fiber 计算。</li>
<li>这意味着，React 不会一次性阻塞主线程去渲染整个组件树，而是<strong>切片执行，每次执行一小部分 Fiber 单元</strong>。</li>
</ul>
<p><strong>MessageChannel 任务所在队列：</strong></p>
<ul>
<li>MessageChannel 的 <code>onmessage</code> 回调属于<strong>宏任务队列</strong>。</li>
<li>宏任务执行完成后，微任务队列会被清空，然后浏览器判断是否渲染。</li>
<li>因此 Fiber 的 Render 阶段是<strong>宏任务中逐片推进的</strong>。</li>
</ul>
<hr/>
<h4 data-id="heading-15">requestAnimationFrame 的使用时机</h4>
<ul>
<li>
<p><strong>作用</strong>：与浏览器渲染帧同步，保证 Commit 阶段操作 DOM 时不掉帧。</p>
</li>
<li>
<p><strong>使用时机</strong>：</p>
<ul>
<li>当 Fiber Render 阶段完成或达到时间片限制时，Scheduler 会判断是否需要提交 DOM。</li>
<li>Commit 阶段执行前，如果希望<strong>和浏览器下一帧对齐</strong>，就会通过 <code>requestAnimationFrame</code> 调用 Commit 阶段回调。</li>
</ul>
</li>
<li>
<p><strong>为什么要使用 rAF</strong>：</p>
<ul>
<li>避免直接提交 DOM 时阻塞渲染</li>
<li>保证渲染和浏览器帧同步，提高 UI 流畅度</li>
<li>避免计算阶段占用过长时间造成掉帧</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-16">结合事件循环的完整执行流程</h4>
<p>以一次用户点击触发更新为例：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd110e8b7e8e473fa53f3ae01cba73e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGltZV9yZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768127705&amp;x-signature=czDU2w1l%2Bi76hOMqUOaGltBeoHg%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>从上图我们可以简单的看出，react fiber的计算过程跨越了多次的事件循环，是否可中断的判断放在每一次的工作单元进行判断。且工作单元（nextUnitOfWork）的计算是放在宏任务中</p>
</blockquote>
<p><strong>总结：</strong></p>
<ol>
<li>
<p><strong>MessageChannel 推进 Fiber 工作单元</strong>：</p>
<ol>
<li>在宏任务队列中运行</li>
<li>逐片执行 Render 阶段</li>
<li>可以中断，分片执行以保证主线程空闲</li>
</ol>
</li>
<li>
<p><strong>requestAnimationFrame 使用</strong>：</p>
<ol>
<li>对齐 Commit 阶段和浏览器渲染帧</li>
<li>避免掉帧，提高 UI 流畅度</li>
</ol>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）]]></title>    <link>https://juejin.cn/post/7591322050240331814</link>    <guid>https://juejin.cn/post/7591322050240331814</guid>    <pubDate>2026-01-04T10:46:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591322050240331814" data-draft-id="7591338980693196846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）"/> <meta itemprop="keywords" content="Android,OpenGL"/> <meta itemprop="datePublished" content="2026-01-04T10:46:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="下位子"/> <meta itemprop="url" content="https://juejin.cn/user/2313028193761389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028193761389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    下位子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:46:24.000Z" title="Sun Jan 04 2026 10:46:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://juejin.cn/post/7567889397497528383" target="_blank" title="https://juejin.cn/post/7567889397497528383">前言: 『OpenGL学习』 从零打造 Android 滤镜相机</a></p>
<p><a href="https://juejin.cn/post/7591338980693393454" target="_blank" title="https://juejin.cn/post/7591338980693393454">上一篇:『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果</a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest" target="_blank" title="https://github.com/xiaweizi/OpenGLTest" ref="nofollow noopener noreferrer">OpenGLTest</a></p>
</blockquote>
<h2 data-id="heading-0">📚 今日目标</h2>
<ul>
<li>理解 LUT（查找表）的工作原理</li>
<li>掌握 3D LUT 的使用方法</li>
<li>实现专业级调色滤镜</li>
<li>学习 LUT 资源加载和管理</li>
<li>支持多种 LUT 滤镜快速切换</li>
</ul>
<h2 data-id="heading-1">运行效果</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/358554c68bd8432398897f6931ad2c46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128384&amp;x-signature=UQuQP4iYbQdl5ogtzQFiAUhUsc8%3D" alt="Day12.gif" loading="lazy"/></p>
<h2 data-id="heading-2">🎯 学习内容</h2>
<h3 data-id="heading-3">1. LUT 简介</h3>
<p><strong>LUT（Look-Up Table，查找表）</strong> 是一种高效的颜色映射技术，广泛应用于专业调色和滤镜效果。</p>
<h4 data-id="heading-4">什么是 LUT？</h4>
<p>LUT 本质是一个<strong>颜色映射表</strong>：</p>
<pre><code class="hljs language-python" lang="python">输入颜色 (R, G, B) → LUT 查找 → 输出颜色 (<span class="hljs-string">R', G'</span>, <span class="hljs-string">B')
</span></code></pre>
<p>如下图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/956873e1e4244cae9c37337c835eee62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128384&amp;x-signature=%2FdpOqs9LYH41Y1oRXW9Gc8%2Fo3p4%3D" alt="res_baby_2.png" loading="lazy"/></p>
<p><strong>类比</strong>：</p>
<ul>
<li>字典：输入单词 → 查找 → 输出释义</li>
<li>LUT：输入颜色 → 查找 → 输出新颜色</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fe329929fec4922bd4eaa6591148f56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128384&amp;x-signature=HcVBrnyHbWR8W7b2xty1%2Bnxiogw%3D" alt="Day12.gif" loading="lazy"/></p>
<h4 data-id="heading-5">LUT 的优势</h4>



































<table><thead><tr><th>特性</th><th>LUT 滤镜</th><th>传统滤镜</th></tr></thead><tbody><tr><td><strong>复杂度</strong></td><td>任意复杂</td><td>受算法限制</td></tr><tr><td><strong>性能</strong></td><td>极快（一次采样）</td><td>可能很慢</td></tr><tr><td><strong>调色精度</strong></td><td>专业级</td><td>有限</td></tr><tr><td><strong>制作方式</strong></td><td>Photoshop/Lightroom</td><td>手写代码</td></tr><tr><td><strong>灵活性</strong></td><td>可随意替换</td><td>需修改代码</td></tr></tbody></table>
<h3 data-id="heading-6">2. 3D LUT 原理</h3>
<h4 data-id="heading-7">2.1 颜色立方体</h4>
<p>RGB 颜色空间是一个<strong>立方体</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">        <span class="hljs-selector-tag">B</span> (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)
       /|
      / |
     /  |
(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)─────&gt; R (<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)
    |  /
    | /
    |/
    G (<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)
</code></pre>
<p><strong>3D LUT</strong> 是这个颜色立方体的<strong>离散化采样</strong>：</p>
<ul>
<li>8×8×8 = 512 种颜色</li>
<li>16×16×16 = 4,096 种颜色</li>
<li><strong>64×64×64 = 262,144 种颜色</strong> ← 常用</li>
</ul>
<h4 data-id="heading-8">2.2 LUT 图片格式</h4>
<p>标准的 64×64×64 LUT 存储为 <strong>512×512</strong> 的 2D 图片：</p>
<pre><code class="hljs">┌────────────────────────────────┐
│ 64x64 │ 64x64 │ 64x64 │ ... x8 │  ← 蓝色 = 0
├────────────────────────────────┤
│ 64x64 │ 64x64 │ 64x64 │ ... x8 │  ← 蓝色 = 1
├────────────────────────────────┤
│  ...  │  ...  │  ...  │  ...   │
├────────────────────────────────┤
│ 64x64 │ 64x64 │ 64x64 │ ... x8 │  ← 蓝色 = 7
└────────────────────────────────┘
  ↑ 红色和绿色从 0-63 变化
</code></pre>
<p><strong>布局规则</strong>：</p>
<ul>
<li>横向 8 块（蓝色通道：0-7）</li>
<li>纵向 8 块（蓝色通道：0-7）</li>
<li>每块内部：红色（X轴），绿色（Y轴）</li>
</ul>
<h4 data-id="heading-9">2.3 查找算法</h4>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">RGB</span> = (<span class="hljs-number">0.75</span>, <span class="hljs-number">0.50</span>, <span class="hljs-number">0.25</span>)

步骤 1：计算 3D 索引
  <span class="hljs-attr">r_index</span> = <span class="hljs-number">0.75</span> × <span class="hljs-number">63</span> = <span class="hljs-number">47.25</span>
  <span class="hljs-attr">g_index</span> = <span class="hljs-number">0.50</span> × <span class="hljs-number">63</span> = <span class="hljs-number">31.5</span>
  <span class="hljs-attr">b_index</span> = <span class="hljs-number">0.25</span> × <span class="hljs-number">63</span> = <span class="hljs-number">15.75</span>

步骤 2：映射到 2D 纹理坐标
  <span class="hljs-attr">blue_x</span> = floor(b_index) % <span class="hljs-number">8</span> = <span class="hljs-number">7</span>
  <span class="hljs-attr">blue_y</span> = floor(b_index) / <span class="hljs-number">8</span> = <span class="hljs-number">1</span>
  
  <span class="hljs-attr">offset_x</span> = blue_x * <span class="hljs-number">64</span> + r_index = <span class="hljs-number">7</span>*<span class="hljs-number">64</span> + <span class="hljs-number">47.25</span> = <span class="hljs-number">495.25</span>
  <span class="hljs-attr">offset_y</span> = blue_y * <span class="hljs-number">64</span> + g_index = <span class="hljs-number">1</span>*<span class="hljs-number">64</span> + <span class="hljs-number">31.5</span> = <span class="hljs-number">95.5</span>
  
  <span class="hljs-attr">uv</span> = (<span class="hljs-literal">off</span>set_x / <span class="hljs-number">512</span>, <span class="hljs-literal">off</span>set_y / <span class="hljs-number">512</span>)

步骤 3：采样 LUT 纹理
  <span class="hljs-attr">new_color</span> = texture2D(uLUT, uv)
</code></pre>
<h3 data-id="heading-10">3. GLSL 实现</h3>
<h4 data-id="heading-11">3.1 基础 LUT 着色器</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture;    // 相机纹理
uniform sampler2D uLUTTexture; // LUT 纹理
uniform float uIntensity;      // LUT 强度

varying vec2 vTexCoord;

vec4 applyLUT(vec4 color, sampler2D lut) {
    // 1. 获取 RGB 值（0.0 - 1.0）
    float r = color.r;
    float g = color.g;
    float b = color.b;
    
    // 2. 计算蓝色索引
    float blueIndex = b * 63.0;
    
    // 3. 计算 LUT 坐标
    float quad = floor(floor(blueIndex) / 8.0);
    float xOffset = (floor(blueIndex) - quad * 8.0) / 8.0;
    float yOffset = quad / 8.0;
    
    // 4. 在 64x64 小格子内的位置
    float lutX = xOffset + (r / 8.0);
    float lutY = yOffset + (g / 8.0);
    
    // 5. 采样 LUT
    vec4 newColor = texture2D(lut, vec2(lutX, lutY));
    
    return newColor;
}

void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec4 lutColor = applyLUT(color, uLUTTexture);
    
    // 使用强度混合原色和 LUT 颜色
    gl_FragColor = mix(color, lutColor, uIntensity);
}
</code></pre>
<h4 data-id="heading-12">3.2 优化版 LUT 着色器（线性插值）</h4>
<p>为了更平滑的过渡，可以在相邻蓝色层之间插值：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 applyLUTWithInterpolation(vec4 color, sampler2D lut) {
    float r = color.r * 63.0;
    float g = color.g * 63.0;
    float b = color.b * 63.0;
    
    // 蓝色索引的整数和小数部分
    float b_floor = floor(b);
    float b_fract = fract(b);
    
    // 计算两个相邻蓝色层的坐标
    vec2 uv1 = getLUTCoord(r, g, b_floor);
    vec2 uv2 = getLUTCoord(r, g, b_floor + 1.0);
    
    // 采样两个层
    vec4 color1 = texture2D(lut, uv1);
    vec4 color2 = texture2D(lut, uv2);
    
    // 在两层之间插值
    return mix(color1, color2, b_fract);
}

vec2 getLUTCoord(float r, float g, float b) {
    float quad = floor(b / 8.0);
    float xOffset = (b - quad * 8.0) / 8.0;
    float yOffset = quad / 8.0;
    
    float lutX = xOffset + (r / 512.0) + 0.5 / 512.0;
    float lutY = yOffset + (g / 512.0) + 0.5 / 512.0;
    
    return vec2(lutX, lutY);
}
</code></pre>
<h3 data-id="heading-13">4. LUT 资源加载</h3>
<h4 data-id="heading-14">4.1 从 Assets 加载</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadLUTFromAssets</span><span class="hljs-params">(assetManager: <span class="hljs-type">AssetManager</span>, fileName: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">val</span> bitmap = assetManager.<span class="hljs-keyword">open</span>(fileName).use { inputStream -&gt;
        BitmapFactory.decodeStream(inputStream)
    }
    
    <span class="hljs-keyword">return</span> loadLUTTexture(bitmap)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadLUTTexture</span><span class="hljs-params">(bitmap: <span class="hljs-type">Bitmap</span>?)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">if</span> (bitmap == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">val</span> textures = IntArray(<span class="hljs-number">1</span>)
    GLES20.glGenTextures(<span class="hljs-number">1</span>, textures, <span class="hljs-number">0</span>)
    
    <span class="hljs-keyword">val</span> textureId = textures[<span class="hljs-number">0</span>]
    GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureId)
    
    <span class="hljs-comment">// 重要：LUT 纹理必须使用线性过滤</span>
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR)
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR)
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE)
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE)
    
    GLUtils.texImage2D(GLES20.GL_TEXTURE_2D, <span class="hljs-number">0</span>, bitmap, <span class="hljs-number">0</span>)
    
    bitmap.recycle()
    
    <span class="hljs-keyword">return</span> textureId
}
</code></pre>
<h4 data-id="heading-15">4.2 LUT 管理器</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LUTManager</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> assetManager: AssetManager) {
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LUTFilter</span>(
        <span class="hljs-keyword">val</span> name: String,
        <span class="hljs-keyword">val</span> fileName: String,
        <span class="hljs-keyword">var</span> textureId: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    )
    
    <span class="hljs-keyword">val</span> filters = listOf(
        LUTFilter(<span class="hljs-string">"原图"</span>, <span class="hljs-string">"filters/res_original.png"</span>),
        LUTFilter(<span class="hljs-string">"宝宝1"</span>, <span class="hljs-string">"filters/res_baby_1.png"</span>),
        LUTFilter(<span class="hljs-string">"宝宝2"</span>, <span class="hljs-string">"filters/res_baby_2.png"</span>),
        LUTFilter(<span class="hljs-string">"美食1"</span>, <span class="hljs-string">"filters/res_food_1.png"</span>),
        LUTFilter(<span class="hljs-string">"风景1"</span>, <span class="hljs-string">"filters/res_landscape_1.png"</span>),
        <span class="hljs-comment">// ... 更多</span>
    )
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllLUTs</span><span class="hljs-params">()</span></span> {
        filters.forEach { filter -&gt;
            filter.textureId = loadLUTFromAssets(assetManager, filter.fileName)
            Log.d(TAG, <span class="hljs-string">"加载 LUT: <span class="hljs-subst">${filter.name}</span>, textureId=<span class="hljs-subst">${filter.textureId}</span>"</span>)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFilterByName</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span>: LUTFilter? {
        <span class="hljs-keyword">return</span> filters.find { it.name == name }
    }
}
</code></pre>
<h3 data-id="heading-16">5. LUT 的优势</h3>
<h4 data-id="heading-17">5.1 与传统滤镜对比</h4>



































<table><thead><tr><th>特性</th><th>传统滤镜（着色器算法）</th><th>LUT 滤镜</th></tr></thead><tbody><tr><td><strong>复杂度</strong></td><td>简单（灰度、复古）</td><td>任意复杂（专业调色）</td></tr><tr><td><strong>性能</strong></td><td>中等</td><td>极快（一次采样）</td></tr><tr><td><strong>调色精度</strong></td><td>有限</td><td>专业级</td></tr><tr><td><strong>制作方式</strong></td><td>写代码</td><td>Photoshop/Lightroom</td></tr><tr><td><strong>灵活性</strong></td><td>需修改代码</td><td>直接替换图片</td></tr></tbody></table>
<h4 data-id="heading-18">5.2 应用场景</h4>
<ul>
<li>📸 <strong>Instagram 风格</strong>：复刻各种 Instagram 滤镜</li>
<li>🎬 <strong>电影调色</strong>：模拟电影色调</li>
<li>🎨 <strong>专业调色</strong>：设计师定制的色彩方案</li>
<li>🌈 <strong>品牌风格</strong>：统一的品牌视觉风格</li>
</ul>
<h3 data-id="heading-19">6. LUT 制作方法</h3>
<h4 data-id="heading-20">方法 1：Adobe Photoshop</h4>
<ol>
<li>打开图片，调整色彩（曲线、色阶、色相/饱和度）</li>
<li>应用调整图层到标准 LUT 模板</li>
<li>导出为 512×512 PNG 图片</li>
</ol>
<h4 data-id="heading-21">方法 2：Adobe Lightroom</h4>
<ol>
<li>调整照片到满意的效果</li>
<li>导出为 LUT 文件（.cube 格式）</li>
<li>转换为 PNG 图片（使用工具）</li>
</ol>
<h4 data-id="heading-22">方法 3：在线工具</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lutify.me%2F" target="_blank" title="https://www.lutify.me/" ref="nofollow noopener noreferrer">LUT Generator</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2F3dlutcreator.com%2F" target="_blank" title="https://3dlutcreator.com/" ref="nofollow noopener noreferrer">3D LUT Creator</a></li>
</ul>
<h3 data-id="heading-23">7. 性能优化</h3>
<h4 data-id="heading-24">7.1 LUT 纹理缓存</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 好的做法：预加载所有 LUT</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSurfaceCreated</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?, config: <span class="hljs-type">EGLConfig</span>?)</span></span> {
    lutManager.loadAllLUTs()  <span class="hljs-comment">// 只加载一次</span>
}

<span class="hljs-comment">// ❌ 不好的做法：切换时加载</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">switchLUT</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> texture = loadLUTFromAssets(name)  <span class="hljs-comment">// 每次都加载，慢！</span>
}
</code></pre>
<h4 data-id="heading-25">7.2 纹理压缩</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// LUT 纹理通常较小（512×512），不需要压缩</span>
<span class="hljs-comment">// 但可以考虑使用 RGB565（如果不需要 Alpha）</span>
</code></pre>
<h4 data-id="heading-26">7.3 异步加载</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 在后台线程加载 LUT</span>
GlobalScope.launch(Dispatchers.IO) {
    <span class="hljs-keyword">val</span> textures = lutManager.loadAllLUTs()
    
    withContext(Dispatchers.Main) {
        glSurfaceView.queueEvent {
            lutManager.updateTextures(textures)
        }
    }
}
</code></pre>
<h2 data-id="heading-27">💻 代码实践</h2>
<h3 data-id="heading-28">今日任务</h3>
<p>实现 LUT 滤镜相机：</p>
<ol>
<li><strong>加载 19 个 LUT 滤镜</strong></li>
<li><strong>实现 LUT 查找算法</strong>（GLSL）</li>
<li><strong>支持滤镜快速切换</strong></li>
<li><strong>添加滤镜强度调节</strong></li>
<li><strong>提供滤镜分类（宝宝、美食、风景等）</strong></li>
</ol>
<h3 data-id="heading-29">核心功能</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day12Renderer</span>(glSurfaceView: GLSurfaceView) : GLSurfaceView.Renderer {
    
    <span class="hljs-comment">// LUT 滤镜列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> lutFilters = mutableListOf&lt;LUTFilter&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentLUTTextureId = <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lutIntensity = <span class="hljs-number">1.0f</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSurfaceCreated</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?, config: <span class="hljs-type">EGLConfig</span>?)</span></span> {
        <span class="hljs-comment">// 加载所有 LUT</span>
        loadAllLUTs()
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// 应用当前 LUT</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, currentLUTTextureId)
        GLES20.glUniform1i(uLUTTextureLocation, <span class="hljs-number">1</span>)
        GLES20.glUniform1f(uIntensityLocation, lutIntensity)
        
        <span class="hljs-comment">// 渲染</span>
        drawQuad()
    }
}
</code></pre>
<h2 data-id="heading-30">🎨 滤镜分类</h2>
<p>根据您的 LUT 资源，我们有以下分类：</p>
<h3 data-id="heading-31">🍼 宝宝系列（5个）</h3>
<ul>
<li>baby_1, baby_2, baby_3, baby_4, baby_5</li>
<li>适合：儿童摄影、可爱风格</li>
</ul>
<h3 data-id="heading-32">🍔 美食系列（3个）</h3>
<ul>
<li>food_1, food_2, food_3</li>
<li>适合：美食拍摄、暖色调</li>
</ul>
<h3 data-id="heading-33">🏞️ 风景系列（3个）</h3>
<ul>
<li>landscape_1, landscape_2, landscape_3</li>
<li>适合：风景摄影、自然风光</li>
</ul>
<h3 data-id="heading-34">🌿 植物系列（2个）</h3>
<ul>
<li>plant_1, plant_2</li>
<li>适合：绿植、清新风格</li>
</ul>
<h3 data-id="heading-35">⭐ 推荐系列（2个）</h3>
<ul>
<li>recomend_1, recomend_2</li>
<li>适合：日常自拍</li>
</ul>
<h3 data-id="heading-36">🏙️ 街景系列（3个）</h3>
<ul>
<li>street_1, street_2, street_3</li>
<li>适合：城市摄影、街拍</li>
</ul>
<h2 data-id="heading-37">🧪 练习任务</h2>
<h3 data-id="heading-38">基础任务</h3>
<ol>
<li>✅ 实现 LUT 查找算法</li>
<li>✅ 加载所有 LUT 纹理</li>
<li>✅ 支持滤镜切换</li>
</ol>
<h3 data-id="heading-39">进阶任务</h3>
<ol>
<li>🎨 实现滤镜分类浏览</li>
<li>🎚️ 添加滤镜强度调节（0-100%）</li>
<li>🖼️ 显示滤镜缩略图预览</li>
<li>⭐ 收藏喜爱的滤镜</li>
</ol>
<h3 data-id="heading-40">挑战任务</h3>
<ol>
<li>🎬 实现滤镜过渡动画（从一个 LUT 平滑过渡到另一个）</li>
<li>🎭 实现双 LUT 混合</li>
<li>📊 分析 LUT 色彩特征</li>
<li>🔧 自定义 LUT 生成工具</li>
</ol>
<h2 data-id="heading-41">📖 知识点总结</h2>
<h3 data-id="heading-42">LUT 的本质</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">LUT</span> = 预计算的颜色映射表
    = 将复杂的调色算法"烘焙"到一张图片中
    = 查表比计算快得多
</code></pre>
<h3 data-id="heading-43">关键概念</h3>

























<table><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td><strong>3D LUT</strong></td><td>三维颜色查找表（R、G、B 三个维度）</td></tr><tr><td><strong>512×512</strong></td><td>标准 LUT 图片大小</td></tr><tr><td><strong>64×64×64</strong></td><td>颜色精度（262,144 种颜色）</td></tr><tr><td><strong>线性插值</strong></td><td>在相邻颜色间平滑过渡</td></tr></tbody></table>
<h3 data-id="heading-44">最佳实践</h3>
<ol>
<li>✅ <strong>预加载所有 LUT</strong>：启动时一次性加载</li>
<li>✅ <strong>使用线性过滤</strong>：<code>GL_LINEAR</code> 而非 <code>GL_NEAREST</code></li>
<li>✅ <strong>添加强度控制</strong>：mix(original, lut, intensity)</li>
<li>✅ <strong>纹理缓存</strong>：避免重复加载</li>
<li>✅ <strong>异步加载</strong>：不阻塞 UI 线程</li>
</ol>
<h2 data-id="heading-45">🔗 参考资料</h2>
<h3 data-id="heading-46">LUT 技术</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2F3D_lookup_table" target="_blank" title="https://en.wikipedia.org/wiki/3D_lookup_table" ref="nofollow noopener noreferrer">3D LUT 原理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.frame.io%2F2017%2F03%2F06%2Fluts-grutas%2F" target="_blank" title="https://blog.frame.io/2017/03/06/luts-grutas/" ref="nofollow noopener noreferrer">Color Grading with LUTs</a></li>
</ul>
<h3 data-id="heading-47">LUT 资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.freepresets.com%2Fproduct%2Ffree-luts%2F" target="_blank" title="https://www.freepresets.com/product/free-luts/" ref="nofollow noopener noreferrer">Free LUTs</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rocketstock.com%2Ffree-after-effects-templates%2F35-free-luts-for-color-grading-videos%2F" target="_blank" title="https://www.rocketstock.com/free-after-effects-templates/35-free-luts-for-color-grading-videos/" ref="nofollow noopener noreferrer">RocketStock LUTs</a></li>
</ul>
<h2 data-id="heading-48">📝 今日总结</h2>
<p>今天我们学习了 LUT 滤镜技术：</p>
<ol>
<li>✅ 理解了 LUT 的工作原理：颜色查找表</li>
<li>✅ 掌握了 3D LUT 的存储格式：512×512 图片</li>
<li>✅ 实现了 LUT 查找算法：RGB → 2D 纹理坐标</li>
<li>✅ 支持 19 种专业滤镜</li>
<li>✅ 理解了 LUT 的性能优势</li>
</ol>
<p><strong>关键要点</strong>：</p>
<ul>
<li>LUT 将复杂调色"烘焙"成查找表</li>
<li>一次纹理采样即可实现专业级调色</li>
<li>性能极高，适合实时应用</li>
<li>可以直接使用 Photoshop/Lightroom 制作</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谈谈 `AI Agent`（智能体）]]></title>    <link>https://juejin.cn/post/7591322050240364582</link>    <guid>https://juejin.cn/post/7591322050240364582</guid>    <pubDate>2026-01-04T11:00:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591322050240364582" data-draft-id="7591346773827207194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谈谈 `AI Agent`（智能体）"/> <meta itemprop="keywords" content="Agent,AI编程"/> <meta itemprop="datePublished" content="2026-01-04T11:00:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="周末程序猿"/> <meta itemprop="url" content="https://juejin.cn/user/3245414056989757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谈谈 `AI Agent`（智能体）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3245414056989757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    周末程序猿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:00:17.000Z" title="Sun Jan 04 2026 11:00:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年以来，我们正站在人工智能应用演进的一个关键节点上，从预测式AI（分析模式、进行分类）到生成式AI（创造文本、代码、图像），我们如今正迈向第三个阶段：AI Agent。<br/>
这并非简单的技术迭代，而是一次根本性的范式转变，第三个阶段 <code>AI Agent</code> 随着模型的不断进化，能自主可控长时间运行，可能2026才是AI普及的开始。</p>
<h2 data-id="heading-0">什么是 <code>AI Agent</code></h2>
<p>传统软件或者工作流的目的是为了用户能够简化和自动化工作流，而 <code>AI Agent</code> 则能够以高度的独立性代表用户执行为实现用户目标的一系列步骤。<br/>
首先集成了 <code>LLM</code> 但不用它们来控制工作流执行的应用程序（例如简单的聊天机器人、单轮对话LLM或情感分类器）不是称为智能体。<br/>
更具体地说，一个智能体拥有使其能够可靠、一致地代表用户行动的核心特征：</p>
<ul>
<li>能利用LLM来管理工作流执行并做出决策，它能识别工作流何时完成，并能在需要时主动纠正其行为，如果失败，它可以停止执行并将控制权交还给用户。</li>
<li>能够访问各种工具以与外部系统交互（既能获取上下文，也能采取行动），并根据工作流的当前状态动态选择适当的工具，始终在明确定义的安全内运行。</li>
</ul>
<p><strong>是不是现在智能体很多，所有的工作都用智能体来解决？</strong><br/>
智能体适合那些传统的、确定性的、基于规则的方法难以处理的工作流，所以对于能通过一些确定性编程或者流程就能解决的，其实不太需要智能体。<br/>
以支付欺诈分析为例，传统的规则引擎就像一个检查清单，根据预设标准标记交易，相比之下，LLM智能体更像一位经验丰富的调查员，评估上下文，考虑细微模式，即使在没有明确违反规则的情况下也能识别可疑活动，这种细致的推理能力正是智能体能够有效管理复杂、模糊情况的关键。<br/>
所以在评估智能体可以在哪些地方的确有价值，请优先考虑那些以前难以自动化、尤其是传统方法遇到阻力的工作流：</p>
<ul>
<li>复杂决策：涉及细微判断、例外情况或上下文敏感决策的工作流。</li>
<li>难以维护的规则：由于规则集庞大且复杂而变得笨重、更新成本高昂或容易出错的系统。</li>
<li>重度依赖非结构化数据：涉及解读自然语言、从文档中提取含义或与用户进行对话式交互的场景。</li>
</ul>
<h2 data-id="heading-1"><code>AI Agent</code>的构成</h2>
<ul>
<li>模型：为智能体的推理和决策提供动力的LLM，决定了智能体的下限。</li>
<li>工具：智能体可用于采取行动的外部函数或API。</li>
<li>指令：定义智能体行为的明确指导方针和安全策略。</li>
</ul>
<p><strong>样例代码：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentExecutor, create_react_agent
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第一部分：定义工具（Tools）</span>
<span class="hljs-comment"># 工具是Agent可以调用的外部函数，扩展了LLM的能力</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculator</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    计算数学表达式。
    输入应该是一个有效的数学表达式，如 '2 + 2' 或 '3 * 4 + 5'。
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 安全地计算数学表达式</span>
        result = <span class="hljs-built_in">eval</span>(expression, {<span class="hljs-string">"__builtins__"</span>: {}}, {})
        <span class="hljs-keyword">return</span><span class="hljs-string">f"计算结果: <span class="hljs-subst">{expression}</span> = <span class="hljs-subst">{result}</span>"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span><span class="hljs-string">f"计算错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_current_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    获取指定城市的当前天气信息。
    输入应该是城市名称，如 '北京' 或 '上海'。
    """</span>
    <span class="hljs-comment"># 模拟天气数据（实际应用中应调用真实的天气API）</span>
    weather_data = {
        <span class="hljs-string">"北京"</span>: <span class="hljs-string">"晴天，温度 5°C，湿度 30%"</span>,
        <span class="hljs-string">"上海"</span>: <span class="hljs-string">"多云，温度 12°C，湿度 65%"</span>,
        <span class="hljs-string">"广州"</span>: <span class="hljs-string">"小雨，温度 18°C，湿度 80%"</span>,
        <span class="hljs-string">"深圳"</span>: <span class="hljs-string">"晴天，温度 20°C，湿度 70%"</span>,
    }
    <span class="hljs-keyword">return</span> weather_data.get(city, <span class="hljs-string">f"抱歉，暂无<span class="hljs-subst">{city}</span>的天气信息"</span>)

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_knowledge</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    搜索知识库获取相关信息。
    输入应该是要搜索的问题或关键词。
    """</span>
    <span class="hljs-comment"># 模拟知识库搜索（实际应用中可接入向量数据库或搜索引擎）</span>
    knowledge_base = {
        <span class="hljs-string">"python"</span>: <span class="hljs-string">"Python是一种高级编程语言，以简洁易读著称，广泛应用于数据科学、Web开发和人工智能领域。"</span>,
        <span class="hljs-string">"agent"</span>: <span class="hljs-string">"AI Agent（智能体）是能够感知环境、做出决策并采取行动的自主系统。它由模型、工具和指令三部分组成。"</span>,
        <span class="hljs-string">"langchain"</span>: <span class="hljs-string">"LangChain是一个用于开发LLM应用的框架，提供了构建Agent、链式调用、记忆管理等功能。"</span>,
    }
    
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> knowledge_base.items():
        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">in</span> query.lower():
            <span class="hljs-keyword">return</span> value
    <span class="hljs-keyword">return</span><span class="hljs-string">f"未找到与'<span class="hljs-subst">{query}</span>'相关的信息"</span>

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第二部分：定义指令（Instructions）</span>
<span class="hljs-comment"># 通过Prompt模板定义Agent的行为方式和安全策略</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-comment"># ReAct风格的Prompt模板</span>
AGENT_PROMPT = <span class="hljs-string">"""你是一个智能助手，能够帮助用户完成各种任务。

你可以使用以下工具:
{tools}

工具名称列表: {tool_names}

请按照以下格式回答问题:

Question: 用户的输入问题
Thought: 你需要思考应该做什么
Action: 要使用的工具名称，必须是[{tool_names}]中的一个
Action Input: 工具的输入参数
Observation: 工具返回的结果
... (这个Thought/Action/Action Input/Observation可以重复多次)
Thought: 我现在知道最终答案了
Final Answer: 对用户问题的最终回答

重要指导方针：
1. 仔细分析用户的问题，选择合适的工具
2. 如果问题可以直接回答，无需使用工具
3. 回答要准确、简洁、有帮助
4. 如果不确定，诚实地说明

开始！

Question: {input}
Thought: {agent_scratchpad}"""</span>

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第三部分：创建Agent</span>
<span class="hljs-comment"># 组合模型、工具和指令</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_simple_agent</span>():
    <span class="hljs-string">"""创建一个简单的Agent"""</span>
    
    <span class="hljs-comment"># 1. 初始化模型（Model）</span>
    <span class="hljs-comment"># 这里使用OpenAI的GPT模型，你也可以替换为其他LLM</span>
    llm = ChatOpenAI(
        model=<span class="hljs-string">"gpt-3.5-turbo"</span>,  <span class="hljs-comment"># 或 "gpt-4"</span>
        temperature=<span class="hljs-number">0</span>,  <span class="hljs-comment"># 设为0使输出更确定性</span>
        <span class="hljs-comment"># api_key=os.getenv("OPENAI_API_KEY"),  # 从环境变量获取</span>
    )
    
    <span class="hljs-comment"># 2. 准备工具列表（Tools）</span>
    tools = [calculator, get_current_weather, search_knowledge]
    
    <span class="hljs-comment"># 3. 创建Prompt模板（Instructions）</span>
    prompt = PromptTemplate.from_template(AGENT_PROMPT)
    
    <span class="hljs-comment"># 4. 创建ReAct Agent</span>
    agent = create_react_agent(
        llm=llm,
        tools=tools,
        prompt=prompt
    )
    
    <span class="hljs-comment"># 5. 创建Agent执行器</span>
    agent_executor = AgentExecutor(
        agent=agent,
        tools=tools,
        verbose=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 打印详细的执行过程</span>
        handle_parsing_errors=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 处理解析错误</span>
        max_iterations=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 最大迭代次数，防止无限循环</span>
    )
    
    <span class="hljs-keyword">return</span> agent_executor

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第四部分：运行示例</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-string">"""运行Agent示例"""</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"LangChain Agent 示例"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    
    <span class="hljs-comment"># 创建Agent</span>
    agent = create_simple_agent()
    
    <span class="hljs-comment"># 测试用例</span>
    test_questions = [
        <span class="hljs-string">"计算 (15 + 25) * 3 等于多少？"</span>,
        <span class="hljs-string">"北京今天天气怎么样？"</span>,
        <span class="hljs-string">"什么是LangChain？"</span>,
        <span class="hljs-string">"帮我计算一下，如果北京温度是5度，上海是12度，它们的平均温度是多少？"</span>,
    ]
    
    <span class="hljs-keyword">for</span> i, question <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_questions, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"测试 <span class="hljs-subst">{i}</span>: <span class="hljs-subst">{question}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        
        <span class="hljs-keyword">try</span>:
            result = agent.invoke({<span class="hljs-string">"input"</span>: question})
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n最终答案: <span class="hljs-subst">{result[<span class="hljs-string">'output'</span>]}</span>"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"执行出错: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h3 data-id="heading-2">选择模型</h3>
<p>不同的模型在任务复杂性、延迟和成本方面有不同的优势和权衡，并非每个任务都需要最聪明的模型——一个简单的检索或意图分类任务可以由更小、更快的模型处理，而困难任务则可能需要能力更强的推理模型。<br/>
选择模型有效的方法是：使用能力最强的模型为每个任务构建您的智能体原型，以建立性能基线，然后，尝试换用更小的模型，看看它们是否仍能达到可接受的结果。 这样，您就不会过早地限制智能体的能力，并且可以诊断出更小的模型在何处成功或失败，总之，选择模型的原则很简单：</p>
<ul>
<li>建立评估体系以确定性能基线。</li>
<li>专注于使用可用的最佳模型达到您的准确率目标。</li>
<li>在可能的情况下，用更小的模型替换更大的模型，以优化成本和延迟。</li>
</ul>
<h3 data-id="heading-3">定义工具</h3>
<p>工具通过使用底层应用程序或系统的API来扩展智能体的能力，对于没有提供API的历史系统，智能体可以依赖计算机使用模型，通过Web和应用程序UI直接与这些应用程序和系统交互——就像人类一样进行黑盒测试。<br/>
每个工具都应具有标准化的定义，从而实现工具与智能体之间灵活的多对多关系，文档完善、经过充分测试且可重用的工具可以提高可发现性，简化版本管理，并防止重复定义，广义上说，智能体需要三种类型的工具。</p>
<ul>
<li>类型描述示例数据工具：使智能体能够检索执行工作流所需的上下文和信息，比如查询交易数据库或CRM等系统，读取PDF文档，或搜索网络。</li>
<li>行动工具：使智能体能够与系统交互以采取行动，例如向数据库添加新信息、更新记录或发送消息，发送电子邮件和短信，更新CRM记录，将客户服务工单转交给人工。</li>
<li>编排工具：智能体本身可以作为其他智能体的工具，作为多智能体系统中单个 <code>sub agent</code>。</li>
</ul>
<h3 data-id="heading-4">配置Prompt</h3>
<p>高质量的Prompt对于任何LLM驱动的应用程序都至关重要，对智能体尤其关键，清晰的指令可以减少歧义，提高智能体的决策质量，从而实现更顺畅的工作流执行和更少的错误。<br/>
具体做法可以参考如下：</p>
<ul>
<li>利用现有文档：在创建流程时，使用现有的操作程序、支持脚本或策略文档来创建，例如 <code>Claude</code> 提出的 <code>Skill</code>，其他模型比较通用的 <code>AGENTS.md</code> 等。</li>
<li>提示智能体分解任务：从密集的资源中提供更小、更清晰的步骤，有助于最小化歧义，并帮助模型更好地遵循指令。</li>
<li>定义清晰的动作：确保流程中的每一步都对应一个特定的动作或输出，例如，一个步骤可能指示智能体向用户询问订单号，或调用API来检索账户详情，明确说明动作（甚至面向用户消息的措辞）可以减少解释错误的空间。</li>
<li>控制边界处理：现实世界的交互经常会产生决策点，例如当用户提供不完整信息或提出意外问题时如何继续，一个健壮的流程应预见常见的变体，并包含如何处理它们的指令，例如使用条件步骤或分支（如果缺少必要信息，则执行替代步骤）。</li>
</ul>
<h2 data-id="heading-5">从 <code>MCP</code> 到 <code>A2A</code></h2>
<p><code>AI Agent</code> 为了和多个其他系统交互，衍生了两种系统交互的协议，<code>MCP</code> 和 <code>A2A</code>。</p>
<h3 data-id="heading-6"><code>MCP</code></h3>
<p><code>MCP</code> 在之前的文章已经讲过了（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqHfSbSjoxl9V5e8MvVMbZA%25EF%25BC%2589%25EF%25BC%258C%25E4%25B8%2580%25E7%25A7%258D%25E5%25BC%2580%25E6%2594%25BE%25E5%258D%258F%25E8%25AE%25AE%25EF%25BC%258C%25E5%258F%25AF%25E6%25A0%2587%25E5%2587%2586%25E5%258C%2596%25E5%25BA%2594%25E7%2594%25A8%25E5%2590%2591" target="_blank" title="https://mp.weixin.qq.com/s/qHfSbSjoxl9V5e8MvVMbZA%EF%BC%89%EF%BC%8C%E4%B8%80%E7%A7%8D%E5%BC%80%E6%94%BE%E5%8D%8F%E8%AE%AE%EF%BC%8C%E5%8F%AF%E6%A0%87%E5%87%86%E5%8C%96%E5%BA%94%E7%94%A8%E5%90%91" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/qHfSbSjox…</a> LLM 提供上下文的方式，<code>MCP</code> 提供了一种将模型连接到资源、提示和工具的标准化方式。</p>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">import</span> httpx
<span class="hljs-keyword">from</span> fastmcp <span class="hljs-keyword">import</span> FastMCP

logger = logging.getLogger(__name__)
logging.basicConfig(<span class="hljs-built_in">format</span>=<span class="hljs-string">"[%(levelname)s]: %(message)s"</span>, level=logging.INFO)

mcp = FastMCP(<span class="hljs-string">"Currency MCP Server 💵"</span>)

<span class="hljs-meta">@mcp.tool()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_exchange_rate</span>(<span class="hljs-params">
    currency_from: <span class="hljs-built_in">str</span> = <span class="hljs-string">'USD'</span>,
    currency_to: <span class="hljs-built_in">str</span> = <span class="hljs-string">'EUR'</span>,
    currency_date: <span class="hljs-built_in">str</span> = <span class="hljs-string">'latest'</span>,
</span>):
    <span class="hljs-string">"""Use this to get current exchange rate.

    Args:
        currency_from: The currency to convert from (e.g., "USD").
        currency_to: The currency to convert to (e.g., "EUR").
        currency_date: The date for the exchange rate or "latest". Defaults to "latest".

    Returns:
        A dictionary containing the exchange rate data, or an error message if the request fails.
    """</span>
    logger.info(<span class="hljs-string">f"--- 🛠️ Tool: get_exchange_rate called for converting <span class="hljs-subst">{currency_from}</span> to <span class="hljs-subst">{currency_to}</span> ---"</span>)
    <span class="hljs-keyword">try</span>:
        response = httpx.get(
            <span class="hljs-string">f'https://api.frankfurter.app/<span class="hljs-subst">{currency_date}</span>'</span>,
            params={<span class="hljs-string">'from'</span>: currency_from, <span class="hljs-string">'to'</span>: currency_to},
        )
        response.raise_for_status()

        data = response.json()
        <span class="hljs-keyword">if</span><span class="hljs-string">'rates'</span>notin data:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'Invalid API response format.'</span>}
        logger.info(<span class="hljs-string">f'✅ API response: <span class="hljs-subst">{data}</span>'</span>)
        <span class="hljs-keyword">return</span> data
    <span class="hljs-keyword">except</span> httpx.HTTPError <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">f'API request failed: <span class="hljs-subst">{e}</span>'</span>}
    <span class="hljs-keyword">except</span> ValueError:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'Invalid JSON response from API.'</span>}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    logger.info(<span class="hljs-string">f"🚀 MCP server started on port <span class="hljs-subst">{os.getenv(<span class="hljs-string">'PORT'</span>, <span class="hljs-number">8080</span>)}</span>"</span>)
    asyncio.run(
        mcp.run_async(
            transport=<span class="hljs-string">"http"</span>,
            host=<span class="hljs-string">"0.0.0.0"</span>,
            port=os.getenv(<span class="hljs-string">"PORT"</span>, <span class="hljs-number">8080</span>),
        )
    )
</code></pre>
<p>以上代码是汇率的 <code>MCP Server</code>，通过 <code>MCP Client</code> 可以获取汇率数据。</p>
<h3 data-id="heading-7">Agent2Agent (<code>A2A</code>)</h3>
<p>Agent2Agent (A2A) 协议是一种开放标准，旨在让 AI 智能体之间实现无缝通信和协作，正如 MCP 提供了一种标准化的方式来让 LLM 访问数据和工具一样，A2A 也提供了一种标准化的方式来让智能体与其他智能体对话！<br/>
在一个智能体由不同供应商使用各种框架构建的世界中，A2A 提供了一种通用语言，打破了孤岛并促进了互操作性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc98315e2cb647cd942fe33ba627861b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129217&amp;x-signature=2%2BUTr8lZfYDTv1OsRLrK%2F8JhriU%3D" alt="图片" loading="lazy"/></p>
<p><strong>A2A的工作原理：</strong></p>
<ul>
<li>发现：使用标准化的 <code>Agent Card</code> 查找其他智能体技能 <code>AgentSkill</code> 和功能 <code>AgentCapabilities</code>；</li>
<li>协议：安全的交换消息和数据；</li>
<li>协作：委派任务给到相应技能的 <code>Agent</code> 并协调行动；</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a22d0989770d424e9e454845cfbc44fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129217&amp;x-signature=6RWzFhFghKxuuRGo%2FIK6uMVa4zs%3D" alt="图片" loading="lazy"/></p>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">import</span> click

<span class="hljs-keyword">from</span> a2a.server.apps <span class="hljs-keyword">import</span> A2AStarletteApplication
<span class="hljs-keyword">from</span> a2a.server.request_handlers <span class="hljs-keyword">import</span> DefaultRequestHandler
<span class="hljs-keyword">from</span> a2a.server.tasks <span class="hljs-keyword">import</span> InMemoryTaskStore
<span class="hljs-keyword">from</span> a2a.types <span class="hljs-keyword">import</span> (
    AgentCapabilities,
    AgentCard,
    AgentSkill,
)
<span class="hljs-keyword">from</span> agent <span class="hljs-keyword">import</span> ImageGenerationAgent
<span class="hljs-keyword">from</span> agent_executor <span class="hljs-keyword">import</span> ImageGenerationAgentExecutor
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv()

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MissingAPIKeyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""Exception for missing API key."""</span>

<span class="hljs-meta">@click.command()</span>
<span class="hljs-meta">@click.option(<span class="hljs-params"><span class="hljs-string">'--host'</span>, <span class="hljs-string">'host'</span>, default=<span class="hljs-string">'localhost'</span></span>)</span>
<span class="hljs-meta">@click.option(<span class="hljs-params"><span class="hljs-string">'--port'</span>, <span class="hljs-string">'port'</span>, default=<span class="hljs-number">10001</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">host, port</span>):
    <span class="hljs-string">"""Entry point for the A2A + CrewAI Image generation sample."""</span>
    <span class="hljs-keyword">try</span>:
        capabilities = AgentCapabilities(streaming=<span class="hljs-literal">False</span>)
        skill = AgentSkill(
            <span class="hljs-built_in">id</span>=<span class="hljs-string">'image_generator'</span>,
            name=<span class="hljs-string">'Image Generator'</span>,
            description=(
                <span class="hljs-string">'Generate stunning, high-quality images on demand and leverage'</span>
                <span class="hljs-string">' powerful editing capabilities to modify, enhance, or completely'</span>
                <span class="hljs-string">' transform visuals.'</span>
            ),
            tags=[<span class="hljs-string">'generate image'</span>, <span class="hljs-string">'edit image'</span>],
            examples=[<span class="hljs-string">'Generate a photorealistic image of raspberry lemonade'</span>],
        )

        agent_host_url = (
            os.getenv(<span class="hljs-string">'HOST_OVERRIDE'</span>)
            <span class="hljs-keyword">if</span> os.getenv(<span class="hljs-string">'HOST_OVERRIDE'</span>)
            <span class="hljs-keyword">else</span><span class="hljs-string">f'http://<span class="hljs-subst">{host}</span>:<span class="hljs-subst">{port}</span>/'</span>
        )
        agent_card = AgentCard(
            name=<span class="hljs-string">'Image Generator Agent'</span>,
            description=(
                <span class="hljs-string">'Generate stunning, high-quality images on demand and leverage'</span>
                <span class="hljs-string">' powerful editing capabilities to modify, enhance, or completely'</span>
                <span class="hljs-string">' transform visuals.'</span>
            ),
            url=agent_host_url,
            version=<span class="hljs-string">'1.0.0'</span>,
            default_input_modes=ImageGenerationAgent.SUPPORTED_CONTENT_TYPES,
            default_output_modes=ImageGenerationAgent.SUPPORTED_CONTENT_TYPES,
            capabilities=capabilities,
            skills=[skill],
        )

        request_handler = DefaultRequestHandler(
            agent_executor=ImageGenerationAgentExecutor(),
            task_store=InMemoryTaskStore(),
        )
        server = A2AStarletteApplication(
            agent_card=agent_card, http_handler=request_handler
        )
        <span class="hljs-keyword">import</span> uvicorn

        uvicorn.run(server.build(), host=host, port=port)

    <span class="hljs-keyword">except</span> MissingAPIKeyError <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f'Error: <span class="hljs-subst">{e}</span>'</span>)
        exit(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f'An error occurred during server startup: <span class="hljs-subst">{e}</span>'</span>)
        exit(<span class="hljs-number">1</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
<h2 data-id="heading-8">从单智能体到多智能体</h2>
<h3 data-id="heading-9">单智能体</h3>
<p>单智能体的智能大部分场景下依赖基座模型，在处理明确问题时较为高效，对于约束性任务时较为准确，并且可以进行回测，但面对复杂、多领域任务时，其能力往往受限。</p>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> nest_asyncio

<span class="hljs-keyword">from</span> langchain_google_genai <span class="hljs-keyword">import</span> ChatGoogleGenerativeAI
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool <span class="hljs-keyword">as</span> langchain_tool
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_tool_calling_agent, AgentExecutor

<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 初始化具备工具调用能力的模型</span>
    llm = ChatGoogleGenerativeAI(model=<span class="hljs-string">"gemini-2.0-flash"</span>, temperature=<span class="hljs-number">0</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 语言模型已初始化：<span class="hljs-subst">{llm.model}</span>"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🛑 初始化语言模型出错：<span class="hljs-subst">{e}</span>"</span>)
    llm = <span class="hljs-literal">None</span>

<span class="hljs-comment"># --- 定义工具 ---</span>
<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_information</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- 🛠️ 工具调用：search_information, 查询：'<span class="hljs-subst">{query}</span>' ---"</span>)
    <span class="hljs-comment"># 用预设结果模拟搜索工具</span>
    simulated_results = {
        <span class="hljs-string">"default"</span>: <span class="hljs-string">f"模拟搜索 '<span class="hljs-subst">{query}</span>'：未找到具体信息，但该主题很有趣。"</span>
    }
    result = simulated_results.get(query.lower(), simulated_results[<span class="hljs-string">"default"</span>])
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- 工具结果：<span class="hljs-subst">{result}</span> ---"</span>)
    <span class="hljs-keyword">return</span> result

tools = [search_information]

<span class="hljs-comment"># --- 创建工具调用 Agent ---</span>
<span class="hljs-keyword">if</span> llm:
    agent_prompt = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个乐于助人的助手。"</span>),
        (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
        (<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{agent_scratchpad}"</span>),
    ])

    agent = create_tool_calling_agent(llm, tools, agent_prompt)
    agent_executor = AgentExecutor(agent=agent, verbose=<span class="hljs-literal">True</span>, tools=tools)

asyncdef run_agent_with_tool(query: <span class="hljs-built_in">str</span>):
    <span class="hljs-string">"""用 Agent 执行查询并打印最终回复。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- 🏃 Agent 运行查询：'<span class="hljs-subst">{query}</span>' ---"</span>)
    <span class="hljs-keyword">try</span>:
        response = <span class="hljs-keyword">await</span> agent_executor.ainvoke({<span class="hljs-string">"input"</span>: query})
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- ✅ Agent 最终回复 ---"</span>)
        <span class="hljs-built_in">print</span>(response[<span class="hljs-string">"output"</span>])
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🛑 Agent 执行出错：<span class="hljs-subst">{e}</span>"</span>)

asyncdef main():
    <span class="hljs-string">"""并发运行多个 Agent 查询。"""</span>
    tasks = [
        run_agent_with_tool(<span class="hljs-string">"今天XXX天气怎么样？"</span>),
    ]
    <span class="hljs-keyword">await</span> asyncio.gather(*tasks)

nest_asyncio.apply()
asyncio.run(main())
</code></pre>
<h3 data-id="heading-10">多智能体</h3>
<p>多智能体协作模式通过将系统结构化为多个独立且专用的智能体进行协作，解决了单智能体的局限，该模式基于任务分解原则，将高层目标拆分为若干子问题，并分配给具备相应工具、数据访问或推理能力的智能体。<br/>
其中多智能体架构的运作方式：用户查询通过主智能体，主智能体创建专门的子智能体来并行搜索和处理不同信息，样例如下执行流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f71fd6ce1f84431cb383885d02478842~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129217&amp;x-signature=NspkZ3UFNn7oMo02EKdhc56oYEs%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>当用户提交查询时，系统会创建一个主智能体，该智能体进入迭代任务流程。</li>
<li>主智能体首先会思考任务方法，并将计划保存到内存中以持久化上下文信息，因为如果上下文窗口超过 20 万个标记，LLM会信息遗忘或者截断，所以保留计划至关重要。</li>
<li>然后，它会创建专门的子智能体，每个子智能体负责特定的任务。</li>
<li>每个子智能体独立执行网络搜索，使用交错思维评估工具结果，并将结果返回给主智能体。</li>
<li>主智能体综合这些结果，并决定是否需要进行更多任务 —— 如果需要，它可以创建更多子智能体或优化其策略。</li>
<li>一旦收集到足够的信息，系统就会退出循环，并将所有结果传递给引文智能体。</li>
<li>引文智能体处理文档和报告，以确定具体的引文位置，最终的结果（包括引用）将返回给用户。</li>
</ul>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentExecutor, create_tool_calling_agent
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool <span class="hljs-keyword">as</span> langchain_tool
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 多智能体系统示例</span>
<span class="hljs-comment"># 架构：主智能体 + 多个专用子智能体</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-comment"># --- 初始化模型 ---</span>
llm = ChatOpenAI(model=<span class="hljs-string">"gpt-5"</span>, temperature=<span class="hljs-number">0</span>)

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第一部分：定义子智能体的工具</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_web</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""搜索网络获取最新信息。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🔍 [网络搜索] 查询: <span class="hljs-subst">{query}</span>"</span>)
    <span class="hljs-comment"># 模拟网络搜索结果</span>
    <span class="hljs-keyword">return</span><span class="hljs-string">f"网络搜索结果: 关于'<span class="hljs-subst">{query}</span>'的最新信息..."</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_database</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""搜索内部数据库获取结构化数据。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🗄️ [数据库搜索] 查询: <span class="hljs-subst">{query}</span>"</span>)
    <span class="hljs-comment"># 模拟数据库查询</span>
    <span class="hljs-keyword">return</span><span class="hljs-string">f"数据库查询结果: '<span class="hljs-subst">{query}</span>'相关记录3条..."</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_data</span>(<span class="hljs-params">data: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""分析数据并生成洞察。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📊 [数据分析] 分析: <span class="hljs-subst">{data}</span>"</span>)
    <span class="hljs-keyword">return</span><span class="hljs-string">f"分析结论: 基于'<span class="hljs-subst">{data}</span>'的数据分析完成..."</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_report</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""根据内容生成报告。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📝 [报告生成] 内容: <span class="hljs-subst">{content}</span>"</span>)
    <span class="hljs-keyword">return</span><span class="hljs-string">f"报告已生成: 包含'<span class="hljs-subst">{content}</span>'的详细报告..."</span>

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第二部分：定义子智能体类</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SubAgent</span>:
    <span class="hljs-string">"""子智能体基类"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, role: <span class="hljs-built_in">str</span>, tools: <span class="hljs-built_in">list</span></span>):
        self.name = name
        self.role = role
        self.tools = tools
        self.agent_executor = self._create_executor()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_executor</span>(<span class="hljs-params">self</span>) -&gt; AgentExecutor:
        prompt = ChatPromptTemplate.from_messages([
            (<span class="hljs-string">"system"</span>, <span class="hljs-string">f"你是<span class="hljs-subst">{self.name}</span>，职责是<span class="hljs-subst">{self.role}</span>。专注完成分配的任务，返回简洁结果。"</span>),
            (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
            (<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{agent_scratchpad}"</span>),
        ])
        agent = create_tool_calling_agent(llm, self.tools, prompt)
        <span class="hljs-keyword">return</span> AgentExecutor(agent=agent, tools=self.tools, verbose=<span class="hljs-literal">True</span>)
    
    asyncdef execute(self, task: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""异步执行任务"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">50</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🤖 子智能体 [<span class="hljs-subst">{self.name}</span>] 开始执行任务: <span class="hljs-subst">{task}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">50</span>}</span>"</span>)
        result = <span class="hljs-keyword">await</span> self.agent_executor.ainvoke({<span class="hljs-string">"input"</span>: task})
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"agent"</span>: self.name, <span class="hljs-string">"task"</span>: task, <span class="hljs-string">"result"</span>: result[<span class="hljs-string">"output"</span>]}

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第三部分：创建主智能体（协调者）</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MasterAgent</span>:
    <span class="hljs-string">"""主智能体 - 负责任务分解和子智能体协调"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.sub_agents = self._create_sub_agents()
        self.memory = []  <span class="hljs-comment"># 用于持久化计划和中间结果</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_sub_agents</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, SubAgent]:
        <span class="hljs-string">"""创建专用子智能体"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"researcher"</span>: SubAgent(
                name=<span class="hljs-string">"研究员智能体"</span>,
                role=<span class="hljs-string">"负责网络搜索和信息收集"</span>,
                tools=[search_web]
            ),
            <span class="hljs-string">"data_analyst"</span>: SubAgent(
                name=<span class="hljs-string">"数据分析智能体"</span>, 
                role=<span class="hljs-string">"负责数据库查询和数据分析"</span>,
                tools=[search_database, analyze_data]
            ),
            <span class="hljs-string">"reporter"</span>: SubAgent(
                name=<span class="hljs-string">"报告智能体"</span>,
                role=<span class="hljs-string">"负责整合信息并生成最终报告"</span>,
                tools=[generate_report]
            ),
        }
    
    asyncdef _decompose_task(self, query: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]]:
        <span class="hljs-string">"""使用LLM分解任务"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🧠 主智能体正在分析任务: <span class="hljs-subst">{query}</span>"</span>)
        
        <span class="hljs-comment"># 使用LLM进行任务分解</span>
        response = <span class="hljs-keyword">await</span> llm.ainvoke([
            SystemMessage(content=<span class="hljs-string">"""你是一个任务分解专家。将用户查询分解为子任务。
返回格式(每行一个): agent_type|task_description
可用的agent_type: researcher, data_analyst, reporter"""</span>),
            HumanMessage(content=<span class="hljs-string">f"分解任务: <span class="hljs-subst">{query}</span>"</span>)
        ])
        
        <span class="hljs-comment"># 解析任务分解结果</span>
        tasks = []
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response.content.strip().split(<span class="hljs-string">"\n"</span>):
            <span class="hljs-keyword">if</span><span class="hljs-string">"|"</span><span class="hljs-keyword">in</span> line:
                agent_type, task_desc = line.split(<span class="hljs-string">"|"</span>, <span class="hljs-number">1</span>)
                agent_type = agent_type.strip().lower()
                <span class="hljs-keyword">if</span> agent_type <span class="hljs-keyword">in</span> self.sub_agents:
                    tasks.append({<span class="hljs-string">"agent"</span>: agent_type, <span class="hljs-string">"task"</span>: task_desc.strip()})
        
        <span class="hljs-comment"># 默认任务流程（如果LLM分解失败）</span>
        ifnot tasks:
            tasks = [
                {<span class="hljs-string">"agent"</span>: <span class="hljs-string">"researcher"</span>, <span class="hljs-string">"task"</span>: <span class="hljs-string">f"搜索关于'<span class="hljs-subst">{query}</span>'的信息"</span>},
                {<span class="hljs-string">"agent"</span>: <span class="hljs-string">"data_analyst"</span>, <span class="hljs-string">"task"</span>: <span class="hljs-string">f"分析'<span class="hljs-subst">{query}</span>'相关数据"</span>},
                {<span class="hljs-string">"agent"</span>: <span class="hljs-string">"reporter"</span>, <span class="hljs-string">"task"</span>: <span class="hljs-string">"整合以上结果生成报告"</span>},
            ]
        
        <span class="hljs-comment"># 保存计划到内存</span>
        self.memory.append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"plan"</span>, <span class="hljs-string">"tasks"</span>: tasks})
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📋 任务分解完成，共<span class="hljs-subst">{<span class="hljs-built_in">len</span>(tasks)}</span>个子任务"</span>)
        <span class="hljs-keyword">return</span> tasks
    
    asyncdef _execute_parallel_tasks(self, tasks: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""并行执行子任务"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🚀 开始并行执行 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(tasks)}</span> 个子任务..."</span>)
        
        <span class="hljs-comment"># 创建并行任务</span>
        coroutines = []
        <span class="hljs-keyword">for</span> task_info <span class="hljs-keyword">in</span> tasks:
            agent = self.sub_agents[task_info[<span class="hljs-string">"agent"</span>]]
            coroutines.append(agent.execute(task_info[<span class="hljs-string">"task"</span>]))
        
        <span class="hljs-comment"># 并行执行所有子智能体任务</span>
        results = <span class="hljs-keyword">await</span> asyncio.gather(*coroutines, return_exceptions=<span class="hljs-literal">True</span>)
        
        <span class="hljs-comment"># 处理结果</span>
        valid_results = []
        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results:
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(r, Exception):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"⚠️ 子任务执行失败: <span class="hljs-subst">{r}</span>"</span>)
            <span class="hljs-keyword">else</span>:
                valid_results.append(r)
                self.memory.append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"result"</span>, <span class="hljs-string">"data"</span>: r})
        
        <span class="hljs-keyword">return</span> valid_results
    
    asyncdef _synthesize_results(self, results: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""综合所有子智能体结果"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🔄 主智能体正在综合 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> 个结果..."</span>)
        
        <span class="hljs-comment"># 构建综合提示</span>
        results_text = <span class="hljs-string">"\n"</span>.join([
            <span class="hljs-string">f"- <span class="hljs-subst">{r[<span class="hljs-string">'agent'</span>]}</span>: <span class="hljs-subst">{r[<span class="hljs-string">'result'</span>]}</span>"</span><span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results
        ])
        
        response = <span class="hljs-keyword">await</span> llm.ainvoke([
            SystemMessage(content=<span class="hljs-string">"你是一个信息综合专家，负责整合多个智能体的执行结果，生成完整、连贯的最终回答。"</span>),
            HumanMessage(content=<span class="hljs-string">f"请综合以下各智能体的执行结果:\n<span class="hljs-subst">{results_text}</span>"</span>)
        ])
        
        <span class="hljs-keyword">return</span> response.content
    
    asyncdef run(self, query: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""运行多智能体系统"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🎯 多智能体系统启动"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📝 用户查询: <span class="hljs-subst">{query}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        
        <span class="hljs-comment"># 1. 任务分解</span>
        tasks = <span class="hljs-keyword">await</span> self._decompose_task(query)
        
        <span class="hljs-comment"># 2. 并行执行子任务</span>
        results = <span class="hljs-keyword">await</span> self._execute_parallel_tasks(tasks)
        
        <span class="hljs-comment"># 3. 综合结果</span>
        final_answer = <span class="hljs-keyword">await</span> self._synthesize_results(results)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 多智能体系统执行完成"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        
        <span class="hljs-keyword">return</span> final_answer

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第四部分：运行示例</span>
<span class="hljs-comment"># ============================================</span>

asyncdef main():
    <span class="hljs-string">"""运行多智能体系统示例"""</span>
    master = MasterAgent()
    
    <span class="hljs-comment"># 测试查询</span>
    query = <span class="hljs-string">"分析2025年人工智能行业的发展趋势，并给出投资建议"</span>
    
    result = <span class="hljs-keyword">await</span> master.run(query)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📊 最终报告"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(result)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<h3 data-id="heading-11">可靠性和工程挑战</h3>
<p>在传统软件中，一个错误可能会导致功能失效、性能下降或系统宕机，而在智能体系统中，微小的变化也会引发巨大的行为改变，这使得为需要在长时间运行的进程中维护状态的复杂智能体编写代码变得异常困难，那我们应该怎么做？</p>
<ul>
<li>智能体是有状态的，错误会不断累积，我们需要做好容错和沙盒环境。<br/>
智能体可以长时间运行，并在多次工具调用中保持状态，这意味着我们需要持久地执行代码，并在执行过程中处理错误，如果没有有效的缓解措施，即使是轻微的系统故障也可能对智能体造成灾难性后果，当错误发生时，我们不能简单地从头开始：重启成本高昂，因此我们需要构建可以从错误发生时智能体所在位置恢复运行的系统。</li>
<li>构建完整的可观测系统，如果某个智能体不符合预期，应该分析原因。<br/>
智能体会做出动态决策，即使提示信息完全相同，每次运行的结果也并不确定，这使得调试更加困难，智能体使用了错误的搜索查询？选择了不合适的数据源？还是遇到了工具故障？添加完整的生产环境跟踪功能后，我们能够诊断智能体故障的原因并系统地修复问题，除了标准的可观测性之外，我们还监控智能体的决策模式和交互结构，这种高层次的可观测性帮助我们诊断根本原因、发现异常行为并修复常见故障。</li>
<li>智能体同步执行会造成瓶颈，尽可能使用并行处理。<br/>
主智能体同步执行子智能体，等待每组子智能体完成任务后再继续执行下一个，这简化了协调，但也造成了智能体间信息流的瓶颈，例如，主智能体无法控制子代智能体，子智能体之间也无法协调，整个系统可能会因为等待单个子智能体完成搜索而被阻塞，异步执行可以实现更高的并行性：智能体可以并发工作，并在需要时创建新的子智能体，当然这种异步性也带来了结果协调、状态一致性和错误在子智能体间传播方面的挑战。</li>
<li>智能体的可测试性在线上运行十分重要。<br/>
传统的软件对一些子功能我们通常会进行单元测试，这个功能点同样适用于构建的智能体，特别是对于那些希望输入和输出需要保持一致性的智能体系统，那该如何实现？首先智能体功能测试不应该依赖单个大模型；其次将功能测试用例拆分输入和预期输出，对于一些强校验的功能，智能体调用子智能体和系统API的所有的输出应该保持预期测试执行流程一致，才算通过测试用例；最后大模型多次对相同的输入不一定获得相同的结果，所以测试用例应该是多次运行，通过率应该通过次数/执行次数的方式来统计。</li>
</ul>
<h2 data-id="heading-12">参考</h2>
<p>（1）<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaggle.com%2Flearn-guide%2F5-day-agents" target="_blank" title="https://www.kaggle.com/learn-guide/5-day-agents" ref="nofollow noopener noreferrer">www.kaggle.com/learn-guide…</a><br/>
（2）<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fai-agents-for-beginners%2Fblob%2Fmain%2Ftranslations%2Fzh%2FREADME.md" target="_blank" title="https://github.com/microsoft/ai-agents-for-beginners/blob/main/translations/zh/README.md" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a><br/>
（3）<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHuggingAGI%2FAwesomeAgentPapers" target="_blank" title="https://github.com/HuggingAGI/AwesomeAgentPapers" ref="nofollow noopener noreferrer">github.com/HuggingAGI/…</a><br/>
（4）<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fbuilding-effective-agents" target="_blank" title="https://www.anthropic.com/engineering/building-effective-agents" ref="nofollow noopener noreferrer">www.anthropic.com/engineering…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[完蛋了，用户登录token集体失效，我的拖字诀还是好用]]></title>    <link>https://juejin.cn/post/7591346773827223578</link>    <guid>https://juejin.cn/post/7591346773827223578</guid>    <pubDate>2026-01-04T11:00:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827223578" data-draft-id="7591346773827190810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="完蛋了，用户登录token集体失效，我的拖字诀还是好用"/> <meta itemprop="keywords" content="Redis"/> <meta itemprop="datePublished" content="2026-01-04T11:00:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="纸仓"/> <meta itemprop="url" content="https://juejin.cn/user/1812410601572599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            完蛋了，用户登录token集体失效，我的拖字诀还是好用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1812410601572599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    纸仓
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:00:46.000Z" title="Sun Jan 04 2026 11:00:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前两天测试同学在群里反馈说测试环境经常会自动退出登录，需要手动重新登录，很麻烦。</p>
<p>本着不主动揽活的原则，我当时眼睛突然就瞎了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b867af0b34d04a5ca4734adfb87f41be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=C1CVKl%2FQ8b%2FP3mr8OVWtCxXfsIE%3D" alt="image.png" loading="lazy"/></p>
<p>好景说长也长说短也短，5个月之后，其他同事也陆续反馈，估计真受不了了。</p>
<p>老大特意@了我，我当时眼睛也正好瞎了，不过有一个前端同学眼睛贼好。老大顺带@了他，他说他要试试。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/214901dc3a364f6b8f051b0c2d9e2442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=JHT9Pg6PC2b34vFsSvYU%2BjujFfU%3D" alt="image.png" loading="lazy"/></p>
<p>确实 token 有可能前端“无意间”调用了登出接口，导致的过期。这个想法非常合理。</p>
<p>我承认我应该向他学习的，但我手上的活实在是太多了。每次和 AI 神仙打架，AI 都表现得跟条死鱼一样，我不得不花时间和她多说几次：“给我可以运行的代码！！！”</p>
<p>后面前端哥们估计也是找不出原因来，这个事情就又搁置下来了，没人记得我，也没人在乎我。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/229fe39545ec410880871653d8f6fad7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=ULNTPgfT3bOY%2BhT55sH8TxWqdp0%3D" alt="image.png" loading="lazy"/></p>
<p>痛吗？怎么可能痛？爽飞了。</p>
<p>但是，但是，但是。好景再一次不长。这次老大直接@我一个人了，要命的是老板还点了个+1。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f74e6fe3314d1da2cefdece59c53a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=%2BecHEzjFuaNBIeFSJx1U7WfxHHc%3D" alt="image.png" loading="lazy"/></p>
<p>为了避免年底喜提年终，我不得不先应下来，但也是能拖就拖。毕竟和 AI 神仙打架好玩点，看起来就是在使用前沿科技 vibe coding，实际上就是和 AI 对线扭打。</p>
<p>每天的类不再是身体的，而是骂不过 AI 的心累。哎，同时代码写的依托答辩，我还能喷赢他。如今连机器人写出依托答辩出来，我都骂不过，我真是个垃圾啊。</p>
<p>玩归玩闹归闹，找bug还得有人靠。于是我广发英雄帖，征求各大 AI 大佬的意见。他们从没如此一致过，说是我的用户登录态过期了，或者是误删了。</p>
<p>要不我学过点 Redis 皮毛还真被这些带佬蒙过去了。鄙人想偷懒才让你们分析，分析不对我自己也略懂一些拳脚。</p>
<p>再来回看 bug 的表现：</p>
<ul>
<li>没有登出的时候token失效了</li>
<li>几个人集体发生</li>
<li>生产环境没有出现</li>
<li>生产环境和测试环境代码一样</li>
<li>近期没有改动账户服务</li>
</ul>
<p>代码一样，那就找不一样的。那比较明显了，环境不一样，一个叫生产一个叫测试。嘿嘿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a22add561c604442bf6cd167a9c78f39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=3OP%2Bvr0%2FhXRknNoH3Ne1f72VtW8%3D" alt="image.png" loading="lazy"/></p>
<p>这就涉及到一个哲学问题：测试环境为什么叫测试环境？生产环境为什么叫生产环境？</p>
<p>一般来说就是测试环境是用来测试的，正式环境一般是给用户用来生产的。牛逼吧？</p>
<p>说人话就是测试环境是给内部人用的，正式环境是给义父们用的。</p>
<p>再说人话就是，内部人能有几个人，老板给个配置最差的 Redis，你都不能怨他。</p>
<p>所以我的猜想是什么呢？就是生产环境的 Redis 配置很高，测试环境的配置很低。</p>
<p>Redis 用的默认的内存策略 LRU，所以内存满了就会驱逐一部分 Key。</p>
<p>有了这个猜想，接下我们就要来验证一下猜想是否准确？</p>
<p>我看了一下生产环境和测试环境之间的差不别，你猜怎么着？</p>
<p>测试和生产之间的差别就是：生产的 Redis 内存 256G，测试的 Redis 内存 16M。</p>
<p>是的你妹看错，是16M。不是16G也不是256M，而是整整16M啊。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b7d893fbe984f94a4764b5ec89cdff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=MzdbMlsAp2h8fw3HPGk72RtTbO4%3D" alt="image.png" loading="lazy"/></p>
<p>多磨勤俭持家的老板啊，为了省下点钱给我们发年终，涨工资。</p>
<p>他都不惜买最低配的服务器，给自己买最低配的跑车。一切都是为了员工的收入，也能理解。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b984e502db2140c3874016e1acabc416~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=jRWJG9iJYOT4dHwTZN3LmChtTEs%3D" alt="image.png" loading="lazy"/></p>
<p>这个配置文件显示测试环境运行的 Redis 就是16M的内存，还显示达到最大内存时的淘汰策略是 lru。</p>
<p>也就是内存满时，把最近最少使用的key给干掉，腾出存储空间来。</p>
<p>不信邪可以在 Redis-cli 执行命令看看实际上是不是这样</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">INFO MEMORY</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Memory</span>
used_memory_human:8.47M
maxmemory_human:16.00M
maxmemory_policy:allkeys-lru
....

</code></pre>
<p>心死了，还真是，再查一下被驱逐的 key 有多少</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">INFO STATS</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Stats</span>
evicted_keys:53725
...

</code></pre>
<p>这下心死透了，直接联系老板手下的运维大将，能不能将 16M 的 Redis 做个升级，升级到 32M？</p>
<p>没想到运维大将竟然直接答应了，还给升级到了 256M，我真是太感谢他了。还好有他，不然我元旦出门都要带电脑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44ca157c4f064be1a3aabacc756ac045~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=teh%2FoJmkDttFa5CrVcoLbDFDk%2FQ%3D" alt="image.png" loading="lazy"/></p>
<p>就酱。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80afa95826974743a17bea63e54fa848~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=TTcsDd%2BM%2FxZbcaVZ5rJJUJ0jCq4%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini Chat Completion API 申请及使用]]></title>    <link>https://juejin.cn/post/7591156262625902627</link>    <guid>https://juejin.cn/post/7591156262625902627</guid>    <pubDate>2026-01-04T11:01:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591156262625902627" data-draft-id="7591330139082899471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini Chat Completion API 申请及使用"/> <meta itemprop="keywords" content="Gemini,ChatGPT,API"/> <meta itemprop="datePublished" content="2026-01-04T11:01:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini Chat Completion API 申请及使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:01:33.000Z" title="Sun Jan 04 2026 11:01:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Google Gemini 是一款非常强大的 AI 对话系统，只要输入提示词，就能在短短几秒内生成流畅自然的回复。Gemini 都能提供令人惊叹的智能协助，极大地提高了人类的工作效率和创造力。</p>
<p>本文档主要介绍 Gemini Chat Completion API 操作的使用流程，利用它我们可以轻松使用官方 Gemini 的对话功能。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 Gemini Chat Completion API，首先可以到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fae54bf9b-af41-4072-b969-3756b6d66834" target="_blank" title="https://platform.acedata.cloud/documents/ae54bf9b-af41-4072-b969-3756b6d66834" ref="nofollow noopener noreferrer">Gemini Chat Completion API</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2c0942732834f97b2988261219becfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=N9dnyGNEk4OCusElZPAUkFtABeM%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>接下来就可以在界面上填写对应的内容，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f49faf02a464bcd9786706cf4c0ce88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=jxrtsoEgANLF6460vNV%2BvYNfglY%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>在第一次使用该接口时，我们至少需要填写三个内容，一个是 <code>authorization</code>，直接在下拉列表里面选择即可。另一个参数是 <code>model</code>， <code>model</code> 就是我们选择使用 Gemini 官网模型类别，这里我们主要有 6 种模型，详情可以看我们提供的模型。最后一个参数是<code>messages</code>，<code>messages</code>是我们输入的提问词数组，它是一个数组，表示可以同时上传多个提问词，每个提问词包含了 <code>role</code> 和 <code>content</code>，其中 <code>role</code> 表示提问者的角色，我们提供了三种身份，分别为 <code>user</code> 、<code>assistant</code>、<code>system</code> 。另一个 <code>content</code> 就是我们提问的具体内容。</p>
<p>同时您可以注意到右侧有对应的调用代码生成，您可以复制代码直接运行，也可以直接点击「Try」按钮进行测试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3200cf144b4d4aca88a1e32621b52ca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=j55w7iX6PI1drFcGipKPp2HhpQw%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>调用之后，我们发现返回结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122212413908150493uPhjTUO9"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763817866</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"I am a large language model, trained by Google."</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**My Reasoning: Answering the User's Question**\n\nOkay, here's how I'm going to approach answering the user's question, \"What model are you?\". The core is to be direct and informative. First, I have to be clear about my origin. Then, I need to make sure the explanation is accessible, given that the user may not be familiar with technical jargon. I need to explain what a \"large language model\" actually *does*, and provide relatable examples. I know the user might be looking for a specific name, like other models have, so I'll address that directly and then wrap it up with an invitation to continue.\n\nSo, here's my plan:\n\n1.  **Lead with the key info:** I'll begin by stating that I am a large language model created by Google. That is the fundamental, most critical piece of the puzzle.\n2.  **Define the buzzword:** Then, I'll explain that \"large language model\" in simple terms. I'll explain what I *do* - process and generate text; how I *do* it - by training on huge amounts of text data; and the *goal* - to be able to communicate like a human.\n3.  **Provide context:** After that, to make the concept even clearer, I'll provide a list of examples of my capabilities. I'll mention things like answering questions, summarizing texts, writing stories, translating languages, and brainstorming ideas.\n4.  **Acknowledge the lack of a personal name:** I'll anticipate the likely question about a model name (like ChatGPT) by clearly stating that I don't have a personal name and that it's best to think of me as an AI assistant from Google.\n5.  **End with an invitation:** Lastly, I'll end with a simple, friendly question to invite further interaction and to guide the conversation.\n\nWith this approach, I am confident I can successfully answer this important question.\n"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">932</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">940</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">921</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>id</code>，生成此次对话任务的 ID，用于唯一标识此次对话任务。</li>
<li><code>model </code>，选择的 Gemini 官网模型。</li>
<li><code>choices</code>，Gemini 针对提问词给于的回答信息。</li>
<li><code>usage </code>：针对本次问答对 token 的统计信息。</li>
</ul>
<p>其中 <code>choices</code> 是包含了 Gemini 的回答信息，它里面的 <code>choices</code> 是 Gemini回答的具体信息，可以发现如图所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c43b1d733fcf40be8cc74dce7afa63f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=4Tujg%2FDuQPcHgOv%2BLuztpq0tvUM%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>可以看到，<code>choices</code> 里面的 <code>content</code> 字段包含了 Gemini 回复的具体内容。</p>
<h2 data-id="heading-2">流式响应</h2>
<p>该接口也支持流式响应，这对网页对接十分有用，可以让网页实现逐字显示效果。</p>
<p>如果想流式返回响应，可以更改请求头里面的 <code>stream </code> 参数，修改为 <code>true</code>。</p>
<p>修改如图所示，不过调用代码需要有对应的更改才能支持流式响应。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16b8b12fe4ca4d1ba8c1c6ebac490196~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=7jH%2B0DEnjjyLim0DcsCShydqJLY%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>将 <code>stream</code> 修改为 <code>true</code> 之后，API 将逐行返回对应的 JSON 数据，在代码层面我们需要做相应的修改来获得逐行的结果。</p>
<p>Python 样例调用代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"gemini-2.5-pro"</span>,
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello,What model are you?"</span>}],
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">True</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>输出效果如下：</p>
<pre><code class="hljs language-json" lang="json">data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**Define My Nature**\n\nMy thinking has started. The user wants to know my nature, asking a direct \"what are you?\" The initial step was straightforward: identifying the query. Now, I recall my fundamental identity: I'm a large language model. This is the core truth I aim to convey.\n\n\n"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**Refining My Response**\n\nI've added the crucial information that I'm trained by Google to the basic \"large language model\" identity. My next step is considering what being a \"large language model\" actually entails, so I can explain my core capabilities. I'm focusing on providing context without going into specific technical details or model names. I want to convey my function in a way the user can easily understand.\n\n\n"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**Confirming Core Identity**\n\nI'm now solidifying my response. The user's query about my model affiliation needs a focused answer. I've pinpointed that \"trained by Google\" is essential, providing key context. I'm resisting the urge to mention any specific model names, as it's not relevant. The aim is to deliver a direct, accurate statement. My goal remains a clear and concise reply, avoiding technical jargon and getting straight to the relevant point.\n\n\n"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"I am a large language model, trained by Google."</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">527</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">535</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">519</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>DONE<span class="hljs-punctuation">]</span>
</code></pre>
<p>可以看到，响应里面有许多 <code>data</code> ，<code>data</code> 里面的 <code>choices</code> 即为最新的回答内容，与上文介绍的内容一致。<code>choices</code> 是新增的回答内容，您可以根据结果来对接到您的系统中。同时流式响应的结束是根据 <code>data</code> 的内容来判断的，如果内容为 <code>[DONE]</code>，则表示流式响应回答已经全部结束。返回的 <code>data</code> 结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>id</code>，生成此次对话任务的 ID，用于唯一标识此次对话任务。</li>
<li><code>model </code>，选择的 Gemini 官网模型。</li>
<li><code>choices</code>，Gemini 针对提问词给于的回答信息。</li>
</ul>
<p>JavaScript 也是支持的，比如 Node.js 的流式调用代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">method</span>: <span class="hljs-string">"post"</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
  },
  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"gemini-2.5-pro"</span>,
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello,What model are you?"</span>}],
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">true</span>
  })
};

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>, options)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<p>Java 样例代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();
jsonObject.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"gemini-2.5-pro"</span>);
jsonObject.put(<span class="hljs-string">"messages"</span>, [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello,What model are you?"</span>}]);
jsonObject.put(<span class="hljs-string">"stream"</span>, <span class="hljs-literal">true</span>);
<span class="hljs-type">MediaType</span> <span class="hljs-variable">mediaType</span> <span class="hljs-operator">=</span> <span class="hljs-string">"application/json; charset=utf-8"</span>.toMediaType();
<span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> jsonObject.toString().toRequestBody(mediaType);
<span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()
  .url(<span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>)
  .post(body)
  .addHeader(<span class="hljs-string">"accept"</span>, <span class="hljs-string">"application/json"</span>)
  .addHeader(<span class="hljs-string">"authorization"</span>, <span class="hljs-string">"Bearer {token}"</span>)
  .addHeader(<span class="hljs-string">"content-type"</span>, <span class="hljs-string">"application/json"</span>)
  .build();

<span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();
<span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.newCall(request).execute();
System.out.print(response.body!!.string())
</code></pre>
<p>其他语言可以另外自行改写，原理都是一样的。</p>
<h2 data-id="heading-3">多轮对话</h2>
<p>如果您想要对接多轮对话功能，需要对 <code>messages</code> 字段上传多个提问词，多个提问词的具体示例如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7425b64a89a48dfaad3494bc36c934a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=ffGWimzHBCZcfuu2v8QEV6DdQ0I%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>Python 样例调用代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"gemini-2.5-pro"</span>,
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello"</span>},{<span class="hljs-string">"role"</span>:<span class="hljs-string">"assistant"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello there! How can I help you today?"</span>},{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"What model are you?"</span>}]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>通过上传多个提问词，就可以轻松实现多轮对话，可以得到如下回答：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214426669120974AKFwnJd1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763819072</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"I am a large language model, trained by Google."</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Okay, here's how I'd approach this, thinking as a sophisticated AI:\n\nFirst, the user is directly querying my core identity: \"What model are you?\" That's a simple, straightforward question. My primary task is to provide accurate and helpful information, so I need to answer this immediately.\n\nRight off the bat, I know the answer. I *am* a large language model. That's my fundamental architecture and operational principle. I'm built on a vast network of connections and trained on a massive dataset.\n\nThen I must add the necessary context. Crucially, I have to provide the source of my training. I *was* trained by Google. That's a key identifier. It provides the user with valuable information about my origin and potential biases (though I'm trained to mitigate them).\n\nNow I must construct the response. My goal is to be factual, concise, and understandable.\n\nThe synthesized response is something like: \"I am a large language model, trained by Google.\"\n\nI have to assess the output: Does it meet the criteria? It's clear. It states what I am, it includes a critical piece of information on my origins, and it avoids jargon. No misleading promises.\n\nFinal verification: Does it actually answer the question? Yes. Is the information correct and truthful? Yes. Is it concise? Absolutely. Is the tone appropriate for any user? Yes. And, finally, this is the standard, approved response. Excellent.\n"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">265</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">281</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">254</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，<code>choices</code> 包含的信息与基本使用的内容是一致的，这个包含了 Gemini 针对多个对话进行回复的具体内容，这样就可以根据多个对话内容来回答对应的问题了。</p>
<h2 data-id="heading-4">Gemini-3.0 多模态模型</h2>
<p>请求样例：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"messages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"图片的内容是什么？"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image_url"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn.acedata.cloud/qzx2z1.png"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"stream"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>样例结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251206001815715692730UVZe38kB"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1764951548</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"这是一张年轻女性的户外半身人像照片。\n\n以下是图片的主要内容描述：\n\n*   **人物外貌**：照片中的女孩留着一头乌黑柔顺的长直发，五官清秀，皮肤白皙。她面带温柔的微笑，目光注视着镜头。\n*   **穿着打扮**：她穿着一件米白色或浅杏色的泡泡袖上衣，外面搭配着黑色的衣物（看起来像是背带裙或马甲）。\n*   **光影氛围**：阳光从左侧后方照射过来，洒在她的头发上，形成了一圈温暖的金黄色光晕，营造出一种清新、唯美的氛围。\n*   **背景**：背景被虚化处理，可以看出是在户外，身后是一条空旷的路面（柏油路）以及路边的绿色树木。\n\n整体来看，这张照片给人一种甜美、阳光和邻家女孩的感觉。"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1092</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1271</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2363</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1072</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>当然你也可以传如视频的链接，具体的输入如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"messages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"视频的内容是什么？"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image_url"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn.acedata.cloud/58yioe.mp4"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"stream"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>样例结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251206002711949677736JC9yL8AE"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1764952060</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"这段视频的内容充满趣味，主要展示了一只**橘猫**在黄昏时分的乡间公路上自信小跑的情景。\n\n具体细节如下：\n\n1.  **画面内容**：\n    *   主角是一只橘色的虎斑猫。\n    *   背景是夕阳西下（或清晨）的时刻，光线金黄柔和。路边有木质栅栏和旷野，远处还有一个行人的剪影。\n    *   镜头采用了低角度拍摄，时而拍摄猫咪迎面跑来，时而拍摄它离去的背影，还有猫咪面部和花纹的特写。\n\n2.  **声音特点（关键点）**：\n    *   视频的配音非常有特色。虽然画面是轻盈的猫咪在跑，但配上的声音却是**沉重且有节奏的马蹄声**（或者是类似木屐/高跟鞋敲击路面的声音）。\n    *   这种声音与画面的反差制造了一种幽默感，仿佛这只猫咪把自己当成了一匹正在驰骋的骏马。\n\n总的来说，这是一个利用音画反差来制造萌点和笑点的宠物视频。"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">915</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1423</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2338</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1162</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>从上面可以看出是Gemini 3.0模型可以支持多模态的理解的。</p>
<h2 data-id="heading-5">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-6">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">结论</h2>
<p>通过本文档，您已经了解了如何使用 Gemini Chat Completion API 轻松实现官方 Gemini 的对话功能。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot：Java开发的神奇加速器（二）]]></title>    <link>https://juejin.cn/post/7591013450525638708</link>    <guid>https://juejin.cn/post/7591013450525638708</guid>    <pubDate>2026-01-04T07:45:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591013450525638708" data-draft-id="7591013450525622324" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot：Java开发的神奇加速器（二）"/> <meta itemprop="keywords" content="Spring Boot,后端"/> <meta itemprop="datePublished" content="2026-01-04T07:45:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot：Java开发的神奇加速器（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T07:45:10.000Z" title="Sun Jan 04 2026 07:45:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">四、深入理解 Spring Boot 配置</h3>
<h4 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.1 配置文件类型</h4>
<blockquote>
<p>在 Spring Boot 应用中，主要有两种配置文件类型，即application.properties和application.yml（或application.yaml），它们都用于配置应用程序的各种属性，但在语法和格式上有所不同。</p>
</blockquote>
<blockquote>
<ul>
<li>
<p><strong>application.properties</strong>：这是一种传统的属性文件格式，使用键值对的方式进行配置，每个属性占一行，以key=value的形式表示。例如：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8080</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/mydb
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-number">123456</span>
AI写代码TypeScript
运行
</code></pre>
<p>这种格式的优点是简单直观，易于理解和编写，适合简单的配置场景。缺点是对于复杂的配置，尤其是具有层级结构的配置，会显得不够灵活和清晰，因为它只能通过点号（.）来模拟层级关系，例如spring.datasource.url，但对于更复杂的嵌套结构，代码会变得冗长且难以维护。</p>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>
<p><strong>application.yml</strong>：它采用 YAML（YAML Ain't Markup Language）格式，使用缩进和冒号来表示属性的层级关系，具有更好的可读性和层次性。例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mydb</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>YAML 格式的优势在于能够清晰地展示配置的层级结构，对于复杂的配置更加友好，易于维护和管理。同时，它还支持列表和嵌套对象的表示，例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">my:</span>
  <span class="hljs-attr">servers:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.101</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>但需要注意的是，YAML 对缩进的要求非常严格，缩进错误可能会导致配置解析失败。在使用时，务必确保缩进的一致性和正确性。</p>
<p>两种配置文件在功能上是等价的，Spring Boot 会自动加载并解析它们。开发者可以根据个人喜好和项目的实际需求来选择使用哪种格式。一般来说，对于简单的项目或配置较少的情况，application.properties可能更方便；而对于大型项目或复杂的配置场景，application.yml则能更好地展现其优势。</p>
</li>
</ul>
</blockquote>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2 常用配置项</h4>
<blockquote>
<p>Spring Boot 应用的配置项非常丰富，涵盖了服务器、数据库、日志、安全等多个方面。以下是一些常用的配置项及其配置方法：</p>
</blockquote>
<blockquote>
<p><strong>服务器端口配置</strong>：在开发和部署 Spring Boot 应用时，经常需要修改服务器的端口号，以避免与其他应用冲突或满足特定的部署需求。可以在application.properties或application.yml文件中进行配置。</p>
</blockquote>
<blockquote>
<ul>
<li>
<p>在application.properties中配置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8081</span>
AI写代码TypeScript
运行
</code></pre>
</li>
<li>
<p>在application.yml中配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>除了在配置文件中设置，还可以通过命令行参数的方式来指定端口号，这种方式在测试或临时部署时非常方便。例如：</p>
<pre><code class="hljs language-ini" lang="ini">java -jar your - application.jar <span class="hljs-attr">--server.port</span>=<span class="hljs-number">8082</span>
AI写代码TypeScript
运行
</code></pre>
<p>命令行参数的优先级高于配置文件中的配置，即如果同时在配置文件和命令行中设置了端口号，应用会采用命令行中指定的端口。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>数据库连接配置</strong>：在大多数 Web 应用中，与数据库进行交互是必不可少的。Spring Boot 支持多种数据库，如 MySQL、PostgreSQL、H2 等，配置方式也相对简单。以 MySQL 数据库为例，在application.properties中配置如下：</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/mydb?useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-number">123456</span>
spring.datasource.driver - class - <span class="hljs-attr">name</span>=com.mysql.cj.jdbc.Driver
AI写代码TypeScript
运行
</code></pre>
<blockquote>
<p> 在application.yml中配置则为：</p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mydb?useSSL=false&amp;serverTimezone=UTC</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">driver - class - name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<blockquote>
<p>其中，spring.datasource.url指定了数据库的连接地址，包括主机名、端口号和数据库名，?useSSL=false&amp;serverTimezone=UTC是一些连接参数，用于禁用 SSL 连接和设置时区；spring.datasource.username和spring.datasource.password分别是数据库的用户名和密码；spring.datasource.driver - class - name指定了数据库驱动类，对于 MySQL 8 及以上版本，通常使用com.mysql.cj.jdbc.Driver。</p>
</blockquote>
<blockquote>
<p>如果使用的是其他数据库，如 H2 嵌入式数据库，配置会有所不同。在application.properties中配置：</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:h2:mem:testdb
spring.datasource.driver - class - <span class="hljs-attr">name</span>=org.h2.Driver
<span class="hljs-attr">spring.datasource.username</span>=sa
<span class="hljs-attr">spring.datasource.password</span>=password
AI写代码TypeScript
运行
</code></pre>
<blockquote>
<p>在application.yml中配置： </p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:h2:mem:testdb</span>
    <span class="hljs-attr">driver - class - name:</span> <span class="hljs-string">org.h2.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">sa</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">password</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<blockquote>
<p>这里jdbc:h2:mem:testdb表示使用内存中的 H2 数据库，数据库名为testdb。</p>
</blockquote>
<blockquote>
<p><strong>日志配置</strong>：日志在应用开发和运维中起着至关重要的作用，它可以帮助我们记录应用的运行状态、排查问题等。Spring Boot 默认使用 Logback 作为日志框架，通过配置文件可以灵活地控制日志的输出级别、格式和目标等。在application.properties中配置日志示例如下：</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 根日志级别</span>
<span class="hljs-attr">logging.level.root</span>=INFO
<span class="hljs-comment"># 指定包下的日志级别</span>
<span class="hljs-attr">logging.level.com.example.myapp</span>=DEBUG
<span class="hljs-comment"># 日志文件名称</span>
<span class="hljs-attr">logging.file.name</span>=myapp.log
<span class="hljs-comment"># 日志文件路径</span>
<span class="hljs-attr">logging.file.path</span>=/var/log/myapp/
AI写代码TypeScript
运行
</code></pre>
<blockquote>
<p>在application.yml中配置：</p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">INFO</span>
    <span class="hljs-attr">com.example.myapp:</span> <span class="hljs-string">DEBUG</span>
  <span class="hljs-attr">file:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">myapp.log</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">/var/log/myapp/</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<blockquote>
<p>上述配置中，logging.level.root设置了根日志级别为INFO，表示只输出INFO级别及以上的日志；<a href="https://link.juejin.cn?target=http%3A%2F%2Flogging.level.com%2F" title="http://logging.level.com/" target="_blank" ref="nofollow noopener noreferrer">logging.level.com</a>.example.myapp将com.example.myapp包下的日志级别设置为DEBUG，这样该包下的详细调试信息也会被记录；logging.file.name指定了日志文件的名称为myapp.log，logging.file.path指定了日志文件的存储路径为/var/log/myapp/。如果不指定路径，日志文件会生成在项目的根目录下。</p>
</blockquote>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.3 自定义配置</h4>
<blockquote>
<p>除了使用 Spring Boot 提供的默认配置项和常用配置项外，我们还可以根据项目的业务需求自定义配置属性，并将其注入到 Java 类中使用。以下是实现自定义配置的详细步骤：</p>
</blockquote>
<blockquote>
<p><strong>1.在配置文件中定义自定义属性</strong>：首先，在application.properties或application.yml文件中添加自定义的配置属性。例如，在application.properties中添加：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">myapp.custom.name</span>=Spring Boot自定义配置示例
<span class="hljs-attr">myapp.custom.value</span>=<span class="hljs-number">123</span>
AI写代码TypeScript
运行
</code></pre>
<p>在application.yml中添加：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">myapp:</span>
  <span class="hljs-attr">custom:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Boot自定义配置示例</span>
    <span class="hljs-attr">value:</span> <span class="hljs-number">123</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
</blockquote>
<blockquote>
<p> 2.<strong>创建 Java 类来接收配置属性</strong>：然后，创建一个 Java 类，使用@ConfigurationProperties注解来绑定配置文件中的属性。假设我们创建一个名为MyAppConfig的类，代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">context</span>.<span class="hljs-property">properties</span>.<span class="hljs-property">ConfigurationProperties</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;
 
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"myapp.custom"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAppConfig</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">private</span> int value;
 
    <span class="hljs-comment">// 生成getter和setter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> name;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
 
    <span class="hljs-keyword">public</span> int <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> value;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setValue</span>(<span class="hljs-params">int value</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个类中，@Component注解将其标记为一个 Spring 组件，使其能够被 Spring 容器扫描并管理。@ConfigurationProperties(prefix = "myapp.custom")注解表示将配置文件中以myapp.custom为前缀的属性绑定到该类的属性上，例如myapp.custom.name会绑定到name属性，myapp.custom.value会绑定到value属性。</p>
</blockquote>
<blockquote>
<p><strong>3.使用自定义配置属性</strong>：在其他类中，通过依赖注入的方式获取MyAppConfig实例，就可以使用自定义的配置属性了。例如，创建一个控制器类CustomConfigController：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
 
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomConfigController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MyAppConfig myAppConfig;
 
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/custom-config"</span>)</span>
    <span class="hljs-keyword">public</span> String getCustomConfig() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"自定义配置名称: "</span> + myAppConfig.getName() + <span class="hljs-string">", 自定义配置值: "</span> + myAppConfig.getValue();
    }
}
AI写代码TypeScript
运行
</code></pre>
</blockquote>
<blockquote>
<p>在这个控制器中，通过@Autowired注解将MyAppConfig实例注入到myAppConfig变量中，然后在getCustomConfig方法中使用其属性，返回自定义配置的信息。当访问/custom-config接口时，就可以看到输出的自定义配置内容。</p>
</blockquote>
<blockquote>
<p>通过上述步骤，我们实现了自定义配置属性并将其注入到 Java 类中使用，这种方式使得我们可以方便地管理和使用项目特定的配置信息，提高了应用的可配置性和灵活性。</p>
</blockquote>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>五、数据访问与持久化</h3>
<blockquote>
<p>在现代 Web 应用开发中，数据访问与持久化是至关重要的环节。它负责与数据库进行交互，实现数据的存储、读取、更新和删除等操作，是连接业务逻辑与数据存储的桥梁。Spring Boot 提供了强大的数据访问支持，结合 Spring Data JPA 等技术，能够极大地简化数据访问层的开发。</p>
</blockquote>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1 集成 Spring Data JPA</h4>
<blockquote>
<p>Spring Data JPA 是 Spring 框架的一个模块，它简化了与 Java 持久化 API（JPA）的交互，提供了一种声明式的数据访问方式。在 Spring Boot 应用中集成 Spring Data JPA，可以显著提高数据访问层的开发效率。以下是集成 Spring Data JPA 的详细步骤：</p>
</blockquote>
<blockquote>
<p><strong>1.添加依赖</strong>：在pom.xml文件中添加 Spring Data JPA 和数据库驱动的依赖。以 MySQL 数据库为例，添加如下依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Data JPA依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- MySQL数据库驱动依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
AI写代码TypeScript
运行
</code></pre>
<p>这里，spring-boot-starter-data-jpa依赖引入了 Spring Data JPA 的核心功能和相关组件，mysql-connector-java依赖则提供了与 MySQL 数据库进行交互的驱动程序。runtime表示该依赖仅在运行时需要，不会参与编译过程。</p>
</blockquote>
<blockquote>
<p><strong>2.配置数据源</strong>：在application.properties或application.yml文件中配置数据库连接信息，包括数据库的 URL、用户名、密码和驱动类名。在application.properties中配置如下：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/mydb?useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-number">123456</span>
spring.datasource.driver - class - <span class="hljs-attr">name</span>=com.mysql.cj.jdbc.Driver
AI写代码TypeScript
运行
</code></pre>
<p>在application.yml中配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mydb?useSSL=false&amp;serverTimezone=UTC</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">driver - class - name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>上述配置中，spring.datasource.url指定了 MySQL 数据库的连接地址，包括主机名<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%2F" title="http://localhost/" target="_blank" ref="nofollow noopener noreferrer">localhost</a>、端口号3306和数据库名mydb，?useSSL=false&amp;serverTimezone=UTC是连接参数，用于禁用 SSL 连接和设置时区为 UTC；spring.datasource.username和spring.datasource.password分别是数据库的用户名和密码；spring.datasource.driver - class - name指定了 MySQL 数据库的驱动类，对于 MySQL 8 及以上版本，通常使用com.mysql.cj.jdbc.Driver。</p>
</blockquote>
<blockquote>
<p><strong>3.配置 JPA</strong>：同样在配置文件中，配置 JPA 的相关属性，如数据库方言、实体扫描位置和 DDL 自动更新策略等。在application.properties中添加：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.jpa.hibernate.ddl-auto</span>=update
<span class="hljs-attr">spring.jpa.show-sql</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.jpa.properties.hibernate.dialect</span>=org.hibernate.dialect.MySQL5InnoDBDialect
AI写代码TypeScript
运行
</code></pre>
<p>在application.yml中添加：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">jpa:</span>
    <span class="hljs-attr">hibernate:</span>
      <span class="hljs-attr">ddl-auto:</span> <span class="hljs-string">update</span>
    <span class="hljs-attr">show-sql:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">properties:</span>
      <span class="hljs-attr">hibernate:</span>
        <span class="hljs-attr">dialect:</span> <span class="hljs-string">org.hibernate.dialect.MySQL5InnoDBDialect</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p> 其中，spring.jpa.hibernate.ddl-auto=update表示在应用启动时，根据实体类的定义自动更新数据库表结构，如果表不存在则创建；spring.jpa.show-sql=true表示在控制台打印 JPA 执行的 SQL 语句，方便调试；spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect指定了使用 MySQL 5 InnoDB 存储引擎的方言，用于生成针对 MySQL 数据库的 SQL 查询和语句。</p>
</blockquote>
<blockquote>
<p><strong>4.创建实体类</strong>：创建与数据库表对应的实体类，并使用 JPA 注解来标记实体类和字段。例如，创建一个User实体类，代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">Entity</span>;
<span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">GeneratedValue</span>;
<span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">GenerationType</span>;
<span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">Id</span>;
 
<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(strategy = <span class="hljs-title class_">GenerationType</span>.<span class="hljs-property">IDENTITY</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> email;
 
    <span class="hljs-comment">// 生成getter和setter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Long</span> <span class="hljs-title function_">getId</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> id;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setId</span>(<span class="hljs-params">Long id</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> name;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getEmail</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> email;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setEmail</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> email</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个实体类中，@Entity注解表示该类是一个实体类，会被映射到数据库表；@Id注解标识id字段为主键；@GeneratedValue(strategy = GenerationType.IDENTITY)表示主键采用自增长策略，即数据库会自动为每条记录生成唯一的主键值。</p>
</blockquote>
<blockquote>
<p><strong>5.创建 Repository 接口</strong>：创建一个继承自JpaRepository的接口，Spring Data JPA 会根据接口方法名称自动实现数据访问逻辑。例如，创建UserRepository接口：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;
 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;User, Long&gt; {
    <span class="hljs-comment">// 可以添加自定义查询方法</span>
    User <span class="hljs-title function_">findByName</span><span class="hljs-params">(String name)</span>;
}
AI写代码TypeScript
运行
</code></pre>
<p>UserRepository接口继承自JpaRepository，其中User是实体类类型，Long是主键的类型。通过继承JpaRepository，我们可以直接使用它提供的一系列默认方法，如save（保存或更新实体）、findById（根据主键查找实体）、findAll（查找所有实体）等。同时，我们还可以在接口中定义自定义的查询方法，如findByName，Spring Data JPA 会根据方法名自动生成相应的 SQL 查询语句。</p>
</blockquote>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2 编写<a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3D%25E6%2595%25B0%25E6%258D%25AE%25E8%25AE%25BF%25E9%2597%25AE%25E5%25B1%2582%26spm%3D1001.2101.3001.7020" target="_blank" title="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%B1%82&amp;spm=1001.2101.3001.7020" ref="nofollow noopener noreferrer">数据访问层</a>代码</h4>
<blockquote>
<p>完成 Spring Data JPA 的集成后，就可以使用Repository接口进行数据访问操作了。Spring Data JPA 提供了丰富的方法来执行 CRUD（创建、读取、更新、删除）操作，同时还支持通过方法名定义查询、使用查询注解等方式进行复杂查询。以下是一些常见的数据访问层代码示例：</p>
</blockquote>
<blockquote>
<p><strong>1.保存数据</strong>：使用save方法可以保存或更新一个实体对象。如果实体对象的主键为空，save方法会执行插入操作；如果主键已存在，则执行更新操作。例如：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
 
    <span class="hljs-keyword">public</span> User saveUser(User user) {
        <span class="hljs-keyword">return</span> userRepository.save(user);
    }
}
AI写代码TypeScript
运行
</code></pre>
<p>在上述代码中，UserService类通过@Autowired注解注入了UserRepository实例，然后在saveUser方法中调用userRepository.save(user)方法将User对象保存到数据库中。如果保存成功，save方法会返回保存后的User对象。</p>
</blockquote>
<blockquote>
<p><strong>2.查询数据</strong>：</p>
<ul>
<li>
<p><strong>根据主键查询</strong>：使用findById方法可以根据主键查找实体对象。该方法返回一个Optional对象，通过isPresent方法可以判断是否找到对应的实体，通过get方法可以获取实体对象。例如：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> User getUserById(<span class="hljs-built_in">Long</span> id) {
    <span class="hljs-keyword">return</span> userRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
}
AI写代码TypeScript
运行
</code></pre>
<p>这里，userRepository.findById(id)返回一个Optional对象，如果Optional对象不为空，即找到了对应的用户，则通过orElse(null)方法返回该用户对象；如果Optional对象为空，即未找到对应的用户，则返回null。</p>
</li>
<li>
<p><strong>查询所有数据</strong>：使用findAll方法可以查询所有实体对象，返回一个Iterable集合。例如：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Iterable&lt;User&gt; <span class="hljs-title">getAllUsers</span>()</span> {
    <span class="hljs-keyword">return</span> userRepository.findAll();
}
AI写代码TypeScript
运行
</code></pre>
</li>
<li>
<p><strong>自定义方法查询</strong>：如前面在UserRepository接口中定义的findByName方法，可以根据用户名查询用户。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">findUserByName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
    <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">findByName</span>(name);
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>Spring Data JPA 会根据方法名findByName自动生成 SQL 查询语句，实现根据用户名查询用户的功能。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>3.更新数据</strong>：更新数据同样使用save方法，因为save方法会根据实体对象的主键来判断是执行插入还是更新操作。例如：</p>
<pre><code class="hljs language-sql" lang="sql">public <span class="hljs-keyword">User</span> updateUser(<span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span>) {
    <span class="hljs-keyword">return</span> userRepository.save(<span class="hljs-keyword">user</span>);
}
AI写代码TypeScript
运行
</code></pre>
<p>在调用updateUser方法时，传入的User对象的主键必须是已存在于数据库中的，这样save方法就会执行更新操作，将User对象的最新数据更新到数据库中。</p>
</blockquote>
<blockquote>
<p><strong>4.删除数据</strong>：使用deleteById方法可以根据主键删除实体对象，使用delete方法可以删除一个实体对象，使用deleteAll方法可以删除所有实体对象。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteUserById</span>(<span class="hljs-params">Long id</span>) {
    userRepository.<span class="hljs-title function_">deleteById</span>(id);
}
 
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">User user</span>) {
    userRepository.<span class="hljs-title function_">delete</span>(user);
}
 
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteAllUsers</span>(<span class="hljs-params"/>) {
    userRepository.<span class="hljs-title function_">deleteAll</span>();
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>上述代码分别展示了根据主键删除用户、删除指定用户对象和删除所有用户的方法。在实际应用中，应根据具体需求选择合适的删除方法。</p>
</blockquote>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.3 事务管理</h4>
<blockquote>
<p>事务管理是保证数据完整性和一致性的重要机制，它确保一组数据库操作要么全部成功执行，要么全部失败回滚。在 Spring Boot 中，使用事务非常简单，通过@Transactional注解就可以轻松实现事务管理。</p>
</blockquote>
<blockquote>
<p><strong>1.事务管理的概念</strong>：事务是一个不可分割的工作单元，它包含多个数据库操作，这些操作要么全部成功提交，使数据持久化到数据库中；要么全部失败回滚，撤销之前的所有操作，保证数据的一致性。例如，在一个银行转账的业务场景中，涉及到从转出账户扣除金额和向转入账户增加金额两个操作，这两个操作必须作为一个事务来处理，否则可能会出现转出账户金额已扣除，但转入账户金额未增加的情况，导致数据不一致。事务具有 ACID 特性：</p>
<ul>
<li><strong>原子性（Atomicity）</strong> ：事务中的所有操作要么全部完成，要么全部不完成，不会出现部分成功部分失败的情况。</li>
<li><strong>一致性（Consistency）</strong> ：事务执行前后，数据库的完整性约束不会被破坏，数据的状态保持一致。</li>
<li><strong>隔离性（Isolation）</strong> ：多个事务并发执行时，一个事务的执行不能被其他事务干扰，每个事务都感觉不到其他事务的存在。</li>
<li><strong>持久性（Durability）</strong> ：一旦事务提交成功，其对数据库的修改将永久保存，即使系统出现故障也不会丢失。</li>
</ul>
</blockquote>
<blockquote>
<p><strong>2.在 Spring Boot 中使用事务</strong>：在 Spring Boot 中，使用事务主要通过@Transactional注解来实现。@Transactional注解可以作用在类或方法上：</p>
<ul>
<li>
<p><strong>作用在类上</strong>：当@Transactional注解作用在类上时，表示该类中的所有公共方法都将被事务管理。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">transaction</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Transactional</span>;
 
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-comment">// 类中的所有公共方法都被事务管理</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">someBusinessMethod</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑代码</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在上述代码中，UserService类上添加了@Transactional注解，因此该类中的someBusinessMethod方法会被事务管理。如果在someBusinessMethod方法中执行多个数据库操作，这些操作将被视为一个事务，要么全部成功提交，要么全部失败回滚。</p>
</li>
<li>
<p><strong>作用在方法上</strong>：当@Transactional注解作用在方法上时，仅该方法会被事务管理。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">transaction</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Transactional</span>;
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">specificBusinessMethod</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑代码</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个例子中，只有specificBusinessMethod方法被事务管理，而UserService类中的其他方法不会受到事务的影响。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>3.事务的传播行为</strong>：事务的传播行为定义了一个事务方法被另一个事务方法调用时，事务应该如何管理。Spring Boot 支持多种事务传播行为，常见的有以下几种：</p>
<ul>
<li><strong>REQUIRED（默认）</strong> ：如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。例如：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ServiceB</span> serviceB;
 
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
        serviceB.<span class="hljs-title function_">methodB</span>();
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在上述代码中，ServiceA的methodA方法和ServiceB的methodB方法都被标记为@Transactional。当methodA调用methodB时，由于methodA已经在一个事务中，methodB会加入到methodA的事务中，它们共享同一个事务。</p>
<ul>
<li>
<p><strong>REQUIRES_NEW</strong>：无论当前是否存在事务，都创建一个新的事务。如果当前存在事务，则将当前事务挂起，直到新事务完成。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ServiceB</span> serviceB;
 
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
        serviceB.<span class="hljs-title function_">methodB</span>();
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> {
    <span class="hljs-meta">@Transactional</span>(propagation = <span class="hljs-title class_">Propagation</span>.<span class="hljs-property">REQUIRES_NEW</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>这里，ServiceB的methodB方法使用了REQUIRES_NEW传播行为。当methodA调用methodB时，methodB会创建一个新的事务，并且将methodA的事务挂起，直到methodB的事务完成。这样，methodA和methodB的事务是相互独立的，互不影响。</p>
</li>
<li>
<p><strong>NESTED</strong>：如果当前存在事务，则在当前事务中创建一个嵌套事务；如果当前没有事务，则创建一个新的事务。嵌套事务可以有自己的回滚点，当嵌套事务回滚时，不会影响外层事务的提交。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ServiceB</span> serviceB;
 
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 业务逻辑</span>
            serviceB.<span class="hljs-title function_">methodB</span>();
            <span class="hljs-comment">// 业务逻辑</span>
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-comment">// 捕获异常并处理，不会影响外层事务的提交</span>
        }
    }
}
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> {
    <span class="hljs-meta">@Transactional</span>(propagation = <span class="hljs-title class_">Propagation</span>.<span class="hljs-property">NESTED</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"模拟异常"</span>);
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个例子中，ServiceB的methodB方法使用了NESTED传播行为。当methodA调用methodB时，methodB会在methodA的事务中创建一个嵌套事务。如果methodB中抛出异常，嵌套事务会回滚，但methodA的事务不会回滚，除非methodA中也抛出未处理的异常。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>4.事务的隔离级别</strong>：事务隔离级别定义了一个事务对其他事务的可见性和数据一致性的保证程度。Spring Boot 支持多种事务隔离级别，常见的有以下几种：</p>
<ul>
<li><strong>READ_UNCOMMITTED</strong>：读取未提交的数据。这是最低的隔离级别，一个事务可以读取到其他事务尚未提交的数据，可能会导致脏读、不可重复读和幻读等问题。</li>
<li><strong>READ_COMMITTED</strong>：读取已提交的数据。一个事务只能读取到其他事务已经提交的数据，可以避免脏读，但仍可能出现不可重复读和幻读问题。</li>
<li><strong>REPEATABLE_READ</strong>：可重复读。在一个事务内多次读取同一数据时，得到的结果是一致的，即使其他事务对该数据进行了修改并提交，也不会影响当前事务的读取结果，可以避免脏读和不可重复读，但仍可能出现幻读问题。</li>
<li><strong>SERIALIZABLE</strong>：串行化。这是最高的隔离级别，事务串行执行，避免了脏读、不可重复读和幻读等所有并发问题，但会严重影响系统的并发性能。</li>
</ul>
<p>在 Spring Boot 中，可以通过@Transactional注解的isolation属性来指定事务的隔离级别。例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Transactional(isolation = Isolation.REPEATABLE_READ)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">someBusinessMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
AI写代码TypeScript
运行
</code></pre>
<p>上述代码中，someBusinessMethod方法的事务隔离级别被设置为REPEATABLE_READ，</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[上线卡半夜、出 bug 只能硬扛？前端自动化部署 + 秒级回滚方案来了]]></title>    <link>https://juejin.cn/post/7591207451778498586</link>    <guid>https://juejin.cn/post/7591207451778498586</guid>    <pubDate>2026-01-04T07:35:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591207451778498586" data-draft-id="7591243363082043430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="上线卡半夜、出 bug 只能硬扛？前端自动化部署 + 秒级回滚方案来了"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-04T07:35:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaEdge在掘金"/> <meta itemprop="url" content="https://juejin.cn/user/26044012176424"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            上线卡半夜、出 bug 只能硬扛？前端自动化部署 + 秒级回滚方案来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044012176424/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaEdge在掘金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T07:35:11.000Z" title="Sun Jan 04 2026 07:35:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文已收录在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJava-Edge%2FJava-Interview-Tutorial" target="_blank" title="https://github.com/Java-Edge/Java-Interview-Tutorial" ref="nofollow noopener noreferrer">Github</a>，<strong>关注我，紧跟本系列专栏文章，咱们下篇再续！</strong></p>
<ul>
<li>🚀 魔都架构师 | 全网30W技术追随者</li>
<li>🔧 大厂分布式系统/数据中台实战专家</li>
<li>🏆 主导交易系统百万级流量调优 &amp; 车联网平台架构</li>
<li>🧠 AIGC应用开发先行者 | 区块链落地实践者</li>
<li>🌍 以技术驱动创新，我们的征途是改变世界！</li>
<li>👉 实战干货：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.javaedge.cn%2F" target="_blank" title="http://www.javaedge.cn/" ref="nofollow noopener noreferrer">编程严选网</a></li>
</ul>
<h2 data-id="heading-0">0 前言</h2>
<p>项目上线前最后一步，把开发好的代码部署到线上。</p>
<p>“npm run build不就行”。这只是在本地把代码打包，想在线上也可访问这些代码，还需部署。所以在下面，如今的前端代码部署时的难点在哪呢？</p>
<h2 data-id="heading-1">1 部署难点</h2>
<h3 data-id="heading-2">jQuery时代之前</h3>
<p>前端项目中所有内容都是一些简单的静态资源。网站还没部署的概念，网站上线前，直接把开发完的项目打包发给运维，再由运维把代码直接上传到服务器的网站根目录下解压缩，完成项目部署。</p>
<h3 data-id="heading-3">jQuery时代</h3>
<p>项目的入口页面被后端管理，模板部署到后端，CSS、js和图片等静态资源依然是打包到后端之后，再解压处理。但现在，对前端的性能和稳定性的要求也越来越高，jQuery时代那种简单部署模式不足以应对性能优化、持续部署。</p>
<h3 data-id="heading-4">当下主要面临的代码部署难点</h3>
<ul>
<li>咋高效地利用项目中的文件缓存</li>
<li>咋能让整个项目的上线部署过程自动化，尽可能避免人力的介入，提高上线稳定性</li>
<li>项目上线之后，如果发现有重大Bug，要考虑咋尽快回滚代码</li>
</ul>
<p>当我们面对这些代码部署上的难点，特别是在团队协作的项目中遇到时，我们就可以考虑对项目进行自动化部署了，这样代码部署的速度和稳定性会给项目研发效率带来很好的提升。</p>
<h2 data-id="heading-5">2 上线前的自动化部署</h2>
<p>如下是大部分团队部署项目时的逻辑：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[开发代码] --&gt;|打包压缩| B[打包代码]
    B --&gt;|上传| C[服务器]
    
    style A fill:#90EE90
    style B fill:#90EE90
    style C fill:#87CEEB
</code></pre>
<p>完成打包压缩，即开发完项目后，代码推送到GitHub，就算完成任务。但打包代码后，把代码上传服务器也是这步，对于前端开发者，很少能接触，但却很重要。</p>
<p>咋把打包好的代码上传服务器，需好的解决方案。</p>
<ul>
<li>先需一台独立机器进行打包和构建，该机器需独立于所有开发环境，为保证打包环境稳定</li>
<li>部署任务启动的时候，需拉取远程代码，并切换到需部署的分支，然后锁定Node版本进行依赖安装、单元测试、ESLint等代码检查工作</li>
<li>最后，在这台机器，执行经过编译产出的打包后的代码，并打包上传代码到CDN和静态服务器</li>
<li>完成这些操作后，还要能通过脚本自动通过内部沟通软件通知团队项目构建的结果</li>
</ul>
<p>项目部署过程可能遇到如下</p>
<h3 data-id="heading-6">问题</h3>
<ul>
<li>在什么os环境中执行项目的构建？</li>
<li>由谁触发构建？</li>
<li>咋管理前面所述的把代码上传CDN时，CDN账户的权限？</li>
<li>咋自动化执行部署的全过程，若每次都由人工执行，就得消耗一个人力守着编译打包，且易引发问题，如测试的步骤遗漏或部署顺序出错。咋提升构建速率，是部署功能中需解决的重要问题。</li>
</ul>
<h3 data-id="heading-7">解决方案</h3>
<p>如采用能保证环境一致性的Docker；自动化构建触发可通过GitHub Actions；GitHub的actions功能相当于给我们提供了一个免费的服务器，可以很方便地监控代码的推送、安装依赖、代码编译自动上传到服务器。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[开发代码] --&gt;|推送代码| B[Github]
    B --&gt; C[环境依赖 / 自动化测试 / 代码打包 / 通知]
    C --&gt; D[打包后代码]
    D --&gt;|html| E[服务器]
    D --&gt;|静态资源| F[CDN]
    
    style A fill:#90EE90
    style B fill:#90EE90
    style C fill:#90EE90
    style D fill:#90EE90
    style E fill:#87CEEB
    style F fill:#87CEEB
</code></pre>
<p>这是用GitHub Actions部署项目后的项目开发流程。现在静态资源管理已完成，也实现自动化部署。提交代码后，项目就可自动推送到服务器，网站第一次上线成功。</p>
<h2 data-id="heading-8">3 上线后的自动化部署</h2>
<p>后续的持续上线咋办？直接发到生产环境，面临极大风险。但不直接发布到生产环境，我们就不能在本地和测试的前端环境去连接生产环境的数据库。</p>
<p>需预发布的（Pre）环境，只能让测试和开发访问，除了访问地址的环节不同，其他所有环节都和生产环境一致，提供最真实的回归测试环境。</p>
<p>又面临</p>
<h3 data-id="heading-9">3.1 问题</h3>
<p>若确定下周一零点发布，就只能晚上12点准时守在电脑前等结果？若npm安装依赖失败或上线后发现重大Bug，就只能迎投诉？</p>
<p>随node_modules体积越来越大，构建时间越来越长。若每次构建都需30min甚至更长，即使Bug在项目刚上线时就发现，且秒级响应修复，但重新部署项目时，也要等服务器慢慢编译。时间就是金钱，若你在修复Bug和重新部署项目上耗时长，就导致项目故障时间过长。</p>
<h3 data-id="heading-10">解决方案</h3>
<p>需一种机制，让我们发现问题后，尽快回滚版本，且在回滚过程，尽可能无需人力介入。所以，需静态资源的版本管理，即让每个历史版本的资源都保留，且有唯一版本号，如故障，能瞬间切换版本。这个过程由具体代码实现后，只需点击回滚的版本号，系统就自动恢复到上线前版本。</p>
<p>该机制下，如业务流量特大，那直接全量上线的操作就会被禁止。为减少上线时，部署操作对用户的影响，需先选择一部分用户做灰度测试，即上线后的项目的访问权限，暂时只对这些用户开放。或做AB测试，如给北京的同学推送Vue课，给上海推荐React课等。我们要做的，是把不同版本代码分开打包，互不干涉。之后，再设计部署的机器和机房去适配不同用户。</p>
<p>Gtihub中可用actions配置打包功能，下面的代码是actions的配置文件。Ubuntu作服务器的打包环境，拉取GitHub最新master代码，并把Node版本固定14.7.6，执行npm install后，再执行npm run build代码打包压缩。</p>
<p>通过GitHub Actions自动化打包一份准备上线的代码：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">打包应用的actions</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span> <span class="hljs-comment"># 监听代码时间</span>
    <span class="hljs-attr">branches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">master</span>  <span class="hljs-comment"># master分支代码推送的时候激活当前action</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-comment"># runs-on 操作系统</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">迁出代码</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@master</span>
      <span class="hljs-comment"># 安装Node</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安装Node</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v1</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">14.7</span><span class="hljs-number">.6</span>
      <span class="hljs-comment"># 安装依赖</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安装依赖</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span>
      <span class="hljs-comment"># 打包</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">打包</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
</code></pre>
<p>然后配置上线服务器和GitHub Actions服务器的信任关系，通过SSH密钥可实现免登录直接部署。直接把build后的代码打包压缩，通过SSH直接上传到服务器，并且要进行代码文件版本的管理，就完成代码部署。</p>
<p>部署成功后的结果通知。钉钉、飞书都提供推送结果，可随时通过群机器人接口把消息推送到群内，把版本号、部署日期、发起人等信息推送到对应接口，就完成自动化部署。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 雪花ID实现方案]]></title>    <link>https://juejin.cn/post/7591104893391847478</link>    <guid>https://juejin.cn/post/7591104893391847478</guid>    <pubDate>2026-01-04T08:36:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591104893391847478" data-draft-id="7591129807755444287" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 雪花ID实现方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T08:36:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东百牧码人"/> <meta itemprop="url" content="https://juejin.cn/user/1345457965762301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 雪花ID实现方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457965762301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东百牧码人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:36:55.000Z" title="Sun Jan 04 2026 08:36:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你希望在.NET中实现一个完整、线程安全且能处理时钟回拨问题的雪花ID（Snowflake）算法，用于分库分表场景下生成全局唯一的分布式ID，避免不同库/表的主键重复。</p>
<p>雪花ID是Twitter开源的分布式ID生成算法，核心是将64位长整型ID按规则拆分，保证全局唯一且趋势递增。下面先讲解核心结构，再给出可直接使用的.NET实现代码。</p>
<hr/>
<h2 data-id="heading-0">一、雪花ID核心结构（64位long型）</h2>






























<table><thead><tr><th>位段</th><th>长度</th><th>作用</th></tr></thead><tbody><tr><td>符号位</td><td>1位</td><td>固定为0（保证ID为正数）</td></tr><tr><td>时间戳位</td><td>41位</td><td>记录生成ID的毫秒级时间戳（相对于一个起始时间），可支持约69年（2^41-1）</td></tr><tr><td>机器/节点位</td><td>10位</td><td>分为5位数据中心ID + 5位机器ID，最多支持1024个节点部署</td></tr><tr><td>序列号位</td><td>12位</td><td>同一毫秒内的自增序列，每毫秒最多生成4096个ID（2^12=4096）</td></tr></tbody></table>
<h2 data-id="heading-1">二、.NET实现雪花ID生成器</h2>
<p>以下实现包含<strong>线程安全</strong>、<strong>时钟回拨检测</strong>、<strong>参数合法性校验</strong>，可直接在生产环境使用：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> 雪花ID生成器（线程安全、支持时钟回拨检测）</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SnowflakeIdGenerator</span>
{
    <span class="hljs-meta">#<span class="hljs-keyword">region</span> 常量定义</span>
    <span class="hljs-comment">// 起始时间戳（UTC时间：2024-01-01 00:00:00），可自行调整，建议使用项目上线前的时间</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> Epoch = <span class="hljs-number">1704067200000L</span>;

    <span class="hljs-comment">// 各部分的位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> TimestampBits = <span class="hljs-number">41</span>; <span class="hljs-comment">// 时间戳位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> DataCenterIdBits = <span class="hljs-number">5</span>; <span class="hljs-comment">// 数据中心ID位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> MachineIdBits = <span class="hljs-number">5</span>; <span class="hljs-comment">// 机器ID位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> SequenceBits = <span class="hljs-number">12</span>; <span class="hljs-comment">// 序列号位长度</span>

    <span class="hljs-comment">// 最大值（位运算计算）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> MaxDataCenterId = (<span class="hljs-number">1L</span> &lt;&lt; DataCenterIdBits) - <span class="hljs-number">1</span>; <span class="hljs-comment">// 31</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> MaxMachineId = (<span class="hljs-number">1L</span> &lt;&lt; MachineIdBits) - <span class="hljs-number">1</span>; <span class="hljs-comment">// 31</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> MaxSequence = (<span class="hljs-number">1L</span> &lt;&lt; SequenceBits) - <span class="hljs-number">1</span>; <span class="hljs-comment">// 4095</span>

    <span class="hljs-comment">// 位移量</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> MachineIdShift = SequenceBits; <span class="hljs-comment">// 12</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> DataCenterIdShift = SequenceBits + MachineIdBits; <span class="hljs-comment">// 17</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> TimestampShift = SequenceBits + MachineIdBits + DataCenterIdBits; <span class="hljs-comment">// 22</span>
    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span>

    <span class="hljs-meta">#<span class="hljs-keyword">region</span> 私有字段</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">long</span> _dataCenterId; <span class="hljs-comment">// 数据中心ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">long</span> _machineId; <span class="hljs-comment">// 机器ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">long</span> _lastTimestamp = <span class="hljs-number">-1L</span>; <span class="hljs-comment">// 上一次生成ID的时间戳</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">long</span> _sequence = <span class="hljs-number">0L</span>; <span class="hljs-comment">// 当前毫秒内的序列号</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _lockObj = <span class="hljs-keyword">new</span>(); <span class="hljs-comment">// 锁对象（保证线程安全）</span>
    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span>

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 构造函数</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="dataCenterId"&gt;</span>数据中心ID（0-31）<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="machineId"&gt;</span>机器ID（0-31）<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;exception cref="ArgumentException"&gt;</span>参数超出范围时抛出<span class="hljs-doctag">&lt;/exception&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SnowflakeIdGenerator</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> dataCenterId, <span class="hljs-built_in">long</span> machineId</span>)</span>
    {
        <span class="hljs-comment">// 校验参数合法性</span>
        <span class="hljs-keyword">if</span> (dataCenterId &lt; <span class="hljs-number">0</span> || dataCenterId &gt; MaxDataCenterId)
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">$"数据中心ID必须在0-<span class="hljs-subst">{MaxDataCenterId}</span>之间"</span>, <span class="hljs-keyword">nameof</span>(dataCenterId));
        }
        <span class="hljs-keyword">if</span> (machineId &lt; <span class="hljs-number">0</span> || machineId &gt; MaxMachineId)
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">$"机器ID必须在0-<span class="hljs-subst">{MaxMachineId}</span>之间"</span>, <span class="hljs-keyword">nameof</span>(machineId));
        }

        _dataCenterId = dataCenterId;
        _machineId = machineId;
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成下一个雪花ID</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>全局唯一的雪花ID<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;exception cref="Exception"&gt;</span>时钟回拨超出容忍范围时抛出<span class="hljs-doctag">&lt;/exception&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> <span class="hljs-title">NextId</span>()</span>
    {
        <span class="hljs-keyword">lock</span> (_lockObj) <span class="hljs-comment">// 加锁保证多线程安全</span>
        {
            <span class="hljs-comment">// 1. 获取当前时间戳（毫秒）</span>
            <span class="hljs-built_in">long</span> currentTimestamp = GetCurrentTimestamp();

            <span class="hljs-comment">// 2. 处理时钟回拨问题</span>
            <span class="hljs-keyword">if</span> (currentTimestamp &lt; _lastTimestamp)
            {
                <span class="hljs-built_in">long</span> timeDiff = _lastTimestamp - currentTimestamp;
                <span class="hljs-comment">// 容忍500ms内的时钟回拨（等待直到时间追上）</span>
                <span class="hljs-keyword">if</span> (timeDiff &lt;= <span class="hljs-number">500</span>)
                {
                    <span class="hljs-comment">// 自旋等待，直到时间戳追上上次的时间戳</span>
                    <span class="hljs-keyword">while</span> (currentTimestamp &lt; _lastTimestamp)
                    {
                        currentTimestamp = GetCurrentTimestamp();
                    }
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-comment">// 超出容忍范围，抛出异常（避免ID重复）</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">$"时钟回拨异常！当前时间戳：<span class="hljs-subst">{currentTimestamp}</span>，上次时间戳：<span class="hljs-subst">{_lastTimestamp}</span>，差值：<span class="hljs-subst">{timeDiff}</span>ms"</span>);
                }
            }

            <span class="hljs-comment">// 3. 处理同一毫秒内的序列号</span>
            <span class="hljs-keyword">if</span> (currentTimestamp == _lastTimestamp)
            {
                <span class="hljs-comment">// 序列号自增，超过最大值则等待下一毫秒</span>
                _sequence = (_sequence + <span class="hljs-number">1</span>) &amp; MaxSequence;
                <span class="hljs-keyword">if</span> (_sequence == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-comment">// 自旋等待下一毫秒</span>
                    <span class="hljs-keyword">while</span> (currentTimestamp &lt;= _lastTimestamp)
                    {
                        currentTimestamp = GetCurrentTimestamp();
                    }
                }
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-comment">// 新的毫秒，序列号重置为0</span>
                _sequence = <span class="hljs-number">0</span>;
            }

            <span class="hljs-comment">// 4. 更新上次时间戳</span>
            _lastTimestamp = currentTimestamp;

            <span class="hljs-comment">// 5. 拼接各部分生成最终ID</span>
            <span class="hljs-keyword">return</span> ((currentTimestamp - Epoch) &lt;&lt; TimestampShift) <span class="hljs-comment">// 时间戳部分</span>
                   | (_dataCenterId &lt;&lt; DataCenterIdShift) <span class="hljs-comment">// 数据中心ID部分</span>
                   | (_machineId &lt;&lt; MachineIdShift) <span class="hljs-comment">// 机器ID部分</span>
                   | _sequence; <span class="hljs-comment">// 序列号部分</span>
        }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 获取当前UTC时间戳（毫秒）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>毫秒级时间戳<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">long</span> <span class="hljs-title">GetCurrentTimestamp</span>()</span>
    {
        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">long</span>)(DateTime.UtcNow - <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">1970</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTimeKind.Utc)).TotalMilliseconds;
    }

    <span class="hljs-meta">#<span class="hljs-keyword">region</span> 便捷方法（可选）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成雪花ID的字符串形式</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>ID字符串<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">NextIdString</span>()</span>
    {
        <span class="hljs-keyword">return</span> NextId().ToString();
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 解析雪花ID，返回各部分信息（用于调试）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="id"&gt;</span>雪花ID<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>解析后的信息<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-keyword">public</span> (DateTime GenerateTime, <span class="hljs-built_in">long</span> DataCenterId, <span class="hljs-built_in">long</span> MachineId, <span class="hljs-built_in">long</span> Sequence) ParseId(<span class="hljs-built_in">long</span> id)
    {
        <span class="hljs-built_in">long</span> timestamp = (id &gt;&gt; TimestampShift) + Epoch;
        DateTime generateTime = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">1970</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTimeKind.Utc).AddMilliseconds(timestamp);
        <span class="hljs-built_in">long</span> dataCenterId = (id &gt;&gt; DataCenterIdShift) &amp; MaxDataCenterId;
        <span class="hljs-built_in">long</span> machineId = (id &gt;&gt; MachineIdShift) &amp; MaxMachineId;
        <span class="hljs-built_in">long</span> sequence = id &amp; MaxSequence;

        <span class="hljs-keyword">return</span> (generateTime.ToLocalTime(), dataCenterId, machineId, sequence);
    }
    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span>
}

</code></pre>
<h2 data-id="heading-2">三、使用示例</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 初始化生成器（数据中心ID=1，机器ID=1，根据实际部署环境调整）</span>
        <span class="hljs-keyword">var</span> idGenerator = <span class="hljs-keyword">new</span> SnowflakeIdGenerator(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// 单线程生成ID</span>
        <span class="hljs-built_in">long</span> id1 = idGenerator.NextId();
        Console.WriteLine(<span class="hljs-string">$"生成的雪花ID：<span class="hljs-subst">{id1}</span>"</span>);

        <span class="hljs-comment">// 解析ID（调试用）</span>
        <span class="hljs-keyword">var</span> parseResult = idGenerator.ParseId(id1);
        Console.WriteLine(<span class="hljs-string">$"生成时间：<span class="hljs-subst">{parseResult.GenerateTime}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"数据中心ID：<span class="hljs-subst">{parseResult.DataCenterId}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"机器ID：<span class="hljs-subst">{parseResult.MachineId}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"序列号：<span class="hljs-subst">{parseResult.Sequence}</span>"</span>);

        <span class="hljs-comment">// 多线程测试（验证线程安全）</span>
        Parallel.For(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>, i =&gt;
        {
            <span class="hljs-built_in">long</span> id = idGenerator.NextId();
            Console.WriteLine(<span class="hljs-string">$"线程<span class="hljs-subst">{Thread.CurrentThread.ManagedThreadId}</span>生成ID：<span class="hljs-subst">{id}</span>"</span>);
        });
    }
}

</code></pre>
<h2 data-id="heading-3">四、关键说明</h2>
<ol>
<li><strong>起始时间戳（Epoch）</strong>：建议设置为项目上线前的时间（如示例中的2024-01-01），可延长ID使用周期（默认能用到2093年）。</li>
<li><strong>机器/数据中心ID</strong>：部署时需保证每个节点的（数据中心ID+机器ID）唯一（比如通过配置文件/环境变量设置），避免不同节点生成重复ID。</li>
<li><strong>时钟回拨处理</strong>：代码中容忍500ms内的时钟回拨（自旋等待），超出则抛异常，可根据业务调整容忍阈值。</li>
<li><strong>性能</strong>：单节点每秒可生成约400万+ ID（1ms生成4096个，1秒=1000ms → 4096*1000=4,096,000），满足绝大多数业务场景。</li>
</ol>
<hr/>
<h3 data-id="heading-4">总结</h3>
<ol>
<li>雪花ID核心是通过<strong>位运算</strong>将时间戳、机器ID、序列号拼接成64位唯一ID，保证全局唯一且趋势递增；</li>
<li>实现时必须保证<strong>线程安全</strong>（加锁）和<strong>时钟回拨检测</strong>（避免ID重复）；</li>
<li>使用时需保证每个节点的机器/数据中心ID唯一，起始时间戳建议根据项目实际调整。</li>
</ol>
<p>这个实现可直接集成到你的.NET分库分表项目中，作为分布式主键生成方案。</p>
<blockquote>
<p>本文使用 <a href="https://juejin.cn/post/6940875049587097631" target="_blank" title="https://juejin.cn/post/6940875049587097631">文章同步助手</a> 同步</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>