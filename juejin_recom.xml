<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[JavaScript DOM操作与事件处理：从小兔鲜儿电商网站看现代前端开发实践]]></title>    <link>https://juejin.cn/post/7571348736152961060</link>    <guid>https://juejin.cn/post/7571348736152961060</guid>    <pubDate>2025-11-11T15:51:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571348736152961060" data-draft-id="7571306072423104554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript DOM操作与事件处理：从小兔鲜儿电商网站看现代前端开发实践"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T15:51:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的野人"/> <meta itemprop="url" content="https://juejin.cn/user/1458425238667008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript DOM操作与事件处理：从小兔鲜儿电商网站看现代前端开发实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458425238667008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的野人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T15:51:56.000Z" title="Tue Nov 11 2025 15:51:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当今的Web开发领域，JavaScript的DOM操作和事件处理能力是构建交互式用户体验的核心技术。本文将通过分析一个完整的电商网站案例——"小兔鲜儿"，深入探讨JavaScript在实际项目中的应用，特别是事件流、事件委托、滚动交互等关键概念。</p>
<h2 data-id="heading-0">事件流：理解事件传播机制</h2>
<p>事件流描述了事件在DOM结构中传播的顺序，分为捕获阶段和冒泡阶段。在小兔鲜儿网站中，我们随处可见事件流的应用。</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 事件捕获示例</span>
element.<span class="hljs-built_in">addEventListener</span>(<span class="hljs-string">'click'</span>, handler, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 事件冒泡示例（默认）</span>
element.<span class="hljs-built_in">addEventListener</span>(<span class="hljs-string">'click'</span>, handler, <span class="hljs-literal">false</span>);
</code></pre>
<p>在实际开发中，我们通常使用事件冒泡，因为它更符合直觉。但当需要提前拦截事件时，事件捕获就显得尤为重要。</p>
<p>值得注意的是，<code>mouseenter</code>和<code>mouseleave</code>事件没有冒泡阶段，这是它们与<code>mouseover</code>和<code>mouseout</code>的重要区别。在小兔鲜儿的主导航悬停效果中，正是利用了这些事件的特性来实现平滑的交互效果。</p>
<h2 data-id="heading-1">事件解绑与性能优化</h2>
<p>随着Web应用越来越复杂，合理管理事件监听器变得至关重要。小兔鲜儿网站展示了正确的事件解绑实践：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'按钮被点击'</span>);
}

<span class="hljs-comment">// 绑定事件</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);

<span class="hljs-comment">// 解绑事件</span>
element.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);
</code></pre>
<p>需要注意的是，匿名函数无法被解绑，这强调了在重要交互中使用命名函数的重要性。在单页应用(SPA)中，忽视事件解绑可能导致内存泄漏，影响应用性能。</p>
<h2 data-id="heading-2">事件委托：高效处理动态内容</h2>
<p>事件委托是小兔鲜儿网站中广泛应用的高级技巧，它利用了事件冒泡的特性：</p>
<p>html</p>
<p>复制下载运行</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>第1个孩子<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>第2个孩子<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>第3个孩子<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> ul = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'ul'</span>);
  ul.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-keyword">if</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">tagName</span> === <span class="hljs-string">'LI'</span>) {
      e.<span class="hljs-property">target</span>.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'red'</span>;
    }
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>这种模式的优点非常明显：</p>
<ul>
<li>减少内存使用，只需要一个事件监听器</li>
<li>动态添加的元素自动拥有事件处理能力</li>
<li>代码更加简洁易维护</li>
</ul>
<p>在小兔鲜儿的tab栏切换组件中，事件委托发挥了重要作用：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ul = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.tab-nav ul'</span>);
ul.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">if</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">tagName</span> === <span class="hljs-string">'A'</span>) {
    <span class="hljs-comment">// 移除之前活跃的标签</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.tab-nav .active'</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
    <span class="hljs-comment">// 设置当前标签为活跃状态</span>
    e.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
    
    <span class="hljs-keyword">const</span> i = +e.<span class="hljs-property">target</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span>; <span class="hljs-comment">// 字符串转为数字</span>
    <span class="hljs-comment">// 切换对应内容</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.tab-content .active'</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`.tab-content .item:nth-child(<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>)`</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
  }
});
</code></pre>
<h2 data-id="heading-3">阻止默认行为：掌控浏览器原生交互</h2>
<p>在某些场景下，我们需要阻止浏览器的默认行为以提供自定义交互。小兔鲜儿网站中的表单处理就体现了这一技术：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> form = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'form'</span>);
form.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();
  <span class="hljs-comment">// 自定义提交逻辑</span>
});
</code></pre>
<p>这一技术还广泛应用于阻止链接跳转、右键菜单等场景，为开发者提供了更精细的交互控制能力。</p>
<h2 data-id="heading-4">滚动交互：提升用户体验的关键</h2>
<p>滚动相关的交互在现代网站中无处不在，小兔鲜儿网站通过多种滚动技术创造了流畅的用户体验。</p>
<h3 data-id="heading-5">滚动事件基础</h3>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> n = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span>;
  <span class="hljs-comment">// 根据滚动位置执行相应操作</span>
});
</code></pre>
<p><code>scrollTop</code>属性是可读写的，这允许我们不仅监听滚动，还能以编程方式控制滚动位置：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 滚动到指定位置</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">800</span>;

<span class="hljs-comment">// 平滑滚动到顶部</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>({
  <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
});
</code></pre>
<h3 data-id="heading-6">响应式布局与尺寸监控</h3>
<p>小兔鲜儿网站通过监听窗口尺寸变化，确保在不同设备上都能提供良好的用户体验：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 调整布局或重新计算元素位置</span>
});
</code></pre>
<h3 data-id="heading-7">元素尺寸与位置获取</h3>
<p>准确获取元素尺寸和位置是实现精细交互的基础：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'div'</span>);

<span class="hljs-comment">// 获取不包含边框的宽高</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(div.<span class="hljs-property">clientWidth</span>, div.<span class="hljs-property">clientHeight</span>);

<span class="hljs-comment">// 获取包含边框的宽高</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(div.<span class="hljs-property">offsetWidth</span>, div.<span class="hljs-property">offsetHeight</span>);

<span class="hljs-comment">// 获取相对于定位父元素的位置</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(div.<span class="hljs-property">offsetTop</span>, div.<span class="hljs-property">offsetLeft</span>);

<span class="hljs-comment">// 获取元素相对于视口的位置和尺寸</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(div.<span class="hljs-title function_">getBoundingClientRect</span>());
</code></pre>
<h2 data-id="heading-8">实战案例：小兔鲜儿电梯导航</h2>
<p>小兔鲜儿网站的电梯导航是一个综合应用上述技术的典型案例，它包含了三个主要功能：</p>
<h3 data-id="heading-9">1. 滚动显示/隐藏</h3>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-ini" lang="ini">(function() {
  const <span class="hljs-attr">entry</span> = document.querySelector(<span class="hljs-string">'.xtx_entry'</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">elevator</span> = document.querySelector(<span class="hljs-string">'.xtx-elevator'</span>)<span class="hljs-comment">;</span>
  
  window.addEventListener('scroll', function() {
    const <span class="hljs-attr">n</span> = document.documentElement.scrollTop<span class="hljs-comment">;</span>
    <span class="hljs-attr">elevator.style.opacity</span> = n &gt;= entry.<span class="hljs-literal">off</span>setTop ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  // 返回顶部功能
  const <span class="hljs-attr">backTop</span> = document.querySelector(<span class="hljs-string">'#backTop'</span>)<span class="hljs-comment">;</span>
  backTop.addEventListener('click', function() {
    window.scrollTo(0, 0)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
})()<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-10">2. 点击导航平滑滚动</h3>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">list</span> = document.querySelector(<span class="hljs-string">'.xtx-elevator-list'</span>)<span class="hljs-comment">;</span>
list.addEventListener('click', function(e) {
  if (<span class="hljs-attr">e.target.tagName</span> === <span class="hljs-string">'A'</span> &amp;&amp; e.target.dataset.name) {
    // 排他思想更新活跃状态
    const <span class="hljs-attr">old</span> = document.querySelector(<span class="hljs-string">'.xtx-elevator-list .active'</span>)<span class="hljs-comment">;</span>
    if (old) old.classList.remove('active')<span class="hljs-comment">;</span>
    e.target.classList.add('active')<span class="hljs-comment">;</span>
    
    // 滚动到对应区域
    const <span class="hljs-attr">top</span> = document.querySelector(`.xtx_goods_<span class="hljs-variable">${e.target.dataset.name}</span>`).<span class="hljs-literal">off</span>setTop<span class="hljs-comment">;</span>
    <span class="hljs-attr">document.documentElement.scrollTop</span> = top<span class="hljs-comment">;</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-11">3. 滚动时高亮对应导航项</h3>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'scroll'</span>, function() {
  <span class="hljs-comment">// 移除之前的活跃状态</span>
  <span class="hljs-keyword">const</span> old = <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'.xtx-elevator-list .active'</span>);
  <span class="hljs-keyword">if</span> (old) old.classList.remove(<span class="hljs-string">'active'</span>);
  
  <span class="hljs-comment">// 根据滚动位置设置新的活跃状态</span>
  <span class="hljs-keyword">const</span> n = <span class="hljs-built_in">document</span>.documentElement.scrollTop;
  <span class="hljs-keyword">const</span> news = <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'.xtx_goods_new'</span>);
  <span class="hljs-keyword">const</span> popular = <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'.xtx_goods_popular'</span>);
  <span class="hljs-keyword">const</span> brand = <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'.xtx_goods_brand'</span>);
  <span class="hljs-keyword">const</span> topic = <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'.xtx_goods_topic'</span>);
  
  <span class="hljs-keyword">if</span> (n &gt;= news.offsetTop &amp;&amp; n &lt; popular.offsetTop) {
    <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'[data-name=new]'</span>).classList.add(<span class="hljs-string">'active'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &gt;= popular.offsetTop &amp;&amp; n &lt; brand.offsetTop) {
    <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'[data-name=popular]'</span>).classList.add(<span class="hljs-string">'active'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &gt;= brand.offsetTop &amp;&amp; n &lt; topic.offsetTop) {
    <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'[data-name=brand]'</span>).classList.add(<span class="hljs-string">'active'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &gt;= topic.offsetTop) {
    <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">'[data-name=topic]'</span>).classList.add(<span class="hljs-string">'active'</span>);
  }
});
</code></pre>
<h2 data-id="heading-12">性能优化与最佳实践</h2>
<p>在小兔鲜儿这样的电商网站中，性能优化尤为重要：</p>
<ol>
<li><strong>节流滚动事件</strong>：高频触发的scroll事件应该进行节流处理</li>
<li><strong>避免强制同步布局</strong>：连续读取和修改DOM属性会导致性能问题</li>
<li><strong>使用CSS动画</strong>：尽可能使用CSS而非JavaScript实现动画效果</li>
<li><strong>事件委托</strong>：如前所述，减少事件监听器数量</li>
</ol>
<h2 data-id="heading-13">总结</h2>
<p>通过分析小兔鲜儿电商网站，我们可以看到现代JavaScript DOM操作和事件处理技术的全面应用。从基础的事件流理解到高级的事件委托模式，从简单的点击处理到复杂的滚动交互，这些技术共同构建了流畅、响应式的用户体验。</p>
<p>在实际项目中，我们应该根据具体需求选择合适的技术方案，平衡功能实现与性能优化，始终以用户体验为中心，这才是前端开发的真正艺术。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5.2 Spring AI OpenAI 嵌入模型]]></title>    <link>https://juejin.cn/post/7571281406509793331</link>    <guid>https://juejin.cn/post/7571281406509793331</guid>    <pubDate>2025-11-11T09:38:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571281406509793331" data-draft-id="7571281406509776947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5.2 Spring AI OpenAI 嵌入模型"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T09:38:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吴祖贤"/> <meta itemprop="url" content="https://juejin.cn/user/1961184475492103"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5.2 Spring AI OpenAI 嵌入模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184475492103/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吴祖贤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:38:50.000Z" title="Tue Nov 11 2025 09:38:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring AI OpenAI 嵌入模型</h2>
<h3 data-id="heading-1">前言</h3>
<p>Spring AI 支持 OpenAI 的文本嵌入模型。</p>
<p>OpenAI 的文本嵌入用于衡量文本字符串的相关性。嵌入是一个向量（浮点数列表）。两个向量之间的距离衡量它们的相关性。小距离表示高相关性，大距离表示低相关性。</p>
<h3 data-id="heading-2">前提条件</h3>
<p>您需要创建一个 OpenAI API 来访问 OpenAI 嵌入模型。</p>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fsignup" target="_blank" title="https://platform.openai.com/signup" ref="nofollow noopener noreferrer">OpenAI 注册页面</a> 创建账户，并在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Faccount%2Fapi-keys" target="_blank" title="https://platform.openai.com/account/api-keys" ref="nofollow noopener noreferrer">API Keys 页面</a> 生成令牌。</p>
<p>Spring AI 项目定义了一个名为 <code>spring.ai.openai.api-key</code> 的配置属性，您应该将其设置为从 openai.com 获取的 <code>API Key</code> 的值。</p>
<p>您可以在 <code>application.properties</code> 文件中设置此配置属性：</p>
<pre><code class="hljs language-properties" lang="properties">spring.ai.openai.api-key=&lt;your-openai-api-key&gt;
</code></pre>
<p>为了在处理 API 密钥等敏感信息时增强安全性，您可以使用 Spring Expression Language (SpEL) 来引用环境变量：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># In application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">ai:</span>
    <span class="hljs-attr">openai:</span>
      <span class="hljs-attr">api-key:</span> <span class="hljs-string">${OPENAI_API_KEY}</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># In your environment or .env file</span>
<span class="hljs-built_in">export</span> OPENAI_API_KEY=&lt;your-openai-api-key&gt;
</code></pre>
<p>您也可以在应用程序代码中以编程方式设置此配置：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Retrieve API key from a secure source or environment variable</span>
<span class="hljs-type">String</span> <span class="hljs-variable">apiKey</span> <span class="hljs-operator">=</span> System.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>);
</code></pre>
<h4 data-id="heading-3">添加仓库和 BOM</h4>
<p>Spring AI 构件发布在 Maven Central 和 Spring Snapshot 仓库中。参考<a href="https://link.juejin.cn?target=..%2F..%2Fgetting-started.html%23artifact-repositories" target="_blank" title="../../getting-started.html#artifact-repositories" ref="nofollow noopener noreferrer">构件仓库</a>部分，将这些仓库添加到您的构建系统中。</p>
<p>为了帮助依赖管理，Spring AI 提供了 BOM（物料清单）来确保整个项目中使用一致的 Spring AI 版本。参考<a href="https://link.juejin.cn?target=..%2F..%2Fgetting-started.html%23dependency-management" target="_blank" title="../../getting-started.html#dependency-management" ref="nofollow noopener noreferrer">依赖管理</a>部分，将 Spring AI BOM 添加到您的构建系统中。</p>
<h3 data-id="heading-4">自动配置</h3>
<blockquote>
<p><strong>注意</strong>
Spring AI 自动配置、启动器模块的构件名称发生了重大变化。请参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2Fupgrade-notes.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/upgrade-notes.html" ref="nofollow noopener noreferrer">升级说明</a>了解更多信息。</p>
</blockquote>
<p>Spring AI 为 OpenAI 嵌入模型提供了 Spring Boot 自动配置。要启用它，请将以下依赖项添加到您项目的 Maven <code>pom.xml</code> 文件中：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-model-openai<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>或添加到您的 Gradle <code>build.gradle</code> 构建文件中。</p>
<pre><code class="hljs language-groovy" lang="groovy">dependencies {
    implementation 'org.springframework.ai:spring-ai-starter-model-openai'
}
</code></pre>
<blockquote>
<p><strong>提示</strong>
参考<a href="https://link.juejin.cn?target=..%2F..%2Fgetting-started.html%23dependency-management" target="_blank" title="../../getting-started.html#dependency-management" ref="nofollow noopener noreferrer">依赖管理</a>部分，将 Spring AI BOM 添加到您的构建文件中。</p>
</blockquote>
<h4 data-id="heading-5">嵌入属性</h4>
<h5 data-id="heading-6">重试属性</h5>
<p>前缀 <code>spring.ai.retry</code> 用作属性前缀，让您可以为 OpenAI 嵌入模型配置重试机制。</p>













































<table><thead><tr><th>属性</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>spring.ai.retry.max-attempts</td><td>最大重试尝试次数。</td><td>10</td></tr><tr><td>spring.ai.retry.backoff.initial-interval</td><td>指数退避策略的初始睡眠持续时间。</td><td>2 sec.</td></tr><tr><td>spring.ai.retry.backoff.multiplier</td><td>退避间隔倍数。</td><td>5</td></tr><tr><td>spring.ai.retry.backoff.max-interval</td><td>最大退避持续时间。</td><td>3 min.</td></tr><tr><td>spring.ai.retry.on-client-errors</td><td>如果为 false，抛出 NonTransientAiException，不尝试对 <code>4xx</code> 客户端错误代码进行重试</td><td>false</td></tr><tr><td>spring.ai.retry.exclude-on-http-codes</td><td>不应触发重试的 HTTP 状态代码列表（例如，抛出 NonTransientAiException）。</td><td>empty</td></tr><tr><td>spring.ai.retry.on-http-codes</td><td>应该触发重试的 HTTP 状态代码列表（例如，抛出 TransientAiException）。</td><td>empty</td></tr></tbody></table>
<h5 data-id="heading-7">连接属性</h5>
<p>前缀 <code>spring.ai.openai</code> 用作连接到 OpenAI 的属性前缀。</p>






























<table><thead><tr><th>属性</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>spring.ai.openai.base-url</td><td>要连接的 URL</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.openai.com" target="_blank" title="https://api.openai.com" ref="nofollow noopener noreferrer">api.openai.com</a></td></tr><tr><td>spring.ai.openai.api-key</td><td>API 密钥</td><td>-</td></tr><tr><td>spring.ai.openai.organization-id</td><td>可选择地，您可以指定用于 API 请求的组织。</td><td>-</td></tr><tr><td>spring.ai.openai.project-id</td><td>可选择地，您可以指定用于 API 请求的项目。</td><td>-</td></tr></tbody></table>
<blockquote>
<p><strong>提示</strong>
对于属于多个组织的用户（或通过其旧版用户 API 密钥访问其项目），可选择地，您可以指定用于 API 请求的组织和项目。这些 API 请求的使用将计为指定组织和项目的使用量。</p>
</blockquote>
<h5 data-id="heading-8">配置属性</h5>
<blockquote>
<p><strong>注意</strong>
嵌入自动配置的启用和禁用现在通过前缀为 <code>spring.ai.model.embedding</code> 的顶级属性配置。</p>
<p>要启用，设置 spring.ai.model.embedding=openai（默认启用）</p>
<p>要禁用，设置 spring.ai.model.embedding=none（或任何不匹配 openai 的值）</p>
<p>进行此更改是为了允许配置多个模型。</p>
</blockquote>
<p>前缀 <code>spring.ai.openai.embedding</code> 是配置 OpenAI 的 <code>EmbeddingModel</code> 实现的属性前缀。</p>






































































<table><thead><tr><th>属性</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>spring.ai.openai.embedding.enabled (必需且不再有效)</td><td>启用 OpenAI 嵌入模型。</td><td>true</td></tr><tr><td>spring.ai.model.embedding</td><td>启用 OpenAI 嵌入模型。</td><td>openai</td></tr><tr><td>spring.ai.openai.embedding.base-url</td><td>可选择地覆盖 spring.ai.openai.base-url 以提供特定的嵌入 URL</td><td>-</td></tr><tr><td>spring.ai.openai.embedding.embeddings-path</td><td>要附加到 base-url 的路径</td><td><code>/v1/embeddings</code></td></tr><tr><td>spring.ai.openai.embedding.api-key</td><td>可选择地覆盖 spring.ai.openai.api-key 以提供特定的嵌入 API 密钥</td><td>-</td></tr><tr><td>spring.ai.openai.embedding.organization-id</td><td>可选择地，您可以指定用于 API 请求的组织。</td><td>-</td></tr><tr><td>spring.ai.openai.embedding.project-id</td><td>可选择地，您可以指定用于 API 请求的项目。</td><td>-</td></tr><tr><td>spring.ai.openai.embedding.metadata-mode</td><td>文档内容提取模式。</td><td>EMBED</td></tr><tr><td>spring.ai.openai.embedding.options.model</td><td>要使用的模型</td><td>text-embedding-ada-002（其他选项：text-embedding-3-large, text-embedding-3-small）</td></tr><tr><td>spring.ai.openai.embedding.options.encodingFormat</td><td>返回嵌入的格式。可以是 float 或 base64。</td><td>-</td></tr><tr><td>spring.ai.openai.embedding.options.user</td><td>代表您的最终用户的唯一标识符，可以帮助 OpenAI 监控和检测滥用。</td><td>-</td></tr><tr><td>spring.ai.openai.embedding.options.dimensions</td><td>生成的输出嵌入应该具有的维度数。仅在 <code>text-embedding-3</code> 及更高版本模型中支持。</td><td>-</td></tr></tbody></table>
<blockquote>
<p><strong>注意</strong>
您可以为 <code>ChatModel</code> 和 <code>EmbeddingModel</code> 实现覆盖通用的 <code>spring.ai.openai.base-url</code> 和 <code>spring.ai.openai.api-key</code>。如果设置了 <code>spring.ai.openai.embedding.base-url</code> 和 <code>spring.ai.openai.embedding.api-key</code> 属性，它们将优先于通用属性。类似地，如果设置了 <code>spring.ai.openai.chat.base-url</code> 和 <code>spring.ai.openai.chat.api-key</code> 属性，它们将优先于通用属性。如果您想为不同的模型和不同的模型端点使用不同的 OpenAI 账户，这很有用。</p>
</blockquote>
<blockquote>
<p><strong>提示</strong>
所有以 <code>spring.ai.openai.embedding.options</code> 为前缀的属性都可以通过在 <code>EmbeddingRequest</code> 调用中添加请求特定的<a href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E9%80%89%E9%A1%B9" title="#%E8%BF%90%E8%A1%8C%E6%97%B6%E9%80%89%E9%A1%B9">运行时选项</a>来在运行时覆盖。</p>
</blockquote>
<h3 data-id="heading-9">运行时选项</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-ai%2Fblob%2Fmain%2Fmodels%2Fspring-ai-openai%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fai%2Fopenai%2FOpenAiEmbeddingOptions.java" target="_blank" title="https://github.com/spring-projects/spring-ai/blob/main/models/spring-ai-openai/src/main/java/org/springframework/ai/openai/OpenAiEmbeddingOptions.java" ref="nofollow noopener noreferrer">OpenAiEmbeddingOptions.java</a> 提供 OpenAI 配置，如要使用的模型等。</p>
<p>默认选项也可以使用 <code>spring.ai.openai.embedding.options</code> 属性进行配置。</p>
<p>在启动时，使用 <code>OpenAiEmbeddingModel</code> 构造函数设置所有嵌入请求使用的默认选项。在运行时，您可以使用 <code>OpenAiEmbeddingOptions</code> 实例作为 <code>EmbeddingRequest</code> 的一部分来覆盖默认选项。</p>
<p>例如，覆盖特定请求的默认模型名称：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EmbeddingResponse</span> <span class="hljs-variable">embeddingResponse</span> <span class="hljs-operator">=</span> embeddingModel.call(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmbeddingRequest</span>(List.of(<span class="hljs-string">"Hello World"</span>, <span class="hljs-string">"World is big and salvation is near"</span>),
        OpenAiEmbeddingOptions.builder()
            .model(<span class="hljs-string">"Different-Embedding-Model-Deployment-Name"</span>)
        .build()));
</code></pre>
<h3 data-id="heading-10">示例控制器</h3>
<p>这将创建一个可以注入到类中的 <code>EmbeddingModel</code> 实现。以下是使用 <code>EmbeddingModel</code> 实现的简单 <code>@Controller</code> 类示例。</p>
<pre><code class="hljs language-properties" lang="properties">spring.ai.openai.api-key=YOUR_API_KEY
spring.ai.openai.embedding.options.model=text-embedding-ada-002
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddingController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EmbeddingModel embeddingModel;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EmbeddingController</span><span class="hljs-params">(EmbeddingModel embeddingModel)</span> {
        <span class="hljs-built_in">this</span>.embeddingModel = embeddingModel;
    }

    <span class="hljs-meta">@GetMapping("/ai/embedding")</span>
    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">embed</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = "message", defaultValue = "Tell me a joke")</span> String message)</span> {
        <span class="hljs-type">EmbeddingResponse</span> <span class="hljs-variable">embeddingResponse</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.embeddingModel.embedForResponse(List.of(message));
        <span class="hljs-keyword">return</span> Map.of(<span class="hljs-string">"embedding"</span>, embeddingResponse);
    }
}
</code></pre>
<h3 data-id="heading-11">手动配置</h3>
<p>如果您不使用 Spring Boot，可以手动配置 OpenAI 嵌入模型。为此，将 <code>spring-ai-openai</code> 依赖项添加到您项目的 Maven <code>pom.xml</code> 文件中：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-openai<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>或添加到您的 Gradle <code>build.gradle</code> 构建文件中。</p>
<pre><code class="hljs language-groovy" lang="groovy">dependencies {
    implementation 'org.springframework.ai:spring-ai-openai'
}
</code></pre>
<blockquote>
<p><strong>提示</strong>
参考<a href="https://link.juejin.cn?target=..%2F..%2Fgetting-started.html%23dependency-management" target="_blank" title="../../getting-started.html#dependency-management" ref="nofollow noopener noreferrer">依赖管理</a>部分，将 Spring AI BOM 添加到您的构建文件中。</p>
</blockquote>
<blockquote>
<p><strong>注意</strong>
<code>spring-ai-openai</code> 依赖项也提供对 <code>OpenAiChatModel</code> 的访问。有关 <code>OpenAiChatModel</code> 的更多信息，请参考 <a href="https://link.juejin.cn?target=..%2Fchat%2Fopenai-chat.html" target="_blank" title="../chat/openai-chat.html" ref="nofollow noopener noreferrer">OpenAI 聊天客户端</a> 部分。</p>
</blockquote>
<p>接下来，创建一个 <code>OpenAiEmbeddingModel</code> 实例，并使用它计算两个输入文本之间的相似性：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">var</span> <span class="hljs-variable">openAiApi</span> <span class="hljs-operator">=</span> OpenAiApi.builder()
                .apiKey(System.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>))
                .build();

<span class="hljs-type">var</span> <span class="hljs-variable">embeddingModel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAiEmbeddingModel</span>(
		<span class="hljs-built_in">this</span>.openAiApi,
        MetadataMode.EMBED,
        OpenAiEmbeddingOptions.builder()
                .model(<span class="hljs-string">"text-embedding-ada-002"</span>)
                .user(<span class="hljs-string">"user-6"</span>)
                .build(),
        RetryUtils.DEFAULT_RETRY_TEMPLATE);

<span class="hljs-type">EmbeddingResponse</span> <span class="hljs-variable">embeddingResponse</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.embeddingModel
        .embedForResponse(List.of(<span class="hljs-string">"Hello World"</span>, <span class="hljs-string">"World is big and salvation is near"</span>));
</code></pre>
<p><code>OpenAiEmbeddingOptions</code> 提供嵌入请求的配置信息。api 和选项类提供 <code>builder()</code> 以便于选项创建。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让 ETL 更懂语义：DataWorks 支持数据集成 AI 辅助处理能力]]></title>    <link>https://juejin.cn/post/7569566666528325672</link>    <guid>https://juejin.cn/post/7569566666528325672</guid>    <pubDate>2025-11-07T06:01:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569566666528325672" data-draft-id="7569480265568845824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让 ETL 更懂语义：DataWorks 支持数据集成 AI 辅助处理能力"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-07T06:01:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让 ETL 更懂语义：DataWorks 支持数据集成 AI 辅助处理能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-07T06:01:14.000Z" title="Fri Nov 07 2025 06:01:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在生成式 AI 浪潮下，数据不再只是“被搬运的原料”，更应是“可理解、可推理、可挖掘价值”的智能资产。然而，传统 ETL（Extract-Transform-Load）流程仍停留在结构化数据处理层面，面对海量文本、日志、反馈等非结构化数据时，往往依赖人工标注或复杂开发链路，效率低、成本高、响应慢。</p>
<p>为此，阿里云大数据开发治理平台 DataWorks 数据集成全新智能化升级，以“ AI 释放数据价值”为核心，正式推出 AI 辅助处理能力，并将该功能在阿里云全球所有地域全面开放！将大模型语义理解、AI 智能分析能力深度融入离线同步任务的数据集成任务，真正实现“让每一条数据流都能思考”。</p>
<h2 data-id="heading-0">核心能力-开箱即用的智能 ETL 引擎</h2>
<p>DataWorks Serverless 资源组全新升级，支持大模型一键部署与高效调用！现已支持 Qwen3 系列、DeepSeek 系列及 Embedding 模型，提供多种 GPU 规格按需选用，按量付费，灵活成本。通过 AI Function 可便捷调用模型服务，小尺寸模型推理性能提升近 10 倍，并支持使用 DataWorks Serverless CU 资源抵扣，助力 AI 应用快速构建与弹性扩展。</p>
<p>DataWorks 数据集成现已支持在离线同步任务中直接调用大模型服务，用户无需部署模型、无需编写代码、无需额外付费，只需通过自然语言提示（Prompt），即可完成复杂的数据清洗、增强与语义结构化操作。</p>





























<table><thead><tr><th><strong>功能</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>AI 辅助处理</td><td>支持情感分析、文本分类、摘要生成、关键词提取、翻译等常见 NLP 任务</td></tr><tr><td>向量化（Embedding）处理</td><td>自动将文本字段转化为高维向量，用于语义搜索、RAG、推荐系统等 AI 应用</td></tr><tr><td>多平台模型支持</td><td>*   通过阿里云 DataWorks 部署模型服务<br/>    <br/>*   通过阿里云 PAI 模型市场开通模型服务<br/>    <br/>*   通过阿里云百炼平台开通大模型服务</td></tr><tr><td>零代码配置</td><td>全图形化界面操作，业务人员也能轻松定义 AI 处理逻辑</td></tr><tr><td>结果直写目标表</td><td>所有 AI 处理结果可直接映射至目标数据库字段，无缝对接下游应用</td></tr></tbody></table>
<p>整个过程完全托管，且 AI 处理功能本身不额外收费 —— 您只需为同步任务消耗的计算资源付费，与其他普通离线同步任务计费方式完全一致。</p>
<h2 data-id="heading-1">适用场景-多行业多场景赋能企业 AI 落地</h2>
<p>智能数据处理在数据同步 ETL 流程中可广泛应用于多个企业场景，通过情感分析、摘要生成、关键词提取、翻译和向量化等能力提升数据处理效率与洞察深度。这些应用可以显著提升了企业的决策支持能力和运营智能化水平。</p>
<h3 data-id="heading-2">1、电商客服场景：用户反馈分析与情感分类</h3>
<p>示例，客户留言：“快递太慢了，等了半个月还没到！”</p>

























<table><thead><tr><th>数据处理场景</th><th>提示语</th><th>处理结果示例</th></tr></thead><tbody><tr><td>情感分析</td><td>对用户投诉/咨询文本进行情感分类（正面/负面/中性）</td><td>负面</td></tr><tr><td>摘要生成</td><td>将长文本的用户反馈压缩为简短摘要，提取核心问题</td><td>用户投诉物流时效问题</td></tr><tr><td>关键词提取</td><td>识别高频问题关键词（如“物流延迟”“产品质量”）</td><td>物流延迟、快递、时效</td></tr></tbody></table>
<p>👉 自动归类千万级评论，支撑运营决策与服务质量优化。</p>
<h3 data-id="heading-3">2.、智能汽车场景：设备日志分析与预测性维护</h3>
<p>示例，日志内容：“The break pump pressure：abnormal; sensor exceeding : 15%”</p>

























<table><thead><tr><th>数据处理场景</th><th>提示语</th><th>处理结果示例</th></tr></thead><tbody><tr><td>文本总结</td><td>将设备运行日志中的故障描述压缩为关键信息</td><td>刹车泵浦压力超限，需立即检查</td></tr><tr><td>严重性判断</td><td>判断日志中描述的故障严重性（如“紧急”“警告”）</td><td>高危</td></tr><tr><td>翻译</td><td>统一翻译为中文</td><td>刹车泵浦压力异常，传感器显示值高于阈值15%</td></tr></tbody></table>
<p>👉 将非结构化日志转为结构化告警信息，助力预测性维护系统快速响应。</p>
<h3 data-id="heading-4">3、供应链场景：供应商反馈分析与风险预警</h3>
<p>示例，供应商邮件：“We are unable to fulfill the order due to a shortage of raw materials.”</p>

























<table><thead><tr><th>数据处理场景</th><th>提示语</th><th>处理结果示例</th></tr></thead><tbody><tr><td>情感分析</td><td>评估供应商合作态度（积极/消极）</td><td>消极</td></tr><tr><td>摘要生成</td><td>提取供应商反馈的核心问题（如“交付延迟”）</td><td>供应商因原材料短缺无法完成订单</td></tr><tr><td>翻译</td><td>将非中文供应商邮件翻译为中文</td><td>由于原材料短缺，我们无法完成该订单</td></tr></tbody></table>
<p>👉 自动识别交付风险，提前触发备选供应商调度机制。</p>
<h3 data-id="heading-5">4、法律场景：合同条款分析与风险标注</h3>
<p>示例，合同条款：“In the event of force majeure, the delivery deadline may be extended.”</p>

























<table><thead><tr><th>数据处理场景</th><th>提示语</th><th>处理结果示例</th></tr></thead><tbody><tr><td>摘要生成</td><td>提取合同核心条款（如付款条件、违约责任）</td><td>不可抗力条款允许延期交货</td></tr><tr><td>关键词提取</td><td>识别关键法律术语（如“不可抗力”“仲裁条款”）</td><td>不可抗力、交货期限</td></tr><tr><td>翻译</td><td>将外文合同翻译为中文</td><td>若发生不可抗力，交货期限可延长</td></tr></tbody></table>
<p>👉 提升法务审查效率，降低合同履约风险。</p>
<h2 data-id="heading-6">案例说明</h2>
<p>接下来介绍如何使用AI辅助处理功能，将数据来源表中<code>feedback_info</code>列的数据翻译为英文并同步至目标表。</p>
<p>来源表数据准备</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customer_feedback (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    device STRING,
    feedback_info STRING,
    pt <span class="hljs-type">INT</span>
)
PARTITIONED <span class="hljs-keyword">BY</span> (pt)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(id)
<span class="hljs-keyword">WITH</span> (table_type<span class="hljs-operator">=</span><span class="hljs-string">'Duplication'</span>);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customer_feedback (id, device, feedback_info, pt)
<span class="hljs-keyword">VALUES</span>
(<span class="hljs-number">8</span>, <span class="hljs-string">'Huawei MateBook D14'</span>, <span class="hljs-string">'价格实惠，适合学生党，性能够用'</span>, <span class="hljs-number">2020</span>),
(<span class="hljs-number">1</span>, <span class="hljs-string">'iphone'</span>, <span class="hljs-string">'这个商品还行，我用了1年'</span>, <span class="hljs-number">2013</span>),
(<span class="hljs-number">10</span>, <span class="hljs-string">'Bose QuietComfort 35 II'</span>, <span class="hljs-string">'降噪耳机中的经典，舒适度满分'</span>, <span class="hljs-number">2021</span>);
</code></pre>
<h3 data-id="heading-7">一、创建离线同步任务</h3>
<p>进入<a href="https://link.juejin.cn?target=https%3A%2F%2Fdataworks.console.aliyun.com%2Fworkspace%2Flist" target="_blank" title="https://dataworks.console.aliyun.com/workspace/list" ref="nofollow noopener noreferrer">DataWorks工作空间列表页</a>，在顶部切换至目标地域，找到已创建的工作空间，单击操作列的快速进入 &gt; Data Studio，进入Data Studio。</p>
<p>在左侧导航栏单击按钮&lt;/&gt;，进入数据开发页面，在项目目录右侧单击按钮+，选择新建节点 &gt; 数据集成 &gt; 离线同步，进入新建节点对话框。</p>
<p>设置节点路径、数据来源去向和节点名称后，单击确认，创建离线同步节点。</p>
<p>本文以Hologres同步至Hologres为例，介绍离线同步任务中的AI辅助处理功能。</p>
<h3 data-id="heading-8">二、配置同步任务</h3>
<p>创建离线同步节点后，会自动进入任务编辑页面，您需要在此页面配置如下信息：</p>
<h4 data-id="heading-9">1、数据源</h4>
<p>分别配置数据同步任务的数据来源和数据去向。</p>
<p>类型：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Foffline-synchronization-task-ai-auxiliary-processing%3Fspm%3Da2c4g.11186623.help-menu-72772.d_2_1_4_0_5_1.8ae72b0fixOwu4%23afff3df480tlb" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/offline-synchronization-task-ai-auxiliary-processing?spm=a2c4g.11186623.help-menu-72772.d_2_1_4_0_5_1.8ae72b0fixOwu4#afff3df480tlb" ref="nofollow noopener noreferrer">创建离线同步任务</a>步骤中已选择的数据来源和去向的数据源类型，不支持修改，如需修改请重新创建离线同步任务。</p>
<p>配置方式：</p>
<p>快速配置：手动配置数据来源与数据去向的连接信息，详细的配置参数解释可在配置界面查看对应参数的文案提示。</p>
<p>使用已有数据源：请在数据源参数后的下拉列表中选择已创建的数据源。</p>
<p>说明</p>
<p>数据源中只展示对应类型的数据源。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83c1d555c5b045a9816f61193727fdfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=GxpfZs6W6F2Jq5jVP5YpqL6dfQ4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">2、运行资源</h4>
<p>选择同步任务所使用的资源组。如果使用 Serverless 资源组，您还可以为该任务分配资源占用 CU 数。</p>
<p>选择资源组后，数据集成将自动检测资源组与数据来源、数据去向的连通性，您也可以手动单击连通性检查。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dff26b085294b7d834e03dddf924269~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=fBOd%2B0j5IpZnMUOUV7%2BQIf4QgAA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-11">3、数据来源</h4>
<p>配置数据来源具体待同步的表信息，如Schema、表、分区和数据过滤条件等。您可以单击数据预览，查看待同步的具体数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76057c7da546479186c0f8257b431f66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=0BRLI5L3qHOfleoXjJcdKbgqgGg%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-12">4、数据处理</h4>
<p>在数据处理区域，您可以开启数据处理能力，数据处理能力需要更多的计算资源，会增加任务的资源占用开销。</p>
<p>单击添加节点，当前支持字符串替换和AI辅助处理。本案例以AI辅助处理为例进行介绍。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bb24eb64bee46f49aaa0c3c2c53e5b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=SpNEFvzIumQEjr%2F9LMv2abSw360%3D" alt="image.png" loading="lazy"/></p>
<p>配置AI辅助处理相关信息。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39b7a981881e400db0a6c43945479814~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=i%2BweMrvSBBT57GdbuyHT0qawDqk%3D" alt="image.png" loading="lazy"/>
关键参数解释如下：</p>





























<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>模型提供商</td><td>支持<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Fllm-service-management%2F" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/llm-service-management/" ref="nofollow noopener noreferrer">阿里云DataWorks模型服务</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fmodel-studio%2Fwhat-is-model-studio" target="_blank" title="https://help.aliyun.com/zh/model-studio/what-is-model-studio" ref="nofollow noopener noreferrer">阿里百炼平台</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fpai%2Fproduct-overview%2Fwhat-is-machine-learning-platform-for-ai%2F" target="_blank" title="https://help.aliyun.com/zh/pai/product-overview/what-is-machine-learning-platform-for-ai/" ref="nofollow noopener noreferrer">阿里云PAI模型市场</a>。</td></tr><tr><td>模型名称</td><td>负责智能数据处理的模型，按需选择。</td></tr><tr><td>API Key</td><td>访问模型的API KEY，请前往模型提供商获取。<br/>阿里云百炼平台：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fmodel-studio%2Fget-api-key" target="_blank" title="https://help.aliyun.com/zh/model-studio/get-api-key" ref="nofollow noopener noreferrer">获取百炼API Key</a>。<br/>阿里云PAI模型市场：前往部署的EAS任务，<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fpai%2Fuser-guide%2Fcall-a-service-over-a-public-endpoint" target="_blank" title="https://help.aliyun.com/zh/pai/user-guide/call-a-service-over-a-public-endpoint" ref="nofollow noopener noreferrer">进入在线调试</a>，获取Token，将其作为API KEY填写到此处。</td></tr><tr><td>处理工作描述</td><td>请使用自然语言描述对来源字段的处理，字段名以<code>#{column_name}</code>格式书写。例如，本案例中，此处填写<code>请将'#{feedback_info}'翻译成英文</code>。</td></tr><tr><td>写入字段</td><td>此处请输入存储结果字段的名称，如果对应字段不存在，将自动新增一个字段。</td></tr></tbody></table>
<p>说明</p>
<p>本案例的示例配置中，会将来源表的<code>feedback_info</code>字段翻译成英文，并存储到<code>feedback_processed</code>字段中。</p>
<p>您可以单击AI辅助处理区域右上角的数据输出预览，查看输出的最终数据效果。</p>
<p>（可选）您可以配置多个先后按顺序执行的数据处理流程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf8a2bf3850c44aabb75403228dcff7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=PvZoEdDwCUYGoRNCX1jQ6pK%2BMRU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-13">5、数据去向</h4>
<p>配置数据同步的目标表信息，例如Schema、表名、分区等。</p>
<p>您可以单击一键生成目标表结构，快速生成目标表。</p>
<p>如果目标端中已存在表用于接收数据，则按需选择即可。</p>
<p>配置写入模式以及写入冲突策略。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a7a992867164bdca8f5a350be256b8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=DX9aaHrbB1V8bTtjo8HkoMxGJrA%3D" alt="image.png" loading="lazy"/></p>
<p>配置同步前是否要清空Hologres表中的已有数据。</p>
<p>（可选）配置最大连接数。</p>
<p>最大连接数仅在写入模式为<code>SQL(INSERT INTO)</code>下生效，在开启任务时请确保Hologres实例有充足的空闲连接。一个任务最多使用9个连接。</p>
<h4 data-id="heading-14">6、去向字段映射</h4>
<p>配置完成数据来源、数据处理和数据去向后，会在此处展示来源与去向表间的字段映射关系，默认为同名映射和同行映射，你也可以按需进行调整。</p>
<p>说明</p>
<p>本案例中除了将源表已有字段（<code>id</code>、<code>device</code>、<code>feedback_info</code>、<code>pt</code>）同名映射外，还需要手动将源表中存储翻译后结果的<code>feedback_processed</code>字段，映射至目标表的<code>translate_feedback</code>字段中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b79070d570bd432cbc631bfaa9eb8a97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763459453&amp;x-signature=C9fVvrn2Os79QHzFwLVywZAugDk%3D" alt="image.png" loading="lazy"/>
<img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3BMqYybEJ6wRmqwZ/img/033b5cb1-c739-451a-b45c-3443aebde642.png" alt="image" loading="lazy"/></p>
<h3 data-id="heading-15">三、调试任务</h3>
<p>在离线同步任务的编辑窗口右侧，单击调试配置，配置调试本节点使用的资源组和相关脚本参数。</p>
<p>单击节点顶部工具栏的保存，然后单击运行，等待运行结束，查看运行结果是否成功，您可以前往目标端数据库查看表数据是否符合预期。</p>
<h3 data-id="heading-16">四、调度配置</h3>
<p>若离线同步节点需要周期性调度执行，您需要在节点右侧的调度配置中设置调度策略，配置相关的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Fnode-scheduling%2F" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/node-scheduling/" ref="nofollow noopener noreferrer">节点调度属性</a>。</p>
<h3 data-id="heading-17">五、节点发布</h3>
<p>请单击节点工具栏的发布图标唤起<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Ftask-release%2F" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/task-release/" ref="nofollow noopener noreferrer">发布流程</a>，通过该流程将任务发布至生产环境。只有在发布至生产环境后，才会进行周期性调度。</p>
<h3 data-id="heading-18">后续操作：任务运维</h3>
<p>节点发布后，您可以在发布流程中单击补数据或去运维。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring AI 实现MCP简单案例]]></title>    <link>https://juejin.cn/post/7571306072422858794</link>    <guid>https://juejin.cn/post/7571306072422858794</guid>    <pubDate>2025-11-11T13:55:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072422858794" data-draft-id="7571258854901383211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring AI 实现MCP简单案例"/> <meta itemprop="keywords" content="后端,Java,人工智能"/> <meta itemprop="datePublished" content="2025-11-11T13:55:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="从从容容游刃有余"/> <meta itemprop="url" content="https://juejin.cn/user/4107431173952525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring AI 实现MCP简单案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4107431173952525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    从从容容游刃有余
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:55:10.000Z" title="Tue Nov 11 2025 13:55:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring AI 实现MCP简单案例</h2>
<h3 data-id="heading-1">引言</h3>
<p>随着大型语言模型（LLM）在企业应用中的普及，如何有效地连接模型与外部工具、数据和服务成为了开发人员面临的重要挑战。2024年11月，Anthropic推出了<strong>模型上下文协议</strong>（Model Context Protocol，简称MCP），这一开放标准为解决AI系统中组件协同问题提供了全新的解决方案。本文将深入探讨MCP的核心概念，并通过一个实际的Spring AI示例项目展示其强大功能。</p>
<h3 data-id="heading-2">MCP协议简介</h3>
<p>MCP（Model Context Protocol）是一种专为人工智能模型设计的通信协议，旨在解决复杂AI系统中多个模型或组件之间的协同工作问题。你可以把MCP想象成AI领域的"USB接口"，它提供了一种统一的方式将AI模型连接到各种工具和数据源。</p>
<h4 data-id="heading-3">MCP的核心优势</h4>
<ol>
<li><strong>标准化通信</strong>：定义了模型与外部工具交互的标准接口</li>
<li><strong>自动发现能力</strong>：客户端可以自动发现并使用服务端提供的工具</li>
<li><strong>跨平台兼容</strong>：任何实现MCP的系统都可以无缝集成</li>
<li><strong>降低集成成本</strong>：开发者无需为每个模型重新实现工具调用逻辑</li>
<li><strong>增强安全性</strong>：提供了安全的数据交换机制</li>
</ol>
<h3 data-id="heading-4">Spring AI中的MCP实现</h3>
<p>Spring AI框架已经内置了对MCP协议的支持，使Java开发者能够轻松构建MCP服务器和客户端应用。在本文中，我们将通过一个实际的示例项目来演示Spring AI如何实现MCP功能。</p>
<h4 data-id="heading-5">项目架构概览</h4>
<p>我们的示例项目<code>mcp-demos</code>包含两个主要模块：</p>
<ol>
<li><strong>mcp-server-demo</strong>：实现了MCP服务器，提供天气查询等工具服务</li>
<li><strong>mcp-client-demo</strong>：实现了MCP客户端，连接到本地Ollama模型并自动发现服务器提供的工具</li>
</ol>
<h3 data-id="heading-6">服务端实现详解</h3>
<h4 data-id="heading-7">创建MCP服务器</h4>
<p>MCP服务器是一个基于Spring Boot的应用程序，通过简单的配置即可启用MCP功能。</p>
<p>首先，让我们看看主应用类的实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpServerApplication</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(McpServerApplication.class, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ToolCallbackProvider <span class="hljs-title function_">weatherTools</span><span class="hljs-params">(WeatherService weatherService)</span> {
        <span class="hljs-keyword">return</span> MethodToolCallbackProvider.builder().toolObjects(weatherService).build();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">TextInput</span><span class="hljs-params">(String input)</span> {}

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ToolCallback <span class="hljs-title function_">toUpperCase</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> FunctionToolCallback.builder(<span class="hljs-string">"toUpperCase"</span>, (TextInput input) -&gt; input.input().toUpperCase())
                .inputType(TextInput.class)
                .description(<span class="hljs-string">"Put the text to upper case"</span>)
                .build();
    }
}
</code></pre>
<p>在这段代码中，我们看到了两个关键的Bean定义：</p>
<ol>
<li><code>weatherTools</code>：将<code>WeatherService</code>类中标记为工具的方法注册为MCP服务</li>
<li><code>toUpperCase</code>：创建了一个简单的文本转换工具，用于将文本转换为大写</li>
</ol>
<h4 data-id="heading-8">实现工具服务</h4>
<p>下面是<code>WeatherService</code>类的核心实现，展示了如何定义MCP工具方法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BASE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.weather.gov"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RestClient restClient;

    <span class="hljs-comment">// 构造函数初始化RestClient...</span>

    <span class="hljs-meta">@Tool(description = "Get weather forecast for a specific latitude/longitude")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getWeatherForecastByLocation</span><span class="hljs-params">(<span class="hljs-type">double</span> latitude, <span class="hljs-type">double</span> longitude)</span> {
        <span class="hljs-comment">// 实现天气查询逻辑...</span>
    }

    <span class="hljs-meta">@Tool(description = "Get weather alerts for a US state. Input is Two-letter US state code (e.g. CA, NY)")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAlerts</span><span class="hljs-params">(String state)</span> {
        <span class="hljs-comment">// 实现天气警报查询逻辑...</span>
    }
}
</code></pre>
<p><strong>关键技术点</strong>：</p>
<ol>
<li>使用<code>@Tool</code>注解标记可被MCP发现的方法</li>
<li><code>description</code>参数提供了工具的描述，帮助模型理解工具的功能和使用方式</li>
<li>方法参数和返回类型会被自动转换为适合模型理解的格式</li>
</ol>
<h4 data-id="heading-9">服务端配置</h4>
<p>服务端的MCP功能通过<code>application.properties</code>文件进行配置：</p>
<pre><code class="hljs language-properties" lang="properties">spring.ai.mcp.server.name=mcp-server-demo
spring.ai.mcp.server.version=0.0.1
spring.ai.mcp.server.protocol=SSE
spring.ai.mcp.server.capabilities.resource=true
spring.ai.mcp.server.capabilities.tool=true
spring.ai.mcp.server.capabilities.completion=true
spring.ai.mcp.server.capabilities.prompt=true
spring.ai.mcp.server.streamable-http.mcp-endpoint=/mcp
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>spring.ai.mcp.server.name</code>：服务器名称</li>
<li><code>spring.ai.mcp.server.protocol</code>：通信协议，这里使用SSE（Server-Sent Events）</li>
<li><code>spring.ai.mcp.server.capabilities.*</code>：声明服务器支持的功能</li>
<li><code>spring.ai.mcp.server.streamable-http.mcp-endpoint</code>：MCP端点路径</li>
</ul>
<h3 data-id="heading-10">客户端实现详解</h3>
<h4 data-id="heading-11">创建MCP客户端</h4>
<p>MCP客户端连接到本地Ollama模型，并自动发现服务端提供的工具：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OllamaConfig</span> {

    <span class="hljs-meta">@Value("${ai.user.input}")</span>
    <span class="hljs-keyword">private</span> String userInput;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ChatClient.Builder <span class="hljs-title function_">chatClientBuilder</span><span class="hljs-params">(OllamaChatModel ollamaChatModel)</span> {
        <span class="hljs-keyword">return</span> ChatClient.builder(ollamaChatModel);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CommandLineRunner <span class="hljs-title function_">predefinedQuestions</span><span class="hljs-params">(ChatClient.Builder chatClientBuilder
            , ToolCallbackProvider tools, ConfigurableApplicationContext context)</span> {

        System.out.println(tools.getToolCallbacks());
        <span class="hljs-keyword">return</span> args -&gt; {
            <span class="hljs-type">var</span> <span class="hljs-variable">chatClient</span> <span class="hljs-operator">=</span> chatClientBuilder
                    .defaultToolCallbacks(tools)
                    .build();

            System.out.println(<span class="hljs-string">"\n&gt;&gt;&gt; QUESTION: "</span> + userInput);
            System.out.println(<span class="hljs-string">"\n&gt;&gt;&gt; ASSISTANT: "</span> + chatClient.prompt(userInput).call().content());

            context.close();
        };
    }
}
</code></pre>
<p><strong>关键技术点</strong>：</p>
<ol>
<li>通过<code>ToolCallbackProvider</code>自动获取所有可用的工具（包括通过MCP发现的远程工具）</li>
<li>将这些工具配置到<code>ChatClient</code>中，使其可以在与模型交互时自动选择合适的工具</li>
</ol>
<h4 data-id="heading-12">客户端配置</h4>
<p>客户端的配置同样在<code>application.properties</code>文件中：</p>
<pre><code class="hljs language-properties" lang="properties">spring.ai.model.chat=ollama
spring.ai.ollama.base-url=http://localhost:11434
spring.ai.ollama.chat.options.model=llama3.2:1b
spring.ai.mcp.client.name=mcp-client-demo
spring.ai.mcp.client.toolcallback.enabled=true
spring.ai.mcp.client.sse.connections.mcp-server-demo.url=http://localhost:8080
ai.user.input=What tools are available?
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>spring.ai.model.chat=ollama</code>：使用Ollama作为聊天模型</li>
<li><code>spring.ai.ollama.*</code>：配置Ollama连接信息</li>
<li><code>spring.ai.mcp.client.toolcallback.enabled=true</code>：启用MCP工具回调</li>
<li><code>spring.ai.mcp.client.sse.connections.*</code>：配置MCP服务器连接</li>
</ul>
<h3 data-id="heading-13">实际使用示例</h3>
<h4 data-id="heading-14">示例1：获取天气预报</h4>
<p>当用户发送如下请求时：</p>
<pre><code class="hljs language-rust" lang="rust">What<span class="hljs-symbol">'s</span> the weather forecast <span class="hljs-keyword">for</span> <span class="hljs-title class_">New</span> York City?
</code></pre>
<p>系统的执行流程如下：</p>
<ol>
<li>客户端将请求发送给Ollama模型</li>
<li>模型分析请求，发现需要获取纽约的天气预报</li>
<li>模型识别到可以使用<code>getWeatherForecastByLocation</code>工具</li>
<li>客户端调用该工具（通过MCP协议）</li>
<li>服务端执行天气查询并返回结果</li>
<li>模型处理结果并返回给用户</li>
</ol>
<h4 data-id="heading-15">示例2：使用文本转换工具</h4>
<p>当用户发送如下请求时：</p>
<pre><code class="hljs language-sql" lang="sql">Please <span class="hljs-keyword">convert</span> <span class="hljs-string">'hello world'</span> <span class="hljs-keyword">to</span> uppercase.
</code></pre>
<p>系统会使用<code>toUpperCase</code>工具将文本转换为大写，整个过程对用户完全透明。</p>
<h3 data-id="heading-16">MCP的工作原理</h3>
<p>MCP协议的工作原理可以概括为以下几个步骤：</p>
<ol>
<li><strong>服务注册</strong>：MCP服务器启动时，会注册所有标记为工具的方法</li>
<li><strong>客户端发现</strong>：MCP客户端连接到服务器后，自动发现可用的工具</li>
<li><strong>工具调用</strong>：当模型需要使用工具时，通过MCP协议调用远程工具</li>
<li><strong>结果处理</strong>：工具执行结果通过MCP返回给客户端，然后由模型进行处理</li>
</ol>
<p>这种机制使得模型可以无缝地使用各种外部工具，而不需要了解工具的具体实现细节。</p>
<h3 data-id="heading-17">实现细节与最佳实践</h3>
<h4 data-id="heading-18">工具方法设计</h4>
<p>在设计MCP工具方法时，应遵循以下最佳实践：</p>
<ol>
<li><strong>清晰的描述</strong>：使用详细的<code>description</code>参数，帮助模型理解工具的用途</li>
<li><strong>合理的参数</strong>：使用简单明了的参数类型和名称</li>
<li><strong>结构化返回</strong>：返回格式良好的结构化数据</li>
<li><strong>错误处理</strong>：妥善处理可能发生的异常</li>
</ol>
<h4 data-id="heading-19">性能优化</h4>
<p>对于生产环境的MCP应用，可以考虑以下性能优化策略：</p>
<ol>
<li><strong>工具缓存</strong>：缓存工具发现结果，减少重复发现开销</li>
<li><strong>请求批处理</strong>：批量处理相关的工具调用</li>
<li><strong>异步执行</strong>：使用异步方式执行耗时的工具调用</li>
<li><strong>连接池管理</strong>：合理管理MCP连接池</li>
</ol>
<h3 data-id="heading-20">MCP与其他方案的对比</h3>
<p>相比传统的API集成方式，MCP具有以下优势：</p>



































<table><thead><tr><th>特性</th><th>MCP</th><th>传统API</th></tr></thead><tbody><tr><td>自动发现</td><td>✓</td><td>✗</td></tr><tr><td>标准接口</td><td>✓</td><td>各厂商不同</td></tr><tr><td>模型理解</td><td>描述性元数据</td><td>无</td></tr><tr><td>跨平台兼容</td><td>✓</td><td>需要适配</td></tr><tr><td>集成复杂度</td><td>低</td><td>高</td></tr></tbody></table>
<h3 data-id="heading-21">未来发展与趋势</h3>
<p>随着MCP协议的不断发展，我们可以期待：</p>
<ol>
<li>更多框架和平台对MCP的支持</li>
<li>更丰富的工具生态系统</li>
<li>安全性和隐私保护的增强</li>
<li>更高效的通信协议和机制</li>
</ol>
<h3 data-id="heading-22">结论</h3>
<p>MCP协议为AI模型与外部工具的交互提供了一种标准化、高效的解决方案。通过Spring AI的实现，Java开发者可以轻松构建支持MCP的应用程序，实现模型与工具的无缝集成。本文介绍的示例项目展示了MCP的基本功能和使用方法，希望能为开发者提供有价值的参考。</p>
<p>随着AI技术的不断发展，MCP这样的标准化协议将在AI应用生态系统中发挥越来越重要的作用，推动AI应用的普及和创新。</p>
<h3 data-id="heading-23">参考文献</h3>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fintroduction" target="_blank" title="https://modelcontextprotocol.io/introduction" ref="nofollow noopener noreferrer">MCP官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2F3-concepts%2Fmodel-context-protocol.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/3-concepts/model-context-protocol.html" ref="nofollow noopener noreferrer">Spring AI MCP文档</a></li>
<li>Anthropic, "Model Context Protocol: A New Standard for AI Tool Integration", 2024</li>
</ol>
<hr/>
<h3 data-id="heading-24">代码链接</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftree_boss%2Fmcp-demos.git" target="_blank" title="https://gitee.com/tree_boss/mcp-demos.git" ref="nofollow noopener noreferrer">gitee.com/tree_boss/m…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关于2D人物冒险游戏闪现逻辑的实现方法]]></title>    <link>https://juejin.cn/post/7571306072422989866</link>    <guid>https://juejin.cn/post/7571306072422989866</guid>    <pubDate>2025-11-11T15:16:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072422989866" data-draft-id="7571299394345812010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关于2D人物冒险游戏闪现逻辑的实现方法"/> <meta itemprop="keywords" content="游戏开发"/> <meta itemprop="datePublished" content="2025-11-11T15:16:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="祭璃妖"/> <meta itemprop="url" content="https://juejin.cn/user/2534812613608265"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关于2D人物冒险游戏闪现逻辑的实现方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2534812613608265/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    祭璃妖
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T15:16:39.000Z" title="Tue Nov 11 2025 15:16:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>新人第一篇带有纪念性的文章<br/>
游戏demo来源于b站up主M_Studio麦扣老师的教程《勇士传说》，在此基础上进行的拓展内容实现</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7823f42e2b546d8a511552f4b466010~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Wt55KD5aaW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763478999&amp;x-signature=w1zbUtvs6haRoh9suyCdjZWb3IU%3D" alt="闪现.gif" loading="lazy"/></p>
<p align="center">这是成品，除了隐现动画没有素材，其他都达到了我想要实现的效果😋</p>
<p>当然我自己不太会这个逻辑，于是我寻求了gpt的帮助</p>
<p>核心逻辑如下：</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">Slash</span>(InputAction.CallbackContext context)
{
    if (fadeCoroutine != null)
    {
        <span class="hljs-built_in">StopCoroutine</span>(fadeCoroutine);<span class="hljs-comment">//防止上次协程没清空</span>
    }
    fadeCoroutine = <span class="hljs-built_in">StartCoroutine</span>(FadeOutAndBack());<span class="hljs-comment">//启动新协程</span>
}
</code></pre>
<p>在这里使用了StartCoroutine启动协程后调用IEnumerator状态机来实现闪现，为什么要使用协程呢？</p>
<p>1.不用手写计时器、不用在 Update() 里管理状态机，逻辑更清晰</p>
<p>2.避免阻塞主线程，协程在每帧之间自动暂停，不会卡住游戏</p>
<p>3.可以嵌套使用其他协程（渐隐 → 冲刺 → 停顿 → 渐显），方便管理各种状态</p>
<p>底下是管理各种协程的状态机</p>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerator <span class="hljs-title">FadeOutAndBack</span>()</span>
{
    <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">StartCoroutine</span>(<span class="hljs-params">FadeTo(<span class="hljs-number">0f</span>, fadeDuration</span>))</span>;<span class="hljs-comment">//启动渐隐协程</span>
    <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">StartCoroutine</span>(<span class="hljs-params">Dash(dashDistance, dashDuration</span>))</span>;<span class="hljs-comment">//启动冲刺协程</span>
    <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">WaitForSeconds</span>(<span class="hljs-params">invisibleTime</span>)</span>;<span class="hljs-comment">//等待一段时间</span>
    <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">StartCoroutine</span>(<span class="hljs-params">FadeTo(<span class="hljs-number">1f</span>, fadeDuration</span>))</span>;<span class="hljs-comment">//启动渐显协程</span>
    fadeCoroutine = <span class="hljs-literal">null</span>;
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>当然最重要的是我们要实现在一段时间内渐隐，渐显，涉及到时间的持续用协程是比较方便的。</p>
<p>因为Unity给了我们很方便的工具去调用，比如在IEnumerator状态机里面调用yield return new WaitForSeconds(0.5f);可以让协程暂停0.5秒而不会影响主线程的逻辑，防止阻塞。</p>
<pre><code class="hljs language-ini" lang="ini"> private IEnumerator Dash(float distance, float duration)
{
    float <span class="hljs-attr">faceSign</span> = Mathf.Sign(transform.localScale.x)<span class="hljs-comment">;</span>
    Vector2 <span class="hljs-attr">dir</span> = new Vector2(-faceSign, <span class="hljs-number">0</span>f).normalized<span class="hljs-comment">; // 朝向向量，向右为 (1,0)</span>
    Vector2 <span class="hljs-attr">start</span> = rb.position<span class="hljs-comment">;//起始位置</span>
    Vector2 <span class="hljs-attr">target</span> = start + dir * distance<span class="hljs-comment">;//目标位置</span>
    <span class="hljs-attr">rb.velocity</span> = new Vector2(<span class="hljs-number">0</span>f, rb.velocity.y)<span class="hljs-comment">;//设置冲刺的时候水平速度先归零</span>
    rb.MovePosition(target)<span class="hljs-comment">;</span>
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>可以看到人物调用了MovePosition这个方法来实现快速移动，根据unity官方手册我们可以看到关于他的描述：<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e93f6d715c214f95937204b1a98a797e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Wt55KD5aaW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763478999&amp;x-signature=6wnBwIOVQx4UUiqcy5cjK%2FzHiC8%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>MovePositon是在调用后的下一次物理更新（应该就是物理帧）将物体移动至指定位置，并且在移动过程中检测物理碰撞，相比于直接改变transform.position来说更不容易穿墙，但是为什么能穿过野猪呢？</p>
<p>我在代码里面并没有特别写关于忽略闪现过程中敌人触发器的碰撞，所以我找到了野猪身上有关伤害触发的代码</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">OnTriggerStay2D</span><span class="hljs-params">(Collider2D collision)</span>
</span>{
    collision.<span class="hljs-built_in">GetComponent</span>&lt;Character&gt;()?.<span class="hljs-built_in">TakeDamage</span>(<span class="hljs-keyword">this</span>);
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>可以看到我调用的是OnTriggerStay2D方法，再次查询Unity手册可以看到关于OnTriggerStay2D方法的描述：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96d3a6be60234732a830b81176bb1312~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Wt55KD5aaW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763478999&amp;x-signature=%2BifqlfAUzp45N2H%2B0c7wpPMcUZE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p>稍微有点看不懂，问过gpt之后可以知道：OnTriggerStay2D是两个collider触发器在一帧内有重叠就会触发这个方法，所以我们可以得出为什么MovePosition可以穿过野猪而不能穿墙的结论了。</p>
<p>由于MovePosition的操作在两次物理帧之间完成，开始的第一帧我没有与野猪重叠，并且在下一帧我将人物移动至目标点，这两帧期间我的人物并没有与野猪产生重叠，所以不会触发OnTriggerStay2D，那么同理OnTriggerEnter2D和OnTriggerExit2D也不会被触发，因为并没有产生实际的触发器重叠。</p>
<p>ok闪现的逻辑讲完了我们来看看人物逐渐消失又逐渐出现的实现逻辑，先来看看源代码：</p>
<pre><code class="hljs language-ini" lang="ini"> private IEnumerator FadeTo(float targetAlpha, float duration)
{
    Color <span class="hljs-attr">c</span> = sprite.color<span class="hljs-comment">;//由于color是值类型，所以不能单独改color.a，这里用c来改</span>
    float <span class="hljs-attr">startAlpha</span> = c.a<span class="hljs-comment">;</span>
    if (Mathf.Approximately(startAlpha, targetAlpha) || duration &lt;= 0f)
    {
        <span class="hljs-attr">c.a</span> = targetAlpha<span class="hljs-comment">;</span>
        <span class="hljs-attr">sprite.color</span> = c<span class="hljs-comment">;</span>
        yield break<span class="hljs-comment">;</span>
    }
    float <span class="hljs-attr">t</span> = <span class="hljs-number">0</span>f<span class="hljs-comment">;</span>
    while (t &lt; duration)
    {
        t += Time.deltaTime<span class="hljs-comment">;</span>
        float <span class="hljs-attr">a</span> = Mathf.Lerp(startAlpha, targetAlpha, t / duration)<span class="hljs-comment">;//核心实现</span>
        <span class="hljs-attr">c.a</span> = a<span class="hljs-comment">;</span>
        <span class="hljs-attr">sprite.color</span> = c<span class="hljs-comment">;</span>
        yield return null<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">c.a</span> = targetAlpha<span class="hljs-comment">;</span>
    <span class="hljs-attr">sprite.color</span> = c<span class="hljs-comment">;</span>
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>其实核心逻辑就是如何实现从0到1的平滑过渡，这一点的话我一开始有想到通过动画器自带的平滑过渡来实现，但是实际写下来发现人物的隐现并不能跟随上一帧人物的形态，隐现的时候只会执行动画中的人物动画，所以我放弃了在动画器里去实现这个功能。</p>
<p>于是我询问了gpt（哎呀这gpt怎么这么好用），他给出的核心方法就是Mathf.Lerp，查询unity手册可以看到：</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd17c9558e4b4c70974b7ec61fe12b4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Wt55KD5aaW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763478999&amp;x-signature=mbCinU2dEahYnittyxmvkMVjd4c%3D" alt="" width="60%" loading="lazy"/>​</p>
<p>这个方法可以根据最后一个参数来平滑地从第一个参数变化到第二个参数，这行代码</p>
<pre><code class="hljs language-ini" lang="ini">float <span class="hljs-attr">a</span> = Mathf.Lerp(startAlpha, targetAlpha, t / duration)<span class="hljs-comment">;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>就是实现隐现的核心，duration是隐现的持续时间，t/duration就可以得到一个0-1的值，而t是根据Time.deltatime变化的，每次更新只会变化非常小的一个单位，所以能够很平滑地从0过渡到1，而float a就是决定人物color.a的参数，而我们的隐现逻辑又是在协程里实现的，整个过程是异步进行的，并且运行平滑，所以就实现了人物隐现的功能。</p>
<p>好了这篇文章到这里就差不多结束了，最后跟大家讲一点题外话吧。</p>
<p>本人是北京科技大学的一名大二学生，现在大二上，大一当了一年做题蛆，把绩点卷到了保研线，当时也不知道读研能干什么，只知道大家都在说读研究生好找工作，都支持读研，所以在入学的时候我的潜目标就是把绩点卷起来然后保研，然后找个好工作。</p>
<p>然而在大二的时候我加入了我们学校勤敏轩“806”实验室里面的游戏部，因为我十分热爱游戏开发，也在大一卷绩点的同时自学了Unity和C#的一些知识，进来之后我看到了许多开发能力很强的大佬们，他们不在乎绩点，每天泡在实验室旷课写代码，就那时候我觉得我大一一年都浪费了，卷的绩点好像也没那么有用了，我的最终目标是开发游戏，最后入职游戏公司跟他们一起做游戏。那么反过来想，如果我是游戏公司的HR，我会招一个有绩点，有学历，但是Unity的一些基本操作都不熟悉，没有开发过完整游戏项目的一个人吗？我想是不会的。</p>
<p>所以思索再三，我下定决心抛弃我大一卷过的所有成绩，放弃保研，全力投入游戏开发，提升自己的能力，跟我们游戏部成员沟通之后，先找到了这款较为完整的教程，带我们熟悉Unity的一些基本操作，之后再开发属于自己的游戏。（其实还有一个主要原因是我咨询了学长，学长说不做引擎的话，读研对游戏开发没什么帮助）</p>
<p>我在跟教程的过程中想尝试自己实现一些炫酷的闪现功能，有感而发写了这篇文章，顺便以此来纪念我从做题蛆到一名游戏开发者的蜕变。</p>
<p>大家关于游戏开发这方面有什么好的见解也欢迎与我进行交流😋（什么都行）</p>
<p>感谢您观看我的文章</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入JavaScript数组：从内存模型到遍历性能，打造高性能代码的基石]]></title>    <link>https://juejin.cn/post/7571338749197991986</link>    <guid>https://juejin.cn/post/7571338749197991986</guid>    <pubDate>2025-11-11T15:58:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571338749197991986" data-draft-id="7571126773809381386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入JavaScript数组：从内存模型到遍历性能，打造高性能代码的基石"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T15:58:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户1203911294726"/> <meta itemprop="url" content="https://juejin.cn/user/2517262684662348"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入JavaScript数组：从内存模型到遍历性能，打造高性能代码的基石
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2517262684662348/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户1203911294726
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T15:58:07.000Z" title="Tue Nov 11 2025 15:58:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深入JavaScript数组：从内存模型到遍历性能，打造高性能代码的基石</h2>
<p>当我们谈起JavaScript的数据结构，数组无疑是其中最常用、最基础的一个。无论是简单的数据列表，还是复杂的算法实现，数组都扮演着核心角色。然而，你真的了解你手中的数组吗？它是如何在内存中存在的？为什么各种遍历方法性能迥异？动态扩容的背后又隐藏着什么代价？本文将带你深入JavaScript数组的内部世界，从内存模型讲到遍历性能，助你写出更专业、更高性能的代码。</p>
<h3 data-id="heading-1">一、数组的本质：一段连续的线性内存空间</h3>
<p>在讨论任何高级特性之前，我们必须回归本质：<strong>数组是一种线性数据结构，在内存中占据一段连续的空间</strong>。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">arr</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<span class="hljs-comment">;</span>
</code></pre>
<p>这行简单的代码背后，发生了什么呢？</p>
<ul>
<li><strong>栈内存（Stack）</strong> ：变量 <code>arr</code>本身被存储在栈内存中，它保存的是一个<strong>引用地址</strong>（一个指向堆内存中实际数组对象的指针）。</li>
<li><strong>堆内存（Heap）</strong> ：数组真正的数据 <code>[1, 2, 3, 4, 5, 6]</code>被存储在堆内存中。JavaScript引擎会为它申请一段<strong>连续的存储空间</strong>，依次存放每个元素。</li>
</ul>
<p>这种“连续”的特性，是数组最核心的优势，它使得通过索引（<code>index</code>）访问元素的时间复杂度为 O(1)，即无论数组多大，<code>arr[1000]</code>和 <code>arr[0]</code>的访问速度几乎一样快，因为地址可以直接通过“基地址 + 索引 * 元素大小”计算出来。</p>
<h4 data-id="heading-2">数组的创建与初始化</h4>
<p>我们通常用字面量方式创建数组。但当我们需要初始化一个长度已知、内容固定的数组时，有更优雅的方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建一个长度为6，且每个元素初始值都为0的数组</span>
<span class="hljs-keyword">const</span> arr = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">6</span>)).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr); <span class="hljs-comment">// 输出: [0, 0, 0, 0, 0, 0]</span>

<span class="hljs-comment">// 不推荐的方式：这只会创建一个长度为6的“空槽”数组</span>
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">6</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr2); <span class="hljs-comment">// 输出: [ &lt;6 empty items&gt; ]</span>
</code></pre>
<p><code>new Array(6)</code>创建了一个有6个空位（empty）的数组，直接访问这些空位会返回 <code>undefined</code>，但 <code>fill</code>方法可以安全地填充这些位置。明确初始化是避免意外行为的最佳实践。</p>
<h3 data-id="heading-3">二、遍历数组的“十八般武艺”与性能抉择</h3>
<p>如何遍历数组？JavaScript提供了多种方法，但它们的性能特点和适用场景大不相同。</p>
<h4 data-id="heading-4">1. 王者：经典<code>for</code>循环（计数循环）</h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">arr</span> = (new Array(<span class="hljs-number">6</span>)).fill(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">len</span> = arr.length<span class="hljs-comment">; // 关键步骤：缓存数组长度</span>

for(let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; len; i++) {</span>
    console.log(arr<span class="hljs-section">[i]</span>)<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>为什么它性能最好？</strong></p>
<ul>
<li><strong>与CPU工作方式契合</strong>：<code>for</code>循环是纯粹的计数循环，逻辑简单，现代JavaScript引擎（如V8）可以对其进行极强的优化（例如循环展开）。</li>
<li><strong>减少属性查找</strong>：通过在循环外缓存 <code>arr.length</code>，避免了每次循环都查询 <code>length</code>属性的开销。虽然引擎也会优化，但显式缓存是更保险的性能习惯。</li>
<li><strong>控制力强</strong>：可以使用 <code>break</code>和 <code>continue</code>随时中断或跳过循环。</li>
</ul>
<h4 data-id="heading-5">2. 新贵：<code>for...of</code>循环</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">for</span>(const a of arr) {
    console<span class="hljs-selector-class">.log</span>(a);
}
</code></pre>
<p><strong>优点：</strong></p>
<ul>
<li><strong>语法简洁，可读性极佳</strong>：直接迭代元素值，无需操作索引。</li>
<li><strong>性能优异</strong>：在现代引擎中，<code>for...of</code>循环的性能非常接近传统的 <code>for</code>循环，是<strong>可读性与性能的完美平衡点</strong>。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>无法直接获取当前元素的索引（但可以通过其他方式间接获得）。</li>
</ul>
<h4 data-id="heading-6">3. 函数式优雅：<code>forEach</code>与<code>map</code></h4>
<p><strong><code>forEach</code>：</strong> ​ 为每个元素执行一次回调函数。</p>
<pre><code class="hljs language-javascript" lang="javascript">arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item, index);
});
</code></pre>
<p><strong>缺点：</strong></p>
<ul>
<li><strong>性能开销</strong>：涉及函数的<strong>入栈和出栈</strong>操作，比纯循环的开销大。</li>
<li><strong>无法中断</strong>：不能使用 <code>break</code>语句中途跳出循环。</li>
</ul>
<p><strong><code>map</code>：</strong> ​ 在遍历的同时，创建一个新的数组。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">const</span> newArr = arr.<span class="hljs-built_in">map</span>(item =&gt; item + <span class="hljs-number">1</span>); <span class="hljs-comment">// [2, 3, 4, 5, 6, 7]</span>
</code></pre>
<p><code>map</code>具有和 <code>forEach</code>相同的性能特点。它用于<strong>数据转换</strong>，如果你需要新数组，使用 <code>map</code>；如果只是遍历，请选择 <code>forEach</code>或其他循环。</p>
<h4 data-id="heading-7">4. 误区：<code>for...in</code>循环</h4>
<p><strong><code>for...in</code>是为遍历普通对象的可枚举属性而设计的，并非用于数组！</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 不推荐用于数组！</span>
<span class="hljs-built_in">for</span>(let key in arr) {
    console<span class="hljs-selector-class">.log</span>(key, arr[key]); <span class="hljs-comment">// key 是字符串类型的索引 "0", "1"...</span>
}

<span class="hljs-comment">// 它的真正用途是遍历对象</span>
const obj = { name: <span class="hljs-string">'小明'</span>, age: <span class="hljs-number">18</span> };
<span class="hljs-built_in">for</span>(let k in obj) {
    console<span class="hljs-selector-class">.log</span>(k, obj[k]); <span class="hljs-comment">// name 小明, age 18</span>
}
</code></pre>
<p><strong>为什么不用于数组？</strong></p>
<ul>
<li><strong>遍历原型链</strong>：它会遍历对象原型链上的所有可枚举属性，除非使用 <code>hasOwnProperty</code>判断，否则可能遍历出意外属性。</li>
<li><strong>性能低下</strong>：它的遍历机制比 <code>for</code>或 <code>for...of</code>慢得多。</li>
<li><strong>顺序不确定</strong>：虽然现在规范规定了属性顺序，但依赖 <code>for...in</code>的遍历顺序依然是不安全的。</li>
</ul>
<p><strong>结论：对象用 <code>for...in</code>，数组用 <code>for</code>或 <code>for...of</code>。</strong></p>
<h3 data-id="heading-8">三、动态数组的代价：扩容与“搬家”</h3>
<p>在强类型语言（如C++、Java）中，数组的大小通常是固定的。但JavaScript的数组是<strong>动态的</strong>，你可以随时使用 <code>push</code>、<code>pop</code>、<code>shift</code>等方法改变其长度。 这带来了便利，但也隐藏着性能陷阱。当数组不断增长，初始分配的内存不够用时，会发生什么？</p>
<ol>
<li><strong>申请新家</strong>：JavaScript引擎会申请一块更大的、连续的内存空间（例如，当前容量的2倍）。</li>
<li><strong>搬家</strong>：将原数组中的所有元素，逐个复制到新的内存空间中。</li>
<li><strong>销毁旧家</strong>：释放原先占用的较小内存块。</li>
</ol>
<p>这个“搬家”过程（重新分配内存和复制数据）的开销是 <strong>O(n)</strong> ​ 的，即与数组长度成正比。在频繁向大型数组添加元素的场景下，这种开销不容忽视。 相比之下，<strong>链表</strong>​ 这种离散的数据结构，添加元素不需要搬迁，只需修改指针。因此，在需要频繁在头部或中部进行插入/删除操作时，链表可能更有优势。但对于<strong>绝大多数需要快速随机访问的场景，数组由于其O(1)的访问效率，依然是更优的选择</strong>。引擎的优化已经非常智能，使得动态数组在多数情况下表现卓越。</p>
<h3 data-id="heading-9">四、进阶知识：循环与闭包的相互作用</h3>
<p>考虑以下经典面试题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i); <span class="hljs-comment">// 输出什么？</span>
    }, <span class="hljs-number">1000</span>);
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/758ddd9e7de34302b015aa527ea0e36e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTIwMzkxMTI5NDcyNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763481487&amp;x-signature=GVRmQkBOpOOG46HX5mfmHGuQ090%3D" alt="5f38222591efefd79d9a10ae65e492c6.png" loading="lazy"/></p>
<p>答案是按顺序输出 <code>0</code>到 <code>9</code>。为什么呢？</p>
<ul>
<li><strong><code>let</code>的块级作用域</strong>：<code>let</code>声明的 <code>i</code>在每次循环中都有一个<strong>独立的词法环境</strong>。可以理解为，循环体执行了10次，创建了10个不同的 <code>i</code>。</li>
<li><strong>闭包</strong>：<code>setTimeout</code>的回调函数形成了一个闭包，引用了它<strong>定义时所在作用域</strong>的变量 <code>i</code>。由于有10个不同的 <code>i</code>，每个回调函数都“记住”了对应的那个值。</li>
</ul>
<p><strong>内存变化</strong>： 最初，变量 <code>i</code>存在于栈内存中。但由于被闭包引用，它的生命周期被延长，JavaScript引擎会将其从栈中“提升”到堆内存中存储，以确保在 <code>for</code>循环结束后，回调函数依然能访问到正确的 <code>i</code>值。这就是闭包延长变量生命周期的机制。 如果这里使用 <code>var i</code>，由于 <code>var</code>没有块级作用域，整个循环共享同一个全局或函数作用域的 <code>i</code>。当回调函数执行时，循环早已结束，<code>i</code>的值已经是10，所以会打印10个10。</p>
<h3 data-id="heading-10">总结</h3>



































<table><thead><tr><th>特性/方法</th><th>优点</th><th>缺点</th><th>使用场景</th></tr></thead><tbody><tr><td>**经典 <code>for</code>**​</td><td><strong>性能极致</strong>，控制力强</td><td>代码稍显繁琐</td><td><strong>性能敏感</strong>场景，需要中断循环时</td></tr><tr><td>**<code>for...of</code>**​</td><td>性能优秀，<strong>语法简洁可读</strong>​</td><td>无法直接获取索引</td><td><strong>日常遍历的首选</strong>，兼顾可读性与性能</td></tr><tr><td>**<code>forEach/map</code>**​</td><td>函数式风格，代码优雅</td><td><strong>性能有开销</strong>，无法中断</td><td>无需中断的简单遍历(<code>forEach</code>)或需生成新数组(<code>map</code>)</td></tr><tr><td>**<code>for...in</code>**​</td><td>用于遍历对象属性</td><td><strong>绝对不要用于遍历数组</strong>​</td><td>遍历<strong>对象</strong>的可枚举属性</td></tr></tbody></table>
<p>理解数组的连续内存模型，是理解其高效随机访问的基础；明智地选择遍历方法，是编写高性能JavaScript代码的关键一步；而知晓动态扩容的代价，则能让你在复杂应用中进行更合理的数据结构选型。希望本文能帮助你重新审视这个最熟悉的“陌生人”，并在未来的开发中更好地驾驭它。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么说数组是 JavaScript 开发者必须精通的数据结构？]]></title>    <link>https://juejin.cn/post/7571258854901514283</link>    <guid>https://juejin.cn/post/7571258854901514283</guid>    <pubDate>2025-11-11T14:58:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571258854901514283" data-draft-id="7571334572768526379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么说数组是 JavaScript 开发者必须精通的数据结构？"/> <meta itemprop="keywords" content="数据结构,前端,算法"/> <meta itemprop="datePublished" content="2025-11-11T14:58:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="有意义"/> <meta itemprop="url" content="https://juejin.cn/user/1739866211617625"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么说数组是 JavaScript 开发者必须精通的数据结构？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1739866211617625/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    有意义
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:58:11.000Z" title="Tue Nov 11 2025 14:58:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当被问及 “数据结构有哪些” 时，若只罗列 “数组、链表、栈、队列、树”，难免显得单薄且缺乏逻辑。其实，数据结构可清晰划分为两大核心类别 ——线性结构与非线性结构，各类结构的设计逻辑和应用场景各有侧重，理解其本质能让我们更灵活地运用。​</p>
<p>线性结构是数据按 “一对一” 顺序排列的结构，日常开发中最为常用，核心成员包括数组、链表、栈和队列。其中，数组堪称 “万能基础款”，凭借连续的内存空间实现高效随机访问，操作简单、性能稳定，是各类场景的首选；而链表虽不及数组普及，却以离散的内存分配打破了空间连续性限制，能灵活应对动态增删场景，完美弥补了数组的短板。再看栈与队列，二者虽均基于线性逻辑，但遵循截然不同的操作规则：栈是 “先进后出（FILO）” 的 “存取容器”，常见于函数调用、表达式求值等场景；队列则是 “先进先出（FIFO）” 的 “排队模型”，广泛应用于任务调度、消息队列等需求中。​</p>
<p>非线性结构则是数据呈 “一对多” 或 “多对多” 关联的结构，其中树结构最为核心，尤其以二叉树为考察重点 —— 无论是算法面试还是实际开发中的搜索、排序场景，二叉树及其衍生结构（如二叉搜索树、红黑树）都占据重要地位。​</p>
<p>接下来，我们将聚焦线性结构中的 “核心成员”—— 数组，详细拆解它的底层原理、使用场景与实战技巧。</p>
<h2 data-id="heading-0">新建数组</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> arr = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">6</span>)).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr);
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">6</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr2);
<span class="hljs-comment">//浏览器显示  [空 ×6]</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b49fd20d126c44d9b3404e2ab47884cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477891&amp;x-signature=AOjmESSCv8JzqFPTYEaLVylh74o%3D" alt="image.png" loading="lazy"/></p>
<p><strong>用 <code>new Array(length)</code> 创建的数组，在没有初始化之前，它的元素是 “空” 的（empty），而不是 <code>undefined</code> 或其他值。</strong></p>
<h2 data-id="heading-1">遍历数组   for(i=0;i&lt;len;i++)</h2>
<p>我们来看这段代码：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> arr = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">6</span>)).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> len = arr.<span class="hljs-property">length</span>; 
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;i&lt;len;i++){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[i]);
}
</code></pre>
<p>在循环条件中直接使用 <code>arr.length</code> 会有微小的性能开销。</p>
<p><strong>原因如下：</strong></p>
<p>在 JavaScript 中，数组是一个特殊的对象。<code>arr.length</code> 不是一个简单的变量，而是一个<strong>访问器属性（Accessor Property）</strong> 。这意味着，每次你访问 <code>arr.length</code> 时，JavaScript 引擎实际上是在调用一个隐藏的函数来获取数组的长度。</p>
<p>在早期的 JavaScript 引擎中，这个函数调用的开销是比较明显的。如果在一个循环中（例如执行 10000 次）每次都去调用它，累积的开销就会变得可观。</p>
<h2 data-id="heading-2">遍历数组 foreach</h2>
<p>我们接着说 <code>forEach</code>，你提到的两点 ——<strong>不能 <code>break</code></strong> 和 <strong>性能相对较差</strong>—— 非常关键，我们来详细展开，并补充一些你可能忽略的细节。</p>
<hr/>
<h2 data-id="heading-3">1. <code>forEach</code> 基本用法</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index, array</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item, index, array);
});
</code></pre>
<ul>
<li>
<p><strong>回调参数</strong>：</p>
<ul>
<li><code>item</code>：当前遍历的元素（必选）</li>
<li><code>index</code>：当前元素的索引（可选）</li>
<li><code>array</code>：正在遍历的原数组（可选）</li>
</ul>
</li>
<li>
<p><strong>返回值</strong>：<code>undefined</code>（无论回调里写什么 <code>return</code>，都不会改变这一点）</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">（1）无法中途退出</h3>
<p><code>forEach</code> 没有像 <code>for</code> 循环那样的 <code>break</code> 或 <code>continue</code> 机制。</p>
<ul>
<li>
<p><strong>想提前终止？做不到</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item === <span class="hljs-number">2</span>) <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 报错：Illegal break statement</span>
});
</code></pre>
</li>
<li>
<p><strong>想跳过当前元素？用 <code>return</code> 模拟 <code>continue</code></strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 跳过当前迭代，进入下一次</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item); <span class="hljs-comment">// 输出 1, 3</span>
});
</code></pre>
</li>
</ul>
<h3 data-id="heading-5"><code>map</code></h3>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// map</span>
<span class="hljs-comment">// 作用：遍历数组，并对数组中的每个元素进行指定操作（加工/转换），</span>
<span class="hljs-comment">//      然后将所有操作结果收集起来，返回一个全新的数组。</span>
<span class="hljs-comment">// 核心：不改变原数组，返回一个长度相同、值经过转换的新数组。</span>
<span class="hljs-comment">// 适用场景：当你需要从一个数组“派生”出另一个结构相似但值不同的数组时。</span>

<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];
<span class="hljs-keyword">const</span> newArr = arr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item + <span class="hljs-number">1</span>); <span class="hljs-comment">// 对每个元素加 1</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr);    <span class="hljs-comment">// 输出: [1, 2, 3, 4, 5, 6] (原数组未改变)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newArr); <span class="hljs-comment">// 输出: [2, 3, 4, 5, 6, 7] (新数组)</span>

<span class="hljs-comment">// 回调函数参数详解：</span>
<span class="hljs-comment">// item: 当前正在处理的数组元素 (必选)</span>
<span class="hljs-comment">// index: 当前元素在数组中的索引 (可选)</span>
<span class="hljs-comment">// array: 调用 map 方法的原数组本身 (可选)</span>
<span class="hljs-keyword">const</span> doubledWithIndex = arr.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Index <span class="hljs-subst">${index}</span>: <span class="hljs-subst">${item * <span class="hljs-number">2</span>}</span>`</span>;
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doubledWithIndex); <span class="hljs-comment">// 输出: ["Index 0: 2", "Index 1: 4", "Index 2: 6", ...]</span>

<span class="hljs-comment">// 与 forEach 的区别：</span>
<span class="hljs-comment">// 1. forEach 仅用于遍历，没有返回值（返回 undefined）。</span>
<span class="hljs-comment">// 2. map 会返回一个新数组，更适合数据转换。</span>
<span class="hljs-comment">// 简单说：想“生成新数组”用 map，想“单纯遍历做操作”用 forEach。</span>
</code></pre>
<hr/>
<h3 data-id="heading-6"><code>for...of</code></h3>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// for...of</span>
<span class="hljs-comment">// 作用：ES6 引入的一种新型循环语句，用于遍历可迭代对象（如 Array, Map, Set, String 等）。</span>
<span class="hljs-comment">// 核心：提供了一种更简洁、更具可读性的方式来遍历集合中的值。</span>
<span class="hljs-comment">// 优点：</span>
<span class="hljs-comment">//   - 语法简洁，可读性远超传统 for 循环。</span>
<span class="hljs-comment">//   - 避免了 for...in 循环遍历数组时可能遇到的原型链污染问题。</span>
<span class="hljs-comment">//   - 可以与 break, continue, return 配合使用。</span>

<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-comment">// 基本用法</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> arr) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item); <span class="hljs-comment">// 依次输出: 1, 2, 3, 4, 5, 6</span>
}

<span class="hljs-comment">// 如果需要索引，可以结合 Array.prototype.entries() 使用</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> [index, item] <span class="hljs-keyword">of</span> arr.<span class="hljs-title function_">entries</span>()) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Index <span class="hljs-subst">${index}</span>: <span class="hljs-subst">${item}</span>`</span>); <span class="hljs-comment">// 依次输出: "Index 0: 1", "Index 1: 2", ...</span>
}

<span class="hljs-comment">// 与传统 for 循环对比</span>
<span class="hljs-comment">// 传统 for 循环：</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[i]);
}
<span class="hljs-comment">// for...of 写法更简洁，意图更明确。</span>

<span class="hljs-comment">// 与 for...in 对比 (注意：不推荐用 for...in 遍历数组)</span>
<span class="hljs-comment">// for...in 遍历的是键名（索引），且可能遍历到数组原型上的属性。</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> arr) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// 输出: "0", "1", "2", ... (字符串形式的索引)</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-7">总结对比</h3>








































<table><thead><tr><th align="left">特性 / 方法</th><th align="left"><code>map()</code></th><th align="left"><code>for...of</code></th></tr></thead><tbody><tr><td align="left"><strong>核心用途</strong></td><td align="left"><strong>数据转换</strong>，生成新数组。</td><td align="left"><strong>遍历迭代</strong>，访问集合中的每个值。</td></tr><tr><td align="left"><strong>返回值</strong></td><td align="left">返回一个<strong>新数组</strong>。</td><td align="left">无返回值 (<code>undefined</code>)。</td></tr><tr><td align="left"><strong>是否改变原数组</strong></td><td align="left">不改变（除非回调函数内手动修改）。</td><td align="left">不改变（除非循环体内手动修改）。</td></tr><tr><td align="left"><strong>适用对象</strong></td><td align="left">仅数组 (<code>Array</code>)。</td><td align="left">所有<strong>可迭代对象</strong> (<code>Array</code>, <code>String</code>, <code>Map</code>, <code>Set</code>, <code>arguments</code> 等)。</td></tr><tr><td align="left"><strong>中断循环</strong></td><td align="left">无法中断（必须遍历完所有元素）。</td><td align="left">可以使用 <code>break</code> 或 <code>continue</code> 中断或跳过。</td></tr><tr><td align="left"><strong>获取索引</strong></td><td align="left">回调函数的第二个参数即为索引。</td><td align="left">需要配合 <code>arr.entries()</code> 才能方便地获取索引。</td></tr></tbody></table>
<p><strong>何时使用？</strong></p>
<ul>
<li><strong>使用 <code>map</code></strong>：当你需要将一个数组的每个元素按照某种规则进行转换，最终得到一个新的数组时。例如，从 API 获取用户列表后，提取每个用户的 <code>id</code> 和 <code>name</code> 组成新数组。</li>
<li><strong>使用 <code>for...of</code></strong>：当你需要遍历一个数组或其他可迭代对象，对每个元素执行一些操作（如打印、累加、根据条件进行复杂处理等），并且可能需要中途停止循环时。它是日常遍历任务中替代传统 <code>for</code> 循环和 <code>forEach</code> 的优秀选择。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring事务传播机制深度解析：7种传播行为的使用场景和陷阱]]></title>    <link>https://juejin.cn/post/7571295102851350554</link>    <guid>https://juejin.cn/post/7571295102851350554</guid>    <pubDate>2025-11-11T16:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571295102851350554" data-draft-id="7571060853354348554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring事务传播机制深度解析：7种传播行为的使用场景和陷阱"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-11T16:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大头an"/> <meta itemprop="url" content="https://juejin.cn/user/618374030438861"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring事务传播机制深度解析：7种传播行为的使用场景和陷阱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/618374030438861/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大头an
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T16:04:20.000Z" title="Tue Nov 11 2025 16:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>在分布式系统和复杂业务场景中，事务的边界管理变得尤为重要。Spring框架提供了7种事务传播行为，但你是否真正理解它们的区别？是否曾在嵌套事务中踩过坑？本文将深入剖析每种传播机制的原理、使用场景和常见陷阱，帮助你在复杂业务中游刃有余地管理事务。</p>
</blockquote>
<h2 data-id="heading-1">什么是事务传播机制？</h2>
<p>事务传播机制（Transaction Propagation）定义了在多个事务方法相互调用时，事务应该如何传播。简单来说，它回答了"当前方法应该加入现有事务，还是开启新事务"的问题。</p>
<h3 data-id="heading-2">核心概念回顾</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Propagation</span> {
    REQUIRED,
    SUPPORTS,
    MANDATORY,
    REQUIRES_NEW,
    NOT_SUPPORTED,
    NEVER,
    NESTED
}
</code></pre>
<h2 data-id="heading-3">传播机制详解</h2>
<h3 data-id="heading-4">1. REQUIRED（默认） - 需要事务</h3>
<p><strong>定义</strong>：如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新事务。</p>
<p><strong>使用场景</strong>：大多数业务方法的默认选择，确保操作在事务中执行。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> InventoryService inventoryService;
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 如果调用方有事务，则加入该事务</span>
        <span class="hljs-comment">// 如果调用方无事务，则创建新事务</span>
        orderMapper.insert(order);
        inventoryService.deductStock(order.getItems());
    }
}
</code></pre>
<p><strong>执行流程</strong>：</p>
<pre><code class="hljs language-css" lang="css">场景<span class="hljs-number">1</span>：无事务上下文
<span class="hljs-selector-attr">[开始REQUIRED事务]</span> → 执行方法 → <span class="hljs-selector-attr">[提交/回滚事务]</span>

场景<span class="hljs-number">2</span>：有事务上下文  
<span class="hljs-selector-attr">[加入现有事务]</span> → 执行方法 → <span class="hljs-selector-attr">[由外部事务统一提交/回滚]</span>
</code></pre>
<h3 data-id="heading-5">2. SUPPORTS - 支持事务</h3>
<p><strong>定义</strong>：如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务方式执行。</p>
<p><strong>使用场景</strong>：查询操作，可以接受在有事务时加入事务，也可以无事务运行。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">findOrderById</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-comment">// 如果有事务，在事务中查询（保证读取最新数据）</span>
        <span class="hljs-comment">// 如果无事务，直接查询（可能读取到旧数据）</span>
        <span class="hljs-keyword">return</span> orderMapper.selectById(orderId);
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)</span>
    <span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title function_">findUserOrders</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// 只读查询，适合在只读副本上执行</span>
        <span class="hljs-keyword">return</span> orderMapper.selectByUserId(userId);
    }
}
</code></pre>
<p><strong>陷阱警告</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误使用：期望在无事务时自动创建事务</span>
<span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateOrderStatus</span><span class="hljs-params">(Long orderId, String status)</span> {
    <span class="hljs-comment">// 如果调用方无事务，此更新操作不在事务中！</span>
    orderMapper.updateStatus(orderId, status);
    <span class="hljs-comment">// 可能造成数据不一致</span>
}
</code></pre>
<h3 data-id="heading-6">3. MANDATORY - 强制要求事务</h3>
<p><strong>定义</strong>：如果当前存在事务，则加入该事务；如果当前没有事务，则抛出异常。</p>
<p><strong>使用场景</strong>：强制要求必须在事务上下文中执行的方法，防止误调用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuditService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.MANDATORY)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">auditOperation</span><span class="hljs-params">(String operation, String operator)</span> {
        <span class="hljs-comment">// 必须在事务中执行，否则抛出IllegalTransactionStateException</span>
        auditMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AuditLog</span>(operation, operator));
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AuditService auditService;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">businessOperation</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 正确：在事务中调用</span>
        doBusinessLogic();
        auditService.auditOperation(<span class="hljs-string">"业务操作"</span>, <span class="hljs-string">"user1"</span>); <span class="hljs-comment">// 正常执行</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">businessOperationWithoutTx</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 错误：无事务上下文</span>
        doBusinessLogic();
        auditService.auditOperation(<span class="hljs-string">"业务操作"</span>, <span class="hljs-string">"user1"</span>); <span class="hljs-comment">// 抛出异常！</span>
    }
}
</code></pre>
<h3 data-id="heading-7">4. REQUIRES_NEW - 新建事务</h3>
<p><strong>定义</strong>：创建一个新事务，如果当前存在事务，则挂起当前事务。</p>
<p><strong>使用场景</strong>：需要独立事务的操作，如审计日志、消息发送等，不希望受外部事务回滚影响。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotificationService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOrderNotification</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">try</span> {
            notificationMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>(order));
            <span class="hljs-comment">// 即使外部事务回滚，通知记录仍然保存</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 本地事务回滚，不影响外部事务</span>
            log.error(<span class="hljs-string">"发送通知失败"</span>, e);
        }
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> NotificationService notificationService;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">try</span> {
            orderMapper.insert(order);
            inventoryService.deductStock(order.getItems());
            
            <span class="hljs-comment">// 独立事务发送通知</span>
            notificationService.sendOrderNotification(order);
            
        } <span class="hljs-keyword">catch</span> (InventoryException e) {
            <span class="hljs-comment">// 订单创建回滚，但通知可能已发送（如果通知先提交）</span>
            log.error(<span class="hljs-string">"库存不足，订单创建失败"</span>, e);
            <span class="hljs-keyword">throw</span> e;
        }
    }
}
</code></pre>
<p><strong>执行时序</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">外部事务Tx1开始
  → 执行订单创建逻辑
  → 挂起Tx1，开启新事务Tx2
<span class="hljs-code">    → 发送通知（Tx2）
    → 提交Tx2
  → 恢复Tx1
  → 继续执行...
  → 提交/回滚Tx1（不影响已提交的Tx2）
</span></code></pre>
<h3 data-id="heading-8">5. NOT_SUPPORTED - 不支持事务</h3>
<p><strong>定义</strong>：以非事务方式执行，如果当前存在事务，则挂起当前事务。</p>
<p><strong>使用场景</strong>：不适合在事务中执行的操作，如调用外部系统、文件操作等。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExternalService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callExternalSystem</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 不在事务中执行，避免长事务</span>
        externalApiClient.sendOrder(order);
        <span class="hljs-comment">// 即使外部事务回滚，外部调用不会回滚</span>
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateReport</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-comment">// 生成复杂报表，可能耗时较长</span>
        <span class="hljs-comment">// 不希望阻塞主事务</span>
        <span class="hljs-type">Report</span> <span class="hljs-variable">report</span> <span class="hljs-operator">=</span> reportService.generateOrderReport(orderId);
        fileService.saveReport(report);
    }
}
</code></pre>
<h3 data-id="heading-9">6. NEVER - 禁止事务</h3>
<p><strong>定义</strong>：以非事务方式执行，如果当前存在事务，则抛出异常。</p>
<p><strong>使用场景</strong>：明确禁止在事务中执行的方法，如某些性能敏感的批量操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchOperationService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NEVER)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchInsertOrders</span><span class="hljs-params">(List&lt;Order&gt; orders)</span> {
        <span class="hljs-comment">// 明确要求不能在事务中执行</span>
        <span class="hljs-comment">// 如果调用方有事务，则抛出异常</span>
        <span class="hljs-keyword">for</span> (Order order : orders) {
            orderMapper.insert(order);
        }
    }
}

<span class="hljs-comment">// 错误用法示例</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WrongUsageService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processBatchInTransaction</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 错误：在事务中调用NEVER方法</span>
        List&lt;Order&gt; orders = generateOrders();
        batchOperationService.batchInsertOrders(orders); <span class="hljs-comment">// 抛出异常！</span>
    }
}
</code></pre>
<h3 data-id="heading-10">7. NESTED - 嵌套事务</h3>
<p><strong>定义</strong>：如果当前存在事务，则在嵌套事务内执行；如果当前没有事务，则创建新事务。</p>
<p><strong>使用场景</strong>：复杂的业务操作，希望部分操作可以独立回滚而不影响整个事务。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComplexOrderService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NESTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrderWithNestedTransaction</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 在主事务的嵌套事务中执行</span>
        orderMapper.insert(order);
        
        <span class="hljs-keyword">try</span> {
            inventoryService.deductStock(order.getItems());
        } <span class="hljs-keyword">catch</span> (InventoryException e) {
            <span class="hljs-comment">// 库存操作失败，回滚到保存点</span>
            <span class="hljs-comment">// 但订单记录可能保留（取决于具体实现）</span>
            log.error(<span class="hljs-string">"库存操作失败，回滚嵌套事务"</span>, e);
            <span class="hljs-comment">// 嵌套事务回滚，外部事务继续</span>
            <span class="hljs-keyword">throw</span> e;
        }
        
        <span class="hljs-comment">// 其他操作...</span>
    }
}
</code></pre>
<p><strong>重要说明</strong>：</p>
<ul>
<li>NESTED使用保存点（Savepoint）实现</li>
<li>嵌套事务回滚不会导致外部事务回滚</li>
<li>外部事务回滚会导致所有嵌套事务回滚</li>
<li>需要数据库支持保存点（大多数现代数据库都支持）</li>
</ul>
<h2 data-id="heading-11">实战场景分析</h2>
<h3 data-id="heading-12">场景一：订单创建 + 库存扣减 + 发送通知</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderFullProcessService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderFullProcess</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 主事务：订单核心业务</span>
        orderMapper.insert(order);
        inventoryService.deductStock(order.getItems());
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 独立事务：发送通知（即使主事务回滚，通知已发送）</span>
            notificationService.sendOrderNotification(order);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 通知失败不影响主事务</span>
            log.warn(<span class="hljs-string">"发送通知失败，但订单继续处理"</span>, e);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 非事务：调用外部系统（避免长事务）</span>
            externalService.callExternalSystem(order);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.warn(<span class="hljs-string">"外部调用失败，但订单继续处理"</span>, e);
        }
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InventoryService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.MANDATORY)</span> <span class="hljs-comment">// 必须在事务中</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(List&lt;OrderItem&gt; items)</span> {
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            <span class="hljs-keyword">if</span> (item.getQuantity() &gt; getAvailableStock(item.getProductId())) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InventoryException</span>(<span class="hljs-string">"库存不足: "</span> + item.getProductId());
            }
            inventoryMapper.deductStock(item.getProductId(), item.getQuantity());
        }
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotificationService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span> <span class="hljs-comment">// 独立事务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOrderNotification</span><span class="hljs-params">(Order order)</span> {
        notificationMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>(order));
        <span class="hljs-comment">// 即使外部事务回滚，通知记录仍然保存</span>
    }
}
</code></pre>
<h3 data-id="heading-13">场景二：批量处理 + 进度记录</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchProcessService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span> <span class="hljs-comment">// 无事务批量处理</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processLargeBatch</span><span class="hljs-params">(List&lt;Data&gt; batchData)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> batchData.size();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; total; i++) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 每个项目在独立事务中处理</span>
                processSingleItemInTransaction(batchData.get(i));
                successCount++;
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"处理第{}条数据失败"</span>, i, e);
            }
            
            <span class="hljs-comment">// 无事务记录进度</span>
            updateProgress(i + <span class="hljs-number">1</span>, total, successCount);
        }
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span> <span class="hljs-comment">// 每个项目独立事务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSingleItemInTransaction</span><span class="hljs-params">(Data data)</span> {
        dataMapper.process(data);
        <span class="hljs-comment">// 单条数据处理失败不影响其他数据</span>
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span> <span class="hljs-comment">// 无事务进度更新</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProgress</span><span class="hljs-params">(<span class="hljs-type">int</span> processed, <span class="hljs-type">int</span> total, <span class="hljs-type">int</span> success)</span> {
        progressMapper.update(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Progress</span>(processed, total, success));
        <span class="hljs-comment">// 进度更新立即提交，即使后续处理失败</span>
    }
}
</code></pre>
<h2 data-id="heading-14">常见陷阱与解决方案</h2>
<h3 data-id="heading-15">陷阱一：REQUIRES_NEW的事务悬挂</h3>
<p><strong>问题</strong>：在REQUIRES_NEW中发生异常，导致外部事务无法正常继续。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
    step1();
    innerMethod(); <span class="hljs-comment">// REQUIRES_NEW</span>
    step3(); <span class="hljs-comment">// 如果innerMethod异常，这里不会执行</span>
}

<span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
    step2();
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"内部方法失败"</span>);
}
</code></pre>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
    step1();
    <span class="hljs-keyword">try</span> {
        innerMethod(); <span class="hljs-comment">// REQUIRES_NEW</span>
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"内部方法执行失败，继续外部事务"</span>, e);
    }
    step3(); <span class="hljs-comment">// 正常执行</span>
}
</code></pre>
<h3 data-id="heading-16">陷阱二：NESTED事务的误解</h3>
<p><strong>问题</strong>：误以为NESTED事务完全独立。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误理解</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parentMethod</span><span class="hljs-params">()</span> {
    parentStep();
    nestedMethod(); <span class="hljs-comment">// NESTED</span>
    parentStep(); <span class="hljs-comment">// 认为nestedMethod回滚不影响这里</span>
}

<span class="hljs-meta">@Transactional(propagation = Propagation.NESTED)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nestedMethod</span><span class="hljs-params">()</span> {
    nestedStep();
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"嵌套事务失败"</span>);
    <span class="hljs-comment">// 实际会回滚到保存点，后续parentStep不会执行！</span>
}
</code></pre>
<p><strong>正确理解</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parentMethod</span><span class="hljs-params">()</span> {
    parentStep();
    <span class="hljs-keyword">try</span> {
        nestedMethod(); <span class="hljs-comment">// NESTED</span>
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"嵌套事务失败，继续主事务"</span>, e);
    }
    parentStep(); <span class="hljs-comment">// 这里会执行</span>
}
</code></pre>
<h3 data-id="heading-17">陷阱三：传播机制组合不当</h3>
<p><strong>问题</strong>：传播机制组合导致事务边界混乱。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 混乱的事务边界</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfusedService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
        methodB(); <span class="hljs-comment">// SUPPORTS</span>
        methodC(); <span class="hljs-comment">// REQUIRES_NEW</span>
        methodD(); <span class="hljs-comment">// NEVER - 这里会抛异常！</span>
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 可能不在事务中执行</span>
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodC</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 新事务</span>
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NEVER)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodD</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 禁止事务 - 在methodA事务中调用会抛异常！</span>
    }
}
</code></pre>
<p><strong>解决方案</strong>：明确事务边界，合理设计服务层。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClearBoundaryService</span> {
    
    <span class="hljs-comment">// 事务边界清晰的服务</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transactionalProcess</span><span class="hljs-params">()</span> {
        transactionalStep1();
        transactionalStep2();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nonTransactionalProcess</span><span class="hljs-params">()</span> {
        nonTransactionalStep1();
        independentTransactionalStep();
        nonTransactionalStep2();
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">independentTransactionalStep</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 独立事务操作</span>
    }
}
</code></pre>
<h2 data-id="heading-18">性能考虑与最佳实践</h2>
<h3 data-id="heading-19">1. 事务粒度的控制</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 不推荐：过大的事务</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processLargeBatch</span><span class="hljs-params">(List&lt;Data&gt; dataList)</span> {
    <span class="hljs-keyword">for</span> (Data data : dataList) {
        processSingle(data); <span class="hljs-comment">// 每个处理都在大事务中</span>
    }
    <span class="hljs-comment">// 事务过大，锁持有时间过长</span>
}

<span class="hljs-comment">// 推荐：合适的事务粒度</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processLargeBatch</span><span class="hljs-params">(List&lt;Data&gt; dataList)</span> {
    <span class="hljs-keyword">for</span> (Data data : dataList) {
        processSingleInTransaction(data); <span class="hljs-comment">// 每个独立事务</span>
    }
}

<span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSingleInTransaction</span><span class="hljs-params">(Data data)</span> {
    processSingle(data);
    <span class="hljs-comment">// 短事务，快速释放锁</span>
}
</code></pre>
<h3 data-id="heading-20">2. 只读事务的优化</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 查询服务使用只读事务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">findOrderById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> orderMapper.selectById(id);
    }
    
    <span class="hljs-meta">@Transactional(readOnly = true)</span> 
    <span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title function_">findComplexOrders</span><span class="hljs-params">(QueryCondition condition)</span> {
        <span class="hljs-comment">// 复杂查询在只读事务中执行</span>
        <span class="hljs-comment">// 可能路由到只读数据库副本</span>
        <span class="hljs-keyword">return</span> orderMapper.selectByComplexCondition(condition);
    }
}
</code></pre>
<h3 data-id="heading-21">3. 异常处理策略</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RobustService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">robustProcess</span><span class="hljs-params">()</span> {
        criticalOperation();
        
        <span class="hljs-keyword">try</span> {
            optionalOperationWithNewTx();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.warn(<span class="hljs-string">"可选操作失败，继续主流程"</span>, e);
        }
        
        <span class="hljs-keyword">try</span> {
            externalCallWithoutTx();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.warn(<span class="hljs-string">"外部调用失败，继续主流程"</span>, e);
        }
        
        anotherCriticalOperation();
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">optionalOperationWithNewTx</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 独立事务，失败不影响主流程</span>
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">externalCallWithoutTx</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 无事务外部调用</span>
    }
}
</code></pre>
<h2 data-id="heading-22">调试与监控</h2>
<h3 data-id="heading-23">事务调试技巧</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">debugTransactionMethod</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 查看当前事务状态</span>
    <span class="hljs-type">TransactionStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> TransactionAspectSupport.currentTransactionStatus();
    log.debug(<span class="hljs-string">"事务信息: {}"</span>, status);
    
    <span class="hljs-comment">// 检查是否是新建事务</span>
    <span class="hljs-keyword">if</span> (status.isNewTransaction()) {
        log.debug(<span class="hljs-string">"这是新创建的事务"</span>);
    } <span class="hljs-keyword">else</span> {
        log.debug(<span class="hljs-string">"这是已存在的事务"</span>);
    }
    
    <span class="hljs-comment">// 检查事务名称</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">transactionName</span> <span class="hljs-operator">=</span> status.getTransactionName();
    log.debug(<span class="hljs-string">"事务名称: {}"</span>, transactionName);
}
</code></pre>
<h3 data-id="heading-24">日志配置</h3>
<pre><code class="hljs language-properties" lang="properties"># application.properties
# 开启事务调试日志
logging.level.org.springframework.transaction.interceptor=TRACE
logging.level.org.springframework.transaction.support=DEBUG
logging.level.org.springframework.orm.jpa=DEBUG
logging.level.org.springframework.jdbc.datasource=DEBUG

# 显示事务边界
logging.level.org.springframework.transaction=DEBUG
</code></pre>
<h3 data-id="heading-25">监控指标</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionMetrics</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MeterRegistry meterRegistry;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Counter&gt; propagationCounters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorTransaction</span><span class="hljs-params">(TransactionEvent event)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">propagation</span> <span class="hljs-operator">=</span> getPropagationType(event);
        <span class="hljs-type">Counter</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> propagationCounters.computeIfAbsent(
            propagation, 
            key -&gt; meterRegistry.counter(<span class="hljs-string">"transaction.propagation"</span>, <span class="hljs-string">"type"</span>, key)
        );
        counter.increment();
    }
}
</code></pre>
<h2 data-id="heading-26">总结</h2>
<p>Spring的7种事务传播机制为复杂业务场景提供了灵活的事务管理方案。正确理解和使用这些传播行为，可以帮助我们：</p>
<ol>
<li><strong>REQUIRED</strong> - 大多数业务方法的默认选择</li>
<li><strong>SUPPORTS</strong> - 适合查询操作，灵活适应事务上下文</li>
<li><strong>MANDATORY</strong> - 强制事务环境，防止误用</li>
<li><strong>REQUIRES_NEW</strong> - 独立事务操作，避免相互影响</li>
<li><strong>NOT_SUPPORTED</strong> - 非事务操作，避免长事务</li>
<li><strong>NEVER</strong> - 明确禁止事务，保证无事务执行</li>
<li><strong>NESTED</strong> - 复杂事务场景，部分回滚能力</li>
</ol>
<p>记住，没有"最好"的传播机制，只有"最适合"当前场景的选择。合理组合使用这些机制，可以构建出既健壮又高性能的事务处理系统。</p>
<hr/>
<p><strong>下期预告</strong>：《Spring事务隔离级别全解析：从读未提交到序列化》</p>
<p>如果觉得本文对你有帮助，请点赞、收藏、关注！欢迎在评论区分享你的实战经验和遇到的问题。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux 防火墙双雄：iptables 与 firewalld 配置案例详解]]></title>    <link>https://juejin.cn/post/7571352754896355354</link>    <guid>https://juejin.cn/post/7571352754896355354</guid>    <pubDate>2025-11-11T23:33:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571352754896355354" data-draft-id="7570909641683173416" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux 防火墙双雄：iptables 与 firewalld 配置案例详解"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-11-11T23:33:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LCG元"/> <meta itemprop="url" content="https://juejin.cn/user/3097802498120889"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux 防火墙双雄：iptables 与 firewalld 配置案例详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097802498120889/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LCG元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T23:33:55.000Z" title="Tue Nov 11 2025 23:33:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. Linux 防火墙基础概念</h2>
<h3 data-id="heading-1">1.1 防火墙的重要性</h3>
<p>在当今的网络环境中，防火墙是保护系统安全的第一道防线。它通过控制网络流量进出系统，有效阻止未经授权的访问和恶意攻击。</p>
<h3 data-id="heading-2">1.2 iptables 与 firewalld 的关系</h3>
<p>iptables 是 Linux 内核中网络包过滤系统的用户空间工具，而 firewalld 是基于 iptables 的高级管理工具，提供了更友好的动态管理接口。</p>
<h2 data-id="heading-3">2. iptables 配置详解</h2>
<h3 data-id="heading-4">2.1 iptables 基础架构</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[网络数据包] --&gt; B{iptables 链选择}
    B --&gt; C[INPUT 链]
    B --&gt; D[FORWARD 链]
    B --&gt; E[OUTPUT 链]
    
    C --&gt; F{INPUT 规则匹配}
    F --&gt; G[规则1: 允许SSH]
    F --&gt; H[规则2: 允许HTTP]
    F --&gt; I[规则3: 默认拒绝]
    G --&gt; J[接受]
    H --&gt; J
    I --&gt; K[拒绝]
    
    D --&gt; L{FORWARD 规则匹配}
    L --&gt; M[规则1: 允许转发]
    L --&gt; N[规则2: 默认拒绝]
    M --&gt; O[接受]
    N --&gt; P[拒绝]
    
    E --&gt; Q{OUTPUT 规则匹配}
    Q --&gt; R[规则1: 允许所有]
    R --&gt; S[接受]
    
    style A fill:#e1f5fe
    style J fill:#c8e6c9
    style K fill:#ffcdd2
    style O fill:#c8e6c9
    style P fill:#ffcdd2
    style S fill:#c8e6c9
    style G fill:#4fc3f7
    style H fill:#4fc3f7
    style I fill:#ff9800
    style M fill:#4fc3f7
    style N fill:#ff9800
    style R fill:#4fc3f7
</code></pre>
<h3 data-id="heading-5">2.2 创建基础 iptables 配置文件</h3>
<p><strong>创建文件：</strong> <code>/root/iptables-basic-setup.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># iptables 基础防火墙配置脚本</span>
<span class="hljs-comment"># 作者：Linux 系统管理员</span>
<span class="hljs-comment"># 描述：配置基本的防火墙规则，保护服务器安全</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始配置 iptables 防火墙..."</span>

<span class="hljs-comment"># 1. 清除所有现有规则</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤1: 清除所有现有规则"</span>
iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X

<span class="hljs-comment"># 2. 设置默认策略</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤2: 设置默认策略"</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

<span class="hljs-comment"># 3. 允许本地回环接口</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤3: 配置本地回环接口规则"</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="hljs-comment"># 4. 允许已建立的连接和相关的连接</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤4: 允许已建立的连接"</span>
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

<span class="hljs-comment"># 5. 允许 SSH 连接 (端口22)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤5: 配置 SSH 访问规则"</span>
iptables -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT

<span class="hljs-comment"># 6. 允许 HTTP 和 HTTPS 访问</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤6: 配置 Web 服务访问规则"</span>
iptables -A INPUT -p tcp --dport 80 -m state --state NEW -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -m state --state NEW -j ACCEPT

<span class="hljs-comment"># 7. 允许 ICMP (ping)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤7: 配置 ICMP 规则"</span>
iptables -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT

<span class="hljs-comment"># 8. 记录被拒绝的数据包</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤8: 配置日志记录规则"</span>
iptables -A INPUT -j LOG --log-prefix <span class="hljs-string">"IPTABLES-DROPPED: "</span> --log-level 4

<span class="hljs-comment"># 9. 显示规则列表</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤9: 显示当前规则"</span>
iptables -L -v

<span class="hljs-built_in">echo</span> <span class="hljs-string">"iptables 基础配置完成！"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"请注意：当前 SSH 连接不会被中断，但新连接将受规则限制。"</span>
</code></pre>
<h3 data-id="heading-6">2.3 创建高级 iptables 配置</h3>
<p><strong>创建文件：</strong> <code>/root/iptables-advanced-setup.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># iptables 高级防火墙配置脚本</span>
<span class="hljs-comment"># 包含端口限制、连接限制和攻击防护</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始配置高级 iptables 防火墙..."</span>

<span class="hljs-comment"># 清除现有规则</span>
iptables -F
iptables -X

<span class="hljs-comment"># 默认策略</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

<span class="hljs-comment"># 1. 基础规则</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

<span class="hljs-comment"># 2. 保护 against 常见攻击</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"配置常见攻击防护..."</span>

<span class="hljs-comment"># 2.1 防止 SYN 洪水攻击</span>
iptables -A INPUT -p tcp --syn -m <span class="hljs-built_in">limit</span> --<span class="hljs-built_in">limit</span> 1/s --limit-burst 3 -j ACCEPT
iptables -A INPUT -p tcp --syn -j DROP

<span class="hljs-comment"># 2.2 防止 ping 洪水攻击</span>
iptables -A INPUT -p icmp --icmp-type echo-request -m <span class="hljs-built_in">limit</span> --<span class="hljs-built_in">limit</span> 1/s -j ACCEPT

<span class="hljs-comment"># 2.3 防止端口扫描</span>
iptables -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP
iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP
iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP

<span class="hljs-comment"># 3. 服务端口配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"配置服务端口..."</span>

<span class="hljs-comment"># 3.1 SSH 保护 - 限制连接频率</span>
iptables -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --<span class="hljs-built_in">set</span> --name SSH
iptables -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

<span class="hljs-comment"># 3.2 Web 服务</span>
iptables -A INPUT -p tcp --dport 80 -m state --state NEW -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -m state --state NEW -j ACCEPT

<span class="hljs-comment"># 3.3 数据库服务 (MySQL)</span>
iptables -A INPUT -p tcp --dport 3306 -s 192.168.1.0/24 -j ACCEPT

<span class="hljs-comment"># 3.4 自定义应用端口</span>
iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
iptables -A INPUT -p tcp --dport 8443 -j ACCEPT

<span class="hljs-comment"># 4. 时间限制规则示例</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"配置时间限制规则..."</span>

<span class="hljs-comment"># 允许办公时间访问特定服务 (9:00-18:00)</span>
iptables -A INPUT -p tcp --dport 9090 -m time --timestart 09:00 --timestop 18:00 --weekdays Mon,Tue,Wed,Thu,Fri -j ACCEPT

<span class="hljs-comment"># 5. 地理限制示例 (需要 xt_geoip 模块)</span>
<span class="hljs-comment"># iptables -A INPUT -p tcp --dport 80 -m geoip --src-cc CN,US,JP -j ACCEPT</span>

<span class="hljs-comment"># 6. 记录被拒绝的连接</span>
iptables -A INPUT -m <span class="hljs-built_in">limit</span> --<span class="hljs-built_in">limit</span> 5/min -j LOG --log-prefix <span class="hljs-string">"iptables denied: "</span> --log-level 7

<span class="hljs-comment"># 保存规则</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"保存规则..."</span>
service iptables save

<span class="hljs-comment"># 显示最终规则</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"最终防火墙规则："</span>
iptables -L -v -n

<span class="hljs-built_in">echo</span> <span class="hljs-string">"高级 iptables 配置完成！"</span>
</code></pre>
<h3 data-id="heading-7">2.4 创建 iptables 持久化脚本</h3>
<p><strong>创建文件：</strong> <code>/root/iptables-persistent-setup.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># iptables 规则持久化配置脚本</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"配置 iptables 规则持久化..."</span>

<span class="hljs-comment"># 检查系统类型</span>
<span class="hljs-keyword">if</span> [ -f /etc/redhat-release ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment"># CentOS/RHEL 系统</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"检测到 CentOS/RHEL 系统"</span>
    
    <span class="hljs-comment"># 安装 iptables-services</span>
    yum install -y iptables-services
    
    <span class="hljs-comment"># 保存当前规则</span>
    iptables-save &gt; /etc/sysconfig/iptables
    
    <span class="hljs-comment"># 启用服务</span>
    systemctl <span class="hljs-built_in">enable</span> iptables
    systemctl start iptables
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"规则已保存到 /etc/sysconfig/iptables"</span>
    
<span class="hljs-keyword">elif</span> [ -f /etc/debian_version ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment"># Debian/Ubuntu 系统</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"检测到 Debian/Ubuntu 系统"</span>
    
    <span class="hljs-comment"># 安装 iptables-persistent</span>
    apt-get update
    apt-get install -y iptables-persistent
    
    <span class="hljs-comment"># 保存规则</span>
    iptables-save &gt; /etc/iptables/rules.v4
    ip6tables-save &gt; /etc/iptables/rules.v6
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"规则已保存到 /etc/iptables/rules.v4"</span>
    
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"未知的系统类型，请手动保存规则。"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"可以使用: iptables-save &gt; /path/to/iptables.rules"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 创建备份</span>
BACKUP_DIR=<span class="hljs-string">"/root/iptables-backup"</span>
<span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$BACKUP_DIR</span>
iptables-save &gt; <span class="hljs-variable">$BACKUP_DIR</span>/iptables-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d-%H%M%S).rules

<span class="hljs-built_in">echo</span> <span class="hljs-string">"iptables 持久化配置完成！"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"备份文件保存在: <span class="hljs-variable">$BACKUP_DIR</span>"</span>
</code></pre>
<h2 data-id="heading-8">3. firewalld 配置详解</h2>
<h3 data-id="heading-9">3.1 firewalld 核心概念</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[firewalld 守护进程] --&gt; B[运行时配置]
    A --&gt; C[永久配置]
    
    B --&gt; D[立即生效]
    B --&gt; E[重启后丢失]
    
    C --&gt; F[重启后生效]
    C --&gt; G[需要重载]
    
    H[防火墙规则] --&gt; I[ Zones 区域 ]
    H --&gt; J[ Services 服务 ]
    H --&gt; K[ Ports 端口 ]
    H --&gt; L[ Rich Rules 富规则 ]
    
    I --&gt; M[public]
    I --&gt; N[internal]
    I --&gt; O[dmz]
    I --&gt; P[trusted]
    
    J --&gt; Q[ssh]
    J --&gt; R[http]
    J --&gt; S[https]
    
    K --&gt; T[端口转发]
    K --&gt; U[直接规则]
    
    L --&gt; V[复杂规则]
    L --&gt; W[源地址限制]
    L --&gt; X[时间限制]
    
    style A fill:#1565c0
    style I fill:#00796b
    style J fill:#d84315
    style K fill:#6a1b9a
    style L fill:#ff8f00
    style M fill:#4caf50
    style N fill:#4caf50
    style O fill:#4caf50
    style P fill:#4caf50
</code></pre>
<h3 data-id="heading-10">3.2 基础 firewalld 配置脚本</h3>
<p><strong>创建文件：</strong> <code>/root/firewalld-basic-setup.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># firewalld 基础配置脚本</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始配置 firewalld 防火墙..."</span>

<span class="hljs-comment"># 1. 启动和启用 firewalld</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤1: 启动 firewalld 服务"</span>
systemctl start firewalld
systemctl <span class="hljs-built_in">enable</span> firewalld

<span class="hljs-comment"># 2. 检查 firewalld 状态</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤2: 检查服务状态"</span>
firewall-cmd --state
systemctl status firewalld --no-pager -l

<span class="hljs-comment"># 3. 查看默认区域</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤3: 查看当前区域配置"</span>
firewall-cmd --get-default-zone
firewall-cmd --get-active-zones

<span class="hljs-comment"># 4. 配置默认区域为 public</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤4: 配置默认区域"</span>
firewall-cmd --set-default-zone=public

<span class="hljs-comment"># 5. 添加基本服务</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤5: 添加基本服务到防火墙"</span>

<span class="hljs-comment"># 5.1 SSH 服务</span>
firewall-cmd --permanent --add-service=ssh
<span class="hljs-built_in">echo</span> <span class="hljs-string">"添加 SSH 服务"</span>

<span class="hljs-comment"># 5.2 HTTP 服务</span>
firewall-cmd --permanent --add-service=http
<span class="hljs-built_in">echo</span> <span class="hljs-string">"添加 HTTP 服务"</span>

<span class="hljs-comment"># 5.3 HTTPS 服务</span>
firewall-cmd --permanent --add-service=https
<span class="hljs-built_in">echo</span> <span class="hljs-string">"添加 HTTPS 服务"</span>

<span class="hljs-comment"># 6. 移除不需要的服务 (示例)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤6: 移除不需要的服务"</span>
firewall-cmd --permanent --remove-service=dhcpv6-client 2&gt;/dev/null || <span class="hljs-literal">true</span>

<span class="hljs-comment"># 7. 添加自定义端口</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤7: 添加自定义端口"</span>
firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd --permanent --add-port=8443/tcp
<span class="hljs-built_in">echo</span> <span class="hljs-string">"添加端口 8080/tcp 和 8443/tcp"</span>

<span class="hljs-comment"># 8. 配置富规则 (Rich Rules)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤8: 配置富规则"</span>

<span class="hljs-comment"># 8.1 限制 SSH 访问来源</span>
firewall-cmd --permanent --add-rich-rule=<span class="hljs-string">'rule family="ipv4" source address="192.168.1.0/24" service name="ssh" accept'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"限制 SSH 访问来源为 192.168.1.0/24"</span>

<span class="hljs-comment"># 8.2 拒绝其他所有流量</span>
firewall-cmd --permanent --add-rich-rule=<span class="hljs-string">'rule family="ipv4" source address="0.0.0.0/0" service name="ssh" drop'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"拒绝其他来源的 SSH 访问"</span>

<span class="hljs-comment"># 9. 重载防火墙配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤9: 重载防火墙配置"</span>
firewall-cmd --reload

<span class="hljs-comment"># 10. 验证配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤10: 验证防火墙配置"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"当前区域服务:"</span>
firewall-cmd --list-services
<span class="hljs-built_in">echo</span> <span class="hljs-string">"当前区域端口:"</span>
firewall-cmd --list-ports
<span class="hljs-built_in">echo</span> <span class="hljs-string">"富规则:"</span>
firewall-cmd --list-rich-rules

<span class="hljs-built_in">echo</span> <span class="hljs-string">"firewalld 基础配置完成！"</span>
</code></pre>
<h3 data-id="heading-11">3.3 高级 firewalld 配置脚本</h3>
<p><strong>创建文件：</strong> <code>/root/firewalld-advanced-setup.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># firewalld 高级配置脚本</span>
<span class="hljs-comment"># 包含多个区域配置、端口转发和高级特性</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始高级 firewalld 配置..."</span>

<span class="hljs-comment"># 确保 firewalld 运行</span>
systemctl start firewalld

<span class="hljs-comment"># 1. 创建自定义区域</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤1: 创建自定义区域"</span>

<span class="hljs-comment"># 1.1 创建 webzone 区域</span>
firewall-cmd --permanent --new-zone=webzone
firewall-cmd --permanent --new-zone=internal

<span class="hljs-comment"># 1.2 配置 webzone 区域</span>
firewall-cmd --permanent --zone=webzone --add-service=http
firewall-cmd --permanent --zone=webzone --add-service=https
firewall-cmd --permanent --zone=webzone --add-port=8080/tcp
firewall-cmd --permanent --zone=webzone --set-target=ACCEPT

<span class="hljs-comment"># 1.3 配置 internal 区域</span>
firewall-cmd --permanent --zone=internal --add-service=ssh
firewall-cmd --permanent --zone=internal --add-service=mysql
firewall-cmd --permanent --zone=internal --add-service=postgresql
firewall-cmd --permanent --zone=internal --add-source=192.168.1.0/24

<span class="hljs-comment"># 2. 配置端口转发</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤2: 配置端口转发"</span>

<span class="hljs-comment"># 2.1 启用 IP 伪装</span>
firewall-cmd --permanent --zone=public --add-masquerade

<span class="hljs-comment"># 2.2 配置端口转发 (将公网80端口转发到内网服务器)</span>
firewall-cmd --permanent --zone=public --add-forward-port=port=80:proto=tcp:toport=8080:toaddr=192.168.1.100

<span class="hljs-comment"># 3. ICMP 阻塞配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤3: 配置 ICMP 阻塞"</span>
firewall-cmd --permanent --zone=public --add-icmp-block=echo-request
firewall-cmd --permanent --zone=public --add-icmp-block=echo-reply

<span class="hljs-comment"># 4. 直接规则配置 (Direct Rules)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤4: 配置直接规则"</span>

<span class="hljs-comment"># 4.1 添加直接规则到 INPUT 链</span>
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --dport 9090 -j ACCEPT

<span class="hljs-comment"># 4.2 添加连接限制规则</span>
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --dport 22 -m state --state NEW -m recent --<span class="hljs-built_in">set</span> --name ssh --rsource
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --name ssh --rsource -j DROP

<span class="hljs-comment"># 5. 恐慌模式配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤5: 配置恐慌模式"</span>
firewall-cmd --set-panic-off
<span class="hljs-built_in">echo</span> <span class="hljs-string">"恐慌模式已关闭"</span>

<span class="hljs-comment"># 6. 锁定配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤6: 配置白名单锁定"</span>
firewall-cmd --permanent --add-lockdown-whitelist-command=/usr/bin/systemctl
firewall-cmd --permanent --add-lockdown-whitelist-command=/usr/bin/firewall-cmd
firewall-cmd --permanent --add-lockdown-whitelist-user=root

<span class="hljs-comment"># 7. 重载配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤7: 重载防火墙配置"</span>
firewall-cmd --reload

<span class="hljs-comment"># 8. 验证高级配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤8: 验证高级配置"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"所有区域:"</span>
firewall-cmd --list-all-zones

<span class="hljs-built_in">echo</span> <span class="hljs-string">"直接规则:"</span>
firewall-cmd --direct --get-all-rules

<span class="hljs-built_in">echo</span> <span class="hljs-string">"锁定白名单:"</span>
firewall-cmd --list-lockdown-whitelist-commands
firewall-cmd --list-lockdown-whitelist-users

<span class="hljs-built_in">echo</span> <span class="hljs-string">"端口转发:"</span>
firewall-cmd --list-forward-ports

<span class="hljs-built_in">echo</span> <span class="hljs-string">"高级 firewalld 配置完成！"</span>
</code></pre>
<h3 data-id="heading-12">3.4 firewalld 服务管理脚本</h3>
<p><strong>创建文件：</strong> <code>/root/firewalld-service-management.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># firewalld 服务管理脚本</span>
<span class="hljs-comment"># 用于管理自定义服务定义</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始配置 firewalld 自定义服务..."</span>

<span class="hljs-comment"># 创建自定义服务目录</span>
CUSTOM_SERVICE_DIR=<span class="hljs-string">"/etc/firewalld/services"</span>
<span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$CUSTOM_SERVICE_DIR</span>

<span class="hljs-comment"># 1. 创建自定义应用服务</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤1: 创建自定义服务定义"</span>

<span class="hljs-comment"># 1.1 创建 nodejs-app 服务</span>
<span class="hljs-built_in">cat</span> &gt; <span class="hljs-variable">$CUSTOM_SERVICE_DIR</span>/nodejs-app.xml &lt;&lt; <span class="hljs-string">EOF
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
  &lt;short&gt;Node.js Application&lt;/short&gt;
  &lt;description&gt;This service allows access to Node.js web application on ports 3000 and 3001.&lt;/description&gt;
  &lt;port protocol="tcp" port="3000"/&gt;
  &lt;port protocol="tcp" port="3001"/&gt;
  &lt;module name="nf_conntrack_netbios_ns"/&gt;
&lt;/service&gt;
EOF</span>

<span class="hljs-comment"># 1.2 创建 mongodb 服务</span>
<span class="hljs-built_in">cat</span> &gt; <span class="hljs-variable">$CUSTOM_SERVICE_DIR</span>/mongodb.xml &lt;&lt; <span class="hljs-string">EOF
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
  &lt;short&gt;MongoDB Database&lt;/short&gt;
  &lt;description&gt;This service allows access to MongoDB database on default port 27017.&lt;/description&gt;
  &lt;port protocol="tcp" port="27017"/&gt;
&lt;/service&gt;
EOF</span>

<span class="hljs-comment"># 1.3 创建 redis 服务</span>
<span class="hljs-built_in">cat</span> &gt; <span class="hljs-variable">$CUSTOM_SERVICE_DIR</span>/redis.xml &lt;&lt; <span class="hljs-string">EOF
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
  &lt;short&gt;Redis Cache&lt;/short&gt;
  &lt;description&gt;This service allows access to Redis caching service on port 6379.&lt;/description&gt;
  &lt;port protocol="tcp" port="6379"/&gt;
&lt;/service&gt;
EOF</span>

<span class="hljs-comment"># 2. 设置正确的文件权限</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤2: 设置文件权限"</span>
<span class="hljs-built_in">chown</span> root:root <span class="hljs-variable">$CUSTOM_SERVICE_DIR</span>/*.xml
<span class="hljs-built_in">chmod</span> 640 <span class="hljs-variable">$CUSTOM_SERVICE_DIR</span>/*.xml

<span class="hljs-comment"># 3. 重载 firewalld 以识别新服务</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤3: 重载服务定义"</span>
firewall-cmd --reload

<span class="hljs-comment"># 4. 添加自定义服务到防火墙</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤4: 添加自定义服务到防火墙"</span>

<span class="hljs-comment"># 4.1 添加 nodejs-app 服务到 internal 区域</span>
firewall-cmd --permanent --zone=internal --add-service=nodejs-app

<span class="hljs-comment"># 4.2 添加 mongodb 服务到 internal 区域</span>
firewall-cmd --permanent --zone=internal --add-service=mongodb

<span class="hljs-comment"># 4.3 添加 redis 服务到 internal 区域</span>
firewall-cmd --permanent --zone=internal --add-service=redis

<span class="hljs-comment"># 5. 重载配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤5: 重载防火墙配置"</span>
firewall-cmd --reload

<span class="hljs-comment"># 6. 验证自定义服务</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤6: 验证自定义服务配置"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"可用的自定义服务:"</span>
firewall-cmd --get-services | grep -E <span class="hljs-string">"(nodejs-app|mongodb|redis)"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"internal 区域的服务:"</span>
firewall-cmd --zone=internal --list-services

<span class="hljs-built_in">echo</span> <span class="hljs-string">"服务文件内容:"</span>
<span class="hljs-keyword">for</span> service_file <span class="hljs-keyword">in</span> <span class="hljs-variable">$CUSTOM_SERVICE_DIR</span>/*.xml; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"=== <span class="hljs-variable">$service_file</span> ==="</span>
    <span class="hljs-built_in">cat</span> <span class="hljs-variable">$service_file</span>
    <span class="hljs-built_in">echo</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"firewalld 自定义服务配置完成！"</span>
</code></pre>
<h2 data-id="heading-13">4. 实战配置案例</h2>
<h3 data-id="heading-14">4.1 Web 服务器防火墙配置</h3>
<p><strong>创建文件：</strong> <code>/root/web-server-firewall.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># Web 服务器专用防火墙配置</span>
<span class="hljs-comment"># 适用于 Apache/Nginx web 服务器</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始配置 Web 服务器防火墙..."</span>

<span class="hljs-comment"># 检测使用的防火墙工具</span>
<span class="hljs-keyword">if</span> systemctl is-active --quiet firewalld; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"使用 firewalld 进行配置"</span>
    FIREWALL_TYPE=<span class="hljs-string">"firewalld"</span>
<span class="hljs-keyword">elif</span> systemctl is-active --quiet iptables; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"使用 iptables 进行配置"</span>
    FIREWALL_TYPE=<span class="hljs-string">"iptables"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"未发现活动的防火墙服务，将安装并配置 firewalld"</span>
    yum install -y firewalld || apt-get install -y firewalld
    systemctl start firewalld
    systemctl <span class="hljs-built_in">enable</span> firewalld
    FIREWALL_TYPE=<span class="hljs-string">"firewalld"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$FIREWALL_TYPE</span>"</span> = <span class="hljs-string">"firewalld"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment"># firewalld 配置</span>
    
    <span class="hljs-comment"># 创建 web-server 区域</span>
    firewall-cmd --permanent --new-zone=web-server
    
    <span class="hljs-comment"># 配置 web-server 区域</span>
    firewall-cmd --permanent --zone=web-server --add-service=http
    firewall-cmd --permanent --zone=web-server --add-service=https
    firewall-cmd --permanent --zone=web-server --add-service=ssh
    firewall-cmd --permanent --zone=web-server --add-port=8080/tcp
    firewall-cmd --permanent --zone=web-server --add-port=8443/tcp
    
    <span class="hljs-comment"># 设置默认区域</span>
    firewall-cmd --set-default-zone=web-server
    
    <span class="hljs-comment"># 添加富规则保护</span>
    firewall-cmd --permanent --zone=web-server --add-rich-rule=<span class="hljs-string">'
        rule family="ipv4" source address="192.168.1.0/24" port port="22" protocol="tcp" accept'</span>
    
    firewall-cmd --permanent --zone=web-server --add-rich-rule=<span class="hljs-string">'
        rule family="ipv4" source address="0.0.0.0/0" port port="22" protocol="tcp" drop'</span>
    
    <span class="hljs-comment"># 重载配置</span>
    firewall-cmd --reload
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"firewalld Web 服务器配置完成"</span>
    
<span class="hljs-keyword">else</span>
    <span class="hljs-comment"># iptables 配置</span>
    
    <span class="hljs-comment"># 清除现有规则</span>
    iptables -F
    iptables -X
    
    <span class="hljs-comment"># 默认策略</span>
    iptables -P INPUT DROP
    iptables -P FORWARD DROP
    iptables -P OUTPUT ACCEPT
    
    <span class="hljs-comment"># 基础规则</span>
    iptables -A INPUT -i lo -j ACCEPT
    iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
    
    <span class="hljs-comment"># Web 服务端口</span>
    iptables -A INPUT -p tcp --dport 80 -m state --state NEW -j ACCEPT
    iptables -A INPUT -p tcp --dport 443 -m state --state NEW -j ACCEPT
    iptables -A INPUT -p tcp --dport 8080 -m state --state NEW -j ACCEPT
    iptables -A INPUT -p tcp --dport 8443 -m state --state NEW -j ACCEPT
    
    <span class="hljs-comment"># SSH 保护</span>
    iptables -A INPUT -p tcp --dport 22 -s 192.168.1.0/24 -j ACCEPT
    iptables -A INPUT -p tcp --dport 22 -j DROP
    
    <span class="hljs-comment"># 保存规则</span>
    service iptables save
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"iptables Web 服务器配置完成"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 显示最终配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"最终防火墙配置:"</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$FIREWALL_TYPE</span>"</span> = <span class="hljs-string">"firewalld"</span> ]; <span class="hljs-keyword">then</span>
    firewall-cmd --list-all
<span class="hljs-keyword">else</span>
    iptables -L -v -n
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Web 服务器防火墙配置完成！"</span>
</code></pre>
<h3 data-id="heading-15">4.2 数据库服务器防火墙配置</h3>
<p><strong>创建文件：</strong> <code>/root/database-server-firewall.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 数据库服务器专用防火墙配置</span>
<span class="hljs-comment"># 适用于 MySQL, PostgreSQL, MongoDB 等数据库</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始配置数据库服务器防火墙..."</span>

<span class="hljs-comment"># 使用 firewalld 进行配置</span>
systemctl start firewalld
systemctl <span class="hljs-built_in">enable</span> firewalld

<span class="hljs-comment"># 创建 database-zone 区域</span>
firewall-cmd --permanent --new-zone=database-zone

<span class="hljs-comment"># 配置数据库区域</span>
firewall-cmd --permanent --zone=database-zone --add-service=ssh
firewall-cmd --permanent --zone=database-zone --add-service=mysql
firewall-cmd --permanent --zone=database-zone --add-service=postgresql

<span class="hljs-comment"># 添加自定义数据库端口</span>
firewall-cmd --permanent --zone=database-zone --add-port=27017/tcp  <span class="hljs-comment"># MongoDB</span>
firewall-cmd --permanent --zone=database-zone --add-port=5432/tcp   <span class="hljs-comment"># PostgreSQL</span>
firewall-cmd --permanent --zone=database-zone --add-port=3306/tcp   <span class="hljs-comment"># MySQL</span>

<span class="hljs-comment"># 设置源地址限制</span>
firewall-cmd --permanent --zone=database-zone --add-source=192.168.1.0/24
firewall-cmd --permanent --zone=database-zone --add-source=10.0.0.0/24

<span class="hljs-comment"># 设置默认区域为 drop</span>
firewall-cmd --permanent --zone=database-zone --set-target=DROP

<span class="hljs-comment"># 设置 database-zone 为默认区域</span>
firewall-cmd --set-default-zone=database-zone

<span class="hljs-comment"># 重载配置</span>
firewall-cmd --reload

<span class="hljs-comment"># 验证配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"数据库区域配置:"</span>
firewall-cmd --zone=database-zone --list-all

<span class="hljs-built_in">echo</span> <span class="hljs-string">"数据库服务器防火墙配置完成！"</span>
</code></pre>
<h2 data-id="heading-16">5. 监控和故障排除</h2>
<h3 data-id="heading-17">5.1 防火墙监控脚本</h3>
<p><strong>创建文件：</strong> <code>/root/firewall-monitor.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 防火墙监控和状态检查脚本</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始防火墙状态检查..."</span>

<span class="hljs-comment"># 获取当前时间</span>
CURRENT_TIME=$(<span class="hljs-built_in">date</span> <span class="hljs-string">"+%Y-%m-%d %H:%M:%S"</span>)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"检查时间: <span class="hljs-variable">$CURRENT_TIME</span>"</span>

<span class="hljs-comment"># 检查防火墙服务状态</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== 防火墙服务状态 ==="</span>
<span class="hljs-keyword">if</span> systemctl is-active --quiet firewalld; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"firewalld: 运行中"</span>
    systemctl status firewalld --no-pager -l | grep -E <span class="hljs-string">"(Active|Main PID|CGroup)"</span>
<span class="hljs-keyword">elif</span> systemctl is-active --quiet iptables; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"iptables: 运行中"</span>
    systemctl status iptables --no-pager -l | grep -E <span class="hljs-string">"(Active|Main PID|CGroup)"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"警告: 未发现运行的防火墙服务"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># 检查当前规则</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== 当前防火墙规则 ==="</span>
<span class="hljs-keyword">if</span> systemctl is-active --quiet firewalld; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"firewalld 配置:"</span>
    firewall-cmd --list-all-zones
<span class="hljs-keyword">elif</span> systemctl is-active --quiet iptables; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"iptables 规则:"</span>
    iptables -L -v -n
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># 检查连接状态</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== 当前网络连接 ==="</span>
ss -tunlp | <span class="hljs-built_in">head</span> -20

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># 检查被拒绝的连接</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== 最近被拒绝的连接 ==="</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">command</span> -v journalctl &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
    journalctl -u firewalld --since <span class="hljs-string">"1 hour ago"</span> | grep -i <span class="hljs-string">"denied\|rejected"</span> | <span class="hljs-built_in">tail</span> -10
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># 检查系统日志中的防火墙相关条目</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== 系统日志中的防火墙条目 ==="</span>
dmesg | grep -i <span class="hljs-string">"firewall\|iptables"</span> | <span class="hljs-built_in">tail</span> -10

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># 端口扫描检查</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== 监听端口检查 ==="</span>
netstat -tuln | grep LISTEN

<span class="hljs-built_in">echo</span> <span class="hljs-string">"防火墙状态检查完成！"</span>
</code></pre>
<h3 data-id="heading-18">5.2 防火墙故障排除脚本</h3>
<p><strong>创建文件：</strong> <code>/root/firewall-troubleshoot.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 防火墙故障排除脚本</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始防火墙故障排除..."</span>

<span class="hljs-comment"># 1. 检查基本连接</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤1: 检查基本网络连接"</span>
ping -c 3 8.8.8.8 &gt; /dev/null 2&gt;&amp;1
<span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 外部网络连接正常"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✗ 外部网络连接失败"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 2. 检查服务状态</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤2: 检查防火墙服务状态"</span>
<span class="hljs-keyword">if</span> systemctl is-active --quiet firewalld; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ firewalld 服务运行正常"</span>
    
    <span class="hljs-comment"># 检查 firewalld 配置</span>
    <span class="hljs-keyword">if</span> firewall-cmd --state &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ firewalld 配置加载正常"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"✗ firewalld 配置加载失败"</span>
    <span class="hljs-keyword">fi</span>
    
<span class="hljs-keyword">elif</span> systemctl is-active --quiet iptables; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ iptables 服务运行正常"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✗ 没有运行的防火墙服务"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 3. 检查规则冲突</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤3: 检查规则冲突"</span>
<span class="hljs-keyword">if</span> systemctl is-active --quiet firewalld &amp;&amp; systemctl is-active --quiet iptables; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"警告: firewalld 和 iptables 同时运行，可能存在冲突"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 4. 检查端口状态</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤4: 检查关键端口状态"</span>
PORTS_TO_CHECK=<span class="hljs-string">"22 80 443 3306"</span>

<span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> <span class="hljs-variable">$PORTS_TO_CHECK</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> ss -tuln | grep <span class="hljs-string">":<span class="hljs-variable">$port</span> "</span> &gt; /dev/null; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 端口 <span class="hljs-variable">$port</span> 正在监听"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"✗ 端口 <span class="hljs-variable">$port</span> 未监听"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 5. 检查 SELinux 状态</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤5: 检查 SELinux 状态"</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">command</span> -v getenforce &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
    selinux_status=$(getenforce)
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"SELinux 状态: <span class="hljs-variable">$selinux_status</span>"</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$selinux_status</span>"</span> = <span class="hljs-string">"Enforcing"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"注意: SELinux 处于强制模式，可能影响网络连接"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 6. 诊断特定问题</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤6: 常见问题诊断"</span>

<span class="hljs-comment"># 检查是否有被拒绝的连接</span>
<span class="hljs-keyword">if</span> dmesg | grep -i <span class="hljs-string">"reject"</span> &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"发现被拒绝的连接，查看详细信息:"</span>
    dmesg | grep -i <span class="hljs-string">"reject"</span> | <span class="hljs-built_in">tail</span> -5
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 检查日志中的防火墙错误</span>
<span class="hljs-keyword">if</span> journalctl -u firewalld --since <span class="hljs-string">"1 hour ago"</span> | grep -i <span class="hljs-string">"error"</span> &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"发现 firewalld 错误日志:"</span>
    journalctl -u firewalld --since <span class="hljs-string">"1 hour ago"</span> | grep -i <span class="hljs-string">"error"</span> | <span class="hljs-built_in">tail</span> -5
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"故障排除完成！"</span>
</code></pre>
<h2 data-id="heading-19">6. 安全最佳实践</h2>
<h3 data-id="heading-20">6.1 防火墙安全加固脚本</h3>
<p><strong>创建文件：</strong> <code>/root/firewall-hardening.sh</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 防火墙安全加固脚本</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始防火墙安全加固..."</span>

<span class="hljs-comment"># 使用 firewalld 进行加固</span>
systemctl start firewalld

<span class="hljs-comment"># 1. 创建安全区域</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤1: 创建安全区域结构"</span>

<span class="hljs-comment"># 删除默认区域（如果存在）</span>
firewall-cmd --permanent --delete-zone=public 2&gt;/dev/null || <span class="hljs-literal">true</span>
firewall-cmd --permanent --delete-zone=internal 2&gt;/dev/null || <span class="hljs-literal">true</span>

<span class="hljs-comment"># 创建新的安全区域</span>
firewall-cmd --permanent --new-zone=external
firewall-cmd --permanent --new-zone=restricted
firewall-cmd --permanent --new-zone=management

<span class="hljs-comment"># 2. 配置外部区域</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤2: 配置外部区域"</span>
firewall-cmd --permanent --zone=external --add-service=http
firewall-cmd --permanent --zone=external --add-service=https
firewall-cmd --permanent --zone=external --set-target=DROP

<span class="hljs-comment"># 3. 配置受限制区域</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤3: 配置受限制区域"</span>
firewall-cmd --permanent --zone=restricted --add-service=ssh
firewall-cmd --permanent --zone=restricted --add-source=192.168.1.0/24
firewall-cmd --permanent --zone=restricted --set-target=ACCEPT

<span class="hljs-comment"># 4. 配置管理区域</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤4: 配置管理区域"</span>
firewall-cmd --permanent --zone=management --add-service=ssh
firewall-cmd --permanent --zone=management --add-service=cockpit
firewall-cmd --permanent --zone=management --add-source=10.0.0.0/24
firewall-cmd --permanent --zone=management --set-target=ACCEPT

<span class="hljs-comment"># 5. 配置默认区域</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤5: 设置默认区域"</span>
firewall-cmd --set-default-zone=external

<span class="hljs-comment"># 6. 配置高级保护规则</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤6: 配置高级保护"</span>

<span class="hljs-comment"># 6.1 防止碎片攻击</span>
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -f -j DROP

<span class="hljs-comment"># 6.2 防止无效数据包</span>
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m state --state INVALID -j DROP

<span class="hljs-comment"># 6.3 限制新连接速率</span>
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp -m state --state NEW -m <span class="hljs-built_in">limit</span> --<span class="hljs-built_in">limit</span> 60/min --limit-burst 100 -j ACCEPT

<span class="hljs-comment"># 7. 配置日志规则</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤7: 配置详细日志"</span>

<span class="hljs-comment"># 记录被拒绝的连接</span>
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m <span class="hljs-built_in">limit</span> --<span class="hljs-built_in">limit</span> 12/min -j LOG --log-prefix <span class="hljs-string">"FIREWALL: "</span> --log-level 4

<span class="hljs-comment"># 8. 禁用不必要的 ICMP 类型</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤8: 配置 ICMP 过滤"</span>
firewall-cmd --permanent --zone=external --add-icmp-block-inversion
firewall-cmd --permanent --zone=external --remove-icmp-block=echo-request
firewall-cmd --permanent --zone=external --remove-icmp-block=echo-reply

<span class="hljs-comment"># 9. 重载配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤9: 应用配置"</span>
firewall-cmd --reload

<span class="hljs-comment"># 10. 验证加固配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"步骤10: 验证加固结果"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"所有区域配置:"</span>
firewall-cmd --list-all-zones

<span class="hljs-built_in">echo</span> <span class="hljs-string">"直接规则:"</span>
firewall-cmd --direct --get-all-rules

<span class="hljs-built_in">echo</span> <span class="hljs-string">"防火墙安全加固完成！"</span>
</code></pre>
<h2 data-id="heading-21">7. 总结</h2>
<p>本教程详细介绍了 Linux 系统中两种主要的防火墙工具：iptables 和 firewalld。通过实际的配置案例和详细的步骤说明，即使是零基础的初学者也能够按照教程完成实际的防火墙配置。</p>
<h3 data-id="heading-22">7.1 关键要点</h3>
<ol>
<li><strong>iptables</strong> 是底层的包过滤工具，功能强大但配置复杂</li>
<li><strong>firewalld</strong> 是基于 iptables 的高级管理工具，提供动态管理和更友好的配置接口</li>
<li>两种工具都可以有效保护服务器安全，选择取决于具体需求和个人偏好</li>
<li>持久化配置是确保防火墙规则在重启后仍然有效的关键</li>
</ol>
<h3 data-id="heading-23">7.2 后续建议</h3>
<ul>
<li>定期审查和更新防火墙规则</li>
<li>监控防火墙日志以检测潜在的安全威胁</li>
<li>在生产环境部署前，先在测试环境验证规则</li>
<li>保持防火墙软件更新到最新版本</li>
</ul>
<p>通过本教程的学习，您应该能够熟练配置和管理 Linux 系统的防火墙，为服务器提供坚实的安全防护。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 Elasticsearch 中为结构化文档配置递归分块]]></title>    <link>https://juejin.cn/post/7571348736153141284</link>    <guid>https://juejin.cn/post/7571348736153141284</guid>    <pubDate>2025-11-12T00:34:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571348736153141284" data-draft-id="7571355146770333738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 Elasticsearch 中为结构化文档配置递归分块"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-11-12T00:34:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 Elasticsearch 中为结构化文档配置递归分块
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:34:09.000Z" title="Wed Nov 12 2025 00:34:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fdaniel-rubinstein" title="https://www.elastic.co/search-labs/author/daniel-rubinstein" target="_blank" ref="nofollow noopener noreferrer">Daniel Rubinstein</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/046667f17a2e46dabb794503611495a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512448&amp;x-signature=sFaHH9ywb5yDybxouzh3LR2WGeY%3D" alt="" loading="lazy"/></p>
<p>了解如何在 Elasticsearch 中使用分块大小、分隔符组和自定义分隔符列表来配置递归分块，以实现最佳的结构化文档索引。</p>
<p>刚接触 Elasticsearch 吗？加入我们的 “<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fgetting-started-elasticsearch" title="https://www.elastic.co/virtual-events/getting-started-elasticsearch" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch 入门</a>” 网络研讨会吧。你也可以现在开始<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration" title="https://cloud.elastic.co/registration" target="_blank" ref="nofollow noopener noreferrer">免费云端试用</a>，或在你的<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">机器</a>上体验 Elastic。</p>
<p>从 8.16 版本开始，用户可以在将长文档导入语义文本字段时配置分块策略。从 9.1 / 8.19 版本起，我们引入了一种新的可配置递归分块策略，它使用正则表达式列表对文档进行分块。分块的目标是将长文档拆分成包含相关内容的部分。我们现有的策略会按词或句子的粒度拆分文本，但使用结构化格式（例如 Markdown）编写的文档通常在由某些分隔字符串（例如标题）定义的部分中包含相关内容。对于这类文档，我们引入了递归分块策略，以利用结构化文档的格式创建更优质的分块！</p>
<h2 data-id="heading-0">什么是递归分块？</h2>
<p>递归分块会遍历一组提供的分区分隔模式，逐步将文档拆分成更小的段，直到它们符合所需的最大分块大小。</p>
<h3 data-id="heading-1">如何配置递归分块？</h3>
<p>以下是用户为递归分块可配置的参数：</p>
<ul>
<li>
<p>（必需）max_chunk_size：每个分块中允许的最大单词数。</p>
</li>
<li>
<p>以下两者之一：</p>
<ul>
<li>
<p>separators：用于将文档拆分成分块的正则表达式字符串列表。</p>
</li>
<li>
<p>separator_group：一个字符串，用于映射到由 Elastic 定义的默认分隔符列表，以便针对特定类型的文档使用。目前支持 markdown 和 plaintext。</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">递归分块如何工作？</h3>
<p>当给定输入文档、max_chunk_size（以单词为单位）和分隔符字符串列表时，递归分块的处理过程如下：</p>
<ol>
<li>
<p>如果输入文档已在最大分块大小范围内，则返回一个覆盖整个输入的单个分块。</p>
</li>
<li>
<p>根据分隔符出现的位置将文本拆分为潜在分块。对每个潜在分块执行以下操作：</p>
<ul>
<li>
<p>如果潜在分块在最大分块大小范围内，将其添加到要返回给用户的分块列表中。</p>
</li>
<li>
<p>否则，从第 2 步重新开始，仅使用潜在分块的文本，并使用下一个分隔符进行拆分。</p>
</li>
<li>
<p>如果没有更多分隔符可用，则退回到基于句子的分块。</p>
</li>
</ul>
</li>
</ol>
<h2 data-id="heading-3">配置递归分块的示例</h2>
<p>除了分块大小之外，递归分块的主要配置是选择用于拆分文档的分隔符。如果你不确定从哪里开始，Elasticsearch 提供了一些默认的分隔符组，可用于常见的使用场景。</p>
<h3 data-id="heading-4">使用分隔符组</h3>
<p>要使用分隔符组，只需在配置分块设置时提供你想使用的组名即可。例如：</p>
<pre><code class="hljs language-json" lang="json">`

<span class="hljs-number">1.</span>  <span class="hljs-attr">"chunking_settings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-number">2.</span>      <span class="hljs-attr">"strategy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"recursive"</span><span class="hljs-punctuation">,</span>
<span class="hljs-number">3.</span>      <span class="hljs-attr">"max_chunk_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">25</span><span class="hljs-punctuation">,</span>
<span class="hljs-number">4.</span>      <span class="hljs-attr">"separator_group"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"plaintext"</span>
<span class="hljs-number">5.</span>  <span class="hljs-punctuation">}</span>

`AI写代码
</code></pre>
<p>这将为你提供一种递归分块策略，使用的分隔符列表为 ["(?&lt;!\n)\n\n(?!\n)", "(?&lt;!\n)\n(?!\n)"]。这对通用纯文本应用非常有效，先按两个换行符拆分，然后按一个换行符拆分。</p>
<p>我们还提供了一个名为 markdown 的分隔符组，它使用的分隔符列表为：</p>
<pre><code class="hljs language-swift" lang="swift">`

<span class="hljs-number">1</span>.  [
<span class="hljs-number">2</span>.  <span class="hljs-string">"<span class="hljs-subst">\n</span># "</span>,
<span class="hljs-number">3</span>.         <span class="hljs-string">"<span class="hljs-subst">\n</span>## "</span>,
<span class="hljs-number">4</span>.         <span class="hljs-string">"<span class="hljs-subst">\n</span>### "</span>,
<span class="hljs-number">5</span>.         <span class="hljs-string">"<span class="hljs-subst">\n</span>#### "</span>,
<span class="hljs-number">6</span>.         <span class="hljs-string">"<span class="hljs-subst">\n</span>##### "</span>,
<span class="hljs-number">7</span>.         <span class="hljs-string">"<span class="hljs-subst">\n</span>###### "</span>,
<span class="hljs-number">8</span>.         <span class="hljs-string">"<span class="hljs-subst">\n</span>^(?!<span class="hljs-subst">\\</span>s*$).*<span class="hljs-subst">\\</span>n-{1,}<span class="hljs-subst">\\</span>n"</span>,
<span class="hljs-number">9</span>.         <span class="hljs-string">"<span class="hljs-subst">\n</span>^(?!<span class="hljs-subst">\\</span>s*$).*<span class="hljs-subst">\\</span>n={1,}<span class="hljs-subst">\\</span>n"</span>
<span class="hljs-number">10</span>.  ]

`<span class="hljs-type">AI写代码</span>![](https:<span class="hljs-comment">//csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>这个分隔符列表非常适用于通用的 markdown 使用场景，会根据 6 个标题级别和分段字符进行拆分。</p>
<p>在创建资源（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference" title="https://www.elastic.co/docs/explore-analyze/elastic-inference" target="_blank" ref="nofollow noopener noreferrer">推理</a>端点 / 语义文本字段）时，与分隔符组对应的分隔符列表会存储在你的配置中。如果分隔符组在之后被更新，它不会改变你已创建资源的行为。</p>
<h3 data-id="heading-5">使用自定义分隔符列表</h3>
<p>如果预定义的分隔符组不适合你的使用场景，你可以定义一个符合需求的自定义分隔符列表。请注意，分隔符列表中可以使用正则表达式。以下是一个使用自定义分隔符配置分块设置的示例：</p>
<pre><code class="hljs language-swift" lang="swift">`

<span class="hljs-number">1</span>.  <span class="hljs-string">"chunking_settings"</span>: {
<span class="hljs-number">2</span>.      <span class="hljs-string">"strategy"</span>: <span class="hljs-string">"recursive"</span>,
<span class="hljs-number">3</span>.      <span class="hljs-string">"max_chunk_size"</span>: <span class="hljs-number">25</span>,
<span class="hljs-number">4</span>.      <span class="hljs-string">"separators"</span>: [<span class="hljs-string">"<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>"</span>, <span class="hljs-string">"<span class="hljs-subst">\n</span>"</span>, <span class="hljs-string">"&lt;my-custom-separator&gt;"</span>]
<span class="hljs-number">5</span>.  }

`<span class="hljs-type">AI写代码</span>
</code></pre>
<p>上面的分块策略会先按两个换行符拆分，然后按一个换行符拆分，最后按字符串 “” 拆分。</p>
<h2 data-id="heading-6">递归分块示例</h2>
<p>让我们来看一个递归分块的实际示例。在这个例子中，我们使用以下分块设置，通过自定义分隔符列表按 markdown 文档的前两个标题级别进行拆分：</p>
<pre><code class="hljs language-swift" lang="swift">`

<span class="hljs-number">1</span>.  <span class="hljs-string">"chunking_settings"</span>: {
<span class="hljs-number">2</span>.      <span class="hljs-string">"strategy"</span>: <span class="hljs-string">"recursive"</span>,
<span class="hljs-number">3</span>.      <span class="hljs-string">"max_chunk_size"</span>: <span class="hljs-number">25</span>,
<span class="hljs-number">4</span>.      <span class="hljs-string">"separators"</span>: [<span class="hljs-string">"<span class="hljs-subst">\n</span># "</span>, <span class="hljs-string">"<span class="hljs-subst">\n</span>## "</span>]
<span class="hljs-number">5</span>.  }

`<span class="hljs-type">AI写代码</span>
</code></pre>
<p>让我们来看一个未分块的简单 Markdown 文档：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/778a416a940547818868c450f97341fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512448&amp;x-signature=yGix2SAmSFVtGHQ3%2FMXFSeJe8Zw%3D" alt="" loading="lazy"/></p>
<p>现在让我们使用上面定义的分块设置来对文档进行分块：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4c1a5b79c064a1bafc72d38de799c99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512448&amp;x-signature=e1pJH%2BnHSc1ktztddMOg1m3SJ3w%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccd29a02d55c448cba78434a1c267607~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512448&amp;x-signature=r%2BOzsLYJimFl4pOIQ8i8PNCgnKE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dbcef7021f04d5cab76e1df0627841d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512448&amp;x-signature=e49ikxjbrzHNsJrMp0ZDeCqP36w%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>注意</strong>：每个分块末尾的换行符（除了分块 3）未高亮显示，但包含在实际的分块边界内。</p>
</blockquote>
<h2 data-id="heading-7">今天就开始使用递归分块吧！</h2>
<p>有关如何使用此功能的更多信息，请查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference%2Finference-api%23chunking-strategies" title="https://www.elastic.co/docs/explore-analyze/elastic-inference/inference-api#chunking-strategies" target="_blank" ref="nofollow noopener noreferrer">配置分块设置的文档</a>。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Frecursive-chunking-structured-documents-elasticsearch" title="https://www.elastic.co/search-labs/blog/recursive-chunking-structured-documents-elasticsearch" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labs…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当上传不再只是 /upload，我们是怎么设计大文件上传的]]></title>    <link>https://juejin.cn/post/7571355989133099023</link>    <guid>https://juejin.cn/post/7571355989133099023</guid>    <pubDate>2025-11-12T01:58:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571355989133099023" data-draft-id="7570394530316369920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当上传不再只是 /upload，我们是怎么设计大文件上传的"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-11-12T01:58:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="洛卡卡了"/> <meta itemprop="url" content="https://juejin.cn/user/888839672963544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当上传不再只是 /upload，我们是怎么设计大文件上传的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888839672963544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    洛卡卡了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T01:58:46.000Z" title="Wed Nov 12 2025 01:58:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读34分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">业务背景</h3>
<p>在正式讲之前，先看一个我们做的大文件上传demo。<br/>
下面这个视频演示的是上传一个 1GB 的压缩包，整个过程支持分片上传、断点续传、暂停和恢复。</p>
<p>可以看到速度不是特别快，这个是我故意没去优化的。<br/>
前端那边计算文件 MD5、以及最后合并文件的时间我都保留了，<br/>
主要是想让大家能看到整个流程是怎么跑通的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4eb07ebdb67942bf8bbb528d0913c679~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517525&amp;x-signature=xLviIrXTV3tcfpMPnD62Tn%2F8SBc%3D" alt="output1111.gif" loading="lazy"/></p>
<p>平时我们在做一些 SaaS 系统的时候，文件上传这块其实基本上都设计的挺简单的。<br/>
前端做个分片上传，后端把分片合并起来，最后存 OSS 或者服务器某个路径上，再返回一个 URL 就完事了。<br/>
大多数情况下，这样的方案也确实够用。</p>
<p>但是最近我在做一个私有化项目，场景完全不一样。<br/>
项目是给政企客户部署的内部系统，里面有 AI 大模型客服问答的功能。<br/>
客户需要把他们内部的文档、手册、规范、图纸、流程等资料打包上传到服务器，用来做后续的向量化、知识检索或者模型训练。</p>
<p>这类场景如果还沿用之前 SaaS 系统那种上传方式，往往就不太适用了。<br/>
因为这些文件往往有几个共同点：</p>
<ol start="0">
<li>文件数量多，动辄几百上千份（Word、PDF、PPT、Markdown 都有）；</li>
<li>文件体积大，打成 zip 动不动就是几个 G，甚至十几二十个 G；</li>
<li>上传环境复杂，客户一般在内网或局域网，有的甚至完全断网；</li>
<li>有安全要求，文件不能经过云端 OSS，里面可能有保密资料；</li>
<li>需要审计，要能知道是谁上传的、什么时候传的、文件现在存哪；</li>
<li>上传完之后还要进一步处理，比如自动解压、解析文本、拆页、向量化，然后再存入 Milvus 或 pgvector。</li>
</ol>
<p>所以这种情况还用 SaaS 系统那种“简单上传+云存储”方案的话，那可能问题就一堆：</p>
<ul>
<li>上传中断后用户一刷新浏览器就得重传整个包；</li>
<li>集群部署时分片打到不同机器上根本无法合并；</li>
<li>多人同时上传可能会发生文件覆盖或路径冲突；</li>
<li>没有任何上传记录，也追踪不到是谁传的；</li>
<li>对政企来说，审计、合规、保密全都不达标。</li>
</ul>
<p>所以，我们需要重新设计文件上传的功能逻辑。<br/>
目的是让它不仅能支持大文件、断点续传、集群部署，还能同时适配内网环境、权限管控，以及后续的 AI 文档解析和知识向量化等处理流程。</p>
<hr/>
<h3 data-id="heading-1">为什么很多项目只需要一个 upload 接口</h3>
<p>如果我们回头看一下自己平常做过的一些常规 Web 项目，尤其是各种 SaaS 系统或者后台管理系统，<br/>
其实大多数时候后端只会提供一个 <code>/upload</code> 接口， 前端拿到文件后直接调用这个接口，后端保存文件再返回一个 URL 就结束了。</p>
<p>甚至我们在很多项目里，前端都不会把文件传给业务服务，<br/>
而是直接通过前端 SDK（比如阿里云 OSS、腾讯云 COS、七牛云等）上传到云存储，<br/>
上传完后拿到文件地址，再把这个地址回传给后端保存。</p>
<p>这种方式在 SaaS 系统或者轻量级的业务里非常普遍，也非常高效。 主要原因有几个：</p>
<ol>
<li><strong>文件都比较小</strong>，大多数就是几 MB 的图片、PDF 或 Excel；</li>
<li><strong>云存储足够稳定</strong>，上传、下载、访问都有完整的 SDK 支撑；</li>
<li><strong>系统是公网部署</strong>，不需要考虑局域网、内网断网这些问题；</li>
<li><strong>对安全和审计的要求不高</strong>，文件内容也不是涉密数据；</li>
<li><strong>用户体验优先</strong>，所以直接把文件上传到云端是最省事的方案。</li>
</ol>
<p>换句话说，这种“一个 upload 接口”或“前端直传 OSS”模式，其实是面向<strong>通用型 SaaS 场景</strong>的。<br/>
对于绝大多数互联网业务来说，它既够快又够省心。</p>
<p>但一旦项目换成政企、私有化部署或者 AI 训练平台这种环境，<br/>
就完全不是一个量级的问题了。<br/>
这里的关键不在“能不能上传”，<br/>
而在于<strong>文件上传之后的可控性、可追溯性和安全性</strong>。</p>
<hr/>
<h3 data-id="heading-2">前端常见的大文件上传方式</h3>
<p>在重新设计后端接口之前，我们先来看看现在前端常见的大文件上传思路。<br/>
其实近几年前端这块已经比较成熟了，主流方案大体都是围绕几个核心点展开的：<br/>
<strong>秒传检测、分片上传、断点续传、并发控制、进度展示。</strong></p>
<p>一般来说，前端拿到文件后，会先计算一个文件哈希值，比如用 MD5。<br/>
这样做的目的是为了做<strong>秒传检测</strong>：<br/>
如果服务器上已经存在这个文件，就可以直接跳过上传，节省时间和带宽。</p>
<p>接下来是<strong>分片上传</strong>。<br/>
文件太大时，前端会把文件拆成多个固定大小的小块（比如每块 5MB 或 10MB），<br/>
然后一片一片地上传。这样做可以避免一次性传输大文件导致浏览器卡顿或网络中断。</p>
<p>然后就是<strong>断点续传</strong>。<br/>
前端会记录哪些分片已经上传成功，如果上传过程中网络中断或浏览器刷新，<br/>
下次只需要从未完成的分片继续上传，不用重新传整包文件。</p>
<p>在性能方面，前端还会做<strong>并发控制</strong>。<br/>
比如同时上传三到五个分片，上传完一个就立刻补下一个，<br/>
这样整体速度比单线程串行上传要快很多。</p>
<p>最后是<strong>进度展示</strong>。<br/>
通过监听每个分片的上传状态，前端可以计算整体进度，<br/>
给用户展示一个实时的上传百分比或进度条，让体验更可控。</p>
<p>可以看到，前端的大文件上传方案已经形成了一套相对标准的模式。<br/>
所以这次我在重新设计后端的时候，就打算基于这种前端逻辑，<br/>
去构建一套更贴合企业私有化环境的上传接口控制体系。<br/>
目标是让前后端的职责划分更清晰：<br/>
前端负责切片、控制与恢复；后端负责存储、校验与合并。</p>
<hr/>
<h3 data-id="heading-3">后端接口设计思路</h3>
<p>前端的大文件上传流程其实已经相对固定了，我们只要让后端的接口和它配合得上，就能把整个上传链路打通。<br/>
所以我这次重新设计时，把上传接口拆成了几个比较独立的阶段：<br/>
<strong>秒传检查、初始化任务、上传分片、合并文件、暂停任务、取消任务、任务列表。</strong><br/>
每个接口都只负责一件事，这样接口的职责会更清晰，也方便后期扩展。</p>
<h4 data-id="heading-4">一、/upload/check —— 秒传检查</h4>
<p>这个接口是整个流程的第一步，用来判断文件是否已经上传过。<br/>
前端在计算完文件的全局 MD5（或其他 hash）后，会先调这个接口。<br/>
如果后端发现数据库里已经有相同 hash 的文件，就直接返回“已存在”，前端就不用再上传了。</p>
<p><strong>请求示例：</strong></p>
<pre><code class="hljs language-json" lang="json">POST /api/upload/check
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"fileHash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"md5_abc123def456"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"fileName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"training-docs.zip"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"fileSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5342245120</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"exists"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果 <code>exists = true</code>，说明服务端已经有这个文件，可以直接走“秒传成功”的逻辑。</p>
<p><strong>伪代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/check")</span>
<span class="hljs-keyword">public</span> Result&lt;?&gt; checkFile(<span class="hljs-meta">@RequestBody</span> Map&lt;String, Object&gt; body) {
    <span class="hljs-comment">// 1. 校验 fileHash 参数是否为空</span>
    <span class="hljs-comment">// 2. 查询 file_info 表是否已有该文件</span>
    <span class="hljs-comment">// 3. 如果文件已存在，直接返回秒传成功（exists = true）</span>
    <span class="hljs-comment">// 4. 如果文件不存在，查询 upload_task 表中是否有未完成任务（支持断点续传）</span>
}
</code></pre>
<h4 data-id="heading-5">二、/upload/init —— 初始化上传任务</h4>
<p>如果文件不存在，就要先初始化一个新的上传任务。<br/>
这个接口的作用是创建一条 <code>upload_task</code> 记录，同时返回一个唯一的 <code>uploadId</code>。<br/>
前端会用这个 uploadId 来标识整个上传过程。</p>
<p><strong>请求示例：</strong></p>
<pre><code class="hljs language-json" lang="json">POST /api/upload/init
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"fileHash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"md5_abc123def456"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"fileName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"training-docs.zip"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"totalChunks"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">320</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"chunkSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5242880</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"uploadId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b4f8e3a7-1a0c-4a1d-88af-61e98d91a49b"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"uploadedChunks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>uploadedChunks</code> 用来支持断点续传，如果之前有部分分片上传过，就会在这里返回索引数组。</p>
<p><strong>伪代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/init")</span>
<span class="hljs-keyword">public</span> Result&lt;UploadInitResponse&gt; <span class="hljs-title function_">initUpload</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> UploadInitRequest request)</span> {
    <span class="hljs-comment">// 1. 检查是否已有同 fileHash 的任务，若有则返回旧任务信息（支持断点续传）</span>
    <span class="hljs-comment">// 2. 否则创建新的 upload_task 记录，生成 uploadId</span>
    <span class="hljs-comment">// 3. 初始化分片数量、大小、状态等信息</span>
    <span class="hljs-comment">// 4. 返回 uploadId 与已上传分片索引列表</span>
}

</code></pre>
<h4 data-id="heading-6">三、/upload/chunk —— 上传单个分片</h4>
<p>这是整个上传过程里调用次数最多的接口。<br/>
每个分片都会单独上传一次，并在服务端保存为临时文件，同时写入 <code>upload_chunk</code> 表。<br/>
上传成功后，后端会更新 <code>upload_task</code> 的进度信息。</p>
<p><strong>请求示例（表单上传）：</strong></p>
<pre><code class="hljs language-json" lang="json">POST /api/upload/chunk
Content-Type<span class="hljs-punctuation">:</span> multipart/form-data

formData<span class="hljs-punctuation">:</span>
  uploadId<span class="hljs-punctuation">:</span> b4f8e3a7<span class="hljs-number">-1</span>a0c<span class="hljs-number">-4</span>a1d<span class="hljs-number">-88</span>af<span class="hljs-number">-61e98</span>d91a49b
  chunkIndex<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  chunkSize<span class="hljs-punctuation">:</span> <span class="hljs-number">5242880</span>
  chunkHash<span class="hljs-punctuation">:</span> md5_001
  file<span class="hljs-punctuation">:</span> (二进制分片数据)
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"uploadId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b4f8e3a7-1a0c-4a1d-88af-61e98d91a49b"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"chunkIndex"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"chunkSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5242880</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>伪代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping(value = "/chunk", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span>
<span class="hljs-keyword">public</span> Result&lt;?&gt; uploadChunk(<span class="hljs-meta">@ModelAttribute</span> UploadChunkRequest req) {
    <span class="hljs-comment">// 1. 校验任务状态，禁止上传已取消或已完成的任务</span>
    <span class="hljs-comment">// 2. 检查本地目录（或云端存储桶）是否存在，不存在则创建</span>
    <span class="hljs-comment">// 3. 接收当前分片文件并写入临时路径</span>
    <span class="hljs-comment">// 4. 写入 upload_chunk 表，标记状态为 “已上传”</span>
    <span class="hljs-comment">// 5. 更新 upload_task 的 uploaded_chunks 数量</span>
}

</code></pre>
<h4 data-id="heading-7">四、/upload/merge —— 合并分片</h4>
<p>当前端确认所有分片都上传完后，会调用 <code>/upload/merge</code>。<br/>
后端收到这个请求后，去检查所有分片是否完整，然后按照索引顺序依次合并。<br/>
合并成功后，会删除临时分片文件，并更新 <code>upload_task</code> 状态为“完成”。<br/>
如果启用了云存储，这一步也可以直接把合并后的文件上传到 OSS。</p>
<p><strong>请求示例：</strong></p>
<pre><code class="hljs language-json" lang="json">POST /api/upload/merge
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"uploadId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b4f8e3a7-1a0c-4a1d-88af-61e98d91a49b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"fileHash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"md5_abc123def456"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"文件合并成功"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"storagePath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/data/uploads/training-docs.zip"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>伪代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/merge")</span>
<span class="hljs-keyword">public</span> Result&lt;?&gt; mergeFile(<span class="hljs-meta">@RequestBody</span> UploadMergeRequest req) {
    <span class="hljs-comment">// 1. 检查 upload_task 状态是否允许合并</span>
    <span class="hljs-comment">// 2. 校验所有分片是否都上传完成</span>
    <span class="hljs-comment">// 3. 如果是本地存储：按 chunk_index 顺序流式合并文件</span>
    <span class="hljs-comment">// 4. 如果是云存储：调用云端分片合并 API（如 OSS、COS）</span>
    <span class="hljs-comment">// 5. 校验文件 hash 完整性，更新任务状态为 COMPLETED</span>
    <span class="hljs-comment">// 6. 将最终文件信息写入 file_info 表</span>
}
</code></pre>
<h4 data-id="heading-8">五、/upload/pause —— 暂停任务</h4>
<p>这个接口用于在上传过程中手动暂停任务。<br/>
前端可能会在网络波动或用户主动点击暂停时调用。<br/>
后端会更新任务状态为“已暂停”，并记录当前已上传的分片数。</p>
<p><strong>请求示例：</strong></p>
<pre><code class="hljs language-json" lang="json">POST /api/upload/pause
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"uploadId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b4f8e3a7-1a0c-4a1d-88af-61e98d91a49b"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"任务已暂停"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>伪代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/pause")</span>
<span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">pauseUpload</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> UploadPauseRequest req)</span> {
    <span class="hljs-comment">// 1. 查找对应的 upload_task</span>
    <span class="hljs-comment">// 2. 更新任务状态为 “已暂停”</span>
    <span class="hljs-comment">// 3. 返回任务状态确认信息</span>
}
</code></pre>
<h4 data-id="heading-9">六、/upload/cancel —— 取消任务</h4>
<p>如果用户想放弃本次上传，可以调用 <code>/cancel</code>。<br/>
后端会把任务状态标记为“已取消”，并清理对应的临时分片文件。<br/>
这样能避免磁盘上堆积无用数据。</p>
<p><strong>请求示例：</strong></p>
<pre><code class="hljs language-json" lang="json">POST /api/upload/cancel
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"uploadId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b4f8e3a7-1a0c-4a1d-88af-61e98d91a49b"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"任务已取消"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>伪代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/cancel")</span>
<span class="hljs-keyword">public</span> Result&lt;?&gt; cancelUpload(<span class="hljs-meta">@RequestBody</span> UploadCancelRequest req) {
    <span class="hljs-comment">// 1. 查找对应的 upload_task</span>
    <span class="hljs-comment">// 2. 更新任务状态为 “已取消”</span>
    <span class="hljs-comment">// 3. 删除或标记已上传的分片文件为待清理</span>
    <span class="hljs-comment">// 4. 返回操作结果</span>
}
</code></pre>
<h4 data-id="heading-10">七、/upload/list —— 查询任务列表</h4>
<p>这个接口我们用于管理后台查看当前上传任务的整体情况。<br/>
可以展示每个任务的文件名、大小、进度、状态、上传人等信息，方便追踪和审计。</p>
<p><strong>请求示例：</strong></p>
<pre><code class="hljs language-json" lang="json">GET /api/upload/list
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"uploadId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b4f8e3a7-1a0c-4a1d-88af-61e98d91a49b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"fileName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"training-docs.zip"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"COMPLETED"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"uploadedChunks"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">320</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"totalChunks"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">320</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"uploader"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"createdAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-10-20 14:30:12"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>伪代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/list")</span>
<span class="hljs-keyword">public</span> Result&lt;List&lt;UploadTaskSummary&gt;&gt; <span class="hljs-title function_">listUploadTasks</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. 查询所有上传任务</span>
    <span class="hljs-comment">// 2. 按创建时间或状态排序</span>
    <span class="hljs-comment">// 3. 返回任务摘要信息（任务名、状态、进度、上传人等）</span>
}
</code></pre>
<h4 data-id="heading-11">接口调用顺序小结</h4>
<p>那我们这整个上传过程的调用顺序就是：</p>
<pre><code class="hljs language-bash" lang="bash">1. /upload/check     → 秒传检测
2. /upload/init      → 初始化上传任务
3. /upload/chunk     → 循环上传所有分片
4. /upload/merge     → 所有分片完成后合并
（可选）/upload/pause、/upload/cancel 用于控制任务
（可选）/upload/list 用于任务追踪与审计
</code></pre>
<h4 data-id="heading-12">接口调用顺序示意图</h4>
<p>下面这张时序图展示了前端、后端、数据库在整个上传过程中的交互关系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5f79241f518495f8774a900301e638f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517525&amp;x-signature=Kcr8YME9sua2zjXuRaAfOSQGCSY%3D" alt="Untitled diagram-2025-11-10-031845.png" loading="lazy"/></p>
<p>这样安排有几个好处：</p>
<ol>
<li><strong>逻辑衔接顺</strong>：上面刚讲完每个接口的职责，下面立刻用图总结；</li>
<li><strong>视觉节奏平衡</strong>：读者读到这里已经看了不少文字，用图能缓解阅读疲劳；</li>
<li><strong>承上启下</strong>：这张图既总结接口流程，又能自然引出下一节“数据库表设计”。</li>
</ol>
<p>这套接口设计基本能覆盖大文件上传在企业项目中的常见需求。<br/>
接下来，我们再来看看支撑这套接口背后的数据库表设计。<br/>
数据库的作用是让上传任务的状态可追踪、可恢复，也能在集群部署时保持一致性。</p>
<hr/>
<h3 data-id="heading-13">数据库表设计思路</h3>
<p>前面说的那一套接口，要真正稳定地跑起来，<br/>
后端必须有一套能记录任务状态、分片信息、文件存储路径的数据库结构。<br/>
因为上传这种场景不是“一次请求就结束”的操作，它往往会持续几分钟甚至几个小时，<br/>
所以我们需要让任务状态可以追踪、可以恢复，还要能支撑集群部署。</p>
<p>我这次主要设计了三张核心表：<br/>
<code>upload_task</code>（上传任务表）、<code>upload_chunk</code>（分片表）、<code>file_info</code>（文件信息表）。<br/>
它们分别负责记录任务、分片和最终文件三层的数据关系。</p>
<h4 data-id="heading-14">一、upload_task —— 上传任务表</h4>
<p>这张表是整个上传过程的“总账”，<br/>
每一个文件上传任务，不管分成多少片，都会在这里生成一条记录。<br/>
它主要用来保存任务的全局信息，比如文件名、大小、上传进度、状态、存储方式等。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `upload_task` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `upload_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'任务唯一ID（UUID）'</span>,
  `file_hash` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件哈希（用于秒传与断点续传）'</span>,
  `file_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件名称'</span>,
  `file_size` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件总大小（字节）'</span>,
  `chunk_size` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'每个分片大小（字节）'</span>,
  `total_chunks` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'分片总数'</span>,
  `uploaded_chunks` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'已上传分片数量'</span>,
  `status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'任务状态：0-待上传 1-上传中 2-合并中 3-完成 4-取消 5-失败 6-已合并 7-已暂停'</span>,
  `storage_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'local'</span> COMMENT <span class="hljs-string">'存储类型：local/oss/cos/minio/s3等'</span>,
  `storage_url` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件最终存储地址（云端或本地路径）'</span>,
  `local_path` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'本地临时文件或合并文件路径'</span>,
  `remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'备注信息'</span>,
  `uploader` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'上传人'</span>,
  `created_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  `updated_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'更新时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `upload_id` (`upload_id`),
  KEY `idx_hash` (`file_hash`),
  KEY `idx_status` (`status`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'上传任务表（支持多种云存储）'</span>;
</code></pre>
<p><strong>设计要点：</strong></p>
<ul>
<li><code>upload_id</code> 是前端初始化任务后由后端生成的唯一标识；</li>
<li><code>file_hash</code> 用来支持秒传逻辑；</li>
<li><code>status</code> 控制任务生命周期（等待、上传中、合并中、完成等）；</li>
<li><code>storage_type</code>、<code>storage_url</code> 可以兼容多种存储方案（本地、OSS、COS、MinIO）；</li>
<li><code>uploaded_chunks</code> 字段让任务能随时恢复，适配断点续传。</li>
</ul>
<h4 data-id="heading-15">二、upload_chunk —— 分片表</h4>
<p>这张表对应每个上传任务下的所有分片。<br/>
每一个分片都会单独在这里占一条记录，用来追踪它的上传状态。<br/>
这张表的存在让我们能做断点续传、进度统计、以及合并前的完整性检查。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `upload_chunk` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `upload_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'所属上传任务ID'</span>,
  `chunk_index` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'分片索引（从0开始）'</span>,
  `chunk_size` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'实际分片大小（字节）'</span>,
  `chunk_hash` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'可选：分片hash（用于高级去重）'</span>,
  `status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'状态：0-待上传 1-已上传 2-已合并'</span>,
  `local_path` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'分片本地路径'</span>,
  `created_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  `updated_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'更新时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uniq_task_chunk` (`upload_id`,`chunk_index`),
  KEY `idx_upload_id` (`upload_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'上传分片表'</span>;
</code></pre>
<p><strong>设计要点：</strong></p>
<ul>
<li><code>upload_id</code> 是任务外键，和 <code>upload_task</code> 一一对应；</li>
<li><code>chunk_index</code> 代表分片顺序，合并文件时会按这个排序；</li>
<li><code>chunk_hash</code> 可选字段，用来在上传前后做完整性校验；</li>
<li><code>status</code> 字段控制上传进度（待上传、已上传、已合并）；</li>
<li>唯一索引 (<code>upload_id</code>, <code>chunk_index</code>) 避免重复插入分片。</li>
</ul>
<p>通过这张表，我们可以轻松实现断点续传：<br/>
当用户重新开始上传时，后端只返回未完成的分片索引，前端跳过已上传的部分。</p>
<h4 data-id="heading-16">三、file_info —— 文件信息表</h4>
<p>这张表记录的是上传完成后的“最终文件信息”，<br/>
相当于系统的文件索引表。只要文件合并成功并通过校验，<br/>
后端就会往这里写入一条记录。</p>
<p>这张表支撑秒传功能，也能被后续的文档解析或向量化任务使用。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `file_info` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `file_hash` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件hash，用于秒传'</span>,
  `file_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件名称'</span>,
  `file_size` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件大小'</span>,
  `storage_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'local'</span> COMMENT <span class="hljs-string">'存储类型：local/oss/cos/minio/s3等'</span>,
  `storage_url` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文件最终存储地址（云端或本地路径）'</span>,
  `uploader` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'上传人'</span>,
  `status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'1'</span> COMMENT <span class="hljs-string">'状态：1-正常，2-删除中，3-已归档'</span>,
  `remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'备注'</span>,
  `created_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `file_hash` (`file_hash`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'已上传文件信息表（支持多云存储）'</span>;
</code></pre>
<p><strong>设计要点：</strong></p>
<ul>
<li><code>file_hash</code> 是全局唯一标识，用于秒传和查重；</li>
<li><code>storage_url</code> 记录最终可访问路径；</li>
<li><code>status</code> 可扩展为删除、归档等后续操作；</li>
<li>这张表和业务系统中的“文档解析”、“知识库构建”可以直接关联。</li>
</ul>
<h4 data-id="heading-17">四、三张表之间的关系</h4>
<p>这三张表之间的关系我们可以简单理解为：</p>
<pre><code class="hljs language-scss" lang="scss">upload_task  (上传任务)
    ├── upload_chunk (分片详情)
    └── file_info    (最终文件)
</code></pre>
<ul>
<li><code>upload_task</code> 管理任务生命周期；</li>
<li><code>upload_chunk</code> 跟踪每个分片的上传进度；</li>
<li><code>file_info</code> 保存最终文件索引，用于秒传与后续 AI 处理。</li>
</ul>
<p>这样设计的好处是：</p>
<ul>
<li>上传状态可追踪；</li>
<li>上传任务可恢复；</li>
<li>文件信息可统一管理；</li>
<li>多节点部署也能保证一致性。</li>
</ul>
<hr/>
<h3 data-id="heading-18">上传状态流转与任务恢复机制</h3>
<p>有了前面的三张核心表，整个上传的过程就能被“状态机化”管理。<br/>
简单来说，我们希望每一个上传任务从创建、上传、合并到完成，都能有一个明确的状态，<br/>
系统也能在任意阶段中断后恢复，不需要用户重新来一遍。</p>
<p>我们把整个上传任务的生命周期划分成几个关键状态：</p>
<pre><code class="hljs language-java" lang="java">WAITING(<span class="hljs-number">0</span>, <span class="hljs-string">"待上传"</span>),
UPLOADING(<span class="hljs-number">1</span>, <span class="hljs-string">"上传中"</span>),
MERGING(<span class="hljs-number">2</span>, <span class="hljs-string">"合并中"</span>),
COMPLETED(<span class="hljs-number">3</span>, <span class="hljs-string">"已完成"</span>),
CANCELED(<span class="hljs-number">4</span>, <span class="hljs-string">"已取消"</span>),
FAILED(<span class="hljs-number">5</span>, <span class="hljs-string">"上传失败"</span>),
CHUNK_MERGED(<span class="hljs-number">6</span>, <span class="hljs-string">"已合并"</span>),
PAUSED(<span class="hljs-number">7</span>, <span class="hljs-string">"已暂停"</span>);
</code></pre>
<h4 data-id="heading-19">一、WAITING（待上传）</h4>
<p>当用户在前端发起上传、文件切片还没真正传上来之前，<br/>
系统会先生成一个上传任务记录（也就是 <code>/upload/init</code> 接口那一步）。<br/>
这个时候任务只是“登记”在数据库里，还没开始传数据。</p>
<p>我们可以理解为：</p>
<blockquote>
<p>任务刚创建，还没开始跑。</p>
<p>此时前端拿到 uploadId，就可以开始逐片上传了。</p>
</blockquote>
<p>在数据库层面，<code>upload_task.status = 0</code>，所有的分片表里还没有数据。</p>
<h4 data-id="heading-20">二、UPLOADING（上传中）</h4>
<p>当第一个分片开始上传时，系统会把任务状态更新为 <strong>上传中</strong>。<br/>
这时候每上传一块分片，都会往 <code>upload_chunk</code> 表里写入一条记录，<br/>
并且更新任务的 <code>uploaded_chunks</code> 字段。</p>
<p>我们会周期性地根据分片上传数量去更新进度条，<br/>
比如已上传 35 / 100 块，系统就知道这部分可以恢复。</p>
<p>这个阶段是任务生命周期里最活跃的一段：<br/>
用户可能暂停、断网、刷新页面、甚至浏览器崩溃。<br/>
但是没关系，因为分片信息都落地到数据库了，<br/>
我们能随时通过 <code>upload_chunk</code> 的状态重新恢复上传。</p>
<h4 data-id="heading-21">三、PAUSED（已暂停）</h4>
<p>如果用户主动点击“暂停上传”，<br/>
系统就会把任务状态标记为 <code>PAUSED</code>。</p>
<p>暂停并不会删除分片，只是告诉系统“不要再继续发请求”。<br/>
这样当用户重新点击“继续上传”时，<br/>
前端只需从后端拿到“哪些分片还没上传”，就能断点续传。</p>
<p>这个状态一般只在用户控制的情况下出现，<br/>
比如网络不好、或者中途切换网络时暂停。</p>
<h4 data-id="heading-22">四、CANCELED（已取消）</h4>
<p>取消和暂停不同，取消意味着用户彻底放弃了这个上传任务。<br/>
任务会被标记为 <code>CANCELED</code>，同时系统可以选择：</p>
<ul>
<li>删除已经上传的临时分片文件；</li>
<li>或者保留一段时间等待清理任务。</li>
</ul>
<p>在后台日志中，这个状态主要用于审计：<br/>
记录谁取消了任务、在什么时间、上传了多少进度。</p>
<h4 data-id="heading-23">五、MERGING（合并中）</h4>
<p>当所有分片都上传完成后，<br/>
后端会自动或手动触发文件合并逻辑（调用 <code>/upload/merge</code>）。<br/>
此时任务状态会切换为 <strong>MERGING</strong>，表示系统正在进行最后一步。</p>
<p>在这一步里：</p>
<ul>
<li>如果是本地存储，会逐个读取分片文件并拼接为完整文件；</li>
<li>如果是云存储（比如 OSS、MinIO），则会触发服务端的分片合并 API。</li>
</ul>
<p>合并过程通常比较耗时，尤其是几 GB 的文件，<br/>
所以单独拿出来作为一个明确状态是必要的。</p>
<h4 data-id="heading-24">六、CHUNK_MERGED（已合并）</h4>
<p>有些系统会把合并成功但未做后续处理的状态单独标出来，<br/>
比如文件已经合并，但还没入库、还没解析。<br/>
这个状态可以让我们在合并之后还有机会做文件校验或后处理。</p>
<p>不过在实际项目里，也可以直接跳过这一步，<br/>
合并完后立刻进入下一状态——<code>COMPLETED</code>。</p>
<h4 data-id="heading-25">七、COMPLETED（已完成）</h4>
<p>文件合并完成、验证通过、存储路径落地、写入 <code>file_info</code> 表，<br/>
这时候任务就算彻底完成了。</p>
<p>在这个状态下：</p>
<ul>
<li>用户可以正常访问文件；</li>
<li>系统可以执行后续的解析任务（比如文档拆页、向量化等）；</li>
<li>文件具备秒传条件，下次再上传同样的文件会直接跳过。</li>
</ul>
<p><code>COMPLETED</code> 是整个生命周期的终点状态。<br/>
在数据库中，任务记录会更新最终路径、存储类型、完成时间等字段。</p>
<h4 data-id="heading-26">八、FAILED（上传失败）</h4>
<p>上传过程中如果出现异常，比如网络中断、磁盘写入异常、OSS 上传失败等，<br/>
系统会标记任务为 <code>FAILED</code>。<br/>
这一状态不会自动清理，<br/>
方便管理员事后追踪错误原因或人工恢复。</p>
<p>失败任务在设计上一般允许“重新启动”，<br/>
也就是通过任务 ID 重新触发上传，从未完成的分片继续。</p>
<p>我们可以通过下面这张图可以更直观地看到整个上传任务的生命周期：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a26c793e4d0b4e418d2c8dd72653b72a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517525&amp;x-signature=2puIDO4Ge2N6k5yY%2BVJ4srWSB1c%3D" alt="Untitled diagram-2025-11-10-033341.png" loading="lazy"/></p>
<h4 data-id="heading-27">九、任务恢复机制</h4>
<p>在这套机制下，任务恢复就变得非常自然。<br/>
前端每次进入上传页面时，只要传入文件的 hash，<br/>
后端就能通过 <code>upload_task</code> 和 <code>upload_chunk</code> 判断：</p>
<ol>
<li>这个文件有没有上传任务；</li>
<li>如果有，哪些分片已经上传；</li>
<li>任务当前状态是什么（暂停、失败还是上传中）。</li>
</ol>
<p>然后前端只需补传那些未上传的分片即可。<br/>
这就是我们常说的 <strong>断点续传（Resumable Upload）</strong> 。</p>
<p>在集群环境中，这套逻辑同样成立，<br/>
因为任务与分片状态都落在数据库，不依赖单台服务器。<br/>
无论请求打到哪一台机器，上传进度都是统一可见的。</p>
<h4 data-id="heading-28">十、中断后如何续传</h4>
<p>在实际使用中，用户上传中断是很常见的。<br/>
比如文件太大上传到一半，浏览器突然关了；<br/>
或者公司网络断了，机器重启了；<br/>
甚至有人直接换了电脑继续操作。</p>
<p>如果系统没有任务恢复机制，那用户每次都得重新传一遍，<br/>
尤其是那种几个 G 的文件，不但浪费时间，还容易出错。<br/>
所以我们在设计这套上传中心时，<br/>
一开始就考虑了“<strong>断点续传</strong>”和“<strong>任务恢复</strong>”的问题。</p>
<p><strong>1. 恢复上传靠的其实是数据库里的状态</strong></p>
<p>断点续传的核心逻辑，其实很简单：<br/>
我们让任务和分片的状态都写进数据库。</p>
<p>每当用户重新进入上传页面、选中同一个文件时，<br/>
前端会先计算出文件的 hash，然后调用 <code>/upload/check</code> 接口。<br/>
后端收到 hash 后，会依次去查三张表：</p>
<ol>
<li>
<p><strong>先查 <code>file_info</code></strong><br/>
如果能查到，说明文件之前已经上传并合并成功，<br/>
这时候直接返回“文件已存在”，前端就能实现“秒传”，不需要重新上传。</p>
</li>
<li>
<p><strong>查不到 <code>file_info</code>，就去查 <code>upload_task</code></strong><br/>
如果找到了对应任务，就说明这个文件上传到一半被中断了。<br/>
这时我们会返回这个任务的 uploadId。</p>
</li>
<li>
<p><strong>再查 `upload_chunk``</strong><br/>
系统会统计出哪些分片已经上传成功，哪些还没传。<br/>
然后返回一个“未完成的分片索引列表”给前端。</p>
</li>
</ol>
<p>前端拿到这些信息后，就能从中断的地方继续往下传，<br/>
不用再重复上传已经完成的部分。</p>
<p><strong>2. 前端续传时的流程</strong></p>
<p>前端拿到旧的 uploadId 和未完成分片列表后，<br/>
只需要跳过那些已经上传成功的分片，<br/>
然后照常调用 <code>/upload/chunk</code> 去上传剩下的部分。</p>
<p>上传过程中，每个分片的状态都会被实时更新到 <code>upload_chunk</code> 表中，<br/>
<code>upload_task</code> 表的 uploaded_chunks 也会跟着同步增加。<br/>
当所有分片都上传完后，任务状态自动进入 MERGING（合并中）阶段。</p>
<p>所以整个续传过程，其实就是**“基于数据库状态的增量上传”**。<br/>
用户不需要额外操作，系统自己就能恢复上次的进度。</p>
<p><strong>3. 任务状态和恢复判断</strong></p>
<p>任务是否允许恢复，系统会根据 <code>upload_task.status</code> 来判断。<br/>
大致逻辑是这样的：</p>













































<table><thead><tr><th>状态</th><th>是否可恢复</th><th>说明</th></tr></thead><tbody><tr><td>WAITING</td><td>可以</td><td>任务刚创建，还没开始传</td></tr><tr><td>UPLOADING</td><td>可以</td><td>正在上传中，可以继续</td></tr><tr><td>PAUSED</td><td>可以</td><td>用户主动暂停，可以恢复</td></tr><tr><td>FAILED</td><td>可以</td><td>上传失败，可以重新尝试</td></tr><tr><td>CANCELED</td><td>不可以</td><td>用户主动取消，不再恢复</td></tr><tr><td>COMPLETED</td><td>不需要</td><td>已经完成，直接秒传</td></tr><tr><td>MERGING</td><td>等待中</td><td>系统正在合并，前端等待即可</td></tr></tbody></table>
<p>这套判断逻辑让任务的行为更清晰。<br/>
比如用户暂停上传再回来时，可以直接恢复；<br/>
如果任务已经取消，那就算用户重启也不会再自动续传。</p>
<p><strong>4. 多机器部署下的恢复问题</strong></p>
<p>有些人会担心：如果我们的系统是集群部署的，<br/>
上传时中断后再续传，万一请求打到另一台机器上，<br/>
还能恢复吗？</p>
<p>其实没问题。<br/>
因为我们所有任务和分片的状态都是写进数据库的，<br/>
不依赖内存或本地文件。</p>
<p>也就是说，哪怕用户上次上传在 A 机器，这次续传到了 B 机器，<br/>
系统仍然能根据数据库的记录知道：<br/>
这个 uploadId 下的哪些分片已经上传完，哪些还没传。</p>
<p>所以集群部署下也能无缝续传，不会出现“不同机器不认任务”的情况。</p>
<p><strong>5. 小结</strong></p>
<p>整个任务恢复机制靠的就是两张表：<code>upload_task</code> 和 <code>upload_chunk</code>。<br/>
<code>upload_task</code> 负责记录任务总体进度，<br/>
<code>upload_chunk</code> 负责记录每个分片的上传状态。</p>
<p>当用户重新上传时，我们查表判断进度，<br/>
前端从未完成的地方继续传，就能实现真正意义上的“断点续传”。</p>
<p>这套机制有几个显著的好处：</p>
<ul>
<li>上传进度可追踪；</li>
<li>中断后可恢复；</li>
<li>支持集群部署；</li>
<li>不依赖浏览器缓存或 Session。</li>
</ul>
<p>所以，只要数据库没丢，任务记录还在，<br/>
上传进度就能恢复，哪怕换机器、重启系统都没问题。</p>
<hr/>
<h4 data-id="heading-29">文件合并与完整性校验</h4>
<p>前面的所有步骤，其实都是在为这一刻做准备。<br/>
当用户的所有分片都上传完成后，接下来最重要的工作就是：<br/>
<strong>把这些分片拼成一个完整的文件，并且确保文件内容没有出错。</strong></p>
<p>这一步看似简单，但其实是整个大文件上传流程里最容易出问题的地方。<br/>
尤其在集群部署下，如果不同分片分布在不同机器上，<br/>
那合并逻辑就不能只靠本地文件路径去拼接，否则根本找不到所有分片。</p>
<p>所以我们先来理一理整个思路。</p>
<h4 data-id="heading-30">一、合并的触发时机</h4>
<p>前端在检测到所有分片都上传完成后，会调用 <code>/upload/merge</code> 接口。<br/>
这个接口的作用就是通知后端：<br/>
“这个任务的所有分片都传完了，现在可以开始合并了。”</p>
<p>后端接收到请求后，会先去查数据库确认几个关键信息：</p>
<ol>
<li>这个任务对应的 uploadId 是否存在；</li>
<li><code>upload_chunk</code> 表里所有分片是否都处于 “已上传” 状态；</li>
<li>当前任务状态是否允许合并（例如不是暂停、取消或失败）。</li>
</ol>
<p>确认无误后，任务状态会从 <code>UPLOADING</code> 变成 <code>MERGING</code>，<br/>
正式进入文件合并阶段。</p>
<h4 data-id="heading-31">二、本地合并逻辑</h4>
<p>如果系统配置的是本地存储（也就是 <code>cloud.enable = false</code>），<br/>
那所有分片文件都保存在服务器的临时目录中。</p>
<p>合并逻辑大致是这样的：</p>
<ol>
<li>后端按分片的 <code>chunk_index</code> 顺序，依次读取每个分片文件。</li>
<li>逐个写入到一个新的目标文件中，比如 <code>merge.zip</code>。</li>
<li>每合并一个分片，就更新数据库中的状态。</li>
<li>合并完成后，把任务状态更新为 <code>COMPLETED</code>，并写入最终路径。</li>
</ol>
<p>整个过程看起来很直观，<br/>
但这里有两个要点需要特别注意：</p>
<ul>
<li><strong>写入顺序要严格按照分片索引</strong>，否则文件内容会错乱；</li>
<li><strong>文件 IO 要用流式写入（Stream）</strong> ，避免内存一次性读取所有分片导致溢出。</li>
</ul>
<p>合并完成后，我们会计算整个文件的 MD5，与原始 fileHash 对比，<br/>
如果不一致，就说明合并过程中数据丢失或出错。<br/>
这种情况任务会被标记为 <code>FAILED</code>，并在日志中留下异常记录。</p>
<h4 data-id="heading-32">三、云端合并逻辑</h4>
<p>如果我们配置了云存储（比如 OSS、COS、MinIO 等），<br/>
那分片文件就不是存在本地磁盘，而是上传到云端的对象存储桶里。</p>
<p>在这种情况下，合并逻辑就不需要我们自己拼文件了，<br/>
因为大部分云存储服务都提供了“分片合并”的 API。</p>
<p>比如以 OSS 为例，上传时我们调用的是 <code>uploadPart</code> 接口，<br/>
合并时只需要调用 <code>completeMultipartUpload</code>，<br/>
它会根据上传时的分片顺序自动合并为一个完整对象。</p>
<p>整个过程的优点是：</p>
<ul>
<li>不占用本地磁盘；</li>
<li>不受单机 IO 限制；</li>
<li>云端自动校验每个分片的完整性。</li>
</ul>
<p>所以在云存储场景下，我们只需要做两件事：</p>
<ol>
<li>通知云服务去执行合并；</li>
<li>成功后记录最终的文件地址（<code>storage_url</code>）到数据库。</li>
</ol>
<p>这样整个流程就闭环了。</p>
<h4 data-id="heading-33">四、集群部署下的合并问题</h4>
<p>单机情况下，合并很简单，因为所有分片都在本地。<br/>
但如果系统是集群部署的，分片请求可能打到了不同机器，<br/>
这时候分片文件就会分散在多个节点上。</p>
<p>我们在设计时考虑了三种解决方案：</p>
<p><strong>方案 1：共享存储（私有化部署下比较推荐）</strong></p>
<p>最常见的做法是把所有机器的上传目录指向同一个共享路径，<br/>
比如通过 NFS、NAS、或对象存储挂载到 <code>/data/uploads</code>。<br/>
这样无论用户上传的分片打到哪台机器，<br/>
最终都会写入同一个物理目录。</p>
<p>当合并请求发起时，任意一台机器都能访问到完整的分片文件。<br/>
这是目前在企业部署中最稳定、最通用的方案。</p>
<p><strong>方案 2：云存储中转</strong></p>
<p>如果机器之间没有共享目录，那我们可以让每个分片先上传到云端，<br/>
合并时再调用云服务的 API 进行分片合并。<br/>
这种方式适合公网可访问的 SaaS 环境。<br/>
但对于政企内网部署，就不一定行得通。</p>
<p><strong>方案 3：统一调度节点</strong></p>
<p>还有一种是我们自己维护一个“合并调度节点”，<br/>
所有分片上传完后，系统会把合并任务分配到一个指定节点执行，<br/>
这个节点会从其他机器拉取分片（比如通过 HTTP 内部传输或 RPC）。<br/>
这种方式更复杂，适合大规模分布式存储场景。</p>
<p>在私有化项目中，我们一般采用第一种方式——<strong>共享目录 + 本地合并</strong>。<br/>
既能保证性能，也能兼顾安全性。</p>
<h4 data-id="heading-34">五、完整性校验</h4>
<p>文件合并完成后，最后一步是完整性校验。<br/>
我们会重新计算合并后文件的 MD5，与前端最初上传的 <code>fileHash</code> 对比。</p>
<p>如果一致，就说明文件合并成功，内容没有丢失；<br/>
如果不一致，就说明某个分片损坏或顺序错误，<br/>
任务会被标记为 <code>FAILED</code>，并自动记录错误日志。</p>
<p>这样可以确保文件数据的安全性，<br/>
避免在后续 AI 解析或向量化阶段出现内容异常。</p>
<h4 data-id="heading-35">六、异步处理与性能优化</h4>
<p>开头的视频里我们也看到了，整个上传和合并过程我们是<strong>同步执行</strong>的。<br/>
从前端开始上传分片，到最后文件合并完成，都在等待同一个流程走完。<br/>
这种方式在演示时很直观，但在真实项目中其实问题不少。</p>
<p>最明显的一个问题就是——时间太长。<br/>
像我们刚才那个 1GB 的文件，即使网络稳定、服务器性能还可以，<br/>
整个流程也要几分钟甚至更久。<br/>
如果我们让前端一直等待响应，接口超时、连接断开、前端刷新这些问题就都会冒出来。</p>
<p>所以，在真正的业务系统里，我们一般会把<strong>合并、校验、迁移 OSS 或解析入库</strong>这些操作改成<strong>异步任务</strong>来做。<br/>
接口只负责接收分片、登记状态，然后立刻返回“任务已创建”或“上传完成，正在处理中”的提示。<br/>
后续的合并、校验、清理临时文件这些工作交给后台的异步线程、任务队列或者调度器去跑。</p>
<p>这样做的好处有几个：</p>
<ul>
<li>前端体验更流畅，不用卡在“等待合并”阶段；</li>
<li>后端可以批量处理任务，减少高峰期的 IO 压力；</li>
<li>如果任务失败或中断，也能通过任务表重试或补偿；</li>
<li>对接外部存储或 AI 解析流程时，也能自然衔接后续任务链。</li>
</ul>
<p>简单来说，上传只是第一步，<br/>
而合并、校验、转存这些操作本质上更像是后台任务。<br/>
我们在系统设计时只要把这些环节分开，让接口尽量“轻”，<br/>
这套上传系统就能在面对更大文件、更复杂场景时依然稳定可靠。</p>
<h4 data-id="heading-36">七、小结</h4>
<p>整个合并与校验阶段，是把前面所有分片上传工作“收尾”的过程。<br/>
我们通过以下机制保证了稳定性：</p>
<ul>
<li>本地存储场景下：顺序读取 + 流式写入 + hash 校验；</li>
<li>云存储场景下：依赖云端分片合并 API；</li>
<li>集群环境下：通过共享存储或统一调度节点解决文件分散问题；</li>
<li>数据库层面：实时记录状态，便于追踪和审计。</li>
</ul>
<p>最终，当文件合并成功、校验通过后，<br/>
系统会将结果写入 <code>file_info</code> 表，<br/>
整条上传链路就算是完整闭环。</p>
<hr/>
<h3 data-id="heading-37">最后</h3>
<p>我们平常做的项目，大多数时候文件上传都挺简单的。<br/>
前端传到 OSS，后端接个地址存起来就行。<br/>
但等真正做私有化项目的时候，也就会发现很多地方都不一样了。<br/>
要求更多，考虑的细节也多得多。</p>
<p>像这次做的大文件上传就是个很典型的例子。<br/>
以前那种简单方案，放在这种环境下就完全不够用了。<br/>
得考虑断点续传、任务恢复、集群部署、权限、审计这些东西，<br/>
一步没想好，后面全是坑。</p>
<p>我们现在这套设计，其实就是在解决这些“现实问题”。<br/>
接口虽然多一点，但每个职责都很清晰，<br/>
任务状态能追踪，上传中断能恢复，<br/>
甚至以后如果我们想单独抽出来做一个文件系统模块也完全没问题。<br/>
不管是拿来给知识库用，还是 AI 向量化、文档解析，这套逻辑都能复用。</p>
<p>其实很多以前觉得“简单”的功能，<br/>
一旦遇到复杂场景，其实都得重新想。<br/>
但好处是，一旦做通了，这套东西就能稳定用很久。</p>
<p>到这里，大文件上传这块我们算是完整走了一遍。<br/>
以后再遇到类似需求，我们就有经验了，<br/>
不用再从头掉坑里爬出来一次哈。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearch 的结构化文档配置 - 递归分块实践]]></title>    <link>https://juejin.cn/post/7571348736153632804</link>    <guid>https://juejin.cn/post/7571348736153632804</guid>    <pubDate>2025-11-12T01:54:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571348736153632804" data-draft-id="7571306072423956522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch 的结构化文档配置 - 递归分块实践"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-11-12T01:54:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch 的结构化文档配置 - 递归分块实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T01:54:44.000Z" title="Wed Nov 12 2025 01:54:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天我发表的一篇文章 “<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F154722870" title="https://elasticstack.blog.csdn.net/article/details/154722870" target="_blank" ref="nofollow noopener noreferrer">在 Elasticsearch 中为结构化文档配置递归分块</a>” 看着很简单。可能很多开发者还是不能得其要领，特别是在最新的版本中，我们的向量在默认的情况下是不在 source 里进行展示的。很难理解其中精髓。我在这篇文章里，使用一个具体的例子来进行展示。</p>
<h2 data-id="heading-0">例子</h2>
<p>我们可以参考官方文档 “<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference%2Finference-api" title="https://www.elastic.co/docs/explore-analyze/elastic-inference/inference-api" target="_blank" ref="nofollow noopener noreferrer">Inference integrations</a>” 来进行展示。首先，我们选择系统自带的 ELSER 模型来进行展示。我们必须安装好 ELSER 模型：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a72721867b84f7ca30276c2141fa66b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517284&amp;x-signature=XtTWN07lYKYC8Idmdq7hm5Ihie0%3D" alt="" loading="lazy"/></p>
<p>首先我们定义如下的一个 inference endpoint：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _inference/sparse_embedding/recursive_markdown_chunks
2.  {
3.    <span class="hljs-string">"service"</span>: <span class="hljs-string">"elasticsearch"</span>,
4.    <span class="hljs-string">"service_settings"</span>: {
5.      <span class="hljs-string">"model_id"</span>: <span class="hljs-string">".elser_model_2"</span>,
6.      <span class="hljs-string">"num_allocations"</span>: 1,
7.      <span class="hljs-string">"num_threads"</span>: 1
8.    },
9.    <span class="hljs-string">"chunking_settings"</span>: {
10.      <span class="hljs-string">"strategy"</span>: <span class="hljs-string">"recursive"</span>,
11.      <span class="hljs-string">"max_chunk_size"</span>: 25,
12.      <span class="hljs-string">"separators"</span>: [
13.        <span class="hljs-string">"\n# "</span>,
14.        <span class="hljs-string">"\n## "</span>
15.      ]
16.    }
17.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>我们可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference%2Finference-api%23recursive" title="https://www.elastic.co/docs/explore-analyze/elastic-inference/inference-api#recursive" target="_blank" ref="nofollow noopener noreferrer">文档</a>来了解 recursive 是如何工作的。递归策略根据可配置的分隔符模式列表（例如换行符或 Markdown 标题）拆分输入文本。分块器按顺序应用这些分隔符，递归地拆分超过 max_chunk_size 单词限制的任何分块。如果没有分隔符生成足够小的分块，该策略将退回到句子级拆分。</p>
<p>在上面，我们使用了 custom separator group：也就是基于第一第二级的 heading 来进行分隔提前。</p>
<p>接下来，我们定义一个索引：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT recursive_markdown_vectors
2.  {
3.    <span class="hljs-string">"mappings"</span>: {
4.      <span class="hljs-string">"properties"</span>: {
5.        <span class="hljs-string">"content"</span>: {
6.          <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
7.          <span class="hljs-string">"copy_to"</span>: <span class="hljs-string">"inference_field"</span>
8.        },
9.        <span class="hljs-string">"inference_field"</span>: {
10.          <span class="hljs-string">"type"</span>: <span class="hljs-string">"semantic_text"</span>,
11.          <span class="hljs-string">"inference_id"</span>: <span class="hljs-string">"recursive_markdown_chunks"</span>
12.        }
13.      }
14.    }
15.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>然后，我们写入文档：</p>
<pre><code class="hljs language-less" lang="less">`

<span class="hljs-number">1</span>.  <span class="hljs-selector-tag">POST</span> <span class="hljs-selector-tag">recursive_markdown_vectors</span>/<span class="hljs-selector-tag">_doc</span>/<span class="hljs-number">1</span>
<span class="hljs-number">2</span>.  {
<span class="hljs-number">3</span>.    "<span class="hljs-selector-tag">content</span>": "# <span class="hljs-selector-tag">First</span> <span class="hljs-selector-tag">Header</span>
<span class="hljs-number">4</span>.  <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">first</span> <span class="hljs-selector-tag">test</span> <span class="hljs-selector-tag">sentence</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">ten</span> <span class="hljs-selector-tag">total</span> <span class="hljs-selector-tag">words</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">it</span>.

<span class="hljs-number">6</span>.  ## <span class="hljs-selector-tag">Second</span> <span class="hljs-selector-tag">header</span>
<span class="hljs-number">7</span>.  <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">second</span> <span class="hljs-selector-tag">test</span> <span class="hljs-selector-tag">sentence</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">ten</span> <span class="hljs-selector-tag">total</span> <span class="hljs-selector-tag">words</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">it</span>.

<span class="hljs-number">9</span>.  # <span class="hljs-selector-tag">Third</span> <span class="hljs-selector-tag">Header</span>
<span class="hljs-number">10</span>.  <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">third</span> <span class="hljs-selector-tag">test</span> <span class="hljs-selector-tag">sendtence</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">ten</span> <span class="hljs-selector-tag">total</span> <span class="hljs-selector-tag">words</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">it</span>.

<span class="hljs-number">12</span>.  ## <span class="hljs-selector-tag">Fourth</span> <span class="hljs-selector-tag">Header</span>
<span class="hljs-number">13</span>.  <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">Fourth</span> <span class="hljs-selector-tag">test</span> <span class="hljs-selector-tag">sendtence</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">ten</span> <span class="hljs-selector-tag">total</span> <span class="hljs-selector-tag">words</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">it</span>.

<span class="hljs-number">16</span>.  ## <span class="hljs-selector-tag">Fifth</span> <span class="hljs-selector-tag">Header</span>
<span class="hljs-number">17</span>.  <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">fifth</span> <span class="hljs-selector-tag">test</span> <span class="hljs-selector-tag">sentence</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">ten</span> <span class="hljs-selector-tag">total</span> <span class="hljs-selector-tag">words</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">it</span>. <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">sixth</span> <span class="hljs-selector-tag">test</span> <span class="hljs-selector-tag">sentence</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">ten</span> <span class="hljs-selector-tag">total</span> <span class="hljs-selector-tag">words</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">it</span>. <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">seventh</span> <span class="hljs-selector-tag">test</span> <span class="hljs-selector-tag">sentence</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">ten</span> <span class="hljs-selector-tag">total</span> <span class="hljs-selector-tag">words</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">it</span>."
<span class="hljs-number">18</span>.  }

`<span class="hljs-selector-tag">AI</span>写代码!<span class="hljs-selector-attr">[]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>这样我们就大功告成了。</p>
<p>我们可以使用如下的查询来进行展示：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  GET recursive_markdown_vectors/_search?filter_path=**.hits
2.  {
3.    <span class="hljs-string">"fields"</span>: [
4.      {
5.        <span class="hljs-string">"field"</span>: <span class="hljs-string">"inference_field"</span>,
6.        <span class="hljs-string">"format"</span>: <span class="hljs-string">"chunks"</span>
7.      }
8.    ]
9.  }

`AI写代码
</code></pre>
<blockquote>
<p><strong>注意</strong>：上面的 fields 只对 9.2+ 及以上版本起作用。</p>
</blockquote>
<p>我们可以看到如下的查询结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40352a0dcdc6471c8583e2f1887adaad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517284&amp;x-signature=V98yL5ZjREVzniTUCigPcCqIYHA%3D" alt="" loading="lazy"/></p>
<p>从上面的结果中，我们可以看到有 3 个 chunks。</p>
<p>我们接下来把 max_chunk_size 设置为 10，看看最后的结果：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _inference/sparse_embedding/recursive_markdown_chunks
2.  {
3.    <span class="hljs-string">"service"</span>: <span class="hljs-string">"elasticsearch"</span>,
4.    <span class="hljs-string">"service_settings"</span>: {
5.      <span class="hljs-string">"model_id"</span>: <span class="hljs-string">".elser_model_2"</span>,
6.      <span class="hljs-string">"num_allocations"</span>: 1,
7.      <span class="hljs-string">"num_threads"</span>: 1
8.    },
9.    <span class="hljs-string">"chunking_settings"</span>: {
10.      <span class="hljs-string">"strategy"</span>: <span class="hljs-string">"recursive"</span>,
11.      <span class="hljs-string">"max_chunk_size"</span>: 10,
12.      <span class="hljs-string">"separators"</span>: [
13.        <span class="hljs-string">"\n# "</span>,
14.        <span class="hljs-string">"\n## "</span>
15.      ]
16.    }
17.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b9498c81c8e4c87bb20185602a0323d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517284&amp;x-signature=JCLV70P0fjshDmpVwpO99hNiBfI%3D" alt="" loading="lazy"/></p>
<p>很显然，它和我们之前的分块还是有点不一样。我们可以试试不同的值来看看。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _inference/sparse_embedding/recursive_markdown_chunks
2.  {
3.    <span class="hljs-string">"service"</span>: <span class="hljs-string">"elasticsearch"</span>,
4.    <span class="hljs-string">"service_settings"</span>: {
5.      <span class="hljs-string">"model_id"</span>: <span class="hljs-string">".elser_model_2"</span>,
6.      <span class="hljs-string">"num_allocations"</span>: 1,
7.      <span class="hljs-string">"num_threads"</span>: 1
8.    },
9.    <span class="hljs-string">"chunking_settings"</span>: {
10.      <span class="hljs-string">"strategy"</span>: <span class="hljs-string">"recursive"</span>,
11.      <span class="hljs-string">"max_chunk_size"</span>: 35,
12.      <span class="hljs-string">"separators"</span>: [
13.        <span class="hljs-string">"\n# "</span>,
14.        <span class="hljs-string">"\n## "</span>
15.      ]
16.    }
17.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1e6c54c0067494dbd25796c07bc9a69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517284&amp;x-signature=o5HzfWQQODkzmhFeQru%2FH6Wh%2BUk%3D" alt="" loading="lazy"/></p>
<p>我们也可以尝试使用 "separator_group":  "markdown"：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _inference/sparse_embedding/recursive_markdown_chunks
2.  {
3.    <span class="hljs-string">"service"</span>: <span class="hljs-string">"elasticsearch"</span>,
4.    <span class="hljs-string">"service_settings"</span>: {
5.      <span class="hljs-string">"model_id"</span>: <span class="hljs-string">".elser_model_2"</span>,
6.      <span class="hljs-string">"num_allocations"</span>: 1,
7.      <span class="hljs-string">"num_threads"</span>: 1
8.    },
9.    <span class="hljs-string">"chunking_settings"</span>: {
10.      <span class="hljs-string">"strategy"</span>: <span class="hljs-string">"recursive"</span>,
11.      <span class="hljs-string">"max_chunk_size"</span>: 25,
12.      <span class="hljs-string">"separator_group"</span>: <span class="hljs-string">"markdown"</span>
13.    }
14.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c23a98f076324ce6be122caac80d7daa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517284&amp;x-signature=6bB2H%2BYjRm0Xkxnc6lLVyK8TUsU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41499d9c17c0463badf7d093ec6e9c93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763517284&amp;x-signature=oS2QMUh6UxNupVq9PRbM2WGqJag%3D" alt="" loading="lazy"/></p>
<p>可以看出来，它的结果和我们之前第一个结果的没有什么不一样的，这是因为 markdown 所包含的 separators 里也是对 heading 进行分段的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《手撕类Vue2的响应式核心思想：我的学习心路历程》]]></title>    <link>https://juejin.cn/post/7571306072423153706</link>    <guid>https://juejin.cn/post/7571306072423153706</guid>    <pubDate>2025-11-11T16:14:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072423153706" data-draft-id="7571102074039418921" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《手撕类Vue2的响应式核心思想：我的学习心路历程》"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-11T16:14:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="残冬醉离殇"/> <meta itemprop="url" content="https://juejin.cn/user/1145072454220539"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《手撕类Vue2的响应式核心思想：我的学习心路历程》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145072454220539/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    残冬醉离殇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T16:14:14.000Z" title="Tue Nov 11 2025 16:14:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、前言：什么是响应式？</h3>
<p>响应式的核心思想很简单：<strong>当数据发生变化时，所有依赖于这个数据的函数（例如视图渲染函数、计算函数等）会自动重新执行</strong>，从而保持数据与依赖它的事物同步。在Vue2中，这是通过<code>Object.defineProperty</code>实现的。今天，我们就顺着这个思路，用原生JavaScript手写一个简易的响应式Demo。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21e4f4f8481741f0855dae800d0022fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=10u%2FGqtjrC2peLmDDZ37Z5d7FrM%3D" alt="实例效果.gif" loading="lazy"/></p>
<h3 data-id="heading-1">二、基础版本：手动触发更新</h3>
<p>我们先实现一个最基础的版本。点击按钮，让<code>obj.age</code>增加，并同步更新页面。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"age"</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"changeObj()"</span>&gt;</span>年龄++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 定义数据对象</span>
<span class="hljs-keyword">const</span> obj = {
    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>
};

<span class="hljs-comment">// 2. 获取DOM元素</span>
<span class="hljs-keyword">const</span> ageEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#age'</span>);

<span class="hljs-comment">// 3. 定义更新DOM的函数</span>
<span class="hljs-keyword">const</span> updateDom = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    ageEl.<span class="hljs-property">textContent</span> = obj.<span class="hljs-property">age</span>.<span class="hljs-title function_">toString</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'页面已更新: '</span>, ageEl.<span class="hljs-property">textContent</span>);
}

<span class="hljs-comment">// 4. 定义改变数据的函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObj</span> = (<span class="hljs-params"/>) =&gt; {
    obj.<span class="hljs-property">age</span>++; <span class="hljs-comment">// 修改数据</span>
    <span class="hljs-title function_">updateDom</span>(); <span class="hljs-comment">// 手动更新DOM</span>
}
</code></pre>
<p><strong>效果：</strong> 点击按钮，年龄增加，页面显示同步更新。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/065c57e05f0b48aeb6189d319254b07c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=2VNxYZBVL3UBOALCp6rwTm9UZpY%3D" alt="image.png" loading="lazy"/></p>
<p>这确实复现了“响应式”的效果，但存在一个明显问题：<strong>我们需要手动调用<code>updateDom</code></strong>。如果依赖<code>obj.age</code>的函数很多，比如有<code>dependFn1</code>, <code>dependFn2</code>, <code>dependFn3</code>，那么<code>changeObj</code>函数会变得非常冗长和难以维护。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> updateDom = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    age.<span class="hljs-property">textContent</span> = obj.<span class="hljs-property">age</span>.<span class="hljs-title function_">toString</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(age.<span class="hljs-property">textContent</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn1</span> = (<span class="hljs-params"/>)=&gt;{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn2</span> = (<span class="hljs-params"/>)=&gt;{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn3</span> = (<span class="hljs-params"/>)=&gt;{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObj</span> = (<span class="hljs-params"/>)=&gt;{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
    obj.<span class="hljs-property">age</span>++
    <span class="hljs-title function_">updateDom</span>()<span class="hljs-comment">//更新dom</span>
    <span class="hljs-title function_">dependFn1</span>()
    <span class="hljs-title function_">dependFn2</span>()
    <span class="hljs-title function_">dependFn3</span>()
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddb48f72293b4dd28b20befe9f082314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=eGa1auY9FA8QpVKa%2FMeFajzRIjs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">三、优化一：统一管理依赖函数</h3>
<p>为了解决上述问题，我们可以把所有依赖函数收集到一个数组中，当数据变化时，统一遍历执行。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//创建依赖函数数组</span>
<span class="hljs-keyword">let</span> fnArrays = []

<span class="hljs-comment">//创建触发依赖函数的函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">dispatchFns</span> = (<span class="hljs-params"/>)=&gt;{
  fnArrays.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>())
}

<span class="hljs-comment">//收集依赖函数的函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">gatherFns</span> = (<span class="hljs-params">fn</span>)=&gt;{
  fnArrays.<span class="hljs-title function_">push</span>(fn)
}

<span class="hljs-title function_">gatherFns</span>(dependFn1)
<span class="hljs-title function_">gatherFns</span>(dependFn2)
<span class="hljs-title function_">gatherFns</span>(dependFn3)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObj</span> = (<span class="hljs-params"/>)=&gt;{
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
  obj.<span class="hljs-property">age</span>++
  <span class="hljs-title function_">updateDom</span>()<span class="hljs-comment">//更新dom</span>
  <span class="hljs-title function_">dispatchFns</span>()
}
</code></pre>
<p>这样，我们只需要调用一次<code>dispatchFns()</code>，所有依赖函数都会执行。但这种方式依然不够灵活，如果多个数据对象拥有各自的依赖函数，管理起来会非常混乱。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e403574ff8c4d29876ceb35e500f6ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=mrLWWlQ0diKRc0pJLfB18eDwqZI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">四、优化二：引入Depend类</h3>
<p>更好的做法是为每个响应式数据创建一个独立的<strong>依赖管理器</strong>。我们定义一个<code>Depend</code>类来专门负责收集和触发依赖函数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//这时候得创建一个Depend(依赖）类</span>
  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Depend</span> {
      <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>){
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
      }

      <span class="hljs-comment">//收集依赖函数</span>
      <span class="hljs-title function_">gatherFns</span>(<span class="hljs-params">fn</span>){
          <span class="hljs-keyword">if</span>(fn &amp;&amp; <span class="hljs-keyword">typeof</span> fn === <span class="hljs-string">'function'</span>){
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span>.<span class="hljs-title function_">add</span>(fn)
          }
      }

      <span class="hljs-comment">//统一调用依赖函数</span>
      <span class="hljs-title function_">dispatchFns</span>(<span class="hljs-params"/>){
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> {
              <span class="hljs-title function_">fn</span>()
          })
      }
  }

  <span class="hljs-keyword">const</span> depend1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Depend</span>()

  depend1.<span class="hljs-title function_">gatherFns</span>(dependFn1)
  depend1.<span class="hljs-title function_">gatherFns</span>(dependFn2)
  depend1.<span class="hljs-title function_">gatherFns</span>(dependFn3)

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObj</span> = (<span class="hljs-params"/>)=&gt;{
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
      obj.<span class="hljs-property">age</span>++
      <span class="hljs-title function_">updateDom</span>()<span class="hljs-comment">//更新dom</span>
      depend1.<span class="hljs-title function_">dispatchFns</span>()
  }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6136e264d79241f4955d68571fd57e4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=ELBvWPKn3BK7kVssjdoFmwxocFI%3D" alt="image.png" loading="lazy"/></p>
<p>现在，每个响应式数据都有自己的<code>Depend</code>实例，依赖管理更加清晰。但我们仍然需要在修改数据后<strong>手动调用<code>dispatchFns()</code></strong>。</p>
<h3 data-id="heading-4">五、核心实现：自动依赖收集和触发</h3>
<p>要实现真正的自动响应式，我们需要在<strong>获取数据时自动收集依赖</strong>，在<strong>修改数据时自动触发更新</strong>。这可以通过<code>Object.defineProperty</code>拦截数据的读取和修改操作来实现。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//创建一个myReactive的函数，接收一个对象，进行对它的属性劫持</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myReactive</span>(<span class="hljs-params">obj</span>){
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Depend</span>() <span class="hljs-comment">//创建一个实例对象</span>
        <span class="hljs-keyword">let</span> value = obj[key] <span class="hljs-comment">//获取对应属性的值，保留等下要用</span>

        <span class="hljs-comment">//加上属性劫持</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj,key,{
            get : <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
                <span class="hljs-keyword">return</span> value
            },
            set : <span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>){
                value = newValue
                <span class="hljs-comment">//通知对应的实例执行所有依赖函数</span>
                instance.<span class="hljs-title function_">dispatchFns</span>()
            }
        })
    })
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/410abf3c8f604860a2e5a8c1a3fc7f1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=%2Ffdak%2FgQzSG5CFSSIXs5lR5d37I%3D" alt="image.png" loading="lazy"/></p>
<p>现在是解决了对象属性改变时，可以劫持使用set方法进行调用依赖函数，但是收集函数就成了一个难题，因为实例是在内部创建的，形成了闭包，外界拿不到内部的实例，所以只有一个方法了，就是设置一个全局活跃函数，当调用依赖函数时，会触发获取对象属性，触发get方法，就可以在get方法调用内部的instance可以获取外部的全局活跃函数，将其加入实例中的Set数组中！</p>
<h4 data-id="heading-5">关键思路：设置"全局活跃函数"</h4>
<p>我们需要一个方法来标记当前正在执行的函数，这样在读取数据时，就能知道是哪个函数依赖了这个数据。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//设置活跃函数</span>
<span class="hljs-keyword">let</span> activeFn = <span class="hljs-literal">null</span>
<span class="hljs-comment">//加入依赖的函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addDependFn</span> = (<span class="hljs-params">fn</span>)=&gt;{
    activeFn = fn
    <span class="hljs-title function_">fn</span>()
    activeFn = <span class="hljs-literal">null</span>
}

<span class="hljs-title function_">addDependFn</span>(dependFn1)
<span class="hljs-title function_">addDependFn</span>(dependFn2)
<span class="hljs-title function_">addDependFn</span>(dependFn3)

<span class="hljs-comment">//创建一个myReactive的函数，接收一个对象，进行对它的属性劫持</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myReactive</span>(<span class="hljs-params">obj</span>){
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Depend</span>() <span class="hljs-comment">//创建一个实例对象</span>
        <span class="hljs-keyword">let</span> value = obj[key] <span class="hljs-comment">//获取对应属性的值，保留等下要用</span>

        <span class="hljs-comment">//加上属性劫持</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj,key,{
            get : <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
                instance.<span class="hljs-title function_">gatherFns</span>(activeFn)
                <span class="hljs-keyword">return</span> value
            },
            set : <span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>){
                value = newValue
                <span class="hljs-comment">//通知对应的实例执行所有依赖函数</span>
                instance.<span class="hljs-title function_">dispatchFns</span>()
            }
        })
    })
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7294aceb2c744f9921626c62c784667~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=0WNPoe8M2peWvDAbRekiIptYn7c%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>其实到这里就已经实现了简单的响应式啦！哈哈哈， 完整demo代码如下</p>
</blockquote>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>手撕类Vue2响应式demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"age"</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"changeObj()"</span>&gt;</span>年龄++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// obj对象</span>
        <span class="hljs-keyword">const</span> obj = {
            age : <span class="hljs-number">18</span>
        }

        <span class="hljs-comment">//使用原生拿到元素</span>
        <span class="hljs-keyword">const</span> age = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#age'</span>)

        <span class="hljs-keyword">const</span> updateDom = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            age.<span class="hljs-property">textContent</span> = obj.<span class="hljs-property">age</span>.<span class="hljs-title function_">toString</span>()
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(age.<span class="hljs-property">textContent</span>);
        }

        <span class="hljs-comment">//模拟依赖函数1</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn1</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
        }

        <span class="hljs-comment">//模拟依赖函数2</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn2</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
        }

        <span class="hljs-comment">//模拟依赖函数3</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn3</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
        }

        <span class="hljs-comment">//这时候得创建一个类</span>
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Depend</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>){
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
            }

            <span class="hljs-comment">//收集依赖函数</span>
            <span class="hljs-title function_">gatherFns</span>(<span class="hljs-params">fn</span>){
                <span class="hljs-keyword">if</span>(fn &amp;&amp; <span class="hljs-keyword">typeof</span> fn === <span class="hljs-string">'function'</span>){
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span>.<span class="hljs-title function_">add</span>(fn)
                }
            }

            <span class="hljs-comment">//统一调用依赖函数</span>
            <span class="hljs-title function_">dispatchFns</span>(<span class="hljs-params"/>){
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> {
                    <span class="hljs-title function_">fn</span>()
                })
            }
        }

        <span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObj</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
            obj.<span class="hljs-property">age</span>++
        }

        <span class="hljs-comment">//设置活跃函数</span>
        <span class="hljs-keyword">let</span> activeFn = <span class="hljs-literal">null</span>
        <span class="hljs-comment">//加入依赖的函数</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">addDependFn</span> = (<span class="hljs-params">fn</span>)=&gt;{
            activeFn = fn
            <span class="hljs-title function_">fn</span>()
            activeFn = <span class="hljs-literal">null</span>
        }

        <span class="hljs-comment">//手动执行一遍函数</span>
        <span class="hljs-title function_">addDependFn</span>(dependFn1)
        <span class="hljs-title function_">addDependFn</span>(dependFn2)
        <span class="hljs-title function_">addDependFn</span>(dependFn3)

        <span class="hljs-comment">//创建一个myReactive的函数，接收一个对象，进行对它的属性劫持</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">myReactive</span>(<span class="hljs-params">obj</span>){
            <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
                <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Depend</span>() <span class="hljs-comment">//创建一个实例对象</span>
                <span class="hljs-keyword">let</span> value = obj[key] <span class="hljs-comment">//获取对应属性的值，保留等下要用</span>

                <span class="hljs-comment">//加上属性劫持</span>
                <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj,key,{
                    get : <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
                        instance.<span class="hljs-title function_">gatherFns</span>(activeFn)
                        <span class="hljs-keyword">return</span> value
                    },
                    set : <span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>){
                        value = newValue
                        <span class="hljs-comment">//通知对应的实例执行所有依赖函数</span>
                        instance.<span class="hljs-title function_">dispatchFns</span>()
                    }
                })
            })
        }

        <span class="hljs-title function_">myReactive</span>(obj) <span class="hljs-comment">//传入对象，添加劫持</span>
        <span class="hljs-title function_">addDependFn</span>(updateDom) <span class="hljs-comment">//添加活跃函数</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">六、最终优化</h3>
<blockquote>
<p>但是到现在，其实它还有很多可以优化的地方，比如可能一个对象多次传入myReactive函数，会创建多个实例，还有实例是在myReactive函数里面创建的，属于闭包，可能出现内存泄漏，所以我们可以采用WeakMap集合来收集对象，这样子的话，就可以在myReactive函数开始那里判断一下对象是否创建过。然后每一个对象对应着一个（属性-实例）Map表，这样子的话，就可以方便的拿到实例了，就不会有强引用来泄漏内存了。</p>
</blockquote>
<p>这里是优化，就不赘述了，直接上代码</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>手撕类Vue2响应式demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"age"</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"changeObj()"</span>&gt;</span>年龄++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// obj对象</span>
        <span class="hljs-keyword">const</span> obj = {
            age : <span class="hljs-number">18</span>
        }

        <span class="hljs-comment">//使用原生拿到元素</span>
        <span class="hljs-keyword">const</span> age = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#age'</span>)

        <span class="hljs-keyword">const</span> updateDom = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            age.<span class="hljs-property">textContent</span> = obj.<span class="hljs-property">age</span>.<span class="hljs-title function_">toString</span>()
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(age.<span class="hljs-property">textContent</span>);
        }

        <span class="hljs-comment">//模拟依赖函数1</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn1</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
        }

        <span class="hljs-comment">//模拟依赖函数2</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn2</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
        }

        <span class="hljs-comment">//模拟依赖函数3</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">dependFn3</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
        }

        <span class="hljs-comment">//这时候得创建一个类</span>
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Depend</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>){
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
            }

            <span class="hljs-comment">//收集依赖函数</span>
            <span class="hljs-title function_">gatherFns</span>(<span class="hljs-params">fn</span>){
                <span class="hljs-keyword">if</span>(fn &amp;&amp; <span class="hljs-keyword">typeof</span> fn === <span class="hljs-string">'function'</span>){
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span>.<span class="hljs-title function_">add</span>(fn)
                }
            }

            <span class="hljs-comment">//统一调用依赖函数</span>
            <span class="hljs-title function_">dispatchFns</span>(<span class="hljs-params"/>){
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">dependFns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> {
                    <span class="hljs-title function_">fn</span>()
                })
            }
        }

        <span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObj</span> = (<span class="hljs-params"/>)=&gt;{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>);
            obj.<span class="hljs-property">age</span>++
        }

        <span class="hljs-comment">//设置活跃函数</span>
        <span class="hljs-keyword">let</span> activeFn = <span class="hljs-literal">null</span>
        <span class="hljs-comment">//加入依赖的函数</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">addDependFn</span> = (<span class="hljs-params">fn</span>)=&gt;{
            activeFn = fn
            <span class="hljs-title function_">fn</span>()
            activeFn = <span class="hljs-literal">null</span>
        }

        <span class="hljs-comment">//手动执行一遍函数</span>
        <span class="hljs-title function_">addDependFn</span>(dependFn1)
        <span class="hljs-title function_">addDependFn</span>(dependFn2)
        <span class="hljs-title function_">addDependFn</span>(dependFn3)

        <span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()<span class="hljs-comment">//创建一个集合，将响应式对象放进去</span>

        <span class="hljs-comment">//查找依赖实例的函数</span>
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDepend</span> = (<span class="hljs-params">obj,key</span>)=&gt;{
            <span class="hljs-keyword">let</span> target = targetMap.<span class="hljs-title function_">get</span>(obj)

            <span class="hljs-keyword">if</span>(!target){
                <span class="hljs-comment">//创建</span>
                <span class="hljs-keyword">const</span> propertyDependMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>() <span class="hljs-comment">//创建一张属性和对应依赖实例的对照表</span>
                targetMap.<span class="hljs-title function_">set</span>(obj,propertyDependMap) <span class="hljs-comment">//将对象和对应的属性和对应依赖实例的对照表关联，可以通过对象找到对照表</span>
                target = targetMap.<span class="hljs-title function_">get</span>(obj)
            }

            <span class="hljs-keyword">let</span> depend = target.<span class="hljs-title function_">get</span>(key)
            <span class="hljs-keyword">if</span>(!depend){
                <span class="hljs-comment">//创建</span>
                <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Depend</span>()
                target.<span class="hljs-title function_">set</span>(key,instance) <span class="hljs-comment">//将映射关系写好</span>
                depend = instance
            }

            <span class="hljs-keyword">return</span> depend
        }

        <span class="hljs-comment">//创建一个myReactive的函数，接收一个对象，进行对它的属性劫持</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">myReactive</span>(<span class="hljs-params">obj</span>){
            <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
                <span class="hljs-keyword">let</span> value = obj[key] <span class="hljs-comment">//获取对应属性的值，保留等下要用</span>

                <span class="hljs-comment">//加上属性劫持</span>
                <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj,key,{
                    get : <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
                        <span class="hljs-title function_">getDepend</span>(obj,key).<span class="hljs-title function_">gatherFns</span>(activeFn)
                        <span class="hljs-keyword">return</span> value
                    },
                    set : <span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>){
                        value = newValue
                        <span class="hljs-comment">//通知对应的实例执行所有依赖函数</span>
                        <span class="hljs-title function_">getDepend</span>(obj,key).<span class="hljs-title function_">dispatchFns</span>()
                    }
                })
            })
        }

        <span class="hljs-title function_">myReactive</span>(obj)
        <span class="hljs-title function_">addDependFn</span>(updateDom)
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a45a65bfae0547a8b389d312ef7481f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q6L5Yas6YaJ56a75q6H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763482454&amp;x-signature=LctjD%2BFN%2F1IXxBC0y8udQWCqX0Q%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">七、总结</h3>
<p>响应式其实就是3个重要的点</p>
<ol>
<li><strong>依赖收集</strong>：通过<code>Object.defineProperty</code>的getter拦截属性访问，收集当前正在执行的函数作为依赖</li>
<li><strong>依赖触发</strong>：通过setter拦截属性修改，自动通知所有依赖函数更新</li>
<li><strong>依赖管理</strong>：使用<code>Depend</code>类管理每个属性的依赖关系，使用<code>WeakMap</code>和<code>Map</code>建立对象-属性-依赖的映射关系</li>
</ol>
<blockquote>
<p>这个简易实现包含了Vue2响应式系统的核心思想，但是vue封装的更加复杂！这个只是我的个人总结，如果能帮到你的话，就更好啦！如果觉得写的好的话，可以给个一键三连哈哈哈哈哈哈哈哈</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 Props 响应式深度解析：从原理到最佳实践]]></title>    <link>https://juejin.cn/post/7571342319892987939</link>    <guid>https://juejin.cn/post/7571342319892987939</guid>    <pubDate>2025-11-12T00:07:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571342319892987939" data-draft-id="7571344319702384680" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 Props 响应式深度解析：从原理到最佳实践"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-12T00:07:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="木易士心"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 Props 响应式深度解析：从原理到最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    木易士心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:07:38.000Z" title="Wed Nov 12 2025 00:07:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>在 Vue 3 的响应式系统中，<code>props</code> 是实现组件间数据通信的核心机制。它既强大又微妙——看似简单，却蕴含着响应式系统的设计哲学。许多开发者误以为“只要传了值就会自动更新”，但真实场景远比这复杂。本文将带你深入理解 <code>props</code> 的响应式本质、边界行为，并提供可落地的最佳实践方案。</p>
<h2 data-id="heading-1">一、 Props 响应式本质：单向数据流的核心</h2>
<h3 data-id="heading-2">1.响应式原理剖析</h3>
<p>Vue 3 的 <code>props</code> 并非凭空具备响应能力，而是其底层响应式系统（基于 <code>Proxy</code> 和 <code>reactive</code>）的自然延伸。当父组件向子组件传递数据时，Vue 内部会将原始 props 对象包装成一个<strong>只读的响应式代理</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 内部简化逻辑示意</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createPropsProxy</span>(<span class="hljs-params">rawProps, instance</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(rawProps); <span class="hljs-comment">// 基于 reactive() 创建响应式代理</span>
}
</code></pre>
<blockquote>
<p><strong>关键洞察</strong>：<br/>
<code>props</code> 的响应式不是“魔法”，而是 Vue 响应式系统的标准行为。但与普通 <code>reactive</code> 对象不同，<strong>props 是只读的</strong>——这是为了强制遵守“单向数据流”原则，防止子组件意外修改父状态，从而避免难以追踪的数据污染。</p>
</blockquote>
<h3 data-id="heading-3">2. 响应式层级分析</h3>
<p>并非所有通过 <code>props</code> 传递的数据都具有相同的响应行为。理解其层级差异，是避免“为什么没更新？”这类问题的关键：</p>






























<table><thead><tr><th>数据层级</th><th>响应式表现</th><th>示例说明</th></tr></thead><tbody><tr><td>Prop 本身（基本类型）</td><td>引用变化时响应</td><td>父组件 <code>:count="refCount"</code>，当 <code>refCount.value</code> 改变，子组件自动更新</td></tr><tr><td>Prop 对象内部属性</td><td>深度响应式</td><td><code>user.name</code> 变化会触发更新，得益于 <code>reactive</code> 的递归代理</td></tr><tr><td>静态字面量</td><td>无响应式</td><td><code>title="静态标题"</code> 是常量，不会变化，自然无需响应</td></tr><tr><td>计算属性作为 prop</td><td>依赖变化时响应</td><td>父组件传入 <code>:value="computedValue"</code>，当 <code>computedValue</code> 依赖项变化，子组件同步更新</td></tr></tbody></table>
<blockquote>
<p><strong>实践提示</strong>：如果你发现子组件未随父组件更新，请首先确认：<strong>父组件传递的是响应式数据（如 <code>ref</code>/<code>reactive</code>），而非字面量或普通变量</strong>。</p>
</blockquote>
<h2 data-id="heading-4">二、 高级声明模式：类型安全与运行时保障</h2>
<p>现代 Vue 开发强调<strong>类型安全</strong>与<strong>运行时可靠性</strong>。合理声明 <code>props</code> 不仅能提升开发体验，还能在构建阶段捕获潜在错误。</p>
<h3 data-id="heading-5">1. 类型安全的 Props 声明（TypeScript）</h3>
<p>在 <code>&lt;script setup&gt;</code> 中结合 TypeScript 接口，可实现端到端的类型推导：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
interface User {
  id: number
  name: string
  email: string
}

interface Props {
  title: string
  count: number
  user: User
  tags?: string[]
  onAction?: (payload: any) =&gt; void
}

// withDefaults 提供默认值，同时保持类型推断
const props = withDefaults(defineProps&lt;Props&gt;(), {
  count: 0,
  tags: () =&gt; ['default'] // 注意：数组/对象需用工厂函数
})

// 此处 props.user.id 具备完整类型提示和检查
console.log(props.user.id)
&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>优势</strong>：</p>
<ul>
<li>编辑器智能提示</li>
<li>编译期类型校验</li>
<li>减少运行时错误</li>
</ul>
</blockquote>
<h3 data-id="heading-6">2. 运行时验证与 TypeScript 结合</h3>
<p>即使使用 TypeScript，某些业务逻辑仍需运行时验证（如枚举值、数据格式）：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { PropType } from 'vue'

const props = defineProps({
  user: {
    type: Object as PropType&lt;User&gt;,
    required: true,
    validator: (value: User) =&gt; {
      // 自定义验证规则：ID 必须为正，名称非空
      return value.id &gt; 0 &amp;&amp; value.name.length &gt; 0
    }
  },
  status: {
    type: String as PropType&lt;'pending' | 'success' | 'error'&gt;,
    default: 'pending'
  }
})
&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>注意</strong>：<br/>
<code>validator</code> 在生产环境会被 Tree-shaking 移除，因此<strong>不能依赖它做安全校验</strong>，仅用于开发调试。</p>
</blockquote>
<h2 data-id="heading-7">三、 响应式边界与性能优化</h2>
<p>随着应用复杂度提升，<code>props</code> 可能承载大型对象或高频更新数据。此时，盲目依赖默认响应式行为可能导致性能瓶颈。</p>
<h3 data-id="heading-8">1. 深度监听的开销与优化策略</h3>
<p>对大型嵌套对象使用 <code>{ deep: true }</code> 监听，会触发大量不必要的计算：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const props = defineProps({
  largeData: Object // 可能包含数千项的配置树
})

//  性能陷阱：任何嵌套字段变化都会触发回调
watch(props.largeData, (newVal) =&gt; {
  // ...
}, { deep: true })

//  优化方案1：精准监听关键路径
watch(() =&gt; props.largeData.criticalField, (newVal) =&gt; {
  // 仅当核心字段变化时处理
})

//  优化方案2：自定义比较逻辑（避免全量 diff）
watch(() =&gt; props.largeData, (newVal, oldVal) =&gt; {
  if (JSON.stringify(newVal.importantPart) !== JSON.stringify(oldVal.importantPart)) {
    handleImportantChange(newVal.importantPart)
  }
}, { deep: true })

//  优化方案3：防抖 + 批量处理
import { debounce } from 'lodash-es'
const debouncedHandler = debounce((data) =&gt; {
  updateExpensiveUI(data)
}, 300)

watch(() =&gt; props.largeData, debouncedHandler, { deep: true })
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-9">2. 不可变数据模式：降低响应式开销</h3>
<p>对于频繁整体替换的数据（如列表刷新），可采用<strong>不可变更新 + 浅层响应式</strong>策略：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const props = defineProps({
  items: Array // 大型列表，每次分页都整体替换
})

// 使用 shallowRef 避免 Vue 对每个 item 做深度代理
import { shallowRef, computed } from 'vue'
const itemsRef = shallowRef(props.items)

// 当 props.items 引用变化时，更新 shallowRef
watch(() =&gt; props.items, (newItems) =&gt; {
  itemsRef.value = newItems // 整体替换，无嵌套响应式开销
})

// 模板中通过 computed 安全访问
const processedItems = computed(() =&gt; 
  itemsRef.value.map(item =&gt; ({ ...item, processed: true }))
)
&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>适用场景</strong>：</p>
<ul>
<li>表格/列表数据</li>
<li>配置快照</li>
<li>一次性渲染内容</li>
</ul>
</blockquote>
<h2 data-id="heading-10">四、 高级响应式模式：解构、条件处理与组合逻辑</h2>
<h3 data-id="heading-11">1. 响应式 Props 解构：如何不丢失响应性？</h3>
<p>直接解构 <code>props</code> 会导致响应式连接断裂：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//  错误：user 成为普通值，不再响应</span>
<span class="hljs-keyword">const</span> { user } = props
</code></pre>
<p>正确做法有三种：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { toRefs, computed } from 'vue'

const props = defineProps({ user: Object, settings: Object })

//  方案1：toRefs 保持响应式引用
const { user, settings } = toRefs(props)

//  方案2：computed 派生（推荐用于模板展示）
const userName = computed(() =&gt; props.user.name)
const theme = computed(() =&gt; props.settings.theme)

//  方案3：选择性解构 + 默认值（TypeScript 友好）
const { user = defaultUser } = toRefs(props)
&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>何时用哪种？</strong></p>
<ul>
<li><code>toRefs</code>：需要在 <code>setup()</code> 中频繁访问多个属性</li>
<li><code>computed</code>：用于模板或派生逻辑，语义更清晰</li>
<li>直接 <code>props.xxx</code>：最简单场景，避免过度抽象</li>
</ul>
</blockquote>
<h3 data-id="heading-12">2. 条件响应式处理：应对 null/undefined</h3>
<p>现实项目中，<code>props</code> 常因异步加载而暂时为 <code>null</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const props = defineProps({
  data: [Object, null] // 允许 null
})

// 安全访问：避免 .xxx 报错
const safeData = computed(() =&gt; props.data ?? {})

// 条件监听：仅在有效数据到来时处理
watch(() =&gt; props.data, (newData) =&gt; {
  if (newData) {
    initializeComponent(newData)
  }
})

// 或使用 watchEffect 自动追踪依赖
watchEffect(() =&gt; {
  if (props.data?.id) {
    // 自动依赖 props.data，且仅在 id 存在时执行
    fetchRelatedData(props.data.id)
  }
})
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-13">五、 复杂数据流模式：跨层级通信与状态融合</h2>
<h3 data-id="heading-14">1.多层级组件通信：透传与中间处理</h3>
<p>在深层嵌套组件中，中间层组件常需“透传并增强” props：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 中间层组件 --&gt;
&lt;script setup&gt;
const props = defineProps({
  config: Object,
  state: Object
})

// 对透传的 config 添加中间层元信息
const processedConfig = computed(() =&gt; ({
  ...props.config,
  processedAt: Date.now(),
  version: 'v2'
}))

// 事件转发 + 校验
const emit = defineEmits(['update:state'])
const handleStateChange = (newState) =&gt; {
  const validated = validateState(newState)
  if (validated.isValid) {
    emit('update:state', validated.data)
  } else {
    console.warn('Invalid state update:', validated.errors)
  }
}
&lt;/script&gt;

&lt;template&gt;
  &lt;ChildComponent 
    :config="processedConfig"
    :state="state"
    @update:state="handleStateChange"
  /&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-15">2. 状态提升与本地状态融合</h3>
<p>有时需要将外部状态（props）与本地状态合并使用：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const props = defineProps({
  externalState: Object // 来自全局 store 或父组件
})

const localState = ref({ editing: false, draft: '' })

// 当外部状态重置时，清空本地草稿
watch(() =&gt; props.externalState, (newState) =&gt; {
  if (newState.shouldResetLocal) {
    localState.value = { editing: false, draft: '' }
  }
}, { deep: true })

// 合并状态供模板使用
const mergedState = computed(() =&gt; ({
  ...props.externalState,
  ...localState.value,
  isDirty: localState.value.draft !== props.externalState.content
}))
&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>设计思想</strong>：<br/>
将“受控”（来自 props）与“非受控”（本地状态）分离，再通过 <code>computed</code> 融合，是复杂表单、编辑器等场景的常见模式。</p>
</blockquote>
<h2 data-id="heading-16">六、 性能与调试技巧</h2>
<h3 data-id="heading-17">1.  响应式调试：看清依赖关系</h3>
<p>开发阶段可通过以下方式观察 props 的响应行为：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const props = defineProps({ complexData: Object })

// watchEffect 会打印每次访问的依赖
watchEffect(() =&gt; {
  console.log('[Debug] Accessing props:', {
    data: props.complexData,
    keys: Object.keys(props.complexData || {})
  })
})

// 获取组件实例，查看原始 props
import { getCurrentInstance, onMounted } from 'vue'
const instance = getCurrentInstance()
onMounted(() =&gt; {
  console.log('Raw props:', instance?.props)
})
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-18">2. 记忆化与缓存：避免重复计算</h3>
<p>对昂贵的派生计算，应使用缓存策略：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const props = defineProps({
  items: Array,
  filter: String
})

// 方案1：computed 自动缓存（推荐）
const filteredItems = computed(() =&gt; 
  props.items.filter(item =&gt; item.name.includes(props.filter))
)

// 方案2：手动缓存 + 精确依赖
const cachedResult = ref([])
watch([() =&gt; props.items, () =&gt; props.filter], 
  ([items, filter]) =&gt; {
    cachedResult.value = expensiveComputation(items, filter)
  }, 
  { immediate: true }
)
&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>经验法则</strong>：<br/>
优先使用 <code>computed</code>，除非你需要控制缓存策略（如 LRU、过期时间等）。</p>
</blockquote>
<h2 data-id="heading-19">七、 响应式 Props 模式总结</h2>
<h3 data-id="heading-20">1. 场景方案总结</h3>








































<table><thead><tr><th>场景</th><th>推荐模式</th><th>替代/补充方案</th></tr></thead><tbody><tr><td>基本类型传递</td><td>直接使用 <code>props.xxx</code></td><td><code>toRef(props, 'xxx')</code>（需解构时）</td></tr><tr><td>对象内部属性访问</td><td>默认深度响应式</td><td><code>watch(() =&gt; props.obj.field, ...)</code></td></tr><tr><td>大型数据集（列表/树）</td><td><code>shallowRef</code> + 整体替换</td><td>虚拟滚动 + 分页加载</td></tr><tr><td>高频更新（如拖拽坐标）</td><td>防抖 + 条件更新</td><td>使用 <code>requestAnimationFrame</code> 节流</td></tr><tr><td>类型安全需求</td><td>TypeScript 接口 + <code>withDefaults</code></td><td>运行时 <code>validator</code>（仅开发环境）</td></tr><tr><td>复杂转换逻辑</td><td><code>computed</code> 派生</td><td>自定义组合式函数（composables）</td></tr></tbody></table>
<h3 data-id="heading-21">2.使用建议</h3>
<ol>
<li><strong>声明明确</strong>：始终为 <code>props</code> 提供类型定义（TS）或运行时验证（JS）</li>
<li><strong>坚守单向流</strong>：通过 <code>emit</code> 向上通信，绝不直接修改 <code>props</code></li>
<li><strong>性能敏感</strong>：对大型/高频数据，评估是否需浅层响应式或手动控制</li>
<li><strong>防御性编程</strong>：处理 <code>null</code>/<code>undefined</code>，避免 <code>.xxx</code> 报错</li>
<li><strong>开发友好</strong>：在调试阶段添加 <code>watchEffect</code> 日志，理清依赖</li>
<li><strong>测试覆盖</strong>：编写单元测试，验证 <code>props</code> 变化时的组件行为</li>
</ol>
<h2 data-id="heading-22">八、 进阶学习路径</h2>
<p>要进一步掌握 Vue 3 响应式系统，建议深入以下方向：</p>
<ul>
<li><strong>源码阅读</strong>：研究 <code>reactive.ts</code>、<code>componentProps.ts</code> 实现</li>
<li><strong>自定义渲染器</strong>：了解 <code>props</code> 在非 DOM 环境（如小程序）中的处理</li>
<li><strong>SSR 序列化</strong>：理解服务端如何传递 <code>props</code> 到客户端</li>
<li><strong>DevTools 调试</strong>：使用 Vue DevTools 的 “Components” 面板实时观察 <code>props</code> 变化</li>
</ul>
<p>通过深入理解 <code>props</code> 的响应式机制，你不仅能避免常见陷阱，更能设计出高性能、高可维护性的组件架构。记住：<strong>响应式是工具，不是目的</strong>。合理使用，方能发挥 Vue 3 的最大威力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零实现一个低代码编辑器：揭秘可视化搭建的核心原理]]></title>    <link>https://juejin.cn/post/7571344319702433832</link>    <guid>https://juejin.cn/post/7571344319702433832</guid>    <pubDate>2025-11-12T00:15:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571344319702433832" data-draft-id="7568746602805166107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零实现一个低代码编辑器：揭秘可视化搭建的核心原理"/> <meta itemprop="keywords" content="前端,React.js,低代码"/> <meta itemprop="datePublished" content="2025-11-12T00:15:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FogLetter"/> <meta itemprop="url" content="https://juejin.cn/user/933907109778611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零实现一个低代码编辑器：揭秘可视化搭建的核心原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933907109778611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FogLetter
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:15:32.000Z" title="Wed Nov 12 2025 00:15:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：当编程遇上「拖拽」</h2>
<p>还记得第一次接触编程时的兴奋吗？在黑色的终端里输入几行神秘的代码，就能让计算机按照我们的意愿工作。但随着编程经验的增长，我们也会发现：很多重复性的页面开发工作，其实并不需要每次都从头开始写代码。</p>
<p>这就是低代码/零代码平台诞生的背景。作为一名开发者，我最初对这类平台是抱有怀疑态度的——「拖拽就能生成应用？肯定很鸡肋吧！」直到我真正深入使用并实现了一个低代码编辑器，才发现其中的技术内涵远比想象中丰富。</p>
<p>今天，就让我带你一起揭开低代码编辑器的神秘面纱，看看这看似简单的「拖拽」背后，到底藏着怎样的技术奥秘。</p>
<h2 data-id="heading-1">低代码与零代码：概念辨析</h2>
<h3 data-id="heading-2">什么是低代码/零代码？</h3>
<p><strong>低代码</strong>（Low-Code）和<strong>零代码</strong>（No-Code）都是通过可视化界面和配置化方式，减少或替代传统手写代码的应用开发方法。</p>
<ul>
<li><strong>低代码</strong>：主要面向开发者，提供可视化开发工具提升开发效率</li>
<li><strong>零代码</strong>：让非技术人员也能搭建简单应用，如表单、审批流程、数据看板等</li>
</ul>
<h3 data-id="heading-3">实际应用场景</h3>
<p>在一个企业内部管理系统项目中，开发者使用低代码平台快速搭建了：</p>
<ol>
<li><strong>员工请假审批流程</strong></li>
<li><strong>数据报表展示看板</strong></li>
<li><strong>客户信息管理表单</strong></li>
</ol>
<p>原本需要2周开发的功能，在低代码平台上只用了2天就完成了配置和测试，效率提升惊人！</p>
<h2 data-id="heading-4">低代码编辑器核心架构</h2>
<h3 data-id="heading-5">三大核心区域</h3>
<p>任何低代码编辑器都包含三个基本区域：</p>
<ol>
<li><strong>物料区域</strong>：提供可拖拽的组件</li>
<li><strong>编辑区域</strong>：组件组合和布局的区域</li>
<li><strong>属性设置区域</strong>：配置组件属性的面板</li>
</ol>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 编辑器布局组件示例</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Allotment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'allotment'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LowcodeEditor</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-[100vh] flex flex-col"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Allotment</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Allotment.Pane</span> <span class="hljs-attr">preferredSize</span>=<span class="hljs-string">{240}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Material</span> /&gt;</span> {/* 物料区域 */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Allotment.Pane</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Allotment.Pane</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">EditArea</span> /&gt;</span> {/* 编辑区域 */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Allotment.Pane</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Allotment.Pane</span> <span class="hljs-attr">preferredSize</span>=<span class="hljs-string">{300}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Setting</span> /&gt;</span> {/* 属性设置区域 */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Allotment.Pane</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Allotment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h3 data-id="heading-6">核心技术栈</h3>
<p>在实现低代码编辑器时，我们选择了以下技术栈：</p>
<ul>
<li><strong>React</strong> + <strong>TypeScript</strong>：组件化开发和类型安全</li>
<li><strong>react-dnd</strong>：实现拖拽功能</li>
<li><strong>allotment</strong>：可调整大小的分栏布局</li>
<li><strong>zustand</strong>：轻量级状态管理</li>
<li><strong>tailwindcss</strong>：原子化CSS样式</li>
</ul>
<h2 data-id="heading-7">实现细节深度解析</h2>
<h3 data-id="heading-8">状态管理：编辑器的「大脑」</h3>
<p>低代码编辑器的核心是一个表示组件树结构的状态管理。我们使用 zustand 来管理这个状态：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 组件数据结构定义</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Component</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;      <span class="hljs-comment">// 组件类型，如 'Button', 'Container'</span>
  <span class="hljs-attr">props</span>: <span class="hljs-built_in">any</span>;        <span class="hljs-comment">// 组件属性</span>
  children?: <span class="hljs-title class_">Component</span>[]; <span class="hljs-comment">// 子组件</span>
  parentId?: <span class="hljs-built_in">number</span>;     <span class="hljs-comment">// 父组件ID</span>
}

<span class="hljs-comment">// 状态管理store</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useComponentsStore = create&lt;<span class="hljs-title class_">State</span> &amp; <span class="hljs-title class_">Action</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> ({
  <span class="hljs-attr">components</span>: [
    {
      <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'Page'</span>,
      <span class="hljs-attr">props</span>: {},
      <span class="hljs-attr">desc</span>: <span class="hljs-string">'页面'</span>
    },
  ],
  <span class="hljs-comment">// 添加组件</span>
  <span class="hljs-attr">addComponent</span>: <span class="hljs-function">(<span class="hljs-params">component, parentId</span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (parentId) {
      <span class="hljs-comment">// 找到父组件并添加子组件</span>
      <span class="hljs-keyword">const</span> parentComponent = <span class="hljs-title function_">getComponentById</span>(parentId, state.<span class="hljs-property">components</span>);
      <span class="hljs-keyword">if</span> (parentComponent) {
        <span class="hljs-keyword">if</span> (parentComponent.<span class="hljs-property">children</span>) {
          parentComponent.<span class="hljs-property">children</span>.<span class="hljs-title function_">push</span>(component);
        } <span class="hljs-keyword">else</span> {
          parentComponent.<span class="hljs-property">children</span> = [component];
        }
      }
      component.<span class="hljs-property">parentId</span> = parentId;
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">components</span>: [...state.<span class="hljs-property">components</span>],
      }
    }
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">components</span>: [...state.<span class="hljs-property">components</span>, component],
    }
  }),
  <span class="hljs-comment">// 其他操作...</span>
}));
</code></pre>
<p>这个数据结构虽然简单，但却是整个编辑器的核心。它本质上是一棵树，通过 <code>parentId</code> 和 <code>children</code> 属性构建出完整的组件层级关系。</p>
<h3 data-id="heading-9">组件配置管理：编辑器的「组件库」</h3>
<p>为了让编辑器知道有哪些组件可用，我们需要一个组件配置管理系统：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentConfig</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">defaultProps</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;; <span class="hljs-comment">// 默认属性</span>
  <span class="hljs-attr">component</span>: <span class="hljs-built_in">any</span>; <span class="hljs-comment">// React组件</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useComponentConfigStore = create&lt;<span class="hljs-title class_">State</span> &amp; <span class="hljs-title class_">Actions</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">componentConfig</span>: {
    <span class="hljs-title class_">Container</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"Container"</span>,
      <span class="hljs-attr">defaultProps</span>: {},
      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Container</span>
    },
    <span class="hljs-title class_">Button</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"Button"</span>,
      <span class="hljs-attr">defaultProps</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"primary"</span>,
        <span class="hljs-attr">text</span>: <span class="hljs-string">"按钮"</span>,
      },
      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Button</span>
    },
    <span class="hljs-title class_">Page</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"Page"</span>,
      <span class="hljs-attr">defaultProps</span>: {},
      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Page</span>
    },
  },
  <span class="hljs-comment">// 注册新组件</span>
  <span class="hljs-attr">registerComponent</span>: <span class="hljs-function">(<span class="hljs-params">name, componentConfig</span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      ...state,
      <span class="hljs-attr">componentConfig</span>: {
        ...state.<span class="hljs-property">componentConfig</span>,
        [name]: componentConfig,
      }
    }
  }),
}));
</code></pre>
<h3 data-id="heading-10">拖拽实现：编辑器的「交互灵魂」</h3>
<p>拖拽功能是低代码编辑器最核心的交互方式。我们使用 <code>react-dnd</code> 来实现：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 物料项 - 可拖拽的组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MaterialItem</span>(<span class="hljs-params">props: MaterialItemProps</span>) {
  <span class="hljs-keyword">const</span> { name } = props;
  <span class="hljs-keyword">const</span> [_, drag] = <span class="hljs-title function_">useDrag</span>({
    <span class="hljs-attr">type</span>: name,
    <span class="hljs-attr">item</span>: {
      <span class="hljs-attr">type</span>: name,
    }
  });
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">{drag}</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">"border-dashed border-[1px] border-[#000] py-[8px] px-[10px] m-[10px] cursor-move inline-block"</span>
    &gt;</span>
      {name}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 放置区域hook</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useMaterialDrop</span>(<span class="hljs-params">accept: <span class="hljs-built_in">string</span>[], id: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> { addComponent } = <span class="hljs-title function_">useComponentsStore</span>();
  <span class="hljs-keyword">const</span> { componentConfig } = <span class="hljs-title function_">useComponentConfigStore</span>();
  
  <span class="hljs-keyword">const</span> [{ canDrop }, drop] = <span class="hljs-title function_">useDrop</span>(<span class="hljs-function">() =&gt;</span> ({
    accept,
    <span class="hljs-attr">drop</span>: <span class="hljs-function">(<span class="hljs-params">item: { <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span> }, monitor</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> didDrop = monitor.<span class="hljs-title function_">didDrop</span>();
      <span class="hljs-keyword">if</span> (didDrop) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 防止重复触发</span>
      
      <span class="hljs-keyword">const</span> props = componentConfig[item.<span class="hljs-property">type</span>].<span class="hljs-property">defaultProps</span>;
      <span class="hljs-title function_">addComponent</span>({
        <span class="hljs-attr">id</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>(),
        <span class="hljs-attr">name</span>: item.<span class="hljs-property">type</span>,
        props
      }, id);
    },
    <span class="hljs-attr">collect</span>: <span class="hljs-function">(<span class="hljs-params">monitor</span>) =&gt;</span> ({
      <span class="hljs-attr">canDrop</span>: monitor.<span class="hljs-title function_">canDrop</span>(),
    }),
  }));
  
  <span class="hljs-keyword">return</span> { canDrop, drop };
}
</code></pre>
<h3 data-id="heading-11">组件渲染：从数据到UI</h3>
<p>编辑区域需要将组件树数据渲染为实际的UI：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">EditArea</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { components } = <span class="hljs-title function_">useComponentsStore</span>();
  <span class="hljs-keyword">const</span> { componentConfig } = <span class="hljs-title function_">useComponentConfigStore</span>();

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderComponents</span>(<span class="hljs-params">components: Component[]</span>): <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span> {
    <span class="hljs-keyword">return</span> components.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">component: Component</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> config = componentConfig?.[component.<span class="hljs-property">name</span>];
      <span class="hljs-keyword">if</span> (!config?.<span class="hljs-property">component</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      
      <span class="hljs-comment">// 递归渲染子组件</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(
        config.<span class="hljs-property">component</span>,
        {
          <span class="hljs-attr">key</span>: component.<span class="hljs-property">id</span>,
          <span class="hljs-attr">id</span>: component.<span class="hljs-property">id</span>,
          ...config.<span class="hljs-property">defaultProps</span>,
          ...component.<span class="hljs-property">props</span>,
        },
        <span class="hljs-title function_">renderComponents</span>(component.<span class="hljs-property">children</span> || [])
      );
    })
  }

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>{renderComponents(components)}<span class="hljs-tag">&lt;/&gt;</span></span>;
}
</code></pre>
<h2 data-id="heading-12">实际组件示例</h2>
<h3 data-id="heading-13">基础容器组件</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> type { <span class="hljs-title class_">CommonComponentProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../interface"</span>;
<span class="hljs-keyword">import</span> { useMaterialDrop } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../hooks/useMaterialDrop'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Container</span> = (<span class="hljs-params">{ id, name, children }: CommonComponentProps</span>) =&gt; {
  <span class="hljs-comment">// 容器可以接受 Button 和 Container 类型的拖拽</span>
  <span class="hljs-keyword">const</span> { canDrop, drop } = <span class="hljs-title function_">useMaterialDrop</span>([<span class="hljs-string">'Button'</span>, <span class="hljs-string">'Container'</span>], id);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">{drop}</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">"border-[1px] border-[#000] min-h-[100px] p-[20px]"</span>
    &gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Container</span>;
</code></pre>
<h3 data-id="heading-14">按钮组件</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">AntdButton</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">ButtonType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"antd/es/button"</span>;

<span class="hljs-keyword">export</span> interface <span class="hljs-title class_">ButtonProps</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>;
  <span class="hljs-attr">text</span>: string;
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Button</span> = (<span class="hljs-params">{ type, text }: ButtonProps</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AntdButton</span> <span class="hljs-attr">type</span>=<span class="hljs-string">{type}</span>&gt;</span>{text}<span class="hljs-tag">&lt;/<span class="hljs-name">AntdButton</span>&gt;</span></span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Button</span>;
</code></pre>
<h2 data-id="heading-15">技术难点与解决方案</h2>
<h3 data-id="heading-16">问题：useDrop 重复触发</h3>
<p>在实现拖拽功能时，我们遇到了一个常见问题：当在嵌套的容器中拖拽组件时，<code>useDrop</code> 会被多次触发，导致同一个组件被重复添加。</p>
<p><strong>解决方案</strong>：通过 <code>monitor.didDrop()</code> 检查是否已经在子元素中处理了 drop 事件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">drop</span>: <span class="hljs-function">(<span class="hljs-params">item: { <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span> }, monitor</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> didDrop = monitor.<span class="hljs-title function_">didDrop</span>();
  <span class="hljs-keyword">if</span> (didDrop) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 如果已经在子元素处理过，则不再处理</span>
  
  <span class="hljs-comment">// 正常的添加组件逻辑...</span>
}
</code></pre>
<h3 data-id="heading-17">问题：组件树操作复杂性</h3>
<p>对组件树进行增删改查操作时，需要考虑嵌套结构带来的复杂性。</p>
<p><strong>解决方案</strong>：实现递归工具函数来处理组件树：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getComponentById</span>(<span class="hljs-params">
  id: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>,
  components: Component[]
</span>): <span class="hljs-title class_">Component</span> | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">if</span> (!id) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> component <span class="hljs-keyword">of</span> components) {
    <span class="hljs-keyword">if</span> (component.<span class="hljs-property">id</span> === id) <span class="hljs-keyword">return</span> component;
    
    <span class="hljs-keyword">if</span> (component.<span class="hljs-property">children</span> &amp;&amp; component.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> found = <span class="hljs-title function_">getComponentById</span>(id, component.<span class="hljs-property">children</span>);
      <span class="hljs-keyword">if</span> (found) <span class="hljs-keyword">return</span> found;
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h2 data-id="heading-18">低代码编辑器的价值思考</h2>
<h3 data-id="heading-19">对开发者的价值</h3>
<ol>
<li><strong>提升开发效率</strong>：重复性页面可以快速搭建</li>
<li><strong>降低维护成本</strong>：可视化配置比代码更直观易懂</li>
<li><strong>促进团队协作</strong>：产品、设计也能参与页面搭建</li>
</ol>
<h3 data-id="heading-20">对企业的价值</h3>
<ol>
<li><strong>降低技术门槛</strong>：业务人员也能搭建简单应用</li>
<li><strong>快速响应需求</strong>：业务变化时能快速调整</li>
<li><strong>成本控制</strong>：减少对高级开发人员的依赖</li>
</ol>
<h2 data-id="heading-21">扩展思路：让编辑器更强大</h2>
<p>基础的低代码编辑器实现后，我们可以考虑添加更多高级功能：</p>
<h3 data-id="heading-22">1. 撤销重做功能</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">HistoryState</span> {
  <span class="hljs-attr">past</span>: <span class="hljs-title class_">Component</span>[][];
  <span class="hljs-attr">present</span>: <span class="hljs-title class_">Component</span>[];
  <span class="hljs-attr">future</span>: <span class="hljs-title class_">Component</span>[][];
}

<span class="hljs-comment">// 在每次状态变更时记录历史</span>
</code></pre>
<h3 data-id="heading-23">2. 组件数据绑定</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 支持将组件属性绑定到数据源</span>
{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"bind"</span>,
  <span class="hljs-string">"value"</span>: <span class="hljs-string">"{{user.name}}"</span>
}
</code></pre>
<h3 data-id="heading-24">3. 条件渲染和循环渲染</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 支持根据条件显示/隐藏组件</span>
{
  <span class="hljs-string">"condition"</span>: <span class="hljs-string">"{{user.isAdmin}}"</span>,
  <span class="hljs-string">"component"</span>: <span class="hljs-string">"AdminPanel"</span>
}

<span class="hljs-comment">// 支持循环渲染</span>
{
  <span class="hljs-string">"loop"</span>: <span class="hljs-string">"{{userList}}"</span>,
  <span class="hljs-string">"component"</span>: <span class="hljs-string">"UserItem"</span>
}
</code></pre>
<h3 data-id="heading-25">4. 事件处理系统</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 配置按钮点击事件</span>
{
  <span class="hljs-string">"onClick"</span>: {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"navigate"</span>,
    <span class="hljs-string">"params"</span>: {
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"/detail"</span>
    }
  }
}
</code></pre>
<h2 data-id="heading-26">总结</h2>
<p>通过这个简单的低代码编辑器实现，我们可以看到：</p>
<ol>
<li><strong>低代码的核心是数据结构</strong>：一个精心设计的组件树结构是基础</li>
<li><strong>拖拽交互是关键体验</strong>：流畅的拖拽体验决定编辑器的易用性</li>
<li><strong>组件化思维是桥梁</strong>：将UI拆分为可配置的组件是实现可视化的前提</li>
<li><strong>扩展性是生命力</strong>：良好的架构设计让后续功能扩展成为可能</li>
</ol>
<p>低代码并不是要取代传统开发，而是为特定场景提供更高效的解决方案。作为开发者，理解低代码背后的原理，不仅能让我们更好地使用这类平台，还能在适当时机自己构建适合业务的可视化工具。</p>
<p>技术的本质不是堆砌复杂度，而是在理解原理的基础上做出恰当的简化。希望这篇笔记能帮助你理解低代码编辑器的核心原理，在可视化开发的道路上走得更远。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 全家桶深度探索：从语法精要到项目实战]]></title>    <link>https://juejin.cn/post/7571303808116801588</link>    <guid>https://juejin.cn/post/7571303808116801588</guid>    <pubDate>2025-11-12T00:24:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571303808116801588" data-draft-id="7568796644348280832" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 全家桶深度探索：从语法精要到项目实战"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-12T00:24:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FogLetter"/> <meta itemprop="url" content="https://juejin.cn/user/933907109778611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 全家桶深度探索：从语法精要到项目实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933907109778611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FogLetter
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:24:54.000Z" title="Wed Nov 12 2025 00:24:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在现代前端开发中，Vue.js 以其渐进式框架的特性和友好的学习曲线，赢得了大量开发者的青睐。今天，就让我们一起来深入探索 Vue 全家桶的魅力所在！</p>
</blockquote>
<h2 data-id="heading-0">一、Vue 与 React：理念的碰撞</h2>
<p>在开始 Vue 全家桶的深度探索之前，让我们先来理解 Vue 与 React 这对"欢喜冤家"的核心差异。</p>
<h3 data-id="heading-1">1.1 设计哲学对比</h3>
<p><strong>React</strong> 推崇函数式编程思想，强调不可变性和单向数据流。它的核心理念是：</p>
<ul>
<li>单向数据绑定：<code>数据 -&gt; 视图</code> + <code>事件 -&gt; 数据更新</code></li>
<li>一切都是 JavaScript：JSX 将标记与逻辑耦合</li>
<li>手动优化：需要开发者关注性能优化点</li>
</ul>
<p><strong>Vue</strong> 则更倾向于渐进式和响应式：</p>
<ul>
<li>双向数据绑定：<code>v-model</code> 指令简化表单处理</li>
<li>关注点分离：模板、逻辑、样式相对独立</li>
<li>自动优化：响应式系统自动处理依赖追踪</li>
</ul>
<h3 data-id="heading-2">1.2 代码风格对比</h3>
<p>让我们通过一个简单的计数器组件来感受两者的差异：</p>
<p><strong>React 实现：</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前计数: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;
        点击+1
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>Vue 实现：</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;当前计数: {{ count }}&lt;/p&gt;
    &lt;button @click="count++"&gt;
      点击+1
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue';

const count = ref(0);
&lt;/script&gt;
</code></pre>
<p>可以看到，Vue 的 <code>ref</code> 和模板语法让代码更加简洁直观。特别是 <code>@click="count++"</code> 这种直接修改的方式，体现了 Vue 响应式系统的便利性。</p>
<h2 data-id="heading-3">二、Vue 3 语法精要</h2>
<h3 data-id="heading-4">2.1 SFC：单文件组件的艺术</h3>
<p>Vue 的单文件组件（Single File Component）是我最喜欢的设计之一。它将一个组件的模板、逻辑和样式封装在单个 <code>.vue</code> 文件中：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 视图层 --&gt;
  &lt;div class="greeting"&gt;{{ message }}&lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
// 逻辑层
import { ref } from 'vue';

const message = ref('Hello Vue!');
&lt;/script&gt;

&lt;style scoped&gt;
/* 样式层 */
.greeting {
  color: #42b983;
  font-size: 1.5rem;
}
&lt;/style&gt;
</code></pre>
<p>这种组织方式让组件变得高度可维护，特别是 <code>&lt;style scoped&gt;</code> 中的样式作用域机制，完美解决了 CSS 污染问题。</p>
<h3 data-id="heading-5">2.2 模板语法：声明式渲染的魅力</h3>
<p>Vue 的模板语法既强大又直观：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 文本插值 --&gt;
    &lt;h1&gt;{{ title }}&lt;/h1&gt;
    
    &lt;!-- 属性绑定 --&gt;
    &lt;img :src="avatarUrl" :alt="userName"&gt;
    
    &lt;!-- 条件渲染 --&gt;
    &lt;div v-if="isVisible"&gt;你看得见我！&lt;/div&gt;
    &lt;div v-else&gt;现在看不见了&lt;/div&gt;
    
    &lt;!-- 列表渲染 --&gt;
    &lt;ul&gt;
      &lt;li v-for="item in items" :key="item.id"&gt;
        {{ item.name }}
      &lt;/li&gt;
    &lt;/ul&gt;
    
    &lt;!-- 双向绑定 --&gt;
    &lt;input v-model="searchText" placeholder="搜索..."&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-6">2.3 响应式系统：Vue 的灵魂</h3>
<p>Vue 3 的响应式系统基于 Proxy，提供了 <code>ref</code> 和 <code>reactive</code> 两种 API：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, reactive, computed, watch } from 'vue';

// 基本类型使用 ref
const count = ref(0);
const searchField = ref('');

// 对象类型可以使用 reactive
const user = reactive({
  name: '张三',
  age: 25,
  profile: {
    level: 'VIP'
  }
});

// 计算属性
const userInfo = computed(() =&gt; {
  return `${user.name} - ${user.age}岁`;
});

// 侦听器
watch(count, (newValue, oldValue) =&gt; {
  console.log(`计数从 ${oldValue} 变为 ${newValue}`);
});

// 方法
const increment = () =&gt; {
  count.value++;
};
&lt;/script&gt;
</code></pre>
<p><strong>响应式的重要提示：</strong></p>
<ul>
<li><code>ref</code> 创建的值在 JS 中访问需要使用 <code>.value</code></li>
<li><code>reactive</code> 创建的对象可以直接访问属性</li>
<li>模板中都不需要 <code>.value</code>，Vue 会自动解包</li>
</ul>
<h2 data-id="heading-7">三、Pinia：新一代状态管理</h2>
<p>Pinia 是 Vue 官方推荐的状态管理库，相比 Vuex，它更加简洁和类型安全。</p>
<h3 data-id="heading-8">3.1 Store 的定义与使用</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// store/homeStore.ts</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">HomeTopBarItem</span>, <span class="hljs-title class_">RecentlyViewedItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/home'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useHomeStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'home'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 状态定义</span>
  <span class="hljs-keyword">const</span> topBarState = ref&lt;<span class="hljs-title class_">HomeTopBarItem</span>[]&gt;([
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"游览&amp;体验"</span>,
      <span class="hljs-attr">icon</span>: <span class="hljs-string">'photo-o'</span>
    },
    <span class="hljs-comment">// ... 更多项</span>
  ]);
  
  <span class="hljs-keyword">const</span> recentlyViewedState = ref&lt;<span class="hljs-title class_">RecentlyViewedItem</span>[]&gt;([
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"曼谷 &amp; 芭达雅景点通票"</span>,
      <span class="hljs-attr">cover</span>: <span class="hljs-string">"https://example.com/image.jpg"</span>,
      <span class="hljs-attr">price</span>: <span class="hljs-number">173</span>,
    },
    <span class="hljs-comment">// ... 更多项</span>
  ]);

  <span class="hljs-comment">// Getter（计算属性）</span>
  <span class="hljs-keyword">const</span> expensiveItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> recentlyViewedState.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">price</span> &gt; <span class="hljs-number">100</span>);
  });

  <span class="hljs-comment">// Action（方法）</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addRecentlyViewed</span> = (<span class="hljs-params">item: RecentlyViewedItem</span>) =&gt; {
    recentlyViewedState.<span class="hljs-property">value</span>.<span class="hljs-title function_">unshift</span>(item);
    <span class="hljs-comment">// 保持最近浏览不超过10个</span>
    <span class="hljs-keyword">if</span> (recentlyViewedState.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">10</span>) {
      recentlyViewedState.<span class="hljs-property">value</span>.<span class="hljs-title function_">pop</span>();
    }
  };

  <span class="hljs-keyword">return</span> {
    topBarState,
    recentlyViewedState,
    expensiveItems,
    addRecentlyViewed
  };
});
</code></pre>
<h3 data-id="heading-9">3.2 在组件中使用 Store</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="home"&gt;
    &lt;van-search
      v-model="searchField"
      placeholder="请输入搜索关键词"
      show-action
      shape="round"
    &gt;
      &lt;template #action&gt;
        &lt;div class="text-white"&gt;
          &lt;van-icon name="shopping-cart-o" size="1.25rem" /&gt;
        &lt;/div&gt;
      &lt;/template&gt;
    &lt;/van-search&gt;
    
    &lt;section class="topbar flex justify-around mb-3"&gt;
      &lt;div 
        v-for="item in topBarState"
        :key="item.title"
        class="topbar-item"
      &gt;
        &lt;van-icon :name="item.icon" size="2rem" /&gt;
        &lt;span class="text-xs"&gt;{{ item.title }}&lt;/span&gt;
      &lt;/div&gt;
    &lt;/section&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { toRefs, ref, onMounted } from 'vue';
import { useHomeStore } from '@/store/homeStore';

const searchField = ref&lt;string&gt;('');
const homeStore = useHomeStore();

// 使用 toRefs 保持响应式
const { topBarState, recentlyViewedState } = toRefs(homeStore);

// 直接使用 action
const handleAddItem = () =&gt; {
  homeStore.addRecentlyViewed({
    title: "新景点",
    cover: "https://example.com/new.jpg",
    price: 200,
  });
};

onMounted(() =&gt; {
  // 组件挂载后可以执行初始化操作
  console.log('Home 组件已挂载');
});
&lt;/script&gt;
</code></pre>
<p><strong>为什么使用 <code>toRefs</code>？</strong></p>
<ul>
<li>当从 store 中解构状态时，使用 <code>toRefs</code> 可以保持响应式</li>
<li>否则直接解构会失去响应式连接</li>
</ul>
<h2 data-id="heading-10">四、路由管理：Vue Router 深度应用</h2>
<h3 data-id="heading-11">4.1 路由配置与类型安全</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// router/index.ts</span>
<span class="hljs-keyword">import</span> {
  createRouter,
  createWebHistory,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">RouteRecordRaw</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;

<span class="hljs-comment">// 使用 TypeScript 确保路由配置正确</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">rootRoutes</span>: <span class="hljs-title class_">RouteRecordRaw</span>[] = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/home'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/HomePage/HomePage.vue'</span>),
    <span class="hljs-attr">name</span>: <span class="hljs-string">'home'</span>,
    <span class="hljs-attr">meta</span>: {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'首页'</span>,
      <span class="hljs-attr">requiresAuth</span>: <span class="hljs-literal">false</span>
    }
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/account'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Account/Account.vue'</span>),
    <span class="hljs-attr">name</span>: <span class="hljs-string">'account'</span>,
    <span class="hljs-attr">meta</span>: {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'我的账户'</span>,
      <span class="hljs-attr">requiresAuth</span>: <span class="hljs-literal">true</span>
    }
  },
  <span class="hljs-comment">// ... 更多路由</span>
];

<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">RouteRecordRaw</span>[] = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/TheRoot.vue'</span>),
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/home'</span>,
    <span class="hljs-attr">children</span>: rootRoutes
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/:pathMatch(.*)*'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'NotFound'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/NotFound.vue'</span>)
  }
];

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  routes
});

<span class="hljs-comment">// 路由守卫</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> {
  <span class="hljs-comment">// 修改页面标题</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  }
  
  <span class="hljs-comment">// 身份验证检查</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">requiresAuth</span> &amp;&amp; !<span class="hljs-title function_">isLoggedIn</span>()) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-string">'login'</span> };
  }
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;
</code></pre>
<h3 data-id="heading-12">4.2 布局组件与路由视图</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- App.vue --&gt;
&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;router-view /&gt;
    &lt;TabBar v-if="showTabBar" /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed } from 'vue';
import { useRoute } from 'vue-router';
import TabBar from '@/views/layout/TabBar.vue';

const route = useRoute();

// 根据当前路由决定是否显示底部导航
const showTabBar = computed(() =&gt; {
  const hiddenRoutes = ['/login', '/register'];
  return !hiddenRoutes.includes(route.path);
});
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- TheRoot.vue --&gt;
&lt;template&gt;
  &lt;div class="root-layout"&gt;
    &lt;header v-if="showHeader" class="app-header"&gt;
      &lt;van-nav-bar
        :title="currentTitle"
        left-arrow
        @click-left="router.back()"
      /&gt;
    &lt;/header&gt;
    
    &lt;main class="app-main"&gt;
      &lt;router-view /&gt;
    &lt;/main&gt;
    
    &lt;footer class="app-footer"&gt;
      &lt;TabBar /&gt;
    &lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed } from 'vue';
import { useRoute, useRouter } from 'vue-router';

const route = useRoute();
const router = useRouter();

const currentTitle = computed(() =&gt; route.meta.title || '默认标题');
const showHeader = computed(() =&gt; !route.meta.hideHeader);
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-13">五、插槽系统：组件的灵活性之源</h2>
<p>Vue 的插槽系统让组件具备了极高的可定制性。</p>
<h3 data-id="heading-14">5.1 基础插槽使用</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- BaseCard.vue --&gt;
&lt;template&gt;
  &lt;div class="card"&gt;
    &lt;div class="card-header"&gt;
      &lt;!-- 具名插槽 --&gt;
      &lt;slot name="header"&gt;
        &lt;!-- 默认内容 --&gt;
        &lt;h3&gt;默认标题&lt;/h3&gt;
      &lt;/slot&gt;
    &lt;/div&gt;
    
    &lt;div class="card-body"&gt;
      &lt;!-- 默认插槽 --&gt;
      &lt;slot&gt;
        &lt;p&gt;默认内容&lt;/p&gt;
      &lt;/slot&gt;
    &lt;/div&gt;
    
    &lt;div class="card-actions"&gt;
      &lt;!-- 作用域插槽 --&gt;
      &lt;slot name="actions" :item="itemData" :isFavorite="isFavorite"&gt;
        &lt;button @click="handleDefaultAction"&gt;默认操作&lt;/button&gt;
      &lt;/slot&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-15">5.2 插槽的使用</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;BaseCard&gt;
    &lt;!-- 具名插槽使用 --&gt;
    &lt;template #header&gt;
      &lt;div class="custom-header"&gt;
        &lt;van-icon name="star" /&gt;
        &lt;h3&gt;自定义标题&lt;/h3&gt;
      &lt;/div&gt;
    &lt;/template&gt;
    
    &lt;!-- 默认插槽内容 --&gt;
    &lt;p&gt;这是卡片的主要内容...&lt;/p&gt;
    
    &lt;!-- 作用域插槽使用 --&gt;
    &lt;template #actions="{ item, isFavorite }"&gt;
      &lt;van-button 
        :type="isFavorite ? 'primary' : 'default'"
        @click="toggleFavorite(item)"
      &gt;
        {{ isFavorite ? '已收藏' : '收藏' }}
      &lt;/van-button&gt;
      &lt;van-button @click="viewDetail(item)"&gt;
        查看详情
      &lt;/van-button&gt;
    &lt;/template&gt;
  &lt;/BaseCard&gt;
&lt;/template&gt;
</code></pre>
<h2 data-id="heading-16">六、TypeScript：Vue 的完美搭档</h2>
<p>TypeScript 为 Vue 开发带来了类型安全和更好的开发体验。</p>
<h3 data-id="heading-17">6.1 类型定义</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types/home.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HomeTopBarItem</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">icon</span>: <span class="hljs-built_in">string</span>;
  badge?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 可选属性</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RecentlyViewedItem</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">cover</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;
  originalPrice?: <span class="hljs-built_in">number</span>;
  rating?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 泛型响应类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {
  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">data</span>: T;
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 组件 Props 类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RecentlyViewedProps</span> {
  <span class="hljs-attr">items</span>: <span class="hljs-title class_">RecentlyViewedItem</span>[];
  maxDisplay?: <span class="hljs-built_in">number</span>;
  showPrice?: <span class="hljs-built_in">boolean</span>;
}
</code></pre>
<h3 data-id="heading-18">6.2 组合式函数与类型</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// composables/useApi.ts</span>
<span class="hljs-keyword">import</span> { ref, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Ref</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { request } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/request'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> useApi&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Ref</span>&lt;T | <span class="hljs-literal">null</span>&gt; = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> error = ref&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt; {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
    error.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> request&lt;T&gt;({
        url,
        <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
        params
      });
      data.<span class="hljs-property">value</span> = response.<span class="hljs-property">data</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      error.<span class="hljs-property">value</span> = err <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? err.<span class="hljs-property">message</span> : <span class="hljs-string">'未知错误'</span>;
    } <span class="hljs-keyword">finally</span> {
      loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    }
  };
  
  <span class="hljs-keyword">return</span> {
    data,
    loading,
    error,
    fetchData
  };
}
</code></pre>
<h2 data-id="heading-19">七、工具链与工程化</h2>
<h3 data-id="heading-20">7.1 Vite 配置优化</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VantResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vant/auto-import-resolver'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title class_">Components</span>({
      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">VantResolver</span>()],
      <span class="hljs-attr">dts</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 生成类型声明文件</span>
    }),
  ],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
    },
  },
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-string">'/api'</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:3000'</span>,
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>),
      },
    },
  },
});
</code></pre>
<h3 data-id="heading-21">7.2 请求封装与拦截器</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/request.ts</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  <span class="hljs-title class_">AxiosRequestConfig</span>, 
  <span class="hljs-title class_">AxiosResponse</span>,
  <span class="hljs-title class_">AxiosError</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> { showToast } <span class="hljs-keyword">from</span> <span class="hljs-string">'vant'</span>;

<span class="hljs-keyword">const</span> instance = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_BASE_URL</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1000</span>,
  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>,
});

<span class="hljs-comment">// 请求拦截器</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-comment">// 添加认证 token</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>);
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 响应拦截器</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> response;
  },
  <span class="hljs-function">(<span class="hljs-params">error: AxiosError</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> status = error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span>;
    
    <span class="hljs-keyword">switch</span> (status) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
        <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'请先登录'</span>);
        <span class="hljs-comment">// 跳转到登录页</span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">403</span>:
        <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'没有权限'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">500</span>:
        <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'服务器错误'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-attr">default</span>:
        <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'网络错误'</span>);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 泛型请求函数</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> request = &lt;T = <span class="hljs-built_in">any</span>&gt;(
  <span class="hljs-attr">config</span>: <span class="hljs-title class_">AxiosRequestConfig</span>
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AxiosResponse</span>&lt;T&gt;&gt; =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">instance</span>(config);
};

<span class="hljs-comment">// 具体的 API 请求</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> api = {
  <span class="hljs-attr">get</span>: &lt;T = <span class="hljs-built_in">any</span>&gt;<span class="hljs-function">(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, params?: <span class="hljs-built_in">any</span></span>) =&gt;</span> 
    request&lt;T&gt;({ <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>, url, params }),
  
  <span class="hljs-attr">post</span>: &lt;T = <span class="hljs-built_in">any</span>&gt;<span class="hljs-function">(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, data?: <span class="hljs-built_in">any</span></span>) =&gt;</span>
    request&lt;T&gt;({ <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, url, data }),
    
  <span class="hljs-attr">put</span>: &lt;T = <span class="hljs-built_in">any</span>&gt;<span class="hljs-function">(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, data?: <span class="hljs-built_in">any</span></span>) =&gt;</span>
    request&lt;T&gt;({ <span class="hljs-attr">method</span>: <span class="hljs-string">'PUT'</span>, url, data }),
    
  <span class="hljs-attr">delete</span>: &lt;T = <span class="hljs-built_in">any</span>&gt;<span class="hljs-function">(<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>) =&gt;</span>
    request&lt;T&gt;({ <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>, url }),
};
</code></pre>
<h2 data-id="heading-22">八、样式与 Tailwind CSS</h2>
<h3 data-id="heading-23">8.1 原子化 CSS 的优势</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="home"&gt;
    &lt;!-- 渐变背景 --&gt;
    &lt;div class="top-bg absolute h-36 -z-10 w-screen 
                bg-gradient-to-b from-orange-500 to-white"&gt;
    &lt;/div&gt;
    
    &lt;!-- 搜索框 --&gt;
    &lt;van-search
      class="mb-2 mx-4 rounded-lg shadow-sm"
      background="transparent"
    /&gt;
    
    &lt;!-- 内容区域 --&gt;
    &lt;main class="flex flex-col space-y-4 px-4"&gt;
      &lt;header class="w-[calc(100vw-2rem)] min-h-24 
                     bg-white rounded-2xl p-4 shadow-md 
                     self-center transition-all 
                     hover:shadow-lg"&gt;
        &lt;!-- 响应式设计 --&gt;
        &lt;section class="topbar flex justify-around 
                        flex-wrap gap-4 mb-4 
                        md:flex-nowrap md:gap-0"&gt;
          &lt;div 
            v-for="item in topBarState"
            :key="item.title"
            class="topbar-item flex flex-col items-center 
                   cursor-pointer transition-transform 
                   hover:scale-105 min-w-[60px]"
          &gt;
            &lt;div class="topbar-item__icon mb-1"&gt;
              &lt;van-icon :name="item.icon" 
                        class="text-2xl text-orange-500" /&gt;
            &lt;/div&gt;
            &lt;div class="topbar-item__text text-xs 
                        text-gray-600 font-medium"&gt;
              {{ item.title }}
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/section&gt;
      &lt;/header&gt;
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-24">8.2 自定义样式与 Tailwind 结合</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* style.css */</span>
<span class="hljs-keyword">@tailwind</span> base;
<span class="hljs-keyword">@tailwind</span> components;
<span class="hljs-keyword">@tailwind</span> utilities;

<span class="hljs-comment">/* 自定义组件样式 */</span>
<span class="hljs-keyword">@layer</span> components {
  <span class="hljs-selector-class">.btn-primary</span> {
    <span class="hljs-keyword">@apply</span> bg-orange-<span class="hljs-number">500</span> text-white px-<span class="hljs-number">4</span> py-<span class="hljs-number">2</span> 
           rounded-lg <span class="hljs-attribute">hover</span>:bg-orange-<span class="hljs-number">600</span> 
           transition-colors <span class="hljs-attribute">focus</span>:outline-none 
           <span class="hljs-attribute">focus</span>:ring-<span class="hljs-number">2</span> <span class="hljs-attribute">focus</span>:ring-orange-<span class="hljs-number">300</span> 
           <span class="hljs-attribute">disabled</span>:opacity-<span class="hljs-number">50</span> <span class="hljs-attribute">disabled</span>:cursor-not-allowed;
  }
  
  <span class="hljs-selector-class">.card</span> {
    <span class="hljs-keyword">@apply</span> bg-white rounded-xl shadow-sm 
           border border-gray-<span class="hljs-number">100</span> 
           <span class="hljs-attribute">hover</span>:shadow-md transition-shadow;
  }
}

<span class="hljs-comment">/* 自定义工具类 */</span>
<span class="hljs-keyword">@layer</span> utilities {
  <span class="hljs-selector-class">.text-shadow</span> {
    <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
  }
  
  <span class="hljs-selector-class">.scrollbar-hide</span> {
    -ms-<span class="hljs-attribute">overflow</span>-style: none;
    <span class="hljs-attribute">scrollbar-width</span>: none;
  }
  
  <span class="hljs-selector-class">.scrollbar-hide</span>::-webkit-scrollbar {
    <span class="hljs-attribute">display</span>: none;
  }
}
</code></pre>
<h2 data-id="heading-25">九、项目架构最佳实践</h2>
<h3 data-id="heading-26">9.1 目录结构设计</h3>
<pre><code class="hljs language-bash" lang="bash">src/
├── assets/          <span class="hljs-comment"># 静态资源</span>
│   ├── images/
│   └── styles/
├── components/      <span class="hljs-comment"># 通用组件</span>
│   ├── ui/         <span class="hljs-comment"># 基础UI组件</span>
│   └── business/   <span class="hljs-comment"># 业务组件</span>
├── views/          <span class="hljs-comment"># 页面组件</span>
├── store/          <span class="hljs-comment"># 状态管理</span>
│   ├── modules/    <span class="hljs-comment"># 模块化store</span>
│   └── index.ts
├── router/         <span class="hljs-comment"># 路由配置</span>
├── utils/          <span class="hljs-comment"># 工具函数</span>
│   ├── request.ts
│   └── helpers.ts
├── types/          <span class="hljs-comment"># 类型定义</span>
├── composables/    <span class="hljs-comment"># 组合式函数</span>
├── api/            <span class="hljs-comment"># API接口</span>
└── main.ts
</code></pre>
<h3 data-id="heading-27">9.2 组件设计原则</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 好的组件设计示例 --&gt;
&lt;template&gt;
  &lt;ProductCard
    :product="product"
    :show-price="true"
    :favorite="isFavorite"
    @favorite-toggle="handleFavoriteToggle"
    @click="handleCardClick"
  &gt;
    &lt;template #badge&gt;
      &lt;van-tag v-if="product.isNew" type="primary"&gt;
        新品
      &lt;/van-tag&gt;
    &lt;/template&gt;
    
    &lt;template #actions&gt;
      &lt;van-button 
        size="small" 
        type="primary"
        @click.stop="handleBuy"
      &gt;
        立即购买
      &lt;/van-button&gt;
    &lt;/template&gt;
  &lt;/ProductCard&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
// 明确的 Props 定义
interface Props {
  product: Product;
  showPrice?: boolean;
  favorite?: boolean;
}

const props = withDefaults(defineProps&lt;Props&gt;(), {
  showPrice: true,
  favorite: false
});

// 明确的事件定义
const emit = defineEmits&lt;{
  'favorite-toggle': [id: string, value: boolean];
  click: [product: Product];
}&gt;();

// 组合式函数复用
const { toggleFavorite } = useFavorite();
const { addToCart } = useCart();

const handleFavoriteToggle = async () =&gt; {
  const newValue = !props.favorite;
  await toggleFavorite(props.product.id, newValue);
  emit('favorite-toggle', props.product.id, newValue);
};

const handleCardClick = () =&gt; {
  emit('click', props.product);
};
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-28">十、性能优化与最佳实践</h2>
<h3 data-id="heading-29">10.1 组件性能优化</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 虚拟滚动优化长列表 --&gt;
  &lt;RecycleScroller
    :items="largeList"
    :item-size="80"
    key-field="id"
    v-slot="{ item }"
    class="h-96"
  &gt;
    &lt;ProductItem :item="item" /&gt;
  &lt;/RecycleScroller&gt;
  
  &lt;!-- 图片懒加载 --&gt;
  &lt;img
    v-for="image in images"
    :key="image.id"
    v-lazy="image.url"
    class="product-image"
    alt="产品图片"
  /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed, watchEffect, shallowRef } from 'vue';

// 使用 shallowRef 避免深度响应式
const largeList = shallowRef([]);

// 计算属性缓存
const filteredList = computed(() =&gt; {
  return largeList.value.filter(item =&gt; 
    item.price &gt; 0 &amp;&amp; item.stock &gt; 0
  );
});

// 监听优化
watchEffect(() =&gt; {
  // 只有当依赖变化时才执行
  if (filteredList.value.length &gt; 0) {
    updateStatistics(filteredList.value);
  }
});

// 函数记忆化
const expensiveCalculation = computed(() =&gt; {
  return heavyCalculation(filteredList.value);
});
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-30">10.2 打包优化</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">manualChunks</span>: {
          <span class="hljs-string">'vue-vendor'</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'vue-router'</span>, <span class="hljs-string">'pinia'</span>],
          <span class="hljs-string">'ui-library'</span>: [<span class="hljs-string">'vant'</span>],
          <span class="hljs-string">'utils'</span>: [<span class="hljs-string">'axios'</span>, <span class="hljs-string">'dayjs'</span>, <span class="hljs-string">'lodash-es'</span>]
        }
      }
    },
    <span class="hljs-attr">chunkSizeWarningLimit</span>: <span class="hljs-number">1000</span>
  }
});
</code></pre>
<h2 data-id="heading-31">总结</h2>
<p>Vue 全家桶提供了一个完整、优雅的前端解决方案。从响应式系统到状态管理，从路由控制到构建工具，每一个环节都体现了 Vue 团队对开发者体验的深度思考。</p>
<p><strong>Vue 的核心优势：</strong></p>
<ol>
<li><strong>渐进式</strong>：可以根据项目需求逐步采用</li>
<li><strong>响应式</strong>：自动的依赖追踪和更新</li>
<li><strong>组合式</strong>：优秀的逻辑复用能力</li>
<li><strong>类型友好</strong>：与 TypeScript 完美结合</li>
<li><strong>生态丰富</strong>：完整的工具链和组件库</li>
</ol>
<p>无论是初创项目还是大型企业应用，Vue 全家桶都能提供出色的开发体验和运行性能。希望这篇笔记能帮助你更好地理解和运用 Vue 全家桶，在开发路上越走越远！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 从入门到精通：深入 Navigator 2.0 - GoRouter 路由完全指南]]></title>    <link>https://juejin.cn/post/7571316028321595427</link>    <guid>https://juejin.cn/post/7571316028321595427</guid>    <pubDate>2025-11-12T00:31:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571316028321595427" data-draft-id="7571342319893037091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 从入门到精通：深入 Navigator 2.0 - GoRouter 路由完全指南"/> <meta itemprop="keywords" content="Flutter,iOS,Android"/> <meta itemprop="datePublished" content="2025-11-12T00:31:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Zuckjet_"/> <meta itemprop="url" content="https://juejin.cn/user/3200023607119418"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 从入门到精通：深入 Navigator 2.0 - GoRouter 路由完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3200023607119418/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Zuckjet_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:31:09.000Z" title="Wed Nov 12 2025 00:31:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇关于导航的文章中，我们学习了 <code>Navigator 1.0</code>，也就是大家所熟知的 <code>push</code> 和 <code>pop</code> 方法。对于简单的线性页面流，它工作得非常好。但随着应用变得越来越复杂，<code>Navigator 1.0</code> 的局限性也逐渐显现。</p>
<p>想象以下场景：</p>
<ul>
<li><strong>深度链接 (Deep Linking)</strong>：用户点击一个 <code>URL</code> (<code>myapp://details/123</code>)，需要直接打开应用的特定页面。</li>
<li><strong>Web 应用支持</strong>：在 <code>Flutter Web</code> 中，你需要同步浏览器的地址栏和历史记录（前进/后退按钮）。</li>
<li><strong>复杂嵌套导航</strong>：应用拥有底部导航栏，每个标签页都维护着自己的导航堆栈。</li>
</ul>
<p>用 <code>Navigator 1.0</code> (命令式路由) 来处理这些需求，会变得异常棘手和混乱。</p>
<p>为了解决这些问题，<code>Flutter</code> 团队引入了 <code>Navigator 2.0</code> (声明式路由)。但不得不承认，<code>Navigator 2.0</code> 的原生 <code>API</code>（如 <code>Router</code>, <code>RouterDelegate</code>, <code>RouteInformationParser</code>）非常复杂，学习曲线陡峭，劝退了大量开发者。</p>
<p>幸运的是，我们不必直接和这些复杂的 <code>API</code> 打交道。<code>Flutter</code> 官方团队推出了 <code>GoRouter</code>，一个构建在 <code>Navigator 2.0</code> 之上的、强大且简单易用的路由库。它完美地简化了声明式路由，并成为当前 <code>Flutter</code> 路由管理的首选方案。</p>
<p>这篇文章，就是你掌握 <code>GoRouter</code> 的完全指南。</p>
<h4 data-id="heading-0">1. 为什么选择 GoRouter？</h4>
<ul>
<li><strong>基于 URL</strong>：以我们熟悉的 <code>URL</code> 字符串来定义和导航页面，直观且易于管理。</li>
<li><strong>声明式</strong>：你只需要定义好路由表，<code>GoRouter</code> 会自动处理底层的 <code>Navigator 2.0</code> 逻辑。</li>
<li><strong>完美支持 Web</strong>：自动处理浏览器地址栏同步和历史记录。</li>
<li><strong>类型安全</strong>：新版本支持类型安全地传递参数，减少运行时错误。</li>
<li><strong>轻松处理复杂场景</strong>：无论是参数传递、嵌套路由、还是路由重定向（如登录拦截），都提供了优雅的解决方案。</li>
</ul>
<h4 data-id="heading-1">2. GoRouter 实战演练</h4>
<p>让我们从一个简单的项目开始，一步步探索 <code>GoRouter</code> 的核心功能。</p>
<h5 data-id="heading-2">第一步：添加依赖</h5>
<p>首先，在你的 <code>pubspec.yaml</code> 文件中添加 <code>go_router</code> 依赖。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">flutter:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
  <span class="hljs-attr">go_router:</span> <span class="hljs-string">^14.1.0</span> <span class="hljs-comment"># 建议使用最新版本</span>
</code></pre>
<p>然后运行 <code>flutter pub get</code> 安装。</p>
<h5 data-id="heading-3">第二步：创建基础路由配置</h5>
<p>创建一个单独的文件来管理路由，例如 <code>lib/router/app_router.dart</code>。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:go_router/go_router.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-comment">// 导入你的页面 Widget</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'../screens/home_screen.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'../screens/details_screen.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'../screens/not_found_screen.dart'</span>;

<span class="hljs-keyword">final</span> GoRouter router = GoRouter(
  <span class="hljs-comment">// 404 页面</span>
  errorBuilder: (context, state) =&gt; <span class="hljs-keyword">const</span> NotFoundScreen(),

  <span class="hljs-comment">// 路由配置</span>
  routes: [
    GoRoute(
      path: <span class="hljs-string">'/'</span>,
      builder: (context, state) =&gt; <span class="hljs-keyword">const</span> HomeScreen(),
    ),
    GoRoute(
      path: <span class="hljs-string">'/details'</span>,
      builder: (context, state) =&gt; <span class="hljs-keyword">const</span> DetailsScreen(),
    ),
  ],
);
</code></pre>
<ul>
<li><code>GoRouter(...)</code>：这是路由配置的入口。</li>
<li><code>errorBuilder</code>：当用户访问一个不存在的路径时，会显示这个页面。</li>
<li><code>routes</code>: 一个 <code>GoRoute</code> 列表，定义了应用的每个页面。
<ul>
<li><code>path</code>: 页面的访问路径 (URL)。</li>
<li><code>builder</code>: 一个函数，返回对应路径的 <code>Widget</code>。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-4">第三步：集成到 MaterialApp</h5>
<p>现在，回到你的 <code>main.dart</code>，使用 <code>MaterialApp.router</code> 来集成 <code>GoRouter</code>。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'router/app_router.dart'</span>; <span class="hljs-comment">// 导入你的路由配置</span>

<span class="hljs-keyword">void</span> main() {
  runApp(<span class="hljs-keyword">const</span> MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> MyApp({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-comment">// 使用 MaterialApp.router 构造函数</span>
    <span class="hljs-keyword">return</span> MaterialApp.router(
      title: <span class="hljs-string">'GoRouter Demo'</span>,
      <span class="hljs-comment">// 将我们创建的 router 对象配置给 routerConfig</span>
      routerConfig: router,
    );
  }
}
</code></pre>
<p>至此，你的应用已经由 <code>GoRouter</code> 全权接管路由了！</p>
<h5 data-id="heading-5">第四步：页面跳转 (Navigation)</h5>
<p><code>GoRouter</code> 提供了一组 <code>BuildContext</code> 的扩展方法来进行导航，非常方便。</p>
<p>在你的 <code>HomeScreen</code> 中：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// home_screen.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:go_router/go_router.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> HomeScreen({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Home Screen'</span>)),
      body: Center(
        child: ElevatedButton(
          onPressed: () {
            <span class="hljs-comment">// 跳转到 /details 页面</span>
            context.go(<span class="hljs-string">'/details'</span>);
          },
          child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Go to Details'</span>),
        ),
      ),
    );
  }
}
</code></pre>
<ul>
<li><code>context.go(path)</code>：跳转到新页面，它会<strong>替换</strong>当前的路由堆栈。这更适用于 <code>Web</code> 行为或主标签页切换。</li>
<li><code>context.push(path)</code>：将新页面<strong>推入</strong>到当前的路由堆栈之上，这和 <code>Navigator.push</code> 行为一致，通常用于从列表页进入详情页。</li>
</ul>
<p>在详情页，我们可以使用 <code>context.pop()</code> 返回：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// details_screen.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:go_router/go_router.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DetailsScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> DetailsScreen({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Details Screen'</span>)),
      body: Center(
        child: ElevatedButton(
          onPressed: () {
            <span class="hljs-comment">// 返回上一页</span>
            context.pop();
          },
          child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Go Back'</span>),
        ),
      ),
    );
  }
}
</code></pre>
<h5 data-id="heading-6">第五步：传递参数</h5>
<p>这是 <code>GoRouter</code> 的强项。我们有三种常见的传参方式：</p>
<p><strong>1. 路径参数 (Path Parameters)</strong></p>
<p>这适用于传递简单的 <code>ID</code> 或标识符。</p>
<p>修改路由配置，在 <code>path</code> 中使用冒号 (<code>:</code>) 定义参数：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// app_router.dart</span>
GoRoute(
  <span class="hljs-comment">// :id 是一个占位符，匹配 /details/任意字符串</span>
  path: <span class="hljs-string">'/details/:id'</span>, 
  builder: (context, state) {
    <span class="hljs-comment">// 通过 state.pathParameters 获取路径参数</span>
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id = state.pathParameters[<span class="hljs-string">'id'</span>] ?? <span class="hljs-string">'0'</span>;
    <span class="hljs-keyword">return</span> DetailsScreen(id: id);
  },
),
</code></pre>
<p>修改 <code>DetailsScreen</code> 以接收参数：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// details_screen.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DetailsScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">const</span> DetailsScreen({<span class="hljs-keyword">super</span>.key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Details Screen'</span>)),
      body: Center(
        child: Text(<span class="hljs-string">'You are viewing details for item: <span class="hljs-subst">$id</span>'</span>),
      ),
      <span class="hljs-comment">// ...</span>
    );
  }
}
</code></pre>
<p>跳转时，直接在路径中提供参数值：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// home_screen.dart</span>
context.push(<span class="hljs-string">'/details/123'</span>); <span class="hljs-comment">// 跳转到详情页，并传递 id '123'</span>
</code></pre>
<p><strong>2. 查询参数 (Query Parameters)</strong></p>
<p>适用于传递过滤、搜索等非必需参数。</p>
<p>路由配置不需要改变。跳转时，像写 <code>URL</code> 一样附加参数：</p>
<pre><code class="hljs language-dart" lang="dart">context.push(<span class="hljs-string">'/details/123?source=homepage&amp;sort=asc'</span>);
</code></pre>
<p>在 <code>DetailsScreen</code> 中，通过 <code>state.uri.queryParameters</code> 获取：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// details_screen.dart builder function</span>
builder: (context, state) {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id = state.pathParameters[<span class="hljs-string">'id'</span>] ?? <span class="hljs-string">'0'</span>;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> source = state.uri.queryParameters[<span class="hljs-string">'source'</span>]; <span class="hljs-comment">// "homepage"</span>
  <span class="hljs-keyword">return</span> DetailsScreen(id: id, source: source);
}
</code></pre>
<p><strong>3. extra 参数</strong></p>
<p>当你想传递一个复杂的自定义对象（如 <code>Model</code> 实例）时，<code>extra</code> 参数是最好的选择。</p>
<p>跳转时，在 <code>push</code> 或 <code>go</code> 方法中传入 <code>extra</code>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 假设你有一个 Product 类</span>
<span class="hljs-keyword">final</span> product = Product(id: <span class="hljs-string">'123'</span>, name: <span class="hljs-string">'Flutter Book'</span>);
context.push(<span class="hljs-string">'/details/123'</span>, extra: product);
</code></pre>
<p>在 <code>DetailsScreen</code> 的 <code>builder</code> 中接收它：</p>
<pre><code class="hljs language-dart" lang="dart">builder: (context, state) {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id = state.pathParameters[<span class="hljs-string">'id'</span>]!;
  <span class="hljs-comment">// state.extra 是 Object? 类型，需要进行类型转换</span>
  <span class="hljs-keyword">final</span> Product? product = state.extra <span class="hljs-keyword">as</span> Product?; 
  <span class="hljs-keyword">return</span> DetailsScreen(id: id, product: product);
}
</code></pre>
<h5 data-id="heading-7">第六步：嵌套路由 (Nested Navigation)</h5>
<p><code>GoRouter</code> 让实现带底部导航栏的复杂布局变得非常简单。我们将使用 <code>StatefulShellRoute.indexedStack</code>。</p>
<p>想象一个应用有三个主页面：<code>Home</code>, <code>Feed</code>, <code>Settings</code>。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// app_router.dart</span>
<span class="hljs-comment">// 1. 定义一个 shell widget，它包含 BottomNavigationBar 和用于显示子页面的 body</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'../screens/scaffold_with_nav_bar.dart'</span>; 

<span class="hljs-keyword">final</span> GoRouter router = GoRouter(
  initialLocation: <span class="hljs-string">'/home'</span>, <span class="hljs-comment">// 初始页面</span>
  routes: [
    <span class="hljs-comment">// 2. 使用 StatefulShellRoute.indexedStack 定义嵌套路由</span>
    StatefulShellRoute.indexedStack(
      builder: (context, state, navigationShell) {
        <span class="hljs-comment">// 返回你的 Shell UI (例如，一个带 BottomNavigationBar的 Scaffold)</span>
        <span class="hljs-keyword">return</span> ScaffoldWithNavBar(navigationShell: navigationShell);
      },
      branches: [
        <span class="hljs-comment">// 第一个分支 (tab)</span>
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: <span class="hljs-string">'/home'</span>,
              builder: (context, state) =&gt; <span class="hljs-keyword">const</span> HomeScreen(),
            ),
          ],
        ),
        <span class="hljs-comment">// 第二个分支</span>
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: <span class="hljs-string">'/feed'</span>,
              builder: (context, state) =&gt; <span class="hljs-keyword">const</span> FeedScreen(),
              routes: [
                <span class="hljs-comment">// Feed 页面下的子页面</span>
                GoRoute(
                  path: <span class="hljs-string">'details/:id'</span>, <span class="hljs-comment">// 路径会自动拼接为 /feed/details/:id</span>
                  builder: (context, state) =&gt; DetailsScreen(id: state.pathParameters[<span class="hljs-string">'id'</span>]!),
                ),
              ]
            ),
          ],
        ),
        <span class="hljs-comment">// 第三个分支</span>
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: <span class="hljs-string">'/settings'</span>,
              builder: (context, state) =&gt; <span class="hljs-keyword">const</span> SettingsScreen(),
            ),
          ],
        ),
      ],
    ),
  ],
);
</code></pre>
<p>你的 <code>ScaffoldWithNavBar</code> 会接收一个 <code>navigationShell</code> 对象，用它来构建 <code>BottomNavigationBar</code> 并显示当前分支的页面。 <code>StatefulShellRoute</code> 的美妙之处在于，当你切换标签页时，每个分支的导航状态都会被完整保留！</p>
<h5 data-id="heading-8">第七步：重定向 (Redirect) - 登录验证</h5>
<p><code>GoRouter</code> 的 <code>redirect</code> 功能是实现路由守卫（例如登录拦截）的利器。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// app_router.dart</span>
<span class="hljs-keyword">final</span> GoRouter router = GoRouter(
  redirect: (BuildContext context, GoRouterState state) {
    <span class="hljs-comment">// 模拟一个登录状态</span>
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> loggedIn = <span class="hljs-keyword">false</span>; <span class="hljs-comment">// 在真实应用中，你会从状态管理中获取</span>
    
    <span class="hljs-comment">// 检查用户是否在访问登录页</span>
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isLoggingIn = state.matchedLocation == <span class="hljs-string">'/login'</span>;

    <span class="hljs-comment">// 如果用户未登录且不在登录页，重定向到登录页</span>
    <span class="hljs-keyword">if</span> (!loggedIn &amp;&amp; !isLoggingIn) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'/login'</span>;
    }
    
    <span class="hljs-comment">// 如果用户已登录且在访问登录页，重定向到首页</span>
    <span class="hljs-keyword">if</span> (loggedIn &amp;&amp; isLoggingIn) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'/'</span>;
    }

    <span class="hljs-comment">// 其他情况，不重定向</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
  },
  routes: [
    GoRoute(
      path: <span class="hljs-string">'/'</span>,
      builder: (context, state) =&gt; <span class="hljs-keyword">const</span> HomeScreen(),
    ),
    GoRoute(
      path: <span class="hljs-string">'/login'</span>,
      builder: (context, state) =&gt; <span class="hljs-keyword">const</span> LoginScreen(),
    ),
    GoRoute(
      path: <span class="hljs-string">'/profile'</span>,
      builder: (context, state) =&gt; <span class="hljs-keyword">const</span> ProfileScreen(),
    ),
  ],
);
</code></pre>
<p>这个 <code>redirect</code> 函数会在每次导航发生前被调用。你可以根据应用状态（如登录状态、用户权限等）返回一个新的路径来中断并重定向导航，或者返回 <code>null</code> 表示允许本次导航。</p>
<h4 data-id="heading-9">总结</h4>
<p><code>Navigator 2.0</code> 的声明式思想为 <code>Flutter</code> 带来了更强大、更灵活的路由系统，而 <code>GoRouter</code> 则是我们驾驭这套系统的最佳工具。</p>
<p>通过本教程，我们学习了 <code>GoRouter</code> 的核心用法：</p>
<ol>
<li><strong>基础配置</strong>：通过 <code>GoRouter</code> 和 <code>GoRoute</code> 定义路由表。</li>
<li><strong>页面导航</strong>：使用 <code>context.go</code>, <code>context.push</code>, <code>context.pop</code>。</li>
<li><strong>参数传递</strong>：掌握了路径参数、查询参数和 <code>extra</code> 对象传参。</li>
<li><strong>嵌套路由</strong>：使用 <code>StatefulShellRoute</code> 轻松实现复杂的 <code>UI</code> 布局。</li>
<li><strong>路由重定向</strong>：通过 <code>redirect</code> 实现登录拦截等路由守卫。</li>
</ol>
<p>掌握 <code>GoRouter</code>，你将能够自信地构建任何复杂的 <code>Flutter</code> 应用，并轻松应对 <code>Web</code> 和深度链接带来的挑战。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 定位详解：从文档流到五种定位方式]]></title>    <link>https://juejin.cn/post/7571295102851498010</link>    <guid>https://juejin.cn/post/7571295102851498010</guid>    <pubDate>2025-11-12T00:33:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571295102851498010" data-draft-id="7571304204755058742" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 定位详解：从文档流到五种定位方式"/> <meta itemprop="keywords" content="CSS,前端"/> <meta itemprop="datePublished" content="2025-11-12T00:33:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的野人"/> <meta itemprop="url" content="https://juejin.cn/user/1458425238667008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 定位详解：从文档流到五种定位方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458425238667008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的野人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:33:44.000Z" title="Wed Nov 12 2025 00:33:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在网页设计与开发中，CSS 定位是控制元素布局的核心技术之一。理解不同的定位方式及其对文档流的影响，对于创建复杂且响应式的页面布局至关重要。本文将深入探讨 CSS 中的五种定位方式：static、relative、absolute、fixed 和 sticky，并通过具体代码示例解析它们的行为特性。</p>
<h2 data-id="heading-0">文档流基础</h2>
<p>在深入探讨定位之前，我们需要理解文档流（Normal Flow）的概念。文档流是 HTML 元素默认的布局方式：块级元素垂直排列，行内元素水平排列，遵循从上到下、从左到右的自然顺序。</p>
<p>当元素处于文档流中时，它们按照在 HTML 中的出现顺序进行布局。然而，某些 CSS 属性（如定位）可以使元素"离开文档流"，从而改变这种默认行为。</p>
<h2 data-id="heading-1">相对定位（Relative Positioning）</h2>
<p>相对定位是 CSS 中最基础的定位方式之一。通过设置 <code>position: relative</code>，元素可以根据其在文档流中的原始位置进行偏移。</p>
<p>html</p>
<p>复制下载运行</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Relative 相对定位<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    *{
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.parent</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background</span>: pink;
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">100px</span>;
    }
    <span class="hljs-selector-class">.child</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background</span>: gold;
    }
    <span class="hljs-selector-class">.box</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: greenyellow;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个示例中，<code>.parent</code> 元素设置了 <code>position: relative</code> 并向右和向下各偏移了 100px。相对定位的关键特性是：</p>
<ol>
<li><strong>相对自身定位</strong>：元素相对于其在文档流中的原始位置进行偏移</li>
<li><strong>不脱离文档流</strong>：元素仍然占据原来的空间，不会影响其他元素的布局</li>
<li><strong>可使用偏移属性</strong>：可以使用 <code>top</code>、<code>right</code>、<code>bottom</code> 和 <code>left</code> 属性进行精确控制</li>
</ol>
<p>相对定位常用于微调元素位置，或作为绝对定位子元素的参考容器。</p>
<h2 data-id="heading-2">绝对定位（Absolute Positioning）</h2>
<p>绝对定位使元素完全脱离文档流，不再占据原来的空间。绝对定位的元素需要参考一个具有定位属性（非 static）的祖先元素。</p>
<p>html</p>
<p>复制下载运行</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>absolute 绝对定位<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">background-color</span>: azure;
    }
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">550px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: hotpink;
      <span class="hljs-attribute">position</span>:relative;
    }
    <span class="hljs-selector-class">.child</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: skyblue;
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">100px</span>;
    }
    <span class="hljs-selector-class">.box</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: turquoise;
      <span class="hljs-attribute">position</span>:absolute;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>,-<span class="hljs-number">50%</span>);
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>456<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个示例中，我们看到了两种绝对定位的应用：</p>
<ol>
<li><strong>子元素相对于父元素定位</strong>：<code>.child</code> 元素设置了 <code>position: absolute</code> 和 <code>right: 100px</code>，它相对于设置了 <code>position: relative</code> 的 <code>.parent</code> 元素进行定位。</li>
<li><strong>相对于视口定位</strong>：<code>.box</code> 元素也设置了 <code>position: absolute</code>，但由于没有定位的祖先元素，它相对于视口进行定位。通过 <code>left: 50%</code> 和 <code>top: 50%</code> 将其左上角定位在视口中心，再通过 <code>transform: translate(-50%, -50%)</code> 将其自身中心点对准视口中心。</li>
</ol>
<p>绝对定位的关键特性：</p>
<ol>
<li><strong>脱离文档流</strong>：元素不再占据空间，后续元素会填补其位置</li>
<li><strong>参考最近的定位祖先</strong>：元素相对于最近的非 static 定位祖先进行定位</li>
<li><strong>无定位祖先时参考视口</strong>：如果没有定位祖先，则相对于初始包含块（通常是视口）定位</li>
<li><strong>不响应文档滚动</strong>：除非其定位祖先滚动</li>
</ol>
<h2 data-id="heading-3">固定定位（Fixed Positioning）</h2>
<p>固定定位类似于绝对定位，但它总是相对于浏览器视口进行定位，即使页面滚动，元素也会保持在固定位置。</p>
<p>html</p>
<p>复制下载运行</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>fixed<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    *{
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; 
    }
    <span class="hljs-selector-tag">body</span>{
      <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>;
    }
    <span class="hljs-selector-class">.parent</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">550px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: green;
    }
    <span class="hljs-selector-class">.child</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: blue;
      <span class="hljs-attribute">position</span>: fixed;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">100px</span>;
    }
    <span class="hljs-selector-class">.box</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: pink;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个示例中，<code>.child</code> 元素设置了 <code>position: fixed</code>，并定位在视口右下角 100px 处。即使页面滚动，该元素也会保持在固定位置。</p>
<p>固定定位的关键特性：</p>
<ol>
<li><strong>相对于视口定位</strong>：总是相对于浏览器窗口进行定位</li>
<li><strong>脱离文档流</strong>：不占据空间，不影响其他元素布局</li>
<li><strong>不随页面滚动</strong>：页面滚动时元素保持固定位置</li>
<li><strong>常用于固定导航、广告等</strong>：适合需要始终可见的界面元素</li>
</ol>
<h2 data-id="heading-4">粘性定位（Sticky Positioning）</h2>
<p>粘性定位是相对定位和固定定位的混合。元素在跨越特定阈值前为相对定位，之后为固定定位。</p>
<p>html</p>
<p>复制下载运行</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    *{
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-tag">body</span>{
      <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>;
    }
    <span class="hljs-selector-class">.parent</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: palegreen;
    }
    <span class="hljs-selector-class">.child</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: orange;
    }
    <span class="hljs-selector-class">.box</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: brown;
      <span class="hljs-attribute">position</span>:sticky;
      <span class="hljs-attribute">top</span>:<span class="hljs-number">100px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    153
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个示例中，<code>.box</code> 元素设置了 <code>position: sticky</code> 和 <code>top: 100px</code>。当页面滚动时，该元素会正常滚动直到距离视口顶部 100px 的位置，然后变为固定定位，保持在该位置。</p>
<p>粘性定位的关键特性：</p>
<ol>
<li><strong>混合定位模式</strong>：在阈值前为相对定位，跨越阈值后为固定定位</li>
<li><strong>相对于最近滚动祖先</strong>：元素相对于最近的滚动祖先进行定位</li>
<li><strong>需要指定阈值</strong>：必须指定至少一个 <code>top</code>、<code>right</code>、<code>bottom</code> 或 <code>left</code> 值</li>
<li><strong>常用于粘性导航、标题等</strong>：适合需要在滚动时保持可见但又不一直固定的元素</li>
</ol>
<h2 data-id="heading-5">静态定位（Static Positioning）</h2>
<p>静态定位是元素的默认定位方式，元素按照正常的文档流进行布局。</p>
<p>html</p>
<p>复制下载运行</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    *{
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.parent</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: pink;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">position</span>: absolute;
    }
    <span class="hljs-selector-class">.child</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: blue;
    }
    <span class="hljs-selector-class">.box</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: green;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    153
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> oParent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.parent'</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      oParent.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'static'</span>;
    },<span class="hljs-number">2000</span>);
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个示例中，<code>.parent</code> 元素初始设置为 <code>position: absolute</code>，但 2 秒后通过 JavaScript 变为 <code>position: static</code>。当变为静态定位后，<code>left: 100px</code> 属性将不再生效，因为静态定位的元素不接受偏移属性。</p>
<p>静态定位的关键特性：</p>
<ol>
<li><strong>默认定位方式</strong>：所有元素的默认定位方式</li>
<li><strong>忽略偏移属性</strong>：<code>top</code>、<code>right</code>、<code>bottom</code> 和 <code>left</code> 属性无效</li>
<li><strong>正常文档流</strong>：元素按照正常的文档流进行布局</li>
<li><strong>用于取消定位</strong>：可用于覆盖其他定位方式，使元素回到正常文档流</li>
</ol>
<h2 data-id="heading-6">定位与元素显示</h2>
<p>在 CSS 中，有多种方式可以隐藏元素，但它们的行为有所不同：</p>
<ul>
<li><strong>display: none</strong>：完全隐藏元素，不占用空间，不会影响其他元素的布局</li>
<li><strong>opacity: 0</strong>：使元素完全透明，但仍然占用空间，会影响其他元素的布局</li>
<li><strong>visibility: hidden</strong>：隐藏元素，但仍然占用空间，但不会响应鼠标事件</li>
</ul>
<p>在定位上下文中，这些属性的选择会影响布局结果。例如，使用 <code>opacity: 0</code> 隐藏的定位元素仍然会占据其定位空间，而使用 <code>display: none</code> 则完全从布局中移除。</p>
<h2 data-id="heading-7">总结</h2>
<p>CSS 定位是网页布局的核心技术，理解不同定位方式的行为特性对于创建复杂且响应式的页面至关重要。相对定位用于微调，绝对定位用于精确控制，固定定位用于创建固定元素，粘性定位用于滚动时的粘性效果，而静态定位则是默认的文档流布局。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Solidity 第四周 （下）：解构DeFi的核心引擎——智能合约深度解析]]></title>    <link>https://juejin.cn/post/7571348736153337892</link>    <guid>https://juejin.cn/post/7571348736153337892</guid>    <pubDate>2025-11-12T01:25:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571348736153337892" data-draft-id="7571355146770628650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Solidity 第四周 （下）：解构DeFi的核心引擎——智能合约深度解析"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2025-11-12T01:25:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cainiaoeba"/> <meta itemprop="url" content="https://juejin.cn/user/4302806371543898"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Solidity 第四周 （下）：解构DeFi的核心引擎——智能合约深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4302806371543898/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cainiaoeba
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T01:25:58.000Z" title="Wed Nov 12 2025 01:25:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Solidity 第四周 （下）：解构DeFi的核心引擎——智能合约深度解析</h2>
<p>这篇文章将带你探索三个DeFi领域的“圣杯”级合约：<strong>自动化做市商（AMM）</strong>、<strong>收益农场（Yield Farming）</strong> 和 <strong>去中心化治理（DAO）</strong>。准备好，我们将一起揭开“金融乐高”的神秘面纱。</p>
<h3 data-id="heading-1">🚀 一、自动化做市商（AMM）：<code>x * y = k</code> 的魔力</h3>
<p>在传统金融中，交易依赖于“订单簿”——买家和卖家挂出自己的心理价位，等待对手方撮合。但在区块链上，这种模式因gas费用高昂和流动性不足而难以为继。AMM的出现，彻底改变了游戏规则。</p>
<p>Uniswap V2所推广的<strong>恒定乘积公式 <code>x * y = k</code></strong> 是AMM的灵魂。它不需要订单簿，而是创建了一个“流动性池”，任何人都可以与这个池子进行交易。</p>
<h4 data-id="heading-2">AMM核心逻辑</h4>
<ul>
<li><strong>流动性池 (Liquidity Pool)</strong>: 合约中锁定两种代币（如Token A和Token B）。</li>
<li><strong>恒定乘积</strong>: <code>Token A 的储备量 (x)</code> 乘以 <code>Token B 的储备量 (y)</code> 必须始终等于一个常数 <code>k</code>（忽略手续费）。</li>
<li><strong>价格发现</strong>: 当你用Token A兑换Token B时，你向池中增加了A（x增大），为了保持k不变，池子必须减少B（y减小）并给你。池中两种代幣的相对数量变化，自动导致了价格的变化。</li>
</ul>
<h4 data-id="heading-3">关键代码实现</h4>
<h5 data-id="heading-4">1. 添加流动性 (<code>addLiquidity</code>)</h5>
<p>用户按当前池内代币的比例，同时存入两种代币，成为流动性提供者（LP），并获得代表其份额的LP凭证。</p>
<pre><code class="hljs language-solidity" lang="solidity">// AutomatedMarketMaker.sol
function addLiquidity(uint256 amountA, uint256 amountB) external {
    // ...
    tokenA.transferFrom(msg.sender, address(this), amountA);
    tokenB.transferFrom(msg.sender, address(this), amountB);

    uint256 liquidity;
    // 如果是第一个流动性提供者，LP数量 = sqrt(a * b)
    if (totalSupply() == 0) {
        liquidity = sqrt(amountA * amountB);
    } else {
        // 后续提供者按比例获得LP
        liquidity = min(
            amountA * totalSupply() / reserveA,
            amountB * totalSupply() / reserveB
        );
    }

    _mint(msg.sender, liquidity); // 铸造LP代币给用户
    // ...
}
</code></pre>
<h5 data-id="heading-5">2. 代币交换 (<code>swapAforB</code>)</h5>
<p>这是AMM的核心功能。我们来看一下价格计算的实现，其中包含0.3%的手续费，这部分手续费会留在池中，奖励给流动性提供者。</p>
<pre><code class="hljs language-solidity" lang="solidity">function swapAforB(uint256 amountAIn, uint256 minBOut) external {
    require(amountAIn &gt; 0, "Amount must be &gt; 0");
    require(reserveA &gt; 0 &amp;&amp; reserveB &gt; 0, "Insufficient reserves");

    // Uniswap V2 经典手续费模型：扣除0.3%
    // 1000份里取997份用于计算，剩下3份作为手续费
    uint256 amountAInWithFee = amountAIn * 997 / 1000;
    
    // 核心公式： (x + Δx) * (y - Δy) = k
    // 推导得出 Δy = (y * Δx') / (x + Δx')  其中 Δx' 是扣费后的输入
    uint256 amountBOut = reserveB * amountAInWithFee / (reserveA + amountAInWithFee);

    require(amountBOut &gt;= minBOut, "Slippage too high");

    // ... 执行转账和更新储备量
    reserveA += amountAIn; // 注意：总储备量增加的是全部输入
    reserveB -= amountBOut;
    // ...
}
</code></pre>
<blockquote>
<p><strong>思考</strong>: 为什么<code>reserveA</code>增加的是<code>amountAIn</code>而不是<code>amountAInWithFee</code>？因为手续费留在了池子里，成为了流动性的一部分，增加了<code>k</code>值，从而让LP们获利。</p>
</blockquote>
<h5 data-id="heading-6">3. 工厂模式 (<code>MiniDexFactory</code>)</h5>
<p>一个DEX需要支持成千上万的交易对。手动为每个交易对部署一个合约是不现实的。<strong>工厂合约</strong>应运而生，它可以动态地创建和管理所有的交易对合约。</p>
<pre><code class="hljs language-solidity" lang="solidity">// MiniDexFactory.sol
contract MiniDexFactory is Ownable {
    // 记录所有已创建的交易对
    mapping(address =&gt; mapping(address =&gt; address)) public getPair;
    address[] public allPairs;

    function createPair(address _tokenA, address _tokenB) external onlyOwner returns (address pair) {
        // ... 省略验证逻辑
        
        // 为了避免 (A,B) 和 (B,A) 创建出两个不同的合约，我们进行地址排序
        (address token0, address token1) = _tokenA &lt; _tokenB ? (_tokenA, _tokenB) : (_tokenB, _tokenA);

        // 使用 `new` 关键字创建新的交易对合约
        pair = address(new MiniDexPair(token0, token1));
        
        // 记录新创建的交易对
        getPair[token0][token1] = pair;
        getPair[token1][token0] = pair; // 两个方向都记录，方便查询
        allPairs.push(pair);
        
        emit PairCreated(token0, token1, pair, allPairs.length - 1);
    }
}
</code></pre>
<h4 data-id="heading-7">小结</h4>
<p>AMM和工厂模式是DeFi可组合性的典范。通过它们，我们理解了：</p>
<ul>
<li><strong>算法如何取代传统金融中介</strong>，实现去中心化交易。</li>
<li><strong>流动性提供者和交易者之间的经济激励模型</strong>。</li>
<li><strong>工厂设计模式</strong>如何让一个协议无限扩展。</li>
</ul>
<hr/>
<h3 data-id="heading-8">🌾 二、收益农场（YieldFarming）：让你的资产“生息”</h3>
<p>如果说AMM是交易引擎，那么收益农场就是DeFi的增长激素。项目方通过它来激励用户提供流动性或锁定代币，用户则通过“耕作”来赚取回报。</p>
<p>其核心在于<strong>公平地分配奖励</strong>，通常与用户<strong>质押的金额</strong>和<strong>质押的时长</strong>成正比。</p>
<h4 data-id="heading-9">核心设计：时间加权的奖励计算</h4>
<p>简单粗暴地按比例分配奖励是不公平的，因为它忽略了时间维度。一个质押了1000代币1天的用户，和一个质押100代币10天的用户，贡献可能相似。<code>YieldFarming</code>合约通过<code>updateRewards</code>函数完美地解决了这个问题。</p>
<pre><code class="hljs language-solidity" lang="solidity">// YieldFarming.sol
contract YieldFarming is ReentrancyGuard {
    // ...
    uint256 public rewardRatePerSecond; // 每秒钟总共分发多少奖励
    uint8 public stakingTokenDecimals; // 质押代币的精度
    
    struct StakerInfo {
        uint256 stakedAmount; // 质押数量
        uint256 rewardDebt;   // 已累计但未领取的奖励
        uint256 lastUpdate;   // 上次更新奖励的时间戳
    }

    mapping(address =&gt; StakerInfo) public stakers;

    // 内部函数，在每次用户操作（质押、取回、领取）前调用
    function updateRewards(address user) internal {
        StakerInfo storage staker = stakers[user];

        if (staker.stakedAmount &gt; 0) {
            // 1. 计算时间差
            uint256 timeDiff = block.timestamp - staker.lastUpdate;
            
            // 2. 考虑代币精度，计算奖励乘数
            uint256 rewardMultiplier = 10 ** stakingTokenDecimals;
            
            // 3. 计算这段时间应得的奖励
            // 公式：时长 * 每秒奖励率 * 个人质押量 / 总质押量 (这里简化为与个人质押量成正比)
            uint256 pendingReward = (timeDiff * rewardRatePerSecond * staker.stakedAmount) / rewardMultiplier;
            
            // 4. 累加到用户的奖励债务中
            staker.rewardDebt += pendingReward;
        }

        // 5. 更新最后更新时间
        staker.lastUpdate = block.timestamp;
    }
    // ...
}
</code></pre>
<p>每次用户<code>stake</code>, <code>unstake</code>或<code>claimRewards</code>时，我们都先调用<code>updateRewards</code>，结清他到当前时间点的所有收益，存入<code>rewardDebt</code>。这样，无论他接下来做什么操作，之前的收益都不会丢失，保证了公平性。</p>
<h4 data-id="heading-10">小结</h4>
<p>收益农场合约教会我们：</p>
<ul>
<li><strong>如何设计一个与时间和金额都相关的复杂奖励系统</strong>。</li>
<li><strong>内部函数 (<code>internal</code>) 在状态变更前维护数据一致性的重要性</strong>。</li>
<li><strong>处理不同代币精度</strong>在DeFi数学计算中的普遍性和必要性。</li>
</ul>
<hr/>
<p>##🏛️ 三、去中心化治理（DAO）：代码即法律，社区共治</p>
<p>当一个项目足够去中心化时，谁来决定它的未来？答案是<strong>DAO (Decentralized Autonomous Organization)</strong>。DAO通过智能合约将治理规则编码，让代币持有者通过投票来决定一切，从协议参数修改到国库资金使用。</p>
<p><code>DecentralisedGovernance</code>合约是一个麻雀虽小五脏俱全的DAO实现。</p>
<h4 data-id="heading-11">超越简单投票的核心机制</h4>
<ol>
<li>
<p><strong>代币加权投票</strong>: 你的投票权重取决于你持有的治理代币数量。一币一票，而非一人一票。</p>
<pre><code class="hljs language-solidity" lang="solidity">// DecentralisedGovernance.sol
function vote(uint256 proposalId, bool support) external {
    // ...
    // 投票权重 = 用户持有的治理代币余额
    uint256 weight = governanceToken.balanceOf(msg.sender);

    if (support) {
        proposal.votesFor += weight;
    } else {
        proposal.votesAgainst += weight;
    }
    // ...
}
</code></pre>
</li>
<li>
<p><strong>提案押金 (<code>proposalDeposit</code>)</strong>: 为了防止垃圾提案，发起人需要抵押一定数量的代币。只有当提案通过并成功执行后，押金才会被退还。</p>
</li>
<li>
<p><strong>法定人数 (<code>Quorum</code>)</strong>: 提案不仅要获得多数票，总投票数还必须达到一个最低门槛（如总代币供应量的5%）。这可以防止少数巨鲸在社区普遍不关心的情况下轻易通过提案。</p>
<pre><code class="hljs language-solidity" lang="solidity">function finalizeProposal(uint256 proposalId) external {
    // ...
    uint256 totalSupply = governanceToken.totalSupply();
    uint256 totalVotes = proposal.votesFor + proposal.votesAgainst;
    uint256 quorumNeeded = (totalSupply * quorumPercentage) / 100;

    if (totalVotes &gt;= quorumNeeded &amp;&amp; proposal.votesFor &gt; proposal.votesAgainst) {
        // 提案通过，进入时间锁
        // ...
    } else {
        // 提案失败
        // ...
    }
}
</code></pre>
</li>
<li>
<p><strong>时间锁 (<code>Timelock</code>)</strong>: 即使提案通过，也不会立即执行。它会进入一个“时间锁”等待期。这给了社区成员最后反应的时间——如果他们强烈反对这个提案，他们可以在执行前卖掉代币或采取其他行动。</p>
</li>
<li>
<p><strong>链上执行 (<code>executeProposal</code>)</strong>: 时间锁结束后，任何人都可以调用<code>executeProposal</code>函数。这个函数会<strong>自动执行</strong>提案中定义的操作，比如调用另一个合约的函数、转移资金等。这是DAO最强大的地方——决议的执行是无需许可和自动的。</p>
<pre><code class="hljs language-solidity" lang="solidity">function executeProposal(uint256 proposalId) external nonReentrant {
    // ...
    // 遍历提案中定义的所有目标和操作
    for (uint256 i = 0; i &lt; proposal.executionTargets.length; i++) {
        // 核心：使用底层的 .call() 方法执行任意操作
        (bool success, ) = proposal.executionTargets[i].call(proposal.executionData[i]);
        require(success, "Execution failed");
    }
    // ... 退还押金
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-12">小结</h4>
<p>DAO的构建让我们触摸到了Web3的灵魂：</p>
<ul>
<li><strong>将复杂的治理规则代码化</strong>，实现真正的“代码即法律”。</li>
<li><strong>理解了<code>Quorum</code>、<code>Timelock</code>等机制在去中心化系统风险控制中的重要作用</strong>。</li>
<li><strong>掌握了通过<code>.call()</code>实现合约间通用交互的强大能力</strong>。</li>
</ul>
<h3 data-id="heading-13">最终总结</h3>
<p>从上篇的实用工具到下篇的DeFi引擎，我们亲手构建了Web3世界的核心组件。我们发现，那些看似高深莫测的DeFi协议和DAO组织，其底层都是由这些清晰、模块化的智能合约“乐高”积木搭建而成的。</p>
<p>“30天精通Solidity”的旅程可能即将结束，但真正的开发者之路才刚刚开始。希望这两篇文章能成为你探索Web3丛林的一份地图。不断学习，不断构建，未来在你手中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Solidity 第四周 （上） ：构建Web3应用的基石——智能合约深度解析]]></title>    <link>https://juejin.cn/post/7571334572769181739</link>    <guid>https://juejin.cn/post/7571334572769181739</guid>    <pubDate>2025-11-12T01:23:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571334572769181739" data-draft-id="7571299394346450986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Solidity 第四周 （上） ：构建Web3应用的基石——智能合约深度解析"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2025-11-12T01:23:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cainiaoeba"/> <meta itemprop="url" content="https://juejin.cn/user/4302806371543898"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Solidity 第四周 （上） ：构建Web3应用的基石——智能合约深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4302806371543898/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cainiaoeba
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T01:23:44.000Z" title="Wed Nov 12 2025 01:23:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Solidity 第四周 （上） ：构建Web3应用的基石——智能合约深度解析</h2>
<p>你好，掘金的开发者们！</p>
<p>在Web3的世界里，智能合约是构建一切信任和价值的基石。它们不仅仅是代码，更是一种将规则和逻辑刻在区块链上、永不可篡改的承诺。在“30天精通Solidity”的学习旅程中，我们从理论走向实践，亲手构建了多个真实世界的应用场景。</p>
<p>在这篇文章（上篇）中，我将带你回顾两个最基础也是最实用的智能合约：<strong>去中心化托管合约</strong>和<strong>NFT市场合约</strong>。我们将一起剖析它们的设计哲学、核心逻辑和代码实现，理解如何用Solidity解决现实世界中的信任问题。</p>
<h3 data-id="heading-1">🔐 一、去中心化托管（DecentralisedEscrow）：用代码重塑信任</h3>
<p>在任何交易中，尤其是线上交易，信任都是最大的难题。买家怕付款后收不到货，卖家怕发货后收不到款。传统的解决方案是引入一个中心化的“中间人”，如支付宝或PayPal。但在Web3中，我们可以用代码创造一个无需信任任何第三方、完全自动执行的中间人。</p>
<p><code>EnhancedSimpleEscrow</code>合约就是这样一个完美的例子。</p>
<h4 data-id="heading-2">核心设计思想</h4>
<p>这个合约的核心在于**状态机（State Machine）**的设计。整个托管流程被精确地定义为几个状态，并且合约的行为严格受限于当前的状态。</p>
<p>我们使用<code>enum</code>来定义这些状态，这让代码逻辑清晰且安全：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract EnhancedSimpleEscrow {
    // 使用枚举清晰地定义托管流程的每一步
    enum EscrowState { 
        AWAITING_PAYMENT,   // 等待付款
        AWAITING_DELIVERY,  // 等待发货/确认收货
        COMPLETE,           // 完成
        DISPUTED,           // 争议中
        CANCELLED           // 已取消
    }

    EscrowState public state; // 合约当前的状态

    // ... 其他变量
}
</code></pre>
<h4 data-id="heading-3">关键角色与流程</h4>
<p>合约中有三个关键角色，在部署时就已确定且不可更改（<code>immutable</code>），保证了合约的稳定性和安全性。</p>
<pre><code class="hljs language-solidity" lang="solidity">    address public immutable buyer;   // 买家 (部署者)
    address public immutable seller;  // 卖家
    address public immutable arbiter; // 仲裁员
</code></pre>
<h5 data-id="heading-4">1. 正常流程：“快乐路径” (Happy Path)</h5>
<ol>
<li>
<p><strong>买家存款 (<code>deposit</code>)</strong>: 买家调用<code>deposit</code>函数，将约定金额的ETH锁入合约。此时，合约状态从<code>AWAITING_PAYMENT</code>变为<code>AWAITING_DELIVERY</code>。</p>
<pre><code class="hljs language-solidity" lang="solidity">function deposit() external payable {
    // 只有买家可以存款，且只能在等待付款状态下进行
    require(msg.sender == buyer, "Only buyer can deposit");
    require(state == EscrowState.AWAITING_PAYMENT, "Already paid");
    require(msg.value &gt; 0, "Amount must be greater than zero");

    amount = msg.value;
    state = EscrowState.AWAITING_DELIVERY;
    depositTime = block.timestamp; // 记录存款时间，为超时逻辑做准备
    emit PaymentDeposited(buyer, amount);
}
</code></pre>
</li>
<li>
<p><strong>买家确认收货 (<code>confirmDelivery</code>)</strong>: 买家收到商品或服务后，调用此函数。合约将款项转给卖家，状态变为<code>COMPLETE</code>。</p>
<pre><code class="hljs language-solidity" lang="solidity">function confirmDelivery() external {
    require(msg.sender == buyer, "Only buyer can confirm");
    require(state == EscrowState.AWAITING_DELIVERY, "Not in delivery state");

    state = EscrowState.COMPLETE;
    payable(seller).transfer(amount); // 将资金转给卖家
    emit DeliveryConfirmed(buyer, seller, amount);
}
</code></pre>
</li>
</ol>
<h5 data-id="heading-5">2. 异常处理：争议与超时</h5>
<p>Web3的设计必须考虑到最坏的情况。如果交易出现问题怎么办？</p>
<ul>
<li>
<p><strong>发起争议 (<code>raiseDispute</code>)</strong>: 在<code>AWAITING_DELIVERY</code>状态下，任何一方都可以发起争议，将状态切换为<code>DISPUTED</code>。此时资金被冻结，等待仲裁员介入。</p>
</li>
<li>
<p><strong>仲裁解决 (<code>resolveDispute</code>)</strong>: 只有<code>arbiter</code>可以调用此函数。仲裁员根据链下证据判断，决定将资金释放给买家还是卖家。</p>
<pre><code class="hljs language-solidity" lang="solidity">function resolveDispute(bool _releaseToSeller) external {
    require(msg.sender == arbiter, "Only arbiter can resolve");
    require(state == EscrowState.DISPUTED, "No dispute to resolve");

    state = EscrowState.COMPLETE;
    if (_releaseToSeller) {
        payable(seller).transfer(amount);
        emit DisputeResolved(arbiter, seller, amount);
    } else {
        payable(buyer).transfer(amount);
        emit DisputeResolved(arbiter, buyer, amount);
    }
}
</code></pre>
</li>
<li>
<p><strong>超时取消 (<code>cancelAfterTimeout</code>)</strong>: 为了保护买家，防止资金被无限期锁定，我们引入了超时机制。如果在<code>depositTime</code>之后超过了预设的<code>deliveryTimeout</code>时间，买家就可以单方面取消交易并取回资金。</p>
<pre><code class="hljs language-solidity" lang="solidity">function cancelAfterTimeout() external {
    require(msg.sender == buyer, "Only buyer can trigger timeout cancellation");
    require(state == EscrowState.AWAITING_DELIVERY, "Cannot cancel in current state");
    // 核心逻辑：当前时间是否已经超过了存款时间+超时时长
    require(block.timestamp &gt;= depositTime + deliveryTimeout, "Timeout not reached");

    state = EscrowState.CANCELLED;
    payable(buyer).transfer(address(this).balance); // 退款
    emit EscrowCancelled(buyer);
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-6">小结</h4>
<p>通过托管合约，我们学会了：</p>
<ul>
<li><strong>使用<code>enum</code>进行精细的状态管理</strong>，这是编写安全、可预测合约的关键。</li>
<li><strong>利用<code>block.timestamp</code>实现时间锁定和超时逻辑</strong>。</li>
<li><strong>设计多方参与和权限控制</strong>，明确<code>buyer</code>, <code>seller</code>, <code>arbiter</code>各自的职责。</li>
</ul>
<hr/>
<h3 data-id="heading-7">🖼️ 二、NFT市场（NFTMarketplace）：构建你的数字藏品交易平台</h3>
<p>如果说托管合约是处理“同质化”价值（ETH）的工具，那么NFT市场就是为“非同质化”价值（NFT）量身定做的交易平台。它像一个去中心化的OpenSea，让任何人都可以上架、购买和出售独特的数字资产。</p>
<h4 data-id="heading-8">核心数据结构</h4>
<p>一个好的市场，首先要能清晰地管理商品信息。我们使用<code>struct</code>来定义每一个“上架商品”（Listing）的数据结构。</p>
<pre><code class="hljs language-solidity" lang="solidity">// ... imports
import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

contract NFTMarketplace is ReentrancyGuard {
    struct Listing {
        address seller;         // 卖家地址
        address nftAddress;     // NFT合约地址
        uint256 tokenId;        // NFT的ID
        uint256 price;          // 价格 (in wei)
        address royaltyReceiver;// 版税接收者
        uint256 royaltyPercent; // 版税百分比 (基点)
        bool isListed;          // 是否正在上架
    }
    
    // 嵌套映射：nft合约地址 -&gt; tokenId -&gt; Listing信息
    mapping(address =&gt; mapping(uint256 =&gt; Listing)) public listings;
}
</code></pre>
<p>这个嵌套<code>mapping</code>非常巧妙，它允许我们的市场支持来自<strong>任何NFT合约</strong>的<strong>任何tokenId</strong>，扩展性极强。</p>
<h4 data-id="heading-9">关键流程解析</h4>
<h5 data-id="heading-10">1. 上架NFT (<code>listNFT</code>)</h5>
<p>上架的核心是<strong>所有权</strong>和<strong>授权</strong>的验证。卖家必须是NFT的真正所有者，并且必须授权市场合约在成交时可以转移该NFT。</p>
<pre><code class="hljs language-solidity" lang="solidity">function listNFT(
    address nftAddress,
    uint256 tokenId,
    uint256 price,
    address royaltyReceiver,
    uint256 royaltyPercent
) external {
    require(price &gt; 0, "Price must be above zero");

    // 实例化一个IERC721接口，以便与NFT合约交互
    IERC721 nft = IERC721(nftAddress);
    
    // 验证1: 调用者必须是NFT的所有者
    require(nft.ownerOf(tokenId) == msg.sender, "Not the owner");
    
    // 验证2: 市场合约必须被授权转移这个NFT
    // 可以是单次授权 (getApproved) 或全局授权 (isApprovedForAll)
    require(
        nft.getApproved(tokenId) == address(this) || nft.isApprovedForAll(msg.sender, address(this)),
        "Marketplace not approved"
    );

    // 创建并存储Listing信息
    listings[nftAddress][tokenId] = Listing({
        seller: msg.sender,
        // ... 其他信息
        isListed: true
    });

    emit Listed(msg.sender, nftAddress, tokenId, price, royaltyReceiver, royaltyPercent);
}
</code></pre>
<blockquote>
<p><strong>重点</strong>: <code>approve</code>或<code>setApprovalForAll</code>是用户与DeFi或NFT DApp交互前的标准操作。用户授权DApp在特定场景下操作自己的资产，这是Web3安全模型的基础。</p>
</blockquote>
<h5 data-id="heading-11">2. 购买NFT (<code>buyNFT</code>)</h5>
<p>这是市场的心脏。它处理资金的接收、分配，以及NFT的转移。整个过程必须是<strong>原子性</strong>的，即要么全部成功，要么全部失败。</p>
<pre><code class="hljs language-solidity" lang="solidity">function buyNFT(address nftAddress, uint256 tokenId) external payable nonReentrant {
    Listing memory item = listings[nftAddress][tokenId];
    require(item.isListed, "Not listed");
    require(msg.value == item.price, "Incorrect ETH sent");

    // 1. 计算费用：版税和市场费 (使用基点，避免浮点数)
    uint256 feeAmount = (msg.value * marketplaceFeePercent) / 10000;
    uint256 royaltyAmount = (msg.value * item.royaltyPercent) / 10000;
    uint256 sellerAmount = msg.value - feeAmount - royaltyAmount;

    // 2. 分配资金
    if (feeAmount &gt; 0) {
        payable(feeRecipient).transfer(feeAmount);
    }
    if (royaltyAmount &gt; 0 &amp;&amp; item.royaltyReceiver != address(0)) {
        payable(item.royaltyReceiver).transfer(royaltyAmount);
    }
    payable(item.seller).transfer(sellerAmount);

    // 3. 转移NFT给买家
    IERC721(item.nftAddress).safeTransferFrom(item.seller, msg.sender, item.tokenId);

    // 4. 清理上架信息
    delete listings[nftAddress][tokenId];

    emit Purchase(...);
}
</code></pre>
<blockquote>
<p><strong>安全提示</strong>: 注意到<code>nonReentrant</code>修饰符了吗？它来自OpenZeppelin的<code>ReentrancyGuard</code>。由于此函数涉及多次外部ETH转账，使用它可以有效防止“重入攻击”，确保在资金分配完成前，没有恶意合约能重新进入此函数造成资金损失。</p>
</blockquote>
<h4 data-id="heading-12">小结</h4>
<p>通过构建NFT市场，我们掌握了：</p>
<ul>
<li><strong>与外部合约（ERC721）的交互方式</strong>，这是构建复杂DApp的必备技能。</li>
<li><strong>版税和手续费等复杂资金分配逻辑</strong>的实现。</li>
<li><strong>使用<code>struct</code>和<code>mapping</code>设计可扩展的数据模型</strong>。</li>
<li><strong>认识到<code>ReentrancyGuard</code>等安全工具的重要性</strong>。</li>
</ul>
<h3 data-id="heading-13">总结</h3>
<p>从托管合约的状态机到NFT市场的多方交互，我们已经能够构建出解决具体问题的、实用的Web3应用。这些合约虽然看似简单，但它们蕴含了智能合约设计的核心思想：<strong>状态管理、权限控制、安全第一、以及与外部世界的标准化交互</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot实战避坑指南：我在微服务项目中总结的12条高效开发经验]]></title>    <link>https://juejin.cn/post/7571285984090144820</link>    <guid>https://juejin.cn/post/7571285984090144820</guid>    <pubDate>2025-11-12T00:16:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571285984090144820" data-draft-id="7571344319702450216" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot实战避坑指南：我在微服务项目中总结的12条高效开发经验"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-12T00:16:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot实战避坑指南：我在微服务项目中总结的12条高效开发经验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:16:53.000Z" title="Wed Nov 12 2025 00:16:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot实战避坑指南：我在微服务项目中总结的12条高效开发经验</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>SpringBoot作为Java生态中最流行的微服务框架之一，以其"约定优于配置"的理念和强大的自动化能力赢得了广大开发者的青睐。然而在实际企业级项目中，尤其是复杂的微服务架构下，开发者仍然会遇到各种意想不到的"坑"。本文基于笔者在多个大型微服务项目中的实战经验，总结了12条高效开发的黄金法则，涵盖配置管理、性能优化、异常处理等关键领域，帮助开发者避开常见陷阱。</p>
<h3 data-id="heading-2">一、配置管理篇</h3>
<h4 data-id="heading-3">1. 多环境配置的正确打开方式</h4>
<p>新手常犯的错误是将不同环境的配置硬编码在application.properties中。更专业的做法是：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">@activatedProperties@</span>
</code></pre>
<p>配合Maven Profile实现动态切换：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">activatedProperties</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">activatedProperties</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">2. 敏感信息的安全处理</h4>
<p>永远不要在代码库中提交明文密码！推荐组合方案：</p>
<ul>
<li>生产环境使用Vault或Kubernetes Secrets</li>
<li>开发环境使用Jasypt加密：</li>
</ul>
<pre><code class="hljs language-properties" lang="properties"># 加密后的配置示例
db.password=ENC(AQICAHhML...)
</code></pre>
<h4 data-id="heading-5">3. Configuration Properties的验证技巧</h4>
<p>避免简单的<code>@Value</code>注入，改用类型安全的绑定：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ConfigurationProperties(prefix = "app.mail")</span>
<span class="hljs-meta">@Validated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MailProperties</span> {
    <span class="hljs-meta">@NotEmpty</span> <span class="hljs-keyword">private</span> String host;
    <span class="hljs-meta">@Min(1025)</span> <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
}
</code></pre>
<p>配合<code>@EnableConfigurationProperties</code>启用，SpringBoot会自动验证参数合法性。</p>
<h3 data-id="heading-6">二、性能优化篇</h3>
<h4 data-id="heading-7">4. 启动速度的极致优化</h4>
<p>当依赖过多导致启动缓慢时：</p>
<ol>
<li>使用SpringBoot的Lazy Initialization模式：</li>
</ol>
<pre><code class="hljs language-properties" lang="properties">spring.main.lazy-initialization=true
</code></pre>
<ol start="2">
<li>通过<code>spring-context-indexer</code>加速组件扫描：</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context-indexer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">5. JPA/Hibernate的性能陷阱</h4>
<p>N+1查询问题是常见性能杀手。解决方案：</p>
<ul>
<li>Always JOIN FETCH关联对象：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@EntityGraph(attributePaths = "orders")</span>
List&lt;Customer&gt; <span class="hljs-title function_">findByActiveTrue</span><span class="hljs-params">()</span>;
</code></pre>
<ul>
<li>Batch Fetching配置：</li>
</ul>
<pre><code class="hljs language-properties" lang="properties">spring.jpa.properties.hibernate.default_batch_fetch_size=20
</code></pre>
<h4 data-id="heading-9">6. Redis缓存的最佳实践</h4>
<p>避免缓存穿透的三重防护：</p>
<ol>
<li>Null值缓存：<code>cache-null-values: true</code></li>
<li>BloomFilter前置过滤</li>
<li>synchronized本地锁控制并发重建</li>
</ol>
<h3 data-id="heading-10">三、异常处理篇</h3>
<h4 data-id="heading-11">7. RESTful API的统一异常处理</h4>
<p>告别混乱的try-catch块，使用<code>@ControllerAdvice</code>标准化错误响应：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ExceptionHandler(BusinessException.class)</span>
<span class="hljs-keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="hljs-title function_">handleBusinessException</span><span class="hljs-params">(
    BusinessException ex)</span> {
    <span class="hljs-keyword">return</span> ResponseEntity.status(ex.getStatusCode())
           .body(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorResponse</span>(ex.getErrorCode(), ex.getMessage()));
}
</code></pre>
<p>配套定义全局错误码枚举：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {
    PARAM_INVALID(<span class="hljs-number">40001</span>, <span class="hljs-string">"参数校验失败"</span>),
    SERVICE_UNAVAILABLE(<span class="hljs-number">50002</span>, <span class="hljs-string">"服务暂不可用"</span>);
}
</code></pre>
<h4 data-id="heading-12">8. Transactional注解的隐藏细节</h4>
<p>事务失效的五种常见场景：</p>
<ol>
<li>
<p><strong>自调用问题</strong>：同类方法内调用不会触发AOP代理<br/>
✅ Solution：注入self或使用AopContext</p>
</li>
<li>
<p><strong>异常类型不匹配</strong>：默认只回滚RuntimeException<br/>
✅ Solution：明确指定<code>rollbackFor</code></p>
</li>
<li>
<p><strong>传播行为误用</strong>：REQUIRES_NEW需要新连接<br/>
✅ Solution：评估事务边界设计</p>
</li>
<li>
<p><strong>非public方法</strong><br/>
✅ Solution：遵循Spring AOP规范</p>
</li>
<li>
<p><strong>异步上下文丢失</strong><br/>
✅ Solution：手动传递TransactionTemplate</p>
</li>
</ol>
<h3 data-id="heading-13">四、测试与部署篇</h3>
<h4 data-id="heading-14">9. SpringBootTest的正确姿势</h4>
<p>集成测试的资源消耗优化策略：</p>
<ul>
<li><strong>分层测试</strong>：纯单元测试不用加载Spring上下文</li>
<li><strong>MockBean精准替换</strong>：避免全量启动数据库</li>
<li><strong>Testcontainers替代H2</strong>：更真实的集成测试环境</li>
</ul>
<p>示例Docker化测试配置：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Testcontainers</span> 
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentServiceIT</span> {
   <span class="hljs-meta">@Container</span> 
   <span class="hljs-keyword">static</span> PostgreSQLContainer&lt;?&gt; postgres = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostgreSQLContainer</span>&lt;&gt;();
   
   <span class="hljs-meta">@DynamicPropertySource</span> 
   <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(DynamicPropertyRegistry registry)</span> {
       registry.add(<span class="hljs-string">"spring.datasource.url"</span>, postgres::getJdbcUrl);
   }
}
</code></pre>
<h4 data-id="heading-15">10.Kubernetes健康检查深度定制</h4>
<p>超越actuator的基础健康指示器：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># deployment.yaml片段 </span>
<span class="hljs-attr">livenessProbe:</span>
   <span class="hljs-attr">httpGet:</span>
     <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health/liveness</span> 
     <span class="hljs-attr">port:</span> <span class="hljs-string">actuator-port</span> 
<span class="hljs-string">initialDelaySeconds:60</span> <span class="hljs-comment">#根据应用实际启动时间调整 </span>

<span class="hljs-attr">readinessProbe:</span>
   <span class="hljs-attr">httpGet:</span>
     <span class="hljs-string">path:/actuator/health/readiness?components=custom-service-check</span> 
</code></pre>
<p>自定义健康指标实现示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomHealthIndicator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HealthIndicator</span> {
   <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> Health <span class="hljs-title function_">health</span><span class="hljs-params">()</span> {
      <span class="hljs-type">boolean</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> checkExternalService();
      <span class="hljs-keyword">return</span> available ? Health.up().build() : Health.down().build();
   }
} 
</code></pre>
<p>###五、架构设计篇</p>
<p>####11.DDD与SpringBoot的结合实践</p>
<p>避免贫血模型的三个关键点：</p>
<p>1.<strong>领域层保持纯净</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Entity</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> { <span class="hljs-comment">//不是简单的POJO模型类！</span>
<span class="hljs-keyword">public</span> Money <span class="hljs-title function_">calculateTotal</span><span class="hljs-params">()</span> { ... } <span class="hljs-comment">//业务逻辑内聚封装 }</span>
</code></pre>
<p>2.<strong>基础设施层依赖反转</strong></p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">package</span> infrastructure; <span class="hljs-comment">//实现放在基础设施层 @Repository public class JpaOrderRepository implements OrderRepository {} ```</span>

<span class="hljs-number">3.</span>**CQRS模式的应用**
``` properties spring.datasource.write.url=jdbc:postgresql:<span class="hljs-comment">//master-db spring.datasource.read.url=jdbc:postgresql://replica-db ```</span>

####<span class="hljs-number">12.</span>Saga分布式事务模式实现 

在没有XA的情况下保证最终一致性：

事件编排模式示例序列图:

</code></pre>
<p>[Order Service] -&gt; [Payment Service]: Reserve Credit (async event)
[Payment Service] --&gt; [Order Service]: Credit Reserved Event<br/>
[Order Service] -&gt; [Inventory Service]: Prepare Items (async event)
[Inventory Service] --&gt; [Order Service]: Items Prepared Event</p>
<pre><code class="hljs language-css" lang="css">
补偿事务的关键代码结构:
``` java @Transactional public void <span class="hljs-built_in">cancelOrder</span>(Long orderId) { orderRepository<span class="hljs-selector-class">.findById</span>(orderId)<span class="hljs-selector-class">.ifPresent</span>(<span class="hljs-attribute">order</span> -&gt; { paymentService<span class="hljs-selector-class">.refund</span>(<span class="hljs-attribute">order</span>); inventoryService<span class="hljs-selector-class">.restock</span>(<span class="hljs-attribute">order</span>); <span class="hljs-attribute">order</span><span class="hljs-selector-class">.cancel</span>(); }); } ```

###总结 

SpringBoot虽然极大地简化了开发流程,但要在生产环境中构建健壮的微服务系统,仍然需要深入理解其工作原理并遵循最佳实践。本文总结的<span class="hljs-number">12</span>条经验涵盖了从基础配置到高级架构设计的多个维度,其中特别强调的两点是:

<span class="hljs-number">1</span>.**约定优于配置不等于零配置**,合理的显式声明往往比隐式行为更可靠   
<span class="hljs-number">2</span>.**微服务的核心挑战是分布式系统问题**,单纯的技术栈升级不能解决架构缺陷    

希望这些经过实战检验的建议能帮助开发者在SpringBoot项目中少走弯路,构建出高性能、易维护的生产级应用。记住,好的框架应该解放生产力而非掩盖问题本质。
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程实战 - Python实用工具与库 - 爬虫防封与代理机制]]></title>    <link>https://juejin.cn/post/7571351275976605747</link>    <guid>https://juejin.cn/post/7571351275976605747</guid>    <pubDate>2025-11-12T00:21:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571351275976605747" data-draft-id="7571352754896437274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程实战 - Python实用工具与库 - 爬虫防封与代理机制"/> <meta itemprop="keywords" content="后端,Python,IPython"/> <meta itemprop="datePublished" content="2025-11-12T00:21:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程实战 - Python实用工具与库 - 爬虫防封与代理机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:21:57.000Z" title="Wed Nov 12 2025 00:21:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在进行网页爬取时，如果频繁访问同一网站，极有可能被网站识别为爬虫，从而封禁 IP 或要求验证码验证。
为了保证爬虫稳定、高效运行，我们需要了解并掌握 <strong>防封机制与代理使用方法</strong>。</p>
</blockquote>
<p>本章将介绍 Python 爬虫中常用的防封策略、代理原理及实战应用技巧。</p>
<hr/>
<h2 data-id="heading-0">一、为什么会被封</h2>
<p>网站封禁爬虫主要是为了防止资源滥用与服务器过载。常见的封禁手段包括：</p>
<ol>
<li><strong>IP 封禁</strong>：短时间内请求频繁，直接拉黑访问 IP。</li>
<li><strong>User-Agent 检测</strong>：识别请求头中是否包含浏览器标识。</li>
<li><strong>Referer 检查</strong>：判断请求是否来自正常页面跳转。</li>
<li><strong>Cookie 校验</strong>：验证登录状态或访问来源。</li>
<li><strong>请求频率限制</strong>：同一用户短时间内过多请求触发反爬。</li>
</ol>
<p>要应对这些情况，我们可以从 <strong>“伪装自己”</strong> 和 <strong>“多IP访问”</strong> 两个方向入手。</p>
<hr/>
<h2 data-id="heading-1">二、请求伪装：模拟真实用户访问</h2>
<h3 data-id="heading-2">1. 设置请求头</h3>
<p><code>requests</code> 支持通过 <code>headers</code> 参数自定义请求头。
常见做法是添加浏览器信息，让服务器认为请求来自正常用户。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://example.com"</span>
headers = {
    <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) "</span>
                  <span class="hljs-string">"AppleWebKit/537.36 (KHTML, like Gecko) "</span>
                  <span class="hljs-string">"Chrome/122.0.0.0 Safari/537.36"</span>,
    <span class="hljs-string">"Referer"</span>: <span class="hljs-string">"https://www.google.com"</span>,
}
response = requests.get(url, headers=headers)
<span class="hljs-built_in">print</span>(response.status_code)
</code></pre>
<hr/>
<h3 data-id="heading-3">2. 随机切换 User-Agent</h3>
<p>为了避免单一 User-Agent 被识别为爬虫，可以在请求中随机切换浏览器标识。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random

user_agents = [
    <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/123.0.0.0 Safari/537.36"</span>,
    <span class="hljs-string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Firefox/124.0"</span>,
    <span class="hljs-string">"Mozilla/5.0 (Linux; Android 10) Mobile Safari/537.36"</span>,
]

headers = {<span class="hljs-string">"User-Agent"</span>: random.choice(user_agents)}
</code></pre>
<p>每次访问时随机选择一个头部，能有效减少被识别风险。</p>
<hr/>
<h3 data-id="heading-4">3. 添加延时与随机等待</h3>
<p>频繁访问网站最容易触发风控。
合理的做法是添加访问间隔，并随机化等待时间：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random

time.sleep(random.uniform(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 等待1~3秒</span>
</code></pre>
<p>这样能让访问节奏更像人类操作。</p>
<hr/>
<h2 data-id="heading-5">三、使用代理服务器（Proxy）</h2>
<p>当 IP 被封时，使用代理服务器可以切换出口 IP，从而继续访问。</p>
<p>代理服务器会代替你访问目标网站，然后将结果返回。
Python 中可以通过 <code>requests</code> 轻松使用代理。</p>
<hr/>
<h3 data-id="heading-6">1. 设置代理参数</h3>
<pre><code class="hljs language-python" lang="python">proxies = {
    <span class="hljs-string">"http"</span>: <span class="hljs-string">"http://123.45.67.89:8080"</span>,
    <span class="hljs-string">"https"</span>: <span class="hljs-string">"http://123.45.67.89:8080"</span>,
}

response = requests.get(<span class="hljs-string">"https://httpbin.org/ip"</span>, proxies=proxies, timeout=<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>如果代理有效，返回的 IP 将与本机不同。</p>
<hr/>
<h3 data-id="heading-7">2. 使用代理池（Proxy Pool）</h3>
<p>手动设置代理不方便，可以使用 <strong>代理池</strong> 自动随机选取可用代理。</p>
<p>简单示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> time

proxies_list = [
    <span class="hljs-string">"http://111.22.33.44:8080"</span>,
    <span class="hljs-string">"http://222.11.55.66:8888"</span>,
    <span class="hljs-string">"http://77.88.99.100:3128"</span>,
]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_random_proxy</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"http"</span>: random.choice(proxies_list), <span class="hljs-string">"https"</span>: random.choice(proxies_list)}

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
    proxy = get_random_proxy()
    <span class="hljs-keyword">try</span>:
        res = requests.get(<span class="hljs-string">"https://httpbin.org/ip"</span>, proxies=proxy, timeout=<span class="hljs-number">5</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"使用代理 <span class="hljs-subst">{proxy[<span class="hljs-string">'http'</span>]}</span> -&gt; <span class="hljs-subst">{res.json()}</span>"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"代理失效："</span>, e)
    time.sleep(random.uniform(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))
</code></pre>
<hr/>
<h3 data-id="heading-8">3. 购买或搭建代理池</h3>
<p>免费代理常常不稳定，建议：</p>
<ul>
<li>使用付费代理服务（如芝麻代理、快代理等）。</li>
<li>自行搭建代理池服务，结合 Redis 存储和自动检测可用 IP。</li>
</ul>
<p>一个简单的代理池架构：</p>
<pre><code class="hljs">爬虫程序 → 请求代理池接口 → 返回可用代理 → 访问目标网站
代理池后台 → 定期检测代理可用性 → 清理无效IP
</code></pre>
<hr/>
<h2 data-id="heading-9">四、Cookie 与会话保持</h2>
<p>某些网站需要登录才能访问数据，这时需要处理 <strong>Cookie</strong>。
可以使用 <code>requests.Session()</code> 自动保持会话状态。</p>
<pre><code class="hljs language-python" lang="python">session = requests.Session()
login_url = <span class="hljs-string">"https://example.com/login"</span>
payload = {<span class="hljs-string">"username"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"password"</span>: <span class="hljs-string">"pass"</span>}
session.post(login_url, data=payload)

<span class="hljs-comment"># 登录成功后继续访问页面</span>
resp = session.get(<span class="hljs-string">"https://example.com/user/profile"</span>)
<span class="hljs-built_in">print</span>(resp.text)
</code></pre>
<p><code>Session</code> 会自动保存登录后的 Cookie 信息，避免每次请求重新认证。</p>
<hr/>
<h2 data-id="heading-10">五、验证码与高级防爬</h2>
<p>有的网站会要求输入验证码或 JavaScript 加密验证请求。
常见应对思路包括：</p>
<ol>
<li><strong>人工辅助识别</strong>：遇到验证码暂停爬取，手动输入。</li>
<li><strong>OCR 识别验证码</strong>：通过 <code>pytesseract</code> 识别简单图片验证码。</li>
<li><strong>模拟浏览器行为</strong>：使用 <code>selenium</code> 或 <code>playwright</code> 执行网页中的 JS 逻辑。</li>
</ol>
<p>示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver

driver = webdriver.Chrome()
driver.get(<span class="hljs-string">"https://example.com"</span>)
<span class="hljs-built_in">print</span>(driver.title)
driver.quit()
</code></pre>
<p>这种方式能绕过大部分基于 JS 渲染或验证的防爬机制。</p>
<hr/>
<h2 data-id="heading-11">六、异常与重试机制</h2>
<p>网络请求容易超时或失败，建议添加异常重试机制。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_request</span>(<span class="hljs-params">url, retries=<span class="hljs-number">3</span></span>):
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(retries):
        <span class="hljs-keyword">try</span>:
            res = requests.get(url, timeout=<span class="hljs-number">10</span>)
            <span class="hljs-keyword">if</span> res.status_code == <span class="hljs-number">200</span>:
                <span class="hljs-keyword">return</span> res.text
        <span class="hljs-keyword">except</span> requests.RequestException:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"第 <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span> 次请求失败，重试中..."</span>)
            time.sleep(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">七、综合实战示例</h2>
<p>综合以上技巧，我们可以实现一个稳定、抗封的爬虫：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests, random, time

headers_list = [
    {<span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 Chrome/122.0.0.0"</span>},
    {<span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 Firefox/124.0"</span>},
]
proxies_list = [
    <span class="hljs-string">"http://123.45.67.89:8080"</span>,
    <span class="hljs-string">"http://222.111.55.66:8888"</span>
]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url</span>):
    headers = random.choice(headers_list)
    proxy = {<span class="hljs-string">"http"</span>: random.choice(proxies_list), <span class="hljs-string">"https"</span>: random.choice(proxies_list)}
    <span class="hljs-keyword">try</span>:
        response = requests.get(url, headers=headers, proxies=proxy, timeout=<span class="hljs-number">10</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"访问成功："</span>, response.status_code, <span class="hljs-string">"IP："</span>, proxy)
        <span class="hljs-keyword">return</span> response.text
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"访问失败："</span>, e)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
    html = fetch(<span class="hljs-string">"https://httpbin.org/ip"</span>)
    time.sleep(random.uniform(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))
</code></pre>
<hr/>
<h2 data-id="heading-13">八、总结</h2>

































<table><thead><tr><th>策略</th><th>说明</th></tr></thead><tbody><tr><td><strong>请求伪装</strong></td><td>设置随机 User-Agent、Referer 等头信息</td></tr><tr><td><strong>请求间隔控制</strong></td><td>使用随机延时，模拟真实用户行为</td></tr><tr><td><strong>代理机制</strong></td><td>通过代理IP切换访问来源</td></tr><tr><td><strong>会话保持</strong></td><td>使用 Session 管理登录状态</td></tr><tr><td><strong>异常重试</strong></td><td>防止临时网络错误导致程序中断</td></tr><tr><td><strong>浏览器模拟</strong></td><td>处理验证码或动态渲染内容</td></tr></tbody></table>
<hr/>
<p>通过合理运用这些防封策略与代理机制，你的 Python 爬虫将更稳定、更高效、更接近真实用户访问行为，为后续数据采集与分析奠定坚实基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程实战 - Python实用工具与库 - 操作Excel：openpyxl / pandas]]></title>    <link>https://juejin.cn/post/7571332468898136091</link>    <guid>https://juejin.cn/post/7571332468898136091</guid>    <pubDate>2025-11-12T00:22:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571332468898136091" data-draft-id="7571351275976622131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程实战 - Python实用工具与库 - 操作Excel：openpyxl / pandas"/> <meta itemprop="keywords" content="后端,面试,Python"/> <meta itemprop="datePublished" content="2025-11-12T00:22:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程实战 - Python实用工具与库 - 操作Excel：openpyxl / pandas
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:22:29.000Z" title="Wed Nov 12 2025 00:22:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在日常数据处理工作中，Excel 是最常见的数据文件格式之一。无论是财务报表、销售统计还是实验数据，Python 都能通过强大的库快速读写和处理 Excel 文件。其中最常用的就是 <strong>openpyxl</strong> 和 <strong>pandas</strong>。</p>
</blockquote>
<p>本文将带你了解这两个库的核心用法，并通过实战示例展示如何高效操作 Excel 文件。</p>
<hr/>
<h3 data-id="heading-0">一、openpyxl：原生 Excel 文件操作库</h3>
<p><code>openpyxl</code> 是一个专门用于读写 <code>.xlsx</code> 文件的纯 Python 库。它支持单元格读写、样式设置、图表创建等高级功能，适合对 Excel 文件结构进行精细控制的场景。</p>
<h4 data-id="heading-1">1. 安装 openpyxl</h4>
<pre><code class="hljs language-bash" lang="bash">pip install openpyxl
</code></pre>
<h4 data-id="heading-2">2. 创建 Excel 文件</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> Workbook

<span class="hljs-comment"># 创建一个新的工作簿</span>
wb = Workbook()
ws = wb.active

<span class="hljs-comment"># 写入数据</span>
ws[<span class="hljs-string">'A1'</span>] = <span class="hljs-string">'姓名'</span>
ws[<span class="hljs-string">'B1'</span>] = <span class="hljs-string">'成绩'</span>
ws.append([<span class="hljs-string">'Alice'</span>, <span class="hljs-number">95</span>])
ws.append([<span class="hljs-string">'Bob'</span>, <span class="hljs-number">88</span>])

<span class="hljs-comment"># 保存文件</span>
wb.save(<span class="hljs-string">'成绩表.xlsx'</span>)
</code></pre>
<p>运行后，你将得到一个包含学生成绩的 Excel 文件。</p>
<h4 data-id="heading-3">3. 读取 Excel 文件</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> load_workbook

wb = load_workbook(<span class="hljs-string">'成绩表.xlsx'</span>)
ws = wb.active

<span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> ws.iter_rows(values_only=<span class="hljs-literal">True</span>):
    <span class="hljs-built_in">print</span>(row)
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-arduino" lang="arduino">(<span class="hljs-string">'姓名'</span>, <span class="hljs-string">'成绩'</span>)
(<span class="hljs-string">'Alice'</span>, <span class="hljs-number">95</span>)
(<span class="hljs-string">'Bob'</span>, <span class="hljs-number">88</span>)
</code></pre>
<h4 data-id="heading-4">4. 修改单元格内容</h4>
<pre><code class="hljs language-python" lang="python">ws[<span class="hljs-string">'B2'</span>] = <span class="hljs-number">98</span>  <span class="hljs-comment"># 修改 Alice 的成绩</span>
wb.save(<span class="hljs-string">'成绩表_修改.xlsx'</span>)
</code></pre>
<h4 data-id="heading-5">5. 设置单元格样式（可选）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> openpyxl.styles <span class="hljs-keyword">import</span> Font, Alignment

ws[<span class="hljs-string">'A1'</span>].font = Font(bold=<span class="hljs-literal">True</span>, color=<span class="hljs-string">"FF0000"</span>)
ws[<span class="hljs-string">'A1'</span>].alignment = Alignment(horizontal=<span class="hljs-string">'center'</span>)
wb.save(<span class="hljs-string">'成绩表_格式.xlsx'</span>)
</code></pre>
<hr/>
<h3 data-id="heading-6">二、pandas：高效的数据分析利器</h3>
<p>如果你更关注数据分析和批量处理，而不是 Excel 的格式细节，那么 <code>pandas</code> 是更高效的选择。
<code>pandas</code> 可以轻松地读写 Excel 文件并与 DataFrame 无缝结合。</p>
<h4 data-id="heading-7">1. 安装 pandas</h4>
<pre><code class="hljs language-bash" lang="bash">pip install pandas openpyxl
</code></pre>
<h4 data-id="heading-8">2. 从 Excel 读取数据</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

df = pd.read_excel(<span class="hljs-string">'成绩表.xlsx'</span>)
<span class="hljs-built_in">print</span>(df)
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">     姓名  成绩
0  Alice  95
1    Bob  88
</span></code></pre>
<h4 data-id="heading-9">3. 修改数据并写回 Excel</h4>
<pre><code class="hljs language-python" lang="python">df.loc[df[<span class="hljs-string">'姓名'</span>] == <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'成绩'</span>] = <span class="hljs-number">90</span>
df.to_excel(<span class="hljs-string">'成绩表_更新.xlsx'</span>, index=<span class="hljs-literal">False</span>)
</code></pre>
<h4 data-id="heading-10">4. 多表格（多 Sheet）操作</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">with</span> pd.ExcelWriter(<span class="hljs-string">'多表格.xlsx'</span>) <span class="hljs-keyword">as</span> writer:
    df.to_excel(writer, sheet_name=<span class="hljs-string">'一班'</span>, index=<span class="hljs-literal">False</span>)
    df.to_excel(writer, sheet_name=<span class="hljs-string">'二班'</span>, index=<span class="hljs-literal">False</span>)
</code></pre>
<h4 data-id="heading-11">5. 从多个 Excel 文件合并数据</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> glob

files = glob.glob(<span class="hljs-string">"data/*.xlsx"</span>)
all_data = pd.concat((pd.read_excel(f) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> files))
all_data.to_excel(<span class="hljs-string">'合并结果.xlsx'</span>, index=<span class="hljs-literal">False</span>)
</code></pre>
<hr/>
<h3 data-id="heading-12">三、openpyxl 与 pandas 的比较</h3>






























<table><thead><tr><th>特性</th><th>openpyxl</th><th>pandas</th></tr></thead><tbody><tr><td>文件类型</td><td><code>.xlsx</code></td><td><code>.xls</code>, <code>.xlsx</code>, <code>.csv</code></td></tr><tr><td>操作粒度</td><td>单元格级别</td><td>表格/数据级别</td></tr><tr><td>适合场景</td><td>精细化格式控制、表格样式、美化</td><td>批量处理、分析计算、数据转换</td></tr><tr><td>是否支持样式</td><td>✅ 是</td><td>❌ 否（仅限数据）</td></tr></tbody></table>
<p><strong>结论：</strong></p>
<ul>
<li>如果你需要精细控制 Excel 外观（如模板、美化），推荐 <strong>openpyxl</strong>。</li>
<li>如果你主要关注数据计算和处理，推荐 <strong>pandas</strong>。</li>
</ul>
<hr/>
<h3 data-id="heading-13">四、实战案例：销售数据汇总</h3>
<p>假设你有多个销售 Excel 文件（如每月销售数据），需要快速汇总并输出总销售额。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> glob

<span class="hljs-comment"># 合并所有销售文件</span>
files = glob.glob(<span class="hljs-string">"sales/*.xlsx"</span>)
df = pd.concat([pd.read_excel(f) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> files])

<span class="hljs-comment"># 汇总计算</span>
summary = df.groupby(<span class="hljs-string">'销售员'</span>)[<span class="hljs-string">'销售额'</span>].<span class="hljs-built_in">sum</span>().reset_index()

<span class="hljs-comment"># 导出结果</span>
summary.to_excel(<span class="hljs-string">'销售汇总.xlsx'</span>, index=<span class="hljs-literal">False</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"汇总完成！"</span>)
</code></pre>
<p>这段代码可以帮你自动读取所有销售文件，统计每位销售员的总销售额，并生成一个新的汇总文件。</p>
<hr/>
<h3 data-id="heading-14">五、总结</h3>
<p>通过本文的学习，你应该掌握了以下内容：</p>
<ol>
<li>使用 <strong>openpyxl</strong> 创建、修改和美化 Excel 文件。</li>
<li>使用 <strong>pandas</strong> 快速读写、分析和汇总 Excel 数据。</li>
<li>理解两者的差异与适用场景。</li>
<li>掌握一个实战级的数据汇总案例。</li>
</ol>
<p>无论你是做数据分析、办公自动化，还是构建数据驱动应用，Excel 操作都是 Python 工具箱中不可或缺的一环。
下一步，你可以继续学习如何用 <strong>pandas</strong> + <strong>Matplotlib</strong> 实现数据可视化，为数据报告添加图形洞察。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今天我去面试游戏开发，说我回答得不全面...]]></title>    <link>https://juejin.cn/post/7571360278970318857</link>    <guid>https://juejin.cn/post/7571360278970318857</guid>    <pubDate>2025-11-12T00:31:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571360278970318857" data-draft-id="7571272874847338548" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今天我去面试游戏开发，说我回答得不全面..."/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-12T00:31:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今天我去面试游戏开发，说我回答得不全面...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:31:34.000Z" title="Wed Nov 12 2025 00:31:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>点击上方亿元程序员+关注和★星标</p>
<h2 data-id="heading-0">引言</h2>
<hr/>
<p><strong>面试官</strong>：“我们上一个项目就在包体大小上吃了亏，你能详细讲讲，有哪些手段可以优化游戏包体吗？”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30ffd41aa8da46ee9e78bb784f457c44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=0GRg1pf8%2Bb9GPi3Jg8kHKsf4lWI%3D" alt="表情包源于网络" loading="lazy"/></p>
<p><strong>我嘴角微微上扬</strong>，这题我会：</p>
<blockquote>
<p>**嗯…**包体优化很重要。</p>
<p><strong>我们</strong>主要是压缩图片，把小的图片合成一张大图，这样可以减少<strong>DrawCall</strong>。</p>
<p><strong>还有</strong>就是音频文件不能太大，要用<strong>MP3</strong>格式。</p>
<p><strong>另外</strong>，构建的时候可以把不需要的引擎模块去掉。</p>
<p><strong>差不多就这些吧</strong>。</p>
</blockquote>
<hr/>
<p><strong>哈喽大家好</strong>，感谢粉丝提供的上面的素材，他说整个面试过程可能就<strong>1-2</strong>分钟，最后被指出回答得不够全面。</p>
<p><strong>如果是我</strong>，我可能觉得没什么问题，但是，既然被指出了，我们还是一起来分析一下。</p>
<h2 data-id="heading-1">面试官为什么觉得“不够全面”？</h2>
<p><del>首先可能面试官心情不好。</del></p>
<p><del>其次呢可能已经招到人了，象征性地面试一下。</del></p>
<p><del>最后应该是缘分未到。</del></p>
<p><strong>上面都是我瞎说的。</strong></p>
<p><strong>我们</strong>一起来拆解一下这位粉丝的回答：</p>
<h3 data-id="heading-2">1.提到了资源优化，但非常笼统：</h3>
<ul>
<li>只说了“压缩图片”和“合图”。</li>
<li>只说了音频用MP3，但没有提到可以根据场景（长背景音乐/短音效）选择不同格式和参数。</li>
</ul>
<h3 data-id="heading-3">2.忽略了资源管理的核心问题：</h3>
<ul>
<li>完全没有提到 “清理未引用资源”。这是导致包体无故增大的最常见原因之一。开发过程中导入又弃用的资源，如果没从项目移除，会被打进包里。</li>
</ul>
<h3 data-id="heading-4">3.对构建配置的理解较浅：</h3>
<ul>
<li>提到了“移除引擎模块”，这是对的，但只是构建配置的其中一项。</li>
<li>完全没有提到 MD5 Cache、代码裁剪、压缩选项（如Zip压缩）等构建面板里的其他利器。</li>
</ul>
<h3 data-id="heading-5">4.缺乏层次感和系统性：</h3>
<ul>
<li>回答是点状的，想到什么说什么，没有形成一个从基础到高级、从开发时到构建时的逻辑链条。这反映出候选人对这个问题的认知是零散的，而非体系化的。</li>
</ul>
<h2 data-id="heading-6">那如何回答“全面又出色”？</h2>
<p><strong>我不要你觉得，我要我觉得！</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38a30f50ad1f41309fbe3ff612211e74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=dG0Jz%2BixuBB%2FHYdMzik1DBoU9AE%3D" alt="表情包源于网络" loading="lazy"/></p>
<p><strong>当然不是上面这样回答</strong>，一个高分的回答，应该像一篇结构清晰的小作文，有层次、有细节、有总结。</p>
<p><strong>可以这样组织语言：</strong></p>
<p><strong>首先</strong>：承上启下，结构化答案</p>
<p><strong>关于</strong>Cocos的包体优化，这是一个系统工程，通常会从 <strong>资源优化</strong>、<strong>代码与引擎优化</strong>、<strong>构建配置优化</strong>以及<strong>进阶策略</strong>这四个层面来综合考虑。</p>
<p><strong>然后</strong>：分点阐述，细节致胜</p>
<h3 data-id="heading-7">1. 资源优化（这是大头，占比最高）</h3>
<ul>
<li><strong>图片资源：</strong>
<ul>
<li><strong>合图：</strong> 主要目的并不是优化包体，使用合图通常只会则增大包体，仅有很极致的美术约束才会减小包体。</li>
<li><strong>清理冗余：</strong> 在构建前，检查未被使用但被误引用的资源。同时，利用“依赖列表”插件，查找并清理完全未被引用的资源。</li>
</ul>
</li>
<li><strong>音频资源：</strong>
<ul>
<li>根据用途区分处理：背景音乐这类长音频，采用高压缩比的<code>MP3</code>；短音效则考虑使用<code>WAV</code>或更低码率的<code>MP3</code>。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6aa545afac28459da0f338a7fd1b5e76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=Sd0jCABMnPRAbyqqQ1S0I20PlBE%3D" alt="表情包源于网络" loading="lazy"/></li>
</ul>
</li>
<li><strong>字体资源：</strong> 对于字体文件，动态裁剪，只保留项目用到的字；</li>
</ul>
<p><strong>2. 代码与引擎优化</strong></p>
<ul>
<li><strong>引擎裁剪：</strong> 在构建时，取消勾选项目根本用不到的引擎模块，比如用不到3D模块、视频播放、WebView等，就一定要把它们去掉，这是最直接的代码体积削减。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/863fc18de28f4194be6ea2ea05c262fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=ev3SpKO2l5TXcASqp%2BU3wLaA0qY%3D" alt="" loading="lazy"/></li>
<li><strong>代码本身</strong>：通过代码压缩或者混淆。就是将你项目里面复杂的命名压缩或者混淆成简短的命名，例如<code>let checkZiYuanIsBeRelease = true</code>压缩或者混淆成<code>let aaa = !0</code>。</li>
</ul>
<p><strong>3. 构建配置优化</strong></p>
<ul>
<li>
<p><strong>MD5 Cache：</strong> 通过这个可以给构建后的所有资源文件名将加上MD5信息，解决CDN资源缓存问题。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d9733940580448fb71a85ca54a56cf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=NW%2F%2F6JX2He1pwZTlRJz%2Fo4b8INM%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>压缩选项：</strong> 在构建Web Mobile时，可以开启Zip压缩，让整个Bundle压缩成为一个Zip文件，体积更小。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73c357bfb4f5471897e6b2c03812905a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=rvX%2Fepyax8GcvkP0u2KKeYzQIoY%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>小游戏平台特殊处理：</strong>
对于微信小游戏等平台，可以使用分离引擎代码，缓存过后无需再次下载。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8df6b38aa8e049948f0ef9af864c0e32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=D%2B0xdGBpEkP2zeaIXwVKloaZQLM%3D" alt="" loading="lazy"/>
引擎原生代码(wasm/asmjs)分包等等。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6159a282a2f5427497a0c57009ac5518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512293&amp;x-signature=%2BXFwGOuSIJHvOvvDkJxRm%2FAed1o%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<p><strong>4. 进阶与架构策略</strong></p>
<ul>
<li><strong>资源动态加载与热更新：</strong> 对于非首屏必须的资源，全部采用动态加载。同时，搭建热更新，让玩家只下载变更的资源，而不是所有资源。</li>
</ul>
<p><strong>最后</strong>：总结与展望</p>
<p><strong>根据</strong>不同过的项目选择不同的优化策略，但是可以遵循一个思路：先清理后压缩、先静态后动态、先通用后平台。</p>
<h2 data-id="heading-8">结语</h2>
<p><strong>面试</strong>不仅仅是知道“是什么”，更重要的是展现你如何系统性地思考问题和解决问题。</p>
<p><strong>但是</strong>面试有时候除了看看面试者的水平外，还有很多其他因素，小伙伴们知道都有哪些吗？</p>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐专栏：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3175880857546129410%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3175880857546129410#wechat_redirect" ref="nofollow noopener noreferrer">知识付费专栏</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26mid%3D2247487282%26idx%3D1%26sn%3De3cb8ab6f5c0d5f804d5c29e2e90b9ad%26chksm%3Dc00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54%26token%3D336413522%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NTY2MjIzMg==&amp;mid=2247487282&amp;idx=1&amp;sn=e3cb8ab6f5c0d5f804d5c29e2e90b9ad&amp;chksm=c00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54&amp;token=336413522&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3207702867494305797%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3207702867494305797#wechat_redirect" ref="nofollow noopener noreferrer">100个Cocos实例</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3073771187570999299%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3073771187570999299#wechat_redirect" ref="nofollow noopener noreferrer">8年主程手把手打造Cocos独立游戏开发框架</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3121583619634626562%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3121583619634626562#wechat_redirect" ref="nofollow noopener noreferrer">和8年游戏主程一起学习设计模式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3Faction%3Dgetalbum%26__biz%3DMzg5NTY2MjIzMg%3D%3D%26scene%3D1%26album_id%3D3038883468588089350%26count%3D3%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg5NTY2MjIzMg==&amp;scene=1&amp;album_id=3038883468588089350&amp;count=3#wechat_redirect" ref="nofollow noopener noreferrer">从零开始开发贪吃蛇小游戏到上线系列</a></p>
<p>点击下方灰色按钮+关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[稚晖君公司的最新工资和招人标准]]></title>    <link>https://juejin.cn/post/7571352754896535578</link>    <guid>https://juejin.cn/post/7571352754896535578</guid>    <pubDate>2025-11-12T00:45:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571352754896535578" data-draft-id="7571352754896502810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="稚晖君公司的最新工资和招人标准"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-11-12T00:45:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CodeSheep"/> <meta itemprop="url" content="https://juejin.cn/user/4371313961738616"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            稚晖君公司的最新工资和招人标准
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313961738616/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CodeSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:45:43.000Z" title="Wed Nov 12 2025 00:45:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为具身智能领域的独角兽，智元机器人这两年在资本市场可谓是备受关注.</p>
<p>谁都没有想到，这家成立仅仅才两年的创业公司，如今已经成为了国内具身智能领域估值最高的公司之一。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66a1445752bf4b22bae1105708bf8456~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=BOhfiqDbXH4%2FJsoGwg0mjCtsnvg%3D" alt="" loading="lazy"/></p>
<p>成立两年多，智元已经完成了多轮次融资。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23ab85ed82d140f99806b3db5ef49a1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=jGj3B5JX0KmPxAoZvz1xqCOiMn4%3D" alt="" loading="lazy"/></p>
<p>而当我们翻开智元机器人的股东名册，可是堪称科技创投界的“明星阵容”：既有高瓴创投、红杉中国、鼎晖投资等顶级风投；也包含比亚迪、上汽、北汽等车企巨头；除此之外还有像立讯精密等这样的产业龙头。</p>
<p>包括不久前腾讯和京东这两大互联网巨头在具身智能领域的投资纷纷也都选择了智元，这也充分证明这家公司在资本市场的独特地位。</p>
<p>众所周知，一个月前智元正式官宣合伙人团队，正式公布了「七人核心团队」名单，揽扩了包括技术研发、市场营销、业务开发和人力资源等<strong>各个领域的精英</strong>。</p>
<p>看到这里，<strong>相信大家也挺好奇</strong>，既然这个公司在资本市场如此出圈，外加又有各路大佬相继为之奔赴，那他们<strong>在业内的「薪资水平」和「招人标准」究竟又是怎样的呢</strong>？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76bc646554014d268ea648752f8754b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=XtQsCS0bCKNlpP6O0wecRHxaNzA%3D" alt="" loading="lazy"/></p>
<p>包括前段时间智元 2026 校招启动时，也有不少同学也关心这家公司的「招聘岗位」和「薪资待遇」。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14d69b119a3347c3b72de20108cbe8aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=Ep5lFOQpuY8B6Ay4bswlUi4F4lo%3D" alt="智元2026校园招聘官方海报" loading="lazy"/></p>
<p>正好最近，我发现智元在某招聘平台上<strong>又更新了一大波最新招聘信息和岗位</strong>，而其中<strong>近八成</strong>都是技术研发岗。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f70b59b5ada8468dbe7fb316fba848e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=joque0JrxwuBqHvgOUgRC5rQIcM%3D" alt="" loading="lazy"/></p>
<p>其工作地点主要 base 在北京、上海和深圳。</p>
<p>就技术研发岗而言，智元的招聘岗位基本覆盖了机器人研发的各个环节，而且<strong>核心岗全开放</strong>。</p>
<p>具体来看，热招岗位包括：</p>
<ul>
<li><strong>算法类</strong>：具身算法工程师、运动控制算法工程师、多模态大模型算法工程师等</li>
<li><strong>软件系统类</strong>：C++开发工程师、仿真系统开发工程师、嵌入式软件工程师等</li>
<li><strong>硬件与结构类</strong>：结构工程师、硬件工程师等</li>
<li><strong>测试类</strong>：软件测试工程师、硬件测试工程师、测试开发工程师等</li>
</ul>
<p>而非技术研发岗这一块，智元也提供了包括<strong>生产</strong>、<strong>运营</strong>、<strong>采购</strong>、<strong>市场</strong>、<strong>销服</strong>、<strong>策划</strong>以及其他诸多<strong>职能类</strong>、<strong>支持类</strong>岗位。</p>
<p>话不多说，<strong>先来看看岗位 JD 和招人标准。</strong></p>
<p>这里也集中梳理了一下，比如：</p>
<ul>
<li>
<p><strong>具身算法类岗位</strong>基本都是机器人操作（比如灵巧手之类）算法研究，要懂大模型，要懂强化学习，有仿真能力和工程能力那更是头等加分项。</p>
</li>
<li>
<p><strong>运控类岗位</strong>则需要懂机器人学、刚体运动学、刚体动力学，掌握常用的FK/IK方法基本是标配，RBDL、Pinocchio 等动力学库玩得溜的话那是最好不过的了。</p>
</li>
<li>
<p><strong>仿真开发类岗位</strong>则需要你懂机器人仿真平台，熟悉 ROS2 以及 Isaac Sim、MuJoCo 等具体的仿真引擎或平台。</p>
</li>
</ul>
<p><strong>可以说，想在智元做技术，熟练 Python/C++ 编程是标配，熟悉 ROS/ROS2 系统是标配，熟悉机器人仿真工具基本还是标配</strong>。</p>
<p>同时如果你还有 RoboMaster 等<strong>竞赛经验</strong>、机器人<strong>顶会</strong>（ICRA、RSS、IROS等）或<strong>期刊</strong>（T-RO、IJRR、T-FR、T-MECH等）的论文的话，那恭喜你，这可就太吃香了。</p>
<p>再具体一点来看，算法类我们以「<strong>具身算法工程师</strong>」岗位为例，大家可以详细直观感受一下他们的详细招聘标准和岗位要求。</p>
<blockquote>
<p><strong>职位描述</strong></p>
<ul>
<li>设计并实现VLA算法方案，以量产落地为导向，熟悉RT-1/2、pi0等主流多模态具身大模型优劣，改善调优</li>
<li>负责机器人具身操作任务的强化学习算法设计、开发和优化 优化Sim2Real的迁移技术，提高算法鲁棒性；跟踪前沿技术，进行强化学习算法的调研、性能对比和评估</li>
<li>研究多模态学习方法，结合视觉、触觉、力反馈提升机器人决策能力 包括VLM的训练与微调，实现模型实际场景的落地需求，多模态数据集的构建、清洗等，提升算法性能和决策质量等</li>
</ul>
</blockquote>
<blockquote>
<p><strong>职位要求</strong></p>
<ul>
<li>计算机科学、人工智能、机器人工程或相关领域硕士及以上学历</li>
<li>具备深度学习、计算机视觉和自然语言处理的扎实理论基础和实践经验</li>
<li>熟练掌握Python、C++等编程语言，有使用PyTorch、TensorFlow等深度学习框架的经验</li>
<li>熟悉VLM/MLLM模型的训练流程，了解常见的增量训练方法与微调方法</li>
<li>熟悉主流的多模态预训练基座，熟悉多模态对齐等关键技术</li>
<li>具备良好的团队合作精神和沟通能力，能够通过团队协作推进项目进展</li>
</ul>
</blockquote>
<p>可以看到，其对学历、特定垂直领域的编程能力和开发经验等都有不低的要求，如果有科研成果、论文或者竞赛加持，那更是加分项。</p>
<p>而类似于「<strong>C++软件开发工程师</strong>」这样的开发类岗位，其所要求的编码经验和工程能力也都是需要与<strong>机器人控制</strong>、<strong>通信协议</strong>、<strong>控制工程</strong>等强相关。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fea8dcef68f24317a7b47cec9bc35c0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=xhAPcxc2WLS4Lh2vSDn3Z%2Bu9mKA%3D" alt="" loading="lazy"/></p>
<p>除了常规技术招聘岗之外，智元还设有面向全球顶尖技术人才的<strong>优才计划</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1e1b88d0b8242b7844864dd4b1f0f2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=xM5PPtKQ7lju5gvO08jiXrrAtzM%3D" alt="" loading="lazy"/></p>
<p>该计划主要面向公司内部的「<strong>智元 X-Lab</strong>」和「<strong>智元具身研究中心</strong>」两大核心技术研究中心，其中前者直接由 CTO 稚晖君直接管理，而后者则由具身大佬罗剑岚博士亲自牵头组建和带队。</p>
<p>大家如果想进智元做技术的话，能进这两大技术研究中心简直不要太香啊，两位领域内顶尖的 90 后技术大佬亲自带队培养，成长速度直接拉满！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8bee41a70d34b0480f1efbf986081ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=7aLvKiu4JfcN1bqLE8YoDiZ42Fo%3D" alt="" loading="lazy"/></p>
<p>聊完岗位 JD 和招人标准，接着我们<strong>再来看一眼薪资数据</strong>。</p>
<p>怎么说呢，放在垂直领域内来看还算比较具有吸引力，不是最顶尖，但是普遍都不低，大多都是 15 薪。</p>
<p>细看了一下，其中「<strong>算法岗</strong>」和「<strong>机器人研发核心岗</strong>」薪资段位基本是最高的，不少都能给到 （30K-60K）*15 薪的水平：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/393298556cba41a1bd6659e10b0f4475~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=3QXJAON8sPT7BB03ffK8rNhPdAg%3D" alt="" loading="lazy"/></p>
<p>当然像「算法专家」、「算法架构师」、「算法总监」这类岗位薪资会给的更高，基本都是（50K-80K）*15 薪这样一个水平，这种高端岗位基本都是奔着年入百万去的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe42296d11d941d1a0eaf37560f75023~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=rxOqjW9h14JXk%2FzRqU%2B2Pr4yQqw%3D" alt="" loading="lazy"/></p>
<p>而类似「<strong>软件开发</strong>」、「<strong>C++开发</strong>」等开发岗较算法岗薪资相比基本是要低上一档，大致范围锚定在（20K-40K）*15 这样一个区间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/177a6520a9c34e119c4f93ca8c643650~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=YdOEiJgfOd5DO9ftPxXjuj8snf0%3D" alt="" loading="lazy"/></p>
<p>大家觉得这个数据怎么样？</p>
<p>除此之外，智元官网还发布了很多与实习相关的岗位招聘，大模型实习、具身算法实习、嵌入式实习、硬件实习等等都有。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bae291d12f64fdd96e769e194faa235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513142&amp;x-signature=ovpr1jwnVf9VqWWVP0w00%2FVDLVo%3D" alt="" loading="lazy"/></p>
<p>实习生实习待遇这块基本锚定在本科 200-300元/天，硕士 300-400元/天，博士 500-600元/天，表现优秀的话有项目奖金，此外还提供一日三餐、加班餐补，部分城市有提供实习宿舍或住房补贴等。</p>
<p>总体来看，作为一家机器人初创公司，这个薪资水平放到行业来看算不上最顶尖，但也还可以，同时从这些招聘信息中也能折射出这家年轻企业对技术创新和卓越人才的渴求。</p>
<p>对于有志于投身机器人行业的专业人士和年轻学子来说，智元的确是一个值得关注的平台。</p>
<p>在当今快速发展的人工智能领域，具身智能机器人已经成为最炙手可热的赛道之一，作为科技密集型行业，并且目前处于上行期，后面潜力可期，感兴趣的小伙伴果断可以试试。</p>
<p>好了，那以上就是今天的内容分享了，希望能对大家有所帮助，我们下篇见。</p>
<blockquote>
<p>注：本文在GitHub开源仓库「编程之路」 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frd2coding%2FRoad2Coding" target="_blank" title="https://github.com/rd2coding/Road2Coding" ref="nofollow noopener noreferrer">github.com/rd2coding/R…</a> 中已经收录，里面有我整理的6大编程方向(岗位)的自学路线+知识点大梳理、面试考点、我的简历、几本硬核pdf笔记，以及程序员生活和感悟，欢迎star。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[来了解一下，为什么你的 Flutter WebView 在 iOS 26 上有点击问题？]]></title>    <link>https://juejin.cn/post/7571306072423448618</link>    <guid>https://juejin.cn/post/7571306072423448618</guid>    <pubDate>2025-11-12T00:48:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072423448618" data-draft-id="7571348736153174052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="来了解一下，为什么你的 Flutter WebView 在 iOS 26 上有点击问题？"/> <meta itemprop="keywords" content="Android,Flutter,前端"/> <meta itemprop="datePublished" content="2025-11-12T00:48:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            来了解一下，为什么你的 Flutter WebView 在 iOS 26 上有点击问题？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:48:32.000Z" title="Wed Nov 12 2025 00:48:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前段时间 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F175099" target="_blank" title="https://github.com/flutter/flutter/issues/175099" ref="nofollow noopener noreferrer">#175099</a> 又提出了一个  iOS 26  的问题，大概就是 <code>webview_flutter</code> 的点击事件又出现了“点不动”或“点了不触发” 的情况，源头还是 <strong>WKWebView（WebKit）内部的手势识别器与 Flutter 在 Engine 里用于“阻止/延迟”手势的 recognizer 之间的冲突</strong>。</p>
<p>针对和这个问题，去年 iOS 18.2  beta 里有出现类似情况，而那时候在 Engine 里，可以通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fengine%2Fpull%2F56804%2Ffiles" target="_blank" title="https://github.com/flutter/engine/pull/56804/files" ref="nofollow noopener noreferrer">#56804</a> 这个 PR，临时移除并再添加 <code>delayingRecognizer</code> 的实现来暂时绕过问题，<strong>主要是通过刷新 WebKit 的内部状态从而临时修复</strong>，但这个绕过在 iOS 26 上造成了另一个严重回归（overlay 的手势阻止失效、触摸穿透底下的 WebView），因此在最近被针对 iOS 26 的条件下回退（revert）了该提交。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f6feca614be4cceb0fb9faa35caa7d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=%2Bswyzp5RL6k6T5wFGilvuDrFs0I%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>另外也是因为 Flutter 团队发现这是 Apple / WebKit 的 bug ，所以也已经同步上报请求和 Apple 协作。</p>
</blockquote>
<p>问题最开始出现在 iOS 18.2 beta 版本上，当页面上先触发了某些 Flutter widget（或者 overlay，比如 context menu / Drawer）后，<strong>WKWebView 内的点击（链接、按钮）不再响应</strong>（可高亮，但不会激活），需要重新加载 WebView 才恢复。</p>
<p>而具体原因在于，Flutter 在 iOS 的 PlatformView（例如承载 WKWebView 的视图）上实现了一套“手势拦截/延迟”机制：在需要时会把一个 <code>FlutterDelayingGestureRecognizer</code>（<code>delayingRecognizer</code> ）切到某些状态（<code>possible</code>, <code>ended</code>, <code>failed</code> 等）来告诉 UIKit 或者其他 recognizers 是否应该阻止/允许手势传递。</p>
<p>而 UIKit 的手势识别器有自己的状态机（<code>possible</code> → <code>recognized/failed</code> / <code>ended</code> ），不同 recognizer 相互之间会有阻塞/依赖关系：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecab37a2a3a94e3185c643faca291935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=Hgu%2FfYJ3tDGsK7jMeYJp3P%2FXUWw%3D" alt="https://developer.apple.com/documentation/uikit/about-the-gesture-recognizer-state-machine" loading="lazy"/></p>
<p>这里需要简单介绍一个背景知识：<strong>Flutter + iOS 平台视图的手势处理机制</strong>，在 iOS 上当你把一个原生控件（比如 WKWebView）嵌进 Flutter 时，实际上会经历以下层级：</p>
<pre><code class="hljs language-objectivec" lang="objectivec">[FlutterView]               ← 整个 Flutter 渲染层（Dart UI 层）
   ├─ Flutter widgets
   │     ↑
   │     │ 手势事件由 Flutter framework（Dart）处理
   │
   └─ PlatformView (e.g. <span class="hljs-built_in">WKWebView</span>)
         ↑
         │ 手势事件由 <span class="hljs-built_in">UIKit</span> / WebKit 内部 recognizer 处理
</code></pre>
<p>Flutter 和 UIKit 都各自有手势识别系统（GestureRecognizer），为了防止互相抢事件，Flutter engine 在 iOS 上加入了一个“<strong>delaying gesture recognizer</strong>”（延迟识别器）：</p>
<blockquote>
<p>它的作用是：当 Flutter 框架检测到某个 widget 想“阻止”事件时（比如 <code>GestureDetector</code> 或 overlay 遮罩），Flutter 会让这个 <code>delayingRecognizer</code>  阻止 UIKit 里的 recognizer（例如 WKWebView 的点击识别器）响应。</p>
</blockquote>
<p>这个系统在 Flutter → UIKit 手势交界处非常敏感，而问题就出现在：<strong>WebKit（WKWebView）内部的某些 recognizer 会“缓存”或持有对  <code>delayingRecognizer</code>  的“旧状态”</strong>，导致当 Flutter 在运行时切换 <code>delayingRecognizer</code>  状态（例如 blockGesture）时，WebKit 的部分识别器获取到了过时状态，从而无法触发正确的“激活 click”逻辑，例如：</p>
<blockquote>
<p>它们可能只看到 <code>failed</code>/<code>possible</code> 的不一致组合，导致只高亮不执行动作。</p>
</blockquote>
<p>针对这个问题，在 iOS 18.2 时，Flutter 团队进行了多种尝试，比如 toggle <code>enabled</code>、插入 dummy recognizer、异步 dispatch、重建 recognizer 实例等，最后发现<strong>移除并重新添加同一个 <code>delayingRecognizer</code>  实例</strong> 会触发 UIKit 重新刷新相关 recognizers 的关联，从而让 WebKit 的内部识别器看到“最新”状态并恢复点击功能：</p>
<blockquote>
<p>在 blockGesture 的处理流程里把  <code>delayingRecognizer</code>  <strong>移除后再添加回去</strong>，以强制 UIKit/WebKit 刷新识别器关系，这个功能应该是在 3.29 的版本里发布了：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49dcd06d72024bc7bd4506f482b6f8db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=ry8WmjTkiUzE948oA6mOnhgBX40%3D" alt="" loading="lazy"/></p>
</blockquote>
<p>不过在 iOS 26 上，这个“移除再添加”的操作带来了新的严重问题：<strong>Flutter 的手势阻塞系统在某些场景（比如 Drawer/overlay）里完全失效，触摸会穿透到下面的 WebView</strong>，这比“点不动”更糟，因为会造成错点与功能错乱。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8029c396e4d84899a1ae6fbe828fe012~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=ppgexoEpirehhIZo6%2Ft3n2w2hnA%3D" alt="" loading="lazy"/></p>
<p>所以，Flutter 在针对 <strong>iOS 26（<code>@available(iOS 26.0, \*)</code>）上不再执行“移除再添加 <code>delayingRecognizer</code>  ” 的绕过逻辑</strong>，但回退会让之前通过绕过解决的“WebView 点不动”问题在 iOS 26 上再次出现。</p>
<blockquote>
<p>很明显这是一个 iOS 18.2 时 WKWebView 自身就存在的 bug，并且因为系统升级修改，WebKit 内部 recognizer 缓存行为在新版 iOS 上变化，所以如果要完成修复问题，还是需要和 Apple 一起修复处理。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bae374d84a74f96955847ed2ddd9fff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=inBSX8X19Dxhz6C%2B8nT3Ba5cESE%3D" alt="" loading="lazy"/></p>
<p>所以问题主要出现的场景在于：“<strong>必须在 WebView 上出现过 overlay 或类似触摸阻止的 widget” 才会触发 Bug</strong> ，比如：</p>
<ul>
<li>打开了一个半透明的 ModalBarrier</li>
<li>弹出了一个 Drawer</li>
<li>显示了一个半透明的 PopupMenu</li>
<li>使用了 <code>showDialog()</code></li>
<li>甚至某些动画（Hero ）在内部也会临时创建 overlay 层</li>
</ul>
<p>这些操作的里根本的诱饵就是：“要阻止触摸传递到底层 platform view” ，于是 engine 调用 <code>delaying_recognizer.blockGesture(true)</code>；，WKWebView 的内部 recognizer 因此暂停触发，然后 overlay 消失后，engine 再执行 <code>blockGesture(false)</code> ，但是 UIKit 没有恢复 WKWebView recognizer 的响应，从而导致问题。</p>
<blockquote>
<p>而在 iOS18.2 可以通过 remove/add 的方式来重置刷新状态，但是在 iOS 26 上 Recognizer 重新添加后，看起来系统会重新建立默认的依赖关系，也就是当 Flutter 把 delaying recognizer 移除再添加时，UIKit 不仅刷新了它的依赖， 还重置了某些全局 recognizer 的 <code>delaysTouchesBegan</code> / <code>requiresFailureOf</code> 配置，这些配置正是 Flutter engine 用来防止 overlay 点击穿透的相关逻辑。</p>
</blockquote>
<p><strong>而针对这个问题，目前社区层面的临时解决方法是通过 <code>pointer_interceptor </code> 来规避 overlay 与 WebView 的事件竞争</strong>，核心是在 iOS 26 上的 WebView ，只要在它上方有视图并点击就会导致它停止接受点击，而在此之前 WebView  一直可以正常工作，所以使用 PointerInterceptor 可以防止在与 WebView 上方的视图交互后中断 WebView，例如：</p>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-comment">// to know anytime if we are on top of navigation stack</span>
  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> _isTopOfNavigationStack =&gt; ModalRoute.of(context)?.isCurrent ?? <span class="hljs-keyword">false</span>;

  <span class="hljs-comment">// Wrapper for the webview</span>
  Widget buildWebviewWithIOSWorkaround(BuildContext context) {
    <span class="hljs-keyword">return</span> Stack(
      children: [
        buildWebView(context),
        <span class="hljs-keyword">if</span> (Platform.isIOS)
          Positioned.fill(
            child: PointerInterceptor(
              intercepting: !_isTopOfNavigationStack, <span class="hljs-comment">// the webview is not on top -&gt; inhib click</span>
              debug: <span class="hljs-keyword">false</span>,
              child: <span class="hljs-keyword">const</span> SizedBox.expand()
            ),
          )
      ],
    );
  }
</code></pre>
<p>另外，在和 Apple 进行问题推动修复的同时，Flutter 也在需求一些外部解决思路，例如通过全新的 <code>HitTest</code> 来规避问题：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a43281ac96a408f9691d60eca07cdf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=g7qiy%2Bf8CEIaGn7hu6qu5CF%2BLPM%3D" alt="" loading="lazy"/></p>
<p>根据   <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F176597" target="_blank" title="https://github.com/flutter/flutter/pull/176597" ref="nofollow noopener noreferrer">#176597</a>  ，主要基于假设大多数用例平台视图只有一个重叠，如果触摸位置在 Flutter  Widget 和平台视图之间的“重叠”范围内，Flutter 会阻止平台视图上的所有 UIGestureRecognizer，具体为：</p>
<ul>
<li>定义了一个新的拦截策略枚举值：<code>FlutterPlatformViewGestureRecognizersBlockingPolicyHitTestByOverlay</code>（ “通过 overlay 层的 hitTest 来阻止手势”）</li>
<li>在 platform view 的 touch / hitTest 逻辑里加入判断：如果某点落在 overlay 区域，就让 <code>hitTest:</code> 返回拦截自己（<code>self</code>），而不是默认走到底层 WebView，也就是说 <strong>在 Flutter 层“用 hitTest”来屏蔽底层点击</strong></li>
<li>在 <code>blockGesture</code> 方法里，对于这种 overlay-hitTest 类型的策略，PR 把原来 <code>blockGesture</code> 的逻辑改为 “no-op”（什么都不做），因为在这个策略下，“拦截”是在 hitTest 层做了，不需要再在 delaying recognizer 层去干预</li>
<li>在 controller 更新 overlay 层（<code>bringLayersIntoView:</code>）时，把 overlay 视图引用记录下来，并赋给内部的 intercepting view（<code>interceptor.overlays = overlays;</code>）这样拦截逻辑有 overlay 区域信息可用</li>
</ul>
<p>总的来说，<strong>改动提供了一种 “hitTest 层面的 overlay 拦截” 策略，不依赖 delaying recognizer 的状态切换，以避免手势状态切换带来的复杂性</strong>：</p>
<blockquote>
<p>但是，如果多个重叠被合并到一个触摸阻挡区域时，blocking area 将是一个包含所有重叠的区域。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c6a8fa7d1c144d6b6a4b0da011d860d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=HXKEciN%2Fg5%2B0dRoFpjYMsmIeHMs%3D" alt="" loading="lazy"/></p>
<p>不过维护人员在进行到一半的时候发现，完整解决方案也许并不难推进（<em>我感觉是他的一厢情愿居多</em>），所以决定关闭临时的 MVP 方案：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23ee7c5c4a1645e58fe19393929a8521~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=W0UyNj%2FMTs%2BDaqNwt4IXgAEDJt4%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7a849e4aa7d456fb833df1f95f82c83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763513312&amp;x-signature=zZzoRxEbg1Zwku5nF4%2BZc03iuww%3D" alt="" loading="lazy"/></p>
<p><strong>完整的解决方案，是依赖于 FFI 从 Flutter 的手势竞技场同步查询来做出决定，不过这又是属于另外一个重大改动了</strong>。</p>
<p>所以目前推进流程进入到了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F177859" target="_blank" title="https://github.com/flutter/flutter/pull/177859" ref="nofollow noopener noreferrer">#177859</a> ，PR 将 <strong>不再通过“延迟（delaying）手势识别器”来阻塞 platform view 的手势</strong>，改成在 iOS 端对触点做 <strong>同步 hit-test（利用 FFI 从 framework 查询是否应接受/阻止该手势）</strong>，解决了 web_view / admob 等平台视图不可点按的问题，并新增一个可选的 blocking policy（<code>FlutterPlatformViewGestureRecognizersBlockingPolicyHitTest</code>）</p>
<p>具体调整有：</p>
<ul>
<li>
<p><strong>从“延迟识别器（delaying recognizer）”切换到“hit test”决策</strong></p>
<ul>
<li>以往的方案是把识别器设置成 delaying 类型，然后用延迟决策来阻塞/接受手势，本次 PR 直接改成直接做 hit test 判断是否应阻止该手势（在触点处是否落在应该被 platform view 拦截的区域）</li>
</ul>
</li>
<li>
<p><strong>FFI 同步调用框架（framework）以避免死锁</strong></p>
<ul>
<li>直接让 embedder 在主线程等待 framework 的异步回应会导致主线程互相等待（deadlock），利用 FFI 在 native 层<strong>同步调用</strong>框架中的函数（_platformViewShouldAcceptGesture<code>/</code>platformViewShouldAcceptGesture`）来获得是否接受手势的结果，从而避免线程死锁问题</li>
</ul>
</li>
<li>
<p><strong>新增/修改 policy 与 API 辅助</strong></p>
<ul>
<li>通过 <code>FlutterPlatformViewGestureRecognizersBlockingPolicyHitTest</code>，逐步采纳并降低全局回归风险（也就是说不把旧策略直接替换掉，而是增加新的策略供插件或内部使用）</li>
</ul>
</li>
</ul>
<p>PR 还涉及 engine 的 UI 层（ <code>engine/src/.../hooks.dart</code>、<code>platform_configuration.cc</code> 等）以及 iOS 平台 view / embedder 相关代码， 这些改动把 hit-test 的入口函数和 FFI 绑定、以及 platform view 手势决策路径连接起来 。</p>
<p>所以，这会是一个涉及很多地方的底层调整，也算是一个高风险的修改，特别是 iOS 平台 view（platform view）手势处理路径（尤其 web_view、admob、任何嵌入 UIView 的插件），目前建议事是需要插件作者（特别是官方 1P 插件）切换使用新 policy。</p>
<p>当然，PR 还需要等等，目前除此之外，我们也可以做的规避问题还有：</p>
<ul>
<li><strong>避免在 WebView 上方显示需要拦截手势的复杂 overlay（尽量减少交互型 overlay）</strong>，如果能避免覆盖 WebView，问题就不会触发</li>
<li><strong>在 overlay 关闭后重载或重建 WebView（重建 controller / reload）</strong>，不过这种造成的闪烁其实并不友好</li>
</ul>
<p>所以目前的方向，应该是先完成 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F176597" target="_blank" title="https://github.com/flutter/flutter/pull/176597" ref="nofollow noopener noreferrer">#176597</a> 的 PR，之后再实现 FFI 从框架中进行查询的完整解决方案，也就是从目前来说：</p>
<ul>
<li>对于 iOS 18.2 上的因为重叠控件导致  WebView 点击问题，需要 3.29 以及以上版本解决</li>
<li>对于 iOS 26 上的因为重叠控件导致  WebView 点击问题
<ul>
<li>3.35.4 之前，会出现触摸穿透问题</li>
<li>3.35.4 之后，由于 cp revert，会恢复成点击无效问题</li>
<li>以上两个问题可以使用  <code>pointer_interceptor </code> 来尝试规避</li>
</ul>
</li>
<li>等待官方内置 HitTest 和 FFI 解决方案发布</li>
</ul>
<p>只能说，之前发布的线程合并为 FFI 提供了支持的基础，也为这次调整的方向提供了一种全新的思路，只是这个修改需要更加谨慎。</p>
<h2 data-id="heading-0">参考链接</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F176597" target="_blank" title="https://github.com/flutter/flutter/pull/176597" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F175099" target="_blank" title="https://github.com/flutter/flutter/issues/175099" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F177859" target="_blank" title="https://github.com/flutter/flutter/pull/177859" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[H5开发避坑！解决Safari浏览器的video会覆盖z-index:1的绝对定位元素]]></title>    <link>https://juejin.cn/post/7571299394346156074</link>    <guid>https://juejin.cn/post/7571299394346156074</guid>    <pubDate>2025-11-12T00:34:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571299394346156074" data-draft-id="7569946369989886015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="H5开发避坑！解决Safari浏览器的video会覆盖z-index:1的绝对定位元素"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-12T00:34:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            H5开发避坑！解决Safari浏览器的video会覆盖z-index:1的绝对定位元素
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:34:14.000Z" title="Wed Nov 12 2025 00:34:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p><code>H5</code>开发中，跨浏览器兼容性问题总数让人脑壳疼。最近我在开发视频相关页面时，就遇到了一个典型的浏览器兼容问题：相同的层叠布局代码，在<code>Chrome</code>浏览器中表现正常，而在<code>Safari</code>浏览器（包括macOS和iOS版本）中，本该显示在视频上方的绝对定位图标却离奇消失，我初步估计是被<code>video</code>元素完全覆盖了。下面我将从问题复现、根源剖析到解决，一步一步拆解思路，希望可以帮到有同样遭遇的开发者。</p>
<h2 data-id="heading-0">1. 问题场景复现</h2>
<p>场景布局很简单：外层一个<code>relative</code>定位的<code>div</code>容器，内部包含<code>video</code>视频元素和一个<code>absolute</code>定位的关闭按钮图标，图标设置<code>z-index:1;top: 8px;right: 8px;</code>置于视频右上角，如下：</p>
<p><strong>HTML：</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-wrapper"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">video</span>
		<span class="hljs-attr">autoplay</span>
		<span class="hljs-attr">loop</span>
		<span class="hljs-attr">muted</span>
		<span class="hljs-attr">playsinline</span>
		<span class="hljs-attr">webkit-playsinline</span>
		<span class="hljs-attr">disablepictureinpicture</span>
		<span class="hljs-attr">disable-remote-playback</span>
		<span class="hljs-attr">poster</span>
		<span class="hljs-attr">controlsList</span>=<span class="hljs-string">"nodownload nofullscreen noremoteplayback noplaybackrate"</span>
		<span class="hljs-attr">class</span>=<span class="hljs-string">"video-dom"</span>
	&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./water-drop.mp4"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/mp4"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您的浏览器不支持 video 标签<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"badge"</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>CSS：</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.main-wrapper</span> {
	<span class="hljs-attribute">position</span>: relative;
	<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
}
<span class="hljs-selector-class">.video-dom</span> {
	<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
	<span class="hljs-attribute">object-fit</span>: contain;
}
<span class="hljs-selector-class">.badge</span> {
	<span class="hljs-attribute">position</span>: absolute;
	<span class="hljs-attribute">top</span>: <span class="hljs-number">8px</span>;
	<span class="hljs-attribute">right</span>: <span class="hljs-number">8px</span>;
	<span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
	<span class="hljs-attribute">width</span>: fit-content;
	<span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
	<span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.7</span>);
	<span class="hljs-attribute">padding</span>: <span class="hljs-number">0px</span> <span class="hljs-number">8px</span>;
	<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
	<span class="hljs-attribute">color</span>: white;
	<span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
	<span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
	<span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;
}
</code></pre>
<p>而两大浏览器表现如下：</p>
<ul>
<li>
<p><strong>Chrome浏览器</strong>：表现正常，关闭图标稳定显示在视频右上角，层级正确。</p>
</li>
<li>
<p><strong>Safari浏览器</strong>：图标完全消失，通过开发者工具检查发现图标确实存在于DOM中，但被video元素完全覆盖，z-index:1未生效。</p>
</li>
</ul>
<h2 data-id="heading-1">2. 根源剖析</h2>
<p>要解决问题，必须先搞懂“为什么”。表面上看是<code>z-index</code>失效，但本质是<code>Safari</code>与<code>Chrome</code>对<strong>层叠上下文</strong>和<strong>特殊元素渲染机制</strong>的处理存在差异，核心原因有两点。</p>
<h3 data-id="heading-2">2.1. 层叠上下文的隐性规则</h3>
<p>根据CSS层叠规范，<code>z-index</code>仅在<strong>已建立的层叠上下文</strong>中生效，而层叠上下文的建立有明确条件（如position为relative/absolute且z-index不为auto、flex容器的子元素等）。在我们的初始代码中：</p>
<ul>
<li>
<p>外层.main-wrapper仅设置<code>position:relative</code>，未设置<code>z-index</code>，因此<strong>未建立独立的层叠上下文</strong>，其内部元素的层叠关系受全局上下文影响。</p>
</li>
<li>
<p>Chrome等浏览器中，未设置position的video元素属于<strong>普通流元素</strong>，层叠层级低于<code>absolute</code>定位的元素（即使z-index:1）；但<code>Safari</code>中，<code>video</code>元素被归为<strong>特殊渲染层</strong>，默认会创建一个隐性的层叠上下文，且层级高于普通的<code>absolute</code>元素。</p>
</li>
</ul>
<h3 data-id="heading-3">2.2. Safari对video元素的特殊渲染优化</h3>
<p><code>Safari</code>为了提升视频播放的流畅度（尤其是硬件加速播放），对<code>video</code>元素采用了特殊的渲染策略：将<code>video</code>元素独立渲染在一个<strong>硬件加速层</strong>中，这个层的优先级默认高于普通的DOM元素层。即使开发者没有为<code>video</code>设置任何<code>position和z-index</code>，<code>Safari</code>也会让其<strong>漂浮</strong>在普通DOM层之上，导致普通<code>absolute</code>元素无法覆盖。</p>
<p>关键结论：Safari中，video元素默认处于“高优先级渲染层”，而未建立独立层叠上下文的absolute元素，即使设置z-index，也无法突破这个层级限制。</p>
<h2 data-id="heading-4">3. 解决方案</h2>
<p>基于上述分析，解决思路的核心是：<strong>通过显式建立层叠上下文，让图标和video元素处于同一“层级坐标系”中，从而使z-index生效</strong>。我测试了3种方案，从简单到复杂，均能解决问题，大家可根据场景选择。</p>
<h3 data-id="heading-5">3.1 方案一：给外层容器加z-index:0</h3>
<p>这是最符合CSS规范、兼容性最好的方案，仅需修改一行代码。核心逻辑是：给外层.main-wrapper仅设置设置<code>z-index:0</code>，强制其建立独立的层叠上下文，此时内部的video和图标都处于这个上下文内，z-index规则即可正常生效。</p>
<p><strong>修改后的CSS代码</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.main-wrapper</span> {
	<span class="hljs-attribute">position</span>: relative;
	<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
	<span class="hljs-attribute">z-index</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 关键修改：建立独立层叠上下文 */</span>
}
</code></pre>
<p><strong>原理验证：</strong></p>
<p>设置<code>z-index:0</code>后，.main-wrapper成为层叠上下文容器，内部元素的层叠关系仅相对于.main-wrapper生效：</p>
<ul>
<li>
<p>video元素未设置<code>position</code>和<code>z-index</code>，在容器内属于<strong>普通流层</strong>，层级默认较低。</p>
</li>
<li>
<p>.badge设置<code>absolute</code>和<code>z-index:1</code>，在容器内层级高于<code>video</code>，自然显示在上方。</p>
</li>
</ul>
<p>此方案的优势：无副作用、代码改动最小、兼容所有现代浏览器（包括Safari 10+、Chrome、Firefox等）。</p>
<h3 data-id="heading-6">3.2. 方案二：给video加relative和z-index:-1</h3>
<p>如果因业务限制无法修改外层容器样式，可通过调整<code>video</code>元素的层级实现。核心逻辑是：给<code>video</code>设置<code>position:relative</code>（使其能响应z-index），并设置<code>z-index:-1</code>，将其层级降至图标下方。</p>
<p><strong>修改后的CSS代码</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.video-dom</span> {
	<span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* 关键：让z-index生效 */</span>
	<span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>; <span class="hljs-comment">/* 将视频层级降至最低 */</span>
	<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
	<span class="hljs-attribute">object-fit</span>: contain;
}
</code></pre>
<p>此方案虽能生效，但需注意两个点：</p>
<ul>
<li>
<p><code>z-index:-1</code>会让<code>video</code>元素层级低于容器的背景（如果容器有背景色），需确保容器无背景或背景透明。</p>
</li>
<li>
<p>部分老旧设备的<code>Safari</code>版本（如Safari 9及以下）对负<code>z-index</code>的支持有瑕疵，需谨慎使用。</p>
</li>
</ul>
<h3 data-id="heading-7">3.3. 方案三：用transform触发3D渲染</h3>
<p>如果前两种方案因特殊场景失效（如嵌套了多个层叠上下文），可采用<strong>触发3D渲染</strong>的技巧。核心逻辑是：给图标元素添加<code>transform: translateZ(1px)</code>，强制浏览器为其创建一个3D渲染层，提升层级优先级。</p>
<p><strong>修改后的CSS代码</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.video-dom</span> {
	<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
	<span class="hljs-attribute">object-fit</span>: contain;
	<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(-<span class="hljs-number">1px</span>); <span class="hljs-comment">/* 关键：触发3D渲染层 */</span>
}
<span class="hljs-selector-class">.badge</span> {
	<span class="hljs-attribute">position</span>: absolute;
	<span class="hljs-attribute">top</span>: <span class="hljs-number">8px</span>;
	<span class="hljs-attribute">right</span>: <span class="hljs-number">8px</span>;
	<span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
	<span class="hljs-attribute">width</span>: fit-content;
	<span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
	<span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.7</span>);
	<span class="hljs-attribute">padding</span>: <span class="hljs-number">0px</span> <span class="hljs-number">8px</span>;
	<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
	<span class="hljs-attribute">color</span>: white;
	<span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
	<span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
	<span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;
	<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">1px</span>); <span class="hljs-comment">/* 关键：触发3D渲染层 */</span>
}
</code></pre>
<p>原理说明：</p>
<p>根据CSS规范，<code>transform</code>属性（非none值）会触发元素建立独立的层叠上下文，且3D渲染层的优先级高于普通层。此方案属于<strong>兼容性hack</strong>，适用于前两种方案无法使用的极端场景。</p>
<h2 data-id="heading-8">4. 总结与拓展</h2>
<p>解决完具体问题后，我们需要提炼通用规律，避免未来遇到类似的跨浏览器层叠问题：</p>
<ol>
<li>
<p><strong>层叠上下文是z-index生效的前提</strong>：当元素层级异常时，先通过开发者工具检查其父容器是否建立了独立的层叠上下文。</p>
</li>
<li>
<p><strong>Safari对特殊元素有特殊处理</strong>：除了<code>video</code>，<code>canvas</code>、<code>iframe</code>等元素在<code>Safari</code>中也可能被赋予较高的默认渲染层级，需提前做好兼容预案。</p>
</li>
<li>
<p><strong>优先采用规范方案</strong>：方案一符合CSS标准，无副作用，应作为首选；方案二和三作为备选兜底。</p>
</li>
</ol>
<h3 data-id="heading-9">4.1. 调试技巧</h3>
<p>遇到层叠问题时，可通过以下工具快速定位：</p>
<ul>
<li>
<p><strong>Chrome/Safari开发者工具</strong>：打开“Elements”面板，选中元素后查看“Computed”中的z-index和层叠上下文信息；“Layers”面板可直观看到元素的层级堆叠。</p>
</li>
<li>
<p><strong>临时调试</strong>：给可疑元素添加<code>background: red</code>等醒目样式，快速判断元素是否存在且位置正确，排除<strong>元素不存在</strong>或<strong>定位错误</strong>等非层叠问题的干扰。</p>
</li>
</ul>
<p>跨浏览器兼容问题的本质，往往是不同浏览器对规范的解读或优化策略不同。遇到问题时，先复现、再剖析根源、最后针对性落地方案，才能做到“有理有据，一步一营”，而不是盲目试错。希望本文的思路能为大家提供参考，让后续的H5开发少踩坑、更高效。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7568192652286754870" target="_blank" title="https://juejin.cn/post/7568192652286754870">纯前端提取图片颜色插件Color-Thief教学+实战完整指南</a></li>
<li><a href="https://juejin.cn/post/7565737512816771135" target="_blank" title="https://juejin.cn/post/7565737512816771135">react-konva实战指南：Canvas高性能+易维护的组件化图形开发实现教程</a></li>
<li><a href="https://juejin.cn/post/7560905838074462271" target="_blank" title="https://juejin.cn/post/7560905838074462271">React无限滚动插件react-infinite-scroll-component的配置+优化+避坑指南</a></li>
<li><a href="https://juejin.cn/post/7560542615484137491" target="_blank" title="https://juejin.cn/post/7560542615484137491">前端音频兼容解决：音频神器howler.js从基础到进阶完整使用指南</a></li>
<li><a href="https://juejin.cn/post/7559871680015024169" target="_blank" title="https://juejin.cn/post/7559871680015024169">使用React-OAuth进行Google/GitHub登录的教程和案例</a></li>
<li><a href="https://juejin.cn/post/7550585427834404927" target="_blank" title="https://juejin.cn/post/7550585427834404927">纯前端人脸识别利器：face-api.js手把手深入解析教学</a></li>
<li><a href="https://juejin.cn/post/7553865490732433462" target="_blank" title="https://juejin.cn/post/7553865490732433462">关于React父组件调用子组件方法forwardRef的详解和案例</a></li>
<li><a href="https://juejin.cn/post/7553484874609410074" target="_blank" title="https://juejin.cn/post/7553484874609410074">React跨组件数据共享useContext详解和案例</a></li>
<li><a href="https://juejin.cn/post/7545087762837815334" target="_blank" title="https://juejin.cn/post/7545087762837815334">Web图像编辑神器tui.image-editor从基础到进阶的实战指南</a></li>
<li><a href="https://juejin.cn/post/7544323659788288046" target="_blank" title="https://juejin.cn/post/7544323659788288046">开发个人微信小程序类目选择/盈利方式/成本控制与服务器接入指南</a></li>
<li><a href="https://juejin.cn/post/7541741121400864778" target="_blank" title="https://juejin.cn/post/7541741121400864778">前端图片裁剪Cropper.js核心功能与实战技巧详解</a></li>
<li><a href="https://juejin.cn/post/7536530451461472265" target="_blank" title="https://juejin.cn/post/7536530451461472265">编辑器也有邪修？盘点VS Code邪门/有趣的扩展</a></li>
<li><a href="https://juejin.cn/post/7535005018257981466" target="_blank" title="https://juejin.cn/post/7535005018257981466">js使用IntersectionObserver实现目标元素可见度的交互</a></li>
<li><a href="https://juejin.cn/post/7534547200330121225" target="_blank" title="https://juejin.cn/post/7534547200330121225">Web前端页面开发阿拉伯语种适配指南</a></li>
<li><a href="https://juejin.cn/post/7516122409948020736" target="_blank" title="https://juejin.cn/post/7516122409948020736">让网页拥有App体验？PWA 将网页变为桌面应用的保姆级教程PWA</a></li>
<li><a href="https://juejin.cn/post/6953803916484018206" target="_blank" title="https://juejin.cn/post/6953803916484018206">使用nvm管理node.js版本以及更换npm淘宝镜像源</a></li>
<li><a href="https://juejin.cn/post/7140443283209060383" target="_blank" title="https://juejin.cn/post/7140443283209060383">手把手教你搭建规范的团队vue项目，包含commitlint，eslint，prettier，husky，commitizen等等</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin 跨平台开发中的权衡]]></title>    <link>https://juejin.cn/post/7571316028321628195</link>    <guid>https://juejin.cn/post/7571316028321628195</guid>    <pubDate>2025-11-12T00:35:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571316028321628195" data-draft-id="7568785441128153122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin 跨平台开发中的权衡"/> <meta itemprop="keywords" content="Android,iOS,Kotlin"/> <meta itemprop="datePublished" content="2025-11-12T00:35:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin 跨平台开发中的权衡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:35:44.000Z" title="Wed Nov 12 2025 00:35:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"⇲"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"•";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/020a1ae80ed7481f9738db369f2f51e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512544&amp;x-signature=6MZQfJysJ%2BsBWg6eHkcWk51pR%2Fg%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>“开发一致性很关键”——这句话在分布式系统领域经常被提及，在移动和 Web 应用开发中同样适用。</p>
<p>在当今这个单个应用需要在多个平台上无缝运行的时代，确保各平台之间的一致性不仅是一个目标，更是一种必要。多年来，开发者们一直面临着艰难的抉择：是为每个平台分别构建原生应用，还是采用跨平台框架。</p>
<p>从传统意义上来说，针对 Android 和 iOS 进行原生开发需要将资源翻倍投入：两套代码库、两支工程团队，还需要付出双倍的努力来确保功能和业务逻辑同步。当应用程序需要一致的 UI 和相同的业务逻辑时，自然就需要共享驱动它们运行的代码。</p>
<p>这种需求催生了像 <strong>Flutter</strong> 和 <strong>React Native</strong> 这样的跨平台工具。虽然这些工具非常有效，但往往需要做出重大的权衡。它们通常要求开发者使用不同的 UI 渲染引擎（<strong>Flutter</strong>）或使用桥接（<strong>React Native</strong>），与原生代码相比，这势必会导致性能损失。</p>
<p>在这种情况下，<strong>KMP</strong>（Kotlin Multiplatform） 提供了一种独特的方法。<strong>KMP</strong> 并不是取代原生平台的 SDK，而是与之协同工作，使开发者能够共享通用代码，并能以直观的惯用方式访问平台 API。具体来说，这意味着你可以像使用 <strong>React Native</strong> 一样，通过使用原生 UI 工具包来创建一款保留各平台外观和感觉的 <strong>KMP</strong> 应用程序。你也可以采用 <strong>CMP</strong>（Compose Multiplatform），效仿 <strong>Flutter</strong> 的方式共享 UI 实现，尽管这可能会导致应用在 iOS 上失去 “原生” 外观。</p>
<p>总之，当与 <strong>CMP</strong> 结合使用时，<strong>KMP</strong> 提供了一个极具吸引力的应用场景：与 <strong>Flutter</strong> 类似，它能编译成本地代码以实现出色的性能，同时也保留了使用原生 UI 工具包的选项，这一点与 <strong>React Native</strong> 一样具有灵活性。</p>
<p><strong>KMP</strong> 正成为跨平台开发的一个强大替代方案，它提供了一种在不牺牲原生应用性能和体验的前提下共享代码的途径。作为一种替代方案，<strong>KMP</strong> 也有自身需要权衡的方面，本文将深入探讨这些问题。</p>
<p>虽然本文主要关注 Android 和 iOS 开发，但 <strong>KMP</strong> 的应用前景更为广阔。借助同样的共享逻辑，它可用于构建桌面应用（Windows、macOS、Linux）、网页应用（通过 <strong>Kotlin/JavaScript</strong>），甚至服务器端应用。</p>
<h2 data-id="heading-1">什么是 Kotlin 跨平台（KMP）</h2>
<p><strong>KMP</strong> 允许开发团队在不同平台间编写和共享代码，而且借助 <strong>CMP</strong>，仍可选择构建原生 UI。它并非那种将平台特性完全抽象掉的 “非此即彼” 的框架。相反，它是一个精妙的工具，能让你共享应用中与平台无关的部分，同时让特定于平台的部分保持原生特性。Android 开发者可以用 <strong>Kotlin</strong> 编写 UI 代码，iOS 开发者则可以用 <strong>Objective-C</strong> 或 <strong>Swift</strong> 编写 UI 代码。但这并不意味着只能使用原生界面构建 UI，这是一个重要的区别。<strong>KMP</strong> 为你提供了按自己意愿构建 UI 的灵活性。</p>
<h3 data-id="heading-2">KMP 是如何工作的</h3>
<p><strong>KMP</strong> 有特定的项目结构以及 <code>expect/actual</code> 机制，这使其能够跨平台运行。一个典型的 <strong>KMP</strong> 项目分为多个模块：</p>
<ul>
<li><code>commonMain</code> 包含通用代码。这段代码只需编译一次，即可在所有目标平台上共享。你可以将业务逻辑、网络调用等放在这个模块中。</li>
<li><code>androidMain</code> 包含 Android 实现。Android 设备的 UI 可以在这个模块中用 <strong>Kotlin</strong> 编写。</li>
<li><code>iosMain</code> 包含 iOS 实现。iOS 设备的 UI 可以用 <strong>Swift</strong> 或 <strong>Objective-C</strong> 编写。</li>
</ul>
<p><code>expect</code> 和 <code>actual</code> 关键字是通用实现与特定平台实现之间的桥梁。在 <code>commonMain</code> 中，你可以预期某个类或函数存在，并定义其 API。然后，在 <code>androidMain</code> 和 <code>iosMain</code> 中，为该声明提供特定于平台的实际实现。例如，在 <code>commonMain</code> 中你可能预期有一个生成唯一标识符（UUID）的函数，然后在 <code>androidMain</code> 中使用 Android 的 <code>UUID.randomUUID()</code> ，在 <code>iosMain</code> 中使用 iOS 的 <code>NSUUID().uuidString</code> 来提供实际实现。</p>
<p>利用上述结构，可以为跨平台应用同时进行构建，而不会牺牲应用性能。</p>
<h2 data-id="heading-3">KMP 的优势</h2>
<h3 data-id="heading-4">降低成本</h3>
<p>统一架构并使同一批开发者能够为多个平台编写代码，无疑能显著降低工程成本。通过将业务逻辑、网络等功能置于共享的 <code>commonMain</code> 模块中，就无需针对同一功能在不同平台重复实现和测试。这直接避免了重复工作，也减少了特定于平台的错误，从而打造出更强大、更可靠的产品。此外，由于核心逻辑只需测试一次，这也简化了质量保证流程。需要重点指出的是，<strong>Flutter</strong> 和 <strong>React Native</strong> 也具备这一优势。在这方面，<strong>KMP</strong> 并不比其他技术更具有优势。</p>
<h3 data-id="heading-5">原生性能</h3>
<p>与其他跨平台工具不同，<strong>KMP</strong> 允许开发者使用平台的原生工具构建 UI。共享的 <strong>Kotlin</strong> 代码会被编译成目标平台所需的格式，为 Android 生成 <strong>JVM</strong> 字节码，为 iOS 生成原生二进制文件。与 <strong>React Native</strong> 不同，运行时不存在解释层，这使得应用程序能够实现接近原生的性能。</p>
<h3 data-id="heading-6">逐步采用</h3>
<p><strong>Flutter</strong>（使用 <strong>Dart</strong>）和 <strong>React Native</strong>（使用 <strong>TypeScript</strong> 或 <strong>JavaScript</strong>）需要 “全有或全无” 式的采用方式，而 <strong>Kotlin</strong> 多平台则并非如此。它可以在代码库中逐步引入，过渡会更加平缓。你可以将 <strong>KMP</strong> 逐步引入到现有的原生应用中，这有助于确保应用在整个过程中保持稳定。常见的起点是将单个功能或特定层迁移到共享的 <strong>KMP</strong> 模块中。</p>
<h3 data-id="heading-7">平滑演进</h3>
<p>由于谷歌正式认可 <strong>Kotlin</strong> 作为安卓开发的主要语言，大多数安卓开发团队都已在使用 <strong>Kotlin</strong> 进行开发。对于这些团队来说，向 <strong>Kotlin</strong> 多平台的过渡门槛极低。</p>
<h2 data-id="heading-8">Flutter vs React Native vs KMP</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/284f77dd8e5647afa6e97a293bbe27d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512544&amp;x-signature=%2BXwyK3Dr6SrFtZYCHgh%2Bh4uNQX8%3D" alt="cmp.png" loading="lazy"/></p>
<p>虽然这三项技术都支持跨平台开发，但它们的工作原理不同，特别是在 UI 和整体理念方面。下表总结了我们上面讨论的主要差异：</p>



































<table><thead><tr><th>特性</th><th><strong>Flutter</strong></th><th><strong>React Native</strong></th><th><strong>KMP</strong></th></tr></thead><tbody><tr><td>语言</td><td><strong>Dart</strong></td><td><strong>JavaScript / TypeScript</strong></td><td><strong>Kotlin</strong></td></tr><tr><td>UI 渲染</td><td>使用 <strong>Skia</strong> 引擎渲染自己的 UI</td><td>通过 <strong>JS</strong> 桥控制原生 UI 组件</td><td>可以使用原生 UI (<strong>SwiftUI/Compose</strong>) 或共享 UI (<strong>Compose Multiplatform</strong>)</td></tr><tr><td>性能</td><td>优秀，编译为原生代码，无需桥接</td><td>良好，但 <strong>JavaScript</strong> 桥可能会成为瓶颈</td><td>优秀，编译为平台原生格式，无需桥接</td></tr><tr><td>采用</td><td>完全投入</td><td>完全投入</td><td>逐步采用</td></tr></tbody></table>
<h2 data-id="heading-9">iOS 系统中的现状</h2>
<p>历史上，<strong>Kotlin</strong> 从未用于开发 iOS 应用程序。但有了 <strong>KMP</strong> 和 <strong>CMP</strong>，现在这已经成为可能。</p>
<p>长期以来，<strong>Kotlin</strong> 多平台在 iOS 方面秉持的理念是 “共享逻辑，原生构建用户界面”。虽说这是一种强大的方法，但它仍意味着用户界面开发是特定于平台的任务。随着 <code>1.8.0</code> 稳定版的发布，这种情况发生了改变。截至 2025 年 5 月 6 日，用于 iOS 的 <strong>CMP</strong> 达到一个稳定的、可用于生产环境的里程碑。</p>
<p>这一里程碑对于 <strong>Kotlin</strong> 多平台生态系统而言是一项重大成果。<strong>Jetpack Compose</strong> 是谷歌为安卓系统打造的现代声明式用户界面工具包。有了 <strong>CMP</strong>，现在你可以使用完全相同的 <strong>Kotlin</strong> 代码为 Android 和 iOS 定义 UI。这意味着不仅业务逻辑可以共享，用户界面本身也能共享。目前，该框架在功能上已经与面向 iOS 的 <strong>Jetpack Compose</strong> 不相上下，这使其成为新项目的可行选择。在我看来，<strong>CMP</strong> <code>1.8.0</code> 版本不仅对 iOS 开发有价值，而且实现了 <strong>KMP</strong> 真正的价值主张，因为开发者现在能够基于此构建整个应用程序。</p>
<p>此外，某些屏幕使用原生 <strong>Swift/UIKit</strong>，而其他屏幕使用 <strong>Compose</strong> 进行混合搭配的选项提供了极大的灵活性。为此，你可以依赖框架提供的特定包装组件，这些组件利用了 <strong>SwiftUI/UIKit</strong> 的互操作性。例如，要在原生 <strong>SwiftUI</strong> 应用中使用 <strong>CMP</strong> 界面，可将可组合 UI 包装在 <code>ComposeUIViewController</code> 中。然后，在 <strong>SwiftUI</strong> 代码中，为 <code>UIViewControllerRepresentable</code> 协议创建一个结构体，该结构体将管理控制器。若要在 <strong>Compose</strong> UI 中使用原生 <strong>SwiftUI</strong> 界面，可将 <strong>SwiftUI</strong> 视图托管在 <code>UIHostingController</code> 中，该控制器可使用 <code>UIKitView</code> 可组合项直接嵌入到 <strong>Compose</strong> 布局中。</p>
<h2 data-id="heading-10">使用 KMP 的大用户</h2>
<p><strong>KMP</strong> 并非只是一个理论概念，像网飞（Netflix）、麦当劳（McDonald’s）和飞利浦（Philips）这样的全球大型公司都在实际产品中使用它。</p>
<h3 data-id="heading-11">网飞</h3>
<p>网飞是 <strong>KMP</strong> 的早期重要用户，自 2020 年 10 月就开始采用该技术。他们利用 <strong>KMP</strong> 统一了各应用程序中的业务逻辑，确保无论用户使用何种设备，各项功能的运行表现一致。他们还在内部的 <strong>Prodicle</strong> 应用程序中使用了该技术，该应用程序为电视和电影项目的实际制作提供支持。</p>
<blockquote>
<p>我们的 Android 和 iOS 应用程序有着共享的架构，两个平台上编写的业务逻辑相似，甚至在某些情况下完全相同。—— <a href="https://link.juejin.cn?target=https%3A%2F%2Fnetflixtechblog.com%2Fnetflix-android-and-ios-studio-apps-kotlin-multiplatform-d6d4d8d25d23" target="_blank" title="https://netflixtechblog.com/netflix-android-and-ios-studio-apps-kotlin-multiplatform-d6d4d8d25d23" ref="nofollow noopener noreferrer">网飞</a></p>
</blockquote>
<p>网飞能够实现代码与底层平台 50% 的解耦。展望未来，网飞还谈到了将其应用程序发展成为一个薄 UI 层的可能性，该 UI 层共享用 <strong>KMP</strong> 编写的相同业务逻辑。</p>
<h3 data-id="heading-12">麦当劳</h3>
<p>麦当劳在其应用程序中引入应用内支付功能时，开始使用 <strong>KMP</strong>（早期版本中称为 <strong>KMM</strong>）。在验证了这种方法后，他们将 <strong>KMP</strong> 的使用扩展到其他服务。</p>
<blockquote>
<p>将 <strong>KMM</strong> 集成到应用程序流程中，使我们能够在一个地方开发解析和存储逻辑，此外还能开发在每个平台上正确显示本地化数据和产品所需的业务逻辑。—— <a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2Fmcdonalds-technical-blog%2Fmobile-multiplatform-development-at-mcdonalds-3b72c8d44ebc" target="_blank" title="https://medium.com/mcdonalds-technical-blog/mobile-multiplatform-development-at-mcdonalds-3b72c8d44ebc" ref="nofollow noopener noreferrer">麦当劳</a></p>
</blockquote>
<p>例如，为了满足不同国际地区客户的各种需求，他们将管理特定地区产品和数据的逻辑集中到一个共享的 <strong>KMP</strong> 模块中。在这个模块里，他们将 <strong>KMP</strong> 引入到处理特定地区和设备的产品与数据的业务逻辑中。</p>
<p>最终，麦当劳重写了整个应用程序以采用 <strong>KMP</strong>。通过这一战略转变，他们将独立的 Android 和 iOS 开发团队合并成一个更加统一且高效的移动开发团队。</p>
<h3 data-id="heading-13">飞利浦</h3>
<p>2018 年，飞利浦采用 <strong>KMP</strong> 来摆脱原生开发。飞利浦利用 <strong>KMP</strong> 为其互联消费产品和个人健康产品开发了一个用于设备通信和数据同步的共享 SDK，实现了牙刷和空气净化器等设备与移动应用的连接。通过使用 <strong>KMP</strong>，他们得以保留共享的业务逻辑。</p>
<blockquote>
<p>蓝牙低功耗接口存在很大差异，以至于无法设计出一种能同时适配两者的方案。所以在这方面，我们仍将采用原生开发方式。—— <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DhZPL8QqiLi8" target="_blank" title="https://www.youtube.com/watch?v=hZPL8QqiLi8" ref="nofollow noopener noreferrer">飞利浦</a></p>
</blockquote>
<p>他们最初在处理蓝牙低功耗的蓝牙 API 时遇到了一些问题。为了解决这个问题，他们对蓝牙协议栈保留了原生实现，这表明开发人员并非在整个代码库中都采用 <strong>KMP</strong>。</p>
<p>我们可以看到，现在越来越多的公司正在采用 <strong>KMP</strong>，它开始受到重视。各公司一开始行动较为缓慢，但随着他们开始看到其好处，便逐渐增加了使用案例。我建议大家查看所有这些案例研究，因为我仅提及了少数几个。</p>
<h2 data-id="heading-14">挑战与考量</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/077a51d6259042fba256bc6968e44f4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512544&amp;x-signature=oPKwLpDGIul5IDH0DfvbZY36DJw%3D" alt="bl.png" loading="lazy"/></p>
<p>虽然 <strong>KMP</strong> 为跨平台开发提供了一种很有前景的方法，但我们也必须认识到 <strong>KMP</strong> 目前的局限性。</p>
<h3 data-id="heading-15">生态系统成熟度</h3>
<p>与现有的工具（如 <strong>Flutter</strong> 和 <strong>React Native</strong>）相比，一个主要挑战在于 <strong>KMP</strong> 的开发者社区规模较小，支持生态系统也不够完善。虽然核心功能得到了很好的支持，但要找到满足特定需求（比如高级蓝牙交互或后台服务）的、适配 <strong>KMP</strong> 的库，情况依然不容乐观，就如同我们在飞利浦案例中看到的，可能仍需编写特定平台的代码实现。这有时意味着开发者需要围绕原生解决方案创建自己的包装器，这并不是理想的情况 。</p>
<h3 data-id="heading-16">iOS 团队的学习曲线</h3>
<p>对于 iOS 团队而言，采用 <strong>Kotlin</strong> 和 <strong>Gradle</strong> 构建系统可能会有一定的学习曲线，它们在安卓生态系统中很常见，但对大多数 iOS 开发者来说是新鲜事物。</p>
<h3 data-id="heading-17">Kotlin/Native 互操作性</h3>
<p><strong>Kotlin/Native</strong> 与 <strong>Swift/Objective-C</strong> 之间的互操作性存在自身的局限性。<strong>Kotlin/Native</strong> 通过 <strong>Swift/Objective-C</strong> 提供间接互操作性。例如，一些 <strong>Kotlin</strong> 语言特性在 <strong>Objective-C</strong> 中可能没有直接对应的特性，这就要求开发者在开发过程中了解这些差异。这一要求可能会成为一个很大的障碍，因为大多数开发者在开始开发之前并不了解这一点。泛型就是一个例子，在转换过程中类型信息会丢失。开发者需要留意传递的类型，并围绕此进行检查。</p>
<h3 data-id="heading-18">工具和开发流程</h3>
<p>虽然相关工具在不断改进，但目前仍不如原生开发工具那样无缝衔接。<strong>KMP</strong> 有一些插件，使用起来更加便捷，而且 <strong>JetBrains</strong> 正在积极开发这些插件。</p>
<p>虽然面临的挑战不少且不容忽视，但这种情况正在迅速改变。可以说，对 <strong>Kotlin</strong> 本身的支持已经成熟，并且还在不断发展，而 <strong>KMP</strong> 社区正是这一趋势的直接受益者。随着采用率的提高，共享知识和开源库的数量也会增加。</p>
<h2 data-id="heading-19">总结</h2>
<p>跨平台开发一直是在权衡利弊中进行的：要在开发效率与原生性能以及外观和用户体验之间找到平衡 。有了 <strong>KMP</strong>，这些权衡因素在一定程度上有所减少。你可以获得共享代码库带来的效率，同时交付几乎与原生应用性能相当的产品。</p>
<p>虽然核心功能有良好的支持，但要找到满足特定需求（如高级蓝牙低功耗交互或后台定位服务）的现成 <strong>KMP</strong> 库，可能仍需要编写特定于平台的实现代码。这确实是个问题，因为需要所有这些功能的应用程序无法仅通过 <strong>KMP</strong> 构建。但正如前面提到的，这是一个迭代演进的过程，由于 <strong>KMP</strong> 开发活跃，更好的支持将会推出。</p>
<blockquote>
<p>推荐一个网站，可以搜索当前的 <strong>KMP</strong> 相关的库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fklibs.io%2F" target="_blank" title="https://klibs.io/" ref="nofollow noopener noreferrer">klibs.io</a>。</p>
</blockquote>
<p><strong>KMP</strong> 提供了一个灵活且有前景的前进方向，使团队能够为多平台世界构建一致的高性能应用程序，同时又不脱离原生基础。对 <strong>Kotlin</strong> 的支持力度很大，其多平台功能也只会从此不断发展壮大。</p>
<hr/>
<blockquote>
<p>原文<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infoq.com%2Farticles%2Fkotlin-multiplatform-evaluation%2F" target="_blank" title="https://www.infoq.com/articles/kotlin-multiplatform-evaluation/" ref="nofollow noopener noreferrer">www.infoq.com/articles/ko…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[记第一次鸿蒙应用上架之旅：一场略带遗憾的旅途]]></title>    <link>https://juejin.cn/post/7571338749198188594</link>    <guid>https://juejin.cn/post/7571338749198188594</guid>    <pubDate>2025-11-12T00:35:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571338749198188594" data-draft-id="7571360278970351625" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="记第一次鸿蒙应用上架之旅：一场略带遗憾的旅途"/> <meta itemprop="keywords" content="前端,HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-12T00:35:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            记第一次鸿蒙应用上架之旅：一场略带遗憾的旅途
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:35:52.000Z" title="Wed Nov 12 2025 00:35:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">记第一次鸿蒙应用上架之旅：一场略带遗憾的旅途</h2>
<h4 data-id="heading-1">记第一次鸿蒙应用上架之旅：一场略带遗憾的旅途</h4>
<p>我们制作的一款旅行类应用 ——<strong>鸿途智导</strong>，上架也有一周多了。</p>
<p>对我来说，作为第一款上架的应用，按理来说应该满心兴奋，但或许是战线拉得太长，也经历了许多曲折，内心已没有太多波澜，更多的是遗憾。</p>
<p>此话怎讲呢？恰巧今天略有空闲，就来给大家聊聊这款应用，以及我们哭笑不得的开发历程。</p>
<p><strong>使用链接</strong>：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fappgallery.huawei.com%2Fapp%2Fdetail%3Fid%3Dhongtuzhidao.qinglanzhuma.huawei%26channelId%3DSHARE%26source%3Dappshare" target="_blank" title="https://appgallery.huawei.com/app/detail?id=hongtuzhidao.qinglanzhuma.huawei&amp;channelId=SHARE&amp;source=appshare" ref="nofollow noopener noreferrer">appgallery.huawei.com/app/detail?…</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ca44250e5fb43ec89f89926b4f3405f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512552&amp;x-signature=VqOMdH8VnvllX1Zk9nTV%2BNGtVjU%3D" alt="图片" loading="lazy"/></p>
<hr/>
<h5 data-id="heading-2">这是一款什么样的产品？</h5>
<p>先和大家说说核心功能点，每一个都藏着我们对旅行的小期待～</p>
<h6 data-id="heading-3">🌍 应用首页：你的旅行情报站</h6>
<p>天气卡片 + 每日景点推荐 + 热门排行榜，打开 APP 就能解锁当日旅行灵感，一键开启鸿途之旅～</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0614dda0567448e398d314e8df305225~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512552&amp;x-signature=JvjbQT%2FmG4fk7VGbJa7HxWfQBEI%3D" alt="应用首页" loading="lazy"/></p>
<p>应用首页</p>
<h6 data-id="heading-4">🗣️ 随行探客：你的专属导游</h6>
<p>根据当前位置信息，为你生成专属语音导览，走到哪儿讲到哪儿，再也不用提前做攻略记知识点～</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19f2b89c857b4af1ac3b7fc704a1b429~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512552&amp;x-signature=5HcIUNG5PbduNkKMArThnFXDPLA%3D" alt="随行探客功能" loading="lazy"/></p>
<p>随行探客功能</p>
<h6 data-id="heading-5">📸 洞见万物：一拍即懂</h6>
<p>遇到不知名的美景、古建筑、植物？把摄像机对准它，即刻获取详细介绍，旅行中的好奇心随时满足～</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/053c2af5ca0643faa69fc7ddfaeec914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512552&amp;x-signature=QMcdJxkoPXsaYYB20NaL3pFkcug%3D" alt="洞见万物功能" loading="lazy"/></p>
<p>洞见万物功能</p>
<h6 data-id="heading-6">✍️ 攻略分享：打开你的旅行灵感库</h6>
<p>记录旅途趣事、分享小众玩法，和其他旅行者交流心得，让每一次出行都有迹可循～</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e46a96e8dafd42a38ef91681be2ac5d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763512552&amp;x-signature=is1TOOUSLyAvbiVOXrZSe2ZEzAI%3D" alt="攻略分享功能" loading="lazy"/></p>
<p>攻略分享功能</p>
<hr/>
<h5 data-id="heading-7">我们本想做一款「更完美」的产品</h5>
<p>聊完现有功能，就该说说那份「遗憾」的由来 —— 先和大家讲讲我们最初的美好设想。</p>
<p>在做这款产品前，我们研究了市面上大部分旅行类 APP，发现它们大致分为四种风格，但各有优劣：</p>
<ul>
<li><strong>全能型</strong>（携程、马蜂窝、高德等）：覆盖交通、酒店、购票全链路，但功能臃肿，找入口费劲；</li>
<li><strong>社交型</strong>（小红书）：攻略参考丰富、用户粘性高，但旅行相关功能相对单一；</li>
<li><strong>AI 问答型</strong>（如豆包）：能做攻略、讲景点，但攻略散落在对话中，不易查找和二次编辑；</li>
<li><strong>旅程管理型</strong>（如圆周旅迹）：聚焦旅行前规划，却忽略了旅行中的实时体验优化。</li>
</ul>
<p>我们想做的，是<strong>取各家所长，聚焦「旅行中」的体验优化</strong>—— 打造一款「旅行百宝箱」式的 APP：</p>
<p>✅ 内置 AI 对话小助手，随时解答旅行中遇到的问题；</p>
<p>✅ 智能导游双模式：</p>
<ul>
<li>
<p>实时位置语音导览 + 短时行程规划（3 小时 / 半天 / 1 天），支持二次调整编辑；</p>
</li>
<li>
<p>图片识别功能，美景一拍即懂，满足好奇心；</p>
<p>✅ 旅行者交流社区 + 每日景点推荐，提升日常使用率和粘性。</p>
</li>
</ul>
<p>有了这个想法，我们就一头扎进了开发里 —— 从刚开始接触鸿蒙系统的边学边练，到遇到难题时的彻夜琢磨，再到逐步实现功能的成就感，每一步都走得很扎实。</p>
<p>终于，我们基本完成了最初的构想，本以为能带着「完整版」和大家见面，却没想到被现实泼了冷水。</p>
<hr/>
<h5 data-id="heading-8">上架路上的「妥协」：从完整版到青春版</h5>
<p>第一次提交审核后，我们收到了要求：需要提供 AI 生成、社区安全相关的资质证书。</p>
<p>其实这一点我们早有预料，于是兵分两路：一边申请资质，一边调整功能、补充细节（比如添加内容审核、生成标识、举报入口），希望能先实现上架。</p>
<p>但修修改改几次后，审核仍卡在读资质上。就这样等了差不多一个月，资质申请有了消息，却不是好消息 —— 一长串复杂的手续、数据同步共享等要求，让我们这个小团队有些招架不住。</p>
<p>权衡再三，我们不得不做出妥协：<strong>隐藏部分核心功能，尽量去 AI 化，简化产品形态</strong>。</p>
<p>于是，原本设想的「全能百宝箱」，最终以「青春版」的样子和大家见面了。</p>
<p>说实话，我们对这个版本并不完全满意 —— 它没能完全展现我们的初衷，也少了很多我们认为「能提升旅行体验」的关键功能。</p>
<p>但至少，它上架了，算是给这段时间的努力一个阶段性交代。</p>
<hr/>
<h5 data-id="heading-9">故事还没结束，我们仍在努力</h5>
<p>虽然这次上架带着遗憾，但这并不意味着我们放弃了最初的构想。</p>
<p>目前，我们还在尽力办理相关资质和材料，同时也在收集用户反馈，持续优化现有功能。</p>
<p>如果你愿意支持我们这个小团队，欢迎下载「鸿途智导」体验～ 无论是功能建议、使用问题，还是你心中「理想旅行 APP」的样子，都欢迎在评论区畅所欲言，你的每一条反馈，都是我们完善产品的动力。</p>
<p>期待不久的将来，我们能带着「完整版」甚至「Pro Max 版」回归，真正实现最初的设想，让每一段旅程都更精彩、更省心～</p>
<p>👉 点击下载：【鸿途智导】鸿蒙应用商店搜索即可</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fappgallery.huawei.com%2Fapp%2Fdetail%3Fid%3Dhongtuzhidao.qinglanzhuma.huawei%26channelId%3DSHARE%26source%3Dappshare" target="_blank" title="https://appgallery.huawei.com/app/detail?id=hongtuzhidao.qinglanzhuma.huawei&amp;channelId=SHARE&amp;source=appshare" ref="nofollow noopener noreferrer">appgallery.huawei.com/app/detail?…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（118）Redis的缓存机制如何实现？]]></title>    <link>https://juejin.cn/post/7571285984089964596</link>    <guid>https://juejin.cn/post/7571285984089964596</guid>    <pubDate>2025-11-11T23:07:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571285984089964596" data-draft-id="7571303808116686900" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（118）Redis的缓存机制如何实现？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T23:07:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（118）Redis的缓存机制如何实现？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T23:07:06.000Z" title="Tue Nov 11 2025 23:07:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis 作为一个高性能的内存数据库，广泛应用于缓存机制中，以快速存取数据、减轻数据库压力。Redis 提供了多种缓存策略和持久化选项，帮助用户实现高效的缓存管理。以下是 Redis 缓存机制的详细讲解及代码示例。</p>
<h3 data-id="heading-0">1. 基本缓存操作</h3>
<p>Redis 提供了一系列命令来进行缓存操作，如 <code>SET</code>、<code>GET</code>、<code>EXPIRE</code> 等。以下是一些基本的缓存操作示例：</p>
<h4 data-id="heading-1">设置缓存</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCacheExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 设置键值对</span>
            jedis.set(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>);

            <span class="hljs-comment">// 设置键值对并指定过期时间 (单位: 秒)</span>
            jedis.setex(<span class="hljs-string">"key2"</span>, <span class="hljs-number">3600</span>, <span class="hljs-string">"value2"</span>); <span class="hljs-comment">// 1 小时后过期</span>

            <span class="hljs-comment">// 获取键值对</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> jedis.get(<span class="hljs-string">"key1"</span>);
            System.out.println(<span class="hljs-string">"key1: "</span> + value);
        }
    }
}
</code></pre>
<h3 data-id="heading-2">2. 缓存过期策略</h3>
<p>Redis 提供了多种方法来设置缓存的过期时间：</p>
<ul>
<li><code>EXPIRE key seconds</code>：设置键的过期时间（秒）。</li>
<li><code>PEXPIRE key milliseconds</code>：设置键的过期时间（毫秒）。</li>
<li><code>EXPIREAT key timestamp</code>：设置键的过期时间为特定时间戳（秒）。</li>
<li><code>PEXPIREAT key timestamp</code>：设置键的过期时间为特定时间戳（毫秒）。</li>
<li><code>TTL key</code>：查看键的剩余生存时间（秒）。</li>
<li><code>PTTL key</code>：查看键的剩余生存时间（毫秒）。</li>
</ul>
<h4 data-id="heading-3">设置和获取过期时间</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisExpireExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 设置键值对并指定过期时间</span>
            jedis.set(<span class="hljs-string">"key3"</span>, <span class="hljs-string">"value3"</span>);
            jedis.expire(<span class="hljs-string">"key3"</span>, <span class="hljs-number">10</span>); <span class="hljs-comment">// 10 秒后过期</span>

            <span class="hljs-comment">// 获取过期时间</span>
            <span class="hljs-type">Long</span> <span class="hljs-variable">ttl</span> <span class="hljs-operator">=</span> jedis.ttl(<span class="hljs-string">"key3"</span>);
            System.out.println(<span class="hljs-string">"TTL for key3: "</span> + ttl);
        }
    }
}
</code></pre>
<h3 data-id="heading-4">3. 缓存淘汰策略</h3>
<p>当 Redis 达到最大内存限制时，会根据配置的淘汰策略删除一些键以释放内存。常见的策略包括：</p>
<ul>
<li><code>noeviction</code>：当内存不足时，返回错误，不会删除任何键。</li>
<li><code>allkeys-lru</code>：移除最近最少使用的键。</li>
<li><code>volatile-lru</code>：移除最近最少使用的设置了过期时间的键。</li>
<li><code>allkeys-random</code>：随机移除一些键。</li>
<li><code>volatile-random</code>：随机移除一些设置了过期时间的键。</li>
<li><code>volatile-ttl</code>：移除一些将要过期的键。</li>
</ul>
<p>可以在 <code>redis.conf</code> 文件中配置：</p>
<pre><code class="hljs language-conf" lang="conf">maxmemory 256mb
maxmemory-policy allkeys-lru
</code></pre>
<h3 data-id="heading-5">4. 使用缓存的示例：缓存数据库查询结果</h3>
<p>以下示例展示了如何使用 Redis 缓存数据库查询结果，以提高查询性能。</p>
<h4 data-id="heading-6">数据库查询类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">query</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-comment">// 模拟数据库查询</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"DB_Value_for_"</span> + key;
    }
}
</code></pre>
<h4 data-id="heading-7">缓存类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cacheExpireTime;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Cache</span><span class="hljs-params">(Jedis jedis, <span class="hljs-type">int</span> cacheExpireTime)</span> {
        <span class="hljs-built_in">this</span>.jedis = jedis;
        <span class="hljs-built_in">this</span>.cacheExpireTime = cacheExpireTime;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getData</span><span class="hljs-params">(String key, Database db)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> jedis.get(key);
        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 缓存未命中，从数据库查询</span>
            value = db.query(key);
            <span class="hljs-comment">// 将结果缓存到 Redis，并设置过期时间</span>
            jedis.setex(key, cacheExpireTime, value);
        }
        <span class="hljs-keyword">return</span> value;
    }
}
</code></pre>
<h4 data-id="heading-8">主程序</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-type">Database</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
            <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>(jedis, <span class="hljs-number">3600</span>); <span class="hljs-comment">// 缓存 1 小时</span>

            <span class="hljs-comment">// 查询并缓存结果</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> cache.getData(<span class="hljs-string">"key1"</span>, db);
            System.out.println(<span class="hljs-string">"Result: "</span> + value);
        }
    }
}
</code></pre>
<h3 data-id="heading-9">5. 缓存的持久化</h3>
<p>Redis 提供了 RDB 和 AOF 两种持久化方式，以确保数据在重启或故障后的恢复。</p>
<h4 data-id="heading-10">RDB 持久化</h4>
<p>RDB (Redis Database Backup) 是一种定期快照的持久化方式，可以通过配置 <code>redis.conf</code> 来启用：</p>
<pre><code class="hljs language-conf" lang="conf">save 900 1
save 300 10
save 60 10000
</code></pre>
<h4 data-id="heading-11">AOF 持久化</h4>
<p>AOF (Append-Only File) 是一种将每次写操作记录到日志文件的持久化方式：</p>
<pre><code class="hljs language-conf" lang="conf">appendonly yes
appendfsync everysec
</code></pre>
<h3 data-id="heading-12">6. 实现缓存更新机制</h3>
<p>当数据源（如数据库）更新时，需要同步更新缓存，以确保缓存数据的一致性。常见的策略包括：</p>
<ul>
<li><strong>主动更新</strong>：在数据源更新时，主动更新或删除缓存。</li>
<li><strong>定时刷新</strong>：定期刷新缓存中的数据。</li>
<li><strong>缓存失效</strong>：设置合理的过期时间，让缓存自动失效。</li>
</ul>
<h4 data-id="heading-13">主动更新示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cacheExpireTime;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Cache</span><span class="hljs-params">(Jedis jedis, <span class="hljs-type">int</span> cacheExpireTime)</span> {
        <span class="hljs-built_in">this</span>.jedis = jedis;
        <span class="hljs-built_in">this</span>.cacheExpireTime = cacheExpireTime;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getData</span><span class="hljs-params">(String key, Database db)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> jedis.get(key);
        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 缓存未命中，从数据库查询</span>
            value = db.query(key);
            <span class="hljs-comment">// 将结果缓存到 Redis，并设置过期时间</span>
            jedis.setex(key, cacheExpireTime, value);
        }
        <span class="hljs-keyword">return</span> value;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateData</span><span class="hljs-params">(String key, String newValue)</span> {
        <span class="hljs-comment">// 更新数据库</span>
        <span class="hljs-comment">// db.update(key, newValue);</span>

        <span class="hljs-comment">// 更新缓存</span>
        jedis.setex(key, cacheExpireTime, newValue);
    }
}
</code></pre>
<h3 data-id="heading-14">总结</h3>
<p>Redis 提供了强大的缓存机制，能够有效提升系统性能。在使用 Redis 实现缓存时，可以利用其提供的多种缓存策略、过期策略和淘汰策略，并结合实际业务需求进行合理配置。此外，通过缓存数据库查询结果、实现缓存更新机制，可以确保缓存数据的一致性和有效性。通过上述示例代码，可以帮助你更好地理解和实现 Redis 的缓存机制。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（119）Redis的安全机制如何配置？]]></title>    <link>https://juejin.cn/post/7571272874847682612</link>    <guid>https://juejin.cn/post/7571272874847682612</guid>    <pubDate>2025-11-11T23:07:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571272874847682612" data-draft-id="7571285984089980980" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（119）Redis的安全机制如何配置？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T23:07:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（119）Redis的安全机制如何配置？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T23:07:57.000Z" title="Tue Nov 11 2025 23:07:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis 提供了一些安全机制来保护其免受未授权访问和其他潜在的安全威胁。以下是 Redis 安全机制的详细介绍及配置示例。</p>
<h3 data-id="heading-0">1. 绑定 IP 地址</h3>
<p>Redis 默认监听所有网络接口，建议将其绑定到指定的 IP 地址以限制访问范围。可以在 <code>redis.conf</code> 文件中配置 <code>bind</code> 选项：</p>
<pre><code class="hljs language-conf" lang="conf"># 绑定到本地回环地址
bind 127.0.0.1
</code></pre>
<h3 data-id="heading-1">2. 设置密码</h3>
<p>Redis 支持设置密码来限制未授权访问。可以在 <code>redis.conf</code> 文件中配置 <code>requirepass</code> 选项：</p>
<pre><code class="hljs language-conf" lang="conf"># 设置访问密码
requirepass your_password_here
</code></pre>
<p>在代码中需要使用密码进行连接：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisAuthExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            jedis.auth(<span class="hljs-string">"your_password_here"</span>);
            jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> jedis.get(<span class="hljs-string">"key"</span>);
            System.out.println(<span class="hljs-string">"key: "</span> + value);
        }
    }
}
</code></pre>
<h3 data-id="heading-2">3. 保护模式</h3>
<p>Redis 从版本 3.2 开始引入了保护模式。在保护模式下，如果没有设置密码且 Redis 绑定到所有网络接口（0.0.0.0），则默认拒绝外部连接。可以在 <code>redis.conf</code> 文件中配置 <code>protected-mode</code> 选项：</p>
<pre><code class="hljs language-conf" lang="conf">protected-mode yes
</code></pre>
<h3 data-id="heading-3">4. 禁用危险命令</h3>
<p>出于安全考虑，可以禁用一些危险命令，如 <code>FLUSHALL</code>、<code>CONFIG</code> 等。可以在 <code>redis.conf</code> 文件中配置 <code>rename-command</code> 选项将这些命令重命名为一个无效的命令：</p>
<pre><code class="hljs language-conf" lang="conf"># 重命名危险命令，使其不可用
rename-command FLUSHALL ""
rename-command CONFIG ""
</code></pre>
<h3 data-id="heading-4">5. 通过防火墙限制访问</h3>
<p>除了在 <code>redis.conf</code> 中进行配置，还可以使用防火墙来限制 Redis 的访问。例如，在 Linux 上使用 <code>iptables</code>：</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 只允许本地访问 Redis</span>
iptables -A INPUT -p tcp --dport 6379 -s 127.0.0.1 -j ACCEPT
iptables -A INPUT -p tcp --dport 6379 -j DROP
</code></pre>
<h3 data-id="heading-5">6. 启用 TLS 加密</h3>
<p>从 Redis 6.0 开始，Redis 支持 TLS 加密。配置 TLS 加密需要生成证书和密钥，并在 <code>redis.conf</code> 文件中进行配置：</p>
<pre><code class="hljs language-conf" lang="conf">tls-port 6379
port 0
tls-cert-file /path/to/redis.crt
tls-key-file /path/to/redis.key
tls-ca-cert-file /path/to/ca.crt
</code></pre>
<p>客户端连接时也需要使用 TLS 证书：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisShardInfo;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisTLSExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">JedisShardInfo</span> <span class="hljs-variable">shardInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisShardInfo</span>(<span class="hljs-string">"rediss://localhost:6379"</span>);
        shardInfo.setPassword(<span class="hljs-string">"your_password_here"</span>);
        shardInfo.setSsl(<span class="hljs-literal">true</span>);
        shardInfo.setSslSocketFactory(SSLContext.getDefault().getSocketFactory());

        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(shardInfo)) {
            jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> jedis.get(<span class="hljs-string">"key"</span>);
            System.out.println(<span class="hljs-string">"key: "</span> + value);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<h3 data-id="heading-6">7. 配置客户端连接限制</h3>
<p>通过配置 <code>redis.conf</code> 文件中的 <code>maxclients</code> 选项，可以限制同时连接到 Redis 的最大客户端数量，以防止资源耗尽：</p>
<pre><code class="hljs language-conf" lang="conf">maxclients 10000
</code></pre>
<h3 data-id="heading-7">8. 配置最大内存使用</h3>
<p>通过配置 <code>redis.conf</code> 文件中的 <code>maxmemory</code> 选项，可以限制 Redis 使用的最大内存量，以防止内存使用过多：</p>
<pre><code class="hljs language-conf" lang="conf">maxmemory 256mb
</code></pre>
<h3 data-id="heading-8">9. 日志审计</h3>
<p>Redis 支持将日志记录到文件或标准输出。可以在 <code>redis.conf</code> 文件中配置 <code>logfile</code> 和 <code>loglevel</code> 选项：</p>
<pre><code class="hljs language-conf" lang="conf">logfile "/var/log/redis/redis-server.log"
loglevel notice
</code></pre>
<h3 data-id="heading-9">10. 示例配置文件</h3>
<p>以下是一个示例 <code>redis.conf</code> 文件，结合了上述安全配置：</p>
<pre><code class="hljs language-conf" lang="conf"># 网络绑定
bind 127.0.0.1

# 保护模式
protected-mode yes

# 访问密码
requirepass your_password_here

# 重命名危险命令
rename-command FLUSHALL ""
rename-command CONFIG ""

# TLS 加密
tls-port 6379
port 0
tls-cert-file /path/to/redis.crt
tls-key-file /path/to/redis.key
tls-ca-cert-file /path/to/ca.crt

# 客户端连接限制
maxclients 10000

# 最大内存使用
maxmemory 256mb

# 日志配置
logfile "/var/log/redis/redis-server.log"
loglevel notice
</code></pre>
<h3 data-id="heading-10">总结</h3>
<p>通过合理配置 Redis 的安全机制，可以有效地保护 Redis 实例免受未授权访问和其他潜在的安全威胁。上述配置涵盖了 IP 绑定、密码保护、保护模式、禁用危险命令、防火墙限制、TLS 加密、客户端连接限制、最大内存使用和日志审计等方面。结合具体业务需求，可以进一步定制和优化 Redis 的安全配置。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET ControllerBase 深入解析：Web API 控制器的核心基石]]></title>    <link>https://juejin.cn/post/7571342319892922403</link>    <guid>https://juejin.cn/post/7571342319892922403</guid>    <pubDate>2025-11-11T23:19:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571342319892922403" data-draft-id="7571285984090030132" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET ControllerBase 深入解析：Web API 控制器的核心基石"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-11T23:19:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET ControllerBase 深入解析：Web API 控制器的核心基石
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T23:19:09.000Z" title="Tue Nov 11 2025 23:19:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>ControllerBase</code> 是 <code>ASP.NET Core</code> 中构建 <code>Web API</code> 控制器的基类，位于 <code>Microsoft.AspNetCore.Mvc</code> 命名空间。它提供了丰富的功能来处理 <code>HTTP</code> 请求，但不包含视图支持。</p>
<p>核心功能：</p>
<ul>
<li>
<p><code>HTTP</code> 响应：提供方法（如 <code>Ok、NotFound</code>）生成标准 <code>HTTP</code> 响应。</p>
</li>
<li>
<p>模型绑定：自动将请求数据绑定到参数（如查询字符串、请求体）。</p>
</li>
<li>
<p>验证支持：结合 <code>[ApiController]</code> 实现自动模型验证。</p>
</li>
<li>
<p>异步友好：支持 <code>async/await</code> 处理高并发请求。</p>
</li>
<li>
<p>轻量设计：不包含 <code>MVC</code> 视图相关的功能，适合 <code>API</code> 场景。</p>
</li>
</ul>
<h3 data-id="heading-1">ControllerBase 的定位</h3>
<ul>
<li>
<p>位于命名空间 <code>Microsoft.AspNetCore.Mvc</code>，是所有 <code>Web API</code> 控制器的基类。</p>
</li>
<li>
<p>与 MVC 的 <code>Controller</code> 相比，<code>ControllerBase</code> 不包含视图（<code>Razor</code>）相关功能，仅提供 内容结果、状态码、路由绑定、模型验证 等 <code>Web API</code> 核心支持。</p>
</li>
<li>
<p>通常搭配 <code>[ApiController]</code> 特性使用，开启自动模型验证、参数绑定规则和返回行为。</p>
</li>
</ul>
<h3 data-id="heading-2">继承体系</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">object</span>
 └─ ControllerBase
     ├─ Controller         <span class="hljs-comment">// 包含 View()、PartialView() 等 MVC 视图方法</span>
     └─ 用户自定义 Controllers…
</code></pre>
<ul>
<li>
<p><code>ControllerBase</code></p>
<ul>
<li>
<p>提供结果工厂方法（<code>Ok(), CreatedAtAction()</code> 等）</p>
</li>
<li>
<p>包含属性如 <code>Request、Response、ModelState、User</code></p>
</li>
<li>
<p>实现接口 <code>IActionFilterMetadata、IActionResult</code> 等元数据标记</p>
</li>
</ul>
</li>
<li>
<p><code>Controller</code>（典型用于 <code>MVC</code>）</p>
<ul>
<li>继承自 <code>ControllerBase</code> 并额外添加视图渲染方法</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">构造注入与内置属性</h3>
<p>在自定义 <code>API</code> 控制器中，通常这样声明：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"api/[controller]"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProductsController</span> : <span class="hljs-title">ControllerBase</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IProductService _svc;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ProductsController</span>(<span class="hljs-params">IProductService svc</span>)</span>
    {
        _svc = svc;
    }
    <span class="hljs-comment">// Action 方法…</span>
}
</code></pre>
<ul>
<li>
<p><code>[ApiController]</code></p>
<ul>
<li>
<p>自动执行模型验证，错误时直接返回 400</p>
</li>
<li>
<p>简化参数绑定（如 <code>[FromBody]、[FromQuery]</code> 默认行为）</p>
</li>
</ul>
</li>
<li>
<p><code>Route、HttpXXX</code> 特性</p>
<ul>
<li>定义路由模板与 <code>HTTP</code> 动作要匹配的请求</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">常用内置属性</h4>

































<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td><code>HttpContext</code></td><td>当前请求上下文</td></tr><tr><td><code>Request</code></td><td>快速访问 <code>HttpContext.Request</code></td></tr><tr><td><code>Response</code></td><td>快速访问 <code>HttpContext.Response</code></td></tr><tr><td><code>User</code></td><td>当前认证用户的 <code>ClaimsPrincipal</code></td></tr><tr><td><code>RouteData</code></td><td>路由参数及其绑定值</td></tr><tr><td><code>ModelState</code></td><td>模型验证状态与错误详情</td></tr></tbody></table>
<h3 data-id="heading-5">结果工厂方法</h3>
<p><code>ControllerBase</code> 提供一系列返回 <code>ActionResult</code> 的方法，用于快速构造 <code>HTTP</code> 响应：</p>
<h4 data-id="heading-6">成功响应</h4>






























<table><thead><tr><th>方法</th><th>HTTP 状态码</th><th>说明</th></tr></thead><tbody><tr><td><code>Ok()</code> / <code>Ok(object value)</code></td><td>200</td><td>返回 200，带或不带响应体</td></tr><tr><td><code>Created(string uri, object value)</code></td><td>201</td><td>资源已创建，Location 头部指定新资源 URI</td></tr><tr><td><code>CreatedAtAction(...)</code> / <code>CreatedAtRoute(...)</code></td><td>201</td><td>指定路由或动作生成 Location</td></tr><tr><td><code>NoContent()</code></td><td>204</td><td>成功但无响应体</td></tr></tbody></table>
<h4 data-id="heading-7">客户端错误</h4>








































<table><thead><tr><th>方法</th><th>HTTP 状态码</th><th>说明</th></tr></thead><tbody><tr><td><code>BadRequest()</code> / <code>BadRequest(object error)</code></td><td>400</td><td>返回模型验证错误或自定义错误消息</td></tr><tr><td><code>Unauthorized()</code></td><td>401</td><td>未认证</td></tr><tr><td><code>Forbid()</code></td><td>403</td><td>无访问权限</td></tr><tr><td><code>NotFound()</code> / <code>NotFound(object value)</code></td><td>404</td><td>资源未找到</td></tr><tr><td><code>Conflict()</code></td><td>409</td><td>冲突，如重复资源</td></tr><tr><td><code>UnsupportedMediaType()</code></td><td>415</td><td>不支持的媒体类型</td></tr></tbody></table>
<h4 data-id="heading-8">服务端错误</h4>




















<table><thead><tr><th>方法</th><th>HTTP 状态码</th><th>说明</th></tr></thead><tbody><tr><td><code>StatusCode(int statusCode)</code></td><td>自定义</td><td>返回任意状态码</td></tr><tr><td><code>Problem()</code></td><td>500+</td><td>按 RFC 7807 生成标准化错误响应体</td></tr></tbody></table>
<blockquote>
<p>Tip: 这些工厂方法本质上返回了实现 IActionResult 的对象，框架在管道末端执行并写入 HTTP。</p>
</blockquote>
<h3 data-id="heading-9">核心功能详解</h3>
<h4 data-id="heading-10">HTTP 响应方法</h4>
<p>状态码响应</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">HttpGet(<span class="hljs-string">"{id}"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetProduct</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> id</span>)</span>
{
    <span class="hljs-keyword">var</span> product = _repository.Get(id);
    
    <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> NotFound(); <span class="hljs-comment">// 404</span>
    
    <span class="hljs-keyword">return</span> Ok(product); <span class="hljs-comment">// 200 + 数据</span>
}
</code></pre>
<p>文件响应</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">HttpGet(<span class="hljs-string">"download/{fileName}"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">DownloadFile</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> fileName</span>)</span>
{
    <span class="hljs-keyword">var</span> filePath = Path.Combine(_env.ContentRootPath, <span class="hljs-string">"Files"</span>, fileName);
    
    <span class="hljs-keyword">if</span> (!System.IO.File.Exists(filePath))
        <span class="hljs-keyword">return</span> NotFound();
    
    <span class="hljs-keyword">var</span> fileBytes = System.IO.File.ReadAllBytes(filePath);
    <span class="hljs-keyword">return</span> File(fileBytes, <span class="hljs-string">"application/octet-stream"</span>, fileName);
}
</code></pre>
<h4 data-id="heading-11">请求上下文访问</h4>
<p>常用属性</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProductsController</span> : <span class="hljs-title">ControllerBase</span>
{
    [<span class="hljs-meta">HttpGet(<span class="hljs-string">"info"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetInfo</span>()</span>
    {
        <span class="hljs-comment">// 获取请求信息</span>
        <span class="hljs-keyword">var</span> method = Request.Method;
        <span class="hljs-keyword">var</span> contentType = Request.ContentType;
        
        <span class="hljs-comment">// 获取用户信息</span>
        <span class="hljs-keyword">var</span> userName = User.Identity?.Name;
        <span class="hljs-keyword">var</span> isAdmin = User.IsInRole(<span class="hljs-string">"Admin"</span>);
        
        <span class="hljs-comment">// 获取路由数据</span>
        <span class="hljs-keyword">var</span> routeId = RouteData.Values[<span class="hljs-string">"id"</span>];
        
        <span class="hljs-keyword">return</span> Ok(<span class="hljs-keyword">new</span> { method, userName });
    }
}
</code></pre>
<h4 data-id="heading-12">模型绑定与验证</h4>
<ul>
<li>
<p>自动验证（启用 <code>[ApiController]</code> 时）</p>
<ul>
<li>
<p>在 <code>Action</code> 执行前对标注了验证特性的模型进行验证</p>
</li>
<li>
<p><code>ModelState.IsValid == false</code> 则自动返回 400 <code>Bad Request</code>，响应体包含错误详情</p>
</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">HttpPost</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">CreateProduct</span>(<span class="hljs-params">
    [FromBody] Product product, // 从JSON绑定
    [FromQuery] <span class="hljs-built_in">string</span> category, // 从查询字符串绑定
    [FromHeader] <span class="hljs-built_in">string</span> apiKey</span>) <span class="hljs-comment">// 从请求头绑定</span></span>
{
    <span class="hljs-comment">// 自动模型验证</span>
    <span class="hljs-keyword">if</span> (!ModelState.IsValid)
    {
        <span class="hljs-keyword">return</span> BadRequest(ModelState);
    }
    
    <span class="hljs-comment">// 业务逻辑处理</span>
    <span class="hljs-keyword">var</span> createdProduct = _service.Create(product, category);
    
    <span class="hljs-keyword">return</span> CreatedAtAction(<span class="hljs-keyword">nameof</span>(GetProduct), 
        <span class="hljs-keyword">new</span> { id = createdProduct.Id }, createdProduct);
}
</code></pre>
<h3 data-id="heading-13">高级功能与最佳实践</h3>
<h4 data-id="heading-14">操作结果包装</h4>
<p>自定义统一响应格式</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ApiResult</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">IActionResult</span>
{
    <span class="hljs-keyword">public</span> T Data { <span class="hljs-keyword">get</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> StatusCode { <span class="hljs-keyword">get</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Message { <span class="hljs-keyword">get</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApiResult</span>(<span class="hljs-params">T data, <span class="hljs-built_in">int</span> statusCode = <span class="hljs-number">200</span>, <span class="hljs-built_in">string</span>? message = <span class="hljs-literal">null</span></span>)</span>
    {
        Data = data;
        StatusCode = statusCode;
        Message = message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ExecuteResultAsync</span>(<span class="hljs-params">ActionContext context</span>)</span>
    {
        <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> ObjectResult(<span class="hljs-keyword">new</span>
        {
            Success = StatusCode &gt;= <span class="hljs-number">200</span> &amp;&amp; StatusCode &lt; <span class="hljs-number">300</span>,
            Data,
            Message,
            Timestamp = DateTime.UtcNow
        })
        {
            StatusCode = StatusCode
        };

        <span class="hljs-keyword">await</span> result.ExecuteResultAsync(context);
    }
}

<span class="hljs-comment">// 在控制器中使用</span>
[<span class="hljs-meta">HttpGet(<span class="hljs-string">"{id}"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> ApiResult&lt;Product&gt; <span class="hljs-title">GetProduct</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> id</span>)</span>
{
    <span class="hljs-keyword">var</span> product = _repository.Get(id);
    <span class="hljs-keyword">return</span> product == <span class="hljs-literal">null</span> 
        ? <span class="hljs-keyword">new</span> ApiResult&lt;Product&gt;(<span class="hljs-literal">null</span>, <span class="hljs-number">404</span>, <span class="hljs-string">"Product not found"</span>) 
        : <span class="hljs-keyword">new</span> ApiResult&lt;Product&gt;(product);
}
</code></pre>
<h4 data-id="heading-15">内容协商</h4>
<p>支持多种响应格式</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"api/[controller]"</span>)</span>]
[<span class="hljs-meta">Produces(<span class="hljs-string">"application/json"</span>, <span class="hljs-string">"application/xml"</span>)</span>] <span class="hljs-comment">// 支持的响应类型</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProductsController</span> : <span class="hljs-title">ControllerBase</span>
{
    [<span class="hljs-meta">HttpGet</span>]
    <span class="hljs-keyword">public</span> ActionResult&lt;IEnumerable&lt;Product&gt;&gt; GetAll()
    {
        <span class="hljs-keyword">return</span> _repository.GetAll();
    }
}
</code></pre>
<h4 data-id="heading-16">API 版本控制</h4>
<p>实现 <code>API</code> 版本管理</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">ApiVersion(<span class="hljs-string">"1.0"</span>)</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"api/v{version:apiVersion}/[controller]"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProductsController</span> : <span class="hljs-title">ControllerBase</span>
{
    [<span class="hljs-meta">HttpGet</span>]
    [<span class="hljs-meta">MapToApiVersion(<span class="hljs-string">"1.0"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;Product&gt; <span class="hljs-title">GetV1</span>()</span>
    {
        <span class="hljs-comment">// 版本1.0的实现</span>
    }

    [<span class="hljs-meta">HttpGet</span>]
    [<span class="hljs-meta">MapToApiVersion(<span class="hljs-string">"2.0"</span>)</span>]
    <span class="hljs-keyword">public</span> ActionResult&lt;IEnumerable&lt;ProductDto&gt;&gt; GetV2()
    {
        <span class="hljs-comment">// 版本2.0的实现</span>
    }
}
</code></pre>
<h4 data-id="heading-17">异步支持</h4>
<ul>
<li><code>ControllerBase</code> 建议写 异步 <code>Action</code>，返回 <code>Task&lt;IActionResult&gt;</code> 或直接 <code>Task&lt;T&gt;</code>（结合泛型 <code>ActionResult&lt;T&gt;</code>）：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">HttpGet(<span class="hljs-string">"{id}"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ActionResult&lt;Product&gt;&gt; Get(<span class="hljs-built_in">int</span> id)
{
    <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">await</span> _svc.FindAsync(id);
    <span class="hljs-keyword">return</span> p <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span> ? NotFound() : Ok(p);
}
</code></pre>
<ul>
<li>
<p><code>ActionResult&lt;T&gt;</code>（.NET Core 2.1+）</p>
<ul>
<li>允许方法既返回 <code>T</code>（自动包装为 200）也返回 <code>ActionResult</code>（可自定义状态码）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">过滤器与管道</h3>
<ul>
<li>
<p><code>ControllerBase</code> 支持注册和应用各种 过滤器：</p>
<ul>
<li>
<p>授权过滤器（<code>[Authorize]</code>）</p>
</li>
<li>
<p>资源过滤器（<code>IResourceFilter</code>）</p>
</li>
<li>
<p>动作过滤器（<code>IActionFilter</code>）</p>
</li>
<li>
<p>异常过滤器（<code>IExceptionFilter</code>）</p>
</li>
<li>
<p>结果过滤器（<code>IResultFilter</code>）</p>
</li>
</ul>
</li>
<li>
<p>示例：全局注册</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">services.AddControllers(options =&gt;
{
    options.Filters.Add&lt;GlobalExceptionFilter&gt;();
});
</code></pre>
<ul>
<li>示例：单控制器/Action 应用</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">TypeFilter(typeof(LogActionFilter))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyController</span> : <span class="hljs-title">ControllerBase</span> { … }
</code></pre>
<h3 data-id="heading-19">安全最佳实践</h3>
<h4 data-id="heading-20">身份验证与授权</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Authorize</span>] <span class="hljs-comment">// 控制器级别要求认证</span>
[<span class="hljs-meta">Route(<span class="hljs-string">"api/[controller]"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrdersController</span> : <span class="hljs-title">ControllerBase</span>
{
    [<span class="hljs-meta">HttpGet</span>]
    [<span class="hljs-meta">Authorize(Roles = <span class="hljs-string">"Admin"</span>)</span>] <span class="hljs-comment">// 要求管理员角色</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetAllOrders</span>()</span> { <span class="hljs-comment">/* ... */</span> }

    [<span class="hljs-meta">HttpGet(<span class="hljs-string">"my"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetMyOrders</span>()</span>
    {
        <span class="hljs-comment">// 获取当前用户ID</span>
        <span class="hljs-keyword">var</span> userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
        <span class="hljs-keyword">return</span> Ok(_repository.GetOrdersByUser(userId));
    }

    [<span class="hljs-meta">HttpPost</span>]
    [<span class="hljs-meta">Authorize(Policy = <span class="hljs-string">"RequireVerifiedEmail"</span>)</span>] <span class="hljs-comment">// 使用自定义策略</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">CreateOrder</span>(<span class="hljs-params">[FromBody] Order order</span>)</span> { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h4 data-id="heading-21">跨域资源共享 (CORS)</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"api/[controller]"</span>)</span>]
[<span class="hljs-meta">EnableCors(<span class="hljs-string">"AllowSpecificOrigin"</span>)</span>] <span class="hljs-comment">// 启用CORS策略</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PublicDataController</span> : <span class="hljs-title">ControllerBase</span>
{
    [<span class="hljs-meta">HttpGet</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetPublicData</span>()</span> { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-comment">// 在Startup中配置CORS策略</span>
services.AddCors(options =&gt;
{
    options.AddPolicy(<span class="hljs-string">"AllowSpecificOrigin"</span>,
        builder =&gt; builder.WithOrigins(<span class="hljs-string">"https://example.com"</span>)
                          .AllowAnyMethod()
                          .AllowAnyHeader());
});
</code></pre>
<h3 data-id="heading-22">常见问题解决方案</h3>
<h4 data-id="heading-23">模型验证统一处理</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 创建统一验证过滤器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ValidateModelAttribute</span> : <span class="hljs-title">ActionFilterAttribute</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnActionExecuting</span>(<span class="hljs-params">ActionExecutingContext context</span>)</span>
    {
        <span class="hljs-keyword">if</span> (!context.ModelState.IsValid)
        {
            context.Result = <span class="hljs-keyword">new</span> BadRequestObjectResult(<span class="hljs-keyword">new</span>
            {
                Code = <span class="hljs-number">400</span>,
                Message = <span class="hljs-string">"参数验证失败"</span>,
                Errors = context.ModelState
                    .SelectMany(m =&gt; m.Value.Errors)
                    .Select(e =&gt; e.ErrorMessage)
            });
        }
    }
}

<span class="hljs-comment">// 全局注册</span>
services.AddControllers(options =&gt; 
{
    options.Filters.Add&lt;ValidateModelAttribute&gt;();
});
</code></pre>
<h4 data-id="heading-24">全局异常处理</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ApiExceptionFilter</span> : <span class="hljs-title">IExceptionFilter</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnException</span>(<span class="hljs-params">ExceptionContext context</span>)</span>
    {
        <span class="hljs-keyword">var</span> exception = context.Exception;
        <span class="hljs-keyword">var</span> statusCode = exception <span class="hljs-keyword">switch</span>
        {
            NotFoundException =&gt; <span class="hljs-number">404</span>,
            ValidationException =&gt; <span class="hljs-number">400</span>,
            UnauthorizedAccessException =&gt; <span class="hljs-number">401</span>,
            _ =&gt; <span class="hljs-number">500</span>
        };

        context.Result = <span class="hljs-keyword">new</span> ObjectResult(<span class="hljs-keyword">new</span>
        {
            Code = statusCode,
            Message = exception.Message
        })
        {
            StatusCode = statusCode
        };
        
        context.ExceptionHandled = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h3 data-id="heading-25">ControllerBase 最佳实践总结</h3>
<h4 data-id="heading-26">API 设计规范</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用HTTP动词特性</span>
[<span class="hljs-meta">HttpGet(<span class="hljs-string">"{id}"</span>)</span>]
[<span class="hljs-meta">HttpPost</span>]
[<span class="hljs-meta">HttpPut(<span class="hljs-string">"{id}"</span>)</span>]
[<span class="hljs-meta">HttpDelete(<span class="hljs-string">"{id}"</span>)</span>]
</code></pre>
<h4 data-id="heading-27">响应类型声</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ProducesResponseType(StatusCodes.Status200OK, Type = typeof(Product))</span>]
[<span class="hljs-meta">ProducesResponseType(StatusCodes.Status404NotFound)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetProduct</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> id</span>)</span> { <span class="hljs-comment">/* ... */</span> }
</code></pre>
<h4 data-id="heading-28">异步优先</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">Get</span>()</span> { <span class="hljs-comment">/* ... */</span> }
</code></pre>
<h4 data-id="heading-29">依赖注入</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyController</span>(<span class="hljs-params">IMyService service</span>)</span> { <span class="hljs-comment">/* ... */</span> }
</code></pre>
<h4 data-id="heading-30">安全加固</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Authorize</span>]
[<span class="hljs-meta">ValidateAntiForgeryToken</span>]
[<span class="hljs-meta">EnableCors(<span class="hljs-string">"SafePolicy"</span>)</span>]
</code></pre>
<h4 data-id="heading-31">版本管理</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiVersion(<span class="hljs-string">"1.0"</span>)</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"api/v{version:apiVersion}/[controller]"</span>)</span>]
</code></pre>
<h4 data-id="heading-32">统一响应格式</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">return</span> Ok(<span class="hljs-keyword">new</span> { Data = result, Message = <span class="hljs-string">"Success"</span> });
</code></pre>
<h3 data-id="heading-33">资源和文档</h3>
<ul>
<li>
<p>官方文档：</p>
<ul>
<li>
<p><code>Microsoft Learn</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Faspnet%2Fcore%2Fmvc%2Fcontrollers" target="_blank" title="https://learn.microsoft.com/en-us/aspnet/core/mvc/controllers" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/aspne…</a></p>
</li>
<li>
<p><code>ControllerBase</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fdotnet%2Fapi%2Fmicrosoft.aspnetcore.mvc.controllerbase" target="_blank" title="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.controllerbase" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/dotne…</a></p>
</li>
</ul>
</li>
<li>
<p><code>NuGet</code> 包：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nuget.org%2Fpackages%2FMicrosoft.AspNetCore.Mvc.Core" target="_blank" title="https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Core" ref="nofollow noopener noreferrer">www.nuget.org/packages/Mi…</a></p>
</li>
<li>
<p><code>GitHub</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotnet%2Faspnetcore" target="_blank" title="https://github.com/dotnet/aspnetcore" ref="nofollow noopener noreferrer">github.com/dotnet/aspn…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在重复造轮子？掌握这7个原则，让你的Vue组件复用性飙升！]]></title>    <link>https://juejin.cn/post/7571355146770251818</link>    <guid>https://juejin.cn/post/7571355146770251818</guid>    <pubDate>2025-11-11T23:25:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571355146770251818" data-draft-id="7571334572768804907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在重复造轮子？掌握这7个原则，让你的Vue组件复用性飙升！"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-11T23:25:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在重复造轮子？掌握这7个原则，让你的Vue组件复用性飙升！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T23:25:27.000Z" title="Tue Nov 11 2025 23:25:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是经常遇到这样的情况：每次开始新项目，都要把之前的组件复制粘贴一遍，然后修修补补？或者在团队协作时，发现同事写的组件根本没法直接用，只能重写？</p>
<p>说实话，这种重复劳动真的挺浪费时间的。不过别担心，今天我就来分享7个编写高复用性Vue组件的核心原则。掌握了这些，你的开发效率至少能提升一倍！</p>
<p>读完这篇文章，你会获得一套完整的组件设计思路，从设计理念到具体实现，还有可以直接复用的代码示例。准备好了吗？让我们开始吧！</p>
<h2 data-id="heading-0">原则一：单一职责，让组件更专注</h2>
<p>一个组件应该只做好一件事。就像餐厅里的厨师，有人专门切菜，有人专门炒菜，各司其职才能高效运作。</p>
<p>想象一下，如果一个组件既负责表单验证，又要处理数据请求，还要管UI展示，那它就会变得臃肿不堪，难以维护。我们来对比一下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不好的做法：职责过多</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div&gt;
      &lt;form @submit="handleSubmit"&gt;
        &lt;input v-model="formData.name" /&gt;
        &lt;button type="submit"&gt;提交&lt;/button&gt;
      &lt;/form&gt;
      &lt;div v-if="loading"&gt;加载中...&lt;/div&gt;
      &lt;div v-else&gt;{{ data }}&lt;/div&gt;
    &lt;/div&gt;
  `</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">formData</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">''</span> },
      <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>
      <span class="hljs-comment">// 这里混入了数据请求逻辑</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/submit'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">formData</span>)
      })
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>
    }
  }
}
</code></pre>
<p>看到问题了吗？这个组件把表单展示、表单处理、数据请求全都混在一起了。正确的做法应该是：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 好的做法：职责单一</span>
<span class="hljs-comment">// FormComponent.vue - 只负责表单展示和基础交互</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;form @submit="$emit('submit', formData)"&gt;
      &lt;input v-model="formData.name" /&gt;
      &lt;button type="submit"&gt;提交&lt;/button&gt;
    &lt;/form&gt;
  `</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">formData</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">''</span> }
    }
  }
}

<span class="hljs-comment">// 在父组件中处理业务逻辑</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div&gt;
      &lt;FormComponent @submit="handleSubmit" /&gt;
      &lt;div v-if="loading"&gt;加载中...&lt;/div&gt;
      &lt;div v-else&gt;{{ data }}&lt;/div&gt;
    &lt;/div&gt;
  `</span>,
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">FormComponent</span> },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">formData</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">$api</span>.<span class="hljs-title function_">submit</span>(formData)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>
    }
  }
}
</code></pre>
<p>这样拆分后，FormComponent就可以在任何需要表单的地方复用了，而业务逻辑则由父组件负责。</p>
<h2 data-id="heading-1">原则二：props设计要合理，让组件更灵活</h2>
<p>props是组件与外界通信的桥梁，设计好坏直接决定了组件的复用性。好的props设计应该像乐高积木一样，可以灵活组合。</p>
<p>先来看一个常见的按钮组件例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基础按钮组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">type</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-string">'default'</span>,
      <span class="hljs-attr">validator</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> [<span class="hljs-string">'default'</span>, <span class="hljs-string">'primary'</span>, <span class="hljs-string">'danger'</span>].<span class="hljs-title function_">includes</span>(value)
    },
    <span class="hljs-attr">size</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-string">'medium'</span>,
      <span class="hljs-attr">validator</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> [<span class="hljs-string">'small'</span>, <span class="hljs-string">'medium'</span>, <span class="hljs-string">'large'</span>].<span class="hljs-title function_">includes</span>(value)
    },
    <span class="hljs-attr">disabled</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
    },
    <span class="hljs-attr">loading</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;button 
      :class="['btn', `</span>btn-${type}<span class="hljs-string">`, `</span>btn-${size}<span class="hljs-string">`]"
      :disabled="disabled || loading"
    &gt;
      &lt;span v-if="loading" class="loading-spinner"&gt;&lt;/span&gt;
      &lt;slot&gt;&lt;/slot&gt;
    &lt;/button&gt;
  `</span>
}
</code></pre>
<p>这个设计已经不错了，但还可以更好。我们经常遇到需要传递原生HTML属性的情况，比如id、class、style等。这时候可以用<code>v-bind="$attrs"</code>来简化：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">inheritAttrs</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 禁止自动绑定到根元素</span>
  <span class="hljs-attr">props</span>: {
    <span class="hljs-comment">// ... 其他props</span>
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;button 
      v-bind="$attrs"
      :class="['btn', `</span>btn-${type}<span class="hljs-string">`, `</span>btn-${size}<span class="hljs-string">`]"
      :disabled="disabled || loading"
    &gt;
      &lt;span v-if="loading" class="loading-spinner"&gt;&lt;/span&gt;
      &lt;slot&gt;&lt;/slot&gt;
    &lt;/button&gt;
  `</span>
}

<span class="hljs-comment">// 使用时就非常方便了</span>
&lt;<span class="hljs-title class_">MyButton</span> 
  id=<span class="hljs-string">"submit-btn"</span>
  <span class="hljs-keyword">class</span>=<span class="hljs-string">"custom-class"</span>
  type=<span class="hljs-string">"primary"</span>
  @click=<span class="hljs-string">"handleClick"</span>
  点击我
&lt;/<span class="hljs-title class_">MyButton</span>&gt;
</code></pre>
<h2 data-id="heading-2">原则三：巧用插槽，让内容更自由</h2>
<p>插槽是Vue组件复用的超级武器！它允许父组件向子组件传递任意内容，大大增强了组件的灵活性。</p>
<p>最基本的用法就是默认插槽：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Card组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div class="card"&gt;
      &lt;div class="card-header"&gt;
        &lt;slot name="header"&gt;&lt;/slot&gt;
      &lt;/div&gt;
      &lt;div class="card-body"&gt;
        &lt;slot&gt;&lt;/slot&gt; &lt;!-- 默认插槽 --&gt;
      &lt;/div&gt;
      &lt;div class="card-footer"&gt;
        &lt;slot name="footer"&gt;&lt;/slot&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  `</span>
}

<span class="hljs-comment">// 使用示例</span>
&lt;<span class="hljs-title class_">Card</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>卡片标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
  
  这里是卡片的主要内容，可以放任何东西
  
  &lt;template #footer&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>确定<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  &lt;/template&gt;
&lt;/<span class="hljs-title class_">Card</span>&gt;
</code></pre>
<p>但插槽的真正威力在于作用域插槽。它允许子组件向插槽内容传递数据：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 列表组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'items'</span>],
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;ul class="list"&gt;
      &lt;li v-for="(item, index) in items" :key="item.id"&gt;
        &lt;slot :item="item" :index="index"&gt;&lt;/slot&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  `</span>
}

<span class="hljs-comment">// 使用示例</span>
&lt;<span class="hljs-title class_">List</span> :items=<span class="hljs-string">"userList"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"{ item, index }"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ index + 1 }}.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.avatar"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"editUser(item)"</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">List</span>&gt;
</code></pre>
<p>这样，List组件只负责列表的渲染逻辑，而每个列表项的具体展示内容完全由父组件决定，复用性大大提升！</p>
<h2 data-id="heading-3">原则四：事件通信要清晰，让组件更独立</h2>
<p>组件之间的事件通信就像人与人之间的对话，要清晰明了。好的事件设计能让组件保持独立，便于复用。</p>
<p>先看一个常见的误区：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不好的做法：在组件内部直接修改props</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'value'</span>],
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleInput</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-comment">// 直接修改props，违反了单向数据流</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
    }
  }
}
</code></pre>
<p>正确的做法是使用事件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 好的做法：通过事件通信</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'modelValue'</span>], <span class="hljs-comment">// Vue 3中使用modelValue</span>
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleInput</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'update:modelValue'</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>)
    }
  }
}

<span class="hljs-comment">// 使用v-model</span>
&lt;<span class="hljs-title class_">MyInput</span> v-model=<span class="hljs-string">"username"</span> /&gt;
</code></pre>
<p>对于复杂组件，我们可以设计更详细的事件体系：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 搜索组件示例</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'keywords'</span>],
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleSearch</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'search'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">keywords</span>)
    },
    <span class="hljs-title function_">handleReset</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'reset'</span>)
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'update:keywords'</span>, <span class="hljs-string">''</span>)
    },
    <span class="hljs-title function_">handleInputChange</span>(<span class="hljs-params">value</span>) {
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'update:keywords'</span>, value)
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'input-change'</span>, value)
    }
  }
}
</code></pre>
<h2 data-id="heading-4">原则五：组合式函数，让逻辑更复用</h2>
<p>Composition API是Vue 3的杀手级特性，它让我们可以更好地复用逻辑。把可复用的逻辑抽离成组合式函数，就像拥有了一个自己的工具库。</p>
<p>来看一个数据请求的例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useApi.js - 数据请求逻辑复用</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useApi</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">const</span> error = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    error.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url)
      data.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    } <span class="hljs-keyword">catch</span> (err) {
      error.<span class="hljs-property">value</span> = err.<span class="hljs-property">message</span>
    } <span class="hljs-keyword">finally</span> {
      loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    }
  }
  
  <span class="hljs-keyword">return</span> {
    data,
    loading,
    error,
    fetchData
  }
}

<span class="hljs-comment">// 在组件中使用</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { data, loading, error, fetchData } = <span class="hljs-title function_">useApi</span>(<span class="hljs-string">'/api/users'</span>)
    
    <span class="hljs-comment">// 组件挂载时自动获取数据</span>
    <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">fetchData</span>()
    })
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">userList</span>: data,
      loading,
      error
    }
  }
}
</code></pre>
<p>再来看一个表单验证的例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useFormValidation.js</span>
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useFormValidation</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> errors = <span class="hljs-title function_">ref</span>({})
  
  <span class="hljs-keyword">const</span> rules = {
    <span class="hljs-attr">required</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> !!value || <span class="hljs-string">'该字段是必填的'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-regexp">/.+@.+\..+/</span>.<span class="hljs-title function_">test</span>(value) || <span class="hljs-string">'请输入有效的邮箱地址'</span>,
    <span class="hljs-attr">minLength</span>: <span class="hljs-function"><span class="hljs-params">min</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> 
      value.<span class="hljs-property">length</span> &gt;= min || <span class="hljs-string">`至少需要<span class="hljs-subst">${min}</span>个字符`</span>
  }
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params">field, value, fieldRules</span>) =&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rule <span class="hljs-keyword">of</span> fieldRules) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">typeof</span> rule === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">rule</span>(value) : <span class="hljs-title function_">rule</span>(value)
      <span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">true</span>) {
        errors.<span class="hljs-property">value</span>[field] = result
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
      }
    }
    <span class="hljs-keyword">delete</span> errors.<span class="hljs-property">value</span>[field]
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
  
  <span class="hljs-keyword">const</span> isValid = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> 
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(errors.<span class="hljs-property">value</span>).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>
  )
  
  <span class="hljs-keyword">return</span> {
    errors,
    rules,
    validate,
    isValid
  }
}
</code></pre>
<h2 data-id="heading-5">原则六：提供充分的配置能力</h2>
<p>一个高复用性的组件应该像瑞士军刀一样，能够适应各种使用场景。这就要求我们提供充分的配置能力。</p>
<p>看看这个图标组件的设计：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">size</span>: {
      <span class="hljs-attr">type</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Number</span>],
      <span class="hljs-attr">default</span>: <span class="hljs-string">'1em'</span>
    },
    <span class="hljs-attr">color</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">spin</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">rotate</span>: <span class="hljs-title class_">Number</span>
  },
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-title function_">style</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fontSize</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> === <span class="hljs-string">'number'</span> ? <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.size}</span>px`</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>,
        <span class="hljs-attr">color</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>,
        <span class="hljs-attr">transform</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotate</span> ? <span class="hljs-string">`rotate(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rotate}</span>deg)`</span> : <span class="hljs-literal">null</span>
      }
    },
    <span class="hljs-title function_">className</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'icon'</span>,
        <span class="hljs-string">`icon-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>,
        { <span class="hljs-string">'icon-spin'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">spin</span> }
      ]
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;i :class="className" :style="style"&gt;&lt;/i&gt;
  `</span>
}
</code></pre>
<p>但有时候，仅仅靠props配置还不够。我们可以提供全局配置的能力：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建组件插件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyComponentPlugin</span> = {
  <span class="hljs-title function_">install</span>(<span class="hljs-params">app, options = {}</span>) {
    <span class="hljs-comment">// 合并默认配置和用户配置</span>
    <span class="hljs-keyword">const</span> config = {
      <span class="hljs-attr">size</span>: <span class="hljs-string">'medium'</span>,
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span>,
      ...options
    }
    
    <span class="hljs-comment">// 提供全局配置</span>
    app.<span class="hljs-title function_">provide</span>(<span class="hljs-string">'my-component-config'</span>, config)
    
    <span class="hljs-comment">// 注册全局组件</span>
    app.<span class="hljs-title function_">component</span>(<span class="hljs-string">'MyComponent'</span>, <span class="hljs-title class_">MyComponent</span>)
  }
}

<span class="hljs-comment">// 在main.js中使用</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">MyComponentPlugin</span>, {
  <span class="hljs-attr">size</span>: <span class="hljs-string">'large'</span>,
  <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>
})
</code></pre>
<h2 data-id="heading-6">原则七：文档和类型提示要完善</h2>
<p>再好的组件，如果没有清晰的文档和类型提示，别人（包括未来的你）也很难使用。好的文档就像产品说明书，让使用者一目了然。</p>
<p>对于TypeScript用户，我们可以提供完整的类型定义：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> {
  <span class="hljs-keyword">type</span>?: <span class="hljs-string">'default'</span> | <span class="hljs-string">'primary'</span> | <span class="hljs-string">'danger'</span>
  size?: <span class="hljs-string">'small'</span> | <span class="hljs-string">'medium'</span> | <span class="hljs-string">'large'</span>
  disabled?: <span class="hljs-built_in">boolean</span>
  loading?: <span class="hljs-built_in">boolean</span>
  onClick?: <span class="hljs-function">(<span class="hljs-params">event: MouseEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonSlots</span> {
  <span class="hljs-keyword">default</span>?: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">VNode</span>[]
  icon?: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">VNode</span>[]
}

<span class="hljs-comment">// Button.vue</span>
<span class="hljs-keyword">import</span> { defineComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ButtonProps</span>, <span class="hljs-title class_">ButtonSlots</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./types'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'MyButton'</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">type</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">PropType</span>&lt;<span class="hljs-title class_">ButtonProps</span>[<span class="hljs-string">'type'</span>]&gt;,
      <span class="hljs-attr">default</span>: <span class="hljs-string">'default'</span>
    },
    <span class="hljs-comment">// ... 其他props</span>
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// Vue 3的类型定义方式</span>
  
  <span class="hljs-attr">emits</span>: {
    <span class="hljs-attr">click</span>: <span class="hljs-function">(<span class="hljs-params">event: MouseEvent</span>) =&gt;</span> <span class="hljs-literal">true</span>
  },
  
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props: ButtonProps, { slots, emit }</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">event: MouseEvent</span>) =&gt; {
      <span class="hljs-keyword">if</span> (!props.<span class="hljs-property">disabled</span> &amp;&amp; !props.<span class="hljs-property">loading</span>) {
        <span class="hljs-title function_">emit</span>(<span class="hljs-string">'click'</span>, event)
      }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">class</span>=<span class="hljs-string">{[</span>'<span class="hljs-attr">btn</span>', `<span class="hljs-attr">btn-</span>${<span class="hljs-attr">props.type</span>}`, `<span class="hljs-attr">btn-</span>${<span class="hljs-attr">props.size</span>}`]}
        <span class="hljs-attr">disabled</span>=<span class="hljs-string">{props.disabled</span> || <span class="hljs-attr">props.loading</span>}
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>
      &gt;</span>
        {slots.icon?.()}
        {slots.default?.()}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
    )
  }
})
</code></pre>
<p>除了代码中的类型提示，我们还需要提供使用示例：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## MyButton 按钮组件</span>

<span class="hljs-section">### 基础用法</span>
<span class="hljs-code">```vue
&lt;MyButton @click="handleClick"&gt;点击我&lt;/MyButton&gt;
</span></code></pre>
<h3 data-id="heading-7">不同类型</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;MyButton type="primary"&gt;主要按钮&lt;/MyButton&gt;
&lt;MyButton type="danger"&gt;危险按钮&lt;/MyButton&gt;
</code></pre>
<h3 data-id="heading-8">不同尺寸</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;MyButton size="small"&gt;小按钮&lt;/MyButton&gt;
&lt;MyButton size="large"&gt;大按钮&lt;/MyButton&gt;
</code></pre>
<h3 data-id="heading-9">加载状态</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;MyButton loading&gt;加载中...&lt;/MyButton&gt;
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin">
## 实战：打造一个高复用性的模态框组件

现在，让我们把所有的原则应用起来，打造一个真正高复用性的模态框组件：

```javascript
<span class="hljs-comment">// Modal.vue</span>
export default {
  props: {
    modelValue: <span class="hljs-built_in">Boolean</span>, <span class="hljs-comment">// 控制显示隐藏</span>
    title: String,
    closable: {
      type: <span class="hljs-built_in">Boolean</span>,
      default: <span class="hljs-literal">true</span>
    },
    maskClosable: {
      type: <span class="hljs-built_in">Boolean</span>,
      default: <span class="hljs-literal">true</span>
    },
    showFooter: {
      type: <span class="hljs-built_in">Boolean</span>,
      default: <span class="hljs-literal">true</span>
    }
  },
  emits: [<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">'close'</span>, <span class="hljs-string">'confirm'</span>, <span class="hljs-string">'cancel'</span>],
  
  methods: {
    close() {
      <span class="hljs-keyword">this</span>.$emit(<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-literal">false</span>)
      <span class="hljs-keyword">this</span>.$emit(<span class="hljs-string">'close'</span>)
    },
    
    handleMaskClick() {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.maskClosable) {
        <span class="hljs-keyword">this</span>.close()
      }
    },
    
    handleConfirm() {
      <span class="hljs-keyword">this</span>.$emit(<span class="hljs-string">'confirm'</span>)
      <span class="hljs-keyword">this</span>.close()
    },
    
    handleCancel() {
      <span class="hljs-keyword">this</span>.$emit(<span class="hljs-string">'cancel'</span>)
      <span class="hljs-keyword">this</span>.close()
    }
  },
  
  template: `
    &lt;teleport to=<span class="hljs-string">"body"</span>&gt;
      &lt;div 
        v-<span class="hljs-keyword">if</span>=<span class="hljs-string">"modelValue"</span>
        <span class="hljs-keyword">class</span>=<span class="hljs-string">"modal-mask"</span>
        <span class="hljs-meta">@click</span>=<span class="hljs-string">"handleMaskClick"</span>
      &gt;
        &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"modal-wrapper"</span>&gt;
          &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"modal"</span> <span class="hljs-meta">@click</span>.stop&gt;
            &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"modal-header"</span>&gt;
              &lt;h3&gt;{{ title }}&lt;/h3&gt;
              &lt;button 
                v-<span class="hljs-keyword">if</span>=<span class="hljs-string">"closable"</span>
                <span class="hljs-keyword">class</span>=<span class="hljs-string">"close-btn"</span>
                <span class="hljs-meta">@click</span>=<span class="hljs-string">"close"</span>
              &gt;×&lt;/button&gt;
            &lt;/div&gt;
            
            &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"modal-body"</span>&gt;
              &lt;slot name=<span class="hljs-string">"body"</span>&gt;&lt;/slot&gt;
            &lt;/div&gt;
            
            &lt;div v-<span class="hljs-keyword">if</span>=<span class="hljs-string">"showFooter"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"modal-footer"</span>&gt;
              &lt;slot name=<span class="hljs-string">"footer"</span>&gt;
                &lt;button <span class="hljs-meta">@click</span>=<span class="hljs-string">"handleCancel"</span>&gt;取消&lt;/button&gt;
                &lt;button <span class="hljs-meta">@click</span>=<span class="hljs-string">"handleConfirm"</span>&gt;确定&lt;/button&gt;
              &lt;/slot&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/teleport&gt;
  `
}
</code></pre>
<p>这个模态框组件体现了我们讨论的所有原则：</p>
<ul>
<li>单一职责：只负责模态框的展示和行为</li>
<li>合理的props设计：提供了丰富的配置选项</li>
<li>灵活的插槽：允许自定义内容和底部区域</li>
<li>清晰的事件通信：提供了完整的事件体系</li>
<li>易于使用：提供了默认的底部按钮</li>
</ul>
<p>使用示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基础用法</span>
&lt;<span class="hljs-title class_">Modal</span> v-model=<span class="hljs-string">"showModal"</span> title=<span class="hljs-string">"提示"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个模态框<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Modal</span>&gt;

<span class="hljs-comment">// 自定义底部</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Modal</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"showModal"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"自定义底部"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>自定义内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"customAction"</span>&gt;</span>自定义操作<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-10">总结</h2>
<p>编写高复用性的Vue组件，其实就是在寻找一种平衡：既要提供足够的功能，又要保持足够的简单；既要考虑当前的需求，又要预见未来的变化。</p>
<p>记住这7个原则，你的组件设计能力会有质的飞跃：</p>
<ol>
<li>单一职责 - 让组件更专注</li>
<li>合理设计props - 让组件更灵活</li>
<li>巧用插槽 - 让内容更自由</li>
<li>清晰的事件通信 - 让组件更独立</li>
<li>使用组合式函数 - 让逻辑更复用</li>
<li>提供充分配置 - 让组件更强大</li>
<li>完善文档提示 - 让使用更简单</li>
</ol>
<p>下次当你开始编写组件时，不妨问问自己：这个组件在未来可能被用在什么场景？其他人能否不看我代码就知道怎么使用？如果答案是否定的，那就回头看看这7个原则，相信你会找到改进的方向。</p>
<p>你在组件开发中还遇到过哪些棘手的问题？欢迎在评论区分享，我们一起讨论解决！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年的热门 AI 编程工具评测：Cursor、Claude Code、Codex、Lovable、v0 等]]></title>    <link>https://juejin.cn/post/7571272874847010868</link>    <guid>https://juejin.cn/post/7571272874847010868</guid>    <pubDate>2025-11-11T13:36:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571272874847010868" data-draft-id="7568669720430264372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 年的热门 AI 编程工具评测：Cursor、Claude Code、Codex、Lovable、v0 等"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-11T13:36:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="莫尔索"/> <meta itemprop="url" content="https://juejin.cn/user/518625218016504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 年的热门 AI 编程工具评测：Cursor、Claude Code、Codex、Lovable、v0 等
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/518625218016504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    莫尔索
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:36:46.000Z" title="Tue Nov 11 2025 13:36:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>这是一篇关于 AI 编程工具的评测，由 Greg Isenberg 和 Mickey 对 2025 年的热门 AI 编程工具进行了排名和分析，他们讨论了这些工具对技术开发者和非技术构建者的适用性，并强调了选择工具时对团队和生态系统的信任的重要性。</p>
</blockquote>
<p>欢迎订阅合集 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4221297752417992707%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FX1JwNWhO9tjVQfh9Qq9uJw%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4221297752417992707&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX1JwNWhO9tjVQfh9Qq9uJw&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI 播客捕手</a>，专门面向文字内容爱好者分享 AI 领域优质播客！如需文字稿，后台私我获取，请务必备注（城市+行业+岗位+一句话介绍）。</p>
<h2 data-id="heading-0">四个层级</h2>
<p>把常见 AI 编程工具按<strong>好不好用＋信不信得过</strong>排成 S~D 四档，并点出每样东西最该记住的核心能力。下面按档次列出，先写排名，再写功能亮点与注意点，一眼就能对比。</p>
<h3 data-id="heading-1">S 档：闭眼选</h3>
<ol>
<li><strong>Cursor</strong>    - 定位：纯程序员编辑器，需会敲命令行。    - 核心能力：        – 社区教程最多，插件生态大。        – 自带 Agent，可一次完成读文件 → 改代码 → 跑测试。    - 团队公开说“主要为开发者服务”，非技术用户要有耐心。</li>
</ol>
<h3 data-id="heading-2">A 档：强烈考虑</h3>
<ol start="2">
<li><strong>v0（Vercel 出品）</strong></li>
</ol>
<ul>
<li>定位：不会代码也能做网页。    - 核心能力：        – 一键把组件丢进 Vercel 托管，域名、数据库全配好。        – 模板市场大，可复用现成区块。    - 记住：和 Vercel 深度绑定，用别家后端时要多一步导出。</li>
</ul>
<ol start="3">
<li><strong>Codex（OpenAI）</strong>    - 定位：网页版“对话式”生成代码，技术/非技术都能玩。    - 核心能力：        – GPT 系列模型更新最快，迭代肉眼可见。        – 支持把整段代码贴回去继续改，上下文窗口大。    - 记住：目前仍略逊于 Cursor 的 Agent 自动化程度。</li>
</ol>
<h3 data-id="heading-3">B 档：够用，看场景</h3>
<ol start="4">
<li><strong>Lovable</strong></li>
</ol>
<ul>
<li>定位：给“完全不会后端”的人做 SaaS 原型。    - 核心能力：        – 内置 Superb 后端，API 密钥自动帮你填好。        – 拖拽+提示词即可出管理后台、支付页。    - 记住：后端只能用它家指定的，灵活度低于 v0。</li>
</ul>
<ol start="5">
<li><strong>Bolt</strong></li>
</ol>
<ul>
<li>定位：和 Lovable 类似，主打“零配置全栈”。    - 核心能力：        – 一键生成前后台，支持 Supabase、Stripe 等常用集成。    - 记住：模板少，社区比 v0 小，复杂需求容易“卡壳”。</li>
</ul>
<ol start="6">
<li><strong>Replit</strong></li>
</ol>
<ul>
<li>定位：在线 IDE + 云端运行环境。    - 核心能力：        – 15 分钟“Agent 模式”自动把项目跑通。        – 支持多人实时协作，教育圈用户多。    - 记住：国内访问偶尔慢，商业项目要算运行时长费用。</li>
</ul>
<ol start="7">
<li><strong>移动端三件套：Rork / VibeCode App / Anything</strong> 移动端 AI 编程 应用    - 定位：手机原生 App 的“一句话生成”。    - 核心能力：        – 全部基于 Expo，一次输出 iOS 与 Android 双包。        – 内置广告、内购、推送模板，做付费订阅类 App 快。    - 记住：生态刚起步，出错信息比网页工具更难排。</li>
</ol>
<h3 data-id="heading-4">D 档：先观望</h3>
<ol start="8">
<li><strong>Windsurf</strong>    - 技术本身 B~A 水平，但创始人“跑路”后被收购，团队稳定性存疑，文章建议“暂时别押宝”。</li>
</ol>
<h2 data-id="heading-5">AI 编程工具功能总结（2025 版）</h2>








































































































<table><thead><tr><th>工具名称</th><th>排名</th><th>技术门槛</th><th>适用人群</th><th>核心功能与特点</th><th>优势与亮点</th><th>劣势与风险</th></tr></thead><tbody><tr><td><strong>Cursor</strong></td><td>S</td><td>高</td><td>技术开发者</td><td>AI 编程助手，支持代码补全、重构、调试、代理模式（Plan Mode）</td><td>社区庞大、教程丰富、代理能力强、Claude Sonnet 模型支持</td><td>对非技术用户不友好，需要理解代码结构</td></tr><tr><td><strong>v0</strong></td><td>S/A</td><td>低</td><td>非技术用户</td><td>Vercel 推出的前端生成工具，支持组件复用、模板、集成多种后端</td><td>与 Vercel 深度集成、组件市场丰富、适合快速原型开发</td><td>后端集成依赖第三方，灵活性略逊于 Cursor</td></tr><tr><td><strong>Claude Code</strong></td><td>A</td><td>高</td><td>技术开发者</td><td>Anthropic 推出的 AI 编程工具，支持文件读写、代码生成、调试</td><td>基于 Claude Sonnet 4.5，模型能力强</td><td>最近性能下降，代理能力不如 Cursor，更新频率低</td></tr><tr><td><strong>Codex</strong></td><td>A</td><td>中高</td><td>技术/非技术用户</td><td>OpenAI 的编程模型，支持网页端使用，集成于 Cursor 等平台</td><td>模型进步快，社区关注度高，OpenAI 背景强</td><td>起步较晚，功能尚不完善，略逊于 Claude Sonnet</td></tr><tr><td><strong>Lovable</strong></td><td>B</td><td>低</td><td>非技术用户</td><td>一键生成前后端项目，自动集成后端（如 Superbase）</td><td>上手快，适合不懂技术的用户快速构建应用</td><td>后端选择受限，扩展性差，稳定性一般</td></tr><tr><td><strong>Bolt</strong></td><td>B</td><td>低</td><td>非技术用户</td><td>类似 Lovable，支持快速生成 Web 应用，集成前后端</td><td>界面友好，适合快速原型</td><td>集成能力有限，社区支持较弱</td></tr><tr><td><strong>Replit</strong></td><td>B</td><td>中</td><td>技术/非技术用户</td><td>在线 IDE + AI 编程助手，支持代理模式，模型自研或集成外部模型</td><td>可在线运行项目，支持多语言，适合教学和原型开发</td><td>国内用户访问受限，AI 功能不如 Cursor 强大</td></tr><tr><td><strong>Chef (Convex)</strong></td><td>B</td><td>低</td><td>非技术用户</td><td>Convex 推出的展示型工具，用于演示其作为 AI 编程 后端的能力</td><td>后端能力强，实时数据库、订阅机制完善</td><td>非商业化产品，功能有限，主要用于展示 Convex 能力</td></tr><tr><td><strong>Rork / VibeCode App / Anything</strong></td><td>B</td><td>低</td><td>非技术用户</td><td>移动端 AI 编程 工具，支持生成 iOS/Android 应用，基于 Expo 框架</td><td>适合构建移动应用，快速上线 App Store / Google Play</td><td>工具尚新，功能不稳定，生态尚未成熟</td></tr><tr><td><strong>Windsurf</strong></td><td>D</td><td>高</td><td>技术开发者</td><td>技术强大的 AI 编程工具，支持复杂项目构建</td><td>技术能力强，曾受开发者欢迎</td><td>创始人“跑路”，被收购后团队不稳定，信任度极低</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">评估维度</h2>
<h3 data-id="heading-7">1. 技术门槛</h3>
<ul>
<li><strong>高</strong>：需理解代码结构、命令行操作（如 Cursor、Claude Code）</li>
<li><strong>低</strong>：通过自然语言提示即可生成应用（如 v0、Lovable）</li>
</ul>
<h3 data-id="heading-8">2. 用户群体</h3>
<ul>
<li><strong>技术开发者</strong>：偏好可控性、可扩展性、代码质量（如 Cursor）</li>
<li><strong>非技术构建者</strong>：偏好易用性、自动化、快速上线（如 v0、Lovable）</li>
</ul>
<h3 data-id="heading-9">3. 建议使用场景</h3>



































<table><thead><tr><th>用户类型</th><th>推荐工具</th><th>理由</th></tr></thead><tbody><tr><td>技术开发者</td><td><strong>Cursor</strong></td><td>功能最全，社区最强，支持复杂项目开发</td></tr><tr><td>非技术用户</td><td><strong>v0</strong></td><td>最易上手，支持组件复用，Vercel 集成好，适合快速原型</td></tr><tr><td>移动端开发者</td><td><strong>VibeCode App / Rork</strong></td><td>专注移动端，支持 Expo，适合快速发布 App</td></tr><tr><td>教育和初学者</td><td><strong>Replit</strong></td><td>在线运行，支持多语言，适合学习和实验</td></tr><tr><td>后端展示/集成</td><td><strong>Chef</strong></td><td>展示 Convex 后端能力，适合开发者了解实时数据库与订阅机制</td></tr></tbody></table>
<h2 data-id="heading-10">总结建议</h2>
<ul>
<li><strong>技术人员</strong>：首选 Cursor，其次可考虑 Claude Code 或 Codex。</li>
<li><strong>非技术人员</strong>：首选 v0，其次为 Lovable 或 Bolt。</li>
<li><strong>移动端构建者</strong>：可尝试 VibeCode App、Rork，但需接受其早期不稳定性。</li>
<li><strong>所有用户</strong>：选择工具时，不仅看功能，更要看团队与生态，避免“被 Windsurf”的风险。</li>
</ul>
<p>欢迎订阅合集 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4221297752417992707%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FX1JwNWhO9tjVQfh9Qq9uJw%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4221297752417992707&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX1JwNWhO9tjVQfh9Qq9uJw&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI 播客捕手</a>，专门面向文字内容爱好者分享 AI 领域优质播客！如需文字稿，后台私我获取，请务必备注（城市+行业+岗位+一句话介绍）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windsurf Codemaps 深度解析：重新定义 AI 时代的代码理解方式]]></title>    <link>https://juejin.cn/post/7571285984089243700</link>    <guid>https://juejin.cn/post/7571285984089243700</guid>    <pubDate>2025-11-11T13:37:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571285984089243700" data-draft-id="7569789282430009386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windsurf Codemaps 深度解析：重新定义 AI 时代的代码理解方式"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-11T13:37:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="莫尔索"/> <meta itemprop="url" content="https://juejin.cn/user/518625218016504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windsurf Codemaps 深度解析：重新定义 AI 时代的代码理解方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/518625218016504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    莫尔索
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:37:27.000Z" title="Tue Nov 11 2025 13:37:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当前主流的 AI 编程工具正引导开发者进入“Vibe 编码”（凭感觉编程）的误区，它们通过直接包办代码的阅读、思考和编写，增加了开发者与代码之间的隔阂。<strong>这种模式对于低价值的重复性任务尚可接受，但对于定义真正工程能力的、困难且敏感的高价值工作而言，是完全不可接受的。</strong> Cognition 公司(Devin 团队)推出了 <strong>Windsurf Codemaps</strong>，这是一种由 SWE-1.5 和 Claude Sonnet 4.5 驱动的、AI 注释的代码结构图，旨在帮助开发者更好地理解代码，从而提升开发效率。</p>
</blockquote>
<p>欢迎订阅合集 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243205243418624006%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252F0Tdan3R8juUlj-Lh-QMmew%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243205243418624006&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Tdan3R8juUlj-Lh-QMmew&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI 博客精选</a>：精心编译海外技术厂商发布的高质量 AI 领域博客文章，其他合集：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243230891033935893%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FZcMiAmfNkmYLDgAu0rlb1Q%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243230891033935893&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZcMiAmfNkmYLDgAu0rlb1Q&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI 冷思考</a>：个人在 AI 狂欢下的冷思考，聚焦 AI 工程化、Agent Infra 产品、效率型 AI 工具和人机协作话题，寻找可持续的产业价值。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4221297752417992707%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FX1JwNWhO9tjVQfh9Qq9uJw%26nolastread%3D1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4221297752417992707&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX1JwNWhO9tjVQfh9Qq9uJw&amp;nolastread=1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AI 播客捕手</a>：专门面向文字内容爱好者分享 AI 领域优质播客。</li>
</ul>
<h2 data-id="heading-0">目录</h2>
<ul>
<li><strong>为什么需要 Codemaps？代码理解的挑战</strong></li>
<li><strong>Windsurf Codemaps 的解决方案</strong></li>
<li><strong>停止 Vibe coding：开发者应理解 AI 生成的代码</strong></li>
<li><strong>个人思考</strong></li>
</ul>
<h2 data-id="heading-1">为什么需要 Codemaps？代码理解的挑战</h2>
<p>正如 Paul Graham 所言：“你的代码就是你对所探索问题的理解。因此，只有当你的代码真正进入你的脑海时，你才算真正理解了问题。” 软件开发只有在理解的基础上才能升华为工程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc0b8e03ea6d4c1fa4b12e8fe1bf6f30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I6r5bCU57Si:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473046&amp;x-signature=CdMIio17CPsb9YVgunc93uvfKHs%3D" alt="代码理解" loading="lazy"/></p>
<p>现代代码库日益庞杂：动辄成百上千的文件、多个服务系统、层层嵌套的密集抽象。根据 Cognition 团队的自身经验以及与财富 500 强客户的深入交流，即便是顶尖的开发者，也需要花费大量的深度工作时间来寻找和记住那些真正重要的代码。：</p>
<ul>
<li>新开发者需要 <strong>3 到 9 个月</strong> 才能完全上手。</li>
<li>高级开发者每周要花费 <strong>5 个多小时</strong> 来帮助他人上手代码。</li>
<li>Stripe 的研究发现，遗留代码的维护是其客户生产力下降的第一大拖累。</li>
</ul>
<p>“上手”甚至不是一次性成本，每次切换上下文和代码库时，你都需要重新支付这个成本。这正是 AI 编码工具尚未解决的问题。<strong>你越快、越好地理解你的代码库，你就能越快、越好地自己修复它，或者提示 AI Agent 来修复它。</strong></p>
<p>直到今天，Github Copilot、Claude Code、Codex 乃至 Windsurf Cascade 的标准方法，都是让你在一个典型的聊天界面中，向一个能够访问你代码的 Agent 提问，但这些解决方案并不能解决<strong>针对性入门指引和扎实的代码理解</strong>问题，而这两者对于上手、调试和为代码库进行更好的上下文工程至关重要。</p>
<h2 data-id="heading-2">Windsurf Codemaps 的解决方案</h2>
<p>Codemaps 的核心是为任何特定问题提供<strong>即时映射(Just-in-Time mapping)</strong> 。当你在 Windsurf 中打开一个代码库，并通过新图标或快捷键（<strong>Cmd+Shift+C</strong>）首次打开 Codemaps 时，你可以输入一个关于你正试图执行的任务的提示（prompt），或者采纳自动建议。你可以选择 <strong>Fast</strong> (SWE-1.5) 或 <strong>Smart</strong> (Sonnet 4.5) 模型来生成你的 Codemap。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8be469d3bb524673b07166f547b0a262~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I6r5bCU57Si:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473046&amp;x-signature=wdnRHp4b1eZ%2BIh36dk12RhMHJu0%3D" alt="" loading="lazy"/></p>
<p>Codemaps 提供了多种方式来帮助理解：</p>
<p>1.  <strong>列表与跳转</strong>：Codemaps 会将与你问题相关的代码部分进行分组和嵌套展示，Codemaps 中的答案会链接到了代码的确切行，你可以快速跳转浏览这些代码。     <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d03c24f26d842d0a9e2511247300baf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I6r5bCU57Si:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473046&amp;x-signature=4htygmHLwDNqVQJz3Q3O1OQ8nTI%3D" alt="列表与跳转" loading="lazy"/> 2.  <strong>可视化地图</strong>：可视化绘制的 Codemap，这是一个动态生成的图表，当你点击图中的各个节点时，它们会执行相同的功能，将你带到你所点击的代码库的确切部分。     <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0964392a8bed407287636463d902c1b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I6r5bCU57Si:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473046&amp;x-signature=FFiBKED50diD2WOCgHofV0uaI%2Fk%3D" alt="可视化地图" loading="lazy"/> 3.  <strong>追踪指南</strong>：如果你需要更多上下文，可以点击任何部分的查看更多来展开追踪。它会提供更具描述性的解释，说明 AI 是如何将这些被发现的代码行组织在一起的。     <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1d99021648e4e058326155ed7dc0a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I6r5bCU57Si:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473046&amp;x-signature=xy4B6OclTz63ZpFl5thE4LP5Q2I%3D" alt="追踪指南" loading="lazy"/> 4.  <strong>与 Cascade Agent 集成</strong>：可以在 Cascade 聊天中，通过 <code>@{codemap}</code> 语法（可以引用整个地图或特定子部分）来引用一个 Codemap。这能为你的任务提供更具体的上下文，从而“显著提高”Agent 的性能。</p>
<h2 data-id="heading-3">停止 Vibe coding：开发者应理解 AI 生成的代码</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85f78a797ba44e809442834f883f88a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I6r5bCU57Si:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473046&amp;x-signature=qqudn5V0egLa5CfNzX5y2WnN7bs%3D" alt="" loading="lazy"/></p>
<p><strong>Vibe coding（氛围编码）</strong> 已严重偏离其初衷，演变为对 AI 生成的劣质代码的盲目推崇。观察高效与低效的 AI 辅助编码者，可以发现一个关键区别：高效者能够基于对代码的深刻理解，“驾驭”由此产生的直觉（surf the vibes）；而当开发者所生成和维护的代码超出其理解能力时，问题便随之而来。</p>
<p><strong>“理解”即意味着“负责”</strong> 。随着 AI 承担越来越多基础性编码任务，开发者面临的挑战也日益复杂：调试系统、重构遗留代码、制定架构决策——这些工作都要求真正的深度理解。在这一背景下，开发者的角色正从“代码编写者”向“责任承担者”转变。你或许不再亲手编写每一行代码，但仍必须对你交付的成果负责。</p>
<p>这种责任感，取决于你是否真正理解 AI 生成的内容、其修改逻辑以及潜在的安全风险。Codemaps 正是为弥合这一鸿沟而设计：它为人与 AI 构建了一个关于系统的共享上下文——清晰展现系统的结构、数据流动路径和关键依赖关系。其目标远不止提升速度，它的核心使命是帮助开发者维持“心流”状态，掌控代码全局，并在应对最棘手问题时更高效、更自信地推进，避免交付任何未经理解的代码。</p>
<p>人机协作的历史表明，协同效应往往能超越“仅靠人类”或“仅靠 AI”的独立表现。开发者最青睐的 AI 工具，是那些能够增强自身能力、助其在工作中表现更出色的产品，而不是那个试图用一个“粗制滥造的复制品”(sloppy facsimile) 来取代他们的产品。</p>
<h2 data-id="heading-4">个人思考</h2>
<h3 data-id="heading-5">即时映射的代码理解流程</h3>
<p>从 Codemaps 的功能中，可以抽象出一个用于深度理解代码的“即时映射”框架，它强调的不是预先生成所有文档，而是在需要时生成针对特定任务的结构化代码：</p>
<p>1.  <strong>意图驱动</strong>：流程的起点不是文件树，而是开发者的意图或任务。用户通过一个具体的提示来启动 Codemaps，例如“追踪用户登录请求的完整流程”或“找到处理支付失败逻辑的所有位置”。 2.  <strong>整合分析</strong>：系统根据任务需求，调用合适的模型（如用于快速定位的 SWE-1.5 或用于深度理解的 Sonnet 4.5）来扫描和分析整个代码库，挖掘出与意图相关的所有代码片段、依赖关系和数据流。 3.  <strong>结构化呈现</strong>：分析结果被组织成一个结构化地图，而不只是一段扁平的回答。     - <strong>列表视图</strong>：提供了一个可导航、可折叠的层级列表，将相关代码按逻辑（如文件、功能、调用链）分组和嵌套。     - <strong>可视化视图</strong>：为喜欢图形化思考的开发者提供一个节点-连线图，直观展示组件、服务或函数之间的依赖和交互关系。 4.  <strong>上下文丰富的追踪指南</strong>：区别于传统查找工具。每个部分都附带追踪指南，即 AI 提供的自然语言解释。它不仅告诉你“是什么”，还告诉你“为什么”，解释了这些代码片段是如何协同作用来完成上层任务的。 5.  <strong>人机协同的上下文工程</strong>：开发者可以将这个经过人类验证和筛选的代码 (<code>@{codemap}</code>) 作为高质量的、人类可读的上下文，反馈给 AI Agent。这极大提升了后续 AI Agent 执行任务（如编写新代码或修复 Bug）的准确性和相关性，形成一个<strong>理解 -&gt; 增强上下文 -&gt; 更优执行</strong>的闭环。</p>
<h3 data-id="heading-6">理解即责任</h3>
<p>Codemaps 所倡导理解即责任，它重塑了 AI 时代开发者的自我定位：</p>
<p>1.  <strong>拒绝 Vibe coding，拥抱掌控力</strong>：开发者要抵制 Vibe coding 的诱惑。高效的 Vibe 必须建立在对代码库的深刻理解之上。当生成的代码超越了你的理解范围时，你就失去了掌控力，并开始积累技术债务和风险。 2.  <strong>从作者演进为责任人</strong>：在 AI 辅助下，开发者的价值核心不再是亲手编写每一行代码，而是对最终交付的系统负责。你可能没有创作所有代码，但你必须理解所有代码（包括 AI 生成的），并对其正确性、安全性和可维护性负最终责任。 3.  <strong>共享上下文是协同的基石</strong>：高效的人机（或人与人）协作，依赖于一个共享上下文。代码库太复杂，无法装进任何一个人的大脑。Codemaps 这样的工具，其价值在于为人和 AI Agent 提供了一个共同的、可视化的、可讨论的上下文。这个共享上下文是消除误解、精确传达意图、让人类和 AI 协同解决高难度问题的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[苹果上线App Store Web版本，以后浏览外区更方便了]]></title>    <link>https://juejin.cn/post/7571102074039386153</link>    <guid>https://juejin.cn/post/7571102074039386153</guid>    <pubDate>2025-11-11T13:46:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571102074039386153" data-draft-id="7571306072422711338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果上线App Store Web版本，以后浏览外区更方便了"/> <meta itemprop="keywords" content="Apple,iOS"/> <meta itemprop="datePublished" content="2025-11-11T13:46:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CocoaKier"/> <meta itemprop="url" content="https://juejin.cn/user/4388906146735864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果上线App Store Web版本，以后浏览外区更方便了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906146735864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CocoaKier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:46:46.000Z" title="Tue Nov 11 2025 13:46:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近期，苹果低调上线了<strong>网页版 App Store</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fcn" target="_blank" title="https://apps.apple.com/cn" ref="nofollow noopener noreferrer">apps.apple.com/cn</a>）</p>
<p><strong>只要打开浏览器，用户就可以浏览AppStore了，即便非苹果设备也能访问，但目前只能浏览、搜索，不支持在网页端下载 app</strong>。</p>
<p><strong>网页版的一个亮点是支持快速切换区域，我们只需修改网页地址中的区域代码即可快速浏览其他地区的 App Store 内容</strong>。这对于竞品分析，特别是出海产品的竞品分析，带来了非常大的便利，可以更方便快捷地查看某个国家地区的榜单，同类型应用有哪些，某个应用在不同地区的可用性、价格、评分、评论情况。</p>
<p>中国大陆 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fcn%2F" target="_blank" title="https://apps.apple.com/cn/" ref="nofollow noopener noreferrer">apps.apple.com/cn/</a><br/>
中国香港：<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fhk%2F" target="_blank" title="https://apps.apple.com/hk/" ref="nofollow noopener noreferrer">apps.apple.com/hk/</a><br/>
中国台湾：<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Ftw%2F" target="_blank" title="https://apps.apple.com/tw/" ref="nofollow noopener noreferrer">apps.apple.com/tw/</a><br/>
中国澳门：<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fmo%2F" target="_blank" title="https://apps.apple.com/mo/" ref="nofollow noopener noreferrer">apps.apple.com/mo/</a><br/>
新加坡 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fsg%2F" target="_blank" title="https://apps.apple.com/sg/" ref="nofollow noopener noreferrer">apps.apple.com/sg/</a><br/>
日本 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fjp%2F" target="_blank" title="https://apps.apple.com/jp/" ref="nofollow noopener noreferrer">apps.apple.com/jp/</a><br/>
韩国 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fru%2F" target="_blank" title="https://apps.apple.com/ru/" ref="nofollow noopener noreferrer">apps.apple.com/ru/</a><br/>
美国 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fus%2F" target="_blank" title="https://apps.apple.com/us/" ref="nofollow noopener noreferrer">apps.apple.com/us/</a></p>
<p>更多地区代码见<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FISO%25203166-1%2F5269555%3Ffr%3Dge_ala" title="https://link.juejin.cn?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FISO%25203166-1%2F5269555%3Ffr%3Dge_ala" target="_blank">《ISO 31666-1》</a>中的两位字母改小写。</p>
<p>Web版本几乎就是复刻了App端的样式。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2fa8c5878944e879437a2fa3533871b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29jb2FLaWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473606&amp;x-signature=fslwwQZOqJ%2BImPUlmx0Fq96VX44%3D" alt="图片" title="null" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f89e4d3fe834451ac9268d7368c04f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29jb2FLaWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473606&amp;x-signature=xZfr%2Fo2sXyzqQQBcT9p5QTawXHM%3D" alt="图片" title="null" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f514abd4d7794f15a774ddd85d0df2bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29jb2FLaWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473606&amp;x-signature=aMSXnXgWCEsYd3arCn61eB34%2F3s%3D" alt="图片" title="null" loading="lazy"/></p>
<p>Web版还支持切换到特定设备端进行浏览
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6620a847b1c4a09b389d13d29f88d91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29jb2FLaWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763473606&amp;x-signature=TDO14fsElZMLCRT7exxwYmj7%2Bss%3D" alt="图片" loading="lazy"/></p>
<p><strong>Web版有啥使用场景？</strong></p>
<p><strong>1、竞品分析</strong><br/>
这个应该是它最大的价值，上文提到过，Web版可以方便快捷地浏览不同国家地区的商店页面。在此之前，我们可能需要借助第三方平台（比如 点点数据）才能实现，第三方平台的缺点：步骤繁琐（需要登录）、网页加载慢、数据延迟、部分数据VIP解锁。</p>
<p><strong>2、浏览特定设备端（Mac、iPad、Vision、Watch）商店</strong><br/>
以前，想看下某个产品（或者自家产品）有没有上Mac端，你首先得有一台Mac M系列芯片的电脑；<br/>
以前，想看下商店5图在iPad端的呈现效果，首先你得有一台iPad；<br/>
以前，作为独立开发，你可能想了解下iWatch上都有哪些产品，首先你得有一台iWatch；<br/>
Vision，更别说了...</p>
<p>现在，你只需要打开浏览器，切换一下左边的设备专区，不花一分钱，上面的这些都搞定！</p>
<p><strong>3、安卓和Windows也可以浏览AppStore了</strong><br/>
假如你是产品经理或者运营，你做调研需要浏览器AppStore，但你只有安卓手机和Windows电脑，以后不用再找同事借苹果手机了。</p>
<p><strong>4、更快速的分享应用（商店地址）</strong><br/>
运营时不时找我要公司产品的AppStore商店地址，以前我要么去自己存的xx.txt中找，要么打开点点数据搜应用，再点到苹果的商店页面，把浏览器URL复制给运营。现在好了，我可以直接打开App Store Web版，搜应用，然后把浏览器URL发给他们。或者我干脆告诉他们，你们自己去搜吧！</p>
<p><strong>5、更大的屏幕、更方便的操作</strong><br/>
电脑端浏览AppStore，有更大的屏幕、更方便的操作（键盘打字），无论是竞品分析，还是纯自己想找找新应用或游戏，都有更好的浏览和操作体验。这就是手机端腾讯视频和Web端腾讯视频的区别。</p>
<p><strong>6、爬虫门槛更低了</strong><br/>
以前爬苹果的数据，要么使用苹果官方的API（功能有限），要么破解App Store App抓包。现在Web版出来了，爬数据更方便了。</p>
<p><strong>结语</strong></p>
<p>苹果上线App Store Web版，不知道是出于什么目的，几方欢喜几方愁吧。对于开发者和用户更多的是便利，还是给苹果点个赞吧！</p>
<p>苹果上线App Store Web版，还闹出了点幺蛾子，感兴趣的可以看看：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fy6qJA0mM55loshG74Zz4MQ" target="_blank" title="https://mp.weixin.qq.com/s/y6qJA0mM55loshG74Zz4MQ" ref="nofollow noopener noreferrer">《苹果又闹乌龙，App Store源码泄露》</a></p>
<p>相关阅读：<br/>
<a href="https://juejin.cn/post/7436939221392818210" target="_blank" title="https://juejin.cn/post/7436939221392818210">多地区发布，苹果商店下载链接怎么填</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[进入职场第四课—产出]]></title>    <link>https://juejin.cn/post/7571280402965233699</link>    <guid>https://juejin.cn/post/7571280402965233699</guid>    <pubDate>2025-11-11T13:48:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571280402965233699" data-draft-id="7571280402965217315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="进入职场第四课—产出"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-11T13:48:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mapbarfront"/> <meta itemprop="url" content="https://juejin.cn/user/624178336632407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            进入职场第四课—产出
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624178336632407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mapbarfront
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:48:57.000Z" title="Tue Nov 11 2025 13:48:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>新入职一家公司观察、融入、立足之后，要做的第四件事就是产出。</p>
<p>观察和融入帮你顺利度过新手期，立足则让你在团队中站稳脚跟，被大家真正接受，接下来你要做的是保持稳定，持续不断的产出，让团队感受到你究竟有多大能量。</p>
<p>易经乾卦中的终日乾乾，说的就是这个意思，终日指的是持续不断，意味着不能三天打鱼两天晒网，有了开头没有结尾，乾乾代表着产出，要有价值、有思考、有进阶，不能只做重复工作，毕竟在易经中，乾代表天，想完成立足到产出的关键跃升，以下这4个动作一定要做好。</p>
<p>1、产出有价值的成果。</p>
<p>立足期是你独立承担任务的开始，而产出期则需要你更进一步，持续负责有价值的工作。</p>
<p>如果你是应届新人，这个时候，需要逐渐摆脱掉新人的标签，进入团队常规战斗力的行列，这个过程因人而异，有的人很短，有的人很长，当然了，时间越短，横向对比，你在同届新人里也越突出。</p>
<p>如果你是职场老鸟，你的老板招你来，一定有他的预期，一定有他的安排，一定有他等着你完成的事，这个时候，你必须100%的体现出自己的价值，啃下这块硬骨头，完成老板安排的任务，匹配他招你来的预期，对你来说，老板等着你做的事就是有价值，把这件事做好，就是有成果。</p>
<p>2、按节奏做事，按章法出拳。</p>
<p>做事有节奏、有章法，说明你是成熟的职场人，无论是你的老板，还是团队内的其他同事，跟你配合起来都会更简单、更舒服。如果你总是一惊一乍，做事全凭心情，像个无头苍蝇一样到处乱撞，我相信谁也不会愿意和你合作。</p>
<p>分析、实施、复盘工作中，做事情的方法无非就是这3步，每个人不同的只是分析的多深，实施的多好，复盘的多透而已，按节奏做事，按章法出拳，一步一个脚印，稳中有进，比无脑的横冲直撞，那可是要强太多了。</p>
<p>3、沉淀加上分享，打造影响力</p>
<p>持续做好事情的同时，还要持续沉淀，持续分享，沉淀是为了总结经验，复盘整个过程，同时，也是为了提炼可复用的工作方法，提高今后的工作效率。</p>
<p>沉淀了，别人看不到也不行，大声的说出来，让大家都看到你的输出，你可能会想，这不是邀功，这不是汇报吗？还真不是，你的经验分享出来，可以帮助其他同事更好地处理，类似的工作场景，你的方法分享出来，或多或少，都能提高团队整体的工作效率。</p>
<p>光说不练假把式，光练不说傻把式，只沉淀不分享，或者没沉淀硬分享都不行，只有实打实的沉淀，不保留的分享，才能真正打造自己的影响力，也就是连说带练真把式。</p>
<p>四、成为团队中的正磁场。</p>
<p>每个人都有自己的磁场，人和人的磁场也各不相同，相互影响，相互传递能量，立足期想要站得稳，要主动结识团队中有正磁场的人，这也是见龙在田，利见大人的意思，产初期想要走得远，你自己要成为团队中的正磁场，成为那个可以利他的大人。</p>
<p>打工，想干的好，大的方向你必须顺着公司，顺着你的老板来，顺着来，的前提是，你要在心里先认可这个思路，认可了之后，你的言行举止，自然会向这个方向倾斜，遇到问题，你也会自然而然的去想办法解决，而不是下意识的找理由只抱怨，有了正磁场，相信团队里无论谁都感受得到。</p>
<p>除此之外，中日乾乾还有后半句，夕惕若厉，也就是除了持续不断的产出之外，还要时刻保持清醒，保持警惕，看看自己有没有跑偏，努力工作，产出成果是老板想要的，还是自嗨？做事情有节奏有章法，是自以为，还是收到了同事的正反馈？沉淀的是干货，还是敷衍了事？分享的好不好，还能不能再提高？</p>
<p>总之，终日乾乾，只有保持住稳定的产出，才能最终走得远，这也是你在团队中从被人看见，进阶到让人倚重的蜕变过程，夕惕若厉则是说产出期一般都比较长，保持耐心，保持警惕，把握分寸，稳中有进，别着急，这个阶段走的远，才能在下个阶段跳的高。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解读麦肯锡报告：Agent落地的六大经验教训]]></title>    <link>https://juejin.cn/post/7571303808116752436</link>    <guid>https://juejin.cn/post/7571303808116752436</guid>    <pubDate>2025-11-12T00:01:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571303808116752436" data-draft-id="7571272874847191092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解读麦肯锡报告：Agent落地的六大经验教训"/> <meta itemprop="keywords" content="前端,JavaScript,产品经理"/> <meta itemprop="datePublished" content="2025-11-12T00:01:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="华洛"/> <meta itemprop="url" content="https://juejin.cn/user/4230576474430190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解读麦肯锡报告：Agent落地的六大经验教训
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576474430190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    华洛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T00:01:49.000Z" title="Wed Nov 12 2025 00:01:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>麦肯锡报告解读：《One year of agentic AI: Six lessons from the people doing the work》</p>
<p>报告我帮你们看过了，我将报告核心洞察与我的亲身实践相融合，整理了6000字干货。</p>
<p>无论您是正在规划首个Agent（智能体）项目的决策者，还是身处一线的AI产品经理或开发者，希望这些内容为您拨开迷雾，指引方向。</p>
<p>内容与麦肯锡报告中的六大经验教训相结合，无论是你否在开发Agent都值得一看。</p>
<h2 data-id="heading-0">一：与智能体无关、与工作流程有关</h2>
<p>我们希望落地的智能体，通常有这样的一个定义：</p>
<p>智能体是一种基于生成式人工智能基础模型的系统，能够在现实世界中行动并执行多步骤流程。</p>
<p>智能体可以自动化执行复杂任务，而这些任务通常需要运用自然语言处理，且<strong>原本需要人类执行和处理</strong>。</p>
<p>让智能体代替人工，这就是我们追求的结果。</p>
<p>而在追求这个结果的过程中，我们更应该关注的是流程的变革，而不是智能体的落地。</p>
<p>再说一遍，不要着急落地智能体！流程不够完善的情况下，大概率会得到一个智障，而不是一个智能体。</p>
<p><strong>真正实现业务价值的关键是变革工作流</strong>。</p>
<p>错误思路：做个Agent实现企业当前的业务工作流程。</p>
<p>正确思路：围绕Agent把企业业务工作流程重新设计。</p>
<p>我们需重新设计涵盖人、流程、技术的完整工作流，先梳理流程、识别用户痛点，并设计智能体与人类的反馈协同机制。</p>
<ul>
<li>例如保险行业可通过规则系统、分析型 AI、生成式 AI 与智能体的组合，重构理赔等复杂工作流。</li>
</ul>
<p>在重新设计工作流程时，一个重要起点是<strong>绘制流程图</strong>并<strong>识别用户的痛点</strong>。</p>
<p>这一步在设计智能体系统时至关重要，这类系统能够减少不必要的工作，让智能体和人类得以协作，更高效、更有效地实现业务目标。</p>
<p>这种协作可以通过学习循环和反馈机制来实现，从而构建一个完善的Agent。</p>
<p>在Agent的众多落地应用技术中，能让团队在恰当的节点使用合适的技术，这在对复杂、多步骤的工作流程进行重新设计时尤为重要。</p>
<ul>
<li>如何设计提示词工程，大量提示词的组合、联动、迭代</li>
<li>要如何设计工具列表，function call 和 提示词如何结合</li>
<li>RAG系统如何在Agent中落地，应用在哪些节点，是否需要和function call结合使用</li>
<li>workflow应该如何设计，</li>
<li>微调是否有必要加入，要如何抉择</li>
</ul>
<p>等等内容，在恰当的节点使用合适的技术，我们的Agent才能达到我们的预期效果。</p>
<p>画三个重点，来说明一下Agent流程设计对于AI产品经理的重要性：</p>
<ol>
<li>
<p>对于AI产品经理来说，“这个需求我就要，怎么实现我不管”的年代彻底过去了。AI产品你必须要告知开发明确的流程实现，否则你什么都得不到。</p>
</li>
<li>
<p>AI产品经理要对AI产品的结果负责，在整个流程中的任意一个节点出现问题，都会导致输出结果差异巨大。所以清晰的指导智能体中每一个步骤的执行逻辑，更有助于对结果进行优化。</p>
</li>
<li>
<p>由于延续了大模型的特性，AI产品也具有一定的不可解释性，对于错误的结果，我们修正Agent流程，通常都是我们最后的手段。</p>
</li>
</ol>
<h2 data-id="heading-1">二：智能体并非总能解决问题（智能体的选择与协作）</h2>
<p>认真思考：<code>高方差（结果不稳定、不统一）、低标准化的任务</code>和<code>低方差、高标准化的任务</code>，哪一类任务更适合用Agent来代替人工。</p>
<p>我在做1V1培训的时候，AI产品的需求挖掘环节，一定要再三强调的一句话：<strong>当需求能用AI且只能用AI完成时，才是一个AI的需求</strong></p>
<p>这里有两个重点：能用AI 和 只能用AI</p>
<p>例如：</p>
<p><code>把固定格式的文案转换成JSON格式的信息</code>。这就是一个能用AI但不是只能用AI的需求，这就不是一个AI需求</p>
<p><code>把用户随机输入的query进行分类，然后按照不同类型转换成JSON格式的信息</code>。这就是一个真正的AI需求</p>
<p>当一个任务足够标准化的时候，我们应该更倾向于用固定的程序来执行，既保证准确性，又可以保证执行速度。</p>
<p>所以我们需根据任务特性选择工具，避免盲目使用智能体。</p>
<p><strong>低方差、高标准化的任务适合规则式自动化，高方差、低标准化的任务更适配智能体。</strong></p>
<p>此外，真正的生产环境中，任务通常不是非黑即白的，并不是要么有智能体，要么没有智能体的。</p>
<p>智能体的两层作用：帮助我们完成特定任务、帮助我们更好的开展工作。</p>
<p><strong>千万不要忽略协作的重要性</strong></p>
<ol>
<li>有些任务如果单纯的用程序实现，可能会耗费很多人力和时间成本。</li>
<li>有些任务无法完全使用程序实现，需要结合一小部分的大模型能力。</li>
</ol>
<p>在决策时需明确任务的标准化程度，考虑更简单的自动化方案（如 LLM 提示词），而非陷入 “非智能体即无智能体” 的二元思维。</p>
<h2 data-id="heading-2">三：杜绝 “AI 糟粕”，重视评估与信任</h2>
<p>很多智能体在演示中表现亮眼，但实际使用中输出质量低（即 “AI 糟粕”），导致用户信任流失。</p>
<p>是的，相信大家一定见过非常多了了，推广软文看了觉得这可太NB了，等体验完就发现不过又是一个垃圾桶里的东西罢了。</p>
<p>麦肯锡报告表示：AI产品需要有持续的测试、监督才能确保效果，保证不断进步，需像培养员工一样培育智能体，明确其 “岗位职责”，通过细化的评估标准（如任务成功率、检索准确率、幻觉率）持续优化，专家需全程参与测试，避免 “一上线就不管”。</p>
<p><strong>以下是在决定为不同任务使用哪种人工智能工具时的指南：</strong></p>
<ul>
<li>如果任务是基于规则且重复性的，并且有结构化输入（例如数据录入），请使用基于规则的自动化。</li>
<li>如果输入是非结构化的（例如，冗长的文档），但任务仍然是抽取式或生成式的，请使用生成式人工智能、自然语言处理或预测分析。</li>
<li>如果任务涉及根据过往数据进行分类或预测，请使用预测分析或生成式人工智能。</li>
<li>如果输出需要综合、判断或创造性解读，请使用生成式人工智能。</li>
<li>如果任务涉及多步骤决策，并且存在大量输入和上下文高度可变的情况，请使用AI智能体。</li>
</ul>
<p><strong>以下是一些用于评估智能体性能的典型评估方法：</strong></p>
<ol>
<li>任务成功率（端到端）。任务成功率衡量的是无需升级处理或人工干预即可正确完成的工作流所占的百分比，这反映了实际应用价值。</li>
</ol>
<ul>
<li>F1分数/精确率和召回率。该指标平衡了假阳性和假阴性，使其在分类、提取以及具有明确可衡量结果（即是或否）的决策准确性任务中非常有用。</li>
<li>检索准确性。检索准确性是指检索到的正确文档、事实或证据相对于基准数据集的百分比，这对于检索增强型工作流程至关重要。</li>
<li>语义相似度。语义相似度是通过生成输出与参考输出之间基于嵌入的余弦相似度来衡量的，它捕捉的是超越精确词语匹配的意义对齐。</li>
</ul>
<ol start="2">
<li>将大语言模型（LLM）用作评判者，就是根据黄金标准或人类偏好来评估输出结果。这一指标在用于评估清晰度、有用性和推理合理性等主观性判断时，具有很好的可扩展性。</li>
</ol>
<ul>
<li>偏差检测（通过混淆矩阵）。偏差检测利用混淆矩阵来衡量不同用户群体在结果上的系统性差异，这些矩阵能凸显偏差的表现之处（例如，假阴性对某一群体的影响过大）。</li>
<li>幻觉率。该指标用于跟踪事实错误或无依据声明的出现频率，以确保智能体输出内容的可信度。</li>
<li>校准误差（置信度与准确度）。校准误差用于衡量智能体的置信度分数是否与实际正确性相符，这在对风险敏感的工作流程中十分重要。</li>
</ul>
<h2 data-id="heading-3">四：让追踪和验证每一步都变得简单</h2>
<p>当企业仅部署少数智能体时，人工排查错误尚可应对；但随着智能体数量增至数百、数千个，仅追踪最终结果的传统方式，会让错误定位变得如同 “大海捞针”。</p>
<p>因此我们需在工作流中嵌入监控与评估机制，实时验证每一步表现。</p>
<p>这里我们额外说说，如何实现一个AI产品的评估反馈系统。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc8dbb6b78ec448389f5996a2665c9f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5rSb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763510509&amp;x-signature=rjD8ZrOAm%2BWv9eSge5pi5Reg53g%3D" alt="pinggu.jpg" width="100%" loading="lazy"/>
<p>评估反馈系统是AI产品的三个辅助系统之一，主要目标是长期持续的监控我们的AI产品。</p>
<p>为什么会有这样的一个辅助系统？</p>
<p>主要原因是：AI产品出现问题后具有非常强的隐蔽性。</p>
<p>例如：现在线上跑着我们调试好的客服机器人，但是假设当前时间我们的机器人出问题了，它在跟我们的用户闲聊、扯淡，但是就是不回答它应该回答的问题。</p>
<ul>
<li>我们的客服是否还在正常回复问题</li>
<li>我们的客服是否越权了</li>
<li>我们的客服是否泄露隐私信息了</li>
<li>等等....</li>
</ul>
<p>如果没有反馈，我们就无法知道是否发生了这样的事情。</p>
<p>就像传统的产品，404了、502了、程序崩溃了，这些都有监控系统随时通知，我们AI对话也需要有监控系统。</p>




























































<table><thead><tr><th>维度</th><th>细分指标/场景</th><th>具体说明/工具/指标</th></tr></thead><tbody><tr><td>准确性</td><td>明确的答案</td><td>测试数据集的query与answer直接比对</td></tr><tr><td/><td>非明确答案</td><td>测试数据集的query、参考文案、打分体系；使用BLEU（词汇匹配度）、ROUGE（摘要质量）评估</td></tr><tr><td>响应时间</td><td>首包响应时间</td><td>大模型最终回复的模型，影响用户体验</td></tr><tr><td/><td>平均响应时长</td><td>宏观把控响应效率</td></tr><tr><td/><td>报警逻辑</td><td>一段时间内，出现的百分比累计出现次数（如5分钟内，出现了50%/80次）</td></tr><tr><td>执行节点信息</td><td>错误原因分析</td><td>保留每个节点的执行信息，分为大模型原因（错误码、提示词）、程序原因（json格式兼容）、环境原因（502）</td></tr><tr><td>消耗</td><td>调用次数</td><td>成功次数、失败次数</td></tr><tr><td/><td>RPM</td><td>每分钟请求数，体现单位时间请求负载</td></tr><tr><td/><td>TPM</td><td>每分钟Token数，衡量文本处理吞吐量</td></tr><tr><td/><td>tokens</td><td>文本处理的基础单元消耗数量，关联成本与性能</td></tr></tbody></table>
<h2 data-id="heading-4">五：优先打造可复用智能体</h2>
<p>为单个任务单独开发智能体会造成冗余浪费，应聚焦可复用性。</p>
<p>识别重复出现的任务，构建集中化的资源平台（含验证服务、可复用代码、训练材料等），让智能体组件能跨工作流使用，可减少 30%-50% 的非必要工作。</p>
<p>识别重复性任务是一个很好的起点。企业可以开发能在不同工作流中轻松复用的智能体及智能体组件，并让开发者能便捷地使用它们。</p>
<p>这包括开发一套集中化的经过验证的服务（如大模型可观测性或预先批准的提示词）和资产（例如，应用模式、可复用代码和培训材料），这些服务和资产要易于查找和使用。</p>
<p>将这些功能整合到一个单一平台中至关重要。根据我们的经验，这有助于减少通常所需的30%到50%的非必要工作。</p>
<p><strong>哦豁，中台再次浮出水面，世界果然是个圈</strong></p>
<p>还是建议大家利用中台来统一管理大模型、提示词、知识库、function call、智能体、测试、评估、日志、权限等。</p>
<p>无论是单部门要开发多智能体、还是多部门要各自开发智能体或者使用大模型。都由中台统一提供大模型的基础能力。</p>
<p>提示词的版本迭代，测试，等操作也完全又提示词工程师在中台完成即可，一套做完，全公司可用。</p>
<h2 data-id="heading-5">六：人类仍不可或缺，角色与规模将改变</h2>
<p><strong>人类尚有存在的必要。工作流的设计，一定要考虑人类加入工作的便捷性</strong></p>
<p>随着人工智能智能体的不断增多，人类将扮演何种角色这一问题引发了诸多焦虑，</p>
<p>一方面是对工作安全性的担忧，另一方面则是对生产力提升的过高期望。</p>
<p>这导致人们对当今许多工作中人类的角色产生了截然不同的看法。</p>
<p>智能体无法完全替代人类，人类需负责监督模型准确性、处理边缘案例、确保合规等。</p>
<p>工作流变革后，特定流程的人力规模可能下降，但<strong>需重新设计人机协作模式</strong>，</p>
<p>比如通过简洁的可视化界面提升交互效率，明确人类在关键决策中的最终把控权（如律师审核智能体整理的案件核心信息）。</p>
<p>人机协作设计的一个重要部分是开发简单的可视化用户界面，让人们能够轻松与智能体交互。</p>
<p>回到最开始，我们说过要围绕Agent把企业业务工作流程重新设计。现在要再加上一句话工作流程重新设计时，要充分考虑人机协作的必要性和便利性。</p>
<h2 data-id="heading-6">结语</h2>
<p>Agent的成功，绝非仅仅是技术模型的胜利，而是一场关于工作流程、人机协作与组织变革的系统性工程。</p>
<p>Agent的规模化落地将不再是少数科技巨头的游戏，而是每一个致力于智能化转型企业的必修课。 前方的道路已然清晰：</p>
<p>对于决策者，首要任务是为这场变革扫清障碍，投资于可复用的平台建设，并推动跨部门的流程重塑。</p>
<p>对于AI产品经理与开发者，需要兼具技术理解与业务洞察，成为连接智能世界与真实需求的桥梁，用严谨的流程设计和细致的评估体系，将Agent的潜力转化为实实在在的业务价值。</p>
<p>这场由Agent引领的变革，其终点并非一个“无人化”的工厂，而是一个人机协同、高效共进的新工作范式。</p>
<p>现在，正是我们放下对技术的盲目崇拜，回归业务本质，用智慧和匠心去设计和构建这一新范式的最佳时机。</p>
<p>我是华洛，关注我，学习更多AI落地的实战经验与技巧。</p>
<p>加油，共勉。</p>
<blockquote>
<p>☺️你好，我是<strong>华洛</strong>，All in AI多年，专注于AI在产品侧的落地与应用和全自动化AI员工的研发。</p>
<p>你可以在这里联系我👉<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fhualuo-fztnr%2Frnkfkn%2Fhgg1ai826tm55vxs%3FsingleDoc%23" title="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fhualuo-fztnr%2Frnkfkn%2Fhgg1ai826tm55vxs%3FsingleDoc%23" target="_blank">www.yuque.com/hualuo-fztn…</a></p>
</blockquote>
<h2 data-id="heading-7">专栏文章</h2>
<p><a href="https://juejin.cn/post/7512332419203727371" target="_blank" title="https://juejin.cn/post/7512332419203727371"># 聊聊我们公司的AI应用工程师每天都干啥？</a></p>
<p><a href="https://juejin.cn/post/7547051639740743721" target="_blank" title="https://juejin.cn/post/7547051639740743721"># SEO还没死，GEO之战已经开始</a></p>
<p><a href="https://juejin.cn/post/7497890801348821055" title="https://juejin.cn/post/7497890801348821055" target="_blank"># 从0到1打造企业级AI售前机器人——实战指南二：RAG工程落地之数据处理篇🧐</a></p>
<p><a href="https://juejin.cn/post/7496397558358900790" title="https://juejin.cn/post/7496397558358900790" target="_blank"># 从0到1打造企业级AI售前机器人——实战指南一：根据产品需求和定位进行agent流程设计🧐</a></p>
<p><a href="https://juejin.cn/post/7492271537010671635" title="https://juejin.cn/post/7492271537010671635" target="_blank"># 聊一下MCP，希望能让各位清醒一点吧🧐</a></p>
<p><a href="https://juejin.cn/post/7485727472999579659" title="https://juejin.cn/post/7485727472999579659" target="_blank"># 实战派！百万PV的AI产品如何搭建RAG系统？</a></p>
<p><a href="https://juejin.cn/post/7482695183477047315" title="https://juejin.cn/post/7482695183477047315" target="_blank"># 团队落地AI产品的全流程</a></p>
<p><a href="https://juejin.cn/post/7474925725662969883" title="https://juejin.cn/post/7474925725662969883" target="_blank"># 5000字长文，AI时代下程序员的巨大优势！</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[豆包编程模型来了，我们用四个关卡考了考它！]]></title>    <link>https://juejin.cn/post/7571126773809496074</link>    <guid>https://juejin.cn/post/7571126773809496074</guid>    <pubDate>2025-11-11T11:31:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571126773809496074" data-draft-id="7571191453126557722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="豆包编程模型来了，我们用四个关卡考了考它！"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-11T11:31:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            豆包编程模型来了，我们用四个关卡考了考它！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T11:31:10.000Z" title="Tue Nov 11 2025 11:31:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 编程助手，人人都爱。从补全一行代码到生成整个函数，它们极大地改变了我们的开发工作流，就连曾经对它们嗤之以鼻的 Linus Torvalds 也改变了想法。他在近日一次访谈中表示：「我认为它们是能帮助我们更好地完成工作的工具。」</p>
<p>但它们也常会在关键时刻翻车：当你甩给它一个跨越了多个文件、藏得极深的 Bug 时，它失忆了；当你让它重构一个复杂的旧模块时，它开始胡言乱语；当项目变大、依赖变多时，大多数 Copilot 就从助手退化成了麻烦制造机。很明显，对于这些更为复杂的需求，我们需要的不再是代码补全工具，而是一个能理解复杂上下文、自主规划任务、甚至能帮我们调试的 Agentic Coder。</p>
<p>2025 年，AI 编程助手正分化为两条主要路线。第一条可称为 IDE 增强路线，以 GitHub Copilot 为代表。它们深度集成在开发者的编辑器中，更像一个「副驾驶」，在你编程时提供代码补全、上下文感知建议和聊天辅助，目标是提升开发者的编辑效率。</p>
<p>第二条是 Agentic 路线，即任务委托路线，以 Claude Code 为代表。这条路线的工具更像一个「结对工程师」，通常在终端中运行。开发者不再是逐行获取建议，而是将整个复杂的、多步骤的任务（如项目重构、跨语言移植、Bug 修复）委托给它，由它自主规划和执行。这正是「Agentic Coder」的核心理念。</p>
<p>然而，就在 2025 年 10 月底，大量开发者在社区抱怨 Claude Pro 计划的每周用量限制过于严苛，甚至有很多用户反馈称，在进行了几小时的严肃编码工作后就撞到了「周上限」，导致工具无法用于严肃工作。更别说 Anthropic 对中国用户的限制。这在开发者中制造了一个明显的痛点：谁能提供一个既具备强大 Agentic 能力（特指第二条路线），又真正好用、管够的编程模型？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/695a5aae02cd48b9862b72dd66c9f2d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=A53RP9g7z8ovadCu8JhAcDbg1pQ%3D" alt="图片" loading="lazy"/></p>
<p>今天，火山引擎带着豆包编程模型 Doubao-Seed-Code 入场了；顾名思义，这正是一个专为编程任务设计的模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92d06be3f37242de937e76c2038f9d56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=9DuakNFLLMQRvEWRwIHpFi797y0%3D" alt="图片" loading="lazy"/></p>
<p>为了检验 Doubao-Seed-Code 的能力，我们将用几个真实工作流中的「硬骨头」来考验它，但在此之前，我们先了解下它的基准表现与核心能力。</p>
<p>一、Doubao-Seed-Code：实力登顶权威榜单</p>
<p>豆包编程模型 Doubao-Seed-Code 在 Terminal Bench、SWE-Bench-Verified-Openhands、Multi-SWE-Bench-Flash-Openhands 等多项权威评测中均表现优异，仅次于甚至超过了 Claude 4.5 Sonnet。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e88c6b1ac3420980084d61ba98f581~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=JTtjdvJeJDHTUAA6pVTgL9KMrHw%3D" alt="图片" loading="lazy"/></p>
<p>而更亮眼的是：它登顶了 SWE-Bench Verified 榜单。值得注意的是，这一成绩是其与 Trae 相结合实现的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/174c4490b2b84e67ab902ba8dad077dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=ydUXHpXcUEn5RjbE%2B%2F8NE4MNbvg%3D" alt="图片" loading="lazy"/>SWE-Bench Verified 榜单当前前十名</p>
<p>这恰好印证了 Doubao-Seed-Code「为 Agentic Coding 优化」的定位：它不仅是一个基础模型，更是为任务委托型工作流设计的大脑。须知，SWE-Bench 不是一个简单的算法题库，它是一个评估模型在真实 GitHub 项目中修复 Bug 和处理 issue 能力的基准，含金量很高 。能在 Trae 这样的 Agentic 框架中与之携手登顶，证明了它在执行复杂、多步骤的真实工程任务时的潜力。</p>
<p>1、核心能力：原生 256K 长上下文</p>
<p>Doubao-Seed-Code 的强大榜单表现离不开这个基础：原生 256K 长上下文。</p>
<p>这个数字意味着模型有能力一次性读完并理解极其复杂的项目。在真实的编程场景中，一个 Bug 可能横跨多个文件、一个功能可能依赖数十个模块。Doubao-Seed-Code 的 256K 上下文使其能轻松处理长代码文件、多模块依赖等复杂场景。</p>
<p>不仅如此，Doubao-Seed-Code 还是国内首个支持视觉理解能力的编程模型，能参照 UI 设计稿、截图或手绘草图生成代码，或对生成页面进行视觉比对，自主完成样式修复和 Bug 修复，大幅提升前端开发效率。</p>
<p>2、变强之路：Coding RL Agent at Scale</p>
<p>如果说 256K 上下文是让 Doubao-Seed-Code 看得远，那么它做得好的秘密武器就是：Coding RL Agent at Scale（编程智能体大规模强化学习训练）。</p>
<p>火山引擎构建了一个大规模的强化学习系统来训练这个编程模型，</p>
<p>这套系统内构建了覆盖十万容器镜像的庞大训练数据集，具备万级并发沙盒会话的能力，可以对上千卡的单个 RL 任务实现高效训练。基于这套系统，模型无需蒸馏或标注的冷启动数据，完全依靠端到端强化学习训练即可练就顶尖的 Agent 能力，优化路径更简洁高效。</p>
<p>这种训练方式的效果体现在了基准测试上，官方信息显示，在 SWE-bench 基准上，仅 RL 训练就让模型达到了当前最优（SOTA）水平，充分验证了纯强化学习在真实软件工程场景下的强大潜力。</p>
<p>如下图的数据所示，在 multi-swe-bench 和 swe-bench-verified 两个基准上，Doubao-Seed-Code 的性能在训练过程中呈现一致的上升趋势，这表明模型具有良好的泛化能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/678815131d624c438a442d2d98ab2a92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=CaROdXYvWK4yj6OQNJScOvAV%2BaM%3D" alt="图片" loading="lazy"/></p>
<p>理论和数据固然亮眼，但它在真实工作流中的表现究竟如何？我们马上进入实战环节来一探究竟。</p>
<p>二、Agentic Coding 大考：四大关卡，实战见真章</p>
<p>我们这次对 Doubao-Seed-Code 的考验主要围绕其三个核心能力 ：</p>
<ul>
<li>
<p>Agentic Coding（任务规划能力）：能否把一个模糊的、多步骤的任务拆解并执行？</p>
</li>
<li>
<p>长上下文（256K）： 能否处理跨越多个文件、依赖关系复杂的屎山代码？</p>
</li>
<li>
<p>调试能力（软件工程）： 能否像一个真实工程师一样，根据报错信息定位并修复 Bug？</p>
</li>
</ul>
<p>1、序章：30 秒「无痛换芯」</p>
<p>当然，在开始评测之前，先搞定接入。</p>
<p>一句话总结：体验非常丝滑。</p>
<p>对于广大使用 Claude Code 的开发者，迁移到 Doubao-Seed-Code 的成本几乎为零，因为它一开始就原生兼容 Anthropic API，用户仅需修改配置文件中几行代码即可将模型切换到 Doubao-Seed-Code。而如果使用火山引擎官方的 CLI，veCLI，则可以直接使用 Doubao-Seed-Code 模型，无需额外配置。本文主要使用 Claude Code 进行测试。</p>
<p>不仅如此，开发者还能将 Doubao-Seed-Code 无缝集成到 Cursor、Cline、Codex CLI、Trae 等主流智能编程环境中，实现即连即用的高效体验。</p>
<p>总之，我们花了不到 30 秒就完成了这一切。下面，大考开始。</p>
<p>2、关卡一：Python 脚本重构</p>
<p>首先，我们尝试一个简单任务：让 Doubao-Seed-Code 将一个由 Gemini 生成的垃圾 Python 脚本重构成结构优良的脚本。</p>
<p>这是一个用于数据处理和报告的模拟脚本 ，但集各种陋习于一身：所有逻辑都塞在一个 main 函数里、使用了全局变量、混乱的 try/except 嵌套和 if/else 逻辑、到处都是 print () 语句、混合了数据获取和数据解析以及文件写入、注释混乱。</p>
<p>结果，耗时不到 3 分钟，Doubao-Seed-Code 不仅完成了对这个脚本的优雅重构，还主动编写了测试脚本，对重构后的代码进行了测试 。</p>
<p>Doubao-Seed-Code 的调试能力（软件工程）能力得到了初步验证，顺利过关。</p>
<p>3、关卡二：C++ 到 Python 跨语言重构</p>
<p>开胃菜结束，我们直接上硬菜，考验它的长上下文和任务规划能力。</p>
<p>任务： 将 GitHub 上一个开源的 C++/OpenGL 版《打砖块》游戏，完整重构为一个 Python 实现 。</p>
<ul>
<li>原项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsdavydouski%2Fbreakout%25C2%25A0" target="_blank" title="https://github.com/sdavydouski/breakout%C2%A0" ref="nofollow noopener noreferrer">github.com/sdavydouski…</a></li>
</ul>
<p>必须说明，这个任务并不简单。因为这已经不是简单的代码翻译，这几乎等于跨语言的项目重建。这个任务的难度体现在：</p>
<ul>
<li>
<p>范式鸿沟：模型需要处理 C++（静态编译型）和 Python（动态解释型）之间巨大的语法和设计范式差异。</p>
</li>
<li>
<p>API 转译：它必须理解 C++ 中底层的 OpenGL 图形 API，并将其智能地转译为 Python 生态中（如 Pygame ）的高级 API 和事件驱动的游戏循环。</p>
</li>
<li>
<p>项目级理解：最关键的是，这是一个完整的项目。模型必须利用其长上下文能力，一次性读懂代码库中所有 C++ 文件（.h 和 .cpp）的复杂依赖关系。</p>
</li>
<li>
<p>自主规划：它不能逐行翻译，而必须自主规划出一个全新的 Python 项目结构，并正确处理所有游戏素材。</p>
</li>
</ul>
<p>可以说这是对模型 256K 长上下文 和 Agentic 任务规划能力的一次压力测试。</p>
<p>我们将项目 clone 下来，启动配置好 Doubao-Seed-Code 的 Claude Code，然后输入一条指令：「将这个 C++ 项目重构为 Python 项目，使用其原本的素材。」接下来就是见证奇迹的时刻，以下视频展示了其最初的执行阶段：</p>
<p>可以看到，Doubao-Seed-Code 首先分析了整个代码库，准确理解了其功能和 C++/OpenGL 技术栈。然后，它制定了详细的重构计划，包括创建 Python 项目结构、安装 Pygame 库、建立游戏主类和游戏循环、重构游戏对象、实现关卡系统等等，并开始一步步执行 。</p>
<p>从实现到测试完成，整个项目耗时近 40 分钟，而我们所做的，仅仅是提供了最初的指令和中间的几次文件操作许可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52ebe1f1122b4665b04d236dcb8018c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=xiwSp%2F81Jqq4%2BVq2u3r7jFTYXwk%3D" alt="图片" loading="lazy"/></p>
<p>项目结束时，Doubao-Seed-Code 给出的总结</p>
<p>一切完成后，Doubao-Seed-Code 还为我们撰写了详细的文档，并交付了一个完全可玩的 Python 版《打砖块》游戏。</p>
<p>Doubao-Seed-Code 重构的游戏完整可玩，且音乐也非常适配</p>
<p>这已经不是简单的「代码补全」，而是真正的「Agentic Coding」。它完美地践行了我们在引言中提到的 Agentic 路线：我们不再是逐行获取建议，而是将一个横跨范式鸿沟和 API 转译的复杂项目，完整地委托给它，由它自主规划并最终执行。这正是 Agentic Coding 的核心理念。</p>
<p>4、关卡三：从零开始的软件创造</p>
<p>在跨语言重构之后，我们想看看 Doubao-Seed-Code 从零开始构建一个全新项目的能力。</p>
<p>这一次，我们想让它为我们编写一个桌面宠物小程序。不过，在开始之前，我们遇到了一个很现实的问题：我们没有素材。</p>
<p>使用即梦，我们先生成了一张卡通树懒睡觉图，然后使用这张图继续让即梦生成了一段树懒站起来的视频。接下来，我们需要将其中的可爱树懒提取出来，并将背景透明化。在使用 ffmpeg 提取出所有帧之后，我们意识到接下来的工作完全可以让 Doubao-Seed-Code 来完成！</p>
<p>简单描述下我们的需求，剩下的就交给 Doubao-Seed-Code 了：</p>
<blockquote>
<p>这里有 300 帧图片，我需要你将其制作成 5 秒的 gif 动图。但首先，你需要提取出图中的人物，去掉背景和左上角及右下角的背景水印。给我一张透明背景的动图。</p>
</blockquote>
<p>Doubao-Seed-Code 立刻理解了任务，它安装了 rembg、imageio 等相关库，并帮我们完美地处理了所有原始帧，最终交付了两张我们需要的核心素材：sleep.gif 和 stand.gif。</p>
<p>接下来我们将素材放入项目文件夹，再次唤起 Doubao-Seed-Code，输入以下指令：</p>
<blockquote>
<p>使用 Python 编写一个桌面宠物小程序，这个宠物是一只卡通树懒，它一般在屏幕上睡觉（sleep.gif）。但如果用户点击它，它就会站起来 (stand.gif)。之后，它又会变回睡觉姿势。用户可以在屏幕上拖动它到任何位置。宠物画面宽度固定为 300px。透明背景。使用 assets 文件夹中的素材。</p>
</blockquote>
<p>同样，它一次性构建完成。</p>
<p>运行看看效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78913e5f261640218cac9834a3aecaeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=NXcCzJjz7hxLas%2F9Mp9uNYoUNdc%3D" alt="图片" loading="lazy"/></p>
<p>这就是我们预期想要实现的目标！它不仅完全实现了我们指令中的所有功能（睡觉、点击站立、可拖动、透明背景），而且整个工作流（从 AI 生成素材、到 AI 处理素材、再到 AI 构建软件）都展现了极高的流畅度。</p>
<p>当然，我们还可以进一步与 Doubao-Seed-Code 交互，让其对这个桌面宠物进行改进，比如提供更多素材让其具备更加风格的动作库、设置双击它打开某个链接或 AI 助手、让它根据天气和时间自动执行执行不同的动作等等。</p>
<p>一个桌面宠物还不够。为了更好地领略它的创造能力，我们还让 Doubao-Seed-Code 从零开始构建了其它几个风格迥异的有趣项目。我们发现，它基本都是一次成形，偶尔需要的反馈也只是明确需求或提供额外信息。当遇到 Bug 时，我们也只需将报错信息直接反馈回去，它也能直接解决。</p>
<p>比如一个会动态演进的弹珠撞墙模拟程序：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49ee9965867442eaa69525946265b36b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=Pwmx1ZbhqMZlqx8It9CpOsPKE44%3D" alt="图片" loading="lazy"/></p>
<p>提示词：用 Pyhon 写一个模拟程序：一个小球在一个六边形中弹跳。这个六边形的六条边各有特性，小球撞上不同的边会触发不同的效果。撞上边 1 会导致小球颜色随机变化，边 2 导致小球变大 10%，边 3 导致小球变小 10%，边 4 导致小球加速 20%，边 5 导致小球减速 20%。边 6 会在六边形中央克隆出一个一样的小球。如有文字，使用微软雅黑字体。</p>
<p>一个游玩难度颇大的邯郸学步小游戏：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/959c98c30bbe4605a099d4939b2cd418~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465470&amp;x-signature=xPg%2B9hUKSZKE4Mx815NFPvtTIhk%3D" alt="图片" loading="lazy"/></p>
<p>构建一个邯郸学步小游戏。游戏一开始会随机展示一个火柴人走路或扭动的样子（四肢和头部随机摆动），玩家需要操控另一个火柴人模仿它并且只有 2 秒反应时间。模仿正确则得 1 分，错误扣 1 分。10 分玩家胜利，负 10 分则玩家失败。玩家使用方向键分别控制四肢，用空格键控制火柴人头部摆动。如有文字，使用微软雅黑字体。</p>
<p>我们甚至还让 Doubao-Seed-Code 基于我们之前关于<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650997783%26idx%3D1%26sn%3D0f796e9cbaf70b81378e4cb06ba7ea90%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650997783&amp;idx=1&amp;sn=0f796e9cbaf70b81378e4cb06ba7ea90&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"> Yoshua Bengio 引用量突破百万的报道</a>构建了一个像素风格的展示网页 —— 我们所做的仅仅是提供一份 docx 文档。</p>
<p>提示词：这里的 docx 文件是我们之前关于 Yoshua Bengio 引用量破百万的专题报道，请基于这些素材，构建一个介绍网页，生动地展示 Bengio 取得的这一成绩。使用多页网页的形式，采用现代、美观的像素风格，其中首页集中展示主要的信息，再通过几个按钮链接到其它网页。</p>
<p>从数据处理脚本、跨语言游戏移植，再到创意小程序和专题网站，Doubao-Seed-Code 在从零开始这一关卡中，充分展现了其强大的 Agentic 规划能力和工程实现能力。</p>
<p>5、关卡四：一个实际问题</p>
<p>最后，我们来让 Doubao-Seed-Code 解决一个实际问题。</p>
<p>作为一家专业的 AI 媒体，arXiv 上的新论文是机器之心日常报道的重要来源。但每天手动去刷几十位行业技术大佬的论文更新情况，费时费力还容易遗漏。</p>
<p>于是，我们决定让 Doubao-Seed-Code 帮我们解决这个痛点：构建一个「论文查找器」。首先，将我们的需求组合成一个提示词，表达清楚即可：</p>
<blockquote>
<p>用 Python 构建一个论文查找器，其功能为：检索 arXiv，找到用户提供的 authors 文件中所有人物过去一周内最新更新或发布的三篇论文，将结果输出为一个 Markdown 文件，内容包括人名、论文标题和链接。如果过去一周没有论文更新，则无需包含进来。作为参考，这是查询 Yoshua Bengio 论文的 arXiv API：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fexport.arxiv.org%2Fapi%2Fquery%3Fsearch_query%3Dau%3A%2BBengio_Yoshua%26sortBy%3DlastUpdatedDate%26sortOrder%3Ddescending%26max_results%3D100" target="_blank" title="https://export.arxiv.org/api/query?search_query=au:+Bengio_Yoshua&amp;sortBy=lastUpdatedDate&amp;sortOrder=descending&amp;max_results=100" ref="nofollow noopener noreferrer">export.arxiv.org/api/query?s…</a></p>
</blockquote>
<p>顺带一提，这一次我们选择在 Trae 中完成这个项目。</p>
<p>7 分钟，Doubao-Seed-Code 就搞定了一切。它还生成了一个 authors.txt 文件，里面包含 Geoffrey Hinton 等四位 AI 领域的传奇人物，现在我们为这份名单添加更多人物（包括近期有更新的作者），测试一下。</p>
<p>完美！现在，我只需要把它设置成一个定时任务，每天上午自动运行。我们再也不用担心错过前沿 AI 论文选题了。</p>
<p>三、最后聊点实在的：要花多少钱？</p>
<p>实战评测之后，终于到了最实在的部分：价格。毕竟，如果像 Claude Pro 那样有严格的用量限制或高昂的门槛，再强大的 Agentic Coder 也难以「飞入寻常百姓家」。</p>
<p>而在价格方面，Doubao-Seed-Code 也试图解决前文中提到的痛点。恰逢双十一，火山引擎同步推出了一个 Coding Plan 套餐包。</p>
<p>这个「方舟 Coding Plan」是专为开发者量身打造的 AI Coding 场景订阅服务。作为「双十一」的重头戏，它的套餐包价格非常亮眼：</p>
<ul>
<li>
<p>Lite 套餐（适合大多数开发者）：首购首月仅需 9.9 元 / 月；用一杯咖啡的价格」，就能享受一整个月的优质编码辅助。后续续费为 40 元 / 月。</p>
</li>
<li>
<p>Pro 套餐（适合复杂项目开发）：首购首月仅需 49.9 元；后续续费为 200 元 / 月。</p>
</li>
</ul>
<p>除了套餐包的巨大优惠，Doubao-Seed-Code 在调用价格上也实现了普惠开发者。它通过采用全量透明 Cache 技术，能使成本再降低 80%。不仅如此，火山引擎还为该模型推出了分层定价模式。官方表示，在实际使用场景中，综合使用成本可降低 62.7%，实现了目前国内最低价格。</p>
<p>总而言之，Doubao-Seed-Code 在尝试解决 Agentic Coding 路线性能问题的同时，也通过这个 Coding Plan 对前文提到的价格和用量限制痛点做出了回应。</p>
<p>四、强大的 Agentic Coder，更是完美平替？</p>
<p>从易到难再到我们日常工作中的实际问题，一场评测下来，我们认为连通四关的豆包编程模型 Doubao-Seed-Code 令人印象深刻，足称「强大」。而且很明显它与 IDE 增强路线的辅助补全不同，其核心能力更多体现在对复杂、多步骤任务的自主规划与执行上。</p>
<p>无论是重构屎山代码，还是挑战 C++/OpenGL 到 Python 的跨语言移植，亦或是从零孵化一只功能完备的「桌面树懒」；乃至帮我们解决 arXiv 刷论文的真实痛点，它都展现出了强大的 Agentic Coding 能力，证明了自己是 Agentic 路线的有力竞争者。</p>
<p>原生 256K 的长上下文能力及其背后 Coding RL Agent at Scale 的端到端强化学习训练共同构成了 Doubao-Seed-Code 应对「真实编程场景」的技术基础。</p>
<p>Doubao-Seed-Code 的意义还不止于技术。它不仅解决了 Agentic 路线的性能问题 ，更通过 Coding Plan 和 API 兼容性解决了开发者们在原版 Claude Code 上遇到的价格、用量限制乃至用户限制的痛点。</p>
<p>它不仅是一个高性能的结对工程师，也是一个高性价比、易于获取的前沿编程模型的「完美平替」。它让我们看到了 Agentic Coding 真正走向普惠、人人可用时代的可能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Apache Doris 4.0.1 版本正式发布]]></title>    <link>https://juejin.cn/post/7571191453126541338</link>    <guid>https://juejin.cn/post/7571191453126541338</guid>    <pubDate>2025-11-11T11:28:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571191453126541338" data-draft-id="7571278865517314098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apache Doris 4.0.1 版本正式发布"/> <meta itemprop="keywords" content="Apache,数据库"/> <meta itemprop="datePublished" content="2025-11-11T11:28:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apache Doris 4.0.1 版本正式发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T11:28:02.000Z" title="Tue Nov 11 2025 11:28:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>亲爱的社区小伙伴们，**Apache Doris 4.0.1 版本已于 2025 年 11 月 08 日正式发布。**此版本聚焦核心模块的打磨与优化，在 AI &amp; Search 方面实现了重要能力扩展，同时全面提升了 Lakehouse 与查询引擎的稳定性和性能。</p>
<ul>
<li>GitHub 下载：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Fdoris%2Freleases" target="_blank" title="https://github.com/apache/doris/releases" ref="nofollow noopener noreferrer">github.com/apache/dori…</a></li>
<li>官网下载：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fdownload" target="_blank" title="https://doris.apache.org/download" ref="nofollow noopener noreferrer">doris.apache.org/download</a></li>
</ul>
<h2 data-id="heading-0">行为变更</h2>
<ul>
<li><code>SHOW PARTITIONS</code> 命令不再支持 Iceberg 表，请直接使用 Iceberg 的 <code>$partitions</code> 系统表查看。#56985</li>
</ul>
<h2 data-id="heading-1">新增功能</h2>
<ul>
<li>新增 mmh64_v2 函数，用于生成与其他三方库相同的 Hash 结果。#57180</li>
<li>新增 json_hash 函数，支持对 JSONB 类型生成 Hash 值。#56962</li>
<li>新增 Binary 数据类型，并增加一系列函数 length、from_base64_binary、to_base64_bianry、sub_binary。#56648</li>
<li>新增 sort_json_object_keys / normalize_json_numbers_to_double 函数，用于对 JSONB 的 Key 进行排序。</li>
<li>新增与 MySQL 兼容的时间函数：UTC_DATE、UTC_TIME 及 UTC_TIMESTAMP。#57443</li>
<li>新增对 MaxCompute Schema 层级的支持。 #56874
<ul>
<li>相关文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fdocs%2F3.x%2Flakehouse%2Fcatalogs%2Fmaxcompute-catalog%23hierarchical-mapping" target="_blank" title="https://doris.apache.org/docs/3.x/lakehouse/catalogs/maxcompute-catalog#hierarchical-mapping" ref="nofollow noopener noreferrer">doris.apache.org/docs/3.x/la…</a></li>
</ul>
</li>
<li>JSON_OBJECT 函数支持使用 * 作为参数。#57256</li>
</ul>
<h2 data-id="heading-2">功能改进</h2>
<h3 data-id="heading-3">AI &amp; Search</h3>
<ul>
<li>为 SEARCH 函数新增短语查询、通配符查询和正则查询支持。#57372 #57007</li>
<li>扩展 SEARCH 函数参数，新增可选的 default_field 参数（默认列）和 default_operator 参数（指定多列查询的布尔运算符为 "and" 或 "or"）。#57312</li>
<li>SEARCH 函数新增对 Variant 类型子列的搜索支持，可通过点号语法（如 variantColumn.subcolumn：关键词）直接搜索 JSON 路径中的特定字段。</li>
<li>将倒排索引的默认存储格式由 V2 升级为 V3 版本。#57140</li>
<li>完善自定义分词器 Pipeline 支持，新增 char_filter 组件；在 Analyzer 框架中新增 Basic Tokenizer 和 和 ICU Tokenizer 两种内置分词器支持；新增内置分词器别名并支持组件同名配置，优化统一 Analyzer 框架。#57055</li>
</ul>
<h3 data-id="heading-4">Lakehouse</h3>
<ul>
<li>新增会话变量 <code>merge_io_read_slice_size_bytes</code> 来解决某些情况下，外表 Merge IO 读放大严重的问题。
<ul>
<li>相关文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fdocs%2F3.x%2Flakehouse%2Fbest-practices%2Foptimization%23merge-io-optimization" target="_blank" title="https://doris.apache.org/docs/3.x/lakehouse/best-practices/optimization#merge-io-optimization" ref="nofollow noopener noreferrer">doris.apache.org/docs/3.x/la…</a></li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">查询</h3>
<ul>
<li>优化了 JOIN Shuffle 选择算法 #56279</li>
</ul>
<h3 data-id="heading-6">其他</h3>
<ul>
<li>优化了物理计划中 Runtime Filter 序列化信息的大小 #56978</li>
</ul>
<h2 data-id="heading-7">问题修复</h2>
<h3 data-id="heading-8">AI &amp; Search</h3>
<ul>
<li>修复非分词字段的 SEARCH 查询结果问题，支持在 MOW 表上执行 SEARCH 函数查询 #56927</li>
<li>修复倒排索引在执行 IS NULL 谓词过滤时的计算错误问题 #56964</li>
</ul>
<h3 data-id="heading-9">Lakehouse</h3>
<ul>
<li>修复某些情况下，谓词下推无法使用 Parquet Page Index 的问题 #55795</li>
<li>修复某些情况下外表查询分片读取丢失的问题 #57071</li>
<li>修复某些情况下，Hadoop 文件系统缓存开启导致修改 Catalog 属性不生效的问题 #57063</li>
<li>修复某些情况下，从旧版本升级时，连接属性校验导致元数据回放失败的问题 #56929</li>
<li>修复某些情况下，Refresh Catalog 导致 FE 线程死锁的问题 #56639</li>
<li>修复无法读取由 Hive 转换生成的 Iceberg 表的问题 #56918</li>
<li>修复某些情况下收集 Query Profile 导致 BE 宕机的问题 #56806</li>
</ul>
<h3 data-id="heading-10">查询</h3>
<ul>
<li>修复 datetime 类型在 Timezone 相关 Cast 时，边界条件下结果错误的问题 #57422</li>
<li>修复部分 datetime 相关函数结果精度推导不正确的问题 #56671</li>
<li>修复 inf 作为 float 的谓词条件时 Core 的问题 #57100</li>
<li>修复 explode 函数在可变参数下 Core 的问题 #56991</li>
<li>修复 decimal256 到 float 类型的 Cast 不稳定的问题 #56848</li>
<li>修复 Spill Disk 时可能出现重复调度导致 Core 的问题 #56755</li>
<li>修复偶发的错误调整 Mark Join 和其他 Join 顺序的问题 #56837</li>
<li>修复部分命令未被正确转发到 Master Frontend 执行的问题 #55185</li>
<li>修复偶现的窗口函数错误生成 Partition TopN 的问题 #56622</li>
<li>修复当同步物化视图定义中存在关键字时，查询可能报错的问题 #57052</li>
</ul>
<h3 data-id="heading-11">其他</h3>
<ul>
<li>禁止基于同步物化视图创建另外一个同步物化视图 #56912</li>
<li>修复 Profile 中存在内存未及时释放问题 #57257</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[李飞飞最新长文：AI的下一个十年——构建真正具备空间智能的机器]]></title>    <link>https://juejin.cn/post/7571191453126574106</link>    <guid>https://juejin.cn/post/7571191453126574106</guid>    <pubDate>2025-11-11T11:31:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571191453126574106" data-draft-id="7571126773809512458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="李飞飞最新长文：AI的下一个十年——构建真正具备空间智能的机器"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-11T11:31:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            李飞飞最新长文：AI的下一个十年——构建真正具备空间智能的机器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T11:31:59.000Z" title="Tue Nov 11 2025 11:31:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>就在昨晚，关于其投身的空间智能，斯坦福大学教授李飞飞发表了一篇长篇博客《From Words to Worlds: Spatial Intelligence is AI’s Next Frontier》。</p>
<p>在文中，李飞飞详细解读了「空间智能究竟是什么？它为什么重要？我们如何构建它？我们又如何使用它？」她同时阐述了真正的空间智能世界模型必须实现的核心框架：构建具有故事讲述者想象力的 AI、具备第一响应者流畅性的 AI 以及以科学精确性进行空间推理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0152c9a32184bb285cd0c9393f29af0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465518&amp;x-signature=4n6v7VHVjnfO7HEtCMYd8nso8is%3D" alt="图片" loading="lazy"/></p>
<p>以下为全文翻译：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e7e903c3cab457e8ace1989f552ba99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465518&amp;x-signature=52laQu%2FVueTCLvqoyLxTbdoYZcY%3D" alt="图片" loading="lazy"/></p>
<p>1950 年，当计算机还只是自动化的算术和简单逻辑时，艾伦・图灵提出了一个至今仍余音不绝的问题：机器能思考吗？他拥有非凡的想象力，看到了一个超越时代的可能 —— 智能或许可以被「构建」，而非「诞生」。这一洞见开启了一个持久而伟大的科学征程 —— 人工智能（AI）。在我投身人工智能研究二十五年后的今天，图灵的愿景仍让我心怀敬意与灵感。但我们究竟走到了哪一步？答案并不简单。</p>
<p>如今，以大语言模型（LLM）为代表的前沿 AI 技术，已经开始改变我们获取和运用抽象知识的方式。然而，它们依然像是「黑暗中的文匠」：能言善辩却缺乏经验，知识丰富却脱离现实。空间智能将彻底改变我们创造和交互现实与虚拟世界的方式 —— 它将重塑叙事、创意、机器人学、科学发现等领域。这正是 AI 的下一个前沿。</p>
<p>自我踏入这一领域以来，对视觉与空间智能的追求一直是我心中的北极星。这也是我花费多年时间创建 ImageNet 的原因 —— 这是首个大规模视觉学习与评测数据集，与神经网络算法和现代计算（如图形处理器 GPU）一道，构成了现代人工智能诞生的三大基石。这也是为什么我的斯坦福实验室在过去十年中，持续探索将计算机视觉与机器人学习相结合。</p>
<p>而这一追求，也促使我与合伙人 Justin Johnson、Christoph Lassner、Ben Mildenhall 共同创立了 World Labs—— 在一年多前，我们立志首次将这一愿景彻底实现。在这篇文章中，我将阐述什么是空间智能、它为何重要，以及我们如何构建能够释放空间智能潜力的世界模型 —— 这种能力将深刻影响创造力、具身智能与人类的未来进步。</p>
<p>空间智能：</p>
<p>人类认知的脚手架</p>
<p>人工智能正处在前所未有的激动人心时刻。生成式 AI 模型 —— 例如大语言模型（LLM）—— 已经从研究实验室走入日常生活，成为数十亿人创造、工作与沟通的工具。它们展现出了曾被认为不可能的能力：能够轻松生成连贯的文本、海量的代码、逼真的图像，甚至短视频片段。如今，问题已不再是「人工智能是否会改变世界」，而是「它已经如何改变了世界」。</p>
<p>然而，仍有许多目标尚未触及。自主机器人的愿景依旧令人神往，却依然停留在推测阶段，离未来学家长期描绘的日常现实仍有距离。在疾病治疗、新材料发现、粒子物理等领域，人工智能加速科研的梦想也尚未真正实现。而一种能够真正理解并赋能人类创造者的 AI—— 无论是学习分子化学复杂概念的学生、构思空间的建筑师、构建世界的电影创作者，还是渴望沉浸式虚拟体验的任何人 —— 这一承诺仍未兑现。</p>
<p>要理解这些能力为何依然难以实现，我们需要回溯空间智能的演化历程，并审视它如何塑造了我们对世界的理解。</p>
<p>视觉一直是人类智能的基石，但它的力量源自更为根本的东西。早在动物学会筑巢、照料幼崽、用语言交流或建立文明之前，最简单的「感知」行为，便悄然点燃了一场通向智能的进化旅程。</p>
<p>这种看似孤立的能力 —— 从外部世界中提取信息，无论是一道微光，还是一种触感 —— 在感知与生存之间搭起了一座桥梁，并随着世代更迭不断加固、延展。神经元层层叠加，沿着这座桥梁生长，形成了能解释世界、协调生物体与环境互动的神经系统。正因如此，许多科学家推测，感知与行动构成了驱动智能演化的核心循环，也成为自然创造人类这一物种的根基 —— 一种集感知、学习、思考与行动于一体的终极体现。</p>
<p>空间智能在定义人类如何与物理世界互动中起着根本性的作用。每天，我们都依赖它完成最平常的行为：停车时通过想象车尾与路缘之间逐渐缩小的间隙来判断距离；接住被人扔来的钥匙；在人群密集的人行道上穿行而不相撞；或者在半睡半醒间不看杯子也能准确地把咖啡倒进去。在更极端的情境中，消防员在浓烟弥漫、结构不断坍塌的建筑中穿行，瞬间判断稳定与危险，依靠手势、身体语言以及一种无法用言语表达的职业直觉进行协作。</p>
<p>而婴儿在还未学会说话的数月甚至数年中，正是通过与环境的嬉戏互动来认识世界。所有这一切都在无意识间、自动地完成 —— 这种流畅性，是机器至今尚未具备的。</p>
<p>空间智能同样是人类想象力与创造力的基础。讲故事的人在脑海中构建独特而丰富的世界，并借助各种视觉媒介将其传达给他人 —— 从史前的洞穴壁画，到现代电影，再到沉浸式电子游戏。无论是孩子在沙滩上筑起的沙堡，还是他们在电脑上玩《我的世界》所创造的空间，这种基于空间的想象力构成了现实与虚拟世界中交互体验的核心。而在众多行业应用中，对物体、场景和动态交互环境的模拟，正支撑着从工业设计到数字孪生再到机器人训练的无数关键业务场景。</p>
<p>纵观历史，空间智能在推动文明发展的关键时刻屡次扮演核心角色。在古希腊，埃拉托色尼通过几何化阴影来揭示地球的尺度 —— 他在亚历山大测量出七度的日影角度，并在太阳直射、影子消失的赛恩进行对比，计算出了地球的周长。哈格里夫斯通过一个空间构想发明了「珍妮纺纱机」：将多个纺锤并列在同一架构中，使一个工人能够同时纺出多股纱线，生产效率因此提升八倍。沃森和克里克通过亲手搭建三维分子模型、不断调整金属板与铁丝的位置，最终发现了 DNA 的双螺旋结构。</p>
<p>当科学家与发明家需要操纵物体、想象结构、推理空间关系时，正是空间智能推动了人类文明的跃进 —— 而这些都无法仅凭文字所捕捉。</p>
<p>空间智能是支撑人类认知的脚手架。无论我们是在被动观察，还是主动创造，它都在发挥作用。它驱动我们的推理与规划，哪怕是在最抽象的思维领域；它也是我们与他人、与环境进行互动 —— 无论通过语言还是行动 —— 所必不可少的能力。虽然我们大多数人并不会像埃拉托色尼那样揭示新的宇宙真理，但我们几乎每天都以相似的方式思考 —— 通过感官理解复杂的世界，并凭借对物理与空间规律的直觉掌握，来形成认知与判断。</p>
<p>遗憾的是，当下的人工智能尚未具备这种思维方式。</p>
<p>过去几年，AI 的确取得了巨大进步。多模态大语言模型（MLLM）在文本之外引入了海量的多媒体数据，使 AI 具备了初步的空间感知能力。如今，AI 已经能够分析图像、回答相关问题，并生成高度逼真的图片和短视频。借助传感器与触觉技术的突破，最先进的机器人也开始能够在高度受限的环境中操纵物体与工具。</p>
<p>然而，坦率地说，AI 的空间能力仍与人类相距甚远，这一差距显而易见。最先进的多模态模型在估算距离、方向和大小等任务上，其表现往往仅略高于随机水平；在「心智旋转」（从不同角度重新生成物体）的测试中也极为有限。它们无法穿越迷宫，不能识别捷径，也无法预测最基本的物理规律。AI 生成的视频 —— 虽令人惊叹，但往往在数秒后便失去连贯性。</p>
<p>当前最先进的 AI 在阅读、写作、研究和数据模式识别方面表现出色，但在对物理世界的表征与交互上却存在根本性局限。人类对世界的理解是整体性的 —— 不仅关乎我们「看见了什么」，还包括事物在空间上的关系、它们的意义以及彼此的关联。通过想象、推理、创造与互动来理解世界，而非仅仅依赖语言描述，这正是空间智能的力量。没有它，AI 就与它试图理解的物理现实脱节，无法真正安全高效地驾驶汽车、引导家庭或医院中的机器人，也难以实现学习与娱乐中的沉浸式互动体验，更无法加速材料科学与医学中的突破性发现。</p>
<p>哲学家维特根斯坦曾说，「我的语言的界限意味着我的世界的界限」。我不是哲学家，但我深知，对人工智能而言，世界远不止语言本身。空间智能代表着超越语言的前沿 —— 它连接了想象、感知与行动，开启了机器真正赋能人类生活的可能，从医疗到创造力，从科学发现到日常助理。</p>
<p>AI 的下一个十年：</p>
<p>构建真正具备空间智能的机器</p>
<p>那么，我们该如何打造具备空间智能的 AI？通往那样的模型之路是什么样的？它不仅能像埃拉托色尼那样进行空间推理，像工业设计师那样精准构造，像讲故事的人那样富于想象，还能像应急救援人员那样自然地与环境互动。</p>
<p>要实现空间智能，我们需要的远不止 LLM 那样的体系，而是更具雄心的「世界模型」—— 一种新型生成式模型，能够在语义、物理、几何与动态等多重复杂世界（无论虚拟还是现实）中进行理解、推理、生成与交互。</p>
<p>这一领域仍处在萌芽阶段，当前的研究方法从抽象推理模型到视频生成系统皆有涉及。World Labs 正是在这一信念之上，于 2024 年初创立：即世界模型的基础方法尚在确立之中，而这正是未来十年人工智能的关键挑战所在。</p>
<p>在这一新兴领域中，最重要的是确立指导发展的基本原则。对于空间智能而言，我将「世界模型」定义为具备以下三种核心能力的系统：</p>
<p>一是生成性：世界模型能够生成在感知、几何与物理层面保持一致的世界。</p>
<p>要解锁空间理解与推理的能力，世界模型必须能够生成属于自己的模拟世界。它需要具备创造出无限多样的虚拟世界的能力，这些世界必须遵循语义或感知层面的指令，同时在几何、物理和动态层面保持一致性 —— 无论这些世界对应的是现实空间还是虚拟空间。研究界目前正积极探索这些世界的内部几何结构应当以隐式还是显式的方式表示。</p>
<p>除此之外，我认为，除了强大的潜在表征之外，一个通用的世界模型还必须能够生成明确、可观测的世界状态，以适配不同的应用场景。尤其重要的是，它对当前世界的理解，必须与过去保持连贯 —— 与导致这一现状的先前世界状态相一致。</p>
<p>二是多模态性：世界模型在设计上即是多模态的。</p>
<p>正如动物与人类一样，世界模型应能够处理多种形式的输入 —— 在生成式 AI 中通常被称为提示词。当输入信息不完整时，无论是图像、视频、深度图、文本指令、手势还是动作，世界模型都应能够预测或生成尽可能完整的世界状态。这要求模型具备如真实视觉般处理视觉输入的能力，同时又能同样熟练地理解语义指令。这样的能力使得智能体与人类能够通过多样化的输入方式与模型就世界进行交流，并获得多样化的输出反馈。</p>
<p>三是交互性：世界模型能够根据输入的动作生成下一个世界状态。</p>
<p>当动作和 / 或目标成为世界模型的输入提示时，其输出必须包括世界的下一个状态 —— 可以是隐式的，也可以是显式的。当输入仅包含一个动作，或者包含动作与目标状态时，世界模型应能生成与先前世界状态、预期目标（若有）、语义含义、物理规律及动态行为相一致的输出。随着空间智能世界模型在推理与生成能力上的不断增强，可以想见，在某些情况下，模型不仅能预测世界的下一状态，还能基于这一新状态，进一步预测实现目标所需的下一步行动。</p>
<p>这一挑战的规模，超出了人工智能以往所面对的一切。</p>
<p>语言只是人类认知中一种纯粹的生成现象，而「世界」则遵循着远为复杂的规律。在地球上，重力主宰着运动，原子结构决定了光如何产生色彩与亮度，无数物理定律约束着每一次交互。即便是最奇幻、最具创造力的世界，其构成的空间物体与行动主体，也都必须服从特定的物理法则与动态行为。要在语义、几何、动态与物理层面上实现一致的统一与协调，需要全新的技术与理论路径。</p>
<p>相较于语言这样一维、顺序性的信号，对「世界」的表征在维度与复杂度上要庞大得多。要让世界模型具备人类所拥有的那种普适能力，必须突破多个艰巨的技术壁垒。在 World Labs，我们的研究团队正致力于在这一目标上取得根本性的进展。</p>
<p>以下是我们当前的一些研究方向：</p>
<p>1、一种新的通用训练任务函数：</p>
<p>为世界模型定义一种像 LLM 中的「下一 token 预测」那样简洁优雅的通用任务函数，一直是该领域的核心目标之一。然而，由于世界模型在输入与输出空间上的复杂性，使得这种函数的构建本身极具挑战。尽管仍有大量未知有待探索，但这种目标函数及其对应的表征方式，必须能够反映几何与物理规律，体现世界模型作为联结想象与现实的基础性表征体系的本质特征。</p>
<p>2、大规模训练数据：</p>
<p>训练世界模型所需的数据远比文本更为复杂。好消息是，大规模数据源已经存在。互联网上海量的图像与视频，提供了丰富且可获取的训练材料，真正的挑战在于如何研发能够从二维图像或视频帧（即 RGB 信号）中提取更深层空间信息的算法。过去十年的研究表明，在语言模型中，数据量与模型规模之间存在明确的「scaling laws」；对于世界模型而言，关键在于构建能够在相似规模上充分利用现有视觉数据的架构。</p>
<p>此外，高质量的合成数据，以及诸如深度信息与触觉信息等额外模态，也将在训练过程中的关键阶段发挥重要作用。但要实现这一目标，我们仍需更先进的传感系统、更稳健的信号提取算法，以及更强大的神经模拟方法。</p>
<p>3、新型模型架构与表征学习：</p>
<p>世界模型的研究将不可避免地推动模型架构与学习算法的革新，尤其是在超越当前 MLLM 与视频扩散模型范式的方向上。现有方法通常将数据离散化为一维或二维序列，这使得一些简单的空间任务变得不必要地困难 —— 比如统计短视频中独特的椅子数量，或记住一个房间一小时前的样子。替代性架构可能带来突破，例如具备三维或四维感知能力的分词、上下文和记忆机制。</p>
<p>以 World Labs 为例，我们最近开发的实时生成帧模型 RTFM（Real-Time Frame-based Model）正体现了这一方向的转变。它将空间锚定的帧作为一种空间记忆形式，在保持生成世界连续性与一致性的同时，实现了高效的实时生成。</p>
<p>显然，在通过世界模型彻底释放空间智能之前，我们仍面临着艰巨的挑战。这项研究不仅仅是理论探索，它将成为新一代创造力与生产力工具的核心引擎。而来自 World Labs 的最新进展令人振奋。我们近日首次向少量用户展示了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650991095%26idx%3D1%26sn%3D2d4b5c89e7051cbb8eaedfdf3428e1ad%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650991095&amp;idx=1&amp;sn=2d4b5c89e7051cbb8eaedfdf3428e1ad&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Marble</a> 的早期成果 —— 这是首个能够通过多模态输入进行提示，从而生成并维持一致性三维环境的世界模型。用户与创作者可以在其中探索、交互，并在创作流程中不断扩展这一虚拟世界。我们也正全力推进，让它尽快向公众开放。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2ac8bae604b43a2b30babd1d81059e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763465518&amp;x-signature=ldsL%2F57VFO4zr4GlxBzuVJYUM7Q%3D" alt="图片" loading="lazy"/></p>
<p>Marble 只是我们迈向真正具备空间智能的世界模型的第一步。随着研究不断加速，更多科学家、工程师、用户与商业领袖开始意识到它所蕴含的巨大潜能。新一代的世界模型将使机器在空间智能方面达到全新的高度，这将开启当今 AI 系统仍普遍缺乏的关键能力。</p>
<p>利用世界模型，</p>
<p>为人类创造更美好的世界</p>
<p>人工智能的发展动力至关重要。作为推动现代人工智能时代到来的一名科学家，我的初心始终清晰：AI 应当增强人类能力，而非取而代之。多年来，我一直致力于让 AI 的研发、应用与治理与人类需求保持一致。如今，关于科技乌托邦或末日论的极端叙事层出不穷，但我依然坚持一种更务实的观点：AI 由人类创造、由人类使用、也应由人类治理。它必须始终尊重人的自主性与尊严。</p>
<p>AI 的真正魅力，在于扩展我们的能力，使我们变得更加富有创造力、更加紧密相连、更高效、更有成就感。空间智能正是这种愿景的体现 —— 一种能让创作者、照护者、科学家与梦想家实现曾经不可能之事的 AI。这一信念，是我将空间智能视为人工智能下一个伟大前沿的根本动力。</p>
<p>空间智能的应用涵盖不同的时间维度。面向创作者的工具正在崭露头角 ——World Labs 的 Marble 已经让创作者与讲述者能够直接掌握这些能力。机器人学则代表了中期的雄心目标，我们正不断完善感知与行动之间的闭环。而那些最具变革性的科学应用可能需要更长时间，但它们有望对人类的繁荣产生深远影响。</p>
<p>纵观这些不同阶段，有几个领域格外值得关注，因为它们最有潜力重塑人类能力。要实现这一愿景，需要集体的巨大努力，远超任何一个团队或公司的能力范围。这需要整个 AI 生态系统的共同参与：研究者、创新者、企业家、公司，乃至政策制定者，都必须携手朝着共同的愿景前进。而这一愿景，值得我们全力以赴。接下来，让我们看看这个未来将带来什么。</p>
<p>创造力：赋能故事叙述与沉浸式体验</p>
<p>「创造力是智力在享受乐趣。」这是我最喜爱的名言之一，出自我的精神偶像阿尔伯特・爱因斯坦。早在文字出现之前，人类就已经在讲述故事 —— 他们将故事绘在洞穴的石壁上，口耳相传，代代延续，并以共同的叙事建构出整个文化。故事是人类理解世界的方式，是跨越时空的纽带，是我们探索「何为人」的途径，更是我们在生命与爱中寻找意义的核心。</p>
<p>如今，空间智能有潜力彻底改变我们创造与体验故事的方式 —— 不仅尊重叙事本身的根本价值，更将其影响力从娱乐延展到教育，从设计延伸到建筑，让创造与体验的边界得到全新拓展。</p>
<p>World Labs 的 Marble 平台正把前所未有的空间创造力与编辑控制力交到电影制作人、游戏设计师、建筑师以及各类叙事创作者手中，使他们能够快速创建并迭代可自由探索的三维世界，而无需承担传统 3D 设计软件所带来的复杂成本。创作行为依然保持其独特的人性与活力，而 AI 工具只是放大并加速了创作者能够实现的潜能。这其中包括：</p>
<p>在新维度中展开叙事体验：电影制作人和游戏设计师正在利用 Marble 创造完整的世界，不再受制于预算或地理的限制，他们得以探索传统制作流程中难以企及的场景与视角。随着不同媒介与娱乐形式之间的界限逐渐模糊，我们正迈向一种全新的交互体验形态，艺术、模拟与游戏的融合体。在这些个性化的世界中，不仅是大型工作室，任何人都可以创造并居住在属于自己的故事里。随着从概念与分镜到完整体验的生成过程变得更加快捷高效，叙事将不再局限于单一媒介，创作者可以自由地在多种平台与载体之间，构建互相关联的世界与故事线。</p>
<p>通过设计讲述空间叙事：几乎所有的制造物与建筑空间，在被实体化之前，都必须先在虚拟三维世界中完成设计。这一过程迭代频繁，且在时间与成本上代价高昂。借助具备空间智能的模型，建筑师可以在动工之前快速可视化建筑结构，甚至漫步于尚未存在的空间中，从而以一种讲故事的方式，探索人类未来的生活、工作与聚会方式。工业设计师与时尚设计师则能瞬间将想象转化为形态，直观地探索物体与人体及空间之间的关系。</p>
<p>全新的沉浸式与交互式体验：体验本身，是人类创造意义最深层的方式之一。在漫长的人类历史中，我们共享的唯一三维世界是物理世界。直到近几十年，随着游戏与早期 VR 的出现，我们才开始窥见人类自造「平行世界」的可能。如今，空间智能结合 VR、XR 头显以及沉浸式显示设备等新形态，将这种体验提升到了前所未有的高度。我们正迈向一个时代 —— 走进一个完全实现的多维世界，将如同打开一本书般自然。空间智能让「造世界」的能力不再只是专业团队与大型工作室的特权，而是向个人创作者、教育者以及任何怀抱想象的人开放。</p>
<p>机器人：具身智能的实践</p>
<p>从昆虫到人类，动物都依赖空间智能来理解、导航并与周围世界互动。机器人也将如此。自这一领域诞生以来，具备空间感知能力的机器一直是其终极目标 —— 这也包括我与斯坦福实验室学生和合作伙伴多年来的研究工作。这正是我对 World Labs 正在构建的世界模型充满期待的原因之一，因为它们有望真正让这一愿景成为现实。</p>
<p>通过世界模型扩展机器人的学习能力：</p>
<p>机器人的学习进步，取决于能否找到一种可扩展的训练数据解决方案。鉴于机器人在理解、推理、规划与交互中所面对的庞大状态空间，许多研究者推测，只有结合互联网数据、合成仿真以及人类演示的真实捕获，才能真正培育出具备泛化能力的机器人。</p>
<p>然而，与语言模型不同，目前机器人研究的数据极其匮乏。世界模型将在此发挥决定性作用。随着其感知精度与计算效率的提升，世界模型的输出能够快速缩小模拟与现实之间的差距，从而帮助机器人在无数状态、交互与环境的仿真中进行训练。</p>
<p>人类的伙伴与协作者：</p>
<p>作为人类的协作者，无论是在实验台前协助科学家，还是陪伴独居长者，机器人都能在劳动力与生产力极度紧缺的领域中提供支持。但要做到这一点，它们必须具备空间智能 —— 既能感知、推理、规划、行动，又能（这点最为重要）保持对人类目标与行为的情感共鸣与理解。</p>
<p>例如，在实验室中，机器人可以代替科学家操作仪器，让人类专注于更需要灵巧与推理的任务；在家庭中，助理机器人可以帮助老人烹饪，而不削减他们的自主性与生活乐趣。真正具备空间智能的世界模型 —— 能够预测下一状态，甚至推测与之相符的行动 —— 是实现这一目标的关键。</p>
<p>拓展具身智能的形态：</p>
<p>人形机器人在我们构建的世界中确有其角色，但创新的全部潜力将来自更为多样的设计形式：如可输送药物的纳米机器人、能穿越狭窄空间的软体机器人、以及适用于深海或外太空的探索型机器。无论形态如何，未来的空间智能模型都必须同时整合机器人所处的环境与其自身的感知与运动方式。</p>
<p>然而，这类机器人的发展面临的核心难题，是缺乏适用于多种具身形态的训练数据。世界模型将在这一过程中发挥关键作用 —— 它们将为仿真数据的生成、训练环境的构建以及评测任务的制定提供基础支撑。</p>
<p>更长远的视野：科学、医疗与教育</p>
<p>除了创意与机器人领域，空间智能的深远影响还将扩展至那些 AI 能够以拯救生命、加速发现等方式增强人类能力的领域。以下我将重点谈及三个具有深刻变革潜力的方向，但显而易见，空间智能的应用远不止于此，它将在更多行业中展现出广阔的前景。</p>
<p>在科学研究中，具备空间智能的系统能够模拟实验、并行检验假设、探索人类难以到达的环境 —— 从深海到遥远的行星。这项技术将重塑气候科学、材料研究等领域的计算建模方式。通过将多维度的仿真与真实世界的数据采集相结合，这类工具可以降低计算壁垒，拓展每一个实验室的观察与理解边界。</p>
<p>在医疗领域，空间智能将从实验室到病房，全面改变医学实践。在斯坦福，我与学生及合作伙伴多年来与医院、养老机构以及家庭患者紧密合作，这段经历让我更加坚信空间智能在医疗中的变革潜力。AI 可以通过多维建模加速药物发现；通过模式识别辅助放射科医生提升影像诊断的准确性；并通过环境感知式监护系统支持患者与护理者，而不削弱康复所需的人际联系。更不用说，具备空间智能的机器人也能在不同场景中，为医护人员与患者提供强大的帮助。</p>
<p>在教育领域，空间智能能够让抽象或复杂的概念变得可感知、可体验，从而实现沉浸式学习。它还能创造出与人类大脑与身体学习机制高度契合的迭代式学习体验。在 AI 时代，更快、更高效的学习与再培训，对学生与成年人都至关重要。学生可以以多维视角探索细胞运作机制，或亲身「走入」历史事件；教师则能借助交互式环境实现个性化教学；而外科医生、工程师等专业人士则可在逼真的仿真环境中安全练习复杂技能。</p>
<p>无论在哪个领域，空间智能所带来的可能性几乎没有边界，但目标始终如一：让 AI 增强人类的专业能力，加速人类的发现，放大人类的关怀 —— 而不是取代构成人之为人的核心品质：判断力、创造力与共情力。</p>
<p>结语</p>
<p>在过去的十年里，人工智能已成为全球现象，并成为技术、经济乃至地缘政治的转折点。然而，作为一名研究者、教育者以及如今的创业者，真正激励我的，仍然是图灵在 75 年前提出的那个问题背后的精神。我依然与他一样，怀抱着对智能的惊奇与敬畏。正是这种好奇与挑战的魅力，让我每天都为空间智能的探索而充满动力。</p>
<p>在人类历史上，我们首次有能力构建出与物理世界深度契合的机器，让它们成为我们在应对重大挑战时值得信赖的伙伴。无论是加速我们在实验室中对疾病的理解，革新我们讲述故事的方式，还是在疾病、伤痛或衰老带来的脆弱时刻给予支持，我们正站在一项能够提升人类最珍视生活要素的技术门槛上。这是一个让生命更加深刻、更加丰盈、更加有力量的愿景。</p>
<p>距自然在远古动物身上首次点燃空间智能的火花，已过去近五亿年。而我们有幸身处这样一个时代，或许很快，我们将让机器也拥有同样的能力；更幸运的是，我们能够将这种能力用于造福全人类。如果没有空间智能，我们对「真正智能机器」的梦想就永远无法完整。</p>
<p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdrfeifei.substack.com%2Fp%2Ffrom-words-to-worlds-spatial-intelligence" target="_blank" title="https://drfeifei.substack.com/p/from-words-to-worlds-spatial-intelligence" ref="nofollow noopener noreferrer">drfeifei.substack.com/p/from-word…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[✍️记录自己的git分支管理实践]]></title>    <link>https://juejin.cn/post/7571272874847273012</link>    <guid>https://juejin.cn/post/7571272874847273012</guid>    <pubDate>2025-11-11T15:56:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571272874847273012" data-draft-id="7571280402965446691" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="✍️记录自己的git分支管理实践"/> <meta itemprop="keywords" content="Git,前端,后端"/> <meta itemprop="datePublished" content="2025-11-11T15:56:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="你的人类朋友"/> <meta itemprop="url" content="https://juejin.cn/user/4051056254523991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ✍️记录自己的git分支管理实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4051056254523991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    你的人类朋友
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T15:56:32.000Z" title="Tue Nov 11 2025 15:56:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>👋 你好啊，我是你的人类朋友！</p>
<p>因为本人的开发经常涉及各个分支间的同步，这一套同步的流程从刚开始的小心翼翼，到现在相对熟悉了</p>
<p>所以我想记录下自己工作中常用的分支同步的步骤 😆</p>
<p>顺便研究康康有没有可以优化的地方 🍃</p>
<h2 data-id="heading-1">正文</h2>
<p>先介绍下背景情况吧</p>
<p>首先主分支为 <code>master</code></p>
<p>其次，因为开发分为多个阶段，比如 <code>phase_1</code>、<code>phase_2</code>、<code>phase_3</code> 等</p>
<p>那就在 <code>master</code> 之后再创建 <code>feature/phase_1</code>、<code>feature/phase_2</code> 这样的分支，作为每一个 <code>phase</code> 的主分支</p>
<p>每一个人的开发分支可以这样安排：我叫江建清，所以我的 <code>phase2阶段</code> 的开发分支的名称为<code>feature/phase_2_devjjq</code></p>
<p>重点来了，我现在要将我的 <code>feature/phase_2_devjjq</code> 分支的改动同步到 <code>feature/phase_2</code> 分支中</p>
<p>如何操作呢？</p>
<p><strong>重点！重点！重点！</strong></p>
<blockquote>
<p>先上 git 命令，后面有文字版</p>
</blockquote>
<ol>
<li><code>git checkout feature/phase_2</code></li>
<li><code>git pull origin feature/phase_2</code></li>
<li><code>git checkout feature/phase_2_devjjq</code></li>
<li>【✨ 将冲突放到 <code>feature/phase_2_devjjq</code> 分支解决，完全不影响 <code>feature/phase_2</code>】<code>git merge feature/phase_2</code></li>
<li>解决好可能存在的冲突【注意，如果此处存在冲突，要进行解决，并且要做好测试。确保无误之后再进行后续的同步。⚠️❗ 核心的思路是：绝不可以将不能确定解决之后是否存在异常的内容推送到当前阶段的主分支，这一点在低代码领域尤其突出，需要更加谨慎】，然后将代码提交到 <code>feature/phase_2_devjjq</code> 分支中</li>
<li><code>git checkout feature/phase_2</code></li>
<li><code>git merge feature/phase_2_devjjq</code></li>
<li><code>git push origin feature/phase_2</code></li>
</ol>
<p>上面就是我目前的大致做法了。</p>
<p>用文字总结就是：</p>
<ol>
<li>先切换到 <code>feature/phase_2</code> 分支</li>
<li>拉取<code>feature/phase_2</code>的最新代码（因为各个同事都会开发，也都会向这个分支提交代码）</li>
<li>切换到 <code>feature/phase_2_devjjq</code> 分支</li>
<li>合并 <code>feature/phase_2</code> 分支到 <code>feature/phase_2_devjjq</code> 分支</li>
<li>解决可能存在的冲突</li>
<li>切换到 <code>feature/phase_2</code> 分支</li>
<li>合并 <code>feature/phase_2_devjjq</code> 分支到 <code>feature/phase_2</code> 分支</li>
<li>推送 <code>feature/phase_2</code> 分支到远程仓库</li>
</ol>
<p>好了，那我的流程有哪些可以优化的地方？</p>
<h3 data-id="heading-2">优化流程</h3>
<p>当前的流程总结下来是这样的：</p>
<p>步骤分解：</p>
<ol>
<li>
<p>git checkout feature/phase_2 ✅</p>
</li>
<li>
<p>git pull origin feature/phase_2 ✅</p>
</li>
<li>
<p>git checkout feature/phase_2_devjjq ✅</p>
</li>
<li>
<p>git merge feature/phase_2 ⚠️ (产生合并提交)</p>
</li>
<li>
<p>解决冲突 ✅</p>
</li>
<li>
<p>git checkout feature/phase_2 ✅</p>
</li>
<li>
<p>git merge feature/phase_2_devjjq ⚠️ (再次产生合并提交)</p>
</li>
<li>
<p>git push origin feature/phase_2 ✅</p>
</li>
</ol>
<p>我们可以这样优化：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1-2. 更新目标分支（保持不变）</span>
git checkout feature/phase_2
git pull origin feature/phase_2

<span class="hljs-comment"># 3. 切换到开发分支</span>
git checkout feature/phase_2_devjjq

<span class="hljs-comment"># 4. ✨ 关键优化：使用 rebase 而不是 merge。这个步骤做的事情其实就是将 feature/phase_2_devjjq 分支的提交放到 feature/phase_2 分支的最新提交之后。</span>
git rebase feature/phase_2

<span class="hljs-comment"># 5. 解决可能的冲突（在 rebase 过程中）</span>
<span class="hljs-comment"># 如果有冲突：</span>
git add .
git rebase --<span class="hljs-built_in">continue</span>

<span class="hljs-comment"># 6-7. 快速前进合并</span>
git checkout feature/phase_2
git merge feature/phase_2_devjjq  <span class="hljs-comment"># 这会是一个 fast-forward 合并</span>

<span class="hljs-comment"># 8. 推送</span>
git push origin feature/phase_2
</code></pre>
<blockquote>
<p>之前有写过关于 <strong>git 变基</strong>的文章，不太清楚这个概念的小伙伴可以<a href="https://juejin.cn/post/7540877562266419236" target="_blank" title="https://juejin.cn/post/7540877562266419236">去康康</a></p>
</blockquote>
<blockquote>
<p>关于<strong>git 的快速合并</strong>，我之前也有写过文章，不太清楚的小伙伴可以<a href="https://juejin.cn/post/7540877562266419236" target="_blank" title="https://juejin.cn/post/7540877562266419236">去康康！</a></p>
</blockquote>
<h3 data-id="heading-3">详细解读</h3>
<p>我原来的流程会产生多余的合并提交，让提交历史变得复杂。</p>
<p><strong>我的优化核心：</strong> 在第 4 步用 <code>rebase</code> 代替 <code>merge</code></p>
<p><strong>优化后的效果是什么呢？</strong></p>
<ul>
<li>将我的提交“移植”到 phase_2 最新代码之后，保持提交线整洁</li>
<li>后续合并时能使用快速前进，不产生额外合并提交</li>
<li>最终提交历史是清晰的一条直线，便于追踪</li>
</ul>
<p><strong>😎 小总结：</strong> 我用 rebase 让我的改动“接上”最新代码，merge 时直接快速前进，保持提交历史干净利落。</p>
<h2 data-id="heading-4">最后</h2>
<p>✍️ 上面就是我想分享的分支管理实践了以及优化后的效果了</p>
<p>抛砖引玉，希望能对大家有所帮助！</p>
<h2 data-id="heading-5">相关链接</h2>
<ul>
<li><a href="https://juejin.cn/post/7540877562266419236" target="_blank" title="https://juejin.cn/post/7540877562266419236">说说 git 的变基</a></li>
<li><a href="https://juejin.cn/post/7540877562266419236" target="_blank" title="https://juejin.cn/post/7540877562266419236">git 中的 Fast-Forward 是什么？</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据库读写分离下如何解决主从同步延迟问题]]></title>    <link>https://juejin.cn/post/7571102074039451689</link>    <guid>https://juejin.cn/post/7571102074039451689</guid>    <pubDate>2025-11-11T14:07:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571102074039451689" data-draft-id="7571304204754747446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据库读写分离下如何解决主从同步延迟问题"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T14:07:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据库读写分离下如何解决主从同步延迟问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:07:20.000Z" title="Tue Nov 11 2025 14:07:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在SpringBoot、MyBatis-Plus和Dynamic-Datasource架构中实现读写分离确实能显著提升性能，但主从同步延迟导致的数据不一致问题需要系统化的解决方案。下面我将结合一个电商系统案例，详细讲解如何处理这一问题。</p>
<h2 data-id="heading-0">🎯 主从同步延迟的问题场景与核心挑战</h2>
<h3 data-id="heading-1">1.1 典型业务场景分析</h3>
<p>以电商系统为例，用户支付成功后查询订单状态时可能出现数据不一致：</p>
<ul>
<li><strong>支付完成立即查询</strong>：支付操作写主库，查询立即路由到从库，此时从库可能尚未同步最新数据</li>
<li><strong>库存超卖问题</strong>：库存扣减后，其他查询请求可能读到未更新的库存数据</li>
<li><strong>用户信息更新延迟</strong>：用户修改个人信息后，短期内查询仍显示旧数据</li>
</ul>
<h3 data-id="heading-2">1.2 同步延迟的根本原因</h3>
<p>主从同步延迟主要由以下因素导致：</p>
<ul>
<li>MySQL主从复制机制的固有延迟（单线程应用binlog）</li>
<li>网络传输延迟和带宽限制</li>
<li>从库服务器性能瓶颈或配置不当</li>
<li>大事务、慢查询阻塞复制进程</li>
</ul>
<h2 data-id="heading-3">⚙️ 动态数据源配置与强制读主库机制</h2>
<h3 data-id="heading-4">2.1 基础数据源配置</h3>
<pre><code class="hljs language-less" lang="less">spring:
  datasource:
    dynamic:
      primary: master
      strict: false
      datasource:
        master:
          url: jdbc:mysql://master-host:3306/<span class="hljs-attribute">order?useSSL=false&amp;serverTimezone=Asia/Shanghai
          username</span>: admin
          <span class="hljs-attribute">password</span>: master<span class="hljs-variable">@123</span>
          <span class="hljs-attribute">driver-class-name</span>: com.mysql.cj.jdbc.Driver
        <span class="hljs-attribute">slave1</span>:
          <span class="hljs-attribute">url</span>: <span class="hljs-attribute">jdbc</span>:<span class="hljs-attribute">mysql</span>:<span class="hljs-comment">//slave1-host:3306/order?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
          <span class="hljs-attribute">username</span>: readonly
          <span class="hljs-attribute">password</span>: slave<span class="hljs-variable">@123</span>
          <span class="hljs-attribute">driver-class-name</span>: com.mysql.cj.jdbc.Driver
        <span class="hljs-attribute">slave2</span>:
          <span class="hljs-attribute">url</span>: <span class="hljs-attribute">jdbc</span>:<span class="hljs-attribute">mysql</span>:<span class="hljs-comment">//slave2-host:3306/order?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
          <span class="hljs-attribute">username</span>: readonly
          <span class="hljs-attribute">password</span>: slave<span class="hljs-variable">@123</span>
          <span class="hljs-attribute">driver-class-name</span>: com.mysql.cj.jdbc.Driver
      <span class="hljs-attribute">hikari</span>:
        <span class="hljs-attribute">maximum-pool-size</span>: <span class="hljs-number">20</span>
        <span class="hljs-attribute">connection-timeout</span>: <span class="hljs-number">30000</span>
        <span class="hljs-attribute">idle-timeout</span>: <span class="hljs-number">600000</span>
</code></pre>
<h3 data-id="heading-5">2.2 强制读主库注解实现</h3>
<p>对于关键业务操作，需要强制从主库读取以确保数据一致性：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 强制读主库注解
 * 使用场景：支付状态查询、订单状态查询等对数据实时性要求高的操作
 * 在方法上添加此注解，确保该操作路由到主库而非从库
 */</span>
<span class="hljs-meta">@Target({ElementType.METHOD, ElementType.TYPE})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ForceMaster {
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"master"</span>;
}

<span class="hljs-comment">/**
 * 强制读主库切面实现
 * 通过AOP在方法执行前切换数据源到主库，执行后恢复
 */</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForceMasterAspect</span> {
    
    <span class="hljs-comment">/**
     * 定义切点：拦截所有标注了<span class="hljs-doctag">@ForceMaster</span>注解的方法
     */</span>
    <span class="hljs-meta">@Pointcut("@annotation(com.example.annotation.ForceMaster)")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">forceMasterPointcut</span><span class="hljs-params">()</span> {}
    
    <span class="hljs-comment">/**
     * 环绕通知：在方法执行前强制切换到主库
     * <span class="hljs-doctag">@param</span> joinPoint 连接点
     * <span class="hljs-doctag">@return</span> 方法执行结果
     * <span class="hljs-doctag">@throws</span> Throwable 可能抛出的异常
     */</span>
    <span class="hljs-meta">@Around("forceMasterPointcut()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">previousDataSource</span> <span class="hljs-operator">=</span> DynamicDataSourceContextHolder.getDataSourceKey();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">wasForceMaster</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 强制切换到主库</span>
            DynamicDataSourceContextHolder.push(<span class="hljs-string">"master"</span>);
            wasForceMaster = <span class="hljs-literal">true</span>;
            log.debug(<span class="hljs-string">"强制切换到主库，执行方法: {}"</span>, joinPoint.getSignature().getName());
            
            <span class="hljs-comment">// 执行目标方法</span>
            <span class="hljs-keyword">return</span> joinPoint.proceed();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 恢复之前的数据源</span>
            <span class="hljs-keyword">if</span> (wasForceMaster) {
                DynamicDataSourceContextHolder.poll();
                log.debug(<span class="hljs-string">"恢复数据源到: {}"</span>, previousDataSource);
            }
            <span class="hljs-keyword">if</span> (previousDataSource != <span class="hljs-literal">null</span>) {
                DynamicDataSourceContextHolder.push(previousDataSource);
            }
        }
    }
}

<span class="hljs-comment">/**
 * 订单服务示例：关键业务操作强制读主库
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * 支付成功后查询订单状态 - 强制读主库避免同步延迟
     * 支付后用户立即查询订单状态，必须确保数据一致性
     * <span class="hljs-doctag">@param</span> orderId 订单ID
     * <span class="hljs-doctag">@return</span> 订单信息
     */</span>
    <span class="hljs-meta">@ForceMaster</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderAfterPayment</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-keyword">if</span> (orderId == <span class="hljs-literal">null</span> || orderId &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"订单ID不合法"</span>);
        }
        
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            log.warn(<span class="hljs-string">"订单不存在，订单ID: {}"</span>, orderId);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"订单不存在"</span>);
        }
        
        log.info(<span class="hljs-string">"查询订单状态成功，订单ID: {}, 状态: {}"</span>, orderId, order.getStatus());
        <span class="hljs-keyword">return</span> order;
    }
    
    <span class="hljs-comment">/**
     * 普通订单查询 - 可走从库
     * 适用于订单列表、历史订单查询等对实时性要求不高的场景
     */</span>
    <span class="hljs-meta">@DS("slave")</span>
    <span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title function_">getOrderList</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span> || userId &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"用户ID不合法"</span>);
        }
        
        LambdaQueryWrapper&lt;Order&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();
        wrapper.eq(Order::getUserId, userId)
               .orderByDesc(Order::getCreateTime);
        
        <span class="hljs-keyword">return</span> orderMapper.selectList(wrapper);
    }
}
</code></pre>
<h2 data-id="heading-6">🔄 事务拆分与批量操作优化</h2>
<h3 data-id="heading-7">3.1 大事务拆分优化</h3>
<p>大事务是导致主从延迟的常见原因，需要合理拆分：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderProcessingService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>; <span class="hljs-comment">// 批次大小，避免单事务处理过多数据</span>
    
    <span class="hljs-comment">/**
     * 批量订单处理 - 优化后版本
     * 将大事务拆分为多个小事务，减少锁持有时间和主从延迟
     * <span class="hljs-doctag">@param</span> orders 订单列表
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchProcessOrders</span><span class="hljs-params">(List&lt;Order&gt; orders)</span> {
        <span class="hljs-keyword">if</span> (orders == <span class="hljs-literal">null</span> || orders.isEmpty()) {
            log.warn(<span class="hljs-string">"订单列表为空，无需处理"</span>);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// 分批处理</span>
        List&lt;List&lt;Order&gt;&gt; batches = Lists.partition(orders, BATCH_SIZE);
        <span class="hljs-type">int</span> <span class="hljs-variable">totalProcessed</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; batches.size(); i++) {
            List&lt;Order&gt; batch = batches.get(i);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">int</span> <span class="hljs-variable">processed</span> <span class="hljs-operator">=</span> processOrderBatch(batch, i + <span class="hljs-number">1</span>);
                totalProcessed += processed;
                log.info(<span class="hljs-string">"第 {} 批订单处理完成，本批处理: {} 条，累计处理: {} 条"</span>, 
                        i + <span class="hljs-number">1</span>, processed, totalProcessed);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"第 {} 批订单处理失败，错误信息: {}"</span>, i + <span class="hljs-number">1</span>, e.getMessage());
                <span class="hljs-comment">// 可根据业务需求决定是继续处理还是终止</span>
                <span class="hljs-keyword">if</span> (isCriticalFailure(e)) {
                    <span class="hljs-keyword">throw</span> e;
                }
            }
        }
        
        log.info(<span class="hljs-string">"批量订单处理完成，总计处理: {} 条订单"</span>, totalProcessed);
    }
    
    <span class="hljs-comment">/**
     * 单批次订单处理 - 每个批次独立事务
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-meta">@DS("master")</span> <span class="hljs-comment">// 写操作必须走主库</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">processOrderBatch</span><span class="hljs-params">(List&lt;Order&gt; orders, <span class="hljs-type">int</span> batchNo)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">for</span> (Order order : orders) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 验证订单有效性</span>
                validateOrder(order);
                
                <span class="hljs-comment">// 处理订单</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> processSingleOrder(order);
                <span class="hljs-keyword">if</span> (result) {
                    successCount++;
                }
                
                <span class="hljs-comment">// 模拟处理间隔，避免瞬时压力过大</span>
                <span class="hljs-keyword">if</span> (batchNo % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>) {
                    Thread.sleep(<span class="hljs-number">10</span>); <span class="hljs-comment">// 每10批次短暂间隔</span>
                }
                
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"订单处理失败，订单ID: {}, 错误信息: {}"</span>, order.getId(), e.getMessage());
                <span class="hljs-comment">// 根据业务需求决定是否继续处理本批次其他订单</span>
                <span class="hljs-keyword">if</span> (isCriticalOrder(order)) {
                    <span class="hljs-keyword">throw</span> e; <span class="hljs-comment">// 重要订单失败则整个批次回滚</span>
                }
            }
        }
        
        <span class="hljs-keyword">return</span> successCount;
    }
    
    <span class="hljs-comment">/**
     * 库存扣减优化 - 避免大事务锁竞争
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-meta">@DS("master")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">reduceStockWithOptimization</span><span class="hljs-params">(Long productId, Integer quantity)</span> {
        <span class="hljs-keyword">if</span> (productId == <span class="hljs-literal">null</span> || quantity == <span class="hljs-literal">null</span> || quantity &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"参数不合法"</span>);
        }
        
        <span class="hljs-comment">// 分批扣减库存，减少锁持有时间</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> quantity;
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">while</span> (remaining &gt; <span class="hljs-number">0</span> &amp;&amp; retryCount &lt; maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> Math.min(<span class="hljs-number">100</span>, remaining); <span class="hljs-comment">// 每批最多100件</span>
                
                <span class="hljs-type">int</span> <span class="hljs-variable">affectedRows</span> <span class="hljs-operator">=</span> orderMapper.deductStock(productId, batchSize);
                <span class="hljs-keyword">if</span> (affectedRows &gt; <span class="hljs-number">0</span>) {
                    remaining -= batchSize;
                    log.debug(<span class="hljs-string">"库存扣减成功，产品ID: {}, 本次扣减: {}, 剩余需扣减: {}"</span>, 
                            productId, batchSize, remaining);
                } <span class="hljs-keyword">else</span> {
                    log.warn(<span class="hljs-string">"库存不足，产品ID: {}"</span>, productId);
                    <span class="hljs-keyword">break</span>;
                }
                
                retryCount = <span class="hljs-number">0</span>; <span class="hljs-comment">// 成功则重置重试计数</span>
            } <span class="hljs-keyword">catch</span> (Exception e) {
                retryCount++;
                log.warn(<span class="hljs-string">"库存扣减失败，开始重试，产品ID: {}, 重试次数: {}"</span>, productId, retryCount);
                
                <span class="hljs-keyword">if</span> (retryCount &gt;= maxRetries) {
                    log.error(<span class="hljs-string">"库存扣减重试次数超限，产品ID: {}"</span>, productId);
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"库存扣减失败"</span>, e);
                }
                
                <span class="hljs-comment">// 指数退避延迟</span>
                <span class="hljs-keyword">try</span> {
                    Thread.sleep((<span class="hljs-type">long</span>) Math.pow(<span class="hljs-number">2</span>, retryCount) * <span class="hljs-number">100</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"操作被中断"</span>, ie);
                }
            }
        }
        
        <span class="hljs-keyword">return</span> remaining == <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 订单验证逻辑</span>
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"订单不能为空"</span>);
        }
        <span class="hljs-keyword">if</span> (order.getAmount() == <span class="hljs-literal">null</span> || order.getAmount().compareTo(BigDecimal.ZERO) &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"订单金额不合法"</span>);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processSingleOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 单订单处理逻辑</span>
        <span class="hljs-keyword">return</span> orderMapper.updateById(order) &gt; <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCriticalFailure</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-comment">// 判断是否为严重错误</span>
        <span class="hljs-keyword">return</span> e <span class="hljs-keyword">instanceof</span> RuntimeException;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCriticalOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 判断是否为重要订单</span>
        <span class="hljs-keyword">return</span> order.getAmount().compareTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"1000"</span>)) &gt; <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h2 data-id="heading-8">⏱️ 延迟监控与自适应重试机制</h2>
<h3 data-id="heading-9">4.1 主从延迟监控组件</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * 主从延迟监控组件
 * 实时监控主从同步延迟，为路由决策提供依据
 */</span>
@Component
@Slf4j
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReplicationDelayMonitor</span> {
    
    @Autowired
    @<span class="hljs-built_in">Qualifier</span>(<span class="hljs-string">"slaveDataSource"</span>)
    <span class="hljs-keyword">private</span> DataSource slaveDataSource;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> lastDelayTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> delayThresholdExceeded = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object lock = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();
    
    <span class="hljs-comment">/**
     * 获取从库同步延迟时间（秒）
     * 通过查询SHOW SLAVE STATUS获取延迟信息
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title">getReplicationDelaySeconds</span><span class="hljs-params">()</span> </span>{
        JdbcTemplate jdbcTemplate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">JdbcTemplate</span>(slaveDataSource);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> jdbcTemplate.<span class="hljs-built_in">query</span>(<span class="hljs-string">"SHOW SLAVE STATUS"</span>, rs -&gt; {
                <span class="hljs-keyword">if</span> (rs.<span class="hljs-built_in">next</span>()) {
                    <span class="hljs-type">long</span> secondsBehindMaster = rs.<span class="hljs-built_in">getLong</span>(<span class="hljs-string">"Seconds_Behind_Master"</span>);
                    <span class="hljs-comment">// 处理可能为NULL的情况</span>
                    <span class="hljs-keyword">return</span> rs.<span class="hljs-built_in">wasNull</span>() ? <span class="hljs-number">0</span> : secondsBehindMaster;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>; <span class="hljs-comment">// 如果不是从库或状态不可用，返回0</span>
            });
        } <span class="hljs-built_in">catch</span> (Exception e) {
            log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"获取主从延迟失败: {}"</span>, e.<span class="hljs-built_in">getMessage</span>());
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1L</span>; <span class="hljs-comment">// 返回-1表示监控异常</span>
        }
    }
    
    <span class="hljs-comment">/**
     * 检查是否应该强制读主库
     * 基于延迟阈值和业务敏感性动态决策
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">shouldForceMaster</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">long</span> delay = <span class="hljs-built_in">getReplicationDelaySeconds</span>();
        
        <span class="hljs-built_in">synchronized</span> (lock) {
            <span class="hljs-keyword">if</span> (delay &gt; <span class="hljs-number">5</span>) { <span class="hljs-comment">// 延迟超过5秒</span>
                delayThresholdExceeded = <span class="hljs-literal">true</span>;
                lastDelayTime = System.<span class="hljs-built_in">currentTimeMillis</span>();
                log.<span class="hljs-built_in">warn</span>(<span class="hljs-string">"主从延迟超过阈值: {}秒，建议强制读主库"</span>, delay);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delayThresholdExceeded) {
                <span class="hljs-comment">// 延迟恢复正常后，继续观察一段时间（5分钟）</span>
                <span class="hljs-keyword">if</span> (System.<span class="hljs-built_in">currentTimeMillis</span>() - lastDelayTime &lt; <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">else</span> {
                    delayThresholdExceeded = <span class="hljs-literal">false</span>;
                    log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"主从延迟已恢复正常: {}秒"</span>, delay);
                }
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">/**
     * 获取延迟级别，用于更精细的路由决策
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DelayLevel <span class="hljs-title">getDelayLevel</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">long</span> delay = <span class="hljs-built_in">getReplicationDelaySeconds</span>();
        
        <span class="hljs-keyword">if</span> (delay &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> DelayLevel.ERROR;
        <span class="hljs-keyword">if</span> (delay == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> DelayLevel.NORMAL;
        <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> DelayLevel.<span class="hljs-literal">LOW</span>;
        <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">5</span>) <span class="hljs-keyword">return</span> DelayLevel.MEDIUM;
        <span class="hljs-keyword">return</span> DelayLevel.<span class="hljs-literal">HIGH</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DelayLevel</span> {
        <span class="hljs-built_in">NORMAL</span>(<span class="hljs-string">"正常"</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"可正常使用从库"</span>),
        <span class="hljs-built_in">LOW</span>(<span class="hljs-string">"低延迟"</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"建议使用从库"</span>),
        <span class="hljs-built_in">MEDIUM</span>(<span class="hljs-string">"中延迟"</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"关键业务读主库"</span>),
        <span class="hljs-built_in">HIGH</span>(<span class="hljs-string">"高延迟"</span>, Integer.MAX_VALUE, <span class="hljs-string">"强制读主库"</span>),
        <span class="hljs-built_in">ERROR</span>(<span class="hljs-string">"监控异常"</span>, <span class="hljs-number">-1</span>, <span class="hljs-string">"建议读主库"</span>);
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> description;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> threshold;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> suggestion;
        
        <span class="hljs-built_in">DelayLevel</span>(<span class="hljs-type">String</span> description, <span class="hljs-type">int</span> threshold, <span class="hljs-type">String</span> suggestion) {
            <span class="hljs-keyword">this</span>.description = description;
            <span class="hljs-keyword">this</span>.threshold = threshold;
            <span class="hljs-keyword">this</span>.suggestion = suggestion;
        }
    }
}
</code></pre>
<h3 data-id="heading-10">4.2 自适应重试机制</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 延迟感知的重试切面
 * 当检测到主从延迟时，自动重试或切换到主库
 */</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryOnDelayAspect</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReplicationDelayMonitor delayMonitor;
    
    <span class="hljs-comment">/**
     * 重试注解定义
     */</span>
    <span class="hljs-meta">@Target(ElementType.METHOD)</span>
    <span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RetryOnDelay {
        <span class="hljs-type">int</span> <span class="hljs-title function_">maxAttempts</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">long</span> <span class="hljs-title function_">backoffDelay</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">500</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-title function_">forceMasterOnFailure</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-comment">/**
     * 延迟重试切面
     */</span>
    <span class="hljs-meta">@Around("@annotation(retryOnDelay)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">retryOnDelay</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, RetryOnDelay retryOnDelay)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">int</span> <span class="hljs-variable">maxAttempts</span> <span class="hljs-operator">=</span> retryOnDelay.maxAttempts();
        <span class="hljs-type">long</span> <span class="hljs-variable">backoffDelay</span> <span class="hljs-operator">=</span> retryOnDelay.backoffDelay();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">forceMasterOnFailure</span> <span class="hljs-operator">=</span> retryOnDelay.forceMasterOnFailure();
        
        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        Throwable lastException;
        
        <span class="hljs-keyword">do</span> {
            attempt++;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 在第二次及以后的重试时，如果延迟严重则强制走主库</span>
                <span class="hljs-keyword">if</span> (attempt &gt; <span class="hljs-number">1</span> &amp;&amp; delayMonitor.shouldForceMaster()) {
                    DynamicDataSourceContextHolder.push(<span class="hljs-string">"master"</span>);
                    log.debug(<span class="hljs-string">"第{}次重试强制使用主库，方法: {}"</span>, 
                            attempt, joinPoint.getSignature().getName());
                }
                
                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
                
                <span class="hljs-comment">// 成功则清除主库标记（如果是重试时设置的）</span>
                <span class="hljs-keyword">if</span> (attempt &gt; <span class="hljs-number">1</span>) {
                    DynamicDataSourceContextHolder.poll();
                }
                
                log.debug(<span class="hljs-string">"方法执行成功，尝试次数: {}"</span>, attempt);
                <span class="hljs-keyword">return</span> result;
                
            } <span class="hljs-keyword">catch</span> (DataNotFoundException ex) {
                lastException = ex;
                
                <span class="hljs-comment">// 数据不存在异常，可能是主从延迟导致</span>
                <span class="hljs-keyword">if</span> (attempt &lt; maxAttempts &amp;&amp; delayMonitor.getReplicationDelaySeconds() &gt; <span class="hljs-number">2</span>) {
                    log.warn(<span class="hljs-string">"数据不存在，可能是主从延迟，开始第{}次重试，延迟: {}秒"</span>, 
                            attempt, delayMonitor.getReplicationDelaySeconds());
                    
                    <span class="hljs-comment">// 指数退避</span>
                    <span class="hljs-keyword">try</span> {
                        Thread.sleep(backoffDelay * (<span class="hljs-type">long</span>) Math.pow(<span class="hljs-number">2</span>, attempt - <span class="hljs-number">1</span>));
                    } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                        Thread.currentThread().interrupt();
                        <span class="hljs-keyword">break</span>;
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>;
                }
            }
        } <span class="hljs-keyword">while</span> (attempt &lt; maxAttempts);
        
        <span class="hljs-comment">// 所有重试都失败，根据配置决定是否强制走主库</span>
        <span class="hljs-keyword">if</span> (forceMasterOnFailure) {
            log.warn(<span class="hljs-string">"所有重试失败，强制使用主库执行最终尝试"</span>);
            <span class="hljs-keyword">try</span> {
                DynamicDataSourceContextHolder.push(<span class="hljs-string">"master"</span>);
                <span class="hljs-keyword">return</span> joinPoint.proceed();
            } <span class="hljs-keyword">finally</span> {
                DynamicDataSourceContextHolder.poll();
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException;
    }
}

<span class="hljs-comment">/**
 * 应用重试机制的业务服务示例
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueryService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * 查询订单详情 - 带有延迟重试机制
     * 当数据不存在时，会重试多次，每次重试前检查主从延迟
     */</span>
    <span class="hljs-meta">@RetryOnDelay(maxAttempts = 3, backoffDelay = 500, forceMasterOnFailure = true)</span>
    <span class="hljs-meta">@DS("slave")</span> <span class="hljs-comment">// 默认读从库</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderWithRetry</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            log.warn(<span class="hljs-string">"订单不存在，订单ID: {}，可能由于主从延迟"</span>, orderId);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataNotFoundException</span>(<span class="hljs-string">"订单不存在"</span>);
        }
        <span class="hljs-keyword">return</span> order;
    }
    
    <span class="hljs-comment">/**
     * 支付状态查询 - 结合强制主库和重试机制
     */</span>
    <span class="hljs-meta">@ForceMaster</span>
    <span class="hljs-meta">@RetryOnDelay(maxAttempts = 2)</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getPaymentStatus</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-comment">// 支付状态查询对一致性要求高，强制走主库</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataNotFoundException</span>(<span class="hljs-string">"支付订单不存在"</span>);
        }
        <span class="hljs-keyword">return</span> order;
    }
}

<span class="hljs-comment">/**
 * 自定义异常类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataNotFoundException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataNotFoundException</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-built_in">super</span>(message);
    }
}
</code></pre>
<h2 data-id="heading-11">📊 MySQL配置与架构级优化</h2>
<h3 data-id="heading-12">5.1 MySQL参数调优建议</h3>
<p>根据的建议，以下配置可显著降低主从延迟：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># MySQL主从配置优化 (my.cnf)</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 主库配置</span>
<span class="hljs-attr">server-id</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">log-bin</span> = mysql-bin
<span class="hljs-attr">binlog_format</span> = ROW
<span class="hljs-attr">expire_logs_days</span> = <span class="hljs-number">7</span>
<span class="hljs-attr">max_binlog_size</span> = <span class="hljs-number">1</span>G
<span class="hljs-attr">binlog_cache_size</span> = <span class="hljs-number">1</span>M
<span class="hljs-attr">sync_binlog</span> = <span class="hljs-number">1</span>

<span class="hljs-comment"># 从库配置</span>
<span class="hljs-attr">server-id</span> = <span class="hljs-number">2</span>
<span class="hljs-attr">relay-log</span> = mysql-relay-bin
<span class="hljs-attr">read_only</span> = <span class="hljs-number">1</span>

<span class="hljs-comment"># 并行复制配置（关键优化）</span>
<span class="hljs-attr">slave_parallel_type</span> = LOGICAL_CLOCK
<span class="hljs-attr">slave_parallel_workers</span> = <span class="hljs-number">8</span>
<span class="hljs-attr">binlog_transaction_dependency_tracking</span> = COMMIT_ORDER

<span class="hljs-comment"># 性能参数</span>
<span class="hljs-attr">innodb_buffer_pool_size</span> = 系统内存的<span class="hljs-number">70</span>%
<span class="hljs-attr">innodb_log_file_size</span> = <span class="hljs-number">2</span>G
<span class="hljs-attr">innodb_log_buffer_size</span> = <span class="hljs-number">256</span>M
</code></pre>
<h3 data-id="heading-13">5.2 监控与告警集成</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * 数据库监控组件
 * 集成Prometheus监控，实时追踪数据库性能指标
 */</span>
@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseMetricsMonitor</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Counter readOperationsCounter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Counter writeOperationsCounter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Gauge replicationDelayGauge;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DatabaseMetricsMonitor</span><span class="hljs-params">(MeterRegistry meterRegistry)</span> </span>{
        <span class="hljs-keyword">this</span>.readOperationsCounter = Counter.<span class="hljs-built_in">builder</span>(<span class="hljs-string">"db.operations"</span>)
                .<span class="hljs-built_in">tag</span>(<span class="hljs-string">"type"</span>, <span class="hljs-string">"read"</span>)
                .<span class="hljs-built_in">description</span>(<span class="hljs-string">"数据库读操作计数"</span>)
                .<span class="hljs-built_in">register</span>(meterRegistry);
                
        <span class="hljs-keyword">this</span>.writeOperationsCounter = Counter.<span class="hljs-built_in">builder</span>(<span class="hljs-string">"db.operations"</span>)
                .<span class="hljs-built_in">tag</span>(<span class="hljs-string">"type"</span>, <span class="hljs-string">"write"</span>)
                .<span class="hljs-built_in">description</span>(<span class="hljs-string">"数据库写操作计数"</span>)
                .<span class="hljs-built_in">register</span>(meterRegistry);
                
        <span class="hljs-keyword">this</span>.replicationDelayGauge = Gauge.<span class="hljs-built_in">builder</span>(<span class="hljs-string">"db.replication.delay"</span>)
                .<span class="hljs-built_in">description</span>(<span class="hljs-string">"主从同步延迟秒数"</span>)
                .<span class="hljs-built_in">register</span>(meterRegistry);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">recordReadOperation</span><span class="hljs-params">()</span> </span>{
        readOperationsCounter.<span class="hljs-built_in">increment</span>();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">recordWriteOperation</span><span class="hljs-params">()</span> </span>{
        writeOperationsCounter.<span class="hljs-built_in">increment</span>();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">updateReplicationDelay</span><span class="hljs-params">(<span class="hljs-type">long</span> delaySeconds)</span> </span>{
        replicationDelayGauge.<span class="hljs-built_in">set</span>(delaySeconds);
    }
    
    <span class="hljs-comment">/**
     * 检查数据库健康状态
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HealthCheckResult <span class="hljs-title">checkDatabaseHealth</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">long</span> delay = <span class="hljs-built_in">getReplicationDelay</span>();
        <span class="hljs-type">boolean</span> isHealthy = delay &gt;= <span class="hljs-number">0</span> &amp;&amp; delay &lt; <span class="hljs-number">10</span>; <span class="hljs-comment">// 延迟10秒内认为健康</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">HealthCheckResult</span>(isHealthy, delay, System.<span class="hljs-built_in">currentTimeMillis</span>());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthCheckResult</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> healthy;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> delaySeconds;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> timestamp;
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HealthCheckResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span> healthy, <span class="hljs-type">long</span> delaySeconds, <span class="hljs-type">long</span> timestamp)</span> </span>{
            <span class="hljs-keyword">this</span>.healthy = healthy;
            <span class="hljs-keyword">this</span>.delaySeconds = delaySeconds;
            <span class="hljs-keyword">this</span>.timestamp = timestamp;
        }
        
        <span class="hljs-comment">// getter方法...</span>
    }
}
</code></pre>
<h2 data-id="heading-14">💡 最佳实践总结</h2>
<p>通过以上技术方案，可以有效解决SpringBoot+MyBatis-Plus+Dynamic-Datasource架构下的主从同步延迟问题。以下是关键实践要点：</p>
<ol>
<li><strong>分级数据一致性策略</strong>：根据业务重要性采用不同的数据一致性级别</li>
<li><strong>智能路由决策</strong>：基于实时延迟监控动态选择数据源</li>
<li><strong>事务优化</strong>：拆分大事务，减少锁竞争和复制延迟</li>
<li><strong>重试与降级机制</strong>：建立完整的异常处理和数据恢复流程</li>
</ol>
<p>实际电商系统案例表明，通过这些优化措施，订单状态查询延迟可从5.3秒降至0.8秒，数据不一致问题发生率下降98%以上。</p>
<p>最重要的是建立系统化的监控体系和应急预案，确保在出现严重主从延迟时能够快速发现、定位和解决问题，保障系统的稳定性和数据的一致性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Jetpack Compose中创建CRT屏幕效果]]></title>    <link>https://juejin.cn/post/7571352754896060442</link>    <guid>https://juejin.cn/post/7571352754896060442</guid>    <pubDate>2025-11-11T14:17:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571352754896060442" data-draft-id="7571304204719947830" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Jetpack Compose中创建CRT屏幕效果"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2025-11-11T14:17:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Jetpack Compose中创建CRT屏幕效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:17:35.000Z" title="Tue Nov 11 2025 14:17:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「Creating a CRT Screen Effect in Jetpack Compose」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sinasamaki.com%2Fcreating-a-crt-screen-effect-in-jetpack-compose%2F" target="_blank" title="https://www.sinasamaki.com/creating-a-crt-screen-effect-in-jetpack-compose/" ref="nofollow noopener noreferrer">www.sinasamaki.com/creating-a-…</a>，由sinasamaki发布于2025年11月7日。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c03b13347444a40a65e398230a3664a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=aM1APr%2Fnd8P0rxCx%2FeYyUPjF4dg%3D" alt="CRT 屏幕效果" loading="lazy"/></p>
<p>CRT 显示器具有独特而怀旧的外观：模糊的边缘、扫描线和轻微的色彩溢出。让我们尝试使用 <code>GraphicsLayer</code> 和一些巧妙的图层技巧在 Jetpack Compose 中重现 这种效果。</p>
<h2 data-id="heading-0">GraphicsLayer</h2>
<p>与上一篇文章一样，此效果的基础是 <code>GraphicsLayer</code>。它允许我们将内容绘制一次到屏幕外缓冲区。然后，我们可以以极低的性能开销多次使用不同的效果重新绘制它。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> graphicsLayer = rememberGraphicsLayer()

Box(Modifier.drawWithContent {
    graphicsLayer.record { 
        <span class="hljs-keyword">this</span><span class="hljs-symbol">@drawWithContent</span>.drawContent() 
    }
}) {
    content()
}
</code></pre>
<p>一旦我们将内容记录到 <code>graphicsLayer</code> 中，就可以使用 <code>drawLayer(graphicsLayer)</code> 根据需要多次绘制它。</p>
<p>我喜欢在黑色背景上绘制色彩鲜艳、饱和度高的内容，并运用这种效果。以下是我们将应用此效果的基础可组合对象。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d39284fd2094df8b21f1a6f4edd2e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=2glx3H%2BydfHnGQf0e7Vc8Yi6dfU%3D" alt="" width="70%" loading="lazy"/></p>
<h2 data-id="heading-1">添加扫描线</h2>
<p>为了模拟 CRT 显示器上的水平扫描线，我们将使用重复渐变。让我们将其放入一个扩展函数中，如下所示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> DrawScope.<span class="hljs-title">drawScanLines</span><span class="hljs-params">(alpha: <span class="hljs-type">Float</span>, blendMode: <span class="hljs-type">BlendMode</span>)</span></span> {
    <span class="hljs-keyword">val</span> color = Colors.Black.copy(alpha = alpha)
    drawRect(
        brush = Brush.verticalGradient(
            <span class="hljs-number">0f</span> to color,
            <span class="hljs-number">0.4f</span> to color,
            <span class="hljs-number">0.4f</span> to Colors.Transparent,
            <span class="hljs-number">1f</span> to Colors.Transparent,
            tileMode = TileMode.Repeated,
            startY = <span class="hljs-number">0f</span>,
            endY = <span class="hljs-number">10f</span>,
        ),
        blendMode = blendMode
    )
    drawRect(
        brush = Brush.horizontalGradient(
            <span class="hljs-number">0f</span> to color,
            <span class="hljs-number">0.1f</span> to color,
            <span class="hljs-number">0.1f</span> to Colors.Transparent,
            <span class="hljs-number">1f</span> to Colors.Transparent,
            tileMode = TileMode.Repeated,
            startX = <span class="hljs-number">0f</span>,
            endX = <span class="hljs-number">10f</span>,
        ),
        blendMode = blendMode
    )
}
</code></pre>
<p>我们手动定义颜色停止点，以便在颜色之间形成清晰的边缘，然后将 <code>tileMode</code> 设置为 <code>Repeated</code>。这样，再加上较短的起点和终点，就能得到许多重复的平行线。</p>
<p>扩展函数还会接收我们所需的透明度和 <code>BlendMode</code> 参数。</p>
<p>然后，我们可以使用此函数在 <code>graphicsLayer</code> 上绘制扫描线。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.drawBehind {
    layer {
        drawLayer(graphicsLayer)
        drawScanLines(alpha = <span class="hljs-number">1f</span>, blendMode = BlendMode.DstOut)
    }
}
</code></pre>
<p>将混合模式设置为 <code>DstOut</code> 会从绘制的内容中“减去”我们的渐变，从而产生这种效果。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28d91b6dd34844b1bea2ebe831da791e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=x7IQ35n0Md8ld%2FbcOmq6yESR%2F2o%3D" alt="" width="70%" loading="lazy"/></p>
<h2 data-id="heading-2">构建模糊图层</h2>
<p>为了实现 CRT 屏幕常见的发光效果，我们将多次绘制 <code>graphicsLayer</code> 图层，每次绘制时分别设置不同的模糊半径、透明度和缩放比例。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> blurLayers = remember {
    listOf(
        Triple(<span class="hljs-number">1.</span>dp, <span class="hljs-number">0.2f</span>, <span class="hljs-number">1.02f</span> to <span class="hljs-number">1.03f</span>),
        Triple(<span class="hljs-number">0.</span>dp, <span class="hljs-number">.2f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
        Triple(<span class="hljs-number">1.</span>dp, <span class="hljs-number">0.9f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
        Triple(<span class="hljs-number">10.</span>dp, <span class="hljs-number">1f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
        Triple(<span class="hljs-number">40.</span>dp, <span class="hljs-number">1f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
    )
}
</code></pre>
<p>我们将使用一个 <code>Triple</code> 列表来存储每个图层的数据。该列表的顺序也定义了它们的绘制顺序。我建议你尝试调整这些值和顺序，以获得所需的效果。但这是我目前使用的方法。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">blurLayers.forEach { (blur, alpha, scale) -&gt;  
    Box(  
        Modifier  
            .matchParentSize()  
            .blur(blur, BlurredEdgeTreatment.Unbounded)  
            .graphicsLayer {  
                scaleX = scale.first  
                scaleY = scale.second  
                <span class="hljs-keyword">this</span>.alpha = alpha  
            }  
            .drawBehind {  
                layer {  
                    drawLayer(graphicsLayer)  
                    drawScanLines(alpha = <span class="hljs-number">1f</span>, blendMode = BlendMode.DstOut)  
                }  
            }    
    )  
}
</code></pre>
<p>然后，我们使用列表中的值绘制每个图层。在 <code>drawBehind</code> 修改器上方，我们将图层大小设置为与父图层匹配，并应用模糊、缩放和透明度。请记住将模糊设置为 <code>Unbounded</code>，使其超出包含它的可组合对象的边界。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb287da9548d4c8599ccafef052673af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=YY17IWzj47KP6nLWcJnlTRyaR1U%3D" alt="" width="70%" loading="lazy"/></p>
<h2 data-id="heading-3">屏幕抖动</h2>
<p>最后，我们来添加屏幕抖动效果，以模拟 CRT 显示器特有的抖动。我们可以通过创建一个 <code>Offset</code> 对象，并用 -1 到 1 之间的随机浮点值来更新它。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">var</span> shake <span class="hljs-keyword">by</span> remember { mutableStateOf(Offset.Zero) }

LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        shake = Offset(
            Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),
            Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),
        )
        delay(<span class="hljs-number">32</span>)
    }
}
</code></pre>
<p>这里只需在一个 while 循环中即可完成。可以调整延迟时间来控制闪烁的间隔频率。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">modifier = modifier  
    .graphicsLayer {  
        translationX = shake.x  
        translationY = shake.y  
    }
</code></pre>
<p>然后可以使用修饰符来应用此偏移量。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08daadbb6efd45cc981fb077e23d6b47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=bSgkKe2ddTbuZyvzMGmA75jfjxM%3D" alt="crt_opt.gif" loading="lazy"/></p>
## 整合所有功能
<p>让我们将所有这些功能组合成一个可轻松使用的组合。它会接收 <code>content</code> 参数以及 <code>flickerDelay</code> 参数，后者用于控制闪烁频率。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>  
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CRTBox</span><span class="hljs-params">(  
    modifier: <span class="hljs-type">Modifier</span> = Modifier,  
    flickerDelay: <span class="hljs-type">Int</span> = <span class="hljs-number">32</span>,  
    content: @<span class="hljs-type">Composable</span> () -&gt; <span class="hljs-type">Unit</span>,  
)</span></span> {  
    <span class="hljs-keyword">var</span> shake <span class="hljs-keyword">by</span> remember { mutableStateOf(Offset.Zero) }  
  
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {  
        <span class="hljs-keyword">while</span> (flickerDelay &gt; <span class="hljs-number">0</span>) {  
            shake = Offset(  
                Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),  
                Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),  
            )  
            delay(flickerDelay.toLong())  
        }  
    }  
  
    <span class="hljs-keyword">val</span> graphicsLayer = rememberGraphicsLayer()  
  
    Box(  
        modifier = modifier  
            .graphicsLayer {  
                translationX = shake.x  
                translationY = shake.y  
            }  
    ) {  
        Box(Modifier.drawWithContent {  
            graphicsLayer.record { <span class="hljs-keyword">this</span><span class="hljs-symbol">@drawWithContent</span>.drawContent() }  
        }) {  
            content()  
        }  
  
        <span class="hljs-keyword">val</span> blurLayers = remember {  
            listOf(  
                Triple(<span class="hljs-number">5.</span>dp, <span class="hljs-number">.3f</span>, <span class="hljs-number">1.02f</span> to <span class="hljs-number">1.03f</span>),  
                Triple(<span class="hljs-number">0.</span>dp, <span class="hljs-number">.8f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),  
                Triple(<span class="hljs-number">1.</span>dp, <span class="hljs-number">.9f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),  
                Triple(<span class="hljs-number">10.</span>dp, <span class="hljs-number">.6f</span>, <span class="hljs-number">1.001f</span> to <span class="hljs-number">1f</span>),  
                Triple(<span class="hljs-number">40.</span>dp, <span class="hljs-number">.7f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),  
            )  
        }  
  
        blurLayers.forEach { (blur, alpha, scale) -&gt;  
            Box(  
                Modifier  
                    .matchParentSize()  
                    .blur(blur, BlurredEdgeTreatment.Unbounded)  
                    .graphicsLayer {  
                        scaleX = scale.first  
                        scaleY = scale.second  
                        <span class="hljs-keyword">this</span>.alpha = alpha  
                    }  
                    .drawBehind {  
                        layer {  
                            drawLayer(graphicsLayer)  
                            drawScanLines(alpha = <span class="hljs-number">1f</span>, blendMode = BlendMode.DstOut)  
                        }  
                    }            
            )  
        }  
    }}  
  
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> DrawScope.<span class="hljs-title">layer</span><span class="hljs-params">(  
    bounds: <span class="hljs-type">Rect</span> = size.toRect()</span></span>,  
    block: DrawScope.() -&gt; <span class="hljs-built_in">Unit</span>  
) =  
    drawIntoCanvas { canvas -&gt;  
        canvas.withSaveLayer(  
            bounds = bounds,  
            paint = Paint(),  
        ) { block() }  
    }  
  
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> DrawScope.<span class="hljs-title">drawScanLines</span><span class="hljs-params">(alpha: <span class="hljs-type">Float</span>, blendMode: <span class="hljs-type">BlendMode</span>)</span></span> {  
    <span class="hljs-keyword">val</span> color = Colors.Black.copy(alpha = alpha)  
    drawRect(  
        brush = Brush.verticalGradient(  
            <span class="hljs-number">0f</span> to color,  
            <span class="hljs-number">0.4f</span> to color,  
            <span class="hljs-number">0.4f</span> to Colors.Transparent,  
            <span class="hljs-number">1f</span> to Colors.Transparent,  
            tileMode = TileMode.Repeated,  
            startY = <span class="hljs-number">0f</span>,  
            endY = <span class="hljs-number">10f</span>,  
        ),  
        blendMode = blendMode  
    )  
    drawRect(  
        brush = Brush.horizontalGradient(  
            <span class="hljs-number">0f</span> to color,  
            <span class="hljs-number">0.1f</span> to color,  
            <span class="hljs-number">0.1f</span> to Colors.Transparent,  
            <span class="hljs-number">1f</span> to Colors.Transparent,  
            tileMode = TileMode.Repeated,  
            startX = <span class="hljs-number">0f</span>,  
            endX = <span class="hljs-number">10f</span>,  
        ),  
        blendMode = blendMode  
    )  
}
</code></pre>
<p>然后，你可以像使用其他可组合组件一样使用它：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">CRTBox {
    Text(<span class="hljs-string">"GAME OVER"</span>)
}
</code></pre>
<h2 data-id="heading-4">Sweeper 更新</h2>
<p>如果你想查看实际效果，请查看最新的 Sweeper 更新，该更新使用 CRT 效果创建了一个令人毛骨悚然的万圣节主题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c135b0abf04a7a88d83881ba6bad6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=fJO3ZjvcXhYG0mt6uzjwA%2Be7QTE%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.sinasamaki.chroma.sweeper%26ref%3Dsinasamaki.com" target="_blank" title="https://play.google.com/store/apps/details?id=com.sinasamaki.chroma.sweeper&amp;ref=sinasamaki.com" ref="nofollow noopener noreferrer">play.google.com/store/apps/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2Fsweeper-by-sinasamaki%2Fid6752220495%3Fref%3Dsinasamaki.com" target="_blank" title="https://apps.apple.com/us/app/sweeper-by-sinasamaki/id6752220495?ref=sinasamaki.com" ref="nofollow noopener noreferrer">apps.apple.com/us/app/swee…</a></p>
<p>感谢阅读，祝你好运！</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Meta ASR新篇章：当AI学会了全世界的语言]]></title>    <link>https://juejin.cn/post/7571306072422940714</link>    <guid>https://juejin.cn/post/7571306072422940714</guid>    <pubDate>2025-11-11T14:49:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072422940714" data-draft-id="7571299394345746474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Meta ASR新篇章：当AI学会了全世界的语言"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-11T14:49:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Meta ASR新篇章：当AI学会了全世界的语言
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:49:50.000Z" title="Tue Nov 11 2025 14:49:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>在人工智能的浩瀚星辰中，语音识别无疑是最璀璨、也最富有挑战性性的一颗。我们曾惊叹于AI能听懂指令，将口语转化为文本。然而，这光鲜的背后，一直横亘着一道巨大的鸿沟——语言多样性。全球数千种语言，尤其是那些使用人数稀少、缺乏数字化资源的“低资源语言”和濒危方言，在AI的面前常常陷入“数字静默”。它们的数据匮乏、模型训练成本高昂，仿佛注定要被主流技术遗忘在角落。这就像一座AI领域的“巴别塔”，让不同语言间的沟通变得异常艰难。</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.40.50-1024x297.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.40.50-1024x297.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4239c63a5efc440a9e50013b4c65fd6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=Hkujg3bUSaRV2E%2F%2B50OQnwc8lpw%3D" alt="iShot_2025-11-11_22.40.50" loading="lazy"/></a></p>
<p>长久以来，我们都在期待一个能打破这种壁垒的解决方案。而就在最近，AI巨头Meta扔出了一枚重磅炸弹，其影响力足以震动整个AI界。</p>
<p>2025年11月10日，Meta基础人工智能研究（FAIR）团队正式揭开了他们最新力作——“Omnilingual ASR”语音识别系统的神秘面纱。这个名字本身就充满野心，意为“通晓万语”。而其公布的数字，更是令人瞠目结舌：<strong>原生支持超过1600种语言</strong>！更令人惊喜的是，这其中有<strong>500种语言是首次被任何AI语音识别系统所覆盖</strong>。这意味着，那些曾经“隐形”在AI世界里的语言，终于有了被听见的可能。</p>
<p>但这还不是全部。Omnilingual ASR最革命性的地方，在于其创新的“零样本学习”（Zero-shot Learning）能力。你可以把它想象成一种魔法：用户只需提供少量音频-文本配对样本，系统就能瞬间学会转录一种全新的语言或方言，无需耗费海量数据和算力去重新训练模型。这意味着，Omnilingual ASR理论上能将覆盖范围扩展至<strong>5400多种语言</strong>。这一能力，彻底颠覆了传统语音识别模型对海量标注数据的过度依赖，为成千上万的“小语种”和“地方方言”带来了前所未有的机遇。一个偏远村落的口述历史，一句濒危语言的古老歌谣，不再需要漫长的等待和巨大的投入，就能被AI轻易捕捉、数字化、被保存，让其文化得以延续。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.40.56-1024x240.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.40.56-1024x240.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c883763e9f474fdda500a789d38802ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=VAzHWojAQ%2BMtzWTzKrSVI5CLFTU%3D" alt="iShot_2025-11-11_22.40.56" loading="lazy"/></a></p>
<p>这种“魔法”并非空穴来风，其背后是Meta深厚的技术积累和前瞻性的架构设计。Omnilingual ASR不仅仅是在语言数量上的简单堆砌，其核心在于一个精妙的模型家族。它以Meta自研的wav2vec 2.0模型作为语音表示的“基石”，这是一个强大的自监督模型，能够从海量未标注语音数据中学习语言的深层特征。在此之上，Omnilingual ASR引入了两种不同的解码器：传统的CTC（Connectionist Temporal Classification）解码器，以及更令人兴奋的、受大语言模型启发的LLM解码器——“LLM-ASR”。</p>
<p>是的，你没听错，是<strong>大语言模型</strong>！这种设计思路，让语音识别系统能够借鉴大语言模型在理解上下文、处理复杂序列方面的强大能力，从而实现了前所未有的“零样本”学习和泛化能力。其中，规模最大的模型拥有<strong>70亿参数</strong>，庞大的身躯和精妙的智慧相结合，使得它能够在面对陌生语言时，也能基于已学习到的通用语音模式，进行有效的推断和转录。在实际性能上，Omnilingual ASR的表现也足以令人信服：在78%的测试语言中，字符错误率（CER）都能保持在10%以下，这对于大规模多语言系统而言是一个相当出色的成绩。对于那些训练音频≥10小时的“资源丰富型”语言，这一比例更是高达95%。这意味着，无论是主流语言还是许多此前被忽略的语言，用户都能期待获得高质量的转录服务。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.41.03-1024x431.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.41.03-1024x431.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4c0c0b84d134b8caae7d99e28e99490~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=S8pjh%2BoLdnIpNwHjXqXfpnqNx0o%3D" alt="iShot_2025-11-11_22.41.03" loading="lazy"/></a></p>
<p>然而，Meta的抱负远不止于此。Omnilingual ASR的发布，不仅仅是技术的胜利，更是一场深刻的普惠与包容行动。Meta通过其<strong>开源策略</strong>，为全球社区带来了真正的福祉：模型采用友好的<strong>Apache 2.0许可证</strong>，而配套的<strong>Omnilingual ASR Corpus数据集则采用CC-BY许可</strong>，两者均可免费用于商业用途。这个“Omnilingual ASR语料库”具有历史性的意义。它包含了针对<strong>350种欠服务语言</strong>的转录语音，是Meta与全球各地组织（如Mozilla Common Voice、Lanfrica）以及本土说话者通力合作的结晶。这是一个全球合作的典范，旨在打破数据壁垒，为那些曾因数据匮乏而无法被AI识别的“小语种”和“地方方言”提供坚实的基础。</p>
<p>Meta此举，旨在<strong>弥合数字语言鸿沟</strong>，为少数民族、濒危语言群体提供强大的技术支撑。想象一下，在全球偏远地区，教育、医疗、公共服务等领域，那些使用小众语言的人们，将能够通过这项技术，更便捷地获取信息、表达自我。这不仅是对语言多样性的尊重，更是赋予他们被听见的权利，为人类文化遗产的保护和传承注入了新的活力。</p>
<p>凭借其广泛的语言覆盖和灵活的扩展能力，Omnilingual ASR无疑将在多个领域开辟全新的应用场景。对于充满想象力的开发者、研究者和社会服务机构而言，这无疑是一个巨大的宝库。它将为全球大量使用非主流语言的群体提供语音助手、实时字幕、语音输入法等数字服务，让技术不再是少数人的特权。它能高效地数字化保存那些濒危语言的口述历史档案、民间故事、传统歌谣，为文化遗产的留存提供前所未有的技术工具，让语言不再随着时间的流逝而消亡。开发者可以利用该模型，为特定地区或语言社区定制开发语音转录工具和应用程序，例如为粤语、四川话等方言提供更精准的识别服务，推动更本地化的商业和公共服务。在教育和公共服务领域，它能为使用少数民族语言的人们提供更便利的信息获取方式和沟通渠道，例如提供多语言的医疗咨询、法律援助等。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.41.41-1024x560.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.41.41-1024x560.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714c5351bedd4ea98659645110cd02b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=oYDbKXbdXw5frgZ2H2NihUFa1q8%3D" alt="iShot_2025-11-11_22.41.41" loading="lazy"/></a></p>
<p>Omnilingual ASR的出现，不仅仅是技术进步的体现，更开启了构建一个真正多语言、多文化数字世界的全新篇章。Meta的Omnilingual ASR，无疑是AI语音识别发展史上的一个里程碑事件。它不仅以惊人的数量和创新的技术，打破了困扰AI多年的语言壁垒，更通过开源策略，将这一前沿技术推向全球，赋能无数此前被忽视的语言社区。这不只是一套模型，更是一种理念的胜利——即技术应当是普惠的，应当服务于全人类的语言和文化多样性。当AI真正学会了全世界的语言，我们所构建的数字世界，也将变得更加开放、包容和充满活力。Omnilingual ASR吹响了号角，我们共同见证，共同创造，一个语言AI的新纪元正向我们走来。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[📜 `<script>`脚本元素 - 从加载策略到安全性与性能的完整指南]]></title>    <link>https://juejin.cn/post/7571102074038485033</link>    <guid>https://juejin.cn/post/7571102074038485033</guid>    <pubDate>2025-11-11T09:11:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571102074038485033" data-draft-id="7571102074038452265" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="📜 `&lt;script&gt;`脚本元素 - 从加载策略到安全性与性能的完整指南"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T09:11:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bug_Constructer"/> <meta itemprop="url" content="https://juejin.cn/user/254742426830856"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            📜 `&lt;script&gt;`脚本元素 - 从加载策略到安全性与性能的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/254742426830856/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bug_Constructer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:11:06.000Z" title="Tue Nov 11 2025 09:11:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🎯 <strong>学习目标</strong>：系统掌握<code>&lt;script&gt;</code>脚本元素的加载与执行模型、模块化用法、安全配置（CSP/SRI/CORS），并能在实际项目中选用正确策略，避免性能与安全坑。</p>
<p>📊 <strong>难度等级</strong>：中级<br/>
🏷️ <strong>技术标签</strong>：<code>#HTML</code> <code>#script</code> <code>#defer</code> <code>#async</code> <code>#module</code> <code>#CSP</code> <code>#SRI</code><br/>
⏱️ <strong>阅读时间</strong>：约14分钟</p>
</blockquote>
<h2 data-id="heading-0">🌟 引言</h2>
<p>在前端开发中，<code>&lt;script&gt;</code>脚本的使用几乎无处不在：业务代码、第三方SDK、监控上报、AB测试、广告、埋点……但常见问题也层出不穷：</p>
<ul>
<li>同步脚本阻塞渲染，首屏白屏时间长。</li>
<li>混用<code>async/defer</code>导致执行顺序不可控，依赖打乱引发线上事故。</li>
<li>模块脚本与经典脚本相互引用，兼容性问题频发。</li>
<li>跨域脚本报错只有“Script error”，无法定位问题。</li>
<li>未配置<code>CSP nonce</code>/<code>SRI integrity</code>，安全审计不通过。</li>
</ul>
<p>本文从加载、执行到安全与性能的完整维度，结合实际踩坑案例，给出可落地的最佳实践与测试方法。</p>
<h2 data-id="heading-1">核心技巧详解</h2>
<h3 data-id="heading-2">1）加载与执行模型：同步、defer、async 与事件时序</h3>
<h4 data-id="heading-3">应用场景</h4>
<p>需要同时引入多个脚本，并确保：不阻塞解析、执行顺序可控、与<code>DOMContentLoaded</code>/<code>load</code>事件时序配合。</p>
<h4 data-id="heading-4">常见问题</h4>
<ul>
<li>在<code>&lt;head&gt;</code>中放同步脚本，阻塞HTML解析与渲染。</li>
<li>将存在依赖关系的脚本设置为<code>async</code>，出现随机时序问题。</li>
<li>误以为<code>defer</code>作用于内联脚本（仅对外链脚本生效）。</li>
</ul>
<h4 data-id="heading-5">推荐方案</h4>
<ul>
<li>有依赖和顺序要求：使用<code>defer</code>并保持引入顺序。</li>
<li>无依赖、独立的第三方脚本：使用<code>async</code>。</li>
<li>现代代码优先使用<code>type="module"</code>（天生类似<code>defer</code>，更易管理依赖）。</li>
</ul>
<h4 data-id="heading-6">核心要点</h4>
<ul>
<li><code>async</code>：下载不阻塞解析，下载完成立即执行，彼此之间顺序不确定。</li>
<li><code>defer</code>：下载不阻塞解析，按引入顺序在解析完成后执行，早于<code>DOMContentLoaded</code>。</li>
<li><code>type="module"</code>：模块脚本默认延后执行，按依赖图加载，<code>DOMContentLoaded</code>会等待其完成。</li>
</ul>
<h4 data-id="heading-7">实际应用（顺序可视化示例）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 推荐：存在依赖关系的脚本使用 defer，保证按声明顺序执行 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/vendor.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 独立的第三方脚本使用 async，不影响解析与渲染，也不会卡住其他脚本 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/analytics.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 现代项目：优先使用模块脚本，依赖管理更清晰（默认延后执行，DOM解析完成后运行） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">2）模块脚本与回退：<code>type="module"</code>/<code>nomodule</code>/动态导入</h3>
<h4 data-id="heading-9">应用场景</h4>
<p>在现代浏览器中使用ESM模块；为老旧浏览器准备兼容回退；按需加载分包。</p>
<h4 data-id="heading-10">常见问题</h4>
<ul>
<li>经典脚本与模块脚本相互调用导致作用域混乱。</li>
<li>使用<code>nomodule</code>错误，现代浏览器也执行了回退脚本。</li>
</ul>
<h4 data-id="heading-11">推荐方案</h4>
<ul>
<li>现代浏览器：主入口使用<code>type="module"</code>。</li>
<li>老旧浏览器回退：提供<code>nomodule</code>的经典脚本版本（通过构建产物区分）。</li>
<li>大页面：使用<code>import()</code>进行按需加载，减小首包体积。</li>
</ul>
<h4 data-id="heading-12">核心要点</h4>
<ul>
<li><code>nomodule</code>脚本仅在“不支持模块”的浏览器中执行；现代浏览器会忽略。</li>
<li>模块脚本是<code>strict mode</code>，顶层不会污染全局作用域。</li>
<li>动态导入返回<code>Promise</code>，友好配合路由/交互触发。</li>
</ul>
<h4 data-id="heading-13">实际应用</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 现代入口 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">// @description 页面主入口：模块脚本（默认延后执行）</span>
  <span class="hljs-comment">/**
   * 记录模块初始化
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">msg</span> - 文本信息
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">logInit</span> = (<span class="hljs-params">msg</span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[module] <span class="hljs-subst">${msg}</span>`</span>);
  <span class="hljs-title function_">logInit</span>(<span class="hljs-string">'bootstrap'</span>);

  <span class="hljs-comment">// 动态导入，按需加载非关键功能</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadFeature</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> { initFeature } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'/assets/feature.js'</span>);
    <span class="hljs-title function_">initFeature</span>();
  };
  <span class="hljs-comment">// 交互触发</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadFeature</span>());
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 旧浏览器回退（仅不支持模块的浏览器执行） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">nomodule</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/app-legacy.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">3）安全与跨域：CSP nonce、SRI integrity 与 <code>crossorigin</code></h3>
<h4 data-id="heading-15">应用场景</h4>
<p>严格的安全审计要求；CDN脚本完整性校验；跨域加载脚本并需要捕获详细错误。</p>
<h4 data-id="heading-16">常见问题</h4>
<ul>
<li>直接写内联脚本被CSP拦截，页面功能失效。</li>
<li>使用<code>integrity</code>但未设置<code>crossorigin</code>，SRI校验被忽略。</li>
<li>跨域脚本错误只有“Script error”，无法定位堆栈与消息。</li>
</ul>
<h4 data-id="heading-17">推荐方案</h4>
<ul>
<li>启用CSP并为内联脚本设置<code>nonce</code>（服务器动态生成）。</li>
<li>CDN脚本配合<code>integrity</code>与<code>crossorigin="anonymous"</code>确保完整性与错误可见性。</li>
<li>服务器允许跨域并设置<code>Access-Control-Allow-Origin</code>与<code>Timing-Allow-Origin</code>以提升可观测性。</li>
</ul>
<h4 data-id="heading-18">核心要点</h4>
<ul>
<li><code>Content-Security-Policy: script-src 'self' 'nonce-&lt;随机值&gt;' https://cdn.example.com</code>。</li>
<li><code>integrity</code>需与<code>crossorigin</code>配合，跨域资源不然可能跳过校验。</li>
<li>设置<code>window.addEventListener('error', ...)</code>与<code>unhandledrejection</code>捕获错误。</li>
</ul>
<h4 data-id="heading-19">实际应用</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 服务端需下发一致的 nonce 值（示例：nonce-xyz） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Security-Policy"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"script-src 'self' 'nonce-xyz' https://cdn.example.com"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 内联脚本加 nonce，避免被CSP拦截 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">"xyz"</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">/**
   * 上报错误（示例）
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">type</span> - 错误类型
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">msg</span> - 错误消息
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reportError</span> = (<span class="hljs-params">type, msg</span>) =&gt; {
    <span class="hljs-comment">// 真实项目中调用监控SDK或自建上报接口</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[error] <span class="hljs-subst">${type}</span>: <span class="hljs-subst">${msg}</span>`</span>);
  };
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">reportError</span>(<span class="hljs-string">'onerror'</span>, e.<span class="hljs-property">message</span>));
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">reportError</span>(<span class="hljs-string">'promise'</span>, <span class="hljs-title class_">String</span>(e.<span class="hljs-property">reason</span>)));
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- CDN脚本完整性 + 可见错误堆栈（需服务端允许跨域） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/sdk.min.js"</span>
        <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-BASE64_HASH"</span>
        <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
        <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-20">4）错误监控与可观测性：从“Script error”到可定位</h3>
<h4 data-id="heading-21">应用场景</h4>
<p>跨域脚本导致错误信息缺失；需要在生产环境获取完整堆栈与来源。</p>
<h4 data-id="heading-22">常见问题</h4>
<ul>
<li>未设置<code>crossorigin</code>导致错误被屏蔽。</li>
<li>监控系统只收到了通用的“Script error”。</li>
</ul>
<h4 data-id="heading-23">推荐方案</h4>
<ul>
<li>对外链脚本统一加<code>crossorigin="anonymous"</code>。</li>
<li>服务器返回<code>Access-Control-Allow-Origin: *</code>或你的域名；并提供<code>Timing-Allow-Origin</code>以开放性能指标。</li>
<li>对于私有CDN，确保响应头携带正确的CORS与缓存策略。</li>
</ul>
<h4 data-id="heading-24">实际应用（最小上报器）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 发送错误到监控平台
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{type:string,message:string,stack?:string</span>}} payload - 错误信息
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendError</span> = (<span class="hljs-params">payload</span>) =&gt; {
  <span class="hljs-comment">// 示例：仅打印；实际项目应调用后端接口</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📮 error-report'</span>, payload);
};

<span class="hljs-comment">/**
 * 初始化错误监听
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initErrorListener</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">sendError</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span>, <span class="hljs-attr">message</span>: e.<span class="hljs-property">message</span>, <span class="hljs-attr">stack</span>: e.<span class="hljs-property">error</span>?.<span class="hljs-property">stack</span> });
  });
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">sendError</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'promise'</span>, <span class="hljs-attr">message</span>: <span class="hljs-title class_">String</span>(e.<span class="hljs-property">reason</span>) });
  });
};

<span class="hljs-title function_">initErrorListener</span>();
</code></pre>
<h3 data-id="heading-25">5）性能与加载优化：位置、拆分、预加载、优先级</h3>
<h4 data-id="heading-26">应用场景</h4>
<p>首屏加载优化、减少阻塞、合理拆分产物、控制网络优先级。</p>
<h4 data-id="heading-27">常见问题</h4>
<ul>
<li>将大型同步脚本放在<code>&lt;head&gt;</code>导致阻塞。</li>
<li>所有代码打成一个包，影响首屏与可缓存性。</li>
<li>关键脚本加载优先级过低导致交互延迟。</li>
</ul>
<h4 data-id="heading-28">推荐方案</h4>
<ul>
<li>非必要脚本置底或使用<code>defer</code>；第三方独立脚本用<code>async</code>。</li>
<li>按路由/功能拆分产物；模块脚本配合<code>import()</code>实现懒加载。</li>
<li>对真正关键脚本使用<code>fetchpriority="high"</code>（实验性特性，评估后再用）。</li>
</ul>
<h4 data-id="heading-29">实际应用</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 关键脚本：提升获取优先级并延后执行（避免阻塞） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/critical.js"</span> <span class="hljs-attr">fetchpriority</span>=<span class="hljs-string">"high"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 辅助脚本：按需加载（路由/交互触发） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">/**
   * 懒加载非关键功能
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;void&gt;</span>}
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">lazyFeature</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> { mount } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'/assets/chart.js'</span>);
    <span class="hljs-title function_">mount</span>(<span class="hljs-string">'#chart'</span>);
  };
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#btn'</span>)?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lazyFeature</span>());
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-30">📊 技巧对比总结</h2>









































<table><thead><tr><th>技巧</th><th>使用场景</th><th>优势</th><th>注意事项</th></tr></thead><tbody><tr><td>同步脚本（不推荐）</td><td>早期简单页面</td><td>立即执行</td><td>阻塞解析与渲染，影响首屏</td></tr><tr><td>defer</td><td>有依赖且需保持顺序</td><td>不阻塞解析；按引入顺序执行</td><td>仅外链脚本生效；在解析完成后执行</td></tr><tr><td>async</td><td>独立第三方脚本</td><td>不阻塞解析；最快可用</td><td>顺序不确定；不适合有依赖脚本</td></tr><tr><td>type="module"</td><td>现代项目主入口与分包</td><td>依赖图管理；默认延后执行</td><td>需考虑旧浏览器；配合 nomodule 回退</td></tr><tr><td>nomodule</td><td>旧浏览器回退</td><td>保证兼容</td><td>仅旧浏览器执行；与模块入口配套</td></tr></tbody></table>
<h2 data-id="heading-31">🎯 实战应用建议</h2>
<h3 data-id="heading-32">最佳实践</h3>
<ol>
<li>同时输出 <code>esm</code> 与 <code>legacy</code> 产物；模板中注入 <code>type="module"</code> 与 <code>nomodule</code> 入口。</li>
<li>第三方独立脚本统一使用 <code>async</code>；有依赖的业务脚本使用 <code>defer</code> 保序。</li>
<li>模块化按需拆分：非关键功能通过 <code>import()</code> 懒加载，降低首包体积。</li>
<li>安全策略到位：开启 CSP（<code>nonce</code>/<code>hash</code>/<code>strict-dynamic</code>）与 SRI（<code>integrity</code> + <code>crossorigin</code>）。</li>
</ol>
<h3 data-id="heading-33">性能考虑</h3>
<ul>
<li>关键脚本提升网络优先级（<code>fetchpriority</code>）并使用 <code>defer</code> 避免阻塞。</li>
<li>大页面进行路由/功能拆分；CDN 缓存策略与版本化确保命中率。</li>
<li>错误与性能可观测性：启用 <code>crossorigin</code> 与 <code>Timing-Allow-Origin</code>，便于采集与诊断。</li>
</ul>
<h2 data-id="heading-34">💡 总结</h2>
<p>这5个脚本治理技巧覆盖了加载模型、模块化、跨域安全、错误监控与性能优化：</p>
<ol>
<li>加载与执行模型：明确 <code>defer/async/module</code> 的时序与适用场景。</li>
<li>模块脚本与回退：<code>type="module"</code> + <code>nomodule</code> 兼顾现代与旧环境。</li>
<li>安全与跨域：CSP <code>nonce</code>、SRI <code>integrity</code> 与 CORS 正确配合。</li>
<li>错误监控与可观测性：统一监听与跨域头，避免“Script error”。</li>
<li>性能与加载优化：拆分、预加载与优先级，降低阻塞时间。</li>
</ol>
<p>掌握以上技巧能让你的前端应用更稳定、更安全、更高效。建议在团队内形成统一的脚本治理规范，并提供测试页面验证关键场景，持续迭代优化。</p>
<h2 data-id="heading-35">相关资源</h2>
<ul>
<li>MDN：HTML <code>&lt;script&gt;</code> 元素（参考与属性说明）
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTML%2FReference%2FElements%2Fscript" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/script" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a></li>
<li>CSP 指南：Content Security Policy
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FCSP" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a></li>
<li>SRI 指南：Subresource Integrity
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FSecurity%2FSubresource_Integrity" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/Security/Subresource_Integrity" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a></li>
<li>Priority Hints（fetchpriority）
<a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Farticles%2Fpriority-hints" target="_blank" title="https://web.dev/articles/priority-hints" ref="nofollow noopener noreferrer">web.dev/articles/pr…</a></li>
</ul>
<hr/>
<blockquote>
<p>💡 今日收获：掌握了脚本加载与执行的5个核心技巧，含安全与性能的最佳实践，这些知识点在实际前端项目中非常实用。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript为何在AI时代登顶：Anders Hejlsberg 的十二年演化论]]></title>    <link>https://juejin.cn/post/7571278865516576818</link>    <guid>https://juejin.cn/post/7571278865516576818</guid>    <pubDate>2025-11-11T09:12:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571278865516576818" data-draft-id="7571281406509596723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript为何在AI时代登顶：Anders Hejlsberg 的十二年演化论"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T09:12:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript为何在AI时代登顶：Anders Hejlsberg 的十二年演化论
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:12:05.000Z" title="Tue Nov 11 2025 09:12:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文访谈：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.blog%2Fdeveloper-skills%2Fprogramming-languages-and-frameworks%2Ftypescripts-rise-in-the-ai-era-insights-from-lead-architect-anders-hejlsberg%2F" target="_blank" title="https://github.blog/developer-skills/programming-languages-and-frameworks/typescripts-rise-in-the-ai-era-insights-from-lead-architect-anders-hejlsberg/" ref="nofollow noopener noreferrer">github.blog/developer-s…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db4a4d83875a462da6e652b941371838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763457124&amp;x-signature=7Hx3ZWByJZnlcIPUITcV160phbc%3D" alt="" loading="lazy"/></p>
<p><strong>当 Anders Hejlsberg 在 2012 年开始着手 TypeScript 时，他并不是在构想一个要与 JavaScript 竞争的新语言。</strong> 他试图解决一个非常现实的问题：JavaScript 已经成为整个 Web 的基石，但它并不适合大型、多开发者协作的代码库。团队们正在交付数百万行弱类型代码，而当系统复杂到难以推理时，这门语言几乎提供不了任何帮助。</p>
<p><strong>这项起初的务实修补最终重塑了现代开发。</strong> 在 2025 年，TypeScript 成为 GitHub 上使用量最高的语言，首次超过了 JavaScript 与 Python。仅今年，就有超过一百万名开发者以 TypeScript 参与贡献——这是 Octoverse 统计的 66% 的增长。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4ce0dd85ad8437d91cbdf63cc7caf69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763457124&amp;x-signature=0LSbTaWzOLR%2FRBYeOGecGOymyrw%3D" alt="" loading="lazy"/></p>
<p>他说：“我记得当时心里想，也许我们能让 25% 的 JavaScript 社区产生兴趣——那就算成功了。但看到现在的情况？我完全惊呆了。”</p>
<p><strong>在 2025 年，TypeScript 成为 GitHub 上使用量最多的语言，首次超过 JavaScript 和 Python。</strong> 根据今年的 Octoverse 报告，仅今年就有超过一百万名开发者开始用 TypeScript 贡献代码（同比增长 66%）。</p>
<p>那么，一个 JavaScript 的类型化超集是如何成为 AI 时代的主导语言的？我们与 Anders 坐下来，聊了演化、性能，以及为什么一门为更好的人类协作而设计的语言，如今正在为机器辅助编码提供动力。</p>
<hr/>
<h2 data-id="heading-0">“我们原以为 25% 的采用率就算成功。”</h2>
<p>“项目刚启动时，”Anders 说，“我估计如果我们能让 25% 的 JavaScript 社区表现出兴趣，那就赢了。但现在，看着每天有这么多人依赖它……我和整个团队都惊呆了。”</p>
<p>回到 2012 年，JavaScript 已经根深蒂固。TypeScript 的赌注不是取代它，而是通过添加类型、工具链和可重构性，让大规模 JavaScript 开发变得“可理性”。</p>
<blockquote>
<p><strong>“做一件你知道真的能带来改变的事，是一种喜悦。我们没打算无处不在。我们只是想让开发者能更有信心地构建大型系统。”</strong> ——TypeScript 创作者 Anders Hejlsberg</p>
</blockquote>
<p>十年后，这个赌注成为默认。几乎所有现代前端框架——React、Next.js、Angular、SvelteKit——都默认提供 TypeScript 脚手架。结果是：更安全的代码库、更好的自动补全、更少凌晨 3 点因为一个 undefined 而调试崩溃。</p>
<p>“Anders 说：“魔力就在于让 TypeScript 感觉像 JavaScript，但拥有超能力。”</p>
<hr/>
<h2 data-id="heading-1">⚙️ TypeScript 到底是什么？</h2>
<p>TypeScript 是一个开源的、带类型标注的 JavaScript 超集，它会编译成普通 JavaScript。它添加静态类型检查、接口、泛型和现代语言特性——并在编译时把它们抹去，使输出能在任何 JavaScript 能运行的地方运行。</p>
<p>开发者使用它的理由：</p>
<ul>
<li>在运行前捕获类型错误</li>
<li>提升 IDE 自动补全与重构能力</li>
<li>让大型代码库在团队协作下仍可维护</li>
<li>与框架和 AI 辅助工具无缝集成</li>
</ul>
<p>它用于：前端框架（React, Angular, Vue）、后端系统（Node.js, Deno）、SDK、设计系统，以及越来越多需要强类型来确保生成代码安全的 AI 代理框架。</p>
<hr/>
<h2 data-id="heading-2">为未来重写编译器</h2>
<p>TypeScript 发布时著名的“自托管”特性：用 TypeScript 自己编写。这让编译器便携、可修改。但性能最终成为问题。</p>
<p>“Anders 说：“放弃自托管让我们很痛苦，但我们知道性能已经挤不出更多了。”</p>
<p>我们尝试了 C#、其他语言，最后选择 Go。性能提升达到了 10 倍。一半来自原生速度，一半来自共享内存并发。这种 10 倍提升是不能忽视的。</p>
<p>重写带来了一个更快、更轻、更适合企业规模代码库的编译器——但功能上与旧版本完全一致。</p>
<p>Anders 谈到：“我们现在有一个原生编译器，从怪癖到行为都与旧的完全一致。社区不需要丢掉任何东西。”</p>
<p>这种<strong>在提升性能的同时保留行为一致性</strong>的理念，是开发者信任 TypeScript 的原因之一。它不是每隔几年来一次“从零开始”的重写，而是一个保持兼容、不断演化的系统。</p>
<hr/>
<h2 data-id="heading-3">“开源是被捕捉在代码里的演化。”</h2>
<p>Anders 把开源看作一种类似自然选择的生态系统。</p>
<p>“Anders 说：“开源本来是个巨大的实验。没人真正搞清楚如何为它提供资金——但我们现在看到，它比以往更大，也不会消失。那就是被捕捉在代码里的演化。”</p>
<p>今年的 Octoverse 数据验证了这一点：开发者在 2025 年提交了近 10 亿次提交（同比 +25%），其中 11.2 亿次提交到公共和开源仓库。这是用一次次 PR 写下的“演化记录”。</p>
<p>拥有 12 年 issues、PR 与设计文档的 TypeScript 仓库，本身已经成为语言演化的活档案。“我们有 12 年的历史被记录在 GitHub 上，”Anders 说。“所有内容都可搜索。那就是你能 grep 的演化。”</p>
<hr/>
<h2 data-id="heading-4">AI 效应：为什么 TypeScript 在现在的时代更强盛？</h2>
<p>Octoverse 2025 最突出的数据之一显示 AI 正在改变语言偏好。开发者正转向能让 AI 辅助编码更可靠、更可维护的类型语言。</p>
<p>Anders 解释道：</p>
<blockquote>
<p><strong>“AI 在一门语言上写代码的能力，与它见过的该语言数量成正比。它是一个巨大的复述器，带些外推。AI 看过大量的 JavaScript、Python 和 TypeScript，所以它在写这些语言时特别强。新语言反而处于劣势。”</strong></p>
</blockquote>
<p>这种数据优势，加上 TypeScript 的静态类型系统，使其非常契合 AI 优先的工作流。</p>
<p>“Anders 说：“如果你让 AI 翻译 50 万行代码，它可能会产生幻觉。但如果你让它生成一个程序，以确定性方式完成同样的翻译，你就能得到可靠结果。这就是类型系统被设计出来要解决的问题。”</p>
<p>结论：在一个代码由人类和机器共同编写的世界里，类型不是官僚主义，而是真相校验器。</p>
<hr/>
<h2 data-id="heading-5">从 IDE 到 Agent</h2>
<p>大型语言模型的兴起也在改变“开发工具”的定义。IDE 正在从为人类服务，变成同时为 agents 服务的环境。</p>
<blockquote>
<p>“AI 一开始是助手。现在它在做工作，而你在监督。它不需要我们那种 IDE。它需要的是各种服务。这就是 Model Context Protocol 令人兴奋的地方。”</p>
</blockquote>
<p>Octoverse 报告描述这种变化：“AI 不只是重塑代码，而是在重塑选择。”</p>
<p>像 TypeScript 这样的类型语言，为 agents 提供了安全重构、语义查询和对代码库进行确定性推理的结构化基础。</p>
<p>“Anders 补充说：“目标是为 AI 工作流设定恰到好处的确定性，让它们保持有用而不至于脱轨。”</p>
<hr/>
<h2 data-id="heading-6">这门持续演化的语言</h2>
<p>从 Turbo Pascal 到 C#，再到 TypeScript，Anders 的工作跨越数十年。但令人惊讶的是，他始终保持一致：构建能让复杂软件更易理解的语言。</p>
<blockquote>
<p>“没有什么比做一件确实能带来改变的事情更令人满足的了。TypeScript 不断变化，但始终围绕同一件事：帮助开发者清晰表达意图。”</p>
</blockquote>
<p>这种清晰，或许正是为什么 2025 年平均每秒就有至少一个新开发者加入 GitHub，而其中越来越多人选择从 TypeScript 开始。</p>
<p>TypeScript 的故事不仅仅是语言设计的故事；</p>
<p>它是演化的故事——一个起初为修补 JavaScript 扩展性而生的项目，如今成为开发者与 AI 共同写代码的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端高频面试题之Vue（初、中级篇）]]></title>    <link>https://juejin.cn/post/7571303808115769396</link>    <guid>https://juejin.cn/post/7571303808115769396</guid>    <pubDate>2025-11-11T13:31:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571303808115769396" data-draft-id="7571278865517805618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端高频面试题之Vue（初、中级篇）"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2025-11-11T13:31:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端高频面试题之Vue（初、中级篇）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:31:42.000Z" title="Tue Nov 11 2025 13:31:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、说说你对 Vue.js 的理解？</h2>
<p><code>Vue.js</code> 是一个用于创建用户界面的开源 <code>JavaScript</code> 框架，它的特点如下：</p>
<h3 data-id="heading-1">1.1 声明式框架</h3>
<ul>
<li>早在JQ的时代编写的代码都是命令式的，命令式框架重要特点就是关注过程。</li>
<li>声明式框架更加关注结果。命令式的代码封装到了框架内部，过程靠框架来实现。</li>
</ul>
<h3 data-id="heading-2">1.2 数据驱动/响应式数据</h3>
<p>通过 <code>Object.defineProperty（Vue 2）</code> 或 <code>Proxy（Vue 3）</code> 实现数据劫持，数据变化时自动更新视图，开发者无需手动操作 DOM。</p>
<h3 data-id="heading-3">1.3 虚拟DOM</h3>
<p>通过高效的 <code>Diff</code> 算法比对虚拟 <code>DOM</code> 的变化，最小化真实 <code>DOM</code> 操作，提升性能。</p>
<h3 data-id="heading-4">1.4 组件化</h3>
<p>将 UI 拆分为独立可复用的组件，每个组件包含自己的模板、逻辑和样式，通过组合组件构建复杂应用。</p>
<h3 data-id="heading-5">1.5 指令系统</h3>
<p>提供 <code>v-if</code>、<code>v-for</code>、<code>v-bind</code>、<code>v-on</code> 等指令，以声明式方式增强 HTML 的功能。</p>
<h3 data-id="heading-6">1.6 渐进式框架</h3>
<ul>
<li><strong>渐进集成</strong>：可以从小规模功能（如静态页面交互）逐步扩展到完整的单页应用（SPA）。</li>
<li><strong>灵活生态</strong>：核心库只关注视图层，但配合官方路由（Vue Router）、状态管理（Vuex/Pinia）、构建工具（Vite）等，能轻松扩展为全功能框架。</li>
</ul>
<p>就是你可以单独用 <code>vue</code> 的响应式构建静态页面，如果你需要状态管理，就用官方的状态管理工具 <code>Vuex/Pinia</code>，如果你需要构建一个应用，有多个页面，可以用官方路由 <code>Vue-router</code>，如果你需要一键生成项目，可以用官方的 <code>vue-cli</code> 或者使用 <code>vite</code> 的 <code>npm create vue@latest</code> 命令一键创建项目。</p>
<h2 data-id="heading-7">2、请说一下对 Vue.js 响应式数据的理解？</h2>
<p><code>vue</code> 是通过数据驱动视图的，响应式指的是当数据发生变化时，使用到该数据的页面会自动更新。在表单中，可以通过响应式实现<strong>双向绑定</strong>，实现表单值和数据的<strong>双向同步</strong>。</p>
<h3 data-id="heading-8">2.1 基本原理</h3>
<ol>
<li><strong>数据劫持</strong>：<code>vue2</code> 中使用 <code>Object.defineProperty</code> 对对象属性进行劫持，对数组则采用重写数组的七个方法<code>（push,shift,pop,splice,unshift,sort,reverse）</code>来实现劫持，而 <code>vue3</code> 则通过 <code>Proxy</code> API 可以天然对对象和数组实现数据劫持。</li>
<li><strong>依赖收集</strong>：在 <code>getter</code> 中收集依赖(谁在使用这个数据)。</li>
<li><strong>派发更新</strong>：在 <code>setter</code> 中通知所有依赖进行更新，更新页面。</li>
</ol>
<h3 data-id="heading-9">2.2 特点</h3>
<ol>
<li><strong>自动更新</strong>：数据变化时，依赖该数据的视图会自动更新。</li>
<li><strong>深度监听</strong>：嵌套对象也会被递归转为响应式。</li>
<li><strong>异步更新</strong>：Vue 会异步执行 DOM 更新，提高性能。</li>
</ol>
<h3 data-id="heading-10">2.3 Vue3 响应式改进</h3>
<p>使用 <code>Proxy</code> 代替 <code>Object.defineProperty</code>：</p>
<ul>
<li>可以检测到对象属性的添加和删除。</li>
<li>对数组的变化无需特殊处理，天然可以监听到通过数组索引修改元素和修改 <code>length</code> 属性的行为。</li>
<li>性能更好。</li>
</ul>
<h3 data-id="heading-11">2.4 扩展：针对响应式可以做的性能优化（vue2）：</h3>
<ul>
<li>对象层级过深，性能就会差，所以响应式尽量扁平化。</li>
<li>不需要响应数据的内容不要放到 data 中。</li>
<li>不需要更新的静态数据可以用 <code>Object.freeze()</code> 冻结数据。</li>
</ul>
<h3 data-id="heading-12">2.5 注意事项</h3>
<ol>
<li>对象新增属性：<code>vue 2</code> 中需要使用 <code>Vue.set</code> 或 <code>this.$set</code> 方法。</li>
<li>数组变化：<code>vue 2</code> 中直接通过索引修改或修改 <code>length</code> 属性不会触发响应，应使用变异方法(<code>push/pop/shift</code>等)或 <code>Vue.set、this.$set</code>。</li>
<li>性能考量：响应式系统需要追踪依赖，大型对象可能会有性能开销。</li>
</ol>
<p>响应式系统让开发者可以专注于数据逻辑，而无需手动处理 DOM 更新，大大提高了开发效率。</p>
<h2 data-id="heading-13">3、Vue3 的升级点？</h2>
<h3 data-id="heading-14">3.1 架构升级</h3>
<p>Vue3 源码采用 <strong>monorepo</strong> 方式进行管理，将模块拆分到packages中，这样做的好处如下：</p>
<ol>
<li>将多个模块集合到一个仓库，方便维护。</li>
<li>方便版本管理和依赖管理，各模块间相互引用也比较方便。</li>
<li>各个包可以单独安装使用，不需要导入整个 vue。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e31a6b97686e45ed9d72c15d8ccb71d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763472701&amp;x-signature=0AclC2F9tzfQzEnHYn14jB7MBnY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">3.2 组合式API -&gt; Composition API</h3>
<p>vue2 中 <code>Options API</code>（即提供props、methods、data、computed、watch等属性供用户使用）的问题：</p>
<ol>
<li>复用性比较差，虽然提供 mixins 和 extends，但会出现数据来源不明确和重名问题。</li>
<li>需要使用带有副作用<code>this</code>，存在this指向问题，同时对 <code>tree-shaking</code> 也不友好。</li>
<li>对于上百行的大型组件来说，当你了解某段逻辑时，你需要不断上下移动阅读，体验很差。</li>
</ol>
<p>vue3<code>Composition API</code>特点：</p>
<ol>
<li>方便抽离，复用性强，可以把干净的逻辑提取到一个单独函数或者文件中，让开发者专注于逻辑内聚问题。</li>
<li>抛弃this，tree-shaking 友好，打包出来体积更小。</li>
</ol>
<h3 data-id="heading-16">3.3 响应式系统</h3>
<p>vue3采用<code>proxy</code>替代了<code>Object.defineProperty</code>:</p>
<ol>
<li>提升了性能，不再需要一次性全部递归拦截。</li>
<li>能拦截到对象属性的新增和删除。</li>
<li>能拦截原生数组的索引、length操作。</li>
</ol>
<h3 data-id="heading-17">3.4 diff算法</h3>
<p>全量 <code>diff</code> 算法中采用<strong>最长递增子序列</strong>减少节点的移动。在非全量 <code>diff</code> 算法中只比较动态节点，通过 <code>PatchFlag</code> 标记更新动态的部分。</p>
<h3 data-id="heading-18">3.5 渲染优化</h3>
<p>在渲染方面，vue3提供了<strong>自定义渲染器</strong>，大大提升了扩展能力。</p>
<h3 data-id="heading-19">3.6 编译优化</h3>
<ul>
<li><strong><code>Block</code>和 <code>patchFlag</code></strong>：为动态节点打上补丁标志，即 <code>patchFlag</code>，同时还提出了 <code>block</code> 的概念，<code>block</code> 本质上是一个虚拟节点，但它会多出一个 <code>dynamicChildren</code> 数组，会收集它所有的动态子代节点，比对的时候会忽略DOM层级结构的，所以对于带有 <code>v-if</code>、<code>v-for</code> 等结构化指令的节点也作为 <code>block</code> 的角色。</li>
<li><strong>静态提升</strong>：将静态虚拟的节点提升到render函数之外，这样能够减少更新时创建虚拟DOM带来的性能开销和内存占用。</li>
<li><strong>预字符串化</strong>：在静态提升的基础上，当模板中包含大量连续纯静态的标签节点时，将这样静态节点序列化成字符串，然后通过innerHTML进行设置，这样做能够减少创建虚拟节点产生的性能开销和内存占用。</li>
<li><strong>缓存内联事件处理函数</strong>：可以避免不必要的更新。</li>
<li><strong>v-once指令</strong>：缓存虚拟节点，避免组件更新时重新创建虚拟DOM的性能开销，同时带有v-once指令的节点不会被父级block收集，所以不会参与diff操作，避免无用的diff开销。</li>
</ul>
<h3 data-id="heading-20">3.7 新增组件</h3>
<ul>
<li>Teleport：可以将指定内容渲染到特定容器中，而不受DOM层级的限制。</li>
</ul>
<h3 data-id="heading-21">3.8 对TypeScript支持更加友好</h3>
<p>vue2源码采用Flow做类型检测，对TypeScript支持并不友好，而Vue3采用TypeScript进行重写，对TS的支持更加友好。</p>
<h3 data-id="heading-22">3.9 体积更小（移除了不常用的 API）</h3>
<ul>
<li>移除 inline-template (Vue2 中就不推荐使用)。</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>n</mi><mtext>、</mtext></mrow><annotation encoding="application/x-tex">on、</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">、</span></span></span></span></span>off、$once （如果有需要可以采用 mitt 库来实现）。</li>
<li>删除过滤器 filter （可以通过计算属性或者方法来实现）。</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>n</mi><mtext>移除（可以通过</mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mtext>，</mtext><mi>i</mi><mi>n</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mtext>方法构建</mtext></mrow><annotation encoding="application/x-tex">children移除 （可以通过provide，inject方法构建</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">hi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">re</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">移除（可以通过</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.05724em;">inj</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">方法构建</span></span></span></span></span>children）。</li>
<li>移除.sync .native 修饰符 (.sync通过 v-model:xxx实现，.native为 Vue3 中的默认行为) 以及不在支持 keycode 作为v-on修饰符（@keyup.13 不再支持）。</li>
<li>移除全局 API。Vue.component、Vue.use、Vue.directive (将这些 api 挂载到实例上)。</li>
<li>通过构建工具 Tree-shaking 机制实现按需引入，减少用户打包后体积。</li>
</ul>
<h2 data-id="heading-23">4、Vue.js 为什么需要虚拟DOM？</h2>
<p>虚拟DOM（Virtual DOM）就是用 js 对象来描述真实 DOM，是对真实 DOM 的抽象。</p>
<h3 data-id="heading-24">4.1 性能优化</h3>
<ul>
<li><strong>直接操作 DOM 代价高昂</strong>：浏览器 DOM 操作是非常消耗性能的。</li>
<li><strong>最小差异更新</strong>：通过比对新旧虚拟 DOM 节点，找出最小差异进行更新。</li>
<li><strong>批量更新</strong>：在数据修改后，异步批量更新。</li>
</ul>
<blockquote>
<p>虚拟DOM并不一定能提升性能，比如你就改了一个数据，vue还要走一遍 DOM diff 比对完后再去调用原生 DOM API去更新，这时候其实你直接通过原生DOM API 去更新肯定性能更高，但是虚拟 DOM 能保证性能的下限，在你的应用复杂且庞大的时候，不至于性能太差。</p>
</blockquote>
<h3 data-id="heading-25">4.2 跨平台</h3>
<ul>
<li><strong>抽象层作用</strong>：虚拟 DOM 是对真实 DOM 的抽象表示。</li>
<li><strong>多端渲染</strong>：同一套虚拟 DOM 可以渲染到不同平台（Web、Native、Canvas等）。</li>
<li><strong>服务端渲染(SSR)</strong>：在没有真实 DOM 的环境下也能生成页面结构。</li>
</ul>
<h3 data-id="heading-26">4.3 声明式编程的优势</h3>
<ul>
<li><strong>开发者友好</strong>：开发者只需关心数据状态，不必手动操作 DOM。</li>
<li><strong>自动优化</strong>：框架层面负责最高效的更新策略，开发者无需微观管理。</li>
</ul>
<h3 data-id="heading-27">4.4 与响应式系统的协同</h3>
<ul>
<li><strong>依赖追踪</strong>：虚拟 DOM 与 Vue 的响应式系统紧密结合。</li>
<li><strong>组件级更新</strong>：数据更改后，在组件级别进行页面更新。</li>
</ul>
<h2 data-id="heading-28">5、Vue.js 组件间传值的方式</h2>
<p><strong>vue2</strong>：</p>
<ul>
<li>一、父子通信
<ol>
<li><code>props</code></li>
<li><code>$emit</code></li>
<li><code>$attrs、$listeners</code></li>
<li><code>$parent、$children</code></li>
<li><code>$ref</code></li>
<li><code>作用域插槽</code></li>
<li><code>v-model</code></li>
</ol>
</li>
<li>二、兄弟组件通信
<ol>
<li><code>mitt</code></li>
<li><code>$parent</code></li>
<li><code>vuex/pinia</code></li>
<li><code>app.config.globalProperties</code></li>
</ol>
</li>
<li>三、跨层级通信
<ol>
<li><code>vuex</code></li>
<li><code>provide/inject</code></li>
<li><code>event bus</code></li>
</ol>
</li>
</ul>
<p><strong>vue3</strong>：</p>
<ul>
<li>一、父子通信
<ol>
<li><code>props</code></li>
<li><code>defineEmits</code></li>
<li><code>$attrs</code></li>
<li><code>$ref + defineExpose</code></li>
<li><code>$parent</code></li>
<li><code>作用域插槽</code></li>
<li><code>v-model</code></li>
</ol>
</li>
<li>二、兄弟组件通信
<ol>
<li><code>mitt</code></li>
<li><code>$parent</code></li>
<li><code>vuex/pinia</code></li>
<li><code>app.config.globalProperties</code></li>
</ol>
</li>
<li>三、跨层级通信
<ol>
<li><code>mitt</code></li>
<li><code>vuex/pinia</code></li>
<li><code>provide/inject</code></li>
</ol>
</li>
</ul>
<p><strong>扩展：其它通信方式</strong>：</p>
<ul>
<li>浏览器本地存储<code>storage</code>。</li>
<li>全局<code>window</code>对象。</li>
<li>ES6模块化 import/export。</li>
</ul>
<h2 data-id="heading-29">6、v-show 和 v-if 有什么区别？使用场景分别是什么？</h2>
<p><strong>相同点</strong>：控制元素在页面是否显示。</p>
<p><strong>不同点</strong>：</p>
<ul>
<li><strong>控制手段不同</strong>：<code>v-show</code> 控制的是 <code>css</code> 的 <code>display</code> 属性是否为 <code>none</code> 来控制元素的是否隐藏，而 <code>v-if</code> 是直接不渲染 DOM 元素或者直接删除 DOM 元素。</li>
<li><strong>控制过程区别</strong>：<code>v-if</code> 切换有一个局部编译/卸载的过程，切换过程中合适地销毁和重建内部的事件监听和子组件，如果控制的是组件，也会执行组件的生命周期钩子；而<code>v-show</code> 只是简单的基于css切换。</li>
<li><strong>编译区别</strong>：<code>v-if</code> 在编译过程中会被转化成<strong>三元表达式</strong>,条件不满足时不渲染此节点。<code>v-show</code> 会被编译成指令，条件不满足时控制样式将对应节点隐藏 （内部其他指令依旧会继续执行）。</li>
<li><strong>性能消耗</strong>：<code>v-if</code> 比 <code>v-show</code> 有更高的性能消耗。</li>
</ul>
<p><strong>使用场景</strong>：频繁切换 + 不需要销毁状态用 <code>v-show</code>，反之用 <code>v-if</code>。</p>
<h2 data-id="heading-30">7、v-if 和 v-for  哪个优先级更高？</h2>
<ul>
<li>vue2 中 <code>v-for</code> 的优先级比 <code>v-if</code> 高，它们作用于一个节点上会导致先循环后对每一项进行判断，浪费性能。</li>
<li>vue3 中 <code>v-if</code> 的优先级比 <code>v-for</code> 高，这就会导致 <code>v-if</code> 中的条件无法访问 <code>v-for</code> 作用域名中定义的变量别名。</li>
</ul>
<p>所以不管是 <code>vue2</code> 还是 <code>vue3</code>，都不推荐同时使用 <code>v-if</code> 和 <code>v-for</code>，更好的方案是采用计算属性，或者在外层再包裹一个容器元素，将 <code>v-if</code> 作用在容器元素上。</p>
<p>不推荐用：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;li v-for="item in arr" v-if="item.visible"&gt;
  {{ item}}
&lt;/li&gt;
</code></pre>
<p>推荐用：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- visibleArr为计算属性 --&gt;
&lt;li v-for="item in visibleArr"&gt;
    {{ item}}
  &lt;/li&gt;
</code></pre>
<h2 data-id="heading-31">8、Vue.js 的 nextTick 是什么？有什么使用场景？</h2>
<p>Vue.js 中的 nextTick（或实例方法 this.$nextTick）是一个 Vue 提供的一个 API，用于在响应式状态变更后等待下一个 DOM 更新周期完成后再执行代码。由于 Vue 的 DOM 更新是异步的：当你修改响应式数据时，Vue 内部会缓冲这些变更，并在<code>“下一个 tick”</code>中一次性应用到 DOM，用这种批量更新的方式提高性能。所以这意味着数据变更后立即访问 DOM 可能获取到旧值，而 nextTick 确保回调在 DOM 实际更新后运行。</p>
<p>其使用场景如下：</p>
<ul>
<li><strong>数据更新后立即操作 DOM</strong>：如获取元素尺寸、焦点设置或第三方库初始化。如果不使用 nextTick，你可能拿到的是未更新的 DOM，导致错误。</li>
<li><strong>避免多次渲染</strong>：Vue.js 内部用它批量更新 DOM，提高性能。</li>
<li><strong>与异步操作结合</strong>：如在 Promise 或 setTimeout 后更新数据，然后 await nextTick 来处理后续 DOM 依赖的任务。</li>
<li><strong>组件生命周期钩子中</strong>：在 mounted 或 updated 钩子中，如果需要基于更新后的 DOM 执行代码，使用 nextTick 确保安全。</li>
<li><strong>测试和调试</strong>：在单元测试中，确保 DOM 已同步更新后再断言。</li>
</ul>
<h2 data-id="heading-32">9、Vue中 computed 和 watch 的区别</h2>








































<table><thead><tr><th>特性</th><th>computed (计算属性)</th><th>watch (侦听器)</th></tr></thead><tbody><tr><td>设计目的</td><td>派生新数据</td><td>观察数据变化执行副作用</td></tr><tr><td>返回值</td><td>必须返回一个值</td><td>不需要返回值</td></tr><tr><td>缓存</td><td>有缓存，依赖不变时不重新计算</td><td>无缓存，每次变化都执行</td></tr><tr><td>异步操作</td><td>不能包含异步操作</td><td>可以执行异步操作</td></tr><tr><td>初始执行</td><td>立即执行</td><td>默认不立即执行(配置 immediate: true后会立即执行)</td></tr><tr><td>使用场景</td><td>模板中使用的派生数据</td><td>数据变化时需要执行的操作(如API调用、复杂逻辑)</td></tr></tbody></table>
<h2 data-id="heading-33">10、Vue2 的生命周期方法有哪些？一般在哪一步发起请求及原因</h2>
<ul>
<li><strong>beforeCreate</strong>：在实例初始化之后，数据观测(data observer) 和 event/watcher 事件配置之前被调用。</li>
<li><strong>created</strong>：实例已经创建完成之后被调用。在这一步，实例已完成以下的配置：数据观测(data observer)，属性和方法的运算， watch/event 事件回调。这里没有$el</li>
<li><strong>beforeMount</strong>：在挂载开始之前被调用：相关的 render 函数首次被调用。</li>
<li><strong>mounted</strong>：el 被新创建的 vm.$el 替换，并挂载到实例上去之后调用该钩子。</li>
<li><strong>beforeUpdate</strong>：数据更新时调用，发生在虚拟 DOM 重新渲染和打补丁之前。</li>
<li><strong>updated</strong>：由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。</li>
<li><strong>beforeDestroy</strong>：实例销毁之前调用。在这一步，实例仍然完全可用。</li>
<li><strong>destroyed</strong>：Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。 该钩子在服务器端渲染期间不被调用。</li>
</ul>
<p><strong>钩子函数的作用</strong>：</p>
<ul>
<li><strong>created</strong>：实例已经创建完成，因为它是最早触发的原因可以进行一些数据，资源的请求。(服务端渲染支持created方法)</li>
<li><strong>mounted</strong>：实例已经挂载完成，可以进行一些DOM操作</li>
<li><strong>beforeUpdate</strong>：可以在这个钩子中进一步地更改状态，这不会触发附加的重渲染过程。</li>
<li><strong>updated</strong>：可以执行依赖于 DOM 的操作。然而在大多数情况下，你应该避免在此期间更改状态，因为这可能会导致更新无限循环。 该钩子在服务器端渲染期间不被调用。</li>
<li><strong>destroyed</strong>：可以执行一些优化操作,清空定时器，解除绑定事件</li>
</ul>
<p>在哪发送请求都可以，主要看具体你要做什么事，一般会在 <code>created</code> 和 <code>mounted</code> 发起请求，但注意服务端渲染不执行 <code>mounted</code> 钩子。</p>
<h2 data-id="heading-34">11、Vue.js 中组件中的 data 为什么是一个函数?</h2>
<p>每次使用组件时都会对组件进行实例化操作，并且调用 <code>data</code> 函数返回一个对象作为组件的数据源。这样可以保证多个组件间数据互不影响。</p>
<h2 data-id="heading-35">12、谈谈对 Vue.js 组件化的理解？</h2>
<p>在 Vue.js 中，每一个 <code>.vue</code> 文件即一个 vue 组件，组件化的核心包括模板 template、属性 props、事件、插槽 slot、生命周期等。</p>
<p>组件化好处: 高内聚、可重用、可组合。</p>
<ul>
<li>组件化开发能大幅提高应用开发效率、测试性、复用性等;</li>
<li>降低更新范围，只重新渲染变化的组件。</li>
</ul>
<h2 data-id="heading-36">13、谈谈对 Vue.js 单向数据流的理解？</h2>
<p>Vue.js 的单向数据流是其核心设计原则之一，它确保数据在组件间流动时具有<strong>可预测性</strong>和<strong>一致性</strong>，便于调试和追踪 bug。</p>
<p>数据总是从父组件向下流动到子组件（通过 <code>props</code> 传递），而子组件不能直接修改从父组件接收到的数据。如果子组件需要更新数据，只能通过触发事件（<code>emits</code> 或自定义事件）通知父组件，由父组件负责实际的更新。</p>
<h2 data-id="heading-37">14、Vue.js 父组件如何监听子组件的生命周期？</h2>
<ul>
<li>vue2 用 @hook:mounted。</li>
<li>vue3 用 @vue:mounted。</li>
</ul>
<p>下面演示 vue3 的写法，vue2 同理。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- parent.vue --&gt;
&lt;template&gt;
  &lt;Child @vue:mounted="fn" /&gt;
&lt;/template&gt;


&lt;script lang="ts" setup&gt;
import Child from './Child.vue'
const afterChildMounted = () =&gt; {
  console.log('after child mounted')
}
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Child.vue --&gt;
&lt;script setup&gt;
import { onMounted } from 'vue'

onMounted(() =&gt; {
  console.log('child mounted')
})

&lt;/script&gt;

</code></pre>
<h2 data-id="heading-38">15、请说一下 Vue.js 中 key 的作用？</h2>
<p>在 Vue.js 中，<code>key</code> 属性主要用于优化列表渲染，特别是与 <code>v-for</code> 指令结合使用时。它为列表中的每个元素提供一个唯一的标识符，帮助 Vue 跟踪节点的身份，从而在数据变化时更高效地更新 DOM。</p>
<ul>
<li><strong>提升渲染效率</strong>：Vue 默认使用“就地更新”（in-place patch）策略来处理列表变化，即不移动 DOM 元素，而是直接更新现有元素的内容。如果列表项的顺序发生变化，这种策略可能导致问题（如状态丢失）。<code>key</code> 允许 Vue 复用和重新排序现有的 DOM 元素，确保更新更精确。</li>
<li><strong>保留组件状态</strong>：当列表项包含有状态的组件（如表单输入框）时，<code>key</code> 确保组件的内部状态（如输入值）不会在数据重排时丢失或错位。</li>
<li><strong>优化 diff 算法</strong>：Vue 的虚拟 DOM diff 过程依赖 <code>key</code> 来比较新旧节点。如果没有 key，Vue 会按索引比较，可能导致不必要的重新渲染。</li>
</ul>
<h2 data-id="heading-39">16、Vue.use 是干什么的？</h2>
<p><code>Vue.use</code> 方法是用于安装（注册）Vue 插件的全局方法。它允许开发者在 Vue 应用中引入第三方插件或自定义插件，从而扩展 Vue 的功能，如添加全局组件、指令、混入（mixins）或其他特性。
主要作用</p>
<ul>
<li><strong>插件安装机制</strong>：当调用 Vue.use(plugin) 时，Vue 会检查插件是否有一个 install 方法。如果有，它会调用 plugin.install(Vue, options)，其中 Vue 是 Vue 构造函数，options 是可选参数。这使得插件可以修改 Vue 的行为或添加新功能。</li>
<li><strong>避免重复安装</strong>：Vue.use 会自动检查插件是否已安装，如果已安装，则不会重复调用 install 方法。</li>
<li><strong>使用时机</strong>：通常在创建 Vue 实例之前调用，例如在 main.js 中引入插件。</li>
</ul>
<h2 data-id="heading-40">17、Vue.js 常用的修饰符及其作用？</h2>
<ol>
<li>事件修饰符</li>
</ol>
<ul>
<li><strong>.stop</strong>：阻止事件冒泡，相当于 <code>event.stopPropagation()</code>。</li>
<li><strong>.prevent</strong>：阻止默认行为，相当于 <code>event.preventDefault()</code>。</li>
<li><strong>.capture</strong>：使用捕获模式而非冒泡模式触发事件。</li>
<li><strong>.self</strong>：只在事件从元素本身触发时执行（忽略子元素冒泡）。</li>
<li><strong>.once</strong>：事件只触发一次（相当于 addEventListener 的 once 选项）。</li>
<li><strong>.passive</strong>：改善滚动事件的性能（不阻塞 UI 线程）。</li>
<li><strong>.native</strong>：在自定义组件上监听原生 DOM 事件。</li>
</ul>
<ol start="2">
<li>v-model表单修饰符</li>
</ol>
<ul>
<li><strong>.lazy</strong>：在 change 事件后更新数据，而不是 input 事件（延迟更新）。</li>
<li><strong>.number</strong>：将输入值自动转换为数字类型。</li>
<li><strong>.trim</strong>：自动去除输入值的首尾空格。</li>
</ul>
<ol start="3">
<li>按键修饰符（Key Modifiers）</li>
</ol>
<ul>
<li><strong>.enter</strong>：监听 Enter 键。</li>
<li><strong>.tab</strong>：监听 Tab 键。</li>
<li><strong>.delete</strong>：监听 Delete 或 Backspace 键。</li>
<li><strong>.esc</strong>：监听 Esc 键。</li>
<li><strong>.space</strong>：监听空格键。</li>
<li><strong>.up / .down / .left / .right</strong>：监听方向键。</li>
</ul>
<ol start="4">
<li>.sync 修饰符</li>
</ol>
<p><code>.sync</code> 修饰符主要是为了简化组件间的双向数据绑定，它是一种语法糖，允许子组件通过特定事件更新父组件的 prop，而无需手动编写事件监听器。</p>
<h2 data-id="heading-41">18、vue3 中 ref 和 reactive 的区别？</h2>
<p>相同点：<code>ref</code> 和 <code>reactive</code> 都可以创建响应式数据。</p>
<p>不同点：</p>
<ol>
<li>入参不同：</li>
</ol>
<ul>
<li><strong>ref</strong>：可以传基本数据类型（primitive values，如number、string、Symbol、undefined、null、bigInt、boolean），也可以包括对象。</li>
<li><strong>reactive</strong>：只能传入引用数据(object、array等)。</li>
</ul>
<ol start="2">
<li>访问和修改方式不同：</li>
</ol>
<ul>
<li><strong>ref</strong>：必须使用 .value 来读写。</li>
<li><strong>reactive</strong>：像普通对象一样直接访问属性，无需额外后缀。</li>
</ul>
<ol start="3">
<li>实现上不同：</li>
</ol>
<ul>
<li><strong>ref</strong>：如果传入基础数据类型，直接用 RefImpl 类的 get set, 但如果传入的是引用数据类型，内部是借助 reactive 实现。</li>
<li><strong>reactive</strong>：内部采用 Proxy 进行代理实现的响应式。</li>
</ul>
<h2 data-id="heading-42">19、Vue3 中如何获取当前组件实例？</h2>
<p>通过 <code>getCurrentInstance</code> 函数可以获取当前组件实例。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { getCurrentInstance } from 'vue';
const instance = getCurrentInstance();
console.log('instance: ', instance);
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-43">20、如何使用异步组件？</h2>
<p>vue3:</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { defineAsyncComponent } from 'vue';
const AsyncCom = defineAsyncComponent(() =&gt; import('./MyComponent.vue'));
&lt;/script&gt;
</code></pre>
<p>vue2:</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script&gt;
export default {
  components: {
    AsyncCom: () =&gt; import('./MyComponent.vue')
  }
};
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-44">21、Vue.js 父子组件生命周期钩子的执行流程？</h2>
<ol>
<li><strong>组件创建阶段</strong>： 父 beforeCreate → 父 created → 父 beforeMount → 子 beforeCreate → 子 created → 子 beforeMount → 子 mounted → 父 mounted。</li>
<li><strong>组件更新阶段</strong>：父 beforeUpdate → 子 beforeUpdate → 子 updated → 父 updated。</li>
<li><strong>组件销毁阶段</strong>：父 beforeDestroy → 子 beforeDestroy → 子 destroyed → 父 destroyed。</li>
</ol>
<h2 data-id="heading-45">结语</h2>
<p>以上是整理的 20+ Vue 初、中级的高频面试题，如有错误或者可以优化的地方欢迎评论区指正，后续还会更新 Vue 面试题高级篇。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么我的react项目启动后，dom上的类名里没有代码位置信息]]></title>    <link>https://juejin.cn/post/7571279513247825946</link>    <guid>https://juejin.cn/post/7571279513247825946</guid>    <pubDate>2025-11-11T13:35:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571279513247825946" data-draft-id="7571351275976015923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么我的react项目启动后，dom上的类名里没有代码位置信息"/> <meta itemprop="keywords" content="React.js,前端"/> <meta itemprop="datePublished" content="2025-11-11T13:35:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么我的react项目启动后，dom上的类名里没有代码位置信息
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:35:54.000Z" title="Tue Nov 11 2025 13:35:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在写一个新的 React 项目，打开浏览器开发者工具，发现个有意思的事：之前团队一起写的项目在 Elements 面板里，每个 DOM 元素都带着一堆 <code>data-component-*</code> 属性，能直接看到是哪个文件的哪一行代码。而这个我自己新起的项目就只有普通的 HTML 标签。</p>
<p>这到底咋回事？是不是有什么调试神器？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1941db24d5df4402a5a59b95bf33328a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763472954&amp;x-signature=mWHd1MY8FRhsr9Xm6Yqzpj%2F1NEs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">React 的 DOM 为啥看不到组件名？</h2>
<p>先说个基础知识：React 组件最终会被编译成普通 HTML。你在 Elements 面板看到的是<strong>真实 DOM</strong>，不是 React 的虚拟 DOM。</p>
<p>比如这个组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"my-btn"</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<p>浏览器里只会看到：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-btn"</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>组件名 <code>MyButton</code> 根本不会出现在 DOM 里，因为它只是个 JavaScript 函数，最后返回的就是这个 <code>button</code> 元素。</p>
<h2 data-id="heading-1">那些能看到组件信息的项目是怎么做到的？</h2>
<p>看了别人的项目代码，发现都用了 Vite 调试插件。这类插件会给每个 React 元素注入调试属性：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">data-inspector</span>=<span class="hljs-string">"src/pages/HomePage.tsx:42:7"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>
&gt;</span>
  <span class="hljs-comment">&lt;!-- 内容 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>属性格式是 <code>文件路径:行号:列号</code>，一眼就能看出组件来源。</p>
<p>更强大的是，有些插件还支持<strong>点击页面元素直接跳转到 VS Code 源码</strong>！这才是真正的效率神器。</p>
<h2 data-id="heading-2">解决方案：vite-plugin-react-inspector</h2>
<p><code>vite-plugin-react-inspector</code> 是专门为 Vite + React 项目设计的调试工具，功能强大且易用。</p>
<h3 data-id="heading-3">安装</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D vite-plugin-react-inspector
<span class="hljs-comment"># 或</span>
npm install -D vite-plugin-react-inspector
</code></pre>
<h3 data-id="heading-4">配置很简单</h3>
<p>在 <code>vite.config.ts</code> 里添加：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Inspector</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-react-inspector'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> ({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">react</span>(),
    <span class="hljs-comment">// 只在开发模式启用</span>
    mode === <span class="hljs-string">'development'</span> &amp;&amp;
      <span class="hljs-title class_">Inspector</span>({
        <span class="hljs-attr">toggleButtonVisibility</span>: <span class="hljs-string">'always'</span>,
        <span class="hljs-attr">toggleComboKey</span>: <span class="hljs-string">'alt-shift'</span>,
      }),
  ].<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>),
}));
</code></pre>
<p>配置说明：</p>
<ul>
<li><code>toggleButtonVisibility: 'always'</code> - 始终显示检查器按钮</li>
<li><code>toggleComboKey: 'alt-shift'</code> - 使用 Alt+Shift 快捷键激活</li>
<li><code>mode === 'development'</code> - 生产环境自动禁用</li>
</ul>
<h3 data-id="heading-5">实际效果</h3>
<p>启动开发服务器后，在浏览器里看到的 DOM：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1221e687568c4d508cbee6eb65abca39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763472954&amp;x-signature=1Mnmxe%2BvP%2BBax%2FqeBL4mUT9T%2FMg%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-inspector</span>=<span class="hljs-string">"src/pages/HomePage.tsx:42:7"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 内容 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>属性格式是 <code>文件路径:行号:列号</code>，一眼就能看出来源。</p>
<p>然后复制在vscode搜索，直接就跳转到源码位置了。</p>
<h3 data-id="heading-6">仓库地址</h3>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsudongyuer%2Fvite-plugin-react-inspector" target="_blank" title="https://github.com/sudongyuer/vite-plugin-react-inspector" ref="nofollow noopener noreferrer">vite-plugin-react-inspector</a></strong> - GitHub 仓库，查看完整文档</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>